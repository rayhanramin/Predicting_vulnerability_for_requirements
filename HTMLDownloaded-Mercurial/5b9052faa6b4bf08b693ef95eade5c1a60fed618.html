<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24668:5b9052faa6b4bf08b693ef95eade5c1a60fed618</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 5b9052faa6b4bf08b693ef95eade5c1a60fed618" />
<meta property="og:url" content="/comm-central/rev/5b9052faa6b4bf08b693ef95eade5c1a60fed618" />
<meta property="og:description" content="Bug 1479904: Remove build files used for buildbot/comm-topdir configurations; r=Fallen" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 5b9052faa6b4bf08b693ef95eade5c1a60fed618 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/5b9052faa6b4bf08b693ef95eade5c1a60fed618">shortlog</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/5b9052faa6b4bf08b693ef95eade5c1a60fed618">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/5b9052faa6b4bf08b693ef95eade5c1a60fed618">files</a> |
changeset |
<a href="/comm-central/raw-rev/5b9052faa6b4bf08b693ef95eade5c1a60fed618">raw</a>  | <a href="/comm-central/archive/5b9052faa6b4bf08b693ef95eade5c1a60fed618.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1479904">Bug 1479904</a>: Remove build files used for buildbot/comm-topdir configurations; r=Fallen
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#84;&#111;&#109;&#32;&#80;&#114;&#105;&#110;&#99;&#101;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#104;&#111;&#99;&#97;&#116;&#46;&#99;&#97;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 01 Aug 2018 05:43:36 +0000</td></tr>

<tr>
 <td>changeset 24668</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/5b9052faa6b4bf08b693ef95eade5c1a60fed618">5b9052faa6b4bf08b693ef95eade5c1a60fed618</a></td>
</tr>



<tr>
<td>parent 24667</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/36a440d150e8f26681cd055cbdccf59a605667f1">36a440d150e8f26681cd055cbdccf59a605667f1</a>
</td>
</tr>

<tr>
<td>child 24669</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d1bb256c78f7a83615b4750f27c9bc62d9f83e2f">d1bb256c78f7a83615b4750f27c9bc62d9f83e2f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=5b9052faa6b4bf08b693ef95eade5c1a60fed618">14840</a></td></tr>
<tr><td>push user</td><td>mozilla@hocat.ca</td></tr>
<tr><td>push date</td><td class="date age">Wed, 05 Sep 2018 23:35:01 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@5b9052faa6b4 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=5b9052faa6b4bf08b693ef95eade5c1a60fed618">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&newProject=comm-central&newRevision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&newProject=comm-central&newRevision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&newProject=comm-central&newRevision=5b9052faa6b4bf08b693ef95eade5c1a60fed618&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1479904">1479904</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1479904">Bug 1479904</a>: Remove build files used for buildbot/comm-topdir configurations; r=Fallen

Differential Revision: <a href="https://phabricator.services.mozilla.com/D2581">https://phabricator.services.mozilla.com/D2581</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/aclocal.m4">aclocal.m4</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/aclocal.m4">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/aclocal.m4">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/aclocal.m4">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.mk">client.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.mk">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.py">client.py</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.py">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.py">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/client.py">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/baseconfig.mk">config/baseconfig.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/baseconfig.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/baseconfig.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/baseconfig.mk">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/config.mk">config/config.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/config.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/config.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/config.mk">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/configobj.py">config/configobj.py</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/configobj.py">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/configobj.py">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/configobj.py">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/autotargets.mk">config/makefiles/autotargets.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/autotargets.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/autotargets.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/autotargets.mk">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/makeutils.mk">config/makefiles/makeutils.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/makeutils.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/makeutils.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/makefiles/makeutils.mk">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/printconfigsetting.py">config/printconfigsetting.py</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/printconfigsetting.py">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/printconfigsetting.py">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/printconfigsetting.py">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/recurse.mk">config/recurse.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/recurse.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/recurse.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/recurse.mk">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/rules.mk">config/rules.mk</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/rules.mk">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/rules.mk">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/config/rules.mk">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.in">configure.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.in">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.in">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.py">configure.py</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.py">diff</a> |
<a href="/comm-central/comparison/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.py">comparison</a> |
<a href="/comm-central/log/5b9052faa6b4bf08b693ef95eade5c1a60fed618/configure.py">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">deleted file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- a/aclocal.m4</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ /dev/null</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -1,27 +0,0 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineminus">-dnl</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineminus">-dnl Local autoconf macros used with mozilla</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-dnl The contents of this file are under the Public Domain.</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-dnl</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineminus">-</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-builtin(include, mozilla/build/autoconf/toolchain.m4)dnl</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-builtin(include, mozilla/build/autoconf/config.status.m4)dnl</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-builtin(include, mozilla/build/autoconf/nspr.m4)dnl</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-builtin(include, mozilla/build/autoconf/nss.m4)dnl</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-builtin(include, mozilla/build/autoconf/pkg.m4)dnl</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-builtin(include, mozilla/build/autoconf/codeset.m4)dnl</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-builtin(include, mozilla/build/autoconf/altoptions.m4)dnl</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-builtin(include, mozilla/build/autoconf/mozprog.m4)dnl</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-builtin(include, mozilla/build/autoconf/acwinpaths.m4)dnl</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-builtin(include, mozilla/build/autoconf/lto.m4)dnl</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-builtin(include, mozilla/build/autoconf/frameptr.m4)dnl</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-builtin(include, mozilla/build/autoconf/compiler-opts.m4)dnl</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-builtin(include, mozilla/build/autoconf/zlib.m4)dnl</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-builtin(include, mozilla/build/autoconf/expandlibs.m4)dnl</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-MOZ_PROG_CHECKMSYS()</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-# Read the user's .mozconfig script.  We can't do this in</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-# configure.in: autoconf puts the argument parsing code above anything</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-# expanded from configure.in, and we need to get the configure options</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-# from .mozconfig in place before that argument parsing code.</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-dnl MOZ_READ_MOZCONFIG(mozilla)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">deleted file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- a/client.mk</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ /dev/null</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -1,468 +0,0 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">-</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineminus">-# Build a comm application (Mozilla calendar, mail or suite).</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineminus">-#</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineminus">-# To build a tree,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-#    1. hg clone https://hg.mozilla.org/comm-central comm</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-#    2. cd comm</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-#    3. python client.py checkout</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-#    4. create your .mozconfig file with</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-#       ac_add_options --enable-application=suite</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-#         (or mail, or calendar)</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-#    5. gmake -f client.mk</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-#</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-# Other targets (gmake -f client.mk [targets...]),</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-#    build</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-#    clean</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-#    distclean</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-#</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-# See http://developer.mozilla.org/en/Build_Documentation for</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-# more information.</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-#</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-# Options:</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-#   MOZ_BUILD_PROJECTS   - Build multiple projects in subdirectories</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-#                          of MOZ_OBJDIR</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-#   MOZ_OBJDIR           - Destination object directory</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-#   MOZ_MAKE_FLAGS       - Flags to pass to $(MAKE)</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-#   MOZ_PREFLIGHT_ALL  } - Makefiles to run before any project in</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-#   MOZ_PREFLIGHT      }   MOZ_BUILD_PROJECTS, before each project, after</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-#   MOZ_POSTFLIGHT     }   each project, and after all projects; these</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-#   MOZ_POSTFLIGHT_ALL }   variables contain space-separated lists</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-#   MOZ_UNIFY_BDATE      - Set to use the same bdate for each project in</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-#                          MOZ_BUILD_PROJECTS</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-#</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-#######################################################################</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-# Defines</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-comma := ,</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-CWD := $(CURDIR)</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-ifneq (1,$(words $(CWD)))</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-$(error The mozilla directory cannot be located in a path with spaces.)</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-endif</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-ifeq &quot;$(CWD)&quot; &quot;/&quot;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-CWD   := /.</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-endif</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-ifndef TOPSRCDIR</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-ifeq (,$(wildcard client.mk))</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-TOPSRCDIR := $(patsubst %/,%,$(dir $(MAKEFILE_LIST)))</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-else</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-TOPSRCDIR := $(CWD)</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-endif</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-endif</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-SH := /bin/sh</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-PERL ?= perl</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-PYTHON ?= $(shell which python2.7 &gt; /dev/null 2&gt;&amp;1 &amp;&amp; echo python2.7 || echo python)</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-CONFIG_GUESS_SCRIPT := $(wildcard $(TOPSRCDIR)/build/autoconf/config.guess)</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-ifdef CONFIG_GUESS_SCRIPT</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-  CONFIG_GUESS := $(shell $(CONFIG_GUESS_SCRIPT))</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-endif</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-####################################</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-# Sanity checks</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-# Windows checks.</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-ifneq (,$(findstring mingw,$(CONFIG_GUESS)))</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-# check for CRLF line endings</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-ifneq (0,$(shell $(PERL) -e 'binmode(STDIN); while (&lt;STDIN&gt;) { if (/\r/) { print &quot;1&quot;; exit } } print &quot;0&quot;' &lt; $(TOPSRCDIR)/client.mk))</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-$(error This source tree appears to have Windows-style line endings. To \</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-convert it to Unix-style line endings, check \</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-&quot;https://developer.mozilla.org/en-US/docs/Developer_Guide/Mozilla_build_FAQ\#Win32-specific_questions&quot; \</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-for a workaround of this issue.)</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-endif</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-endif</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-####################################</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-# Load mozconfig Options</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-# See build pages, http://www.mozilla.org/build/ for how to set up mozconfig.</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-MOZCONFIG_LOADER := build/autoconf/mozconfig2client-mk</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-define CR</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-endef</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-# As $(shell) doesn't preserve newlines, use sed to replace them with an</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-# unlikely sequence (||), which is then replaced back to newlines by make</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-# before evaluation. $(shell) replacing newlines with spaces, || is always</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-# followed by a space (since sed doesn't remove newlines), except on the</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-# last line, so replace both '|| ' and '||'.</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-# Also, make MOZ_PGO available to mozconfig when passed on make command line.</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-MOZCONFIG_CONTENT := $(subst ||,$(CR),$(subst || ,$(CR),$(shell MOZ_PGO=$(MOZ_PGO) $(TOPSRCDIR)/$(MOZCONFIG_LOADER) $(TOPSRCDIR) | sed 's/$$/||/')))</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-$(eval $(MOZCONFIG_CONTENT))</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-export FOUND_MOZCONFIG</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-# As '||' was used as a newline separator, it means it's not occurring in</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-# lines themselves. It can thus safely be used to replaces normal spaces,</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-# to then replace newlines with normal spaces. This allows to get a list</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-# of mozconfig output lines.</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-MOZCONFIG_OUT_LINES := $(subst $(CR), ,$(subst $(NULL) $(NULL),||,$(MOZCONFIG_CONTENT)))</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-# Filter-out comments from those lines.</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-START_COMMENT = \#</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-MOZCONFIG_OUT_FILTERED := $(filter-out $(START_COMMENT)%,$(MOZCONFIG_OUT_LINES))</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-ifdef MOZ_PGO</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-export MOZ_PGO</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-endif</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-# Automatically add -jN to make flags if not defined. N defaults to number of cores.</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-ifeq (,$(findstring -j,$(MOZ_MAKE_FLAGS)))</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-  cores=$(shell $(PYTHON) -c 'import multiprocessing; print(multiprocessing.cpu_count())')</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-  MOZ_MAKE_FLAGS += -j$(cores)</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-endif</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineminus">-</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-ifndef MOZ_OBJDIR</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineminus">-  MOZ_OBJDIR = obj-$(CONFIG_GUESS)</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-else</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-# On Windows Pymake builds check MOZ_OBJDIR doesn't start with &quot;/&quot;</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-  ifneq (,$(findstring mingw,$(CONFIG_GUESS)))</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-  ifeq (1_a,$(.PYMAKE)_$(firstword a$(subst /, ,$(MOZ_OBJDIR))))</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-  $(error For Windows Pymake builds, MOZ_OBJDIR must be a Windows [and not MSYS] style path.)</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-  endif</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-  endif</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-endif</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-ifdef MOZ_BUILD_PROJECTS</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-ifdef MOZ_CURRENT_PROJECT</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-  OBJDIR = $(MOZ_OBJDIR)/$(MOZ_CURRENT_PROJECT)</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-  MOZ_MAKE = $(MAKE) $(MOZ_MAKE_FLAGS) -C $(OBJDIR)</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-  BUILD_PROJECT_ARG = MOZ_BUILD_APP=$(MOZ_CURRENT_PROJECT)</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-else</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-  OBJDIR = $(error Cannot find the OBJDIR when MOZ_CURRENT_PROJECT is not set.)</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-  MOZ_MAKE = $(error Cannot build in the OBJDIR when MOZ_CURRENT_PROJECT is not set.)</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-endif</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-else # MOZ_BUILD_PROJECTS</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-OBJDIR = $(MOZ_OBJDIR)</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-MOZ_MAKE = $(MAKE) $(MOZ_MAKE_FLAGS) -C $(OBJDIR)</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-endif # MOZ_BUILD_PROJECTS</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">-</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-# If we have a MOZ_OBJDIR that's set from the environment, ensure that it is an</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-# absolute path.</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-ifdef MOZ_OBJDIR</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-MOZ_OBJDIR := $(shell $(PYTHON) -c &quot;import os.path; print(os.path.join(\&quot;$(TOPSRCDIR)\&quot;, \&quot;$(MOZ_OBJDIR)\&quot;).replace('\\\\','/'))&quot;)</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-endif</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-# 'configure' scripts generated by autoconf.</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-CONFIGURES := $(TOPSRCDIR)/configure</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineminus">-CONFIGURES += $(TOPSRCDIR)/mozilla/configure</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-CONFIGURES += $(TOPSRCDIR)/mozilla/js/src/configure</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-# Make targets that are going to be passed to the real build system</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-OBJDIR_TARGETS = install export libs clean realclean distclean maybe_clobber_profiledbuild upload sdk installer package package-compare stage-package source-package l10n-check automation/build</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineminus">-</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineminus">-#######################################################################</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineminus">-# Rules</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineminus">-</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineminus">-# The default rule is build</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineminus">-build::</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineminus">-</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineminus">-# Define mkdir</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineminus">-include $(TOPSRCDIR)/config/makefiles/makeutils.mk</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineminus">-include $(TOPSRCDIR)/config/makefiles/autotargets.mk</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineminus">-</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineminus">-# Create a makefile containing the mk_add_options values from mozconfig,</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineminus">-# but only do so when OBJDIR is defined (see further above).</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineminus">-ifdef MOZ_BUILD_PROJECTS</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineminus">-ifdef MOZ_CURRENT_PROJECT</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineminus">-WANT_MOZCONFIG_MK = 1</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineminus">-else</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineminus">-WANT_MOZCONFIG_MK =</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineminus">-endif</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineminus">-else</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineminus">-WANT_MOZCONFIG_MK = 1</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineminus">-endif</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineminus">-</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineminus">-ifdef WANT_MOZCONFIG_MK</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineminus">-# For now, only output &quot;export&quot; lines from mozconfig2client-mk output.</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineminus">-MOZCONFIG_MK_LINES := $(filter export||%,$(MOZCONFIG_OUT_LINES))</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineminus">-$(OBJDIR)/.mozconfig.mk: $(FOUND_MOZCONFIG) $(call mkdir_deps,$(OBJDIR))</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-	$(if $(MOZCONFIG_MK_LINES),( $(foreach line,$(MOZCONFIG_MK_LINES), echo &quot;$(subst ||, ,$(line))&quot;;) )) &gt; $@</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineminus">-ifdef MOZ_CURRENT_PROJECT</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineminus">-	echo export MOZ_CURRENT_PROJECT=$(MOZ_CURRENT_PROJECT) &gt;&gt; $@</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineminus">-endif</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineminus">-</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-# Include that makefile so that it is created. This should not actually change</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-# the environment since MOZCONFIG_CONTENT, which MOZCONFIG_OUT_LINES derives</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-# from, has already been eval'ed.</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-include $(OBJDIR)/.mozconfig.mk</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineminus">-endif</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineminus">-</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineminus">-# UPLOAD_EXTRA_FILES is appended to and exported from mozconfig, which makes</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-# submakes as well as configure add even more to that, so just unexport it</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineminus">-# for submakes to pick it from .mozconfig.mk and for configure to pick it</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineminus">-# from mach environment.</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineminus">-unexport UPLOAD_EXTRA_FILES</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineminus">-</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineminus">-# These targets are candidates for auto-running client.py</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineminus">-</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineminus">-ifeq (01,$(MAKELEVEL)$(if $(ALWAYS_RUN_CLIENT_PY),1,))</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineminus">-</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineminus">-build profiledbuild configure:: run_client_py</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineminus">-	$(MAKE) -f $(TOPSRCDIR)/client.mk $@</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineminus">-else</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineminus">-</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineminus">-</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineminus">-# Print out any options loaded from mozconfig.</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-all build clean distclean export libs install realclean::</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-ifneq (,$(strip $(MOZCONFIG_OUT_FILTERED)))</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineminus">-	$(info Adding client.mk options from $(FOUND_MOZCONFIG):)</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-	$(foreach line,$(MOZCONFIG_OUT_FILTERED),$(info $(NULL) $(NULL) $(NULL) $(NULL) $(subst ||, ,$(line))))</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineminus">-endif</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineminus">-</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineminus">-# Windows equivalents</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineminus">-build_all: build</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineminus">-clobber clobber_all: clean</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">-</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineminus">-# Do everything from scratch</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineminus">-everything: clean build</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineminus">-</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineminus">-####################################</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineminus">-# Profile-Guided Optimization</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineminus">-#  To use this, you should set the following variables in your mozconfig</span>
<a href="#l2.242"></a><span id="l2.242" class="difflineminus">-#    mk_add_options PROFILE_GEN_SCRIPT=/path/to/profile-script</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-#</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-#  The profile script should exercise the functionality to be included</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-#  in the profile feedback.</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineminus">-#</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineminus">-#  This is up here, outside of the MOZ_CURRENT_PROJECT logic so that this</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineminus">-#  is usable in multi-pass builds, where you might not have a runnable</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineminus">-#  application until all the build passes and postflight scripts have run.</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineminus">-ifdef MOZ_OBJDIR</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineminus">-  PGO_OBJDIR = $(MOZ_OBJDIR)</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-else</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineminus">-  PGO_OBJDIR := $(TOPSRCDIR)</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineminus">-endif</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineminus">-</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineminus">-profiledbuild::</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineminus">-	$(MAKE) -f $(TOPSRCDIR)/client.mk build MOZ_PROFILE_GENERATE=1</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineminus">-	$(MAKE) -C $(PGO_OBJDIR) stage-package</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineminus">-	OBJDIR=${PGO_OBJDIR} $(PROFILE_GEN_SCRIPT)</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineminus">-	$(MAKE) -f $(TOPSRCDIR)/client.mk maybe_clobber_profiledbuild</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineminus">-	$(MAKE) -f $(TOPSRCDIR)/client.mk build MOZ_PROFILE_USE=1</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineminus">-</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineminus">-#####################################################</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineminus">-# Build date unification</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineminus">-</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineminus">-ifdef MOZ_UNIFY_BDATE</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineminus">-ifndef MOZ_BUILD_DATE</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineminus">-ifdef MOZ_BUILD_PROJECTS</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-MOZ_BUILD_DATE = $(shell $(PYTHON) $(TOPSRCDIR)/mozilla/build/variables.py buildid_header | awk '{print $$3}')</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-export MOZ_BUILD_DATE</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineminus">-endif</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-endif</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-endif</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineminus">-</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineminus">-#####################################################</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-# Preflight, before building any project</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineminus">-</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineminus">-build preflight_all::</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineminus">-ifeq (,$(MOZ_CURRENT_PROJECT)$(if $(MOZ_PREFLIGHT_ALL),,1))</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineminus">-# Don't run preflight_all for individual projects in multi-project builds</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineminus">-# (when MOZ_CURRENT_PROJECT is set.)</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-ifndef MOZ_BUILD_PROJECTS</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-# Building a single project, OBJDIR is usable.</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-	set -e; \</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-	for mkfile in $(MOZ_PREFLIGHT_ALL); do \</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/$$mkfile preflight_all TOPSRCDIR=$(TOPSRCDIR) OBJDIR=$(OBJDIR) MOZ_OBJDIR=$(MOZ_OBJDIR); \</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineminus">-	done</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineminus">-else</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-# OBJDIR refers to the project-specific OBJDIR, which is not available at</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-# this point when building multiple projects.  Only MOZ_OBJDIR is available.</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineminus">-	set -e; \</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineminus">-	for mkfile in $(MOZ_PREFLIGHT_ALL); do \</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/$$mkfile preflight_all TOPSRCDIR=$(TOPSRCDIR) MOZ_OBJDIR=$(MOZ_OBJDIR) MOZ_BUILD_PROJECTS='$(MOZ_BUILD_PROJECTS)'; \</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineminus">-	done</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineminus">-endif</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineminus">-endif</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineminus">-</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineminus">-# If we're building multiple projects, but haven't specified which project,</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineminus">-# loop through them.</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineminus">-</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineminus">-ifeq (,$(MOZ_CURRENT_PROJECT)$(if $(MOZ_BUILD_PROJECTS),,1))</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineminus">-configure build preflight postflight $(OBJDIR_TARGETS)::</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineminus">-	set -e; \</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineminus">-	for app in $(MOZ_BUILD_PROJECTS); do \</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/client.mk $@ MOZ_CURRENT_PROJECT=$$app; \</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineminus">-	done</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineminus">-</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineminus">-else</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineminus">-</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineminus">-# MOZ_CURRENT_PROJECT: either doing a single-project build, or building an</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-# individual project in a multi-project build.</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineminus">-####################################</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineminus">-# Configure</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineminus">-</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineminus">-MAKEFILE      = $(wildcard $(OBJDIR)/Makefile)</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineminus">-CONFIG_STATUS = $(wildcard $(OBJDIR)/config.status)</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineminus">-CONFIG_CACHE  = $(wildcard $(OBJDIR)/config.cache)</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineminus">-</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineminus">-EXTRA_CONFIG_DEPS := \</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineminus">-	$(TOPSRCDIR)/aclocal.m4 \</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineminus">-	$(TOPSRCDIR)/mozilla/aclocal.m4 \</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineminus">-	$(TOPSRCDIR)/mozilla/old-configure.in \</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-	$(wildcard $(TOPSRCDIR)/mozilla/build/autoconf/*.m4) \</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">-	$(TOPSRCDIR)/mozilla/js/src/aclocal.m4 \</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-	$(TOPSRCDIR)/mozilla/js/src/old-configure.in \</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-	$(NULL)</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineminus">-$(CONFIGURES): %: %.in $(EXTRA_CONFIG_DEPS)</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-	@echo Generating $@</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-	sed '1,/^divert/d' $&lt; &gt; $@</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineminus">-	chmod +x $@</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineminus">-</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineminus">-CONFIG_STATUS_DEPS := \</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineminus">-	$(wildcard $(CONFIGURES)) \</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineminus">-	$(wildcard $(TOPSRCDIR)/mozilla/nsprpub/configure) \</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineminus">-	$(wildcard $(TOPSRCDIR)/mozilla/config/milestone.txt) \</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineminus">-	$(wildcard $(TOPSRCDIR)/ldap/sdks/c-sdk/configure) \</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineminus">-	$(wildcard $(addsuffix confvars.sh,$(wildcard $(TOPSRCDIR)/*/))) \</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineminus">-	$(NULL)</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">-</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineminus">-CONFIGURE_ENV_ARGS += \</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-  MAKE='$(MAKE)' \</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineminus">-  $(NULL)</span>
<a href="#l2.345"></a><span id="l2.345" class="difflineminus">-</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineminus">-# configure uses the program name to determine @srcdir@. Calling it without</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineminus">-#   $(TOPSRCDIR) will set @srcdir@ to '.'; otherwise, it is set to the full</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineminus">-#   path of $(TOPSRCDIR).</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineminus">-ifeq ($(TOPSRCDIR),$(OBJDIR))</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineminus">-  CONFIGURE = ./configure</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineminus">-else</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-  CONFIGURE = $(TOPSRCDIR)/configure</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineminus">-endif</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineminus">-</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineminus">-configure-files: $(CONFIGURES)</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineminus">-</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineminus">-configure-preqs = \</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineminus">-  configure-files \</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineminus">-  $(call mkdir_deps,$(OBJDIR)) \</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineminus">-  $(if $(MOZ_BUILD_PROJECTS),$(call mkdir_deps,$(MOZ_OBJDIR))) \</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineminus">-  $(NULL)</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineminus">-</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineminus">-configure:: $(configure-preqs)</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineminus">-	@echo cd $(OBJDIR);</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineminus">-	@echo $(CONFIGURE) $(CONFIGURE_ARGS)</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineminus">-	@cd $(OBJDIR) &amp;&amp; $(BUILD_PROJECT_ARG) $(CONFIGURE_ENV_ARGS) $(CONFIGURE) $(CONFIGURE_ARGS) \</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineminus">-	  || ( echo '*** Fix above errors and then restart with\</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineminus">-               &quot;$(MAKE) -f client.mk build&quot;' &amp;&amp; exit 1 )</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineminus">-	@touch $(OBJDIR)/Makefile</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineminus">-</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineminus">-ifneq (,$(MAKEFILE))</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineminus">-$(OBJDIR)/Makefile: $(OBJDIR)/config.status</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineminus">-</span>
<a href="#l2.374"></a><span id="l2.374" class="difflineminus">-$(OBJDIR)/config.status: $(CONFIG_STATUS_DEPS)</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineminus">-else</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineminus">-$(OBJDIR)/Makefile: $(CONFIG_STATUS_DEPS)</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineminus">-endif</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineminus">-	@$(MAKE) -f $(TOPSRCDIR)/client.mk configure</span>
<a href="#l2.379"></a><span id="l2.379" class="difflineminus">-</span>
<a href="#l2.380"></a><span id="l2.380" class="difflineminus">-ifneq (,$(CONFIG_STATUS))</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineminus">-$(OBJDIR)/config/autoconf.mk: $(TOPSRCDIR)/config/autoconf.mk.in</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineminus">-	$(PYTHON) $(OBJDIR)/config.status -n --file=$(OBJDIR)/config/autoconf.mk</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineminus">-endif</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineminus">-</span>
<a href="#l2.385"></a><span id="l2.385" class="difflineminus">-</span>
<a href="#l2.386"></a><span id="l2.386" class="difflineminus">-####################################</span>
<a href="#l2.387"></a><span id="l2.387" class="difflineminus">-# Preflight</span>
<a href="#l2.388"></a><span id="l2.388" class="difflineminus">-</span>
<a href="#l2.389"></a><span id="l2.389" class="difflineminus">-build preflight::</span>
<a href="#l2.390"></a><span id="l2.390" class="difflineminus">-ifdef MOZ_PREFLIGHT</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineminus">-	set -e; \</span>
<a href="#l2.392"></a><span id="l2.392" class="difflineminus">-	for mkfile in $(MOZ_PREFLIGHT); do \</span>
<a href="#l2.393"></a><span id="l2.393" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/$$mkfile preflight TOPSRCDIR=$(TOPSRCDIR) OBJDIR=$(OBJDIR) MOZ_OBJDIR=$(MOZ_OBJDIR); \</span>
<a href="#l2.394"></a><span id="l2.394" class="difflineminus">-	done</span>
<a href="#l2.395"></a><span id="l2.395" class="difflineminus">-endif</span>
<a href="#l2.396"></a><span id="l2.396" class="difflineminus">-</span>
<a href="#l2.397"></a><span id="l2.397" class="difflineminus">-####################################</span>
<a href="#l2.398"></a><span id="l2.398" class="difflineminus">-# Build it</span>
<a href="#l2.399"></a><span id="l2.399" class="difflineminus">-</span>
<a href="#l2.400"></a><span id="l2.400" class="difflineminus">-build::  $(OBJDIR)/Makefile $(OBJDIR)/config.status</span>
<a href="#l2.401"></a><span id="l2.401" class="difflineminus">-	+$(MOZ_MAKE)</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineminus">-</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineminus">-####################################</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineminus">-# Other targets</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineminus">-</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineminus">-# Pass these target onto the real build system</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineminus">-$(OBJDIR_TARGETS):: $(OBJDIR)/Makefile $(OBJDIR)/config.status</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineminus">-	+$(MOZ_MAKE) $@</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineminus">-</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineminus">-####################################</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineminus">-# Postflight</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineminus">-</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineminus">-build postflight::</span>
<a href="#l2.414"></a><span id="l2.414" class="difflineminus">-ifdef MOZ_POSTFLIGHT</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineminus">-	set -e; \</span>
<a href="#l2.416"></a><span id="l2.416" class="difflineminus">-	for mkfile in $(MOZ_POSTFLIGHT); do \</span>
<a href="#l2.417"></a><span id="l2.417" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/$$mkfile postflight TOPSRCDIR=$(TOPSRCDIR) OBJDIR=$(OBJDIR) MOZ_OBJDIR=$(MOZ_OBJDIR); \</span>
<a href="#l2.418"></a><span id="l2.418" class="difflineminus">-	done</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineminus">-endif</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineminus">-</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineminus">-endif # MOZ_CURRENT_PROJECT</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineminus">-endif # RAN_CLIENT_PY</span>
<a href="#l2.423"></a><span id="l2.423" class="difflineminus">-</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineminus">-####################################</span>
<a href="#l2.425"></a><span id="l2.425" class="difflineminus">-# Postflight, after building all projects</span>
<a href="#l2.426"></a><span id="l2.426" class="difflineminus">-</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineminus">-build postflight_all::</span>
<a href="#l2.428"></a><span id="l2.428" class="difflineminus">-ifeq (,$(MOZ_CURRENT_PROJECT)$(if $(MOZ_POSTFLIGHT_ALL),,1))</span>
<a href="#l2.429"></a><span id="l2.429" class="difflineminus">-# Don't run postflight_all for individual projects in multi-project builds</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineminus">-# (when MOZ_CURRENT_PROJECT is set.)</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineminus">-ifndef MOZ_BUILD_PROJECTS</span>
<a href="#l2.432"></a><span id="l2.432" class="difflineminus">-# Building a single project, OBJDIR is usable.</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineminus">-	set -e; \</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineminus">-	for mkfile in $(MOZ_POSTFLIGHT_ALL); do \</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/$$mkfile postflight_all TOPSRCDIR=$(TOPSRCDIR) OBJDIR=$(OBJDIR) MOZ_OBJDIR=$(MOZ_OBJDIR); \</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineminus">-	done</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineminus">-else</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineminus">-# OBJDIR refers to the project-specific OBJDIR, which is not available at</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineminus">-# this point when building multiple projects.  Only MOZ_OBJDIR is available.</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineminus">-	set -e; \</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineminus">-	for mkfile in $(MOZ_POSTFLIGHT_ALL); do \</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineminus">-	  $(MAKE) -f $(TOPSRCDIR)/$$mkfile postflight_all TOPSRCDIR=$(TOPSRCDIR) MOZ_OBJDIR=$(MOZ_OBJDIR) MOZ_BUILD_PROJECTS='$(MOZ_BUILD_PROJECTS)'; \</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineminus">-	done</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineminus">-endif</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineminus">-endif</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineminus">-</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineminus">-cleansrcdir:</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineminus">-	@cd $(TOPSRCDIR); \</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineminus">-	if [ -f Makefile ]; then \</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineminus">-	  $(MAKE) distclean ; \</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineminus">-	else \</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineminus">-	  echo 'Removing object files from srcdir...'; \</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineminus">-	  rm -fr `find . -type d \( -name .deps -print -o -name CVS \</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineminus">-	          -o -exec test ! -d {}/CVS \; \) -prune \</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineminus">-	          -o \( -name '*.[ao]' -o -name '*.so' \) -type f -print`; \</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineminus">-	   build/autoconf/clean-config.sh; \</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineminus">-	fi;</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineminus">-</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineminus">-echo-variable-%:</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineminus">-	@echo $($*)</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineminus">-</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineminus">-checkout co: run_client_py</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineminus">-</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineminus">-run_client_py:</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineminus">-	$(PYTHON) $(TOPSRCDIR)/client.py checkout $(CLIENT_PY_ARGS)</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineminus">-</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineminus">-# This makefile doesn't support parallel execution. It does pass</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineminus">-# MOZ_MAKE_FLAGS to sub-make processes, so they will correctly execute</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineminus">-# in parallel.</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineminus">-.NOTPARALLEL:</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineminus">-</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineminus">-.PHONY: checkout co real_checkout build profiledbuild cleansrcdir pull_all build_all clobber clobber_all pull_and_build_all everything configure preflight_all preflight postflight postflight_all $(OBJDIR_TARGETS)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">deleted file mode 100755</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- a/client.py</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ /dev/null</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -1,661 +0,0 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineminus">-#!/usr/bin/env python</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-# Repo Defaults</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-# 'REV' controls the default rev for All the various repo's</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-# Define x_REV to override. Where x can be one of:</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-#  &quot;COMM&quot;, &quot;MOZILLA&quot;, &quot;CHATZILLA&quot;, &quot;INSPECTOR&quot;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-DEFAULTS = {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-    # Global Default Revision</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-    'REV': &quot;default&quot;,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-    # URL of the default hg repository to clone for ChatZilla.</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-    'CHATZILLA_REPO': 'https://hg.mozilla.org/chatzilla/',</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-    # The stable revision to use for the next branch</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-    #  'CHATZILLA_REV':  'SEA2_48_RELBRANCH',</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-    # URL of the default hg repository to clone for DOM Inspector.</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-    'INSPECTOR_REPO': 'https://hg.mozilla.org/dom-inspector/',</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-    # The stable revision to use for the next branch</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-    #  'INSPECTOR_REV':  'DOMI_2_0_17',</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-    # URL of the default hg repository to clone for Mozilla.</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-    'MOZILLA_REPO': 'https://hg.mozilla.org/mozilla-central/',</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-}</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-REPO_SHORT_NAMES = {</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-    'mozilla-central':  'moz',</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-    'dom-inspector':    'dom',</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-}</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-def get_DEFAULT_tag(index):</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-    if index in DEFAULTS:</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-        return DEFAULTS[index]</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-    else:</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-        return DEFAULTS['REV']</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-# The set of defaults below relate to the current switching mechanism between</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-# trunk or branches and back again if it is required.</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-# The current version expected in the .treestate file for nothing to happen.</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-# This reflects the &quot;[treestate] src_update_version = ...&quot; value.</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-#</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-# src_update_version values:</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-# '1' : mozilla/ may have been moved to mozilla-1.9.1 (or kept the same</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-#       depending on set-up).</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-# '2' : mozilla/ may have been moved back to mozilla-central.</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-CURRENT_TREESTATE_VERSION = '2'</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-# REGEX to match against, $1 should refer to protocol scheme</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-SWITCH_MOZILLA_REPO_REGEXP = '(ssh|http|https):\/\/hg\.mozilla\.org\/releases/mozilla-1.9.1\/?$'</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-# The location to back-up the existing mozilla repo to, e.g. &quot;.mozilla-trunk&quot;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-# or &quot;.mozilla-1.9.1&quot;.</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-SWITCH_MOZILLA_REPO_BACKUP_LOCATION = &quot;.mozilla-1.9.1&quot;</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-# This is the potential location for a repository from the last time we</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-# switched. Can be blank for no effect.</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-SWITCH_MOZILLA_REPO_OLD_REPO_LOCATION = &quot;.mozilla-trunk&quot;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-# This should be the same as DEFAULTS['MOZILLA_REPO'] but using %s instead</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-# of http for the scheme.</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-SWITCH_MOZILLA_REPO_REPLACE = '%s://hg.mozilla.org/mozilla-central/'</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-SWITCH_MOZILLA_BASE_REV = &quot;GECKO_1_9_1_BASE&quot;</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-import sys</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-pyver = sys.version_info</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-if pyver[0] &lt;= 1 or (pyver[0] == 2 and pyver[1] &lt; 6):</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-    sys.exit(&quot;ERROR: Python 2.6 or newer required&quot;)</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-elif pyver[0] &gt;= 3:</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-    # Python series 3 will syntax error here, Hack needed per Bug 601649c#8</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-    print &quot;ERROR: Python series 3 is not supported, use python 2.7&quot;</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-    sys.exit()  # Do an explicit sys.exit for code clarity.</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-del pyver</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-import os</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-from optparse import OptionParser, OptionValueError</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-import re</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-topsrcdir = os.path.dirname(__file__)</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-if topsrcdir == '':</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-    topsrcdir = '.'</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-TREE_STATE_FILE = os.path.join(topsrcdir, '.treestate')</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-from subprocess import check_call, check_output</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-def check_call_output(cmd, *args, **kwargs):</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-    return check_output(cmd, *args, **kwargs)</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-def check_call_noisy(cmd, retryMax=0, *args, **kwargs):</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-    &quot;&quot;&quot;Wrapper around execute_check_call() to allow retries before failing.</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-    |cmd|, is the command to try and execute.</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-    |retryMax|, is the maximum number of retries to attempt, 0 by default.</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-    def execute_check_call(cmd, *args, **kwargs):</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-        print &quot;Executing command:&quot;, cmd</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-        check_call(cmd, *args, **kwargs)</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-    # By default (= no retries), simply pass the call on.</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-    if retryMax == 0:</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-        execute_check_call(cmd, *args, **kwargs)</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-        return</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineminus">-</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineminus">-    # Loop (1 + retryMax) times, at most.</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineminus">-    for r in range(0, 1 + retryMax):</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-        # Add a retry header, not for initial call.</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-        if r != 0:</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-            print &gt;&gt; sys.stderr, &quot;Retrying previous command: %d of %d time(s)&quot; % (r, retryMax)</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-        try:</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-            # (Re-)Try the call.</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-            execute_check_call(cmd, *args, **kwargs)</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineminus">-            # If the call succeeded then no more retries.</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-            break</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-        except:</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-            # Print the exception without its traceback.</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-            # This traceback starts in the try block, which should be low value.</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-            print &gt;&gt; sys.stderr, &quot;The exception was:&quot;</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-            sys.excepthook(sys.exc_info()[0], sys.exc_info()[1], None)</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-            # Add a blank line.</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-            print &gt;&gt; sys.stderr</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-        else:</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-            # Raise our own exception.</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-            # This traceback starts at (= reports) the initial caller line.</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-            raise Exception(&quot;Command '%s' failed %d time(s). Giving up.&quot; %</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-                            (cmd, retryMax + 1))</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineminus">-def repo_config():</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineminus">-    &quot;&quot;&quot;Create/Update TREE_STATE_FILE as needed.</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-    switch_mozilla_repo() may be called if the branch that the mozilla repo is</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-    on needs changing</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-    import ConfigParser</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-    config_version = CURRENT_TREESTATE_VERSION</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-    config = ConfigParser.ConfigParser()</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-    # If the file exists, see if we need to move to the stable branch.</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-    # If it doesn't exist, we assume the user hasn't pulled before (or has</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-    # done it manually) and therefore leave his mozilla/ repo as it is.</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-    if os.path.exists(TREE_STATE_FILE):</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-        config.read([TREE_STATE_FILE])</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineminus">-        if config.has_option('treestate', 'src_update_version'):</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineminus">-            config_version = config.get('treestate', 'src_update_version')</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-        else:</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-            # If src_update_version doesn't exist, assume this to be '1' and</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-            # apply the update. This was because the first version of this</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineminus">-            # migration allowed the existence of the file to equate to '1'.</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineminus">-            config_version = '1'</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineminus">-</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineminus">-    # Do nothing if the current version is up to date.</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineminus">-    if config_version &lt; CURRENT_TREESTATE_VERSION:</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-        switch_mozilla_repo()</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineminus">-</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineminus">-    if not os.path.exists(TREE_STATE_FILE) or config_version &lt; CURRENT_TREESTATE_VERSION:</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineminus">-        if not config.has_section('treestate'):</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineminus">-            config.add_section('treestate')</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineminus">-        config.set('treestate', 'src_update_version',</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-                   CURRENT_TREESTATE_VERSION)</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineminus">-</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-        # Write this file out</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-        f = open(TREE_STATE_FILE, 'w')</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-        try:</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineminus">-            config.write(f)</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineminus">-        finally:</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-            f.close()</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineminus">-</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-def switch_mozilla_repo():</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-    &quot;&quot;&quot;If the mozilla/ repo matches SWITCH_MOZILLA_REPO_REGEXP then:</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-    1) Backup (unused anymore) checkout of mozilla/.</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-    2a) If SWITCH_MOZILLA_REPO_OLD_REPO_LOCATION exists, move that to mozilla/.</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineminus">-    2b) Else clone the backup of mozilla/ up to the SWITCH_MOZILLA_BASE_REV</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-        revision and set the pull location to SWITCH_MOZILLA_REPO_REPLACE.</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineminus">-</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-    It is expected that the normal pull/update functions in this script will</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-    update the new mozilla/ repo to the latest version.</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineminus">-</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-    mozilla_path = os.path.join(topsrcdir, 'mozilla')</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineminus">-    # Do nothing if there is no Mozilla directory.</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-    if not os.path.exists(mozilla_path):</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-        return</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineminus">-</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineminus">-    import ConfigParser</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineminus">-    import re</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineminus">-    config = ConfigParser.ConfigParser()</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-    config_path = os.path.join(mozilla_path, '.hg', 'hgrc')</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineminus">-    config.read([config_path])</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineminus">-    if not config.has_option('paths', 'default'):</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineminus">-        # Abort, not to get into a possibly inconsistent state.</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineminus">-        sys.exit(&quot;Error: default path in %s is undefined!&quot; % config_path)</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineminus">-</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineminus">-    # Compile the Mozilla repository regex.</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineminus">-    moz_old_regex = re.compile(SWITCH_MOZILLA_REPO_REGEXP, re.I)</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineminus">-    match = moz_old_regex.match(config.get('paths', 'default'))</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineminus">-    # Do nothing if not pulling from the one we're trying to switch from.</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineminus">-    if not match:</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineminus">-        return</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-    config.set('paths', 'default',</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-               SWITCH_MOZILLA_REPO_REPLACE % match.group(1))</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineminus">-</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-    if config.has_option('paths', 'default-push'):</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineminus">-        match = moz_old_regex.match(config.get('paths', 'default-push'))</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineminus">-        # Do not update this property if not pushing to Mozilla trunk.</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineminus">-        if match:</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-            config.set('paths', 'default-push',</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-                       SWITCH_MOZILLA_REPO_REPLACE % match.group(1))</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-    hgcloneopts = []</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-    if options.hgcloneopts:</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineminus">-        hgcloneopts = options.hgcloneopts.split()</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineminus">-</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-    hgopts = []</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineminus">-    if options.hgopts:</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineminus">-        hgopts = options.hgopts.split()</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineminus">-    backup_mozilla_path = os.path.join(topsrcdir,</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineminus">-                                       SWITCH_MOZILLA_REPO_BACKUP_LOCATION)</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineminus">-    print &quot;Moving mozilla to &quot; + SWITCH_MOZILLA_REPO_BACKUP_LOCATION + &quot;...&quot;</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineminus">-    try:</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineminus">-        os.rename(mozilla_path, backup_mozilla_path)</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineminus">-    except:</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineminus">-        # Print the exception without its traceback.</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineminus">-        sys.excepthook(sys.exc_info()[0], sys.exc_info()[1], None)</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineminus">-        sys.exit(&quot;Error: Mozilla directory renaming failed!&quot;)</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineminus">-</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineminus">-    # Does the user have a pre-existing backup repository?</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-    old_backup_repository = os.path.join(topsrcdir,</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineminus">-                                         SWITCH_MOZILLA_REPO_OLD_REPO_LOCATION)</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineminus">-    if SWITCH_MOZILLA_REPO_OLD_REPO_LOCATION != &quot;&quot; and \</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineminus">-            os.path.exists(old_backup_repository):</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineminus">-        # Yes, so let's use that</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineminus">-        print &quot;Moving &quot; + old_backup_repository + &quot; to &quot; + mozilla_path + &quot;...&quot;</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-        try:</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineminus">-            os.rename(old_backup_repository, mozilla_path)</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineminus">-        except:</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineminus">-            # Print the exception without its traceback.</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineminus">-            sys.excepthook(sys.exc_info()[0], sys.exc_info()[1], None)</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineminus">-            sys.exit(&quot;Error: Renaming old backup directory failed! You must recover manually.&quot;)</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineminus">-        # Let's leave the hgrc as it was, so any repo specific config is left</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineminus">-        # the same.</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineminus">-        return</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineminus">-</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineminus">-    # Locally clone common repository history.</span>
<a href="#l3.258"></a><span id="l3.258" class="difflineminus">-    check_call_noisy([options.hg, 'clone', '-r', SWITCH_MOZILLA_BASE_REV] +</span>
<a href="#l3.259"></a><span id="l3.259" class="difflineminus">-                     hgcloneopts + hgopts + [backup_mozilla_path, mozilla_path],</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineminus">-                     retryMax=options.retries)</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineminus">-</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineminus">-    # Rewrite hgrc for new local mozilla repo based on pre-existing hgrc</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineminus">-    # but with new values</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineminus">-    f = open(os.path.join(topsrcdir, 'mozilla', '.hg', 'hgrc'), 'w')</span>
<a href="#l3.265"></a><span id="l3.265" class="difflineminus">-    try:</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineminus">-        config.write(f)</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineminus">-    finally:</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineminus">-        f.close()</span>
<a href="#l3.269"></a><span id="l3.269" class="difflineminus">-</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineminus">-</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-def backup_cvs_extension(extensionName, extensionDir, extensionPath):</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-    &quot;&quot;&quot;Backup (obsolete) cvs checkout of extensionName.</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineminus">-</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineminus">-    # Do nothing if there is no extensionName cvs directory.</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineminus">-    if not os.path.exists(os.path.join(extensionPath, 'CVS')):</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineminus">-        return</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineminus">-</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineminus">-    extensionBackupPath = extensionPath + '-cvs'</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineminus">-    print &quot;Moving %s to %s-cvs...&quot; % (extensionDir, extensionDir)</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineminus">-    try:</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineminus">-        os.rename(extensionPath, extensionBackupPath)</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineminus">-    except:</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineminus">-        # Print the exception without its traceback.</span>
<a href="#l3.285"></a><span id="l3.285" class="difflineminus">-        sys.excepthook(sys.exc_info()[0], sys.exc_info()[1], None)</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineminus">-        sys.exit(&quot;Error: %s directory renaming failed!&quot; % extensionName)</span>
<a href="#l3.287"></a><span id="l3.287" class="difflineminus">-</span>
<a href="#l3.288"></a><span id="l3.288" class="difflineminus">-</span>
<a href="#l3.289"></a><span id="l3.289" class="difflineminus">-def do_hg_pull(dir, repository, hg, rev, hgtool=None, hgtool1=None):</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineminus">-    &quot;&quot;&quot;Clone if the dir doesn't exist, pull if it does.</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineminus">-</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineminus">-    fulldir = os.path.join(topsrcdir, dir)</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineminus">-</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineminus">-    hgcloneopts = []</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineminus">-    if options.hgcloneopts:</span>
<a href="#l3.297"></a><span id="l3.297" class="difflineminus">-        hgcloneopts = options.hgcloneopts.split()</span>
<a href="#l3.298"></a><span id="l3.298" class="difflineminus">-</span>
<a href="#l3.299"></a><span id="l3.299" class="difflineminus">-    hgopts = []</span>
<a href="#l3.300"></a><span id="l3.300" class="difflineminus">-    if options.hgopts:</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineminus">-        hgopts = options.hgopts.split()</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineminus">-    if hgtool or hgtool1:</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineminus">-        if not os.path.exists(hgtool):</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineminus">-            hgtool = hgtool1</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineminus">-</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineminus">-    if hgtool:</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineminus">-        hgtoolcmd = hgtool.split()</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineminus">-        # We need to strip the trailing slash from the repository url so that</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineminus">-        # the hg tool gets a url that's consistent with the rest of the build</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineminus">-        # automation.</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-        repo = repository.rstrip('/')</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineminus">-</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineminus">-        # Make sure to unset the PROPERTIES_FILE variable, otherwise hgtool</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineminus">-        # might use this for the revisions and branches.</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineminus">-        hgtoolenv = os.environ.copy()</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineminus">-        if 'PROPERTIES_FILE' in hgtoolenv:</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineminus">-            del hgtoolenv['PROPERTIES_FILE']</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineminus">-</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineminus">-        # Set up the tool options, most importantly the revision</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineminus">-        hgtoolopts = ['-r', rev]</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineminus">-        if options.verbose:</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineminus">-            hgtoolopts.append('-v')</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineminus">-</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineminus">-        check_call_noisy(['python'] + hgtoolcmd +</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineminus">-                         hgtoolopts +</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-                         [repo, fulldir],</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">-                         env=hgtoolenv,</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineminus">-                         retryMax=options.retries)</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineminus">-    else:</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineminus">-        if not os.path.exists(fulldir):</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineminus">-            fulldir = os.path.join(topsrcdir, dir)</span>
<a href="#l3.333"></a><span id="l3.333" class="difflineminus">-            check_call_noisy([hg, 'clone'] + hgcloneopts + hgopts +</span>
<a href="#l3.334"></a><span id="l3.334" class="difflineminus">-                             [repository, fulldir],</span>
<a href="#l3.335"></a><span id="l3.335" class="difflineminus">-                             retryMax=options.retries)</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineminus">-        else:</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineminus">-            cmd = [hg, 'pull', '-R', fulldir] + hgopts</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineminus">-            if repository is not None:</span>
<a href="#l3.339"></a><span id="l3.339" class="difflineminus">-                cmd.append(repository)</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineminus">-            check_call_noisy(cmd, retryMax=options.retries)</span>
<a href="#l3.341"></a><span id="l3.341" class="difflineminus">-</span>
<a href="#l3.342"></a><span id="l3.342" class="difflineminus">-        # update to specific revision</span>
<a href="#l3.343"></a><span id="l3.343" class="difflineminus">-        cmd = [hg, 'update', '-r', rev, '-R', fulldir] + hgopts</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineminus">-        if options.verbose:</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineminus">-            cmd.append('-v')</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineminus">-        # Explicitly never retry 'hg update': otherwise any merge failures are</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineminus">-        # ignored.</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineminus">-        # This command is local: a failure can't be caused by a network error.</span>
<a href="#l3.349"></a><span id="l3.349" class="difflineminus">-        check_call_noisy(cmd, retryMax=0)</span>
<a href="#l3.350"></a><span id="l3.350" class="difflineminus">-</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineminus">-    check_call([hg, 'parent', '-R', fulldir,</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineminus">-                '--template=Updated to revision {node}.\n'])</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineminus">-</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineminus">-    if options.tinderbox_print and dir != '.':</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-        got_rev = check_call_output([hg, 'parent', '-R', fulldir,</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-                                     '--template={node}'])</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineminus">-</span>
<a href="#l3.358"></a><span id="l3.358" class="difflineminus">-        url = check_call_output([hg, 'paths', 'default', '-R', fulldir]).rstrip().rstrip('/')</span>
<a href="#l3.359"></a><span id="l3.359" class="difflineminus">-        repo_name = url.split('/')[-1]</span>
<a href="#l3.360"></a><span id="l3.360" class="difflineminus">-        repo_short_name = REPO_SHORT_NAMES.get(repo_name, repo_name)</span>
<a href="#l3.361"></a><span id="l3.361" class="difflineminus">-</span>
<a href="#l3.362"></a><span id="l3.362" class="difflineminus">-        print &quot;TinderboxPrint:&lt;a href=%s/rev/%s title='Built from %s revision %s'&gt;%s:%s&lt;/a&gt;&quot; % (url, got_rev, repo_name, got_rev, repo_short_name, got_rev)</span>
<a href="#l3.363"></a><span id="l3.363" class="difflineminus">-</span>
<a href="#l3.364"></a><span id="l3.364" class="difflineminus">-</span>
<a href="#l3.365"></a><span id="l3.365" class="difflineminus">-def check_retries_option(option, opt_str, value, parser):</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineminus">-    if value &lt; 0:</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineminus">-        raise OptionValueError(&quot;%s option value needs to be positive (not '%d')&quot; %</span>
<a href="#l3.368"></a><span id="l3.368" class="difflineminus">-                               (opt_str, value))</span>
<a href="#l3.369"></a><span id="l3.369" class="difflineminus">-    setattr(parser.values, option.dest, value)</span>
<a href="#l3.370"></a><span id="l3.370" class="difflineminus">-</span>
<a href="#l3.371"></a><span id="l3.371" class="difflineminus">-</span>
<a href="#l3.372"></a><span id="l3.372" class="difflineminus">-def do_apply_patch(hg, patch, repo):</span>
<a href="#l3.373"></a><span id="l3.373" class="difflineminus">-    check_call_noisy([hg,</span>
<a href="#l3.374"></a><span id="l3.374" class="difflineminus">-                      'import',</span>
<a href="#l3.375"></a><span id="l3.375" class="difflineminus">-                      '-R', repo,</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineminus">-                      '-m', &quot;local patch from %s&quot; % patch,</span>
<a href="#l3.377"></a><span id="l3.377" class="difflineminus">-                      '--no-commit', '--force',</span>
<a href="#l3.378"></a><span id="l3.378" class="difflineminus">-                      patch,</span>
<a href="#l3.379"></a><span id="l3.379" class="difflineminus">-                      ],</span>
<a href="#l3.380"></a><span id="l3.380" class="difflineminus">-                     retryMax=0</span>
<a href="#l3.381"></a><span id="l3.381" class="difflineminus">-                     )</span>
<a href="#l3.382"></a><span id="l3.382" class="difflineminus">-    return</span>
<a href="#l3.383"></a><span id="l3.383" class="difflineminus">-</span>
<a href="#l3.384"></a><span id="l3.384" class="difflineminus">-import glob</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineminus">-</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineminus">-</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineminus">-def do_apply_patches(topsrcdir, hg):</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineminus">-    prefix_map = {</span>
<a href="#l3.389"></a><span id="l3.389" class="difflineminus">-        'mozilla': 'mozilla',</span>
<a href="#l3.390"></a><span id="l3.390" class="difflineminus">-        'chatzilla': os.path.join('mozilla', 'extensions', 'irc'),</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineminus">-        'inspector': os.path.join('mozilla', 'extensions', 'inspector'),</span>
<a href="#l3.392"></a><span id="l3.392" class="difflineminus">-    }</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineminus">-</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineminus">-    for prefix in prefix_map.keys():</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineminus">-        prefix_dir = prefix_map.get(prefix)</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-        files = glob.glob(&quot;%s*.patch&quot; % prefix)</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineminus">-        files.sort()</span>
<a href="#l3.398"></a><span id="l3.398" class="difflineminus">-        for file in files:</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineminus">-            patch = os.path.join(topsrcdir, file)</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-            if os.path.exists(patch):</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineminus">-                do_apply_patch(hg, patch, prefix_dir)</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineminus">-</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineminus">-o = OptionParser(usage=&quot;%prog [options] checkout&quot;)</span>
<a href="#l3.404"></a><span id="l3.404" class="difflineminus">-o.add_option(&quot;-m&quot;, &quot;--comm-repo&quot;, dest=&quot;comm_repo&quot;,</span>
<a href="#l3.405"></a><span id="l3.405" class="difflineminus">-             default=None,</span>
<a href="#l3.406"></a><span id="l3.406" class="difflineminus">-             help=&quot;URL of comm (Calendar/Mail/Suite) repository to pull from (default: use hg default in .hg/hgrc)&quot;)</span>
<a href="#l3.407"></a><span id="l3.407" class="difflineminus">-o.add_option(&quot;--skip-comm&quot;, dest=&quot;skip_comm&quot;,</span>
<a href="#l3.408"></a><span id="l3.408" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.409"></a><span id="l3.409" class="difflineminus">-             help=&quot;Skip pulling the comm (Calendar/Mail/Suite) repository.&quot;)</span>
<a href="#l3.410"></a><span id="l3.410" class="difflineminus">-o.add_option(&quot;--comm-rev&quot;, dest=&quot;comm_rev&quot;,</span>
<a href="#l3.411"></a><span id="l3.411" class="difflineminus">-             default=None,</span>
<a href="#l3.412"></a><span id="l3.412" class="difflineminus">-             help=&quot;Revision of comm (Calendar/Mail/Suite) repository to update to. If not present, COMM_REV from the environment will be used. If that doesn't exist the default is: \&quot;&quot; + get_DEFAULT_tag('COMM_REV') + &quot;\&quot;&quot;)</span>
<a href="#l3.413"></a><span id="l3.413" class="difflineminus">-</span>
<a href="#l3.414"></a><span id="l3.414" class="difflineminus">-o.add_option(&quot;-z&quot;, &quot;--mozilla-repo&quot;, dest=&quot;mozilla_repo&quot;,</span>
<a href="#l3.415"></a><span id="l3.415" class="difflineminus">-             default=None,</span>
<a href="#l3.416"></a><span id="l3.416" class="difflineminus">-             help=&quot;URL of Mozilla repository to pull from (default: use hg default in mozilla/.hg/hgrc; or if that file doesn't exist, use \&quot;&quot; + DEFAULTS['MOZILLA_REPO'] + &quot;\&quot;.)&quot;)</span>
<a href="#l3.417"></a><span id="l3.417" class="difflineminus">-o.add_option(&quot;--skip-mozilla&quot;, dest=&quot;skip_mozilla&quot;,</span>
<a href="#l3.418"></a><span id="l3.418" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.419"></a><span id="l3.419" class="difflineminus">-             help=&quot;Skip pulling the Mozilla repository.&quot;)</span>
<a href="#l3.420"></a><span id="l3.420" class="difflineminus">-o.add_option(&quot;--mozilla-rev&quot;, dest=&quot;mozilla_rev&quot;,</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineminus">-             default=None,</span>
<a href="#l3.422"></a><span id="l3.422" class="difflineminus">-             help=&quot;Revision of Mozilla repository to update to. If not present, MOZILLA_REV from the environment will be used. If that doesn't exist the default is: \&quot;&quot; + get_DEFAULT_tag('MOZILLA_REV') + &quot;\&quot;&quot;)</span>
<a href="#l3.423"></a><span id="l3.423" class="difflineminus">-</span>
<a href="#l3.424"></a><span id="l3.424" class="difflineminus">-o.add_option(&quot;--inspector-repo&quot;, dest=&quot;inspector_repo&quot;,</span>
<a href="#l3.425"></a><span id="l3.425" class="difflineminus">-             default=None,</span>
<a href="#l3.426"></a><span id="l3.426" class="difflineminus">-             help=&quot;URL of DOM Inspector repository to pull from (default: use hg default in mozilla/extensions/inspector/.hg/hgrc; or if that file doesn't exist, use \&quot;&quot; + DEFAULTS['INSPECTOR_REPO'] + &quot;\&quot;.)&quot;)</span>
<a href="#l3.427"></a><span id="l3.427" class="difflineminus">-o.add_option(&quot;--skip-inspector&quot;, dest=&quot;skip_inspector&quot;,</span>
<a href="#l3.428"></a><span id="l3.428" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.429"></a><span id="l3.429" class="difflineminus">-             help=&quot;Skip pulling the DOM Inspector repository.&quot;)</span>
<a href="#l3.430"></a><span id="l3.430" class="difflineminus">-o.add_option(&quot;--inspector-rev&quot;, dest=&quot;inspector_rev&quot;,</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineminus">-             default=None,</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineminus">-             help=&quot;Revision of DOM Inspector repository to update to. Default: \&quot;&quot; + get_DEFAULT_tag('INSPECTOR_REV') + &quot;\&quot;&quot;)</span>
<a href="#l3.433"></a><span id="l3.433" class="difflineminus">-</span>
<a href="#l3.434"></a><span id="l3.434" class="difflineminus">-o.add_option(&quot;--chatzilla-repo&quot;, dest=&quot;chatzilla_repo&quot;,</span>
<a href="#l3.435"></a><span id="l3.435" class="difflineminus">-             default=None,</span>
<a href="#l3.436"></a><span id="l3.436" class="difflineminus">-             help=&quot;URL of ChatZilla repository to pull from (default: use hg default in mozilla/extensions/irc/.hg/hgrc; or if that file doesn't exist, use \&quot;&quot; + DEFAULTS['CHATZILLA_REPO'] + &quot;\&quot;.)&quot;)</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineminus">-o.add_option(&quot;--skip-chatzilla&quot;, dest=&quot;skip_chatzilla&quot;,</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.439"></a><span id="l3.439" class="difflineminus">-             help=&quot;Skip pulling the ChatZilla repository.&quot;)</span>
<a href="#l3.440"></a><span id="l3.440" class="difflineminus">-o.add_option(&quot;--chatzilla-rev&quot;, dest=&quot;chatzilla_rev&quot;,</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineminus">-             default=None,</span>
<a href="#l3.442"></a><span id="l3.442" class="difflineminus">-             help=&quot;Revision of ChatZilla repository to update to. Default: \&quot;&quot; + get_DEFAULT_tag('CHATZILLA_REV') + &quot;\&quot;&quot;)</span>
<a href="#l3.443"></a><span id="l3.443" class="difflineminus">-</span>
<a href="#l3.444"></a><span id="l3.444" class="difflineminus">-o.add_option(&quot;--skip-venkman&quot;, dest=&quot;skip_venkman&quot;,</span>
<a href="#l3.445"></a><span id="l3.445" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.446"></a><span id="l3.446" class="difflineminus">-             help=&quot;Obsolete option, supported for backwards compat.&quot;)</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineminus">-o.add_option(&quot;--venkman-rev&quot;, dest=&quot;venkman_rev&quot;,</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineminus">-             default=None,</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineminus">-             help=&quot;Obsolete option, supported for backwards compat.&quot;)</span>
<a href="#l3.450"></a><span id="l3.450" class="difflineminus">-</span>
<a href="#l3.451"></a><span id="l3.451" class="difflineminus">-o.add_option(&quot;--hg&quot;, dest=&quot;hg&quot;, default=os.environ.get('HG', 'hg'),</span>
<a href="#l3.452"></a><span id="l3.452" class="difflineminus">-             help=&quot;The location of the hg binary&quot;)</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineminus">-o.add_option(&quot;-v&quot;, &quot;--verbose&quot;, dest=&quot;verbose&quot;,</span>
<a href="#l3.454"></a><span id="l3.454" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.455"></a><span id="l3.455" class="difflineminus">-             help=&quot;Enable verbose output on hg updates&quot;)</span>
<a href="#l3.456"></a><span id="l3.456" class="difflineminus">-o.add_option(&quot;--hgtool&quot;, dest=&quot;hgtool&quot;,</span>
<a href="#l3.457"></a><span id="l3.457" class="difflineminus">-             default=None,</span>
<a href="#l3.458"></a><span id="l3.458" class="difflineminus">-             help=&quot;Path to hgtool, if wanted&quot;)</span>
<a href="#l3.459"></a><span id="l3.459" class="difflineminus">-o.add_option(&quot;--hgtool1&quot;, dest=&quot;hgtool1&quot;,</span>
<a href="#l3.460"></a><span id="l3.460" class="difflineminus">-             default=None,</span>
<a href="#l3.461"></a><span id="l3.461" class="difflineminus">-             help=&quot;Alternative path to hgtool, if wanted&quot;)</span>
<a href="#l3.462"></a><span id="l3.462" class="difflineminus">-o.add_option(&quot;--hg-options&quot;, dest=&quot;hgopts&quot;,</span>
<a href="#l3.463"></a><span id="l3.463" class="difflineminus">-             help=&quot;Pass arbitrary options to hg commands (i.e. --debug, --time)&quot;)</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineminus">-o.add_option(&quot;--hg-clone-options&quot;, dest=&quot;hgcloneopts&quot;,</span>
<a href="#l3.465"></a><span id="l3.465" class="difflineminus">-             help=&quot;Pass arbitrary options to hg clone commands (i.e. --uncompressed)&quot;)</span>
<a href="#l3.466"></a><span id="l3.466" class="difflineminus">-</span>
<a href="#l3.467"></a><span id="l3.467" class="difflineminus">-o.add_option(&quot;--retries&quot;, dest=&quot;retries&quot;, type=&quot;int&quot;, metavar=&quot;NUM&quot;,</span>
<a href="#l3.468"></a><span id="l3.468" class="difflineminus">-             default=1, help=&quot;Number of times to retry a failed command before giving up. (default: 1)&quot;,</span>
<a href="#l3.469"></a><span id="l3.469" class="difflineminus">-             action=&quot;callback&quot;, callback=check_retries_option)</span>
<a href="#l3.470"></a><span id="l3.470" class="difflineminus">-</span>
<a href="#l3.471"></a><span id="l3.471" class="difflineminus">-o.add_option(&quot;-r&quot;, &quot;--rev&quot;, dest=&quot;default_rev&quot;,</span>
<a href="#l3.472"></a><span id="l3.472" class="difflineminus">-             default=None,</span>
<a href="#l3.473"></a><span id="l3.473" class="difflineminus">-             help=&quot;Revision of all repositories to update to, unless otherwise specified.&quot;)</span>
<a href="#l3.474"></a><span id="l3.474" class="difflineminus">-</span>
<a href="#l3.475"></a><span id="l3.475" class="difflineminus">-o.add_option(&quot;--apply-patches&quot;, dest=&quot;apply_patches&quot;,</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.477"></a><span id="l3.477" class="difflineminus">-             help=&quot;Look for and apply local patches (repo*.patch)&quot;)</span>
<a href="#l3.478"></a><span id="l3.478" class="difflineminus">-</span>
<a href="#l3.479"></a><span id="l3.479" class="difflineminus">-o.add_option(&quot;--tinderbox-print&quot;, dest=&quot;tinderbox_print&quot;,</span>
<a href="#l3.480"></a><span id="l3.480" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.481"></a><span id="l3.481" class="difflineminus">-             help=&quot;Print repo revisions for Tinderbox&quot;)</span>
<a href="#l3.482"></a><span id="l3.482" class="difflineminus">-</span>
<a href="#l3.483"></a><span id="l3.483" class="difflineminus">-o.add_option(&quot;--fixup-rust-vendoring-bug-1424825&quot;, dest=&quot;fixup_rust_vendoring&quot;,</span>
<a href="#l3.484"></a><span id="l3.484" class="difflineminus">-             action=&quot;store_true&quot;, default=False,</span>
<a href="#l3.485"></a><span id="l3.485" class="difflineminus">-             help=&quot;Remove checksums from vendored rust crates to work around Bug 1424825.&quot;)</span>
<a href="#l3.486"></a><span id="l3.486" class="difflineminus">-</span>
<a href="#l3.487"></a><span id="l3.487" class="difflineminus">-</span>
<a href="#l3.488"></a><span id="l3.488" class="difflineminus">-def fixup_comm_repo_options(options):</span>
<a href="#l3.489"></a><span id="l3.489" class="difflineminus">-    &quot;&quot;&quot;Check options.comm_repo value.</span>
<a href="#l3.490"></a><span id="l3.490" class="difflineminus">-</span>
<a href="#l3.491"></a><span id="l3.491" class="difflineminus">-    options.comm_repo is normally None.</span>
<a href="#l3.492"></a><span id="l3.492" class="difflineminus">-    This is fine -- our &quot;hg pull&quot; command will omit the repo URL.</span>
<a href="#l3.493"></a><span id="l3.493" class="difflineminus">-    The exception is the initial checkout, which does an &quot;hg clone&quot;.</span>
<a href="#l3.494"></a><span id="l3.494" class="difflineminus">-    That command requires a repository URL.</span>
<a href="#l3.495"></a><span id="l3.495" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineminus">-</span>
<a href="#l3.497"></a><span id="l3.497" class="difflineminus">-    if options.comm_repo is None and \</span>
<a href="#l3.498"></a><span id="l3.498" class="difflineminus">-            not os.path.exists(os.path.join(topsrcdir, '.hg')):</span>
<a href="#l3.499"></a><span id="l3.499" class="difflineminus">-        o.print_help()</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-        print</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineminus">-        print &quot;Error: the -m option is required for the initial checkout!&quot;</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineminus">-        sys.exit(2)</span>
<a href="#l3.503"></a><span id="l3.503" class="difflineminus">-</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineminus">-    # If COMM_REV is passed via environment, prefer that over the passed</span>
<a href="#l3.505"></a><span id="l3.505" class="difflineminus">-    # option so that automation can pass tagged versions while still defaulting</span>
<a href="#l3.506"></a><span id="l3.506" class="difflineminus">-    # to a certain revision via client.py-args.</span>
<a href="#l3.507"></a><span id="l3.507" class="difflineminus">-    envRev = os.environ.get(&quot;COMM_REV&quot;)</span>
<a href="#l3.508"></a><span id="l3.508" class="difflineminus">-    if envRev:</span>
<a href="#l3.509"></a><span id="l3.509" class="difflineminus">-        if options.comm_rev and options.comm_rev != envRev:</span>
<a href="#l3.510"></a><span id="l3.510" class="difflineminus">-            print &quot;Warning: Preferring COMM_REV (%s) over passed revision (%s)&quot; % (envRev, options.comm_rev)</span>
<a href="#l3.511"></a><span id="l3.511" class="difflineminus">-        else:</span>
<a href="#l3.512"></a><span id="l3.512" class="difflineminus">-            print &quot;Using COMM_REV from environment (%s)&quot; % envRev</span>
<a href="#l3.513"></a><span id="l3.513" class="difflineminus">-        options.comm_rev = envRev</span>
<a href="#l3.514"></a><span id="l3.514" class="difflineminus">-</span>
<a href="#l3.515"></a><span id="l3.515" class="difflineminus">-    # If no version was set before, use the default comm revision.</span>
<a href="#l3.516"></a><span id="l3.516" class="difflineminus">-    if options.comm_rev is None:</span>
<a href="#l3.517"></a><span id="l3.517" class="difflineminus">-        options.comm_rev = get_DEFAULT_tag(&quot;COMM_REV&quot;)</span>
<a href="#l3.518"></a><span id="l3.518" class="difflineminus">-</span>
<a href="#l3.519"></a><span id="l3.519" class="difflineminus">-</span>
<a href="#l3.520"></a><span id="l3.520" class="difflineminus">-def fixup_mozilla_repo_options(options):</span>
<a href="#l3.521"></a><span id="l3.521" class="difflineminus">-    &quot;&quot;&quot;Handle special case: initial checkout of Mozilla.</span>
<a href="#l3.522"></a><span id="l3.522" class="difflineminus">-</span>
<a href="#l3.523"></a><span id="l3.523" class="difflineminus">-    See fixup_comm_repo_options().</span>
<a href="#l3.524"></a><span id="l3.524" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.525"></a><span id="l3.525" class="difflineminus">-    if options.mozilla_repo is None:</span>
<a href="#l3.526"></a><span id="l3.526" class="difflineminus">-        if (os.environ.get('MOZ_AUTOMATION') == '1'</span>
<a href="#l3.527"></a><span id="l3.527" class="difflineminus">-                or not os.path.exists(os.path.join(topsrcdir, 'mozilla'))):</span>
<a href="#l3.528"></a><span id="l3.528" class="difflineminus">-            options.mozilla_repo = DEFAULTS['MOZILLA_REPO']</span>
<a href="#l3.529"></a><span id="l3.529" class="difflineminus">-        else:</span>
<a href="#l3.530"></a><span id="l3.530" class="difflineminus">-            # Fallback to using .hgrc as hgtool/share needs the repo</span>
<a href="#l3.531"></a><span id="l3.531" class="difflineminus">-            import ConfigParser</span>
<a href="#l3.532"></a><span id="l3.532" class="difflineminus">-            config = ConfigParser.ConfigParser()</span>
<a href="#l3.533"></a><span id="l3.533" class="difflineminus">-            config_path = os.path.join(topsrcdir, 'mozilla', '.hg', 'hgrc')</span>
<a href="#l3.534"></a><span id="l3.534" class="difflineminus">-            config.read([config_path])</span>
<a href="#l3.535"></a><span id="l3.535" class="difflineminus">-            if not config.has_option('paths', 'default'):</span>
<a href="#l3.536"></a><span id="l3.536" class="difflineminus">-                # Abort, not to get into a possibly inconsistent state.</span>
<a href="#l3.537"></a><span id="l3.537" class="difflineminus">-                sys.exit(&quot;Error: default path in %s is undefined!&quot; %</span>
<a href="#l3.538"></a><span id="l3.538" class="difflineminus">-                         config_path)</span>
<a href="#l3.539"></a><span id="l3.539" class="difflineminus">-</span>
<a href="#l3.540"></a><span id="l3.540" class="difflineminus">-            options.mozilla_repo = config.get('paths', 'default')</span>
<a href="#l3.541"></a><span id="l3.541" class="difflineminus">-</span>
<a href="#l3.542"></a><span id="l3.542" class="difflineminus">-    # If MOZILLA_REV is passed via environment, prefer that over the passed</span>
<a href="#l3.543"></a><span id="l3.543" class="difflineminus">-    # option so that automation can pass tagged versions while still defaulting</span>
<a href="#l3.544"></a><span id="l3.544" class="difflineminus">-    # to a certain revision via client.py-args.</span>
<a href="#l3.545"></a><span id="l3.545" class="difflineminus">-    envRev = os.environ.get(&quot;MOZILLA_REV&quot;)</span>
<a href="#l3.546"></a><span id="l3.546" class="difflineminus">-    if envRev:</span>
<a href="#l3.547"></a><span id="l3.547" class="difflineminus">-        if options.mozilla_rev and options.mozilla_rev != envRev:</span>
<a href="#l3.548"></a><span id="l3.548" class="difflineminus">-            print &quot;Warning: Preferring MOZILLA_REV (%s) over passed revision (%s)&quot; % (envRev, options.mozilla_rev)</span>
<a href="#l3.549"></a><span id="l3.549" class="difflineminus">-        else:</span>
<a href="#l3.550"></a><span id="l3.550" class="difflineminus">-            print &quot;Using MOZILLA_REV from environment (%s)&quot; % envRev</span>
<a href="#l3.551"></a><span id="l3.551" class="difflineminus">-        options.mozilla_rev = envRev</span>
<a href="#l3.552"></a><span id="l3.552" class="difflineminus">-</span>
<a href="#l3.553"></a><span id="l3.553" class="difflineminus">-    # If no version was set before, use the default mozilla revision.</span>
<a href="#l3.554"></a><span id="l3.554" class="difflineminus">-    if options.mozilla_rev is None:</span>
<a href="#l3.555"></a><span id="l3.555" class="difflineminus">-        options.mozilla_rev = get_DEFAULT_tag(&quot;MOZILLA_REV&quot;)</span>
<a href="#l3.556"></a><span id="l3.556" class="difflineminus">-</span>
<a href="#l3.557"></a><span id="l3.557" class="difflineminus">-</span>
<a href="#l3.558"></a><span id="l3.558" class="difflineminus">-def fixup_chatzilla_repo_options(options):</span>
<a href="#l3.559"></a><span id="l3.559" class="difflineminus">-    &quot;&quot;&quot;Handle special case: initial hg checkout of Chatzilla.</span>
<a href="#l3.560"></a><span id="l3.560" class="difflineminus">-</span>
<a href="#l3.561"></a><span id="l3.561" class="difflineminus">-    See fixup_comm_repo_options().</span>
<a href="#l3.562"></a><span id="l3.562" class="difflineminus">-    backup_cvs_extension() is also called.</span>
<a href="#l3.563"></a><span id="l3.563" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.564"></a><span id="l3.564" class="difflineminus">-</span>
<a href="#l3.565"></a><span id="l3.565" class="difflineminus">-    extensionPath = os.path.join(topsrcdir, 'mozilla', 'extensions', 'irc')</span>
<a href="#l3.566"></a><span id="l3.566" class="difflineminus">-</span>
<a href="#l3.567"></a><span id="l3.567" class="difflineminus">-    backup_cvs_extension('Chatzilla', 'irc', extensionPath)</span>
<a href="#l3.568"></a><span id="l3.568" class="difflineminus">-</span>
<a href="#l3.569"></a><span id="l3.569" class="difflineminus">-    if options.chatzilla_repo is None and not os.path.exists(extensionPath):</span>
<a href="#l3.570"></a><span id="l3.570" class="difflineminus">-        options.chatzilla_repo = DEFAULTS['CHATZILLA_REPO']</span>
<a href="#l3.571"></a><span id="l3.571" class="difflineminus">-</span>
<a href="#l3.572"></a><span id="l3.572" class="difflineminus">-    if options.chatzilla_rev is None:</span>
<a href="#l3.573"></a><span id="l3.573" class="difflineminus">-        options.chatzilla_rev = get_DEFAULT_tag(&quot;CHATZILLA_REV&quot;)</span>
<a href="#l3.574"></a><span id="l3.574" class="difflineminus">-</span>
<a href="#l3.575"></a><span id="l3.575" class="difflineminus">-</span>
<a href="#l3.576"></a><span id="l3.576" class="difflineminus">-def fixup_inspector_repo_options(options):</span>
<a href="#l3.577"></a><span id="l3.577" class="difflineminus">-    &quot;&quot;&quot;Handle special case: initial checkout of DOM Inspector.</span>
<a href="#l3.578"></a><span id="l3.578" class="difflineminus">-</span>
<a href="#l3.579"></a><span id="l3.579" class="difflineminus">-    See fixup_comm_repo_options().</span>
<a href="#l3.580"></a><span id="l3.580" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l3.581"></a><span id="l3.581" class="difflineminus">-</span>
<a href="#l3.582"></a><span id="l3.582" class="difflineminus">-    # No cvs backup needed as DOM Inspector was part (and removed from)</span>
<a href="#l3.583"></a><span id="l3.583" class="difflineminus">-    # Mozilla hg repository.</span>
<a href="#l3.584"></a><span id="l3.584" class="difflineminus">-    if options.inspector_repo is None and \</span>
<a href="#l3.585"></a><span id="l3.585" class="difflineminus">-            not os.path.exists(os.path.join(topsrcdir, 'mozilla', 'extensions',</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineminus">-                                            'inspector')):</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineminus">-        options.inspector_repo = DEFAULTS['INSPECTOR_REPO']</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineminus">-</span>
<a href="#l3.589"></a><span id="l3.589" class="difflineminus">-    if options.inspector_rev is None:</span>
<a href="#l3.590"></a><span id="l3.590" class="difflineminus">-        options.inspector_rev = get_DEFAULT_tag(&quot;INSPECTOR_REV&quot;)</span>
<a href="#l3.591"></a><span id="l3.591" class="difflineminus">-</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineminus">-</span>
<a href="#l3.593"></a><span id="l3.593" class="difflineminus">-def fixup_rust_vendoring():</span>
<a href="#l3.594"></a><span id="l3.594" class="difflineminus">-    import json</span>
<a href="#l3.595"></a><span id="l3.595" class="difflineminus">-</span>
<a href="#l3.596"></a><span id="l3.596" class="difflineminus">-    print(&quot;Patching .cargo-checksum.json files to work around Bug 1424825.&quot;)</span>
<a href="#l3.597"></a><span id="l3.597" class="difflineminus">-</span>
<a href="#l3.598"></a><span id="l3.598" class="difflineminus">-    files = glob.glob(&quot;mozilla/third_party/rust/*/.cargo-checksum.json&quot;)</span>
<a href="#l3.599"></a><span id="l3.599" class="difflineminus">-    for file in files:</span>
<a href="#l3.600"></a><span id="l3.600" class="difflineminus">-        if options.verbose:</span>
<a href="#l3.601"></a><span id="l3.601" class="difflineminus">-            print(&quot;\t{file}&quot;.format(file))</span>
<a href="#l3.602"></a><span id="l3.602" class="difflineminus">-        with open(file, &quot;r&quot;) as fp:</span>
<a href="#l3.603"></a><span id="l3.603" class="difflineminus">-            cksum = json.load(fp)</span>
<a href="#l3.604"></a><span id="l3.604" class="difflineminus">-        cksum['files'] = {}</span>
<a href="#l3.605"></a><span id="l3.605" class="difflineminus">-        with open(file, &quot;w&quot;) as fp:</span>
<a href="#l3.606"></a><span id="l3.606" class="difflineminus">-            json.dump(cksum, fp)</span>
<a href="#l3.607"></a><span id="l3.607" class="difflineminus">-</span>
<a href="#l3.608"></a><span id="l3.608" class="difflineminus">-    if options.verbose:</span>
<a href="#l3.609"></a><span id="l3.609" class="difflineminus">-        print(&quot;Done patching .cargo-checksum.json files.&quot;)</span>
<a href="#l3.610"></a><span id="l3.610" class="difflineminus">-</span>
<a href="#l3.611"></a><span id="l3.611" class="difflineminus">-</span>
<a href="#l3.612"></a><span id="l3.612" class="difflineminus">-try:</span>
<a href="#l3.613"></a><span id="l3.613" class="difflineminus">-    (options, (action,)) = o.parse_args()</span>
<a href="#l3.614"></a><span id="l3.614" class="difflineminus">-except ValueError:</span>
<a href="#l3.615"></a><span id="l3.615" class="difflineminus">-    o.print_help()</span>
<a href="#l3.616"></a><span id="l3.616" class="difflineminus">-    sys.exit(2)</span>
<a href="#l3.617"></a><span id="l3.617" class="difflineminus">-</span>
<a href="#l3.618"></a><span id="l3.618" class="difflineminus">-if options.default_rev:</span>
<a href="#l3.619"></a><span id="l3.619" class="difflineminus">-    # We now wish to override all the DEFAULTS.</span>
<a href="#l3.620"></a><span id="l3.620" class="difflineminus">-    DEFAULTS['REV'] = options.default_rev</span>
<a href="#l3.621"></a><span id="l3.621" class="difflineminus">-    for index in ['CHATZILLA', 'INSPECTOR', 'COMM', 'MOZILLA']:</span>
<a href="#l3.622"></a><span id="l3.622" class="difflineminus">-        index += &quot;_REV&quot;</span>
<a href="#l3.623"></a><span id="l3.623" class="difflineminus">-        # Clear the rest from file-defaults</span>
<a href="#l3.624"></a><span id="l3.624" class="difflineminus">-        if index in DEFAULTS:</span>
<a href="#l3.625"></a><span id="l3.625" class="difflineminus">-            del DEFAULTS[index]</span>
<a href="#l3.626"></a><span id="l3.626" class="difflineminus">-</span>
<a href="#l3.627"></a><span id="l3.627" class="difflineminus">-if action in ('checkout', 'co'):</span>
<a href="#l3.628"></a><span id="l3.628" class="difflineminus">-    # Update Comm repository configuration.</span>
<a href="#l3.629"></a><span id="l3.629" class="difflineminus">-    repo_config()</span>
<a href="#l3.630"></a><span id="l3.630" class="difflineminus">-</span>
<a href="#l3.631"></a><span id="l3.631" class="difflineminus">-    if not options.skip_comm:</span>
<a href="#l3.632"></a><span id="l3.632" class="difflineminus">-        fixup_comm_repo_options(options)</span>
<a href="#l3.633"></a><span id="l3.633" class="difflineminus">-        do_hg_pull('.', options.comm_repo, options.hg, options.comm_rev)</span>
<a href="#l3.634"></a><span id="l3.634" class="difflineminus">-</span>
<a href="#l3.635"></a><span id="l3.635" class="difflineminus">-    if not options.skip_mozilla:</span>
<a href="#l3.636"></a><span id="l3.636" class="difflineminus">-        fixup_mozilla_repo_options(options)</span>
<a href="#l3.637"></a><span id="l3.637" class="difflineminus">-        do_hg_pull('mozilla', options.mozilla_repo, options.hg,</span>
<a href="#l3.638"></a><span id="l3.638" class="difflineminus">-                   options.mozilla_rev, options.hgtool, options.hgtool1)</span>
<a href="#l3.639"></a><span id="l3.639" class="difflineminus">-</span>
<a href="#l3.640"></a><span id="l3.640" class="difflineminus">-    # Check whether destination directory exists for these extensions.</span>
<a href="#l3.641"></a><span id="l3.641" class="difflineminus">-    if (not options.skip_chatzilla or not options.skip_inspector) and \</span>
<a href="#l3.642"></a><span id="l3.642" class="difflineminus">-       not os.path.exists(os.path.join(topsrcdir, 'mozilla', 'extensions')):</span>
<a href="#l3.643"></a><span id="l3.643" class="difflineminus">-        # Don't create the directory: Mozilla repository should provide it...</span>
<a href="#l3.644"></a><span id="l3.644" class="difflineminus">-        sys.exit(&quot;Error: mozilla/extensions directory does not exist;&quot; +</span>
<a href="#l3.645"></a><span id="l3.645" class="difflineminus">-                 &quot; ChatZilla, and/or DOM Inspector cannot be checked out!&quot;)</span>
<a href="#l3.646"></a><span id="l3.646" class="difflineminus">-</span>
<a href="#l3.647"></a><span id="l3.647" class="difflineminus">-    if not options.skip_chatzilla:</span>
<a href="#l3.648"></a><span id="l3.648" class="difflineminus">-        fixup_chatzilla_repo_options(options)</span>
<a href="#l3.649"></a><span id="l3.649" class="difflineminus">-        do_hg_pull(os.path.join('mozilla', 'extensions', 'irc'),</span>
<a href="#l3.650"></a><span id="l3.650" class="difflineminus">-                   options.chatzilla_repo, options.hg, options.chatzilla_rev)</span>
<a href="#l3.651"></a><span id="l3.651" class="difflineminus">-</span>
<a href="#l3.652"></a><span id="l3.652" class="difflineminus">-    if not options.skip_inspector:</span>
<a href="#l3.653"></a><span id="l3.653" class="difflineminus">-        fixup_inspector_repo_options(options)</span>
<a href="#l3.654"></a><span id="l3.654" class="difflineminus">-        do_hg_pull(os.path.join('mozilla', 'extensions', 'inspector'),</span>
<a href="#l3.655"></a><span id="l3.655" class="difflineminus">-                   options.inspector_repo, options.hg, options.inspector_rev)</span>
<a href="#l3.656"></a><span id="l3.656" class="difflineminus">-</span>
<a href="#l3.657"></a><span id="l3.657" class="difflineminus">-    if options.apply_patches:</span>
<a href="#l3.658"></a><span id="l3.658" class="difflineminus">-        do_apply_patches(topsrcdir, options.hg)</span>
<a href="#l3.659"></a><span id="l3.659" class="difflineminus">-</span>
<a href="#l3.660"></a><span id="l3.660" class="difflineminus">-    if options.fixup_rust_vendoring:</span>
<a href="#l3.661"></a><span id="l3.661" class="difflineminus">-        fixup_rust_vendoring()</span>
<a href="#l3.662"></a><span id="l3.662" class="difflineminus">-</span>
<a href="#l3.663"></a><span id="l3.663" class="difflineminus">-else:</span>
<a href="#l3.664"></a><span id="l3.664" class="difflineminus">-    o.print_help()</span>
<a href="#l3.665"></a><span id="l3.665" class="difflineminus">-    sys.exit(2)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/config/baseconfig.mk</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,16 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-# This file is normally included by autoconf.mk, but it is also used</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-# directly in python/mozbuild/mozbuild/base.py for gmake validation.</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">-# We thus use INCLUDED_AUTOCONF_MK to enable/disable some parts depending</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">-# whether a normal build is happening or whether the check is running.</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-# When mach wants to know if we're to use mozmake, it runs:</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">-# make -f topsrcdir/config/baseconfig.mk</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-# The first word of MAKEFILE_LIST is the main file we're running. Grabbing the</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-# parent of that directory therefore gets us the topsrcdir of comm-central,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-# whence we get the mozilla directory to run the &quot;real&quot; baseconfig.mk logic.</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-ifndef INCLUDED_AUTOCONF_MK</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-topsrcdir := $(dir $(firstword $(MAKEFILE_LIST)))..</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-endif</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-MOZILLA_SRCDIR = $(topsrcdir)/mozilla</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-include $(MOZILLA_SRCDIR)/config/baseconfig.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/config/config.mk</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,7 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-#</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-# Just use mozilla-central's copy of config.mk now.</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-include $(MOZILLA_DIR)/config/config.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/config/configobj.py</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,2279 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-# configobj.py</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-# A config file reader/writer that supports nested sections in config files.</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-# Copyright (C) 2005-2006 Michael Foord, Nicola Larosa</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">-# E-mail: fuzzyman AT voidspace DOT org DOT uk</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-#         nico AT tekNico DOT net</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-# ConfigObj 4</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-# http://www.voidspace.org.uk/python/configobj.html</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-# Released subject to the BSD License</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-# Please see http://www.voidspace.org.uk/python/license.shtml</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-# Scripts maintained at http://www.voidspace.org.uk/python/index.shtml</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-# For information about bugfixes, updates and support, please join the</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-# ConfigObj mailing list:</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-# http://lists.sourceforge.net/lists/listinfo/configobj-develop</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-# Comments, suggestions and bug reports welcome.</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-from __future__ import generators</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-import sys</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-INTP_VER = sys.version_info[:2]</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-if INTP_VER &lt; (2, 2):</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-    raise RuntimeError(&quot;Python v.2.2 or later needed&quot;)</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-import os, re</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-compiler = None</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-try:</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    import compiler</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-except ImportError:</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-    # for IronPython</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-    pass</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-from types import StringTypes</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-from warnings import warn</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-try:</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-    from codecs import BOM_UTF8, BOM_UTF16, BOM_UTF16_BE, BOM_UTF16_LE</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-except ImportError:</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-    # Python 2.2 does not have these</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-    # UTF-8</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-    BOM_UTF8 = '\xef\xbb\xbf'</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-    # UTF-16, little endian</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-    BOM_UTF16_LE = '\xff\xfe'</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-    # UTF-16, big endian</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-    BOM_UTF16_BE = '\xfe\xff'</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-    if sys.byteorder == 'little':</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-        # UTF-16, native endianness</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-        BOM_UTF16 = BOM_UTF16_LE</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-    else:</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-        # UTF-16, native endianness</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-        BOM_UTF16 = BOM_UTF16_BE</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-# A dictionary mapping BOM to</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-# the encoding to decode with, and what to set the</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-# encoding attribute to.</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-BOMS = {</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-    BOM_UTF8: ('utf_8', None),</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-    BOM_UTF16_BE: ('utf16_be', 'utf_16'),</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-    BOM_UTF16_LE: ('utf16_le', 'utf_16'),</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-    BOM_UTF16: ('utf_16', 'utf_16'),</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-    }</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-# All legal variants of the BOM codecs.</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-# TODO: the list of aliases is not meant to be exhaustive, is there a</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-#   better way ?</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-BOM_LIST = {</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-    'utf_16': 'utf_16',</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-    'u16': 'utf_16',</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-    'utf16': 'utf_16',</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-    'utf-16': 'utf_16',</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-    'utf16_be': 'utf16_be',</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-    'utf_16_be': 'utf16_be',</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-    'utf-16be': 'utf16_be',</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-    'utf16_le': 'utf16_le',</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-    'utf_16_le': 'utf16_le',</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-    'utf-16le': 'utf16_le',</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-    'utf_8': 'utf_8',</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-    'u8': 'utf_8',</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-    'utf': 'utf_8',</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-    'utf8': 'utf_8',</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-    'utf-8': 'utf_8',</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-    }</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-# Map of encodings to the BOM to write.</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-BOM_SET = {</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-    'utf_8': BOM_UTF8,</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-    'utf_16': BOM_UTF16,</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-    'utf16_be': BOM_UTF16_BE,</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-    'utf16_le': BOM_UTF16_LE,</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-    None: BOM_UTF8</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-    }</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-try:</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-    from validate import VdtMissingValue</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineminus">-except ImportError:</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineminus">-    VdtMissingValue = None</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-try:</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-    enumerate</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-except NameError:</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-    def enumerate(obj):</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-        &quot;&quot;&quot;enumerate for Python 2.2.&quot;&quot;&quot;</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-        i = -1</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-        for item in obj:</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-            i += 1</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-            yield i, item</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-try:</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-    True, False</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-except NameError:</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-    True, False = 1, 0</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-__version__ = '4.4.0'</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-__revision__ = '$Id: configobj.py,v 3.5 2007/07/02 18:20:24 benjamin%smedbergs.us Exp $'</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">-</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineminus">-__docformat__ = &quot;restructuredtext en&quot;</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-__all__ = (</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-    '__version__',</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineminus">-    'DEFAULT_INDENT_TYPE',</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-    'DEFAULT_INTERPOLATION',</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-    'ConfigObjError',</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-    'NestingError',</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-    'ParseError',</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-    'DuplicateError',</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-    'ConfigspecError',</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-    'ConfigObj',</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-    'SimpleVal',</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-    'InterpolationError',</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-    'InterpolationLoopError',</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-    'MissingInterpolationOption',</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineminus">-    'RepeatSectionError',</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineminus">-    'UnreprError',</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineminus">-    'UnknownType',</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-    '__docformat__',</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineminus">-    'flatten_errors',</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineminus">-)</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineminus">-DEFAULT_INTERPOLATION = 'configparser'</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineminus">-DEFAULT_INDENT_TYPE = '    '</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-MAX_INTERPOL_DEPTH = 10</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineminus">-OPTION_DEFAULTS = {</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineminus">-    'interpolation': True,</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineminus">-    'raise_errors': False,</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineminus">-    'list_values': True,</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-    'create_empty': False,</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineminus">-    'file_error': False,</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineminus">-    'configspec': None,</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineminus">-    'stringify': True,</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-    # option may be set to one of ('', ' ', '\t')</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-    'indent_type': None,</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-    'encoding': None,</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-    'default_encoding': None,</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-    'unrepr': False,</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-    'write_empty_values': False,</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineminus">-}</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineminus">-def getObj(s):</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineminus">-    s = &quot;a=&quot; + s</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineminus">-    if compiler is None:</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-        raise ImportError('compiler module not available')</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-    p = compiler.parse(s)</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineminus">-    return p.getChildren()[1].getChildren()[0].getChildren()[1]</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineminus">-</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineminus">-class UnknownType(Exception):</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineminus">-    pass</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineminus">-</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineminus">-class Builder:</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineminus">-    </span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-    def build(self, o):</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-        m = getattr(self, 'build_' + o.__class__.__name__, None)</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-        if m is None:</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineminus">-            raise UnknownType(o.__class__.__name__)</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineminus">-        return m(o)</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-    </span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-    def build_List(self, o):</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineminus">-        return map(self.build, o.getChildren())</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-    </span>
<a href="#l6.185"></a><span id="l6.185" class="difflineminus">-    def build_Const(self, o):</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-        return o.value</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-    </span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-    def build_Dict(self, o):</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-        d = {}</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-        i = iter(map(self.build, o.getChildren()))</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineminus">-        for el in i:</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineminus">-            d[el] = i.next()</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineminus">-        return d</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineminus">-    </span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-    def build_Tuple(self, o):</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-        return tuple(self.build_List(o))</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">-    </span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">-    def build_Name(self, o):</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">-        if o.name == 'None':</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-            return None</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-        if o.name == 'True':</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-            return True</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-        if o.name == 'False':</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-            return False</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-        </span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-        # An undefinted Name</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-        raise UnknownType('Undefined Name')</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-    </span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-    def build_Add(self, o):</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-        real, imag = map(self.build_Const, o.getChildren())</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-        try:</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-            real = float(real)</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-        except TypeError:</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-            raise UnknownType('Add')</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-        if not isinstance(imag, complex) or imag.real != 0.0:</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-            raise UnknownType('Add')</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-        return real+imag</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-    </span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-    def build_Getattr(self, o):</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-        parent = self.build(o.expr)</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-        return getattr(parent, o.attrname)</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-    </span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-    def build_UnarySub(self, o):</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-        return -self.build_Const(o.getChildren()[0])</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-    </span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-    def build_UnaryAdd(self, o):</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-        return self.build_Const(o.getChildren()[0])</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-def unrepr(s):</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-    if not s:</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-        return s</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-    return Builder().build(getObj(s))</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-def _splitlines(instring):</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-    &quot;&quot;&quot;Split a string on lines, without losing line endings or truncating.&quot;&quot;&quot;</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-    </span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-class ConfigObjError(SyntaxError):</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-    This is the base class for all errors that ConfigObj raises.</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-    It is a subclass of SyntaxError.</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineminus">-    def __init__(self, message='', line_number=None, line=''):</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineminus">-        self.line = line</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineminus">-        self.line_number = line_number</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineminus">-        self.message = message</span>
<a href="#l6.247"></a><span id="l6.247" class="difflineminus">-        SyntaxError.__init__(self, message)</span>
<a href="#l6.248"></a><span id="l6.248" class="difflineminus">-</span>
<a href="#l6.249"></a><span id="l6.249" class="difflineminus">-class NestingError(ConfigObjError):</span>
<a href="#l6.250"></a><span id="l6.250" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineminus">-    This error indicates a level of nesting that doesn't match.</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineminus">-</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineminus">-class ParseError(ConfigObjError):</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.256"></a><span id="l6.256" class="difflineminus">-    This error indicates that a line is badly written.</span>
<a href="#l6.257"></a><span id="l6.257" class="difflineminus">-    It is neither a valid ``key = value`` line,</span>
<a href="#l6.258"></a><span id="l6.258" class="difflineminus">-    nor a valid section marker line.</span>
<a href="#l6.259"></a><span id="l6.259" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineminus">-</span>
<a href="#l6.261"></a><span id="l6.261" class="difflineminus">-class DuplicateError(ConfigObjError):</span>
<a href="#l6.262"></a><span id="l6.262" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineminus">-    The keyword or section specified already exists.</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineminus">-</span>
<a href="#l6.266"></a><span id="l6.266" class="difflineminus">-class ConfigspecError(ConfigObjError):</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.268"></a><span id="l6.268" class="difflineminus">-    An error occurred whilst parsing a configspec.</span>
<a href="#l6.269"></a><span id="l6.269" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineminus">-</span>
<a href="#l6.271"></a><span id="l6.271" class="difflineminus">-class InterpolationError(ConfigObjError):</span>
<a href="#l6.272"></a><span id="l6.272" class="difflineminus">-    &quot;&quot;&quot;Base class for the two interpolation errors.&quot;&quot;&quot;</span>
<a href="#l6.273"></a><span id="l6.273" class="difflineminus">-</span>
<a href="#l6.274"></a><span id="l6.274" class="difflineminus">-class InterpolationLoopError(InterpolationError):</span>
<a href="#l6.275"></a><span id="l6.275" class="difflineminus">-    &quot;&quot;&quot;Maximum interpolation depth exceeded in string interpolation.&quot;&quot;&quot;</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineminus">-</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineminus">-    def __init__(self, option):</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineminus">-        InterpolationError.__init__(</span>
<a href="#l6.279"></a><span id="l6.279" class="difflineminus">-            self,</span>
<a href="#l6.280"></a><span id="l6.280" class="difflineminus">-            'interpolation loop detected in value &quot;%s&quot;.' % option)</span>
<a href="#l6.281"></a><span id="l6.281" class="difflineminus">-</span>
<a href="#l6.282"></a><span id="l6.282" class="difflineminus">-class RepeatSectionError(ConfigObjError):</span>
<a href="#l6.283"></a><span id="l6.283" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.284"></a><span id="l6.284" class="difflineminus">-    This error indicates additional sections in a section with a</span>
<a href="#l6.285"></a><span id="l6.285" class="difflineminus">-    ``__many__`` (repeated) section.</span>
<a href="#l6.286"></a><span id="l6.286" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.287"></a><span id="l6.287" class="difflineminus">-</span>
<a href="#l6.288"></a><span id="l6.288" class="difflineminus">-class MissingInterpolationOption(InterpolationError):</span>
<a href="#l6.289"></a><span id="l6.289" class="difflineminus">-    &quot;&quot;&quot;A value specified for interpolation was missing.&quot;&quot;&quot;</span>
<a href="#l6.290"></a><span id="l6.290" class="difflineminus">-</span>
<a href="#l6.291"></a><span id="l6.291" class="difflineminus">-    def __init__(self, option):</span>
<a href="#l6.292"></a><span id="l6.292" class="difflineminus">-        InterpolationError.__init__(</span>
<a href="#l6.293"></a><span id="l6.293" class="difflineminus">-            self,</span>
<a href="#l6.294"></a><span id="l6.294" class="difflineminus">-            'missing option &quot;%s&quot; in interpolation.' % option)</span>
<a href="#l6.295"></a><span id="l6.295" class="difflineminus">-</span>
<a href="#l6.296"></a><span id="l6.296" class="difflineminus">-class UnreprError(ConfigObjError):</span>
<a href="#l6.297"></a><span id="l6.297" class="difflineminus">-    &quot;&quot;&quot;An error parsing in unrepr mode.&quot;&quot;&quot;</span>
<a href="#l6.298"></a><span id="l6.298" class="difflineminus">-</span>
<a href="#l6.299"></a><span id="l6.299" class="difflineminus">-</span>
<a href="#l6.300"></a><span id="l6.300" class="difflineminus">-class InterpolationEngine(object):</span>
<a href="#l6.301"></a><span id="l6.301" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.302"></a><span id="l6.302" class="difflineminus">-    A helper class to help perform string interpolation.</span>
<a href="#l6.303"></a><span id="l6.303" class="difflineminus">-</span>
<a href="#l6.304"></a><span id="l6.304" class="difflineminus">-    This class is an abstract base class; its descendants perform</span>
<a href="#l6.305"></a><span id="l6.305" class="difflineminus">-    the actual work.</span>
<a href="#l6.306"></a><span id="l6.306" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.307"></a><span id="l6.307" class="difflineminus">-</span>
<a href="#l6.308"></a><span id="l6.308" class="difflineminus">-    # compiled regexp to use in self.interpolate()</span>
<a href="#l6.309"></a><span id="l6.309" class="difflineminus">-    _KEYCRE = re.compile(r&quot;%\(([^)]*)\)s&quot;)</span>
<a href="#l6.310"></a><span id="l6.310" class="difflineminus">-</span>
<a href="#l6.311"></a><span id="l6.311" class="difflineminus">-    def __init__(self, section):</span>
<a href="#l6.312"></a><span id="l6.312" class="difflineminus">-        # the Section instance that &quot;owns&quot; this engine</span>
<a href="#l6.313"></a><span id="l6.313" class="difflineminus">-        self.section = section</span>
<a href="#l6.314"></a><span id="l6.314" class="difflineminus">-</span>
<a href="#l6.315"></a><span id="l6.315" class="difflineminus">-    def interpolate(self, key, value):</span>
<a href="#l6.316"></a><span id="l6.316" class="difflineminus">-        def recursive_interpolate(key, value, section, backtrail):</span>
<a href="#l6.317"></a><span id="l6.317" class="difflineminus">-            &quot;&quot;&quot;The function that does the actual work.</span>
<a href="#l6.318"></a><span id="l6.318" class="difflineminus">-</span>
<a href="#l6.319"></a><span id="l6.319" class="difflineminus">-            ``value``: the string we're trying to interpolate.</span>
<a href="#l6.320"></a><span id="l6.320" class="difflineminus">-            ``section``: the section in which that string was found</span>
<a href="#l6.321"></a><span id="l6.321" class="difflineminus">-            ``backtrail``: a dict to keep track of where we've been,</span>
<a href="#l6.322"></a><span id="l6.322" class="difflineminus">-            to detect and prevent infinite recursion loops</span>
<a href="#l6.323"></a><span id="l6.323" class="difflineminus">-</span>
<a href="#l6.324"></a><span id="l6.324" class="difflineminus">-            This is similar to a depth-first-search algorithm.</span>
<a href="#l6.325"></a><span id="l6.325" class="difflineminus">-            &quot;&quot;&quot;</span>
<a href="#l6.326"></a><span id="l6.326" class="difflineminus">-            # Have we been here already?</span>
<a href="#l6.327"></a><span id="l6.327" class="difflineminus">-            if backtrail.has_key((key, section.name)):</span>
<a href="#l6.328"></a><span id="l6.328" class="difflineminus">-                # Yes - infinite loop detected</span>
<a href="#l6.329"></a><span id="l6.329" class="difflineminus">-                raise InterpolationLoopError(key)</span>
<a href="#l6.330"></a><span id="l6.330" class="difflineminus">-            # Place a marker on our backtrail so we won't come back here again</span>
<a href="#l6.331"></a><span id="l6.331" class="difflineminus">-            backtrail[(key, section.name)] = 1</span>
<a href="#l6.332"></a><span id="l6.332" class="difflineminus">-</span>
<a href="#l6.333"></a><span id="l6.333" class="difflineminus">-            # Now start the actual work</span>
<a href="#l6.334"></a><span id="l6.334" class="difflineminus">-            match = self._KEYCRE.search(value)</span>
<a href="#l6.335"></a><span id="l6.335" class="difflineminus">-            while match:</span>
<a href="#l6.336"></a><span id="l6.336" class="difflineminus">-                # The actual parsing of the match is implementation-dependent,</span>
<a href="#l6.337"></a><span id="l6.337" class="difflineminus">-                # so delegate to our helper function</span>
<a href="#l6.338"></a><span id="l6.338" class="difflineminus">-                k, v, s = self._parse_match(match)</span>
<a href="#l6.339"></a><span id="l6.339" class="difflineminus">-                if k is None:</span>
<a href="#l6.340"></a><span id="l6.340" class="difflineminus">-                    # That's the signal that no further interpolation is needed</span>
<a href="#l6.341"></a><span id="l6.341" class="difflineminus">-                    replacement = v</span>
<a href="#l6.342"></a><span id="l6.342" class="difflineminus">-                else:</span>
<a href="#l6.343"></a><span id="l6.343" class="difflineminus">-                    # Further interpolation may be needed to obtain final value</span>
<a href="#l6.344"></a><span id="l6.344" class="difflineminus">-                    replacement = recursive_interpolate(k, v, s, backtrail)</span>
<a href="#l6.345"></a><span id="l6.345" class="difflineminus">-                # Replace the matched string with its final value</span>
<a href="#l6.346"></a><span id="l6.346" class="difflineminus">-                start, end = match.span()</span>
<a href="#l6.347"></a><span id="l6.347" class="difflineminus">-                value = ''.join((value[:start], replacement, value[end:]))</span>
<a href="#l6.348"></a><span id="l6.348" class="difflineminus">-                new_search_start = start + len(replacement)</span>
<a href="#l6.349"></a><span id="l6.349" class="difflineminus">-                # Pick up the next interpolation key, if any, for next time</span>
<a href="#l6.350"></a><span id="l6.350" class="difflineminus">-                # through the while loop</span>
<a href="#l6.351"></a><span id="l6.351" class="difflineminus">-                match = self._KEYCRE.search(value, new_search_start)</span>
<a href="#l6.352"></a><span id="l6.352" class="difflineminus">-</span>
<a href="#l6.353"></a><span id="l6.353" class="difflineminus">-            # Now safe to come back here again; remove marker from backtrail</span>
<a href="#l6.354"></a><span id="l6.354" class="difflineminus">-            del backtrail[(key, section.name)]</span>
<a href="#l6.355"></a><span id="l6.355" class="difflineminus">-</span>
<a href="#l6.356"></a><span id="l6.356" class="difflineminus">-            return value</span>
<a href="#l6.357"></a><span id="l6.357" class="difflineminus">-</span>
<a href="#l6.358"></a><span id="l6.358" class="difflineminus">-        # Back in interpolate(), all we have to do is kick off the recursive</span>
<a href="#l6.359"></a><span id="l6.359" class="difflineminus">-        # function with appropriate starting values</span>
<a href="#l6.360"></a><span id="l6.360" class="difflineminus">-        value = recursive_interpolate(key, value, self.section, {})</span>
<a href="#l6.361"></a><span id="l6.361" class="difflineminus">-        return value</span>
<a href="#l6.362"></a><span id="l6.362" class="difflineminus">-</span>
<a href="#l6.363"></a><span id="l6.363" class="difflineminus">-    def _fetch(self, key):</span>
<a href="#l6.364"></a><span id="l6.364" class="difflineminus">-        &quot;&quot;&quot;Helper function to fetch values from owning section.</span>
<a href="#l6.365"></a><span id="l6.365" class="difflineminus">-</span>
<a href="#l6.366"></a><span id="l6.366" class="difflineminus">-        Returns a 2-tuple: the value, and the section where it was found.</span>
<a href="#l6.367"></a><span id="l6.367" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.368"></a><span id="l6.368" class="difflineminus">-        # switch off interpolation before we try and fetch anything !</span>
<a href="#l6.369"></a><span id="l6.369" class="difflineminus">-        save_interp = self.section.main.interpolation</span>
<a href="#l6.370"></a><span id="l6.370" class="difflineminus">-        self.section.main.interpolation = False</span>
<a href="#l6.371"></a><span id="l6.371" class="difflineminus">-</span>
<a href="#l6.372"></a><span id="l6.372" class="difflineminus">-        # Start at section that &quot;owns&quot; this InterpolationEngine</span>
<a href="#l6.373"></a><span id="l6.373" class="difflineminus">-        current_section = self.section</span>
<a href="#l6.374"></a><span id="l6.374" class="difflineminus">-        while True:</span>
<a href="#l6.375"></a><span id="l6.375" class="difflineminus">-            # try the current section first</span>
<a href="#l6.376"></a><span id="l6.376" class="difflineminus">-            val = current_section.get(key)</span>
<a href="#l6.377"></a><span id="l6.377" class="difflineminus">-            if val is not None:</span>
<a href="#l6.378"></a><span id="l6.378" class="difflineminus">-                break</span>
<a href="#l6.379"></a><span id="l6.379" class="difflineminus">-            # try &quot;DEFAULT&quot; next</span>
<a href="#l6.380"></a><span id="l6.380" class="difflineminus">-            val = current_section.get('DEFAULT', {}).get(key)</span>
<a href="#l6.381"></a><span id="l6.381" class="difflineminus">-            if val is not None:</span>
<a href="#l6.382"></a><span id="l6.382" class="difflineminus">-                break</span>
<a href="#l6.383"></a><span id="l6.383" class="difflineminus">-            # move up to parent and try again</span>
<a href="#l6.384"></a><span id="l6.384" class="difflineminus">-            # top-level's parent is itself</span>
<a href="#l6.385"></a><span id="l6.385" class="difflineminus">-            if current_section.parent is current_section:</span>
<a href="#l6.386"></a><span id="l6.386" class="difflineminus">-                # reached top level, time to give up</span>
<a href="#l6.387"></a><span id="l6.387" class="difflineminus">-                break</span>
<a href="#l6.388"></a><span id="l6.388" class="difflineminus">-            current_section = current_section.parent</span>
<a href="#l6.389"></a><span id="l6.389" class="difflineminus">-</span>
<a href="#l6.390"></a><span id="l6.390" class="difflineminus">-        # restore interpolation to previous value before returning</span>
<a href="#l6.391"></a><span id="l6.391" class="difflineminus">-        self.section.main.interpolation = save_interp</span>
<a href="#l6.392"></a><span id="l6.392" class="difflineminus">-        if val is None:</span>
<a href="#l6.393"></a><span id="l6.393" class="difflineminus">-            raise MissingInterpolationOption(key)</span>
<a href="#l6.394"></a><span id="l6.394" class="difflineminus">-        return val, current_section</span>
<a href="#l6.395"></a><span id="l6.395" class="difflineminus">-</span>
<a href="#l6.396"></a><span id="l6.396" class="difflineminus">-    def _parse_match(self, match):</span>
<a href="#l6.397"></a><span id="l6.397" class="difflineminus">-        &quot;&quot;&quot;Implementation-dependent helper function.</span>
<a href="#l6.398"></a><span id="l6.398" class="difflineminus">-</span>
<a href="#l6.399"></a><span id="l6.399" class="difflineminus">-        Will be passed a match object corresponding to the interpolation</span>
<a href="#l6.400"></a><span id="l6.400" class="difflineminus">-        key we just found (e.g., &quot;%(foo)s&quot; or &quot;$foo&quot;). Should look up that</span>
<a href="#l6.401"></a><span id="l6.401" class="difflineminus">-        key in the appropriate config file section (using the ``_fetch()``</span>
<a href="#l6.402"></a><span id="l6.402" class="difflineminus">-        helper function) and return a 3-tuple: (key, value, section)</span>
<a href="#l6.403"></a><span id="l6.403" class="difflineminus">-</span>
<a href="#l6.404"></a><span id="l6.404" class="difflineminus">-        ``key`` is the name of the key we're looking for</span>
<a href="#l6.405"></a><span id="l6.405" class="difflineminus">-        ``value`` is the value found for that key</span>
<a href="#l6.406"></a><span id="l6.406" class="difflineminus">-        ``section`` is a reference to the section where it was found</span>
<a href="#l6.407"></a><span id="l6.407" class="difflineminus">-</span>
<a href="#l6.408"></a><span id="l6.408" class="difflineminus">-        ``key`` and ``section`` should be None if no further</span>
<a href="#l6.409"></a><span id="l6.409" class="difflineminus">-        interpolation should be performed on the resulting value</span>
<a href="#l6.410"></a><span id="l6.410" class="difflineminus">-        (e.g., if we interpolated &quot;$$&quot; and returned &quot;$&quot;).</span>
<a href="#l6.411"></a><span id="l6.411" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.412"></a><span id="l6.412" class="difflineminus">-        raise NotImplementedError</span>
<a href="#l6.413"></a><span id="l6.413" class="difflineminus">-    </span>
<a href="#l6.414"></a><span id="l6.414" class="difflineminus">-</span>
<a href="#l6.415"></a><span id="l6.415" class="difflineminus">-class ConfigParserInterpolation(InterpolationEngine):</span>
<a href="#l6.416"></a><span id="l6.416" class="difflineminus">-    &quot;&quot;&quot;Behaves like ConfigParser.&quot;&quot;&quot;</span>
<a href="#l6.417"></a><span id="l6.417" class="difflineminus">-    _KEYCRE = re.compile(r&quot;%\(([^)]*)\)s&quot;)</span>
<a href="#l6.418"></a><span id="l6.418" class="difflineminus">-</span>
<a href="#l6.419"></a><span id="l6.419" class="difflineminus">-    def _parse_match(self, match):</span>
<a href="#l6.420"></a><span id="l6.420" class="difflineminus">-        key = match.group(1)</span>
<a href="#l6.421"></a><span id="l6.421" class="difflineminus">-        value, section = self._fetch(key)</span>
<a href="#l6.422"></a><span id="l6.422" class="difflineminus">-        return key, value, section</span>
<a href="#l6.423"></a><span id="l6.423" class="difflineminus">-</span>
<a href="#l6.424"></a><span id="l6.424" class="difflineminus">-</span>
<a href="#l6.425"></a><span id="l6.425" class="difflineminus">-class TemplateInterpolation(InterpolationEngine):</span>
<a href="#l6.426"></a><span id="l6.426" class="difflineminus">-    &quot;&quot;&quot;Behaves like string.Template.&quot;&quot;&quot;</span>
<a href="#l6.427"></a><span id="l6.427" class="difflineminus">-    _delimiter = '$'</span>
<a href="#l6.428"></a><span id="l6.428" class="difflineminus">-    _KEYCRE = re.compile(r&quot;&quot;&quot;</span>
<a href="#l6.429"></a><span id="l6.429" class="difflineminus">-        \$(?:</span>
<a href="#l6.430"></a><span id="l6.430" class="difflineminus">-          (?P&lt;escaped&gt;\$)              |   # Two $ signs</span>
<a href="#l6.431"></a><span id="l6.431" class="difflineminus">-          (?P&lt;named&gt;[_a-z][_a-z0-9]*)  |   # $name format</span>
<a href="#l6.432"></a><span id="l6.432" class="difflineminus">-          {(?P&lt;braced&gt;[^}]*)}              # ${name} format</span>
<a href="#l6.433"></a><span id="l6.433" class="difflineminus">-        )</span>
<a href="#l6.434"></a><span id="l6.434" class="difflineminus">-        &quot;&quot;&quot;, re.IGNORECASE | re.VERBOSE)</span>
<a href="#l6.435"></a><span id="l6.435" class="difflineminus">-</span>
<a href="#l6.436"></a><span id="l6.436" class="difflineminus">-    def _parse_match(self, match):</span>
<a href="#l6.437"></a><span id="l6.437" class="difflineminus">-        # Valid name (in or out of braces): fetch value from section</span>
<a href="#l6.438"></a><span id="l6.438" class="difflineminus">-        key = match.group('named') or match.group('braced')</span>
<a href="#l6.439"></a><span id="l6.439" class="difflineminus">-        if key is not None:</span>
<a href="#l6.440"></a><span id="l6.440" class="difflineminus">-            value, section = self._fetch(key)</span>
<a href="#l6.441"></a><span id="l6.441" class="difflineminus">-            return key, value, section</span>
<a href="#l6.442"></a><span id="l6.442" class="difflineminus">-        # Escaped delimiter (e.g., $$): return single delimiter</span>
<a href="#l6.443"></a><span id="l6.443" class="difflineminus">-        if match.group('escaped') is not None:</span>
<a href="#l6.444"></a><span id="l6.444" class="difflineminus">-            # Return None for key and section to indicate it's time to stop</span>
<a href="#l6.445"></a><span id="l6.445" class="difflineminus">-            return None, self._delimiter, None</span>
<a href="#l6.446"></a><span id="l6.446" class="difflineminus">-        # Anything else: ignore completely, just return it unchanged</span>
<a href="#l6.447"></a><span id="l6.447" class="difflineminus">-        return None, match.group(), None</span>
<a href="#l6.448"></a><span id="l6.448" class="difflineminus">-</span>
<a href="#l6.449"></a><span id="l6.449" class="difflineminus">-interpolation_engines = {</span>
<a href="#l6.450"></a><span id="l6.450" class="difflineminus">-    'configparser': ConfigParserInterpolation,</span>
<a href="#l6.451"></a><span id="l6.451" class="difflineminus">-    'template': TemplateInterpolation,</span>
<a href="#l6.452"></a><span id="l6.452" class="difflineminus">-}</span>
<a href="#l6.453"></a><span id="l6.453" class="difflineminus">-</span>
<a href="#l6.454"></a><span id="l6.454" class="difflineminus">-class Section(dict):</span>
<a href="#l6.455"></a><span id="l6.455" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.456"></a><span id="l6.456" class="difflineminus">-    A dictionary-like object that represents a section in a config file.</span>
<a href="#l6.457"></a><span id="l6.457" class="difflineminus">-    </span>
<a href="#l6.458"></a><span id="l6.458" class="difflineminus">-    It does string interpolation if the 'interpolation' attribute</span>
<a href="#l6.459"></a><span id="l6.459" class="difflineminus">-    of the 'main' object is set to True.</span>
<a href="#l6.460"></a><span id="l6.460" class="difflineminus">-    </span>
<a href="#l6.461"></a><span id="l6.461" class="difflineminus">-    Interpolation is tried first from this object, then from the 'DEFAULT'</span>
<a href="#l6.462"></a><span id="l6.462" class="difflineminus">-    section of this object, next from the parent and its 'DEFAULT' section,</span>
<a href="#l6.463"></a><span id="l6.463" class="difflineminus">-    and so on until the main object is reached.</span>
<a href="#l6.464"></a><span id="l6.464" class="difflineminus">-    </span>
<a href="#l6.465"></a><span id="l6.465" class="difflineminus">-    A Section will behave like an ordered dictionary - following the</span>
<a href="#l6.466"></a><span id="l6.466" class="difflineminus">-    order of the ``scalars`` and ``sections`` attributes.</span>
<a href="#l6.467"></a><span id="l6.467" class="difflineminus">-    You can use this to change the order of members.</span>
<a href="#l6.468"></a><span id="l6.468" class="difflineminus">-    </span>
<a href="#l6.469"></a><span id="l6.469" class="difflineminus">-    Iteration follows the order: scalars, then sections.</span>
<a href="#l6.470"></a><span id="l6.470" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.471"></a><span id="l6.471" class="difflineminus">-</span>
<a href="#l6.472"></a><span id="l6.472" class="difflineminus">-    def __init__(self, parent, depth, main, indict=None, name=None):</span>
<a href="#l6.473"></a><span id="l6.473" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.474"></a><span id="l6.474" class="difflineminus">-        * parent is the section above</span>
<a href="#l6.475"></a><span id="l6.475" class="difflineminus">-        * depth is the depth level of this section</span>
<a href="#l6.476"></a><span id="l6.476" class="difflineminus">-        * main is the main ConfigObj</span>
<a href="#l6.477"></a><span id="l6.477" class="difflineminus">-        * indict is a dictionary to initialise the section with</span>
<a href="#l6.478"></a><span id="l6.478" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.479"></a><span id="l6.479" class="difflineminus">-        if indict is None:</span>
<a href="#l6.480"></a><span id="l6.480" class="difflineminus">-            indict = {}</span>
<a href="#l6.481"></a><span id="l6.481" class="difflineminus">-        dict.__init__(self)</span>
<a href="#l6.482"></a><span id="l6.482" class="difflineminus">-        # used for nesting level *and* interpolation</span>
<a href="#l6.483"></a><span id="l6.483" class="difflineminus">-        self.parent = parent</span>
<a href="#l6.484"></a><span id="l6.484" class="difflineminus">-        # used for the interpolation attribute</span>
<a href="#l6.485"></a><span id="l6.485" class="difflineminus">-        self.main = main</span>
<a href="#l6.486"></a><span id="l6.486" class="difflineminus">-        # level of nesting depth of this Section</span>
<a href="#l6.487"></a><span id="l6.487" class="difflineminus">-        self.depth = depth</span>
<a href="#l6.488"></a><span id="l6.488" class="difflineminus">-        # the sequence of scalar values in this Section</span>
<a href="#l6.489"></a><span id="l6.489" class="difflineminus">-        self.scalars = []</span>
<a href="#l6.490"></a><span id="l6.490" class="difflineminus">-        # the sequence of sections in this Section</span>
<a href="#l6.491"></a><span id="l6.491" class="difflineminus">-        self.sections = []</span>
<a href="#l6.492"></a><span id="l6.492" class="difflineminus">-        # purely for information</span>
<a href="#l6.493"></a><span id="l6.493" class="difflineminus">-        self.name = name</span>
<a href="#l6.494"></a><span id="l6.494" class="difflineminus">-        # for comments :-)</span>
<a href="#l6.495"></a><span id="l6.495" class="difflineminus">-        self.comments = {}</span>
<a href="#l6.496"></a><span id="l6.496" class="difflineminus">-        self.inline_comments = {}</span>
<a href="#l6.497"></a><span id="l6.497" class="difflineminus">-        # for the configspec</span>
<a href="#l6.498"></a><span id="l6.498" class="difflineminus">-        self.configspec = {}</span>
<a href="#l6.499"></a><span id="l6.499" class="difflineminus">-        self._order = []</span>
<a href="#l6.500"></a><span id="l6.500" class="difflineminus">-        self._configspec_comments = {}</span>
<a href="#l6.501"></a><span id="l6.501" class="difflineminus">-        self._configspec_inline_comments = {}</span>
<a href="#l6.502"></a><span id="l6.502" class="difflineminus">-        self._cs_section_comments = {}</span>
<a href="#l6.503"></a><span id="l6.503" class="difflineminus">-        self._cs_section_inline_comments = {}</span>
<a href="#l6.504"></a><span id="l6.504" class="difflineminus">-        # for defaults</span>
<a href="#l6.505"></a><span id="l6.505" class="difflineminus">-        self.defaults = []</span>
<a href="#l6.506"></a><span id="l6.506" class="difflineminus">-        #</span>
<a href="#l6.507"></a><span id="l6.507" class="difflineminus">-        # we do this explicitly so that __setitem__ is used properly</span>
<a href="#l6.508"></a><span id="l6.508" class="difflineminus">-        # (rather than just passing to ``dict.__init__``)</span>
<a href="#l6.509"></a><span id="l6.509" class="difflineminus">-        for entry in indict:</span>
<a href="#l6.510"></a><span id="l6.510" class="difflineminus">-            self[entry] = indict[entry]</span>
<a href="#l6.511"></a><span id="l6.511" class="difflineminus">-</span>
<a href="#l6.512"></a><span id="l6.512" class="difflineminus">-    def _interpolate(self, key, value):</span>
<a href="#l6.513"></a><span id="l6.513" class="difflineminus">-        try:</span>
<a href="#l6.514"></a><span id="l6.514" class="difflineminus">-            # do we already have an interpolation engine?</span>
<a href="#l6.515"></a><span id="l6.515" class="difflineminus">-            engine = self._interpolation_engine</span>
<a href="#l6.516"></a><span id="l6.516" class="difflineminus">-        except AttributeError:</span>
<a href="#l6.517"></a><span id="l6.517" class="difflineminus">-            # not yet: first time running _interpolate(), so pick the engine</span>
<a href="#l6.518"></a><span id="l6.518" class="difflineminus">-            name = self.main.interpolation</span>
<a href="#l6.519"></a><span id="l6.519" class="difflineminus">-            if name == True:  # note that &quot;if name:&quot; would be incorrect here</span>
<a href="#l6.520"></a><span id="l6.520" class="difflineminus">-                # backwards-compatibility: interpolation=True means use default</span>
<a href="#l6.521"></a><span id="l6.521" class="difflineminus">-                name = DEFAULT_INTERPOLATION</span>
<a href="#l6.522"></a><span id="l6.522" class="difflineminus">-            name = name.lower()  # so that &quot;Template&quot;, &quot;template&quot;, etc. all work</span>
<a href="#l6.523"></a><span id="l6.523" class="difflineminus">-            class_ = interpolation_engines.get(name, None)</span>
<a href="#l6.524"></a><span id="l6.524" class="difflineminus">-            if class_ is None:</span>
<a href="#l6.525"></a><span id="l6.525" class="difflineminus">-                # invalid value for self.main.interpolation</span>
<a href="#l6.526"></a><span id="l6.526" class="difflineminus">-                self.main.interpolation = False</span>
<a href="#l6.527"></a><span id="l6.527" class="difflineminus">-                return value</span>
<a href="#l6.528"></a><span id="l6.528" class="difflineminus">-            else:</span>
<a href="#l6.529"></a><span id="l6.529" class="difflineminus">-                # save reference to engine so we don't have to do this again</span>
<a href="#l6.530"></a><span id="l6.530" class="difflineminus">-                engine = self._interpolation_engine = class_(self)</span>
<a href="#l6.531"></a><span id="l6.531" class="difflineminus">-        # let the engine do the actual work</span>
<a href="#l6.532"></a><span id="l6.532" class="difflineminus">-        return engine.interpolate(key, value)</span>
<a href="#l6.533"></a><span id="l6.533" class="difflineminus">-</span>
<a href="#l6.534"></a><span id="l6.534" class="difflineminus">-    def __getitem__(self, key):</span>
<a href="#l6.535"></a><span id="l6.535" class="difflineminus">-        &quot;&quot;&quot;Fetch the item and do string interpolation.&quot;&quot;&quot;</span>
<a href="#l6.536"></a><span id="l6.536" class="difflineminus">-        val = dict.__getitem__(self, key)</span>
<a href="#l6.537"></a><span id="l6.537" class="difflineminus">-        if self.main.interpolation and isinstance(val, StringTypes):</span>
<a href="#l6.538"></a><span id="l6.538" class="difflineminus">-            return self._interpolate(key, val)</span>
<a href="#l6.539"></a><span id="l6.539" class="difflineminus">-        return val</span>
<a href="#l6.540"></a><span id="l6.540" class="difflineminus">-</span>
<a href="#l6.541"></a><span id="l6.541" class="difflineminus">-    def __setitem__(self, key, value, unrepr=False):</span>
<a href="#l6.542"></a><span id="l6.542" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.543"></a><span id="l6.543" class="difflineminus">-        Correctly set a value.</span>
<a href="#l6.544"></a><span id="l6.544" class="difflineminus">-        </span>
<a href="#l6.545"></a><span id="l6.545" class="difflineminus">-        Making dictionary values Section instances.</span>
<a href="#l6.546"></a><span id="l6.546" class="difflineminus">-        (We have to special case 'Section' instances - which are also dicts)</span>
<a href="#l6.547"></a><span id="l6.547" class="difflineminus">-        </span>
<a href="#l6.548"></a><span id="l6.548" class="difflineminus">-        Keys must be strings.</span>
<a href="#l6.549"></a><span id="l6.549" class="difflineminus">-        Values need only be strings (or lists of strings) if</span>
<a href="#l6.550"></a><span id="l6.550" class="difflineminus">-        ``main.stringify`` is set.</span>
<a href="#l6.551"></a><span id="l6.551" class="difflineminus">-        </span>
<a href="#l6.552"></a><span id="l6.552" class="difflineminus">-        `unrepr`` must be set when setting a value to a dictionary, without</span>
<a href="#l6.553"></a><span id="l6.553" class="difflineminus">-        creating a new sub-section.</span>
<a href="#l6.554"></a><span id="l6.554" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.555"></a><span id="l6.555" class="difflineminus">-        if not isinstance(key, StringTypes):</span>
<a href="#l6.556"></a><span id="l6.556" class="difflineminus">-            raise ValueError, 'The key &quot;%s&quot; is not a string.' % key</span>
<a href="#l6.557"></a><span id="l6.557" class="difflineminus">-        # add the comment</span>
<a href="#l6.558"></a><span id="l6.558" class="difflineminus">-        if not self.comments.has_key(key):</span>
<a href="#l6.559"></a><span id="l6.559" class="difflineminus">-            self.comments[key] = []</span>
<a href="#l6.560"></a><span id="l6.560" class="difflineminus">-            self.inline_comments[key] = ''</span>
<a href="#l6.561"></a><span id="l6.561" class="difflineminus">-        # remove the entry from defaults</span>
<a href="#l6.562"></a><span id="l6.562" class="difflineminus">-        if key in self.defaults:</span>
<a href="#l6.563"></a><span id="l6.563" class="difflineminus">-            self.defaults.remove(key)</span>
<a href="#l6.564"></a><span id="l6.564" class="difflineminus">-        #</span>
<a href="#l6.565"></a><span id="l6.565" class="difflineminus">-        if isinstance(value, Section):</span>
<a href="#l6.566"></a><span id="l6.566" class="difflineminus">-            if not self.has_key(key):</span>
<a href="#l6.567"></a><span id="l6.567" class="difflineminus">-                self.sections.append(key)</span>
<a href="#l6.568"></a><span id="l6.568" class="difflineminus">-            dict.__setitem__(self, key, value)</span>
<a href="#l6.569"></a><span id="l6.569" class="difflineminus">-        elif isinstance(value, dict) and not unrepr:</span>
<a href="#l6.570"></a><span id="l6.570" class="difflineminus">-            # First create the new depth level,</span>
<a href="#l6.571"></a><span id="l6.571" class="difflineminus">-            # then create the section</span>
<a href="#l6.572"></a><span id="l6.572" class="difflineminus">-            if not self.has_key(key):</span>
<a href="#l6.573"></a><span id="l6.573" class="difflineminus">-                self.sections.append(key)</span>
<a href="#l6.574"></a><span id="l6.574" class="difflineminus">-            new_depth = self.depth + 1</span>
<a href="#l6.575"></a><span id="l6.575" class="difflineminus">-            dict.__setitem__(</span>
<a href="#l6.576"></a><span id="l6.576" class="difflineminus">-                self,</span>
<a href="#l6.577"></a><span id="l6.577" class="difflineminus">-                key,</span>
<a href="#l6.578"></a><span id="l6.578" class="difflineminus">-                Section(</span>
<a href="#l6.579"></a><span id="l6.579" class="difflineminus">-                    self,</span>
<a href="#l6.580"></a><span id="l6.580" class="difflineminus">-                    new_depth,</span>
<a href="#l6.581"></a><span id="l6.581" class="difflineminus">-                    self.main,</span>
<a href="#l6.582"></a><span id="l6.582" class="difflineminus">-                    indict=value,</span>
<a href="#l6.583"></a><span id="l6.583" class="difflineminus">-                    name=key))</span>
<a href="#l6.584"></a><span id="l6.584" class="difflineminus">-        else:</span>
<a href="#l6.585"></a><span id="l6.585" class="difflineminus">-            if not self.has_key(key):</span>
<a href="#l6.586"></a><span id="l6.586" class="difflineminus">-                self.scalars.append(key)</span>
<a href="#l6.587"></a><span id="l6.587" class="difflineminus">-            if not self.main.stringify:</span>
<a href="#l6.588"></a><span id="l6.588" class="difflineminus">-                if isinstance(value, StringTypes):</span>
<a href="#l6.589"></a><span id="l6.589" class="difflineminus">-                    pass</span>
<a href="#l6.590"></a><span id="l6.590" class="difflineminus">-                elif isinstance(value, (list, tuple)):</span>
<a href="#l6.591"></a><span id="l6.591" class="difflineminus">-                    for entry in value:</span>
<a href="#l6.592"></a><span id="l6.592" class="difflineminus">-                        if not isinstance(entry, StringTypes):</span>
<a href="#l6.593"></a><span id="l6.593" class="difflineminus">-                            raise TypeError, (</span>
<a href="#l6.594"></a><span id="l6.594" class="difflineminus">-                                'Value is not a string &quot;%s&quot;.' % entry)</span>
<a href="#l6.595"></a><span id="l6.595" class="difflineminus">-                else:</span>
<a href="#l6.596"></a><span id="l6.596" class="difflineminus">-                    raise TypeError, 'Value is not a string &quot;%s&quot;.' % value</span>
<a href="#l6.597"></a><span id="l6.597" class="difflineminus">-            dict.__setitem__(self, key, value)</span>
<a href="#l6.598"></a><span id="l6.598" class="difflineminus">-</span>
<a href="#l6.599"></a><span id="l6.599" class="difflineminus">-    def __delitem__(self, key):</span>
<a href="#l6.600"></a><span id="l6.600" class="difflineminus">-        &quot;&quot;&quot;Remove items from the sequence when deleting.&quot;&quot;&quot;</span>
<a href="#l6.601"></a><span id="l6.601" class="difflineminus">-        dict. __delitem__(self, key)</span>
<a href="#l6.602"></a><span id="l6.602" class="difflineminus">-        if key in self.scalars:</span>
<a href="#l6.603"></a><span id="l6.603" class="difflineminus">-            self.scalars.remove(key)</span>
<a href="#l6.604"></a><span id="l6.604" class="difflineminus">-        else:</span>
<a href="#l6.605"></a><span id="l6.605" class="difflineminus">-            self.sections.remove(key)</span>
<a href="#l6.606"></a><span id="l6.606" class="difflineminus">-        del self.comments[key]</span>
<a href="#l6.607"></a><span id="l6.607" class="difflineminus">-        del self.inline_comments[key]</span>
<a href="#l6.608"></a><span id="l6.608" class="difflineminus">-</span>
<a href="#l6.609"></a><span id="l6.609" class="difflineminus">-    def get(self, key, default=None):</span>
<a href="#l6.610"></a><span id="l6.610" class="difflineminus">-        &quot;&quot;&quot;A version of ``get`` that doesn't bypass string interpolation.&quot;&quot;&quot;</span>
<a href="#l6.611"></a><span id="l6.611" class="difflineminus">-        try:</span>
<a href="#l6.612"></a><span id="l6.612" class="difflineminus">-            return self[key]</span>
<a href="#l6.613"></a><span id="l6.613" class="difflineminus">-        except KeyError:</span>
<a href="#l6.614"></a><span id="l6.614" class="difflineminus">-            return default</span>
<a href="#l6.615"></a><span id="l6.615" class="difflineminus">-</span>
<a href="#l6.616"></a><span id="l6.616" class="difflineminus">-    def update(self, indict):</span>
<a href="#l6.617"></a><span id="l6.617" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.618"></a><span id="l6.618" class="difflineminus">-        A version of update that uses our ``__setitem__``.</span>
<a href="#l6.619"></a><span id="l6.619" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.620"></a><span id="l6.620" class="difflineminus">-        for entry in indict:</span>
<a href="#l6.621"></a><span id="l6.621" class="difflineminus">-            self[entry] = indict[entry]</span>
<a href="#l6.622"></a><span id="l6.622" class="difflineminus">-</span>
<a href="#l6.623"></a><span id="l6.623" class="difflineminus">-    def pop(self, key, *args):</span>
<a href="#l6.624"></a><span id="l6.624" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.625"></a><span id="l6.625" class="difflineminus">-        val = dict.pop(self, key, *args)</span>
<a href="#l6.626"></a><span id="l6.626" class="difflineminus">-        if key in self.scalars:</span>
<a href="#l6.627"></a><span id="l6.627" class="difflineminus">-            del self.comments[key]</span>
<a href="#l6.628"></a><span id="l6.628" class="difflineminus">-            del self.inline_comments[key]</span>
<a href="#l6.629"></a><span id="l6.629" class="difflineminus">-            self.scalars.remove(key)</span>
<a href="#l6.630"></a><span id="l6.630" class="difflineminus">-        elif key in self.sections:</span>
<a href="#l6.631"></a><span id="l6.631" class="difflineminus">-            del self.comments[key]</span>
<a href="#l6.632"></a><span id="l6.632" class="difflineminus">-            del self.inline_comments[key]</span>
<a href="#l6.633"></a><span id="l6.633" class="difflineminus">-            self.sections.remove(key)</span>
<a href="#l6.634"></a><span id="l6.634" class="difflineminus">-        if self.main.interpolation and isinstance(val, StringTypes):</span>
<a href="#l6.635"></a><span id="l6.635" class="difflineminus">-            return self._interpolate(key, val)</span>
<a href="#l6.636"></a><span id="l6.636" class="difflineminus">-        return val</span>
<a href="#l6.637"></a><span id="l6.637" class="difflineminus">-</span>
<a href="#l6.638"></a><span id="l6.638" class="difflineminus">-    def popitem(self):</span>
<a href="#l6.639"></a><span id="l6.639" class="difflineminus">-        &quot;&quot;&quot;Pops the first (key,val)&quot;&quot;&quot;</span>
<a href="#l6.640"></a><span id="l6.640" class="difflineminus">-        sequence = (self.scalars + self.sections)</span>
<a href="#l6.641"></a><span id="l6.641" class="difflineminus">-        if not sequence:</span>
<a href="#l6.642"></a><span id="l6.642" class="difflineminus">-            raise KeyError, &quot;: 'popitem(): dictionary is empty'&quot;</span>
<a href="#l6.643"></a><span id="l6.643" class="difflineminus">-        key = sequence[0]</span>
<a href="#l6.644"></a><span id="l6.644" class="difflineminus">-        val =  self[key]</span>
<a href="#l6.645"></a><span id="l6.645" class="difflineminus">-        del self[key]</span>
<a href="#l6.646"></a><span id="l6.646" class="difflineminus">-        return key, val</span>
<a href="#l6.647"></a><span id="l6.647" class="difflineminus">-</span>
<a href="#l6.648"></a><span id="l6.648" class="difflineminus">-    def clear(self):</span>
<a href="#l6.649"></a><span id="l6.649" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.650"></a><span id="l6.650" class="difflineminus">-        A version of clear that also affects scalars/sections</span>
<a href="#l6.651"></a><span id="l6.651" class="difflineminus">-        Also clears comments and configspec.</span>
<a href="#l6.652"></a><span id="l6.652" class="difflineminus">-        </span>
<a href="#l6.653"></a><span id="l6.653" class="difflineminus">-        Leaves other attributes alone :</span>
<a href="#l6.654"></a><span id="l6.654" class="difflineminus">-            depth/main/parent are not affected</span>
<a href="#l6.655"></a><span id="l6.655" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.656"></a><span id="l6.656" class="difflineminus">-        dict.clear(self)</span>
<a href="#l6.657"></a><span id="l6.657" class="difflineminus">-        self.scalars = []</span>
<a href="#l6.658"></a><span id="l6.658" class="difflineminus">-        self.sections = []</span>
<a href="#l6.659"></a><span id="l6.659" class="difflineminus">-        self.comments = {}</span>
<a href="#l6.660"></a><span id="l6.660" class="difflineminus">-        self.inline_comments = {}</span>
<a href="#l6.661"></a><span id="l6.661" class="difflineminus">-        self.configspec = {}</span>
<a href="#l6.662"></a><span id="l6.662" class="difflineminus">-</span>
<a href="#l6.663"></a><span id="l6.663" class="difflineminus">-    def setdefault(self, key, default=None):</span>
<a href="#l6.664"></a><span id="l6.664" class="difflineminus">-        &quot;&quot;&quot;A version of setdefault that sets sequence if appropriate.&quot;&quot;&quot;</span>
<a href="#l6.665"></a><span id="l6.665" class="difflineminus">-        try:</span>
<a href="#l6.666"></a><span id="l6.666" class="difflineminus">-            return self[key]</span>
<a href="#l6.667"></a><span id="l6.667" class="difflineminus">-        except KeyError:</span>
<a href="#l6.668"></a><span id="l6.668" class="difflineminus">-            self[key] = default</span>
<a href="#l6.669"></a><span id="l6.669" class="difflineminus">-            return self[key]</span>
<a href="#l6.670"></a><span id="l6.670" class="difflineminus">-</span>
<a href="#l6.671"></a><span id="l6.671" class="difflineminus">-    def items(self):</span>
<a href="#l6.672"></a><span id="l6.672" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.673"></a><span id="l6.673" class="difflineminus">-        return zip((self.scalars + self.sections), self.values())</span>
<a href="#l6.674"></a><span id="l6.674" class="difflineminus">-</span>
<a href="#l6.675"></a><span id="l6.675" class="difflineminus">-    def keys(self):</span>
<a href="#l6.676"></a><span id="l6.676" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.677"></a><span id="l6.677" class="difflineminus">-        return (self.scalars + self.sections)</span>
<a href="#l6.678"></a><span id="l6.678" class="difflineminus">-</span>
<a href="#l6.679"></a><span id="l6.679" class="difflineminus">-    def values(self):</span>
<a href="#l6.680"></a><span id="l6.680" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.681"></a><span id="l6.681" class="difflineminus">-        return [self[key] for key in (self.scalars + self.sections)]</span>
<a href="#l6.682"></a><span id="l6.682" class="difflineminus">-</span>
<a href="#l6.683"></a><span id="l6.683" class="difflineminus">-    def iteritems(self):</span>
<a href="#l6.684"></a><span id="l6.684" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.685"></a><span id="l6.685" class="difflineminus">-        return iter(self.items())</span>
<a href="#l6.686"></a><span id="l6.686" class="difflineminus">-</span>
<a href="#l6.687"></a><span id="l6.687" class="difflineminus">-    def iterkeys(self):</span>
<a href="#l6.688"></a><span id="l6.688" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.689"></a><span id="l6.689" class="difflineminus">-        return iter((self.scalars + self.sections))</span>
<a href="#l6.690"></a><span id="l6.690" class="difflineminus">-</span>
<a href="#l6.691"></a><span id="l6.691" class="difflineminus">-    __iter__ = iterkeys</span>
<a href="#l6.692"></a><span id="l6.692" class="difflineminus">-</span>
<a href="#l6.693"></a><span id="l6.693" class="difflineminus">-    def itervalues(self):</span>
<a href="#l6.694"></a><span id="l6.694" class="difflineminus">-        &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.695"></a><span id="l6.695" class="difflineminus">-        return iter(self.values())</span>
<a href="#l6.696"></a><span id="l6.696" class="difflineminus">-</span>
<a href="#l6.697"></a><span id="l6.697" class="difflineminus">-    def __repr__(self):</span>
<a href="#l6.698"></a><span id="l6.698" class="difflineminus">-        return '{%s}' % ', '.join([('%s: %s' % (repr(key), repr(self[key])))</span>
<a href="#l6.699"></a><span id="l6.699" class="difflineminus">-            for key in (self.scalars + self.sections)])</span>
<a href="#l6.700"></a><span id="l6.700" class="difflineminus">-</span>
<a href="#l6.701"></a><span id="l6.701" class="difflineminus">-    __str__ = __repr__</span>
<a href="#l6.702"></a><span id="l6.702" class="difflineminus">-</span>
<a href="#l6.703"></a><span id="l6.703" class="difflineminus">-    # Extra methods - not in a normal dictionary</span>
<a href="#l6.704"></a><span id="l6.704" class="difflineminus">-</span>
<a href="#l6.705"></a><span id="l6.705" class="difflineminus">-    def dict(self):</span>
<a href="#l6.706"></a><span id="l6.706" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.707"></a><span id="l6.707" class="difflineminus">-        Return a deepcopy of self as a dictionary.</span>
<a href="#l6.708"></a><span id="l6.708" class="difflineminus">-        </span>
<a href="#l6.709"></a><span id="l6.709" class="difflineminus">-        All members that are ``Section`` instances are recursively turned to</span>
<a href="#l6.710"></a><span id="l6.710" class="difflineminus">-        ordinary dictionaries - by calling their ``dict`` method.</span>
<a href="#l6.711"></a><span id="l6.711" class="difflineminus">-        </span>
<a href="#l6.712"></a><span id="l6.712" class="difflineminus">-        &gt;&gt;&gt; n = a.dict()</span>
<a href="#l6.713"></a><span id="l6.713" class="difflineminus">-        &gt;&gt;&gt; n == a</span>
<a href="#l6.714"></a><span id="l6.714" class="difflineminus">-        1</span>
<a href="#l6.715"></a><span id="l6.715" class="difflineminus">-        &gt;&gt;&gt; n is a</span>
<a href="#l6.716"></a><span id="l6.716" class="difflineminus">-        0</span>
<a href="#l6.717"></a><span id="l6.717" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.718"></a><span id="l6.718" class="difflineminus">-        newdict = {}</span>
<a href="#l6.719"></a><span id="l6.719" class="difflineminus">-        for entry in self:</span>
<a href="#l6.720"></a><span id="l6.720" class="difflineminus">-            this_entry = self[entry]</span>
<a href="#l6.721"></a><span id="l6.721" class="difflineminus">-            if isinstance(this_entry, Section):</span>
<a href="#l6.722"></a><span id="l6.722" class="difflineminus">-                this_entry = this_entry.dict()</span>
<a href="#l6.723"></a><span id="l6.723" class="difflineminus">-            elif isinstance(this_entry, list):</span>
<a href="#l6.724"></a><span id="l6.724" class="difflineminus">-                # create a copy rather than a reference</span>
<a href="#l6.725"></a><span id="l6.725" class="difflineminus">-                this_entry = list(this_entry)</span>
<a href="#l6.726"></a><span id="l6.726" class="difflineminus">-            elif isinstance(this_entry, tuple):</span>
<a href="#l6.727"></a><span id="l6.727" class="difflineminus">-                # create a copy rather than a reference</span>
<a href="#l6.728"></a><span id="l6.728" class="difflineminus">-                this_entry = tuple(this_entry)</span>
<a href="#l6.729"></a><span id="l6.729" class="difflineminus">-            newdict[entry] = this_entry</span>
<a href="#l6.730"></a><span id="l6.730" class="difflineminus">-        return newdict</span>
<a href="#l6.731"></a><span id="l6.731" class="difflineminus">-</span>
<a href="#l6.732"></a><span id="l6.732" class="difflineminus">-    def merge(self, indict):</span>
<a href="#l6.733"></a><span id="l6.733" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.734"></a><span id="l6.734" class="difflineminus">-        A recursive update - useful for merging config files.</span>
<a href="#l6.735"></a><span id="l6.735" class="difflineminus">-        </span>
<a href="#l6.736"></a><span id="l6.736" class="difflineminus">-        &gt;&gt;&gt; a = '''[section1]</span>
<a href="#l6.737"></a><span id="l6.737" class="difflineminus">-        ...     option1 = True</span>
<a href="#l6.738"></a><span id="l6.738" class="difflineminus">-        ...     [[subsection]]</span>
<a href="#l6.739"></a><span id="l6.739" class="difflineminus">-        ...     more_options = False</span>
<a href="#l6.740"></a><span id="l6.740" class="difflineminus">-        ...     # end of file'''.splitlines()</span>
<a href="#l6.741"></a><span id="l6.741" class="difflineminus">-        &gt;&gt;&gt; b = '''# File is user.ini</span>
<a href="#l6.742"></a><span id="l6.742" class="difflineminus">-        ...     [section1]</span>
<a href="#l6.743"></a><span id="l6.743" class="difflineminus">-        ...     option1 = False</span>
<a href="#l6.744"></a><span id="l6.744" class="difflineminus">-        ...     # end of file'''.splitlines()</span>
<a href="#l6.745"></a><span id="l6.745" class="difflineminus">-        &gt;&gt;&gt; c1 = ConfigObj(b)</span>
<a href="#l6.746"></a><span id="l6.746" class="difflineminus">-        &gt;&gt;&gt; c2 = ConfigObj(a)</span>
<a href="#l6.747"></a><span id="l6.747" class="difflineminus">-        &gt;&gt;&gt; c2.merge(c1)</span>
<a href="#l6.748"></a><span id="l6.748" class="difflineminus">-        &gt;&gt;&gt; c2</span>
<a href="#l6.749"></a><span id="l6.749" class="difflineminus">-        {'section1': {'option1': 'False', 'subsection': {'more_options': 'False'}}}</span>
<a href="#l6.750"></a><span id="l6.750" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.751"></a><span id="l6.751" class="difflineminus">-        for key, val in indict.items():</span>
<a href="#l6.752"></a><span id="l6.752" class="difflineminus">-            if (key in self and isinstance(self[key], dict) and</span>
<a href="#l6.753"></a><span id="l6.753" class="difflineminus">-                                isinstance(val, dict)):</span>
<a href="#l6.754"></a><span id="l6.754" class="difflineminus">-                self[key].merge(val)</span>
<a href="#l6.755"></a><span id="l6.755" class="difflineminus">-            else:   </span>
<a href="#l6.756"></a><span id="l6.756" class="difflineminus">-                self[key] = val</span>
<a href="#l6.757"></a><span id="l6.757" class="difflineminus">-</span>
<a href="#l6.758"></a><span id="l6.758" class="difflineminus">-    def rename(self, oldkey, newkey):</span>
<a href="#l6.759"></a><span id="l6.759" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.760"></a><span id="l6.760" class="difflineminus">-        Change a keyname to another, without changing position in sequence.</span>
<a href="#l6.761"></a><span id="l6.761" class="difflineminus">-        </span>
<a href="#l6.762"></a><span id="l6.762" class="difflineminus">-        Implemented so that transformations can be made on keys,</span>
<a href="#l6.763"></a><span id="l6.763" class="difflineminus">-        as well as on values. (used by encode and decode)</span>
<a href="#l6.764"></a><span id="l6.764" class="difflineminus">-        </span>
<a href="#l6.765"></a><span id="l6.765" class="difflineminus">-        Also renames comments.</span>
<a href="#l6.766"></a><span id="l6.766" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.767"></a><span id="l6.767" class="difflineminus">-        if oldkey in self.scalars:</span>
<a href="#l6.768"></a><span id="l6.768" class="difflineminus">-            the_list = self.scalars</span>
<a href="#l6.769"></a><span id="l6.769" class="difflineminus">-        elif oldkey in self.sections:</span>
<a href="#l6.770"></a><span id="l6.770" class="difflineminus">-            the_list = self.sections</span>
<a href="#l6.771"></a><span id="l6.771" class="difflineminus">-        else:</span>
<a href="#l6.772"></a><span id="l6.772" class="difflineminus">-            raise KeyError, 'Key &quot;%s&quot; not found.' % oldkey</span>
<a href="#l6.773"></a><span id="l6.773" class="difflineminus">-        pos = the_list.index(oldkey)</span>
<a href="#l6.774"></a><span id="l6.774" class="difflineminus">-        #</span>
<a href="#l6.775"></a><span id="l6.775" class="difflineminus">-        val = self[oldkey]</span>
<a href="#l6.776"></a><span id="l6.776" class="difflineminus">-        dict.__delitem__(self, oldkey)</span>
<a href="#l6.777"></a><span id="l6.777" class="difflineminus">-        dict.__setitem__(self, newkey, val)</span>
<a href="#l6.778"></a><span id="l6.778" class="difflineminus">-        the_list.remove(oldkey)</span>
<a href="#l6.779"></a><span id="l6.779" class="difflineminus">-        the_list.insert(pos, newkey)</span>
<a href="#l6.780"></a><span id="l6.780" class="difflineminus">-        comm = self.comments[oldkey]</span>
<a href="#l6.781"></a><span id="l6.781" class="difflineminus">-        inline_comment = self.inline_comments[oldkey]</span>
<a href="#l6.782"></a><span id="l6.782" class="difflineminus">-        del self.comments[oldkey]</span>
<a href="#l6.783"></a><span id="l6.783" class="difflineminus">-        del self.inline_comments[oldkey]</span>
<a href="#l6.784"></a><span id="l6.784" class="difflineminus">-        self.comments[newkey] = comm</span>
<a href="#l6.785"></a><span id="l6.785" class="difflineminus">-        self.inline_comments[newkey] = inline_comment</span>
<a href="#l6.786"></a><span id="l6.786" class="difflineminus">-</span>
<a href="#l6.787"></a><span id="l6.787" class="difflineminus">-    def walk(self, function, raise_errors=True,</span>
<a href="#l6.788"></a><span id="l6.788" class="difflineminus">-            call_on_sections=False, **keywargs):</span>
<a href="#l6.789"></a><span id="l6.789" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.790"></a><span id="l6.790" class="difflineminus">-        Walk every member and call a function on the keyword and value.</span>
<a href="#l6.791"></a><span id="l6.791" class="difflineminus">-        </span>
<a href="#l6.792"></a><span id="l6.792" class="difflineminus">-        Return a dictionary of the return values</span>
<a href="#l6.793"></a><span id="l6.793" class="difflineminus">-        </span>
<a href="#l6.794"></a><span id="l6.794" class="difflineminus">-        If the function raises an exception, raise the errror</span>
<a href="#l6.795"></a><span id="l6.795" class="difflineminus">-        unless ``raise_errors=False``, in which case set the return value to</span>
<a href="#l6.796"></a><span id="l6.796" class="difflineminus">-        ``False``.</span>
<a href="#l6.797"></a><span id="l6.797" class="difflineminus">-        </span>
<a href="#l6.798"></a><span id="l6.798" class="difflineminus">-        Any unrecognised keyword arguments you pass to walk, will be pased on</span>
<a href="#l6.799"></a><span id="l6.799" class="difflineminus">-        to the function you pass in.</span>
<a href="#l6.800"></a><span id="l6.800" class="difflineminus">-        </span>
<a href="#l6.801"></a><span id="l6.801" class="difflineminus">-        Note: if ``call_on_sections`` is ``True`` then - on encountering a</span>
<a href="#l6.802"></a><span id="l6.802" class="difflineminus">-        subsection, *first* the function is called for the *whole* subsection,</span>
<a href="#l6.803"></a><span id="l6.803" class="difflineminus">-        and then recurses into its members. This means your function must be</span>
<a href="#l6.804"></a><span id="l6.804" class="difflineminus">-        able to handle strings, dictionaries and lists. This allows you</span>
<a href="#l6.805"></a><span id="l6.805" class="difflineminus">-        to change the key of subsections as well as for ordinary members. The</span>
<a href="#l6.806"></a><span id="l6.806" class="difflineminus">-        return value when called on the whole subsection has to be discarded.</span>
<a href="#l6.807"></a><span id="l6.807" class="difflineminus">-        </span>
<a href="#l6.808"></a><span id="l6.808" class="difflineminus">-        See  the encode and decode methods for examples, including functions.</span>
<a href="#l6.809"></a><span id="l6.809" class="difflineminus">-        </span>
<a href="#l6.810"></a><span id="l6.810" class="difflineminus">-        .. caution::</span>
<a href="#l6.811"></a><span id="l6.811" class="difflineminus">-        </span>
<a href="#l6.812"></a><span id="l6.812" class="difflineminus">-            You can use ``walk`` to transform the names of members of a section</span>
<a href="#l6.813"></a><span id="l6.813" class="difflineminus">-            but you mustn't add or delete members.</span>
<a href="#l6.814"></a><span id="l6.814" class="difflineminus">-        </span>
<a href="#l6.815"></a><span id="l6.815" class="difflineminus">-        &gt;&gt;&gt; config = '''[XXXXsection]</span>
<a href="#l6.816"></a><span id="l6.816" class="difflineminus">-        ... XXXXkey = XXXXvalue'''.splitlines()</span>
<a href="#l6.817"></a><span id="l6.817" class="difflineminus">-        &gt;&gt;&gt; cfg = ConfigObj(config)</span>
<a href="#l6.818"></a><span id="l6.818" class="difflineminus">-        &gt;&gt;&gt; cfg</span>
<a href="#l6.819"></a><span id="l6.819" class="difflineminus">-        {'XXXXsection': {'XXXXkey': 'XXXXvalue'}}</span>
<a href="#l6.820"></a><span id="l6.820" class="difflineminus">-        &gt;&gt;&gt; def transform(section, key):</span>
<a href="#l6.821"></a><span id="l6.821" class="difflineminus">-        ...     val = section[key]</span>
<a href="#l6.822"></a><span id="l6.822" class="difflineminus">-        ...     newkey = key.replace('XXXX', 'CLIENT1')</span>
<a href="#l6.823"></a><span id="l6.823" class="difflineminus">-        ...     section.rename(key, newkey)</span>
<a href="#l6.824"></a><span id="l6.824" class="difflineminus">-        ...     if isinstance(val, (tuple, list, dict)):</span>
<a href="#l6.825"></a><span id="l6.825" class="difflineminus">-        ...         pass</span>
<a href="#l6.826"></a><span id="l6.826" class="difflineminus">-        ...     else:</span>
<a href="#l6.827"></a><span id="l6.827" class="difflineminus">-        ...         val = val.replace('XXXX', 'CLIENT1')</span>
<a href="#l6.828"></a><span id="l6.828" class="difflineminus">-        ...         section[newkey] = val</span>
<a href="#l6.829"></a><span id="l6.829" class="difflineminus">-        &gt;&gt;&gt; cfg.walk(transform, call_on_sections=True)</span>
<a href="#l6.830"></a><span id="l6.830" class="difflineminus">-        {'CLIENT1section': {'CLIENT1key': None}}</span>
<a href="#l6.831"></a><span id="l6.831" class="difflineminus">-        &gt;&gt;&gt; cfg</span>
<a href="#l6.832"></a><span id="l6.832" class="difflineminus">-        {'CLIENT1section': {'CLIENT1key': 'CLIENT1value'}}</span>
<a href="#l6.833"></a><span id="l6.833" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.834"></a><span id="l6.834" class="difflineminus">-        out = {}</span>
<a href="#l6.835"></a><span id="l6.835" class="difflineminus">-        # scalars first</span>
<a href="#l6.836"></a><span id="l6.836" class="difflineminus">-        for i in range(len(self.scalars)):</span>
<a href="#l6.837"></a><span id="l6.837" class="difflineminus">-            entry = self.scalars[i]</span>
<a href="#l6.838"></a><span id="l6.838" class="difflineminus">-            try:</span>
<a href="#l6.839"></a><span id="l6.839" class="difflineminus">-                val = function(self, entry, **keywargs)</span>
<a href="#l6.840"></a><span id="l6.840" class="difflineminus">-                # bound again in case name has changed</span>
<a href="#l6.841"></a><span id="l6.841" class="difflineminus">-                entry = self.scalars[i]</span>
<a href="#l6.842"></a><span id="l6.842" class="difflineminus">-                out[entry] = val</span>
<a href="#l6.843"></a><span id="l6.843" class="difflineminus">-            except Exception:</span>
<a href="#l6.844"></a><span id="l6.844" class="difflineminus">-                if raise_errors:</span>
<a href="#l6.845"></a><span id="l6.845" class="difflineminus">-                    raise</span>
<a href="#l6.846"></a><span id="l6.846" class="difflineminus">-                else:</span>
<a href="#l6.847"></a><span id="l6.847" class="difflineminus">-                    entry = self.scalars[i]</span>
<a href="#l6.848"></a><span id="l6.848" class="difflineminus">-                    out[entry] = False</span>
<a href="#l6.849"></a><span id="l6.849" class="difflineminus">-        # then sections</span>
<a href="#l6.850"></a><span id="l6.850" class="difflineminus">-        for i in range(len(self.sections)):</span>
<a href="#l6.851"></a><span id="l6.851" class="difflineminus">-            entry = self.sections[i]</span>
<a href="#l6.852"></a><span id="l6.852" class="difflineminus">-            if call_on_sections:</span>
<a href="#l6.853"></a><span id="l6.853" class="difflineminus">-                try:</span>
<a href="#l6.854"></a><span id="l6.854" class="difflineminus">-                    function(self, entry, **keywargs)</span>
<a href="#l6.855"></a><span id="l6.855" class="difflineminus">-                except Exception:</span>
<a href="#l6.856"></a><span id="l6.856" class="difflineminus">-                    if raise_errors:</span>
<a href="#l6.857"></a><span id="l6.857" class="difflineminus">-                        raise</span>
<a href="#l6.858"></a><span id="l6.858" class="difflineminus">-                    else:</span>
<a href="#l6.859"></a><span id="l6.859" class="difflineminus">-                        entry = self.sections[i]</span>
<a href="#l6.860"></a><span id="l6.860" class="difflineminus">-                        out[entry] = False</span>
<a href="#l6.861"></a><span id="l6.861" class="difflineminus">-                # bound again in case name has changed</span>
<a href="#l6.862"></a><span id="l6.862" class="difflineminus">-                entry = self.sections[i]</span>
<a href="#l6.863"></a><span id="l6.863" class="difflineminus">-            # previous result is discarded</span>
<a href="#l6.864"></a><span id="l6.864" class="difflineminus">-            out[entry] = self[entry].walk(</span>
<a href="#l6.865"></a><span id="l6.865" class="difflineminus">-                function,</span>
<a href="#l6.866"></a><span id="l6.866" class="difflineminus">-                raise_errors=raise_errors,</span>
<a href="#l6.867"></a><span id="l6.867" class="difflineminus">-                call_on_sections=call_on_sections,</span>
<a href="#l6.868"></a><span id="l6.868" class="difflineminus">-                **keywargs)</span>
<a href="#l6.869"></a><span id="l6.869" class="difflineminus">-        return out</span>
<a href="#l6.870"></a><span id="l6.870" class="difflineminus">-</span>
<a href="#l6.871"></a><span id="l6.871" class="difflineminus">-    def decode(self, encoding):</span>
<a href="#l6.872"></a><span id="l6.872" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.873"></a><span id="l6.873" class="difflineminus">-        Decode all strings and values to unicode, using the specified encoding.</span>
<a href="#l6.874"></a><span id="l6.874" class="difflineminus">-        </span>
<a href="#l6.875"></a><span id="l6.875" class="difflineminus">-        Works with subsections and list values.</span>
<a href="#l6.876"></a><span id="l6.876" class="difflineminus">-        </span>
<a href="#l6.877"></a><span id="l6.877" class="difflineminus">-        Uses the ``walk`` method.</span>
<a href="#l6.878"></a><span id="l6.878" class="difflineminus">-        </span>
<a href="#l6.879"></a><span id="l6.879" class="difflineminus">-        Testing ``encode`` and ``decode``.</span>
<a href="#l6.880"></a><span id="l6.880" class="difflineminus">-        &gt;&gt;&gt; m = ConfigObj(a)</span>
<a href="#l6.881"></a><span id="l6.881" class="difflineminus">-        &gt;&gt;&gt; m.decode('ascii')</span>
<a href="#l6.882"></a><span id="l6.882" class="difflineminus">-        &gt;&gt;&gt; def testuni(val):</span>
<a href="#l6.883"></a><span id="l6.883" class="difflineminus">-        ...     for entry in val:</span>
<a href="#l6.884"></a><span id="l6.884" class="difflineminus">-        ...         if not isinstance(entry, unicode):</span>
<a href="#l6.885"></a><span id="l6.885" class="difflineminus">-        ...             print &gt;&gt; sys.stderr, type(entry)</span>
<a href="#l6.886"></a><span id="l6.886" class="difflineminus">-        ...             raise AssertionError, 'decode failed.'</span>
<a href="#l6.887"></a><span id="l6.887" class="difflineminus">-        ...         if isinstance(val[entry], dict):</span>
<a href="#l6.888"></a><span id="l6.888" class="difflineminus">-        ...             testuni(val[entry])</span>
<a href="#l6.889"></a><span id="l6.889" class="difflineminus">-        ...         elif not isinstance(val[entry], unicode):</span>
<a href="#l6.890"></a><span id="l6.890" class="difflineminus">-        ...             raise AssertionError, 'decode failed.'</span>
<a href="#l6.891"></a><span id="l6.891" class="difflineminus">-        &gt;&gt;&gt; testuni(m)</span>
<a href="#l6.892"></a><span id="l6.892" class="difflineminus">-        &gt;&gt;&gt; m.encode('ascii')</span>
<a href="#l6.893"></a><span id="l6.893" class="difflineminus">-        &gt;&gt;&gt; a == m</span>
<a href="#l6.894"></a><span id="l6.894" class="difflineminus">-        1</span>
<a href="#l6.895"></a><span id="l6.895" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.896"></a><span id="l6.896" class="difflineminus">-        warn('use of ``decode`` is deprecated.', DeprecationWarning)</span>
<a href="#l6.897"></a><span id="l6.897" class="difflineminus">-        def decode(section, key, encoding=encoding, warn=True):</span>
<a href="#l6.898"></a><span id="l6.898" class="difflineminus">-            &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.899"></a><span id="l6.899" class="difflineminus">-            val = section[key]</span>
<a href="#l6.900"></a><span id="l6.900" class="difflineminus">-            if isinstance(val, (list, tuple)):</span>
<a href="#l6.901"></a><span id="l6.901" class="difflineminus">-                newval = []</span>
<a href="#l6.902"></a><span id="l6.902" class="difflineminus">-                for entry in val:</span>
<a href="#l6.903"></a><span id="l6.903" class="difflineminus">-                    newval.append(entry.decode(encoding))</span>
<a href="#l6.904"></a><span id="l6.904" class="difflineminus">-            elif isinstance(val, dict):</span>
<a href="#l6.905"></a><span id="l6.905" class="difflineminus">-                newval = val</span>
<a href="#l6.906"></a><span id="l6.906" class="difflineminus">-            else:</span>
<a href="#l6.907"></a><span id="l6.907" class="difflineminus">-                newval = val.decode(encoding)</span>
<a href="#l6.908"></a><span id="l6.908" class="difflineminus">-            newkey = key.decode(encoding)</span>
<a href="#l6.909"></a><span id="l6.909" class="difflineminus">-            section.rename(key, newkey)</span>
<a href="#l6.910"></a><span id="l6.910" class="difflineminus">-            section[newkey] = newval</span>
<a href="#l6.911"></a><span id="l6.911" class="difflineminus">-        # using ``call_on_sections`` allows us to modify section names</span>
<a href="#l6.912"></a><span id="l6.912" class="difflineminus">-        self.walk(decode, call_on_sections=True)</span>
<a href="#l6.913"></a><span id="l6.913" class="difflineminus">-</span>
<a href="#l6.914"></a><span id="l6.914" class="difflineminus">-    def encode(self, encoding):</span>
<a href="#l6.915"></a><span id="l6.915" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.916"></a><span id="l6.916" class="difflineminus">-        Encode all strings and values from unicode,</span>
<a href="#l6.917"></a><span id="l6.917" class="difflineminus">-        using the specified encoding.</span>
<a href="#l6.918"></a><span id="l6.918" class="difflineminus">-        </span>
<a href="#l6.919"></a><span id="l6.919" class="difflineminus">-        Works with subsections and list values.</span>
<a href="#l6.920"></a><span id="l6.920" class="difflineminus">-        Uses the ``walk`` method.</span>
<a href="#l6.921"></a><span id="l6.921" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.922"></a><span id="l6.922" class="difflineminus">-        warn('use of ``encode`` is deprecated.', DeprecationWarning)</span>
<a href="#l6.923"></a><span id="l6.923" class="difflineminus">-        def encode(section, key, encoding=encoding):</span>
<a href="#l6.924"></a><span id="l6.924" class="difflineminus">-            &quot;&quot;&quot; &quot;&quot;&quot;</span>
<a href="#l6.925"></a><span id="l6.925" class="difflineminus">-            val = section[key]</span>
<a href="#l6.926"></a><span id="l6.926" class="difflineminus">-            if isinstance(val, (list, tuple)):</span>
<a href="#l6.927"></a><span id="l6.927" class="difflineminus">-                newval = []</span>
<a href="#l6.928"></a><span id="l6.928" class="difflineminus">-                for entry in val:</span>
<a href="#l6.929"></a><span id="l6.929" class="difflineminus">-                    newval.append(entry.encode(encoding))</span>
<a href="#l6.930"></a><span id="l6.930" class="difflineminus">-            elif isinstance(val, dict):</span>
<a href="#l6.931"></a><span id="l6.931" class="difflineminus">-                newval = val</span>
<a href="#l6.932"></a><span id="l6.932" class="difflineminus">-            else:</span>
<a href="#l6.933"></a><span id="l6.933" class="difflineminus">-                newval = val.encode(encoding)</span>
<a href="#l6.934"></a><span id="l6.934" class="difflineminus">-            newkey = key.encode(encoding)</span>
<a href="#l6.935"></a><span id="l6.935" class="difflineminus">-            section.rename(key, newkey)</span>
<a href="#l6.936"></a><span id="l6.936" class="difflineminus">-            section[newkey] = newval</span>
<a href="#l6.937"></a><span id="l6.937" class="difflineminus">-        self.walk(encode, call_on_sections=True)</span>
<a href="#l6.938"></a><span id="l6.938" class="difflineminus">-</span>
<a href="#l6.939"></a><span id="l6.939" class="difflineminus">-    def istrue(self, key):</span>
<a href="#l6.940"></a><span id="l6.940" class="difflineminus">-        &quot;&quot;&quot;A deprecated version of ``as_bool``.&quot;&quot;&quot;</span>
<a href="#l6.941"></a><span id="l6.941" class="difflineminus">-        warn('use of ``istrue`` is deprecated. Use ``as_bool`` method '</span>
<a href="#l6.942"></a><span id="l6.942" class="difflineminus">-                'instead.', DeprecationWarning)</span>
<a href="#l6.943"></a><span id="l6.943" class="difflineminus">-        return self.as_bool(key)</span>
<a href="#l6.944"></a><span id="l6.944" class="difflineminus">-</span>
<a href="#l6.945"></a><span id="l6.945" class="difflineminus">-    def as_bool(self, key):</span>
<a href="#l6.946"></a><span id="l6.946" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.947"></a><span id="l6.947" class="difflineminus">-        Accepts a key as input. The corresponding value must be a string or</span>
<a href="#l6.948"></a><span id="l6.948" class="difflineminus">-        the objects (``True`` or 1) or (``False`` or 0). We allow 0 and 1 to</span>
<a href="#l6.949"></a><span id="l6.949" class="difflineminus">-        retain compatibility with Python 2.2.</span>
<a href="#l6.950"></a><span id="l6.950" class="difflineminus">-        </span>
<a href="#l6.951"></a><span id="l6.951" class="difflineminus">-        If the string is one of  ``True``, ``On``, ``Yes``, or ``1`` it returns </span>
<a href="#l6.952"></a><span id="l6.952" class="difflineminus">-        ``True``.</span>
<a href="#l6.953"></a><span id="l6.953" class="difflineminus">-        </span>
<a href="#l6.954"></a><span id="l6.954" class="difflineminus">-        If the string is one of  ``False``, ``Off``, ``No``, or ``0`` it returns </span>
<a href="#l6.955"></a><span id="l6.955" class="difflineminus">-        ``False``.</span>
<a href="#l6.956"></a><span id="l6.956" class="difflineminus">-        </span>
<a href="#l6.957"></a><span id="l6.957" class="difflineminus">-        ``as_bool`` is not case sensitive.</span>
<a href="#l6.958"></a><span id="l6.958" class="difflineminus">-        </span>
<a href="#l6.959"></a><span id="l6.959" class="difflineminus">-        Any other input will raise a ``ValueError``.</span>
<a href="#l6.960"></a><span id="l6.960" class="difflineminus">-        </span>
<a href="#l6.961"></a><span id="l6.961" class="difflineminus">-        &gt;&gt;&gt; a = ConfigObj()</span>
<a href="#l6.962"></a><span id="l6.962" class="difflineminus">-        &gt;&gt;&gt; a['a'] = 'fish'</span>
<a href="#l6.963"></a><span id="l6.963" class="difflineminus">-        &gt;&gt;&gt; a.as_bool('a')</span>
<a href="#l6.964"></a><span id="l6.964" class="difflineminus">-        Traceback (most recent call last):</span>
<a href="#l6.965"></a><span id="l6.965" class="difflineminus">-        ValueError: Value &quot;fish&quot; is neither True nor False</span>
<a href="#l6.966"></a><span id="l6.966" class="difflineminus">-        &gt;&gt;&gt; a['b'] = 'True'</span>
<a href="#l6.967"></a><span id="l6.967" class="difflineminus">-        &gt;&gt;&gt; a.as_bool('b')</span>
<a href="#l6.968"></a><span id="l6.968" class="difflineminus">-        1</span>
<a href="#l6.969"></a><span id="l6.969" class="difflineminus">-        &gt;&gt;&gt; a['b'] = 'off'</span>
<a href="#l6.970"></a><span id="l6.970" class="difflineminus">-        &gt;&gt;&gt; a.as_bool('b')</span>
<a href="#l6.971"></a><span id="l6.971" class="difflineminus">-        0</span>
<a href="#l6.972"></a><span id="l6.972" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.973"></a><span id="l6.973" class="difflineminus">-        val = self[key]</span>
<a href="#l6.974"></a><span id="l6.974" class="difflineminus">-        if val == True:</span>
<a href="#l6.975"></a><span id="l6.975" class="difflineminus">-            return True</span>
<a href="#l6.976"></a><span id="l6.976" class="difflineminus">-        elif val == False:</span>
<a href="#l6.977"></a><span id="l6.977" class="difflineminus">-            return False</span>
<a href="#l6.978"></a><span id="l6.978" class="difflineminus">-        else:</span>
<a href="#l6.979"></a><span id="l6.979" class="difflineminus">-            try:</span>
<a href="#l6.980"></a><span id="l6.980" class="difflineminus">-                if not isinstance(val, StringTypes):</span>
<a href="#l6.981"></a><span id="l6.981" class="difflineminus">-                    raise KeyError</span>
<a href="#l6.982"></a><span id="l6.982" class="difflineminus">-                else:</span>
<a href="#l6.983"></a><span id="l6.983" class="difflineminus">-                    return self.main._bools[val.lower()]</span>
<a href="#l6.984"></a><span id="l6.984" class="difflineminus">-            except KeyError:</span>
<a href="#l6.985"></a><span id="l6.985" class="difflineminus">-                raise ValueError('Value &quot;%s&quot; is neither True nor False' % val)</span>
<a href="#l6.986"></a><span id="l6.986" class="difflineminus">-</span>
<a href="#l6.987"></a><span id="l6.987" class="difflineminus">-    def as_int(self, key):</span>
<a href="#l6.988"></a><span id="l6.988" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.989"></a><span id="l6.989" class="difflineminus">-        A convenience method which coerces the specified value to an integer.</span>
<a href="#l6.990"></a><span id="l6.990" class="difflineminus">-        </span>
<a href="#l6.991"></a><span id="l6.991" class="difflineminus">-        If the value is an invalid literal for ``int``, a ``ValueError`` will</span>
<a href="#l6.992"></a><span id="l6.992" class="difflineminus">-        be raised.</span>
<a href="#l6.993"></a><span id="l6.993" class="difflineminus">-        </span>
<a href="#l6.994"></a><span id="l6.994" class="difflineminus">-        &gt;&gt;&gt; a = ConfigObj()</span>
<a href="#l6.995"></a><span id="l6.995" class="difflineminus">-        &gt;&gt;&gt; a['a'] = 'fish'</span>
<a href="#l6.996"></a><span id="l6.996" class="difflineminus">-        &gt;&gt;&gt; a.as_int('a')</span>
<a href="#l6.997"></a><span id="l6.997" class="difflineminus">-        Traceback (most recent call last):</span>
<a href="#l6.998"></a><span id="l6.998" class="difflineminus">-        ValueError: invalid literal for int(): fish</span>
<a href="#l6.999"></a><span id="l6.999" class="difflineminus">-        &gt;&gt;&gt; a['b'] = '1'</span>
<a href="#l6.1000"></a><span id="l6.1000" class="difflineminus">-        &gt;&gt;&gt; a.as_int('b')</span>
<a href="#l6.1001"></a><span id="l6.1001" class="difflineminus">-        1</span>
<a href="#l6.1002"></a><span id="l6.1002" class="difflineminus">-        &gt;&gt;&gt; a['b'] = '3.2'</span>
<a href="#l6.1003"></a><span id="l6.1003" class="difflineminus">-        &gt;&gt;&gt; a.as_int('b')</span>
<a href="#l6.1004"></a><span id="l6.1004" class="difflineminus">-        Traceback (most recent call last):</span>
<a href="#l6.1005"></a><span id="l6.1005" class="difflineminus">-        ValueError: invalid literal for int(): 3.2</span>
<a href="#l6.1006"></a><span id="l6.1006" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1007"></a><span id="l6.1007" class="difflineminus">-        return int(self[key])</span>
<a href="#l6.1008"></a><span id="l6.1008" class="difflineminus">-</span>
<a href="#l6.1009"></a><span id="l6.1009" class="difflineminus">-    def as_float(self, key):</span>
<a href="#l6.1010"></a><span id="l6.1010" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1011"></a><span id="l6.1011" class="difflineminus">-        A convenience method which coerces the specified value to a float.</span>
<a href="#l6.1012"></a><span id="l6.1012" class="difflineminus">-        </span>
<a href="#l6.1013"></a><span id="l6.1013" class="difflineminus">-        If the value is an invalid literal for ``float``, a ``ValueError`` will</span>
<a href="#l6.1014"></a><span id="l6.1014" class="difflineminus">-        be raised.</span>
<a href="#l6.1015"></a><span id="l6.1015" class="difflineminus">-        </span>
<a href="#l6.1016"></a><span id="l6.1016" class="difflineminus">-        &gt;&gt;&gt; a = ConfigObj()</span>
<a href="#l6.1017"></a><span id="l6.1017" class="difflineminus">-        &gt;&gt;&gt; a['a'] = 'fish'</span>
<a href="#l6.1018"></a><span id="l6.1018" class="difflineminus">-        &gt;&gt;&gt; a.as_float('a')</span>
<a href="#l6.1019"></a><span id="l6.1019" class="difflineminus">-        Traceback (most recent call last):</span>
<a href="#l6.1020"></a><span id="l6.1020" class="difflineminus">-        ValueError: invalid literal for float(): fish</span>
<a href="#l6.1021"></a><span id="l6.1021" class="difflineminus">-        &gt;&gt;&gt; a['b'] = '1'</span>
<a href="#l6.1022"></a><span id="l6.1022" class="difflineminus">-        &gt;&gt;&gt; a.as_float('b')</span>
<a href="#l6.1023"></a><span id="l6.1023" class="difflineminus">-        1.0</span>
<a href="#l6.1024"></a><span id="l6.1024" class="difflineminus">-        &gt;&gt;&gt; a['b'] = '3.2'</span>
<a href="#l6.1025"></a><span id="l6.1025" class="difflineminus">-        &gt;&gt;&gt; a.as_float('b')</span>
<a href="#l6.1026"></a><span id="l6.1026" class="difflineminus">-        3.2000000000000002</span>
<a href="#l6.1027"></a><span id="l6.1027" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1028"></a><span id="l6.1028" class="difflineminus">-        return float(self[key])</span>
<a href="#l6.1029"></a><span id="l6.1029" class="difflineminus">-    </span>
<a href="#l6.1030"></a><span id="l6.1030" class="difflineminus">-</span>
<a href="#l6.1031"></a><span id="l6.1031" class="difflineminus">-class ConfigObj(Section):</span>
<a href="#l6.1032"></a><span id="l6.1032" class="difflineminus">-    &quot;&quot;&quot;An object to read, create, and write config files.&quot;&quot;&quot;</span>
<a href="#l6.1033"></a><span id="l6.1033" class="difflineminus">-</span>
<a href="#l6.1034"></a><span id="l6.1034" class="difflineminus">-    _keyword = re.compile(r'''^ # line start</span>
<a href="#l6.1035"></a><span id="l6.1035" class="difflineminus">-        (\s*)                   # indentation</span>
<a href="#l6.1036"></a><span id="l6.1036" class="difflineminus">-        (                       # keyword</span>
<a href="#l6.1037"></a><span id="l6.1037" class="difflineminus">-            (?:&quot;.*?&quot;)|          # double quotes</span>
<a href="#l6.1038"></a><span id="l6.1038" class="difflineminus">-            (?:'.*?')|          # single quotes</span>
<a href="#l6.1039"></a><span id="l6.1039" class="difflineminus">-            (?:[^'&quot;=].*?)       # no quotes</span>
<a href="#l6.1040"></a><span id="l6.1040" class="difflineminus">-        )</span>
<a href="#l6.1041"></a><span id="l6.1041" class="difflineminus">-        \s*=\s*                 # divider</span>
<a href="#l6.1042"></a><span id="l6.1042" class="difflineminus">-        (.*)                    # value (including list values and comments)</span>
<a href="#l6.1043"></a><span id="l6.1043" class="difflineminus">-        $   # line end</span>
<a href="#l6.1044"></a><span id="l6.1044" class="difflineminus">-        ''',</span>
<a href="#l6.1045"></a><span id="l6.1045" class="difflineminus">-        re.VERBOSE)</span>
<a href="#l6.1046"></a><span id="l6.1046" class="difflineminus">-</span>
<a href="#l6.1047"></a><span id="l6.1047" class="difflineminus">-    _sectionmarker = re.compile(r'''^</span>
<a href="#l6.1048"></a><span id="l6.1048" class="difflineminus">-        (\s*)                     # 1: indentation</span>
<a href="#l6.1049"></a><span id="l6.1049" class="difflineminus">-        ((?:\[\s*)+)              # 2: section marker open</span>
<a href="#l6.1050"></a><span id="l6.1050" class="difflineminus">-        (                         # 3: section name open</span>
<a href="#l6.1051"></a><span id="l6.1051" class="difflineminus">-            (?:&quot;\s*\S.*?\s*&quot;)|    # at least one non-space with double quotes</span>
<a href="#l6.1052"></a><span id="l6.1052" class="difflineminus">-            (?:'\s*\S.*?\s*')|    # at least one non-space with single quotes</span>
<a href="#l6.1053"></a><span id="l6.1053" class="difflineminus">-            (?:[^'&quot;\s].*?)        # at least one non-space unquoted</span>
<a href="#l6.1054"></a><span id="l6.1054" class="difflineminus">-        )                         # section name close</span>
<a href="#l6.1055"></a><span id="l6.1055" class="difflineminus">-        ((?:\s*\])+)              # 4: section marker close</span>
<a href="#l6.1056"></a><span id="l6.1056" class="difflineminus">-        \s*(\#.*)?                # 5: optional comment</span>
<a href="#l6.1057"></a><span id="l6.1057" class="difflineminus">-        $''',</span>
<a href="#l6.1058"></a><span id="l6.1058" class="difflineminus">-        re.VERBOSE)</span>
<a href="#l6.1059"></a><span id="l6.1059" class="difflineminus">-</span>
<a href="#l6.1060"></a><span id="l6.1060" class="difflineminus">-    # this regexp pulls list values out as a single string</span>
<a href="#l6.1061"></a><span id="l6.1061" class="difflineminus">-    # or single values and comments</span>
<a href="#l6.1062"></a><span id="l6.1062" class="difflineminus">-    # FIXME: this regex adds a '' to the end of comma terminated lists</span>
<a href="#l6.1063"></a><span id="l6.1063" class="difflineminus">-    #   workaround in ``_handle_value``</span>
<a href="#l6.1064"></a><span id="l6.1064" class="difflineminus">-    _valueexp = re.compile(r'''^</span>
<a href="#l6.1065"></a><span id="l6.1065" class="difflineminus">-        (?:</span>
<a href="#l6.1066"></a><span id="l6.1066" class="difflineminus">-            (?:</span>
<a href="#l6.1067"></a><span id="l6.1067" class="difflineminus">-                (</span>
<a href="#l6.1068"></a><span id="l6.1068" class="difflineminus">-                    (?:</span>
<a href="#l6.1069"></a><span id="l6.1069" class="difflineminus">-                        (?:</span>
<a href="#l6.1070"></a><span id="l6.1070" class="difflineminus">-                            (?:&quot;.*?&quot;)|              # double quotes</span>
<a href="#l6.1071"></a><span id="l6.1071" class="difflineminus">-                            (?:'.*?')|              # single quotes</span>
<a href="#l6.1072"></a><span id="l6.1072" class="difflineminus">-                            (?:[^'&quot;,\#][^,\#]*?)    # unquoted</span>
<a href="#l6.1073"></a><span id="l6.1073" class="difflineminus">-                        )</span>
<a href="#l6.1074"></a><span id="l6.1074" class="difflineminus">-                        \s*,\s*                     # comma</span>
<a href="#l6.1075"></a><span id="l6.1075" class="difflineminus">-                    )*      # match all list items ending in a comma (if any)</span>
<a href="#l6.1076"></a><span id="l6.1076" class="difflineminus">-                )</span>
<a href="#l6.1077"></a><span id="l6.1077" class="difflineminus">-                (</span>
<a href="#l6.1078"></a><span id="l6.1078" class="difflineminus">-                    (?:&quot;.*?&quot;)|                      # double quotes</span>
<a href="#l6.1079"></a><span id="l6.1079" class="difflineminus">-                    (?:'.*?')|                      # single quotes</span>
<a href="#l6.1080"></a><span id="l6.1080" class="difflineminus">-                    (?:[^'&quot;,\#\s][^,]*?)|           # unquoted</span>
<a href="#l6.1081"></a><span id="l6.1081" class="difflineminus">-                    (?:(?&lt;!,))                      # Empty value</span>
<a href="#l6.1082"></a><span id="l6.1082" class="difflineminus">-                )?          # last item in a list - or string value</span>
<a href="#l6.1083"></a><span id="l6.1083" class="difflineminus">-            )|</span>
<a href="#l6.1084"></a><span id="l6.1084" class="difflineminus">-            (,)             # alternatively a single comma - empty list</span>
<a href="#l6.1085"></a><span id="l6.1085" class="difflineminus">-        )</span>
<a href="#l6.1086"></a><span id="l6.1086" class="difflineminus">-        \s*(\#.*)?          # optional comment</span>
<a href="#l6.1087"></a><span id="l6.1087" class="difflineminus">-        $''',</span>
<a href="#l6.1088"></a><span id="l6.1088" class="difflineminus">-        re.VERBOSE)</span>
<a href="#l6.1089"></a><span id="l6.1089" class="difflineminus">-</span>
<a href="#l6.1090"></a><span id="l6.1090" class="difflineminus">-    # use findall to get the members of a list value</span>
<a href="#l6.1091"></a><span id="l6.1091" class="difflineminus">-    _listvalueexp = re.compile(r'''</span>
<a href="#l6.1092"></a><span id="l6.1092" class="difflineminus">-        (</span>
<a href="#l6.1093"></a><span id="l6.1093" class="difflineminus">-            (?:&quot;.*?&quot;)|          # double quotes</span>
<a href="#l6.1094"></a><span id="l6.1094" class="difflineminus">-            (?:'.*?')|          # single quotes</span>
<a href="#l6.1095"></a><span id="l6.1095" class="difflineminus">-            (?:[^'&quot;,\#].*?)       # unquoted</span>
<a href="#l6.1096"></a><span id="l6.1096" class="difflineminus">-        )</span>
<a href="#l6.1097"></a><span id="l6.1097" class="difflineminus">-        \s*,\s*                 # comma</span>
<a href="#l6.1098"></a><span id="l6.1098" class="difflineminus">-        ''',</span>
<a href="#l6.1099"></a><span id="l6.1099" class="difflineminus">-        re.VERBOSE)</span>
<a href="#l6.1100"></a><span id="l6.1100" class="difflineminus">-</span>
<a href="#l6.1101"></a><span id="l6.1101" class="difflineminus">-    # this regexp is used for the value</span>
<a href="#l6.1102"></a><span id="l6.1102" class="difflineminus">-    # when lists are switched off</span>
<a href="#l6.1103"></a><span id="l6.1103" class="difflineminus">-    _nolistvalue = re.compile(r'''^</span>
<a href="#l6.1104"></a><span id="l6.1104" class="difflineminus">-        (</span>
<a href="#l6.1105"></a><span id="l6.1105" class="difflineminus">-            (?:&quot;.*?&quot;)|          # double quotes</span>
<a href="#l6.1106"></a><span id="l6.1106" class="difflineminus">-            (?:'.*?')|          # single quotes</span>
<a href="#l6.1107"></a><span id="l6.1107" class="difflineminus">-            (?:[^'&quot;\#].*?)|     # unquoted</span>
<a href="#l6.1108"></a><span id="l6.1108" class="difflineminus">-            (?:)                # Empty value</span>
<a href="#l6.1109"></a><span id="l6.1109" class="difflineminus">-        )</span>
<a href="#l6.1110"></a><span id="l6.1110" class="difflineminus">-        \s*(\#.*)?              # optional comment</span>
<a href="#l6.1111"></a><span id="l6.1111" class="difflineminus">-        $''',</span>
<a href="#l6.1112"></a><span id="l6.1112" class="difflineminus">-        re.VERBOSE)</span>
<a href="#l6.1113"></a><span id="l6.1113" class="difflineminus">-</span>
<a href="#l6.1114"></a><span id="l6.1114" class="difflineminus">-    # regexes for finding triple quoted values on one line</span>
<a href="#l6.1115"></a><span id="l6.1115" class="difflineminus">-    _single_line_single = re.compile(r&quot;^'''(.*?)'''\s*(#.*)?$&quot;)</span>
<a href="#l6.1116"></a><span id="l6.1116" class="difflineminus">-    _single_line_double = re.compile(r'^&quot;&quot;&quot;(.*?)&quot;&quot;&quot;\s*(#.*)?$')</span>
<a href="#l6.1117"></a><span id="l6.1117" class="difflineminus">-    _multi_line_single = re.compile(r&quot;^(.*?)'''\s*(#.*)?$&quot;)</span>
<a href="#l6.1118"></a><span id="l6.1118" class="difflineminus">-    _multi_line_double = re.compile(r'^(.*?)&quot;&quot;&quot;\s*(#.*)?$')</span>
<a href="#l6.1119"></a><span id="l6.1119" class="difflineminus">-</span>
<a href="#l6.1120"></a><span id="l6.1120" class="difflineminus">-    _triple_quote = {</span>
<a href="#l6.1121"></a><span id="l6.1121" class="difflineminus">-        &quot;'''&quot;: (_single_line_single, _multi_line_single),</span>
<a href="#l6.1122"></a><span id="l6.1122" class="difflineminus">-        '&quot;&quot;&quot;': (_single_line_double, _multi_line_double),</span>
<a href="#l6.1123"></a><span id="l6.1123" class="difflineminus">-    }</span>
<a href="#l6.1124"></a><span id="l6.1124" class="difflineminus">-</span>
<a href="#l6.1125"></a><span id="l6.1125" class="difflineminus">-    # Used by the ``istrue`` Section method</span>
<a href="#l6.1126"></a><span id="l6.1126" class="difflineminus">-    _bools = {</span>
<a href="#l6.1127"></a><span id="l6.1127" class="difflineminus">-        'yes': True, 'no': False,</span>
<a href="#l6.1128"></a><span id="l6.1128" class="difflineminus">-        'on': True, 'off': False,</span>
<a href="#l6.1129"></a><span id="l6.1129" class="difflineminus">-        '1': True, '0': False,</span>
<a href="#l6.1130"></a><span id="l6.1130" class="difflineminus">-        'true': True, 'false': False,</span>
<a href="#l6.1131"></a><span id="l6.1131" class="difflineminus">-        }</span>
<a href="#l6.1132"></a><span id="l6.1132" class="difflineminus">-</span>
<a href="#l6.1133"></a><span id="l6.1133" class="difflineminus">-    def __init__(self, infile=None, options=None, **kwargs):</span>
<a href="#l6.1134"></a><span id="l6.1134" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1135"></a><span id="l6.1135" class="difflineminus">-        Parse or create a config file object.</span>
<a href="#l6.1136"></a><span id="l6.1136" class="difflineminus">-        </span>
<a href="#l6.1137"></a><span id="l6.1137" class="difflineminus">-        ``ConfigObj(infile=None, options=None, **kwargs)``</span>
<a href="#l6.1138"></a><span id="l6.1138" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1139"></a><span id="l6.1139" class="difflineminus">-        if infile is None:</span>
<a href="#l6.1140"></a><span id="l6.1140" class="difflineminus">-            infile = []</span>
<a href="#l6.1141"></a><span id="l6.1141" class="difflineminus">-        if options is None:</span>
<a href="#l6.1142"></a><span id="l6.1142" class="difflineminus">-            options = {}</span>
<a href="#l6.1143"></a><span id="l6.1143" class="difflineminus">-        else:</span>
<a href="#l6.1144"></a><span id="l6.1144" class="difflineminus">-            options = dict(options)</span>
<a href="#l6.1145"></a><span id="l6.1145" class="difflineminus">-        # keyword arguments take precedence over an options dictionary</span>
<a href="#l6.1146"></a><span id="l6.1146" class="difflineminus">-        options.update(kwargs)</span>
<a href="#l6.1147"></a><span id="l6.1147" class="difflineminus">-        # init the superclass</span>
<a href="#l6.1148"></a><span id="l6.1148" class="difflineminus">-        Section.__init__(self, self, 0, self)</span>
<a href="#l6.1149"></a><span id="l6.1149" class="difflineminus">-        #</span>
<a href="#l6.1150"></a><span id="l6.1150" class="difflineminus">-        defaults = OPTION_DEFAULTS.copy()</span>
<a href="#l6.1151"></a><span id="l6.1151" class="difflineminus">-        for entry in options.keys():</span>
<a href="#l6.1152"></a><span id="l6.1152" class="difflineminus">-            if entry not in defaults.keys():</span>
<a href="#l6.1153"></a><span id="l6.1153" class="difflineminus">-                raise TypeError, 'Unrecognised option &quot;%s&quot;.' % entry</span>
<a href="#l6.1154"></a><span id="l6.1154" class="difflineminus">-        # TODO: check the values too.</span>
<a href="#l6.1155"></a><span id="l6.1155" class="difflineminus">-        #</span>
<a href="#l6.1156"></a><span id="l6.1156" class="difflineminus">-        # Add any explicit options to the defaults</span>
<a href="#l6.1157"></a><span id="l6.1157" class="difflineminus">-        defaults.update(options)</span>
<a href="#l6.1158"></a><span id="l6.1158" class="difflineminus">-        #</span>
<a href="#l6.1159"></a><span id="l6.1159" class="difflineminus">-        # initialise a few variables</span>
<a href="#l6.1160"></a><span id="l6.1160" class="difflineminus">-        self.filename = None</span>
<a href="#l6.1161"></a><span id="l6.1161" class="difflineminus">-        self._errors = []</span>
<a href="#l6.1162"></a><span id="l6.1162" class="difflineminus">-        self.raise_errors = defaults['raise_errors']</span>
<a href="#l6.1163"></a><span id="l6.1163" class="difflineminus">-        self.interpolation = defaults['interpolation']</span>
<a href="#l6.1164"></a><span id="l6.1164" class="difflineminus">-        self.list_values = defaults['list_values']</span>
<a href="#l6.1165"></a><span id="l6.1165" class="difflineminus">-        self.create_empty = defaults['create_empty']</span>
<a href="#l6.1166"></a><span id="l6.1166" class="difflineminus">-        self.file_error = defaults['file_error']</span>
<a href="#l6.1167"></a><span id="l6.1167" class="difflineminus">-        self.stringify = defaults['stringify']</span>
<a href="#l6.1168"></a><span id="l6.1168" class="difflineminus">-        self.indent_type = defaults['indent_type']</span>
<a href="#l6.1169"></a><span id="l6.1169" class="difflineminus">-        self.encoding = defaults['encoding']</span>
<a href="#l6.1170"></a><span id="l6.1170" class="difflineminus">-        self.default_encoding = defaults['default_encoding']</span>
<a href="#l6.1171"></a><span id="l6.1171" class="difflineminus">-        self.BOM = False</span>
<a href="#l6.1172"></a><span id="l6.1172" class="difflineminus">-        self.newlines = None</span>
<a href="#l6.1173"></a><span id="l6.1173" class="difflineminus">-        self.write_empty_values = defaults['write_empty_values']</span>
<a href="#l6.1174"></a><span id="l6.1174" class="difflineminus">-        self.unrepr = defaults['unrepr']</span>
<a href="#l6.1175"></a><span id="l6.1175" class="difflineminus">-        #</span>
<a href="#l6.1176"></a><span id="l6.1176" class="difflineminus">-        self.initial_comment = []</span>
<a href="#l6.1177"></a><span id="l6.1177" class="difflineminus">-        self.final_comment = []</span>
<a href="#l6.1178"></a><span id="l6.1178" class="difflineminus">-        #</span>
<a href="#l6.1179"></a><span id="l6.1179" class="difflineminus">-        self._terminated = False</span>
<a href="#l6.1180"></a><span id="l6.1180" class="difflineminus">-        #</span>
<a href="#l6.1181"></a><span id="l6.1181" class="difflineminus">-        if isinstance(infile, StringTypes):</span>
<a href="#l6.1182"></a><span id="l6.1182" class="difflineminus">-            self.filename = infile</span>
<a href="#l6.1183"></a><span id="l6.1183" class="difflineminus">-            if os.path.isfile(infile):</span>
<a href="#l6.1184"></a><span id="l6.1184" class="difflineminus">-                infile = open(infile).read() or []</span>
<a href="#l6.1185"></a><span id="l6.1185" class="difflineminus">-            elif self.file_error:</span>
<a href="#l6.1186"></a><span id="l6.1186" class="difflineminus">-                # raise an error if the file doesn't exist</span>
<a href="#l6.1187"></a><span id="l6.1187" class="difflineminus">-                raise IOError, 'Config file not found: &quot;%s&quot;.' % self.filename</span>
<a href="#l6.1188"></a><span id="l6.1188" class="difflineminus">-            else:</span>
<a href="#l6.1189"></a><span id="l6.1189" class="difflineminus">-                # file doesn't already exist</span>
<a href="#l6.1190"></a><span id="l6.1190" class="difflineminus">-                if self.create_empty:</span>
<a href="#l6.1191"></a><span id="l6.1191" class="difflineminus">-                    # this is a good test that the filename specified</span>
<a href="#l6.1192"></a><span id="l6.1192" class="difflineminus">-                    # isn't impossible - like on a non existent device</span>
<a href="#l6.1193"></a><span id="l6.1193" class="difflineminus">-                    h = open(infile, 'w')</span>
<a href="#l6.1194"></a><span id="l6.1194" class="difflineminus">-                    h.write('')</span>
<a href="#l6.1195"></a><span id="l6.1195" class="difflineminus">-                    h.close()</span>
<a href="#l6.1196"></a><span id="l6.1196" class="difflineminus">-                infile = []</span>
<a href="#l6.1197"></a><span id="l6.1197" class="difflineminus">-        elif isinstance(infile, (list, tuple)):</span>
<a href="#l6.1198"></a><span id="l6.1198" class="difflineminus">-            infile = list(infile)</span>
<a href="#l6.1199"></a><span id="l6.1199" class="difflineminus">-        elif isinstance(infile, dict):</span>
<a href="#l6.1200"></a><span id="l6.1200" class="difflineminus">-            # initialise self</span>
<a href="#l6.1201"></a><span id="l6.1201" class="difflineminus">-            # the Section class handles creating subsections</span>
<a href="#l6.1202"></a><span id="l6.1202" class="difflineminus">-            if isinstance(infile, ConfigObj):</span>
<a href="#l6.1203"></a><span id="l6.1203" class="difflineminus">-                # get a copy of our ConfigObj</span>
<a href="#l6.1204"></a><span id="l6.1204" class="difflineminus">-                infile = infile.dict()</span>
<a href="#l6.1205"></a><span id="l6.1205" class="difflineminus">-            for entry in infile:</span>
<a href="#l6.1206"></a><span id="l6.1206" class="difflineminus">-                self[entry] = infile[entry]</span>
<a href="#l6.1207"></a><span id="l6.1207" class="difflineminus">-            del self._errors</span>
<a href="#l6.1208"></a><span id="l6.1208" class="difflineminus">-            if defaults['configspec'] is not None:</span>
<a href="#l6.1209"></a><span id="l6.1209" class="difflineminus">-                self._handle_configspec(defaults['configspec'])</span>
<a href="#l6.1210"></a><span id="l6.1210" class="difflineminus">-            else:</span>
<a href="#l6.1211"></a><span id="l6.1211" class="difflineminus">-                self.configspec = None</span>
<a href="#l6.1212"></a><span id="l6.1212" class="difflineminus">-            return</span>
<a href="#l6.1213"></a><span id="l6.1213" class="difflineminus">-        elif hasattr(infile, 'read'):</span>
<a href="#l6.1214"></a><span id="l6.1214" class="difflineminus">-            # This supports file like objects</span>
<a href="#l6.1215"></a><span id="l6.1215" class="difflineminus">-            infile = infile.read() or []</span>
<a href="#l6.1216"></a><span id="l6.1216" class="difflineminus">-            # needs splitting into lines - but needs doing *after* decoding</span>
<a href="#l6.1217"></a><span id="l6.1217" class="difflineminus">-            # in case it's not an 8 bit encoding</span>
<a href="#l6.1218"></a><span id="l6.1218" class="difflineminus">-        else:</span>
<a href="#l6.1219"></a><span id="l6.1219" class="difflineminus">-            raise TypeError, ('infile must be a filename,'</span>
<a href="#l6.1220"></a><span id="l6.1220" class="difflineminus">-                ' file like object, or list of lines.')</span>
<a href="#l6.1221"></a><span id="l6.1221" class="difflineminus">-        #</span>
<a href="#l6.1222"></a><span id="l6.1222" class="difflineminus">-        if infile:</span>
<a href="#l6.1223"></a><span id="l6.1223" class="difflineminus">-            # don't do it for the empty ConfigObj</span>
<a href="#l6.1224"></a><span id="l6.1224" class="difflineminus">-            infile = self._handle_bom(infile)</span>
<a href="#l6.1225"></a><span id="l6.1225" class="difflineminus">-            # infile is now *always* a list</span>
<a href="#l6.1226"></a><span id="l6.1226" class="difflineminus">-            #</span>
<a href="#l6.1227"></a><span id="l6.1227" class="difflineminus">-            # Set the newlines attribute (first line ending it finds)</span>
<a href="#l6.1228"></a><span id="l6.1228" class="difflineminus">-            # and strip trailing '\n' or '\r' from lines</span>
<a href="#l6.1229"></a><span id="l6.1229" class="difflineminus">-            for line in infile:</span>
<a href="#l6.1230"></a><span id="l6.1230" class="difflineminus">-                if (not line) or (line[-1] not in ('\r', '\n', '\r\n')):</span>
<a href="#l6.1231"></a><span id="l6.1231" class="difflineminus">-                    continue</span>
<a href="#l6.1232"></a><span id="l6.1232" class="difflineminus">-                for end in ('\r\n', '\n', '\r'):</span>
<a href="#l6.1233"></a><span id="l6.1233" class="difflineminus">-                    if line.endswith(end):</span>
<a href="#l6.1234"></a><span id="l6.1234" class="difflineminus">-                        self.newlines = end</span>
<a href="#l6.1235"></a><span id="l6.1235" class="difflineminus">-                        break</span>
<a href="#l6.1236"></a><span id="l6.1236" class="difflineminus">-                break</span>
<a href="#l6.1237"></a><span id="l6.1237" class="difflineminus">-            if infile[-1] and infile[-1] in ('\r', '\n', '\r\n'):</span>
<a href="#l6.1238"></a><span id="l6.1238" class="difflineminus">-                self._terminated = True</span>
<a href="#l6.1239"></a><span id="l6.1239" class="difflineminus">-            infile = [line.rstrip('\r\n') for line in infile]</span>
<a href="#l6.1240"></a><span id="l6.1240" class="difflineminus">-        #</span>
<a href="#l6.1241"></a><span id="l6.1241" class="difflineminus">-        self._parse(infile)</span>
<a href="#l6.1242"></a><span id="l6.1242" class="difflineminus">-        # if we had any errors, now is the time to raise them</span>
<a href="#l6.1243"></a><span id="l6.1243" class="difflineminus">-        if self._errors:</span>
<a href="#l6.1244"></a><span id="l6.1244" class="difflineminus">-            info = &quot;at line %s.&quot; % self._errors[0].line_number</span>
<a href="#l6.1245"></a><span id="l6.1245" class="difflineminus">-            if len(self._errors) &gt; 1:</span>
<a href="#l6.1246"></a><span id="l6.1246" class="difflineminus">-                msg = (&quot;Parsing failed with several errors.\nFirst error %s&quot; %</span>
<a href="#l6.1247"></a><span id="l6.1247" class="difflineminus">-                    info)</span>
<a href="#l6.1248"></a><span id="l6.1248" class="difflineminus">-                error = ConfigObjError(msg)</span>
<a href="#l6.1249"></a><span id="l6.1249" class="difflineminus">-            else:</span>
<a href="#l6.1250"></a><span id="l6.1250" class="difflineminus">-                error = self._errors[0]</span>
<a href="#l6.1251"></a><span id="l6.1251" class="difflineminus">-            # set the errors attribute; it's a list of tuples:</span>
<a href="#l6.1252"></a><span id="l6.1252" class="difflineminus">-            # (error_type, message, line_number)</span>
<a href="#l6.1253"></a><span id="l6.1253" class="difflineminus">-            error.errors = self._errors</span>
<a href="#l6.1254"></a><span id="l6.1254" class="difflineminus">-            # set the config attribute</span>
<a href="#l6.1255"></a><span id="l6.1255" class="difflineminus">-            error.config = self</span>
<a href="#l6.1256"></a><span id="l6.1256" class="difflineminus">-            raise error</span>
<a href="#l6.1257"></a><span id="l6.1257" class="difflineminus">-        # delete private attributes</span>
<a href="#l6.1258"></a><span id="l6.1258" class="difflineminus">-        del self._errors</span>
<a href="#l6.1259"></a><span id="l6.1259" class="difflineminus">-        #</span>
<a href="#l6.1260"></a><span id="l6.1260" class="difflineminus">-        if defaults['configspec'] is None:</span>
<a href="#l6.1261"></a><span id="l6.1261" class="difflineminus">-            self.configspec = None</span>
<a href="#l6.1262"></a><span id="l6.1262" class="difflineminus">-        else:</span>
<a href="#l6.1263"></a><span id="l6.1263" class="difflineminus">-            self._handle_configspec(defaults['configspec'])</span>
<a href="#l6.1264"></a><span id="l6.1264" class="difflineminus">-    </span>
<a href="#l6.1265"></a><span id="l6.1265" class="difflineminus">-    def __repr__(self):</span>
<a href="#l6.1266"></a><span id="l6.1266" class="difflineminus">-        return 'ConfigObj({%s})' % ', '.join(</span>
<a href="#l6.1267"></a><span id="l6.1267" class="difflineminus">-            [('%s: %s' % (repr(key), repr(self[key]))) for key in</span>
<a href="#l6.1268"></a><span id="l6.1268" class="difflineminus">-            (self.scalars + self.sections)])</span>
<a href="#l6.1269"></a><span id="l6.1269" class="difflineminus">-    </span>
<a href="#l6.1270"></a><span id="l6.1270" class="difflineminus">-    def _handle_bom(self, infile):</span>
<a href="#l6.1271"></a><span id="l6.1271" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1272"></a><span id="l6.1272" class="difflineminus">-        Handle any BOM, and decode if necessary.</span>
<a href="#l6.1273"></a><span id="l6.1273" class="difflineminus">-        </span>
<a href="#l6.1274"></a><span id="l6.1274" class="difflineminus">-        If an encoding is specified, that *must* be used - but the BOM should</span>
<a href="#l6.1275"></a><span id="l6.1275" class="difflineminus">-        still be removed (and the BOM attribute set).</span>
<a href="#l6.1276"></a><span id="l6.1276" class="difflineminus">-        </span>
<a href="#l6.1277"></a><span id="l6.1277" class="difflineminus">-        (If the encoding is wrongly specified, then a BOM for an alternative</span>
<a href="#l6.1278"></a><span id="l6.1278" class="difflineminus">-        encoding won't be discovered or removed.)</span>
<a href="#l6.1279"></a><span id="l6.1279" class="difflineminus">-        </span>
<a href="#l6.1280"></a><span id="l6.1280" class="difflineminus">-        If an encoding is not specified, UTF8 or UTF16 BOM will be detected and</span>
<a href="#l6.1281"></a><span id="l6.1281" class="difflineminus">-        removed. The BOM attribute will be set. UTF16 will be decoded to</span>
<a href="#l6.1282"></a><span id="l6.1282" class="difflineminus">-        unicode.</span>
<a href="#l6.1283"></a><span id="l6.1283" class="difflineminus">-        </span>
<a href="#l6.1284"></a><span id="l6.1284" class="difflineminus">-        NOTE: This method must not be called with an empty ``infile``.</span>
<a href="#l6.1285"></a><span id="l6.1285" class="difflineminus">-        </span>
<a href="#l6.1286"></a><span id="l6.1286" class="difflineminus">-        Specifying the *wrong* encoding is likely to cause a</span>
<a href="#l6.1287"></a><span id="l6.1287" class="difflineminus">-        ``UnicodeDecodeError``.</span>
<a href="#l6.1288"></a><span id="l6.1288" class="difflineminus">-        </span>
<a href="#l6.1289"></a><span id="l6.1289" class="difflineminus">-        ``infile`` must always be returned as a list of lines, but may be</span>
<a href="#l6.1290"></a><span id="l6.1290" class="difflineminus">-        passed in as a single string.</span>
<a href="#l6.1291"></a><span id="l6.1291" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1292"></a><span id="l6.1292" class="difflineminus">-        if ((self.encoding is not None) and</span>
<a href="#l6.1293"></a><span id="l6.1293" class="difflineminus">-            (self.encoding.lower() not in BOM_LIST)):</span>
<a href="#l6.1294"></a><span id="l6.1294" class="difflineminus">-            # No need to check for a BOM</span>
<a href="#l6.1295"></a><span id="l6.1295" class="difflineminus">-            # the encoding specified doesn't have one</span>
<a href="#l6.1296"></a><span id="l6.1296" class="difflineminus">-            # just decode</span>
<a href="#l6.1297"></a><span id="l6.1297" class="difflineminus">-            return self._decode(infile, self.encoding)</span>
<a href="#l6.1298"></a><span id="l6.1298" class="difflineminus">-        #</span>
<a href="#l6.1299"></a><span id="l6.1299" class="difflineminus">-        if isinstance(infile, (list, tuple)):</span>
<a href="#l6.1300"></a><span id="l6.1300" class="difflineminus">-            line = infile[0]</span>
<a href="#l6.1301"></a><span id="l6.1301" class="difflineminus">-        else:</span>
<a href="#l6.1302"></a><span id="l6.1302" class="difflineminus">-            line = infile</span>
<a href="#l6.1303"></a><span id="l6.1303" class="difflineminus">-        if self.encoding is not None:</span>
<a href="#l6.1304"></a><span id="l6.1304" class="difflineminus">-            # encoding explicitly supplied</span>
<a href="#l6.1305"></a><span id="l6.1305" class="difflineminus">-            # And it could have an associated BOM</span>
<a href="#l6.1306"></a><span id="l6.1306" class="difflineminus">-            # TODO: if encoding is just UTF16 - we ought to check for both</span>
<a href="#l6.1307"></a><span id="l6.1307" class="difflineminus">-            # TODO: big endian and little endian versions.</span>
<a href="#l6.1308"></a><span id="l6.1308" class="difflineminus">-            enc = BOM_LIST[self.encoding.lower()]</span>
<a href="#l6.1309"></a><span id="l6.1309" class="difflineminus">-            if enc == 'utf_16':</span>
<a href="#l6.1310"></a><span id="l6.1310" class="difflineminus">-                # For UTF16 we try big endian and little endian</span>
<a href="#l6.1311"></a><span id="l6.1311" class="difflineminus">-                for BOM, (encoding, final_encoding) in BOMS.items():</span>
<a href="#l6.1312"></a><span id="l6.1312" class="difflineminus">-                    if not final_encoding:</span>
<a href="#l6.1313"></a><span id="l6.1313" class="difflineminus">-                        # skip UTF8</span>
<a href="#l6.1314"></a><span id="l6.1314" class="difflineminus">-                        continue</span>
<a href="#l6.1315"></a><span id="l6.1315" class="difflineminus">-                    if infile.startswith(BOM):</span>
<a href="#l6.1316"></a><span id="l6.1316" class="difflineminus">-                        ### BOM discovered</span>
<a href="#l6.1317"></a><span id="l6.1317" class="difflineminus">-                        ##self.BOM = True</span>
<a href="#l6.1318"></a><span id="l6.1318" class="difflineminus">-                        # Don't need to remove BOM</span>
<a href="#l6.1319"></a><span id="l6.1319" class="difflineminus">-                        return self._decode(infile, encoding)</span>
<a href="#l6.1320"></a><span id="l6.1320" class="difflineminus">-                #</span>
<a href="#l6.1321"></a><span id="l6.1321" class="difflineminus">-                # If we get this far, will *probably* raise a DecodeError</span>
<a href="#l6.1322"></a><span id="l6.1322" class="difflineminus">-                # As it doesn't appear to start with a BOM</span>
<a href="#l6.1323"></a><span id="l6.1323" class="difflineminus">-                return self._decode(infile, self.encoding)</span>
<a href="#l6.1324"></a><span id="l6.1324" class="difflineminus">-            #</span>
<a href="#l6.1325"></a><span id="l6.1325" class="difflineminus">-            # Must be UTF8</span>
<a href="#l6.1326"></a><span id="l6.1326" class="difflineminus">-            BOM = BOM_SET[enc]</span>
<a href="#l6.1327"></a><span id="l6.1327" class="difflineminus">-            if not line.startswith(BOM):</span>
<a href="#l6.1328"></a><span id="l6.1328" class="difflineminus">-                return self._decode(infile, self.encoding)</span>
<a href="#l6.1329"></a><span id="l6.1329" class="difflineminus">-            #</span>
<a href="#l6.1330"></a><span id="l6.1330" class="difflineminus">-            newline = line[len(BOM):]</span>
<a href="#l6.1331"></a><span id="l6.1331" class="difflineminus">-            #</span>
<a href="#l6.1332"></a><span id="l6.1332" class="difflineminus">-            # BOM removed</span>
<a href="#l6.1333"></a><span id="l6.1333" class="difflineminus">-            if isinstance(infile, (list, tuple)):</span>
<a href="#l6.1334"></a><span id="l6.1334" class="difflineminus">-                infile[0] = newline</span>
<a href="#l6.1335"></a><span id="l6.1335" class="difflineminus">-            else:</span>
<a href="#l6.1336"></a><span id="l6.1336" class="difflineminus">-                infile = newline</span>
<a href="#l6.1337"></a><span id="l6.1337" class="difflineminus">-            self.BOM = True</span>
<a href="#l6.1338"></a><span id="l6.1338" class="difflineminus">-            return self._decode(infile, self.encoding)</span>
<a href="#l6.1339"></a><span id="l6.1339" class="difflineminus">-        #</span>
<a href="#l6.1340"></a><span id="l6.1340" class="difflineminus">-        # No encoding specified - so we need to check for UTF8/UTF16</span>
<a href="#l6.1341"></a><span id="l6.1341" class="difflineminus">-        for BOM, (encoding, final_encoding) in BOMS.items():</span>
<a href="#l6.1342"></a><span id="l6.1342" class="difflineminus">-            if not line.startswith(BOM):</span>
<a href="#l6.1343"></a><span id="l6.1343" class="difflineminus">-                continue</span>
<a href="#l6.1344"></a><span id="l6.1344" class="difflineminus">-            else:</span>
<a href="#l6.1345"></a><span id="l6.1345" class="difflineminus">-                # BOM discovered</span>
<a href="#l6.1346"></a><span id="l6.1346" class="difflineminus">-                self.encoding = final_encoding</span>
<a href="#l6.1347"></a><span id="l6.1347" class="difflineminus">-                if not final_encoding:</span>
<a href="#l6.1348"></a><span id="l6.1348" class="difflineminus">-                    self.BOM = True</span>
<a href="#l6.1349"></a><span id="l6.1349" class="difflineminus">-                    # UTF8</span>
<a href="#l6.1350"></a><span id="l6.1350" class="difflineminus">-                    # remove BOM</span>
<a href="#l6.1351"></a><span id="l6.1351" class="difflineminus">-                    newline = line[len(BOM):]</span>
<a href="#l6.1352"></a><span id="l6.1352" class="difflineminus">-                    if isinstance(infile, (list, tuple)):</span>
<a href="#l6.1353"></a><span id="l6.1353" class="difflineminus">-                        infile[0] = newline</span>
<a href="#l6.1354"></a><span id="l6.1354" class="difflineminus">-                    else:</span>
<a href="#l6.1355"></a><span id="l6.1355" class="difflineminus">-                        infile = newline</span>
<a href="#l6.1356"></a><span id="l6.1356" class="difflineminus">-                    # UTF8 - don't decode</span>
<a href="#l6.1357"></a><span id="l6.1357" class="difflineminus">-                    if isinstance(infile, StringTypes):</span>
<a href="#l6.1358"></a><span id="l6.1358" class="difflineminus">-                        return infile.splitlines(True)</span>
<a href="#l6.1359"></a><span id="l6.1359" class="difflineminus">-                    else:</span>
<a href="#l6.1360"></a><span id="l6.1360" class="difflineminus">-                        return infile</span>
<a href="#l6.1361"></a><span id="l6.1361" class="difflineminus">-                # UTF16 - have to decode</span>
<a href="#l6.1362"></a><span id="l6.1362" class="difflineminus">-                return self._decode(infile, encoding)</span>
<a href="#l6.1363"></a><span id="l6.1363" class="difflineminus">-        #</span>
<a href="#l6.1364"></a><span id="l6.1364" class="difflineminus">-        # No BOM discovered and no encoding specified, just return</span>
<a href="#l6.1365"></a><span id="l6.1365" class="difflineminus">-        if isinstance(infile, StringTypes):</span>
<a href="#l6.1366"></a><span id="l6.1366" class="difflineminus">-            # infile read from a file will be a single string</span>
<a href="#l6.1367"></a><span id="l6.1367" class="difflineminus">-            return infile.splitlines(True)</span>
<a href="#l6.1368"></a><span id="l6.1368" class="difflineminus">-        else:</span>
<a href="#l6.1369"></a><span id="l6.1369" class="difflineminus">-            return infile</span>
<a href="#l6.1370"></a><span id="l6.1370" class="difflineminus">-</span>
<a href="#l6.1371"></a><span id="l6.1371" class="difflineminus">-    def _a_to_u(self, aString):</span>
<a href="#l6.1372"></a><span id="l6.1372" class="difflineminus">-        &quot;&quot;&quot;Decode ASCII strings to unicode if a self.encoding is specified.&quot;&quot;&quot;</span>
<a href="#l6.1373"></a><span id="l6.1373" class="difflineminus">-        if self.encoding:</span>
<a href="#l6.1374"></a><span id="l6.1374" class="difflineminus">-            return aString.decode('ascii')</span>
<a href="#l6.1375"></a><span id="l6.1375" class="difflineminus">-        else:</span>
<a href="#l6.1376"></a><span id="l6.1376" class="difflineminus">-            return aString</span>
<a href="#l6.1377"></a><span id="l6.1377" class="difflineminus">-</span>
<a href="#l6.1378"></a><span id="l6.1378" class="difflineminus">-    def _decode(self, infile, encoding):</span>
<a href="#l6.1379"></a><span id="l6.1379" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1380"></a><span id="l6.1380" class="difflineminus">-        Decode infile to unicode. Using the specified encoding.</span>
<a href="#l6.1381"></a><span id="l6.1381" class="difflineminus">-        </span>
<a href="#l6.1382"></a><span id="l6.1382" class="difflineminus">-        if is a string, it also needs converting to a list.</span>
<a href="#l6.1383"></a><span id="l6.1383" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1384"></a><span id="l6.1384" class="difflineminus">-        if isinstance(infile, StringTypes):</span>
<a href="#l6.1385"></a><span id="l6.1385" class="difflineminus">-            # can't be unicode</span>
<a href="#l6.1386"></a><span id="l6.1386" class="difflineminus">-            # NOTE: Could raise a ``UnicodeDecodeError``</span>
<a href="#l6.1387"></a><span id="l6.1387" class="difflineminus">-            return infile.decode(encoding).splitlines(True)</span>
<a href="#l6.1388"></a><span id="l6.1388" class="difflineminus">-        for i, line in enumerate(infile):</span>
<a href="#l6.1389"></a><span id="l6.1389" class="difflineminus">-            if not isinstance(line, unicode):</span>
<a href="#l6.1390"></a><span id="l6.1390" class="difflineminus">-                # NOTE: The isinstance test here handles mixed lists of unicode/string</span>
<a href="#l6.1391"></a><span id="l6.1391" class="difflineminus">-                # NOTE: But the decode will break on any non-string values</span>
<a href="#l6.1392"></a><span id="l6.1392" class="difflineminus">-                # NOTE: Or could raise a ``UnicodeDecodeError``</span>
<a href="#l6.1393"></a><span id="l6.1393" class="difflineminus">-                infile[i] = line.decode(encoding)</span>
<a href="#l6.1394"></a><span id="l6.1394" class="difflineminus">-        return infile</span>
<a href="#l6.1395"></a><span id="l6.1395" class="difflineminus">-</span>
<a href="#l6.1396"></a><span id="l6.1396" class="difflineminus">-    def _decode_element(self, line):</span>
<a href="#l6.1397"></a><span id="l6.1397" class="difflineminus">-        &quot;&quot;&quot;Decode element to unicode if necessary.&quot;&quot;&quot;</span>
<a href="#l6.1398"></a><span id="l6.1398" class="difflineminus">-        if not self.encoding:</span>
<a href="#l6.1399"></a><span id="l6.1399" class="difflineminus">-            return line</span>
<a href="#l6.1400"></a><span id="l6.1400" class="difflineminus">-        if isinstance(line, str) and self.default_encoding:</span>
<a href="#l6.1401"></a><span id="l6.1401" class="difflineminus">-            return line.decode(self.default_encoding)</span>
<a href="#l6.1402"></a><span id="l6.1402" class="difflineminus">-        return line</span>
<a href="#l6.1403"></a><span id="l6.1403" class="difflineminus">-</span>
<a href="#l6.1404"></a><span id="l6.1404" class="difflineminus">-    def _str(self, value):</span>
<a href="#l6.1405"></a><span id="l6.1405" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1406"></a><span id="l6.1406" class="difflineminus">-        Used by ``stringify`` within validate, to turn non-string values</span>
<a href="#l6.1407"></a><span id="l6.1407" class="difflineminus">-        into strings.</span>
<a href="#l6.1408"></a><span id="l6.1408" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1409"></a><span id="l6.1409" class="difflineminus">-        if not isinstance(value, StringTypes):</span>
<a href="#l6.1410"></a><span id="l6.1410" class="difflineminus">-            return str(value)</span>
<a href="#l6.1411"></a><span id="l6.1411" class="difflineminus">-        else:</span>
<a href="#l6.1412"></a><span id="l6.1412" class="difflineminus">-            return value</span>
<a href="#l6.1413"></a><span id="l6.1413" class="difflineminus">-</span>
<a href="#l6.1414"></a><span id="l6.1414" class="difflineminus">-    def _parse(self, infile):</span>
<a href="#l6.1415"></a><span id="l6.1415" class="difflineminus">-        &quot;&quot;&quot;Actually parse the config file.&quot;&quot;&quot;</span>
<a href="#l6.1416"></a><span id="l6.1416" class="difflineminus">-        temp_list_values = self.list_values</span>
<a href="#l6.1417"></a><span id="l6.1417" class="difflineminus">-        if self.unrepr:</span>
<a href="#l6.1418"></a><span id="l6.1418" class="difflineminus">-            self.list_values = False</span>
<a href="#l6.1419"></a><span id="l6.1419" class="difflineminus">-        comment_list = []</span>
<a href="#l6.1420"></a><span id="l6.1420" class="difflineminus">-        done_start = False</span>
<a href="#l6.1421"></a><span id="l6.1421" class="difflineminus">-        this_section = self</span>
<a href="#l6.1422"></a><span id="l6.1422" class="difflineminus">-        maxline = len(infile) - 1</span>
<a href="#l6.1423"></a><span id="l6.1423" class="difflineminus">-        cur_index = -1</span>
<a href="#l6.1424"></a><span id="l6.1424" class="difflineminus">-        reset_comment = False</span>
<a href="#l6.1425"></a><span id="l6.1425" class="difflineminus">-        while cur_index &lt; maxline:</span>
<a href="#l6.1426"></a><span id="l6.1426" class="difflineminus">-            if reset_comment:</span>
<a href="#l6.1427"></a><span id="l6.1427" class="difflineminus">-                comment_list = []</span>
<a href="#l6.1428"></a><span id="l6.1428" class="difflineminus">-            cur_index += 1</span>
<a href="#l6.1429"></a><span id="l6.1429" class="difflineminus">-            line = infile[cur_index]</span>
<a href="#l6.1430"></a><span id="l6.1430" class="difflineminus">-            sline = line.strip()</span>
<a href="#l6.1431"></a><span id="l6.1431" class="difflineminus">-            # do we have anything on the line ?</span>
<a href="#l6.1432"></a><span id="l6.1432" class="difflineminus">-            if not sline or sline.startswith('#') or sline.startswith(';'):</span>
<a href="#l6.1433"></a><span id="l6.1433" class="difflineminus">-                reset_comment = False</span>
<a href="#l6.1434"></a><span id="l6.1434" class="difflineminus">-                comment_list.append(line)</span>
<a href="#l6.1435"></a><span id="l6.1435" class="difflineminus">-                continue</span>
<a href="#l6.1436"></a><span id="l6.1436" class="difflineminus">-            if not done_start:</span>
<a href="#l6.1437"></a><span id="l6.1437" class="difflineminus">-                # preserve initial comment</span>
<a href="#l6.1438"></a><span id="l6.1438" class="difflineminus">-                self.initial_comment = comment_list</span>
<a href="#l6.1439"></a><span id="l6.1439" class="difflineminus">-                comment_list = []</span>
<a href="#l6.1440"></a><span id="l6.1440" class="difflineminus">-                done_start = True</span>
<a href="#l6.1441"></a><span id="l6.1441" class="difflineminus">-            reset_comment = True</span>
<a href="#l6.1442"></a><span id="l6.1442" class="difflineminus">-            # first we check if it's a section marker</span>
<a href="#l6.1443"></a><span id="l6.1443" class="difflineminus">-            mat = self._sectionmarker.match(line)</span>
<a href="#l6.1444"></a><span id="l6.1444" class="difflineminus">-            if mat is not None:</span>
<a href="#l6.1445"></a><span id="l6.1445" class="difflineminus">-                # is a section line</span>
<a href="#l6.1446"></a><span id="l6.1446" class="difflineminus">-                (indent, sect_open, sect_name, sect_close, comment) = (</span>
<a href="#l6.1447"></a><span id="l6.1447" class="difflineminus">-                    mat.groups())</span>
<a href="#l6.1448"></a><span id="l6.1448" class="difflineminus">-                if indent and (self.indent_type is None):</span>
<a href="#l6.1449"></a><span id="l6.1449" class="difflineminus">-                    self.indent_type = indent</span>
<a href="#l6.1450"></a><span id="l6.1450" class="difflineminus">-                cur_depth = sect_open.count('[')</span>
<a href="#l6.1451"></a><span id="l6.1451" class="difflineminus">-                if cur_depth != sect_close.count(']'):</span>
<a href="#l6.1452"></a><span id="l6.1452" class="difflineminus">-                    self._handle_error(</span>
<a href="#l6.1453"></a><span id="l6.1453" class="difflineminus">-                        &quot;Cannot compute the section depth at line %s.&quot;,</span>
<a href="#l6.1454"></a><span id="l6.1454" class="difflineminus">-                        NestingError, infile, cur_index)</span>
<a href="#l6.1455"></a><span id="l6.1455" class="difflineminus">-                    continue</span>
<a href="#l6.1456"></a><span id="l6.1456" class="difflineminus">-                #</span>
<a href="#l6.1457"></a><span id="l6.1457" class="difflineminus">-                if cur_depth &lt; this_section.depth:</span>
<a href="#l6.1458"></a><span id="l6.1458" class="difflineminus">-                    # the new section is dropping back to a previous level</span>
<a href="#l6.1459"></a><span id="l6.1459" class="difflineminus">-                    try:</span>
<a href="#l6.1460"></a><span id="l6.1460" class="difflineminus">-                        parent = self._match_depth(</span>
<a href="#l6.1461"></a><span id="l6.1461" class="difflineminus">-                            this_section,</span>
<a href="#l6.1462"></a><span id="l6.1462" class="difflineminus">-                            cur_depth).parent</span>
<a href="#l6.1463"></a><span id="l6.1463" class="difflineminus">-                    except SyntaxError:</span>
<a href="#l6.1464"></a><span id="l6.1464" class="difflineminus">-                        self._handle_error(</span>
<a href="#l6.1465"></a><span id="l6.1465" class="difflineminus">-                            &quot;Cannot compute nesting level at line %s.&quot;,</span>
<a href="#l6.1466"></a><span id="l6.1466" class="difflineminus">-                            NestingError, infile, cur_index)</span>
<a href="#l6.1467"></a><span id="l6.1467" class="difflineminus">-                        continue</span>
<a href="#l6.1468"></a><span id="l6.1468" class="difflineminus">-                elif cur_depth == this_section.depth:</span>
<a href="#l6.1469"></a><span id="l6.1469" class="difflineminus">-                    # the new section is a sibling of the current section</span>
<a href="#l6.1470"></a><span id="l6.1470" class="difflineminus">-                    parent = this_section.parent</span>
<a href="#l6.1471"></a><span id="l6.1471" class="difflineminus">-                elif cur_depth == this_section.depth + 1:</span>
<a href="#l6.1472"></a><span id="l6.1472" class="difflineminus">-                    # the new section is a child the current section</span>
<a href="#l6.1473"></a><span id="l6.1473" class="difflineminus">-                    parent = this_section</span>
<a href="#l6.1474"></a><span id="l6.1474" class="difflineminus">-                else:</span>
<a href="#l6.1475"></a><span id="l6.1475" class="difflineminus">-                    self._handle_error(</span>
<a href="#l6.1476"></a><span id="l6.1476" class="difflineminus">-                        &quot;Section too nested at line %s.&quot;,</span>
<a href="#l6.1477"></a><span id="l6.1477" class="difflineminus">-                        NestingError, infile, cur_index)</span>
<a href="#l6.1478"></a><span id="l6.1478" class="difflineminus">-                #</span>
<a href="#l6.1479"></a><span id="l6.1479" class="difflineminus">-                sect_name = self._unquote(sect_name)</span>
<a href="#l6.1480"></a><span id="l6.1480" class="difflineminus">-                if parent.has_key(sect_name):</span>
<a href="#l6.1481"></a><span id="l6.1481" class="difflineminus">-                    self._handle_error(</span>
<a href="#l6.1482"></a><span id="l6.1482" class="difflineminus">-                        'Duplicate section name at line %s.',</span>
<a href="#l6.1483"></a><span id="l6.1483" class="difflineminus">-                        DuplicateError, infile, cur_index)</span>
<a href="#l6.1484"></a><span id="l6.1484" class="difflineminus">-                    continue</span>
<a href="#l6.1485"></a><span id="l6.1485" class="difflineminus">-                # create the new section</span>
<a href="#l6.1486"></a><span id="l6.1486" class="difflineminus">-                this_section = Section(</span>
<a href="#l6.1487"></a><span id="l6.1487" class="difflineminus">-                    parent,</span>
<a href="#l6.1488"></a><span id="l6.1488" class="difflineminus">-                    cur_depth,</span>
<a href="#l6.1489"></a><span id="l6.1489" class="difflineminus">-                    self,</span>
<a href="#l6.1490"></a><span id="l6.1490" class="difflineminus">-                    name=sect_name)</span>
<a href="#l6.1491"></a><span id="l6.1491" class="difflineminus">-                parent[sect_name] = this_section</span>
<a href="#l6.1492"></a><span id="l6.1492" class="difflineminus">-                parent.inline_comments[sect_name] = comment</span>
<a href="#l6.1493"></a><span id="l6.1493" class="difflineminus">-                parent.comments[sect_name] = comment_list</span>
<a href="#l6.1494"></a><span id="l6.1494" class="difflineminus">-                continue</span>
<a href="#l6.1495"></a><span id="l6.1495" class="difflineminus">-            #</span>
<a href="#l6.1496"></a><span id="l6.1496" class="difflineminus">-            # it's not a section marker,</span>
<a href="#l6.1497"></a><span id="l6.1497" class="difflineminus">-            # so it should be a valid ``key = value`` line</span>
<a href="#l6.1498"></a><span id="l6.1498" class="difflineminus">-            mat = self._keyword.match(line)</span>
<a href="#l6.1499"></a><span id="l6.1499" class="difflineminus">-            if mat is None:</span>
<a href="#l6.1500"></a><span id="l6.1500" class="difflineminus">-                # it neither matched as a keyword</span>
<a href="#l6.1501"></a><span id="l6.1501" class="difflineminus">-                # or a section marker</span>
<a href="#l6.1502"></a><span id="l6.1502" class="difflineminus">-                self._handle_error(</span>
<a href="#l6.1503"></a><span id="l6.1503" class="difflineminus">-                    'Invalid line at line &quot;%s&quot;.',</span>
<a href="#l6.1504"></a><span id="l6.1504" class="difflineminus">-                    ParseError, infile, cur_index)</span>
<a href="#l6.1505"></a><span id="l6.1505" class="difflineminus">-            else:</span>
<a href="#l6.1506"></a><span id="l6.1506" class="difflineminus">-                # is a keyword value</span>
<a href="#l6.1507"></a><span id="l6.1507" class="difflineminus">-                # value will include any inline comment</span>
<a href="#l6.1508"></a><span id="l6.1508" class="difflineminus">-                (indent, key, value) = mat.groups()</span>
<a href="#l6.1509"></a><span id="l6.1509" class="difflineminus">-                if indent and (self.indent_type is None):</span>
<a href="#l6.1510"></a><span id="l6.1510" class="difflineminus">-                    self.indent_type = indent</span>
<a href="#l6.1511"></a><span id="l6.1511" class="difflineminus">-                # check for a multiline value</span>
<a href="#l6.1512"></a><span id="l6.1512" class="difflineminus">-                if value[:3] in ['&quot;&quot;&quot;', &quot;'''&quot;]:</span>
<a href="#l6.1513"></a><span id="l6.1513" class="difflineminus">-                    try:</span>
<a href="#l6.1514"></a><span id="l6.1514" class="difflineminus">-                        (value, comment, cur_index) = self._multiline(</span>
<a href="#l6.1515"></a><span id="l6.1515" class="difflineminus">-                            value, infile, cur_index, maxline)</span>
<a href="#l6.1516"></a><span id="l6.1516" class="difflineminus">-                    except SyntaxError:</span>
<a href="#l6.1517"></a><span id="l6.1517" class="difflineminus">-                        self._handle_error(</span>
<a href="#l6.1518"></a><span id="l6.1518" class="difflineminus">-                            'Parse error in value at line %s.',</span>
<a href="#l6.1519"></a><span id="l6.1519" class="difflineminus">-                            ParseError, infile, cur_index)</span>
<a href="#l6.1520"></a><span id="l6.1520" class="difflineminus">-                        continue</span>
<a href="#l6.1521"></a><span id="l6.1521" class="difflineminus">-                    else:</span>
<a href="#l6.1522"></a><span id="l6.1522" class="difflineminus">-                        if self.unrepr:</span>
<a href="#l6.1523"></a><span id="l6.1523" class="difflineminus">-                            comment = ''</span>
<a href="#l6.1524"></a><span id="l6.1524" class="difflineminus">-                            try:</span>
<a href="#l6.1525"></a><span id="l6.1525" class="difflineminus">-                                value = unrepr(value)</span>
<a href="#l6.1526"></a><span id="l6.1526" class="difflineminus">-                            except Exception, e:</span>
<a href="#l6.1527"></a><span id="l6.1527" class="difflineminus">-                                if type(e) == UnknownType:</span>
<a href="#l6.1528"></a><span id="l6.1528" class="difflineminus">-                                    msg = 'Unknown name or type in value at line %s.'</span>
<a href="#l6.1529"></a><span id="l6.1529" class="difflineminus">-                                else:</span>
<a href="#l6.1530"></a><span id="l6.1530" class="difflineminus">-                                    msg = 'Parse error in value at line %s.'</span>
<a href="#l6.1531"></a><span id="l6.1531" class="difflineminus">-                                self._handle_error(msg, UnreprError, infile,</span>
<a href="#l6.1532"></a><span id="l6.1532" class="difflineminus">-                                    cur_index)</span>
<a href="#l6.1533"></a><span id="l6.1533" class="difflineminus">-                                continue</span>
<a href="#l6.1534"></a><span id="l6.1534" class="difflineminus">-                else:</span>
<a href="#l6.1535"></a><span id="l6.1535" class="difflineminus">-                    if self.unrepr:</span>
<a href="#l6.1536"></a><span id="l6.1536" class="difflineminus">-                        comment = ''</span>
<a href="#l6.1537"></a><span id="l6.1537" class="difflineminus">-                        try:</span>
<a href="#l6.1538"></a><span id="l6.1538" class="difflineminus">-                            value = unrepr(value)</span>
<a href="#l6.1539"></a><span id="l6.1539" class="difflineminus">-                        except Exception, e:</span>
<a href="#l6.1540"></a><span id="l6.1540" class="difflineminus">-                            if isinstance(e, UnknownType):</span>
<a href="#l6.1541"></a><span id="l6.1541" class="difflineminus">-                                msg = 'Unknown name or type in value at line %s.'</span>
<a href="#l6.1542"></a><span id="l6.1542" class="difflineminus">-                            else:</span>
<a href="#l6.1543"></a><span id="l6.1543" class="difflineminus">-                                msg = 'Parse error in value at line %s.'</span>
<a href="#l6.1544"></a><span id="l6.1544" class="difflineminus">-                            self._handle_error(msg, UnreprError, infile,</span>
<a href="#l6.1545"></a><span id="l6.1545" class="difflineminus">-                                cur_index)</span>
<a href="#l6.1546"></a><span id="l6.1546" class="difflineminus">-                            continue</span>
<a href="#l6.1547"></a><span id="l6.1547" class="difflineminus">-                    else:</span>
<a href="#l6.1548"></a><span id="l6.1548" class="difflineminus">-                        # extract comment and lists</span>
<a href="#l6.1549"></a><span id="l6.1549" class="difflineminus">-                        try:</span>
<a href="#l6.1550"></a><span id="l6.1550" class="difflineminus">-                            (value, comment) = self._handle_value(value)</span>
<a href="#l6.1551"></a><span id="l6.1551" class="difflineminus">-                        except SyntaxError:</span>
<a href="#l6.1552"></a><span id="l6.1552" class="difflineminus">-                            self._handle_error(</span>
<a href="#l6.1553"></a><span id="l6.1553" class="difflineminus">-                                'Parse error in value at line %s.',</span>
<a href="#l6.1554"></a><span id="l6.1554" class="difflineminus">-                                ParseError, infile, cur_index)</span>
<a href="#l6.1555"></a><span id="l6.1555" class="difflineminus">-                            continue</span>
<a href="#l6.1556"></a><span id="l6.1556" class="difflineminus">-                #</span>
<a href="#l6.1557"></a><span id="l6.1557" class="difflineminus">-                key = self._unquote(key)</span>
<a href="#l6.1558"></a><span id="l6.1558" class="difflineminus">-                if this_section.has_key(key):</span>
<a href="#l6.1559"></a><span id="l6.1559" class="difflineminus">-                    self._handle_error(</span>
<a href="#l6.1560"></a><span id="l6.1560" class="difflineminus">-                        'Duplicate keyword name at line %s.',</span>
<a href="#l6.1561"></a><span id="l6.1561" class="difflineminus">-                        DuplicateError, infile, cur_index)</span>
<a href="#l6.1562"></a><span id="l6.1562" class="difflineminus">-                    continue</span>
<a href="#l6.1563"></a><span id="l6.1563" class="difflineminus">-                # add the key.</span>
<a href="#l6.1564"></a><span id="l6.1564" class="difflineminus">-                # we set unrepr because if we have got this far we will never</span>
<a href="#l6.1565"></a><span id="l6.1565" class="difflineminus">-                # be creating a new section</span>
<a href="#l6.1566"></a><span id="l6.1566" class="difflineminus">-                this_section.__setitem__(key, value, unrepr=True)</span>
<a href="#l6.1567"></a><span id="l6.1567" class="difflineminus">-                this_section.inline_comments[key] = comment</span>
<a href="#l6.1568"></a><span id="l6.1568" class="difflineminus">-                this_section.comments[key] = comment_list</span>
<a href="#l6.1569"></a><span id="l6.1569" class="difflineminus">-                continue</span>
<a href="#l6.1570"></a><span id="l6.1570" class="difflineminus">-        #</span>
<a href="#l6.1571"></a><span id="l6.1571" class="difflineminus">-        if self.indent_type is None:</span>
<a href="#l6.1572"></a><span id="l6.1572" class="difflineminus">-            # no indentation used, set the type accordingly</span>
<a href="#l6.1573"></a><span id="l6.1573" class="difflineminus">-            self.indent_type = ''</span>
<a href="#l6.1574"></a><span id="l6.1574" class="difflineminus">-        #</span>
<a href="#l6.1575"></a><span id="l6.1575" class="difflineminus">-        if self._terminated:</span>
<a href="#l6.1576"></a><span id="l6.1576" class="difflineminus">-            comment_list.append('')</span>
<a href="#l6.1577"></a><span id="l6.1577" class="difflineminus">-        # preserve the final comment</span>
<a href="#l6.1578"></a><span id="l6.1578" class="difflineminus">-        if not self and not self.initial_comment:</span>
<a href="#l6.1579"></a><span id="l6.1579" class="difflineminus">-            self.initial_comment = comment_list</span>
<a href="#l6.1580"></a><span id="l6.1580" class="difflineminus">-        elif not reset_comment:</span>
<a href="#l6.1581"></a><span id="l6.1581" class="difflineminus">-            self.final_comment = comment_list</span>
<a href="#l6.1582"></a><span id="l6.1582" class="difflineminus">-        self.list_values = temp_list_values</span>
<a href="#l6.1583"></a><span id="l6.1583" class="difflineminus">-</span>
<a href="#l6.1584"></a><span id="l6.1584" class="difflineminus">-    def _match_depth(self, sect, depth):</span>
<a href="#l6.1585"></a><span id="l6.1585" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1586"></a><span id="l6.1586" class="difflineminus">-        Given a section and a depth level, walk back through the sections</span>
<a href="#l6.1587"></a><span id="l6.1587" class="difflineminus">-        parents to see if the depth level matches a previous section.</span>
<a href="#l6.1588"></a><span id="l6.1588" class="difflineminus">-        </span>
<a href="#l6.1589"></a><span id="l6.1589" class="difflineminus">-        Return a reference to the right section,</span>
<a href="#l6.1590"></a><span id="l6.1590" class="difflineminus">-        or raise a SyntaxError.</span>
<a href="#l6.1591"></a><span id="l6.1591" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1592"></a><span id="l6.1592" class="difflineminus">-        while depth &lt; sect.depth:</span>
<a href="#l6.1593"></a><span id="l6.1593" class="difflineminus">-            if sect is sect.parent:</span>
<a href="#l6.1594"></a><span id="l6.1594" class="difflineminus">-                # we've reached the top level already</span>
<a href="#l6.1595"></a><span id="l6.1595" class="difflineminus">-                raise SyntaxError</span>
<a href="#l6.1596"></a><span id="l6.1596" class="difflineminus">-            sect = sect.parent</span>
<a href="#l6.1597"></a><span id="l6.1597" class="difflineminus">-        if sect.depth == depth:</span>
<a href="#l6.1598"></a><span id="l6.1598" class="difflineminus">-            return sect</span>
<a href="#l6.1599"></a><span id="l6.1599" class="difflineminus">-        # shouldn't get here</span>
<a href="#l6.1600"></a><span id="l6.1600" class="difflineminus">-        raise SyntaxError</span>
<a href="#l6.1601"></a><span id="l6.1601" class="difflineminus">-</span>
<a href="#l6.1602"></a><span id="l6.1602" class="difflineminus">-    def _handle_error(self, text, ErrorClass, infile, cur_index):</span>
<a href="#l6.1603"></a><span id="l6.1603" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1604"></a><span id="l6.1604" class="difflineminus">-        Handle an error according to the error settings.</span>
<a href="#l6.1605"></a><span id="l6.1605" class="difflineminus">-        </span>
<a href="#l6.1606"></a><span id="l6.1606" class="difflineminus">-        Either raise the error or store it.</span>
<a href="#l6.1607"></a><span id="l6.1607" class="difflineminus">-        The error will have occurred at ``cur_index``</span>
<a href="#l6.1608"></a><span id="l6.1608" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1609"></a><span id="l6.1609" class="difflineminus">-        line = infile[cur_index]</span>
<a href="#l6.1610"></a><span id="l6.1610" class="difflineminus">-        cur_index += 1</span>
<a href="#l6.1611"></a><span id="l6.1611" class="difflineminus">-        message = text % cur_index</span>
<a href="#l6.1612"></a><span id="l6.1612" class="difflineminus">-        error = ErrorClass(message, cur_index, line)</span>
<a href="#l6.1613"></a><span id="l6.1613" class="difflineminus">-        if self.raise_errors:</span>
<a href="#l6.1614"></a><span id="l6.1614" class="difflineminus">-            # raise the error - parsing stops here</span>
<a href="#l6.1615"></a><span id="l6.1615" class="difflineminus">-            raise error</span>
<a href="#l6.1616"></a><span id="l6.1616" class="difflineminus">-        # store the error</span>
<a href="#l6.1617"></a><span id="l6.1617" class="difflineminus">-        # reraise when parsing has finished</span>
<a href="#l6.1618"></a><span id="l6.1618" class="difflineminus">-        self._errors.append(error)</span>
<a href="#l6.1619"></a><span id="l6.1619" class="difflineminus">-</span>
<a href="#l6.1620"></a><span id="l6.1620" class="difflineminus">-    def _unquote(self, value):</span>
<a href="#l6.1621"></a><span id="l6.1621" class="difflineminus">-        &quot;&quot;&quot;Return an unquoted version of a value&quot;&quot;&quot;</span>
<a href="#l6.1622"></a><span id="l6.1622" class="difflineminus">-        if (value[0] == value[-1]) and (value[0] in ('&quot;', &quot;'&quot;)):</span>
<a href="#l6.1623"></a><span id="l6.1623" class="difflineminus">-            value = value[1:-1]</span>
<a href="#l6.1624"></a><span id="l6.1624" class="difflineminus">-        return value</span>
<a href="#l6.1625"></a><span id="l6.1625" class="difflineminus">-</span>
<a href="#l6.1626"></a><span id="l6.1626" class="difflineminus">-    def _quote(self, value, multiline=True):</span>
<a href="#l6.1627"></a><span id="l6.1627" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1628"></a><span id="l6.1628" class="difflineminus">-        Return a safely quoted version of a value.</span>
<a href="#l6.1629"></a><span id="l6.1629" class="difflineminus">-        </span>
<a href="#l6.1630"></a><span id="l6.1630" class="difflineminus">-        Raise a ConfigObjError if the value cannot be safely quoted.</span>
<a href="#l6.1631"></a><span id="l6.1631" class="difflineminus">-        If multiline is ``True`` (default) then use triple quotes</span>
<a href="#l6.1632"></a><span id="l6.1632" class="difflineminus">-        if necessary.</span>
<a href="#l6.1633"></a><span id="l6.1633" class="difflineminus">-        </span>
<a href="#l6.1634"></a><span id="l6.1634" class="difflineminus">-        Don't quote values that don't need it.</span>
<a href="#l6.1635"></a><span id="l6.1635" class="difflineminus">-        Recursively quote members of a list and return a comma joined list.</span>
<a href="#l6.1636"></a><span id="l6.1636" class="difflineminus">-        Multiline is ``False`` for lists.</span>
<a href="#l6.1637"></a><span id="l6.1637" class="difflineminus">-        Obey list syntax for empty and single member lists.</span>
<a href="#l6.1638"></a><span id="l6.1638" class="difflineminus">-        </span>
<a href="#l6.1639"></a><span id="l6.1639" class="difflineminus">-        If ``list_values=False`` then the value is only quoted if it contains</span>
<a href="#l6.1640"></a><span id="l6.1640" class="difflineminus">-        a ``\n`` (is multiline).</span>
<a href="#l6.1641"></a><span id="l6.1641" class="difflineminus">-        </span>
<a href="#l6.1642"></a><span id="l6.1642" class="difflineminus">-        If ``write_empty_values`` is set, and the value is an empty string, it</span>
<a href="#l6.1643"></a><span id="l6.1643" class="difflineminus">-        won't be quoted.</span>
<a href="#l6.1644"></a><span id="l6.1644" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1645"></a><span id="l6.1645" class="difflineminus">-        if multiline and self.write_empty_values and value == '':</span>
<a href="#l6.1646"></a><span id="l6.1646" class="difflineminus">-            # Only if multiline is set, so that it is used for values not</span>
<a href="#l6.1647"></a><span id="l6.1647" class="difflineminus">-            # keys, and not values that are part of a list</span>
<a href="#l6.1648"></a><span id="l6.1648" class="difflineminus">-            return ''</span>
<a href="#l6.1649"></a><span id="l6.1649" class="difflineminus">-        if multiline and isinstance(value, (list, tuple)):</span>
<a href="#l6.1650"></a><span id="l6.1650" class="difflineminus">-            if not value:</span>
<a href="#l6.1651"></a><span id="l6.1651" class="difflineminus">-                return ','</span>
<a href="#l6.1652"></a><span id="l6.1652" class="difflineminus">-            elif len(value) == 1:</span>
<a href="#l6.1653"></a><span id="l6.1653" class="difflineminus">-                return self._quote(value[0], multiline=False) + ','</span>
<a href="#l6.1654"></a><span id="l6.1654" class="difflineminus">-            return ', '.join([self._quote(val, multiline=False)</span>
<a href="#l6.1655"></a><span id="l6.1655" class="difflineminus">-                for val in value])</span>
<a href="#l6.1656"></a><span id="l6.1656" class="difflineminus">-        if not isinstance(value, StringTypes):</span>
<a href="#l6.1657"></a><span id="l6.1657" class="difflineminus">-            if self.stringify:</span>
<a href="#l6.1658"></a><span id="l6.1658" class="difflineminus">-                value = str(value)</span>
<a href="#l6.1659"></a><span id="l6.1659" class="difflineminus">-            else:</span>
<a href="#l6.1660"></a><span id="l6.1660" class="difflineminus">-                raise TypeError, 'Value &quot;%s&quot; is not a string.' % value</span>
<a href="#l6.1661"></a><span id="l6.1661" class="difflineminus">-        squot = &quot;'%s'&quot;</span>
<a href="#l6.1662"></a><span id="l6.1662" class="difflineminus">-        dquot = '&quot;%s&quot;'</span>
<a href="#l6.1663"></a><span id="l6.1663" class="difflineminus">-        noquot = &quot;%s&quot;</span>
<a href="#l6.1664"></a><span id="l6.1664" class="difflineminus">-        wspace_plus = ' \r\t\n\v\t\'&quot;'</span>
<a href="#l6.1665"></a><span id="l6.1665" class="difflineminus">-        tsquot = '&quot;&quot;&quot;%s&quot;&quot;&quot;'</span>
<a href="#l6.1666"></a><span id="l6.1666" class="difflineminus">-        tdquot = &quot;'''%s'''&quot;</span>
<a href="#l6.1667"></a><span id="l6.1667" class="difflineminus">-        if not value:</span>
<a href="#l6.1668"></a><span id="l6.1668" class="difflineminus">-            return '&quot;&quot;'</span>
<a href="#l6.1669"></a><span id="l6.1669" class="difflineminus">-        if (not self.list_values and '\n' not in value) or not (multiline and</span>
<a href="#l6.1670"></a><span id="l6.1670" class="difflineminus">-                (((&quot;'&quot; in value) and ('&quot;' in value)) or ('\n' in value))):</span>
<a href="#l6.1671"></a><span id="l6.1671" class="difflineminus">-            if not self.list_values:</span>
<a href="#l6.1672"></a><span id="l6.1672" class="difflineminus">-                # we don't quote if ``list_values=False``</span>
<a href="#l6.1673"></a><span id="l6.1673" class="difflineminus">-                quot = noquot</span>
<a href="#l6.1674"></a><span id="l6.1674" class="difflineminus">-            # for normal values either single or double quotes will do</span>
<a href="#l6.1675"></a><span id="l6.1675" class="difflineminus">-            elif '\n' in value:</span>
<a href="#l6.1676"></a><span id="l6.1676" class="difflineminus">-                # will only happen if multiline is off - e.g. '\n' in key</span>
<a href="#l6.1677"></a><span id="l6.1677" class="difflineminus">-                raise ConfigObjError, ('Value &quot;%s&quot; cannot be safely quoted.' %</span>
<a href="#l6.1678"></a><span id="l6.1678" class="difflineminus">-                    value)</span>
<a href="#l6.1679"></a><span id="l6.1679" class="difflineminus">-            elif ((value[0] not in wspace_plus) and</span>
<a href="#l6.1680"></a><span id="l6.1680" class="difflineminus">-                    (value[-1] not in wspace_plus) and</span>
<a href="#l6.1681"></a><span id="l6.1681" class="difflineminus">-                    (',' not in value)):</span>
<a href="#l6.1682"></a><span id="l6.1682" class="difflineminus">-                quot = noquot</span>
<a href="#l6.1683"></a><span id="l6.1683" class="difflineminus">-            else:</span>
<a href="#l6.1684"></a><span id="l6.1684" class="difflineminus">-                if (&quot;'&quot; in value) and ('&quot;' in value):</span>
<a href="#l6.1685"></a><span id="l6.1685" class="difflineminus">-                    raise ConfigObjError, (</span>
<a href="#l6.1686"></a><span id="l6.1686" class="difflineminus">-                        'Value &quot;%s&quot; cannot be safely quoted.' % value)</span>
<a href="#l6.1687"></a><span id="l6.1687" class="difflineminus">-                elif '&quot;' in value:</span>
<a href="#l6.1688"></a><span id="l6.1688" class="difflineminus">-                    quot = squot</span>
<a href="#l6.1689"></a><span id="l6.1689" class="difflineminus">-                else:</span>
<a href="#l6.1690"></a><span id="l6.1690" class="difflineminus">-                    quot = dquot</span>
<a href="#l6.1691"></a><span id="l6.1691" class="difflineminus">-        else:</span>
<a href="#l6.1692"></a><span id="l6.1692" class="difflineminus">-            # if value has '\n' or &quot;'&quot; *and* '&quot;', it will need triple quotes</span>
<a href="#l6.1693"></a><span id="l6.1693" class="difflineminus">-            if (value.find('&quot;&quot;&quot;') != -1) and (value.find(&quot;'''&quot;) != -1):</span>
<a href="#l6.1694"></a><span id="l6.1694" class="difflineminus">-                raise ConfigObjError, (</span>
<a href="#l6.1695"></a><span id="l6.1695" class="difflineminus">-                    'Value &quot;%s&quot; cannot be safely quoted.' % value)</span>
<a href="#l6.1696"></a><span id="l6.1696" class="difflineminus">-            if value.find('&quot;&quot;&quot;') == -1:</span>
<a href="#l6.1697"></a><span id="l6.1697" class="difflineminus">-                quot = tdquot</span>
<a href="#l6.1698"></a><span id="l6.1698" class="difflineminus">-            else:</span>
<a href="#l6.1699"></a><span id="l6.1699" class="difflineminus">-                quot = tsquot</span>
<a href="#l6.1700"></a><span id="l6.1700" class="difflineminus">-        return quot % value</span>
<a href="#l6.1701"></a><span id="l6.1701" class="difflineminus">-</span>
<a href="#l6.1702"></a><span id="l6.1702" class="difflineminus">-    def _handle_value(self, value):</span>
<a href="#l6.1703"></a><span id="l6.1703" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1704"></a><span id="l6.1704" class="difflineminus">-        Given a value string, unquote, remove comment,</span>
<a href="#l6.1705"></a><span id="l6.1705" class="difflineminus">-        handle lists. (including empty and single member lists)</span>
<a href="#l6.1706"></a><span id="l6.1706" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1707"></a><span id="l6.1707" class="difflineminus">-        # do we look for lists in values ?</span>
<a href="#l6.1708"></a><span id="l6.1708" class="difflineminus">-        if not self.list_values:</span>
<a href="#l6.1709"></a><span id="l6.1709" class="difflineminus">-            mat = self._nolistvalue.match(value)</span>
<a href="#l6.1710"></a><span id="l6.1710" class="difflineminus">-            if mat is None:</span>
<a href="#l6.1711"></a><span id="l6.1711" class="difflineminus">-                raise SyntaxError</span>
<a href="#l6.1712"></a><span id="l6.1712" class="difflineminus">-            # NOTE: we don't unquote here</span>
<a href="#l6.1713"></a><span id="l6.1713" class="difflineminus">-            return mat.groups()</span>
<a href="#l6.1714"></a><span id="l6.1714" class="difflineminus">-        #</span>
<a href="#l6.1715"></a><span id="l6.1715" class="difflineminus">-        mat = self._valueexp.match(value)</span>
<a href="#l6.1716"></a><span id="l6.1716" class="difflineminus">-        if mat is None:</span>
<a href="#l6.1717"></a><span id="l6.1717" class="difflineminus">-            # the value is badly constructed, probably badly quoted,</span>
<a href="#l6.1718"></a><span id="l6.1718" class="difflineminus">-            # or an invalid list</span>
<a href="#l6.1719"></a><span id="l6.1719" class="difflineminus">-            raise SyntaxError</span>
<a href="#l6.1720"></a><span id="l6.1720" class="difflineminus">-        (list_values, single, empty_list, comment) = mat.groups()</span>
<a href="#l6.1721"></a><span id="l6.1721" class="difflineminus">-        if (list_values == '') and (single is None):</span>
<a href="#l6.1722"></a><span id="l6.1722" class="difflineminus">-            # change this if you want to accept empty values</span>
<a href="#l6.1723"></a><span id="l6.1723" class="difflineminus">-            raise SyntaxError</span>
<a href="#l6.1724"></a><span id="l6.1724" class="difflineminus">-        # NOTE: note there is no error handling from here if the regex</span>
<a href="#l6.1725"></a><span id="l6.1725" class="difflineminus">-        # is wrong: then incorrect values will slip through</span>
<a href="#l6.1726"></a><span id="l6.1726" class="difflineminus">-        if empty_list is not None:</span>
<a href="#l6.1727"></a><span id="l6.1727" class="difflineminus">-            # the single comma - meaning an empty list</span>
<a href="#l6.1728"></a><span id="l6.1728" class="difflineminus">-            return ([], comment)</span>
<a href="#l6.1729"></a><span id="l6.1729" class="difflineminus">-        if single is not None:</span>
<a href="#l6.1730"></a><span id="l6.1730" class="difflineminus">-            # handle empty values</span>
<a href="#l6.1731"></a><span id="l6.1731" class="difflineminus">-            if list_values and not single:</span>
<a href="#l6.1732"></a><span id="l6.1732" class="difflineminus">-                # FIXME: the '' is a workaround because our regex now matches</span>
<a href="#l6.1733"></a><span id="l6.1733" class="difflineminus">-                #   '' at the end of a list if it has a trailing comma</span>
<a href="#l6.1734"></a><span id="l6.1734" class="difflineminus">-                single = None</span>
<a href="#l6.1735"></a><span id="l6.1735" class="difflineminus">-            else:</span>
<a href="#l6.1736"></a><span id="l6.1736" class="difflineminus">-                single = single or '&quot;&quot;'</span>
<a href="#l6.1737"></a><span id="l6.1737" class="difflineminus">-                single = self._unquote(single)</span>
<a href="#l6.1738"></a><span id="l6.1738" class="difflineminus">-        if list_values == '':</span>
<a href="#l6.1739"></a><span id="l6.1739" class="difflineminus">-            # not a list value</span>
<a href="#l6.1740"></a><span id="l6.1740" class="difflineminus">-            return (single, comment)</span>
<a href="#l6.1741"></a><span id="l6.1741" class="difflineminus">-        the_list = self._listvalueexp.findall(list_values)</span>
<a href="#l6.1742"></a><span id="l6.1742" class="difflineminus">-        the_list = [self._unquote(val) for val in the_list]</span>
<a href="#l6.1743"></a><span id="l6.1743" class="difflineminus">-        if single is not None:</span>
<a href="#l6.1744"></a><span id="l6.1744" class="difflineminus">-            the_list += [single]</span>
<a href="#l6.1745"></a><span id="l6.1745" class="difflineminus">-        return (the_list, comment)</span>
<a href="#l6.1746"></a><span id="l6.1746" class="difflineminus">-</span>
<a href="#l6.1747"></a><span id="l6.1747" class="difflineminus">-    def _multiline(self, value, infile, cur_index, maxline):</span>
<a href="#l6.1748"></a><span id="l6.1748" class="difflineminus">-        &quot;&quot;&quot;Extract the value, where we are in a multiline situation.&quot;&quot;&quot;</span>
<a href="#l6.1749"></a><span id="l6.1749" class="difflineminus">-        quot = value[:3]</span>
<a href="#l6.1750"></a><span id="l6.1750" class="difflineminus">-        newvalue = value[3:]</span>
<a href="#l6.1751"></a><span id="l6.1751" class="difflineminus">-        single_line = self._triple_quote[quot][0]</span>
<a href="#l6.1752"></a><span id="l6.1752" class="difflineminus">-        multi_line = self._triple_quote[quot][1]</span>
<a href="#l6.1753"></a><span id="l6.1753" class="difflineminus">-        mat = single_line.match(value)</span>
<a href="#l6.1754"></a><span id="l6.1754" class="difflineminus">-        if mat is not None:</span>
<a href="#l6.1755"></a><span id="l6.1755" class="difflineminus">-            retval = list(mat.groups())</span>
<a href="#l6.1756"></a><span id="l6.1756" class="difflineminus">-            retval.append(cur_index)</span>
<a href="#l6.1757"></a><span id="l6.1757" class="difflineminus">-            return retval</span>
<a href="#l6.1758"></a><span id="l6.1758" class="difflineminus">-        elif newvalue.find(quot) != -1:</span>
<a href="#l6.1759"></a><span id="l6.1759" class="difflineminus">-            # somehow the triple quote is missing</span>
<a href="#l6.1760"></a><span id="l6.1760" class="difflineminus">-            raise SyntaxError</span>
<a href="#l6.1761"></a><span id="l6.1761" class="difflineminus">-        #</span>
<a href="#l6.1762"></a><span id="l6.1762" class="difflineminus">-        while cur_index &lt; maxline:</span>
<a href="#l6.1763"></a><span id="l6.1763" class="difflineminus">-            cur_index += 1</span>
<a href="#l6.1764"></a><span id="l6.1764" class="difflineminus">-            newvalue += '\n'</span>
<a href="#l6.1765"></a><span id="l6.1765" class="difflineminus">-            line = infile[cur_index]</span>
<a href="#l6.1766"></a><span id="l6.1766" class="difflineminus">-            if line.find(quot) == -1:</span>
<a href="#l6.1767"></a><span id="l6.1767" class="difflineminus">-                newvalue += line</span>
<a href="#l6.1768"></a><span id="l6.1768" class="difflineminus">-            else:</span>
<a href="#l6.1769"></a><span id="l6.1769" class="difflineminus">-                # end of multiline, process it</span>
<a href="#l6.1770"></a><span id="l6.1770" class="difflineminus">-                break</span>
<a href="#l6.1771"></a><span id="l6.1771" class="difflineminus">-        else:</span>
<a href="#l6.1772"></a><span id="l6.1772" class="difflineminus">-            # we've got to the end of the config, oops...</span>
<a href="#l6.1773"></a><span id="l6.1773" class="difflineminus">-            raise SyntaxError</span>
<a href="#l6.1774"></a><span id="l6.1774" class="difflineminus">-        mat = multi_line.match(line)</span>
<a href="#l6.1775"></a><span id="l6.1775" class="difflineminus">-        if mat is None:</span>
<a href="#l6.1776"></a><span id="l6.1776" class="difflineminus">-            # a badly formed line</span>
<a href="#l6.1777"></a><span id="l6.1777" class="difflineminus">-            raise SyntaxError</span>
<a href="#l6.1778"></a><span id="l6.1778" class="difflineminus">-        (value, comment) = mat.groups()</span>
<a href="#l6.1779"></a><span id="l6.1779" class="difflineminus">-        return (newvalue + value, comment, cur_index)</span>
<a href="#l6.1780"></a><span id="l6.1780" class="difflineminus">-</span>
<a href="#l6.1781"></a><span id="l6.1781" class="difflineminus">-    def _handle_configspec(self, configspec):</span>
<a href="#l6.1782"></a><span id="l6.1782" class="difflineminus">-        &quot;&quot;&quot;Parse the configspec.&quot;&quot;&quot;</span>
<a href="#l6.1783"></a><span id="l6.1783" class="difflineminus">-        # FIXME: Should we check that the configspec was created with the </span>
<a href="#l6.1784"></a><span id="l6.1784" class="difflineminus">-        #   correct settings ? (i.e. ``list_values=False``)</span>
<a href="#l6.1785"></a><span id="l6.1785" class="difflineminus">-        if not isinstance(configspec, ConfigObj):</span>
<a href="#l6.1786"></a><span id="l6.1786" class="difflineminus">-            try:</span>
<a href="#l6.1787"></a><span id="l6.1787" class="difflineminus">-                configspec = ConfigObj(</span>
<a href="#l6.1788"></a><span id="l6.1788" class="difflineminus">-                    configspec,</span>
<a href="#l6.1789"></a><span id="l6.1789" class="difflineminus">-                    raise_errors=True,</span>
<a href="#l6.1790"></a><span id="l6.1790" class="difflineminus">-                    file_error=True,</span>
<a href="#l6.1791"></a><span id="l6.1791" class="difflineminus">-                    list_values=False)</span>
<a href="#l6.1792"></a><span id="l6.1792" class="difflineminus">-            except ConfigObjError, e:</span>
<a href="#l6.1793"></a><span id="l6.1793" class="difflineminus">-                # FIXME: Should these errors have a reference</span>
<a href="#l6.1794"></a><span id="l6.1794" class="difflineminus">-                # to the already parsed ConfigObj ?</span>
<a href="#l6.1795"></a><span id="l6.1795" class="difflineminus">-                raise ConfigspecError('Parsing configspec failed: %s' % e)</span>
<a href="#l6.1796"></a><span id="l6.1796" class="difflineminus">-            except IOError, e:</span>
<a href="#l6.1797"></a><span id="l6.1797" class="difflineminus">-                raise IOError('Reading configspec failed: %s' % e)</span>
<a href="#l6.1798"></a><span id="l6.1798" class="difflineminus">-        self._set_configspec_value(configspec, self)</span>
<a href="#l6.1799"></a><span id="l6.1799" class="difflineminus">-</span>
<a href="#l6.1800"></a><span id="l6.1800" class="difflineminus">-    def _set_configspec_value(self, configspec, section):</span>
<a href="#l6.1801"></a><span id="l6.1801" class="difflineminus">-        &quot;&quot;&quot;Used to recursively set configspec values.&quot;&quot;&quot;</span>
<a href="#l6.1802"></a><span id="l6.1802" class="difflineminus">-        if '__many__' in configspec.sections:</span>
<a href="#l6.1803"></a><span id="l6.1803" class="difflineminus">-            section.configspec['__many__'] = configspec['__many__']</span>
<a href="#l6.1804"></a><span id="l6.1804" class="difflineminus">-            if len(configspec.sections) &gt; 1:</span>
<a href="#l6.1805"></a><span id="l6.1805" class="difflineminus">-                # FIXME: can we supply any useful information here ?</span>
<a href="#l6.1806"></a><span id="l6.1806" class="difflineminus">-                raise RepeatSectionError</span>
<a href="#l6.1807"></a><span id="l6.1807" class="difflineminus">-        if hasattr(configspec, 'initial_comment'):</span>
<a href="#l6.1808"></a><span id="l6.1808" class="difflineminus">-            section._configspec_initial_comment = configspec.initial_comment</span>
<a href="#l6.1809"></a><span id="l6.1809" class="difflineminus">-            section._configspec_final_comment = configspec.final_comment</span>
<a href="#l6.1810"></a><span id="l6.1810" class="difflineminus">-            section._configspec_encoding = configspec.encoding</span>
<a href="#l6.1811"></a><span id="l6.1811" class="difflineminus">-            section._configspec_BOM = configspec.BOM</span>
<a href="#l6.1812"></a><span id="l6.1812" class="difflineminus">-            section._configspec_newlines = configspec.newlines</span>
<a href="#l6.1813"></a><span id="l6.1813" class="difflineminus">-            section._configspec_indent_type = configspec.indent_type</span>
<a href="#l6.1814"></a><span id="l6.1814" class="difflineminus">-        for entry in configspec.scalars:</span>
<a href="#l6.1815"></a><span id="l6.1815" class="difflineminus">-            section._configspec_comments[entry] = configspec.comments[entry]</span>
<a href="#l6.1816"></a><span id="l6.1816" class="difflineminus">-            section._configspec_inline_comments[entry] = (</span>
<a href="#l6.1817"></a><span id="l6.1817" class="difflineminus">-                configspec.inline_comments[entry])</span>
<a href="#l6.1818"></a><span id="l6.1818" class="difflineminus">-            section.configspec[entry] = configspec[entry]</span>
<a href="#l6.1819"></a><span id="l6.1819" class="difflineminus">-            section._order.append(entry)</span>
<a href="#l6.1820"></a><span id="l6.1820" class="difflineminus">-        for entry in configspec.sections:</span>
<a href="#l6.1821"></a><span id="l6.1821" class="difflineminus">-            if entry == '__many__':</span>
<a href="#l6.1822"></a><span id="l6.1822" class="difflineminus">-                continue</span>
<a href="#l6.1823"></a><span id="l6.1823" class="difflineminus">-            section._cs_section_comments[entry] = configspec.comments[entry]</span>
<a href="#l6.1824"></a><span id="l6.1824" class="difflineminus">-            section._cs_section_inline_comments[entry] = (</span>
<a href="#l6.1825"></a><span id="l6.1825" class="difflineminus">-                configspec.inline_comments[entry])</span>
<a href="#l6.1826"></a><span id="l6.1826" class="difflineminus">-            if not section.has_key(entry):</span>
<a href="#l6.1827"></a><span id="l6.1827" class="difflineminus">-                section[entry] = {}</span>
<a href="#l6.1828"></a><span id="l6.1828" class="difflineminus">-            self._set_configspec_value(configspec[entry], section[entry])</span>
<a href="#l6.1829"></a><span id="l6.1829" class="difflineminus">-</span>
<a href="#l6.1830"></a><span id="l6.1830" class="difflineminus">-    def _handle_repeat(self, section, configspec):</span>
<a href="#l6.1831"></a><span id="l6.1831" class="difflineminus">-        &quot;&quot;&quot;Dynamically assign configspec for repeated section.&quot;&quot;&quot;</span>
<a href="#l6.1832"></a><span id="l6.1832" class="difflineminus">-        try:</span>
<a href="#l6.1833"></a><span id="l6.1833" class="difflineminus">-            section_keys = configspec.sections</span>
<a href="#l6.1834"></a><span id="l6.1834" class="difflineminus">-            scalar_keys = configspec.scalars</span>
<a href="#l6.1835"></a><span id="l6.1835" class="difflineminus">-        except AttributeError:</span>
<a href="#l6.1836"></a><span id="l6.1836" class="difflineminus">-            section_keys = [entry for entry in configspec </span>
<a href="#l6.1837"></a><span id="l6.1837" class="difflineminus">-                                if isinstance(configspec[entry], dict)]</span>
<a href="#l6.1838"></a><span id="l6.1838" class="difflineminus">-            scalar_keys = [entry for entry in configspec </span>
<a href="#l6.1839"></a><span id="l6.1839" class="difflineminus">-                                if not isinstance(configspec[entry], dict)]</span>
<a href="#l6.1840"></a><span id="l6.1840" class="difflineminus">-        if '__many__' in section_keys and len(section_keys) &gt; 1:</span>
<a href="#l6.1841"></a><span id="l6.1841" class="difflineminus">-            # FIXME: can we supply any useful information here ?</span>
<a href="#l6.1842"></a><span id="l6.1842" class="difflineminus">-            raise RepeatSectionError</span>
<a href="#l6.1843"></a><span id="l6.1843" class="difflineminus">-        scalars = {}</span>
<a href="#l6.1844"></a><span id="l6.1844" class="difflineminus">-        sections = {}</span>
<a href="#l6.1845"></a><span id="l6.1845" class="difflineminus">-        for entry in scalar_keys:</span>
<a href="#l6.1846"></a><span id="l6.1846" class="difflineminus">-            val = configspec[entry]</span>
<a href="#l6.1847"></a><span id="l6.1847" class="difflineminus">-            scalars[entry] = val</span>
<a href="#l6.1848"></a><span id="l6.1848" class="difflineminus">-        for entry in section_keys:</span>
<a href="#l6.1849"></a><span id="l6.1849" class="difflineminus">-            val = configspec[entry]</span>
<a href="#l6.1850"></a><span id="l6.1850" class="difflineminus">-            if entry == '__many__':</span>
<a href="#l6.1851"></a><span id="l6.1851" class="difflineminus">-                scalars[entry] = val</span>
<a href="#l6.1852"></a><span id="l6.1852" class="difflineminus">-                continue</span>
<a href="#l6.1853"></a><span id="l6.1853" class="difflineminus">-            sections[entry] = val</span>
<a href="#l6.1854"></a><span id="l6.1854" class="difflineminus">-        #</span>
<a href="#l6.1855"></a><span id="l6.1855" class="difflineminus">-        section.configspec = scalars</span>
<a href="#l6.1856"></a><span id="l6.1856" class="difflineminus">-        for entry in sections:</span>
<a href="#l6.1857"></a><span id="l6.1857" class="difflineminus">-            if not section.has_key(entry):</span>
<a href="#l6.1858"></a><span id="l6.1858" class="difflineminus">-                section[entry] = {}</span>
<a href="#l6.1859"></a><span id="l6.1859" class="difflineminus">-            self._handle_repeat(section[entry], sections[entry])</span>
<a href="#l6.1860"></a><span id="l6.1860" class="difflineminus">-</span>
<a href="#l6.1861"></a><span id="l6.1861" class="difflineminus">-    def _write_line(self, indent_string, entry, this_entry, comment):</span>
<a href="#l6.1862"></a><span id="l6.1862" class="difflineminus">-        &quot;&quot;&quot;Write an individual line, for the write method&quot;&quot;&quot;</span>
<a href="#l6.1863"></a><span id="l6.1863" class="difflineminus">-        # NOTE: the calls to self._quote here handles non-StringType values.</span>
<a href="#l6.1864"></a><span id="l6.1864" class="difflineminus">-        if not self.unrepr:</span>
<a href="#l6.1865"></a><span id="l6.1865" class="difflineminus">-            val = self._decode_element(self._quote(this_entry))</span>
<a href="#l6.1866"></a><span id="l6.1866" class="difflineminus">-        else:</span>
<a href="#l6.1867"></a><span id="l6.1867" class="difflineminus">-            val = repr(this_entry)</span>
<a href="#l6.1868"></a><span id="l6.1868" class="difflineminus">-        return '%s%s%s%s%s' % (</span>
<a href="#l6.1869"></a><span id="l6.1869" class="difflineminus">-            indent_string,</span>
<a href="#l6.1870"></a><span id="l6.1870" class="difflineminus">-            self._decode_element(self._quote(entry, multiline=False)),</span>
<a href="#l6.1871"></a><span id="l6.1871" class="difflineminus">-            self._a_to_u(' = '),</span>
<a href="#l6.1872"></a><span id="l6.1872" class="difflineminus">-            val,</span>
<a href="#l6.1873"></a><span id="l6.1873" class="difflineminus">-            self._decode_element(comment))</span>
<a href="#l6.1874"></a><span id="l6.1874" class="difflineminus">-</span>
<a href="#l6.1875"></a><span id="l6.1875" class="difflineminus">-    def _write_marker(self, indent_string, depth, entry, comment):</span>
<a href="#l6.1876"></a><span id="l6.1876" class="difflineminus">-        &quot;&quot;&quot;Write a section marker line&quot;&quot;&quot;</span>
<a href="#l6.1877"></a><span id="l6.1877" class="difflineminus">-        return '%s%s%s%s%s' % (</span>
<a href="#l6.1878"></a><span id="l6.1878" class="difflineminus">-            indent_string,</span>
<a href="#l6.1879"></a><span id="l6.1879" class="difflineminus">-            self._a_to_u('[' * depth),</span>
<a href="#l6.1880"></a><span id="l6.1880" class="difflineminus">-            self._quote(self._decode_element(entry), multiline=False),</span>
<a href="#l6.1881"></a><span id="l6.1881" class="difflineminus">-            self._a_to_u(']' * depth),</span>
<a href="#l6.1882"></a><span id="l6.1882" class="difflineminus">-            self._decode_element(comment))</span>
<a href="#l6.1883"></a><span id="l6.1883" class="difflineminus">-</span>
<a href="#l6.1884"></a><span id="l6.1884" class="difflineminus">-    def _handle_comment(self, comment):</span>
<a href="#l6.1885"></a><span id="l6.1885" class="difflineminus">-        &quot;&quot;&quot;Deal with a comment.&quot;&quot;&quot;</span>
<a href="#l6.1886"></a><span id="l6.1886" class="difflineminus">-        if not comment:</span>
<a href="#l6.1887"></a><span id="l6.1887" class="difflineminus">-            return ''</span>
<a href="#l6.1888"></a><span id="l6.1888" class="difflineminus">-        start = self.indent_type</span>
<a href="#l6.1889"></a><span id="l6.1889" class="difflineminus">-        if not comment.startswith('#'):</span>
<a href="#l6.1890"></a><span id="l6.1890" class="difflineminus">-            start += self._a_to_u(' # ')</span>
<a href="#l6.1891"></a><span id="l6.1891" class="difflineminus">-        return (start + comment)</span>
<a href="#l6.1892"></a><span id="l6.1892" class="difflineminus">-</span>
<a href="#l6.1893"></a><span id="l6.1893" class="difflineminus">-    # Public methods</span>
<a href="#l6.1894"></a><span id="l6.1894" class="difflineminus">-</span>
<a href="#l6.1895"></a><span id="l6.1895" class="difflineminus">-    def write(self, outfile=None, section=None):</span>
<a href="#l6.1896"></a><span id="l6.1896" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1897"></a><span id="l6.1897" class="difflineminus">-        Write the current ConfigObj as a file</span>
<a href="#l6.1898"></a><span id="l6.1898" class="difflineminus">-        </span>
<a href="#l6.1899"></a><span id="l6.1899" class="difflineminus">-        tekNico: FIXME: use StringIO instead of real files</span>
<a href="#l6.1900"></a><span id="l6.1900" class="difflineminus">-        </span>
<a href="#l6.1901"></a><span id="l6.1901" class="difflineminus">-        &gt;&gt;&gt; filename = a.filename</span>
<a href="#l6.1902"></a><span id="l6.1902" class="difflineminus">-        &gt;&gt;&gt; a.filename = 'test.ini'</span>
<a href="#l6.1903"></a><span id="l6.1903" class="difflineminus">-        &gt;&gt;&gt; a.write()</span>
<a href="#l6.1904"></a><span id="l6.1904" class="difflineminus">-        &gt;&gt;&gt; a.filename = filename</span>
<a href="#l6.1905"></a><span id="l6.1905" class="difflineminus">-        &gt;&gt;&gt; a == ConfigObj('test.ini', raise_errors=True)</span>
<a href="#l6.1906"></a><span id="l6.1906" class="difflineminus">-        1</span>
<a href="#l6.1907"></a><span id="l6.1907" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1908"></a><span id="l6.1908" class="difflineminus">-        if self.indent_type is None:</span>
<a href="#l6.1909"></a><span id="l6.1909" class="difflineminus">-            # this can be true if initialised from a dictionary</span>
<a href="#l6.1910"></a><span id="l6.1910" class="difflineminus">-            self.indent_type = DEFAULT_INDENT_TYPE</span>
<a href="#l6.1911"></a><span id="l6.1911" class="difflineminus">-        #</span>
<a href="#l6.1912"></a><span id="l6.1912" class="difflineminus">-        out = []</span>
<a href="#l6.1913"></a><span id="l6.1913" class="difflineminus">-        cs = self._a_to_u('#')</span>
<a href="#l6.1914"></a><span id="l6.1914" class="difflineminus">-        csp = self._a_to_u('# ')</span>
<a href="#l6.1915"></a><span id="l6.1915" class="difflineminus">-        if section is None:</span>
<a href="#l6.1916"></a><span id="l6.1916" class="difflineminus">-            int_val = self.interpolation</span>
<a href="#l6.1917"></a><span id="l6.1917" class="difflineminus">-            self.interpolation = False</span>
<a href="#l6.1918"></a><span id="l6.1918" class="difflineminus">-            section = self</span>
<a href="#l6.1919"></a><span id="l6.1919" class="difflineminus">-            for line in self.initial_comment:</span>
<a href="#l6.1920"></a><span id="l6.1920" class="difflineminus">-                line = self._decode_element(line)</span>
<a href="#l6.1921"></a><span id="l6.1921" class="difflineminus">-                stripped_line = line.strip()</span>
<a href="#l6.1922"></a><span id="l6.1922" class="difflineminus">-                if stripped_line and not stripped_line.startswith(cs):</span>
<a href="#l6.1923"></a><span id="l6.1923" class="difflineminus">-                    line = csp + line</span>
<a href="#l6.1924"></a><span id="l6.1924" class="difflineminus">-                out.append(line)</span>
<a href="#l6.1925"></a><span id="l6.1925" class="difflineminus">-        #</span>
<a href="#l6.1926"></a><span id="l6.1926" class="difflineminus">-        indent_string = self.indent_type * section.depth</span>
<a href="#l6.1927"></a><span id="l6.1927" class="difflineminus">-        for entry in (section.scalars + section.sections):</span>
<a href="#l6.1928"></a><span id="l6.1928" class="difflineminus">-            if entry in section.defaults:</span>
<a href="#l6.1929"></a><span id="l6.1929" class="difflineminus">-                # don't write out default values</span>
<a href="#l6.1930"></a><span id="l6.1930" class="difflineminus">-                continue</span>
<a href="#l6.1931"></a><span id="l6.1931" class="difflineminus">-            for comment_line in section.comments[entry]:</span>
<a href="#l6.1932"></a><span id="l6.1932" class="difflineminus">-                comment_line = self._decode_element(comment_line.lstrip())</span>
<a href="#l6.1933"></a><span id="l6.1933" class="difflineminus">-                if comment_line and not comment_line.startswith(cs):</span>
<a href="#l6.1934"></a><span id="l6.1934" class="difflineminus">-                    comment_line = csp + comment_line</span>
<a href="#l6.1935"></a><span id="l6.1935" class="difflineminus">-                out.append(indent_string + comment_line)</span>
<a href="#l6.1936"></a><span id="l6.1936" class="difflineminus">-            this_entry = section[entry]</span>
<a href="#l6.1937"></a><span id="l6.1937" class="difflineminus">-            comment = self._handle_comment(section.inline_comments[entry])</span>
<a href="#l6.1938"></a><span id="l6.1938" class="difflineminus">-            #</span>
<a href="#l6.1939"></a><span id="l6.1939" class="difflineminus">-            if isinstance(this_entry, dict):</span>
<a href="#l6.1940"></a><span id="l6.1940" class="difflineminus">-                # a section</span>
<a href="#l6.1941"></a><span id="l6.1941" class="difflineminus">-                out.append(self._write_marker(</span>
<a href="#l6.1942"></a><span id="l6.1942" class="difflineminus">-                    indent_string,</span>
<a href="#l6.1943"></a><span id="l6.1943" class="difflineminus">-                    this_entry.depth,</span>
<a href="#l6.1944"></a><span id="l6.1944" class="difflineminus">-                    entry,</span>
<a href="#l6.1945"></a><span id="l6.1945" class="difflineminus">-                    comment))</span>
<a href="#l6.1946"></a><span id="l6.1946" class="difflineminus">-                out.extend(self.write(section=this_entry))</span>
<a href="#l6.1947"></a><span id="l6.1947" class="difflineminus">-            else:</span>
<a href="#l6.1948"></a><span id="l6.1948" class="difflineminus">-                out.append(self._write_line(</span>
<a href="#l6.1949"></a><span id="l6.1949" class="difflineminus">-                    indent_string,</span>
<a href="#l6.1950"></a><span id="l6.1950" class="difflineminus">-                    entry,</span>
<a href="#l6.1951"></a><span id="l6.1951" class="difflineminus">-                    this_entry,</span>
<a href="#l6.1952"></a><span id="l6.1952" class="difflineminus">-                    comment))</span>
<a href="#l6.1953"></a><span id="l6.1953" class="difflineminus">-        #</span>
<a href="#l6.1954"></a><span id="l6.1954" class="difflineminus">-        if section is self:</span>
<a href="#l6.1955"></a><span id="l6.1955" class="difflineminus">-            for line in self.final_comment:</span>
<a href="#l6.1956"></a><span id="l6.1956" class="difflineminus">-                line = self._decode_element(line)</span>
<a href="#l6.1957"></a><span id="l6.1957" class="difflineminus">-                stripped_line = line.strip()</span>
<a href="#l6.1958"></a><span id="l6.1958" class="difflineminus">-                if stripped_line and not stripped_line.startswith(cs):</span>
<a href="#l6.1959"></a><span id="l6.1959" class="difflineminus">-                    line = csp + line</span>
<a href="#l6.1960"></a><span id="l6.1960" class="difflineminus">-                out.append(line)</span>
<a href="#l6.1961"></a><span id="l6.1961" class="difflineminus">-            self.interpolation = int_val</span>
<a href="#l6.1962"></a><span id="l6.1962" class="difflineminus">-        #</span>
<a href="#l6.1963"></a><span id="l6.1963" class="difflineminus">-        if section is not self:</span>
<a href="#l6.1964"></a><span id="l6.1964" class="difflineminus">-            return out</span>
<a href="#l6.1965"></a><span id="l6.1965" class="difflineminus">-        #</span>
<a href="#l6.1966"></a><span id="l6.1966" class="difflineminus">-        if (self.filename is None) and (outfile is None):</span>
<a href="#l6.1967"></a><span id="l6.1967" class="difflineminus">-            # output a list of lines</span>
<a href="#l6.1968"></a><span id="l6.1968" class="difflineminus">-            # might need to encode</span>
<a href="#l6.1969"></a><span id="l6.1969" class="difflineminus">-            # NOTE: This will *screw* UTF16, each line will start with the BOM</span>
<a href="#l6.1970"></a><span id="l6.1970" class="difflineminus">-            if self.encoding:</span>
<a href="#l6.1971"></a><span id="l6.1971" class="difflineminus">-                out = [l.encode(self.encoding) for l in out]</span>
<a href="#l6.1972"></a><span id="l6.1972" class="difflineminus">-            if (self.BOM and ((self.encoding is None) or</span>
<a href="#l6.1973"></a><span id="l6.1973" class="difflineminus">-                (BOM_LIST.get(self.encoding.lower()) == 'utf_8'))):</span>
<a href="#l6.1974"></a><span id="l6.1974" class="difflineminus">-                # Add the UTF8 BOM</span>
<a href="#l6.1975"></a><span id="l6.1975" class="difflineminus">-                if not out:</span>
<a href="#l6.1976"></a><span id="l6.1976" class="difflineminus">-                    out.append('')</span>
<a href="#l6.1977"></a><span id="l6.1977" class="difflineminus">-                out[0] = BOM_UTF8 + out[0]</span>
<a href="#l6.1978"></a><span id="l6.1978" class="difflineminus">-            return out</span>
<a href="#l6.1979"></a><span id="l6.1979" class="difflineminus">-        #</span>
<a href="#l6.1980"></a><span id="l6.1980" class="difflineminus">-        # Turn the list to a string, joined with correct newlines</span>
<a href="#l6.1981"></a><span id="l6.1981" class="difflineminus">-        output = (self._a_to_u(self.newlines or os.linesep)</span>
<a href="#l6.1982"></a><span id="l6.1982" class="difflineminus">-            ).join(out)</span>
<a href="#l6.1983"></a><span id="l6.1983" class="difflineminus">-        if self.encoding:</span>
<a href="#l6.1984"></a><span id="l6.1984" class="difflineminus">-            output = output.encode(self.encoding)</span>
<a href="#l6.1985"></a><span id="l6.1985" class="difflineminus">-        if (self.BOM and ((self.encoding is None) or</span>
<a href="#l6.1986"></a><span id="l6.1986" class="difflineminus">-            (BOM_LIST.get(self.encoding.lower()) == 'utf_8'))):</span>
<a href="#l6.1987"></a><span id="l6.1987" class="difflineminus">-            # Add the UTF8 BOM</span>
<a href="#l6.1988"></a><span id="l6.1988" class="difflineminus">-            output = BOM_UTF8 + output</span>
<a href="#l6.1989"></a><span id="l6.1989" class="difflineminus">-        if outfile is not None:</span>
<a href="#l6.1990"></a><span id="l6.1990" class="difflineminus">-            outfile.write(output)</span>
<a href="#l6.1991"></a><span id="l6.1991" class="difflineminus">-        else:</span>
<a href="#l6.1992"></a><span id="l6.1992" class="difflineminus">-            h = open(self.filename, 'wb')</span>
<a href="#l6.1993"></a><span id="l6.1993" class="difflineminus">-            h.write(output)</span>
<a href="#l6.1994"></a><span id="l6.1994" class="difflineminus">-            h.close()</span>
<a href="#l6.1995"></a><span id="l6.1995" class="difflineminus">-</span>
<a href="#l6.1996"></a><span id="l6.1996" class="difflineminus">-    def validate(self, validator, preserve_errors=False, copy=False,</span>
<a href="#l6.1997"></a><span id="l6.1997" class="difflineminus">-        section=None):</span>
<a href="#l6.1998"></a><span id="l6.1998" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.1999"></a><span id="l6.1999" class="difflineminus">-        Test the ConfigObj against a configspec.</span>
<a href="#l6.2000"></a><span id="l6.2000" class="difflineminus">-        </span>
<a href="#l6.2001"></a><span id="l6.2001" class="difflineminus">-        It uses the ``validator`` object from *validate.py*.</span>
<a href="#l6.2002"></a><span id="l6.2002" class="difflineminus">-        </span>
<a href="#l6.2003"></a><span id="l6.2003" class="difflineminus">-        To run ``validate`` on the current ConfigObj, call: ::</span>
<a href="#l6.2004"></a><span id="l6.2004" class="difflineminus">-        </span>
<a href="#l6.2005"></a><span id="l6.2005" class="difflineminus">-            test = config.validate(validator)</span>
<a href="#l6.2006"></a><span id="l6.2006" class="difflineminus">-        </span>
<a href="#l6.2007"></a><span id="l6.2007" class="difflineminus">-        (Normally having previously passed in the configspec when the ConfigObj</span>
<a href="#l6.2008"></a><span id="l6.2008" class="difflineminus">-        was created - you can dynamically assign a dictionary of checks to the</span>
<a href="#l6.2009"></a><span id="l6.2009" class="difflineminus">-        ``configspec`` attribute of a section though).</span>
<a href="#l6.2010"></a><span id="l6.2010" class="difflineminus">-        </span>
<a href="#l6.2011"></a><span id="l6.2011" class="difflineminus">-        It returns ``True`` if everything passes, or a dictionary of</span>
<a href="#l6.2012"></a><span id="l6.2012" class="difflineminus">-        pass/fails (True/False). If every member of a subsection passes, it</span>
<a href="#l6.2013"></a><span id="l6.2013" class="difflineminus">-        will just have the value ``True``. (It also returns ``False`` if all</span>
<a href="#l6.2014"></a><span id="l6.2014" class="difflineminus">-        members fail).</span>
<a href="#l6.2015"></a><span id="l6.2015" class="difflineminus">-        </span>
<a href="#l6.2016"></a><span id="l6.2016" class="difflineminus">-        In addition, it converts the values from strings to their native</span>
<a href="#l6.2017"></a><span id="l6.2017" class="difflineminus">-        types if their checks pass (and ``stringify`` is set).</span>
<a href="#l6.2018"></a><span id="l6.2018" class="difflineminus">-        </span>
<a href="#l6.2019"></a><span id="l6.2019" class="difflineminus">-        If ``preserve_errors`` is ``True`` (``False`` is default) then instead</span>
<a href="#l6.2020"></a><span id="l6.2020" class="difflineminus">-        of a marking a fail with a ``False``, it will preserve the actual</span>
<a href="#l6.2021"></a><span id="l6.2021" class="difflineminus">-        exception object. This can contain info about the reason for failure.</span>
<a href="#l6.2022"></a><span id="l6.2022" class="difflineminus">-        For example the ``VdtValueTooSmallError`` indeicates that the value</span>
<a href="#l6.2023"></a><span id="l6.2023" class="difflineminus">-        supplied was too small. If a value (or section) is missing it will</span>
<a href="#l6.2024"></a><span id="l6.2024" class="difflineminus">-        still be marked as ``False``.</span>
<a href="#l6.2025"></a><span id="l6.2025" class="difflineminus">-        </span>
<a href="#l6.2026"></a><span id="l6.2026" class="difflineminus">-        You must have the validate module to use ``preserve_errors=True``.</span>
<a href="#l6.2027"></a><span id="l6.2027" class="difflineminus">-        </span>
<a href="#l6.2028"></a><span id="l6.2028" class="difflineminus">-        You can then use the ``flatten_errors`` function to turn your nested</span>
<a href="#l6.2029"></a><span id="l6.2029" class="difflineminus">-        results dictionary into a flattened list of failures - useful for</span>
<a href="#l6.2030"></a><span id="l6.2030" class="difflineminus">-        displaying meaningful error messages.</span>
<a href="#l6.2031"></a><span id="l6.2031" class="difflineminus">-        &quot;&quot;&quot;</span>
<a href="#l6.2032"></a><span id="l6.2032" class="difflineminus">-        if section is None:</span>
<a href="#l6.2033"></a><span id="l6.2033" class="difflineminus">-            if self.configspec is None:</span>
<a href="#l6.2034"></a><span id="l6.2034" class="difflineminus">-                raise ValueError, 'No configspec supplied.'</span>
<a href="#l6.2035"></a><span id="l6.2035" class="difflineminus">-            if preserve_errors:</span>
<a href="#l6.2036"></a><span id="l6.2036" class="difflineminus">-                if VdtMissingValue is None:</span>
<a href="#l6.2037"></a><span id="l6.2037" class="difflineminus">-                    raise ImportError('Missing validate module.')</span>
<a href="#l6.2038"></a><span id="l6.2038" class="difflineminus">-            section = self</span>
<a href="#l6.2039"></a><span id="l6.2039" class="difflineminus">-        #</span>
<a href="#l6.2040"></a><span id="l6.2040" class="difflineminus">-        spec_section = section.configspec</span>
<a href="#l6.2041"></a><span id="l6.2041" class="difflineminus">-        if copy and hasattr(section, '_configspec_initial_comment'):</span>
<a href="#l6.2042"></a><span id="l6.2042" class="difflineminus">-            section.initial_comment = section._configspec_initial_comment</span>
<a href="#l6.2043"></a><span id="l6.2043" class="difflineminus">-            section.final_comment = section._configspec_final_comment</span>
<a href="#l6.2044"></a><span id="l6.2044" class="difflineminus">-            section.encoding = section._configspec_encoding</span>
<a href="#l6.2045"></a><span id="l6.2045" class="difflineminus">-            section.BOM = section._configspec_BOM</span>
<a href="#l6.2046"></a><span id="l6.2046" class="difflineminus">-            section.newlines = section._configspec_newlines</span>
<a href="#l6.2047"></a><span id="l6.2047" class="difflineminus">-            section.indent_type = section._configspec_indent_type</span>
<a href="#l6.2048"></a><span id="l6.2048" class="difflineminus">-        if '__many__' in section.configspec:</span>
<a href="#l6.2049"></a><span id="l6.2049" class="difflineminus">-            many = spec_section['__many__']</span>
<a href="#l6.2050"></a><span id="l6.2050" class="difflineminus">-            # dynamically assign the configspecs</span>
<a href="#l6.2051"></a><span id="l6.2051" class="difflineminus">-            # for the sections below</span>
<a href="#l6.2052"></a><span id="l6.2052" class="difflineminus">-            for entry in section.sections:</span>
<a href="#l6.2053"></a><span id="l6.2053" class="difflineminus">-                self._handle_repeat(section[entry], many)</span>
<a href="#l6.2054"></a><span id="l6.2054" class="difflineminus">-        #</span>
<a href="#l6.2055"></a><span id="l6.2055" class="difflineminus">-        out = {}</span>
<a href="#l6.2056"></a><span id="l6.2056" class="difflineminus">-        ret_true = True</span>
<a href="#l6.2057"></a><span id="l6.2057" class="difflineminus">-        ret_false = True</span>
<a href="#l6.2058"></a><span id="l6.2058" class="difflineminus">-        order = [k for k in section._order if k in spec_section]</span>
<a href="#l6.2059"></a><span id="l6.2059" class="difflineminus">-        order += [k for k in spec_section if k not in order]</span>
<a href="#l6.2060"></a><span id="l6.2060" class="difflineminus">-        for entry in order:</span>
<a href="#l6.2061"></a><span id="l6.2061" class="difflineminus">-            if entry == '__many__':</span>
<a href="#l6.2062"></a><span id="l6.2062" class="difflineminus">-                continue</span>
<a href="#l6.2063"></a><span id="l6.2063" class="difflineminus">-            if (not entry in section.scalars) or (entry in section.defaults):</span>
<a href="#l6.2064"></a><span id="l6.2064" class="difflineminus">-                # missing entries</span>
<a href="#l6.2065"></a><span id="l6.2065" class="difflineminus">-                # or entries from defaults</span>
<a href="#l6.2066"></a><span id="l6.2066" class="difflineminus">-                missing = True</span>
<a href="#l6.2067"></a><span id="l6.2067" class="difflineminus">-                val = None</span>
<a href="#l6.2068"></a><span id="l6.2068" class="difflineminus">-                if copy and not entry in section.scalars:</span>
<a href="#l6.2069"></a><span id="l6.2069" class="difflineminus">-                    # copy comments</span>
<a href="#l6.2070"></a><span id="l6.2070" class="difflineminus">-                    section.comments[entry] = (</span>
<a href="#l6.2071"></a><span id="l6.2071" class="difflineminus">-                        section._configspec_comments.get(entry, []))</span>
<a href="#l6.2072"></a><span id="l6.2072" class="difflineminus">-                    section.inline_comments[entry] = (</span>
<a href="#l6.2073"></a><span id="l6.2073" class="difflineminus">-                        section._configspec_inline_comments.get(entry, ''))</span>
<a href="#l6.2074"></a><span id="l6.2074" class="difflineminus">-                #</span>
<a href="#l6.2075"></a><span id="l6.2075" class="difflineminus">-            else:</span>
<a href="#l6.2076"></a><span id="l6.2076" class="difflineminus">-                missing = False</span>
<a href="#l6.2077"></a><span id="l6.2077" class="difflineminus">-                val = section[entry]</span>
<a href="#l6.2078"></a><span id="l6.2078" class="difflineminus">-            try:</span>
<a href="#l6.2079"></a><span id="l6.2079" class="difflineminus">-                check = validator.check(spec_section[entry],</span>
<a href="#l6.2080"></a><span id="l6.2080" class="difflineminus">-                                        val,</span>
<a href="#l6.2081"></a><span id="l6.2081" class="difflineminus">-                                        missing=missing</span>
<a href="#l6.2082"></a><span id="l6.2082" class="difflineminus">-                                        )</span>
<a href="#l6.2083"></a><span id="l6.2083" class="difflineminus">-            except validator.baseErrorClass, e:</span>
<a href="#l6.2084"></a><span id="l6.2084" class="difflineminus">-                if not preserve_errors or isinstance(e, VdtMissingValue):</span>
<a href="#l6.2085"></a><span id="l6.2085" class="difflineminus">-                    out[entry] = False</span>
<a href="#l6.2086"></a><span id="l6.2086" class="difflineminus">-                else:</span>
<a href="#l6.2087"></a><span id="l6.2087" class="difflineminus">-                    # preserve the error</span>
<a href="#l6.2088"></a><span id="l6.2088" class="difflineminus">-                    out[entry] = e</span>
<a href="#l6.2089"></a><span id="l6.2089" class="difflineminus">-                    ret_false = False</span>
<a href="#l6.2090"></a><span id="l6.2090" class="difflineminus">-                ret_true = False</span>
<a href="#l6.2091"></a><span id="l6.2091" class="difflineminus">-            else:</span>
<a href="#l6.2092"></a><span id="l6.2092" class="difflineminus">-                ret_false = False</span>
<a href="#l6.2093"></a><span id="l6.2093" class="difflineminus">-                out[entry] = True</span>
<a href="#l6.2094"></a><span id="l6.2094" class="difflineminus">-                if self.stringify or missing:</span>
<a href="#l6.2095"></a><span id="l6.2095" class="difflineminus">-                    # if we are doing type conversion</span>
<a href="#l6.2096"></a><span id="l6.2096" class="difflineminus">-                    # or the value is a supplied default</span>
<a href="#l6.2097"></a><span id="l6.2097" class="difflineminus">-                    if not self.stringify:</span>
<a href="#l6.2098"></a><span id="l6.2098" class="difflineminus">-                        if isinstance(check, (list, tuple)):</span>
<a href="#l6.2099"></a><span id="l6.2099" class="difflineminus">-                            # preserve lists</span>
<a href="#l6.2100"></a><span id="l6.2100" class="difflineminus">-                            check = [self._str(item) for item in check]</span>
<a href="#l6.2101"></a><span id="l6.2101" class="difflineminus">-                        elif missing and check is None:</span>
<a href="#l6.2102"></a><span id="l6.2102" class="difflineminus">-                            # convert the None from a default to a ''</span>
<a href="#l6.2103"></a><span id="l6.2103" class="difflineminus">-                            check = ''</span>
<a href="#l6.2104"></a><span id="l6.2104" class="difflineminus">-                        else:</span>
<a href="#l6.2105"></a><span id="l6.2105" class="difflineminus">-                            check = self._str(check)</span>
<a href="#l6.2106"></a><span id="l6.2106" class="difflineminus">-                    if (check != val) or missing:</span>
<a href="#l6.2107"></a><span id="l6.2107" class="difflineminus">-                        section[entry] = check</span>
<a href="#l6.2108"></a><span id="l6.2108" class="difflineminus">-                if not copy and missing and entry not in section.defaults:</span>
<a href="#l6.2109"></a><span id="l6.2109" class="difflineminus">-                    section.defaults.append(entry)</span>
<a href="#l6.2110"></a><span id="l6.2110" class="difflineminus">-        #</span>
<a href="#l6.2111"></a><span id="l6.2111" class="difflineminus">-        # Missing sections will have been created as empty ones when the</span>
<a href="#l6.2112"></a><span id="l6.2112" class="difflineminus">-        # configspec was read.</span>
<a href="#l6.2113"></a><span id="l6.2113" class="difflineminus">-        for entry in section.sections:</span>
<a href="#l6.2114"></a><span id="l6.2114" class="difflineminus">-            # FIXME: this means DEFAULT is not copied in copy mode</span>
<a href="#l6.2115"></a><span id="l6.2115" class="difflineminus">-            if section is self and entry == 'DEFAULT':</span>
<a href="#l6.2116"></a><span id="l6.2116" class="difflineminus">-                continue</span>
<a href="#l6.2117"></a><span id="l6.2117" class="difflineminus">-            if copy:</span>
<a href="#l6.2118"></a><span id="l6.2118" class="difflineminus">-                section.comments[entry] = section._cs_section_comments[entry]</span>
<a href="#l6.2119"></a><span id="l6.2119" class="difflineminus">-                section.inline_comments[entry] = (</span>
<a href="#l6.2120"></a><span id="l6.2120" class="difflineminus">-                    section._cs_section_inline_comments[entry])</span>
<a href="#l6.2121"></a><span id="l6.2121" class="difflineminus">-            check = self.validate(validator, preserve_errors=preserve_errors,</span>
<a href="#l6.2122"></a><span id="l6.2122" class="difflineminus">-                copy=copy, section=section[entry])</span>
<a href="#l6.2123"></a><span id="l6.2123" class="difflineminus">-            out[entry] = check</span>
<a href="#l6.2124"></a><span id="l6.2124" class="difflineminus">-            if check == False:</span>
<a href="#l6.2125"></a><span id="l6.2125" class="difflineminus">-                ret_true = False</span>
<a href="#l6.2126"></a><span id="l6.2126" class="difflineminus">-            elif check == True:</span>
<a href="#l6.2127"></a><span id="l6.2127" class="difflineminus">-                ret_false = False</span>
<a href="#l6.2128"></a><span id="l6.2128" class="difflineminus">-            else:</span>
<a href="#l6.2129"></a><span id="l6.2129" class="difflineminus">-                ret_true = False</span>
<a href="#l6.2130"></a><span id="l6.2130" class="difflineminus">-                ret_false = False</span>
<a href="#l6.2131"></a><span id="l6.2131" class="difflineminus">-        #</span>
<a href="#l6.2132"></a><span id="l6.2132" class="difflineminus">-        if ret_true:</span>
<a href="#l6.2133"></a><span id="l6.2133" class="difflineminus">-            return True</span>
<a href="#l6.2134"></a><span id="l6.2134" class="difflineminus">-        elif ret_false:</span>
<a href="#l6.2135"></a><span id="l6.2135" class="difflineminus">-            return False</span>
<a href="#l6.2136"></a><span id="l6.2136" class="difflineminus">-        else:</span>
<a href="#l6.2137"></a><span id="l6.2137" class="difflineminus">-            return out</span>
<a href="#l6.2138"></a><span id="l6.2138" class="difflineminus">-</span>
<a href="#l6.2139"></a><span id="l6.2139" class="difflineminus">-class SimpleVal(object):</span>
<a href="#l6.2140"></a><span id="l6.2140" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.2141"></a><span id="l6.2141" class="difflineminus">-    A simple validator.</span>
<a href="#l6.2142"></a><span id="l6.2142" class="difflineminus">-    Can be used to check that all members expected are present.</span>
<a href="#l6.2143"></a><span id="l6.2143" class="difflineminus">-    </span>
<a href="#l6.2144"></a><span id="l6.2144" class="difflineminus">-    To use it, provide a configspec with all your members in (the value given</span>
<a href="#l6.2145"></a><span id="l6.2145" class="difflineminus">-    will be ignored). Pass an instance of ``SimpleVal`` to the ``validate``</span>
<a href="#l6.2146"></a><span id="l6.2146" class="difflineminus">-    method of your ``ConfigObj``. ``validate`` will return ``True`` if all</span>
<a href="#l6.2147"></a><span id="l6.2147" class="difflineminus">-    members are present, or a dictionary with True/False meaning</span>
<a href="#l6.2148"></a><span id="l6.2148" class="difflineminus">-    present/missing. (Whole missing sections will be replaced with ``False``)</span>
<a href="#l6.2149"></a><span id="l6.2149" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.2150"></a><span id="l6.2150" class="difflineminus">-    </span>
<a href="#l6.2151"></a><span id="l6.2151" class="difflineminus">-    def __init__(self):</span>
<a href="#l6.2152"></a><span id="l6.2152" class="difflineminus">-        self.baseErrorClass = ConfigObjError</span>
<a href="#l6.2153"></a><span id="l6.2153" class="difflineminus">-    </span>
<a href="#l6.2154"></a><span id="l6.2154" class="difflineminus">-    def check(self, check, member, missing=False):</span>
<a href="#l6.2155"></a><span id="l6.2155" class="difflineminus">-        &quot;&quot;&quot;A dummy check method, always returns the value unchanged.&quot;&quot;&quot;</span>
<a href="#l6.2156"></a><span id="l6.2156" class="difflineminus">-        if missing:</span>
<a href="#l6.2157"></a><span id="l6.2157" class="difflineminus">-            raise self.baseErrorClass</span>
<a href="#l6.2158"></a><span id="l6.2158" class="difflineminus">-        return member</span>
<a href="#l6.2159"></a><span id="l6.2159" class="difflineminus">-</span>
<a href="#l6.2160"></a><span id="l6.2160" class="difflineminus">-# Check / processing functions for options</span>
<a href="#l6.2161"></a><span id="l6.2161" class="difflineminus">-def flatten_errors(cfg, res, levels=None, results=None):</span>
<a href="#l6.2162"></a><span id="l6.2162" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.2163"></a><span id="l6.2163" class="difflineminus">-    An example function that will turn a nested dictionary of results</span>
<a href="#l6.2164"></a><span id="l6.2164" class="difflineminus">-    (as returned by ``ConfigObj.validate``) into a flat list.</span>
<a href="#l6.2165"></a><span id="l6.2165" class="difflineminus">-    </span>
<a href="#l6.2166"></a><span id="l6.2166" class="difflineminus">-    ``cfg`` is the ConfigObj instance being checked, ``res`` is the results</span>
<a href="#l6.2167"></a><span id="l6.2167" class="difflineminus">-    dictionary returned by ``validate``.</span>
<a href="#l6.2168"></a><span id="l6.2168" class="difflineminus">-    </span>
<a href="#l6.2169"></a><span id="l6.2169" class="difflineminus">-    (This is a recursive function, so you shouldn't use the ``levels`` or</span>
<a href="#l6.2170"></a><span id="l6.2170" class="difflineminus">-    ``results`` arguments - they are used by the function.</span>
<a href="#l6.2171"></a><span id="l6.2171" class="difflineminus">-    </span>
<a href="#l6.2172"></a><span id="l6.2172" class="difflineminus">-    Returns a list of keys that failed. Each member of the list is a tuple :</span>
<a href="#l6.2173"></a><span id="l6.2173" class="difflineminus">-    ::</span>
<a href="#l6.2174"></a><span id="l6.2174" class="difflineminus">-    </span>
<a href="#l6.2175"></a><span id="l6.2175" class="difflineminus">-        ([list of sections...], key, result)</span>
<a href="#l6.2176"></a><span id="l6.2176" class="difflineminus">-    </span>
<a href="#l6.2177"></a><span id="l6.2177" class="difflineminus">-    If ``validate`` was called with ``preserve_errors=False`` (the default)</span>
<a href="#l6.2178"></a><span id="l6.2178" class="difflineminus">-    then ``result`` will always be ``False``.</span>
<a href="#l6.2179"></a><span id="l6.2179" class="difflineminus">-</span>
<a href="#l6.2180"></a><span id="l6.2180" class="difflineminus">-    *list of sections* is a flattened list of sections that the key was found</span>
<a href="#l6.2181"></a><span id="l6.2181" class="difflineminus">-    in.</span>
<a href="#l6.2182"></a><span id="l6.2182" class="difflineminus">-    </span>
<a href="#l6.2183"></a><span id="l6.2183" class="difflineminus">-    If the section was missing then key will be ``None``.</span>
<a href="#l6.2184"></a><span id="l6.2184" class="difflineminus">-    </span>
<a href="#l6.2185"></a><span id="l6.2185" class="difflineminus">-    If the value (or section) was missing then ``result`` will be ``False``.</span>
<a href="#l6.2186"></a><span id="l6.2186" class="difflineminus">-    </span>
<a href="#l6.2187"></a><span id="l6.2187" class="difflineminus">-    If ``validate`` was called with ``preserve_errors=True`` and a value</span>
<a href="#l6.2188"></a><span id="l6.2188" class="difflineminus">-    was present, but failed the check, then ``result`` will be the exception</span>
<a href="#l6.2189"></a><span id="l6.2189" class="difflineminus">-    object returned. You can use this as a string that describes the failure.</span>
<a href="#l6.2190"></a><span id="l6.2190" class="difflineminus">-    </span>
<a href="#l6.2191"></a><span id="l6.2191" class="difflineminus">-    For example *The value &quot;3&quot; is of the wrong type*.</span>
<a href="#l6.2192"></a><span id="l6.2192" class="difflineminus">-    </span>
<a href="#l6.2193"></a><span id="l6.2193" class="difflineminus">-    &gt;&gt;&gt; import validate</span>
<a href="#l6.2194"></a><span id="l6.2194" class="difflineminus">-    &gt;&gt;&gt; vtor = validate.Validator()</span>
<a href="#l6.2195"></a><span id="l6.2195" class="difflineminus">-    &gt;&gt;&gt; my_ini = '''</span>
<a href="#l6.2196"></a><span id="l6.2196" class="difflineminus">-    ...     option1 = True</span>
<a href="#l6.2197"></a><span id="l6.2197" class="difflineminus">-    ...     [section1]</span>
<a href="#l6.2198"></a><span id="l6.2198" class="difflineminus">-    ...     option1 = True</span>
<a href="#l6.2199"></a><span id="l6.2199" class="difflineminus">-    ...     [section2]</span>
<a href="#l6.2200"></a><span id="l6.2200" class="difflineminus">-    ...     another_option = Probably</span>
<a href="#l6.2201"></a><span id="l6.2201" class="difflineminus">-    ...     [section3]</span>
<a href="#l6.2202"></a><span id="l6.2202" class="difflineminus">-    ...     another_option = True</span>
<a href="#l6.2203"></a><span id="l6.2203" class="difflineminus">-    ...     [[section3b]]</span>
<a href="#l6.2204"></a><span id="l6.2204" class="difflineminus">-    ...     value = 3</span>
<a href="#l6.2205"></a><span id="l6.2205" class="difflineminus">-    ...     value2 = a</span>
<a href="#l6.2206"></a><span id="l6.2206" class="difflineminus">-    ...     value3 = 11</span>
<a href="#l6.2207"></a><span id="l6.2207" class="difflineminus">-    ...     '''</span>
<a href="#l6.2208"></a><span id="l6.2208" class="difflineminus">-    &gt;&gt;&gt; my_cfg = '''</span>
<a href="#l6.2209"></a><span id="l6.2209" class="difflineminus">-    ...     option1 = boolean()</span>
<a href="#l6.2210"></a><span id="l6.2210" class="difflineminus">-    ...     option2 = boolean()</span>
<a href="#l6.2211"></a><span id="l6.2211" class="difflineminus">-    ...     option3 = boolean(default=Bad_value)</span>
<a href="#l6.2212"></a><span id="l6.2212" class="difflineminus">-    ...     [section1]</span>
<a href="#l6.2213"></a><span id="l6.2213" class="difflineminus">-    ...     option1 = boolean()</span>
<a href="#l6.2214"></a><span id="l6.2214" class="difflineminus">-    ...     option2 = boolean()</span>
<a href="#l6.2215"></a><span id="l6.2215" class="difflineminus">-    ...     option3 = boolean(default=Bad_value)</span>
<a href="#l6.2216"></a><span id="l6.2216" class="difflineminus">-    ...     [section2]</span>
<a href="#l6.2217"></a><span id="l6.2217" class="difflineminus">-    ...     another_option = boolean()</span>
<a href="#l6.2218"></a><span id="l6.2218" class="difflineminus">-    ...     [section3]</span>
<a href="#l6.2219"></a><span id="l6.2219" class="difflineminus">-    ...     another_option = boolean()</span>
<a href="#l6.2220"></a><span id="l6.2220" class="difflineminus">-    ...     [[section3b]]</span>
<a href="#l6.2221"></a><span id="l6.2221" class="difflineminus">-    ...     value = integer</span>
<a href="#l6.2222"></a><span id="l6.2222" class="difflineminus">-    ...     value2 = integer</span>
<a href="#l6.2223"></a><span id="l6.2223" class="difflineminus">-    ...     value3 = integer(0, 10)</span>
<a href="#l6.2224"></a><span id="l6.2224" class="difflineminus">-    ...         [[[section3b-sub]]]</span>
<a href="#l6.2225"></a><span id="l6.2225" class="difflineminus">-    ...         value = string</span>
<a href="#l6.2226"></a><span id="l6.2226" class="difflineminus">-    ...     [section4]</span>
<a href="#l6.2227"></a><span id="l6.2227" class="difflineminus">-    ...     another_option = boolean()</span>
<a href="#l6.2228"></a><span id="l6.2228" class="difflineminus">-    ...     '''</span>
<a href="#l6.2229"></a><span id="l6.2229" class="difflineminus">-    &gt;&gt;&gt; cs = my_cfg.split('\\n')</span>
<a href="#l6.2230"></a><span id="l6.2230" class="difflineminus">-    &gt;&gt;&gt; ini = my_ini.split('\\n')</span>
<a href="#l6.2231"></a><span id="l6.2231" class="difflineminus">-    &gt;&gt;&gt; cfg = ConfigObj(ini, configspec=cs)</span>
<a href="#l6.2232"></a><span id="l6.2232" class="difflineminus">-    &gt;&gt;&gt; res = cfg.validate(vtor, preserve_errors=True)</span>
<a href="#l6.2233"></a><span id="l6.2233" class="difflineminus">-    &gt;&gt;&gt; errors = []</span>
<a href="#l6.2234"></a><span id="l6.2234" class="difflineminus">-    &gt;&gt;&gt; for entry in flatten_errors(cfg, res):</span>
<a href="#l6.2235"></a><span id="l6.2235" class="difflineminus">-    ...     section_list, key, error = entry</span>
<a href="#l6.2236"></a><span id="l6.2236" class="difflineminus">-    ...     section_list.insert(0, '[root]')</span>
<a href="#l6.2237"></a><span id="l6.2237" class="difflineminus">-    ...     if key is not None:</span>
<a href="#l6.2238"></a><span id="l6.2238" class="difflineminus">-    ...        section_list.append(key)</span>
<a href="#l6.2239"></a><span id="l6.2239" class="difflineminus">-    ...     else:</span>
<a href="#l6.2240"></a><span id="l6.2240" class="difflineminus">-    ...         section_list.append('[missing]')</span>
<a href="#l6.2241"></a><span id="l6.2241" class="difflineminus">-    ...     section_string = ', '.join(section_list)</span>
<a href="#l6.2242"></a><span id="l6.2242" class="difflineminus">-    ...     errors.append((section_string, ' = ', error))</span>
<a href="#l6.2243"></a><span id="l6.2243" class="difflineminus">-    &gt;&gt;&gt; errors.sort()</span>
<a href="#l6.2244"></a><span id="l6.2244" class="difflineminus">-    &gt;&gt;&gt; for entry in errors:</span>
<a href="#l6.2245"></a><span id="l6.2245" class="difflineminus">-    ...     print entry[0], entry[1], (entry[2] or 0)</span>
<a href="#l6.2246"></a><span id="l6.2246" class="difflineminus">-    [root], option2  =  0</span>
<a href="#l6.2247"></a><span id="l6.2247" class="difflineminus">-    [root], option3  =  the value &quot;Bad_value&quot; is of the wrong type.</span>
<a href="#l6.2248"></a><span id="l6.2248" class="difflineminus">-    [root], section1, option2  =  0</span>
<a href="#l6.2249"></a><span id="l6.2249" class="difflineminus">-    [root], section1, option3  =  the value &quot;Bad_value&quot; is of the wrong type.</span>
<a href="#l6.2250"></a><span id="l6.2250" class="difflineminus">-    [root], section2, another_option  =  the value &quot;Probably&quot; is of the wrong type.</span>
<a href="#l6.2251"></a><span id="l6.2251" class="difflineminus">-    [root], section3, section3b, section3b-sub, [missing]  =  0</span>
<a href="#l6.2252"></a><span id="l6.2252" class="difflineminus">-    [root], section3, section3b, value2  =  the value &quot;a&quot; is of the wrong type.</span>
<a href="#l6.2253"></a><span id="l6.2253" class="difflineminus">-    [root], section3, section3b, value3  =  the value &quot;11&quot; is too big.</span>
<a href="#l6.2254"></a><span id="l6.2254" class="difflineminus">-    [root], section4, [missing]  =  0</span>
<a href="#l6.2255"></a><span id="l6.2255" class="difflineminus">-    &quot;&quot;&quot;</span>
<a href="#l6.2256"></a><span id="l6.2256" class="difflineminus">-    if levels is None:</span>
<a href="#l6.2257"></a><span id="l6.2257" class="difflineminus">-        # first time called</span>
<a href="#l6.2258"></a><span id="l6.2258" class="difflineminus">-        levels = []</span>
<a href="#l6.2259"></a><span id="l6.2259" class="difflineminus">-        results = []</span>
<a href="#l6.2260"></a><span id="l6.2260" class="difflineminus">-    if res is True:</span>
<a href="#l6.2261"></a><span id="l6.2261" class="difflineminus">-        return results</span>
<a href="#l6.2262"></a><span id="l6.2262" class="difflineminus">-    if res is False:</span>
<a href="#l6.2263"></a><span id="l6.2263" class="difflineminus">-        results.append((levels[:], None, False))</span>
<a href="#l6.2264"></a><span id="l6.2264" class="difflineminus">-        if levels:</span>
<a href="#l6.2265"></a><span id="l6.2265" class="difflineminus">-            levels.pop()</span>
<a href="#l6.2266"></a><span id="l6.2266" class="difflineminus">-        return results</span>
<a href="#l6.2267"></a><span id="l6.2267" class="difflineminus">-    for (key, val) in res.items():</span>
<a href="#l6.2268"></a><span id="l6.2268" class="difflineminus">-        if val == True:</span>
<a href="#l6.2269"></a><span id="l6.2269" class="difflineminus">-            continue</span>
<a href="#l6.2270"></a><span id="l6.2270" class="difflineminus">-        if isinstance(cfg.get(key), dict):</span>
<a href="#l6.2271"></a><span id="l6.2271" class="difflineminus">-            # Go down one level</span>
<a href="#l6.2272"></a><span id="l6.2272" class="difflineminus">-            levels.append(key)</span>
<a href="#l6.2273"></a><span id="l6.2273" class="difflineminus">-            flatten_errors(cfg[key], val, levels, results)</span>
<a href="#l6.2274"></a><span id="l6.2274" class="difflineminus">-            continue</span>
<a href="#l6.2275"></a><span id="l6.2275" class="difflineminus">-        results.append((levels[:], key, val))</span>
<a href="#l6.2276"></a><span id="l6.2276" class="difflineminus">-    #</span>
<a href="#l6.2277"></a><span id="l6.2277" class="difflineminus">-    # Go up one level</span>
<a href="#l6.2278"></a><span id="l6.2278" class="difflineminus">-    if levels:</span>
<a href="#l6.2279"></a><span id="l6.2279" class="difflineminus">-        levels.pop()</span>
<a href="#l6.2280"></a><span id="l6.2280" class="difflineminus">-    #</span>
<a href="#l6.2281"></a><span id="l6.2281" class="difflineminus">-    return results</span>
<a href="#l6.2282"></a><span id="l6.2282" class="difflineminus">-</span>
<a href="#l6.2283"></a><span id="l6.2283" class="difflineminus">-&quot;&quot;&quot;*A programming language is a medium of expression.* - Paul Graham&quot;&quot;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">deleted file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- a/config/makefiles/autotargets.mk</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ /dev/null</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -1,94 +0,0 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">-# -*- makefile -*-</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">-# vim:set ts=8 sw=8 sts=8 noet:</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">-#</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-# You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">-#</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-ifndef INCLUDED_AUTOTARGETS_MK #{</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-# Conditional does not wrap the entire file so multiple</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-# includes will be able to accumulate dependencies.</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-###########################################################################</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-#      AUTO_DEPS - A list of deps/targets drived from other macros.</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-###########################################################################</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-MKDIR ?= mkdir -p</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-TOUCH ?= touch</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-# declare for local use, rules.mk may not have been loaded</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-space = $(NULL) $(NULL)</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-# Deps will be considered intermediate when used as a pre-requisite for</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-# wildcard targets.  Inhibit their removal, mkdir -p is a standalone op.</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-.PRECIOUS: %/.mkdir.done</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-#########################</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-##---]  FUNCTIONS  [---##</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-#########################</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-# Squeeze can be overzealous, restore root for abspath</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-getPathPrefix =$(if $(filter /%,$(1)),/)</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-# Squeeze '//' from the path, easily created by string functions</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-_slashSqueeze =$(foreach val,$(getargv),$(call getPathPrefix,$(val))$(subst $(space),/,$(strip $(subst /,$(space),$(val)))))</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineminus">-# Squeeze extraneous directory slashes from the path</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-#  o protect embedded spaces within the path</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-#  o replace //+ sequences with /</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-slash_strip = \</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-  $(strip \</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-    $(subst &lt;--[**]--&gt;,$(space),\</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-	$(call _slashSqueeze,\</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-    $(subst $(space),&lt;--[**]--&gt;,$(1))\</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-  )))</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-# Extract directory path from a dependency file.</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-mkdir_stem =$(foreach val,$(getargv),$(subst /.mkdir.done,$(NULL),$(val)))</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-## Generate timestamp file for threadsafe directory creation</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-mkdir_deps =$(foreach dir,$(getargv),$(call slash_strip,$(dir)/.mkdir.done))</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-#######################</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-##---]  TARGETS  [---##</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-#######################</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-%/.mkdir.done: # mkdir -p -p =&gt; mkdir -p</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-	$(subst $(space)-p,$(null),$(MKDIR)) -p '$(dir $@)'</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-# Make the timestamp old enough for not being a problem with symbolic links</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-# targets depending on it. Use Jan 3, 1980 to accomodate any timezone where</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-# 198001010000 would translate to something older than FAT epoch.</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-	@$(TOUCH) -t 198001030000 '$@'</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-# A handful of makefiles are attempting &quot;mkdir dot&quot;.</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-# tbpl/valgrind builds are using this target</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-# https://bugzilla.mozilla.org/show_bug.cgi?id=837754</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-.mkdir.done:</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-	@echo 'WARNING: $(MKDIR) -dot- requested by $(MAKE) -C $(CURDIR) $(MAKECMDGOALS)'</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-	@$(TOUCH) -t 198001030000 '$@'</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-INCLUDED_AUTOTARGETS_MK = 1</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-endif #}</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-## Accumulate deps and cleanup</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-ifneq (,$(GENERATED_DIRS))</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-  GENERATED_DIRS := $(strip $(sort $(GENERATED_DIRS)))</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-  tmpauto :=$(call mkdir_deps,GENERATED_DIRS)</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-  GENERATED_DIRS_DEPS +=$(tmpauto)</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-  GARBAGE_DIRS        +=$(GENERATED_DIRS)</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-endif</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-#################################################################</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-# One ring/dep to rule them all:</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-#   config/rules.mk::all target is available by default</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-#   Add $(AUTO_DEPS) as an explicit target dependency when needed.</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-#################################################################</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-AUTO_DEPS +=$(GENERATED_DIRS_DEPS)</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-AUTO_DEPS := $(strip $(sort $(AUTO_DEPS)))</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-# Complain loudly if deps have not loaded so getargv != $(NULL)</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-$(call requiredfunction,getargv)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/config/makefiles/makeutils.mk</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,117 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-# -*- makefile -*-</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-# vim:set ts=8 sw=8 sts=8 noet:</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-#</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-# You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-## Identify function argument types</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-istype =$(if $(value ${1}),list,scalar)</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-isval  =$(if $(filter-out list,$(call istype,${1})),true)</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-isvar  =$(if $(filter-out scalar,$(call istype,${1})),true)</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-# Access up to 9 arguments passed, option needed to emulate $*</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-# Inline for function expansion, do not use $(call )</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-argv  =$(strip</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-argv +=$(if $(1), $(1))$(if $(2), $(2))$(if $(3), $(3))$(if $(4), $(4))</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-argv +=$(if $(5), $(5))$(if $(6), $(6))$(if $(7), $(7))$(if $(8), $(8))</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-argv +=$(if $(9), $(9))</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-argv +=$(if $(10), $(error makeutils.mk::argv can only handle 9 arguments))</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-argv +=)</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-###########################################################################</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-## Access function args as a simple list, inline within user functions.</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-## Usage: $(info ** $(call banner,$(getargv)))</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-##    $(call banner,scalar)</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-##    $(call banner,list0 list1 list2)</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-##    $(call banner,ref) ; ref=foo bar tans</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-## getarglist() would be a more accurate name but is longer to type</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-getargv = $(if $(call isvar,$(1)),$($(1)),$(argv))</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-###########################################################################</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-# Strip [n] leading options from an argument list.  This will allow passing</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-# extra args to user functions that will not propogate to sub-$(call )'s</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-# Usage: $(call subargv,2)</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-subargv =$(wordlist $(1),$(words $(getargv)),$(getargv))</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-###########################################################################</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-# Intent: Display a distinct banner heading in the output stream</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-# Usage: $(call banner,BUILDING: foo bar tans)</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-# Debug:</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-#   target-preqs = \</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-#     $(call banner,target-preqs-BEGIN) \</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-#     foo bar tans \</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-#     $(call banner,target-preqs-END) \</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-#     $(NULL)</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-#   target: $(target-preqs)</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-banner = \</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-$(info ) \</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-$(info ***************************************************************************) \</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-$(info ** $(getargv)) \</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-$(info ***************************************************************************) \</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-$(NULL)</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-#####################################################################</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-# Intent: Determine if a string or pattern is contained in a list</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-# Usage: strcmp  - $(call if_XinY,clean,$(MAKECMDGOALS))</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-#      : pattern - $(call if_XinY,clean%,$(MAKECMDGOALS))</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-is_XinY =$(filter $(1),$(call subargv,3,$(getargv)))</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-#####################################################################</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-# Provide an alternate var to support testing</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-ifdef MAKEUTILS_UNIT_TEST</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-  mcg_goals=TEST_MAKECMDGOALS</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-else</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-  mcg_goals=MAKECMDGOALS</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-endif</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-# Intent: Conditionals for detecting common/tier target use</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-isTargetStem       = $(sort \</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-  $(foreach var,$(getargv),\</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-    $(foreach pat,$(var)% %$(var),\</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-      $(call is_XinY,$(pat),${$(mcg_goals)})\</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-  )))</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-isTargetStemClean  = $(call isTargetStem,clean)</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-isTargetStemExport = $(call isTargetStem,export)</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-isTargetStemLibs   = $(call isTargetStem,libs)</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-isTargetStemTools  = $(call isTargetStem,tools)</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-##################################################</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-# Intent: Validation functions / unit test helpers</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-errorifneq =$(if $(subst $(strip $(1)),$(NULL),$(strip $(2))),$(error expected [$(1)] but found [$(2)]))</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-# Intent: verify function declaration exists</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-requiredfunction =$(foreach func,$(1) $(2) $(3) $(4) $(5) $(6) $(7) $(8) $(9),$(if $(value $(func)),$(NULL),$(error required function [$(func)] is unavailable)))</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-## http://www.gnu.org/software/make/manual/make.html#Call-Function</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-## Usage: o = $(call map,origin,o map $(MAKE))</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-map = $(foreach val,$(2),$(call $(1),$(val)))</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-## Disable checking for clean targets</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineminus">-ifeq (,$(filter %clean clean%,$(MAKECMDGOALS))) #{</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-# Usage: $(call checkIfEmpty,[error|warning] foo NULL bar)</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-checkIfEmpty =$(foreach var,$(wordlist 2,100,$(argv)),$(if $(strip $($(var))),$(NOP),$(call $(1),Variable $(var) does not contain a value)))</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-# Usage: $(call errorIfEmpty,foo NULL bar)</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-errorIfEmpty =$(call checkIfEmpty,error $(argv))</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-warnIfEmpty  =$(call checkIfEmpty,warning $(argv))</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-endif #}</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-###########################################################################</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-## Common makefile library loader</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-###########################################################################</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-topORerr =$(if $(topsrcdir),$(topsrcdir),$(error topsrcdir is not defined))</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-ifdef USE_AUTOTARGETS_MK # mkdir_deps</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-  include $(topORerr)/config/makefiles/autotargets.mk</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-endif</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineminus">-## copy(src, dst): recursive copy</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineminus">-copy_dir = (cd $(1)/. &amp;&amp; $(TAR) $(TAR_CREATE_FLAGS) - .) | (cd $(2)/. &amp;&amp; tar -xf -)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/config/printconfigsetting.py</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,25 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">-</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-import configobj, sys</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-try:</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    (file, section, key) = sys.argv[1:]</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-except ValueError:</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-    print &quot;Usage: printconfigsetting.py &lt;file&gt; &lt;section&gt; &lt;setting&gt;&quot;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-    sys.exit(1)</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-c = configobj.ConfigObj(file)</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-try:</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-    s = c[section]</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-except KeyError:</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-    print &gt;&gt;sys.stderr, &quot;Section [%s] not found.&quot; % section</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-    sys.exit(1)</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-try:</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-    print s[key]</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-except KeyError:</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-    print &gt;&gt;sys.stderr, &quot;Key %s not found.&quot; % key</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-    sys.exit(1)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/config/recurse.mk</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,9 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">-# You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">-</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-ifndef INCLUDED_RULES_MK</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-endif</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-include $(MOZILLA_DIR)/config/recurse.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/config/rules.mk</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,13 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-# vim:set ts=8 sw=8 sts=8 noet:</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-#</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">-# You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-#</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">-</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-ifndef topsrcdir</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-$(error topsrcdir was not set))</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-endif</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-# Use mozilla-central's copy of rules.mk.</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-include $(topsrcdir)/mozilla/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/configure.in</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,42 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-dnl -*- Mode: Autoconf; tab-width: 4; indent-tabs-mode: nil; -*-</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-dnl vi: set tabstop=4 shiftwidth=4 expandtab:</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">-dnl This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">-dnl License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">-dnl file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-dnl</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-dnl This is a not-really-autoconf script (which is to say, it's a shell script</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-dnl that is piped through m4 first) that executes the mozilla-central python</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-dnl configure, first doing a little bit of processing to handle mozconfig and</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-dnl the --with-external-source-dir rules.</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-dnl ========================================================</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-divert(0)dnl</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-#!/bin/sh</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-SRCDIR=$(dirname $0)</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-TOPSRCDIR=&quot;$SRCDIR&quot;</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-MOZILLA_SRCDIR=&quot;${SRCDIR}/mozilla&quot;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-export OLD_CONFIGURE=&quot;${MOZILLA_SRCDIR}&quot;/old-configure</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-# Ensure the comm-* values are used unless overridden by environment variables.</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-if test -z &quot;$MOZ_SOURCE_CHANGESET&quot;; then</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-    export MOZ_SOURCE_CHANGESET=$(hg -R &quot;$TOPSRCDIR&quot; parent --template=&quot;{node}&quot; 2&gt;/dev/null)</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-fi</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-if test -z &quot;$MOZ_SOURCE_REPO&quot;; then</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-    export MOZ_SOURCE_REPO=$(hg -R &quot;$TOPSRCDIR&quot; showconfig paths.default 2&gt;/dev/null | sed -e &quot;s/^ssh:/https:/&quot;)</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-fi</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-# If MOZCONFIG isn't set, use the .mozconfig from the current directory. This</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-# overrides the lookup in mozilla-central's configure, which looks in the wrong</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-# directory for this file.</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-if test -z &quot;$MOZCONFIG&quot; -a -f &quot;$SRCDIR&quot;/.mozconfig; then</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-    export MOZCONFIG=&quot;$SRCDIR&quot;/.mozconfig</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-elif test -z &quot;$MOZCONFIG&quot; -a -f &quot;$SRCDIR&quot;/mozconfig; then</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-    export MOZCONFIG=&quot;$SRCDIR&quot;/mozconfig</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-fi</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-# Execute the mozilla configure script in the current directory, adding the</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-# parameter we need to run comm-central. Since the configure script is really</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-# just a wrapper around invoking a python variant, execute the underlying python</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-# directly. We use a copy of the underlying configure script to get paths</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-# correct.</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-set -- &quot;$@&quot; --with-external-source-dir=&quot;$TOPSRCDIR&quot;</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-which python2.7 &gt; /dev/null &amp;&amp; exec python2.7 &quot;$TOPSRCDIR/configure.py&quot; &quot;$@&quot; || exec python &quot;$TOPSRCDIR/configure.py&quot; &quot;$@&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/configure.py</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,32 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">-</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-from __future__ import print_function, unicode_literals</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-import imp</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-import os</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-import sys</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-base_dir = os.path.abspath(os.path.dirname(__file__))</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-sys.path.append(os.path.join(base_dir, 'mozilla', 'python', 'mozbuild'))</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-from mozbuild.configure import ConfigureSandbox</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-# We can't just import config_status since configure is shadowed by this file!</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-f, pathname, desc = imp.find_module('configure',</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-                                    [os.path.join(base_dir, 'mozilla')])</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-config_status = imp.load_module('configure', f, pathname, desc).config_status</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-def main(argv):</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-    config = {}</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-    sandbox = ConfigureSandbox(config, os.environ, argv)</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-    sandbox.run(os.path.join(os.path.dirname(__file__), 'moz.configure'))</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-    if sandbox._help:</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-        return 0</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-    return config_status(config)</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-if __name__ == '__main__':</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-    sys.exit(main(sys.argv))</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

