<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3174:ff945c5683e98f60b02acadd56e3bcb112548c14</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ff945c5683e98f60b02acadd56e3bcb112548c14" />
<meta property="og:url" content="/comm-central/rev/ff945c5683e98f60b02acadd56e3bcb112548c14" />
<meta property="og:description" content="Attempt to fix rando-orange in mozmill middle click to open tab in foreground tests. Wait for message display completion after the middle click, so that we don't assert before the new tab's message has a chance to be displayed. irc-r=Standard8, no bug" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ff945c5683e98f60b02acadd56e3bcb112548c14 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ff945c5683e98f60b02acadd56e3bcb112548c14">shortlog</a> |
<a href="/comm-central/log/ff945c5683e98f60b02acadd56e3bcb112548c14">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ff945c5683e98f60b02acadd56e3bcb112548c14">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ff945c5683e98f60b02acadd56e3bcb112548c14">files</a> |
changeset |
<a href="/comm-central/raw-rev/ff945c5683e98f60b02acadd56e3bcb112548c14">raw</a>  | <a href="/comm-central/archive/ff945c5683e98f60b02acadd56e3bcb112548c14.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Attempt to fix rando-orange in mozmill middle click to open tab in foreground tests. Wait for message display completion after the middle click, so that we don't assert before the new tab's message has a chance to be displayed. irc-r=Standard8, no bug
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#105;&#100;&#100;&#104;&#97;&#114;&#116;&#104;&#32;&#65;&#103;&#97;&#114;&#119;&#97;&#108;&#32;&#60;&#115;&#105;&#100;&#46;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 29 Jul 2009 20:10:55 +0530</td></tr>

<tr>
 <td>changeset 3174</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ff945c5683e98f60b02acadd56e3bcb112548c14">ff945c5683e98f60b02acadd56e3bcb112548c14</a></td>
</tr>



<tr>
<td>parent 3173</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b53c35234619ddfca10de281de298fecfc4de1e1">b53c35234619ddfca10de281de298fecfc4de1e1</a>
</td>
</tr>

<tr>
<td>child 3175</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c0c95a082fe13edba8ac52746ce8c6e2b6dcf8bd">c0c95a082fe13edba8ac52746ce8c6e2b6dcf8bd</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ff945c5683e98f60b02acadd56e3bcb112548c14">2586</a></td></tr>
<tr><td>push user</td><td>sid.bugzilla@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 29 Jul 2009 14:46:11 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ff945c5683e9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ff945c5683e98f60b02acadd56e3bcb112548c14">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ff945c5683e98f60b02acadd56e3bcb112548c14&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff945c5683e98f60b02acadd56e3bcb112548c14&newProject=comm-central&newRevision=ff945c5683e98f60b02acadd56e3bcb112548c14&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff945c5683e98f60b02acadd56e3bcb112548c14&newProject=comm-central&newRevision=ff945c5683e98f60b02acadd56e3bcb112548c14&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ff945c5683e98f60b02acadd56e3bcb112548c14&newProject=comm-central&newRevision=ff945c5683e98f60b02acadd56e3bcb112548c14&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">Attempt to fix rando-orange in mozmill middle click to open tab in foreground tests. Wait for message display completion after the middle click, so that we don't assert before the new tab's message has a chance to be displayed. irc-r=Standard8, no bug</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff945c5683e98f60b02acadd56e3bcb112548c14/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff945c5683e98f60b02acadd56e3bcb112548c14/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">file</a> |
<a href="/comm-central/annotate/ff945c5683e98f60b02acadd56e3bcb112548c14/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">annotate</a> |
<a href="/comm-central/diff/ff945c5683e98f60b02acadd56e3bcb112548c14/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">diff</a> |
<a href="/comm-central/comparison/ff945c5683e98f60b02acadd56e3bcb112548c14/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">comparison</a> |
<a href="/comm-central/log/ff945c5683e98f60b02acadd56e3bcb112548c14/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -172,16 +172,20 @@ function _middle_click_with_nothing_sele</span>
<a href="#l1.4"></a><span id="l1.4">   focus_thread_tree();</span>
<a href="#l1.5"></a><span id="l1.5">   let [tabMessage, curMessage] = middle_click_on_row(1);</span>
<a href="#l1.6"></a><span id="l1.6">   if (aBackground) {</span>
<a href="#l1.7"></a><span id="l1.7">     // Make sure we haven't switched to the new tab.</span>
<a href="#l1.8"></a><span id="l1.8">     assert_selected_tab(folderTab);</span>
<a href="#l1.9"></a><span id="l1.9">     // Now switch to the new tab and check</span>
<a href="#l1.10"></a><span id="l1.10">     switch_tab(tabMessage);</span>
<a href="#l1.11"></a><span id="l1.11">   }</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+  else {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  }</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16">   assert_selected_and_displayed(curMessage);</span>
<a href="#l1.17"></a><span id="l1.17">   assert_message_pane_focused();</span>
<a href="#l1.18"></a><span id="l1.18">   close_tab(tabMessage);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">   assert_nothing_selected();</span>
<a href="#l1.21"></a><span id="l1.21">   assert_thread_tree_focused();</span>
<a href="#l1.22"></a><span id="l1.22"> }</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -198,16 +202,20 @@ function _middle_click_with_one_thing_se</span>
<a href="#l1.25"></a><span id="l1.25">   focus_thread_tree();</span>
<a href="#l1.26"></a><span id="l1.26">   let [tabMessage, curMessage] = middle_click_on_row(1);</span>
<a href="#l1.27"></a><span id="l1.27">   if (aBackground) {</span>
<a href="#l1.28"></a><span id="l1.28">     // Make sure we haven't switched to the new tab.</span>
<a href="#l1.29"></a><span id="l1.29">     assert_selected_tab(folderTab);</span>
<a href="#l1.30"></a><span id="l1.30">     // Now switch to the new tab and check</span>
<a href="#l1.31"></a><span id="l1.31">     switch_tab(tabMessage);</span>
<a href="#l1.32"></a><span id="l1.32">   }</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+  else {</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  }</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+</span>
<a href="#l1.37"></a><span id="l1.37">   assert_selected_and_displayed(curMessage);</span>
<a href="#l1.38"></a><span id="l1.38">   assert_message_pane_focused();</span>
<a href="#l1.39"></a><span id="l1.39">   close_tab(tabMessage);</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41">   assert_selected_and_displayed(0);</span>
<a href="#l1.42"></a><span id="l1.42">   assert_thread_tree_focused();</span>
<a href="#l1.43"></a><span id="l1.43"> }</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45" class="difflineat">@@ -226,16 +234,20 @@ function _middle_click_with_many_things_</span>
<a href="#l1.46"></a><span id="l1.46">   focus_thread_tree();</span>
<a href="#l1.47"></a><span id="l1.47">   let [tabMessage, curMessage] = middle_click_on_row(1);</span>
<a href="#l1.48"></a><span id="l1.48">   if (aBackground) {</span>
<a href="#l1.49"></a><span id="l1.49">     // Make sure we haven't switched to the new tab.</span>
<a href="#l1.50"></a><span id="l1.50">     assert_selected_tab(folderTab);</span>
<a href="#l1.51"></a><span id="l1.51">     // Now switch to the new tab and check</span>
<a href="#l1.52"></a><span id="l1.52">     switch_tab(tabMessage);</span>
<a href="#l1.53"></a><span id="l1.53">   }</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+  else {</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+  }</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+</span>
<a href="#l1.58"></a><span id="l1.58">   assert_selected_and_displayed(curMessage);</span>
<a href="#l1.59"></a><span id="l1.59">   assert_message_pane_focused();</span>
<a href="#l1.60"></a><span id="l1.60">   close_tab(tabMessage);</span>
<a href="#l1.61"></a><span id="l1.61"> </span>
<a href="#l1.62"></a><span id="l1.62">   assert_selected_and_displayed([0, 5]);</span>
<a href="#l1.63"></a><span id="l1.63">   assert_thread_tree_focused();</span>
<a href="#l1.64"></a><span id="l1.64"> }</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66" class="difflineat">@@ -252,16 +264,20 @@ function _middle_click_on_existing_singl</span>
<a href="#l1.67"></a><span id="l1.67">   focus_thread_tree();</span>
<a href="#l1.68"></a><span id="l1.68">   let [tabMessage, curMessage] = middle_click_on_row(3);</span>
<a href="#l1.69"></a><span id="l1.69">   if (aBackground) {</span>
<a href="#l1.70"></a><span id="l1.70">     // Make sure we haven't switched to the new tab.</span>
<a href="#l1.71"></a><span id="l1.71">     assert_selected_tab(folderTab);</span>
<a href="#l1.72"></a><span id="l1.72">     // Now switch to the new tab and check</span>
<a href="#l1.73"></a><span id="l1.73">     switch_tab(tabMessage);</span>
<a href="#l1.74"></a><span id="l1.74">   }</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+  else {</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+  }</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+</span>
<a href="#l1.79"></a><span id="l1.79">   assert_selected_and_displayed(curMessage);</span>
<a href="#l1.80"></a><span id="l1.80">   assert_message_pane_focused();</span>
<a href="#l1.81"></a><span id="l1.81">   close_tab(tabMessage);</span>
<a href="#l1.82"></a><span id="l1.82"> </span>
<a href="#l1.83"></a><span id="l1.83">   assert_selected_and_displayed(3);</span>
<a href="#l1.84"></a><span id="l1.84">   assert_thread_tree_focused();</span>
<a href="#l1.85"></a><span id="l1.85"> }</span>
<a href="#l1.86"></a><span id="l1.86"> </span>
<a href="#l1.87"></a><span id="l1.87" class="difflineat">@@ -279,16 +295,20 @@ function _middle_click_on_existing_multi</span>
<a href="#l1.88"></a><span id="l1.88">   focus_thread_tree();</span>
<a href="#l1.89"></a><span id="l1.89">   let [tabMessage, curMessage] = middle_click_on_row(5);</span>
<a href="#l1.90"></a><span id="l1.90">   if (aBackground) {</span>
<a href="#l1.91"></a><span id="l1.91">     // Make sure we haven't switched to the new tab.</span>
<a href="#l1.92"></a><span id="l1.92">     assert_selected_tab(folderTab);</span>
<a href="#l1.93"></a><span id="l1.93">     // Now switch to the new tab and check</span>
<a href="#l1.94"></a><span id="l1.94">     switch_tab(tabMessage);</span>
<a href="#l1.95"></a><span id="l1.95">   }</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+  else {</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+  }</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+</span>
<a href="#l1.100"></a><span id="l1.100">   assert_selected_and_displayed(curMessage);</span>
<a href="#l1.101"></a><span id="l1.101">   assert_message_pane_focused();</span>
<a href="#l1.102"></a><span id="l1.102">   close_tab(tabMessage);</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104">   assert_selected_and_displayed([3, 6]);</span>
<a href="#l1.105"></a><span id="l1.105">   assert_thread_tree_focused();</span>
<a href="#l1.106"></a><span id="l1.106"> }</span>
<a href="#l1.107"></a><span id="l1.107"> </span>
<a href="#l1.108"></a><span id="l1.108" class="difflineat">@@ -315,19 +335,21 @@ function _middle_click_on_collapsed_thre</span>
<a href="#l1.109"></a><span id="l1.109">   // don't scroll because of it. So click on the first visible row.</span>
<a href="#l1.110"></a><span id="l1.110">   select_click_row(preFirstRow);</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112">   // Middle-click on the root of the collapsed thread, which is also the last</span>
<a href="#l1.113"></a><span id="l1.113">   // row</span>
<a href="#l1.114"></a><span id="l1.114">   let [tabMessage, ] = middle_click_on_row(</span>
<a href="#l1.115"></a><span id="l1.115">                            mc.folderDisplay.view.dbView.rowCount - 1);</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-  if (!aBackground)</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+  if (!aBackground) {</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.120"></a><span id="l1.120">     // Switch back to the folder tab</span>
<a href="#l1.121"></a><span id="l1.121">     switch_tab(folderTab);</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+  }</span>
<a href="#l1.123"></a><span id="l1.123"> </span>
<a href="#l1.124"></a><span id="l1.124">   // Make sure the first visible row is still the same</span>
<a href="#l1.125"></a><span id="l1.125">   if (treeBox.getFirstVisibleRow() != preFirstRow)</span>
<a href="#l1.126"></a><span id="l1.126">     throw new Error(&quot;The first visible row should have been &quot; + preFirstRow +</span>
<a href="#l1.127"></a><span id="l1.127">         &quot;, but is actually &quot; + treeBox.getFirstVisibleRow() + &quot;.&quot;);</span>
<a href="#l1.128"></a><span id="l1.128"> </span>
<a href="#l1.129"></a><span id="l1.129">   close_tab(tabMessage);</span>
<a href="#l1.130"></a><span id="l1.130"> }</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineat">@@ -356,19 +378,21 @@ function _middle_click_on_expanded_threa</span>
<a href="#l1.132"></a><span id="l1.132">   // don't scroll because of it. So click on the first visible row.</span>
<a href="#l1.133"></a><span id="l1.133">   select_click_row(preFirstRow);</span>
<a href="#l1.134"></a><span id="l1.134"> </span>
<a href="#l1.135"></a><span id="l1.135">   // Middle-click on the root of the expanded thread, which is the row with</span>
<a href="#l1.136"></a><span id="l1.136">   // index (number of rows - number of messages in thread).</span>
<a href="#l1.137"></a><span id="l1.137">   let [tabMessage, ] = middle_click_on_row(</span>
<a href="#l1.138"></a><span id="l1.138">       mc.folderDisplay.view.dbView.rowCount - NUM_MESSAGES_IN_THREAD);</span>
<a href="#l1.139"></a><span id="l1.139"> </span>
<a href="#l1.140"></a><span id="l1.140" class="difflineminus">-  if (!aBackground)</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  if (!aBackground) {</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+    wait_for_message_display_completion();</span>
<a href="#l1.143"></a><span id="l1.143">     // Switch back to the folder tab</span>
<a href="#l1.144"></a><span id="l1.144">     switch_tab(folderTab);</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+  }</span>
<a href="#l1.146"></a><span id="l1.146"> </span>
<a href="#l1.147"></a><span id="l1.147">   // Make sure the first visible row is still the same</span>
<a href="#l1.148"></a><span id="l1.148">   if (treeBox.getFirstVisibleRow() != preFirstRow)</span>
<a href="#l1.149"></a><span id="l1.149">     throw new Error(&quot;The first visible row should have been &quot; + preFirstRow +</span>
<a href="#l1.150"></a><span id="l1.150">         &quot;, but is actually &quot; + treeBox.getFirstVisibleRow() + &quot;.&quot;);</span>
<a href="#l1.151"></a><span id="l1.151"> </span>
<a href="#l1.152"></a><span id="l1.152">   close_tab(tabMessage);</span>
<a href="#l1.153"></a><span id="l1.153"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

