<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26254:e1343db925fa739705ca67456084afe5fe80d781</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ e1343db925fa739705ca67456084afe5fe80d781" />
<meta property="og:url" content="/comm-central/rev/e1343db925fa739705ca67456084afe5fe80d781" />
<meta property="og:description" content="Bug 1540438 - Part 1: SeaMonkey tab removal in mail and news. r=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / e1343db925fa739705ca67456084afe5fe80d781 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/e1343db925fa739705ca67456084afe5fe80d781">shortlog</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/e1343db925fa739705ca67456084afe5fe80d781">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781">files</a> |
changeset |
<a href="/comm-central/raw-rev/e1343db925fa739705ca67456084afe5fe80d781">raw</a>  | <a href="/comm-central/archive/e1343db925fa739705ca67456084afe5fe80d781.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1540438">Bug 1540438</a> - Part 1: SeaMonkey tab removal in mail and news. r=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#45;&#82;&#97;&#105;&#110;&#101;&#114;&#32;&#71;&#114;&#97;&#104;&#108;&#32;&#60;&#102;&#114;&#103;&#114;&#97;&#104;&#108;&#64;&#103;&#109;&#120;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 06 Apr 2019 16:33:50 +0200</td></tr>

<tr>
 <td>changeset 26254</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/e1343db925fa739705ca67456084afe5fe80d781">e1343db925fa739705ca67456084afe5fe80d781</a></td>
</tr>



<tr>
<td>parent 26253</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/65ca4bd457a614dcb5d72f6d3c2195654281e672">65ca4bd457a614dcb5d72f6d3c2195654281e672</a>
</td>
</tr>

<tr>
<td>child 26255</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0a8b3f8e67f7f12bfdfb4435eceebadd3e265007">0a8b3f8e67f7f12bfdfb4435eceebadd3e265007</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=e1343db925fa739705ca67456084afe5fe80d781">15755</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Sat, 06 Apr 2019 14:34:39 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9318d65e46d6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9318d65e46d6a6c0d71c0d63bb7ee80af6a6cb24">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9318d65e46d6a6c0d71c0d63bb7ee80af6a6cb24&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9318d65e46d6a6c0d71c0d63bb7ee80af6a6cb24&newProject=comm-central&newRevision=df19db6b5049451b36247d7b88212759ad44e163&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9318d65e46d6a6c0d71c0d63bb7ee80af6a6cb24&newProject=comm-central&newRevision=df19db6b5049451b36247d7b88212759ad44e163&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9318d65e46d6a6c0d71c0d63bb7ee80af6a6cb24&newProject=comm-central&newRevision=df19db6b5049451b36247d7b88212759ad44e163&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1540438">1540438</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1540438">Bug 1540438</a> - Part 1: SeaMonkey tab removal in mail and news. r=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abCardViewOverlay.js">suite/mailnews/components/addrbook/content/abCardViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abCardViewOverlay.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abCardViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abCardViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abCardViewOverlay.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abCardViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook-panel.xul">suite/mailnews/components/addrbook/content/addressbook-panel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook-panel.xul">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook-panel.xul">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook-panel.xul">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook-panel.xul">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook-panel.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook.js">suite/mailnews/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/addressingWidgetOverlay.js">suite/mailnews/components/compose/content/addressingWidgetOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/addressingWidgetOverlay.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/addressingWidgetOverlay.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/addressingWidgetOverlay.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/addressingWidgetOverlay.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/addressingWidgetOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul">suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/FilterListDialog.js">suite/mailnews/content/FilterListDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/FilterListDialog.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/FilterListDialog.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/FilterListDialog.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/FilterListDialog.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/FilterListDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mac/platformMailnewsOverlay.xul">suite/mailnews/content/mac/platformMailnewsOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mac/platformMailnewsOverlay.xul">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mac/platformMailnewsOverlay.xul">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mac/platformMailnewsOverlay.xul">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mac/platformMailnewsOverlay.xul">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mac/platformMailnewsOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mail3PaneWindowCommands.js">suite/mailnews/content/mail3PaneWindowCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mail3PaneWindowCommands.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mail3PaneWindowCommands.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mail3PaneWindowCommands.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mail3PaneWindowCommands.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/mail3PaneWindowCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.js">suite/mailnews/content/messageWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.xul">suite/mailnews/content/messageWindow.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.xul">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.xul">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.xul">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.xul">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/messageWindow.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/msgMail3PaneWindow.js">suite/mailnews/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/e1343db925fa739705ca67456084afe5fe80d781/suite/mailnews/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abCardViewOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abCardViewOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -47,93 +47,93 @@ function OnLoadCardView()</span>
<a href="#l1.4"></a><span id="l1.4">   zCellular = gAddressBookBundle.getString(&quot;propertyCellular&quot;);</span>
<a href="#l1.5"></a><span id="l1.5">   zPager = gAddressBookBundle.getString(&quot;propertyPager&quot;);</span>
<a href="#l1.6"></a><span id="l1.6">   zBirthday = gAddressBookBundle.getString(&quot;propertyBirthday&quot;);</span>
<a href="#l1.7"></a><span id="l1.7">   zCustom1 = gAddressBookBundle.getString(&quot;propertyCustom1&quot;);</span>
<a href="#l1.8"></a><span id="l1.8">   zCustom2 = gAddressBookBundle.getString(&quot;propertyCustom2&quot;);</span>
<a href="#l1.9"></a><span id="l1.9">   zCustom3 = gAddressBookBundle.getString(&quot;propertyCustom3&quot;);</span>
<a href="#l1.10"></a><span id="l1.10">   zCustom4 = gAddressBookBundle.getString(&quot;propertyCustom4&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-	var doc = document;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  var doc = document;</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-	/* data for address book, prefixes: &quot;cvb&quot; = card view box</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-										&quot;cvh&quot; = crad view header</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-										&quot;cv&quot;  = card view (normal fields) */</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-	cvData = new Object;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+  /* data for address book, prefixes: &quot;cvb&quot; = card view box</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+                                      &quot;cvh&quot; = crad view header</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+                                      &quot;cv&quot;  = card view (normal fields) */</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+  cvData = new Object;</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-	// Card View Box</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-	cvData.CardViewBox		= doc.getElementById(&quot;CardViewInnerBox&quot;);</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-	// Title</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-	cvData.CardTitle		= doc.getElementById(&quot;CardTitle&quot;);</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-	// Name section</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-	cvData.cvbContact = doc.getElementById(&quot;cvbContact&quot;);</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-	cvData.cvhContact = doc.getElementById(&quot;cvhContact&quot;);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-	cvData.cvNickname		= doc.getElementById(&quot;cvNickname&quot;);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-	cvData.cvDisplayName	= doc.getElementById(&quot;cvDisplayName&quot;);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-	cvData.cvEmail1Box		= doc.getElementById(&quot;cvEmail1Box&quot;);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-	cvData.cvEmail1			= doc.getElementById(&quot;cvEmail1&quot;);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-	cvData.cvScreennameBox		= doc.getElementById(&quot;cvScreennameBox&quot;);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-	cvData.cvScreenname		= doc.getElementById(&quot;cvScreenname&quot;);</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-	cvData.cvBuddyIcon              = doc.getElementById(&quot;cvBuddyIcon&quot;);</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-	cvData.cvListNameBox		= doc.getElementById(&quot;cvListNameBox&quot;);</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-	cvData.cvListName               = doc.getElementById(&quot;cvListName&quot;);</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-	cvData.cvEmail2Box		= doc.getElementById(&quot;cvEmail2Box&quot;);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-	cvData.cvEmail2			= doc.getElementById(&quot;cvEmail2&quot;);</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-	// Home section</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-	cvData.cvbHome			= doc.getElementById(&quot;cvbHome&quot;);</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-	cvData.cvhHome			= doc.getElementById(&quot;cvhHome&quot;);</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-	cvData.cvHomeAddress	= doc.getElementById(&quot;cvHomeAddress&quot;);</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-	cvData.cvHomeAddress2	= doc.getElementById(&quot;cvHomeAddress2&quot;);</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-	cvData.cvHomeCityStZip	= doc.getElementById(&quot;cvHomeCityStZip&quot;);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-	cvData.cvHomeCountry	= doc.getElementById(&quot;cvHomeCountry&quot;);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-  cvData.cvbHomeMapItBox  = doc.getElementById(&quot;cvbHomeMapItBox&quot;);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+  // Card View Box</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+  cvData.CardViewBox = doc.getElementById(&quot;CardViewInnerBox&quot;);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  // Title</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+  cvData.CardTitle = doc.getElementById(&quot;CardTitle&quot;);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+  // Name section</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+  cvData.cvbContact = doc.getElementById(&quot;cvbContact&quot;);</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+  cvData.cvhContact = doc.getElementById(&quot;cvhContact&quot;);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+  cvData.cvNickname = doc.getElementById(&quot;cvNickname&quot;);</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+  cvData.cvDisplayName = doc.getElementById(&quot;cvDisplayName&quot;);</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+  cvData.cvEmail1Box = doc.getElementById(&quot;cvEmail1Box&quot;);</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+  cvData.cvEmail1 = doc.getElementById(&quot;cvEmail1&quot;);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+  cvData.cvScreennameBox = doc.getElementById(&quot;cvScreennameBox&quot;);</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+  cvData.cvScreenname = doc.getElementById(&quot;cvScreenname&quot;);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+  cvData.cvBuddyIcon = doc.getElementById(&quot;cvBuddyIcon&quot;);</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+  cvData.cvListNameBox = doc.getElementById(&quot;cvListNameBox&quot;);</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+  cvData.cvListName = doc.getElementById(&quot;cvListName&quot;);</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+  cvData.cvEmail2Box = doc.getElementById(&quot;cvEmail2Box&quot;);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+  cvData.cvEmail2 = doc.getElementById(&quot;cvEmail2&quot;);</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+  // Home section</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+  cvData.cvbHome = doc.getElementById(&quot;cvbHome&quot;);</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+  cvData.cvhHome = doc.getElementById(&quot;cvhHome&quot;);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+  cvData.cvHomeAddress = doc.getElementById(&quot;cvHomeAddress&quot;);</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+  cvData.cvHomeAddress2 = doc.getElementById(&quot;cvHomeAddress2&quot;);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+  cvData.cvHomeCityStZip = doc.getElementById(&quot;cvHomeCityStZip&quot;);</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+  cvData.cvHomeCountry = doc.getElementById(&quot;cvHomeCountry&quot;);</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+  cvData.cvbHomeMapItBox = doc.getElementById(&quot;cvbHomeMapItBox&quot;);</span>
<a href="#l1.76"></a><span id="l1.76">   cvData.cvHomeMapIt = doc.getElementById(&quot;cvHomeMapIt&quot;);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-	cvData.cvHomeWebPageBox = doc.getElementById(&quot;cvHomeWebPageBox&quot;);</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-	cvData.cvHomeWebPage	= doc.getElementById(&quot;cvHomeWebPage&quot;);</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-	// Other section</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-	cvData.cvbOther			= doc.getElementById(&quot;cvbOther&quot;);</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-	cvData.cvBirthday   = doc.getElementById(&quot;cvBirthday&quot;);</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-	cvData.cvhOther			= doc.getElementById(&quot;cvhOther&quot;);</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-	cvData.cvCustom1		= doc.getElementById(&quot;cvCustom1&quot;);</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-	cvData.cvCustom2		= doc.getElementById(&quot;cvCustom2&quot;);</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-	cvData.cvCustom3		= doc.getElementById(&quot;cvCustom3&quot;);</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-	cvData.cvCustom4		= doc.getElementById(&quot;cvCustom4&quot;);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-	cvData.cvNotes			= doc.getElementById(&quot;cvNotes&quot;);</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+  cvData.cvHomeWebPageBox = doc.getElementById(&quot;cvHomeWebPageBox&quot;);</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+  cvData.cvHomeWebPage = doc.getElementById(&quot;cvHomeWebPage&quot;);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+  // Other section</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+  cvData.cvbOther = doc.getElementById(&quot;cvbOther&quot;);</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+  cvData.cvBirthday = doc.getElementById(&quot;cvBirthday&quot;);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+  cvData.cvhOther = doc.getElementById(&quot;cvhOther&quot;);</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+  cvData.cvCustom1 = doc.getElementById(&quot;cvCustom1&quot;);</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+  cvData.cvCustom2 = doc.getElementById(&quot;cvCustom2&quot;);</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+  cvData.cvCustom3 = doc.getElementById(&quot;cvCustom3&quot;);</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+  cvData.cvCustom4 = doc.getElementById(&quot;cvCustom4&quot;);</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+  cvData.cvNotes = doc.getElementById(&quot;cvNotes&quot;);</span>
<a href="#l1.99"></a><span id="l1.99">   // Description section (mailing lists only)</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-  cvData.cvbDescription			= doc.getElementById(&quot;cvbDescription&quot;);</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-	cvData.cvhDescription			= doc.getElementById(&quot;cvhDescription&quot;);</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-  cvData.cvDescription			= doc.getElementById(&quot;cvDescription&quot;);</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+  cvData.cvbDescription = doc.getElementById(&quot;cvbDescription&quot;);</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+  cvData.cvhDescription = doc.getElementById(&quot;cvhDescription&quot;);</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+  cvData.cvDescription = doc.getElementById(&quot;cvDescription&quot;);</span>
<a href="#l1.106"></a><span id="l1.106">   // Addresses section (mailing lists only)</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineminus">-  cvData.cvbAddresses			= doc.getElementById(&quot;cvbAddresses&quot;);</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-	cvData.cvhAddresses			= doc.getElementById(&quot;cvhAddresses&quot;);</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-  cvData.cvAddresses			= doc.getElementById(&quot;cvAddresses&quot;);</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-	// Phone section</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-	cvData.cvbPhone			= doc.getElementById(&quot;cvbPhone&quot;);</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-	cvData.cvhPhone			= doc.getElementById(&quot;cvhPhone&quot;);</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-	cvData.cvPhWork			= doc.getElementById(&quot;cvPhWork&quot;);</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineminus">-	cvData.cvPhHome			= doc.getElementById(&quot;cvPhHome&quot;);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineminus">-	cvData.cvPhFax			= doc.getElementById(&quot;cvPhFax&quot;);</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineminus">-	cvData.cvPhCellular		= doc.getElementById(&quot;cvPhCellular&quot;);</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-	cvData.cvPhPager		= doc.getElementById(&quot;cvPhPager&quot;);</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-	// Work section</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-	cvData.cvbWork			= doc.getElementById(&quot;cvbWork&quot;);</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineminus">-	cvData.cvhWork			= doc.getElementById(&quot;cvhWork&quot;);</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineminus">-	cvData.cvJobTitle		= doc.getElementById(&quot;cvJobTitle&quot;);</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineminus">-	cvData.cvDepartment		= doc.getElementById(&quot;cvDepartment&quot;);</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineminus">-	cvData.cvCompany		= doc.getElementById(&quot;cvCompany&quot;);</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineminus">-	cvData.cvWorkAddress	= doc.getElementById(&quot;cvWorkAddress&quot;);</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineminus">-	cvData.cvWorkAddress2	= doc.getElementById(&quot;cvWorkAddress2&quot;);</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineminus">-	cvData.cvWorkCityStZip	= doc.getElementById(&quot;cvWorkCityStZip&quot;);</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineminus">-	cvData.cvWorkCountry	= doc.getElementById(&quot;cvWorkCountry&quot;);</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineminus">-  cvData.cvbWorkMapItBox  = doc.getElementById(&quot;cvbWorkMapItBox&quot;);</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+  cvData.cvbAddresses = doc.getElementById(&quot;cvbAddresses&quot;);</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+  cvData.cvhAddresses = doc.getElementById(&quot;cvhAddresses&quot;);</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+  cvData.cvAddresses = doc.getElementById(&quot;cvAddresses&quot;);</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineplus">+  // Phone section</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineplus">+  cvData.cvbPhone = doc.getElementById(&quot;cvbPhone&quot;);</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineplus">+  cvData.cvhPhone = doc.getElementById(&quot;cvhPhone&quot;);</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+  cvData.cvPhWork = doc.getElementById(&quot;cvPhWork&quot;);</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+  cvData.cvPhHome = doc.getElementById(&quot;cvPhHome&quot;);</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+  cvData.cvPhFax = doc.getElementById(&quot;cvPhFax&quot;);</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+  cvData.cvPhCellular = doc.getElementById(&quot;cvPhCellular&quot;);</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+  cvData.cvPhPager = doc.getElementById(&quot;cvPhPager&quot;);</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+  // Work section</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  cvData.cvbWork = doc.getElementById(&quot;cvbWork&quot;);</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+  cvData.cvhWork = doc.getElementById(&quot;cvhWork&quot;);</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+  cvData.cvJobTitle = doc.getElementById(&quot;cvJobTitle&quot;);</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+  cvData.cvDepartment = doc.getElementById(&quot;cvDepartment&quot;);</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+  cvData.cvCompany = doc.getElementById(&quot;cvCompany&quot;);</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+  cvData.cvWorkAddress = doc.getElementById(&quot;cvWorkAddress&quot;);</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+  cvData.cvWorkAddress2 = doc.getElementById(&quot;cvWorkAddress2&quot;);</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+  cvData.cvWorkCityStZip = doc.getElementById(&quot;cvWorkCityStZip&quot;);</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+  cvData.cvWorkCountry = doc.getElementById(&quot;cvWorkCountry&quot;);</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+  cvData.cvbWorkMapItBox = doc.getElementById(&quot;cvbWorkMapItBox&quot;);</span>
<a href="#l1.151"></a><span id="l1.151">   cvData.cvWorkMapIt = doc.getElementById(&quot;cvWorkMapIt&quot;);</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-	cvData.cvWorkWebPageBox = doc.getElementById(&quot;cvWorkWebPageBox&quot;);</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-	cvData.cvWorkWebPage	= doc.getElementById(&quot;cvWorkWebPage&quot;);</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+  cvData.cvWorkWebPageBox = doc.getElementById(&quot;cvWorkWebPageBox&quot;);</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+  cvData.cvWorkWebPage = doc.getElementById(&quot;cvWorkWebPage&quot;);</span>
<a href="#l1.156"></a><span id="l1.156">   cvData.cvbPhoto = doc.getElementById(&quot;cvbPhoto&quot;);</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineminus">-  cvData.cvPhoto  = doc.getElementById(&quot;cvPhoto&quot;);</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+  cvData.cvPhoto = doc.getElementById(&quot;cvPhoto&quot;);</span>
<a href="#l1.159"></a><span id="l1.159"> }</span>
<a href="#l1.160"></a><span id="l1.160"> </span>
<a href="#l1.161"></a><span id="l1.161"> // XXX todo</span>
<a href="#l1.162"></a><span id="l1.162"> // some similar code (in spirit) already exists, see OnLoadEditList()</span>
<a href="#l1.163"></a><span id="l1.163"> // perhaps we could combine and put in abCommon.js?</span>
<a href="#l1.164"></a><span id="l1.164"> function GetAddressesFromURI(uri)</span>
<a href="#l1.165"></a><span id="l1.165"> {</span>
<a href="#l1.166"></a><span id="l1.166">   var addresses = &quot;&quot;;</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineat">@@ -217,32 +217,32 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l1.168"></a><span id="l1.168">   let mapURLList = data.cvHomeMapIt.firstChild;</span>
<a href="#l1.169"></a><span id="l1.169">   if (visible)</span>
<a href="#l1.170"></a><span id="l1.170">     mapURLList.initMapAddressFromCard(card, &quot;Home&quot;);</span>
<a href="#l1.171"></a><span id="l1.171"> </span>
<a href="#l1.172"></a><span id="l1.172">   cvSetVisible(data.cvbHomeMapItBox, addressVisible &amp;&amp; !!mapURLList.mapURL);</span>
<a href="#l1.173"></a><span id="l1.173"> </span>
<a href="#l1.174"></a><span id="l1.174">   visible = HandleLink(data.cvHomeWebPage, &quot;&quot;, card.getProperty(&quot;WebPage2&quot;), data.cvHomeWebPageBox, card.getProperty(&quot;WebPage2&quot;)) || visible;</span>
<a href="#l1.175"></a><span id="l1.175"> </span>
<a href="#l1.176"></a><span id="l1.176" class="difflineminus">-	cvSetVisible(data.cvhHome, visible);</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineminus">-	cvSetVisible(data.cvbHome, visible);</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineplus">+  cvSetVisible(data.cvhHome, visible);</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+  cvSetVisible(data.cvbHome, visible);</span>
<a href="#l1.180"></a><span id="l1.180">   if (card.isMailList) {</span>
<a href="#l1.181"></a><span id="l1.181">     // Description section</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineminus">-	  visible = cvSetNode(data.cvDescription, card.getProperty(&quot;Notes&quot;))</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineminus">-  	cvSetVisible(data.cvbDescription, visible);</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+    visible = cvSetNode(data.cvDescription, card.getProperty(&quot;Notes&quot;))</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+    cvSetVisible(data.cvbDescription, visible);</span>
<a href="#l1.186"></a><span id="l1.186"> </span>
<a href="#l1.187"></a><span id="l1.187">     // Addresses section</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineminus">-	  visible = cvAddAddressNodes(data.cvAddresses, card.mailListURI);</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineminus">-  	cvSetVisible(data.cvbAddresses, visible);</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+    visible = cvAddAddressNodes(data.cvAddresses, card.mailListURI);</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+    cvSetVisible(data.cvbAddresses, visible);</span>
<a href="#l1.192"></a><span id="l1.192"> </span>
<a href="#l1.193"></a><span id="l1.193">     // Other section, not shown for mailing lists.</span>
<a href="#l1.194"></a><span id="l1.194">     cvSetVisible(data.cvbOther, false);</span>
<a href="#l1.195"></a><span id="l1.195">   }</span>
<a href="#l1.196"></a><span id="l1.196">   else {</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineminus">-	  // Other section</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineplus">+    // Other section</span>
<a href="#l1.199"></a><span id="l1.199">     /// setup the birthday information</span>
<a href="#l1.200"></a><span id="l1.200">     var day = card.getProperty(&quot;BirthDay&quot;, null);</span>
<a href="#l1.201"></a><span id="l1.201">     var month = card.getProperty(&quot;BirthMonth&quot;, null);</span>
<a href="#l1.202"></a><span id="l1.202">     var year = card.getProperty(&quot;BirthYear&quot;, null);</span>
<a href="#l1.203"></a><span id="l1.203">     var dateStr;</span>
<a href="#l1.204"></a><span id="l1.204">     if (day &gt; 0 &amp;&amp; day &lt; 32 &amp;&amp; month &gt; 0 &amp;&amp; month &lt; 13) {</span>
<a href="#l1.205"></a><span id="l1.205">       var date;</span>
<a href="#l1.206"></a><span id="l1.206">       var formatter;</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineat">@@ -261,64 +261,64 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l1.208"></a><span id="l1.208">                       { month: &quot;long&quot;, day: &quot;numeric&quot;, timeZone: &quot;UTC&quot; });</span>
<a href="#l1.209"></a><span id="l1.209">       }</span>
<a href="#l1.210"></a><span id="l1.210">       dateStr = formatter.format(date);</span>
<a href="#l1.211"></a><span id="l1.211">     }</span>
<a href="#l1.212"></a><span id="l1.212">     else if (year)</span>
<a href="#l1.213"></a><span id="l1.213">       dateStr = year;</span>
<a href="#l1.214"></a><span id="l1.214">     visible = cvSetNodeWithLabel(data.cvBirthday, zBirthday, dateStr);</span>
<a href="#l1.215"></a><span id="l1.215"> </span>
<a href="#l1.216"></a><span id="l1.216" class="difflineminus">-	  visible = cvSetNodeWithLabel(data.cvCustom1, zCustom1, card.getProperty(&quot;Custom1&quot;)) || visible;</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineminus">-	  visible = cvSetNodeWithLabel(data.cvCustom2, zCustom2, card.getProperty(&quot;Custom2&quot;)) || visible;</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineminus">-	  visible = cvSetNodeWithLabel(data.cvCustom3, zCustom3, card.getProperty(&quot;Custom3&quot;)) || visible;</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineminus">-	  visible = cvSetNodeWithLabel(data.cvCustom4, zCustom4, card.getProperty(&quot;Custom4&quot;)) || visible;</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineminus">-	  visible = cvSetNode(data.cvNotes, card.getProperty(&quot;Notes&quot;)) || visible;</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineplus">+    visible = cvSetNodeWithLabel(data.cvCustom1, zCustom1, card.getProperty(&quot;Custom1&quot;)) || visible;</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineplus">+    visible = cvSetNodeWithLabel(data.cvCustom2, zCustom2, card.getProperty(&quot;Custom2&quot;)) || visible;</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineplus">+    visible = cvSetNodeWithLabel(data.cvCustom3, zCustom3, card.getProperty(&quot;Custom3&quot;)) || visible;</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineplus">+    visible = cvSetNodeWithLabel(data.cvCustom4, zCustom4, card.getProperty(&quot;Custom4&quot;)) || visible;</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineplus">+    visible = cvSetNode(data.cvNotes, card.getProperty(&quot;Notes&quot;)) || visible;</span>
<a href="#l1.226"></a><span id="l1.226">     visible = setBuddyIcon(card, data.cvBuddyIcon) || visible;</span>
<a href="#l1.227"></a><span id="l1.227"> </span>
<a href="#l1.228"></a><span id="l1.228">     cvSetVisible(data.cvhOther, visible);</span>
<a href="#l1.229"></a><span id="l1.229">     cvSetVisible(data.cvbOther, visible);</span>
<a href="#l1.230"></a><span id="l1.230"> </span>
<a href="#l1.231"></a><span id="l1.231">     // hide description section, not show for non-mailing lists</span>
<a href="#l1.232"></a><span id="l1.232">     cvSetVisible(data.cvbDescription, false);</span>
<a href="#l1.233"></a><span id="l1.233"> </span>
<a href="#l1.234"></a><span id="l1.234">     // hide addresses section, not show for non-mailing lists</span>
<a href="#l1.235"></a><span id="l1.235">     cvSetVisible(data.cvbAddresses, false);</span>
<a href="#l1.236"></a><span id="l1.236">   }</span>
<a href="#l1.237"></a><span id="l1.237"> </span>
<a href="#l1.238"></a><span id="l1.238" class="difflineminus">-	// Phone section</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineminus">-	visible = cvSetNodeWithLabel(data.cvPhWork, zWork, card.getProperty(&quot;WorkPhone&quot;));</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineminus">-	visible = cvSetNodeWithLabel(data.cvPhHome, zHome, card.getProperty(&quot;HomePhone&quot;)) || visible;</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineminus">-	visible = cvSetNodeWithLabel(data.cvPhFax, zFax, card.getProperty(&quot;FaxNumber&quot;)) || visible;</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineminus">-	visible = cvSetNodeWithLabel(data.cvPhCellular, zCellular, card.getProperty(&quot;CellularNumber&quot;)) || visible;</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineminus">-	visible = cvSetNodeWithLabel(data.cvPhPager, zPager, card.getProperty(&quot;PagerNumber&quot;)) || visible;</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineminus">-	cvSetVisible(data.cvhPhone, visible);</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-	cvSetVisible(data.cvbPhone, visible);</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-	// Work section</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-	visible = cvSetNode(data.cvJobTitle, card.getProperty(&quot;JobTitle&quot;));</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineminus">-	visible = cvSetNode(data.cvDepartment, card.getProperty(&quot;Department&quot;)) || visible;</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineminus">-	visible = cvSetNode(data.cvCompany, card.getProperty(&quot;Company&quot;)) || visible;</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineplus">+  // Phone section</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineplus">+  visible = cvSetNodeWithLabel(data.cvPhWork, zWork, card.getProperty(&quot;WorkPhone&quot;));</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineplus">+  visible = cvSetNodeWithLabel(data.cvPhHome, zHome, card.getProperty(&quot;HomePhone&quot;)) || visible;</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineplus">+  visible = cvSetNodeWithLabel(data.cvPhFax, zFax, card.getProperty(&quot;FaxNumber&quot;)) || visible;</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineplus">+  visible = cvSetNodeWithLabel(data.cvPhCellular, zCellular, card.getProperty(&quot;CellularNumber&quot;)) || visible;</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+  visible = cvSetNodeWithLabel(data.cvPhPager, zPager, card.getProperty(&quot;PagerNumber&quot;)) || visible;</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineplus">+  cvSetVisible(data.cvhPhone, visible);</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineplus">+  cvSetVisible(data.cvbPhone, visible);</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineplus">+  // Work section</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineplus">+  visible = cvSetNode(data.cvJobTitle, card.getProperty(&quot;JobTitle&quot;));</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineplus">+  visible = cvSetNode(data.cvDepartment, card.getProperty(&quot;Department&quot;)) || visible;</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineplus">+  visible = cvSetNode(data.cvCompany, card.getProperty(&quot;Company&quot;)) || visible;</span>
<a href="#l1.262"></a><span id="l1.262"> </span>
<a href="#l1.263"></a><span id="l1.263" class="difflineminus">-        var addressVisible = cvSetNode(data.cvWorkAddress, card.getProperty(&quot;WorkAddress&quot;));</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineminus">-	addressVisible = cvSetNode(data.cvWorkAddress2, card.getProperty(&quot;WorkAddress2&quot;)) || addressVisible;</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineminus">-	addressVisible = cvSetCityStateZip(data.cvWorkCityStZip, card.getProperty(&quot;WorkCity&quot;), card.getProperty(&quot;WorkState&quot;), card.getProperty(&quot;WorkZipCode&quot;)) || addressVisible;</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineminus">-	addressVisible = cvSetNode(data.cvWorkCountry, card.getProperty(&quot;WorkCountry&quot;)) || addressVisible;</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+  var addressVisible = cvSetNode(data.cvWorkAddress, card.getProperty(&quot;WorkAddress&quot;));</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineplus">+  addressVisible = cvSetNode(data.cvWorkAddress2, card.getProperty(&quot;WorkAddress2&quot;)) || addressVisible;</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineplus">+  addressVisible = cvSetCityStateZip(data.cvWorkCityStZip, card.getProperty(&quot;WorkCity&quot;), card.getProperty(&quot;WorkState&quot;), card.getProperty(&quot;WorkZipCode&quot;)) || addressVisible;</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineplus">+  addressVisible = cvSetNode(data.cvWorkCountry, card.getProperty(&quot;WorkCountry&quot;)) || addressVisible;</span>
<a href="#l1.271"></a><span id="l1.271"> </span>
<a href="#l1.272"></a><span id="l1.272">   mapURLList = data.cvWorkMapIt.firstChild;</span>
<a href="#l1.273"></a><span id="l1.273">   if (addressVisible)</span>
<a href="#l1.274"></a><span id="l1.274">     mapURLList.initMapAddressFromCard(card, &quot;Work&quot;);</span>
<a href="#l1.275"></a><span id="l1.275"> </span>
<a href="#l1.276"></a><span id="l1.276">   cvSetVisible(data.cvbWorkMapItBox, addressVisible &amp;&amp; !!mapURLList.mapURL);</span>
<a href="#l1.277"></a><span id="l1.277"> </span>
<a href="#l1.278"></a><span id="l1.278">         visible = HandleLink(data.cvWorkWebPage, &quot;&quot;, card.getProperty(&quot;WebPage1&quot;), data.cvWorkWebPageBox, card.getProperty(&quot;WebPage1&quot;)) || addressVisible || visible;</span>
<a href="#l1.279"></a><span id="l1.279"> </span>
<a href="#l1.280"></a><span id="l1.280" class="difflineminus">-	cvSetVisible(data.cvhWork, visible);</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineminus">-	cvSetVisible(data.cvbWork, visible);</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineplus">+  cvSetVisible(data.cvhWork, visible);</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineplus">+  cvSetVisible(data.cvbWork, visible);</span>
<a href="#l1.284"></a><span id="l1.284"> </span>
<a href="#l1.285"></a><span id="l1.285" class="difflineminus">-	// make the card view box visible</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineminus">-	cvSetVisible(top.cvData.CardViewBox, true);</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineplus">+  // make the card view box visible</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineplus">+  cvSetVisible(top.cvData.CardViewBox, true);</span>
<a href="#l1.289"></a><span id="l1.289"> }</span>
<a href="#l1.290"></a><span id="l1.290"> </span>
<a href="#l1.291"></a><span id="l1.291"> function setBuddyIcon(card, buddyIcon)</span>
<a href="#l1.292"></a><span id="l1.292"> {</span>
<a href="#l1.293"></a><span id="l1.293">   try {</span>
<a href="#l1.294"></a><span id="l1.294">     var myScreenName = Services.prefs.getCharPref(&quot;aim.session.screenname&quot;);</span>
<a href="#l1.295"></a><span id="l1.295">     if (myScreenName &amp;&amp; card.primaryEmail) {</span>
<a href="#l1.296"></a><span id="l1.296">       if (!gProfileDirURL) {</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineat">@@ -345,17 +345,17 @@ function setBuddyIcon(card, buddyIcon)</span>
<a href="#l1.298"></a><span id="l1.298">   }</span>
<a href="#l1.299"></a><span id="l1.299"> </span>
<a href="#l1.300"></a><span id="l1.300">   buddyIcon.setAttribute(&quot;src&quot;, &quot;&quot;);</span>
<a href="#l1.301"></a><span id="l1.301">   return false;</span>
<a href="#l1.302"></a><span id="l1.302"> }</span>
<a href="#l1.303"></a><span id="l1.303"> </span>
<a href="#l1.304"></a><span id="l1.304"> function ClearCardViewPane()</span>
<a href="#l1.305"></a><span id="l1.305"> {</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineminus">-	cvSetVisible(top.cvData.CardViewBox, false);</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+  cvSetVisible(top.cvData.CardViewBox, false);</span>
<a href="#l1.308"></a><span id="l1.308"> }</span>
<a href="#l1.309"></a><span id="l1.309"> </span>
<a href="#l1.310"></a><span id="l1.310"> function cvSetNodeWithLabel(node, label, text)</span>
<a href="#l1.311"></a><span id="l1.311"> {</span>
<a href="#l1.312"></a><span id="l1.312">   if (text) {</span>
<a href="#l1.313"></a><span id="l1.313">     if (label)</span>
<a href="#l1.314"></a><span id="l1.314">       return cvSetNode(node, label + &quot;: &quot; + text);</span>
<a href="#l1.315"></a><span id="l1.315">     else</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineat">@@ -383,37 +383,37 @@ function cvSetCityStateZip(node, city, s</span>
<a href="#l1.317"></a><span id="l1.317">     text = city + state + zip;</span>
<a href="#l1.318"></a><span id="l1.318">   }</span>
<a href="#l1.319"></a><span id="l1.319"> </span>
<a href="#l1.320"></a><span id="l1.320">   return cvSetNode(node, text);</span>
<a href="#l1.321"></a><span id="l1.321"> }</span>
<a href="#l1.322"></a><span id="l1.322"> </span>
<a href="#l1.323"></a><span id="l1.323"> function cvSetNode(node, text)</span>
<a href="#l1.324"></a><span id="l1.324"> {</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineminus">-	if ( node )</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineminus">-	{</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineminus">-		if ( !node.hasChildNodes() )</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineminus">-		{</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineminus">-			var textNode = document.createTextNode(text);</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineminus">-			node.appendChild(textNode);</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineminus">-		}</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineminus">-		else if ( node.childNodes.length == 1 )</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineminus">-			node.childNodes[0].nodeValue = text;</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+  if ( node )</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineplus">+  {</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineplus">+    if ( !node.hasChildNodes() )</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineplus">+    {</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineplus">+      var textNode = document.createTextNode(text);</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineplus">+      node.appendChild(textNode);</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineplus">+    }</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineplus">+    else if ( node.childNodes.length == 1 )</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineplus">+      node.childNodes[0].nodeValue = text;</span>
<a href="#l1.343"></a><span id="l1.343"> </span>
<a href="#l1.344"></a><span id="l1.344" class="difflineminus">-		var visible;</span>
<a href="#l1.345"></a><span id="l1.345" class="difflineplus">+    var visible;</span>
<a href="#l1.346"></a><span id="l1.346"> </span>
<a href="#l1.347"></a><span id="l1.347" class="difflineminus">-		if ( text )</span>
<a href="#l1.348"></a><span id="l1.348" class="difflineminus">-			visible = true;</span>
<a href="#l1.349"></a><span id="l1.349" class="difflineminus">-		else</span>
<a href="#l1.350"></a><span id="l1.350" class="difflineminus">-			visible = false;</span>
<a href="#l1.351"></a><span id="l1.351" class="difflineplus">+    if ( text )</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineplus">+      visible = true;</span>
<a href="#l1.353"></a><span id="l1.353" class="difflineplus">+    else</span>
<a href="#l1.354"></a><span id="l1.354" class="difflineplus">+      visible = false;</span>
<a href="#l1.355"></a><span id="l1.355"> </span>
<a href="#l1.356"></a><span id="l1.356" class="difflineminus">-		cvSetVisible(node, visible);</span>
<a href="#l1.357"></a><span id="l1.357" class="difflineminus">-	}</span>
<a href="#l1.358"></a><span id="l1.358" class="difflineplus">+    cvSetVisible(node, visible);</span>
<a href="#l1.359"></a><span id="l1.359" class="difflineplus">+  }</span>
<a href="#l1.360"></a><span id="l1.360"> </span>
<a href="#l1.361"></a><span id="l1.361" class="difflineminus">-	return visible;</span>
<a href="#l1.362"></a><span id="l1.362" class="difflineplus">+  return visible;</span>
<a href="#l1.363"></a><span id="l1.363"> }</span>
<a href="#l1.364"></a><span id="l1.364"> </span>
<a href="#l1.365"></a><span id="l1.365"> function cvAddAddressNodes(node, uri)</span>
<a href="#l1.366"></a><span id="l1.366"> {</span>
<a href="#l1.367"></a><span id="l1.367">   var visible = false;</span>
<a href="#l1.368"></a><span id="l1.368"> </span>
<a href="#l1.369"></a><span id="l1.369">   if (node) {</span>
<a href="#l1.370"></a><span id="l1.370">     var editList = GetDirectoryFromURI(uri);</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineat">@@ -421,17 +421,17 @@ function cvAddAddressNodes(node, uri)</span>
<a href="#l1.372"></a><span id="l1.372"> </span>
<a href="#l1.373"></a><span id="l1.373">     if (addressList) {</span>
<a href="#l1.374"></a><span id="l1.374">       var total = addressList.length;</span>
<a href="#l1.375"></a><span id="l1.375">       if (total &gt; 0) {</span>
<a href="#l1.376"></a><span id="l1.376">         while (node.hasChildNodes()) {</span>
<a href="#l1.377"></a><span id="l1.377">           node.lastChild.remove();</span>
<a href="#l1.378"></a><span id="l1.378">         }</span>
<a href="#l1.379"></a><span id="l1.379">         for (i = 0;  i &lt; total; i++ ) {</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineminus">-      	   var descNode = document.createElement(&quot;description&quot;);</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineplus">+          var descNode = document.createElement(&quot;description&quot;);</span>
<a href="#l1.382"></a><span id="l1.382">           var card = addressList.queryElementAt(i, Ci.nsIAbCard);</span>
<a href="#l1.383"></a><span id="l1.383"> </span>
<a href="#l1.384"></a><span id="l1.384">           descNode.setAttribute(&quot;class&quot;, &quot;CardViewLink&quot;);</span>
<a href="#l1.385"></a><span id="l1.385">           node.appendChild(descNode);</span>
<a href="#l1.386"></a><span id="l1.386"> </span>
<a href="#l1.387"></a><span id="l1.387">           var linkNode = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;a&quot;);</span>
<a href="#l1.388"></a><span id="l1.388">           linkNode.setAttribute(&quot;id&quot;, &quot;addr#&quot; + i);</span>
<a href="#l1.389"></a><span id="l1.389">           linkNode.setAttribute(&quot;href&quot;, &quot;mailto:&quot; + card.primaryEmail);</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineat">@@ -445,20 +445,20 @@ function cvAddAddressNodes(node, uri)</span>
<a href="#l1.391"></a><span id="l1.391">     }</span>
<a href="#l1.392"></a><span id="l1.392">     cvSetVisible(node, visible);</span>
<a href="#l1.393"></a><span id="l1.393">   }</span>
<a href="#l1.394"></a><span id="l1.394">   return visible;</span>
<a href="#l1.395"></a><span id="l1.395"> }</span>
<a href="#l1.396"></a><span id="l1.396"> </span>
<a href="#l1.397"></a><span id="l1.397"> function cvSetVisible(node, visible)</span>
<a href="#l1.398"></a><span id="l1.398"> {</span>
<a href="#l1.399"></a><span id="l1.399" class="difflineminus">-	if ( visible )</span>
<a href="#l1.400"></a><span id="l1.400" class="difflineminus">-		node.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l1.401"></a><span id="l1.401" class="difflineminus">-	else</span>
<a href="#l1.402"></a><span id="l1.402" class="difflineminus">-		node.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l1.403"></a><span id="l1.403" class="difflineplus">+  if ( visible )</span>
<a href="#l1.404"></a><span id="l1.404" class="difflineplus">+    node.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l1.405"></a><span id="l1.405" class="difflineplus">+  else</span>
<a href="#l1.406"></a><span id="l1.406" class="difflineplus">+    node.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l1.407"></a><span id="l1.407"> }</span>
<a href="#l1.408"></a><span id="l1.408"> </span>
<a href="#l1.409"></a><span id="l1.409"> function HandleLink(node, label, value, box, link)</span>
<a href="#l1.410"></a><span id="l1.410"> {</span>
<a href="#l1.411"></a><span id="l1.411">   var visible = cvSetNodeWithLabel(node, label, value);</span>
<a href="#l1.412"></a><span id="l1.412">   if (visible)</span>
<a href="#l1.413"></a><span id="l1.413">     node.setAttribute('href', link);</span>
<a href="#l1.414"></a><span id="l1.414">   cvSetVisible(box, visible);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -24,17 +24,17 @@ var gCcButton;</span>
<a href="#l2.4"></a><span id="l2.4"> var gBccButton;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> var gActivatedButton;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> var gDragService = Cc[&quot;@mozilla.org/widget/dragservice;1&quot;]</span>
<a href="#l2.9"></a><span id="l2.9">                      .getService(Ci.nsIDragService);</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> var gSelectAddressesAbViewListener = {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-	onSelectionChanged: function() {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  onSelectionChanged: function() {</span>
<a href="#l2.14"></a><span id="l2.14">     ResultsPaneSelectionChanged();</span>
<a href="#l2.15"></a><span id="l2.15">   },</span>
<a href="#l2.16"></a><span id="l2.16">   onCountChanged: function(total) {</span>
<a href="#l2.17"></a><span id="l2.17">     // do nothing</span>
<a href="#l2.18"></a><span id="l2.18">   }</span>
<a href="#l2.19"></a><span id="l2.19"> };</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> function GetAbViewListener()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/addressbook-panel.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/addressbook-panel.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -53,31 +53,31 @@</span>
<a href="#l3.4"></a><span id="l3.4">     &lt;menuseparator/&gt;</span>
<a href="#l3.5"></a><span id="l3.5">     &lt;menuitem label=&quot;&amp;newAddrBookCard.label;&quot; accesskey=&quot;&amp;newAddrBookCard.accesskey;&quot; oncommand=&quot;AbPanelNewCard();&quot;/&gt;</span>
<a href="#l3.6"></a><span id="l3.6">     &lt;menuitem label=&quot;&amp;newAddrBookMailingList.label;&quot; accesskey=&quot;&amp;newAddrBookMailingList.accesskey;&quot; command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l3.7"></a><span id="l3.7">     &lt;menuseparator/&gt;</span>
<a href="#l3.8"></a><span id="l3.8">     &lt;menuitem label=&quot;&amp;addrBookCardProperties.label;&quot; accesskey=&quot;&amp;addrBookCardProperties.accesskey;&quot; command=&quot;cmd_properties&quot;/&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;/menupopup&gt;</span>
<a href="#l3.10"></a><span id="l3.10">   &lt;vbox id=&quot;results_box&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11">     &lt;hbox id=&quot;panel-bar&quot; class=&quot;toolbar&quot; align=&quot;center&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-	  &lt;label value=&quot;&amp;lookIn.label;&quot; control=&quot;addressbookList&quot; id=&quot;lookInLabel&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      &lt;label value=&quot;&amp;lookIn.label;&quot; control=&quot;addressbookList&quot; id=&quot;lookInLabel&quot;/&gt;</span>
<a href="#l3.14"></a><span id="l3.14">       &lt;menulist id=&quot;addressbookList&quot;</span>
<a href="#l3.15"></a><span id="l3.15">                 oncommand=&quot;DirPaneSelectionChangeMenulist();&quot; flex=&quot;1&quot;</span>
<a href="#l3.16"></a><span id="l3.16">                 persist=&quot;value&quot;&gt;</span>
<a href="#l3.17"></a><span id="l3.17">         &lt;menupopup id=&quot;addressbookList-menupopup&quot; class=&quot;addrbooksPopup&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">       &lt;/menulist&gt;</span>
<a href="#l3.19"></a><span id="l3.19">     &lt;/hbox&gt;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-	&lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-	  &lt;label value=&quot;&amp;for.label;&quot; id=&quot;forLabel&quot; control=&quot;searchInput&quot;/&gt;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-	  &lt;textbox id=&quot;searchInput&quot; flex=&quot;1&quot; type=&quot;search&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+    &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+      &lt;label value=&quot;&amp;for.label;&quot; id=&quot;forLabel&quot; control=&quot;searchInput&quot;/&gt;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+      &lt;textbox id=&quot;searchInput&quot; flex=&quot;1&quot; type=&quot;search&quot;</span>
<a href="#l3.26"></a><span id="l3.26">                aria-labelledby=&quot;lookInLabel addressbookList forLabel&quot;</span>
<a href="#l3.27"></a><span id="l3.27">                aria-controls=&quot;abResultsTree&quot;</span>
<a href="#l3.28"></a><span id="l3.28">                placeholder=&quot;&amp;for.placeholder;&quot;</span>
<a href="#l3.29"></a><span id="l3.29">                oncommand=&quot;onEnterInSearchBar();&quot; clickSelectsAll=&quot;true&quot;/&gt;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-	&lt;/hbox&gt;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l3.32"></a><span id="l3.32"> </span>
<a href="#l3.33"></a><span id="l3.33">     &lt;tree id=&quot;abResultsTree&quot; flex=&quot;1&quot; context=&quot;composeMail&quot; onclick=&quot;AbResultsPaneOnClick(event);&quot; class=&quot;plain&quot;</span>
<a href="#l3.34"></a><span id="l3.34">           sortCol=&quot;GeneratedName&quot; persist=&quot;sortCol&quot;&gt;</span>
<a href="#l3.35"></a><span id="l3.35">   &lt;treecols&gt;</span>
<a href="#l3.36"></a><span id="l3.36">     &lt;!-- these column ids must match up to the mork column names, see nsIAddrDatabase.idl --&gt;</span>
<a href="#l3.37"></a><span id="l3.37">     &lt;treecol id=&quot;GeneratedName&quot;</span>
<a href="#l3.38"></a><span id="l3.38">           persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot; label=&quot;&amp;GeneratedName.label;&quot; primary=&quot;true&quot;/&gt;</span>
<a href="#l3.39"></a><span id="l3.39">     &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/addressbook.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/addressbook.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -51,17 +51,17 @@ function GetAbViewListener()</span>
<a href="#l4.4"></a><span id="l4.4"> {</span>
<a href="#l4.5"></a><span id="l4.5">   return gAddressBookAbViewListener;</span>
<a href="#l4.6"></a><span id="l4.6"> }</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> function OnLoadAddressBook()</span>
<a href="#l4.9"></a><span id="l4.9"> {</span>
<a href="#l4.10"></a><span id="l4.10">   gSearchInput = document.getElementById(&quot;searchInput&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  verifyAccounts(null, false); 	// this will do migration, if we need to.</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  verifyAccounts(null, false); // this will do migration, if we need to.</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">   InitCommonJS();</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">   UpgradeAddressBookResultsPaneUI(&quot;mailnews.ui.addressbook_results.version&quot;);</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   GetCurrentPrefs();</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">   // FIX ME - later we will be able to use onload from the overlay</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -95,35 +95,35 @@ function OnLoadAddressBook()</span>
<a href="#l4.23"></a><span id="l4.23">   window.QueryInterface(Ci.nsIInterfaceRequestor)</span>
<a href="#l4.24"></a><span id="l4.24">         .getInterface(Ci.nsIWebNavigation)</span>
<a href="#l4.25"></a><span id="l4.25">         .QueryInterface(Ci.nsIDocShell)</span>
<a href="#l4.26"></a><span id="l4.26">         .useErrorPages = false;</span>
<a href="#l4.27"></a><span id="l4.27"> }</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29"> function GetCurrentPrefs()</span>
<a href="#l4.30"></a><span id="l4.30"> {</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-	// check &quot;Show Name As&quot; menu item based on pref</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-	var menuitemID;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-	switch (Services.prefs.getIntPref(kPrefMailAddrBookLastNameFirst))</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-	{</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-		case kFirstNameFirst:</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-			menuitemID = 'firstLastCmd';</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-			break;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-		case kLastNameFirst:</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-			menuitemID = 'lastFirstCmd';</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-			break;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-		case kDisplayName:</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-		default:</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-			menuitemID = 'displayNameCmd';</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-			break;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-	}</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+  // check &quot;Show Name As&quot; menu item based on pref</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+  var menuitemID;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+  switch (Services.prefs.getIntPref(kPrefMailAddrBookLastNameFirst))</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+  {</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    case kFirstNameFirst:</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+      menuitemID = 'firstLastCmd';</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+      break;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+    case kLastNameFirst:</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+      menuitemID = 'lastFirstCmd';</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+      break;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+    case kDisplayName:</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+    default:</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+      menuitemID = 'displayNameCmd';</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+      break;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+  }</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-	var menuitem = top.document.getElementById(menuitemID);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-	if ( menuitem )</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-		menuitem.setAttribute('checked', 'true');</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+  var menuitem = top.document.getElementById(menuitemID);</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+  if ( menuitem )</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+    menuitem.setAttribute('checked', 'true');</span>
<a href="#l4.68"></a><span id="l4.68"> </span>
<a href="#l4.69"></a><span id="l4.69">   // show phonetic fields if indicated by the pref</span>
<a href="#l4.70"></a><span id="l4.70">   if (GetLocalizedStringPref(&quot;mail.addr_book.show_phonetic_fields&quot;) == &quot;true&quot;)</span>
<a href="#l4.71"></a><span id="l4.71">     document.getElementById(&quot;cmd_SortBy_PhoneticName&quot;)</span>
<a href="#l4.72"></a><span id="l4.72">             .setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l4.73"></a><span id="l4.73"> }</span>
<a href="#l4.74"></a><span id="l4.74"> </span>
<a href="#l4.75"></a><span id="l4.75"> </span>
<a href="#l4.76"></a><span id="l4.76" class="difflineat">@@ -205,20 +205,20 @@ function AbPrintCardInternal(doPrintPrev</span>
<a href="#l4.77"></a><span id="l4.77">     let card = selectedItems[i];</span>
<a href="#l4.78"></a><span id="l4.78">     let printCardUrl = CreatePrintCardUrl(card);</span>
<a href="#l4.79"></a><span id="l4.79">     if (printCardUrl) {</span>
<a href="#l4.80"></a><span id="l4.80">       selectionArray.push(printCardUrl);</span>
<a href="#l4.81"></a><span id="l4.81">     }</span>
<a href="#l4.82"></a><span id="l4.82">   }</span>
<a href="#l4.83"></a><span id="l4.83"> </span>
<a href="#l4.84"></a><span id="l4.84">   printEngineWindow = window.openDialog(&quot;chrome://messenger/content/msgPrintEngine.xul&quot;,</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-                                         &quot;&quot;,</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-                                         &quot;chrome,dialog=no,all&quot;,</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-                                         selectionArray.length, selectionArray,</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-                                         statusFeedback, doPrintPreview, msgType);</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+                                        &quot;&quot;,</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+                                        &quot;chrome,dialog=no,all&quot;,</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+                                        selectionArray.length, selectionArray,</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+                                        statusFeedback, doPrintPreview, msgType);</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94">   return;</span>
<a href="#l4.95"></a><span id="l4.95"> }</span>
<a href="#l4.96"></a><span id="l4.96"> </span>
<a href="#l4.97"></a><span id="l4.97"> function AbPrintCard()</span>
<a href="#l4.98"></a><span id="l4.98"> {</span>
<a href="#l4.99"></a><span id="l4.99">   AbPrintCardInternal(false, Ci.nsIMsgPrintEngine.MNAB_PRINT_AB_CARD);</span>
<a href="#l4.100"></a><span id="l4.100"> }</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineat">@@ -235,33 +235,34 @@ function CreatePrintCardUrl(card)</span>
<a href="#l4.102"></a><span id="l4.102"> </span>
<a href="#l4.103"></a><span id="l4.103"> function AbPrintAddressBookInternal(doPrintPreview, msgType)</span>
<a href="#l4.104"></a><span id="l4.104"> {</span>
<a href="#l4.105"></a><span id="l4.105">   let uri = getSelectedDirectoryURI();</span>
<a href="#l4.106"></a><span id="l4.106">   if (!uri)</span>
<a href="#l4.107"></a><span id="l4.107">     return;</span>
<a href="#l4.108"></a><span id="l4.108"> </span>
<a href="#l4.109"></a><span id="l4.109">   var statusFeedback;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-	statusFeedback = Cc[&quot;@mozilla.org/messenger/statusfeedback;1&quot;].createInstance();</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-	statusFeedback = statusFeedback.QueryInterface(Ci.nsIMsgStatusFeedback);</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+  statusFeedback = Cc[&quot;@mozilla.org/messenger/statusfeedback;1&quot;].createInstance();</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+  statusFeedback = statusFeedback.QueryInterface(Ci.nsIMsgStatusFeedback);</span>
<a href="#l4.114"></a><span id="l4.114"> </span>
<a href="#l4.115"></a><span id="l4.115">   /*</span>
<a href="#l4.116"></a><span id="l4.116">     turn &quot;moz-abmdbdirectory://abook.mab&quot; into</span>
<a href="#l4.117"></a><span id="l4.117">     &quot;addbook://moz-abmdbdirectory/abook.mab?action=print&quot;</span>
<a href="#l4.118"></a><span id="l4.118">    */</span>
<a href="#l4.119"></a><span id="l4.119"> </span>
<a href="#l4.120"></a><span id="l4.120">   var abURIArr = uri.split(&quot;://&quot;);</span>
<a href="#l4.121"></a><span id="l4.121">   var printUrl = &quot;addbook://&quot; + abURIArr[0] + &quot;/&quot; + abURIArr[1] + &quot;?action=print&quot;</span>
<a href="#l4.122"></a><span id="l4.122"> </span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-	printEngineWindow = window.openDialog(&quot;chrome://messenger/content/msgPrintEngine.xul&quot;,</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-										&quot;&quot;,</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-										&quot;chrome,dialog=no,all&quot;,</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-										1, [printUrl], statusFeedback, doPrintPreview, msgType);</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+  printEngineWindow = window.openDialog(&quot;chrome://messenger/content/msgPrintEngine.xul&quot;,</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+                                        &quot;&quot;,</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+                                        &quot;chrome,dialog=no,all&quot;,</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+                                        1, [printUrl],</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+                                        statusFeedback, doPrintPreview, msgType);</span>
<a href="#l4.132"></a><span id="l4.132"> </span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-	return;</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+  return;</span>
<a href="#l4.135"></a><span id="l4.135"> }</span>
<a href="#l4.136"></a><span id="l4.136"> </span>
<a href="#l4.137"></a><span id="l4.137"> function AbPrintAddressBook()</span>
<a href="#l4.138"></a><span id="l4.138"> {</span>
<a href="#l4.139"></a><span id="l4.139">   AbPrintAddressBookInternal(false, Ci.nsIMsgPrintEngine.MNAB_PRINT_ADDRBOOK);</span>
<a href="#l4.140"></a><span id="l4.140"> }</span>
<a href="#l4.141"></a><span id="l4.141"> </span>
<a href="#l4.142"></a><span id="l4.142"> function AbPrintPreviewAddressBook()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/mailnews/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/mailnews/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -719,36 +719,35 @@ function awRecipientTextCommand(userActi</span>
<a href="#l5.4"></a><span id="l5.4"> function awRecipientErrorCommand(errItem, element)</span>
<a href="#l5.5"></a><span id="l5.5"> {</span>
<a href="#l5.6"></a><span id="l5.6">     // remove the angle brackets from the general error message to construct</span>
<a href="#l5.7"></a><span id="l5.7">     // the title for the alert.  someday we'll pass this info using a real</span>
<a href="#l5.8"></a><span id="l5.8">     // exception object, and then this code can go away.</span>
<a href="#l5.9"></a><span id="l5.9">     //</span>
<a href="#l5.10"></a><span id="l5.10">     var generalErrString;</span>
<a href="#l5.11"></a><span id="l5.11">     if (errItem.value != &quot;&quot;) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-	generalErrString = errItem.value.slice(1, errItem.value.length-1);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      generalErrString = errItem.value.slice(1, errItem.value.length-1);</span>
<a href="#l5.14"></a><span id="l5.14">     } else {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-	generalErrString = &quot;Unknown LDAP server problem encountered&quot;;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+      generalErrString = &quot;Unknown LDAP server problem encountered&quot;;</span>
<a href="#l5.17"></a><span id="l5.17">     }</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">     // try and get the string of the specific error to contruct the complete</span>
<a href="#l5.20"></a><span id="l5.20">     // err msg, otherwise fall back to something generic.  This message is</span>
<a href="#l5.21"></a><span id="l5.21">     // handed to us as an nsISupportsString in the param slot of the</span>
<a href="#l5.22"></a><span id="l5.22">     // autocomplete error item, by agreement documented in</span>
<a href="#l5.23"></a><span id="l5.23">     // nsILDAPAutoCompFormatter.idl</span>
<a href="#l5.24"></a><span id="l5.24">     //</span>
<a href="#l5.25"></a><span id="l5.25">     var specificErrString = &quot;&quot;;</span>
<a href="#l5.26"></a><span id="l5.26">     try {</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-	var specificError = errItem.param.QueryInterface(</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-	    Ci.nsISupportsString);</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-	specificErrString = specificError.data;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+      var specificError = errItem.param.QueryInterface(Ci.nsISupportsString);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+      specificErrString = specificError.data;</span>
<a href="#l5.32"></a><span id="l5.32">     } catch (ex) {</span>
<a href="#l5.33"></a><span id="l5.33">     }</span>
<a href="#l5.34"></a><span id="l5.34">     if (specificErrString == &quot;&quot;) {</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-	specificErrString = &quot;Internal error&quot;;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+      specificErrString = &quot;Internal error&quot;;</span>
<a href="#l5.37"></a><span id="l5.37">     }</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">     Services.prompt.alert(window, generalErrString, specificErrString);</span>
<a href="#l5.40"></a><span id="l5.40"> }</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42"> function awRecipientKeyPress(event, element)</span>
<a href="#l5.43"></a><span id="l5.43"> {</span>
<a href="#l5.44"></a><span id="l5.44">   switch(event.keyCode) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/mailnews/components/compose/content/prefs/pref-composing_messages.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -159,17 +159,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">                 &lt;menuitem value=&quot;Times New Roman, Times, serif&quot;</span>
<a href="#l6.5"></a><span id="l6.5">                           label=&quot;&amp;fontTimes.label;&quot;/&gt;</span>
<a href="#l6.6"></a><span id="l6.6">                 &lt;menuitem value=&quot;Courier New, Courier, monospace&quot;</span>
<a href="#l6.7"></a><span id="l6.7">                           label=&quot;&amp;fontCourier.label;&quot;/&gt;</span>
<a href="#l6.8"></a><span id="l6.8">                 &lt;menuseparator/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">               &lt;/menupopup&gt;</span>
<a href="#l6.10"></a><span id="l6.10">             &lt;/menulist&gt;</span>
<a href="#l6.11"></a><span id="l6.11">           &lt;/row&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-	  &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+          &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14">             &lt;label value=&quot;&amp;size.label;&quot;</span>
<a href="#l6.15"></a><span id="l6.15">                    accesskey=&quot;&amp;size.accesskey;&quot;</span>
<a href="#l6.16"></a><span id="l6.16">                    control=&quot;fontSizeSelect&quot;/&gt;</span>
<a href="#l6.17"></a><span id="l6.17">             &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.18"></a><span id="l6.18">               &lt;menulist id=&quot;fontSizeSelect&quot; preference=&quot;msgcompose.font_size&quot;&gt;</span>
<a href="#l6.19"></a><span id="l6.19">                 &lt;menupopup&gt;</span>
<a href="#l6.20"></a><span id="l6.20">                   &lt;menuitem value=&quot;x-small&quot; label=&quot;&amp;size-tinyCmd.label;&quot;/&gt;</span>
<a href="#l6.21"></a><span id="l6.21">                   &lt;menuitem value=&quot;small&quot; label=&quot;&amp;size-smallCmd.label;&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/content/FilterListDialog.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/content/FilterListDialog.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -16,28 +16,28 @@ var gRunFiltersButton;</span>
<a href="#l7.4"></a><span id="l7.4"> var gFilterBundle;</span>
<a href="#l7.5"></a><span id="l7.5"> var gFilterListMsgWindow = null;</span>
<a href="#l7.6"></a><span id="l7.6"> var gFilterTree;</span>
<a href="#l7.7"></a><span id="l7.7"> var gStatusBar;</span>
<a href="#l7.8"></a><span id="l7.8"> var gStatusText;</span>
<a href="#l7.9"></a><span id="l7.9"> var gCurrentFolder;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> var gStatusFeedback = {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-	showStatusString: function(status)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  showStatusString: function(status)</span>
<a href="#l7.14"></a><span id="l7.14">   {</span>
<a href="#l7.15"></a><span id="l7.15">     gStatusText.setAttribute(&quot;value&quot;, status);</span>
<a href="#l7.16"></a><span id="l7.16">   },</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-	startMeteors: function()</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+  startMeteors: function()</span>
<a href="#l7.19"></a><span id="l7.19">   {</span>
<a href="#l7.20"></a><span id="l7.20">     // change run button to be a stop button</span>
<a href="#l7.21"></a><span id="l7.21">     gRunFiltersButton.setAttribute(&quot;label&quot;, gRunFiltersButton.getAttribute(&quot;stoplabel&quot;));</span>
<a href="#l7.22"></a><span id="l7.22">     gRunFiltersButton.setAttribute(&quot;accesskey&quot;, gRunFiltersButton.getAttribute(&quot;stopaccesskey&quot;));</span>
<a href="#l7.23"></a><span id="l7.23">     gStatusBar.setAttribute(&quot;mode&quot;, &quot;undetermined&quot;);</span>
<a href="#l7.24"></a><span id="l7.24">   },</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-	stopMeteors: function()</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+  stopMeteors: function()</span>
<a href="#l7.27"></a><span id="l7.27">   {</span>
<a href="#l7.28"></a><span id="l7.28">     try {</span>
<a href="#l7.29"></a><span id="l7.29">       // change run button to be a stop button</span>
<a href="#l7.30"></a><span id="l7.30">       gRunFiltersButton.setAttribute(&quot;label&quot;, gRunFiltersButton.getAttribute(&quot;runlabel&quot;));</span>
<a href="#l7.31"></a><span id="l7.31">       gRunFiltersButton.setAttribute(&quot;accesskey&quot;, gRunFiltersButton.getAttribute(&quot;runaccesskey&quot;));</span>
<a href="#l7.32"></a><span id="l7.32">       gStatusBar.setAttribute(&quot;mode&quot;, &quot;normal&quot;);</span>
<a href="#l7.33"></a><span id="l7.33">     }</span>
<a href="#l7.34"></a><span id="l7.34">     catch (ex) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/content/mac/platformMailnewsOverlay.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/content/mac/platformMailnewsOverlay.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -6,12 +6,12 @@</span>
<a href="#l8.4"></a><span id="l8.4"> &lt;!-- mac version of platformMailnewsOverlay.xul --&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> &lt;overlay id=&quot;platformMailnewsOverlay&quot;</span>
<a href="#l8.7"></a><span id="l8.7">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">   &lt;!-- Delete Key --&gt;</span>
<a href="#l8.10"></a><span id="l8.10">   &lt;!-- not all Mac keyboards have a VK_DELETE key, so we use VK_BACK as</span>
<a href="#l8.11"></a><span id="l8.11">        the primary and provide VK_DELETE as a secondary key definition --&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-	&lt;key id=&quot;key_shiftDelete&quot;  keycode=&quot;VK_BACK&quot;   modifiers=&quot;shift&quot; command=&quot;cmd_shiftDelete&quot;/&gt;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-	&lt;key id=&quot;key_shiftDelete2&quot; keycode=&quot;VK_DELETE&quot; modifiers=&quot;shift&quot; command=&quot;cmd_shiftDelete&quot;/&gt;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  &lt;key id=&quot;key_shiftDelete&quot;  keycode=&quot;VK_BACK&quot;   modifiers=&quot;shift&quot; command=&quot;cmd_shiftDelete&quot;/&gt;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+  &lt;key id=&quot;key_shiftDelete2&quot; keycode=&quot;VK_DELETE&quot; modifiers=&quot;shift&quot; command=&quot;cmd_shiftDelete&quot;/&gt;</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/mailnews/content/mail3PaneWindowCommands.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/mailnews/content/mail3PaneWindowCommands.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,226 +1,224 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.5"></a><span id="l9.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> // Controller object for folder pane</span>
<a href="#l9.10"></a><span id="l9.10"> var FolderPaneController =</span>
<a href="#l9.11"></a><span id="l9.11"> {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-   supportsCommand: function(command)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-	{</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-		switch ( command )</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-		{</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-			case &quot;cmd_delete&quot;:</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-			case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-			case &quot;button_delete&quot;:</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-			case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-			//case &quot;cmd_selectAll&quot;: the folder pane currently only handles single selection</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-			case &quot;cmd_cut&quot;:</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-			case &quot;cmd_copy&quot;:</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-			case &quot;cmd_paste&quot;:</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-				return true;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+  supportsCommand: function(command)</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  {</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+    switch ( command )</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    {</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+      case &quot;cmd_delete&quot;:</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+      case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+      case &quot;button_delete&quot;:</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+      case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+      //case &quot;cmd_selectAll&quot;: the folder pane currently only handles single selection</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+      case &quot;cmd_cut&quot;:</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+      case &quot;cmd_copy&quot;:</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+      case &quot;cmd_paste&quot;:</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+        return true;</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-			default:</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-				return false;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-		}</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-	},</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+      default:</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+        return false;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+    }</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+  },</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-	isCommandEnabled: function(command)</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-	{</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-		switch ( command )</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-		{</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-			case &quot;cmd_cut&quot;:</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-			case &quot;cmd_copy&quot;:</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-			case &quot;cmd_paste&quot;:</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-				return false;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-			case &quot;cmd_delete&quot;:</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-			case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-			case &quot;button_delete&quot;:</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+  isCommandEnabled: function(command)</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+  {</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+    switch ( command )</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+    {</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+      case &quot;cmd_cut&quot;:</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+      case &quot;cmd_copy&quot;:</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+      case &quot;cmd_paste&quot;:</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+        return false;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+      case &quot;cmd_delete&quot;:</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+      case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+      case &quot;button_delete&quot;:</span>
<a href="#l9.70"></a><span id="l9.70">         // Make sure the button doesn't show &quot;Undelete&quot; for folders.</span>
<a href="#l9.71"></a><span id="l9.71">         if (command == &quot;button_delete&quot;)</span>
<a href="#l9.72"></a><span id="l9.72">           UpdateDeleteToolbarButton(true);</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-			case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-			if ( command == &quot;cmd_delete&quot; )</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-				goSetMenuValue(command, 'valueFolder');</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+      case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+      if ( command == &quot;cmd_delete&quot; )</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+        goSetMenuValue(command, 'valueFolder');</span>
<a href="#l9.79"></a><span id="l9.79">         let folders = GetSelectedMsgFolders();</span>
<a href="#l9.80"></a><span id="l9.80"> </span>
<a href="#l9.81"></a><span id="l9.81">         if (folders.length) {</span>
<a href="#l9.82"></a><span id="l9.82">           var canDeleteThisFolder;</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-				var specialFolder = null;</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-				var isServer = null;</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-				try {</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+        var specialFolder = null;</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+        var isServer = null;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+        try {</span>
<a href="#l9.89"></a><span id="l9.89">           let folder = folders[0];</span>
<a href="#l9.90"></a><span id="l9.90">           specialFolder = getSpecialFolderString(folder);</span>
<a href="#l9.91"></a><span id="l9.91">           isServer = folder.isServer;</span>
<a href="#l9.92"></a><span id="l9.92">           if (folder.server.type == &quot;nntp&quot;) {</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-			     	if ( command == &quot;cmd_delete&quot; ) {</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-					      goSetMenuValue(command, 'valueNewsgroup');</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineminus">-				    	  goSetAccessKey(command, 'valueNewsgroupAccessKey');</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+             if ( command == &quot;cmd_delete&quot; ) {</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+                goSetMenuValue(command, 'valueNewsgroup');</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+                goSetAccessKey(command, 'valueNewsgroupAccessKey');</span>
<a href="#l9.99"></a><span id="l9.99">             }</span>
<a href="#l9.100"></a><span id="l9.100">           }</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineminus">-				}</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineminus">-				catch (ex) {</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-					//dump(&quot;specialFolder failure: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-				}</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+        }</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+        catch (ex) {</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+          //dump(&quot;specialFolder failure: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+        }</span>
<a href="#l9.109"></a><span id="l9.109">         if (specialFolder == &quot;Inbox&quot; || specialFolder == &quot;Trash&quot; || specialFolder == &quot;Drafts&quot; ||</span>
<a href="#l9.110"></a><span id="l9.110">             specialFolder == &quot;Sent&quot; || specialFolder == &quot;Templates&quot; || specialFolder == &quot;Outbox&quot; ||</span>
<a href="#l9.111"></a><span id="l9.111">             (specialFolder == &quot;Junk&quot; &amp;&amp; !CanRenameDeleteJunkMail(GetSelectedFolderURI())) || isServer)</span>
<a href="#l9.112"></a><span id="l9.112">           canDeleteThisFolder = false;</span>
<a href="#l9.113"></a><span id="l9.113">         else</span>
<a href="#l9.114"></a><span id="l9.114">           canDeleteThisFolder = true;</span>
<a href="#l9.115"></a><span id="l9.115">         return canDeleteThisFolder &amp;&amp; isCommandEnabled(command);</span>
<a href="#l9.116"></a><span id="l9.116">       }</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-			else</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-				return false;</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineplus">+      else</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+        return false;</span>
<a href="#l9.121"></a><span id="l9.121"> </span>
<a href="#l9.122"></a><span id="l9.122" class="difflineminus">-			default:</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-				return false;</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-		}</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-	},</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+      default:</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+        return false;</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+    }</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+  },</span>
<a href="#l9.130"></a><span id="l9.130"> </span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-	doCommand: function(command)</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-	{</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+  doCommand: function(command)</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+  {</span>
<a href="#l9.135"></a><span id="l9.135">     // if the user invoked a key short cut then it is possible that we got here for a command which is</span>
<a href="#l9.136"></a><span id="l9.136">     // really disabled. kick out if the command should be disabled.</span>
<a href="#l9.137"></a><span id="l9.137">     if (!this.isCommandEnabled(command)) return;</span>
<a href="#l9.138"></a><span id="l9.138"> </span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-		switch ( command )</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-		{</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineminus">-			case &quot;cmd_delete&quot;:</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineminus">-			case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-			case &quot;button_delete&quot;:</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-			case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-				MsgDeleteFolder();</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineminus">-				break;</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-		}</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-	},</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+    switch ( command )</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineplus">+    {</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+      case &quot;cmd_delete&quot;:</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+      case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineplus">+      case &quot;button_delete&quot;:</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+      case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineplus">+        MsgDeleteFolder();</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineplus">+        break;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineplus">+    }</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+  },</span>
<a href="#l9.159"></a><span id="l9.159"> </span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">-	onEvent: function(event)</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-	{</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineminus">-	}</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+  onEvent: function(event)</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+  {</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+  }</span>
<a href="#l9.166"></a><span id="l9.166"> };</span>
<a href="#l9.167"></a><span id="l9.167"> </span>
<a href="#l9.168"></a><span id="l9.168"> // DefaultController object (handles commands when one of the trees does not have focus)</span>
<a href="#l9.169"></a><span id="l9.169"> var DefaultController =</span>
<a href="#l9.170"></a><span id="l9.170"> {</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-   supportsCommand: function(command)</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-	{</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+  supportsCommand: function(command)</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+  {</span>
<a href="#l9.175"></a><span id="l9.175"> </span>
<a href="#l9.176"></a><span id="l9.176" class="difflineminus">-		switch ( command )</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineminus">-		{</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineplus">+    switch ( command )</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineplus">+    {</span>
<a href="#l9.180"></a><span id="l9.180">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l9.181"></a><span id="l9.181">       case &quot;cmd_archive&quot;:</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-			case &quot;cmd_reply&quot;:</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-			case &quot;button_reply&quot;:</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-			case &quot;cmd_replyList&quot;:</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-			case &quot;cmd_replyGroup&quot;:</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-			case &quot;cmd_replySender&quot;:</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineminus">-			case &quot;cmd_replyall&quot;:</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-			case &quot;button_replyall&quot;:</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineplus">+      case &quot;cmd_reply&quot;:</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineplus">+      case &quot;button_reply&quot;:</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineplus">+      case &quot;cmd_replyList&quot;:</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineplus">+      case &quot;cmd_replyGroup&quot;:</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineplus">+      case &quot;cmd_replySender&quot;:</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+      case &quot;cmd_replyall&quot;:</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+      case &quot;button_replyall&quot;:</span>
<a href="#l9.196"></a><span id="l9.196">       case &quot;cmd_replySenderAndGroup&quot;:</span>
<a href="#l9.197"></a><span id="l9.197">       case &quot;cmd_replyAllRecipients&quot;:</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-			case &quot;cmd_forward&quot;:</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineminus">-			case &quot;button_forward&quot;:</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineminus">-			case &quot;cmd_forwardInline&quot;:</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineminus">-			case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineminus">-			case &quot;cmd_editAsNew&quot;:</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+      case &quot;cmd_forward&quot;:</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+      case &quot;button_forward&quot;:</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+      case &quot;cmd_forwardInline&quot;:</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+      case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineplus">+      case &quot;cmd_editAsNew&quot;:</span>
<a href="#l9.208"></a><span id="l9.208">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l9.209"></a><span id="l9.209">       case &quot;cmd_delete&quot;:</span>
<a href="#l9.210"></a><span id="l9.210">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l9.211"></a><span id="l9.211">       case &quot;button_delete&quot;:</span>
<a href="#l9.212"></a><span id="l9.212">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l9.213"></a><span id="l9.213">       case &quot;button_junk&quot;:</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">-			case &quot;cmd_nextMsg&quot;:</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineplus">+      case &quot;cmd_nextMsg&quot;:</span>
<a href="#l9.216"></a><span id="l9.216">       case &quot;button_next&quot;:</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-			case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">-			case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineminus">-			case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineminus">-			case &quot;cmd_previousMsg&quot;:</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-			case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineminus">-			case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineplus">+      case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l9.224"></a><span id="l9.224" class="difflineplus">+      case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineplus">+      case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineplus">+      case &quot;cmd_previousMsg&quot;:</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineplus">+      case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineplus">+      case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l9.229"></a><span id="l9.229">       case &quot;button_goBack&quot;:</span>
<a href="#l9.230"></a><span id="l9.230">       case &quot;cmd_goBack&quot;:</span>
<a href="#l9.231"></a><span id="l9.231">       case &quot;button_goForward&quot;:</span>
<a href="#l9.232"></a><span id="l9.232">       case &quot;cmd_goForward&quot;:</span>
<a href="#l9.233"></a><span id="l9.233">       case &quot;cmd_goStartPage&quot;:</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-			case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineminus">-			case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineplus">+      case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineplus">+      case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l9.238"></a><span id="l9.238">       case &quot;cmd_viewThreadsWithUnread&quot;:</span>
<a href="#l9.239"></a><span id="l9.239">       case &quot;cmd_viewWatchedThreadsWithUnread&quot;:</span>
<a href="#l9.240"></a><span id="l9.240">       case &quot;cmd_viewIgnoredThreads&quot;:</span>
<a href="#l9.241"></a><span id="l9.241">       case &quot;cmd_stop&quot;:</span>
<a href="#l9.242"></a><span id="l9.242">       case &quot;cmd_undo&quot;:</span>
<a href="#l9.243"></a><span id="l9.243">       case &quot;cmd_redo&quot;:</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineminus">-			case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l9.245"></a><span id="l9.245" class="difflineminus">-			case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineminus">-			case &quot;cmd_renameFolder&quot;:</span>
<a href="#l9.247"></a><span id="l9.247" class="difflineminus">-			case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineplus">+      case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineplus">+      case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l9.250"></a><span id="l9.250" class="difflineplus">+      case &quot;cmd_renameFolder&quot;:</span>
<a href="#l9.251"></a><span id="l9.251" class="difflineplus">+      case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l9.252"></a><span id="l9.252">       case &quot;cmd_subscribe&quot;:</span>
<a href="#l9.253"></a><span id="l9.253">       case &quot;cmd_openMessage&quot;:</span>
<a href="#l9.254"></a><span id="l9.254">       case &quot;button_print&quot;:</span>
<a href="#l9.255"></a><span id="l9.255" class="difflineminus">-			case &quot;cmd_print&quot;:</span>
<a href="#l9.256"></a><span id="l9.256" class="difflineminus">-			case &quot;cmd_printpreview&quot;:</span>
<a href="#l9.257"></a><span id="l9.257" class="difflineminus">-			case &quot;cmd_printSetup&quot;:</span>
<a href="#l9.258"></a><span id="l9.258" class="difflineminus">-			case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l9.259"></a><span id="l9.259" class="difflineminus">-			case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l9.260"></a><span id="l9.260" class="difflineplus">+      case &quot;cmd_print&quot;:</span>
<a href="#l9.261"></a><span id="l9.261" class="difflineplus">+      case &quot;cmd_printpreview&quot;:</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineplus">+      case &quot;cmd_printSetup&quot;:</span>
<a href="#l9.263"></a><span id="l9.263" class="difflineplus">+      case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l9.264"></a><span id="l9.264" class="difflineplus">+      case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l9.265"></a><span id="l9.265">       case &quot;cmd_properties&quot;:</span>
<a href="#l9.266"></a><span id="l9.266" class="difflineminus">-			case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l9.267"></a><span id="l9.267" class="difflineminus">-			case &quot;cmd_setFolderCharset&quot;:</span>
<a href="#l9.268"></a><span id="l9.268" class="difflineminus">-			case &quot;cmd_reload&quot;:</span>
<a href="#l9.269"></a><span id="l9.269" class="difflineplus">+      case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l9.270"></a><span id="l9.270" class="difflineplus">+      case &quot;cmd_setFolderCharset&quot;:</span>
<a href="#l9.271"></a><span id="l9.271" class="difflineplus">+      case &quot;cmd_reload&quot;:</span>
<a href="#l9.272"></a><span id="l9.272">       case &quot;button_getNewMessages&quot;:</span>
<a href="#l9.273"></a><span id="l9.273" class="difflineminus">-			case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l9.274"></a><span id="l9.274" class="difflineplus">+      case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l9.275"></a><span id="l9.275">       case &quot;cmd_getMsgsForAuthAccounts&quot;:</span>
<a href="#l9.276"></a><span id="l9.276" class="difflineminus">-			case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l9.277"></a><span id="l9.277" class="difflineminus">-			case &quot;cmd_find&quot;:</span>
<a href="#l9.278"></a><span id="l9.278" class="difflineplus">+      case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l9.279"></a><span id="l9.279" class="difflineplus">+      case &quot;cmd_find&quot;:</span>
<a href="#l9.280"></a><span id="l9.280">       case &quot;cmd_findNext&quot;:</span>
<a href="#l9.281"></a><span id="l9.281" class="difflineminus">-			case &quot;cmd_findPrev&quot;:</span>
<a href="#l9.282"></a><span id="l9.282" class="difflineplus">+      case &quot;cmd_findPrev&quot;:</span>
<a href="#l9.283"></a><span id="l9.283">       case &quot;button_search&quot;:</span>
<a href="#l9.284"></a><span id="l9.284">       case &quot;cmd_search&quot;:</span>
<a href="#l9.285"></a><span id="l9.285">       case &quot;button_mark&quot;:</span>
<a href="#l9.286"></a><span id="l9.286" class="difflineminus">-			case &quot;cmd_markAsRead&quot;:</span>
<a href="#l9.287"></a><span id="l9.287" class="difflineminus">-			case &quot;cmd_markAllRead&quot;:</span>
<a href="#l9.288"></a><span id="l9.288" class="difflineminus">-			case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l9.289"></a><span id="l9.289" class="difflineminus">-			case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l9.290"></a><span id="l9.290" class="difflineminus">-			case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l9.291"></a><span id="l9.291" class="difflineminus">-			case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l9.292"></a><span id="l9.292" class="difflineminus">-			case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l9.293"></a><span id="l9.293" class="difflineplus">+      case &quot;cmd_markAsRead&quot;:</span>
<a href="#l9.294"></a><span id="l9.294" class="difflineplus">+      case &quot;cmd_markAllRead&quot;:</span>
<a href="#l9.295"></a><span id="l9.295" class="difflineplus">+      case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l9.296"></a><span id="l9.296" class="difflineplus">+      case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l9.297"></a><span id="l9.297" class="difflineplus">+      case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l9.298"></a><span id="l9.298" class="difflineplus">+      case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l9.299"></a><span id="l9.299" class="difflineplus">+      case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l9.300"></a><span id="l9.300">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l9.301"></a><span id="l9.301">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l9.302"></a><span id="l9.302">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l9.303"></a><span id="l9.303">       case &quot;cmd_displayMsgFilters&quot;:</span>
<a href="#l9.304"></a><span id="l9.304">       case &quot;cmd_applyFiltersToSelection&quot;:</span>
<a href="#l9.305"></a><span id="l9.305">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l9.306"></a><span id="l9.306">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l9.307"></a><span id="l9.307">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l9.308"></a><span id="l9.308">       case &quot;button_file&quot;:</span>
<a href="#l9.309"></a><span id="l9.309" class="difflineminus">-			case &quot;cmd_emptyTrash&quot;:</span>
<a href="#l9.310"></a><span id="l9.310" class="difflineminus">-			case &quot;cmd_compactFolder&quot;:</span>
<a href="#l9.311"></a><span id="l9.311" class="difflineminus">-  	  case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l9.312"></a><span id="l9.312" class="difflineplus">+      case &quot;cmd_emptyTrash&quot;:</span>
<a href="#l9.313"></a><span id="l9.313" class="difflineplus">+      case &quot;cmd_compactFolder&quot;:</span>
<a href="#l9.314"></a><span id="l9.314" class="difflineplus">+      case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l9.315"></a><span id="l9.315">       case &quot;cmd_close&quot;:</span>
<a href="#l9.316"></a><span id="l9.316">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l9.317"></a><span id="l9.317">       case &quot;cmd_selectThread&quot;:</span>
<a href="#l9.318"></a><span id="l9.318">       case &quot;cmd_selectFlagged&quot;:</span>
<a href="#l9.319"></a><span id="l9.319" class="difflineminus">-				return true;</span>
<a href="#l9.320"></a><span id="l9.320" class="difflineplus">+        return true;</span>
<a href="#l9.321"></a><span id="l9.321">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l9.322"></a><span id="l9.322">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l9.323"></a><span id="l9.323">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l9.324"></a><span id="l9.324">         return !Services.io.offline;</span>
<a href="#l9.325"></a><span id="l9.325" class="difflineminus">-</span>
<a href="#l9.326"></a><span id="l9.326">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l9.327"></a><span id="l9.327">       case &quot;cmd_killThread&quot;:</span>
<a href="#l9.328"></a><span id="l9.328">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l9.329"></a><span id="l9.329">       case &quot;cmd_cancel&quot;:</span>
<a href="#l9.330"></a><span id="l9.330">         return gFolderDisplay.selectedMessageIsNews;</span>
<a href="#l9.331"></a><span id="l9.331" class="difflineminus">-</span>
<a href="#l9.332"></a><span id="l9.332" class="difflineminus">-			default:</span>
<a href="#l9.333"></a><span id="l9.333" class="difflineminus">-				return false;</span>
<a href="#l9.334"></a><span id="l9.334" class="difflineminus">-		}</span>
<a href="#l9.335"></a><span id="l9.335" class="difflineminus">-	},</span>
<a href="#l9.336"></a><span id="l9.336" class="difflineplus">+      default:</span>
<a href="#l9.337"></a><span id="l9.337" class="difflineplus">+        return false;</span>
<a href="#l9.338"></a><span id="l9.338" class="difflineplus">+    }</span>
<a href="#l9.339"></a><span id="l9.339" class="difflineplus">+  },</span>
<a href="#l9.340"></a><span id="l9.340"> </span>
<a href="#l9.341"></a><span id="l9.341">   isCommandEnabled: function(command)</span>
<a href="#l9.342"></a><span id="l9.342">   {</span>
<a href="#l9.343"></a><span id="l9.343">     var enabled = new Object();</span>
<a href="#l9.344"></a><span id="l9.344">     enabled.value = false;</span>
<a href="#l9.345"></a><span id="l9.345">     var checkStatus = new Object();</span>
<a href="#l9.346"></a><span id="l9.346"> </span>
<a href="#l9.347"></a><span id="l9.347">     switch ( command )</span>
<a href="#l9.348"></a><span id="l9.348" class="difflineat">@@ -299,17 +297,17 @@ var DefaultController =</span>
<a href="#l9.349"></a><span id="l9.349">           if (gDBView)</span>
<a href="#l9.350"></a><span id="l9.350">           {</span>
<a href="#l9.351"></a><span id="l9.351">             gDBView.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody, enabled, checkStatus);</span>
<a href="#l9.352"></a><span id="l9.352">             return enabled.value;</span>
<a href="#l9.353"></a><span id="l9.353">           }</span>
<a href="#l9.354"></a><span id="l9.354">         }</span>
<a href="#l9.355"></a><span id="l9.355">         return false;</span>
<a href="#l9.356"></a><span id="l9.356">       case &quot;cmd_printpreview&quot;:</span>
<a href="#l9.357"></a><span id="l9.357" class="difflineminus">-	      if ( GetNumSelectedMessages() == 1 &amp;&amp; gDBView)</span>
<a href="#l9.358"></a><span id="l9.358" class="difflineplus">+        if ( GetNumSelectedMessages() == 1 &amp;&amp; gDBView)</span>
<a href="#l9.359"></a><span id="l9.359">         {</span>
<a href="#l9.360"></a><span id="l9.360">            gDBView.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody, enabled, checkStatus);</span>
<a href="#l9.361"></a><span id="l9.361">            return enabled.value;</span>
<a href="#l9.362"></a><span id="l9.362">         }</span>
<a href="#l9.363"></a><span id="l9.363">         return false;</span>
<a href="#l9.364"></a><span id="l9.364">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l9.365"></a><span id="l9.365">         return true;</span>
<a href="#l9.366"></a><span id="l9.366">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l9.367"></a><span id="l9.367" class="difflineat">@@ -457,61 +455,61 @@ var DefaultController =</span>
<a href="#l9.368"></a><span id="l9.368">       return;</span>
<a href="#l9.369"></a><span id="l9.369"> </span>
<a href="#l9.370"></a><span id="l9.370">     switch (command)</span>
<a href="#l9.371"></a><span id="l9.371">     {</span>
<a href="#l9.372"></a><span id="l9.372">       case &quot;cmd_close&quot;:</span>
<a href="#l9.373"></a><span id="l9.373">         MsgCloseCurrentTab();</span>
<a href="#l9.374"></a><span id="l9.374">         break;</span>
<a href="#l9.375"></a><span id="l9.375">       case &quot;button_getNewMessages&quot;:</span>
<a href="#l9.376"></a><span id="l9.376" class="difflineminus">-			case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l9.377"></a><span id="l9.377" class="difflineminus">-				MsgGetMessage();</span>
<a href="#l9.378"></a><span id="l9.378" class="difflineminus">-				break;</span>
<a href="#l9.379"></a><span id="l9.379" class="difflineplus">+      case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l9.380"></a><span id="l9.380" class="difflineplus">+        MsgGetMessage();</span>
<a href="#l9.381"></a><span id="l9.381" class="difflineplus">+        break;</span>
<a href="#l9.382"></a><span id="l9.382">       case &quot;cmd_getMsgsForAuthAccounts&quot;:</span>
<a href="#l9.383"></a><span id="l9.383">         MsgGetMessagesForAllAuthenticatedAccounts();</span>
<a href="#l9.384"></a><span id="l9.384">         break;</span>
<a href="#l9.385"></a><span id="l9.385" class="difflineminus">-			case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l9.386"></a><span id="l9.386" class="difflineminus">-				MsgGetNextNMessages();</span>
<a href="#l9.387"></a><span id="l9.387" class="difflineminus">-				break;</span>
<a href="#l9.388"></a><span id="l9.388" class="difflineminus">-			case &quot;cmd_archive&quot;:</span>
<a href="#l9.389"></a><span id="l9.389" class="difflineminus">-				MsgArchiveSelectedMessages(null);</span>
<a href="#l9.390"></a><span id="l9.390" class="difflineminus">-				break;</span>
<a href="#l9.391"></a><span id="l9.391" class="difflineminus">-			case &quot;cmd_reply&quot;:</span>
<a href="#l9.392"></a><span id="l9.392" class="difflineminus">-				MsgReplyMessage(null);</span>
<a href="#l9.393"></a><span id="l9.393" class="difflineminus">-				break;</span>
<a href="#l9.394"></a><span id="l9.394" class="difflineminus">-			case &quot;cmd_replyList&quot;:</span>
<a href="#l9.395"></a><span id="l9.395" class="difflineminus">-				MsgReplyList(null);</span>
<a href="#l9.396"></a><span id="l9.396" class="difflineminus">-				break;</span>
<a href="#l9.397"></a><span id="l9.397" class="difflineminus">-			case &quot;cmd_replyGroup&quot;:</span>
<a href="#l9.398"></a><span id="l9.398" class="difflineminus">-				MsgReplyGroup(null);</span>
<a href="#l9.399"></a><span id="l9.399" class="difflineminus">-				break;</span>
<a href="#l9.400"></a><span id="l9.400" class="difflineminus">-			case &quot;cmd_replySender&quot;:</span>
<a href="#l9.401"></a><span id="l9.401" class="difflineminus">-				MsgReplySender(null);</span>
<a href="#l9.402"></a><span id="l9.402" class="difflineminus">-				break;</span>
<a href="#l9.403"></a><span id="l9.403" class="difflineminus">-			case &quot;cmd_replyall&quot;:</span>
<a href="#l9.404"></a><span id="l9.404" class="difflineminus">-				MsgReplyToAllMessage(null);</span>
<a href="#l9.405"></a><span id="l9.405" class="difflineminus">-				break;</span>
<a href="#l9.406"></a><span id="l9.406" class="difflineplus">+      case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l9.407"></a><span id="l9.407" class="difflineplus">+        MsgGetNextNMessages();</span>
<a href="#l9.408"></a><span id="l9.408" class="difflineplus">+        break;</span>
<a href="#l9.409"></a><span id="l9.409" class="difflineplus">+      case &quot;cmd_archive&quot;:</span>
<a href="#l9.410"></a><span id="l9.410" class="difflineplus">+        MsgArchiveSelectedMessages(null);</span>
<a href="#l9.411"></a><span id="l9.411" class="difflineplus">+        break;</span>
<a href="#l9.412"></a><span id="l9.412" class="difflineplus">+      case &quot;cmd_reply&quot;:</span>
<a href="#l9.413"></a><span id="l9.413" class="difflineplus">+        MsgReplyMessage(null);</span>
<a href="#l9.414"></a><span id="l9.414" class="difflineplus">+        break;</span>
<a href="#l9.415"></a><span id="l9.415" class="difflineplus">+      case &quot;cmd_replyList&quot;:</span>
<a href="#l9.416"></a><span id="l9.416" class="difflineplus">+        MsgReplyList(null);</span>
<a href="#l9.417"></a><span id="l9.417" class="difflineplus">+        break;</span>
<a href="#l9.418"></a><span id="l9.418" class="difflineplus">+      case &quot;cmd_replyGroup&quot;:</span>
<a href="#l9.419"></a><span id="l9.419" class="difflineplus">+        MsgReplyGroup(null);</span>
<a href="#l9.420"></a><span id="l9.420" class="difflineplus">+        break;</span>
<a href="#l9.421"></a><span id="l9.421" class="difflineplus">+      case &quot;cmd_replySender&quot;:</span>
<a href="#l9.422"></a><span id="l9.422" class="difflineplus">+        MsgReplySender(null);</span>
<a href="#l9.423"></a><span id="l9.423" class="difflineplus">+        break;</span>
<a href="#l9.424"></a><span id="l9.424" class="difflineplus">+      case &quot;cmd_replyall&quot;:</span>
<a href="#l9.425"></a><span id="l9.425" class="difflineplus">+        MsgReplyToAllMessage(null);</span>
<a href="#l9.426"></a><span id="l9.426" class="difflineplus">+        break;</span>
<a href="#l9.427"></a><span id="l9.427">       case &quot;cmd_replySenderAndGroup&quot;:</span>
<a href="#l9.428"></a><span id="l9.428">         MsgReplyToSenderAndGroup(null);</span>
<a href="#l9.429"></a><span id="l9.429">         break;</span>
<a href="#l9.430"></a><span id="l9.430">       case &quot;cmd_replyAllRecipients&quot;:</span>
<a href="#l9.431"></a><span id="l9.431">         MsgReplyToAllRecipients(null);</span>
<a href="#l9.432"></a><span id="l9.432">         break;</span>
<a href="#l9.433"></a><span id="l9.433" class="difflineminus">-			case &quot;cmd_forward&quot;:</span>
<a href="#l9.434"></a><span id="l9.434" class="difflineminus">-				MsgForwardMessage(null);</span>
<a href="#l9.435"></a><span id="l9.435" class="difflineminus">-				break;</span>
<a href="#l9.436"></a><span id="l9.436" class="difflineminus">-			case &quot;cmd_forwardInline&quot;:</span>
<a href="#l9.437"></a><span id="l9.437" class="difflineminus">-				MsgForwardAsInline(null);</span>
<a href="#l9.438"></a><span id="l9.438" class="difflineminus">-				break;</span>
<a href="#l9.439"></a><span id="l9.439" class="difflineminus">-			case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l9.440"></a><span id="l9.440" class="difflineminus">-				MsgForwardAsAttachment(null);</span>
<a href="#l9.441"></a><span id="l9.441" class="difflineminus">-				break;</span>
<a href="#l9.442"></a><span id="l9.442" class="difflineminus">-			case &quot;cmd_editAsNew&quot;:</span>
<a href="#l9.443"></a><span id="l9.443" class="difflineminus">-				MsgEditMessageAsNew();</span>
<a href="#l9.444"></a><span id="l9.444" class="difflineminus">-				break;</span>
<a href="#l9.445"></a><span id="l9.445" class="difflineplus">+      case &quot;cmd_forward&quot;:</span>
<a href="#l9.446"></a><span id="l9.446" class="difflineplus">+        MsgForwardMessage(null);</span>
<a href="#l9.447"></a><span id="l9.447" class="difflineplus">+        break;</span>
<a href="#l9.448"></a><span id="l9.448" class="difflineplus">+      case &quot;cmd_forwardInline&quot;:</span>
<a href="#l9.449"></a><span id="l9.449" class="difflineplus">+        MsgForwardAsInline(null);</span>
<a href="#l9.450"></a><span id="l9.450" class="difflineplus">+        break;</span>
<a href="#l9.451"></a><span id="l9.451" class="difflineplus">+      case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l9.452"></a><span id="l9.452" class="difflineplus">+        MsgForwardAsAttachment(null);</span>
<a href="#l9.453"></a><span id="l9.453" class="difflineplus">+        break;</span>
<a href="#l9.454"></a><span id="l9.454" class="difflineplus">+      case &quot;cmd_editAsNew&quot;:</span>
<a href="#l9.455"></a><span id="l9.455" class="difflineplus">+        MsgEditMessageAsNew();</span>
<a href="#l9.456"></a><span id="l9.456" class="difflineplus">+        break;</span>
<a href="#l9.457"></a><span id="l9.457">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l9.458"></a><span id="l9.458">         MsgCreateFilter();</span>
<a href="#l9.459"></a><span id="l9.459">         break;</span>
<a href="#l9.460"></a><span id="l9.460">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l9.461"></a><span id="l9.461">         CreateFilter(document.popupNode);</span>
<a href="#l9.462"></a><span id="l9.462">         break;</span>
<a href="#l9.463"></a><span id="l9.463">       case &quot;cmd_delete&quot;:</span>
<a href="#l9.464"></a><span id="l9.464">       case &quot;button_delete&quot;:</span>
<a href="#l9.465"></a><span id="l9.465" class="difflineat">@@ -525,157 +523,157 @@ var DefaultController =</span>
<a href="#l9.466"></a><span id="l9.466">         break;</span>
<a href="#l9.467"></a><span id="l9.467">       case &quot;cmd_cancel&quot;:</span>
<a href="#l9.468"></a><span id="l9.468">         let message = gFolderDisplay.selectedMessage;</span>
<a href="#l9.469"></a><span id="l9.469">         message.folder.QueryInterface(Ci.nsIMsgNewsFolder)</span>
<a href="#l9.470"></a><span id="l9.470">                       .cancelMessage(message, msgWindow);</span>
<a href="#l9.471"></a><span id="l9.471">         break;</span>
<a href="#l9.472"></a><span id="l9.472">       case &quot;cmd_killThread&quot;:</span>
<a href="#l9.473"></a><span id="l9.473">         /* kill thread kills the thread and then does a next unread */</span>
<a href="#l9.474"></a><span id="l9.474" class="difflineminus">-      	GoNextMessage(nsMsgNavigationType.toggleThreadKilled, true);</span>
<a href="#l9.475"></a><span id="l9.475" class="difflineplus">+        GoNextMessage(nsMsgNavigationType.toggleThreadKilled, true);</span>
<a href="#l9.476"></a><span id="l9.476">         break;</span>
<a href="#l9.477"></a><span id="l9.477">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l9.478"></a><span id="l9.478">         GoNextMessage(nsMsgNavigationType.toggleSubthreadKilled, true);</span>
<a href="#l9.479"></a><span id="l9.479">         break;</span>
<a href="#l9.480"></a><span id="l9.480">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l9.481"></a><span id="l9.481">         gDBView.doCommand(nsMsgViewCommandType.toggleThreadWatched);</span>
<a href="#l9.482"></a><span id="l9.482">         break;</span>
<a href="#l9.483"></a><span id="l9.483">       case &quot;button_next&quot;:</span>
<a href="#l9.484"></a><span id="l9.484" class="difflineminus">-			case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l9.485"></a><span id="l9.485" class="difflineminus">-				MsgNextUnreadMessage();</span>
<a href="#l9.486"></a><span id="l9.486" class="difflineminus">-				break;</span>
<a href="#l9.487"></a><span id="l9.487" class="difflineminus">-			case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l9.488"></a><span id="l9.488" class="difflineminus">-				MsgNextUnreadThread();</span>
<a href="#l9.489"></a><span id="l9.489" class="difflineminus">-				break;</span>
<a href="#l9.490"></a><span id="l9.490" class="difflineminus">-			case &quot;cmd_nextMsg&quot;:</span>
<a href="#l9.491"></a><span id="l9.491" class="difflineminus">-				MsgNextMessage();</span>
<a href="#l9.492"></a><span id="l9.492" class="difflineminus">-				break;</span>
<a href="#l9.493"></a><span id="l9.493" class="difflineminus">-			case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l9.494"></a><span id="l9.494" class="difflineminus">-				MsgNextFlaggedMessage();</span>
<a href="#l9.495"></a><span id="l9.495" class="difflineminus">-				break;</span>
<a href="#l9.496"></a><span id="l9.496" class="difflineminus">-			case &quot;cmd_previousMsg&quot;:</span>
<a href="#l9.497"></a><span id="l9.497" class="difflineminus">-				MsgPreviousMessage();</span>
<a href="#l9.498"></a><span id="l9.498" class="difflineminus">-				break;</span>
<a href="#l9.499"></a><span id="l9.499" class="difflineminus">-			case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l9.500"></a><span id="l9.500" class="difflineminus">-				MsgPreviousUnreadMessage();</span>
<a href="#l9.501"></a><span id="l9.501" class="difflineminus">-				break;</span>
<a href="#l9.502"></a><span id="l9.502" class="difflineminus">-			case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l9.503"></a><span id="l9.503" class="difflineminus">-				MsgPreviousFlaggedMessage();</span>
<a href="#l9.504"></a><span id="l9.504" class="difflineminus">-				break;</span>
<a href="#l9.505"></a><span id="l9.505" class="difflineplus">+      case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l9.506"></a><span id="l9.506" class="difflineplus">+        MsgNextUnreadMessage();</span>
<a href="#l9.507"></a><span id="l9.507" class="difflineplus">+        break;</span>
<a href="#l9.508"></a><span id="l9.508" class="difflineplus">+      case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l9.509"></a><span id="l9.509" class="difflineplus">+        MsgNextUnreadThread();</span>
<a href="#l9.510"></a><span id="l9.510" class="difflineplus">+        break;</span>
<a href="#l9.511"></a><span id="l9.511" class="difflineplus">+      case &quot;cmd_nextMsg&quot;:</span>
<a href="#l9.512"></a><span id="l9.512" class="difflineplus">+        MsgNextMessage();</span>
<a href="#l9.513"></a><span id="l9.513" class="difflineplus">+        break;</span>
<a href="#l9.514"></a><span id="l9.514" class="difflineplus">+      case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l9.515"></a><span id="l9.515" class="difflineplus">+        MsgNextFlaggedMessage();</span>
<a href="#l9.516"></a><span id="l9.516" class="difflineplus">+        break;</span>
<a href="#l9.517"></a><span id="l9.517" class="difflineplus">+      case &quot;cmd_previousMsg&quot;:</span>
<a href="#l9.518"></a><span id="l9.518" class="difflineplus">+        MsgPreviousMessage();</span>
<a href="#l9.519"></a><span id="l9.519" class="difflineplus">+        break;</span>
<a href="#l9.520"></a><span id="l9.520" class="difflineplus">+      case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l9.521"></a><span id="l9.521" class="difflineplus">+        MsgPreviousUnreadMessage();</span>
<a href="#l9.522"></a><span id="l9.522" class="difflineplus">+        break;</span>
<a href="#l9.523"></a><span id="l9.523" class="difflineplus">+      case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l9.524"></a><span id="l9.524" class="difflineplus">+        MsgPreviousFlaggedMessage();</span>
<a href="#l9.525"></a><span id="l9.525" class="difflineplus">+        break;</span>
<a href="#l9.526"></a><span id="l9.526">       case &quot;button_goBack&quot;:</span>
<a href="#l9.527"></a><span id="l9.527">       case &quot;cmd_goBack&quot;:</span>
<a href="#l9.528"></a><span id="l9.528">         MsgGoBack();</span>
<a href="#l9.529"></a><span id="l9.529">         break;</span>
<a href="#l9.530"></a><span id="l9.530">        case &quot;button_goForward&quot;:</span>
<a href="#l9.531"></a><span id="l9.531">        case &quot;cmd_goForward&quot;:</span>
<a href="#l9.532"></a><span id="l9.532">         MsgGoForward();</span>
<a href="#l9.533"></a><span id="l9.533">         break;</span>
<a href="#l9.534"></a><span id="l9.534">       case &quot;cmd_goStartPage&quot;:</span>
<a href="#l9.535"></a><span id="l9.535">         HideMessageHeaderPane();</span>
<a href="#l9.536"></a><span id="l9.536">         loadStartPage();</span>
<a href="#l9.537"></a><span id="l9.537">         break;</span>
<a href="#l9.538"></a><span id="l9.538" class="difflineminus">-			case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l9.539"></a><span id="l9.539" class="difflineplus">+      case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l9.540"></a><span id="l9.540">       case &quot;cmd_viewThreadsWithUnread&quot;:</span>
<a href="#l9.541"></a><span id="l9.541">       case &quot;cmd_viewWatchedThreadsWithUnread&quot;:</span>
<a href="#l9.542"></a><span id="l9.542" class="difflineminus">-			case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l9.543"></a><span id="l9.543" class="difflineplus">+      case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l9.544"></a><span id="l9.544">       case &quot;cmd_viewIgnoredThreads&quot;:</span>
<a href="#l9.545"></a><span id="l9.545" class="difflineminus">-				SwitchView(command);</span>
<a href="#l9.546"></a><span id="l9.546" class="difflineminus">-				break;</span>
<a href="#l9.547"></a><span id="l9.547" class="difflineminus">-			case &quot;cmd_undo&quot;:</span>
<a href="#l9.548"></a><span id="l9.548" class="difflineminus">-				messenger.undo(msgWindow);</span>
<a href="#l9.549"></a><span id="l9.549" class="difflineminus">-				break;</span>
<a href="#l9.550"></a><span id="l9.550" class="difflineminus">-			case &quot;cmd_redo&quot;:</span>
<a href="#l9.551"></a><span id="l9.551" class="difflineminus">-				messenger.redo(msgWindow);</span>
<a href="#l9.552"></a><span id="l9.552" class="difflineminus">-				break;</span>
<a href="#l9.553"></a><span id="l9.553" class="difflineminus">-			case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l9.554"></a><span id="l9.554" class="difflineplus">+        SwitchView(command);</span>
<a href="#l9.555"></a><span id="l9.555" class="difflineplus">+        break;</span>
<a href="#l9.556"></a><span id="l9.556" class="difflineplus">+      case &quot;cmd_undo&quot;:</span>
<a href="#l9.557"></a><span id="l9.557" class="difflineplus">+        messenger.undo(msgWindow);</span>
<a href="#l9.558"></a><span id="l9.558" class="difflineplus">+        break;</span>
<a href="#l9.559"></a><span id="l9.559" class="difflineplus">+      case &quot;cmd_redo&quot;:</span>
<a href="#l9.560"></a><span id="l9.560" class="difflineplus">+        messenger.redo(msgWindow);</span>
<a href="#l9.561"></a><span id="l9.561" class="difflineplus">+        break;</span>
<a href="#l9.562"></a><span id="l9.562" class="difflineplus">+      case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l9.563"></a><span id="l9.563">                 gDBView.doCommand(nsMsgViewCommandType.expandAll);</span>
<a href="#l9.564"></a><span id="l9.564" class="difflineminus">-				break;</span>
<a href="#l9.565"></a><span id="l9.565" class="difflineminus">-			case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l9.566"></a><span id="l9.566" class="difflineplus">+        break;</span>
<a href="#l9.567"></a><span id="l9.567" class="difflineplus">+      case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l9.568"></a><span id="l9.568">                 gDBView.doCommand(nsMsgViewCommandType.collapseAll);</span>
<a href="#l9.569"></a><span id="l9.569" class="difflineminus">-				break;</span>
<a href="#l9.570"></a><span id="l9.570" class="difflineminus">-			case &quot;cmd_renameFolder&quot;:</span>
<a href="#l9.571"></a><span id="l9.571" class="difflineminus">-				MsgRenameFolder();</span>
<a href="#l9.572"></a><span id="l9.572" class="difflineminus">-				return;</span>
<a href="#l9.573"></a><span id="l9.573" class="difflineminus">-			case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l9.574"></a><span id="l9.574" class="difflineminus">-				MsgSendUnsentMsgs();</span>
<a href="#l9.575"></a><span id="l9.575" class="difflineminus">-				return;</span>
<a href="#l9.576"></a><span id="l9.576" class="difflineplus">+        break;</span>
<a href="#l9.577"></a><span id="l9.577" class="difflineplus">+      case &quot;cmd_renameFolder&quot;:</span>
<a href="#l9.578"></a><span id="l9.578" class="difflineplus">+        MsgRenameFolder();</span>
<a href="#l9.579"></a><span id="l9.579" class="difflineplus">+        return;</span>
<a href="#l9.580"></a><span id="l9.580" class="difflineplus">+      case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l9.581"></a><span id="l9.581" class="difflineplus">+        MsgSendUnsentMsgs();</span>
<a href="#l9.582"></a><span id="l9.582" class="difflineplus">+        return;</span>
<a href="#l9.583"></a><span id="l9.583">       case &quot;cmd_subscribe&quot;:</span>
<a href="#l9.584"></a><span id="l9.584">         MsgSubscribe();</span>
<a href="#l9.585"></a><span id="l9.585">         return;</span>
<a href="#l9.586"></a><span id="l9.586">       case &quot;cmd_openMessage&quot;:</span>
<a href="#l9.587"></a><span id="l9.587">         MsgOpenSelectedMessages();</span>
<a href="#l9.588"></a><span id="l9.588">         return;</span>
<a href="#l9.589"></a><span id="l9.589">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l9.590"></a><span id="l9.590">         PrintUtils.showPageSetup();</span>
<a href="#l9.591"></a><span id="l9.591">         return;</span>
<a href="#l9.592"></a><span id="l9.592" class="difflineminus">-			case &quot;cmd_print&quot;:</span>
<a href="#l9.593"></a><span id="l9.593" class="difflineminus">-				PrintEnginePrint();</span>
<a href="#l9.594"></a><span id="l9.594" class="difflineminus">-				return;</span>
<a href="#l9.595"></a><span id="l9.595" class="difflineminus">-			case &quot;cmd_printpreview&quot;:</span>
<a href="#l9.596"></a><span id="l9.596" class="difflineminus">-				PrintEnginePrintPreview();</span>
<a href="#l9.597"></a><span id="l9.597" class="difflineminus">-				return;</span>
<a href="#l9.598"></a><span id="l9.598" class="difflineminus">-			case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l9.599"></a><span id="l9.599" class="difflineminus">-				MsgSaveAsFile();</span>
<a href="#l9.600"></a><span id="l9.600" class="difflineminus">-				return;</span>
<a href="#l9.601"></a><span id="l9.601" class="difflineminus">-			case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l9.602"></a><span id="l9.602" class="difflineminus">-				MsgSaveAsTemplate();</span>
<a href="#l9.603"></a><span id="l9.603" class="difflineminus">-				return;</span>
<a href="#l9.604"></a><span id="l9.604" class="difflineminus">-			case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l9.605"></a><span id="l9.605" class="difflineminus">-				MsgViewPageSource();</span>
<a href="#l9.606"></a><span id="l9.606" class="difflineminus">-				return;</span>
<a href="#l9.607"></a><span id="l9.607" class="difflineminus">-			case &quot;cmd_setFolderCharset&quot;:</span>
<a href="#l9.608"></a><span id="l9.608" class="difflineminus">-				MsgFolderProperties();</span>
<a href="#l9.609"></a><span id="l9.609" class="difflineminus">-				return;</span>
<a href="#l9.610"></a><span id="l9.610" class="difflineminus">-			case &quot;cmd_reload&quot;:</span>
<a href="#l9.611"></a><span id="l9.611" class="difflineminus">-				ReloadMessage();</span>
<a href="#l9.612"></a><span id="l9.612" class="difflineminus">-				return;</span>
<a href="#l9.613"></a><span id="l9.613" class="difflineminus">-			case &quot;cmd_find&quot;:</span>
<a href="#l9.614"></a><span id="l9.614" class="difflineminus">-				MsgFind();</span>
<a href="#l9.615"></a><span id="l9.615" class="difflineminus">-				return;</span>
<a href="#l9.616"></a><span id="l9.616" class="difflineplus">+      case &quot;cmd_print&quot;:</span>
<a href="#l9.617"></a><span id="l9.617" class="difflineplus">+        PrintEnginePrint();</span>
<a href="#l9.618"></a><span id="l9.618" class="difflineplus">+        return;</span>
<a href="#l9.619"></a><span id="l9.619" class="difflineplus">+      case &quot;cmd_printpreview&quot;:</span>
<a href="#l9.620"></a><span id="l9.620" class="difflineplus">+        PrintEnginePrintPreview();</span>
<a href="#l9.621"></a><span id="l9.621" class="difflineplus">+        return;</span>
<a href="#l9.622"></a><span id="l9.622" class="difflineplus">+      case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l9.623"></a><span id="l9.623" class="difflineplus">+        MsgSaveAsFile();</span>
<a href="#l9.624"></a><span id="l9.624" class="difflineplus">+        return;</span>
<a href="#l9.625"></a><span id="l9.625" class="difflineplus">+      case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l9.626"></a><span id="l9.626" class="difflineplus">+        MsgSaveAsTemplate();</span>
<a href="#l9.627"></a><span id="l9.627" class="difflineplus">+        return;</span>
<a href="#l9.628"></a><span id="l9.628" class="difflineplus">+      case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l9.629"></a><span id="l9.629" class="difflineplus">+        MsgViewPageSource();</span>
<a href="#l9.630"></a><span id="l9.630" class="difflineplus">+        return;</span>
<a href="#l9.631"></a><span id="l9.631" class="difflineplus">+      case &quot;cmd_setFolderCharset&quot;:</span>
<a href="#l9.632"></a><span id="l9.632" class="difflineplus">+        MsgFolderProperties();</span>
<a href="#l9.633"></a><span id="l9.633" class="difflineplus">+        return;</span>
<a href="#l9.634"></a><span id="l9.634" class="difflineplus">+      case &quot;cmd_reload&quot;:</span>
<a href="#l9.635"></a><span id="l9.635" class="difflineplus">+        ReloadMessage();</span>
<a href="#l9.636"></a><span id="l9.636" class="difflineplus">+        return;</span>
<a href="#l9.637"></a><span id="l9.637" class="difflineplus">+      case &quot;cmd_find&quot;:</span>
<a href="#l9.638"></a><span id="l9.638" class="difflineplus">+        MsgFind();</span>
<a href="#l9.639"></a><span id="l9.639" class="difflineplus">+        return;</span>
<a href="#l9.640"></a><span id="l9.640">       case &quot;cmd_findNext&quot;:</span>
<a href="#l9.641"></a><span id="l9.641" class="difflineminus">-				MsgFindAgain(false);</span>
<a href="#l9.642"></a><span id="l9.642" class="difflineminus">-				return;</span>
<a href="#l9.643"></a><span id="l9.643" class="difflineminus">-			case &quot;cmd_findPrev&quot;:</span>
<a href="#l9.644"></a><span id="l9.644" class="difflineminus">-				MsgFindAgain(true);</span>
<a href="#l9.645"></a><span id="l9.645" class="difflineminus">-				return;</span>
<a href="#l9.646"></a><span id="l9.646" class="difflineplus">+        MsgFindAgain(false);</span>
<a href="#l9.647"></a><span id="l9.647" class="difflineplus">+        return;</span>
<a href="#l9.648"></a><span id="l9.648" class="difflineplus">+      case &quot;cmd_findPrev&quot;:</span>
<a href="#l9.649"></a><span id="l9.649" class="difflineplus">+        MsgFindAgain(true);</span>
<a href="#l9.650"></a><span id="l9.650" class="difflineplus">+        return;</span>
<a href="#l9.651"></a><span id="l9.651">       case &quot;cmd_properties&quot;:</span>
<a href="#l9.652"></a><span id="l9.652">         MsgFolderProperties();</span>
<a href="#l9.653"></a><span id="l9.653">         return;</span>
<a href="#l9.654"></a><span id="l9.654">       case &quot;button_search&quot;:</span>
<a href="#l9.655"></a><span id="l9.655">       case &quot;cmd_search&quot;:</span>
<a href="#l9.656"></a><span id="l9.656">         MsgSearchMessages();</span>
<a href="#l9.657"></a><span id="l9.657">         return;</span>
<a href="#l9.658"></a><span id="l9.658">       case &quot;button_mark&quot;:</span>
<a href="#l9.659"></a><span id="l9.659" class="difflineminus">-			case &quot;cmd_markAsRead&quot;:</span>
<a href="#l9.660"></a><span id="l9.660" class="difflineminus">-				MsgMarkMsgAsRead(null);</span>
<a href="#l9.661"></a><span id="l9.661" class="difflineminus">-				return;</span>
<a href="#l9.662"></a><span id="l9.662" class="difflineminus">-			case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l9.663"></a><span id="l9.663" class="difflineminus">-				MsgMarkThreadAsRead();</span>
<a href="#l9.664"></a><span id="l9.664" class="difflineminus">-				return;</span>
<a href="#l9.665"></a><span id="l9.665" class="difflineminus">-			case &quot;cmd_markAllRead&quot;:</span>
<a href="#l9.666"></a><span id="l9.666" class="difflineplus">+      case &quot;cmd_markAsRead&quot;:</span>
<a href="#l9.667"></a><span id="l9.667" class="difflineplus">+        MsgMarkMsgAsRead(null);</span>
<a href="#l9.668"></a><span id="l9.668" class="difflineplus">+        return;</span>
<a href="#l9.669"></a><span id="l9.669" class="difflineplus">+      case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l9.670"></a><span id="l9.670" class="difflineplus">+        MsgMarkThreadAsRead();</span>
<a href="#l9.671"></a><span id="l9.671" class="difflineplus">+        return;</span>
<a href="#l9.672"></a><span id="l9.672" class="difflineplus">+      case &quot;cmd_markAllRead&quot;:</span>
<a href="#l9.673"></a><span id="l9.673">         gDBView.doCommand(nsMsgViewCommandType.markAllRead);</span>
<a href="#l9.674"></a><span id="l9.674" class="difflineminus">-				return;</span>
<a href="#l9.675"></a><span id="l9.675" class="difflineminus">-			case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l9.676"></a><span id="l9.676" class="difflineplus">+        return;</span>
<a href="#l9.677"></a><span id="l9.677" class="difflineplus">+      case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l9.678"></a><span id="l9.678">         MsgMarkReadByDate();</span>
<a href="#l9.679"></a><span id="l9.679">         return;</span>
<a href="#l9.680"></a><span id="l9.680">       case &quot;button_junk&quot;:</span>
<a href="#l9.681"></a><span id="l9.681">         MsgJunk();</span>
<a href="#l9.682"></a><span id="l9.682">         return;</span>
<a href="#l9.683"></a><span id="l9.683">       case &quot;cmd_stop&quot;:</span>
<a href="#l9.684"></a><span id="l9.684">         MsgStop();</span>
<a href="#l9.685"></a><span id="l9.685">         return;</span>
<a href="#l9.686"></a><span id="l9.686" class="difflineminus">-			case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l9.687"></a><span id="l9.687" class="difflineminus">-				MsgMarkAsFlagged(null);</span>
<a href="#l9.688"></a><span id="l9.688" class="difflineminus">-				return;</span>
<a href="#l9.689"></a><span id="l9.689" class="difflineminus">-			case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l9.690"></a><span id="l9.690" class="difflineplus">+      case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l9.691"></a><span id="l9.691" class="difflineplus">+        MsgMarkAsFlagged(null);</span>
<a href="#l9.692"></a><span id="l9.692" class="difflineplus">+        return;</span>
<a href="#l9.693"></a><span id="l9.693" class="difflineplus">+      case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l9.694"></a><span id="l9.694">         JunkSelectedMessages(true);</span>
<a href="#l9.695"></a><span id="l9.695" class="difflineminus">-				return;</span>
<a href="#l9.696"></a><span id="l9.696" class="difflineminus">-			case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l9.697"></a><span id="l9.697" class="difflineplus">+        return;</span>
<a href="#l9.698"></a><span id="l9.698" class="difflineplus">+      case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l9.699"></a><span id="l9.699">         JunkSelectedMessages(false);</span>
<a href="#l9.700"></a><span id="l9.700" class="difflineminus">-				return;</span>
<a href="#l9.701"></a><span id="l9.701" class="difflineplus">+        return;</span>
<a href="#l9.702"></a><span id="l9.702">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l9.703"></a><span id="l9.703">         analyzeMessagesForJunk();</span>
<a href="#l9.704"></a><span id="l9.704">         return;</span>
<a href="#l9.705"></a><span id="l9.705">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l9.706"></a><span id="l9.706">         LoadMsgWithRemoteContent();</span>
<a href="#l9.707"></a><span id="l9.707">         return;</span>
<a href="#l9.708"></a><span id="l9.708">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l9.709"></a><span id="l9.709">         MsgIsNotAScam();</span>
<a href="#l9.710"></a><span id="l9.710" class="difflineat">@@ -690,88 +688,88 @@ var DefaultController =</span>
<a href="#l9.711"></a><span id="l9.711">         MsgApplyFilters(null);</span>
<a href="#l9.712"></a><span id="l9.712">         return;</span>
<a href="#l9.713"></a><span id="l9.713">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l9.714"></a><span id="l9.714">         filterFolderForJunk();</span>
<a href="#l9.715"></a><span id="l9.715">         return;</span>
<a href="#l9.716"></a><span id="l9.716">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l9.717"></a><span id="l9.717">         deleteJunkInFolder();</span>
<a href="#l9.718"></a><span id="l9.718">         return;</span>
<a href="#l9.719"></a><span id="l9.719" class="difflineminus">-			case &quot;cmd_emptyTrash&quot;:</span>
<a href="#l9.720"></a><span id="l9.720" class="difflineminus">-				MsgEmptyTrash();</span>
<a href="#l9.721"></a><span id="l9.721" class="difflineminus">-				return;</span>
<a href="#l9.722"></a><span id="l9.722" class="difflineminus">-			case &quot;cmd_compactFolder&quot;:</span>
<a href="#l9.723"></a><span id="l9.723" class="difflineminus">-				MsgCompactFolder(true);</span>
<a href="#l9.724"></a><span id="l9.724" class="difflineminus">-				return;</span>
<a href="#l9.725"></a><span id="l9.725" class="difflineminus">-            case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l9.726"></a><span id="l9.726" class="difflineminus">-                MsgDownloadFlagged();</span>
<a href="#l9.727"></a><span id="l9.727" class="difflineminus">-                break;</span>
<a href="#l9.728"></a><span id="l9.728" class="difflineminus">-            case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l9.729"></a><span id="l9.729" class="difflineminus">-                MsgDownloadSelected();</span>
<a href="#l9.730"></a><span id="l9.730" class="difflineminus">-                break;</span>
<a href="#l9.731"></a><span id="l9.731" class="difflineminus">-            case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l9.732"></a><span id="l9.732" class="difflineminus">-                MsgSynchronizeOffline();</span>
<a href="#l9.733"></a><span id="l9.733" class="difflineminus">-                break;</span>
<a href="#l9.734"></a><span id="l9.734" class="difflineminus">-            case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l9.735"></a><span id="l9.735" class="difflineminus">-                MsgSettingsOffline();</span>
<a href="#l9.736"></a><span id="l9.736" class="difflineminus">-                break;</span>
<a href="#l9.737"></a><span id="l9.737" class="difflineminus">-            case &quot;cmd_selectAll&quot;:</span>
<a href="#l9.738"></a><span id="l9.738" class="difflineminus">-                // move the focus so the user can delete the newly selected messages, not the folder</span>
<a href="#l9.739"></a><span id="l9.739" class="difflineminus">-                SetFocusThreadPane();</span>
<a href="#l9.740"></a><span id="l9.740" class="difflineminus">-                // if in threaded mode, the view will expand all before selecting all</span>
<a href="#l9.741"></a><span id="l9.741" class="difflineminus">-                gDBView.doCommand(nsMsgViewCommandType.selectAll)</span>
<a href="#l9.742"></a><span id="l9.742" class="difflineminus">-                if (gDBView.numSelected != 1) {</span>
<a href="#l9.743"></a><span id="l9.743" class="difflineminus">-                    setTitleFromFolder(gDBView.msgFolder,null);</span>
<a href="#l9.744"></a><span id="l9.744" class="difflineminus">-                    ClearMessagePane();</span>
<a href="#l9.745"></a><span id="l9.745" class="difflineminus">-                }</span>
<a href="#l9.746"></a><span id="l9.746" class="difflineminus">-                break;</span>
<a href="#l9.747"></a><span id="l9.747" class="difflineminus">-            case &quot;cmd_selectThread&quot;:</span>
<a href="#l9.748"></a><span id="l9.748" class="difflineminus">-                gDBView.doCommand(nsMsgViewCommandType.selectThread);</span>
<a href="#l9.749"></a><span id="l9.749" class="difflineminus">-                break;</span>
<a href="#l9.750"></a><span id="l9.750" class="difflineplus">+      case &quot;cmd_emptyTrash&quot;:</span>
<a href="#l9.751"></a><span id="l9.751" class="difflineplus">+        MsgEmptyTrash();</span>
<a href="#l9.752"></a><span id="l9.752" class="difflineplus">+        return;</span>
<a href="#l9.753"></a><span id="l9.753" class="difflineplus">+      case &quot;cmd_compactFolder&quot;:</span>
<a href="#l9.754"></a><span id="l9.754" class="difflineplus">+        MsgCompactFolder(true);</span>
<a href="#l9.755"></a><span id="l9.755" class="difflineplus">+        return;</span>
<a href="#l9.756"></a><span id="l9.756" class="difflineplus">+      case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l9.757"></a><span id="l9.757" class="difflineplus">+        MsgDownloadFlagged();</span>
<a href="#l9.758"></a><span id="l9.758" class="difflineplus">+        break;</span>
<a href="#l9.759"></a><span id="l9.759" class="difflineplus">+      case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l9.760"></a><span id="l9.760" class="difflineplus">+        MsgDownloadSelected();</span>
<a href="#l9.761"></a><span id="l9.761" class="difflineplus">+        break;</span>
<a href="#l9.762"></a><span id="l9.762" class="difflineplus">+      case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l9.763"></a><span id="l9.763" class="difflineplus">+        MsgSynchronizeOffline();</span>
<a href="#l9.764"></a><span id="l9.764" class="difflineplus">+        break;</span>
<a href="#l9.765"></a><span id="l9.765" class="difflineplus">+      case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l9.766"></a><span id="l9.766" class="difflineplus">+        MsgSettingsOffline();</span>
<a href="#l9.767"></a><span id="l9.767" class="difflineplus">+        break;</span>
<a href="#l9.768"></a><span id="l9.768" class="difflineplus">+      case &quot;cmd_selectAll&quot;:</span>
<a href="#l9.769"></a><span id="l9.769" class="difflineplus">+        // move the focus so the user can delete the newly selected messages, not the folder</span>
<a href="#l9.770"></a><span id="l9.770" class="difflineplus">+        SetFocusThreadPane();</span>
<a href="#l9.771"></a><span id="l9.771" class="difflineplus">+        // if in threaded mode, the view will expand all before selecting all</span>
<a href="#l9.772"></a><span id="l9.772" class="difflineplus">+        gDBView.doCommand(nsMsgViewCommandType.selectAll)</span>
<a href="#l9.773"></a><span id="l9.773" class="difflineplus">+        if (gDBView.numSelected != 1) {</span>
<a href="#l9.774"></a><span id="l9.774" class="difflineplus">+          setTitleFromFolder(gDBView.msgFolder,null);</span>
<a href="#l9.775"></a><span id="l9.775" class="difflineplus">+          ClearMessagePane();</span>
<a href="#l9.776"></a><span id="l9.776" class="difflineplus">+        }</span>
<a href="#l9.777"></a><span id="l9.777" class="difflineplus">+        break;</span>
<a href="#l9.778"></a><span id="l9.778" class="difflineplus">+      case &quot;cmd_selectThread&quot;:</span>
<a href="#l9.779"></a><span id="l9.779" class="difflineplus">+        gDBView.doCommand(nsMsgViewCommandType.selectThread);</span>
<a href="#l9.780"></a><span id="l9.780" class="difflineplus">+        break;</span>
<a href="#l9.781"></a><span id="l9.781">       case &quot;cmd_selectFlagged&quot;:</span>
<a href="#l9.782"></a><span id="l9.782">         gDBView.doCommand(nsMsgViewCommandType.selectFlagged);</span>
<a href="#l9.783"></a><span id="l9.783">         break;</span>
<a href="#l9.784"></a><span id="l9.784" class="difflineminus">-		}</span>
<a href="#l9.785"></a><span id="l9.785" class="difflineminus">-	},</span>
<a href="#l9.786"></a><span id="l9.786" class="difflineplus">+    }</span>
<a href="#l9.787"></a><span id="l9.787" class="difflineplus">+  },</span>
<a href="#l9.788"></a><span id="l9.788"> </span>
<a href="#l9.789"></a><span id="l9.789" class="difflineminus">-	onEvent: function(event)</span>
<a href="#l9.790"></a><span id="l9.790" class="difflineminus">-	{</span>
<a href="#l9.791"></a><span id="l9.791" class="difflineminus">-		// on blur events set the menu item texts back to the normal values</span>
<a href="#l9.792"></a><span id="l9.792" class="difflineminus">-		if ( event == 'blur' )</span>
<a href="#l9.793"></a><span id="l9.793" class="difflineminus">-        {</span>
<a href="#l9.794"></a><span id="l9.794" class="difflineminus">-            goSetMenuValue('cmd_undo', 'valueDefault');</span>
<a href="#l9.795"></a><span id="l9.795" class="difflineminus">-            goSetMenuValue('cmd_redo', 'valueDefault');</span>
<a href="#l9.796"></a><span id="l9.796" class="difflineminus">-        }</span>
<a href="#l9.797"></a><span id="l9.797" class="difflineminus">-	}</span>
<a href="#l9.798"></a><span id="l9.798" class="difflineplus">+  onEvent: function(event)</span>
<a href="#l9.799"></a><span id="l9.799" class="difflineplus">+  {</span>
<a href="#l9.800"></a><span id="l9.800" class="difflineplus">+    // on blur events set the menu item texts back to the normal values</span>
<a href="#l9.801"></a><span id="l9.801" class="difflineplus">+    if ( event == 'blur' )</span>
<a href="#l9.802"></a><span id="l9.802" class="difflineplus">+    {</span>
<a href="#l9.803"></a><span id="l9.803" class="difflineplus">+      goSetMenuValue('cmd_undo', 'valueDefault');</span>
<a href="#l9.804"></a><span id="l9.804" class="difflineplus">+      goSetMenuValue('cmd_redo', 'valueDefault');</span>
<a href="#l9.805"></a><span id="l9.805" class="difflineplus">+    }</span>
<a href="#l9.806"></a><span id="l9.806" class="difflineplus">+  }</span>
<a href="#l9.807"></a><span id="l9.807"> };</span>
<a href="#l9.808"></a><span id="l9.808"> </span>
<a href="#l9.809"></a><span id="l9.809"> function GetNumSelectedMessages()</span>
<a href="#l9.810"></a><span id="l9.810"> {</span>
<a href="#l9.811"></a><span id="l9.811" class="difflineminus">-    try {</span>
<a href="#l9.812"></a><span id="l9.812" class="difflineminus">-        return gDBView.numSelected;</span>
<a href="#l9.813"></a><span id="l9.813" class="difflineminus">-    }</span>
<a href="#l9.814"></a><span id="l9.814" class="difflineminus">-    catch (ex) {</span>
<a href="#l9.815"></a><span id="l9.815" class="difflineminus">-        return 0;</span>
<a href="#l9.816"></a><span id="l9.816" class="difflineminus">-    }</span>
<a href="#l9.817"></a><span id="l9.817" class="difflineplus">+  try {</span>
<a href="#l9.818"></a><span id="l9.818" class="difflineplus">+    return gDBView.numSelected;</span>
<a href="#l9.819"></a><span id="l9.819" class="difflineplus">+  }</span>
<a href="#l9.820"></a><span id="l9.820" class="difflineplus">+  catch (ex) {</span>
<a href="#l9.821"></a><span id="l9.821" class="difflineplus">+    return 0;</span>
<a href="#l9.822"></a><span id="l9.822" class="difflineplus">+  }</span>
<a href="#l9.823"></a><span id="l9.823"> }</span>
<a href="#l9.824"></a><span id="l9.824"> </span>
<a href="#l9.825"></a><span id="l9.825"> var gLastFocusedElement=null;</span>
<a href="#l9.826"></a><span id="l9.826"> </span>
<a href="#l9.827"></a><span id="l9.827"> function FocusRingUpdate_Mail()</span>
<a href="#l9.828"></a><span id="l9.828"> {</span>
<a href="#l9.829"></a><span id="l9.829">   // WhichPaneHasFocus() uses on top.document.commandDispatcher.focusedElement</span>
<a href="#l9.830"></a><span id="l9.830">   // to determine which pane has focus</span>
<a href="#l9.831"></a><span id="l9.831">   // if the focusedElement is null, we're here on a blur.</span>
<a href="#l9.832"></a><span id="l9.832">   // nsFocusController::Blur() calls nsFocusController::SetFocusedElement(null),</span>
<a href="#l9.833"></a><span id="l9.833">   // which will update any commands listening for &quot;focus&quot;.</span>
<a href="#l9.834"></a><span id="l9.834">   // we really only care about nsFocusController::Focus() happens,</span>
<a href="#l9.835"></a><span id="l9.835">   // which calls nsFocusController::SetFocusedElement(element)</span>
<a href="#l9.836"></a><span id="l9.836">   var currentFocusedElement = WhichPaneHasFocus();</span>
<a href="#l9.837"></a><span id="l9.837"> </span>
<a href="#l9.838"></a><span id="l9.838" class="difflineminus">-	if (currentFocusedElement != gLastFocusedElement) {</span>
<a href="#l9.839"></a><span id="l9.839" class="difflineplus">+  if (currentFocusedElement != gLastFocusedElement) {</span>
<a href="#l9.840"></a><span id="l9.840">     if (currentFocusedElement)</span>
<a href="#l9.841"></a><span id="l9.841">       currentFocusedElement.setAttribute(&quot;focusring&quot;, &quot;true&quot;);</span>
<a href="#l9.842"></a><span id="l9.842"> </span>
<a href="#l9.843"></a><span id="l9.843">     if (gLastFocusedElement)</span>
<a href="#l9.844"></a><span id="l9.844">       gLastFocusedElement.removeAttribute(&quot;focusring&quot;);</span>
<a href="#l9.845"></a><span id="l9.845"> </span>
<a href="#l9.846"></a><span id="l9.846">     gLastFocusedElement = currentFocusedElement;</span>
<a href="#l9.847"></a><span id="l9.847"> </span>
<a href="#l9.848"></a><span id="l9.848" class="difflineat">@@ -787,27 +785,27 @@ function WhichPaneHasFocus()</span>
<a href="#l9.849"></a><span id="l9.849"> {</span>
<a href="#l9.850"></a><span id="l9.850">   var threadTree = GetThreadTree();</span>
<a href="#l9.851"></a><span id="l9.851">   var folderTree = GetFolderTree();</span>
<a href="#l9.852"></a><span id="l9.852">   var messagePane = GetMessagePane();</span>
<a href="#l9.853"></a><span id="l9.853"> </span>
<a href="#l9.854"></a><span id="l9.854">   if (top.document.commandDispatcher.focusedWindow == GetMessagePaneFrame())</span>
<a href="#l9.855"></a><span id="l9.855">     return messagePane;</span>
<a href="#l9.856"></a><span id="l9.856"> </span>
<a href="#l9.857"></a><span id="l9.857" class="difflineminus">-	var currentNode = top.document.commandDispatcher.focusedElement;</span>
<a href="#l9.858"></a><span id="l9.858" class="difflineminus">-	while (currentNode) {</span>
<a href="#l9.859"></a><span id="l9.859" class="difflineplus">+  var currentNode = top.document.commandDispatcher.focusedElement;</span>
<a href="#l9.860"></a><span id="l9.860" class="difflineplus">+  while (currentNode) {</span>
<a href="#l9.861"></a><span id="l9.861">     if (currentNode === threadTree ||</span>
<a href="#l9.862"></a><span id="l9.862">         currentNode === folderTree ||</span>
<a href="#l9.863"></a><span id="l9.863">         currentNode === messagePane)</span>
<a href="#l9.864"></a><span id="l9.864">       return currentNode;</span>
<a href="#l9.865"></a><span id="l9.865"> </span>
<a href="#l9.866"></a><span id="l9.866" class="difflineminus">-		currentNode = currentNode.parentNode;</span>
<a href="#l9.867"></a><span id="l9.867" class="difflineplus">+    currentNode = currentNode.parentNode;</span>
<a href="#l9.868"></a><span id="l9.868">   }</span>
<a href="#l9.869"></a><span id="l9.869"> </span>
<a href="#l9.870"></a><span id="l9.870" class="difflineminus">-	return null;</span>
<a href="#l9.871"></a><span id="l9.871" class="difflineplus">+  return null;</span>
<a href="#l9.872"></a><span id="l9.872"> }</span>
<a href="#l9.873"></a><span id="l9.873"> </span>
<a href="#l9.874"></a><span id="l9.874"> function SetupCommandUpdateHandlers()</span>
<a href="#l9.875"></a><span id="l9.875"> {</span>
<a href="#l9.876"></a><span id="l9.876">   // folder pane</span>
<a href="#l9.877"></a><span id="l9.877">   var widget = GetFolderTree();</span>
<a href="#l9.878"></a><span id="l9.878">   if (widget)</span>
<a href="#l9.879"></a><span id="l9.879">     widget.controllers.appendController(FolderPaneController);</span>
<a href="#l9.880"></a><span id="l9.880" class="difflineat">@@ -933,117 +931,116 @@ function IsFolderSelected()</span>
<a href="#l9.881"></a><span id="l9.881"> </span>
<a href="#l9.882"></a><span id="l9.882"> function IsMessageDisplayedInMessagePane()</span>
<a href="#l9.883"></a><span id="l9.883"> {</span>
<a href="#l9.884"></a><span id="l9.884">   return (!IsMessagePaneCollapsed() &amp;&amp; (GetNumSelectedMessages() &gt; 0));</span>
<a href="#l9.885"></a><span id="l9.885"> }</span>
<a href="#l9.886"></a><span id="l9.886"> </span>
<a href="#l9.887"></a><span id="l9.887"> function MsgDeleteFolder()</span>
<a href="#l9.888"></a><span id="l9.888"> {</span>
<a href="#l9.889"></a><span id="l9.889" class="difflineminus">-    const NS_MSG_ERROR_COPY_FOLDER_ABORTED = 0x8055001a;</span>
<a href="#l9.890"></a><span id="l9.890" class="difflineminus">-    var folderTree = GetFolderTree();</span>
<a href="#l9.891"></a><span id="l9.891" class="difflineminus">-    var selectedFolders = GetSelectedMsgFolders();</span>
<a href="#l9.892"></a><span id="l9.892" class="difflineminus">-    var prompt = Services.prompt;</span>
<a href="#l9.893"></a><span id="l9.893" class="difflineminus">-    for (var i = 0; i &lt; selectedFolders.length; i++)</span>
<a href="#l9.894"></a><span id="l9.894" class="difflineplus">+  const NS_MSG_ERROR_COPY_FOLDER_ABORTED = 0x8055001a;</span>
<a href="#l9.895"></a><span id="l9.895" class="difflineplus">+  var folderTree = GetFolderTree();</span>
<a href="#l9.896"></a><span id="l9.896" class="difflineplus">+  var selectedFolders = GetSelectedMsgFolders();</span>
<a href="#l9.897"></a><span id="l9.897" class="difflineplus">+  var prompt = Services.prompt;</span>
<a href="#l9.898"></a><span id="l9.898" class="difflineplus">+  for (var i = 0; i &lt; selectedFolders.length; i++)</span>
<a href="#l9.899"></a><span id="l9.899" class="difflineplus">+  {</span>
<a href="#l9.900"></a><span id="l9.900" class="difflineplus">+    var selectedFolder = selectedFolders[i];</span>
<a href="#l9.901"></a><span id="l9.901" class="difflineplus">+    let specialFolder = getSpecialFolderString(selectedFolder);</span>
<a href="#l9.902"></a><span id="l9.902" class="difflineplus">+    if (specialFolder != &quot;Inbox&quot; &amp;&amp; specialFolder != &quot;Trash&quot;)</span>
<a href="#l9.903"></a><span id="l9.903">     {</span>
<a href="#l9.904"></a><span id="l9.904" class="difflineminus">-        var selectedFolder = selectedFolders[i];</span>
<a href="#l9.905"></a><span id="l9.905" class="difflineminus">-        let specialFolder = getSpecialFolderString(selectedFolder);</span>
<a href="#l9.906"></a><span id="l9.906" class="difflineminus">-        if (specialFolder != &quot;Inbox&quot; &amp;&amp; specialFolder != &quot;Trash&quot;)</span>
<a href="#l9.907"></a><span id="l9.907" class="difflineplus">+      var folder = selectedFolder.QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l9.908"></a><span id="l9.908" class="difflineplus">+      if (folder.flags &amp; Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l9.909"></a><span id="l9.909" class="difflineplus">+      {</span>
<a href="#l9.910"></a><span id="l9.910" class="difflineplus">+        var confirmation = gMessengerBundle.getString(&quot;confirmSavedSearchDeleteMessage&quot;);</span>
<a href="#l9.911"></a><span id="l9.911" class="difflineplus">+        var title = gMessengerBundle.getString(&quot;confirmSavedSearchDeleteTitle&quot;);</span>
<a href="#l9.912"></a><span id="l9.912" class="difflineplus">+        var buttonTitle = gMessengerBundle.getString(&quot;confirmSavedSearchDeleteButton&quot;);</span>
<a href="#l9.913"></a><span id="l9.913" class="difflineplus">+        var buttonFlags = prompt.BUTTON_TITLE_IS_STRING * prompt.BUTTON_POS_0 +</span>
<a href="#l9.914"></a><span id="l9.914" class="difflineplus">+                          prompt.BUTTON_TITLE_CANCEL * prompt.BUTTON_POS_1;</span>
<a href="#l9.915"></a><span id="l9.915" class="difflineplus">+        if (prompt.confirmEx(window, title, confirmation, buttonFlags, buttonTitle,</span>
<a href="#l9.916"></a><span id="l9.916" class="difflineplus">+                             &quot;&quot;, &quot;&quot;, &quot;&quot;, {}) != 0) /* the yes button is in position 0 */</span>
<a href="#l9.917"></a><span id="l9.917" class="difflineplus">+          continue;</span>
<a href="#l9.918"></a><span id="l9.918" class="difflineplus">+        if (gCurrentVirtualFolderUri == selectedFolder.URI)</span>
<a href="#l9.919"></a><span id="l9.919" class="difflineplus">+          gCurrentVirtualFolderUri = null;</span>
<a href="#l9.920"></a><span id="l9.920" class="difflineplus">+        var array = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l9.921"></a><span id="l9.921" class="difflineplus">+                      .createInstance(Ci.nsIMutableArray);</span>
<a href="#l9.922"></a><span id="l9.922" class="difflineplus">+        array.appendElement(folder);</span>
<a href="#l9.923"></a><span id="l9.923" class="difflineplus">+        folder.parent.deleteSubFolders(array, msgWindow);</span>
<a href="#l9.924"></a><span id="l9.924" class="difflineplus">+        continue;</span>
<a href="#l9.925"></a><span id="l9.925" class="difflineplus">+      }</span>
<a href="#l9.926"></a><span id="l9.926" class="difflineplus">+</span>
<a href="#l9.927"></a><span id="l9.927" class="difflineplus">+      if (isNewsURI(selectedFolder.URI))</span>
<a href="#l9.928"></a><span id="l9.928" class="difflineplus">+      {</span>
<a href="#l9.929"></a><span id="l9.929" class="difflineplus">+        var unsubscribe = ConfirmUnsubscribe(selectedFolder);</span>
<a href="#l9.930"></a><span id="l9.930" class="difflineplus">+        if (unsubscribe)</span>
<a href="#l9.931"></a><span id="l9.931" class="difflineplus">+          UnSubscribe(selectedFolder);</span>
<a href="#l9.932"></a><span id="l9.932" class="difflineplus">+      }</span>
<a href="#l9.933"></a><span id="l9.933" class="difflineplus">+      else if (specialFolder == &quot;Junk&quot; ?</span>
<a href="#l9.934"></a><span id="l9.934" class="difflineplus">+             CanRenameDeleteJunkMail(folder.URI) : folder.deletable)</span>
<a href="#l9.935"></a><span id="l9.935" class="difflineplus">+      {</span>
<a href="#l9.936"></a><span id="l9.936" class="difflineplus">+        // We can delete this folder.</span>
<a href="#l9.937"></a><span id="l9.937" class="difflineplus">+        var array = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l9.938"></a><span id="l9.938" class="difflineplus">+                      .createInstance(Ci.nsIMutableArray);</span>
<a href="#l9.939"></a><span id="l9.939" class="difflineplus">+        array.appendElement(selectedFolder);</span>
<a href="#l9.940"></a><span id="l9.940" class="difflineplus">+        try</span>
<a href="#l9.941"></a><span id="l9.941">         {</span>
<a href="#l9.942"></a><span id="l9.942" class="difflineminus">-            var folder = selectedFolder.QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l9.943"></a><span id="l9.943" class="difflineminus">-            if (folder.flags &amp; Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l9.944"></a><span id="l9.944" class="difflineminus">-            {</span>
<a href="#l9.945"></a><span id="l9.945" class="difflineminus">-                var confirmation = gMessengerBundle.getString(&quot;confirmSavedSearchDeleteMessage&quot;);</span>
<a href="#l9.946"></a><span id="l9.946" class="difflineminus">-                var title = gMessengerBundle.getString(&quot;confirmSavedSearchDeleteTitle&quot;);</span>
<a href="#l9.947"></a><span id="l9.947" class="difflineminus">-                var buttonTitle = gMessengerBundle.getString(&quot;confirmSavedSearchDeleteButton&quot;);</span>
<a href="#l9.948"></a><span id="l9.948" class="difflineminus">-                var buttonFlags = prompt.BUTTON_TITLE_IS_STRING * prompt.BUTTON_POS_0 +</span>
<a href="#l9.949"></a><span id="l9.949" class="difflineminus">-                                  prompt.BUTTON_TITLE_CANCEL * prompt.BUTTON_POS_1;</span>
<a href="#l9.950"></a><span id="l9.950" class="difflineminus">-                if (prompt.confirmEx(window, title, confirmation, buttonFlags, buttonTitle,</span>
<a href="#l9.951"></a><span id="l9.951" class="difflineminus">-                                     &quot;&quot;, &quot;&quot;, &quot;&quot;, {}) != 0) /* the yes button is in position 0 */</span>
<a href="#l9.952"></a><span id="l9.952" class="difflineminus">-                    continue;</span>
<a href="#l9.953"></a><span id="l9.953" class="difflineminus">-                if (gCurrentVirtualFolderUri == selectedFolder.URI)</span>
<a href="#l9.954"></a><span id="l9.954" class="difflineminus">-                  gCurrentVirtualFolderUri = null;</span>
<a href="#l9.955"></a><span id="l9.955" class="difflineminus">-                var array = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l9.956"></a><span id="l9.956" class="difflineminus">-                              .createInstance(Ci.nsIMutableArray);</span>
<a href="#l9.957"></a><span id="l9.957" class="difflineminus">-                array.appendElement(folder);</span>
<a href="#l9.958"></a><span id="l9.958" class="difflineminus">-                folder.parent.deleteSubFolders(array, msgWindow);</span>
<a href="#l9.959"></a><span id="l9.959" class="difflineminus">-                continue;</span>
<a href="#l9.960"></a><span id="l9.960" class="difflineminus">-            }</span>
<a href="#l9.961"></a><span id="l9.961" class="difflineminus">-</span>
<a href="#l9.962"></a><span id="l9.962" class="difflineminus">-            if (isNewsURI(selectedFolder.URI))</span>
<a href="#l9.963"></a><span id="l9.963" class="difflineminus">-            {</span>
<a href="#l9.964"></a><span id="l9.964" class="difflineminus">-                var unsubscribe = ConfirmUnsubscribe(selectedFolder);</span>
<a href="#l9.965"></a><span id="l9.965" class="difflineminus">-                if (unsubscribe)</span>
<a href="#l9.966"></a><span id="l9.966" class="difflineminus">-                    UnSubscribe(selectedFolder);</span>
<a href="#l9.967"></a><span id="l9.967" class="difflineminus">-            }</span>
<a href="#l9.968"></a><span id="l9.968" class="difflineminus">-            else if (specialFolder == &quot;Junk&quot; ?</span>
<a href="#l9.969"></a><span id="l9.969" class="difflineminus">-                     CanRenameDeleteJunkMail(folder.URI) : folder.deletable)</span>
<a href="#l9.970"></a><span id="l9.970" class="difflineminus">-            {</span>
<a href="#l9.971"></a><span id="l9.971" class="difflineminus">-                // We can delete this folder.</span>
<a href="#l9.972"></a><span id="l9.972" class="difflineminus">-</span>
<a href="#l9.973"></a><span id="l9.973" class="difflineminus">-                var array = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l9.974"></a><span id="l9.974" class="difflineminus">-                              .createInstance(Ci.nsIMutableArray);</span>
<a href="#l9.975"></a><span id="l9.975" class="difflineminus">-                array.appendElement(selectedFolder);</span>
<a href="#l9.976"></a><span id="l9.976" class="difflineminus">-                try</span>
<a href="#l9.977"></a><span id="l9.977" class="difflineminus">-                {</span>
<a href="#l9.978"></a><span id="l9.978" class="difflineminus">-                    selectedFolder.parent.deleteSubFolders(array, msgWindow);</span>
<a href="#l9.979"></a><span id="l9.979" class="difflineminus">-                }</span>
<a href="#l9.980"></a><span id="l9.980" class="difflineminus">-                // Ignore known errors from canceled warning dialogs.</span>
<a href="#l9.981"></a><span id="l9.981" class="difflineminus">-                catch (ex) {</span>
<a href="#l9.982"></a><span id="l9.982" class="difflineminus">-                  if (ex.result != NS_MSG_ERROR_COPY_FOLDER_ABORTED) {</span>
<a href="#l9.983"></a><span id="l9.983" class="difflineminus">-                    throw ex;</span>
<a href="#l9.984"></a><span id="l9.984" class="difflineminus">-                  }</span>
<a href="#l9.985"></a><span id="l9.985" class="difflineminus">-                }</span>
<a href="#l9.986"></a><span id="l9.986" class="difflineminus">-            }</span>
<a href="#l9.987"></a><span id="l9.987" class="difflineplus">+          selectedFolder.parent.deleteSubFolders(array, msgWindow);</span>
<a href="#l9.988"></a><span id="l9.988">         }</span>
<a href="#l9.989"></a><span id="l9.989" class="difflineplus">+        // Ignore known errors from canceled warning dialogs.</span>
<a href="#l9.990"></a><span id="l9.990" class="difflineplus">+        catch (ex) {</span>
<a href="#l9.991"></a><span id="l9.991" class="difflineplus">+          if (ex.result != NS_MSG_ERROR_COPY_FOLDER_ABORTED) {</span>
<a href="#l9.992"></a><span id="l9.992" class="difflineplus">+            throw ex;</span>
<a href="#l9.993"></a><span id="l9.993" class="difflineplus">+          }</span>
<a href="#l9.994"></a><span id="l9.994" class="difflineplus">+        }</span>
<a href="#l9.995"></a><span id="l9.995" class="difflineplus">+      }</span>
<a href="#l9.996"></a><span id="l9.996">     }</span>
<a href="#l9.997"></a><span id="l9.997" class="difflineplus">+  }</span>
<a href="#l9.998"></a><span id="l9.998"> }</span>
<a href="#l9.999"></a><span id="l9.999"> </span>
<a href="#l9.1000"></a><span id="l9.1000"> function SetFocusThreadPaneIfNotOnMessagePane()</span>
<a href="#l9.1001"></a><span id="l9.1001"> {</span>
<a href="#l9.1002"></a><span id="l9.1002">   var focusedElement = WhichPaneHasFocus();</span>
<a href="#l9.1003"></a><span id="l9.1003"> </span>
<a href="#l9.1004"></a><span id="l9.1004">   if((focusedElement != GetThreadTree()) &amp;&amp;</span>
<a href="#l9.1005"></a><span id="l9.1005">      (focusedElement != GetMessagePane()))</span>
<a href="#l9.1006"></a><span id="l9.1006">      SetFocusThreadPane();</span>
<a href="#l9.1007"></a><span id="l9.1007"> }</span>
<a href="#l9.1008"></a><span id="l9.1008"> </span>
<a href="#l9.1009"></a><span id="l9.1009"> // 3pane related commands.  Need to go in own file.  Putting here for the moment.</span>
<a href="#l9.1010"></a><span id="l9.1010"> function MsgNextMessage()</span>
<a href="#l9.1011"></a><span id="l9.1011"> {</span>
<a href="#l9.1012"></a><span id="l9.1012" class="difflineminus">-	GoNextMessage(nsMsgNavigationType.nextMessage, false );</span>
<a href="#l9.1013"></a><span id="l9.1013" class="difflineplus">+  GoNextMessage(nsMsgNavigationType.nextMessage, false);</span>
<a href="#l9.1014"></a><span id="l9.1014"> }</span>
<a href="#l9.1015"></a><span id="l9.1015"> </span>
<a href="#l9.1016"></a><span id="l9.1016"> function MsgNextUnreadMessage()</span>
<a href="#l9.1017"></a><span id="l9.1017"> {</span>
<a href="#l9.1018"></a><span id="l9.1018" class="difflineminus">-	GoNextMessage(nsMsgNavigationType.nextUnreadMessage, true);</span>
<a href="#l9.1019"></a><span id="l9.1019" class="difflineplus">+  GoNextMessage(nsMsgNavigationType.nextUnreadMessage, true);</span>
<a href="#l9.1020"></a><span id="l9.1020"> }</span>
<a href="#l9.1021"></a><span id="l9.1021"> function MsgNextFlaggedMessage()</span>
<a href="#l9.1022"></a><span id="l9.1022"> {</span>
<a href="#l9.1023"></a><span id="l9.1023" class="difflineminus">-	GoNextMessage(nsMsgNavigationType.nextFlagged, true);</span>
<a href="#l9.1024"></a><span id="l9.1024" class="difflineplus">+  GoNextMessage(nsMsgNavigationType.nextFlagged, true);</span>
<a href="#l9.1025"></a><span id="l9.1025"> }</span>
<a href="#l9.1026"></a><span id="l9.1026"> </span>
<a href="#l9.1027"></a><span id="l9.1027"> function MsgNextUnreadThread()</span>
<a href="#l9.1028"></a><span id="l9.1028"> {</span>
<a href="#l9.1029"></a><span id="l9.1029">   GoNextMessage(nsMsgNavigationType.nextUnreadThread, true);</span>
<a href="#l9.1030"></a><span id="l9.1030"> }</span>
<a href="#l9.1031"></a><span id="l9.1031"> </span>
<a href="#l9.1032"></a><span id="l9.1032"> function MsgPreviousMessage()</span>
<a href="#l9.1033"></a><span id="l9.1033"> {</span>
<a href="#l9.1034"></a><span id="l9.1034" class="difflineminus">-    GoNextMessage(nsMsgNavigationType.previousMessage, false);</span>
<a href="#l9.1035"></a><span id="l9.1035" class="difflineplus">+  GoNextMessage(nsMsgNavigationType.previousMessage, false);</span>
<a href="#l9.1036"></a><span id="l9.1036"> }</span>
<a href="#l9.1037"></a><span id="l9.1037"> </span>
<a href="#l9.1038"></a><span id="l9.1038"> function MsgPreviousUnreadMessage()</span>
<a href="#l9.1039"></a><span id="l9.1039"> {</span>
<a href="#l9.1040"></a><span id="l9.1040" class="difflineminus">-	GoNextMessage(nsMsgNavigationType.previousUnreadMessage, true);</span>
<a href="#l9.1041"></a><span id="l9.1041" class="difflineplus">+  GoNextMessage(nsMsgNavigationType.previousUnreadMessage, true);</span>
<a href="#l9.1042"></a><span id="l9.1042"> }</span>
<a href="#l9.1043"></a><span id="l9.1043"> </span>
<a href="#l9.1044"></a><span id="l9.1044"> function MsgPreviousFlaggedMessage()</span>
<a href="#l9.1045"></a><span id="l9.1045"> {</span>
<a href="#l9.1046"></a><span id="l9.1046" class="difflineminus">-	GoNextMessage(nsMsgNavigationType.previousFlagged, true);</span>
<a href="#l9.1047"></a><span id="l9.1047" class="difflineplus">+  GoNextMessage(nsMsgNavigationType.previousFlagged, true);</span>
<a href="#l9.1048"></a><span id="l9.1048"> }</span>
<a href="#l9.1049"></a><span id="l9.1049"> </span>
<a href="#l9.1050"></a><span id="l9.1050"> function MsgGoBack()</span>
<a href="#l9.1051"></a><span id="l9.1051"> {</span>
<a href="#l9.1052"></a><span id="l9.1052">   GoNextMessage(nsMsgNavigationType.back, true);</span>
<a href="#l9.1053"></a><span id="l9.1053"> }</span>
<a href="#l9.1054"></a><span id="l9.1054"> </span>
<a href="#l9.1055"></a><span id="l9.1055"> function MsgGoForward()</span>
<a href="#l9.1056"></a><span id="l9.1056" class="difflineat">@@ -1084,26 +1081,26 @@ function SwitchPaneFocus(event)</span>
<a href="#l9.1057"></a><span id="l9.1057">       folderTree.focus();</span>
<a href="#l9.1058"></a><span id="l9.1058">     else</span>
<a href="#l9.1059"></a><span id="l9.1059">       threadTree.focus();</span>
<a href="#l9.1060"></a><span id="l9.1060">   }</span>
<a href="#l9.1061"></a><span id="l9.1061"> }</span>
<a href="#l9.1062"></a><span id="l9.1062"> </span>
<a href="#l9.1063"></a><span id="l9.1063"> function SetFocusThreadPane()</span>
<a href="#l9.1064"></a><span id="l9.1064"> {</span>
<a href="#l9.1065"></a><span id="l9.1065" class="difflineminus">-    var threadTree = GetThreadTree();</span>
<a href="#l9.1066"></a><span id="l9.1066" class="difflineminus">-    threadTree.focus();</span>
<a href="#l9.1067"></a><span id="l9.1067" class="difflineplus">+  var threadTree = GetThreadTree();</span>
<a href="#l9.1068"></a><span id="l9.1068" class="difflineplus">+  threadTree.focus();</span>
<a href="#l9.1069"></a><span id="l9.1069"> }</span>
<a href="#l9.1070"></a><span id="l9.1070"> </span>
<a href="#l9.1071"></a><span id="l9.1071"> function SetFocusMessagePane()</span>
<a href="#l9.1072"></a><span id="l9.1072"> {</span>
<a href="#l9.1073"></a><span id="l9.1073" class="difflineminus">-    // XXX hack: to clear the focus on the previous element first focus</span>
<a href="#l9.1074"></a><span id="l9.1074" class="difflineminus">-    // on the message pane element then focus on the main content window</span>
<a href="#l9.1075"></a><span id="l9.1075" class="difflineminus">-    GetMessagePane().focus();</span>
<a href="#l9.1076"></a><span id="l9.1076" class="difflineminus">-    GetMessagePaneFrame().focus();</span>
<a href="#l9.1077"></a><span id="l9.1077" class="difflineplus">+  // XXX hack: to clear the focus on the previous element first focus</span>
<a href="#l9.1078"></a><span id="l9.1078" class="difflineplus">+  // on the message pane element then focus on the main content window</span>
<a href="#l9.1079"></a><span id="l9.1079" class="difflineplus">+  GetMessagePane().focus();</span>
<a href="#l9.1080"></a><span id="l9.1080" class="difflineplus">+  GetMessagePaneFrame().focus();</span>
<a href="#l9.1081"></a><span id="l9.1081"> }</span>
<a href="#l9.1082"></a><span id="l9.1082"> </span>
<a href="#l9.1083"></a><span id="l9.1083"> function isCommandEnabled(cmd)</span>
<a href="#l9.1084"></a><span id="l9.1084"> {</span>
<a href="#l9.1085"></a><span id="l9.1085">   var selectedFolders = GetSelectedMsgFolders();</span>
<a href="#l9.1086"></a><span id="l9.1086">   var numFolders = selectedFolders.length;</span>
<a href="#l9.1087"></a><span id="l9.1087">   if(numFolders !=1)</span>
<a href="#l9.1088"></a><span id="l9.1088">     return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/mailnews/content/messageWindow.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/mailnews/content/messageWindow.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -450,18 +450,18 @@ function GetSelectedFolderURI()</span>
<a href="#l10.4"></a><span id="l10.4"> function GetLoadedMessage()</span>
<a href="#l10.5"></a><span id="l10.5"> {</span>
<a href="#l10.6"></a><span id="l10.6">   return gCurrentMessageUri;</span>
<a href="#l10.7"></a><span id="l10.7"> }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> //Clear everything related to the current message. called after load start page.</span>
<a href="#l10.10"></a><span id="l10.10"> function ClearMessageSelection()</span>
<a href="#l10.11"></a><span id="l10.11"> {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-	gCurrentMessageUri = null;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-	gCurrentFolderUri = null;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  gCurrentMessageUri = null;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  gCurrentFolderUri = null;</span>
<a href="#l10.16"></a><span id="l10.16">   UpdateMailToolbar(&quot;clear msg, std alone window&quot;);</span>
<a href="#l10.17"></a><span id="l10.17"> }</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19"> function SetNextMessageAfterDelete()</span>
<a href="#l10.20"></a><span id="l10.20"> {</span>
<a href="#l10.21"></a><span id="l10.21">   gNextMessageViewIndexAfterDelete = gDBView.msgToSelectAfterDelete;</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24" class="difflineat">@@ -632,25 +632,25 @@ var MessageWindowController =</span>
<a href="#l10.25"></a><span id="l10.25">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l10.26"></a><span id="l10.26">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l10.27"></a><span id="l10.27">         return !Services.io.offline;</span>
<a href="#l10.28"></a><span id="l10.28">       default:</span>
<a href="#l10.29"></a><span id="l10.29">         return false;</span>
<a href="#l10.30"></a><span id="l10.30">     }</span>
<a href="#l10.31"></a><span id="l10.31">   },</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-	isCommandEnabled: function(command)</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-	{</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+  isCommandEnabled: function(command)</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+  {</span>
<a href="#l10.37"></a><span id="l10.37">     var loadedFolder;</span>
<a href="#l10.38"></a><span id="l10.38">     var enabled = new Object();</span>
<a href="#l10.39"></a><span id="l10.39">     enabled.value = false;</span>
<a href="#l10.40"></a><span id="l10.40">     var checkStatus = new Object();</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-		switch (command)</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-		{</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+    switch (command)</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+    {</span>
<a href="#l10.46"></a><span id="l10.46">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l10.47"></a><span id="l10.47">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l10.48"></a><span id="l10.48">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l10.49"></a><span id="l10.49">         return (loadedFolder &amp;&amp; loadedFolder.server.canHaveFilters);</span>
<a href="#l10.50"></a><span id="l10.50">       case &quot;cmd_delete&quot;:</span>
<a href="#l10.51"></a><span id="l10.51">         UpdateDeleteCommand();</span>
<a href="#l10.52"></a><span id="l10.52">         // fall through</span>
<a href="#l10.53"></a><span id="l10.53">       case &quot;button_delete&quot;:</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineat">@@ -660,90 +660,90 @@ var MessageWindowController =</span>
<a href="#l10.55"></a><span id="l10.55">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l10.56"></a><span id="l10.56">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l10.57"></a><span id="l10.57">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l10.58"></a><span id="l10.58">         return gCurrentMessageUri &amp;&amp; loadedFolder &amp;&amp; loadedFolder.canDeleteMessages;</span>
<a href="#l10.59"></a><span id="l10.59">       case &quot;button_junk&quot;:</span>
<a href="#l10.60"></a><span id="l10.60">         UpdateJunkToolbarButton();</span>
<a href="#l10.61"></a><span id="l10.61">         // fall through</span>
<a href="#l10.62"></a><span id="l10.62">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-			case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+      case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l10.65"></a><span id="l10.65">         if (gDBView)</span>
<a href="#l10.66"></a><span id="l10.66">           gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l10.67"></a><span id="l10.67">         return enabled.value;</span>
<a href="#l10.68"></a><span id="l10.68">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l10.69"></a><span id="l10.69">         if (GetNumSelectedMessages() &gt; 0 &amp;&amp; gDBView)</span>
<a href="#l10.70"></a><span id="l10.70">           gDBView.getCommandStatus(nsMsgViewCommandType.runJunkControls, enabled, checkStatus);</span>
<a href="#l10.71"></a><span id="l10.71">         return enabled.value;</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-			case &quot;cmd_reply&quot;:</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-			case &quot;button_reply&quot;:</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-			case &quot;cmd_replyList&quot;:</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-			case &quot;cmd_replyGroup&quot;:</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-			case &quot;cmd_replySender&quot;:</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-			case &quot;cmd_replyall&quot;:</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-			case &quot;button_replyall&quot;:</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+      case &quot;cmd_reply&quot;:</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+      case &quot;button_reply&quot;:</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+      case &quot;cmd_replyList&quot;:</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+      case &quot;cmd_replyGroup&quot;:</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+      case &quot;cmd_replySender&quot;:</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+      case &quot;cmd_replyall&quot;:</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+      case &quot;button_replyall&quot;:</span>
<a href="#l10.86"></a><span id="l10.86">       case &quot;cmd_replySenderAndGroup&quot;:</span>
<a href="#l10.87"></a><span id="l10.87">       case &quot;cmd_replyAllRecipients&quot;:</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-			case &quot;cmd_forward&quot;:</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-			case &quot;button_forward&quot;:</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-			case &quot;cmd_forwardInline&quot;:</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-			case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-			case &quot;cmd_editAsNew&quot;:</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-			case &quot;cmd_print&quot;:</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-			case &quot;cmd_printpreview&quot;:</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+      case &quot;cmd_forward&quot;:</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+      case &quot;button_forward&quot;:</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+      case &quot;cmd_forwardInline&quot;:</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+      case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+      case &quot;cmd_editAsNew&quot;:</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+      case &quot;cmd_print&quot;:</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+      case &quot;cmd_printpreview&quot;:</span>
<a href="#l10.102"></a><span id="l10.102">       case &quot;button_print&quot;:</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-			case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+      case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l10.105"></a><span id="l10.105">         return true;</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-			case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+      case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l10.108"></a><span id="l10.108">         var target = gMessageBrowser.contentPrincipal.URI.scheme;</span>
<a href="#l10.109"></a><span id="l10.109">         return target != &quot;news&quot;;</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-			case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-			case &quot;cmd_reload&quot;:</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-			case &quot;cmd_find&quot;:</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+      case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+      case &quot;cmd_reload&quot;:</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+      case &quot;cmd_find&quot;:</span>
<a href="#l10.116"></a><span id="l10.116">       case &quot;button_mark&quot;:</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-			case &quot;cmd_markAsRead&quot;:</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-			case &quot;cmd_markAllRead&quot;:</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-			case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-			case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+      case &quot;cmd_markAsRead&quot;:</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+      case &quot;cmd_markAllRead&quot;:</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+      case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+      case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l10.125"></a><span id="l10.125">         return true;</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-			case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+      case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l10.128"></a><span id="l10.128">       case &quot;button_file&quot;:</span>
<a href="#l10.129"></a><span id="l10.129">         return (gCurrentMessageUri != null);</span>
<a href="#l10.130"></a><span id="l10.130">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l10.131"></a><span id="l10.131">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;remoteContentPolicy&quot;, kAllowRemoteContent));</span>
<a href="#l10.132"></a><span id="l10.132">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l10.133"></a><span id="l10.133">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;notAPhishMessage&quot;, kNotAPhishMessage));</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-			case &quot;cmd_printSetup&quot;:</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-			  return true;</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-			case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+      case &quot;cmd_printSetup&quot;:</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+        return true;</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+      case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l10.140"></a><span id="l10.140">       case &quot;button_getNewMessages&quot;:</span>
<a href="#l10.141"></a><span id="l10.141">       case &quot;cmd_getMsgsForAuthAccounts&quot;:</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-				return IsGetNewMessagesEnabled();</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-			case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineminus">-				return IsGetNextNMessagesEnabled();</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-			case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineminus">-			case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+        return IsGetNewMessagesEnabled();</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+      case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+        return IsGetNextNMessagesEnabled();</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+      case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+      case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l10.152"></a><span id="l10.152">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l10.153"></a><span id="l10.153">         return !Services.io.offline;</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-			case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-                return IsAccountOfflineEnabled();</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-			case &quot;cmd_close&quot;:</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-			case &quot;cmd_nextMsg&quot;:</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+      case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+        return IsAccountOfflineEnabled();</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+      case &quot;cmd_close&quot;:</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+      case &quot;cmd_nextMsg&quot;:</span>
<a href="#l10.162"></a><span id="l10.162">       case &quot;button_next&quot;:</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-			case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+      case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l10.165"></a><span id="l10.165">       case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-			case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-			case &quot;cmd_previousMsg&quot;:</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-			case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+      case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+      case &quot;cmd_previousMsg&quot;:</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+      case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l10.172"></a><span id="l10.172">       case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l10.173"></a><span id="l10.173">       case &quot;cmd_applyFiltersToSelection&quot;:</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineminus">-				return true;</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+        return true;</span>
<a href="#l10.176"></a><span id="l10.176">       case &quot;cmd_findNext&quot;:</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineminus">-			case &quot;cmd_findPrev&quot;:</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineminus">-				return MsgCanFindAgain();</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+      case &quot;cmd_findPrev&quot;:</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+        return MsgCanFindAgain();</span>
<a href="#l10.181"></a><span id="l10.181">       case &quot;cmd_goBack&quot;:</span>
<a href="#l10.182"></a><span id="l10.182">       case &quot;button_goBack&quot;:</span>
<a href="#l10.183"></a><span id="l10.183">         return gDBView &amp;&amp; gDBView.navigateStatus(nsMsgNavigationType.back);</span>
<a href="#l10.184"></a><span id="l10.184">       case &quot;cmd_goForward&quot;:</span>
<a href="#l10.185"></a><span id="l10.185">       case &quot;button_goForward&quot;:</span>
<a href="#l10.186"></a><span id="l10.186">         return gDBView &amp;&amp; gDBView.navigateStatus(nsMsgNavigationType.forward);</span>
<a href="#l10.187"></a><span id="l10.187">       case &quot;button_search&quot;:</span>
<a href="#l10.188"></a><span id="l10.188">       case &quot;cmd_search&quot;:</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineat">@@ -753,82 +753,82 @@ var MessageWindowController =</span>
<a href="#l10.190"></a><span id="l10.190">         return true;</span>
<a href="#l10.191"></a><span id="l10.191">       case &quot;cmd_undo&quot;:</span>
<a href="#l10.192"></a><span id="l10.192">       case &quot;cmd_redo&quot;:</span>
<a href="#l10.193"></a><span id="l10.193">         return SetupUndoRedoCommand(command);</span>
<a href="#l10.194"></a><span id="l10.194">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l10.195"></a><span id="l10.195">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l10.196"></a><span id="l10.196">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l10.197"></a><span id="l10.197">         return false;</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineminus">-			default:</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineminus">-				return false;</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineminus">-		}</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineminus">-	},</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+      default:</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+        return false;</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+    }</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+  },</span>
<a href="#l10.206"></a><span id="l10.206"> </span>
<a href="#l10.207"></a><span id="l10.207" class="difflineminus">-	doCommand: function(command)</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineminus">-	{</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+  doCommand: function(command)</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineplus">+  {</span>
<a href="#l10.211"></a><span id="l10.211">     // if the user invoked a key short cut then it is possible that we got here for a command which is</span>
<a href="#l10.212"></a><span id="l10.212">     // really disabled. kick out if the command should be disabled.</span>
<a href="#l10.213"></a><span id="l10.213">     if (!this.isCommandEnabled(command)) return;</span>
<a href="#l10.214"></a><span id="l10.214"> </span>
<a href="#l10.215"></a><span id="l10.215">     var navigationType = nsMsgNavigationType.nextUnreadMessage;</span>
<a href="#l10.216"></a><span id="l10.216"> </span>
<a href="#l10.217"></a><span id="l10.217" class="difflineminus">-		switch ( command )</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineminus">-		{</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineminus">-			case &quot;cmd_close&quot;:</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineminus">-				CloseMailWindow();</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineminus">-				break;</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineminus">-			case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineminus">-				MsgGetMessage();</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineminus">-				break;</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineminus">-            case &quot;cmd_undo&quot;:</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineminus">-                messenger.undo(msgWindow);</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineminus">-                break;</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineminus">-            case &quot;cmd_redo&quot;:</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineminus">-                messenger.redo(msgWindow);</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineminus">-                break;</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+    switch ( command )</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineplus">+    {</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+      case &quot;cmd_close&quot;:</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineplus">+        CloseMailWindow();</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineplus">+        break;</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineplus">+      case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+        MsgGetMessage();</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+        break;</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+      case &quot;cmd_undo&quot;:</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+        messenger.undo(msgWindow);</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineplus">+        break;</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineplus">+      case &quot;cmd_redo&quot;:</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineplus">+        messenger.redo(msgWindow);</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineplus">+        break;</span>
<a href="#l10.245"></a><span id="l10.245">       case &quot;cmd_getMsgsForAuthAccounts&quot;:</span>
<a href="#l10.246"></a><span id="l10.246">         MsgGetMessagesForAllAuthenticatedAccounts();</span>
<a href="#l10.247"></a><span id="l10.247">         break;</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineminus">-			case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineminus">-				MsgGetNextNMessages();</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineminus">-				break;</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineminus">-			case &quot;cmd_reply&quot;:</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineminus">-				MsgReplyMessage(null);</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineminus">-				break;</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineminus">-			case &quot;cmd_replyList&quot;:</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineminus">-				MsgReplyList(null);</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineminus">-				break;</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineminus">-			case &quot;cmd_replyGroup&quot;:</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineminus">-				MsgReplyGroup(null);</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineminus">-				break;</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineminus">-			case &quot;cmd_replySender&quot;:</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineminus">-				MsgReplySender(null);</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineminus">-				break;</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineminus">-			case &quot;cmd_replyall&quot;:</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineminus">-				MsgReplyToAllMessage(null);</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineminus">-				break;</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+      case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+        MsgGetNextNMessages();</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+        break;</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineplus">+      case &quot;cmd_reply&quot;:</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineplus">+        MsgReplyMessage(null);</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineplus">+        break;</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineplus">+      case &quot;cmd_replyList&quot;:</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineplus">+        MsgReplyList(null);</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineplus">+        break;</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineplus">+      case &quot;cmd_replyGroup&quot;:</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineplus">+        MsgReplyGroup(null);</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineplus">+        break;</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineplus">+      case &quot;cmd_replySender&quot;:</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineplus">+        MsgReplySender(null);</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineplus">+        break;</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineplus">+      case &quot;cmd_replyall&quot;:</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineplus">+        MsgReplyToAllMessage(null);</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineplus">+        break;</span>
<a href="#l10.284"></a><span id="l10.284">       case &quot;cmd_replySenderAndGroup&quot;:</span>
<a href="#l10.285"></a><span id="l10.285">         MsgReplyToSenderAndGroup(null);</span>
<a href="#l10.286"></a><span id="l10.286">         break;</span>
<a href="#l10.287"></a><span id="l10.287">       case &quot;cmd_replyAllRecipients&quot;:</span>
<a href="#l10.288"></a><span id="l10.288">         MsgReplyToAllRecipients(null);</span>
<a href="#l10.289"></a><span id="l10.289">         break;</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineminus">-			case &quot;cmd_forward&quot;:</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineminus">-				MsgForwardMessage(null);</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineminus">-				break;</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineminus">-			case &quot;cmd_forwardInline&quot;:</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineminus">-				MsgForwardAsInline(null);</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineminus">-				break;</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineminus">-			case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineminus">-				MsgForwardAsAttachment(null);</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineminus">-				break;</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineminus">-			case &quot;cmd_editAsNew&quot;:</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineminus">-				MsgEditMessageAsNew();</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineminus">-				break;</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineplus">+      case &quot;cmd_forward&quot;:</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineplus">+        MsgForwardMessage(null);</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineplus">+        break;</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineplus">+      case &quot;cmd_forwardInline&quot;:</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineplus">+        MsgForwardAsInline(null);</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineplus">+        break;</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineplus">+      case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineplus">+        MsgForwardAsAttachment(null);</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineplus">+        break;</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineplus">+      case &quot;cmd_editAsNew&quot;:</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineplus">+        MsgEditMessageAsNew();</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineplus">+        break;</span>
<a href="#l10.314"></a><span id="l10.314">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l10.315"></a><span id="l10.315">         CreateFilter(document.popupNode);</span>
<a href="#l10.316"></a><span id="l10.316">         break;</span>
<a href="#l10.317"></a><span id="l10.317">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l10.318"></a><span id="l10.318">         MsgCreateFilter();</span>
<a href="#l10.319"></a><span id="l10.319">         break;</span>
<a href="#l10.320"></a><span id="l10.320">       case &quot;cmd_delete&quot;:</span>
<a href="#l10.321"></a><span id="l10.321">       case &quot;button_delete&quot;:</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineat">@@ -843,69 +843,69 @@ var MessageWindowController =</span>
<a href="#l10.323"></a><span id="l10.323">         MsgJunk();</span>
<a href="#l10.324"></a><span id="l10.324">         break;</span>
<a href="#l10.325"></a><span id="l10.325">       case &quot;cmd_stop&quot;:</span>
<a href="#l10.326"></a><span id="l10.326">         MsgStop();</span>
<a href="#l10.327"></a><span id="l10.327">         break;</span>
<a href="#l10.328"></a><span id="l10.328">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l10.329"></a><span id="l10.329">         PrintUtils.showPageSetup();</span>
<a href="#l10.330"></a><span id="l10.330">         break;</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineminus">-			case &quot;cmd_print&quot;:</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineminus">-				PrintEnginePrint();</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineminus">-				break;</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineminus">-			case &quot;cmd_printpreview&quot;:</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineminus">-				PrintEnginePrintPreview();</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineminus">-				break;</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineminus">-			case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l10.338"></a><span id="l10.338" class="difflineminus">-				MsgSaveAsFile();</span>
<a href="#l10.339"></a><span id="l10.339" class="difflineminus">-				break;</span>
<a href="#l10.340"></a><span id="l10.340" class="difflineminus">-			case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineminus">-				MsgSaveAsTemplate();</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineminus">-				break;</span>
<a href="#l10.343"></a><span id="l10.343" class="difflineminus">-			case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l10.344"></a><span id="l10.344" class="difflineminus">-				MsgViewPageSource();</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineminus">-				break;</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineminus">-			case &quot;cmd_reload&quot;:</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineminus">-				ReloadMessage();</span>
<a href="#l10.348"></a><span id="l10.348" class="difflineminus">-				break;</span>
<a href="#l10.349"></a><span id="l10.349" class="difflineminus">-			case &quot;cmd_find&quot;:</span>
<a href="#l10.350"></a><span id="l10.350" class="difflineminus">-				MsgFind();</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineminus">-				break;</span>
<a href="#l10.352"></a><span id="l10.352" class="difflineplus">+      case &quot;cmd_print&quot;:</span>
<a href="#l10.353"></a><span id="l10.353" class="difflineplus">+        PrintEnginePrint();</span>
<a href="#l10.354"></a><span id="l10.354" class="difflineplus">+        break;</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineplus">+      case &quot;cmd_printpreview&quot;:</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineplus">+        PrintEnginePrintPreview();</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineplus">+        break;</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineplus">+      case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l10.359"></a><span id="l10.359" class="difflineplus">+        MsgSaveAsFile();</span>
<a href="#l10.360"></a><span id="l10.360" class="difflineplus">+        break;</span>
<a href="#l10.361"></a><span id="l10.361" class="difflineplus">+      case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l10.362"></a><span id="l10.362" class="difflineplus">+        MsgSaveAsTemplate();</span>
<a href="#l10.363"></a><span id="l10.363" class="difflineplus">+        break;</span>
<a href="#l10.364"></a><span id="l10.364" class="difflineplus">+      case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l10.365"></a><span id="l10.365" class="difflineplus">+        MsgViewPageSource();</span>
<a href="#l10.366"></a><span id="l10.366" class="difflineplus">+        break;</span>
<a href="#l10.367"></a><span id="l10.367" class="difflineplus">+      case &quot;cmd_reload&quot;:</span>
<a href="#l10.368"></a><span id="l10.368" class="difflineplus">+        ReloadMessage();</span>
<a href="#l10.369"></a><span id="l10.369" class="difflineplus">+        break;</span>
<a href="#l10.370"></a><span id="l10.370" class="difflineplus">+      case &quot;cmd_find&quot;:</span>
<a href="#l10.371"></a><span id="l10.371" class="difflineplus">+        MsgFind();</span>
<a href="#l10.372"></a><span id="l10.372" class="difflineplus">+        break;</span>
<a href="#l10.373"></a><span id="l10.373">       case &quot;cmd_findNext&quot;:</span>
<a href="#l10.374"></a><span id="l10.374" class="difflineminus">-				MsgFindAgain(false);</span>
<a href="#l10.375"></a><span id="l10.375" class="difflineminus">-				break;</span>
<a href="#l10.376"></a><span id="l10.376" class="difflineminus">-			case &quot;cmd_findPrev&quot;:</span>
<a href="#l10.377"></a><span id="l10.377" class="difflineminus">-				MsgFindAgain(true);</span>
<a href="#l10.378"></a><span id="l10.378" class="difflineminus">-				break;</span>
<a href="#l10.379"></a><span id="l10.379" class="difflineplus">+        MsgFindAgain(false);</span>
<a href="#l10.380"></a><span id="l10.380" class="difflineplus">+        break;</span>
<a href="#l10.381"></a><span id="l10.381" class="difflineplus">+      case &quot;cmd_findPrev&quot;:</span>
<a href="#l10.382"></a><span id="l10.382" class="difflineplus">+        MsgFindAgain(true);</span>
<a href="#l10.383"></a><span id="l10.383" class="difflineplus">+        break;</span>
<a href="#l10.384"></a><span id="l10.384">       case &quot;button_search&quot;:</span>
<a href="#l10.385"></a><span id="l10.385">       case &quot;cmd_search&quot;:</span>
<a href="#l10.386"></a><span id="l10.386">         MsgSearchMessages();</span>
<a href="#l10.387"></a><span id="l10.387">         break;</span>
<a href="#l10.388"></a><span id="l10.388">       case &quot;button_mark&quot;:</span>
<a href="#l10.389"></a><span id="l10.389" class="difflineminus">-			case &quot;cmd_markAsRead&quot;:</span>
<a href="#l10.390"></a><span id="l10.390" class="difflineminus">-				MsgMarkMsgAsRead(null);</span>
<a href="#l10.391"></a><span id="l10.391" class="difflineminus">-				return;</span>
<a href="#l10.392"></a><span id="l10.392" class="difflineminus">-			case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l10.393"></a><span id="l10.393" class="difflineminus">-				MsgMarkThreadAsRead();</span>
<a href="#l10.394"></a><span id="l10.394" class="difflineminus">-				return;</span>
<a href="#l10.395"></a><span id="l10.395" class="difflineminus">-			case &quot;cmd_markAllRead&quot;:</span>
<a href="#l10.396"></a><span id="l10.396" class="difflineminus">-				MsgMarkAllRead();</span>
<a href="#l10.397"></a><span id="l10.397" class="difflineminus">-				return;</span>
<a href="#l10.398"></a><span id="l10.398" class="difflineminus">-			case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l10.399"></a><span id="l10.399" class="difflineminus">-				MsgMarkReadByDate();</span>
<a href="#l10.400"></a><span id="l10.400" class="difflineminus">-				return;</span>
<a href="#l10.401"></a><span id="l10.401" class="difflineminus">-			case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l10.402"></a><span id="l10.402" class="difflineminus">-				MsgMarkAsFlagged(null);</span>
<a href="#l10.403"></a><span id="l10.403" class="difflineminus">-				return;</span>
<a href="#l10.404"></a><span id="l10.404" class="difflineminus">-			case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l10.405"></a><span id="l10.405" class="difflineplus">+      case &quot;cmd_markAsRead&quot;:</span>
<a href="#l10.406"></a><span id="l10.406" class="difflineplus">+        MsgMarkMsgAsRead(null);</span>
<a href="#l10.407"></a><span id="l10.407" class="difflineplus">+        return;</span>
<a href="#l10.408"></a><span id="l10.408" class="difflineplus">+      case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l10.409"></a><span id="l10.409" class="difflineplus">+        MsgMarkThreadAsRead();</span>
<a href="#l10.410"></a><span id="l10.410" class="difflineplus">+        return;</span>
<a href="#l10.411"></a><span id="l10.411" class="difflineplus">+      case &quot;cmd_markAllRead&quot;:</span>
<a href="#l10.412"></a><span id="l10.412" class="difflineplus">+        MsgMarkAllRead();</span>
<a href="#l10.413"></a><span id="l10.413" class="difflineplus">+        return;</span>
<a href="#l10.414"></a><span id="l10.414" class="difflineplus">+      case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l10.415"></a><span id="l10.415" class="difflineplus">+        MsgMarkReadByDate();</span>
<a href="#l10.416"></a><span id="l10.416" class="difflineplus">+        return;</span>
<a href="#l10.417"></a><span id="l10.417" class="difflineplus">+      case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l10.418"></a><span id="l10.418" class="difflineplus">+        MsgMarkAsFlagged(null);</span>
<a href="#l10.419"></a><span id="l10.419" class="difflineplus">+        return;</span>
<a href="#l10.420"></a><span id="l10.420" class="difflineplus">+      case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l10.421"></a><span id="l10.421">         JunkSelectedMessages(true);</span>
<a href="#l10.422"></a><span id="l10.422" class="difflineminus">-				return;</span>
<a href="#l10.423"></a><span id="l10.423" class="difflineminus">-			case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l10.424"></a><span id="l10.424" class="difflineplus">+        return;</span>
<a href="#l10.425"></a><span id="l10.425" class="difflineplus">+      case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l10.426"></a><span id="l10.426">         JunkSelectedMessages(false);</span>
<a href="#l10.427"></a><span id="l10.427" class="difflineminus">-				return;</span>
<a href="#l10.428"></a><span id="l10.428" class="difflineplus">+        return;</span>
<a href="#l10.429"></a><span id="l10.429">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l10.430"></a><span id="l10.430">         analyzeMessagesForJunk();</span>
<a href="#l10.431"></a><span id="l10.431">         return;</span>
<a href="#l10.432"></a><span id="l10.432">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l10.433"></a><span id="l10.433">         LoadMsgWithRemoteContent();</span>
<a href="#l10.434"></a><span id="l10.434">         return;</span>
<a href="#l10.435"></a><span id="l10.435">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l10.436"></a><span id="l10.436">         MsgIsNotAScam();</span>
<a href="#l10.437"></a><span id="l10.437" class="difflineat">@@ -921,49 +921,49 @@ var MessageWindowController =</span>
<a href="#l10.438"></a><span id="l10.438">         return;</span>
<a href="#l10.439"></a><span id="l10.439">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l10.440"></a><span id="l10.440">         MsgSettingsOffline();</span>
<a href="#l10.441"></a><span id="l10.441">         return;</span>
<a href="#l10.442"></a><span id="l10.442">       case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l10.443"></a><span id="l10.443">       case &quot;button_next&quot;:</span>
<a href="#l10.444"></a><span id="l10.444">         performNavigation(nsMsgNavigationType.nextUnreadMessage);</span>
<a href="#l10.445"></a><span id="l10.445">         break;</span>
<a href="#l10.446"></a><span id="l10.446" class="difflineminus">-			case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l10.447"></a><span id="l10.447" class="difflineplus">+      case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l10.448"></a><span id="l10.448">         performNavigation(nsMsgNavigationType.nextUnreadThread);</span>
<a href="#l10.449"></a><span id="l10.449" class="difflineminus">-				break;</span>
<a href="#l10.450"></a><span id="l10.450" class="difflineminus">-			case &quot;cmd_nextMsg&quot;:</span>
<a href="#l10.451"></a><span id="l10.451" class="difflineplus">+        break;</span>
<a href="#l10.452"></a><span id="l10.452" class="difflineplus">+      case &quot;cmd_nextMsg&quot;:</span>
<a href="#l10.453"></a><span id="l10.453">         performNavigation(nsMsgNavigationType.nextMessage);</span>
<a href="#l10.454"></a><span id="l10.454" class="difflineminus">-				break;</span>
<a href="#l10.455"></a><span id="l10.455" class="difflineminus">-			case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l10.456"></a><span id="l10.456" class="difflineplus">+        break;</span>
<a href="#l10.457"></a><span id="l10.457" class="difflineplus">+      case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l10.458"></a><span id="l10.458">         performNavigation(nsMsgNavigationType.nextFlagged);</span>
<a href="#l10.459"></a><span id="l10.459" class="difflineminus">-				break;</span>
<a href="#l10.460"></a><span id="l10.460" class="difflineminus">-			case &quot;cmd_previousMsg&quot;:</span>
<a href="#l10.461"></a><span id="l10.461" class="difflineplus">+        break;</span>
<a href="#l10.462"></a><span id="l10.462" class="difflineplus">+      case &quot;cmd_previousMsg&quot;:</span>
<a href="#l10.463"></a><span id="l10.463">         performNavigation(nsMsgNavigationType.previousMessage);</span>
<a href="#l10.464"></a><span id="l10.464" class="difflineminus">-				break;</span>
<a href="#l10.465"></a><span id="l10.465" class="difflineminus">-			case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l10.466"></a><span id="l10.466" class="difflineplus">+        break;</span>
<a href="#l10.467"></a><span id="l10.467" class="difflineplus">+      case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l10.468"></a><span id="l10.468">         performNavigation(nsMsgNavigationType.previousUnreadMessage);</span>
<a href="#l10.469"></a><span id="l10.469" class="difflineminus">-				break;</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineminus">-			case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l10.471"></a><span id="l10.471" class="difflineplus">+        break;</span>
<a href="#l10.472"></a><span id="l10.472" class="difflineplus">+      case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l10.473"></a><span id="l10.473">         performNavigation(nsMsgNavigationType.previousFlagged);</span>
<a href="#l10.474"></a><span id="l10.474" class="difflineminus">-				break;</span>
<a href="#l10.475"></a><span id="l10.475" class="difflineplus">+        break;</span>
<a href="#l10.476"></a><span id="l10.476">       case &quot;cmd_goBack&quot;:</span>
<a href="#l10.477"></a><span id="l10.477">         performNavigation(nsMsgNavigationType.back);</span>
<a href="#l10.478"></a><span id="l10.478">         break;</span>
<a href="#l10.479"></a><span id="l10.479">       case &quot;cmd_goForward&quot;:</span>
<a href="#l10.480"></a><span id="l10.480">         performNavigation(nsMsgNavigationType.forward);</span>
<a href="#l10.481"></a><span id="l10.481">         break;</span>
<a href="#l10.482"></a><span id="l10.482">       case &quot;cmd_applyFiltersToSelection&quot;:</span>
<a href="#l10.483"></a><span id="l10.483">         MsgApplyFiltersToSelection();</span>
<a href="#l10.484"></a><span id="l10.484">         break;</span>
<a href="#l10.485"></a><span id="l10.485" class="difflineminus">-		}</span>
<a href="#l10.486"></a><span id="l10.486" class="difflineminus">-	},</span>
<a href="#l10.487"></a><span id="l10.487" class="difflineplus">+    }</span>
<a href="#l10.488"></a><span id="l10.488" class="difflineplus">+  },</span>
<a href="#l10.489"></a><span id="l10.489"> </span>
<a href="#l10.490"></a><span id="l10.490" class="difflineminus">-	onEvent: function(event)</span>
<a href="#l10.491"></a><span id="l10.491" class="difflineminus">-	{</span>
<a href="#l10.492"></a><span id="l10.492" class="difflineminus">-	}</span>
<a href="#l10.493"></a><span id="l10.493" class="difflineplus">+  onEvent: function(event)</span>
<a href="#l10.494"></a><span id="l10.494" class="difflineplus">+  {</span>
<a href="#l10.495"></a><span id="l10.495" class="difflineplus">+  }</span>
<a href="#l10.496"></a><span id="l10.496"> };</span>
<a href="#l10.497"></a><span id="l10.497"> </span>
<a href="#l10.498"></a><span id="l10.498"> function LoadMessageByNavigationType(type)</span>
<a href="#l10.499"></a><span id="l10.499"> {</span>
<a href="#l10.500"></a><span id="l10.500">   var resultId = new Object;</span>
<a href="#l10.501"></a><span id="l10.501">   var resultIndex = new Object;</span>
<a href="#l10.502"></a><span id="l10.502">   var threadIndex = new Object;</span>
<a href="#l10.503"></a><span id="l10.503"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/mailnews/content/messageWindow.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/mailnews/content/messageWindow.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -59,17 +59,17 @@</span>
<a href="#l11.4"></a><span id="l11.4">     &lt;commandset id=&quot;mailSearchMenuItems&quot;/&gt;</span>
<a href="#l11.5"></a><span id="l11.5">     &lt;commandset id=&quot;mailGoMenuItems&quot;/&gt;</span>
<a href="#l11.6"></a><span id="l11.6">     &lt;commandset id=&quot;mailMessageMenuItems&quot;/&gt;</span>
<a href="#l11.7"></a><span id="l11.7">     &lt;commandset id=&quot;mailToolbarItems&quot;/&gt;</span>
<a href="#l11.8"></a><span id="l11.8">     &lt;commandset id=&quot;mailGetMsgMenuItems&quot;/&gt;</span>
<a href="#l11.9"></a><span id="l11.9">     &lt;commandset id=&quot;mailMarkMenuItems&quot;/&gt;</span>
<a href="#l11.10"></a><span id="l11.10">     &lt;commandset id=&quot;mailToolsMenuItems&quot;/&gt;</span>
<a href="#l11.11"></a><span id="l11.11">     &lt;commandset id=&quot;mailEditContextMenuItems&quot;/&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-	  &lt;commandset id=&quot;tasksCommands&quot;/&gt;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    &lt;commandset id=&quot;tasksCommands&quot;/&gt;</span>
<a href="#l11.14"></a><span id="l11.14">     &lt;commandset id=&quot;commandKeys&quot;/&gt;</span>
<a href="#l11.15"></a><span id="l11.15">   &lt;/commandset&gt;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   &lt;broadcasterset id=&quot;mailBroadcasters&quot;&gt;</span>
<a href="#l11.18"></a><span id="l11.18">     &lt;broadcaster id=&quot;mailHideMenus&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l11.19"></a><span id="l11.19">     &lt;broadcaster id=&quot;mailDisableKeys&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l11.20"></a><span id="l11.20">     &lt;!-- File Menu --&gt;</span>
<a href="#l11.21"></a><span id="l11.21">     &lt;broadcaster id=&quot;Communicator:WorkMode&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/mailnews/content/msgMail3PaneWindow.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/mailnews/content/msgMail3PaneWindow.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1431,19 +1431,19 @@ function SetBusyCursor(window, enable)</span>
<a href="#l12.4"></a><span id="l12.4">     // setCursor method</span>
<a href="#l12.5"></a><span id="l12.5">     if (&quot;setCursor&quot; in window) {</span>
<a href="#l12.6"></a><span id="l12.6">         if (enable)</span>
<a href="#l12.7"></a><span id="l12.7">             window.setCursor(&quot;progress&quot;);</span>
<a href="#l12.8"></a><span id="l12.8">         else</span>
<a href="#l12.9"></a><span id="l12.9">             window.setCursor(&quot;auto&quot;);</span>
<a href="#l12.10"></a><span id="l12.10">     }</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-	var numFrames = window.frames.length;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-	for(var i = 0; i &lt; numFrames; i++)</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-		SetBusyCursor(window.frames[i], enable);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+    var numFrames = window.frames.length;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+    for(var i = 0; i &lt; numFrames; i++)</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+      SetBusyCursor(window.frames[i], enable);</span>
<a href="#l12.18"></a><span id="l12.18"> }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> function GetDBView()</span>
<a href="#l12.21"></a><span id="l12.21"> {</span>
<a href="#l12.22"></a><span id="l12.22">   return gDBView;</span>
<a href="#l12.23"></a><span id="l12.23"> }</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25"> function GetFolderResource(tree, index)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

