<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17548:a39af5933cc112d73dfe116da2030353bcacdd9c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a39af5933cc112d73dfe116da2030353bcacdd9c" />
<meta property="og:url" content="/comm-central/rev/a39af5933cc112d73dfe116da2030353bcacdd9c" />
<meta property="og:description" content="Fix bug 351499 - Sort out &quot;delete calendar&quot; vs. &quot;unsubscribe&quot; UI hilarity. r=redDragon" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a39af5933cc112d73dfe116da2030353bcacdd9c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a39af5933cc112d73dfe116da2030353bcacdd9c">shortlog</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a39af5933cc112d73dfe116da2030353bcacdd9c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c">files</a> |
changeset |
<a href="/comm-central/raw-rev/a39af5933cc112d73dfe116da2030353bcacdd9c">raw</a>  | <a href="/comm-central/archive/a39af5933cc112d73dfe116da2030353bcacdd9c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=351499">bug 351499</a> - Sort out &quot;delete calendar&quot; vs. &quot;unsubscribe&quot; UI hilarity. r=redDragon
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 23 Feb 2015 01:27:54 +0100</td></tr>

<tr>
 <td>changeset 17548</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a39af5933cc112d73dfe116da2030353bcacdd9c">a39af5933cc112d73dfe116da2030353bcacdd9c</a></td>
</tr>



<tr>
<td>parent 17547</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">ea9366c0757233c1e7bee1a3e4275bb697cf4f5a</a>
</td>
</tr>

<tr>
<td>child 17549</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e529163574ffb098d113448b4313a8470a4c5203">e529163574ffb098d113448b4313a8470a4c5203</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a39af5933cc112d73dfe116da2030353bcacdd9c">10802</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Mon, 23 Feb 2015 00:49:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@b50441dcdf0d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b50441dcdf0d63a642d784b223f6cee0f4195f6f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&newProject=comm-central&newRevision=9903ed277c05c6ad56f7a652aad43a19d24a98d6&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&newProject=comm-central&newRevision=9903ed277c05c6ad56f7a652aad43a19d24a98d6&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&newProject=comm-central&newRevision=9903ed277c05c6ad56f7a652aad43a19d24a98d6&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28redDragon%29&revcount=50">redDragon</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=351499">351499</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=351499">bug 351499</a> - Sort out &quot;delete calendar&quot; vs. &quot;unsubscribe&quot; UI hilarity. r=redDragon</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-calendars-list.xul">calendar/base/content/calendar-calendars-list.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-calendars-list.xul">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-calendars-list.xul">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-calendars-list.xul">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-calendars-list.xul">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-calendars-list.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendar.idl">calendar/base/public/calICalendar.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendar.idl">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendar.idl">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendar.idl">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendar.idl">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendar.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendarManager.idl">calendar/base/public/calICalendarManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendarManager.idl">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendarManager.idl">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendarManager.idl">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendarManager.idl">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/public/calICalendarManager.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/lightning/content/lightning-menus.xul">calendar/lightning/content/lightning-menus.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/lightning/content/lightning-menus.xul">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/lightning/content/lightning-menus.xul">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/lightning/content/lightning-menus.xul">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/lightning/content/lightning-menus.xul">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/lightning/content/lightning-menus.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.dtd">calendar/locales/en-US/chrome/calendar/calendar.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.dtd">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.dtd">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.dtd">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.dtd">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.properties">calendar/locales/en-US/chrome/calendar/calendar.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.properties">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.properties">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.properties">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.properties">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/calendar.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd">calendar/locales/en-US/chrome/calendar/menuOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/gdata/content/gdata-migration.js">calendar/providers/gdata/content/gdata-migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/gdata/content/gdata-migration.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/gdata/content/gdata-migration.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/gdata/content/gdata-migration.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/gdata/content/gdata-migration.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/gdata/content/gdata-migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/test_calmgr.js">calendar/test/unit/test_calmgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/test_calmgr.js">file</a> |
<a href="/comm-central/annotate/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/test_calmgr.js">annotate</a> |
<a href="/comm-central/diff/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/test_calmgr.js">diff</a> |
<a href="/comm-central/comparison/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/test_calmgr.js">comparison</a> |
<a href="/comm-central/log/a39af5933cc112d73dfe116da2030353bcacdd9c/calendar/test/unit/test_calmgr.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-calendars-list.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-calendars-list.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -29,18 +29,22 @@</span>
<a href="#l1.4"></a><span id="l1.4">                 label=&quot;&amp;calendar.context.newserver.label;&quot;</span>
<a href="#l1.5"></a><span id="l1.5">                 accesskey=&quot;&amp;calendar.context.newserver.accesskey;&quot;</span>
<a href="#l1.6"></a><span id="l1.6">                 observes=&quot;calendar_new_calendar_command&quot;/&gt;</span>
<a href="#l1.7"></a><span id="l1.7">       &lt;menuitem id=&quot;list-calendars-context-find&quot;</span>
<a href="#l1.8"></a><span id="l1.8">                 label=&quot;&amp;calendar.context.findcalendar.label;&quot;</span>
<a href="#l1.9"></a><span id="l1.9">                 accesskey=&quot;&amp;calendar.context.findcalendar.accesskey;&quot;</span>
<a href="#l1.10"></a><span id="l1.10">                 oncommand=&quot;openCalendarSubscriptionsDialog();&quot;/&gt;</span>
<a href="#l1.11"></a><span id="l1.11">       &lt;menuitem id=&quot;list-calendars-context-delete&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-                label=&quot;&amp;calendar.context.deleteserver.label;&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                accesskey=&quot;&amp;calendar.context.deleteserver.accesskey;&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+                labeldelete=&quot;&amp;calendar.context.deleteserver2.label;&quot;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+                labelremove=&quot;&amp;calendar.context.removeserver.label;&quot;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+                labelunsubscribe=&quot;&amp;calendar.context.unsubscribeserver.label;&quot;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+                accesskeydelete=&quot;&amp;calendar.context.deleteserver2.accesskey;&quot;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+                accesskeyremove=&quot;&amp;calendar.context.removeserver.accesskey;&quot;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+                accesskeyunsubscribe=&quot;&amp;calendar.context.unsubscribeserver.accesskey;&quot;</span>
<a href="#l1.20"></a><span id="l1.20">                 observes=&quot;calendar_delete_calendar_command&quot;/&gt;</span>
<a href="#l1.21"></a><span id="l1.21">       &lt;menuseparator id=&quot;list-calendars-context-itemops-menuseparator&quot;/&gt;</span>
<a href="#l1.22"></a><span id="l1.22">       &lt;menuitem id=&quot;list-calendars-context-export&quot;</span>
<a href="#l1.23"></a><span id="l1.23">                 label=&quot;&amp;calendar.context.export.label;&quot;</span>
<a href="#l1.24"></a><span id="l1.24">                 accesskey=&quot;&amp;calendar.context.export.accesskey;&quot;</span>
<a href="#l1.25"></a><span id="l1.25">                 oncommand=&quot;exportEntireCalendar(document.getElementById('list-calendars-context-menu').contextCalendar);&quot;/&gt;</span>
<a href="#l1.26"></a><span id="l1.26">       &lt;menuitem id=&quot;list-calendars-context-publish&quot;</span>
<a href="#l1.27"></a><span id="l1.27">                 label=&quot;&amp;calendar.context.publish.label;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -19,32 +19,63 @@ function getSelectedCalendar() {</span>
<a href="#l2.4"></a><span id="l2.4"> /**</span>
<a href="#l2.5"></a><span id="l2.5">  * Deletes the passed calendar, prompting the user if he really wants to do</span>
<a href="#l2.6"></a><span id="l2.6">  * this. If there is only one calendar left, no calendar is removed and the user</span>
<a href="#l2.7"></a><span id="l2.7">  * is not prompted.</span>
<a href="#l2.8"></a><span id="l2.8">  *</span>
<a href="#l2.9"></a><span id="l2.9">  * @param aCalendar     The calendar to delete.</span>
<a href="#l2.10"></a><span id="l2.10">  */</span>
<a href="#l2.11"></a><span id="l2.11"> function promptDeleteCalendar(aCalendar) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    const nIPS = Components.interfaces.nsIPromptService;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    const cICM = Components.interfaces.calICalendarManager;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    let calMgr = cal.getCalendarManager();</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    let calendars = calMgr.getCalendars({});</span>
<a href="#l2.18"></a><span id="l2.18">     if (calendars.length &lt;= 1) {</span>
<a href="#l2.19"></a><span id="l2.19">         // If this is the last calendar, don't delete it.</span>
<a href="#l2.20"></a><span id="l2.20">         return;</span>
<a href="#l2.21"></a><span id="l2.21">     }</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-    let ok = Services.prompt.confirm(window,</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-                                     calGetString(&quot;calendar&quot;, &quot;unsubscribeCalendarTitle&quot;),</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-                                     calGetString(&quot;calendar&quot;, &quot;unsubscribeCalendarMessage&quot;,</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-                                                  [aCalendar.name]),</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-                                     {});</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    let modes = new Set(aCalendar.getProperty(&quot;capabilities.removeModes&quot;) || [&quot;unsubscribe&quot;]);</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+    let title = cal.calGetString(&quot;calendar&quot;, &quot;removeCalendarTitle&quot;);</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+    let textKey, b0text, b2text;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    let removeFlags = 0;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    let promptFlags = (nIPS.BUTTON_POS_0 * nIPS.BUTTON_TITLE_IS_STRING) +</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+                      (nIPS.BUTTON_POS_1 * nIPS.BUTTON_TITLE_CANCEL);</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-    if (ok) {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-        let calMgr = cal.getCalendarManager();</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-        calMgr.unregisterCalendar(aCalendar);</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-        calMgr.deleteCalendar(aCalendar);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+    if (modes.has(&quot;delete&quot;) &amp;&amp; !modes.has(&quot;unsubscribe&quot;)) {</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+        textKey = &quot;removeCalendarMessageDelete&quot;;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+        promptFlags += nIPS.BUTTON_DELAY_ENABLE;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+        b0text = cal.calGetString(&quot;calendar&quot;, &quot;removeCalendarButtonDelete&quot;);</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+    } else if (modes.has(&quot;delete&quot;)) {</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+        textKey = &quot;removeCalendarMessageDeleteOrUnsubscribe&quot;;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+        promptFlags += (nIPS.BUTTON_POS_2 * nIPS.BUTTON_TITLE_IS_STRING);</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+        b0text = cal.calGetString(&quot;calendar&quot;, &quot;removeCalendarButtonUnsubscribe&quot;);</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+        b2text = cal.calGetString(&quot;calendar&quot;, &quot;removeCalendarButtonDelete&quot;);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+    } else if (modes.has(&quot;unsubscribe&quot;)) {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+        textKey = &quot;removeCalendarMessageUnsubscribe&quot;;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+        removeFlags |= cICM.REMOVE_NO_DELETE;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+        b0text = cal.calGetString(&quot;calendar&quot;, &quot;removeCalendarButtonUnsubscribe&quot;);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+    } else {</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+        return;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+    }</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+    let text = cal.calGetString(&quot;calendar&quot;, textKey, [aCalendar.name]);</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+    let res = Services.prompt.confirmEx(window, title, text, promptFlags,</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+                                        b0text, null, b2text, null, {});</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    if (res != 1) { // Not canceled</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+        if (textKey == &quot;removeCalendarMessageDeleteOrUnsubscribe&quot; &amp;&amp; res == 0) {</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+            // Both unsubscribing and deleting is possible, but unsubscribing was</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+            // requested. Make sure no delete is executed.</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+            removeFlags |= cICM.REMOVE_NO_DELETE;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+        }</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+        calMgr.removeCalendar(aCalendar, removeFlags);</span>
<a href="#l2.69"></a><span id="l2.69">     }</span>
<a href="#l2.70"></a><span id="l2.70"> }</span>
<a href="#l2.71"></a><span id="l2.71"> </span>
<a href="#l2.72"></a><span id="l2.72"> /**</span>
<a href="#l2.73"></a><span id="l2.73">  * Called to initialize the calendar manager for a window.</span>
<a href="#l2.74"></a><span id="l2.74">  */</span>
<a href="#l2.75"></a><span id="l2.75"> function loadCalendarManager() {</span>
<a href="#l2.76"></a><span id="l2.76">     // Set up the composite calendar in the calendar list widget.</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineat">@@ -168,46 +199,71 @@ function calendarListSetupContextMenu(ev</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">     // Only enable calendar search if there's actually the chance of finding something:</span>
<a href="#l2.80"></a><span id="l2.80">     let hasProviders = getCalendarSearchService().getProviders({}).length &lt; 1 &amp;&amp; &quot;true&quot;;</span>
<a href="#l2.81"></a><span id="l2.81">     setElementValue(&quot;list-calendars-context-find&quot;, hasProviders, &quot;collapsed&quot;);</span>
<a href="#l2.82"></a><span id="l2.82"> </span>
<a href="#l2.83"></a><span id="l2.83">     if (calendar) {</span>
<a href="#l2.84"></a><span id="l2.84">         enableElement(&quot;list-calendars-context-edit&quot;);</span>
<a href="#l2.85"></a><span id="l2.85">         enableElement(&quot;list-calendars-context-publish&quot;);</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-        // Only enable the delete calendars item if there is more than one</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-        // calendar. We don't want to have the last calendar deleted.</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-        if (calendars.length &gt; 1) {</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-            enableElement(&quot;list-calendars-context-delete&quot;);</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-        }</span>
<a href="#l2.91"></a><span id="l2.91"> </span>
<a href="#l2.92"></a><span id="l2.92">         enableElement(&quot;list-calendars-context-togglevisible&quot;);</span>
<a href="#l2.93"></a><span id="l2.93">         setElementValue(&quot;list-calendars-context-togglevisible&quot;, false, &quot;collapsed&quot;);</span>
<a href="#l2.94"></a><span id="l2.94">         let stringName = composite.getCalendarById(calendar.id) ? &quot;hideCalendar&quot; : &quot;showCalendar&quot;;</span>
<a href="#l2.95"></a><span id="l2.95">         setElementValue(&quot;list-calendars-context-togglevisible&quot;,</span>
<a href="#l2.96"></a><span id="l2.96">                         cal.calGetString(&quot;calendar&quot;, stringName, [calendar.name]),</span>
<a href="#l2.97"></a><span id="l2.97">                         &quot;label&quot;);</span>
<a href="#l2.98"></a><span id="l2.98">         enableElement(&quot;list-calendars-context-showonly&quot;);</span>
<a href="#l2.99"></a><span id="l2.99">         setElementValue(&quot;list-calendars-context-showonly&quot;, false, &quot;collapsed&quot;);</span>
<a href="#l2.100"></a><span id="l2.100">         setElementValue(&quot;list-calendars-context-showonly&quot;,</span>
<a href="#l2.101"></a><span id="l2.101">                         cal.calGetString(&quot;calendar&quot;, &quot;showOnlyCalendar&quot;, [calendar.name]),</span>
<a href="#l2.102"></a><span id="l2.102">                         &quot;label&quot;);</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+        setupDeleteMenuitem(&quot;list-calendars-context-delete&quot;, calendar);</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+        // Only enable the delete calendars item if there is more than one</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+        // calendar. We don't want to have the last calendar deleted.</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+        setElementValue(&quot;list-calendars-context-delete&quot;, calendars.length &lt; 2 &amp;&amp; &quot;true&quot;, &quot;disabled&quot;);</span>
<a href="#l2.108"></a><span id="l2.108">     } else {</span>
<a href="#l2.109"></a><span id="l2.109">         disableElement(&quot;list-calendars-context-edit&quot;);</span>
<a href="#l2.110"></a><span id="l2.110">         disableElement(&quot;list-calendars-context-publish&quot;);</span>
<a href="#l2.111"></a><span id="l2.111">         disableElement(&quot;list-calendars-context-delete&quot;);</span>
<a href="#l2.112"></a><span id="l2.112">         disableElement(&quot;list-calendars-context-togglevisible&quot;);</span>
<a href="#l2.113"></a><span id="l2.113">         setElementValue(&quot;list-calendars-context-togglevisible&quot;, true, &quot;collapsed&quot;);</span>
<a href="#l2.114"></a><span id="l2.114">         disableElement(&quot;list-calendars-context-showonly&quot;);</span>
<a href="#l2.115"></a><span id="l2.115">         setElementValue(&quot;list-calendars-context-showonly&quot;, true, &quot;collapsed&quot;);</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+        setupDeleteMenuitem(&quot;list-calendars-context-delete&quot;, null);</span>
<a href="#l2.117"></a><span id="l2.117">     }</span>
<a href="#l2.118"></a><span id="l2.118">     return true;</span>
<a href="#l2.119"></a><span id="l2.119"> }</span>
<a href="#l2.120"></a><span id="l2.120"> </span>
<a href="#l2.121"></a><span id="l2.121"> /**</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+ * Changes the &quot;delete calendar&quot; menuitem to have the right label based on the</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+ * removeModes. The menuitem must have the attributes &quot;labelremove&quot;,</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+ * &quot;labeldelete&quot; and &quot;labelunsubscribe&quot;.</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+ *</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+ * @param aDeleteId     The id of the menuitem to delete the calendar</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+ */</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+function setupDeleteMenuitem(aDeleteId, aCalendar) {</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+    let calendar = (aCalendar === undefined ?  getSelectedCalendar() : aCalendar);</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+    let modes = new Set(calendar ? calendar.getProperty(&quot;capabilities.removeModes&quot;) || [&quot;unsubscribe&quot;] : []);</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+    let type = &quot;remove&quot;;</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+    if (modes.has(&quot;delete&quot;) &amp;&amp; !modes.has(&quot;unsubscribe&quot;)) {</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+        type = &quot;delete&quot;;</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+    } else if (modes.has(&quot;unsubscribe&quot;) &amp;&amp; !modes.has(&quot;delete&quot;)) {</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+        type = &quot;unsubscribe&quot;;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+    }</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+    let deleteItem = document.getElementById(aDeleteId);</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+    setElementValue(deleteItem, deleteItem.getAttribute(&quot;label&quot; + type), &quot;label&quot;);</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+    setElementValue(deleteItem, deleteItem.getAttribute(&quot;accesskey&quot; + type), &quot;accesskey&quot;);</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    setElementValue(deleteItem, modes.size == 0 &amp;&amp; &quot;true&quot;, &quot;disabled&quot;);</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+}</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+/**</span>
<a href="#l2.146"></a><span id="l2.146">  * Makes sure the passed calendar is visible to the user</span>
<a href="#l2.147"></a><span id="l2.147">  *</span>
<a href="#l2.148"></a><span id="l2.148">  * @param aCalendar   The calendar to make visible.</span>
<a href="#l2.149"></a><span id="l2.149">  */</span>
<a href="#l2.150"></a><span id="l2.150"> function ensureCalendarVisible(aCalendar) {</span>
<a href="#l2.151"></a><span id="l2.151">     // We use the main window's calendar list to ensure that the calendar is visible</span>
<a href="#l2.152"></a><span id="l2.152">     document.getElementById(&quot;calendar-list-tree-widget&quot;).ensureCalendarVisible(aCalendar);</span>
<a href="#l2.153"></a><span id="l2.153"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/public/calICalendar.idl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/public/calICalendar.idl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -182,16 +182,23 @@ interface calICalendar : nsISupports</span>
<a href="#l3.4"></a><span id="l3.4">    *   capabilities.privacy.values = [&quot;PUBLIC&quot;, &quot;CONFIDENTIAL&quot;, &quot;PRIVATE&quot;];</span>
<a href="#l3.5"></a><span id="l3.5">    *</span>
<a href="#l3.6"></a><span id="l3.6">    * The following special capability disables rewriting the WWW-Authenticate</span>
<a href="#l3.7"></a><span id="l3.7">    * header on HTTP requests to include the calendar name. The default value</span>
<a href="#l3.8"></a><span id="l3.8">    * is false, i.e rewriting is NOT disabled.</span>
<a href="#l3.9"></a><span id="l3.9">    *</span>
<a href="#l3.10"></a><span id="l3.10">    *   capabilities.realmrewrite.disabled = false</span>
<a href="#l3.11"></a><span id="l3.11">    *</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+   * The following capability describes if the calendar can be permanently</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+   * deleted, or just unsubscribed. If this property is not specified, then</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+   * only unsubscribing is allowed. If an empty array is specified, neither</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+   * deleting nor unsubscribing is presented in the UI.</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+   *</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+   *   capabilities.removeModes = [&quot;delete&quot;, &quot;unsubscribe&quot;]</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+   *</span>
<a href="#l3.19"></a><span id="l3.19">    * @param aName property name</span>
<a href="#l3.20"></a><span id="l3.20">    * @return value (string, integer and boolean values are supported),</span>
<a href="#l3.21"></a><span id="l3.21">    *               else null</span>
<a href="#l3.22"></a><span id="l3.22">    */</span>
<a href="#l3.23"></a><span id="l3.23">   nsIVariant getProperty(in AUTF8String aName);</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">   /**</span>
<a href="#l3.26"></a><span id="l3.26">    * Sets a calendar property.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/public/calICalendarManager.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/public/calICalendarManager.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> interface calICalendar;</span>
<a href="#l4.6"></a><span id="l4.6"> interface calIObserver;</span>
<a href="#l4.7"></a><span id="l4.7"> interface nsIURI;</span>
<a href="#l4.8"></a><span id="l4.8"> interface nsIVariant;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> interface calICalendarManagerObserver;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-[scriptable, uuid(613fb99f-359c-4a12-9c87-10b2b968f8cd)]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+[scriptable, uuid(fd8a2565-cb0f-4ecc-945d-760d75ab16d8)]</span>
<a href="#l4.14"></a><span id="l4.14"> interface calICalendarManager : nsISupports</span>
<a href="#l4.15"></a><span id="l4.15"> {</span>
<a href="#l4.16"></a><span id="l4.16">   /**</span>
<a href="#l4.17"></a><span id="l4.17">    * Gives the number of registered calendars that require network access.</span>
<a href="#l4.18"></a><span id="l4.18">    */</span>
<a href="#l4.19"></a><span id="l4.19">   readonly attribute uint32_t networkCalendarCount;</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">   /***</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -35,19 +35,41 @@ interface calICalendarManager : nsISuppo</span>
<a href="#l4.23"></a><span id="l4.23">   calICalendar createCalendar(in AUTF8String aType, in nsIURI aURL);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   /* register a newly created calendar with the calendar service */</span>
<a href="#l4.26"></a><span id="l4.26">   void registerCalendar(in calICalendar aCalendar);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   /* unregister a calendar */</span>
<a href="#l4.29"></a><span id="l4.29">   void unregisterCalendar(in calICalendar aCalendar);</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  /* delete a calendar for good */</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  /** @deprecated This method has been replaced by ::removeCalendar */</span>
<a href="#l4.33"></a><span id="l4.33">   void deleteCalendar(in calICalendar aCalendar);</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+  /** Remove the calendar following the calendar's capabilities.removeModes. */</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+  const unsigned short REMOVE_AUTO = 0;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  /** Just unsubscribe from the calendar, do not delete it. */</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  const unsigned short REMOVE_NO_DELETE = 1;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  /** Passing this flag will cause the call to fail if the calendar is registered */</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  const unsigned short REMOVE_NO_UNREGISTER = 2;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+  /**</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+   * Unregister and delete the calendar from the calendar manager. By default</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+   * the calendar will be removed based on the capabilities.removeModes</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+   * property of the calendar.</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+   *</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+   * WARNING: If the calendar supports deletion, the calendar will be</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+   * permanently deleted. You can prevent this with the REMOVE_NO_DELETE flag.</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+   *</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+   * @param aCalendar       The calendar to remove.</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+   * @param aMode           A combination of the above mode flags.</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+   */</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+  void removeCalendar(in calICalendar aCalendar, [optional] in uint8_t aMode);</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+</span>
<a href="#l4.57"></a><span id="l4.57">   /* get a calendar by its id */</span>
<a href="#l4.58"></a><span id="l4.58">   calICalendar getCalendarById(in AUTF8String aId);</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60">   /* return a list of all calendars currently registered */</span>
<a href="#l4.61"></a><span id="l4.61">   void getCalendars(out uint32_t count,</span>
<a href="#l4.62"></a><span id="l4.62">                     [array, size_is(count), retval] out calICalendar aCalendars);</span>
<a href="#l4.63"></a><span id="l4.63"> </span>
<a href="#l4.64"></a><span id="l4.64">   /** Add an observer for the calendar manager, i.e when calendars are registered */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -584,39 +584,57 @@ calCalendarManager.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">         if (calendar.getProperty(&quot;requiresNetwork&quot;) !== false) {</span>
<a href="#l5.5"></a><span id="l5.5">             this.mNetworkCalendarCount--;</span>
<a href="#l5.6"></a><span id="l5.6">         }</span>
<a href="#l5.7"></a><span id="l5.7">         this.mCalendarCount--;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">         this.clearRefreshTimer(calendar);</span>
<a href="#l5.10"></a><span id="l5.10">     },</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    // Delete this method for Lightning 4.7 at latest</span>
<a href="#l5.13"></a><span id="l5.13">     deleteCalendar: function(calendar) {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-        /* check to see if calendar is unregistered first... */</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-        /* delete the calendar for good */</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-        if (this.mCache &amp;&amp; (calendar.id in this.mCache)) {</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-            throw &quot;Can't delete a registered calendar&quot;;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+        if (!this.deleteCalendar.warningIssued) {</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+            cal.WARN(&quot;Use of calICalendarManager::deleteCalendar is deprecated&quot; +</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+                     &quot; and will be removed with the next release. Use&quot; +</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+                     &quot; ::removeCalendar instead.\n&quot; + cal.STACK(10));</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+            this.deleteCalendar.warningIssued = true;</span>
<a href="#l5.23"></a><span id="l5.23">         }</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+        const cICM = Components.interfaces.calICalendarManager;</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+        this.removeCalendar(calendar, cICM.REMOVE_NO_UNREGISTER);</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+    },</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+    removeCalendar: function(calendar, mode=0) {</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+        const cICM = Components.interfaces.calICalendarManager;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+        let removeModes = new Set(calendar.getProperty(&quot;capabilities.removeModes&quot;) || [&quot;unsubscribe&quot;]);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+        if (!removeModes.has(&quot;unsubscribe&quot;) &amp;&amp; !removeModes.has(&quot;delete&quot;)) {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+            // Removing is not allowed</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+            return;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+        }</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+        if ((mode &amp; cICM.REMOVE_NO_UNREGISTER) &amp;&amp; this.mCache &amp;&amp;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+            (calendar.id in this.mCache)) {</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+            throw new Components.Exception(&quot;Can't remove a registered calendar&quot;);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+        } else if (!(mode &amp; cICM.REMOVE_NO_UNREGISTER)) {</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+            this.unregisterCalendar(calendar);</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+        }</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+        // This observer notification needs to be fired for both unsubscribe</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+        // and delete, we don't differ this at the moment.</span>
<a href="#l5.47"></a><span id="l5.47">         this.notifyObservers(&quot;onCalendarDeleting&quot;, [calendar]);</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-        // XXX This is a workaround for bug 351499. We should remove it once</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        // we sort out the whole &quot;delete&quot; vs. &quot;unsubscribe&quot; UI thing.</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-        //</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-        // We only want to delete the contents of calendars from local</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-        // providers (storage and memory). Otherwise we may nuke someone's</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-        // calendar stored on a server when all they really wanted to do was</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-        // unsubscribe.</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-        let wrappedCalendar = cal.wrapInstance(calendar, Components.interfaces.calICalendarProvider);</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-        if (wrappedCalendar &amp;&amp;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-            (wrappedCalendar.type == &quot;storage&quot; || wrappedCalendar.type == &quot;memory&quot;)) {</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-            try {</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-                wrappedCalendar.deleteCalendar(calendar, null);</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-            } catch (e) {</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-                Components.utils.reportError(&quot;error purging calendar: &quot; + e);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+        // For deleting, we also call the deleteCalendar method from the provider.</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+        if (removeModes.has(&quot;delete&quot;) &amp;&amp; (mode &amp; cICM.REMOVE_NO_DELETE) == 0) {</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+            let wrappedCalendar = cal.wrapInstance(calendar, Components.interfaces.calICalendarProvider);</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+            if (!wrappedCalendar) {</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+                throw new Components.Exception(&quot;Calendar is missing a provider implementation for delete&quot;);</span>
<a href="#l5.68"></a><span id="l5.68">             }</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+            wrappedCalendar.deleteCalendar(calendar, null);</span>
<a href="#l5.71"></a><span id="l5.71">         }</span>
<a href="#l5.72"></a><span id="l5.72">     },</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74">     getCalendarById: function cmgr_getCalendarById(aId) {</span>
<a href="#l5.75"></a><span id="l5.75">         if (aId in this.mCache) {</span>
<a href="#l5.76"></a><span id="l5.76">             return this.mCache[aId];</span>
<a href="#l5.77"></a><span id="l5.77">         } else {</span>
<a href="#l5.78"></a><span id="l5.78">             return null;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineat">@@ -808,34 +826,34 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l5.80"></a><span id="l5.80">                 if (!aValue &amp;&amp; aCalendar.canRefresh) {</span>
<a href="#l5.81"></a><span id="l5.81">                     aCalendar.refresh();</span>
<a href="#l5.82"></a><span id="l5.82">                 }</span>
<a href="#l5.83"></a><span id="l5.83">                 break;</span>
<a href="#l5.84"></a><span id="l5.84">         }</span>
<a href="#l5.85"></a><span id="l5.85">     },</span>
<a href="#l5.86"></a><span id="l5.86"> </span>
<a href="#l5.87"></a><span id="l5.87">     changeCalendarCache: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+        const cICM = Components.interfaces.calICalendarManager;</span>
<a href="#l5.89"></a><span id="l5.89">         aOldValue = aOldValue || false;</span>
<a href="#l5.90"></a><span id="l5.90">         aValue = aValue || false;</span>
<a href="#l5.91"></a><span id="l5.91"> </span>
<a href="#l5.92"></a><span id="l5.92">         if (aOldValue != aValue) {</span>
<a href="#l5.93"></a><span id="l5.93">             // Try to find the current sort order</span>
<a href="#l5.94"></a><span id="l5.94">             let sortOrderPref = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l5.95"></a><span id="l5.95">             let initialSortOrderPos = null;</span>
<a href="#l5.96"></a><span id="l5.96">             for (let i = 0; i &lt; sortOrderPref.length; ++i) {</span>
<a href="#l5.97"></a><span id="l5.97">                 if (sortOrderPref[i] == aCalendar.id) {</span>
<a href="#l5.98"></a><span id="l5.98">                     initialSortOrderPos = i;</span>
<a href="#l5.99"></a><span id="l5.99">                 }</span>
<a href="#l5.100"></a><span id="l5.100">             }</span>
<a href="#l5.101"></a><span id="l5.101">             // Enabling or disabling cache on a calendar re-creates</span>
<a href="#l5.102"></a><span id="l5.102">             // it so the registerCalendar call can wrap/unwrap the</span>
<a href="#l5.103"></a><span id="l5.103">             // calCachedCalendar facade saving the user the need to</span>
<a href="#l5.104"></a><span id="l5.104">             // restart Thunderbird and making sure a new Id is used.</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-            this.calMgr.unregisterCalendar(aCalendar);</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-            this.calMgr.deleteCalendar(aCalendar);</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+            this.calMgr.removeCalendar(aCalendar, cICM.REMOVE_UNSUBSCRIBE);</span>
<a href="#l5.108"></a><span id="l5.108">             var newCal = this.calMgr.createCalendar(aCalendar.type,aCalendar.uri);</span>
<a href="#l5.109"></a><span id="l5.109">             newCal.name = aCalendar.name;</span>
<a href="#l5.110"></a><span id="l5.110"> </span>
<a href="#l5.111"></a><span id="l5.111">             // TODO: if properties get added this list will need to be adjusted,</span>
<a href="#l5.112"></a><span id="l5.112">             // ideally we should add a &quot;getProperties&quot; method to calICalendar.idl</span>
<a href="#l5.113"></a><span id="l5.113">             // to retrieve all non-transient properties for a calendar.</span>
<a href="#l5.114"></a><span id="l5.114">             let propsToCopy = [ &quot;color&quot;,</span>
<a href="#l5.115"></a><span id="l5.115">                                 &quot;disabled&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/lightning/content/lightning-menus.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-menus.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -314,17 +314,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">               observes=&quot;calendar_view_prev_command&quot;/&gt;</span>
<a href="#l6.5"></a><span id="l6.5">   &lt;/menupopup&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">   &lt;menubar id=&quot;mail-menubar&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8">     &lt;menu id=&quot;menu_Event_Task&quot;</span>
<a href="#l6.9"></a><span id="l6.9">           label=&quot;&amp;lightning.menu.eventtask.label;&quot;</span>
<a href="#l6.10"></a><span id="l6.10">           accesskey=&quot;&amp;lightning.menu.eventtask.accesskey;&quot;</span>
<a href="#l6.11"></a><span id="l6.11">           insertafter=&quot;messageMenu&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      &lt;menupopup id=&quot;menu_Event_Task_Popup&quot; onpopupshowing=&quot;changeMenuForTask(event)&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      &lt;menupopup id=&quot;menu_Event_Task_Popup&quot; onpopupshowing=&quot;changeMenuForTask(event); setupDeleteMenuitem('ltnDeleteSelectedCalendar')&quot;&gt;</span>
<a href="#l6.14"></a><span id="l6.14">         &lt;menuitem id=&quot;ltnNewEvent2&quot;</span>
<a href="#l6.15"></a><span id="l6.15">                   label=&quot;&amp;event.new.event;&quot;</span>
<a href="#l6.16"></a><span id="l6.16">                   accesskey=&quot;&amp;event.new.event.accesskey;&quot;</span>
<a href="#l6.17"></a><span id="l6.17">                   key=&quot;calendar-new-event-key&quot;</span>
<a href="#l6.18"></a><span id="l6.18">                   command=&quot;calendar_new_event_command&quot;</span>
<a href="#l6.19"></a><span id="l6.19">                   observes=&quot;calendar_new_event_command&quot;/&gt;</span>
<a href="#l6.20"></a><span id="l6.20">         &lt;menuitem id=&quot;ltnNewTask2&quot;</span>
<a href="#l6.21"></a><span id="l6.21">                   label=&quot;&amp;event.new.task;&quot;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -368,18 +368,22 @@</span>
<a href="#l6.23"></a><span id="l6.23">                   command=&quot;calendar_import_command&quot;</span>
<a href="#l6.24"></a><span id="l6.24">                   observes=&quot;calendar_import_command&quot;/&gt;</span>
<a href="#l6.25"></a><span id="l6.25">         &lt;menuitem id=&quot;ltnPublishCalendar&quot;</span>
<a href="#l6.26"></a><span id="l6.26">                   label=&quot;&amp;calendar.publish.label;&quot;</span>
<a href="#l6.27"></a><span id="l6.27">                   accesskey=&quot;&amp;calendar.publish.accesskey;&quot;</span>
<a href="#l6.28"></a><span id="l6.28">                   commmand=&quot;calendar_publish_calendar_command&quot;</span>
<a href="#l6.29"></a><span id="l6.29">                   observes=&quot;calendar_publish_calendar_command&quot;/&gt;</span>
<a href="#l6.30"></a><span id="l6.30">         &lt;menuitem id=&quot;ltnDeleteSelectedCalendar&quot;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-                  label=&quot;&amp;calendar.deletecalendar.label;&quot;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-                  accesskey=&quot;&amp;calendar.deletecalendar.accesskey;&quot;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+                  labeldelete=&quot;&amp;calendar.deletecalendar.label;&quot;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+                  labelremove=&quot;&amp;calendar.removecalendar.label;&quot;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+                  labelunsubscribe=&quot;&amp;calendar.unsubscribecalendar.label;&quot;</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+                  accesskeydelete=&quot;&amp;calendar.deletecalendar.accesskey;&quot;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+                  accesskeyremove=&quot;&amp;calendar.removecalendar.accesskey;&quot;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+                  accesskeyunsubscribe=&quot;&amp;calendar.unsubscribecalendar.accesskey;&quot;</span>
<a href="#l6.39"></a><span id="l6.39">                   command=&quot;calendar_delete_calendar_command&quot;</span>
<a href="#l6.40"></a><span id="l6.40">                   observes=&quot;calendar_delete_calendar_command&quot;/&gt;</span>
<a href="#l6.41"></a><span id="l6.41">         &lt;menuseparator id=&quot;ltnBeforeTaskActions&quot;/&gt;</span>
<a href="#l6.42"></a><span id="l6.42">         &lt;menuitem id=&quot;ltnTaskActionsMarkCompletedMenuitem&quot;</span>
<a href="#l6.43"></a><span id="l6.43">                   type=&quot;checkbox&quot;</span>
<a href="#l6.44"></a><span id="l6.44">                   label=&quot;&amp;calendar.context.markcompleted.label;&quot;</span>
<a href="#l6.45"></a><span id="l6.45">                   accesskey=&quot;&amp;calendar.context.markcompleted.accesskey;&quot;</span>
<a href="#l6.46"></a><span id="l6.46">                   command=&quot;calendar_toggle_completed_command&quot;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineat">@@ -696,17 +700,17 @@</span>
<a href="#l6.48"></a><span id="l6.48">               label-month=&quot;&amp;lightning.toolbar.month.label;&quot;</span>
<a href="#l6.49"></a><span id="l6.49">               observes=&quot;calendar_view_prev_command&quot;/&gt;</span>
<a href="#l6.50"></a><span id="l6.50">   &lt;/menupopup&gt;</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52">   &lt;vbox id=&quot;appmenuSecondaryPane&quot;&gt;</span>
<a href="#l6.53"></a><span id="l6.53">     &lt;menu id=&quot;appmenu_Event_Task&quot;</span>
<a href="#l6.54"></a><span id="l6.54">           label=&quot;&amp;lightning.menu.eventtask.label;&quot;</span>
<a href="#l6.55"></a><span id="l6.55">           insertafter=&quot;appmenu_messageMenu&quot;&gt;</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-      &lt;menupopup id=&quot;appmenu_Event_Task_Popup&quot; onpopupshowing=&quot;changeMenuForTask(event)&quot;&gt;</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+      &lt;menupopup id=&quot;appmenu_Event_Task_Popup&quot; onpopupshowing=&quot;changeMenuForTask(event); setupDeleteMenuitem('appmenu_ltnDeleteSelectedCalendar')&quot;&gt;</span>
<a href="#l6.58"></a><span id="l6.58">         &lt;menuitem id=&quot;appmenu_ltnMenuSwitchToCalendar&quot;</span>
<a href="#l6.59"></a><span id="l6.59">                   type=&quot;checkbox&quot;</span>
<a href="#l6.60"></a><span id="l6.60">                   label=&quot;&amp;lightning.toolbar.calendar.label;&quot;</span>
<a href="#l6.61"></a><span id="l6.61">                   command=&quot;switch2calendar&quot;</span>
<a href="#l6.62"></a><span id="l6.62">                   autocheck=&quot;false&quot;&gt;</span>
<a href="#l6.63"></a><span id="l6.63">           &lt;observes element=&quot;modeBroadcaster&quot;</span>
<a href="#l6.64"></a><span id="l6.64">                     attribute=&quot;mode&quot;</span>
<a href="#l6.65"></a><span id="l6.65">                     onbroadcast=&quot;this.parentNode.setAttribute('checked', '' + document.getElementById('modeBroadcaster').getAttribute('mode') == 'calendar')&quot;/&gt;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineat">@@ -730,17 +734,22 @@</span>
<a href="#l6.67"></a><span id="l6.67">                   label=&quot;&amp;calendar.import.label;&quot;</span>
<a href="#l6.68"></a><span id="l6.68">                   command=&quot;calendar_import_command&quot;</span>
<a href="#l6.69"></a><span id="l6.69">                   observes=&quot;calendar_import_command&quot;/&gt;</span>
<a href="#l6.70"></a><span id="l6.70">         &lt;menuitem id=&quot;appmenu_ltnPublishCalendar&quot;</span>
<a href="#l6.71"></a><span id="l6.71">                   label=&quot;&amp;calendar.publish.label;&quot;</span>
<a href="#l6.72"></a><span id="l6.72">                   commmand=&quot;calendar_publish_calendar_command&quot;</span>
<a href="#l6.73"></a><span id="l6.73">                   observes=&quot;calendar_publish_calendar_command&quot;/&gt;</span>
<a href="#l6.74"></a><span id="l6.74">         &lt;menuitem id=&quot;appmenu_ltnDeleteSelectedCalendar&quot;</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-                  label=&quot;&amp;calendar.deletecalendar.label;&quot;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+                  labeldelete=&quot;&amp;calendar.deletecalendar.label;&quot;</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+                  labelremove=&quot;&amp;calendar.removecalendar.label;&quot;</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+                  labelunsubscribe=&quot;&amp;calendar.unsubscribecalendar.label;&quot;</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+                  accesskeydelete=&quot;&amp;calendar.deletecalendar.accesskey;&quot;</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+                  accesskeyremove=&quot;&amp;calendar.removecalendar.accesskey;&quot;</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+                  accesskeyunsubscribe=&quot;&amp;calendar.unsubscribecalendar.accesskey;&quot;</span>
<a href="#l6.82"></a><span id="l6.82">                   command=&quot;calendar_delete_calendar_command&quot;</span>
<a href="#l6.83"></a><span id="l6.83">                   observes=&quot;calendar_delete_calendar_command&quot;/&gt;</span>
<a href="#l6.84"></a><span id="l6.84">         &lt;menuseparator id=&quot;ltnBeforeTaskActions&quot;/&gt;</span>
<a href="#l6.85"></a><span id="l6.85">         &lt;menuitem id=&quot;appmenu_ltnTaskActionsMarkCompletedMenuitem&quot;</span>
<a href="#l6.86"></a><span id="l6.86">                   type=&quot;checkbox&quot;</span>
<a href="#l6.87"></a><span id="l6.87">                   label=&quot;&amp;calendar.context.markcompleted.label;&quot;</span>
<a href="#l6.88"></a><span id="l6.88">                   command=&quot;calendar_toggle_completed_command&quot;</span>
<a href="#l6.89"></a><span id="l6.89">                   observes=&quot;calendar_toggle_completed_command&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/calendar.dtd</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/calendar.dtd</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -227,18 +227,27 @@</span>
<a href="#l7.4"></a><span id="l7.4">      task action buttons --&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> &lt;!ENTITY calendar.taskview.delete.label     &quot;Delete&quot;&gt;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> &lt;!-- Server Context Menu --&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> &lt;!ENTITY calendar.context.newserver.label              &quot;New Calendar&quot;&gt;</span>
<a href="#l7.9"></a><span id="l7.9"> &lt;!ENTITY calendar.context.newserver.accesskey          &quot;N&quot;&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> &lt;!ENTITY calendar.context.findcalendar.label           &quot;Find Calendar&quot; &gt;</span>
<a href="#l7.11"></a><span id="l7.11"> &lt;!ENTITY calendar.context.findcalendar.accesskey       &quot;F&quot; &gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-&lt;!ENTITY calendar.context.deleteserver.label           &quot;Delete Calendar&quot;&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-&lt;!ENTITY calendar.context.deleteserver.accesskey       &quot;D&quot;&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+&lt;!ENTITY calendar.context.deleteserver2.label          &quot;Delete Calendar&quot;&gt;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+&lt;!ENTITY calendar.context.deleteserver2.accesskey      &quot;D&quot;&gt;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+&lt;!-- LOCALIZATION NOTE (calendar.context.removeserver.label): Removing the</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+      calendar is the general action of removing it, while deleting means to</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+      clear the data and unsubscribing means just taking it out of the calendar</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+      list. --&gt;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+&lt;!ENTITY calendar.context.removeserver.label           &quot;Remove Calendar&quot;&gt;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+&lt;!ENTITY calendar.context.removeserver.accesskey       &quot;R&quot;&gt;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+&lt;!ENTITY calendar.context.unsubscribeserver.label      &quot;Unsubscribe Calendar&quot;&gt;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+&lt;!ENTITY calendar.context.unsubscribeserver.accesskey  &quot;U&quot;&gt;</span>
<a href="#l7.25"></a><span id="l7.25"> &lt;!ENTITY calendar.context.synccalendars.label          &quot;Synchronize Calendars&quot;&gt;</span>
<a href="#l7.26"></a><span id="l7.26"> &lt;!ENTITY calendar.context.synccalendars.accesskey      &quot;S&quot;&gt;</span>
<a href="#l7.27"></a><span id="l7.27"> &lt;!ENTITY calendar.context.publish.label                &quot;Publish Calendar&quot;&gt;</span>
<a href="#l7.28"></a><span id="l7.28"> &lt;!ENTITY calendar.context.publish.accesskey            &quot;b&quot;&gt;</span>
<a href="#l7.29"></a><span id="l7.29"> &lt;!ENTITY calendar.context.export.label                 &quot;Export Calendar&quot;&gt;</span>
<a href="#l7.30"></a><span id="l7.30"> &lt;!ENTITY calendar.context.export.accesskey             &quot;E&quot;&gt;</span>
<a href="#l7.31"></a><span id="l7.31"> &lt;!ENTITY calendar.context.properties.label             &quot;Properties&quot;&gt;</span>
<a href="#l7.32"></a><span id="l7.32"> &lt;!ENTITY calendar.context.properties.accesskey         &quot;P&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/calendar.properties</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/calendar.properties</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -80,22 +80,35 @@ unableToCreateProvider=An error was enco</span>
<a href="#l8.4"></a><span id="l8.4"> unknownTimezonesError=An error was encountered preparing the calendar located at %1$S for use. The calendar might refer to unknown timezones. Please install the latest calendar-timezones.xpi.</span>
<a href="#l8.5"></a><span id="l8.5"> missingCalendarTimezonesError=No timezones found! Please install calendar-timezones.xpi.</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> # Sample: Unknown timezone &quot;USPacific&quot; in &quot;Dentist Appt&quot;.  Using the 'floating' local timezone instead: 2008/02/28 14:00:00</span>
<a href="#l8.8"></a><span id="l8.8"> unknownTimezoneInItem=Unknown timezone &quot;%1$S&quot; in &quot;%2$S&quot;.  Treated as 'floating' local timezone instead: %3$S</span>
<a href="#l8.9"></a><span id="l8.9"> TimezoneErrorsAlertTitle=Timezone Errors</span>
<a href="#l8.10"></a><span id="l8.10"> TimezoneErrorsSeeConsole=See Error Console: Unknown timezones are treated as the 'floating' local timezone.</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-unsubscribeCalendarTitle=Unsubscribe from Calendar</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+# The following strings are for the prompt to delete/unsubscribe from the calendar</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+removeCalendarTitle=Remove Calendar</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+removeCalendarButtonDelete=Delete Calendar</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+removeCalendarButtonUnsubscribe=Unsubscribe</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+# LOCALIZATION NOTE (removeCalendarMessageDeleteOrUnsubscribe): Shown for</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+# calendar where both deleting and unsubscribing is possible.</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+# %1$S:  The name of a calendar</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+removeCalendarMessageDeleteOrUnsubscribe=Do you want to remove the calendar &quot;%1$S&quot;? Unsubscribing will remove the calendar from the list, deleting will also permanently purge its data.</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-# LOCALIZATION NOTE (unsubscribeCalendarMessage):</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-# used for an message like 'Are you sure you want to unsubscribe from calendar &quot;Home&quot;?'</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-#    %1$S will be replaced with the name of a calendar</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-unsubscribeCalendarMessage=Are you sure you want to unsubscribe from calendar &quot;%1$S&quot;?</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+# LOCALIZATION NOTE (removeCalendarMessageDelete): Shown for calendar where</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+# deleting is the only option.</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+# %1$S:  The name of a calendar</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+removeCalendarMessageDelete=Do you want to permanently delete the calendar &quot;%1$S&quot;?</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+# LOCALIZATION NOTE (removeCalendarMessageUnsubscribe): Shown for calendar</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+# where unsubscribing is the only option.</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+# %1$S:  The name of a calendar</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+removeCalendarMessageUnsubscribe=Do you want to unsubscribe from the calendar &quot;%1$S&quot;?</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37"> WeekTitle=Week %1$S</span>
<a href="#l8.38"></a><span id="l8.38"> # Used to format the Multiweek's labels, ie Weeks 2 - 7</span>
<a href="#l8.39"></a><span id="l8.39"> WeeksTitle=Weeks %1$S-%2$S</span>
<a href="#l8.40"></a><span id="l8.40"> None=None</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42"> # Error strings</span>
<a href="#l8.43"></a><span id="l8.43"> ## @name UID_NOT_FOUND</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/menuOverlay.dtd</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -15,16 +15,25 @@</span>
<a href="#l9.4"></a><span id="l9.4"> &lt;!ENTITY calendar.export.label                  &quot;Export&quot;&gt;</span>
<a href="#l9.5"></a><span id="l9.5"> &lt;!ENTITY calendar.export.accesskey              &quot;E&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> &lt;!ENTITY calendar.publish.label                 &quot;Publish&quot;&gt;</span>
<a href="#l9.8"></a><span id="l9.8"> &lt;!ENTITY calendar.publish.accesskey             &quot;b&quot;&gt;</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> &lt;!ENTITY calendar.deletecalendar.label          &quot;Delete Selected Calendar&quot;&gt;</span>
<a href="#l9.11"></a><span id="l9.11"> &lt;!ENTITY calendar.deletecalendar.accesskey      &quot;D&quot;&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+&lt;!ENTITY calendar.unsubscribecalendar.label     &quot;Unsubscribe Selected Calendar&quot;&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+&lt;!ENTITY calendar.unsubscribecalendar.accesskey &quot;U&quot;&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+&lt;!-- LOCALIZATION NOTE (calendar.removecalendar.label): Removing the calendar</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+      is the general action of removing it, while deleting means to clear the</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+      data and unsubscribing means just taking it out of the calendar list. --&gt;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+&lt;!ENTITY calendar.removecalendar.label          &quot;Remove Selected Calendar&quot;&gt;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+&lt;!ENTITY calendar.removecalendar.accesskey      &quot;R&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22"> &lt;!ENTITY calendar.menu.customize.label          &quot;Customize&quot;&gt;</span>
<a href="#l9.23"></a><span id="l9.23"> &lt;!ENTITY calendar.menu.customize.accesskey      &quot;C&quot;&gt;</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25"> &lt;!ENTITY showUnifinderCmd.label                 &quot;Find Events&quot;&gt;</span>
<a href="#l9.26"></a><span id="l9.26"> &lt;!ENTITY showUnifinderCmd.accesskey             &quot;F&quot;&gt;</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> &lt;!ENTITY calendar.displaytodos.checkbox.label       &quot;Show Tasks in Calendar&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-migration.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-migration.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -14,18 +14,23 @@ function migrateSelectedCalendars() {</span>
<a href="#l10.4"></a><span id="l10.4">     let listbox = document.getElementById(&quot;calendars-listbox&quot;);</span>
<a href="#l10.5"></a><span id="l10.5">     let calmgr = cal.getCalendarManager();</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">     for (let i = 0; i &lt; listbox.childNodes.length; i++) {</span>
<a href="#l10.8"></a><span id="l10.8">         let item = listbox.childNodes[i];</span>
<a href="#l10.9"></a><span id="l10.9">         if (item.checked) {</span>
<a href="#l10.10"></a><span id="l10.10">             // Migrate the calendar to a gdata calendar</span>
<a href="#l10.11"></a><span id="l10.11">             let newCal = calmgr.createCalendar(&quot;gdata&quot;, item.calendar.uri);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-            calmgr.unregisterCalendar(item.calendar);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-            calmgr.deleteCalendar(item.calendar);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+            if (calmgr.removeCalendar) {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+                // Lightning 4.0+</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+                calmgr.removeCalendar(item.calendar);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+            } else {</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+                calmgr.unregisterCalendar(item.calendar);</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+                calmgr.deleteCalendar(item.calendar);</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+            }</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">             // Copy some properties to the new calendar</span>
<a href="#l10.23"></a><span id="l10.23">             newCal.name = item.calendar.name;</span>
<a href="#l10.24"></a><span id="l10.24">             newCal.setProperty(&quot;color&quot;,</span>
<a href="#l10.25"></a><span id="l10.25">                                item.calendar.getProperty(&quot;color&quot;));</span>
<a href="#l10.26"></a><span id="l10.26">             newCal.setProperty(&quot;disabled&quot;,</span>
<a href="#l10.27"></a><span id="l10.27">                                item.calendar.getProperty(&quot;disabled&quot;));</span>
<a href="#l10.28"></a><span id="l10.28">             newCal.setProperty(&quot;cache.enabled&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -89,16 +89,18 @@ calMemoryCalendar.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">     // calICalendar interface</span>
<a href="#l11.5"></a><span id="l11.5">     //</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">     getProperty: function calMemoryCalendar_getProperty(aName) {</span>
<a href="#l11.8"></a><span id="l11.8">         switch (aName) {</span>
<a href="#l11.9"></a><span id="l11.9">             case &quot;cache.supported&quot;:</span>
<a href="#l11.10"></a><span id="l11.10">             case &quot;requiresNetwork&quot;:</span>
<a href="#l11.11"></a><span id="l11.11">                 return false;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+            case &quot;removemodes&quot;:</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+                return [&quot;delete&quot;];</span>
<a href="#l11.14"></a><span id="l11.14">         }</span>
<a href="#l11.15"></a><span id="l11.15">         return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l11.16"></a><span id="l11.16">     },</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">     // readonly attribute AUTF8String type;</span>
<a href="#l11.19"></a><span id="l11.19">     get type() { return &quot;memory&quot;; },</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">     // void addItem( in calIItemBase aItem, in calIOperationListener aListener );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -133,16 +133,18 @@ calStorageCalendar.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">     //</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">     getProperty: function cSC_getProperty(aName) {</span>
<a href="#l12.7"></a><span id="l12.7">         switch (aName) {</span>
<a href="#l12.8"></a><span id="l12.8">             case &quot;cache.supported&quot;:</span>
<a href="#l12.9"></a><span id="l12.9">                 return false;</span>
<a href="#l12.10"></a><span id="l12.10">             case &quot;requiresNetwork&quot;:</span>
<a href="#l12.11"></a><span id="l12.11">                 return false;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+            case &quot;capabilities.removeModes&quot;:</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                return [&quot;delete&quot;];</span>
<a href="#l12.14"></a><span id="l12.14">         }</span>
<a href="#l12.15"></a><span id="l12.15">         return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l12.16"></a><span id="l12.16">     },</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">     // readonly attribute AUTF8String type;</span>
<a href="#l12.19"></a><span id="l12.19">     get type() { return &quot;storage&quot;; },</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">     // attribute AUTF8String id;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -297,20 +297,19 @@ function back(controller, n){</span>
<a href="#l13.4"></a><span id="l13.4">  * @param name - calendar name</span>
<a href="#l13.5"></a><span id="l13.5">  */</span>
<a href="#l13.6"></a><span id="l13.6"> function deleteCalendars(controller, name){</span>
<a href="#l13.7"></a><span id="l13.7">   let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l13.8"></a><span id="l13.8">                     .getNode().ownerDocument.defaultView;</span>
<a href="#l13.9"></a><span id="l13.9">   let manager = defaultView.getCalendarManager();</span>
<a href="#l13.10"></a><span id="l13.10">   let cals = manager.getCalendars({});</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  for (let i = 0; i &lt; cals.length; i++)</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    if (cals[i].name == name){</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-      manager.unregisterCalendar(cals[i]);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-      manager.deleteCalendar(cals[i]);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+  for (let calendar of manager.getCalendars({})) {</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+    if (calendar.name == name) {</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+      manager.removeCalendar(calendar);</span>
<a href="#l13.19"></a><span id="l13.19">     }</span>
<a href="#l13.20"></a><span id="l13.20"> }</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22"> /**</span>
<a href="#l13.23"></a><span id="l13.23">  * Creates local calendar with given name and select it in calendars list</span>
<a href="#l13.24"></a><span id="l13.24">  * @param controller - Mozmill window controller</span>
<a href="#l13.25"></a><span id="l13.25">  * @param name - calendar name</span>
<a href="#l13.26"></a><span id="l13.26">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -59,28 +59,18 @@ function createEventFromIcalString(icalS</span>
<a href="#l14.4"></a><span id="l14.4"> function createTodoFromIcalString(icalString) {</span>
<a href="#l14.5"></a><span id="l14.5">     var todo = Cc[&quot;@mozilla.org/calendar/todo;1&quot;]</span>
<a href="#l14.6"></a><span id="l14.6">                .createInstance(Ci.calITodo);</span>
<a href="#l14.7"></a><span id="l14.7">     todo.icalString = icalString;</span>
<a href="#l14.8"></a><span id="l14.8">     return todo;</span>
<a href="#l14.9"></a><span id="l14.9"> }</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> function getMemoryCal() {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    // create memory calendar</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    var memoryCalendar = Cc[&quot;@mozilla.org/calendar/calendar;1?type=memory&quot;]</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-                         .createInstance(Ci.calISyncWriteCalendar);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-    // remove existing items</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-    var calendar = memoryCalendar.QueryInterface(Ci.calICalendarProvider);</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-    try {</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-        calendar.deleteCalendar(calendar, null);</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-    } catch (e) {</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-        print(&quot;*** error purging calendar: &quot; + e);</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-    }</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-    return memoryCalendar;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+    return Cc[&quot;@mozilla.org/calendar/calendar;1?type=memory&quot;]</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+             .createInstance(Ci.calISyncWriteCalendar);</span>
<a href="#l14.26"></a><span id="l14.26"> }</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28"> function getStorageCal() {</span>
<a href="#l14.29"></a><span id="l14.29">     // Whenever we get the storage calendar we need to request a profile,</span>
<a href="#l14.30"></a><span id="l14.30">     // otherwise the cleanup functions will not run</span>
<a href="#l14.31"></a><span id="l14.31">     do_get_profile();</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">     // create URI</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineat">@@ -93,24 +83,16 @@ function getStorageCal() {</span>
<a href="#l14.35"></a><span id="l14.35">               .getService(Components.interfaces.calIStartupService)</span>
<a href="#l14.36"></a><span id="l14.36">               .startup(null);</span>
<a href="#l14.37"></a><span id="l14.37"> </span>
<a href="#l14.38"></a><span id="l14.38">     // create storage calendar</span>
<a href="#l14.39"></a><span id="l14.39">     var stor = Cc[&quot;@mozilla.org/calendar/calendar;1?type=storage&quot;]</span>
<a href="#l14.40"></a><span id="l14.40">               .createInstance(Ci.calISyncWriteCalendar);</span>
<a href="#l14.41"></a><span id="l14.41">     stor.uri = uri;</span>
<a href="#l14.42"></a><span id="l14.42">     stor.id = cal.getUUID();</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-    // remove existing items</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-    var calendar = stor.QueryInterface(Ci.calICalendarProvider);</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-    try {</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-        calendar.deleteCalendar(calendar, null);</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-    } catch (e) {</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-        print(&quot;*** error purging calendar: &quot; + e);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-    }</span>
<a href="#l14.51"></a><span id="l14.51">     return stor;</span>
<a href="#l14.52"></a><span id="l14.52"> }</span>
<a href="#l14.53"></a><span id="l14.53"> </span>
<a href="#l14.54"></a><span id="l14.54"> /**</span>
<a href="#l14.55"></a><span id="l14.55">  * Return an item property as string.</span>
<a href="#l14.56"></a><span id="l14.56">  * @param aItem</span>
<a href="#l14.57"></a><span id="l14.57">  * @param string aProp possible item properties: start, end, duration,</span>
<a href="#l14.58"></a><span id="l14.58">  *                     generation, title,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/test/unit/test_calmgr.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/test/unit/test_calmgr.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -10,16 +10,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l15.4"></a><span id="l15.4">  */</span>
<a href="#l15.5"></a><span id="l15.5"> function run_test() {</span>
<a href="#l15.6"></a><span id="l15.6">     do_get_profile();</span>
<a href="#l15.7"></a><span id="l15.7">     // Initialize the floating timezone without actually starting the service.</span>
<a href="#l15.8"></a><span id="l15.8">     cal.getTimezoneService().floating;</span>
<a href="#l15.9"></a><span id="l15.9">     add_test(test_registration);</span>
<a href="#l15.10"></a><span id="l15.10">     add_test(test_calobserver);</span>
<a href="#l15.11"></a><span id="l15.11">     add_test(test_calprefs);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+    add_test(test_removeModes);</span>
<a href="#l15.13"></a><span id="l15.13">     cal.getCalendarManager().startup({ onResult: function() {</span>
<a href="#l15.14"></a><span id="l15.14">         run_next_test();</span>
<a href="#l15.15"></a><span id="l15.15">     }});</span>
<a href="#l15.16"></a><span id="l15.16"> }</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18"> function test_calobserver() {</span>
<a href="#l15.19"></a><span id="l15.19">     function checkCounters(add, modify, del, alladd, allmodify, alldel) {</span>
<a href="#l15.20"></a><span id="l15.20">         equal(calcounter.addItem, add);</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -168,37 +169,87 @@ function test_registration() {</span>
<a href="#l15.22"></a><span id="l15.22">     checkRegistration(false, true, false);</span>
<a href="#l15.23"></a><span id="l15.23">     checkCalendarCount(0, 0, 0);</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">     // The calendar shouldn't be in the list of ids</span>
<a href="#l15.26"></a><span id="l15.26">     equal(calmgr.getCalendarById(memory.id), null);</span>
<a href="#l15.27"></a><span id="l15.27">     ok(calmgr.getCalendars({}).every(function(x) x.id != memory.id));</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">     // And finally delete it</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-    calmgr.deleteCalendar(memory);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+    calmgr.removeCalendar(memory, Ci.calICalendarManager.REMOVE_NO_UNREGISTER);</span>
<a href="#l15.32"></a><span id="l15.32">     checkRegistration(false, false, true);</span>
<a href="#l15.33"></a><span id="l15.33">     checkCalendarCount(0, 0, 0);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35">     // Now remove the observer again</span>
<a href="#l15.36"></a><span id="l15.36">     calmgr.removeObserver(mgrobs);</span>
<a href="#l15.37"></a><span id="l15.37">     memory.removeObserver(calobs);</span>
<a href="#l15.38"></a><span id="l15.38"> </span>
<a href="#l15.39"></a><span id="l15.39">     // Check if removing it actually worked</span>
<a href="#l15.40"></a><span id="l15.40">     calmgr.registerCalendar(memory);</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-    calmgr.unregisterCalendar(memory);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-    calmgr.deleteCalendar(memory);</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+    calmgr.removeCalendar(memory);</span>
<a href="#l15.44"></a><span id="l15.44">     memory.setProperty(&quot;readOnly&quot;, false);</span>
<a href="#l15.45"></a><span id="l15.45">     checkRegistration(false, false, false);</span>
<a href="#l15.46"></a><span id="l15.46">     equal(readOnly, true);</span>
<a href="#l15.47"></a><span id="l15.47">     checkCalendarCount(0, 0, 0);</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">     // We are done now, start the next test</span>
<a href="#l15.50"></a><span id="l15.50">     run_next_test();</span>
<a href="#l15.51"></a><span id="l15.51"> }</span>
<a href="#l15.52"></a><span id="l15.52"> </span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+function test_removeModes() {</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+    function checkCounts(modes, shouldDelete, expectCount, extraFlags=0) {</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+        if (calmgr.calendarCount == baseCalendarCount) {</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+            calmgr.registerCalendar(memory);</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+            equal(calmgr.calendarCount, baseCalendarCount + 1);</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+        }</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+        deleteCalled = false;</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+        removeModes = modes;</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+        calmgr.removeCalendar(memory, extraFlags);</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+        equal(calmgr.calendarCount, baseCalendarCount + expectCount);</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+        equal(deleteCalled, shouldDelete);</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+    }</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+    function mockCalendar(memory) {</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+        let oldGetProperty = memory.wrappedJSObject.getProperty;</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+        memory.wrappedJSObject.getProperty = function(name) {</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+            if (name == &quot;capabilities.removeModes&quot;) {</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+                return removeModes;</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+            } else {</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+                return oldGetProperty.apply(this, arguments);</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+            }</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+        };</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+        let oldDeleteCalendar = memory.wrappedJSObject.deleteCalendar;</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+        memory.wrappedJSObject.deleteCalendar = function(calendar, listener) {</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+            deleteCalled = true;</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+            return oldDeleteCalendar.apply(this, arguments);</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+        };</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+    }</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+    // For better readability</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+    const SHOULD_DELETE = true, SHOULD_NOT_DELETE = false;</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+    const cICM = Components.interfaces.calICalendarManager;</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+    let calmgr = cal.getCalendarManager();</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+    let memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+    let baseCalendarCount = calmgr.calendarCount;</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+    let removeModes = null;</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+    let deleteCalled = false;</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+    mockCalendar(memory);</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+    checkCounts([], SHOULD_NOT_DELETE, 1);</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+    checkCounts([&quot;unsubscribe&quot;], SHOULD_NOT_DELETE, 0);</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+    checkCounts([&quot;unsubscribe&quot;, &quot;delete&quot;], SHOULD_DELETE, 0);</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+    checkCounts([&quot;unsubscribe&quot;, &quot;delete&quot;], SHOULD_NOT_DELETE, 0, cICM.REMOVE_NO_DELETE);</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineplus">+    checkCounts([&quot;delete&quot;], SHOULD_DELETE, 0);</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineplus">+    run_next_test();</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+}</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+</span>
<a href="#l15.104"></a><span id="l15.104"> function test_calprefs() {</span>
<a href="#l15.105"></a><span id="l15.105">     let prop;</span>
<a href="#l15.106"></a><span id="l15.106">     let calmgr = cal.getCalendarManager();</span>
<a href="#l15.107"></a><span id="l15.107">     let memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l15.108"></a><span id="l15.108">     calmgr.registerCalendar(memory);</span>
<a href="#l15.109"></a><span id="l15.109">     let memid = memory.id;</span>
<a href="#l15.110"></a><span id="l15.110"> </span>
<a href="#l15.111"></a><span id="l15.111">     // First set a few values, one of each relevant type</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

