<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20020:505ce0057efd730944a3b6e815d39177c6baf59f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 505ce0057efd730944a3b6e815d39177c6baf59f" />
<meta property="og:url" content="/comm-central/rev/505ce0057efd730944a3b6e815d39177c6baf59f" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable curly rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 505ce0057efd730944a3b6e815d39177c6baf59f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/505ce0057efd730944a3b6e815d39177c6baf59f">shortlog</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/505ce0057efd730944a3b6e815d39177c6baf59f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f">files</a> |
changeset |
<a href="/comm-central/raw-rev/505ce0057efd730944a3b6e815d39177c6baf59f">raw</a>  | <a href="/comm-central/archive/505ce0057efd730944a3b6e815d39177c6baf59f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable curly rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 11:16:13 +0200</td></tr>

<tr>
 <td>changeset 20020</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/505ce0057efd730944a3b6e815d39177c6baf59f">505ce0057efd730944a3b6e815d39177c6baf59f</a></td>
</tr>



<tr>
<td>parent 20019</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d56d639677139ede62ac3c3736e23c7a05aeee42">d56d639677139ede62ac3c3736e23c7a05aeee42</a>
</td>
</tr>

<tr>
<td>child 20021</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4d3dd4462739e7233fe2e5bc6fe8403f871c04f6">4d3dd4462739e7233fe2e5bc6fe8403f871c04f6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=505ce0057efd730944a3b6e815d39177c6baf59f">12289</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Thu, 15 Sep 2016 22:59:22 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@239f769da6b3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=239f769da6b375beb31a149046382429f59af6ae">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=239f769da6b375beb31a149046382429f59af6ae&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=239f769da6b375beb31a149046382429f59af6ae&newProject=comm-central&newRevision=505ce0057efd730944a3b6e815d39177c6baf59f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=239f769da6b375beb31a149046382429f59af6ae&newProject=comm-central&newRevision=505ce0057efd730944a3b6e815d39177c6baf59f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=239f769da6b375beb31a149046382429f59af6ae&newProject=comm-central&newRevision=505ce0057efd730944a3b6e815d39177c6baf59f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable curly rule. r=MakeMyDay

MozReview-Commit-ID: L1nKra4eTVu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/backend/icaljs/calRecurrenceRule.js">calendar/base/backend/icaljs/calRecurrenceRule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/backend/icaljs/calRecurrenceRule.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/backend/icaljs/calRecurrenceRule.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/backend/icaljs/calRecurrenceRule.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/backend/icaljs/calRecurrenceRule.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/backend/icaljs/calRecurrenceRule.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-daypicker.xml">calendar/base/content/calendar-daypicker.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-daypicker.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-daypicker.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-daypicker.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-daypicker.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-daypicker.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-alarm-dialog.js">calendar/base/content/dialogs/calendar-alarm-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-alarm-dialog.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-alarm-dialog.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-alarm-dialog.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-alarm-dialog.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-alarm-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-properties-dialog.js">calendar/base/content/dialogs/calendar-properties-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-properties-dialog.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-properties-dialog.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-properties-dialog.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-properties-dialog.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/dialogs/calendar-properties-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/preferences/categories.js">calendar/base/content/preferences/categories.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/preferences/categories.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/preferences/categories.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/preferences/categories.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/preferences/categories.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/preferences/categories.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calPrintUtils.jsm">calendar/base/modules/calPrintUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calPrintUtils.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calPrintUtils.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calPrintUtils.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calPrintUtils.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calPrintUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calViewUtils.jsm">calendar/base/modules/calViewUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calViewUtils.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calViewUtils.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calViewUtils.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calViewUtils.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calViewUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calXMLUtils.jsm">calendar/base/modules/calXMLUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calXMLUtils.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calXMLUtils.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calXMLUtils.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calXMLUtils.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/modules/calXMLUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarm.js">calendar/base/src/calAlarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarm.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarm.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarm.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarm.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDateTimeFormatter.js">calendar/base/src/calDateTimeFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDateTimeFormatter.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDateTimeFormatter.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDateTimeFormatter.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDateTimeFormatter.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDateTimeFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDeletedItems.js">calendar/base/src/calDeletedItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDeletedItems.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDeletedItems.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDeletedItems.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDeletedItems.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calDeletedItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calEvent.js">calendar/base/src/calEvent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calEvent.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calEvent.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calEvent.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calEvent.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calEvent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTodo.js">calendar/base/src/calTodo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTodo.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTodo.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTodo.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTodo.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calTodo.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calMonthGridPrinter.js">calendar/import-export/calMonthGridPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calMonthGridPrinter.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calMonthGridPrinter.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calMonthGridPrinter.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calMonthGridPrinter.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calMonthGridPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calWeekPrinter.js">calendar/import-export/calWeekPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calWeekPrinter.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calWeekPrinter.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calWeekPrinter.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calWeekPrinter.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/import-export/calWeekPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageHelpers.jsm">calendar/providers/storage/calStorageHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageHelpers.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageHelpers.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapErrors.js">calendar/providers/wcap/calWcapErrors.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapErrors.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapErrors.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapErrors.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapErrors.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapErrors.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/calendarCreation.js">calendar/resources/content/calendarCreation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/calendarCreation.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/calendarCreation.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/calendarCreation.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/calendarCreation.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/calendarCreation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publishDialog.js">calendar/resources/content/publishDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publishDialog.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publishDialog.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publishDialog.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publishDialog.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/resources/content/publishDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/testTodayPane.js">calendar/test/mozmill/testTodayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/testTodayPane.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/testTodayPane.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/testTodayPane.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/testTodayPane.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/testTodayPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_calmgr.js">calendar/test/unit/test_calmgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_calmgr.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_calmgr.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_calmgr.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_calmgr.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_calmgr.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_hashedarray.js">calendar/test/unit/test_hashedarray.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_hashedarray.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_hashedarray.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_hashedarray.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_hashedarray.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_hashedarray.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_parser.js">calendar/test/unit/test_ics_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_parser.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_parser.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_parser.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_parser.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_parser.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_rfc3339_parser.js">calendar/test/unit/test_rfc3339_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_rfc3339_parser.js">file</a> |
<a href="/comm-central/annotate/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_rfc3339_parser.js">annotate</a> |
<a href="/comm-central/diff/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_rfc3339_parser.js">diff</a> |
<a href="/comm-central/comparison/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_rfc3339_parser.js">comparison</a> |
<a href="/comm-central/log/505ce0057efd730944a3b6e815d39177c6baf59f/calendar/test/unit/test_rfc3339_parser.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -14,16 +14,19 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &quot;comma-dangle&quot;: 0,</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     // Enforce spacing before and after comma</span>
<a href="#l1.7"></a><span id="l1.7">     &quot;comma-spacing&quot;: [2, {&quot;before&quot;: false, &quot;after&quot;: true}],</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Enforce one true comma style.</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;comma-style&quot;: [2, &quot;last&quot;],</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Enforce curly brace conventions for all control statements.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;curly&quot;: 2,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // Enforce the spacing around the * in generator functions.</span>
<a href="#l1.16"></a><span id="l1.16">     &quot;generator-star-spacing&quot;: [2, &quot;after&quot;],</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18">     // Disallow deletion of variables (deleting properties is fine).</span>
<a href="#l1.19"></a><span id="l1.19">     &quot;no-delete-var&quot;: 2,</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">     // Disallow duplicate arguments in functions.</span>
<a href="#l1.22"></a><span id="l1.22">     &quot;no-dupe-args&quot;: 2,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calRecurrenceRule.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calRecurrenceRule.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -159,17 +159,19 @@ calRecurrenceRule.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">                 }</span>
<a href="#l2.5"></a><span id="l2.5">                 if (match[1] == '-') {</span>
<a href="#l2.6"></a><span id="l2.6">                     // Week numbers are counted back from the end of the period.</span>
<a href="#l2.7"></a><span id="l2.7">                     values[i] *= -1;</span>
<a href="#l2.8"></a><span id="l2.8">                 }</span>
<a href="#l2.9"></a><span id="l2.9">             }</span>
<a href="#l2.10"></a><span id="l2.10">         }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        if (aCount) aCount.value = values.length;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        if (aCount) {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+            aCount.value = values.length;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+        }</span>
<a href="#l2.16"></a><span id="l2.16">         return values;</span>
<a href="#l2.17"></a><span id="l2.17">     },</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">     setComponent: function(aType, aCount, aValues) {</span>
<a href="#l2.20"></a><span id="l2.20">         let values = aValues;</span>
<a href="#l2.21"></a><span id="l2.21">         if (aType == &quot;BYDAY&quot;) {</span>
<a href="#l2.22"></a><span id="l2.22">             // BYDAY values are alphanumeric: SU, MO, TU, etc..</span>
<a href="#l2.23"></a><span id="l2.23">             for (let i = 0; i &lt; values.length; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -348,18 +348,19 @@</span>
<a href="#l3.4"></a><span id="l3.4">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l3.5"></a><span id="l3.5">       &lt;/property&gt;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">       &lt;property name=&quot;displayCalendar&quot;&gt;</span>
<a href="#l3.8"></a><span id="l3.8">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l3.9"></a><span id="l3.9">           return this.mCalendar;</span>
<a href="#l3.10"></a><span id="l3.10">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l3.11"></a><span id="l3.11">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-          if (this.mCalendar)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+          if (this.mCalendar) {</span>
<a href="#l3.14"></a><span id="l3.14">               this.mCalendar.removeObserver(this.mObserver);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+          }</span>
<a href="#l3.16"></a><span id="l3.16">           this.mCalendar = val;</span>
<a href="#l3.17"></a><span id="l3.17">           this.mCalendar.addObserver(this.mObserver);</span>
<a href="#l3.18"></a><span id="l3.18">           this.refresh();</span>
<a href="#l3.19"></a><span id="l3.19">           return val;</span>
<a href="#l3.20"></a><span id="l3.20">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l3.21"></a><span id="l3.21">       &lt;/property&gt;</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">       &lt;property name=&quot;initialized&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -127,18 +127,19 @@ var calendarController = {</span>
<a href="#l4.4"></a><span id="l4.4">                  // This code is temporarily commented out due to</span>
<a href="#l4.5"></a><span id="l4.5">                  // bug 469684 Unifinder-todo: raising of the context menu fires blur-event</span>
<a href="#l4.6"></a><span id="l4.6">                  // this.todo_tasktree_focused;</span>
<a href="#l4.7"></a><span id="l4.7">             case &quot;calendar_edit_calendar_command&quot;:</span>
<a href="#l4.8"></a><span id="l4.8">                 return this.isCalendarInForeground();</span>
<a href="#l4.9"></a><span id="l4.9">             case &quot;calendar_task_filter_command&quot;:</span>
<a href="#l4.10"></a><span id="l4.10">                 return true;</span>
<a href="#l4.11"></a><span id="l4.11">             case &quot;calendar_delete_todo_command&quot;:</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                if (!CalendarDeleteCommandEnabled)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                if (!CalendarDeleteCommandEnabled) {</span>
<a href="#l4.14"></a><span id="l4.14">                     return false;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+                }</span>
<a href="#l4.16"></a><span id="l4.16">             case &quot;calendar_toggle_completed_command&quot;:</span>
<a href="#l4.17"></a><span id="l4.17">             case &quot;calendar_percentComplete-0_command&quot;:</span>
<a href="#l4.18"></a><span id="l4.18">             case &quot;calendar_percentComplete-25_command&quot;:</span>
<a href="#l4.19"></a><span id="l4.19">             case &quot;calendar_percentComplete-50_command&quot;:</span>
<a href="#l4.20"></a><span id="l4.20">             case &quot;calendar_percentComplete-75_command&quot;:</span>
<a href="#l4.21"></a><span id="l4.21">             case &quot;calendar_percentComplete-100_command&quot;:</span>
<a href="#l4.22"></a><span id="l4.22">             case &quot;calendar_priority-0_command&quot;:</span>
<a href="#l4.23"></a><span id="l4.23">             case &quot;calendar_priority-9_command&quot;:</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -886,26 +887,30 @@ function calendarUpdateNewItemsCommand()</span>
<a href="#l4.25"></a><span id="l4.25">     let taskCommands = [&quot;calendar_new_todo_command&quot;,</span>
<a href="#l4.26"></a><span id="l4.26">                         &quot;calendar_new_todo_context_command&quot;,</span>
<a href="#l4.27"></a><span id="l4.27">                         &quot;calendar_new_todo_todaypane_command&quot;];</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">     // re-calculate command status</span>
<a href="#l4.30"></a><span id="l4.30">     CalendarNewEventsCommandEnabled = false;</span>
<a href="#l4.31"></a><span id="l4.31">     CalendarNewTasksCommandEnabled = false;</span>
<a href="#l4.32"></a><span id="l4.32">     let calendars = cal.getCalendarManager().getCalendars({}).filter(cal.isCalendarWritable).filter(userCanAddItemsToCalendar);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-    if (calendars.some(cal.isEventCalendar))</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+    if (calendars.some(cal.isEventCalendar)) {</span>
<a href="#l4.35"></a><span id="l4.35">         CalendarNewEventsCommandEnabled = true;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-    if (calendars.some(cal.isTaskCalendar))</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+    }</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+    if (calendars.some(cal.isTaskCalendar)) {</span>
<a href="#l4.39"></a><span id="l4.39">         CalendarNewTasksCommandEnabled = true;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+    }</span>
<a href="#l4.41"></a><span id="l4.41"> </span>
<a href="#l4.42"></a><span id="l4.42">     // update command status if required</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-    if (CalendarNewEventsCommandEnabled != oldEventValue)</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+    if (CalendarNewEventsCommandEnabled != oldEventValue) {</span>
<a href="#l4.45"></a><span id="l4.45">         eventCommands.forEach(goUpdateCommand);</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-    if (CalendarNewTasksCommandEnabled != oldTaskValue)</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+    }</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+    if (CalendarNewTasksCommandEnabled != oldTaskValue) {</span>
<a href="#l4.49"></a><span id="l4.49">         taskCommands.forEach(goUpdateCommand);</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    }</span>
<a href="#l4.51"></a><span id="l4.51"> }</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53"> function calendarUpdateDeleteCommand(selectedItems) {</span>
<a href="#l4.54"></a><span id="l4.54">     let oldValue = CalendarDeleteCommandEnabled;</span>
<a href="#l4.55"></a><span id="l4.55">     CalendarDeleteCommandEnabled = (selectedItems.length &gt; 0);</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57">     /* we must disable &quot;delete&quot; when at least one item cannot be deleted */</span>
<a href="#l4.58"></a><span id="l4.58">     for (let item of selectedItems) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -103,18 +103,19 @@</span>
<a href="#l5.4"></a><span id="l5.4">               document.getAnonymousElementByAttribute(</span>
<a href="#l5.5"></a><span id="l5.5">                   this, &quot;anonid&quot;, &quot;mainbox&quot;);</span>
<a href="#l5.6"></a><span id="l5.6">           var numChilds = mainbox.childNodes.length;</span>
<a href="#l5.7"></a><span id="l5.7">           var days = [];</span>
<a href="#l5.8"></a><span id="l5.8">           for (var i = 0; i &lt; numChilds; i++) {</span>
<a href="#l5.9"></a><span id="l5.9">               var child = mainbox.childNodes[i];</span>
<a href="#l5.10"></a><span id="l5.10">               if (child.getAttribute(&quot;checked&quot;) == &quot;true&quot;) {</span>
<a href="#l5.11"></a><span id="l5.11">                   var index = i + this.weekStartOffset;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                  if (index &gt;= 7)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                  index -= 7;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+                  if (index &gt;= 7) {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                      index -= 7;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+                  }</span>
<a href="#l5.17"></a><span id="l5.17">                   days.push(index + 1);</span>
<a href="#l5.18"></a><span id="l5.18">               }</span>
<a href="#l5.19"></a><span id="l5.19">           }</span>
<a href="#l5.20"></a><span id="l5.20">           return days;</span>
<a href="#l5.21"></a><span id="l5.21">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.22"></a><span id="l5.22">       &lt;/property&gt;</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">       &lt;constructor&gt;&lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -246,24 +246,28 @@ var calendarExtract = {</span>
<a href="#l6.4"></a><span id="l6.4">             contextEventDisabled = true;</span>
<a href="#l6.5"></a><span id="l6.5">         }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">         if (newTask.getAttribute(&quot;disabled&quot;) == &quot;true&quot;) {</span>
<a href="#l6.8"></a><span id="l6.8">             taskDisabled = true;</span>
<a href="#l6.9"></a><span id="l6.9">             contextTaskDisabled = true;</span>
<a href="#l6.10"></a><span id="l6.10">         }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        if (eventButton)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        if (eventButton) {</span>
<a href="#l6.14"></a><span id="l6.14">             eventButton.disabled = eventDisabled;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-        if (taskButton)</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+        }</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+        if (taskButton) {</span>
<a href="#l6.18"></a><span id="l6.18">             taskButton.disabled = taskDisabled;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-        if (hdrEventButton)</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+        }</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+        if (hdrEventButton) {</span>
<a href="#l6.22"></a><span id="l6.22">             hdrEventButton.disabled = eventDisabled;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-        if (hdrTaskButton)</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+        }</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+        if (hdrTaskButton) {</span>
<a href="#l6.26"></a><span id="l6.26">             hdrTaskButton.disabled = taskDisabled;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+        }</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">         contextMenuEvent.disabled = contextEventDisabled;</span>
<a href="#l6.30"></a><span id="l6.30">         contextMenuTask.disabled = contextTaskDisabled;</span>
<a href="#l6.31"></a><span id="l6.31"> </span>
<a href="#l6.32"></a><span id="l6.32">         contextMenu.disabled = contextEventDisabled &amp;&amp; contextTaskDisabled;</span>
<a href="#l6.33"></a><span id="l6.33">     }</span>
<a href="#l6.34"></a><span id="l6.34"> };</span>
<a href="#l6.35"></a><span id="l6.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -154,20 +154,21 @@</span>
<a href="#l7.4"></a><span id="l7.4">           var sel = this.getAttribute(&quot;selected&quot;);</span>
<a href="#l7.5"></a><span id="l7.5">           if (sel &amp;&amp; sel == &quot;true&quot;) {</span>
<a href="#l7.6"></a><span id="l7.6">             return true;</span>
<a href="#l7.7"></a><span id="l7.7">           }</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">           return false;</span>
<a href="#l7.10"></a><span id="l7.10">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l7.11"></a><span id="l7.11">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-          if (val)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+          if (val) {</span>
<a href="#l7.14"></a><span id="l7.14">             this.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-          else</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+          } else {</span>
<a href="#l7.17"></a><span id="l7.17">             this.removeAttribute(&quot;selected&quot;);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+          }</span>
<a href="#l7.19"></a><span id="l7.19">           return val;</span>
<a href="#l7.20"></a><span id="l7.20">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l7.21"></a><span id="l7.21">       &lt;/property&gt;</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23">       &lt;property name=&quot;dayitems&quot;&gt;</span>
<a href="#l7.24"></a><span id="l7.24">         &lt;getter&gt;return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;day-items&quot;);&lt;/getter&gt;</span>
<a href="#l7.25"></a><span id="l7.25">       &lt;/property&gt;</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27" class="difflineat">@@ -306,18 +307,19 @@</span>
<a href="#l7.28"></a><span id="l7.28">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.29"></a><span id="l7.29">       &lt;/method&gt;</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">     &lt;/implementation&gt;</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33">     &lt;handlers&gt;</span>
<a href="#l7.34"></a><span id="l7.34">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l7.35"></a><span id="l7.35">         event.stopPropagation();</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-        if (this.mDate)</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+        if (this.mDate) {</span>
<a href="#l7.38"></a><span id="l7.38">           this.calendarView.selectedDay = this.mDate;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+        }</span>
<a href="#l7.40"></a><span id="l7.40">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l7.41"></a><span id="l7.41">       &lt;handler event=&quot;dblclick&quot;&gt;&lt;![CDATA[</span>
<a href="#l7.42"></a><span id="l7.42">         event.stopPropagation();</span>
<a href="#l7.43"></a><span id="l7.43">         this.calendarView.controller.createNewEvent();</span>
<a href="#l7.44"></a><span id="l7.44">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l7.45"></a><span id="l7.45">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l7.46"></a><span id="l7.46">         if (!(event.ctrlKey || event.metaKey)) {</span>
<a href="#l7.47"></a><span id="l7.47">           this.calendarView.setSelectedItems(0, []);</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineat">@@ -443,24 +445,22 @@</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50">       &lt;field name=&quot;mClickedTime&quot;&gt;null&lt;/field&gt;</span>
<a href="#l7.51"></a><span id="l7.51"> </span>
<a href="#l7.52"></a><span id="l7.52">       &lt;!-- other methods --&gt;</span>
<a href="#l7.53"></a><span id="l7.53">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l7.54"></a><span id="l7.54">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l7.55"></a><span id="l7.55">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l7.56"></a><span id="l7.56">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-          var needsrelayout = false;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-          if (aAttr == &quot;context&quot; || aAttr == &quot;item-context&quot;)</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-              needsrelayout = true;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+          let needsrelayout = (aAttr == &quot;context&quot; || aAttr == &quot;item-context&quot;);</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+          let ret = XULElement.prototype.setAttribute.call (this, aAttr, aVal);</span>
<a href="#l7.62"></a><span id="l7.62"> </span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-          var ret = XULElement.prototype.setAttribute.call (this, aAttr, aVal);</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-          if (needsrelayout)</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+          if (needsrelayout) {</span>
<a href="#l7.67"></a><span id="l7.67">               this.relayout();</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+          }</span>
<a href="#l7.69"></a><span id="l7.69"> </span>
<a href="#l7.70"></a><span id="l7.70">           return ret;</span>
<a href="#l7.71"></a><span id="l7.71">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.72"></a><span id="l7.72">       &lt;/method&gt;</span>
<a href="#l7.73"></a><span id="l7.73"> </span>
<a href="#l7.74"></a><span id="l7.74">       &lt;!-- calICalendarView --&gt;</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76">       &lt;property name=&quot;supportsDisjointDates&quot; readonly=&quot;true&quot;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineat">@@ -576,24 +576,26 @@</span>
<a href="#l7.78"></a><span id="l7.78"> </span>
<a href="#l7.79"></a><span id="l7.79">       &lt;method name=&quot;centerSelectedItems&quot;&gt;</span>
<a href="#l7.80"></a><span id="l7.80">         &lt;body&gt;</span>
<a href="#l7.81"></a><span id="l7.81">         &lt;/body&gt;</span>
<a href="#l7.82"></a><span id="l7.82">       &lt;/method&gt;</span>
<a href="#l7.83"></a><span id="l7.83"> </span>
<a href="#l7.84"></a><span id="l7.84">       &lt;property name=&quot;selectedDay&quot;&gt;</span>
<a href="#l7.85"></a><span id="l7.85">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-          if (this.mSelectedDayBox)</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+          if (this.mSelectedDayBox) {</span>
<a href="#l7.88"></a><span id="l7.88">             return this.mSelectedDayBox.date.clone();</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+          }</span>
<a href="#l7.90"></a><span id="l7.90"> </span>
<a href="#l7.91"></a><span id="l7.91">           return null;</span>
<a href="#l7.92"></a><span id="l7.92">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l7.93"></a><span id="l7.93">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-          if (this.mSelectedDayBox)</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+          if (this.mSelectedDayBox) {</span>
<a href="#l7.96"></a><span id="l7.96">             this.mSelectedDayBox.selected = false;</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+          }</span>
<a href="#l7.98"></a><span id="l7.98"> </span>
<a href="#l7.99"></a><span id="l7.99">           var realVal = val;</span>
<a href="#l7.100"></a><span id="l7.100">           if (!realVal.isDate) {</span>
<a href="#l7.101"></a><span id="l7.101">             realVal = val.clone();</span>
<a href="#l7.102"></a><span id="l7.102">             realVal.isDate = true;</span>
<a href="#l7.103"></a><span id="l7.103">           }</span>
<a href="#l7.104"></a><span id="l7.104">           let box = this.findDayBoxForDate(realVal);</span>
<a href="#l7.105"></a><span id="l7.105">           if (box) {</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineat">@@ -933,18 +935,19 @@</span>
<a href="#l7.107"></a><span id="l7.107"> </span>
<a href="#l7.108"></a><span id="l7.108">       &lt;method name=&quot;findDayBoxForDate&quot;&gt;</span>
<a href="#l7.109"></a><span id="l7.109">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l7.110"></a><span id="l7.110">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.111"></a><span id="l7.111">           if (!this.mDateBoxes) {</span>
<a href="#l7.112"></a><span id="l7.112">             return null;</span>
<a href="#l7.113"></a><span id="l7.113">           }</span>
<a href="#l7.114"></a><span id="l7.114">           for (let box of this.mDateBoxes) {</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineminus">-            if (box.mDate.compare(aDate) == 0)</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+            if (box.mDate.compare(aDate) == 0) {</span>
<a href="#l7.117"></a><span id="l7.117">               return box;</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+            }</span>
<a href="#l7.119"></a><span id="l7.119">           }</span>
<a href="#l7.120"></a><span id="l7.120">           return null;</span>
<a href="#l7.121"></a><span id="l7.121">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.122"></a><span id="l7.122">       &lt;/method&gt;</span>
<a href="#l7.123"></a><span id="l7.123"> </span>
<a href="#l7.124"></a><span id="l7.124">       &lt;method name=&quot;findDayBoxesForItem&quot;&gt;</span>
<a href="#l7.125"></a><span id="l7.125">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l7.126"></a><span id="l7.126">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineat">@@ -959,18 +962,19 @@</span>
<a href="#l7.128"></a><span id="l7.128">           } else if (cal.isToDo(aItem)) {</span>
<a href="#l7.129"></a><span id="l7.129">               // Consider tasks without entry OR due date.</span>
<a href="#l7.130"></a><span id="l7.130">               if (aItem.entryDate || aItem.dueDate) {</span>
<a href="#l7.131"></a><span id="l7.131">                   targetDate = (aItem.entryDate || aItem.dueDate).getInTimezone(this.mTimezone);</span>
<a href="#l7.132"></a><span id="l7.132">                   finishDate = (aItem.dueDate || aItem.entryDate).getInTimezone(this.mTimezone);</span>
<a href="#l7.133"></a><span id="l7.133">               }</span>
<a href="#l7.134"></a><span id="l7.134">           }</span>
<a href="#l7.135"></a><span id="l7.135"> </span>
<a href="#l7.136"></a><span id="l7.136" class="difflineminus">-          if (!targetDate)</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-            return boxes;</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+          if (!targetDate) {</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+              return boxes;</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineplus">+          }</span>
<a href="#l7.141"></a><span id="l7.141"> </span>
<a href="#l7.142"></a><span id="l7.142">           if (!finishDate) {</span>
<a href="#l7.143"></a><span id="l7.143">             let maybeBox = this.findDayBoxForDate(targetDate);</span>
<a href="#l7.144"></a><span id="l7.144">             if (maybeBox) {</span>
<a href="#l7.145"></a><span id="l7.145">               boxes.push(maybeBox);</span>
<a href="#l7.146"></a><span id="l7.146">             }</span>
<a href="#l7.147"></a><span id="l7.147">             return boxes;</span>
<a href="#l7.148"></a><span id="l7.148">           }</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineat">@@ -1005,41 +1009,43 @@</span>
<a href="#l7.150"></a><span id="l7.150"> 	]]&gt;&lt;/body&gt;</span>
<a href="#l7.151"></a><span id="l7.151">       &lt;/method&gt;</span>
<a href="#l7.152"></a><span id="l7.152"> </span>
<a href="#l7.153"></a><span id="l7.153">       &lt;method name=&quot;doAddItem&quot;&gt;</span>
<a href="#l7.154"></a><span id="l7.154">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l7.155"></a><span id="l7.155">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.156"></a><span id="l7.156">           let boxes = this.findDayBoxesForItem(aItem);</span>
<a href="#l7.157"></a><span id="l7.157"> </span>
<a href="#l7.158"></a><span id="l7.158" class="difflineminus">-          if (!boxes.length)</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-            return;</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+          if (!boxes.length) {</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineplus">+              return;</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+          }</span>
<a href="#l7.163"></a><span id="l7.163"> </span>
<a href="#l7.164"></a><span id="l7.164">           for (let box of boxes) {</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-            box.addItem(aItem);</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineplus">+              box.addItem(aItem);</span>
<a href="#l7.167"></a><span id="l7.167">           }</span>
<a href="#l7.168"></a><span id="l7.168">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.169"></a><span id="l7.169">       &lt;/method&gt;</span>
<a href="#l7.170"></a><span id="l7.170"> </span>
<a href="#l7.171"></a><span id="l7.171">       &lt;method name=&quot;doDeleteItem&quot;&gt;</span>
<a href="#l7.172"></a><span id="l7.172">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l7.173"></a><span id="l7.173">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.174"></a><span id="l7.174">           let boxes = this.findDayBoxesForItem(aItem);</span>
<a href="#l7.175"></a><span id="l7.175"> </span>
<a href="#l7.176"></a><span id="l7.176" class="difflineminus">-          if (!boxes.length)</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineminus">-            return;</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineplus">+          if (!boxes.length) {</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineplus">+              return;</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+          }</span>
<a href="#l7.181"></a><span id="l7.181"> </span>
<a href="#l7.182"></a><span id="l7.182">           function isNotItem(a) {</span>
<a href="#l7.183"></a><span id="l7.183">               return (a.hashId != aItem.hashId);</span>
<a href="#l7.184"></a><span id="l7.184">           }</span>
<a href="#l7.185"></a><span id="l7.185">           var oldLength = this.mSelectedItems.length;</span>
<a href="#l7.186"></a><span id="l7.186">           this.mSelectedItems = this.mSelectedItems.filter(isNotItem);</span>
<a href="#l7.187"></a><span id="l7.187"> </span>
<a href="#l7.188"></a><span id="l7.188">           for (let box of boxes) {</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineminus">-            box.deleteItem(aItem);</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineplus">+              box.deleteItem(aItem);</span>
<a href="#l7.191"></a><span id="l7.191">           }</span>
<a href="#l7.192"></a><span id="l7.192"> </span>
<a href="#l7.193"></a><span id="l7.193">           // If a deleted event was selected, we need to announce that the</span>
<a href="#l7.194"></a><span id="l7.194">           // selection changed.</span>
<a href="#l7.195"></a><span id="l7.195">           if (oldLength != this.mSelectedItems.length) {</span>
<a href="#l7.196"></a><span id="l7.196">               this.fireEvent(&quot;itemselect&quot;, this.mSelectedItems);</span>
<a href="#l7.197"></a><span id="l7.197">           }</span>
<a href="#l7.198"></a><span id="l7.198">         ]]&gt;&lt;/body&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -68,18 +68,19 @@</span>
<a href="#l8.4"></a><span id="l8.4">       &lt;/method&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l8.7"></a><span id="l8.7">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l8.8"></a><span id="l8.8">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l8.9"></a><span id="l8.9">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.10"></a><span id="l8.10">           var needsrelayout = false;</span>
<a href="#l8.11"></a><span id="l8.11">           if (aAttr == &quot;orient&quot;) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-              if (this.getAttribute(&quot;orient&quot;) != aVal)</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+              if (this.getAttribute(&quot;orient&quot;) != aVal) {</span>
<a href="#l8.14"></a><span id="l8.14">                   needsrelayout = true;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+              }</span>
<a href="#l8.16"></a><span id="l8.16">           }</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">           // this should be done using lookupMethod(), see bug 286629</span>
<a href="#l8.19"></a><span id="l8.19">           var ret = XULElement.prototype.setAttribute.call (this, aAttr, aVal);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">           if (needsrelayout) {</span>
<a href="#l8.22"></a><span id="l8.22">               this.relayout();</span>
<a href="#l8.23"></a><span id="l8.23">           }</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineat">@@ -116,35 +117,38 @@</span>
<a href="#l8.25"></a><span id="l8.25">               label.setAttribute(&quot;value&quot;, timestr);</span>
<a href="#l8.26"></a><span id="l8.26">               label.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">               box.appendChild(label);</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">               return box;</span>
<a href="#l8.31"></a><span id="l8.31">           }</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-          while (topbox.hasChildNodes())</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+          while (topbox.hasChildNodes()) {</span>
<a href="#l8.35"></a><span id="l8.35">               topbox.lastChild.remove();</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+          }</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">           var formatter = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;].</span>
<a href="#l8.39"></a><span id="l8.39">                           getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l8.40"></a><span id="l8.40">           var timeString;</span>
<a href="#l8.41"></a><span id="l8.41">           var theMin = this.mStartMin;</span>
<a href="#l8.42"></a><span id="l8.42">           var theHour = Math.floor(theMin / 60);</span>
<a href="#l8.43"></a><span id="l8.43">           var durLeft = this.mEndMin - this.mStartMin;</span>
<a href="#l8.44"></a><span id="l8.44"> </span>
<a href="#l8.45"></a><span id="l8.45">           while (durLeft &gt; 0) {</span>
<a href="#l8.46"></a><span id="l8.46">               var dur;</span>
<a href="#l8.47"></a><span id="l8.47">               if (this.mEndMin - theMin &lt; 60) {</span>
<a href="#l8.48"></a><span id="l8.48">                   dur = this.mEndMin - theMin;</span>
<a href="#l8.49"></a><span id="l8.49">               } else {</span>
<a href="#l8.50"></a><span id="l8.50">                   dur = theMin % 60;</span>
<a href="#l8.51"></a><span id="l8.51">               }</span>
<a href="#l8.52"></a><span id="l8.52">               theMin += dur;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-              if (dur == 0) dur = 60;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+              if (dur == 0) {</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+                  dur = 60;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+              }</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58">               // calculate duration pixel as the difference between</span>
<a href="#l8.59"></a><span id="l8.59">               // start pixel and end pixel to avoid rounding errors.</span>
<a href="#l8.60"></a><span id="l8.60">               var startPix = Math.round(theMin * this.mPixPerMin);</span>
<a href="#l8.61"></a><span id="l8.61">               var endPix   = Math.round((theMin + dur) * this.mPixPerMin);</span>
<a href="#l8.62"></a><span id="l8.62">               var durPix   = endPix - startPix;</span>
<a href="#l8.63"></a><span id="l8.63">               var box;</span>
<a href="#l8.64"></a><span id="l8.64">               if (dur != 60) {</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineat">@@ -288,21 +292,22 @@</span>
<a href="#l8.66"></a><span id="l8.66">       &lt;field name=&quot;mSelectedItemIds&quot;&gt;new Object()&lt;/field&gt;</span>
<a href="#l8.67"></a><span id="l8.67"> </span>
<a href="#l8.68"></a><span id="l8.68">       &lt;!-- properties --&gt;</span>
<a href="#l8.69"></a><span id="l8.69">       &lt;property name=&quot;pixelsPerMinute&quot;&gt;</span>
<a href="#l8.70"></a><span id="l8.70">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.71"></a><span id="l8.71">           return this.mPixPerMin;</span>
<a href="#l8.72"></a><span id="l8.72">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.73"></a><span id="l8.73">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-          if (val &lt;= 0.0)</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-            val = 0.01;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+          if (val &lt;= 0.0) {</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+              val = 0.01;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+          }</span>
<a href="#l8.79"></a><span id="l8.79">           if (val != this.mPixPerMin) {</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-            this.mPixPerMin = val;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-            this.relayout();</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+              this.mPixPerMin = val;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+              this.relayout();</span>
<a href="#l8.84"></a><span id="l8.84">           }</span>
<a href="#l8.85"></a><span id="l8.85">           return val;</span>
<a href="#l8.86"></a><span id="l8.86">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l8.87"></a><span id="l8.87">       &lt;/property&gt;</span>
<a href="#l8.88"></a><span id="l8.88"> </span>
<a href="#l8.89"></a><span id="l8.89">       &lt;field name=&quot;mSelected&quot;&gt;false&lt;/field&gt;</span>
<a href="#l8.90"></a><span id="l8.90">       &lt;property name=&quot;selected&quot;&gt;</span>
<a href="#l8.91"></a><span id="l8.91">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineat">@@ -456,18 +461,19 @@</span>
<a href="#l8.93"></a><span id="l8.93">       &lt;method name=&quot;startLayoutBatchChange&quot;&gt;</span>
<a href="#l8.94"></a><span id="l8.94">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.95"></a><span id="l8.95">             this.mLayoutBatchCount++;</span>
<a href="#l8.96"></a><span id="l8.96">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.97"></a><span id="l8.97">       &lt;/method&gt;</span>
<a href="#l8.98"></a><span id="l8.98">       &lt;method name=&quot;endLayoutBatchChange&quot;&gt;</span>
<a href="#l8.99"></a><span id="l8.99">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.100"></a><span id="l8.100">             this.mLayoutBatchCount--;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-            if (this.mLayoutBatchCount == 0)</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-              this.relayout();</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+            if (this.mLayoutBatchCount == 0) {</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+                this.relayout();</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+            }</span>
<a href="#l8.106"></a><span id="l8.106">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.107"></a><span id="l8.107">       &lt;/method&gt;</span>
<a href="#l8.108"></a><span id="l8.108"> </span>
<a href="#l8.109"></a><span id="l8.109">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l8.110"></a><span id="l8.110">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l8.111"></a><span id="l8.111">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l8.112"></a><span id="l8.112">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.113"></a><span id="l8.113">           // this should be done using lookupMethod(), see bug 286629</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineat">@@ -602,18 +608,19 @@</span>
<a href="#l8.115"></a><span id="l8.115">            // Fun with scoping...</span>
<a href="#l8.116"></a><span id="l8.116">            this.mEventMapTimeout = setTimeout(function() { column.relayout.call(column) }, 5);</span>
<a href="#l8.117"></a><span id="l8.117">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.118"></a><span id="l8.118">       &lt;/method&gt;</span>
<a href="#l8.119"></a><span id="l8.119"> </span>
<a href="#l8.120"></a><span id="l8.120">       &lt;method name=&quot;deleteEvent&quot;&gt;</span>
<a href="#l8.121"></a><span id="l8.121">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l8.122"></a><span id="l8.122">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-           if (this.internalDeleteEvent(aOccurrence))</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineminus">-             this.relayout();</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineplus">+           if (this.internalDeleteEvent(aOccurrence)) {</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+               this.relayout();</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+           }</span>
<a href="#l8.128"></a><span id="l8.128">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.129"></a><span id="l8.129">       &lt;/method&gt;</span>
<a href="#l8.130"></a><span id="l8.130"> </span>
<a href="#l8.131"></a><span id="l8.131">       &lt;method name=&quot;clear&quot;&gt;</span>
<a href="#l8.132"></a><span id="l8.132">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.133"></a><span id="l8.133">           while (this.bgbox &amp;&amp; this.bgbox.hasChildNodes()) {</span>
<a href="#l8.134"></a><span id="l8.134">               this.bgbox.lastChild.remove();</span>
<a href="#l8.135"></a><span id="l8.135">           }</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineat">@@ -626,18 +633,19 @@</span>
<a href="#l8.137"></a><span id="l8.137">           this.mHandlersToRemove = [];</span>
<a href="#l8.138"></a><span id="l8.138">           this.mSelectedChunks = [];</span>
<a href="#l8.139"></a><span id="l8.139">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.140"></a><span id="l8.140">       &lt;/method&gt;</span>
<a href="#l8.141"></a><span id="l8.141"> </span>
<a href="#l8.142"></a><span id="l8.142">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l8.143"></a><span id="l8.143">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.144"></a><span id="l8.144"> </span>
<a href="#l8.145"></a><span id="l8.145" class="difflineminus">-          if (this.mLayoutBatchCount &gt; 0)</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+          if (this.mLayoutBatchCount &gt; 0) {</span>
<a href="#l8.147"></a><span id="l8.147">               return;</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineplus">+          }</span>
<a href="#l8.149"></a><span id="l8.149">           this.clear();</span>
<a href="#l8.150"></a><span id="l8.150"> </span>
<a href="#l8.151"></a><span id="l8.151">           let orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l8.152"></a><span id="l8.152">           this.bgbox.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l8.153"></a><span id="l8.153"> </span>
<a href="#l8.154"></a><span id="l8.154">           // bgbox is used mainly for drawing the grid.  at some point it may</span>
<a href="#l8.155"></a><span id="l8.155">           // also be used for all-day events.</span>
<a href="#l8.156"></a><span id="l8.156">           let otherorient = getOtherOrientation(orient);</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineat">@@ -648,17 +656,19 @@</span>
<a href="#l8.158"></a><span id="l8.158">           this.mMinDuration = Components.classes[&quot;@mozilla.org/calendar/duration;1&quot;]</span>
<a href="#l8.159"></a><span id="l8.159">                                             .createInstance(Components.interfaces.calIDuration);</span>
<a href="#l8.160"></a><span id="l8.160">           this.mMinDuration.minutes = parseInt(minSize/this.mPixPerMin);</span>
<a href="#l8.161"></a><span id="l8.161"> </span>
<a href="#l8.162"></a><span id="l8.162">           let theMin = this.mStartMin;</span>
<a href="#l8.163"></a><span id="l8.163">           while (theMin &lt; this.mEndMin) {</span>
<a href="#l8.164"></a><span id="l8.164">               let dur = theMin % 60;</span>
<a href="#l8.165"></a><span id="l8.165">               theMin += dur;</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-              if (dur == 0) dur = 60;</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+              if (dur == 0) {</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineplus">+                  dur = 60;</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+              }</span>
<a href="#l8.170"></a><span id="l8.170"> </span>
<a href="#l8.171"></a><span id="l8.171">               let box = createXULElement(&quot;spacer&quot;);</span>
<a href="#l8.172"></a><span id="l8.172">               // we key off this in a CSS selector</span>
<a href="#l8.173"></a><span id="l8.173">               box.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l8.174"></a><span id="l8.174">               box.setAttribute(&quot;class&quot;, &quot;calendar-event-column-linebox&quot;);</span>
<a href="#l8.175"></a><span id="l8.175"> </span>
<a href="#l8.176"></a><span id="l8.176">               if (this.mSelected) {</span>
<a href="#l8.177"></a><span id="l8.177">                   box.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineat">@@ -673,20 +683,21 @@</span>
<a href="#l8.179"></a><span id="l8.179">               // Carry forth the day relation</span>
<a href="#l8.180"></a><span id="l8.180">               box.setAttribute(&quot;relation&quot;, this.getAttribute(&quot;relation&quot;));</span>
<a href="#l8.181"></a><span id="l8.181"> </span>
<a href="#l8.182"></a><span id="l8.182">               // calculate duration pixel as the difference between</span>
<a href="#l8.183"></a><span id="l8.183">               // start pixel and end pixel to avoid rounding errors.</span>
<a href="#l8.184"></a><span id="l8.184">               let startPix = Math.round(theMin * this.mPixPerMin);</span>
<a href="#l8.185"></a><span id="l8.185">               let endPix   = Math.round((theMin + dur) * this.mPixPerMin);</span>
<a href="#l8.186"></a><span id="l8.186">               let durPix   = endPix - startPix;</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineminus">-              if (orient == &quot;vertical&quot;)</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+              if (orient == &quot;vertical&quot;) {</span>
<a href="#l8.189"></a><span id="l8.189">                   box.setAttribute(&quot;height&quot;, durPix);</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-              else</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+              } else {</span>
<a href="#l8.192"></a><span id="l8.192">                   box.setAttribute(&quot;width&quot;, durPix);</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+              }</span>
<a href="#l8.194"></a><span id="l8.194"> </span>
<a href="#l8.195"></a><span id="l8.195">               box.setAttribute(&quot;style&quot;, &quot;min-width: 1px; min-height: 1px;&quot;);</span>
<a href="#l8.196"></a><span id="l8.196"> </span>
<a href="#l8.197"></a><span id="l8.197">               this.bgbox.appendChild(box);</span>
<a href="#l8.198"></a><span id="l8.198">               theMin += 60;</span>
<a href="#l8.199"></a><span id="l8.199">           }</span>
<a href="#l8.200"></a><span id="l8.200"> </span>
<a href="#l8.201"></a><span id="l8.201">           // fgbox is used for dragging events</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineat">@@ -1418,17 +1429,19 @@</span>
<a href="#l8.203"></a><span id="l8.203"> </span>
<a href="#l8.204"></a><span id="l8.204">       &lt;!--</span>
<a href="#l8.205"></a><span id="l8.205">          - Event sweep handlers</span>
<a href="#l8.206"></a><span id="l8.206">         --&gt;</span>
<a href="#l8.207"></a><span id="l8.207">       &lt;method name=&quot;onEventSweepMouseMove&quot;&gt;</span>
<a href="#l8.208"></a><span id="l8.208">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l8.209"></a><span id="l8.209">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.210"></a><span id="l8.210">           let col = document.calendarEventColumnDragging;</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineminus">-          if (!col) return;</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineplus">+          if (!col) {</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineplus">+              return;</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineplus">+          }</span>
<a href="#l8.215"></a><span id="l8.215"> </span>
<a href="#l8.216"></a><span id="l8.216">           col.setupMagicScroll(event);</span>
<a href="#l8.217"></a><span id="l8.217"> </span>
<a href="#l8.218"></a><span id="l8.218">           let dragState = col.mDragState;</span>
<a href="#l8.219"></a><span id="l8.219"> </span>
<a href="#l8.220"></a><span id="l8.220">           let lateralColumns = col.firstLastShadowColumns();</span>
<a href="#l8.221"></a><span id="l8.221">           let firstCol = lateralColumns.firstCol;</span>
<a href="#l8.222"></a><span id="l8.222">           let firstIndex = lateralColumns.firstIndex;</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineat">@@ -1608,17 +1621,19 @@</span>
<a href="#l8.224"></a><span id="l8.224">           col.mDragState.shadows = currentShadows;</span>
<a href="#l8.225"></a><span id="l8.225">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.226"></a><span id="l8.226">       &lt;/method&gt;</span>
<a href="#l8.227"></a><span id="l8.227"> </span>
<a href="#l8.228"></a><span id="l8.228">       &lt;method name=&quot;onEventSweepMouseUp&quot;&gt;</span>
<a href="#l8.229"></a><span id="l8.229">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l8.230"></a><span id="l8.230">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.231"></a><span id="l8.231">           let col = document.calendarEventColumnDragging;</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineminus">-          if (!col) return;</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+          if (!col) {</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+              return;</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+          }</span>
<a href="#l8.236"></a><span id="l8.236"> </span>
<a href="#l8.237"></a><span id="l8.237">           let dragState = col.mDragState;</span>
<a href="#l8.238"></a><span id="l8.238"> </span>
<a href="#l8.239"></a><span id="l8.239">           let lateralColumns = col.firstLastShadowColumns();</span>
<a href="#l8.240"></a><span id="l8.240">           let column = lateralColumns.firstCol;</span>
<a href="#l8.241"></a><span id="l8.241">           let index = lateralColumns.firstIndex;</span>
<a href="#l8.242"></a><span id="l8.242">           while (column &amp;&amp; index &lt; dragState.shadows) {</span>
<a href="#l8.243"></a><span id="l8.243">               column.fgboxes.dragbox.removeAttribute(&quot;dragging&quot;);</span>
<a href="#l8.244"></a><span id="l8.244" class="difflineat">@@ -1635,21 +1650,23 @@</span>
<a href="#l8.245"></a><span id="l8.245"> </span>
<a href="#l8.246"></a><span id="l8.246">           document.calendarEventColumnDragging = null;</span>
<a href="#l8.247"></a><span id="l8.247"> </span>
<a href="#l8.248"></a><span id="l8.248">           // if the user didn't sweep out at least a few pixels, ignore</span>
<a href="#l8.249"></a><span id="l8.249">           // unless we're in a different column</span>
<a href="#l8.250"></a><span id="l8.250">           if (dragState.origColumn == col) {</span>
<a href="#l8.251"></a><span id="l8.251">               var ignore = false;</span>
<a href="#l8.252"></a><span id="l8.252">               if (col.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l8.253"></a><span id="l8.253" class="difflineminus">-                  if (Math.abs(event.screenY - dragState.origLoc) &lt; 3)</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineplus">+                  if (Math.abs(event.screenY - dragState.origLoc) &lt; 3) {</span>
<a href="#l8.255"></a><span id="l8.255">                       ignore = true;</span>
<a href="#l8.256"></a><span id="l8.256" class="difflineplus">+                  }</span>
<a href="#l8.257"></a><span id="l8.257">               } else {</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineminus">-                  if (Math.abs(event.screenX - dragState.origLoc) &lt; 3)</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineplus">+                  if (Math.abs(event.screenX - dragState.origLoc) &lt; 3) {</span>
<a href="#l8.260"></a><span id="l8.260">                       ignore = true;</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineplus">+                  }</span>
<a href="#l8.262"></a><span id="l8.262">               }</span>
<a href="#l8.263"></a><span id="l8.263"> </span>
<a href="#l8.264"></a><span id="l8.264">               if (ignore) {</span>
<a href="#l8.265"></a><span id="l8.265">                   col.mDragState = null;</span>
<a href="#l8.266"></a><span id="l8.266">                   return;</span>
<a href="#l8.267"></a><span id="l8.267">               }</span>
<a href="#l8.268"></a><span id="l8.268">           }</span>
<a href="#l8.269"></a><span id="l8.269"> </span>
<a href="#l8.270"></a><span id="l8.270" class="difflineat">@@ -1891,20 +1908,21 @@</span>
<a href="#l8.271"></a><span id="l8.271"> </span>
<a href="#l8.272"></a><span id="l8.272">               let shadowElements = this.getShadowElements(this.mDragState.origMinStart,</span>
<a href="#l8.273"></a><span id="l8.273">                                                           this.mDragState.origMinEnd);</span>
<a href="#l8.274"></a><span id="l8.274">               this.mDragState.shadows = shadowElements.shadows;</span>
<a href="#l8.275"></a><span id="l8.275">               this.mDragState.offset = shadowElements.offset;</span>
<a href="#l8.276"></a><span id="l8.276">               // we need to set a mouse offset, since we're not dragging from</span>
<a href="#l8.277"></a><span id="l8.277">               // one end of the element</span>
<a href="#l8.278"></a><span id="l8.278">               if (aEventBox) {</span>
<a href="#l8.279"></a><span id="l8.279" class="difflineminus">-                  if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;)</span>
<a href="#l8.280"></a><span id="l8.280" class="difflineplus">+                  if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l8.281"></a><span id="l8.281">                       this.mDragState.mouseOffset = aMouseY - aEventBox.boxObject.screenY;</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineminus">-                  else</span>
<a href="#l8.283"></a><span id="l8.283" class="difflineplus">+                  } else {</span>
<a href="#l8.284"></a><span id="l8.284">                       this.mDragState.mouseOffset = aMouseX - aEventBox.boxObject.screenX;</span>
<a href="#l8.285"></a><span id="l8.285" class="difflineplus">+                  }</span>
<a href="#l8.286"></a><span id="l8.286">               }</span>
<a href="#l8.287"></a><span id="l8.287">           } else {</span>
<a href="#l8.288"></a><span id="l8.288">               // Invalid grabbed element.</span>
<a href="#l8.289"></a><span id="l8.289">           }</span>
<a href="#l8.290"></a><span id="l8.290"> </span>
<a href="#l8.291"></a><span id="l8.291">           document.calendarEventColumnDragging = this;</span>
<a href="#l8.292"></a><span id="l8.292"> </span>
<a href="#l8.293"></a><span id="l8.293">           window.addEventListener(&quot;mousemove&quot;, this.onEventSweepMouseMove, false);</span>
<a href="#l8.294"></a><span id="l8.294" class="difflineat">@@ -1930,17 +1948,19 @@</span>
<a href="#l8.295"></a><span id="l8.295">           // So we really don't have anything to do here.</span>
<a href="#l8.296"></a><span id="l8.296">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.297"></a><span id="l8.297">       &lt;/method&gt;</span>
<a href="#l8.298"></a><span id="l8.298"> </span>
<a href="#l8.299"></a><span id="l8.299">       &lt;method name=&quot;updateDragLabels&quot;&gt;</span>
<a href="#l8.300"></a><span id="l8.300">         &lt;parameter name=&quot;aFirstColumn&quot;/&gt;</span>
<a href="#l8.301"></a><span id="l8.301">         &lt;parameter name=&quot;aLastColumn&quot;/&gt;</span>
<a href="#l8.302"></a><span id="l8.302">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.303"></a><span id="l8.303" class="difflineminus">-          if (!this.mDragState) return;</span>
<a href="#l8.304"></a><span id="l8.304" class="difflineplus">+          if (!this.mDragState) {</span>
<a href="#l8.305"></a><span id="l8.305" class="difflineplus">+              return;</span>
<a href="#l8.306"></a><span id="l8.306" class="difflineplus">+          }</span>
<a href="#l8.307"></a><span id="l8.307"> </span>
<a href="#l8.308"></a><span id="l8.308">           let firstColumn = (aFirstColumn || this);</span>
<a href="#l8.309"></a><span id="l8.309">           let lastColumn = (aLastColumn || this);</span>
<a href="#l8.310"></a><span id="l8.310">           let realstartmin = this.mDragState.startMin + this.mStartMin;</span>
<a href="#l8.311"></a><span id="l8.311">           let realendmin = this.mDragState.endMin + this.mStartMin;</span>
<a href="#l8.312"></a><span id="l8.312">           var starthr = Math.floor(realstartmin / 60);</span>
<a href="#l8.313"></a><span id="l8.313">           var startmin = realstartmin % 60;</span>
<a href="#l8.314"></a><span id="l8.314"> </span>
<a href="#l8.315"></a><span id="l8.315" class="difflineat">@@ -2307,26 +2327,26 @@</span>
<a href="#l8.316"></a><span id="l8.316"> </span>
<a href="#l8.317"></a><span id="l8.317">       &lt;!-- methods/properties --&gt;</span>
<a href="#l8.318"></a><span id="l8.318">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l8.319"></a><span id="l8.319">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l8.320"></a><span id="l8.320">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l8.321"></a><span id="l8.321">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.322"></a><span id="l8.322">           var needsrelayout = false;</span>
<a href="#l8.323"></a><span id="l8.323">           if (aAttr == &quot;orient&quot;) {</span>
<a href="#l8.324"></a><span id="l8.324" class="difflineminus">-              if (this.getAttribute(&quot;orient&quot;) != aVal)</span>
<a href="#l8.325"></a><span id="l8.325" class="difflineplus">+              if (this.getAttribute(&quot;orient&quot;) != aVal) {</span>
<a href="#l8.326"></a><span id="l8.326">                   needsrelayout = true;</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineplus">+              }</span>
<a href="#l8.328"></a><span id="l8.328">           }</span>
<a href="#l8.329"></a><span id="l8.329"> </span>
<a href="#l8.330"></a><span id="l8.330">           // this should be done using lookupMethod(), see bug 286629</span>
<a href="#l8.331"></a><span id="l8.331">           var ret = XULElement.prototype.setAttribute.call (this, aAttr, aVal);</span>
<a href="#l8.332"></a><span id="l8.332"> </span>
<a href="#l8.333"></a><span id="l8.333">           if (needsrelayout) {</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineminus">-              var otherorient = &quot;vertical&quot;;</span>
<a href="#l8.335"></a><span id="l8.335" class="difflineminus">-              if (val != &quot;horizontal&quot;) otherorient = &quot;horizontal&quot;;</span>
<a href="#l8.336"></a><span id="l8.336" class="difflineplus">+              var otherorient = (val == &quot;vertical&quot; ? &quot;horizontal&quot; : &quot;vertical&quot;);</span>
<a href="#l8.337"></a><span id="l8.337">               var eventbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;eventbox&quot;);</span>
<a href="#l8.338"></a><span id="l8.338">               eventbox.setAttribute(&quot;orient&quot;, val);</span>
<a href="#l8.339"></a><span id="l8.339">               var gb1 = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar1&quot;);</span>
<a href="#l8.340"></a><span id="l8.340">               gb1.parentorient = val;</span>
<a href="#l8.341"></a><span id="l8.341">               var gb2 = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar2&quot;);</span>
<a href="#l8.342"></a><span id="l8.342">               gb2.parentorient = val;</span>
<a href="#l8.343"></a><span id="l8.343">           }</span>
<a href="#l8.344"></a><span id="l8.344"> </span>
<a href="#l8.345"></a><span id="l8.345" class="difflineat">@@ -2354,27 +2374,29 @@</span>
<a href="#l8.346"></a><span id="l8.346">       &lt;/method&gt;</span>
<a href="#l8.347"></a><span id="l8.347"> </span>
<a href="#l8.348"></a><span id="l8.348">       &lt;property name=&quot;parentColumn&quot;</span>
<a href="#l8.349"></a><span id="l8.349">         onget=&quot;return this.mParentColumn;&quot;</span>
<a href="#l8.350"></a><span id="l8.350">         onset=&quot;return (this.mParentColumn = val);&quot;/&gt;</span>
<a href="#l8.351"></a><span id="l8.351"> </span>
<a href="#l8.352"></a><span id="l8.352">       &lt;property name=&quot;startMinute&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l8.353"></a><span id="l8.353">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.354"></a><span id="l8.354" class="difflineminus">-            if (!this.mOccurrence)</span>
<a href="#l8.355"></a><span id="l8.355" class="difflineplus">+            if (!this.mOccurrence) {</span>
<a href="#l8.356"></a><span id="l8.356">                 return 0;</span>
<a href="#l8.357"></a><span id="l8.357" class="difflineplus">+            }</span>
<a href="#l8.358"></a><span id="l8.358">             var startDate = this.mOccurrence.startDate || this.mOccurrence.entryDate;</span>
<a href="#l8.359"></a><span id="l8.359">             return startDate.hour * 60 + startDate.minute;</span>
<a href="#l8.360"></a><span id="l8.360">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.361"></a><span id="l8.361">       &lt;/property&gt;</span>
<a href="#l8.362"></a><span id="l8.362"> </span>
<a href="#l8.363"></a><span id="l8.363">       &lt;property name=&quot;endMinute&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l8.364"></a><span id="l8.364">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.365"></a><span id="l8.365" class="difflineminus">-            if (!this.mOccurrence)</span>
<a href="#l8.366"></a><span id="l8.366" class="difflineplus">+            if (!this.mOccurrence) {</span>
<a href="#l8.367"></a><span id="l8.367">                 return 0;</span>
<a href="#l8.368"></a><span id="l8.368" class="difflineplus">+            }</span>
<a href="#l8.369"></a><span id="l8.369">             var endDate = this.mOccurrence.endDate || this.mOccurrence.dueDate;</span>
<a href="#l8.370"></a><span id="l8.370">             return endDate.hour * 60 + endDate.minute;</span>
<a href="#l8.371"></a><span id="l8.371">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.372"></a><span id="l8.372">       &lt;/property&gt;</span>
<a href="#l8.373"></a><span id="l8.373"> </span>
<a href="#l8.374"></a><span id="l8.374">       &lt;method name=&quot;setEditableLabel&quot;&gt;</span>
<a href="#l8.375"></a><span id="l8.375">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.376"></a><span id="l8.376">           var evl = this.eventNameLabel;</span>
<a href="#l8.377"></a><span id="l8.377" class="difflineat">@@ -2393,18 +2415,19 @@</span>
<a href="#l8.378"></a><span id="l8.378">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.379"></a><span id="l8.379">       &lt;/method&gt;</span>
<a href="#l8.380"></a><span id="l8.380">     &lt;/implementation&gt;</span>
<a href="#l8.381"></a><span id="l8.381"> </span>
<a href="#l8.382"></a><span id="l8.382">     &lt;handlers&gt;</span>
<a href="#l8.383"></a><span id="l8.383">       &lt;handler event=&quot;mousedown&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.384"></a><span id="l8.384">         event.stopPropagation();</span>
<a href="#l8.385"></a><span id="l8.385"> </span>
<a href="#l8.386"></a><span id="l8.386" class="difflineminus">-        if (this.mEditing)</span>
<a href="#l8.387"></a><span id="l8.387" class="difflineplus">+        if (this.mEditing) {</span>
<a href="#l8.388"></a><span id="l8.388">             return;</span>
<a href="#l8.389"></a><span id="l8.389" class="difflineplus">+        }</span>
<a href="#l8.390"></a><span id="l8.390"> </span>
<a href="#l8.391"></a><span id="l8.391">         this.parentColumn.calendarView.selectedDay = this.parentColumn.mDate;</span>
<a href="#l8.392"></a><span id="l8.392">         this.mMouseX = event.screenX;</span>
<a href="#l8.393"></a><span id="l8.393">         this.mMouseY = event.screenY;</span>
<a href="#l8.394"></a><span id="l8.394"> </span>
<a href="#l8.395"></a><span id="l8.395">         let whichside = event.whichside;</span>
<a href="#l8.396"></a><span id="l8.396">         if (!whichside) {</span>
<a href="#l8.397"></a><span id="l8.397">             // may be click or drag,</span>
<a href="#l8.398"></a><span id="l8.398" class="difflineat">@@ -2422,18 +2445,20 @@</span>
<a href="#l8.399"></a><span id="l8.399">             // start edge resize drag</span>
<a href="#l8.400"></a><span id="l8.400">             this.parentColumn.startSweepingToModifyEvent(this, this.mOccurrence, whichside,</span>
<a href="#l8.401"></a><span id="l8.401">                                                          event.screenX, event.screenY,</span>
<a href="#l8.402"></a><span id="l8.402">                                                          snapIntMin);</span>
<a href="#l8.403"></a><span id="l8.403">         }</span>
<a href="#l8.404"></a><span id="l8.404">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l8.405"></a><span id="l8.405"> </span>
<a href="#l8.406"></a><span id="l8.406">       &lt;handler event=&quot;mousemove&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.407"></a><span id="l8.407" class="difflineminus">-        if (!this.mInMouseDown)</span>
<a href="#l8.408"></a><span id="l8.408" class="difflineplus">+        if (!this.mInMouseDown) {</span>
<a href="#l8.409"></a><span id="l8.409">             return;</span>
<a href="#l8.410"></a><span id="l8.410" class="difflineplus">+        }</span>
<a href="#l8.411"></a><span id="l8.411" class="difflineplus">+</span>
<a href="#l8.412"></a><span id="l8.412">         var dx = Math.abs(event.screenX - this.mMouseX);</span>
<a href="#l8.413"></a><span id="l8.413">         var dy = Math.abs(event.screenY - this.mMouseY);</span>
<a href="#l8.414"></a><span id="l8.414">         // more than a 3 pixel move?</span>
<a href="#l8.415"></a><span id="l8.415">         if ((dx*dx + dy*dy) &gt; 9) {</span>
<a href="#l8.416"></a><span id="l8.416">             if (this.parentColumn) {</span>
<a href="#l8.417"></a><span id="l8.417">                 if (this.editingTimer) {</span>
<a href="#l8.418"></a><span id="l8.418">                     clearTimeout(this.editingTimer);</span>
<a href="#l8.419"></a><span id="l8.419">                     this.editingTimer = null;</span>
<a href="#l8.420"></a><span id="l8.420" class="difflineat">@@ -2461,18 +2486,19 @@</span>
<a href="#l8.421"></a><span id="l8.421">             this.mEditing = false;</span>
<a href="#l8.422"></a><span id="l8.422"> </span>
<a href="#l8.423"></a><span id="l8.423">             this.parentColumn.startSweepingToModifyEvent(this, this.mOccurrence, &quot;middle&quot;, this.mMouseX, this.mMouseY);</span>
<a href="#l8.424"></a><span id="l8.424">             this.mInMouseDown = false;</span>
<a href="#l8.425"></a><span id="l8.425">         }</span>
<a href="#l8.426"></a><span id="l8.426">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l8.427"></a><span id="l8.427"> </span>
<a href="#l8.428"></a><span id="l8.428">       &lt;handler event=&quot;mouseup&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.429"></a><span id="l8.429" class="difflineminus">-        if (this.mEditing)</span>
<a href="#l8.430"></a><span id="l8.430" class="difflineplus">+        if (this.mEditing) {</span>
<a href="#l8.431"></a><span id="l8.431">             return;</span>
<a href="#l8.432"></a><span id="l8.432" class="difflineplus">+        }</span>
<a href="#l8.433"></a><span id="l8.433"> </span>
<a href="#l8.434"></a><span id="l8.434">         this.mInMouseDown = false;</span>
<a href="#l8.435"></a><span id="l8.435">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l8.436"></a><span id="l8.436"> </span>
<a href="#l8.437"></a><span id="l8.437">       &lt;handler event=&quot;mouseover&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.438"></a><span id="l8.438">         if (this.calendarView &amp;&amp; this.calendarView.controller) {</span>
<a href="#l8.439"></a><span id="l8.439">             event.stopPropagation();</span>
<a href="#l8.440"></a><span id="l8.440">             onMouseOverItem(event);</span>
<a href="#l8.441"></a><span id="l8.441" class="difflineat">@@ -2784,45 +2810,55 @@</span>
<a href="#l8.442"></a><span id="l8.442">       &lt;!-- calICalendarView --&gt;</span>
<a href="#l8.443"></a><span id="l8.443">       &lt;property name=&quot;supportsDisjointDates&quot;</span>
<a href="#l8.444"></a><span id="l8.444">         onget=&quot;return true&quot;/&gt;</span>
<a href="#l8.445"></a><span id="l8.445">       &lt;property name=&quot;hasDisjointDates&quot;</span>
<a href="#l8.446"></a><span id="l8.446">         onget=&quot;return (this.mDateList != null);&quot;/&gt;</span>
<a href="#l8.447"></a><span id="l8.447"> </span>
<a href="#l8.448"></a><span id="l8.448">       &lt;property name=&quot;startDate&quot;&gt;</span>
<a href="#l8.449"></a><span id="l8.449">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.450"></a><span id="l8.450" class="difflineminus">-          if (this.mStartDate) return this.mStartDate;</span>
<a href="#l8.451"></a><span id="l8.451" class="difflineminus">-          else if (this.mDateList &amp;&amp; this.mDateList.length &gt; 0) return this.mDateList[0];</span>
<a href="#l8.452"></a><span id="l8.452" class="difflineminus">-          else return null;</span>
<a href="#l8.453"></a><span id="l8.453" class="difflineplus">+          if (this.mStartDate) {</span>
<a href="#l8.454"></a><span id="l8.454" class="difflineplus">+              return this.mStartDate;</span>
<a href="#l8.455"></a><span id="l8.455" class="difflineplus">+          } else if (this.mDateList &amp;&amp; this.mDateList.length &gt; 0) {</span>
<a href="#l8.456"></a><span id="l8.456" class="difflineplus">+              return this.mDateList[0];</span>
<a href="#l8.457"></a><span id="l8.457" class="difflineplus">+          } else {</span>
<a href="#l8.458"></a><span id="l8.458" class="difflineplus">+              return null;</span>
<a href="#l8.459"></a><span id="l8.459" class="difflineplus">+          }</span>
<a href="#l8.460"></a><span id="l8.460">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.461"></a><span id="l8.461">       &lt;/property&gt;</span>
<a href="#l8.462"></a><span id="l8.462"> </span>
<a href="#l8.463"></a><span id="l8.463">       &lt;property name=&quot;endDate&quot;&gt;</span>
<a href="#l8.464"></a><span id="l8.464">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.465"></a><span id="l8.465" class="difflineminus">-          if (this.mEndDate) return this.mEndDate;</span>
<a href="#l8.466"></a><span id="l8.466" class="difflineminus">-          else if (this.mDateList &amp;&amp; this.mDateList.length &gt; 0) return this.mDateList[this.mDateList.length-1];</span>
<a href="#l8.467"></a><span id="l8.467" class="difflineminus">-          else return null;</span>
<a href="#l8.468"></a><span id="l8.468" class="difflineplus">+          if (this.mEndDate) {</span>
<a href="#l8.469"></a><span id="l8.469" class="difflineplus">+              return this.mEndDate;</span>
<a href="#l8.470"></a><span id="l8.470" class="difflineplus">+          } else if (this.mDateList &amp;&amp; this.mDateList.length &gt; 0) {</span>
<a href="#l8.471"></a><span id="l8.471" class="difflineplus">+              return this.mDateList[this.mDateList.length - 1];</span>
<a href="#l8.472"></a><span id="l8.472" class="difflineplus">+          } else {</span>
<a href="#l8.473"></a><span id="l8.473" class="difflineplus">+              return null;</span>
<a href="#l8.474"></a><span id="l8.474" class="difflineplus">+          }</span>
<a href="#l8.475"></a><span id="l8.475">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l8.476"></a><span id="l8.476">       &lt;/property&gt;</span>
<a href="#l8.477"></a><span id="l8.477"> </span>
<a href="#l8.478"></a><span id="l8.478">       &lt;method name=&quot;showDate&quot;&gt;</span>
<a href="#l8.479"></a><span id="l8.479">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l8.480"></a><span id="l8.480">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.481"></a><span id="l8.481">           var targetDate = aDate.getInTimezone(this.mTimezone);</span>
<a href="#l8.482"></a><span id="l8.482">           targetDate.isDate = true;</span>
<a href="#l8.483"></a><span id="l8.483"> </span>
<a href="#l8.484"></a><span id="l8.484">           if (this.mStartDate &amp;&amp; this.mEndDate) {</span>
<a href="#l8.485"></a><span id="l8.485">               if (this.mStartDate.compare(targetDate) &lt;= 0 &amp;&amp;</span>
<a href="#l8.486"></a><span id="l8.486" class="difflineminus">-                  this.mEndDate.compare(targetDate) &gt;= 0)</span>
<a href="#l8.487"></a><span id="l8.487" class="difflineplus">+                  this.mEndDate.compare(targetDate) &gt;= 0) {</span>
<a href="#l8.488"></a><span id="l8.488">                   return;</span>
<a href="#l8.489"></a><span id="l8.489" class="difflineplus">+              }</span>
<a href="#l8.490"></a><span id="l8.490">           } else if (this.mDateList) {</span>
<a href="#l8.491"></a><span id="l8.491">               for (var d of this.mDateList) {</span>
<a href="#l8.492"></a><span id="l8.492">                   // if date is already visible, nothing to do</span>
<a href="#l8.493"></a><span id="l8.493" class="difflineminus">-                  if (d.compare(targetDate) == 0)</span>
<a href="#l8.494"></a><span id="l8.494" class="difflineplus">+                  if (d.compare(targetDate) == 0) {</span>
<a href="#l8.495"></a><span id="l8.495">                       return;</span>
<a href="#l8.496"></a><span id="l8.496" class="difflineplus">+                  }</span>
<a href="#l8.497"></a><span id="l8.497">               }</span>
<a href="#l8.498"></a><span id="l8.498">           }</span>
<a href="#l8.499"></a><span id="l8.499"> </span>
<a href="#l8.500"></a><span id="l8.500">           // if we're only showing one date, then continue</span>
<a href="#l8.501"></a><span id="l8.501">           // to only show one date; otherwise, show the week.</span>
<a href="#l8.502"></a><span id="l8.502">           if (this.numVisibleDates == 1) {</span>
<a href="#l8.503"></a><span id="l8.503">             this.setDateRange(aDate, aDate);</span>
<a href="#l8.504"></a><span id="l8.504">           } else {</span>
<a href="#l8.505"></a><span id="l8.505" class="difflineat">@@ -3130,18 +3166,19 @@</span>
<a href="#l8.506"></a><span id="l8.506">           return val;</span>
<a href="#l8.507"></a><span id="l8.507">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l8.508"></a><span id="l8.508">       &lt;/property&gt;</span>
<a href="#l8.509"></a><span id="l8.509"> </span>
<a href="#l8.510"></a><span id="l8.510">       &lt;!-- private --&gt;</span>
<a href="#l8.511"></a><span id="l8.511"> </span>
<a href="#l8.512"></a><span id="l8.512">       &lt;property name=&quot;numVisibleDates&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l8.513"></a><span id="l8.513">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l8.514"></a><span id="l8.514" class="difflineminus">-          if (this.mDateList)</span>
<a href="#l8.515"></a><span id="l8.515" class="difflineplus">+          if (this.mDateList) {</span>
<a href="#l8.516"></a><span id="l8.516">             return this.mDateList.length;</span>
<a href="#l8.517"></a><span id="l8.517" class="difflineplus">+          }</span>
<a href="#l8.518"></a><span id="l8.518"> </span>
<a href="#l8.519"></a><span id="l8.519">           var count = 0;</span>
<a href="#l8.520"></a><span id="l8.520"> </span>
<a href="#l8.521"></a><span id="l8.521">           if (!this.mStartDate || !this.mEndDate) {</span>
<a href="#l8.522"></a><span id="l8.522">             // The view has not been initialized, so there are 0 visible dates.</span>
<a href="#l8.523"></a><span id="l8.523">             return count;</span>
<a href="#l8.524"></a><span id="l8.524">           }</span>
<a href="#l8.525"></a><span id="l8.525"> </span>
<a href="#l8.526"></a><span id="l8.526" class="difflineat">@@ -3169,42 +3206,44 @@</span>
<a href="#l8.527"></a><span id="l8.527"> </span>
<a href="#l8.528"></a><span id="l8.528">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l8.529"></a><span id="l8.529">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l8.530"></a><span id="l8.530">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l8.531"></a><span id="l8.531">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.532"></a><span id="l8.532">           var needsreorient = false;</span>
<a href="#l8.533"></a><span id="l8.533">           var needsrelayout = false;</span>
<a href="#l8.534"></a><span id="l8.534">           if (aAttr == &quot;orient&quot;) {</span>
<a href="#l8.535"></a><span id="l8.535" class="difflineminus">-              if (this.getAttribute(&quot;orient&quot;) != aVal)</span>
<a href="#l8.536"></a><span id="l8.536" class="difflineplus">+              if (this.getAttribute(&quot;orient&quot;) != aVal) {</span>
<a href="#l8.537"></a><span id="l8.537">                   needsreorient = true;</span>
<a href="#l8.538"></a><span id="l8.538" class="difflineplus">+              }</span>
<a href="#l8.539"></a><span id="l8.539">           }</span>
<a href="#l8.540"></a><span id="l8.540"> </span>
<a href="#l8.541"></a><span id="l8.541" class="difflineminus">-          if (aAttr == &quot;context&quot; || aAttr == &quot;item-context&quot;)</span>
<a href="#l8.542"></a><span id="l8.542" class="difflineplus">+          if (aAttr == &quot;context&quot; || aAttr == &quot;item-context&quot;) {</span>
<a href="#l8.543"></a><span id="l8.543">               needsrelayout = true;</span>
<a href="#l8.544"></a><span id="l8.544" class="difflineplus">+          }</span>
<a href="#l8.545"></a><span id="l8.545"> </span>
<a href="#l8.546"></a><span id="l8.546">           // this should be done using lookupMethod(), see bug 286629</span>
<a href="#l8.547"></a><span id="l8.547">           var ret = XULElement.prototype.setAttribute.call (this, aAttr, aVal);</span>
<a href="#l8.548"></a><span id="l8.548"> </span>
<a href="#l8.549"></a><span id="l8.549" class="difflineminus">-          if (needsrelayout &amp;&amp; !needsreorient)</span>
<a href="#l8.550"></a><span id="l8.550" class="difflineplus">+          if (needsrelayout &amp;&amp; !needsreorient) {</span>
<a href="#l8.551"></a><span id="l8.551">               this.relayout();</span>
<a href="#l8.552"></a><span id="l8.552" class="difflineminus">-</span>
<a href="#l8.553"></a><span id="l8.553" class="difflineminus">-          if (needsreorient)</span>
<a href="#l8.554"></a><span id="l8.554" class="difflineplus">+          }</span>
<a href="#l8.555"></a><span id="l8.555" class="difflineplus">+</span>
<a href="#l8.556"></a><span id="l8.556" class="difflineplus">+          if (needsreorient) {</span>
<a href="#l8.557"></a><span id="l8.557">               this.reorient();</span>
<a href="#l8.558"></a><span id="l8.558" class="difflineplus">+          }</span>
<a href="#l8.559"></a><span id="l8.559"> </span>
<a href="#l8.560"></a><span id="l8.560">           return ret;</span>
<a href="#l8.561"></a><span id="l8.561">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.562"></a><span id="l8.562">       &lt;/method&gt;</span>
<a href="#l8.563"></a><span id="l8.563"> </span>
<a href="#l8.564"></a><span id="l8.564">       &lt;method name=&quot;reorient&quot;&gt;</span>
<a href="#l8.565"></a><span id="l8.565">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.566"></a><span id="l8.566" class="difflineminus">-          let orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l8.567"></a><span id="l8.567" class="difflineminus">-          let otherorient = &quot;vertical&quot;;</span>
<a href="#l8.568"></a><span id="l8.568" class="difflineminus">-          if (!orient) orient = &quot;horizontal&quot;;</span>
<a href="#l8.569"></a><span id="l8.569" class="difflineminus">-          if (orient == &quot;vertical&quot;) otherorient = &quot;horizontal&quot;;</span>
<a href="#l8.570"></a><span id="l8.570" class="difflineplus">+          let orient = this.getAttribute(&quot;orient&quot;) || &quot;horizontal&quot;;</span>
<a href="#l8.571"></a><span id="l8.571" class="difflineplus">+          let otherorient = (orient == &quot;vertical&quot; ? &quot;horizontal&quot; : &quot;vertical&quot;);</span>
<a href="#l8.572"></a><span id="l8.572"> </span>
<a href="#l8.573"></a><span id="l8.573">           if (orient == &quot;horizontal&quot;) {</span>
<a href="#l8.574"></a><span id="l8.574">               this.pixelsPerMinute = 1.5;</span>
<a href="#l8.575"></a><span id="l8.575">           } else {</span>
<a href="#l8.576"></a><span id="l8.576">               this.pixelsPerMinute = 0.6;</span>
<a href="#l8.577"></a><span id="l8.577">           }</span>
<a href="#l8.578"></a><span id="l8.578"> </span>
<a href="#l8.579"></a><span id="l8.579">           let normalelems = ['mainbox', 'timebar'];</span>
<a href="#l8.580"></a><span id="l8.580" class="difflineat">@@ -3249,19 +3288,18 @@</span>
<a href="#l8.581"></a><span id="l8.581">       &lt;/method&gt;</span>
<a href="#l8.582"></a><span id="l8.582"> </span>
<a href="#l8.583"></a><span id="l8.583">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l8.584"></a><span id="l8.584">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.585"></a><span id="l8.585">           if (!this.mStartDate || !this.mEndDate) {</span>
<a href="#l8.586"></a><span id="l8.586">               return;</span>
<a href="#l8.587"></a><span id="l8.587">           }</span>
<a href="#l8.588"></a><span id="l8.588"> </span>
<a href="#l8.589"></a><span id="l8.589" class="difflineminus">-          var orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l8.590"></a><span id="l8.590" class="difflineminus">-          if (!orient) orient = &quot;horizontal&quot;;</span>
<a href="#l8.591"></a><span id="l8.591" class="difflineminus">-          var otherorient = getOtherOrientation(orient);</span>
<a href="#l8.592"></a><span id="l8.592" class="difflineplus">+          let orient = this.getAttribute(&quot;orient&quot;) || &quot;horizontal&quot;;</span>
<a href="#l8.593"></a><span id="l8.593" class="difflineplus">+          let otherorient = getOtherOrientation(orient);</span>
<a href="#l8.594"></a><span id="l8.594"> </span>
<a href="#l8.595"></a><span id="l8.595">           let computedDateList = new Array();</span>
<a href="#l8.596"></a><span id="l8.596">           let startDate = this.mStartDate.clone();</span>
<a href="#l8.597"></a><span id="l8.597">           while (startDate.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l8.598"></a><span id="l8.598">               let workday = startDate.clone();</span>
<a href="#l8.599"></a><span id="l8.599">               workday.makeImmutable();</span>
<a href="#l8.600"></a><span id="l8.600">               if (this.mDisplayDaysOff) {</span>
<a href="#l8.601"></a><span id="l8.601">                   computedDateList.push(workday);</span>
<a href="#l8.602"></a><span id="l8.602" class="difflineat">@@ -3454,18 +3492,19 @@</span>
<a href="#l8.603"></a><span id="l8.603"> </span>
<a href="#l8.604"></a><span id="l8.604">       &lt;method name=&quot;findColumnForDate&quot;&gt;</span>
<a href="#l8.605"></a><span id="l8.605">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l8.606"></a><span id="l8.606">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.607"></a><span id="l8.607">           if (!this.mDateColumns) {</span>
<a href="#l8.608"></a><span id="l8.608">               return null;</span>
<a href="#l8.609"></a><span id="l8.609">           }</span>
<a href="#l8.610"></a><span id="l8.610">           for (var col of this.mDateColumns) {</span>
<a href="#l8.611"></a><span id="l8.611" class="difflineminus">-              if (col.date.compare(aDate) == 0)</span>
<a href="#l8.612"></a><span id="l8.612" class="difflineplus">+              if (col.date.compare(aDate) == 0) {</span>
<a href="#l8.613"></a><span id="l8.613">                   return col;</span>
<a href="#l8.614"></a><span id="l8.614" class="difflineplus">+              }</span>
<a href="#l8.615"></a><span id="l8.615">           }</span>
<a href="#l8.616"></a><span id="l8.616">           return null;</span>
<a href="#l8.617"></a><span id="l8.617">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.618"></a><span id="l8.618">       &lt;/method&gt;</span>
<a href="#l8.619"></a><span id="l8.619"> </span>
<a href="#l8.620"></a><span id="l8.620">       &lt;method name=&quot;findDayBoxForDate&quot;&gt;</span>
<a href="#l8.621"></a><span id="l8.621">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l8.622"></a><span id="l8.622">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.623"></a><span id="l8.623" class="difflineat">@@ -3601,18 +3640,19 @@</span>
<a href="#l8.624"></a><span id="l8.624">           }</span>
<a href="#l8.625"></a><span id="l8.625">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.626"></a><span id="l8.626">       &lt;/method&gt;</span>
<a href="#l8.627"></a><span id="l8.627"> </span>
<a href="#l8.628"></a><span id="l8.628">       &lt;method name=&quot;doAddItem&quot;&gt;</span>
<a href="#l8.629"></a><span id="l8.629">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l8.630"></a><span id="l8.630">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.631"></a><span id="l8.631">           var cols = this.findColumnsForItem(aEvent);</span>
<a href="#l8.632"></a><span id="l8.632" class="difflineminus">-          if (!cols.length)</span>
<a href="#l8.633"></a><span id="l8.633" class="difflineplus">+          if (!cols.length) {</span>
<a href="#l8.634"></a><span id="l8.634">               return;</span>
<a href="#l8.635"></a><span id="l8.635" class="difflineplus">+          }</span>
<a href="#l8.636"></a><span id="l8.636"> </span>
<a href="#l8.637"></a><span id="l8.637">           for (let col of cols) {</span>
<a href="#l8.638"></a><span id="l8.638">               let column = col.column;</span>
<a href="#l8.639"></a><span id="l8.639">               let header = col.header;</span>
<a href="#l8.640"></a><span id="l8.640"> </span>
<a href="#l8.641"></a><span id="l8.641">               let estart = aEvent.startDate || aEvent.entryDate || aEvent.dueDate;</span>
<a href="#l8.642"></a><span id="l8.642">               if (estart.isDate) {</span>
<a href="#l8.643"></a><span id="l8.643">                   header.addEvent(aEvent);</span>
<a href="#l8.644"></a><span id="l8.644" class="difflineat">@@ -3624,18 +3664,19 @@</span>
<a href="#l8.645"></a><span id="l8.645">           this.adjustScrollbarSpacersForAlldayEvents(aEvent);</span>
<a href="#l8.646"></a><span id="l8.646">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.647"></a><span id="l8.647">       &lt;/method&gt;</span>
<a href="#l8.648"></a><span id="l8.648"> </span>
<a href="#l8.649"></a><span id="l8.649">       &lt;method name=&quot;doDeleteItem&quot;&gt;</span>
<a href="#l8.650"></a><span id="l8.650">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l8.651"></a><span id="l8.651">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.652"></a><span id="l8.652">           var cols = this.findColumnsForItem(aEvent);</span>
<a href="#l8.653"></a><span id="l8.653" class="difflineminus">-          if (!cols.length)</span>
<a href="#l8.654"></a><span id="l8.654" class="difflineplus">+          if (!cols.length) {</span>
<a href="#l8.655"></a><span id="l8.655">               return;</span>
<a href="#l8.656"></a><span id="l8.656" class="difflineplus">+          }</span>
<a href="#l8.657"></a><span id="l8.657"> </span>
<a href="#l8.658"></a><span id="l8.658">           var oldLength = this.mSelectedItems.length;</span>
<a href="#l8.659"></a><span id="l8.659">           this.mSelectedItems = this.mSelectedItems.filter((item) =&gt; {</span>
<a href="#l8.660"></a><span id="l8.660">               return item.hashId != aEvent.hashId;</span>
<a href="#l8.661"></a><span id="l8.661">           });</span>
<a href="#l8.662"></a><span id="l8.662"> </span>
<a href="#l8.663"></a><span id="l8.663">           for (let col of cols) {</span>
<a href="#l8.664"></a><span id="l8.664">               let column = col.column;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -190,21 +190,23 @@</span>
<a href="#l9.4"></a><span id="l9.4">           let sorted = this.mTreeView.selectedColumn;</span>
<a href="#l9.5"></a><span id="l9.5">           let tree = document.getAnonymousNodes(this)[0];</span>
<a href="#l9.6"></a><span id="l9.6">           let treecols = tree.getElementsByTagNameNS(tree.namespaceURI, &quot;treecol&quot;);</span>
<a href="#l9.7"></a><span id="l9.7">           for (let i = 0; i &lt; treecols.length; i++) {</span>
<a href="#l9.8"></a><span id="l9.8">               if (treecols[i].getAttribute(&quot;hidden&quot;) != &quot;true&quot;) {</span>
<a href="#l9.9"></a><span id="l9.9">                 let content = treecols[i].getAttribute(&quot;itemproperty&quot;);</span>
<a href="#l9.10"></a><span id="l9.10">                 visible += (visible.length &gt; 0) ? &quot; &quot;+content : content;</span>
<a href="#l9.11"></a><span id="l9.11">               }</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-              if(ordinals.length &gt; 0)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+              if (ordinals.length &gt; 0) {</span>
<a href="#l9.14"></a><span id="l9.14">                   ordinals += &quot; &quot;;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+              }</span>
<a href="#l9.16"></a><span id="l9.16">               ordinals += treecols[i].ordinal;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-              if(widths.length &gt; 0)</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+              if (widths.length &gt; 0) {</span>
<a href="#l9.19"></a><span id="l9.19">                   widths += &quot; &quot;;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+              }</span>
<a href="#l9.21"></a><span id="l9.21">               widths += treecols[i].width || 0;</span>
<a href="#l9.22"></a><span id="l9.22">           }</span>
<a href="#l9.23"></a><span id="l9.23">           this.setAttribute(&quot;visible-columns&quot;, visible);</span>
<a href="#l9.24"></a><span id="l9.24">           this.setAttribute(&quot;ordinals&quot;, ordinals);</span>
<a href="#l9.25"></a><span id="l9.25">           this.setAttribute(&quot;widths&quot;, widths);</span>
<a href="#l9.26"></a><span id="l9.26">           if (sorted) {</span>
<a href="#l9.27"></a><span id="l9.27">               this.setAttribute(&quot;sort-active&quot;, sorted.getAttribute(&quot;itemproperty&quot;));</span>
<a href="#l9.28"></a><span id="l9.28">               this.setAttribute(&quot;sort-direction&quot;, this.mTreeView.sortDirection);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineat">@@ -581,18 +583,20 @@</span>
<a href="#l9.30"></a><span id="l9.30">                   }</span>
<a href="#l9.31"></a><span id="l9.31">               }</span>
<a href="#l9.32"></a><span id="l9.32">           },</span>
<a href="#l9.33"></a><span id="l9.33"> </span>
<a href="#l9.34"></a><span id="l9.34">           // The text for a given cell. If a column consists only of an</span>
<a href="#l9.35"></a><span id="l9.35">           // image, then the empty string is returned.</span>
<a href="#l9.36"></a><span id="l9.36">           getCellText: function mTV_getCellText(aRow, aCol) {</span>
<a href="#l9.37"></a><span id="l9.37">               var task = this.binding.mTaskArray[aRow];</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-              if (!task)</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+              if (!task) {</span>
<a href="#l9.40"></a><span id="l9.40">                   return false;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+              }</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+</span>
<a href="#l9.43"></a><span id="l9.43">               switch (aCol.element.getAttribute(&quot;itemproperty&quot;)) {</span>
<a href="#l9.44"></a><span id="l9.44">                   case &quot;title&quot;:</span>
<a href="#l9.45"></a><span id="l9.45">                       // return title, or &quot;Untitled&quot; if empty/null</span>
<a href="#l9.46"></a><span id="l9.46">                       return (task.title ? task.title.replace(/\n/g, ' ') : calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;));</span>
<a href="#l9.47"></a><span id="l9.47">                   case &quot;entryDate&quot;:</span>
<a href="#l9.48"></a><span id="l9.48">                       return task.recurrenceInfo ? calGetString(&quot;dateFormat&quot;, &quot;Repeating&quot;) : this._formatDateTime(task.entryDate);</span>
<a href="#l9.49"></a><span id="l9.49">                   case &quot;dueDate&quot;:</span>
<a href="#l9.50"></a><span id="l9.50">                       return task.recurrenceInfo ? calGetString(&quot;dateFormat&quot;, &quot;Repeating&quot;) : this._formatDateTime(task.dueDate);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineat">@@ -1155,24 +1159,26 @@</span>
<a href="#l9.52"></a><span id="l9.52"> </span>
<a href="#l9.53"></a><span id="l9.53">           var rowX = bo.x;</span>
<a href="#l9.54"></a><span id="l9.54">           var rowY = bo.y;</span>
<a href="#l9.55"></a><span id="l9.55">           var rowHeight = obo.rowHeight;</span>
<a href="#l9.56"></a><span id="l9.56">           var rowWidth = bo.width;</span>
<a href="#l9.57"></a><span id="l9.57"> </span>
<a href="#l9.58"></a><span id="l9.58">           //add a rectangle for each visible selected row</span>
<a href="#l9.59"></a><span id="l9.59">           for (var i = obo.getFirstVisibleRow(); i &lt;= obo.getLastVisibleRow(); i ++) {</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-            if (sel.isSelected(i))</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+            if (sel.isSelected(i)) {</span>
<a href="#l9.62"></a><span id="l9.62">               region.unionRect(rowX, rowY, rowWidth, rowHeight);</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+            }</span>
<a href="#l9.64"></a><span id="l9.64">             rowY = rowY + rowHeight;</span>
<a href="#l9.65"></a><span id="l9.65">           }</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67">           //and finally, clip the result to be sure we don't spill over...</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-          if(!region.isEmpty())</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+          if (!region.isEmpty()) {</span>
<a href="#l9.70"></a><span id="l9.70">             region.intersectRect(bo.x, bo.y, bo.width, bo.height);</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+          }</span>
<a href="#l9.72"></a><span id="l9.72">         } catch(ex) {</span>
<a href="#l9.73"></a><span id="l9.73">           ASSERT(false, &quot;Error while building selection region: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l9.74"></a><span id="l9.74">           region = null;</span>
<a href="#l9.75"></a><span id="l9.75">         }</span>
<a href="#l9.76"></a><span id="l9.76">         invokeEventDragSession(item, event.target);</span>
<a href="#l9.77"></a><span id="l9.77">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l9.78"></a><span id="l9.78">     &lt;/handlers&gt;</span>
<a href="#l9.79"></a><span id="l9.79"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -72,21 +72,22 @@</span>
<a href="#l10.4"></a><span id="l10.4">          Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">          let self = this;</span>
<a href="#l10.7"></a><span id="l10.7">          this.eventNameTextbox.onblur = function onBlur() {</span>
<a href="#l10.8"></a><span id="l10.8">              self.stopEditing(true);</span>
<a href="#l10.9"></a><span id="l10.9">          };</span>
<a href="#l10.10"></a><span id="l10.10">          this.eventNameTextbox.onkeypress = function onKeyPress(event) {</span>
<a href="#l10.11"></a><span id="l10.11">              // save on enter</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-             if (event.keyCode == 13)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+             if (event.keyCode == 13) {</span>
<a href="#l10.14"></a><span id="l10.14">                  self.stopEditing(true);</span>
<a href="#l10.15"></a><span id="l10.15">              // abort on escape</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-             else if (event.keyCode == 27)</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+             } else if (event.keyCode == 27) {</span>
<a href="#l10.18"></a><span id="l10.18">                  self.stopEditing(false);</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+             }</span>
<a href="#l10.20"></a><span id="l10.20">          };</span>
<a href="#l10.21"></a><span id="l10.21">          function stopPropagationIfEditing(event) {</span>
<a href="#l10.22"></a><span id="l10.22">            if (self.mEditing) {</span>
<a href="#l10.23"></a><span id="l10.23">              event.stopPropagation();</span>
<a href="#l10.24"></a><span id="l10.24">            }</span>
<a href="#l10.25"></a><span id="l10.25">          }</span>
<a href="#l10.26"></a><span id="l10.26">          // while editing, single click positions cursor, so don't propagate.</span>
<a href="#l10.27"></a><span id="l10.27">          this.eventNameTextbox.onclick = stopPropagationIfEditing;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineat">@@ -278,18 +279,19 @@</span>
<a href="#l10.29"></a><span id="l10.29">                 items = [this.mOccurrence];</span>
<a href="#l10.30"></a><span id="l10.30">             }</span>
<a href="#l10.31"></a><span id="l10.31">             this.calendarView.setSelectedItems(items.length, items);</span>
<a href="#l10.32"></a><span id="l10.32">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.33"></a><span id="l10.33">       &lt;/method&gt;</span>
<a href="#l10.34"></a><span id="l10.34">       &lt;method name=&quot;stopEditing&quot;&gt;</span>
<a href="#l10.35"></a><span id="l10.35">         &lt;parameter name=&quot;saveChanges&quot;/&gt;</span>
<a href="#l10.36"></a><span id="l10.36">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-          if (!this.mEditing)</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-            return;</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+          if (!this.mEditing) {</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+              return;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+          }</span>
<a href="#l10.42"></a><span id="l10.42"> </span>
<a href="#l10.43"></a><span id="l10.43">           this.mEditing = false;</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45">           if (saveChanges &amp;&amp; (this.eventNameTextbox.value != this.mOriginalTextLabel)) {</span>
<a href="#l10.46"></a><span id="l10.46">               this.calendarView.controller.modifyOccurrence(this.mOccurrence,</span>
<a href="#l10.47"></a><span id="l10.47">                                                             null, null,</span>
<a href="#l10.48"></a><span id="l10.48">                                                             this.eventNameTextbox.value);</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50" class="difflineat">@@ -361,18 +363,19 @@</span>
<a href="#l10.51"></a><span id="l10.51">             return;</span>
<a href="#l10.52"></a><span id="l10.52">         }</span>
<a href="#l10.53"></a><span id="l10.53">         let item = this.occurrence;</span>
<a href="#l10.54"></a><span id="l10.54">         if (!isCalendarWritable(item.calendar)</span>
<a href="#l10.55"></a><span id="l10.55">             || !userCanModifyItem(item)</span>
<a href="#l10.56"></a><span id="l10.56">             || (item.calendar instanceof Components.interfaces.calISchedulingSupport &amp;&amp; item.calendar.isInvitation(item))) {</span>
<a href="#l10.57"></a><span id="l10.57">             return;</span>
<a href="#l10.58"></a><span id="l10.58">         }</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-        if (!this.selected)</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+        if (!this.selected) {</span>
<a href="#l10.61"></a><span id="l10.61">             this.select(event);</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+        }</span>
<a href="#l10.63"></a><span id="l10.63">         invokeEventDragSession(item, this);</span>
<a href="#l10.64"></a><span id="l10.64">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l10.65"></a><span id="l10.65">     &lt;/handlers&gt;</span>
<a href="#l10.66"></a><span id="l10.66">   &lt;/binding&gt;</span>
<a href="#l10.67"></a><span id="l10.67"> </span>
<a href="#l10.68"></a><span id="l10.68">   &lt;binding id=&quot;calendar-category-box&quot;&gt;</span>
<a href="#l10.69"></a><span id="l10.69">     &lt;!-- calendar-views.css makes this binding hide if the categories attribute</span>
<a href="#l10.70"></a><span id="l10.70">          is not specified --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -236,18 +236,19 @@ function setupTitle() {</span>
<a href="#l11.4"></a><span id="l11.4">  *</span>
<a href="#l11.5"></a><span id="l11.5">  * @param aItem                 A calendar item for the comparison of the start date property</span>
<a href="#l11.6"></a><span id="l11.6">  * @param calAlarmWidget        The alarm widget item for the start date comparison with the given calendar item</span>
<a href="#l11.7"></a><span id="l11.7">  * @return                      1 - if the calendar item starts before the calendar-alarm-widget</span>
<a href="#l11.8"></a><span id="l11.8">  *                             -1 - if the calendar-alarm-widget starts before the calendar item</span>
<a href="#l11.9"></a><span id="l11.9">  *                              0 - otherwise</span>
<a href="#l11.10"></a><span id="l11.10">  */</span>
<a href="#l11.11"></a><span id="l11.11"> function widgetAlarmComptor(aItem, aWidgetItem) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    if (aItem == null || aWidgetItem == null) return -1;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+    if (aItem == null || aWidgetItem == null) {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+        return -1;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+    }</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">     // Get the dates to compare</span>
<a href="#l11.19"></a><span id="l11.19">     let aDate = aItem[calGetStartDateProp(aItem)];</span>
<a href="#l11.20"></a><span id="l11.20">     let bDate = aWidgetItem[calGetStartDateProp(aWidgetItem)];</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22">     return aDate.compare(bDate);</span>
<a href="#l11.23"></a><span id="l11.23"> }</span>
<a href="#l11.24"></a><span id="l11.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -495,39 +495,45 @@</span>
<a href="#l12.4"></a><span id="l12.4">     &lt;/method&gt;</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">     &lt;method name=&quot;_getListEntriesInt&quot;&gt;</span>
<a href="#l12.7"></a><span id="l12.7">         &lt;parameter name=&quot;mailingList&quot;/&gt;</span>
<a href="#l12.8"></a><span id="l12.8">         &lt;parameter name=&quot;attendees&quot;/&gt;</span>
<a href="#l12.9"></a><span id="l12.9">         &lt;parameter name=&quot;allListsUri&quot;/&gt;</span>
<a href="#l12.10"></a><span id="l12.10">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.11"></a><span id="l12.11">             function in_list(aList, listid) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-              for (var l=0;l&lt;aList.length;l++){</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                if (aList[l]===listid) return true;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+              for (let l = 0; l &lt; aList.length; l++) {</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+                if (aList[l] === listid) {</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+                  return true;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+                }</span>
<a href="#l12.18"></a><span id="l12.18">               }</span>
<a href="#l12.19"></a><span id="l12.19">               return false;</span>
<a href="#l12.20"></a><span id="l12.20">             }</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22">             let addressLists = mailingList.addressLists;</span>
<a href="#l12.23"></a><span id="l12.23">             for (var i=0;i&lt;addressLists.length;i++) {</span>
<a href="#l12.24"></a><span id="l12.24">               let abCard = addressLists.queryElementAt(i, Components.interfaces.nsIAbCard);</span>
<a href="#l12.25"></a><span id="l12.25">               let thisId = abCard.primaryEmail;</span>
<a href="#l12.26"></a><span id="l12.26">               if (abCard.displayName.length &gt; 0) {</span>
<a href="#l12.27"></a><span id="l12.27">                   let rCn = abCard.displayName;</span>
<a href="#l12.28"></a><span id="l12.28">                   if (rCn.includes(&quot;,&quot;)) {</span>
<a href="#l12.29"></a><span id="l12.29">                       rCn = '&quot;' + rCn + '&quot;';</span>
<a href="#l12.30"></a><span id="l12.30">                   }</span>
<a href="#l12.31"></a><span id="l12.31">                   thisId = rCn + &quot; &lt;&quot; + thisId + &quot;&gt;&quot;;</span>
<a href="#l12.32"></a><span id="l12.32">               }</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-              if (in_list(attendees, thisId)) continue;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+              if (in_list(attendees, thisId)) {</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+                continue;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+              }</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38">               if (abCard.displayName.length &gt; 0) {</span>
<a href="#l12.39"></a><span id="l12.39">                 let ml = this._findListInAddrBooks(abCard.displayName);</span>
<a href="#l12.40"></a><span id="l12.40">                 if (null!=ml){</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-                  if (in_list(allListsUri, ml.URI)) continue;</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+                  if (in_list(allListsUri, ml.URI)) {</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+                    continue;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+                  }</span>
<a href="#l12.45"></a><span id="l12.45">                   allListsUri.push(ml.URI);</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47">                   this._getListEntriesInt(ml, attendees, allListsUri);</span>
<a href="#l12.48"></a><span id="l12.48"> </span>
<a href="#l12.49"></a><span id="l12.49">                   continue;</span>
<a href="#l12.50"></a><span id="l12.50">                 }</span>
<a href="#l12.51"></a><span id="l12.51">               }</span>
<a href="#l12.52"></a><span id="l12.52"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -89,18 +89,22 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l13.4"></a><span id="l13.4">         settings.end = theView.endDay.clone();</span>
<a href="#l13.5"></a><span id="l13.5">         settings.end.day += 1;</span>
<a href="#l13.6"></a><span id="l13.6">         settings.start.isDate = false;</span>
<a href="#l13.7"></a><span id="l13.7">         settings.end.isDate = false;</span>
<a href="#l13.8"></a><span id="l13.8">         break;</span>
<a href="#l13.9"></a><span id="l13.9">     case 'selected': {</span>
<a href="#l13.10"></a><span id="l13.10">         let selectedItems = theView.getSelectedItems({});</span>
<a href="#l13.11"></a><span id="l13.11">         settings.eventList = selectedItems.filter(function(item) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            if (cal.isEvent(item) &amp;&amp; !settings.printEvents) return false;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-            if (cal.isToDo(item) &amp;&amp; !settings.printTasks) return false;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+            if (cal.isEvent(item) &amp;&amp; !settings.printEvents) {</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+                return false;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+            }</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+            if (cal.isToDo(item) &amp;&amp; !settings.printTasks) {</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+                return false;</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+            }</span>
<a href="#l13.20"></a><span id="l13.20">             return true;</span>
<a href="#l13.21"></a><span id="l13.21">         });</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">         // If tasks should be printed, also include selected tasks from the</span>
<a href="#l13.24"></a><span id="l13.24">         // opening window.</span>
<a href="#l13.25"></a><span id="l13.25">         if (settings.printTasks) {</span>
<a href="#l13.26"></a><span id="l13.26">             let selectedTasks = window.opener.getSelectedTasks();</span>
<a href="#l13.27"></a><span id="l13.27">             for (var task of selectedTasks) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -139,17 +139,19 @@ function initRefreshInterval() {</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">         return menuitem;</span>
<a href="#l14.6"></a><span id="l14.6">     }</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8">     setBooleanAttribute(&quot;calendar-refreshInterval-row&quot;, &quot;hidden&quot;, !gCalendar.canRefresh);</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">     if (gCalendar.canRefresh) {</span>
<a href="#l14.11"></a><span id="l14.11">         let refreshInterval = gCalendar.getProperty(&quot;refreshInterval&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        if (refreshInterval === null) refreshInterval = 30;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        if (refreshInterval === null) {</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+            refreshInterval = 30;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+        }</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">         let foundValue = false;</span>
<a href="#l14.18"></a><span id="l14.18">         let separator = document.getElementById(&quot;calendar-refreshInterval-manual-separator&quot;);</span>
<a href="#l14.19"></a><span id="l14.19">         let menulist = document.getElementById(&quot;calendar-refreshInterval-menulist&quot;);</span>
<a href="#l14.20"></a><span id="l14.20">         for (let min of [1, 5, 15, 30, 60]) {</span>
<a href="#l14.21"></a><span id="l14.21">             let menuitem = createMenuItem(min);</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23">             separator.parentNode.insertBefore(menuitem, separator);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/preferences/categories.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/preferences/categories.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -71,18 +71,19 @@ var gCategoriesPane = {</span>
<a href="#l15.4"></a><span id="l15.4">     updateCategoryList: function gCP_updateCategoryList () {</span>
<a href="#l15.5"></a><span id="l15.5">         this.updatePrefs();</span>
<a href="#l15.6"></a><span id="l15.6">         let listbox = document.getElementById(&quot;categorieslist&quot;);</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">         listbox.clearSelection();</span>
<a href="#l15.9"></a><span id="l15.9">         this.updateButtons();</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        while (listbox.lastChild.id != &quot;categoryColumns&quot;)</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        while (listbox.lastChild.id != &quot;categoryColumns&quot;) {</span>
<a href="#l15.14"></a><span id="l15.14">             listbox.lastChild.remove();</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        }</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17">         for (var i=0; i &lt; gCategoryList.length; i++) {</span>
<a href="#l15.18"></a><span id="l15.18">             var newListItem = document.createElement(&quot;listitem&quot;);</span>
<a href="#l15.19"></a><span id="l15.19">             var categoryName = document.createElement(&quot;listcell&quot;);</span>
<a href="#l15.20"></a><span id="l15.20">             categoryName.setAttribute(&quot;id&quot;, gCategoryList[i]);</span>
<a href="#l15.21"></a><span id="l15.21">             categoryName.setAttribute(&quot;label&quot;, gCategoryList[i]);</span>
<a href="#l15.22"></a><span id="l15.22">             var categoryNameFix = formatStringForCSSRule(gCategoryList[i]);</span>
<a href="#l15.23"></a><span id="l15.23">             var categoryColor = document.createElement(&quot;listcell&quot;);</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineat">@@ -184,41 +185,45 @@ var gCategoriesPane = {</span>
<a href="#l15.25"></a><span id="l15.25">      * @param categoryName      The name of the category.</span>
<a href="#l15.26"></a><span id="l15.26">      * @param categoryColor     The color of the category</span>
<a href="#l15.27"></a><span id="l15.27">      */</span>
<a href="#l15.28"></a><span id="l15.28">     saveCategory: function gCP_saveCateogry(categoryName, categoryColor) {</span>
<a href="#l15.29"></a><span id="l15.29">         var list = document.getElementById(&quot;categorieslist&quot;);</span>
<a href="#l15.30"></a><span id="l15.30">         // Check to make sure another category doesn't have the same name</span>
<a href="#l15.31"></a><span id="l15.31">         var toBeDeleted = -1;</span>
<a href="#l15.32"></a><span id="l15.32">         for (var i=0; i &lt; gCategoryList.length; i++) {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-            if (i == list.selectedIndex)</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+            if (i == list.selectedIndex) {</span>
<a href="#l15.35"></a><span id="l15.35">                 continue;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+            }</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+</span>
<a href="#l15.38"></a><span id="l15.38">             if (categoryName.toLowerCase() == gCategoryList[i].toLowerCase()) {</span>
<a href="#l15.39"></a><span id="l15.39">                 if (Services.prompt.confirm(null, overwriteTitle, overwrite)) {</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-                    if (list.selectedIndex != -1)</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+                    if (list.selectedIndex != -1) {</span>
<a href="#l15.42"></a><span id="l15.42">                         // Don't delete the old category yet. It will mess up indices.</span>
<a href="#l15.43"></a><span id="l15.43">                         toBeDeleted = list.selectedIndex;</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+                    }</span>
<a href="#l15.45"></a><span id="l15.45">                     list.selectedIndex = i;</span>
<a href="#l15.46"></a><span id="l15.46">                 } else {</span>
<a href="#l15.47"></a><span id="l15.47">                     return;</span>
<a href="#l15.48"></a><span id="l15.48">                 }</span>
<a href="#l15.49"></a><span id="l15.49">             }</span>
<a href="#l15.50"></a><span id="l15.50">         }</span>
<a href="#l15.51"></a><span id="l15.51"> </span>
<a href="#l15.52"></a><span id="l15.52">         if (categoryName.length == 0) {</span>
<a href="#l15.53"></a><span id="l15.53">             Services.prompt.alert(null, null, noBlankCategories);</span>
<a href="#l15.54"></a><span id="l15.54">             return;</span>
<a href="#l15.55"></a><span id="l15.55">         }</span>
<a href="#l15.56"></a><span id="l15.56"> </span>
<a href="#l15.57"></a><span id="l15.57">         var categoryNameFix = formatStringForCSSRule(categoryName);</span>
<a href="#l15.58"></a><span id="l15.58">         if (list.selectedIndex == -1) {</span>
<a href="#l15.59"></a><span id="l15.59">             this.backupData(categoryNameFix);</span>
<a href="#l15.60"></a><span id="l15.60">             gCategoryList.push(categoryName);</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-            if (categoryColor)</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+            if (categoryColor) {</span>
<a href="#l15.63"></a><span id="l15.63">                 categoryPrefBranch.setCharPref(categoryNameFix, categoryColor);</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+            }</span>
<a href="#l15.65"></a><span id="l15.65">         } else {</span>
<a href="#l15.66"></a><span id="l15.66">             this.backupData(categoryNameFix);</span>
<a href="#l15.67"></a><span id="l15.67">             gCategoryList.splice(list.selectedIndex, 1, categoryName);</span>
<a href="#l15.68"></a><span id="l15.68">             if (categoryColor) {</span>
<a href="#l15.69"></a><span id="l15.69">                 categoryPrefBranch.setCharPref(categoryNameFix, categoryColor);</span>
<a href="#l15.70"></a><span id="l15.70">             } else {</span>
<a href="#l15.71"></a><span id="l15.71">                 try {</span>
<a href="#l15.72"></a><span id="l15.72">                     categoryPrefBranch.clearUserPref(categoryNameFix);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -152,30 +152,32 @@</span>
<a href="#l16.4"></a><span id="l16.4">          this.mScrollYearsHandler = null;</span>
<a href="#l16.5"></a><span id="l16.5">        ]]&gt;&lt;/destructor&gt;</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">        &lt;method name=&quot;showPopupList&quot;&gt;</span>
<a href="#l16.8"></a><span id="l16.8">          &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l16.9"></a><span id="l16.9">          &lt;parameter name=&quot;aPopupAnonId&quot;/&gt;</span>
<a href="#l16.10"></a><span id="l16.10">           &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.11"></a><span id="l16.11">            // Close open popups (if any), to prevent linux crashes</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-           if (this.mPopup)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+           if (this.mPopup) {</span>
<a href="#l16.14"></a><span id="l16.14">                this.mPopup.hidePopup();</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+           }</span>
<a href="#l16.16"></a><span id="l16.16">            this.mPopup = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, aPopupAnonId);</span>
<a href="#l16.17"></a><span id="l16.17">            this.mPopup.openPopup(aEvent.target, &quot;after_start&quot;);</span>
<a href="#l16.18"></a><span id="l16.18">          ]]&gt;&lt;/body&gt;</span>
<a href="#l16.19"></a><span id="l16.19">        &lt;/method&gt;</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">        &lt;method name=&quot;hidePopupList&quot;&gt;</span>
<a href="#l16.22"></a><span id="l16.22">          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.23"></a><span id="l16.23">            // Close open popups (if any)</span>
<a href="#l16.24"></a><span id="l16.24">            let popup = this.mPopup;</span>
<a href="#l16.25"></a><span id="l16.25">            this.mPopup = null;</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-           if (popup)</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+           if (popup) {</span>
<a href="#l16.28"></a><span id="l16.28">                popup.hidePopup();</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+           }</span>
<a href="#l16.30"></a><span id="l16.30">          ]]&gt;&lt;/body&gt;</span>
<a href="#l16.31"></a><span id="l16.31">        &lt;/method&gt;</span>
<a href="#l16.32"></a><span id="l16.32">        &lt;method name=&quot;firePopupListHidden&quot;&gt;</span>
<a href="#l16.33"></a><span id="l16.33">          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.34"></a><span id="l16.34">            if (this.mPopup) {</span>
<a href="#l16.35"></a><span id="l16.35">                this.mPopup = null;</span>
<a href="#l16.36"></a><span id="l16.36">                this.kMinimonth.fireEvent(&quot;popuplisthidden&quot;);</span>
<a href="#l16.37"></a><span id="l16.37">            }</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineat">@@ -581,18 +583,19 @@</span>
<a href="#l16.39"></a><span id="l16.39">         // Cache the result so the compare isn't called in each iteration.</span>
<a href="#l16.40"></a><span id="l16.40">         let compareResult = (start.compare(end) == 0 ? 1 : 0);</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42">         // Setup the busy days.</span>
<a href="#l16.43"></a><span id="l16.43">         while (current.compare(end) &lt; compareResult) {</span>
<a href="#l16.44"></a><span id="l16.44">             let box = this.getBoxForDate(current);</span>
<a href="#l16.45"></a><span id="l16.45">             if (box) {</span>
<a href="#l16.46"></a><span id="l16.46">                 let busyCalendars = this.parseBoxBusy(box);</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-                if (!busyCalendars[aOccurrence.calendar.id])</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+                if (!busyCalendars[aOccurrence.calendar.id]) {</span>
<a href="#l16.49"></a><span id="l16.49">                     busyCalendars[aOccurrence.calendar.id] = 0;</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+                }</span>
<a href="#l16.51"></a><span id="l16.51">                 busyCalendars[aOccurrence.calendar.id] += (aState ? 1 : -1);</span>
<a href="#l16.52"></a><span id="l16.52">                 this.updateBoxBusy(box, busyCalendars);</span>
<a href="#l16.53"></a><span id="l16.53">             }</span>
<a href="#l16.54"></a><span id="l16.54">             current.day++;</span>
<a href="#l16.55"></a><span id="l16.55">         }</span>
<a href="#l16.56"></a><span id="l16.56">         ]]&gt;&lt;/body&gt;</span>
<a href="#l16.57"></a><span id="l16.57">       &lt;/method&gt;</span>
<a href="#l16.58"></a><span id="l16.58"> </span>
<a href="#l16.59"></a><span id="l16.59" class="difflineat">@@ -753,18 +756,19 @@</span>
<a href="#l16.60"></a><span id="l16.60">               //    and ALL localized day names share same prefix (as in Chinese),</span>
<a href="#l16.61"></a><span id="l16.61">               //    then trim shared &quot;day-&quot; prefix.</span>
<a href="#l16.62"></a><span id="l16.62">               if (dayList.some(function(dayAbbr){ return dayAbbr.length &gt; 2; })) {</span>
<a href="#l16.63"></a><span id="l16.63">                   for (var endPrefix = 0; endPrefix &lt; minLength; endPrefix++) {</span>
<a href="#l16.64"></a><span id="l16.64">                       var c = dayList[0][endPrefix];</span>
<a href="#l16.65"></a><span id="l16.65">                       if (dayList.some(function(dayAbbr) {</span>
<a href="#l16.66"></a><span id="l16.66">                                              return dayAbbr[endPrefix] != c; })) {</span>
<a href="#l16.67"></a><span id="l16.67">                           if (endPrefix &gt; 0) {</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-                              for (i = 0; i &lt; dayList.length; i++) // trim prefix chars.</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+                              for (i = 0; i &lt; dayList.length; i++) { // trim prefix chars.</span>
<a href="#l16.70"></a><span id="l16.70">                                   dayList[i] = dayList[i].substring(endPrefix);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+                              }</span>
<a href="#l16.72"></a><span id="l16.72">                           }</span>
<a href="#l16.73"></a><span id="l16.73">                           break;</span>
<a href="#l16.74"></a><span id="l16.74">                       }</span>
<a href="#l16.75"></a><span id="l16.75">                   }</span>
<a href="#l16.76"></a><span id="l16.76">               }</span>
<a href="#l16.77"></a><span id="l16.77">               // 3. trim each day abbreviation to 1 char if unique, else 2 chars.</span>
<a href="#l16.78"></a><span id="l16.78">               for (i = 0; i &lt; dayList.length; i++) {</span>
<a href="#l16.79"></a><span id="l16.79">                   var foundMatch = 1;</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineat">@@ -888,17 +892,21 @@</span>
<a href="#l16.81"></a><span id="l16.81">                     day.setAttribute(&quot;value&quot;, date.getDate());</span>
<a href="#l16.82"></a><span id="l16.82">                     date.setDate(date.getDate() + 1);</span>
<a href="#l16.83"></a><span id="l16.83"> </span>
<a href="#l16.84"></a><span id="l16.84">                     if (monthChanged) {</span>
<a href="#l16.85"></a><span id="l16.85">                         this.resetAttributesForDate(day.date);</span>
<a href="#l16.86"></a><span id="l16.86">                     }</span>
<a href="#l16.87"></a><span id="l16.87">                 }</span>
<a href="#l16.88"></a><span id="l16.88">             }</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineminus">-            if (monthChanged) this.fireEvent('monthchange');</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+            if (monthChanged) {</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+                this.fireEvent('monthchange');</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+            }</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+</span>
<a href="#l16.95"></a><span id="l16.95">             if (this.getAttribute(&quot;freebusy&quot;) == &quot;true&quot;) {</span>
<a href="#l16.96"></a><span id="l16.96">                 this.getItems();</span>
<a href="#l16.97"></a><span id="l16.97">             }</span>
<a href="#l16.98"></a><span id="l16.98">         ]]&gt;&lt;/body&gt;</span>
<a href="#l16.99"></a><span id="l16.99">       &lt;/method&gt;</span>
<a href="#l16.100"></a><span id="l16.100">       &lt;!--Attention - duplicate!!!!--&gt;</span>
<a href="#l16.101"></a><span id="l16.101">       &lt;method name=&quot;fireEvent&quot;&gt;</span>
<a href="#l16.102"></a><span id="l16.102">         &lt;parameter name=&quot;aEventName&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1191,17 +1191,19 @@ ItipItemFinder.prototype = {</span>
<a href="#l17.4"></a><span id="l17.4">         this._unobserveChanges();</span>
<a href="#l17.5"></a><span id="l17.5">         this.mItipItem.targetCalendar.getItem(this.mSearchId, this);</span>
<a href="#l17.6"></a><span id="l17.6">     },</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">     _observeChanges: function _observeChanges(aCalendar) {</span>
<a href="#l17.9"></a><span id="l17.9">         this._unobserveChanges();</span>
<a href="#l17.10"></a><span id="l17.10">         this.mObservedCalendar = aCalendar;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        if (this.mObservedCalendar) this.mObservedCalendar.addObserver(this);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        if (this.mObservedCalendar) {</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+            this.mObservedCalendar.addObserver(this);</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+        }</span>
<a href="#l17.16"></a><span id="l17.16">     },</span>
<a href="#l17.17"></a><span id="l17.17">     _unobserveChanges: function _unobserveChanges() {</span>
<a href="#l17.18"></a><span id="l17.18">         if (this.mObservedCalendar) {</span>
<a href="#l17.19"></a><span id="l17.19">             this.mObservedCalendar.removeObserver(this);</span>
<a href="#l17.20"></a><span id="l17.20">             this.mObservedCalendar = null;</span>
<a href="#l17.21"></a><span id="l17.21">         }</span>
<a href="#l17.22"></a><span id="l17.22">     },</span>
<a href="#l17.23"></a><span id="l17.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/modules/calPrintUtils.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/modules/calPrintUtils.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -181,19 +181,20 @@ cal.print = {</span>
<a href="#l18.4"></a><span id="l18.4">         end.isDate = true;</span>
<a href="#l18.5"></a><span id="l18.5">         if (start.compare(end) == 0) {</span>
<a href="#l18.6"></a><span id="l18.6">             // Events that start and end in the same day.</span>
<a href="#l18.7"></a><span id="l18.7">             return dateFormatter.formatTimeInterval(startDate, endDate);</span>
<a href="#l18.8"></a><span id="l18.8">         } else {</span>
<a href="#l18.9"></a><span id="l18.9">             // Events that span two or more days.</span>
<a href="#l18.10"></a><span id="l18.10">             let compareStart = aBoxDate.compare(start);</span>
<a href="#l18.11"></a><span id="l18.11">             let compareEnd = aBoxDate.compare(end);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-            if (compareStart == 0)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+            if (compareStart == 0) {</span>
<a href="#l18.14"></a><span id="l18.14">                 return &quot;\u21e4 &quot; + dateFormatter.formatTime(startDate); // unicode ''</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-            else if (compareStart &gt; 0 &amp;&amp; compareEnd &lt; 0)</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+            } else if (compareStart &gt; 0 &amp;&amp; compareEnd &lt; 0) {</span>
<a href="#l18.17"></a><span id="l18.17">                 return &quot;\u21ff&quot;;                                        // unicode ''</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-            else if (compareEnd == 0)</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+            } else if (compareEnd == 0) {</span>
<a href="#l18.20"></a><span id="l18.20">                 return &quot;\u21e5 &quot; + dateFormatter.formatTime(endDate);   // unicode ''</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-            else</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+            } else {</span>
<a href="#l18.23"></a><span id="l18.23">                 return &quot;&quot;;</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+            }</span>
<a href="#l18.25"></a><span id="l18.25">         }</span>
<a href="#l18.26"></a><span id="l18.26">     }</span>
<a href="#l18.27"></a><span id="l18.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -820,33 +820,37 @@ cal.ProviderBase.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5">         let org = aItem.organizer;</span>
<a href="#l19.6"></a><span id="l19.6">         if (!org || !org.id) {</span>
<a href="#l19.7"></a><span id="l19.7">             // HACK</span>
<a href="#l19.8"></a><span id="l19.8">             // if we don't have an organizer, this is perhaps because it's an exception</span>
<a href="#l19.9"></a><span id="l19.9">             // to a recurring event. We check the parent item.</span>
<a href="#l19.10"></a><span id="l19.10">             if (aItem.parentItem) {</span>
<a href="#l19.11"></a><span id="l19.11">                 org = aItem.parentItem.organizer;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-                if (!org || !org.id) return false;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+                if (!org || !org.id) {</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+                    return false;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+                }</span>
<a href="#l19.16"></a><span id="l19.16">             } else {</span>
<a href="#l19.17"></a><span id="l19.17">                 return false;</span>
<a href="#l19.18"></a><span id="l19.18">             }</span>
<a href="#l19.19"></a><span id="l19.19">         }</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21">         // We check if :</span>
<a href="#l19.22"></a><span id="l19.22">         // - the organizer of the event is NOT within the owner's identities of this calendar</span>
<a href="#l19.23"></a><span id="l19.23">         // - if the one of the owner's identities of this calendar is in the attendees</span>
<a href="#l19.24"></a><span id="l19.24">         let ownerIdentities = this.mACLEntry.getOwnerIdentities({});</span>
<a href="#l19.25"></a><span id="l19.25">         for (let i = 0; i &lt; ownerIdentities.length; i++) {</span>
<a href="#l19.26"></a><span id="l19.26">             let identity = &quot;mailto:&quot; + ownerIdentities[i].email.toLowerCase();</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">-            if (org.id.toLowerCase() == identity)</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+            if (org.id.toLowerCase() == identity) {</span>
<a href="#l19.29"></a><span id="l19.29">                 return false;</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+            }</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-            if (aItem.getAttendeeById(identity) != null)</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+            if (aItem.getAttendeeById(identity) != null) {</span>
<a href="#l19.34"></a><span id="l19.34">                 return true;</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+            }</span>
<a href="#l19.36"></a><span id="l19.36">         }</span>
<a href="#l19.37"></a><span id="l19.37"> </span>
<a href="#l19.38"></a><span id="l19.38">         return false;</span>
<a href="#l19.39"></a><span id="l19.39">     },</span>
<a href="#l19.40"></a><span id="l19.40"> </span>
<a href="#l19.41"></a><span id="l19.41">     getInvitedAttendee: function cPB_getInvitedAttendee(aItem) {</span>
<a href="#l19.42"></a><span id="l19.42">         let id = this.getProperty(&quot;organizerId&quot;);</span>
<a href="#l19.43"></a><span id="l19.43">         let attendee = (id ? aItem.getAttendeeById(id) : null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -469,37 +469,43 @@ var cal = {</span>
<a href="#l20.4"></a><span id="l20.4">       } else if (a &gt; b) {</span>
<a href="#l20.5"></a><span id="l20.5">         return 1;</span>
<a href="#l20.6"></a><span id="l20.6">       } else {</span>
<a href="#l20.7"></a><span id="l20.7">         return 0;</span>
<a href="#l20.8"></a><span id="l20.8">       }</span>
<a href="#l20.9"></a><span id="l20.9">     },</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">     compareNativeTimeFilledAsc: function cal_compareNativeTimeFilledAsc(a, b) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      if (a == b)</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      if (a == b) {</span>
<a href="#l20.14"></a><span id="l20.14">         return 0;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+      }</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17">       // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-      if (a == -62168601600000000) // value for (0000/00/00 00:00:00)</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+      if (a == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l20.20"></a><span id="l20.20">         return 1;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-      if (b == -62168601600000000) // value for (0000/00/00 00:00:00)</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+      }</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+      if (b == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l20.24"></a><span id="l20.24">         return -1;</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+      }</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">       return (a &lt; b ? -1 : 1);</span>
<a href="#l20.28"></a><span id="l20.28">     },</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30">     compareNativeTimeFilledDesc: function cal_compareNativeTimeFilledDesc(a, b) {</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-      if (a == b)</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+      if (a == b) {</span>
<a href="#l20.33"></a><span id="l20.33">         return 0;</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+      }</span>
<a href="#l20.35"></a><span id="l20.35"> </span>
<a href="#l20.36"></a><span id="l20.36">       // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-      if (a == -62168601600000000) // value for (0000/00/00 00:00:00)</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+      if (a == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l20.39"></a><span id="l20.39">         return 1;</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-      if (b == -62168601600000000) // value for (0000/00/00 00:00:00)</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+      }</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+      if (b == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l20.43"></a><span id="l20.43">         return -1;</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+      }</span>
<a href="#l20.45"></a><span id="l20.45"> </span>
<a href="#l20.46"></a><span id="l20.46">       return (a &lt; b ? 1 : -1);</span>
<a href="#l20.47"></a><span id="l20.47">     },</span>
<a href="#l20.48"></a><span id="l20.48"> </span>
<a href="#l20.49"></a><span id="l20.49">     compareNumber: function cal_compareNumber(a, b) {</span>
<a href="#l20.50"></a><span id="l20.50">       a = Number(a);</span>
<a href="#l20.51"></a><span id="l20.51">       b = Number(b);</span>
<a href="#l20.52"></a><span id="l20.52">       if (a &lt; b) {</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineat">@@ -890,18 +896,20 @@ var cal = {</span>
<a href="#l20.54"></a><span id="l20.54">      * // GOOD USAGE:</span>
<a href="#l20.55"></a><span id="l20.55">      * foo = cal.wrapInstance(foo, Ci.nsIBar);</span>
<a href="#l20.56"></a><span id="l20.56">      * if (foo) {</span>
<a href="#l20.57"></a><span id="l20.57">      *   foo.barMethod();</span>
<a href="#l20.58"></a><span id="l20.58">      *   }</span>
<a href="#l20.59"></a><span id="l20.59">      *</span>
<a href="#l20.60"></a><span id="l20.60">      */</span>
<a href="#l20.61"></a><span id="l20.61">     wrapInstance: function wrapInstance(aObj, aInterface) {</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-        if (!aObj)</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+        if (!aObj) {</span>
<a href="#l20.64"></a><span id="l20.64">             return null;</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+        }</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+</span>
<a href="#l20.67"></a><span id="l20.67">         try {</span>
<a href="#l20.68"></a><span id="l20.68">             return aObj.QueryInterface(aInterface);</span>
<a href="#l20.69"></a><span id="l20.69">         } catch (e) {</span>
<a href="#l20.70"></a><span id="l20.70">             return null;</span>
<a href="#l20.71"></a><span id="l20.71">         }</span>
<a href="#l20.72"></a><span id="l20.72">     },</span>
<a href="#l20.73"></a><span id="l20.73"> </span>
<a href="#l20.74"></a><span id="l20.74">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/modules/calViewUtils.jsm</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/modules/calViewUtils.jsm</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -9,38 +9,56 @@ cal.view = {</span>
<a href="#l21.4"></a><span id="l21.4">     /**</span>
<a href="#l21.5"></a><span id="l21.5">       - * Item comparator for inserting items into dayboxes.</span>
<a href="#l21.6"></a><span id="l21.6">       - *</span>
<a href="#l21.7"></a><span id="l21.7">       - * @param a     The first item</span>
<a href="#l21.8"></a><span id="l21.8">       - * @param b     The second item</span>
<a href="#l21.9"></a><span id="l21.9">       - * @return      The usual -1, 0, 1</span>
<a href="#l21.10"></a><span id="l21.10">       - */</span>
<a href="#l21.11"></a><span id="l21.11">     compareItems: function(a, b) {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-        if (!a) return -1;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-        if (!b) return 1;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+        if (!a) {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+            return -1;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+        }</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+        if (!b) {</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+            return 1;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+        }</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21">         let aIsEvent = cal.isEvent(a);</span>
<a href="#l21.22"></a><span id="l21.22">         let aIsTodo = cal.isToDo(a);</span>
<a href="#l21.23"></a><span id="l21.23"> </span>
<a href="#l21.24"></a><span id="l21.24">         let bIsEvent = cal.isEvent(b);</span>
<a href="#l21.25"></a><span id="l21.25">         let bIsTodo = cal.isToDo(b);</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27">         // sort todos before events</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-        if (aIsTodo &amp;&amp; bIsEvent) return -1;</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-        if (aIsEvent &amp;&amp; bIsTodo) return 1;</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+        if (aIsTodo &amp;&amp; bIsEvent) {</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+            return -1;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+        }</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+        if (aIsEvent &amp;&amp; bIsTodo) {</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+            return 1;</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+        }</span>
<a href="#l21.36"></a><span id="l21.36"> </span>
<a href="#l21.37"></a><span id="l21.37">         // todos are kept equal</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-        if (aIsTodo &amp;&amp; bIsTodo) return 0;</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+        if (aIsTodo &amp;&amp; bIsTodo) {</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+            return 0;</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+        }</span>
<a href="#l21.42"></a><span id="l21.42"> </span>
<a href="#l21.43"></a><span id="l21.43">         // sort all day events before events with a duration</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-        if (a.startDate.isDate &amp;&amp; !b.startDate.isDate) return -1;</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-        if (!a.startDate.isDate &amp;&amp; b.startDate.isDate) return 1;</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+        if (a.startDate.isDate &amp;&amp; !b.startDate.isDate) {</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+            return -1;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+        }</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+        if (!a.startDate.isDate &amp;&amp; b.startDate.isDate) {</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+            return 1;</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+        }</span>
<a href="#l21.52"></a><span id="l21.52"> </span>
<a href="#l21.53"></a><span id="l21.53">         let cmp = a.startDate.compare(b.startDate);</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-        if (cmp != 0) return cmp;</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+        if (cmp != 0) {</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+            return cmp;</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+        }</span>
<a href="#l21.58"></a><span id="l21.58"> </span>
<a href="#l21.59"></a><span id="l21.59">         cmp = a.endDate.compare(b.endDate);</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-        if (cmp != 0) return cmp;</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+        if (cmp != 0) {</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+            return cmp;</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+        }</span>
<a href="#l21.64"></a><span id="l21.64"> </span>
<a href="#l21.65"></a><span id="l21.65">         cmp = (a.title &gt; b.title) - (a.title &lt; b.title);</span>
<a href="#l21.66"></a><span id="l21.66">         return cmp;</span>
<a href="#l21.67"></a><span id="l21.67">     }</span>
<a href="#l21.68"></a><span id="l21.68"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/modules/calXMLUtils.jsm</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/modules/calXMLUtils.jsm</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -161,14 +161,14 @@ cal.xml.serializeDOM = function(doc) {</span>
<a href="#l22.4"></a><span id="l22.4">  * @return              The escaped string</span>
<a href="#l22.5"></a><span id="l22.5">  */</span>
<a href="#l22.6"></a><span id="l22.6"> cal.xml.escapeString = function escapeString(str, isAttribute) {</span>
<a href="#l22.7"></a><span id="l22.7">     return str.replace(/[&amp;&lt;&gt;'&quot;]/g, function(chr) {</span>
<a href="#l22.8"></a><span id="l22.8">         switch (chr) {</span>
<a href="#l22.9"></a><span id="l22.9">             case &quot;&amp;&quot;: return &quot;&amp;amp;&quot;;</span>
<a href="#l22.10"></a><span id="l22.10">             case &quot;&lt;&quot;: return &quot;&amp;lt;&quot;;</span>
<a href="#l22.11"></a><span id="l22.11">             case &quot;&gt;&quot;: return &quot;&amp;gt;&quot;;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-            case '&quot;': if (isAttribute) return &quot;&amp;quot;&quot;;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-            case &quot;'&quot;: if (isAttribute) return &quot;&amp;apos;&quot;;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+            case '&quot;': return (isAttribute ? &quot;&amp;quot;&quot; : chr);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+            case &quot;'&quot;: return (isAttribute ? &quot;&amp;apos;&quot; : chr);</span>
<a href="#l22.16"></a><span id="l22.16">             default: return chr;</span>
<a href="#l22.17"></a><span id="l22.17">         }</span>
<a href="#l22.18"></a><span id="l22.18">     });</span>
<a href="#l22.19"></a><span id="l22.19"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -77,18 +77,19 @@ calAlarm.prototype = {</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">         // Properties</span>
<a href="#l23.6"></a><span id="l23.6">         let e = this.mProperties.enumerator;</span>
<a href="#l23.7"></a><span id="l23.7">         while (e.hasMoreElements()) {</span>
<a href="#l23.8"></a><span id="l23.8">             let prop = e.getNext();</span>
<a href="#l23.9"></a><span id="l23.9">             let val = prop.value;</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">             if (prop.value instanceof Components.interfaces.calIDateTime) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-                if (prop.value.isMutable)</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+                if (prop.value.isMutable) {</span>
<a href="#l23.14"></a><span id="l23.14">                     prop.value.makeImmutable();</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+                }</span>
<a href="#l23.16"></a><span id="l23.16">             }</span>
<a href="#l23.17"></a><span id="l23.17">         }</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">         this.mImmutable = true;</span>
<a href="#l23.20"></a><span id="l23.20">     },</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22">     clone: function cA_clone() {</span>
<a href="#l23.23"></a><span id="l23.23">         let m = new calAlarm();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -579,13 +579,15 @@ calAlarmService.prototype = {</span>
<a href="#l24.4"></a><span id="l24.4">             !aItem.calendar.getProperty(&quot;disabled&quot;) &amp;&amp;</span>
<a href="#l24.5"></a><span id="l24.5">             aItem.getProperty(&quot;STATUS&quot;) != &quot;CANCELLED&quot;) {</span>
<a href="#l24.6"></a><span id="l24.6">             this.mObservers.notify(&quot;onAlarm&quot;, [aItem, aAlarm]);</span>
<a href="#l24.7"></a><span id="l24.7">         }</span>
<a href="#l24.8"></a><span id="l24.8">     },</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10">     get isLoading() {</span>
<a href="#l24.11"></a><span id="l24.11">         for (let calId in this.mLoadedCalendars) {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-            if (!this.mLoadedCalendars[calId]) return true;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+            if (!this.mLoadedCalendars[calId]) {</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+                return true;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+            }</span>
<a href="#l24.16"></a><span id="l24.16">         }</span>
<a href="#l24.17"></a><span id="l24.17">         return false;</span>
<a href="#l24.18"></a><span id="l24.18">     }</span>
<a href="#l24.19"></a><span id="l24.19"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -54,18 +54,19 @@ function calDateTimeFormatter() {</span>
<a href="#l25.4"></a><span id="l25.4">         }</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">         // On Unix extended/long date format may be created using %Ex instead</span>
<a href="#l25.7"></a><span id="l25.7">         // of %x. Some systems may not support it and return &quot;Ex&quot; or same as</span>
<a href="#l25.8"></a><span id="l25.8">         // short string. In that case, don't use long date service, use a</span>
<a href="#l25.9"></a><span id="l25.9">         // workaround hack instead.</span>
<a href="#l25.10"></a><span id="l25.10">         if (longProbeString == null ||</span>
<a href="#l25.11"></a><span id="l25.11">             longProbeString.length &lt; 4 ||</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-            longProbeString == probeStringA)</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-           this.mUseLongDateService = false;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+            longProbeString == probeStringA) {</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+            this.mUseLongDateService = false;</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+        }</span>
<a href="#l25.17"></a><span id="l25.17">     } catch (e) {</span>
<a href="#l25.18"></a><span id="l25.18">         this.mUseLongDateService = false;</span>
<a href="#l25.19"></a><span id="l25.19">     }</span>
<a href="#l25.20"></a><span id="l25.20"> }</span>
<a href="#l25.21"></a><span id="l25.21"> var calDateTimeFormatterClassID = Components.ID(&quot;{4123da9a-f047-42da-a7d0-cc4175b9f36a}&quot;);</span>
<a href="#l25.22"></a><span id="l25.22"> var calDateTimeFormatterInterfaces = [Components.interfaces.calIDateTimeFormatter];</span>
<a href="#l25.23"></a><span id="l25.23"> calDateTimeFormatter.prototype = {</span>
<a href="#l25.24"></a><span id="l25.24">     classID: calDateTimeFormatterClassID,</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineat">@@ -127,18 +128,19 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l25.26"></a><span id="l25.26">         if (this.mMonthFirst) {</span>
<a href="#l25.27"></a><span id="l25.27">             return this.shortMonthName(aDate.month) + &quot; &quot; + this.formatDayWithOrdinal(aDate.day);</span>
<a href="#l25.28"></a><span id="l25.28">         } else {</span>
<a href="#l25.29"></a><span id="l25.29">             return this.formatDayWithOrdinal(aDate.day) + &quot; &quot; + this.shortMonthName(aDate.month);</span>
<a href="#l25.30"></a><span id="l25.30">         }</span>
<a href="#l25.31"></a><span id="l25.31">     },</span>
<a href="#l25.32"></a><span id="l25.32"> </span>
<a href="#l25.33"></a><span id="l25.33">     formatTime: function formatTime(aDate) {</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-        if (aDate.isDate)</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+        if (aDate.isDate) {</span>
<a href="#l25.36"></a><span id="l25.36">             return this.mDateStringBundle.GetStringFromName(&quot;AllDay&quot;);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+        }</span>
<a href="#l25.38"></a><span id="l25.38"> </span>
<a href="#l25.39"></a><span id="l25.39">         return this.mDateService.FormatTime(&quot;&quot;,</span>
<a href="#l25.40"></a><span id="l25.40">                                             nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l25.41"></a><span id="l25.41">                                             aDate.hour,</span>
<a href="#l25.42"></a><span id="l25.42">                                             aDate.minute,</span>
<a href="#l25.43"></a><span id="l25.43">                                             0);</span>
<a href="#l25.44"></a><span id="l25.44">     },</span>
<a href="#l25.45"></a><span id="l25.45"> </span>
<a href="#l25.46"></a><span id="l25.46" class="difflineat">@@ -150,19 +152,25 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l25.47"></a><span id="l25.47">         if (timeBeforeDate) {</span>
<a href="#l25.48"></a><span id="l25.48">             return formattedTime + &quot; &quot; + formattedDate;</span>
<a href="#l25.49"></a><span id="l25.49">         } else {</span>
<a href="#l25.50"></a><span id="l25.50">             return formattedDate + &quot; &quot; + formattedTime;</span>
<a href="#l25.51"></a><span id="l25.51">         }</span>
<a href="#l25.52"></a><span id="l25.52">     },</span>
<a href="#l25.53"></a><span id="l25.53"> </span>
<a href="#l25.54"></a><span id="l25.54">     formatTimeInterval: function formatTimeInterval(aStartDate, aEndDate) {</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-        if (!aStartDate &amp;&amp; aEndDate) return this.formatTime(aEndDate);</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-        if (!aEndDate &amp;&amp; aStartDate) return this.formatTime(aStartDate);</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineminus">-        if (!aStartDate &amp;&amp; !aEndDate) return &quot;&quot;;</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+        if (!aStartDate &amp;&amp; aEndDate) {</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+            return this.formatTime(aEndDate);</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineplus">+        }</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineplus">+        if (!aEndDate &amp;&amp; aStartDate) {</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineplus">+            return this.formatTime(aStartDate);</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineplus">+        }</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineplus">+        if (!aStartDate &amp;&amp; !aEndDate) {</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineplus">+            return &quot;&quot;;</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineplus">+        }</span>
<a href="#l25.67"></a><span id="l25.67"> </span>
<a href="#l25.68"></a><span id="l25.68">         // TODO do we need l10n for this?</span>
<a href="#l25.69"></a><span id="l25.69">         // TODO should we check for the same day? The caller should know what</span>
<a href="#l25.70"></a><span id="l25.70">         // he is doing...</span>
<a href="#l25.71"></a><span id="l25.71">         return this.formatTime(aStartDate) + &quot;\u2013&quot; + this.formatTime(aEndDate);</span>
<a href="#l25.72"></a><span id="l25.72">     },</span>
<a href="#l25.73"></a><span id="l25.73"> </span>
<a href="#l25.74"></a><span id="l25.74">     formatInterval: function formatInterval(aStartDate, aEndDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/calDeletedItems.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/calDeletedItems.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -125,17 +125,19 @@ calDeletedItems.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4">         if (aTopic == &quot;profile-after-change&quot;) {</span>
<a href="#l26.5"></a><span id="l26.5">             // Make sure to observe calendar changes so we know when things are</span>
<a href="#l26.6"></a><span id="l26.6">             // deleted. We don't initialize the statements until first use.</span>
<a href="#l26.7"></a><span id="l26.7">             cal.getCalendarManager().addCalendarObserver(this);</span>
<a href="#l26.8"></a><span id="l26.8">         }</span>
<a href="#l26.9"></a><span id="l26.9">     },</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11">     ensureStatements: function ensureStatements() {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        if (!this.mDB) this.initDB();</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+        if (!this.mDB) {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+            this.initDB();</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+        }</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">         if (!this.stmtMarkDelete) {</span>
<a href="#l26.18"></a><span id="l26.18">             let stmt = &quot;INSERT OR REPLACE INTO cal_deleted_items (cal_id, id, time_deleted, recurrence_id) VALUES(:calId, :id, :time, :rid)&quot;;</span>
<a href="#l26.19"></a><span id="l26.19">             this.stmtMarkDelete = this.mDB.createStatement(stmt);</span>
<a href="#l26.20"></a><span id="l26.20">         }</span>
<a href="#l26.21"></a><span id="l26.21">         if (!this.stmtUnmarkDelete) {</span>
<a href="#l26.22"></a><span id="l26.22">             let stmt = &quot;DELETE FROM cal_deleted_items WHERE id = :id&quot;;</span>
<a href="#l26.23"></a><span id="l26.23">             this.stmtUnmarkDelete = this.mDB.createStatement(stmt);</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineat">@@ -151,21 +153,23 @@ calDeletedItems.prototype = {</span>
<a href="#l26.25"></a><span id="l26.25">         if (!this.stmtFlush) {</span>
<a href="#l26.26"></a><span id="l26.26">             let stmt = &quot;DELETE FROM cal_deleted_items WHERE time_deleted &lt; :stale_time&quot;;</span>
<a href="#l26.27"></a><span id="l26.27">             this.stmtFlush = this.mDB.createStatement(stmt);</span>
<a href="#l26.28"></a><span id="l26.28">         }</span>
<a href="#l26.29"></a><span id="l26.29">     },</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31">     shutdown: function shutdown() {</span>
<a href="#l26.32"></a><span id="l26.32">         try {</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-            if (this.stmtMarkDelete) this.stmtMarkDelete.finalize();</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-            if (this.stmtUnmarkDelete) this.stmtUnmarkDelete.finalize();</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-            if (this.stmtGet) this.stmtGet.finalize();</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-            if (this.stmtGetWithCal) this.stmtGetWithCal.finalize();</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-            if (this.stmtFlush) this.stmtFlush.finalize();</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineplus">+            let stmts = [</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+                this.stmtMarkDelete, this.stmtUnmarkDelete, this.stmtGet,</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+                this.stmtGetWithCal, this.stmtFlush</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineplus">+            ];</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+            for (let stmt of stmts) {</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+                stmt.finalize();</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+            }</span>
<a href="#l26.45"></a><span id="l26.45"> </span>
<a href="#l26.46"></a><span id="l26.46">             if (this.mDB) { this.mDB.asyncClose(); this.mDB = null; }</span>
<a href="#l26.47"></a><span id="l26.47">         } catch (e) {</span>
<a href="#l26.48"></a><span id="l26.48">             cal.ERROR(&quot;Error closing deleted items database: &quot; + e);</span>
<a href="#l26.49"></a><span id="l26.49">         }</span>
<a href="#l26.50"></a><span id="l26.50"> </span>
<a href="#l26.51"></a><span id="l26.51">         cal.getCalendarManager().removeCalendarObserver(this);</span>
<a href="#l26.52"></a><span id="l26.52">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/calEvent.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/calEvent.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -131,18 +131,19 @@ calEvent.prototype = {</span>
<a href="#l27.4"></a><span id="l27.4">     },</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">     eventPromotedProps: null,</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">     set icalComponent(event) {</span>
<a href="#l27.9"></a><span id="l27.9">         this.modify();</span>
<a href="#l27.10"></a><span id="l27.10">         if (event.componentType != &quot;VEVENT&quot;) {</span>
<a href="#l27.11"></a><span id="l27.11">             event = event.getFirstSubcomponent(&quot;VEVENT&quot;);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-            if (!event)</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+            if (!event) {</span>
<a href="#l27.14"></a><span id="l27.14">                 throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+            }</span>
<a href="#l27.16"></a><span id="l27.16">         }</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18">         this.mEndDate = undefined;</span>
<a href="#l27.19"></a><span id="l27.19">         this.setItemBaseFromICS(event);</span>
<a href="#l27.20"></a><span id="l27.20">         this.mapPropsFromICS(event, this.icsEventPropMap);</span>
<a href="#l27.21"></a><span id="l27.21"> </span>
<a href="#l27.22"></a><span id="l27.22">         this.importUnpromotedProperties(event, this.eventPromotedProps);</span>
<a href="#l27.23"></a><span id="l27.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -119,18 +119,19 @@ calItemBase.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">         return (this.mRecurrenceInfo = calTryWrappedJSObject(value));</span>
<a href="#l28.5"></a><span id="l28.5">     },</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7">     // attribute calIItemBase parentItem;</span>
<a href="#l28.8"></a><span id="l28.8">     get parentItem() {</span>
<a href="#l28.9"></a><span id="l28.9">         return (this.mParentItem || this);</span>
<a href="#l28.10"></a><span id="l28.10">     },</span>
<a href="#l28.11"></a><span id="l28.11">     set parentItem(value) {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        if (this.mImmutable)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+        if (this.mImmutable) {</span>
<a href="#l28.14"></a><span id="l28.14">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+        }</span>
<a href="#l28.16"></a><span id="l28.16">         return (this.mParentItem = calTryWrappedJSObject(value));</span>
<a href="#l28.17"></a><span id="l28.17">     },</span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19">     /**</span>
<a href="#l28.20"></a><span id="l28.20">      * Initializes the base item to be an item proxy. Used by inheriting</span>
<a href="#l28.21"></a><span id="l28.21">      * objects createProxy() method.</span>
<a href="#l28.22"></a><span id="l28.22">      *</span>
<a href="#l28.23"></a><span id="l28.23">      * XXXdbo Explain proxy a bit better, either here or in</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineat">@@ -158,18 +159,19 @@ calItemBase.prototype = {</span>
<a href="#l28.25"></a><span id="l28.25">     get isMutable() { return !this.mImmutable; },</span>
<a href="#l28.26"></a><span id="l28.26"> </span>
<a href="#l28.27"></a><span id="l28.27">     /**</span>
<a href="#l28.28"></a><span id="l28.28">      * This function should be called by all members that modify the item. It</span>
<a href="#l28.29"></a><span id="l28.29">      * checks if the item is immutable and throws accordingly, and sets the</span>
<a href="#l28.30"></a><span id="l28.30">      * mDirty property.</span>
<a href="#l28.31"></a><span id="l28.31">      */</span>
<a href="#l28.32"></a><span id="l28.32">     modify: function cIB_modify() {</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-        if (this.mImmutable)</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+        if (this.mImmutable) {</span>
<a href="#l28.35"></a><span id="l28.35">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+        }</span>
<a href="#l28.37"></a><span id="l28.37">         this.mDirty = true;</span>
<a href="#l28.38"></a><span id="l28.38">     },</span>
<a href="#l28.39"></a><span id="l28.39"> </span>
<a href="#l28.40"></a><span id="l28.40">     /**</span>
<a href="#l28.41"></a><span id="l28.41">      * Makes sure the item is not dirty. If the item is dirty, properties like</span>
<a href="#l28.42"></a><span id="l28.42">      * LAST-MODIFIED and DTSTAMP are set to now.</span>
<a href="#l28.43"></a><span id="l28.43">      */</span>
<a href="#l28.44"></a><span id="l28.44">     ensureNotDirty: function cIB_ensureNotDirty() {</span>
<a href="#l28.45"></a><span id="l28.45" class="difflineat">@@ -186,21 +188,23 @@ calItemBase.prototype = {</span>
<a href="#l28.46"></a><span id="l28.46">      * inheriting objects' makeImmutable method.</span>
<a href="#l28.47"></a><span id="l28.47">      */</span>
<a href="#l28.48"></a><span id="l28.48">     makeItemBaseImmutable: function cIB_makeItemBaseImmutable() {</span>
<a href="#l28.49"></a><span id="l28.49">         if (this.mImmutable) {</span>
<a href="#l28.50"></a><span id="l28.50">             return;</span>
<a href="#l28.51"></a><span id="l28.51">         }</span>
<a href="#l28.52"></a><span id="l28.52"> </span>
<a href="#l28.53"></a><span id="l28.53">         // make all our components immutable</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineminus">-        if (this.mRecurrenceInfo)</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineplus">+        if (this.mRecurrenceInfo) {</span>
<a href="#l28.56"></a><span id="l28.56">             this.mRecurrenceInfo.makeImmutable();</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineplus">+        }</span>
<a href="#l28.58"></a><span id="l28.58"> </span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-        if (this.mOrganizer)</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineplus">+        if (this.mOrganizer) {</span>
<a href="#l28.61"></a><span id="l28.61">             this.mOrganizer.makeImmutable();</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineplus">+        }</span>
<a href="#l28.63"></a><span id="l28.63">         if (this.mAttendees) {</span>
<a href="#l28.64"></a><span id="l28.64">             for (let att of this.mAttendees) {</span>
<a href="#l28.65"></a><span id="l28.65">                 att.makeImmutable();</span>
<a href="#l28.66"></a><span id="l28.66">             }</span>
<a href="#l28.67"></a><span id="l28.67">         }</span>
<a href="#l28.68"></a><span id="l28.68"> </span>
<a href="#l28.69"></a><span id="l28.69">         for (let [propKey, propValue] of this.mProperties) {</span>
<a href="#l28.70"></a><span id="l28.70">             if (propValue instanceof Components.interfaces.calIDateTime &amp;&amp;</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineat">@@ -679,18 +683,19 @@ calItemBase.prototype = {</span>
<a href="#l28.72"></a><span id="l28.72">     get calendar() {</span>
<a href="#l28.73"></a><span id="l28.73">         if (!this.mCalendar &amp;&amp; (this.parentItem != this)) {</span>
<a href="#l28.74"></a><span id="l28.74">             return this.parentItem.calendar;</span>
<a href="#l28.75"></a><span id="l28.75">         } else {</span>
<a href="#l28.76"></a><span id="l28.76">             return this.mCalendar;</span>
<a href="#l28.77"></a><span id="l28.77">         }</span>
<a href="#l28.78"></a><span id="l28.78">     },</span>
<a href="#l28.79"></a><span id="l28.79">     set calendar(v) {</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-        if (this.mImmutable)</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineplus">+        if (this.mImmutable) {</span>
<a href="#l28.82"></a><span id="l28.82">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineplus">+        }</span>
<a href="#l28.84"></a><span id="l28.84">         this.mHashId = null; // recompute hashId</span>
<a href="#l28.85"></a><span id="l28.85">         this.mCalendar = v;</span>
<a href="#l28.86"></a><span id="l28.86">     },</span>
<a href="#l28.87"></a><span id="l28.87"> </span>
<a href="#l28.88"></a><span id="l28.88">     // attribute calIAttendee organizer;</span>
<a href="#l28.89"></a><span id="l28.89">     get organizer() {</span>
<a href="#l28.90"></a><span id="l28.90">         if (this.mIsProxy &amp;&amp; (this.mOrganizer === undefined)) {</span>
<a href="#l28.91"></a><span id="l28.91">             return this.mParentItem.organizer;</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineat">@@ -781,35 +786,37 @@ calItemBase.prototype = {</span>
<a href="#l28.93"></a><span id="l28.93">      *</span>
<a href="#l28.94"></a><span id="l28.94">      * @param icalcomp      The calIIcalComponent to read from.</span>
<a href="#l28.95"></a><span id="l28.95">      * @param propmap       The property map to walk through.</span>
<a href="#l28.96"></a><span id="l28.96">      */</span>
<a href="#l28.97"></a><span id="l28.97">     mapPropsFromICS: function cIB_mapPropsFromICS(icalcomp, propmap) {</span>
<a href="#l28.98"></a><span id="l28.98">         for (var i = 0; i &lt; propmap.length; i++) {</span>
<a href="#l28.99"></a><span id="l28.99">             var prop = propmap[i];</span>
<a href="#l28.100"></a><span id="l28.100">             var val = icalcomp[prop.ics];</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineminus">-            if (val != null &amp;&amp; val != Components.interfaces.calIIcalComponent.INVALID_VALUE)</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineplus">+            if (val != null &amp;&amp; val != Components.interfaces.calIIcalComponent.INVALID_VALUE) {</span>
<a href="#l28.103"></a><span id="l28.103">                 this.setProperty(prop.cal, val);</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineplus">+            }</span>
<a href="#l28.105"></a><span id="l28.105">         }</span>
<a href="#l28.106"></a><span id="l28.106">     },</span>
<a href="#l28.107"></a><span id="l28.107"> </span>
<a href="#l28.108"></a><span id="l28.108">     /**</span>
<a href="#l28.109"></a><span id="l28.109">      * Walks through the propmap and sets all properties on the given icalcomp</span>
<a href="#l28.110"></a><span id="l28.110">      * from the properties set on this item.</span>
<a href="#l28.111"></a><span id="l28.111">      * given icalcomp.</span>
<a href="#l28.112"></a><span id="l28.112">      *</span>
<a href="#l28.113"></a><span id="l28.113">      * @param icalcomp      The calIIcalComponent to write to.</span>
<a href="#l28.114"></a><span id="l28.114">      * @param propmap       The property map to walk through.</span>
<a href="#l28.115"></a><span id="l28.115">      */</span>
<a href="#l28.116"></a><span id="l28.116">     mapPropsToICS: function cIB_mapPropsToICS(icalcomp, propmap) {</span>
<a href="#l28.117"></a><span id="l28.117">         for (var i = 0; i &lt; propmap.length; i++) {</span>
<a href="#l28.118"></a><span id="l28.118">             var prop = propmap[i];</span>
<a href="#l28.119"></a><span id="l28.119">             var val = this.getProperty(prop.cal);</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-            if (val != null &amp;&amp; val != Components.interfaces.calIIcalComponent.INVALID_VALUE)</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineplus">+            if (val != null &amp;&amp; val != Components.interfaces.calIIcalComponent.INVALID_VALUE) {</span>
<a href="#l28.122"></a><span id="l28.122">                 icalcomp[prop.ics] = val;</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineplus">+            }</span>
<a href="#l28.124"></a><span id="l28.124">         }</span>
<a href="#l28.125"></a><span id="l28.125">     },</span>
<a href="#l28.126"></a><span id="l28.126"> </span>
<a href="#l28.127"></a><span id="l28.127"> </span>
<a href="#l28.128"></a><span id="l28.128">     /**</span>
<a href="#l28.129"></a><span id="l28.129">      * Reads an ical component and sets up the base item's properties to match</span>
<a href="#l28.130"></a><span id="l28.130">      * it.</span>
<a href="#l28.131"></a><span id="l28.131">      *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -507,46 +507,50 @@ function guessSystemTimezone() {</span>
<a href="#l29.4"></a><span id="l29.4">         // no such period found</span>
<a href="#l29.5"></a><span id="l29.5">         return null;</span>
<a href="#l29.6"></a><span id="l29.6">     }</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8">     function environmentVariableValue(varName) {</span>
<a href="#l29.9"></a><span id="l29.9">         let envSvc = Components.classes[&quot;@mozilla.org/process/environment;1&quot;]</span>
<a href="#l29.10"></a><span id="l29.10">                                 .getService(Components.interfaces.nsIEnvironment);</span>
<a href="#l29.11"></a><span id="l29.11">         let value = envSvc.get(varName);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-        if (!value) return &quot;&quot;;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-        if (!value.match(tzRegex)) return &quot;&quot;;</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+        if (!value || !value.match(tzRegex)) {</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+            return &quot;&quot;;</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+        }</span>
<a href="#l29.17"></a><span id="l29.17">         return varName+&quot;=&quot;+value;</span>
<a href="#l29.18"></a><span id="l29.18">     }</span>
<a href="#l29.19"></a><span id="l29.19"> </span>
<a href="#l29.20"></a><span id="l29.20">     function symbolicLinkTarget(filepath) {</span>
<a href="#l29.21"></a><span id="l29.21">         try {</span>
<a href="#l29.22"></a><span id="l29.22">             let file = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l29.23"></a><span id="l29.23">                                  .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l29.24"></a><span id="l29.24">             file.initWithPath(filepath);</span>
<a href="#l29.25"></a><span id="l29.25">             file.QueryInterface(Components.interfaces.nsIFile);</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">-            if (!file.exists()) return &quot;&quot;;</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-            if (!file.isSymlink()) return &quot;&quot;;</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-            if (!file.target.match(tzRegex)) return &quot;&quot;;</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineplus">+            if (!file.exists() || !file.isSymlink() || !file.target.match(tzRegex)) {</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+                return &quot;&quot;;</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+            }</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+</span>
<a href="#l29.33"></a><span id="l29.33">             return filepath +&quot; -&gt; &quot;+file.target;</span>
<a href="#l29.34"></a><span id="l29.34">         } catch (ex) {</span>
<a href="#l29.35"></a><span id="l29.35">             Components.utils.reportError(filepath+&quot;: &quot;+ex);</span>
<a href="#l29.36"></a><span id="l29.36">             return &quot;&quot;;</span>
<a href="#l29.37"></a><span id="l29.37">         }</span>
<a href="#l29.38"></a><span id="l29.38">     }</span>
<a href="#l29.39"></a><span id="l29.39"> </span>
<a href="#l29.40"></a><span id="l29.40">     function fileFirstZoneLineString(filepath) {</span>
<a href="#l29.41"></a><span id="l29.41">         // return first line of file that matches tzRegex (ZoneInfo id),</span>
<a href="#l29.42"></a><span id="l29.42">         // or &quot;&quot; if no file or no matching line.</span>
<a href="#l29.43"></a><span id="l29.43">         try {</span>
<a href="#l29.44"></a><span id="l29.44">             let file = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l29.45"></a><span id="l29.45">                                  .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l29.46"></a><span id="l29.46">             file.initWithPath(filepath);</span>
<a href="#l29.47"></a><span id="l29.47">             file.QueryInterface(Components.interfaces.nsIFile);</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-            if (!file.exists()) return &quot;&quot;;</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineplus">+            if (!file.exists()) {</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineplus">+                return &quot;&quot;;</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineplus">+            }</span>
<a href="#l29.52"></a><span id="l29.52">             let fileInstream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l29.53"></a><span id="l29.53">                                          .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l29.54"></a><span id="l29.54">             const PR_RDONLY = 0x1;</span>
<a href="#l29.55"></a><span id="l29.55">             fileInstream.init(file, PR_RDONLY, 0, 0);</span>
<a href="#l29.56"></a><span id="l29.56">             fileInstream.QueryInterface(Components.interfaces.nsILineInputStream);</span>
<a href="#l29.57"></a><span id="l29.57">             try {</span>
<a href="#l29.58"></a><span id="l29.58">                 let line = {}, hasMore = true, MAXLINES = 10;</span>
<a href="#l29.59"></a><span id="l29.59">                 for (let i = 0; hasMore &amp;&amp; i &lt; MAXLINES; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/src/calTodo.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/src/calTodo.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -72,18 +72,19 @@ calTodo.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">     get isCompleted() {</span>
<a href="#l30.5"></a><span id="l30.5">         return this.completedDate != null ||</span>
<a href="#l30.6"></a><span id="l30.6">                this.percentComplete == 100 ||</span>
<a href="#l30.7"></a><span id="l30.7">                this.status == &quot;COMPLETED&quot;;</span>
<a href="#l30.8"></a><span id="l30.8">     },</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10">     set isCompleted(v) {</span>
<a href="#l30.11"></a><span id="l30.11">         if (v) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-            if (!this.completedDate)</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+            if (!this.completedDate) {</span>
<a href="#l30.14"></a><span id="l30.14">                 this.completedDate = cal.jsDateToDateTime(new Date());</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+            }</span>
<a href="#l30.16"></a><span id="l30.16">             this.status = &quot;COMPLETED&quot;;</span>
<a href="#l30.17"></a><span id="l30.17">             this.percentComplete = 100;</span>
<a href="#l30.18"></a><span id="l30.18">         } else {</span>
<a href="#l30.19"></a><span id="l30.19">             this.deleteProperty(&quot;COMPLETED&quot;);</span>
<a href="#l30.20"></a><span id="l30.20">             this.deleteProperty(&quot;STATUS&quot;);</span>
<a href="#l30.21"></a><span id="l30.21">             this.deleteProperty(&quot;PERCENT-COMPLETE&quot;);</span>
<a href="#l30.22"></a><span id="l30.22">         }</span>
<a href="#l30.23"></a><span id="l30.23">     },</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineat">@@ -168,18 +169,19 @@ calTodo.prototype = {</span>
<a href="#l30.25"></a><span id="l30.25">     },</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27">     todoPromotedProps: null,</span>
<a href="#l30.28"></a><span id="l30.28"> </span>
<a href="#l30.29"></a><span id="l30.29">     set icalComponent(todo) {</span>
<a href="#l30.30"></a><span id="l30.30">         this.modify();</span>
<a href="#l30.31"></a><span id="l30.31">         if (todo.componentType != &quot;VTODO&quot;) {</span>
<a href="#l30.32"></a><span id="l30.32">             todo = todo.getFirstSubcomponent(&quot;VTODO&quot;);</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-            if (!todo)</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+            if (!todo) {</span>
<a href="#l30.35"></a><span id="l30.35">                 throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+            }</span>
<a href="#l30.37"></a><span id="l30.37">         }</span>
<a href="#l30.38"></a><span id="l30.38"> </span>
<a href="#l30.39"></a><span id="l30.39">         this.mDueDate = undefined;</span>
<a href="#l30.40"></a><span id="l30.40">         this.setItemBaseFromICS(todo);</span>
<a href="#l30.41"></a><span id="l30.41">         this.mapPropsFromICS(todo, this.icsEventPropMap);</span>
<a href="#l30.42"></a><span id="l30.42"> </span>
<a href="#l30.43"></a><span id="l30.43">         this.importUnpromotedProperties(todo, this.todoPromotedProps);</span>
<a href="#l30.44"></a><span id="l30.44">         // Importing didn't really change anything</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -756,26 +756,30 @@ function compareObjects(aObject, aOtherO</span>
<a href="#l31.4"></a><span id="l31.4">     sip2.dataIID = aIID;</span>
<a href="#l31.5"></a><span id="l31.5">     return sip1.data == sip2.data;</span>
<a href="#l31.6"></a><span id="l31.6"> }</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8"> /**</span>
<a href="#l31.9"></a><span id="l31.9">  * Compare two arrays using the passed function.</span>
<a href="#l31.10"></a><span id="l31.10">  */</span>
<a href="#l31.11"></a><span id="l31.11"> function compareArrays(aOne, aTwo, compareFunc) {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    if (!aOne &amp;&amp; !aTwo)</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    if (!aOne &amp;&amp; !aTwo) {</span>
<a href="#l31.14"></a><span id="l31.14">         return true;</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-    if (!aOne || !aTwo)</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+    }</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+    if (!aOne || !aTwo) {</span>
<a href="#l31.18"></a><span id="l31.18">         return false;</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+    }</span>
<a href="#l31.20"></a><span id="l31.20">     var len = aOne.length;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">-    if (len != aTwo.length)</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+    if (len != aTwo.length) {</span>
<a href="#l31.23"></a><span id="l31.23">         return false;</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineplus">+    }</span>
<a href="#l31.25"></a><span id="l31.25">     for (var i = 0; i &lt; len; ++i) {</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-        if (!compareFunc(aOne[i], aTwo[i]))</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineplus">+        if (!compareFunc(aOne[i], aTwo[i])) {</span>
<a href="#l31.28"></a><span id="l31.28">             return false;</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+        }</span>
<a href="#l31.30"></a><span id="l31.30">     }</span>
<a href="#l31.31"></a><span id="l31.31">     return true;</span>
<a href="#l31.32"></a><span id="l31.32"> }</span>
<a href="#l31.33"></a><span id="l31.33"> </span>
<a href="#l31.34"></a><span id="l31.34"> /**</span>
<a href="#l31.35"></a><span id="l31.35">  * Takes care of all QueryInterface business, including calling the QI of any</span>
<a href="#l31.36"></a><span id="l31.36">  * existing parent prototypes.</span>
<a href="#l31.37"></a><span id="l31.37">  *</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineat">@@ -1125,21 +1129,23 @@ function checkIfInRange(item, rangeStart</span>
<a href="#l31.39"></a><span id="l31.39">  * completed, overdue, duetoday, inprogress, future</span>
<a href="#l31.40"></a><span id="l31.40">  *</span>
<a href="#l31.41"></a><span id="l31.41">  * @param aTask     The task to check.</span>
<a href="#l31.42"></a><span id="l31.42">  * @return          The progress atom.</span>
<a href="#l31.43"></a><span id="l31.43">  */</span>
<a href="#l31.44"></a><span id="l31.44"> function getProgressAtom(aTask) {</span>
<a href="#l31.45"></a><span id="l31.45">     var now = new Date();</span>
<a href="#l31.46"></a><span id="l31.46"> </span>
<a href="#l31.47"></a><span id="l31.47" class="difflineminus">-    if (aTask.recurrenceInfo)</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineminus">-      return &quot;repeating&quot;;</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineplus">+    if (aTask.recurrenceInfo) {</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineplus">+        return &quot;repeating&quot;;</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineplus">+    }</span>
<a href="#l31.52"></a><span id="l31.52"> </span>
<a href="#l31.53"></a><span id="l31.53" class="difflineminus">-    if (aTask.isCompleted)</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineminus">-      return &quot;completed&quot;;</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+    if (aTask.isCompleted) {</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineplus">+        return &quot;completed&quot;;</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineplus">+    }</span>
<a href="#l31.58"></a><span id="l31.58"> </span>
<a href="#l31.59"></a><span id="l31.59">     if (aTask.dueDate &amp;&amp; aTask.dueDate.isValid) {</span>
<a href="#l31.60"></a><span id="l31.60">         if (cal.dateTimeToJsDate(aTask.dueDate).getTime() &lt; now.getTime()) {</span>
<a href="#l31.61"></a><span id="l31.61">             return &quot;overdue&quot;;</span>
<a href="#l31.62"></a><span id="l31.62">         } else if (aTask.dueDate.year == now.getFullYear() &amp;&amp;</span>
<a href="#l31.63"></a><span id="l31.63">                    aTask.dueDate.month == now.getMonth() &amp;&amp;</span>
<a href="#l31.64"></a><span id="l31.64">                    aTask.dueDate.day == now.getDate()) {</span>
<a href="#l31.65"></a><span id="l31.65">             return &quot;duetoday&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -175,19 +175,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">         let weekContainer = currentMonth.querySelector(&quot;.week-container&quot;);</span>
<a href="#l32.5"></a><span id="l32.5"> </span>
<a href="#l32.6"></a><span id="l32.6">         for (let weekStart = startOfMonthView; weekStart.compare(endOfMonthView) &lt; 0; weekStart.day += 7) {</span>
<a href="#l32.7"></a><span id="l32.7">             this.setupWeek(document, weekContainer, weekStart, mainMonth, dayTable);</span>
<a href="#l32.8"></a><span id="l32.8">         }</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">         // Now insert the month into the page container, sorting by date (and therefore by month)</span>
<a href="#l32.11"></a><span id="l32.11">         function compareDates(a, b) {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-            if (!a || !b) return -1;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-            let res = a.compare(b);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-            return res;</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+            return (!a || !b) ? -1 : a.compare(b);</span>
<a href="#l32.16"></a><span id="l32.16">         }</span>
<a href="#l32.17"></a><span id="l32.17"> </span>
<a href="#l32.18"></a><span id="l32.18">         cal.binaryInsertNode(monthContainer, currentMonth, currentMonth.item, compareDates);</span>
<a href="#l32.19"></a><span id="l32.19">     },</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21">     setupWeek: function monthPrint_setupWeek(document, weekContainer, startOfWeek, mainMonth, dayTable) {</span>
<a href="#l32.22"></a><span id="l32.22">         const weekdayMap = [&quot;sunday&quot;, &quot;monday&quot;, &quot;tuesday&quot;, &quot;wednesday&quot;, &quot;thursday&quot;, &quot;friday&quot;, &quot;saturday&quot;];</span>
<a href="#l32.23"></a><span id="l32.23">         let weekTemplate = document.getElementById(&quot;week-template&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -199,18 +199,19 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l33.4"></a><span id="l33.4">             aCount.value = 0;</span>
<a href="#l33.5"></a><span id="l33.5">             return [];</span>
<a href="#l33.6"></a><span id="l33.6">         }</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8">         // Construct event regexp according to field indexes. The regexp can</span>
<a href="#l33.9"></a><span id="l33.9">         // be made stricter, if it seems this matches too loosely.</span>
<a href="#l33.10"></a><span id="l33.10">         let regExpStr = &quot;^&quot;;</span>
<a href="#l33.11"></a><span id="l33.11">         for (i = 1; i &lt;= header.length; i++) {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-            if (i &gt; 1)</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+            if (i &gt; 1) {</span>
<a href="#l33.14"></a><span id="l33.14">                 regExpStr += &quot;,&quot;;</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+            }</span>
<a href="#l33.16"></a><span id="l33.16">             regExpStr += &quot;(?:\&quot;((?:[^\&quot;]|\&quot;\&quot;)*)\&quot;)?&quot;;</span>
<a href="#l33.17"></a><span id="l33.17">         }</span>
<a href="#l33.18"></a><span id="l33.18">         regExpStr += &quot;$&quot;;</span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20">         // eventRegExp: regexp for reading events (this one'll be constructed on fly)</span>
<a href="#l33.21"></a><span id="l33.21">         const eventRegExp = new RegExp(regExpStr, &quot;gm&quot;);</span>
<a href="#l33.22"></a><span id="l33.22"> </span>
<a href="#l33.23"></a><span id="l33.23">         // match first line</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/import-export/calWeekPrinter.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/import-export/calWeekPrinter.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -128,16 +128,14 @@ calWeekPrinter.prototype = {</span>
<a href="#l34.4"></a><span id="l34.4">             if (Preferences.get(dayOffPrefName, false)) {</span>
<a href="#l34.5"></a><span id="l34.5">                 let daysOffNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-box&quot;);</span>
<a href="#l34.6"></a><span id="l34.6">                 daysOffNode.className += &quot; day-off&quot;;</span>
<a href="#l34.7"></a><span id="l34.7">             }</span>
<a href="#l34.8"></a><span id="l34.8">         }</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">         // Now insert the week into the week container, sorting by date (and therefore week number)</span>
<a href="#l34.11"></a><span id="l34.11">         function compareDates(a, b) {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-            if (!a || !b) return -1;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-            let res = a.compare(b);</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-            return res;</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+            return (!a || !b) ? -1 : a.compare(b);</span>
<a href="#l34.16"></a><span id="l34.16">         }</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18">         cal.binaryInsertNode(weekContainer, currentPage, currentPage.item, compareDates);</span>
<a href="#l34.19"></a><span id="l34.19">     }</span>
<a href="#l34.20"></a><span id="l34.20"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -50,18 +50,19 @@ var gConfig = {</span>
<a href="#l35.4"></a><span id="l35.4"> //   - gShowLink</span>
<a href="#l35.5"></a><span id="l35.5"> </span>
<a href="#l35.6"></a><span id="l35.6"> var eventDialogQuitObserver = {</span>
<a href="#l35.7"></a><span id="l35.7">   observe: function(aSubject, aTopic, aData) {</span>
<a href="#l35.8"></a><span id="l35.8">     // Check whether or not we want to veto the quit request (unless another</span>
<a href="#l35.9"></a><span id="l35.9">     // observer already did.</span>
<a href="#l35.10"></a><span id="l35.10">     if (aTopic == &quot;quit-application-requested&quot; &amp;&amp;</span>
<a href="#l35.11"></a><span id="l35.11">         (aSubject instanceof Components.interfaces.nsISupportsPRBool) &amp;&amp;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-        !aSubject.data)</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+        !aSubject.data) {</span>
<a href="#l35.14"></a><span id="l35.14">       aSubject.data = !onCancel();</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+    }</span>
<a href="#l35.16"></a><span id="l35.16">   }</span>
<a href="#l35.17"></a><span id="l35.17"> };</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19"> var eventDialogCalendarObserver = {</span>
<a href="#l35.20"></a><span id="l35.20">     target: null,</span>
<a href="#l35.21"></a><span id="l35.21">     isObserving: false,</span>
<a href="#l35.22"></a><span id="l35.22"> </span>
<a href="#l35.23"></a><span id="l35.23">     onModifyItem: function(aNewItem, aOldItem) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -623,19 +623,20 @@ function LtnObserveDisplayDeckChange(eve</span>
<a href="#l36.4"></a><span id="l36.4">     }</span>
<a href="#l36.5"></a><span id="l36.5"> }</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7"> function ltnFinish() {</span>
<a href="#l36.8"></a><span id="l36.8">     getCalendarManager().removeObserver(gInvitationsCalendarManagerObserver);</span>
<a href="#l36.9"></a><span id="l36.9"> </span>
<a href="#l36.10"></a><span id="l36.10">     // Remove listener for mailContext.</span>
<a href="#l36.11"></a><span id="l36.11">     let mailContextPopup = document.getElementById(&quot;mailContext&quot;);</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    if (mailContextPopup)</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-      mailContextPopup.removeEventListener(&quot;popupshowing&quot;,</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-                                           gCalSetupMailContext.popup, false);</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+    if (mailContextPopup) {</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+        mailContextPopup.removeEventListener(&quot;popupshowing&quot;,</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineplus">+                                             gCalSetupMailContext.popup, false);</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+    }</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20">     // Common finish steps</span>
<a href="#l36.21"></a><span id="l36.21">     commonFinishCalendar();</span>
<a href="#l36.22"></a><span id="l36.22"> }</span>
<a href="#l36.23"></a><span id="l36.23"> </span>
<a href="#l36.24"></a><span id="l36.24"> // == invitations link</span>
<a href="#l36.25"></a><span id="l36.25"> var FIRST_DELAY_STARTUP = 100;</span>
<a href="#l36.26"></a><span id="l36.26"> var FIRST_DELAY_RESCHEDULE = 100;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -136,20 +136,22 @@ calCompositeCalendar.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">         }</span>
<a href="#l37.5"></a><span id="l37.5">         this.mPrefPrefix = aPrefPrefix;</span>
<a href="#l37.6"></a><span id="l37.6">         this.mActivePref = aPrefPrefix + &quot;-in-composite&quot;;</span>
<a href="#l37.7"></a><span id="l37.7">         this.mDefaultPref = aPrefPrefix + &quot;-default&quot;;</span>
<a href="#l37.8"></a><span id="l37.8">         let mgr = cal.getCalendarManager();</span>
<a href="#l37.9"></a><span id="l37.9">         let cals = mgr.getCalendars({});</span>
<a href="#l37.10"></a><span id="l37.10"> </span>
<a href="#l37.11"></a><span id="l37.11">         cals.forEach(function (c) {</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-            if (c.getProperty(this.mActivePref))</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+            if (c.getProperty(this.mActivePref)) {</span>
<a href="#l37.14"></a><span id="l37.14">                 this.addCalendar(c);</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-            if (c.getProperty(this.mDefaultPref))</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+            }</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+            if (c.getProperty(this.mDefaultPref)) {</span>
<a href="#l37.18"></a><span id="l37.18">                 this.setDefaultCalendar(c, false);</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineplus">+            }</span>
<a href="#l37.20"></a><span id="l37.20">         }, this);</span>
<a href="#l37.21"></a><span id="l37.21">     },</span>
<a href="#l37.22"></a><span id="l37.22"> </span>
<a href="#l37.23"></a><span id="l37.23">     get prefPrefix () {</span>
<a href="#l37.24"></a><span id="l37.24">         return this.mPrefPrefix;</span>
<a href="#l37.25"></a><span id="l37.25">     },</span>
<a href="#l37.26"></a><span id="l37.26"> </span>
<a href="#l37.27"></a><span id="l37.27">     addCalendar: function cCC_addCalendar(aCalendar) {</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineat">@@ -520,18 +522,19 @@ calCompositeGetListenerHelper.prototype </span>
<a href="#l37.29"></a><span id="l37.29">             return;</span>
<a href="#l37.30"></a><span id="l37.30">         }</span>
<a href="#l37.31"></a><span id="l37.31">         if (this.mFinished) {</span>
<a href="#l37.32"></a><span id="l37.32">             dump (&quot;+++ calCompositeGetListenerHelper.onGetResult: called with mFinished == true!&quot;);</span>
<a href="#l37.33"></a><span id="l37.33">             return;</span>
<a href="#l37.34"></a><span id="l37.34">         }</span>
<a href="#l37.35"></a><span id="l37.35"> </span>
<a href="#l37.36"></a><span id="l37.36">         // ignore if we have a max and we're past it</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineminus">-        if (this.mMaxItems &amp;&amp; this.mItemsReceived &gt;= this.mMaxItems)</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineplus">+        if (this.mMaxItems &amp;&amp; this.mItemsReceived &gt;= this.mMaxItems) {</span>
<a href="#l37.39"></a><span id="l37.39">             return;</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineplus">+        }</span>
<a href="#l37.41"></a><span id="l37.41"> </span>
<a href="#l37.42"></a><span id="l37.42">         if (Components.isSuccessCode(aStatus) &amp;&amp;</span>
<a href="#l37.43"></a><span id="l37.43">             this.mMaxItems &amp;&amp;</span>
<a href="#l37.44"></a><span id="l37.44">             ((this.mItemsReceived + aCount) &gt; this.mMaxItems))</span>
<a href="#l37.45"></a><span id="l37.45">         {</span>
<a href="#l37.46"></a><span id="l37.46">             // this will blow past the limit</span>
<a href="#l37.47"></a><span id="l37.47">             aCount = this.mMaxItems - this.mItemsReceived;</span>
<a href="#l37.48"></a><span id="l37.48">             aItems = aItems.slice(0, aCount);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -299,18 +299,19 @@ calICSCalendar.prototype = {</span>
<a href="#l38.4"></a><span id="l38.4">         };</span>
<a href="#l38.5"></a><span id="l38.5">         parser.parseString(str, null, listener);</span>
<a href="#l38.6"></a><span id="l38.6">     },</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8">     writeICS: function () {</span>
<a href="#l38.9"></a><span id="l38.9">         cal.LOG(&quot;[calICSCalendar] Commencing write of ICS Calendar &quot; + this.name);</span>
<a href="#l38.10"></a><span id="l38.10">         this.lock();</span>
<a href="#l38.11"></a><span id="l38.11">         try {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-            if (!this.mUri)</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+            if (!this.mUri) {</span>
<a href="#l38.14"></a><span id="l38.14">                 throw Components.results.NS_ERROR_FAILURE;</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+            }</span>
<a href="#l38.16"></a><span id="l38.16">             // makeBackup will call doWriteICS</span>
<a href="#l38.17"></a><span id="l38.17">             this.makeBackup(this.doWriteICS);</span>
<a href="#l38.18"></a><span id="l38.18">         } catch (exc) {</span>
<a href="#l38.19"></a><span id="l38.19">             this.unlock(calIErrors.MODIFICATION_FAILED);</span>
<a href="#l38.20"></a><span id="l38.20">             throw exc;</span>
<a href="#l38.21"></a><span id="l38.21">         }</span>
<a href="#l38.22"></a><span id="l38.22">     },</span>
<a href="#l38.23"></a><span id="l38.23"> </span>
<a href="#l38.24"></a><span id="l38.24" class="difflineat">@@ -462,33 +463,36 @@ calICSCalendar.prototype = {</span>
<a href="#l38.25"></a><span id="l38.25"> </span>
<a href="#l38.26"></a><span id="l38.26">     // Always use the queue, just to reduce the amount of places where</span>
<a href="#l38.27"></a><span id="l38.27">     // this.mMemoryCalendar.addItem() and friends are called. less</span>
<a href="#l38.28"></a><span id="l38.28">     // copied code.</span>
<a href="#l38.29"></a><span id="l38.29">     addItem: function (aItem, aListener) {</span>
<a href="#l38.30"></a><span id="l38.30">         this.adoptItem(aItem.clone(), aListener);</span>
<a href="#l38.31"></a><span id="l38.31">     },</span>
<a href="#l38.32"></a><span id="l38.32">     adoptItem: function (aItem, aListener) {</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineminus">-        if (this.readOnly)</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+        if (this.readOnly) {</span>
<a href="#l38.35"></a><span id="l38.35">             throw calIErrors.CAL_IS_READONLY;</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+        }</span>
<a href="#l38.37"></a><span id="l38.37">         this.queue.push({action:'add', item:aItem, listener:aListener});</span>
<a href="#l38.38"></a><span id="l38.38">         this.processQueue();</span>
<a href="#l38.39"></a><span id="l38.39">     },</span>
<a href="#l38.40"></a><span id="l38.40"> </span>
<a href="#l38.41"></a><span id="l38.41">     modifyItem: function (aNewItem, aOldItem, aListener) {</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-        if (this.readOnly)</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineplus">+        if (this.readOnly) {</span>
<a href="#l38.44"></a><span id="l38.44">             throw calIErrors.CAL_IS_READONLY;</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+        }</span>
<a href="#l38.46"></a><span id="l38.46">         this.queue.push({action:'modify', oldItem: aOldItem,</span>
<a href="#l38.47"></a><span id="l38.47">                          newItem: aNewItem, listener:aListener});</span>
<a href="#l38.48"></a><span id="l38.48">         this.processQueue();</span>
<a href="#l38.49"></a><span id="l38.49">     },</span>
<a href="#l38.50"></a><span id="l38.50"> </span>
<a href="#l38.51"></a><span id="l38.51">     deleteItem: function (aItem, aListener) {</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-        if (this.readOnly)</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+        if (this.readOnly) {</span>
<a href="#l38.54"></a><span id="l38.54">             throw calIErrors.CAL_IS_READONLY;</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineplus">+        }</span>
<a href="#l38.56"></a><span id="l38.56">         this.queue.push({action:'delete', item:aItem, listener:aListener});</span>
<a href="#l38.57"></a><span id="l38.57">         this.processQueue();</span>
<a href="#l38.58"></a><span id="l38.58">     },</span>
<a href="#l38.59"></a><span id="l38.59"> </span>
<a href="#l38.60"></a><span id="l38.60">     getItem: function (aId, aListener) {</span>
<a href="#l38.61"></a><span id="l38.61">         this.queue.push({action:'get_item', id:aId, listener:aListener});</span>
<a href="#l38.62"></a><span id="l38.62">         this.processQueue();</span>
<a href="#l38.63"></a><span id="l38.63">     },</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineat">@@ -500,18 +504,19 @@ calICSCalendar.prototype = {</span>
<a href="#l38.65"></a><span id="l38.65">                          itemFilter:aItemFilter, count:aCount,</span>
<a href="#l38.66"></a><span id="l38.66">                          rangeStart:aRangeStart, rangeEnd:aRangeEnd,</span>
<a href="#l38.67"></a><span id="l38.67">                          listener:aListener});</span>
<a href="#l38.68"></a><span id="l38.68">         this.processQueue();</span>
<a href="#l38.69"></a><span id="l38.69">     },</span>
<a href="#l38.70"></a><span id="l38.70"> </span>
<a href="#l38.71"></a><span id="l38.71">     processQueue: function ()</span>
<a href="#l38.72"></a><span id="l38.72">     {</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-        if (this.isLocked())</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+        if (this.isLocked()) {</span>
<a href="#l38.75"></a><span id="l38.75">             return;</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineplus">+        }</span>
<a href="#l38.77"></a><span id="l38.77"> </span>
<a href="#l38.78"></a><span id="l38.78">         function modListener(action) {</span>
<a href="#l38.79"></a><span id="l38.79">             this.mAction = action;</span>
<a href="#l38.80"></a><span id="l38.80">         }</span>
<a href="#l38.81"></a><span id="l38.81">         modListener.prototype = {</span>
<a href="#l38.82"></a><span id="l38.82">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l38.83"></a><span id="l38.83">             onGetResult: function() {},</span>
<a href="#l38.84"></a><span id="l38.84">             onOperationComplete: function() {</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineat">@@ -695,20 +700,21 @@ calICSCalendar.prototype = {</span>
<a href="#l38.86"></a><span id="l38.86">             var files = [];</span>
<a href="#l38.87"></a><span id="l38.87">             while (dirEnum.hasMoreElements()) {</span>
<a href="#l38.88"></a><span id="l38.88">                 var file = dirEnum.getNext().QueryInterface(CI.nsIFile);</span>
<a href="#l38.89"></a><span id="l38.89">                 if (file.isFile()) {</span>
<a href="#l38.90"></a><span id="l38.90">                     files.push({name: file.leafName, lastmodified: file.lastModifiedTime});</span>
<a href="#l38.91"></a><span id="l38.91">                 }</span>
<a href="#l38.92"></a><span id="l38.92">             }</span>
<a href="#l38.93"></a><span id="l38.93"> </span>
<a href="#l38.94"></a><span id="l38.94" class="difflineminus">-            if (doDailyBackup)</span>
<a href="#l38.95"></a><span id="l38.95" class="difflineplus">+            if (doDailyBackup) {</span>
<a href="#l38.96"></a><span id="l38.96">                 purgeBackupsByType(files, 'day');</span>
<a href="#l38.97"></a><span id="l38.97" class="difflineminus">-            else</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineplus">+            } else {</span>
<a href="#l38.99"></a><span id="l38.99">                 purgeBackupsByType(files, 'edit');</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineplus">+            }</span>
<a href="#l38.101"></a><span id="l38.101"> </span>
<a href="#l38.102"></a><span id="l38.102">             return;</span>
<a href="#l38.103"></a><span id="l38.103">         }</span>
<a href="#l38.104"></a><span id="l38.104"> </span>
<a href="#l38.105"></a><span id="l38.105">         function copyToOverwriting(oldFile, newParentDir, newName) {</span>
<a href="#l38.106"></a><span id="l38.106">             try {</span>
<a href="#l38.107"></a><span id="l38.107">                 var newFile = newParentDir.clone();</span>
<a href="#l38.108"></a><span id="l38.108">                 newFile.append(newName);</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineat">@@ -755,18 +761,19 @@ calICSCalendar.prototype = {</span>
<a href="#l38.110"></a><span id="l38.110">             cal.ERROR(&quot;[calICSCalendar] Backup failed, no calendarmanager:&quot; + e);</span>
<a href="#l38.111"></a><span id="l38.111">             aCallback.call(this);</span>
<a href="#l38.112"></a><span id="l38.112">             return;</span>
<a href="#l38.113"></a><span id="l38.113">         }</span>
<a href="#l38.114"></a><span id="l38.114"> </span>
<a href="#l38.115"></a><span id="l38.115">         var doInitialBackup = false;</span>
<a href="#l38.116"></a><span id="l38.116">         var initialBackupFile = backupDir.clone();</span>
<a href="#l38.117"></a><span id="l38.117">         initialBackupFile.append(makeName('initial'));</span>
<a href="#l38.118"></a><span id="l38.118" class="difflineminus">-        if (!initialBackupFile.exists())</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineplus">+        if (!initialBackupFile.exists()) {</span>
<a href="#l38.120"></a><span id="l38.120">             doInitialBackup = true;</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineplus">+        }</span>
<a href="#l38.122"></a><span id="l38.122"> </span>
<a href="#l38.123"></a><span id="l38.123">         var doDailyBackup = false;</span>
<a href="#l38.124"></a><span id="l38.124">         var backupTime = this.getProperty('backup-time2');</span>
<a href="#l38.125"></a><span id="l38.125">         if (!backupTime ||</span>
<a href="#l38.126"></a><span id="l38.126">             (new Date().getTime() &gt; backupTime + backupDays*24*60*60*1000)) {</span>
<a href="#l38.127"></a><span id="l38.127">             // It's time do to a daily backup</span>
<a href="#l38.128"></a><span id="l38.128">             doDailyBackup = true;</span>
<a href="#l38.129"></a><span id="l38.129">             this.setProperty('backup-time2', new Date().getTime());</span>
<a href="#l38.130"></a><span id="l38.130" class="difflineat">@@ -794,20 +801,22 @@ calICSCalendar.prototype = {</span>
<a href="#l38.131"></a><span id="l38.131">         channel.notificationCallbacks = this;</span>
<a href="#l38.132"></a><span id="l38.132"> </span>
<a href="#l38.133"></a><span id="l38.133">         var downloader = Components.classes[&quot;@mozilla.org/network/downloader;1&quot;]</span>
<a href="#l38.134"></a><span id="l38.134">                                    .createInstance(CI.nsIDownloader);</span>
<a href="#l38.135"></a><span id="l38.135"> </span>
<a href="#l38.136"></a><span id="l38.136">         var savedthis = this;</span>
<a href="#l38.137"></a><span id="l38.137">         var listener = {</span>
<a href="#l38.138"></a><span id="l38.138">             onDownloadComplete: function(downloader, request, ctxt, status, result) {</span>
<a href="#l38.139"></a><span id="l38.139" class="difflineminus">-                if (doInitialBackup)</span>
<a href="#l38.140"></a><span id="l38.140" class="difflineplus">+                if (doInitialBackup) {</span>
<a href="#l38.141"></a><span id="l38.141">                     copyToOverwriting(result, backupDir, makeName('initial'));</span>
<a href="#l38.142"></a><span id="l38.142" class="difflineminus">-                if (doDailyBackup)</span>
<a href="#l38.143"></a><span id="l38.143" class="difflineplus">+                }</span>
<a href="#l38.144"></a><span id="l38.144" class="difflineplus">+                if (doDailyBackup) {</span>
<a href="#l38.145"></a><span id="l38.145">                     copyToOverwriting(result, backupDir, dailyBackupFileName);</span>
<a href="#l38.146"></a><span id="l38.146" class="difflineplus">+                }</span>
<a href="#l38.147"></a><span id="l38.147"> </span>
<a href="#l38.148"></a><span id="l38.148">                 aCallback.call(savedthis);</span>
<a href="#l38.149"></a><span id="l38.149">             }</span>
<a href="#l38.150"></a><span id="l38.150">         }</span>
<a href="#l38.151"></a><span id="l38.151"> </span>
<a href="#l38.152"></a><span id="l38.152">         downloader.init(listener, backupFile);</span>
<a href="#l38.153"></a><span id="l38.153">         try {</span>
<a href="#l38.154"></a><span id="l38.154">             channel.asyncOpen(downloader, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -106,20 +106,22 @@ calMemoryCalendar.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">     // void addItem( in calIItemBase aItem, in calIOperationListener aListener );</span>
<a href="#l39.5"></a><span id="l39.5">     addItem: function (aItem, aListener) {</span>
<a href="#l39.6"></a><span id="l39.6">         var newItem = aItem.clone();</span>
<a href="#l39.7"></a><span id="l39.7">         return this.adoptItem(newItem, aListener);</span>
<a href="#l39.8"></a><span id="l39.8">     },</span>
<a href="#l39.9"></a><span id="l39.9"> </span>
<a href="#l39.10"></a><span id="l39.10">     // void adoptItem( in calIItemBase aItem, in calIOperationListener aListener );</span>
<a href="#l39.11"></a><span id="l39.11">     adoptItem: function (aItem, aListener) {</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-        if (this.readOnly)</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+        if (this.readOnly) {</span>
<a href="#l39.14"></a><span id="l39.14">             throw Components.interfaces.calIErrors.CAL_IS_READONLY;</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-        if (aItem.id == null &amp;&amp; aItem.isMutable)</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+        }</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+        if (aItem.id == null &amp;&amp; aItem.isMutable) {</span>
<a href="#l39.18"></a><span id="l39.18">             aItem.id = cal.getUUID();</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineplus">+        }</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21">         if (aItem.id == null) {</span>
<a href="#l39.22"></a><span id="l39.22">             this.notifyOperationComplete(aListener,</span>
<a href="#l39.23"></a><span id="l39.23">                                          Components.results.NS_ERROR_FAILURE,</span>
<a href="#l39.24"></a><span id="l39.24">                                          Components.interfaces.calIOperationListener.ADD,</span>
<a href="#l39.25"></a><span id="l39.25">                                          aItem.id,</span>
<a href="#l39.26"></a><span id="l39.26">                                          &quot;Can't set ID on non-mutable item to addItem&quot;);</span>
<a href="#l39.27"></a><span id="l39.27">             return;</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineat">@@ -160,18 +162,19 @@ calMemoryCalendar.prototype = {</span>
<a href="#l39.29"></a><span id="l39.29">                                      aItem.id,</span>
<a href="#l39.30"></a><span id="l39.30">                                      aItem);</span>
<a href="#l39.31"></a><span id="l39.31">         // notify observers</span>
<a href="#l39.32"></a><span id="l39.32">         this.mObservers.notify(&quot;onAddItem&quot;, [aItem]);</span>
<a href="#l39.33"></a><span id="l39.33">     },</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35">     // void modifyItem( in calIItemBase aNewItem, in calIItemBase aOldItem, in calIOperationListener aListener );</span>
<a href="#l39.36"></a><span id="l39.36">     modifyItem: function (aNewItem, aOldItem, aListener) {</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineminus">-        if (this.readOnly)</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineplus">+        if (this.readOnly) {</span>
<a href="#l39.39"></a><span id="l39.39">             throw Components.interfaces.calIErrors.CAL_IS_READONLY;</span>
<a href="#l39.40"></a><span id="l39.40" class="difflineplus">+        }</span>
<a href="#l39.41"></a><span id="l39.41">         if (!aNewItem) {</span>
<a href="#l39.42"></a><span id="l39.42">             throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l39.43"></a><span id="l39.43">         }</span>
<a href="#l39.44"></a><span id="l39.44"> </span>
<a href="#l39.45"></a><span id="l39.45">         var this_ = this;</span>
<a href="#l39.46"></a><span id="l39.46">         function reportError(errStr, errId) {</span>
<a href="#l39.47"></a><span id="l39.47">             this_.notifyOperationComplete(aListener,</span>
<a href="#l39.48"></a><span id="l39.48">                                           errId ? errId : Components.results.NS_ERROR_FAILURE,</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineat">@@ -295,18 +298,19 @@ calMemoryCalendar.prototype = {</span>
<a href="#l39.50"></a><span id="l39.50">                                      aItem.id,</span>
<a href="#l39.51"></a><span id="l39.51">                                      aItem);</span>
<a href="#l39.52"></a><span id="l39.52">         // notify observers</span>
<a href="#l39.53"></a><span id="l39.53">         this.mObservers.notify(&quot;onDeleteItem&quot;, [oldItem]);</span>
<a href="#l39.54"></a><span id="l39.54">     },</span>
<a href="#l39.55"></a><span id="l39.55"> </span>
<a href="#l39.56"></a><span id="l39.56">     // void getItem( in string id, in calIOperationListener aListener );</span>
<a href="#l39.57"></a><span id="l39.57">     getItem: function (aId, aListener) {</span>
<a href="#l39.58"></a><span id="l39.58" class="difflineminus">-        if (!aListener)</span>
<a href="#l39.59"></a><span id="l39.59" class="difflineplus">+        if (!aListener) {</span>
<a href="#l39.60"></a><span id="l39.60">             return;</span>
<a href="#l39.61"></a><span id="l39.61" class="difflineplus">+        }</span>
<a href="#l39.62"></a><span id="l39.62"> </span>
<a href="#l39.63"></a><span id="l39.63">         if (aId == null || this.mItems[aId] == null) {</span>
<a href="#l39.64"></a><span id="l39.64">             // querying by id is a valid use case, even if no item is returned:</span>
<a href="#l39.65"></a><span id="l39.65">             this.notifyOperationComplete(aListener,</span>
<a href="#l39.66"></a><span id="l39.66">                                          Components.results.NS_OK,</span>
<a href="#l39.67"></a><span id="l39.67">                                          Components.interfaces.calIOperationListener.GET,</span>
<a href="#l39.68"></a><span id="l39.68">                                          aId,</span>
<a href="#l39.69"></a><span id="l39.69">                                          null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -611,18 +611,19 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">                                      aItem);</span>
<a href="#l40.5"></a><span id="l40.5"> </span>
<a href="#l40.6"></a><span id="l40.6">         // notify observers</span>
<a href="#l40.7"></a><span id="l40.7">         this.observers.notify(&quot;onDeleteItem&quot;, [aItem]);</span>
<a href="#l40.8"></a><span id="l40.8">     },</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10">     // void getItem( in string id, in calIOperationListener aListener );</span>
<a href="#l40.11"></a><span id="l40.11">     getItem: function cSC_getItem(aId, aListener) {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-        if (!aListener)</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+        if (!aListener) {</span>
<a href="#l40.14"></a><span id="l40.14">             return;</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+        }</span>
<a href="#l40.16"></a><span id="l40.16"> </span>
<a href="#l40.17"></a><span id="l40.17">         var item = this.getItemById (aId);</span>
<a href="#l40.18"></a><span id="l40.18">         if (!item) {</span>
<a href="#l40.19"></a><span id="l40.19">             // querying by id is a valid use case, even if no item is returned:</span>
<a href="#l40.20"></a><span id="l40.20">             this.notifyOperationComplete(aListener,</span>
<a href="#l40.21"></a><span id="l40.21">                                          Components.results.NS_OK,</span>
<a href="#l40.22"></a><span id="l40.22">                                          Components.interfaces.calIOperationListener.GET,</span>
<a href="#l40.23"></a><span id="l40.23">                                          aId,</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineat">@@ -665,30 +666,33 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.25"></a><span id="l40.25">         cal.postPone(function() {</span>
<a href="#l40.26"></a><span id="l40.26">             this_.getItems_(aItemFilter, aCount, aRangeStart, aRangeEnd, aListener);</span>
<a href="#l40.27"></a><span id="l40.27">         });</span>
<a href="#l40.28"></a><span id="l40.28">     },</span>
<a href="#l40.29"></a><span id="l40.29">     getItems_: function cSC_getItems_(aItemFilter, aCount,</span>
<a href="#l40.30"></a><span id="l40.30">                                       aRangeStart, aRangeEnd, aListener)</span>
<a href="#l40.31"></a><span id="l40.31">     {</span>
<a href="#l40.32"></a><span id="l40.32">         //var profStartTime = Date.now();</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineminus">-        if (!aListener)</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineplus">+        if (!aListener) {</span>
<a href="#l40.35"></a><span id="l40.35">             return;</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineplus">+        }</span>
<a href="#l40.37"></a><span id="l40.37"> </span>
<a href="#l40.38"></a><span id="l40.38">         let self = this;</span>
<a href="#l40.39"></a><span id="l40.39"> </span>
<a href="#l40.40"></a><span id="l40.40">         let itemsFound = Array();</span>
<a href="#l40.41"></a><span id="l40.41">         let startTime = -0x7fffffffffffffff;</span>
<a href="#l40.42"></a><span id="l40.42">         // endTime needs to be the max value a PRTime can be</span>
<a href="#l40.43"></a><span id="l40.43">         let endTime = 0x7fffffffffffffff;</span>
<a href="#l40.44"></a><span id="l40.44">         let count = 0;</span>
<a href="#l40.45"></a><span id="l40.45" class="difflineminus">-        if (aRangeStart)</span>
<a href="#l40.46"></a><span id="l40.46" class="difflineplus">+        if (aRangeStart) {</span>
<a href="#l40.47"></a><span id="l40.47">             startTime = aRangeStart.nativeTime;</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineminus">-        if (aRangeEnd)</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineplus">+        }</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineplus">+        if (aRangeEnd) {</span>
<a href="#l40.51"></a><span id="l40.51">             endTime = aRangeEnd.nativeTime;</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineplus">+        }</span>
<a href="#l40.53"></a><span id="l40.53"> </span>
<a href="#l40.54"></a><span id="l40.54">         let wantUnrespondedInvitations = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_REQUEST_NEEDS_ACTION) != 0);</span>
<a href="#l40.55"></a><span id="l40.55">         let superCal;</span>
<a href="#l40.56"></a><span id="l40.56">         try {</span>
<a href="#l40.57"></a><span id="l40.57">             superCal = this.superCalendar.QueryInterface(Components.interfaces.calISchedulingSupport);</span>
<a href="#l40.58"></a><span id="l40.58">         } catch (exc) {</span>
<a href="#l40.59"></a><span id="l40.59">             wantUnrespondedInvitations = false;</span>
<a href="#l40.60"></a><span id="l40.60">         }</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineat">@@ -737,23 +741,25 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.62"></a><span id="l40.62">         // a send and a queue clear.</span>
<a href="#l40.63"></a><span id="l40.63">         let maxQueueSize = 10;</span>
<a href="#l40.64"></a><span id="l40.64">         let queuedItems = [];</span>
<a href="#l40.65"></a><span id="l40.65">         let queuedItemsIID;</span>
<a href="#l40.66"></a><span id="l40.66">         function queueItems(theItems, theIID) {</span>
<a href="#l40.67"></a><span id="l40.67">             // if we're about to start sending a different IID,</span>
<a href="#l40.68"></a><span id="l40.68">             // flush the queue</span>
<a href="#l40.69"></a><span id="l40.69">             if (theIID &amp;&amp; queuedItemsIID != theIID) {</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineminus">-                if (queuedItemsIID)</span>
<a href="#l40.71"></a><span id="l40.71" class="difflineplus">+                if (queuedItemsIID) {</span>
<a href="#l40.72"></a><span id="l40.72">                     queueItems(null);</span>
<a href="#l40.73"></a><span id="l40.73" class="difflineplus">+                }</span>
<a href="#l40.74"></a><span id="l40.74">                 queuedItemsIID = theIID;</span>
<a href="#l40.75"></a><span id="l40.75">             }</span>
<a href="#l40.76"></a><span id="l40.76"> </span>
<a href="#l40.77"></a><span id="l40.77" class="difflineminus">-            if (theItems)</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineplus">+            if (theItems) {</span>
<a href="#l40.79"></a><span id="l40.79">                 queuedItems = queuedItems.concat(theItems);</span>
<a href="#l40.80"></a><span id="l40.80" class="difflineplus">+            }</span>
<a href="#l40.81"></a><span id="l40.81"> </span>
<a href="#l40.82"></a><span id="l40.82">             if (queuedItems.length != 0 &amp;&amp; (!theItems || queuedItems.length &gt; maxQueueSize)) {</span>
<a href="#l40.83"></a><span id="l40.83">                 //var listenerStart = Date.now();</span>
<a href="#l40.84"></a><span id="l40.84">                 aListener.onGetResult(self.superCalendar,</span>
<a href="#l40.85"></a><span id="l40.85">                                       Components.results.NS_OK,</span>
<a href="#l40.86"></a><span id="l40.86">                                       queuedItemsIID, null,</span>
<a href="#l40.87"></a><span id="l40.87">                                       queuedItems.length, queuedItems);</span>
<a href="#l40.88"></a><span id="l40.88">                 //var listenerEnd = Date.now();</span>
<a href="#l40.89"></a><span id="l40.89" class="difflineat">@@ -821,19 +827,23 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.90"></a><span id="l40.90">                 this.prepareStatement(this.mSelectNonRecurringEventsByRange);</span>
<a href="#l40.91"></a><span id="l40.91">                 sp = this.mSelectNonRecurringEventsByRange.params;</span>
<a href="#l40.92"></a><span id="l40.92">                 sp.range_start = startTime;</span>
<a href="#l40.93"></a><span id="l40.93">                 sp.range_end = endTime;</span>
<a href="#l40.94"></a><span id="l40.94">                 sp.start_offset = aRangeStart ? aRangeStart.timezoneOffset * USECS_PER_SECOND : 0;</span>
<a href="#l40.95"></a><span id="l40.95">                 sp.end_offset = aRangeEnd ? aRangeEnd.timezoneOffset * USECS_PER_SECOND : 0;</span>
<a href="#l40.96"></a><span id="l40.96">                 sp.offline_journal = null;</span>
<a href="#l40.97"></a><span id="l40.97"> </span>
<a href="#l40.98"></a><span id="l40.98" class="difflineminus">-                if (wantOfflineDeletedItems) sp.offline_journal = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l40.99"></a><span id="l40.99" class="difflineminus">-                else if (wantOfflineCreatedItems) sp.offline_journal = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l40.100"></a><span id="l40.100" class="difflineminus">-                else if (wantOfflineModifiedItems) sp.offline_journal = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineplus">+                if (wantOfflineDeletedItems) {</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineplus">+                    sp.offline_journal = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineplus">+                } else if (wantOfflineCreatedItems) {</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineplus">+                    sp.offline_journal = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineplus">+                } else if (wantOfflineModifiedItems) {</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineplus">+                    sp.offline_journal = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l40.107"></a><span id="l40.107" class="difflineplus">+                }</span>
<a href="#l40.108"></a><span id="l40.108"> </span>
<a href="#l40.109"></a><span id="l40.109">                 while (this.mSelectNonRecurringEventsByRange.executeStep()) {</span>
<a href="#l40.110"></a><span id="l40.110">                     let row = this.mSelectNonRecurringEventsByRange.row;</span>
<a href="#l40.111"></a><span id="l40.111">                     resultItems.push(this.getEventFromRow(row, {}));</span>
<a href="#l40.112"></a><span id="l40.112">                 }</span>
<a href="#l40.113"></a><span id="l40.113">             } catch (e) {</span>
<a href="#l40.114"></a><span id="l40.114">                 this.logError(&quot;Error selecting non recurring events by range!\n&quot;, e);</span>
<a href="#l40.115"></a><span id="l40.115">             } finally {</span>
<a href="#l40.116"></a><span id="l40.116" class="difflineat">@@ -873,19 +883,25 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.117"></a><span id="l40.117">             try {</span>
<a href="#l40.118"></a><span id="l40.118">                 this.prepareStatement(this.mSelectNonRecurringTodosByRange);</span>
<a href="#l40.119"></a><span id="l40.119">                 sp = this.mSelectNonRecurringTodosByRange.params;</span>
<a href="#l40.120"></a><span id="l40.120">                 sp.range_start = startTime;</span>
<a href="#l40.121"></a><span id="l40.121">                 sp.range_end = endTime;</span>
<a href="#l40.122"></a><span id="l40.122">                 sp.start_offset = aRangeStart ? aRangeStart.timezoneOffset * USECS_PER_SECOND : 0;</span>
<a href="#l40.123"></a><span id="l40.123">                 sp.end_offset = aRangeEnd ? aRangeEnd.timezoneOffset * USECS_PER_SECOND : 0;</span>
<a href="#l40.124"></a><span id="l40.124">                 sp.offline_journal = null;</span>
<a href="#l40.125"></a><span id="l40.125" class="difflineminus">-                if (wantOfflineCreatedItems) sp.offline_journal = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l40.126"></a><span id="l40.126" class="difflineminus">-                if (wantOfflineDeletedItems) sp.offline_journal = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l40.127"></a><span id="l40.127" class="difflineminus">-                if (wantOfflineModifiedItems) sp.offline_journal = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l40.128"></a><span id="l40.128" class="difflineplus">+                if (wantOfflineCreatedItems) {</span>
<a href="#l40.129"></a><span id="l40.129" class="difflineplus">+                    sp.offline_journal = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l40.130"></a><span id="l40.130" class="difflineplus">+                }</span>
<a href="#l40.131"></a><span id="l40.131" class="difflineplus">+                if (wantOfflineDeletedItems) {</span>
<a href="#l40.132"></a><span id="l40.132" class="difflineplus">+                    sp.offline_journal = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l40.133"></a><span id="l40.133" class="difflineplus">+                }</span>
<a href="#l40.134"></a><span id="l40.134" class="difflineplus">+                if (wantOfflineModifiedItems) {</span>
<a href="#l40.135"></a><span id="l40.135" class="difflineplus">+                    sp.offline_journal = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l40.136"></a><span id="l40.136" class="difflineplus">+                }</span>
<a href="#l40.137"></a><span id="l40.137"> </span>
<a href="#l40.138"></a><span id="l40.138">                 while (this.mSelectNonRecurringTodosByRange.executeStep()) {</span>
<a href="#l40.139"></a><span id="l40.139">                     let row = this.mSelectNonRecurringTodosByRange.row;</span>
<a href="#l40.140"></a><span id="l40.140">                     resultItems.push(this.getTodoFromRow(row, {}));</span>
<a href="#l40.141"></a><span id="l40.141">                 }</span>
<a href="#l40.142"></a><span id="l40.142">             } catch (e) {</span>
<a href="#l40.143"></a><span id="l40.143">                 this.logError(&quot;Error selecting non recurring todos by range&quot;, e);</span>
<a href="#l40.144"></a><span id="l40.144">             } finally {</span>
<a href="#l40.145"></a><span id="l40.145" class="difflineat">@@ -1491,39 +1507,44 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.146"></a><span id="l40.146">     // database reading functions</span>
<a href="#l40.147"></a><span id="l40.147">     //</span>
<a href="#l40.148"></a><span id="l40.148"> </span>
<a href="#l40.149"></a><span id="l40.149">     // read in the common ItemBase attributes from aDBRow, and stick</span>
<a href="#l40.150"></a><span id="l40.150">     // them on item</span>
<a href="#l40.151"></a><span id="l40.151">     getItemBaseFromRow: function cSC_getItemBaseFromRow(row, flags, item) {</span>
<a href="#l40.152"></a><span id="l40.152">         item.calendar = this.superCalendar;</span>
<a href="#l40.153"></a><span id="l40.153">         item.id = row.id;</span>
<a href="#l40.154"></a><span id="l40.154" class="difflineminus">-        if (row.title)</span>
<a href="#l40.155"></a><span id="l40.155" class="difflineplus">+        if (row.title) {</span>
<a href="#l40.156"></a><span id="l40.156">             item.title = row.title;</span>
<a href="#l40.157"></a><span id="l40.157" class="difflineminus">-        if (row.priority)</span>
<a href="#l40.158"></a><span id="l40.158" class="difflineplus">+        }</span>
<a href="#l40.159"></a><span id="l40.159" class="difflineplus">+        if (row.priority) {</span>
<a href="#l40.160"></a><span id="l40.160">             item.priority = row.priority;</span>
<a href="#l40.161"></a><span id="l40.161" class="difflineminus">-        if (row.privacy)</span>
<a href="#l40.162"></a><span id="l40.162" class="difflineplus">+        }</span>
<a href="#l40.163"></a><span id="l40.163" class="difflineplus">+        if (row.privacy) {</span>
<a href="#l40.164"></a><span id="l40.164">             item.privacy = row.privacy;</span>
<a href="#l40.165"></a><span id="l40.165" class="difflineminus">-        if (row.ical_status)</span>
<a href="#l40.166"></a><span id="l40.166" class="difflineplus">+        }</span>
<a href="#l40.167"></a><span id="l40.167" class="difflineplus">+        if (row.ical_status) {</span>
<a href="#l40.168"></a><span id="l40.168">             item.status = row.ical_status;</span>
<a href="#l40.169"></a><span id="l40.169" class="difflineplus">+        }</span>
<a href="#l40.170"></a><span id="l40.170"> </span>
<a href="#l40.171"></a><span id="l40.171">         if (row.alarm_last_ack) {</span>
<a href="#l40.172"></a><span id="l40.172">             // alarm acks are always in utc</span>
<a href="#l40.173"></a><span id="l40.173">             item.alarmLastAck = newDateTime(row.alarm_last_ack, &quot;UTC&quot;);</span>
<a href="#l40.174"></a><span id="l40.174">         }</span>
<a href="#l40.175"></a><span id="l40.175"> </span>
<a href="#l40.176"></a><span id="l40.176">         if (row.recurrence_id) {</span>
<a href="#l40.177"></a><span id="l40.177">             item.recurrenceId = newDateTime(row.recurrence_id, row.recurrence_id_tz);</span>
<a href="#l40.178"></a><span id="l40.178">             if ((row.flags &amp; CAL_ITEM_FLAG.RECURRENCE_ID_ALLDAY) != 0) {</span>
<a href="#l40.179"></a><span id="l40.179">                 item.recurrenceId.isDate = true;</span>
<a href="#l40.180"></a><span id="l40.180">             }</span>
<a href="#l40.181"></a><span id="l40.181">         }</span>
<a href="#l40.182"></a><span id="l40.182"> </span>
<a href="#l40.183"></a><span id="l40.183" class="difflineminus">-        if (flags)</span>
<a href="#l40.184"></a><span id="l40.184" class="difflineplus">+        if (flags) {</span>
<a href="#l40.185"></a><span id="l40.185">             flags.value = row.flags;</span>
<a href="#l40.186"></a><span id="l40.186" class="difflineplus">+        }</span>
<a href="#l40.187"></a><span id="l40.187"> </span>
<a href="#l40.188"></a><span id="l40.188">         if (row.time_created) {</span>
<a href="#l40.189"></a><span id="l40.189">             item.setProperty(&quot;CREATED&quot;, newDateTime(row.time_created, &quot;UTC&quot;));</span>
<a href="#l40.190"></a><span id="l40.190">         }</span>
<a href="#l40.191"></a><span id="l40.191"> </span>
<a href="#l40.192"></a><span id="l40.192">         // This must be done last because the setting of any other property</span>
<a href="#l40.193"></a><span id="l40.193">         // after this would overwrite it again.</span>
<a href="#l40.194"></a><span id="l40.194">         if (row.last_modified) {</span>
<a href="#l40.195"></a><span id="l40.195" class="difflineat">@@ -1592,22 +1613,25 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.196"></a><span id="l40.196">             item = this.mItemCache[row.id];</span>
<a href="#l40.197"></a><span id="l40.197">             if (item) {</span>
<a href="#l40.198"></a><span id="l40.198">                 return item;</span>
<a href="#l40.199"></a><span id="l40.199">             }</span>
<a href="#l40.200"></a><span id="l40.200">         }</span>
<a href="#l40.201"></a><span id="l40.201"> </span>
<a href="#l40.202"></a><span id="l40.202">         item = createEvent();</span>
<a href="#l40.203"></a><span id="l40.203"> </span>
<a href="#l40.204"></a><span id="l40.204" class="difflineminus">-        if (row.event_start)</span>
<a href="#l40.205"></a><span id="l40.205" class="difflineplus">+        if (row.event_start) {</span>
<a href="#l40.206"></a><span id="l40.206">             item.startDate = newDateTime(row.event_start, row.event_start_tz);</span>
<a href="#l40.207"></a><span id="l40.207" class="difflineminus">-        if (row.event_end)</span>
<a href="#l40.208"></a><span id="l40.208" class="difflineplus">+        }</span>
<a href="#l40.209"></a><span id="l40.209" class="difflineplus">+        if (row.event_end) {</span>
<a href="#l40.210"></a><span id="l40.210">             item.endDate = newDateTime(row.event_end, row.event_end_tz);</span>
<a href="#l40.211"></a><span id="l40.211" class="difflineminus">-        if (row.event_stamp)</span>
<a href="#l40.212"></a><span id="l40.212" class="difflineplus">+        }</span>
<a href="#l40.213"></a><span id="l40.213" class="difflineplus">+        if (row.event_stamp) {</span>
<a href="#l40.214"></a><span id="l40.214">             item.setProperty(&quot;DTSTAMP&quot;, newDateTime(row.event_stamp, &quot;UTC&quot;));</span>
<a href="#l40.215"></a><span id="l40.215" class="difflineplus">+        }</span>
<a href="#l40.216"></a><span id="l40.216">         if ((row.flags &amp; CAL_ITEM_FLAG.EVENT_ALLDAY) != 0) {</span>
<a href="#l40.217"></a><span id="l40.217">             item.startDate.isDate = true;</span>
<a href="#l40.218"></a><span id="l40.218">             item.endDate.isDate = true;</span>
<a href="#l40.219"></a><span id="l40.219">         }</span>
<a href="#l40.220"></a><span id="l40.220"> </span>
<a href="#l40.221"></a><span id="l40.221">         // This must be done last to keep the modification time intact.</span>
<a href="#l40.222"></a><span id="l40.222">         this.getItemBaseFromRow (row, flags, item);</span>
<a href="#l40.223"></a><span id="l40.223">         this.getAdditionalDataForItem(item, flags.value);</span>
<a href="#l40.224"></a><span id="l40.224" class="difflineat">@@ -1625,26 +1649,31 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.225"></a><span id="l40.225">             item = this.mItemCache[row.id];</span>
<a href="#l40.226"></a><span id="l40.226">             if (item) {</span>
<a href="#l40.227"></a><span id="l40.227">                 return item;</span>
<a href="#l40.228"></a><span id="l40.228">             }</span>
<a href="#l40.229"></a><span id="l40.229">         }</span>
<a href="#l40.230"></a><span id="l40.230"> </span>
<a href="#l40.231"></a><span id="l40.231">         item = createTodo();</span>
<a href="#l40.232"></a><span id="l40.232"> </span>
<a href="#l40.233"></a><span id="l40.233" class="difflineminus">-        if (row.todo_entry)</span>
<a href="#l40.234"></a><span id="l40.234" class="difflineplus">+        if (row.todo_entry) {</span>
<a href="#l40.235"></a><span id="l40.235">             item.entryDate = newDateTime(row.todo_entry, row.todo_entry_tz);</span>
<a href="#l40.236"></a><span id="l40.236" class="difflineminus">-        if (row.todo_due)</span>
<a href="#l40.237"></a><span id="l40.237" class="difflineplus">+        }</span>
<a href="#l40.238"></a><span id="l40.238" class="difflineplus">+        if (row.todo_due) {</span>
<a href="#l40.239"></a><span id="l40.239">             item.dueDate = newDateTime(row.todo_due, row.todo_due_tz);</span>
<a href="#l40.240"></a><span id="l40.240" class="difflineminus">-        if (row.todo_stamp)</span>
<a href="#l40.241"></a><span id="l40.241" class="difflineplus">+        }</span>
<a href="#l40.242"></a><span id="l40.242" class="difflineplus">+        if (row.todo_stamp) {</span>
<a href="#l40.243"></a><span id="l40.243">             item.setProperty(&quot;DTSTAMP&quot;, newDateTime(row.todo_stamp, &quot;UTC&quot;));</span>
<a href="#l40.244"></a><span id="l40.244" class="difflineminus">-        if (row.todo_completed)</span>
<a href="#l40.245"></a><span id="l40.245" class="difflineplus">+        }</span>
<a href="#l40.246"></a><span id="l40.246" class="difflineplus">+        if (row.todo_completed) {</span>
<a href="#l40.247"></a><span id="l40.247">             item.completedDate = newDateTime(row.todo_completed, row.todo_completed_tz);</span>
<a href="#l40.248"></a><span id="l40.248" class="difflineminus">-        if (row.todo_complete)</span>
<a href="#l40.249"></a><span id="l40.249" class="difflineplus">+        }</span>
<a href="#l40.250"></a><span id="l40.250" class="difflineplus">+        if (row.todo_complete) {</span>
<a href="#l40.251"></a><span id="l40.251">             item.percentComplete = row.todo_complete;</span>
<a href="#l40.252"></a><span id="l40.252" class="difflineplus">+        }</span>
<a href="#l40.253"></a><span id="l40.253"> </span>
<a href="#l40.254"></a><span id="l40.254">         // This must be done last to keep the modification time intact.</span>
<a href="#l40.255"></a><span id="l40.255">         this.getItemBaseFromRow (row, flags, item);</span>
<a href="#l40.256"></a><span id="l40.256">         this.getAdditionalDataForItem(item, flags.value);</span>
<a href="#l40.257"></a><span id="l40.257"> </span>
<a href="#l40.258"></a><span id="l40.258">         if (!isException) { // keep exceptions modifyable to set the parentItem</span>
<a href="#l40.259"></a><span id="l40.259">             item.makeImmutable();</span>
<a href="#l40.260"></a><span id="l40.260">             this.cacheItem(item);</span>
<a href="#l40.261"></a><span id="l40.261" class="difflineat">@@ -1757,18 +1786,19 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.262"></a><span id="l40.262">                 this.mSelectRecurrenceForItem.reset();</span>
<a href="#l40.263"></a><span id="l40.263">             }</span>
<a href="#l40.264"></a><span id="l40.264">         }</span>
<a href="#l40.265"></a><span id="l40.265"> </span>
<a href="#l40.266"></a><span id="l40.266">         if (flags &amp; CAL_ITEM_FLAG.HAS_EXCEPTIONS) {</span>
<a href="#l40.267"></a><span id="l40.267">             // it's safe that we don't run into this branch again for exceptions</span>
<a href="#l40.268"></a><span id="l40.268">             // (getAdditionalDataForItem-&gt;get[Event|Todo]FromRow-&gt;getAdditionalDataForItem):</span>
<a href="#l40.269"></a><span id="l40.269">             // every excepton has a recurrenceId and isn't flagged as CAL_ITEM_FLAG.HAS_EXCEPTIONS</span>
<a href="#l40.270"></a><span id="l40.270" class="difflineminus">-            if (item.recurrenceId)</span>
<a href="#l40.271"></a><span id="l40.271" class="difflineplus">+            if (item.recurrenceId) {</span>
<a href="#l40.272"></a><span id="l40.272">                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l40.273"></a><span id="l40.273" class="difflineplus">+            }</span>
<a href="#l40.274"></a><span id="l40.274"> </span>
<a href="#l40.275"></a><span id="l40.275">             let rec = item.recurrenceInfo;</span>
<a href="#l40.276"></a><span id="l40.276"> </span>
<a href="#l40.277"></a><span id="l40.277">             if (cal.isEvent(item)) {</span>
<a href="#l40.278"></a><span id="l40.278">                 this.mSelectEventExceptions.params.id = item.id;</span>
<a href="#l40.279"></a><span id="l40.279">                 this.prepareStatement(this.mSelectEventExceptions);</span>
<a href="#l40.280"></a><span id="l40.280">                 try {</span>
<a href="#l40.281"></a><span id="l40.281">                     while (this.mSelectEventExceptions.executeStep()) {</span>
<a href="#l40.282"></a><span id="l40.282" class="difflineat">@@ -2059,20 +2089,22 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.283"></a><span id="l40.283">         ip.id = item.id;</span>
<a href="#l40.284"></a><span id="l40.284"> </span>
<a href="#l40.285"></a><span id="l40.285">         if (item.recurrenceId) {</span>
<a href="#l40.286"></a><span id="l40.286">             this.setDateParamHelper(ip, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l40.287"></a><span id="l40.287">         }</span>
<a href="#l40.288"></a><span id="l40.288"> </span>
<a href="#l40.289"></a><span id="l40.289">         var tmp;</span>
<a href="#l40.290"></a><span id="l40.290"> </span>
<a href="#l40.291"></a><span id="l40.291" class="difflineminus">-        if ((tmp = item.getProperty(&quot;CREATED&quot;)))</span>
<a href="#l40.292"></a><span id="l40.292" class="difflineplus">+        if ((tmp = item.getProperty(&quot;CREATED&quot;))) {</span>
<a href="#l40.293"></a><span id="l40.293">             ip.time_created = tmp.nativeTime;</span>
<a href="#l40.294"></a><span id="l40.294" class="difflineminus">-        if ((tmp = item.getProperty(&quot;LAST-MODIFIED&quot;)))</span>
<a href="#l40.295"></a><span id="l40.295" class="difflineplus">+        }</span>
<a href="#l40.296"></a><span id="l40.296" class="difflineplus">+        if ((tmp = item.getProperty(&quot;LAST-MODIFIED&quot;))) {</span>
<a href="#l40.297"></a><span id="l40.297">             ip.last_modified = tmp.nativeTime;</span>
<a href="#l40.298"></a><span id="l40.298" class="difflineplus">+        }</span>
<a href="#l40.299"></a><span id="l40.299"> </span>
<a href="#l40.300"></a><span id="l40.300">         ip.title = item.getProperty(&quot;SUMMARY&quot;);</span>
<a href="#l40.301"></a><span id="l40.301">         ip.priority = item.getProperty(&quot;PRIORITY&quot;);</span>
<a href="#l40.302"></a><span id="l40.302">         ip.privacy = item.getProperty(&quot;CLASS&quot;);</span>
<a href="#l40.303"></a><span id="l40.303">         ip.ical_status = item.getProperty(&quot;STATUS&quot;);</span>
<a href="#l40.304"></a><span id="l40.304"> </span>
<a href="#l40.305"></a><span id="l40.305">         if (item.alarmLastAck) {</span>
<a href="#l40.306"></a><span id="l40.306">             ip.alarm_last_ack = item.alarmLastAck.nativeTime;</span>
<a href="#l40.307"></a><span id="l40.307" class="difflineat">@@ -2134,18 +2166,19 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.308"></a><span id="l40.308">     },</span>
<a href="#l40.309"></a><span id="l40.309"> </span>
<a href="#l40.310"></a><span id="l40.310">     writeProperties: function cSC_writeProperties(item, olditem) {</span>
<a href="#l40.311"></a><span id="l40.311">         var ret = 0;</span>
<a href="#l40.312"></a><span id="l40.312">         var propEnumerator = item.propertyEnumerator;</span>
<a href="#l40.313"></a><span id="l40.313">         while (propEnumerator.hasMoreElements()) {</span>
<a href="#l40.314"></a><span id="l40.314">             ret = CAL_ITEM_FLAG.HAS_PROPERTIES;</span>
<a href="#l40.315"></a><span id="l40.315">             var prop = propEnumerator.getNext().QueryInterface(Components.interfaces.nsIProperty);</span>
<a href="#l40.316"></a><span id="l40.316" class="difflineminus">-            if (item.isPropertyPromoted(prop.name))</span>
<a href="#l40.317"></a><span id="l40.317" class="difflineplus">+            if (item.isPropertyPromoted(prop.name)) {</span>
<a href="#l40.318"></a><span id="l40.318">                 continue;</span>
<a href="#l40.319"></a><span id="l40.319" class="difflineplus">+            }</span>
<a href="#l40.320"></a><span id="l40.320">             this.writeProperty(item, prop.name, prop.value);</span>
<a href="#l40.321"></a><span id="l40.321">         }</span>
<a href="#l40.322"></a><span id="l40.322"> </span>
<a href="#l40.323"></a><span id="l40.323">         var cats = item.getCategories({});</span>
<a href="#l40.324"></a><span id="l40.324">         if (cats.length &gt; 0) {</span>
<a href="#l40.325"></a><span id="l40.325">             ret = CAL_ITEM_FLAG.HAS_PROPERTIES;</span>
<a href="#l40.326"></a><span id="l40.326">             this.writeProperty(item, &quot;CATEGORIES&quot;, categoriesArrayToString(cats));</span>
<a href="#l40.327"></a><span id="l40.327">         }</span>
<a href="#l40.328"></a><span id="l40.328" class="difflineat">@@ -2176,18 +2209,19 @@ calStorageCalendar.prototype = {</span>
<a href="#l40.329"></a><span id="l40.329">             if (exceptions.length &gt; 0) {</span>
<a href="#l40.330"></a><span id="l40.330">                 flags |= CAL_ITEM_FLAG.HAS_EXCEPTIONS;</span>
<a href="#l40.331"></a><span id="l40.331"> </span>
<a href="#l40.332"></a><span id="l40.332">                 // we need to serialize each exid as a separate</span>
<a href="#l40.333"></a><span id="l40.333">                 // event/todo; setupItemBase will handle</span>
<a href="#l40.334"></a><span id="l40.334">                 // writing the recurrenceId for us</span>
<a href="#l40.335"></a><span id="l40.335">                 for (let exid of exceptions) {</span>
<a href="#l40.336"></a><span id="l40.336">                     let ex = rec.getExceptionFor(exid);</span>
<a href="#l40.337"></a><span id="l40.337" class="difflineminus">-                    if (!ex)</span>
<a href="#l40.338"></a><span id="l40.338" class="difflineplus">+                    if (!ex) {</span>
<a href="#l40.339"></a><span id="l40.339">                         throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l40.340"></a><span id="l40.340" class="difflineplus">+                    }</span>
<a href="#l40.341"></a><span id="l40.341">                     this.writeItem(ex, null);</span>
<a href="#l40.342"></a><span id="l40.342">                 }</span>
<a href="#l40.343"></a><span id="l40.343">             }</span>
<a href="#l40.344"></a><span id="l40.344">         } else  if (item.recurrenceId &amp;&amp; item.recurrenceId.isDate) {</span>
<a href="#l40.345"></a><span id="l40.345">             flags |= CAL_ITEM_FLAG.RECURRENCE_ID_ALLDAY;</span>
<a href="#l40.346"></a><span id="l40.346">         }</span>
<a href="#l40.347"></a><span id="l40.347"> </span>
<a href="#l40.348"></a><span id="l40.348">         return flags;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/providers/storage/calStorageHelpers.jsm</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageHelpers.jsm</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -94,18 +94,19 @@ function textToDate(d) {</span>
<a href="#l41.4"></a><span id="l41.4">     let date;</span>
<a href="#l41.5"></a><span id="l41.5">     if (d[0] == 'U' || d[0] == 'Z') {</span>
<a href="#l41.6"></a><span id="l41.6">         date = newDateTime(dval, tz);</span>
<a href="#l41.7"></a><span id="l41.7">     } else if (d[0] == 'L') {</span>
<a href="#l41.8"></a><span id="l41.8">         // is local time</span>
<a href="#l41.9"></a><span id="l41.9">         date = newDateTime(dval, &quot;floating&quot;);</span>
<a href="#l41.10"></a><span id="l41.10">     }</span>
<a href="#l41.11"></a><span id="l41.11"> </span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    if (d[1] == 'D')</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    if (d[1] == 'D') {</span>
<a href="#l41.14"></a><span id="l41.14">         date.isDate = true;</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+    }</span>
<a href="#l41.16"></a><span id="l41.16">     return date;</span>
<a href="#l41.17"></a><span id="l41.17"> }</span>
<a href="#l41.18"></a><span id="l41.18"> </span>
<a href="#l41.19"></a><span id="l41.19"> //</span>
<a href="#l41.20"></a><span id="l41.20"> // other helpers</span>
<a href="#l41.21"></a><span id="l41.21"> //</span>
<a href="#l41.22"></a><span id="l41.22"> </span>
<a href="#l41.23"></a><span id="l41.23"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -1491,19 +1491,21 @@ upgrade.v22 = function upgrade_v22(db, v</span>
<a href="#l42.4"></a><span id="l42.4">                          aStatus, aType, aIsOrganizer, aProperties] =</span>
<a href="#l42.5"></a><span id="l42.5">                          mapStorageArgs(storArgs);</span>
<a href="#l42.6"></a><span id="l42.6"> </span>
<a href="#l42.7"></a><span id="l42.7">                     let attendee = cal.createAttendee();</span>
<a href="#l42.8"></a><span id="l42.8"> </span>
<a href="#l42.9"></a><span id="l42.9">                     attendee.id = aAttendeeId;</span>
<a href="#l42.10"></a><span id="l42.10">                     attendee.commonName = aCommonName;</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-                    if (aRsvp === 0) attendee.rsvp = &quot;FALSE&quot;;</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-                    if (aRsvp === 1) attendee.rsvp = &quot;TRUE&quot;;</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">-                    // default: keep undefined</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+                    switch (aRsvp) {</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+                        case 0: attendee.rsvp = &quot;FALSE&quot;; break;</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+                        case 1: attendee.rsvp = &quot;TRUE&quot;; break;</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+                        // default: keep undefined</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+                    }</span>
<a href="#l42.20"></a><span id="l42.20"> </span>
<a href="#l42.21"></a><span id="l42.21">                     attendee.role = aRole;</span>
<a href="#l42.22"></a><span id="l42.22">                     attendee.participationStatus = aStatus;</span>
<a href="#l42.23"></a><span id="l42.23">                     attendee.userType = aType;</span>
<a href="#l42.24"></a><span id="l42.24">                     attendee.isOrganizer = !!aIsOrganizer;</span>
<a href="#l42.25"></a><span id="l42.25">                     if (aProperties) {</span>
<a href="#l42.26"></a><span id="l42.26">                         for (let pair of aProperties.split(&quot;,&quot;)) {</span>
<a href="#l42.27"></a><span id="l42.27">                             let [key, value] = pair.split(&quot;:&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -242,18 +242,19 @@ calWcapCalendar.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4"> </span>
<a href="#l43.5"></a><span id="l43.5">     get ownerId() {</span>
<a href="#l43.6"></a><span id="l43.6">         var ar = this.getCalendarProperties(&quot;X-NSCP-CALPROPS-PRIMARY-OWNER&quot;);</span>
<a href="#l43.7"></a><span id="l43.7">         if (ar.length == 0) {</span>
<a href="#l43.8"></a><span id="l43.8">             var calId = this.calId;</span>
<a href="#l43.9"></a><span id="l43.9">             log(&quot;cannot determine primary owner of calendar &quot; + calId, this);</span>
<a href="#l43.10"></a><span id="l43.10">             // fallback to calId prefix:</span>
<a href="#l43.11"></a><span id="l43.11">             var nColon = calId.indexOf(&quot;:&quot;);</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-            if (nColon &gt;= 0)</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+            if (nColon &gt;= 0) {</span>
<a href="#l43.14"></a><span id="l43.14">                 calId = calId.substring(0, nColon);</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineplus">+            }</span>
<a href="#l43.16"></a><span id="l43.16">             return calId;</span>
<a href="#l43.17"></a><span id="l43.17">         }</span>
<a href="#l43.18"></a><span id="l43.18">         return ar[0];</span>
<a href="#l43.19"></a><span id="l43.19">     },</span>
<a href="#l43.20"></a><span id="l43.20"> </span>
<a href="#l43.21"></a><span id="l43.21">     get description() {</span>
<a href="#l43.22"></a><span id="l43.22">         var ar = this.getCalendarProperties(&quot;X-NSCP-CALPROPS-DESCRIPTION&quot;);</span>
<a href="#l43.23"></a><span id="l43.23">         if (ar.length == 0) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1090,18 +1090,19 @@ function calWcapCalendar_getItem(id, lis</span>
<a href="#l44.4"></a><span id="l44.4">                     if (!checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) &amp;&amp;</span>
<a href="#l44.5"></a><span id="l44.5">                         !checkErrorCode(err, calIWcapErrors.WCAP_COMPONENT_NOT_FOUND)) {</span>
<a href="#l44.6"></a><span id="l44.6">                         throw err;</span>
<a href="#l44.7"></a><span id="l44.7">                     }</span>
<a href="#l44.8"></a><span id="l44.8">                     // try todos:</span>
<a href="#l44.9"></a><span id="l44.9">                     this_.issueNetworkRequest(</span>
<a href="#l44.10"></a><span id="l44.10">                         request,</span>
<a href="#l44.11"></a><span id="l44.11">                         function fetchTodosById_resp(err, icalRootComp) {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-                            if (err)</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+                            if (err) {</span>
<a href="#l44.14"></a><span id="l44.14">                                 throw err;</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+                            }</span>
<a href="#l44.16"></a><span id="l44.16">                             notifyResult(icalRootComp);</span>
<a href="#l44.17"></a><span id="l44.17">                         },</span>
<a href="#l44.18"></a><span id="l44.18">                         stringToIcal, &quot;fetchtodos_by_id&quot;, params, calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l44.19"></a><span id="l44.19">                 } else {</span>
<a href="#l44.20"></a><span id="l44.20">                     notifyResult(icalRootComp);</span>
<a href="#l44.21"></a><span id="l44.21">                 }</span>
<a href="#l44.22"></a><span id="l44.22">             },</span>
<a href="#l44.23"></a><span id="l44.23">             stringToIcal, &quot;fetchevents_by_id&quot;, params, calIWcapCalendar.AC_COMP_READ);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapErrors.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapErrors.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -103,18 +103,19 @@ var g_nsNetErrorCodes = [</span>
<a href="#l45.4"></a><span id="l45.4">     ];</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6"> function netErrorToString(rc) {</span>
<a href="#l45.7"></a><span id="l45.7">     if (!isNaN(rc) &amp;&amp; getErrorModule(rc) == NS_ERROR_MODULE_NETWORK) {</span>
<a href="#l45.8"></a><span id="l45.8">         var i = 0;</span>
<a href="#l45.9"></a><span id="l45.9">         while (i &lt; g_nsNetErrorCodes.length) {</span>
<a href="#l45.10"></a><span id="l45.10">             // however rc is kept unsigned, our generated code signed,</span>
<a href="#l45.11"></a><span id="l45.11">             // so == won't work here:</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-            if ((g_nsNetErrorCodes[i] ^ rc) == 0)</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+            if ((g_nsNetErrorCodes[i] ^ rc) == 0) {</span>
<a href="#l45.14"></a><span id="l45.14">                 return g_nsNetErrorCodes[i + 1];</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineplus">+            }</span>
<a href="#l45.16"></a><span id="l45.16">             i += 2;</span>
<a href="#l45.17"></a><span id="l45.17">         }</span>
<a href="#l45.18"></a><span id="l45.18">     }</span>
<a href="#l45.19"></a><span id="l45.19">     throw new Components.Exception(&quot;No known network error code: &quot; + rc.toString(0x10), NS_ERROR_INVALID_ARG);</span>
<a href="#l45.20"></a><span id="l45.20"> }</span>
<a href="#l45.21"></a><span id="l45.21"> </span>
<a href="#l45.22"></a><span id="l45.22"> </span>
<a href="#l45.23"></a><span id="l45.23"> //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -481,18 +481,19 @@ calWcapSession.prototype = {</span>
<a href="#l46.4"></a><span id="l46.4">             request_.attachSubRequest(request);</span>
<a href="#l46.5"></a><span id="l46.5">         }</span>
<a href="#l46.6"></a><span id="l46.6"> </span>
<a href="#l46.7"></a><span id="l46.7">         request.lockPending();</span>
<a href="#l46.8"></a><span id="l46.8">         try {</span>
<a href="#l46.9"></a><span id="l46.9">             this.issueNetworkRequest_(</span>
<a href="#l46.10"></a><span id="l46.10">                 request,</span>
<a href="#l46.11"></a><span id="l46.11">                 function userprefs_resp(err, data) {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-                    if (err)</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+                    if (err) {</span>
<a href="#l46.14"></a><span id="l46.14">                         throw err;</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineplus">+                    }</span>
<a href="#l46.16"></a><span id="l46.16">                     this_.credentials.userPrefs = data;</span>
<a href="#l46.17"></a><span id="l46.17">                     log(&quot;installed user prefs.&quot;, this_);</span>
<a href="#l46.18"></a><span id="l46.18"> </span>
<a href="#l46.19"></a><span id="l46.19">                     // get calprops for all registered calendars:</span>
<a href="#l46.20"></a><span id="l46.20">                     var cals = this_.getRegisteredCalendars(true);</span>
<a href="#l46.21"></a><span id="l46.21"> </span>
<a href="#l46.22"></a><span id="l46.22">                     var calprops_resp = null;</span>
<a href="#l46.23"></a><span id="l46.23">                     var defaultCal = this_.defaultCalendar;</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineat">@@ -746,20 +747,21 @@ calWcapSession.prototype = {</span>
<a href="#l46.25"></a><span id="l46.25"> </span>
<a href="#l46.26"></a><span id="l46.26">         var url = this.getCommandUrl(wcapCommand, params, sessionId);</span>
<a href="#l46.27"></a><span id="l46.27">         var this_ = this;</span>
<a href="#l46.28"></a><span id="l46.28">         issueNetworkRequest(request,</span>
<a href="#l46.29"></a><span id="l46.29">                             function netResp(err, str) {</span>
<a href="#l46.30"></a><span id="l46.30">                                 var data;</span>
<a href="#l46.31"></a><span id="l46.31">                                 if (!err) {</span>
<a href="#l46.32"></a><span id="l46.32">                                     try {</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineminus">-                                        if (dataConvFunc)</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineplus">+                                        if (dataConvFunc) {</span>
<a href="#l46.35"></a><span id="l46.35">                                             data = dataConvFunc(this_, str);</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineminus">-                                        else</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineplus">+                                        } else {</span>
<a href="#l46.38"></a><span id="l46.38">                                             data = str;</span>
<a href="#l46.39"></a><span id="l46.39" class="difflineplus">+                                        }</span>
<a href="#l46.40"></a><span id="l46.40">                                     } catch (exc) {</span>
<a href="#l46.41"></a><span id="l46.41">                                         err = exc;</span>
<a href="#l46.42"></a><span id="l46.42">                                     }</span>
<a href="#l46.43"></a><span id="l46.43">                                 }</span>
<a href="#l46.44"></a><span id="l46.44">                                 request.execSubRespFunc(respFunc, err, data);</span>
<a href="#l46.45"></a><span id="l46.45">                             }, url);</span>
<a href="#l46.46"></a><span id="l46.46">     },</span>
<a href="#l46.47"></a><span id="l46.47"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -187,18 +187,19 @@ function doCreateCalendar() {</span>
<a href="#l47.4"></a><span id="l47.4"> }</span>
<a href="#l47.5"></a><span id="l47.5"> </span>
<a href="#l47.6"></a><span id="l47.6"> /**</span>
<a href="#l47.7"></a><span id="l47.7">  * Initializes the calendar name from its uri</span>
<a href="#l47.8"></a><span id="l47.8">  */</span>
<a href="#l47.9"></a><span id="l47.9"> function initNameFromURI() {</span>
<a href="#l47.10"></a><span id="l47.10">     let path = document.getElementById(&quot;calendar-uri&quot;).value;</span>
<a href="#l47.11"></a><span id="l47.11">     let nameField = document.getElementById(&quot;calendar-name&quot;);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    if (!path || nameField.value)</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+    if (!path || nameField.value) {</span>
<a href="#l47.14"></a><span id="l47.14">         return;</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineplus">+    }</span>
<a href="#l47.16"></a><span id="l47.16"> </span>
<a href="#l47.17"></a><span id="l47.17">     let fullPathRegex = new RegExp(&quot;([^/:]+)[.]ics$&quot;);</span>
<a href="#l47.18"></a><span id="l47.18">     let captures = path.match(fullPathRegex);</span>
<a href="#l47.19"></a><span id="l47.19">     if (captures &amp;&amp; captures.length &gt;= 1) {</span>
<a href="#l47.20"></a><span id="l47.20">         nameField.value = decodeURIComponent(captures[1]);</span>
<a href="#l47.21"></a><span id="l47.21">     }</span>
<a href="#l47.22"></a><span id="l47.22"> }</span>
<a href="#l47.23"></a><span id="l47.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -572,20 +572,21 @@</span>
<a href="#l48.4"></a><span id="l48.4">     &lt;implementation&gt;</span>
<a href="#l48.5"></a><span id="l48.5">       &lt;constructor&gt;</span>
<a href="#l48.6"></a><span id="l48.6">         &lt;![CDATA[</span>
<a href="#l48.7"></a><span id="l48.7">           var hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l48.8"></a><span id="l48.8">           this.kTextBox = hbox.childNodes[0];</span>
<a href="#l48.9"></a><span id="l48.9">           this.kTextBox.kTimePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11">           var val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-          if (val)</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+          if (val) {</span>
<a href="#l48.14"></a><span id="l48.14">             this.value = (new Date(val));</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineminus">-          else</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineplus">+          } else {</span>
<a href="#l48.17"></a><span id="l48.17">             this.value = (new Date());</span>
<a href="#l48.18"></a><span id="l48.18" class="difflineplus">+          }</span>
<a href="#l48.19"></a><span id="l48.19"> </span>
<a href="#l48.20"></a><span id="l48.20">           // Change the grids in the timepicker-grids for 12-hours time format.</span>
<a href="#l48.21"></a><span id="l48.21">           if (this.ampmIndex) {</span>
<a href="#l48.22"></a><span id="l48.22">             // Find the locale strings for the AM/PM prefix/suffix.</span>
<a href="#l48.23"></a><span id="l48.23">             let amTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l48.24"></a><span id="l48.24">             let pmTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l48.25"></a><span id="l48.25">             amTime = amTime.toLocaleFormat(this.kTimeFormatString);</span>
<a href="#l48.26"></a><span id="l48.26">             pmTime = pmTime.toLocaleFormat(this.kTimeFormatString);</span>
<a href="#l48.27"></a><span id="l48.27" class="difflineat">@@ -1140,18 +1141,19 @@</span>
<a href="#l48.28"></a><span id="l48.28">             }</span>
<a href="#l48.29"></a><span id="l48.29">           ]]&gt;</span>
<a href="#l48.30"></a><span id="l48.30">         &lt;/body&gt;</span>
<a href="#l48.31"></a><span id="l48.31">       &lt;/method&gt;</span>
<a href="#l48.32"></a><span id="l48.32"> </span>
<a href="#l48.33"></a><span id="l48.33">       &lt;method name=&quot;onPopupHiding&quot;&gt;</span>
<a href="#l48.34"></a><span id="l48.34">         &lt;body&gt;</span>
<a href="#l48.35"></a><span id="l48.35">           &lt;![CDATA[</span>
<a href="#l48.36"></a><span id="l48.36" class="difflineminus">-            if (this.hasChanged)</span>
<a href="#l48.37"></a><span id="l48.37" class="difflineplus">+            if (this.hasChanged) {</span>
<a href="#l48.38"></a><span id="l48.38">                 this.timeSelected();</span>
<a href="#l48.39"></a><span id="l48.39" class="difflineplus">+            }</span>
<a href="#l48.40"></a><span id="l48.40">           ]]&gt;</span>
<a href="#l48.41"></a><span id="l48.41">         &lt;/body&gt;</span>
<a href="#l48.42"></a><span id="l48.42">       &lt;/method&gt;</span>
<a href="#l48.43"></a><span id="l48.43"> </span>
<a href="#l48.44"></a><span id="l48.44">       &lt;!-- Called when the more tab is clicked, and possibly at startup --&gt;</span>
<a href="#l48.45"></a><span id="l48.45">       &lt;method name=&quot;clickMore&quot;&gt;</span>
<a href="#l48.46"></a><span id="l48.46">         &lt;body&gt;</span>
<a href="#l48.47"></a><span id="l48.47">           &lt;![CDATA[</span>
<a href="#l48.48"></a><span id="l48.48" class="difflineat">@@ -1272,47 +1274,50 @@</span>
<a href="#l48.49"></a><span id="l48.49">       &lt;/method&gt;</span>
<a href="#l48.50"></a><span id="l48.50"> </span>
<a href="#l48.51"></a><span id="l48.51">       &lt;!-- Helper function to select an hour item --&gt;</span>
<a href="#l48.52"></a><span id="l48.52">       &lt;method name=&quot;selectHourItem&quot;&gt;</span>
<a href="#l48.53"></a><span id="l48.53">         &lt;parameter name=&quot;hourItem&quot;/&gt;</span>
<a href="#l48.54"></a><span id="l48.54">         &lt;body&gt;</span>
<a href="#l48.55"></a><span id="l48.55">           &lt;![CDATA[</span>
<a href="#l48.56"></a><span id="l48.56">             // clear old selection, if there is one</span>
<a href="#l48.57"></a><span id="l48.57" class="difflineminus">-            if (this.mSelectedHourItem != null)</span>
<a href="#l48.58"></a><span id="l48.58" class="difflineplus">+            if (this.mSelectedHourItem != null) {</span>
<a href="#l48.59"></a><span id="l48.59">               this.mSelectedHourItem.removeAttribute( &quot;selected&quot; );</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineplus">+            }</span>
<a href="#l48.61"></a><span id="l48.61">             // set selected attribute, to cause the selected style to apply</span>
<a href="#l48.62"></a><span id="l48.62">             hourItem.setAttribute( &quot;selected&quot;, &quot;true&quot; );</span>
<a href="#l48.63"></a><span id="l48.63">             // remember the selected item so we can deselect it</span>
<a href="#l48.64"></a><span id="l48.64">             this.mSelectedHourItem = hourItem;</span>
<a href="#l48.65"></a><span id="l48.65">           ]]&gt;</span>
<a href="#l48.66"></a><span id="l48.66">         &lt;/body&gt;</span>
<a href="#l48.67"></a><span id="l48.67">       &lt;/method&gt;</span>
<a href="#l48.68"></a><span id="l48.68"> </span>
<a href="#l48.69"></a><span id="l48.69">       &lt;!-- Helper function to select an minute item --&gt;</span>
<a href="#l48.70"></a><span id="l48.70">       &lt;method name=&quot;selectMinuteItem&quot;&gt;</span>
<a href="#l48.71"></a><span id="l48.71">         &lt;parameter name=&quot;minuteItem&quot;/&gt;</span>
<a href="#l48.72"></a><span id="l48.72">         &lt;body&gt;</span>
<a href="#l48.73"></a><span id="l48.73">           &lt;![CDATA[</span>
<a href="#l48.74"></a><span id="l48.74">             // clear old selection, if there is one</span>
<a href="#l48.75"></a><span id="l48.75" class="difflineminus">-            if (this.mSelectedMinuteItem != null)</span>
<a href="#l48.76"></a><span id="l48.76" class="difflineplus">+            if (this.mSelectedMinuteItem != null) {</span>
<a href="#l48.77"></a><span id="l48.77">               this.mSelectedMinuteItem.removeAttribute( &quot;selected&quot; );</span>
<a href="#l48.78"></a><span id="l48.78" class="difflineplus">+            }</span>
<a href="#l48.79"></a><span id="l48.79">             // set selected attribute, to cause the selected style to apply</span>
<a href="#l48.80"></a><span id="l48.80">             minuteItem.setAttribute( &quot;selected&quot;, &quot;true&quot; );</span>
<a href="#l48.81"></a><span id="l48.81">             // remember the selected item so we can deselect it</span>
<a href="#l48.82"></a><span id="l48.82">             this.mSelectedMinuteItem = minuteItem;</span>
<a href="#l48.83"></a><span id="l48.83">           ]]&gt;</span>
<a href="#l48.84"></a><span id="l48.84">         &lt;/body&gt;</span>
<a href="#l48.85"></a><span id="l48.85">       &lt;/method&gt;</span>
<a href="#l48.86"></a><span id="l48.86">       &lt;method name=&quot;moveMinutes&quot;&gt;</span>
<a href="#l48.87"></a><span id="l48.87">         &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l48.88"></a><span id="l48.88">         &lt;body&gt;</span>
<a href="#l48.89"></a><span id="l48.89">           &lt;![CDATA[</span>
<a href="#l48.90"></a><span id="l48.90" class="difflineminus">-            if (!this.mSelectedTime)</span>
<a href="#l48.91"></a><span id="l48.91" class="difflineplus">+            if (!this.mSelectedTime) {</span>
<a href="#l48.92"></a><span id="l48.92">               return;</span>
<a href="#l48.93"></a><span id="l48.93" class="difflineplus">+            }</span>
<a href="#l48.94"></a><span id="l48.94"> </span>
<a href="#l48.95"></a><span id="l48.95">             var idPrefix = &quot;time-picker-one-minute-box-&quot;;</span>
<a href="#l48.96"></a><span id="l48.96"> </span>
<a href="#l48.97"></a><span id="l48.97">             // Everything above assumes that we are showing the one-minute-grid,</span>
<a href="#l48.98"></a><span id="l48.98">             // If not, we need to do these corrections;</span>
<a href="#l48.99"></a><span id="l48.99">             var fiveMinuteBox = document.getAnonymousElementByAttribute(</span>
<a href="#l48.100"></a><span id="l48.100">                                 this, &quot;anonid&quot;, &quot;time-picker-five-minute-grid-box&quot;);</span>
<a href="#l48.101"></a><span id="l48.101"> </span>
<a href="#l48.102"></a><span id="l48.102" class="difflineat">@@ -1323,46 +1328,51 @@</span>
<a href="#l48.103"></a><span id="l48.103">               // If the detailed view was shown before, then mSelectedTime.getMinutes</span>
<a href="#l48.104"></a><span id="l48.104">               // might not be a multiple of 5.</span>
<a href="#l48.105"></a><span id="l48.105">               this.mSelectedTime.setMinutes(this.calcNearestFiveMinutes(this.mSelectedTime));</span>
<a href="#l48.106"></a><span id="l48.106">             }</span>
<a href="#l48.107"></a><span id="l48.107"> </span>
<a href="#l48.108"></a><span id="l48.108">             var newMinutes = this.mSelectedTime.getMinutes() + aNumber;</span>
<a href="#l48.109"></a><span id="l48.109"> </span>
<a href="#l48.110"></a><span id="l48.110">             // Handle rollover cases</span>
<a href="#l48.111"></a><span id="l48.111" class="difflineminus">-            if (newMinutes &lt; 0)</span>
<a href="#l48.112"></a><span id="l48.112" class="difflineplus">+            if (newMinutes &lt; 0) {</span>
<a href="#l48.113"></a><span id="l48.113">                 newMinutes += 60;</span>
<a href="#l48.114"></a><span id="l48.114" class="difflineminus">-            if (newMinutes &gt; 59)</span>
<a href="#l48.115"></a><span id="l48.115" class="difflineplus">+            }</span>
<a href="#l48.116"></a><span id="l48.116" class="difflineplus">+            if (newMinutes &gt; 59) {</span>
<a href="#l48.117"></a><span id="l48.117">                 newMinutes -= 60;</span>
<a href="#l48.118"></a><span id="l48.118" class="difflineplus">+            }</span>
<a href="#l48.119"></a><span id="l48.119"> </span>
<a href="#l48.120"></a><span id="l48.120">             this.mSelectedTime.setMinutes(newMinutes);</span>
<a href="#l48.121"></a><span id="l48.121"> </span>
<a href="#l48.122"></a><span id="l48.122">             var minuteItemId = idPrefix + this.mSelectedTime.getMinutes();</span>
<a href="#l48.123"></a><span id="l48.123">             var minuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, minuteItemId);</span>
<a href="#l48.124"></a><span id="l48.124"> </span>
<a href="#l48.125"></a><span id="l48.125">             this.selectMinuteItem(minuteItem);</span>
<a href="#l48.126"></a><span id="l48.126">             this.mPicker.kTextBox.value = this.mPicker.formatTime(this.mSelectedTime);</span>
<a href="#l48.127"></a><span id="l48.127">             this.hasChanged = true;</span>
<a href="#l48.128"></a><span id="l48.128">           ]]&gt;</span>
<a href="#l48.129"></a><span id="l48.129">         &lt;/body&gt;</span>
<a href="#l48.130"></a><span id="l48.130">       &lt;/method&gt;</span>
<a href="#l48.131"></a><span id="l48.131">       &lt;method name=&quot;moveHours&quot;&gt;</span>
<a href="#l48.132"></a><span id="l48.132">         &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l48.133"></a><span id="l48.133">         &lt;body&gt;</span>
<a href="#l48.134"></a><span id="l48.134">           &lt;![CDATA[</span>
<a href="#l48.135"></a><span id="l48.135" class="difflineminus">-            if (!this.mSelectedTime)</span>
<a href="#l48.136"></a><span id="l48.136" class="difflineplus">+            if (!this.mSelectedTime) {</span>
<a href="#l48.137"></a><span id="l48.137">               return;</span>
<a href="#l48.138"></a><span id="l48.138" class="difflineplus">+            }</span>
<a href="#l48.139"></a><span id="l48.139"> </span>
<a href="#l48.140"></a><span id="l48.140">             var newHours = this.mSelectedTime.getHours() + aNumber;</span>
<a href="#l48.141"></a><span id="l48.141"> </span>
<a href="#l48.142"></a><span id="l48.142">             // Handle rollover cases</span>
<a href="#l48.143"></a><span id="l48.143" class="difflineminus">-            if (newHours &lt; 0)</span>
<a href="#l48.144"></a><span id="l48.144" class="difflineplus">+            if (newHours &lt; 0) {</span>
<a href="#l48.145"></a><span id="l48.145">                 newHours += 24;</span>
<a href="#l48.146"></a><span id="l48.146" class="difflineminus">-            if (newHours &gt; 23)</span>
<a href="#l48.147"></a><span id="l48.147" class="difflineplus">+            }</span>
<a href="#l48.148"></a><span id="l48.148" class="difflineplus">+            if (newHours &gt; 23) {</span>
<a href="#l48.149"></a><span id="l48.149">                 newHours -= 24;</span>
<a href="#l48.150"></a><span id="l48.150" class="difflineplus">+            }</span>
<a href="#l48.151"></a><span id="l48.151"> </span>
<a href="#l48.152"></a><span id="l48.152">             this.mSelectedTime.setHours(newHours);</span>
<a href="#l48.153"></a><span id="l48.153"> </span>
<a href="#l48.154"></a><span id="l48.154">             var hourItemId = &quot;time-picker-hour-box-&quot; + this.mSelectedTime.getHours();</span>
<a href="#l48.155"></a><span id="l48.155">             var hourItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, hourItemId);</span>
<a href="#l48.156"></a><span id="l48.156"> </span>
<a href="#l48.157"></a><span id="l48.157">             this.selectHourItem(hourItem);</span>
<a href="#l48.158"></a><span id="l48.158">             this.mPicker.kTextBox.value = this.mPicker.formatTime(this.mSelectedTime);</span>
<a href="#l48.159"></a><span id="l48.159" class="difflineat">@@ -1374,18 +1384,19 @@</span>
<a href="#l48.160"></a><span id="l48.160">       &lt;!-- Helper function to calulate the nearest even five minutes --&gt;</span>
<a href="#l48.161"></a><span id="l48.161">       &lt;method name=&quot;calcNearestFiveMinutes&quot;&gt;</span>
<a href="#l48.162"></a><span id="l48.162">         &lt;parameter name=&quot;time&quot;/&gt;</span>
<a href="#l48.163"></a><span id="l48.163">         &lt;body&gt;</span>
<a href="#l48.164"></a><span id="l48.164">           &lt;![CDATA[</span>
<a href="#l48.165"></a><span id="l48.165">             var minutes = time.getMinutes();</span>
<a href="#l48.166"></a><span id="l48.166">             var minutesByFive = Math.round( minutes / 5 ) * 5;</span>
<a href="#l48.167"></a><span id="l48.167"> </span>
<a href="#l48.168"></a><span id="l48.168" class="difflineminus">-            if (minutesByFive &gt; 59)</span>
<a href="#l48.169"></a><span id="l48.169" class="difflineplus">+            if (minutesByFive &gt; 59) {</span>
<a href="#l48.170"></a><span id="l48.170">               minutesByFive = 55;</span>
<a href="#l48.171"></a><span id="l48.171" class="difflineplus">+            }</span>
<a href="#l48.172"></a><span id="l48.172">             return minutesByFive;</span>
<a href="#l48.173"></a><span id="l48.173">           ]]&gt;</span>
<a href="#l48.174"></a><span id="l48.174">         &lt;/body&gt;</span>
<a href="#l48.175"></a><span id="l48.175">       &lt;/method&gt;</span>
<a href="#l48.176"></a><span id="l48.176"> </span>
<a href="#l48.177"></a><span id="l48.177">       &lt;method name=&quot;changeTo12HoursFormat&quot;&gt;</span>
<a href="#l48.178"></a><span id="l48.178">         &lt;parameter name=&quot;aAmLabel&quot;/&gt;</span>
<a href="#l48.179"></a><span id="l48.179">         &lt;parameter name=&quot;aPmLabel&quot;/&gt;</span>
<a href="#l48.180"></a><span id="l48.180" class="difflineat">@@ -1478,20 +1489,21 @@</span>
<a href="#l48.181"></a><span id="l48.181">         &lt;/body&gt;</span>
<a href="#l48.182"></a><span id="l48.182">       &lt;/method&gt;</span>
<a href="#l48.183"></a><span id="l48.183"> </span>
<a href="#l48.184"></a><span id="l48.184">       &lt;!-- Date was changed by gui: update value. --&gt;</span>
<a href="#l48.185"></a><span id="l48.185">       &lt;method name=&quot;onDatePick&quot;&gt;</span>
<a href="#l48.186"></a><span id="l48.186">         &lt;body&gt;</span>
<a href="#l48.187"></a><span id="l48.187">           &lt;![CDATA[</span>
<a href="#l48.188"></a><span id="l48.188">             var tempTime;</span>
<a href="#l48.189"></a><span id="l48.189" class="difflineminus">-            if (this.kDatePicker.lastDateParseIncludedTime)</span>
<a href="#l48.190"></a><span id="l48.190" class="difflineplus">+            if (this.kDatePicker.lastDateParseIncludedTime) {</span>
<a href="#l48.191"></a><span id="l48.191">               tempTime = new Date(this.kDatePicker.value);</span>
<a href="#l48.192"></a><span id="l48.192" class="difflineminus">-            else</span>
<a href="#l48.193"></a><span id="l48.193" class="difflineplus">+            } else {</span>
<a href="#l48.194"></a><span id="l48.194">               tempTime = new Date(this.mValue);</span>
<a href="#l48.195"></a><span id="l48.195" class="difflineplus">+            }</span>
<a href="#l48.196"></a><span id="l48.196">             var newDate = new Date(this.kDatePicker.value);</span>
<a href="#l48.197"></a><span id="l48.197">             // Note: create new date because setting month and date of month in</span>
<a href="#l48.198"></a><span id="l48.198">             // either order can lead to unexpected results (month may be advanced</span>
<a href="#l48.199"></a><span id="l48.199">             // automatically if day of month is temporarily out of range).</span>
<a href="#l48.200"></a><span id="l48.200">             var dateTime = new Date(newDate.getFullYear(),</span>
<a href="#l48.201"></a><span id="l48.201">                                     newDate.getMonth(),</span>
<a href="#l48.202"></a><span id="l48.202">                                     newDate.getDate(),</span>
<a href="#l48.203"></a><span id="l48.203">                                     tempTime.getHours(),</span>
<a href="#l48.204"></a><span id="l48.204" class="difflineat">@@ -1579,18 +1591,19 @@</span>
<a href="#l48.205"></a><span id="l48.205">            (see initDateFormat). Uses parseTime() for times.</span>
<a href="#l48.206"></a><span id="l48.206">       --&gt;</span>
<a href="#l48.207"></a><span id="l48.207">       &lt;method name=&quot;parseDateTime&quot;&gt;</span>
<a href="#l48.208"></a><span id="l48.208">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l48.209"></a><span id="l48.209">         &lt;body&gt;</span>
<a href="#l48.210"></a><span id="l48.210">           &lt;![CDATA[</span>
<a href="#l48.211"></a><span id="l48.211">             this.mLastDateParseIncludedTime = false;</span>
<a href="#l48.212"></a><span id="l48.212">             var tempDate = null;</span>
<a href="#l48.213"></a><span id="l48.213" class="difflineminus">-            if (!this.probeSucceeded)</span>
<a href="#l48.214"></a><span id="l48.214" class="difflineplus">+            if (!this.probeSucceeded) {</span>
<a href="#l48.215"></a><span id="l48.215">               return null; // avoid errors accessing uninitialized data.</span>
<a href="#l48.216"></a><span id="l48.216" class="difflineplus">+            }</span>
<a href="#l48.217"></a><span id="l48.217"> </span>
<a href="#l48.218"></a><span id="l48.218">             var year = Number.MIN_VALUE; var month = -1; var day = -1; let timeString = null;</span>
<a href="#l48.219"></a><span id="l48.219">             if (this.alphaMonths == null) {</span>
<a href="#l48.220"></a><span id="l48.220">               // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l48.221"></a><span id="l48.221">               // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l48.222"></a><span id="l48.222">               // which do not match \w, esp. in CJK locales.)</span>
<a href="#l48.223"></a><span id="l48.223">               // (.*)? binds to null if no suffix.</span>
<a href="#l48.224"></a><span id="l48.224">               var parseNumShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)(.*)?$/;</span>
<a href="#l48.225"></a><span id="l48.225" class="difflineat">@@ -1631,20 +1644,22 @@</span>
<a href="#l48.226"></a><span id="l48.226">               if (0 &lt;= year &amp;&amp; year &lt; 100) {</span>
<a href="#l48.227"></a><span id="l48.227">                 // If 0 &lt;= year &lt; 100, treat as 2-digit year (like formatDate):</span>
<a href="#l48.228"></a><span id="l48.228">                 //   parse year as up to 30 years in future or 69 years in past.</span>
<a href="#l48.229"></a><span id="l48.229">                 //   (Covers 30-year mortgage and most working people's birthdate.)</span>
<a href="#l48.230"></a><span id="l48.230">                 // otherwise will be treated as four digit year.</span>
<a href="#l48.231"></a><span id="l48.231">                 var currentYear = new Date().getFullYear();</span>
<a href="#l48.232"></a><span id="l48.232">                 var currentCentury = currentYear - currentYear % 100;</span>
<a href="#l48.233"></a><span id="l48.233">                 year = currentCentury + year;</span>
<a href="#l48.234"></a><span id="l48.234" class="difflineminus">-                if (year &lt; currentYear - 69)</span>
<a href="#l48.235"></a><span id="l48.235" class="difflineplus">+                if (year &lt; currentYear - 69) {</span>
<a href="#l48.236"></a><span id="l48.236">                   year += 100;</span>
<a href="#l48.237"></a><span id="l48.237" class="difflineminus">-                if (year &gt; currentYear + 30)</span>
<a href="#l48.238"></a><span id="l48.238" class="difflineplus">+                }</span>
<a href="#l48.239"></a><span id="l48.239" class="difflineplus">+                if (year &gt; currentYear + 30) {</span>
<a href="#l48.240"></a><span id="l48.240">                   year -= 100;</span>
<a href="#l48.241"></a><span id="l48.241" class="difflineplus">+                }</span>
<a href="#l48.242"></a><span id="l48.242">               }</span>
<a href="#l48.243"></a><span id="l48.243">               // if time is also present, parse it</span>
<a href="#l48.244"></a><span id="l48.244">               var hours = 0; var minutes = 0; var seconds = 0;</span>
<a href="#l48.245"></a><span id="l48.245">               if (timeString != null) {</span>
<a href="#l48.246"></a><span id="l48.246">                 var time = this.parseTime(timeString);</span>
<a href="#l48.247"></a><span id="l48.247">                 if (time != null) {</span>
<a href="#l48.248"></a><span id="l48.248">                   hours = time.getHours();</span>
<a href="#l48.249"></a><span id="l48.249">                   minutes = time.getMinutes();</span>
<a href="#l48.250"></a><span id="l48.250" class="difflineat">@@ -1696,27 +1711,33 @@</span>
<a href="#l48.251"></a><span id="l48.251">             var time = null;</span>
<a href="#l48.252"></a><span id="l48.252">             var timePartsArray = this.parseTimeRegExp.exec(aValue);</span>
<a href="#l48.253"></a><span id="l48.253">             const PRE_INDEX=1, HR_INDEX=2, MIN_INDEX=4, SEC_INDEX=6, POST_INDEX=8;</span>
<a href="#l48.254"></a><span id="l48.254"> </span>
<a href="#l48.255"></a><span id="l48.255">             if (timePartsArray != null) {</span>
<a href="#l48.256"></a><span id="l48.256">               var hoursString   = timePartsArray[HR_INDEX]</span>
<a href="#l48.257"></a><span id="l48.257">               var hours         = Number(hoursString);</span>
<a href="#l48.258"></a><span id="l48.258">               var hoursSuffix   = timePartsArray[HR_INDEX + 1];</span>
<a href="#l48.259"></a><span id="l48.259" class="difflineminus">-              if (!(0 &lt;= hours &amp;&amp; hours &lt; 24)) return null;</span>
<a href="#l48.260"></a><span id="l48.260" class="difflineplus">+              if (!(0 &lt;= hours &amp;&amp; hours &lt; 24)) {</span>
<a href="#l48.261"></a><span id="l48.261" class="difflineplus">+                return null;</span>
<a href="#l48.262"></a><span id="l48.262" class="difflineplus">+              }</span>
<a href="#l48.263"></a><span id="l48.263"> </span>
<a href="#l48.264"></a><span id="l48.264">               var minutesString = timePartsArray[MIN_INDEX];</span>
<a href="#l48.265"></a><span id="l48.265">               var minutes       = (minutesString == null? 0 : Number(minutesString));</span>
<a href="#l48.266"></a><span id="l48.266">               var minutesSuffix = timePartsArray[MIN_INDEX + 1];</span>
<a href="#l48.267"></a><span id="l48.267" class="difflineminus">-              if (!(0 &lt;= minutes &amp;&amp; minutes &lt; 60)) return null;</span>
<a href="#l48.268"></a><span id="l48.268" class="difflineplus">+              if (!(0 &lt;= minutes &amp;&amp; minutes &lt; 60)) {</span>
<a href="#l48.269"></a><span id="l48.269" class="difflineplus">+                return null;</span>
<a href="#l48.270"></a><span id="l48.270" class="difflineplus">+              }</span>
<a href="#l48.271"></a><span id="l48.271"> </span>
<a href="#l48.272"></a><span id="l48.272">               var secondsString = timePartsArray[SEC_INDEX];</span>
<a href="#l48.273"></a><span id="l48.273">               var seconds       = (secondsString == null? 0 : Number(secondsString));</span>
<a href="#l48.274"></a><span id="l48.274">               var secondsSuffix = timePartsArray[SEC_INDEX + 1];</span>
<a href="#l48.275"></a><span id="l48.275" class="difflineminus">-              if (!(0 &lt;= seconds &amp;&amp; seconds &lt; 60)) return null;</span>
<a href="#l48.276"></a><span id="l48.276" class="difflineplus">+              if (!(0 &lt;= seconds &amp;&amp; seconds &lt; 60)) {</span>
<a href="#l48.277"></a><span id="l48.277" class="difflineplus">+                return null;</span>
<a href="#l48.278"></a><span id="l48.278" class="difflineplus">+              }</span>
<a href="#l48.279"></a><span id="l48.279"> </span>
<a href="#l48.280"></a><span id="l48.280">               var ampmCode = null;</span>
<a href="#l48.281"></a><span id="l48.281">               if (timePartsArray[PRE_INDEX] || timePartsArray[POST_INDEX]) {</span>
<a href="#l48.282"></a><span id="l48.282">                 if (this.ampmIndex &amp;&amp; timePartsArray[this.ampmIndex]) {</span>
<a href="#l48.283"></a><span id="l48.283">                   // try current format order first</span>
<a href="#l48.284"></a><span id="l48.284">                   var ampmString = timePartsArray[this.ampmIndex];</span>
<a href="#l48.285"></a><span id="l48.285">                   if (this.amRegExp.test(ampmString)) {</span>
<a href="#l48.286"></a><span id="l48.286">                     ampmCode = &quot;AM&quot;;</span>
<a href="#l48.287"></a><span id="l48.287" class="difflineat">@@ -1733,21 +1754,23 @@</span>
<a href="#l48.288"></a><span id="l48.288">                     ampmCode = &quot;AM&quot;;</span>
<a href="#l48.289"></a><span id="l48.289">                   } else if ((preString &amp;&amp; this.pmRegExp.test(preString)) ||</span>
<a href="#l48.290"></a><span id="l48.290">                              (postString &amp;&amp; this.pmRegExp.test(postString))) {</span>
<a href="#l48.291"></a><span id="l48.291">                     ampmCode = &quot;PM&quot;;</span>
<a href="#l48.292"></a><span id="l48.292">                   } // else no match, ignore and treat as 24hour time.</span>
<a href="#l48.293"></a><span id="l48.293">                 }</span>
<a href="#l48.294"></a><span id="l48.294">               }</span>
<a href="#l48.295"></a><span id="l48.295">               if (ampmCode == &quot;AM&quot;) {</span>
<a href="#l48.296"></a><span id="l48.296" class="difflineminus">-                if (hours == 12)</span>
<a href="#l48.297"></a><span id="l48.297" class="difflineplus">+                if (hours == 12) {</span>
<a href="#l48.298"></a><span id="l48.298">                   hours = 0;</span>
<a href="#l48.299"></a><span id="l48.299" class="difflineplus">+                }</span>
<a href="#l48.300"></a><span id="l48.300">               } else if (ampmCode == &quot;PM&quot;) {</span>
<a href="#l48.301"></a><span id="l48.301" class="difflineminus">-                if (hours &lt; 12)</span>
<a href="#l48.302"></a><span id="l48.302" class="difflineplus">+                if (hours &lt; 12) {</span>
<a href="#l48.303"></a><span id="l48.303">                   hours += 12;</span>
<a href="#l48.304"></a><span id="l48.304" class="difflineplus">+                }</span>
<a href="#l48.305"></a><span id="l48.305">               }</span>
<a href="#l48.306"></a><span id="l48.306">               time = new Date(0, 0, 0, hours, minutes, seconds, 0);</span>
<a href="#l48.307"></a><span id="l48.307">             }  // else did not match regex, not valid time</span>
<a href="#l48.308"></a><span id="l48.308">             return time;</span>
<a href="#l48.309"></a><span id="l48.309">           ]]&gt;</span>
<a href="#l48.310"></a><span id="l48.310">         &lt;/body&gt;</span>
<a href="#l48.311"></a><span id="l48.311">       &lt;/method&gt;</span>
<a href="#l48.312"></a><span id="l48.312"> </span>
<a href="#l48.313"></a><span id="l48.313" class="difflineat">@@ -1805,26 +1828,28 @@</span>
<a href="#l48.314"></a><span id="l48.314">                 if (this.yearIndex != -1 &amp;&amp; this.dayIndex != -1 &amp;&amp; this.monthIndex != -1) {</span>
<a href="#l48.315"></a><span id="l48.315">                   this.probeSucceeded = true;</span>
<a href="#l48.316"></a><span id="l48.316">                   // Fill this.alphaMonths with month names.</span>
<a href="#l48.317"></a><span id="l48.317">                   this.alphaMonths = new Array(12);</span>
<a href="#l48.318"></a><span id="l48.318">                   for (var m = 0; m &lt; 12; m++) {</span>
<a href="#l48.319"></a><span id="l48.319">                     probeDate.setMonth(m);</span>
<a href="#l48.320"></a><span id="l48.320">                     probeString = this.formatDate(probeDate);</span>
<a href="#l48.321"></a><span id="l48.321">                     probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l48.322"></a><span id="l48.322" class="difflineminus">-                    if (probeArray != null)</span>
<a href="#l48.323"></a><span id="l48.323" class="difflineplus">+                    if (probeArray != null) {</span>
<a href="#l48.324"></a><span id="l48.324">                       this.alphaMonths[m] = probeArray[this.monthIndex].toUpperCase();</span>
<a href="#l48.325"></a><span id="l48.325" class="difflineminus">-                    else</span>
<a href="#l48.326"></a><span id="l48.326" class="difflineplus">+                    } else {</span>
<a href="#l48.327"></a><span id="l48.327">                       this.probeSucceeded = false;</span>
<a href="#l48.328"></a><span id="l48.328" class="difflineplus">+                    }</span>
<a href="#l48.329"></a><span id="l48.329">                   }</span>
<a href="#l48.330"></a><span id="l48.330">                 }</span>
<a href="#l48.331"></a><span id="l48.331">               }</span>
<a href="#l48.332"></a><span id="l48.332">             }</span>
<a href="#l48.333"></a><span id="l48.333" class="difflineminus">-            if (! this.probeSucceeded)</span>
<a href="#l48.334"></a><span id="l48.334" class="difflineplus">+            if (!this.probeSucceeded) {</span>
<a href="#l48.335"></a><span id="l48.335">               dump(&quot;\nOperating system short date format is not recognized: &quot;+probeString+&quot;\n&quot;);</span>
<a href="#l48.336"></a><span id="l48.336" class="difflineplus">+            }</span>
<a href="#l48.337"></a><span id="l48.337">           ]]&gt;</span>
<a href="#l48.338"></a><span id="l48.338">         &lt;/body&gt;</span>
<a href="#l48.339"></a><span id="l48.339">       &lt;/method&gt;</span>
<a href="#l48.340"></a><span id="l48.340"> </span>
<a href="#l48.341"></a><span id="l48.341">       &lt;!-- Time format in 24-hour format or 12-hour format with am/pm string.</span>
<a href="#l48.342"></a><span id="l48.342">            Should match formats</span>
<a href="#l48.343"></a><span id="l48.343">                 HH:mm,       H:mm,       HH:mm:ss,       H:mm:ss</span>
<a href="#l48.344"></a><span id="l48.344">                 hh:mm tt,    h:mm tt,    hh:mm:ss tt,    h:mm:ss tt</span>
<a href="#l48.345"></a><span id="l48.345" class="difflineat">@@ -1888,21 +1913,23 @@</span>
<a href="#l48.346"></a><span id="l48.346">                     }</span>
<a href="#l48.347"></a><span id="l48.347">                   }</span>
<a href="#l48.348"></a><span id="l48.348">                 }</span>
<a href="#l48.349"></a><span id="l48.349">                 if (this.ampmIndex) {</span>
<a href="#l48.350"></a><span id="l48.350">                   var makeFormatRegExp = function(string) {</span>
<a href="#l48.351"></a><span id="l48.351">                     // make expr to accept either as provided, lowercased, or uppercased</span>
<a href="#l48.352"></a><span id="l48.352">                     var regExp = string.replace(/(\W)/g, &quot;[$1]&quot;); // escape punctuation</span>
<a href="#l48.353"></a><span id="l48.353">                     var lowercased = string.toLowerCase();</span>
<a href="#l48.354"></a><span id="l48.354" class="difflineminus">-                    if (string != lowercased)</span>
<a href="#l48.355"></a><span id="l48.355" class="difflineplus">+                    if (string != lowercased) {</span>
<a href="#l48.356"></a><span id="l48.356">                       regExp += &quot;|&quot;+lowercased;</span>
<a href="#l48.357"></a><span id="l48.357" class="difflineplus">+                    }</span>
<a href="#l48.358"></a><span id="l48.358">                     var uppercased = string.toUpperCase();</span>
<a href="#l48.359"></a><span id="l48.359" class="difflineminus">-                    if (string != uppercased)</span>
<a href="#l48.360"></a><span id="l48.360" class="difflineplus">+                    if (string != uppercased) {</span>
<a href="#l48.361"></a><span id="l48.361">                       regExp += &quot;|&quot;+uppercased;</span>
<a href="#l48.362"></a><span id="l48.362" class="difflineplus">+                    }</span>
<a href="#l48.363"></a><span id="l48.363">                     return regExp;</span>
<a href="#l48.364"></a><span id="l48.364">                   };</span>
<a href="#l48.365"></a><span id="l48.365">                   amFormatExpr = makeFormatRegExp(amProbeArray[this.ampmIndex]);</span>
<a href="#l48.366"></a><span id="l48.366">                   pmFormatExpr = makeFormatRegExp(pmProbeArray[this.ampmIndex]);</span>
<a href="#l48.367"></a><span id="l48.367">                 }</span>
<a href="#l48.368"></a><span id="l48.368">               }</span>
<a href="#l48.369"></a><span id="l48.369">             }</span>
<a href="#l48.370"></a><span id="l48.370">             // International formats ([roman, cyrillic]|arabic|chinese/kanji characters)</span>
<a href="#l48.371"></a><span id="l48.371" class="difflineat">@@ -1927,22 +1954,23 @@</span>
<a href="#l48.372"></a><span id="l48.372">             //</span>
<a href="#l48.373"></a><span id="l48.373">             // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l48.374"></a><span id="l48.374">             this.parseTimeRegExp =</span>
<a href="#l48.375"></a><span id="l48.375">               new RegExp(&quot;(&quot;+ampmExpr+&quot;)?\\s?&quot;+digitsExpr+&quot;(&quot;+ampmExpr+&quot;)?\\s*$&quot;);</span>
<a href="#l48.376"></a><span id="l48.376">             this.amRegExp = new RegExp(&quot;^(?:&quot;+amExpr+&quot;)$&quot;);</span>
<a href="#l48.377"></a><span id="l48.377">             this.pmRegExp = new RegExp(&quot;^(?:&quot;+pmExpr+&quot;)$&quot;);</span>
<a href="#l48.378"></a><span id="l48.378">             // build time display format that mimics &quot;%x&quot; format without seconds</span>
<a href="#l48.379"></a><span id="l48.379">             var ampmSep = (pmProbeString.includes(' ') ? &quot; &quot; : &quot;&quot;);</span>
<a href="#l48.380"></a><span id="l48.380" class="difflineminus">-	          if (this.ampmIndex == PRE_INDEX)</span>
<a href="#l48.381"></a><span id="l48.381" class="difflineplus">+            if (this.ampmIndex == PRE_INDEX) {</span>
<a href="#l48.382"></a><span id="l48.382">               this.kTimeFormatString = &quot;%p&quot; + ampmSep + &quot;%I:%M&quot;;</span>
<a href="#l48.383"></a><span id="l48.383" class="difflineminus">-            else if (this.ampmIndex == POST_INDEX)</span>
<a href="#l48.384"></a><span id="l48.384" class="difflineplus">+            } else if (this.ampmIndex == POST_INDEX) {</span>
<a href="#l48.385"></a><span id="l48.385">               this.kTimeFormatString = &quot;%I:%M&quot; + ampmSep + &quot;%p&quot;;</span>
<a href="#l48.386"></a><span id="l48.386" class="difflineminus">-            else</span>
<a href="#l48.387"></a><span id="l48.387" class="difflineplus">+            } else {</span>
<a href="#l48.388"></a><span id="l48.388">               this.kTimeFormatString = &quot;%H:%M&quot;;</span>
<a href="#l48.389"></a><span id="l48.389" class="difflineplus">+            }</span>
<a href="#l48.390"></a><span id="l48.390">           ]]&gt;</span>
<a href="#l48.391"></a><span id="l48.391">         &lt;/body&gt;</span>
<a href="#l48.392"></a><span id="l48.392">       &lt;/method&gt;</span>
<a href="#l48.393"></a><span id="l48.393"> </span>
<a href="#l48.394"></a><span id="l48.394">       &lt;method name=&quot;formatDate&quot;&gt;</span>
<a href="#l48.395"></a><span id="l48.395">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l48.396"></a><span id="l48.396">         &lt;body&gt;</span>
<a href="#l48.397"></a><span id="l48.397">           &lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -130,20 +130,22 @@ function publishItemArray(aItemArray, aP</span>
<a href="#l49.4"></a><span id="l49.4">     var icsURL = makeURL(aPath);</span>
<a href="#l49.5"></a><span id="l49.5"> </span>
<a href="#l49.6"></a><span id="l49.6">     var channel = Services.io.newChannelFromURI2(icsURL,</span>
<a href="#l49.7"></a><span id="l49.7">                                                  null,</span>
<a href="#l49.8"></a><span id="l49.8">                                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l49.9"></a><span id="l49.9">                                                  null,</span>
<a href="#l49.10"></a><span id="l49.10">                                                  Components.interfaces.nsILoadInfo.SEC_NORMAL,</span>
<a href="#l49.11"></a><span id="l49.11">                                                  Components.interfaces.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-    if (icsURL.schemeIs('webcal'))</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+    if (icsURL.schemeIs('webcal')) {</span>
<a href="#l49.14"></a><span id="l49.14">         icsURL.scheme = 'http';</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineminus">-    if (icsURL.schemeIs('webcals'))</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineplus">+    }</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineplus">+    if (icsURL.schemeIs('webcals')) {</span>
<a href="#l49.18"></a><span id="l49.18">         icsURL.scheme = 'https';</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineplus">+    }</span>
<a href="#l49.20"></a><span id="l49.20"> </span>
<a href="#l49.21"></a><span id="l49.21">     switch(icsURL.scheme) {</span>
<a href="#l49.22"></a><span id="l49.22">         case 'http':</span>
<a href="#l49.23"></a><span id="l49.23">         case 'https':</span>
<a href="#l49.24"></a><span id="l49.24">             channel = channel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l49.25"></a><span id="l49.25">             break;</span>
<a href="#l49.26"></a><span id="l49.26">         case 'ftp':</span>
<a href="#l49.27"></a><span id="l49.27">             channel = channel.QueryInterface(Components.interfaces.nsIFTPChannel);</span>
<a href="#l49.28"></a><span id="l49.28" class="difflineat">@@ -197,26 +199,18 @@ var notificationCallbacks =</span>
<a href="#l49.29"></a><span id="l49.29">             return Services.ww.getNewAuthPrompter(null);</span>
<a href="#l49.30"></a><span id="l49.30">         }</span>
<a href="#l49.31"></a><span id="l49.31"> </span>
<a href="#l49.32"></a><span id="l49.32">         throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l49.33"></a><span id="l49.33">     }</span>
<a href="#l49.34"></a><span id="l49.34"> }</span>
<a href="#l49.35"></a><span id="l49.35"> </span>
<a href="#l49.36"></a><span id="l49.36"> </span>
<a href="#l49.37"></a><span id="l49.37" class="difflineminus">-var publishingListener =</span>
<a href="#l49.38"></a><span id="l49.38" class="difflineminus">-{</span>
<a href="#l49.39"></a><span id="l49.39" class="difflineminus">-    QueryInterface: function(aIId, instance)</span>
<a href="#l49.40"></a><span id="l49.40" class="difflineminus">-    {</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineminus">-        if (aIId.equals(Components.interfaces.nsIStreamListener) ||</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineminus">-            aIId.equals(Components.interfaces.nsISupports))</span>
<a href="#l49.43"></a><span id="l49.43" class="difflineminus">-            return this;</span>
<a href="#l49.44"></a><span id="l49.44" class="difflineminus">-</span>
<a href="#l49.45"></a><span id="l49.45" class="difflineminus">-        throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l49.46"></a><span id="l49.46" class="difflineminus">-    },</span>
<a href="#l49.47"></a><span id="l49.47" class="difflineplus">+var publishingListener = {</span>
<a href="#l49.48"></a><span id="l49.48" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIStreamListener]),</span>
<a href="#l49.49"></a><span id="l49.49"> </span>
<a href="#l49.50"></a><span id="l49.50">     onStartRequest: function(request, ctxt)</span>
<a href="#l49.51"></a><span id="l49.51">     {</span>
<a href="#l49.52"></a><span id="l49.52">     },</span>
<a href="#l49.53"></a><span id="l49.53"> </span>
<a href="#l49.54"></a><span id="l49.54">     onStopRequest: function(request, ctxt, status, errorMsg)</span>
<a href="#l49.55"></a><span id="l49.55">     {</span>
<a href="#l49.56"></a><span id="l49.56">         ctxt.wrappedJSObject.onStopUpload();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/resources/content/publishDialog.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/resources/content/publishDialog.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -23,24 +23,22 @@ var gPublishObject;</span>
<a href="#l50.4"></a><span id="l50.4"> function loadCalendarPublishDialog()</span>
<a href="#l50.5"></a><span id="l50.5"> {</span>
<a href="#l50.6"></a><span id="l50.6">    // Get arguments, see description at top of file</span>
<a href="#l50.7"></a><span id="l50.7"> </span>
<a href="#l50.8"></a><span id="l50.8">    var args = window.arguments[0];</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">    gOnOkFunction = args.onOk;</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-   if( args.publishObject )</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineminus">-   {</span>
<a href="#l50.14"></a><span id="l50.14" class="difflineplus">+   if (args.publishObject) {</span>
<a href="#l50.15"></a><span id="l50.15">       gPublishObject = args.publishObject;</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineminus">-      if ( args.publishObject.remotePath )</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineplus">+      if (args.publishObject.remotePath) {</span>
<a href="#l50.18"></a><span id="l50.18">           document.getElementById( &quot;publish-remotePath-textbox&quot; ).value = args.publishObject.remotePath;</span>
<a href="#l50.19"></a><span id="l50.19" class="difflineminus">-   }</span>
<a href="#l50.20"></a><span id="l50.20" class="difflineminus">-   else</span>
<a href="#l50.21"></a><span id="l50.21" class="difflineminus">-   {</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineplus">+      }</span>
<a href="#l50.23"></a><span id="l50.23" class="difflineplus">+   } else {</span>
<a href="#l50.24"></a><span id="l50.24">       gPublishObject = new Object();</span>
<a href="#l50.25"></a><span id="l50.25">    }</span>
<a href="#l50.26"></a><span id="l50.26">    document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;label&quot;, publishButtonLabel );</span>
<a href="#l50.27"></a><span id="l50.27"> </span>
<a href="#l50.28"></a><span id="l50.28">    checkURLField( );</span>
<a href="#l50.29"></a><span id="l50.29"> </span>
<a href="#l50.30"></a><span id="l50.30">    var firstFocus = document.getElementById( &quot;publish-remotePath-textbox&quot; );</span>
<a href="#l50.31"></a><span id="l50.31">    firstFocus.focus();</span>
<a href="#l50.32"></a><span id="l50.32" class="difflineat">@@ -61,20 +59,21 @@ function onOKCommand()</span>
<a href="#l50.33"></a><span id="l50.33">    document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;label&quot;, closeButtonLabel );</span>
<a href="#l50.34"></a><span id="l50.34">    document.getElementById( &quot;calendar-publishwindow&quot; ).setAttribute( &quot;ondialogaccept&quot;, &quot;closeDialog()&quot; );</span>
<a href="#l50.35"></a><span id="l50.35">    return( false );</span>
<a href="#l50.36"></a><span id="l50.36"> }</span>
<a href="#l50.37"></a><span id="l50.37"> </span>
<a href="#l50.38"></a><span id="l50.38"> </span>
<a href="#l50.39"></a><span id="l50.39"> function checkURLField( )</span>
<a href="#l50.40"></a><span id="l50.40"> {</span>
<a href="#l50.41"></a><span id="l50.41" class="difflineminus">-   if( document.getElementById( &quot;publish-remotePath-textbox&quot; ).value.length == 0 )</span>
<a href="#l50.42"></a><span id="l50.42" class="difflineplus">+   if (document.getElementById( &quot;publish-remotePath-textbox&quot; ).value.length == 0) {</span>
<a href="#l50.43"></a><span id="l50.43">       document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;disabled&quot;, &quot;true&quot; );</span>
<a href="#l50.44"></a><span id="l50.44" class="difflineminus">-   else</span>
<a href="#l50.45"></a><span id="l50.45" class="difflineplus">+   } else {</span>
<a href="#l50.46"></a><span id="l50.46">       document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).removeAttribute( &quot;disabled&quot; );</span>
<a href="#l50.47"></a><span id="l50.47" class="difflineplus">+   }</span>
<a href="#l50.48"></a><span id="l50.48"> }</span>
<a href="#l50.49"></a><span id="l50.49"> </span>
<a href="#l50.50"></a><span id="l50.50"> function closeDialog( )</span>
<a href="#l50.51"></a><span id="l50.51"> {</span>
<a href="#l50.52"></a><span id="l50.52">    self.close( );</span>
<a href="#l50.53"></a><span id="l50.53"> }</span>
<a href="#l50.54"></a><span id="l50.54"> </span>
<a href="#l50.55"></a><span id="l50.55"> var progressDialog = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -68,17 +68,19 @@ var testEventDialog = function () {</span>
<a href="#l51.4"></a><span id="l51.4">   // next full hour except last hour hour of the day</span>
<a href="#l51.5"></a><span id="l51.5">   let now = new Date();</span>
<a href="#l51.6"></a><span id="l51.6">   let hour = now.getHours();</span>
<a href="#l51.7"></a><span id="l51.7">   let startHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l51.8"></a><span id="l51.8">   let ampm = &quot;&quot;;</span>
<a href="#l51.9"></a><span id="l51.9">   if (now.toLocaleTimeString().match(/AM|PM/)) {</span>
<a href="#l51.10"></a><span id="l51.10">     ampm = (hour &gt;= 12 ? &quot; PM&quot; : &quot; AM&quot;)</span>
<a href="#l51.11"></a><span id="l51.11">     startHour = startHour % 12;</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    if (startHour == 0) startHour = 12;</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    if (startHour == 0) {</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineplus">+      startHour = 12;</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineplus">+    }</span>
<a href="#l51.16"></a><span id="l51.16">   }</span>
<a href="#l51.17"></a><span id="l51.17"> </span>
<a href="#l51.18"></a><span id="l51.18">   let startTime = startHour + ':00' + ampm;</span>
<a href="#l51.19"></a><span id="l51.19">   let endTime = ((startHour + 1) % 24) + ':00' + ampm;</span>
<a href="#l51.20"></a><span id="l51.20">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l51.21"></a><span id="l51.21">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l51.22"></a><span id="l51.22">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l51.23"></a><span id="l51.23">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/'</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineat">@@ -186,40 +188,44 @@ var testEventDialog = function () {</span>
<a href="#l51.25"></a><span id="l51.25">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l51.26"></a><span id="l51.26"> </span>
<a href="#l51.27"></a><span id="l51.27">   // verify all others still exist</span>
<a href="#l51.28"></a><span id="l51.28">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.29"></a><span id="l51.29">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l51.30"></a><span id="l51.30">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.31"></a><span id="l51.31">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l51.32"></a><span id="l51.32"> </span>
<a href="#l51.33"></a><span id="l51.33" class="difflineminus">-  for(row = 1; row &lt; 5; row++)</span>
<a href="#l51.34"></a><span id="l51.34" class="difflineminus">-    for(col = 0; col &lt; 7; col++)</span>
<a href="#l51.35"></a><span id="l51.35" class="difflineplus">+  for (row = 1; row &lt; 5; row++) {</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineplus">+    for (col = 0; col &lt; 7; col++) {</span>
<a href="#l51.37"></a><span id="l51.37">         controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.38"></a><span id="l51.38">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineplus">+    }</span>
<a href="#l51.40"></a><span id="l51.40" class="difflineplus">+  }</span>
<a href="#l51.41"></a><span id="l51.41"> </span>
<a href="#l51.42"></a><span id="l51.42">   // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l51.43"></a><span id="l51.43">   calUtils.handleParentDeletion(controller);</span>
<a href="#l51.44"></a><span id="l51.44">   controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.45"></a><span id="l51.45">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l51.46"></a><span id="l51.46">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l51.47"></a><span id="l51.47">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l51.48"></a><span id="l51.48"> </span>
<a href="#l51.49"></a><span id="l51.49">   // verify all deleted</span>
<a href="#l51.50"></a><span id="l51.50">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.51"></a><span id="l51.51">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l51.52"></a><span id="l51.52">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.53"></a><span id="l51.53">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l51.54"></a><span id="l51.54">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.55"></a><span id="l51.55">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l51.56"></a><span id="l51.56"> </span>
<a href="#l51.57"></a><span id="l51.57" class="difflineminus">-  for(row = 1; row &lt; 5; row++)</span>
<a href="#l51.58"></a><span id="l51.58" class="difflineminus">-    for(col = 0; col &lt; 7; col++)</span>
<a href="#l51.59"></a><span id="l51.59" class="difflineplus">+  for (row = 1; row &lt; 5; row++) {</span>
<a href="#l51.60"></a><span id="l51.60" class="difflineplus">+    for (col = 0; col &lt; 7; col++) {</span>
<a href="#l51.61"></a><span id="l51.61">         controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l51.62"></a><span id="l51.62">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l51.63"></a><span id="l51.63" class="difflineplus">+    }</span>
<a href="#l51.64"></a><span id="l51.64" class="difflineplus">+  }</span>
<a href="#l51.65"></a><span id="l51.65"> }</span>
<a href="#l51.66"></a><span id="l51.66"> </span>
<a href="#l51.67"></a><span id="l51.67"> function handleAttendees(attendees){</span>
<a href="#l51.68"></a><span id="l51.68">   let input = new elementslib.Lookup(attendees.window.document,</span>
<a href="#l51.69"></a><span id="l51.69">     '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/'</span>
<a href="#l51.70"></a><span id="l51.70">     + 'anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/'</span>
<a href="#l51.71"></a><span id="l51.71">     + 'anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/'</span>
<a href="#l51.72"></a><span id="l51.72">     + '{&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -118,17 +118,19 @@ function setRecurrence(recurrence){</span>
<a href="#l52.4"></a><span id="l52.4">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l52.5"></a><span id="l52.5">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l52.6"></a><span id="l52.6"> }</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8"> function checkMultiWeekView(view){</span>
<a href="#l52.9"></a><span id="l52.9">   let week = 1;</span>
<a href="#l52.10"></a><span id="l52.10"> </span>
<a href="#l52.11"></a><span id="l52.11">   // in month view event starts from 2nd row</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  if(view == &quot;month&quot;) week++;</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  if (view == &quot;month&quot;) {</span>
<a href="#l52.14"></a><span id="l52.14" class="difflineplus">+    week++;</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineplus">+  }</span>
<a href="#l52.16"></a><span id="l52.16"> </span>
<a href="#l52.17"></a><span id="l52.17">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l52.18"></a><span id="l52.18">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l52.19"></a><span id="l52.19">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined)</span>
<a href="#l52.20"></a><span id="l52.20">       + eventPath;</span>
<a href="#l52.21"></a><span id="l52.21">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l52.22"></a><span id="l52.22">   }</span>
<a href="#l52.23"></a><span id="l52.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -149,17 +149,19 @@ function setRecurrence(recurrence){</span>
<a href="#l53.4"></a><span id="l53.4">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l53.5"></a><span id="l53.5">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l53.6"></a><span id="l53.6"> }</span>
<a href="#l53.7"></a><span id="l53.7"> </span>
<a href="#l53.8"></a><span id="l53.8"> function checkMultiWeekView(view){</span>
<a href="#l53.9"></a><span id="l53.9">   let startWeek = 1;</span>
<a href="#l53.10"></a><span id="l53.10"> </span>
<a href="#l53.11"></a><span id="l53.11">   // in month view event starts from 2nd row</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-  if(view == &quot;month&quot;) startWeek++;</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+  if (view == &quot;month&quot;) {</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineplus">+    startWeek++;</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineplus">+  }</span>
<a href="#l53.16"></a><span id="l53.16"> </span>
<a href="#l53.17"></a><span id="l53.17">   for(let week = startWeek; week &lt; startWeek + 3; week++){</span>
<a href="#l53.18"></a><span id="l53.18">     // Monday</span>
<a href="#l53.19"></a><span id="l53.19">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined)</span>
<a href="#l53.20"></a><span id="l53.20">       + eventPath;</span>
<a href="#l53.21"></a><span id="l53.21">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l53.22"></a><span id="l53.22">     // Wednesday</span>
<a href="#l53.23"></a><span id="l53.23">     box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -131,17 +131,19 @@ function setRecurrence(recurrence){</span>
<a href="#l54.4"></a><span id="l54.4">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l54.5"></a><span id="l54.5">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l54.6"></a><span id="l54.6"> }</span>
<a href="#l54.7"></a><span id="l54.7"> </span>
<a href="#l54.8"></a><span id="l54.8"> function checkMultiWeekView(view){</span>
<a href="#l54.9"></a><span id="l54.9">   let week = 1;</span>
<a href="#l54.10"></a><span id="l54.10"> </span>
<a href="#l54.11"></a><span id="l54.11">   // in month view event starts from 2nd row</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  if(view == &quot;month&quot;) week++;</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+  if (view == &quot;month&quot;) {</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineplus">+    week++;</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineplus">+  }</span>
<a href="#l54.16"></a><span id="l54.16"> </span>
<a href="#l54.17"></a><span id="l54.17">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l54.18"></a><span id="l54.18">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l54.19"></a><span id="l54.19">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined)</span>
<a href="#l54.20"></a><span id="l54.20">       + eventPath;</span>
<a href="#l54.21"></a><span id="l54.21">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l54.22"></a><span id="l54.22">   }</span>
<a href="#l54.23"></a><span id="l54.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -162,17 +162,19 @@ function setRecurrence(recurrence){</span>
<a href="#l55.4"></a><span id="l55.4">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l55.5"></a><span id="l55.5">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l55.6"></a><span id="l55.6"> }</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8"> function checkMultiWeekView(view){</span>
<a href="#l55.9"></a><span id="l55.9">   let startWeek = 1;</span>
<a href="#l55.10"></a><span id="l55.10"> </span>
<a href="#l55.11"></a><span id="l55.11">   // in month view event starts from 2nd row</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  if(view == &quot;month&quot;) startWeek++;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  if (view == &quot;month&quot;) {</span>
<a href="#l55.14"></a><span id="l55.14" class="difflineplus">+    startWeek++;</span>
<a href="#l55.15"></a><span id="l55.15" class="difflineplus">+  }</span>
<a href="#l55.16"></a><span id="l55.16"> </span>
<a href="#l55.17"></a><span id="l55.17">   for(let week = startWeek; week &lt; startWeek + 3; week++){</span>
<a href="#l55.18"></a><span id="l55.18">     // Monday</span>
<a href="#l55.19"></a><span id="l55.19">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined)</span>
<a href="#l55.20"></a><span id="l55.20">       + eventPath;</span>
<a href="#l55.21"></a><span id="l55.21">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l55.22"></a><span id="l55.22">     // Wednesday</span>
<a href="#l55.23"></a><span id="l55.23">     box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -47,39 +47,37 @@ function handleAddingAttachment(controll</span>
<a href="#l56.4"></a><span id="l56.4"> </span>
<a href="#l56.5"></a><span id="l56.5"> /**</span>
<a href="#l56.6"></a><span id="l56.6">  *  Choose to delete just one occurrence of a repeating event</span>
<a href="#l56.7"></a><span id="l56.7">  *  @param controller - Mozmill window controller</span>
<a href="#l56.8"></a><span id="l56.8">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l56.9"></a><span id="l56.9">  */</span>
<a href="#l56.10"></a><span id="l56.10"> function handleOccurrenceDeletion(controller, attendees) {</span>
<a href="#l56.11"></a><span id="l56.11">   let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  md.start(</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineminus">-    function(dialog){</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineminus">-      if(attendees)</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineminus">-        acceptSendingNotificationMail();</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineminus">-      dialog.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-occurrence-button&quot;));</span>
<a href="#l56.17"></a><span id="l56.17" class="difflineplus">+  md.start((dialog) =&gt; {</span>
<a href="#l56.18"></a><span id="l56.18" class="difflineplus">+    if (attendees) {</span>
<a href="#l56.19"></a><span id="l56.19" class="difflineplus">+      acceptSendingNotificationMail();</span>
<a href="#l56.20"></a><span id="l56.20">     }</span>
<a href="#l56.21"></a><span id="l56.21" class="difflineminus">-  );</span>
<a href="#l56.22"></a><span id="l56.22" class="difflineplus">+    dialog.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-occurrence-button&quot;));</span>
<a href="#l56.23"></a><span id="l56.23" class="difflineplus">+  });</span>
<a href="#l56.24"></a><span id="l56.24"> }</span>
<a href="#l56.25"></a><span id="l56.25"> </span>
<a href="#l56.26"></a><span id="l56.26"> /**</span>
<a href="#l56.27"></a><span id="l56.27">  *  Choose to delete all occurrences of a repeating event</span>
<a href="#l56.28"></a><span id="l56.28">  *  @param controller - Mozmill window controller</span>
<a href="#l56.29"></a><span id="l56.29">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l56.30"></a><span id="l56.30">  */</span>
<a href="#l56.31"></a><span id="l56.31"> function handleParentDeletion(controller, attendees){</span>
<a href="#l56.32"></a><span id="l56.32">   let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineminus">-  md.start(</span>
<a href="#l56.34"></a><span id="l56.34" class="difflineminus">-    function(dialog){</span>
<a href="#l56.35"></a><span id="l56.35" class="difflineminus">-      if(attendees)</span>
<a href="#l56.36"></a><span id="l56.36" class="difflineminus">-        acceptSendingNotificationMail();</span>
<a href="#l56.37"></a><span id="l56.37" class="difflineminus">-      dialog.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-parent-button&quot;));</span>
<a href="#l56.38"></a><span id="l56.38" class="difflineplus">+  md.start((dialog) =&gt; {</span>
<a href="#l56.39"></a><span id="l56.39" class="difflineplus">+    if (attendees) {</span>
<a href="#l56.40"></a><span id="l56.40" class="difflineplus">+      acceptSendingNotificationMail();</span>
<a href="#l56.41"></a><span id="l56.41">     }</span>
<a href="#l56.42"></a><span id="l56.42" class="difflineminus">-  );</span>
<a href="#l56.43"></a><span id="l56.43" class="difflineplus">+    dialog.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-parent-button&quot;));</span>
<a href="#l56.44"></a><span id="l56.44" class="difflineplus">+  });</span>
<a href="#l56.45"></a><span id="l56.45"> }</span>
<a href="#l56.46"></a><span id="l56.46"> </span>
<a href="#l56.47"></a><span id="l56.47"> /**</span>
<a href="#l56.48"></a><span id="l56.48">  *  Choose to modify just one occurrence of a repeating event</span>
<a href="#l56.49"></a><span id="l56.49">  *  @param controller - Mozmill window controller</span>
<a href="#l56.50"></a><span id="l56.50">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l56.51"></a><span id="l56.51">  */</span>
<a href="#l56.52"></a><span id="l56.52"> function handleOccurrenceModification(controller, attendees){</span>
<a href="#l56.53"></a><span id="l56.53" class="difflineat">@@ -235,40 +233,40 @@ function getEventBoxPath(controller, vie</span>
<a href="#l56.54"></a><span id="l56.54">       path += multiweekView;</span>
<a href="#l56.55"></a><span id="l56.55">       break;</span>
<a href="#l56.56"></a><span id="l56.56">     case &quot;month&quot;:</span>
<a href="#l56.57"></a><span id="l56.57">       path += monthView;</span>
<a href="#l56.58"></a><span id="l56.58">       break;</span>
<a href="#l56.59"></a><span id="l56.59">     default: path += dayView;</span>
<a href="#l56.60"></a><span id="l56.60">   }</span>
<a href="#l56.61"></a><span id="l56.61"> </span>
<a href="#l56.62"></a><span id="l56.62" class="difflineminus">-  if((view == &quot;day&quot; || view == &quot;week&quot;) &amp;&amp; option == ALLDAY){</span>
<a href="#l56.63"></a><span id="l56.63" class="difflineplus">+  if ((view == &quot;day&quot; || view == &quot;week&quot;) &amp;&amp; option == ALLDAY) {</span>
<a href="#l56.64"></a><span id="l56.64">     path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})';</span>
<a href="#l56.65"></a><span id="l56.65">     path += '/[' + (column - 1) + ']';</span>
<a href="#l56.66"></a><span id="l56.66"> </span>
<a href="#l56.67"></a><span id="l56.67">     return path;</span>
<a href="#l56.68"></a><span id="l56.68" class="difflineminus">-  }</span>
<a href="#l56.69"></a><span id="l56.69" class="difflineminus">-  else if(view == &quot;day&quot; || view == &quot;week&quot;){</span>
<a href="#l56.70"></a><span id="l56.70" class="difflineplus">+  } else if (view == &quot;day&quot; || view == &quot;week&quot;) {</span>
<a href="#l56.71"></a><span id="l56.71">     path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})';</span>
<a href="#l56.72"></a><span id="l56.72">     path += '/[' + (column - 1) + ']';</span>
<a href="#l56.73"></a><span id="l56.73">     path += '/anon({&quot;anonid&quot;:&quot;boxstack&quot;})';</span>
<a href="#l56.74"></a><span id="l56.74"> </span>
<a href="#l56.75"></a><span id="l56.75" class="difflineminus">-    if(option == CANVAS_BOX)</span>
<a href="#l56.76"></a><span id="l56.76" class="difflineplus">+    if (option == CANVAS_BOX) {</span>
<a href="#l56.77"></a><span id="l56.77">       path += '/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + hour + ']';</span>
<a href="#l56.78"></a><span id="l56.78" class="difflineminus">-    else</span>
<a href="#l56.79"></a><span id="l56.79" class="difflineplus">+    } else {</span>
<a href="#l56.80"></a><span id="l56.80">       path += '/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l56.81"></a><span id="l56.81" class="difflineplus">+    }</span>
<a href="#l56.82"></a><span id="l56.82"> </span>
<a href="#l56.83"></a><span id="l56.83">     return path;</span>
<a href="#l56.84"></a><span id="l56.84" class="difflineminus">-  }</span>
<a href="#l56.85"></a><span id="l56.85" class="difflineminus">-  else{</span>
<a href="#l56.86"></a><span id="l56.86" class="difflineplus">+  } else {</span>
<a href="#l56.87"></a><span id="l56.87">     path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/'</span>
<a href="#l56.88"></a><span id="l56.88">       + 'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[' + (row - 1) + ']/[' + (column - 1) + ']';</span>
<a href="#l56.89"></a><span id="l56.89"> </span>
<a href="#l56.90"></a><span id="l56.90" class="difflineminus">-    if(option == CANVAS_BOX)</span>
<a href="#l56.91"></a><span id="l56.91" class="difflineplus">+    if (option == CANVAS_BOX) {</span>
<a href="#l56.92"></a><span id="l56.92">       path += '/anon({&quot;anonid&quot;:&quot;day-items&quot;})';</span>
<a href="#l56.93"></a><span id="l56.93" class="difflineplus">+    }</span>
<a href="#l56.94"></a><span id="l56.94"> </span>
<a href="#l56.95"></a><span id="l56.95">     return path;</span>
<a href="#l56.96"></a><span id="l56.96">   }</span>
<a href="#l56.97"></a><span id="l56.97"> }</span>
<a href="#l56.98"></a><span id="l56.98"> </span>
<a href="#l56.99"></a><span id="l56.99"> /**</span>
<a href="#l56.100"></a><span id="l56.100">  * @param controller - Mozmill window controller</span>
<a href="#l56.101"></a><span id="l56.101">  * @param n - how many times next button in view is clicked</span>
<a href="#l56.102"></a><span id="l56.102" class="difflineat">@@ -297,20 +295,21 @@ function back(controller, n){</span>
<a href="#l56.103"></a><span id="l56.103">  * @param name - calendar name</span>
<a href="#l56.104"></a><span id="l56.104">  */</span>
<a href="#l56.105"></a><span id="l56.105"> function deleteCalendars(controller, name){</span>
<a href="#l56.106"></a><span id="l56.106">   let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l56.107"></a><span id="l56.107">                     .getNode().ownerDocument.defaultView;</span>
<a href="#l56.108"></a><span id="l56.108">   let manager = defaultView.getCalendarManager();</span>
<a href="#l56.109"></a><span id="l56.109">   let cals = manager.getCalendars({});</span>
<a href="#l56.110"></a><span id="l56.110"> </span>
<a href="#l56.111"></a><span id="l56.111" class="difflineminus">-  for (let i = 0; i &lt; cals.length; i++)</span>
<a href="#l56.112"></a><span id="l56.112" class="difflineplus">+  for (let i = 0; i &lt; cals.length; i++) {</span>
<a href="#l56.113"></a><span id="l56.113">     if (cals[i].name == name) {</span>
<a href="#l56.114"></a><span id="l56.114">         manager.removeCalendar(cals[i]);</span>
<a href="#l56.115"></a><span id="l56.115">     }</span>
<a href="#l56.116"></a><span id="l56.116" class="difflineplus">+  }</span>
<a href="#l56.117"></a><span id="l56.117"> }</span>
<a href="#l56.118"></a><span id="l56.118"> </span>
<a href="#l56.119"></a><span id="l56.119"> /**</span>
<a href="#l56.120"></a><span id="l56.120">  * Creates local calendar with given name and select it in calendars list</span>
<a href="#l56.121"></a><span id="l56.121">  * @param controller - Mozmill window controller</span>
<a href="#l56.122"></a><span id="l56.122">  * @param name - calendar name</span>
<a href="#l56.123"></a><span id="l56.123">  */</span>
<a href="#l56.124"></a><span id="l56.124"> function createCalendar(controller, name){</span>
<a href="#l56.125"></a><span id="l56.125" class="difflineat">@@ -324,19 +323,21 @@ function createCalendar(controller, name</span>
<a href="#l56.126"></a><span id="l56.126">   manager.registerCalendar(calendar);</span>
<a href="#l56.127"></a><span id="l56.127"> </span>
<a href="#l56.128"></a><span id="l56.128">   let id = calendar.id;</span>
<a href="#l56.129"></a><span id="l56.129">   let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l56.130"></a><span id="l56.130">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l56.131"></a><span id="l56.131">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/'</span>
<a href="#l56.132"></a><span id="l56.132">     + 'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l56.133"></a><span id="l56.133">     .getNode();</span>
<a href="#l56.134"></a><span id="l56.134" class="difflineminus">-  for(i = 0; i &lt; calendarTree.mCalendarList.length; i++)</span>
<a href="#l56.135"></a><span id="l56.135" class="difflineminus">-    if(calendarTree.mCalendarList[i].id == id)</span>
<a href="#l56.136"></a><span id="l56.136" class="difflineplus">+  for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l56.137"></a><span id="l56.137" class="difflineplus">+    if (calendarTree.mCalendarList[i].id == id) {</span>
<a href="#l56.138"></a><span id="l56.138">       calendarTree.tree.view.selection.select(i);</span>
<a href="#l56.139"></a><span id="l56.139" class="difflineplus">+    }</span>
<a href="#l56.140"></a><span id="l56.140" class="difflineplus">+  }</span>
<a href="#l56.141"></a><span id="l56.141"> }</span>
<a href="#l56.142"></a><span id="l56.142"> </span>
<a href="#l56.143"></a><span id="l56.143"> /**</span>
<a href="#l56.144"></a><span id="l56.144">  * Retrieves array of all calendar-event-box elements in node</span>
<a href="#l56.145"></a><span id="l56.145">  * @param node - node to be searched</span>
<a href="#l56.146"></a><span id="l56.146">  * @param eventNodes - array where to put resultng nodes</span>
<a href="#l56.147"></a><span id="l56.147">  */</span>
<a href="#l56.148"></a><span id="l56.148"> function findEventsInNode(node, eventNodes) {</span>
<a href="#l56.149"></a><span id="l56.149" class="difflineat">@@ -479,18 +480,19 @@ function setData(controller, data) {</span>
<a href="#l56.150"></a><span id="l56.150">     menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l56.151"></a><span id="l56.151">     controller.click(menuitem);</span>
<a href="#l56.152"></a><span id="l56.152">   }</span>
<a href="#l56.153"></a><span id="l56.153"> </span>
<a href="#l56.154"></a><span id="l56.154">   // startdate</span>
<a href="#l56.155"></a><span id="l56.155">   if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == 'Date') {</span>
<a href="#l56.156"></a><span id="l56.156">     let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l56.157"></a><span id="l56.157">       data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l56.158"></a><span id="l56.158" class="difflineminus">-    if(!isEvent)</span>
<a href="#l56.159"></a><span id="l56.159" class="difflineplus">+    if (!isEvent) {</span>
<a href="#l56.160"></a><span id="l56.160">       controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-entrydate&quot;), true);</span>
<a href="#l56.161"></a><span id="l56.161" class="difflineplus">+    }</span>
<a href="#l56.162"></a><span id="l56.162">     if (!mac) {</span>
<a href="#l56.163"></a><span id="l56.163">       controller.keypress(startDateInput, 'a', {ctrlKey: true});</span>
<a href="#l56.164"></a><span id="l56.164">       controller.type(startDateInput, startdate);</span>
<a href="#l56.165"></a><span id="l56.165">     } else {</span>
<a href="#l56.166"></a><span id="l56.166">       startDateInput.getNode().value = startdate;</span>
<a href="#l56.167"></a><span id="l56.167">     }</span>
<a href="#l56.168"></a><span id="l56.168">   }</span>
<a href="#l56.169"></a><span id="l56.169"> </span>
<a href="#l56.170"></a><span id="l56.170" class="difflineat">@@ -506,18 +508,19 @@ function setData(controller, data) {</span>
<a href="#l56.171"></a><span id="l56.171">       controller.sleep(sleep);</span>
<a href="#l56.172"></a><span id="l56.172">     }</span>
<a href="#l56.173"></a><span id="l56.173">   }</span>
<a href="#l56.174"></a><span id="l56.174"> </span>
<a href="#l56.175"></a><span id="l56.175">   // enddate</span>
<a href="#l56.176"></a><span id="l56.176">   if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == 'Date') {</span>
<a href="#l56.177"></a><span id="l56.177">     let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l56.178"></a><span id="l56.178">       data.enddate.getFullYear(), data.enddate.getMonth() + 1, data.enddate.getDate());</span>
<a href="#l56.179"></a><span id="l56.179" class="difflineminus">-    if(!isEvent)</span>
<a href="#l56.180"></a><span id="l56.180" class="difflineplus">+    if (!isEvent) {</span>
<a href="#l56.181"></a><span id="l56.181">       controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-duedate&quot;), true);</span>
<a href="#l56.182"></a><span id="l56.182" class="difflineplus">+    }</span>
<a href="#l56.183"></a><span id="l56.183">     if (!mac) {</span>
<a href="#l56.184"></a><span id="l56.184">       controller.keypress(endDateInput, 'a', {ctrlKey: true});</span>
<a href="#l56.185"></a><span id="l56.185">       controller.type(endDateInput, enddate);</span>
<a href="#l56.186"></a><span id="l56.186">     } else {</span>
<a href="#l56.187"></a><span id="l56.187">       endDateInput.getNode().value = enddate;</span>
<a href="#l56.188"></a><span id="l56.188">     }</span>
<a href="#l56.189"></a><span id="l56.189">   }</span>
<a href="#l56.190"></a><span id="l56.190"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -46,18 +46,19 @@ var testTodayPane = function () {</span>
<a href="#l57.4"></a><span id="l57.4"> </span>
<a href="#l57.5"></a><span id="l57.5">   // create event 6 hours from now, if this is tomorrow then at 23 today</span>
<a href="#l57.6"></a><span id="l57.6">   // doubleclick only triggers new event dialog on visible boxes, so scrolling may be needed</span>
<a href="#l57.7"></a><span id="l57.7">   // by default visible time is 08:00 - 17:00, box of 17th hour is out of view</span>
<a href="#l57.8"></a><span id="l57.8">   let hour = (new Date()).getHours();</span>
<a href="#l57.9"></a><span id="l57.9">   let startHour = (hour &lt; 18)? hour + 6 : 23;</span>
<a href="#l57.10"></a><span id="l57.10">   let view = (new elementslib.Lookup(controller.window.document, dayView)).getNode();</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  if(startHour &lt; 8 || startHour &gt; 16)</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  if (startHour &lt; 8 || startHour &gt; 16) {</span>
<a href="#l57.14"></a><span id="l57.14">     view.scrollToMinute(60 * startHour);</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineplus">+  }</span>
<a href="#l57.16"></a><span id="l57.16"> </span>
<a href="#l57.17"></a><span id="l57.17">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l57.18"></a><span id="l57.18">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l57.19"></a><span id="l57.19">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l57.20"></a><span id="l57.20">     + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + ']'), 1, 1);</span>
<a href="#l57.21"></a><span id="l57.21">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l57.22"></a><span id="l57.22">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l57.23"></a><span id="l57.23">   let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineat">@@ -83,18 +84,19 @@ var testTodayPane = function () {</span>
<a href="#l57.25"></a><span id="l57.25">   event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l57.26"></a><span id="l57.26"> </span>
<a href="#l57.27"></a><span id="l57.27">   event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l57.28"></a><span id="l57.28">   event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Tomorrow's Event&quot;);</span>
<a href="#l57.29"></a><span id="l57.29">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l57.30"></a><span id="l57.30">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l57.31"></a><span id="l57.31"> </span>
<a href="#l57.32"></a><span id="l57.32">   // go 5 days forward and add an event</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineminus">-  for(let i = 0; i &lt; 5; i++)</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineplus">+  for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l57.35"></a><span id="l57.35">     controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l57.36"></a><span id="l57.36" class="difflineplus">+  }</span>
<a href="#l57.37"></a><span id="l57.37">   controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l57.38"></a><span id="l57.38"> </span>
<a href="#l57.39"></a><span id="l57.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l57.40"></a><span id="l57.40">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l57.41"></a><span id="l57.41">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l57.42"></a><span id="l57.42">     + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l57.43"></a><span id="l57.43">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l57.44"></a><span id="l57.44">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -35,19 +35,21 @@ var testTaskView = function () {</span>
<a href="#l58.4"></a><span id="l58.4">   controller.sleep(sleep);</span>
<a href="#l58.5"></a><span id="l58.5"> </span>
<a href="#l58.6"></a><span id="l58.6">   // make sure that testing calendar is selected</span>
<a href="#l58.7"></a><span id="l58.7">   let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l58.8"></a><span id="l58.8">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l58.9"></a><span id="l58.9">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/'</span>
<a href="#l58.10"></a><span id="l58.10">     + 'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l58.11"></a><span id="l58.11">     .getNode();</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  for(i = 0; i &lt; calendarTree.mCalendarList.length; i++)</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-    if(calendarTree.mCalendarList[i].name == calendar)</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineplus">+  for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineplus">+    if (calendarTree.mCalendarList[i].name == calendar) {</span>
<a href="#l58.16"></a><span id="l58.16">       calendarTree.tree.view.selection.select(i);</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineplus">+    }</span>
<a href="#l58.18"></a><span id="l58.18" class="difflineplus">+  }</span>
<a href="#l58.19"></a><span id="l58.19"> </span>
<a href="#l58.20"></a><span id="l58.20">   let taskTreeNode = (new elementslib.Lookup(controller.window.document, taskTree)).getNode();</span>
<a href="#l58.21"></a><span id="l58.21">   let countBefore = taskTreeNode.mTaskArray.length;</span>
<a href="#l58.22"></a><span id="l58.22"> </span>
<a href="#l58.23"></a><span id="l58.23">   // add task</span>
<a href="#l58.24"></a><span id="l58.24">   controller.type(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l58.25"></a><span id="l58.25">     + 'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l58.26"></a><span id="l58.26">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/test/unit/test_calmgr.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/test/unit/test_calmgr.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -34,23 +34,29 @@ add_test(function test_registration() {</span>
<a href="#l59.4"></a><span id="l59.4">     // Create a local memory calendar, ths shouldn't register any calendars</span>
<a href="#l59.5"></a><span id="l59.5">     let memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l59.6"></a><span id="l59.6">     checkCalendarCount(0, 0, 0);</span>
<a href="#l59.7"></a><span id="l59.7"> </span>
<a href="#l59.8"></a><span id="l59.8">     // Register an observer to test it.</span>
<a href="#l59.9"></a><span id="l59.9">     let registered = false, unregistered = false, deleted = false, readOnly = false;</span>
<a href="#l59.10"></a><span id="l59.10">     let mgrobs = cal.createAdapter(Components.interfaces.calICalendarManagerObserver, {</span>
<a href="#l59.11"></a><span id="l59.11">         onCalendarRegistered: function onCalendarRegistered(aCalendar) {</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-            if (aCalendar.id == memory.id) registered = true;</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+            if (aCalendar.id == memory.id) {</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineplus">+              registered = true;</span>
<a href="#l59.15"></a><span id="l59.15" class="difflineplus">+            }</span>
<a href="#l59.16"></a><span id="l59.16">         },</span>
<a href="#l59.17"></a><span id="l59.17">         onCalendarUnregistering: function onCalendarUnregistering(aCalendar) {</span>
<a href="#l59.18"></a><span id="l59.18" class="difflineminus">-            if (aCalendar.id == memory.id) unregistered = true;</span>
<a href="#l59.19"></a><span id="l59.19" class="difflineplus">+            if (aCalendar.id == memory.id) {</span>
<a href="#l59.20"></a><span id="l59.20" class="difflineplus">+              unregistered = true;</span>
<a href="#l59.21"></a><span id="l59.21" class="difflineplus">+            }</span>
<a href="#l59.22"></a><span id="l59.22">         },</span>
<a href="#l59.23"></a><span id="l59.23">         onCalendarDeleting: function onCalendarDeleting(aCalendar) {</span>
<a href="#l59.24"></a><span id="l59.24" class="difflineminus">-            if (aCalendar.id == memory.id) deleted = true;</span>
<a href="#l59.25"></a><span id="l59.25" class="difflineplus">+            if (aCalendar.id == memory.id) {</span>
<a href="#l59.26"></a><span id="l59.26" class="difflineplus">+              deleted = true;</span>
<a href="#l59.27"></a><span id="l59.27" class="difflineplus">+            }</span>
<a href="#l59.28"></a><span id="l59.28">         }</span>
<a href="#l59.29"></a><span id="l59.29">     });</span>
<a href="#l59.30"></a><span id="l59.30">     let calobs = cal.createAdapter(Components.interfaces.calIObserver, {</span>
<a href="#l59.31"></a><span id="l59.31">         onPropertyChanged: function onPropertyChanging(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l59.32"></a><span id="l59.32">             equal(aCalendar.id, memory.id);</span>
<a href="#l59.33"></a><span id="l59.33">             equal(aName, &quot;readOnly&quot;);</span>
<a href="#l59.34"></a><span id="l59.34">             readOnly = aValue;</span>
<a href="#l59.35"></a><span id="l59.35">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -385,57 +385,79 @@ GDataServer.prototype = {</span>
<a href="#l60.4"></a><span id="l60.4">             response.setStatusLine(null, 404, &quot;Not Found&quot;);</span>
<a href="#l60.5"></a><span id="l60.5">         }</span>
<a href="#l60.6"></a><span id="l60.6">     },</span>
<a href="#l60.7"></a><span id="l60.7"> </span>
<a href="#l60.8"></a><span id="l60.8">     processAddEvent: function(jsonData, isImport) {</span>
<a href="#l60.9"></a><span id="l60.9">         jsonData.kind = &quot;calendar#event&quot;;</span>
<a href="#l60.10"></a><span id="l60.10">         jsonData.etag = this.nextEtag || '&quot;' + (new Date()).getTime() + '&quot;';</span>
<a href="#l60.11"></a><span id="l60.11">         jsonData.id = generateID();</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-        if (!isImport) jsonData.htmlLink = this.baseUri + &quot;/calendar/event?eid=&quot; + jsonData.id;</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-        if (!isImport || !jsonData.iCalUID) jsonData.iCalUID = jsonData.id + &quot;@google.com&quot;;</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-        if (!isImport || !jsonData.created) jsonData.created = cal.toRFC3339(cal.now());</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineminus">-        if (!isImport || !jsonData.updated) jsonData.updated = cal.toRFC3339(cal.now());</span>
<a href="#l60.16"></a><span id="l60.16" class="difflineminus">-        if (!isImport || !jsonData.creator) jsonData.creator = this.creator;</span>
<a href="#l60.17"></a><span id="l60.17" class="difflineminus">-        if (!isImport || !jsonData.organizer) jsonData.organizer = this.creator;</span>
<a href="#l60.18"></a><span id="l60.18" class="difflineplus">+        if (!isImport) { jsonData.htmlLink = this.baseUri + &quot;/calendar/event?eid=&quot; + jsonData.id; }</span>
<a href="#l60.19"></a><span id="l60.19" class="difflineplus">+        if (!isImport || !jsonData.iCalUID) {</span>
<a href="#l60.20"></a><span id="l60.20" class="difflineplus">+            jsonData.iCalUID = jsonData.id + &quot;@google.com&quot;;</span>
<a href="#l60.21"></a><span id="l60.21" class="difflineplus">+        }</span>
<a href="#l60.22"></a><span id="l60.22" class="difflineplus">+        if (!isImport || !jsonData.created) {</span>
<a href="#l60.23"></a><span id="l60.23" class="difflineplus">+            jsonData.created = cal.toRFC3339(cal.now());</span>
<a href="#l60.24"></a><span id="l60.24" class="difflineplus">+        }</span>
<a href="#l60.25"></a><span id="l60.25" class="difflineplus">+        if (!isImport || !jsonData.updated) {</span>
<a href="#l60.26"></a><span id="l60.26" class="difflineplus">+            jsonData.updated = cal.toRFC3339(cal.now());</span>
<a href="#l60.27"></a><span id="l60.27" class="difflineplus">+        }</span>
<a href="#l60.28"></a><span id="l60.28" class="difflineplus">+        if (!isImport || !jsonData.creator) {</span>
<a href="#l60.29"></a><span id="l60.29" class="difflineplus">+            jsonData.creator = this.creator;</span>
<a href="#l60.30"></a><span id="l60.30" class="difflineplus">+        }</span>
<a href="#l60.31"></a><span id="l60.31" class="difflineplus">+        if (!isImport || !jsonData.organizer) {</span>
<a href="#l60.32"></a><span id="l60.32" class="difflineplus">+            jsonData.organizer = this.creator;</span>
<a href="#l60.33"></a><span id="l60.33" class="difflineplus">+        }</span>
<a href="#l60.34"></a><span id="l60.34">         this.nextEtag = null;</span>
<a href="#l60.35"></a><span id="l60.35">         return jsonData;</span>
<a href="#l60.36"></a><span id="l60.36">     },</span>
<a href="#l60.37"></a><span id="l60.37"> </span>
<a href="#l60.38"></a><span id="l60.38">     processModifyEvent: function(jsonData, id) {</span>
<a href="#l60.39"></a><span id="l60.39">         jsonData.kind = &quot;calendar#event&quot;;</span>
<a href="#l60.40"></a><span id="l60.40">         jsonData.etag = this.nextEtag || '&quot;' + (new Date()).getTime() + '&quot;';</span>
<a href="#l60.41"></a><span id="l60.41">         jsonData.updated  = cal.toRFC3339(cal.now());</span>
<a href="#l60.42"></a><span id="l60.42">         jsonData.id = id;</span>
<a href="#l60.43"></a><span id="l60.43">         jsonData.iCalUID = (jsonData.recurringEventId || jsonData.id) + &quot;@google.com&quot;;</span>
<a href="#l60.44"></a><span id="l60.44" class="difflineminus">-        if (!jsonData.creator) jsonData.creator = this.creator;</span>
<a href="#l60.45"></a><span id="l60.45" class="difflineminus">-        if (!jsonData.organizer) jsonData.organizer = this.creator;</span>
<a href="#l60.46"></a><span id="l60.46" class="difflineplus">+        if (!jsonData.creator) {</span>
<a href="#l60.47"></a><span id="l60.47" class="difflineplus">+            jsonData.creator = this.creator;</span>
<a href="#l60.48"></a><span id="l60.48" class="difflineplus">+        }</span>
<a href="#l60.49"></a><span id="l60.49" class="difflineplus">+        if (!jsonData.organizer) {</span>
<a href="#l60.50"></a><span id="l60.50" class="difflineplus">+            jsonData.organizer = this.creator;</span>
<a href="#l60.51"></a><span id="l60.51" class="difflineplus">+        }</span>
<a href="#l60.52"></a><span id="l60.52"> </span>
<a href="#l60.53"></a><span id="l60.53">         this.nextEtag = null;</span>
<a href="#l60.54"></a><span id="l60.54">         return jsonData;</span>
<a href="#l60.55"></a><span id="l60.55">     },</span>
<a href="#l60.56"></a><span id="l60.56"> </span>
<a href="#l60.57"></a><span id="l60.57">     processAddTask: function(jsonData) {</span>
<a href="#l60.58"></a><span id="l60.58">         jsonData.kind = &quot;tasks#task&quot;;</span>
<a href="#l60.59"></a><span id="l60.59">         jsonData.etag = this.nextEtag || '&quot;' + (new Date()).getTime() + '&quot;';</span>
<a href="#l60.60"></a><span id="l60.60">         jsonData.id = generateID();</span>
<a href="#l60.61"></a><span id="l60.61">         jsonData.position = generateID(); // Not a real position, but we don't really use this at the moment</span>
<a href="#l60.62"></a><span id="l60.62" class="difflineminus">-        if (!jsonData.status) jsonData.status = &quot;needsAction&quot;;</span>
<a href="#l60.63"></a><span id="l60.63" class="difflineminus">-        if (!jsonData.updated) jsonData.updated = cal.toRFC3339(cal.now());</span>
<a href="#l60.64"></a><span id="l60.64" class="difflineplus">+        if (!jsonData.status) {</span>
<a href="#l60.65"></a><span id="l60.65" class="difflineplus">+            jsonData.status = &quot;needsAction&quot;;</span>
<a href="#l60.66"></a><span id="l60.66" class="difflineplus">+        }</span>
<a href="#l60.67"></a><span id="l60.67" class="difflineplus">+        if (!jsonData.updated) {</span>
<a href="#l60.68"></a><span id="l60.68" class="difflineplus">+            jsonData.updated = cal.toRFC3339(cal.now());</span>
<a href="#l60.69"></a><span id="l60.69" class="difflineplus">+        }</span>
<a href="#l60.70"></a><span id="l60.70"> </span>
<a href="#l60.71"></a><span id="l60.71">         this.nextEtag = null;</span>
<a href="#l60.72"></a><span id="l60.72">         return jsonData;</span>
<a href="#l60.73"></a><span id="l60.73">     },</span>
<a href="#l60.74"></a><span id="l60.74"> </span>
<a href="#l60.75"></a><span id="l60.75">     processModifyTask: function(jsonData) {</span>
<a href="#l60.76"></a><span id="l60.76">         jsonData.kind = &quot;tasks#task&quot;;</span>
<a href="#l60.77"></a><span id="l60.77">         jsonData.etag = this.nextEtag || '&quot;' + (new Date()).getTime() + '&quot;';</span>
<a href="#l60.78"></a><span id="l60.78">         jsonData.updated  = cal.toRFC3339(cal.now());</span>
<a href="#l60.79"></a><span id="l60.79" class="difflineminus">-        if (!jsonData.status) jsonData.status = &quot;needsAction&quot;;</span>
<a href="#l60.80"></a><span id="l60.80" class="difflineminus">-        if (!jsonData.updated) jsonData.updated = cal.toRFC3339(cal.now());</span>
<a href="#l60.81"></a><span id="l60.81" class="difflineplus">+        if (!jsonData.status) {</span>
<a href="#l60.82"></a><span id="l60.82" class="difflineplus">+            jsonData.status = &quot;needsAction&quot;;</span>
<a href="#l60.83"></a><span id="l60.83" class="difflineplus">+        }</span>
<a href="#l60.84"></a><span id="l60.84" class="difflineplus">+        if (!jsonData.updated) {</span>
<a href="#l60.85"></a><span id="l60.85" class="difflineplus">+            jsonData.updated = cal.toRFC3339(cal.now());</span>
<a href="#l60.86"></a><span id="l60.86" class="difflineplus">+        }</span>
<a href="#l60.87"></a><span id="l60.87"> </span>
<a href="#l60.88"></a><span id="l60.88">         this.nextEtag = null;</span>
<a href="#l60.89"></a><span id="l60.89">         return jsonData;</span>
<a href="#l60.90"></a><span id="l60.90">     },</span>
<a href="#l60.91"></a><span id="l60.91"> };</span>
<a href="#l60.92"></a><span id="l60.92"> </span>
<a href="#l60.93"></a><span id="l60.93"> function findKey(container, key, searchKey) {</span>
<a href="#l60.94"></a><span id="l60.94">     let foundIndex = -1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/test/unit/test_hashedarray.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/test/unit/test_hashedarray.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -177,17 +177,19 @@ function test_hashAccessor() {</span>
<a href="#l61.4"></a><span id="l61.4">     let comptor = (a, b) =&gt; titleComptor(a.item, b.item);</span>
<a href="#l61.5"></a><span id="l61.5"> </span>
<a href="#l61.6"></a><span id="l61.6">     har = new cal.SortedHashedArray(comptor);</span>
<a href="#l61.7"></a><span id="l61.7">     har.hashAccessor = function(obj) {</span>
<a href="#l61.8"></a><span id="l61.8">         return obj.item.hashId;</span>
<a href="#l61.9"></a><span id="l61.9">     };</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11">     function itemAccessor(obj) {</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-        if (!obj) do_throw(&quot;WTF?&quot;);</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+        if (!obj) {</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineplus">+            do_throw(&quot;WTF?&quot;);</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineplus">+        }</span>
<a href="#l61.16"></a><span id="l61.16">         return obj.item;</span>
<a href="#l61.17"></a><span id="l61.17">     }</span>
<a href="#l61.18"></a><span id="l61.18"> </span>
<a href="#l61.19"></a><span id="l61.19">     function itemCreator(title) {</span>
<a href="#l61.20"></a><span id="l61.20">         return { item: hashedCreateItem(title) };</span>
<a href="#l61.21"></a><span id="l61.21">     }</span>
<a href="#l61.22"></a><span id="l61.22"> </span>
<a href="#l61.23"></a><span id="l61.23">     function sortedPostProcess(harParam, tiParam) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/test/unit/test_ics_parser.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_parser.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -4,17 +4,19 @@</span>
<a href="#l62.4"></a><span id="l62.4"> </span>
<a href="#l62.5"></a><span id="l62.5"> function run_test() {</span>
<a href="#l62.6"></a><span id="l62.6">     do_calendar_startup(really_run_test);</span>
<a href="#l62.7"></a><span id="l62.7"> }</span>
<a href="#l62.8"></a><span id="l62.8"> </span>
<a href="#l62.9"></a><span id="l62.9"> function really_run_test() {</span>
<a href="#l62.10"></a><span id="l62.10">     test_roundtrip();</span>
<a href="#l62.11"></a><span id="l62.11">     test_async();</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) test_failures();</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineplus">+        test_failures();</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineplus">+    }</span>
<a href="#l62.16"></a><span id="l62.16">     test_fake_parent();</span>
<a href="#l62.17"></a><span id="l62.17">     test_props_comps();</span>
<a href="#l62.18"></a><span id="l62.18">     test_timezone();</span>
<a href="#l62.19"></a><span id="l62.19"> }</span>
<a href="#l62.20"></a><span id="l62.20"> </span>
<a href="#l62.21"></a><span id="l62.21"> function test_props_comps() {</span>
<a href="#l62.22"></a><span id="l62.22">     let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l62.23"></a><span id="l62.23">                            .createInstance(Components.interfaces.calIIcsParser);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -9,17 +9,19 @@ function run_test() {</span>
<a href="#l63.4"></a><span id="l63.4"> function really_run_test() {</span>
<a href="#l63.5"></a><span id="l63.5">     test_iterator();</span>
<a href="#l63.6"></a><span id="l63.6">     test_icalcomponent();</span>
<a href="#l63.7"></a><span id="l63.7">     test_icsservice();</span>
<a href="#l63.8"></a><span id="l63.8">     test_icalstring();</span>
<a href="#l63.9"></a><span id="l63.9">     test_param();</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11">     // Only supported with ical.js</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) test_icalproperty();</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineplus">+        test_icalproperty();</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineplus">+    }</span>
<a href="#l63.16"></a><span id="l63.16"> }</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18"> function test_icalstring() {</span>
<a href="#l63.19"></a><span id="l63.19">     function checkComp(createFunc, icalString, members, properties) {</span>
<a href="#l63.20"></a><span id="l63.20">         let thing = createFunc(icalString);</span>
<a href="#l63.21"></a><span id="l63.21">         equal(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l63.22"></a><span id="l63.22"> </span>
<a href="#l63.23"></a><span id="l63.23">         if (members) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/test/unit/test_rfc3339_parser.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/test/unit/test_rfc3339_parser.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -27,20 +27,21 @@ function really_run_test() {</span>
<a href="#l64.4"></a><span id="l64.4">             second: aExpectedDateTime[5],</span>
<a href="#l64.5"></a><span id="l64.5">             timezone: aExpectedDateTime[6],</span>
<a href="#l64.6"></a><span id="l64.6">             isDate: aExpectedDateTime[7]</span>
<a href="#l64.7"></a><span id="l64.7">         };</span>
<a href="#l64.8"></a><span id="l64.8">         for (let prop in expectedDateProps) {</span>
<a href="#l64.9"></a><span id="l64.9">             do_print(&quot;Checking prop: &quot; + prop);</span>
<a href="#l64.10"></a><span id="l64.10">             // Object comparison fails with ical.js, and we only want to check</span>
<a href="#l64.11"></a><span id="l64.11">             // that we have the right timezone.</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-            if (prop == &quot;timezone&quot;)</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+            if (prop == &quot;timezone&quot;) {</span>
<a href="#l64.14"></a><span id="l64.14">                 equal(dateTime[prop].tzid, expectedDateProps[prop].tzid)</span>
<a href="#l64.15"></a><span id="l64.15" class="difflineminus">-            else</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineplus">+            } else {</span>
<a href="#l64.17"></a><span id="l64.17">                 equal(dateTime[prop], expectedDateProps[prop]);</span>
<a href="#l64.18"></a><span id="l64.18" class="difflineplus">+            }</span>
<a href="#l64.19"></a><span id="l64.19">         }</span>
<a href="#l64.20"></a><span id="l64.20"> </span>
<a href="#l64.21"></a><span id="l64.21">         // Test round tripping that dateTime object back to an RFC 3339 string.</span>
<a href="#l64.22"></a><span id="l64.22">         let rfc3339Date = cal.toRFC3339(dateTime);</span>
<a href="#l64.23"></a><span id="l64.23"> </span>
<a href="#l64.24"></a><span id="l64.24">         // In theory this should just match the input RFC 3339 date, but there are</span>
<a href="#l64.25"></a><span id="l64.25">         // multiple ways of generating the same time, e.g. 2006-03-14Z is</span>
<a href="#l64.26"></a><span id="l64.26">         // equivalent to 2006-03-14.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

