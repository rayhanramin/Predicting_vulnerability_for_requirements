<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22134:254747a8daa5e96faeb4f3c389841e61365cb82b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 254747a8daa5e96faeb4f3c389841e61365cb82b" />
<meta property="og:url" content="/comm-central/rev/254747a8daa5e96faeb4f3c389841e61365cb82b" />
<meta property="og:description" content="Bug 1340972 - Part 14: Fix use of NS_ADDREF() and NS_IF_ADDREF() in mailnews/base/src. r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 254747a8daa5e96faeb4f3c389841e61365cb82b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/254747a8daa5e96faeb4f3c389841e61365cb82b">shortlog</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/254747a8daa5e96faeb4f3c389841e61365cb82b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b">files</a> |
changeset |
<a href="/comm-central/raw-rev/254747a8daa5e96faeb4f3c389841e61365cb82b">raw</a>  | <a href="/comm-central/archive/254747a8daa5e96faeb4f3c389841e61365cb82b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340972">Bug 1340972</a> - Part 14: Fix use of NS_ADDREF() and NS_IF_ADDREF() in mailnews/base/src. r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 15 Sep 2017 00:32:14 +0200</td></tr>

<tr>
 <td>changeset 22134</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/254747a8daa5e96faeb4f3c389841e61365cb82b">254747a8daa5e96faeb4f3c389841e61365cb82b</a></td>
</tr>



<tr>
<td>parent 22133</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a0bd8f2b70bef081d138819a6363a1917da55cbe">a0bd8f2b70bef081d138819a6363a1917da55cbe</a>
</td>
</tr>

<tr>
<td>child 22135</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ebe355c1d925132c3dd4ce6acca6506079518d89">ebe355c1d925132c3dd4ce6acca6506079518d89</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=254747a8daa5e96faeb4f3c389841e61365cb82b">13511</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 14 Sep 2017 22:36:09 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ebe355c1d925 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ebe355c1d925132c3dd4ce6acca6506079518d89">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ebe355c1d925132c3dd4ce6acca6506079518d89&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ebe355c1d925132c3dd4ce6acca6506079518d89&newProject=comm-central&newRevision=a0bd8f2b70bef081d138819a6363a1917da55cbe&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ebe355c1d925132c3dd4ce6acca6506079518d89&newProject=comm-central&newRevision=a0bd8f2b70bef081d138819a6363a1917da55cbe&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ebe355c1d925132c3dd4ce6acca6506079518d89&newProject=comm-central&newRevision=a0bd8f2b70bef081d138819a6363a1917da55cbe&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340972">1340972</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340972">Bug 1340972</a> - Part 14: Fix use of NS_ADDREF() and NS_IF_ADDREF() in mailnews/base/src. r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMailDirProvider.cpp">mailnews/base/src/nsMailDirProvider.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMailDirProvider.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMailDirProvider.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMailDirProvider.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMailDirProvider.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMailDirProvider.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManagerDS.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManagerDS.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderCacheElement.cpp">mailnews/base/src/nsMsgFolderCacheElement.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderCacheElement.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderCacheElement.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderCacheElement.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderCacheElement.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderCacheElement.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderDataSource.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgGroupThread.cpp">mailnews/base/src/nsMsgGroupThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgGroupThread.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgGroupThread.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgGroupThread.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgGroupThread.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgGroupThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgMailSession.cpp">mailnews/base/src/nsMsgMailSession.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgMailSession.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgMailSession.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgMailSession.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgMailSession.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgMailSession.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgOfflineManager.cpp">mailnews/base/src/nsMsgOfflineManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgOfflineManager.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgOfflineManager.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgOfflineManager.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgOfflineManager.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgOfflineManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgQuickSearchDBView.cpp">mailnews/base/src/nsMsgQuickSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgQuickSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgQuickSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgQuickSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgQuickSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgQuickSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFDataSource.cpp">mailnews/base/src/nsMsgRDFDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFDataSource.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFDataSource.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFUtils.cpp">mailnews/base/src/nsMsgRDFUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFUtils.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFUtils.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFUtils.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFUtils.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgRDFUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSpecialViews.cpp">mailnews/base/src/nsMsgSpecialViews.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSpecialViews.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSpecialViews.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSpecialViews.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSpecialViews.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgSpecialViews.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFViewThread.cpp">mailnews/base/src/nsMsgXFViewThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFViewThread.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFViewThread.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFViewThread.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFViewThread.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFViewThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribableServer.cpp">mailnews/base/src/nsSubscribableServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribableServer.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribableServer.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribableServer.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribableServer.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribableServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribeDataSource.cpp">mailnews/base/src/nsSubscribeDataSource.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribeDataSource.cpp">file</a> |
<a href="/comm-central/annotate/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribeDataSource.cpp">annotate</a> |
<a href="/comm-central/diff/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribeDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribeDataSource.cpp">comparison</a> |
<a href="/comm-central/log/254747a8daa5e96faeb4f3c389841e61365cb82b/mailnews/base/src/nsSubscribeDataSource.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/src/nsMailDirProvider.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -121,17 +121,17 @@ nsMailDirProvider::GetFiles(const char *</span>
<a href="#l1.4"></a><span id="l1.4">   // xpcshell-tests don't have XRE_EXTENSIONS_DIR_LIST, so accept a null return here.</span>
<a href="#l1.5"></a><span id="l1.5">   dirSvc-&gt;Get(XRE_EXTENSIONS_DIR_LIST,</span>
<a href="#l1.6"></a><span id="l1.6">               NS_GET_IID(nsISimpleEnumerator),</span>
<a href="#l1.7"></a><span id="l1.7">               getter_AddRefs(extensionsEnum));</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">   rv = NS_NewUnionEnumerator(getter_AddRefs(combinedEnumerator), directoryEnumerator, extensionsEnum);</span>
<a href="#l1.10"></a><span id="l1.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  NS_IF_ADDREF(*aResult = new AppendingEnumerator(combinedEnumerator));</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  NS_ADDREF(*aResult = new AppendingEnumerator(combinedEnumerator));</span>
<a href="#l1.14"></a><span id="l1.14">   return NS_SUCCESS_AGGREGATE_RESULT;</span>
<a href="#l1.15"></a><span id="l1.15"> }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> NS_IMPL_ISUPPORTS(nsMailDirProvider::AppendingEnumerator,</span>
<a href="#l1.18"></a><span id="l1.18">                    nsISimpleEnumerator)</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> NS_IMETHODIMP</span>
<a href="#l1.21"></a><span id="l1.21"> nsMailDirProvider::AppendingEnumerator::HasMoreElements(bool *aResult)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1619,20 +1619,17 @@ nsMessenger::Redo(nsIMsgWindow *msgWindo</span>
<a href="#l2.4"></a><span id="l2.4">   }</span>
<a href="#l2.5"></a><span id="l2.5">   return rv;</span>
<a href="#l2.6"></a><span id="l2.6"> }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> NS_IMETHODIMP</span>
<a href="#l2.9"></a><span id="l2.9"> nsMessenger::GetTransactionManager(nsITransactionManager* *aTxnMgr)</span>
<a href="#l2.10"></a><span id="l2.10"> {</span>
<a href="#l2.11"></a><span id="l2.11">   NS_ENSURE_TRUE(mTxnMgr &amp;&amp; aTxnMgr, NS_ERROR_NULL_POINTER);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  *aTxnMgr = mTxnMgr;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-  NS_ADDREF(*aTxnMgr);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  NS_ADDREF(*aTxnMgr = mTxnMgr);</span>
<a href="#l2.17"></a><span id="l2.17">   return NS_OK;</span>
<a href="#l2.18"></a><span id="l2.18"> }</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> NS_IMETHODIMP nsMessenger::SetDocumentCharset(const nsACString&amp; aCharacterSet)</span>
<a href="#l2.21"></a><span id="l2.21"> {</span>
<a href="#l2.22"></a><span id="l2.22">   // We want to redisplay the currently selected message (if any) but forcing the</span>
<a href="#l2.23"></a><span id="l2.23">   // redisplay to use characterSet</span>
<a href="#l2.24"></a><span id="l2.24">   if (!mLastDisplayURI.IsEmpty())</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -2132,19 +2129,18 @@ nsMessenger::GetLastSaveDirectory(nsIFil</span>
<a href="#l2.26"></a><span id="l2.26"> {</span>
<a href="#l2.27"></a><span id="l2.27">   nsresult rv;</span>
<a href="#l2.28"></a><span id="l2.28">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l2.29"></a><span id="l2.29">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">   // this can fail, and it will, on the first time we call it, as there is no default for this pref.</span>
<a href="#l2.32"></a><span id="l2.32">   nsCOMPtr &lt;nsIFile&gt; localFile;</span>
<a href="#l2.33"></a><span id="l2.33">   rv = prefBranch-&gt;GetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsIFile), getter_AddRefs(localFile));</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-    NS_IF_ADDREF(*aLastSaveDir = localFile);</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-  }</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+  if (NS_SUCCEEDED(rv))</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+    localFile.forget(aLastSaveDir);</span>
<a href="#l2.39"></a><span id="l2.39">   return rv;</span>
<a href="#l2.40"></a><span id="l2.40"> }</span>
<a href="#l2.41"></a><span id="l2.41"> </span>
<a href="#l2.42"></a><span id="l2.42"> nsresult</span>
<a href="#l2.43"></a><span id="l2.43"> nsMessenger::SetLastSaveDirectory(nsIFile *aLocalFile)</span>
<a href="#l2.44"></a><span id="l2.44"> {</span>
<a href="#l2.45"></a><span id="l2.45">   nsresult rv;</span>
<a href="#l2.46"></a><span id="l2.46">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -385,17 +385,17 @@ nsresult nsMessengerWinIntegration::GetS</span>
<a href="#l3.4"></a><span id="l3.4"> {</span>
<a href="#l3.5"></a><span id="l3.5">   NS_ENSURE_ARG_POINTER(aBundle);</span>
<a href="#l3.6"></a><span id="l3.6">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService =</span>
<a href="#l3.7"></a><span id="l3.7">     mozilla::services::GetStringBundleService();</span>
<a href="#l3.8"></a><span id="l3.8">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l3.9"></a><span id="l3.9">   nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l3.10"></a><span id="l3.10">   bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messenger.properties&quot;,</span>
<a href="#l3.11"></a><span id="l3.11">                               getter_AddRefs(bundle));</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  NS_IF_ADDREF(*aBundle = bundle);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  bundle.forget(aBundle);</span>
<a href="#l3.14"></a><span id="l3.14">   return NS_OK;</span>
<a href="#l3.15"></a><span id="l3.15"> }</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> #ifndef MOZ_THUNDERBIRD</span>
<a href="#l3.18"></a><span id="l3.18"> nsresult nsMessengerWinIntegration::ShowAlertMessage(const nsString&amp; aAlertTitle,</span>
<a href="#l3.19"></a><span id="l3.19">                                                      const nsString&amp; aAlertText,</span>
<a href="#l3.20"></a><span id="l3.20">                                                      const nsACString&amp; aFolderURI)</span>
<a href="#l3.21"></a><span id="l3.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -922,17 +922,17 @@ nsMsgAccountManager::GetAccounts(nsIArra</span>
<a href="#l4.4"></a><span id="l4.4">     {</span>
<a href="#l4.5"></a><span id="l4.5">       bool hidden = false;</span>
<a href="#l4.6"></a><span id="l4.6">       server-&gt;GetHidden(&amp;hidden);</span>
<a href="#l4.7"></a><span id="l4.7">       if (hidden)</span>
<a href="#l4.8"></a><span id="l4.8">         continue;</span>
<a href="#l4.9"></a><span id="l4.9">     }</span>
<a href="#l4.10"></a><span id="l4.10">     accounts-&gt;AppendElement(existingAccount, false);</span>
<a href="#l4.11"></a><span id="l4.11">   }</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  NS_IF_ADDREF(*_retval = accounts);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  accounts.forget(_retval);</span>
<a href="#l4.14"></a><span id="l4.14">   return NS_OK;</span>
<a href="#l4.15"></a><span id="l4.15"> }</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> NS_IMETHODIMP</span>
<a href="#l4.18"></a><span id="l4.18"> nsMsgAccountManager::GetAllIdentities(nsIArray **_retval)</span>
<a href="#l4.19"></a><span id="l4.19"> {</span>
<a href="#l4.20"></a><span id="l4.20">   nsresult rv = LoadAccounts();</span>
<a href="#l4.21"></a><span id="l4.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -1978,17 +1978,17 @@ nsMsgAccountManager::findServerInternal(</span>
<a href="#l4.23"></a><span id="l4.23">         (hostname.IsEmpty() || thisHostname.Equals(hostname, nsCaseInsensitiveCStringComparator())) &amp;&amp;</span>
<a href="#l4.24"></a><span id="l4.24">         (!(port != 0) || (port == thisPort)) &amp;&amp;</span>
<a href="#l4.25"></a><span id="l4.25">         (username.IsEmpty() || thisUsername.Equals(username)))</span>
<a href="#l4.26"></a><span id="l4.26">     {</span>
<a href="#l4.27"></a><span id="l4.27">       // stop on first find; cache for next time</span>
<a href="#l4.28"></a><span id="l4.28">       if (!aRealFlag)</span>
<a href="#l4.29"></a><span id="l4.29">         SetLastServerFound(server, hostname, username, port, type);</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-      NS_ADDREF(*aResult = server);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+      NS_ADDREF(*aResult = server);  // Was populated from member variable.</span>
<a href="#l4.33"></a><span id="l4.33">       return NS_OK;</span>
<a href="#l4.34"></a><span id="l4.34">     }</span>
<a href="#l4.35"></a><span id="l4.35">   }</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37">   return NS_ERROR_UNEXPECTED;</span>
<a href="#l4.38"></a><span id="l4.38"> }</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -761,18 +761,17 @@ nsMsgAccountManagerDataSource::getAccoun</span>
<a href="#l5.4"></a><span id="l5.4">     mAccountArcsOut-&gt;AppendElement(kNC_Name, false);</span>
<a href="#l5.5"></a><span id="l5.5">     mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeName, false);</span>
<a href="#l5.6"></a><span id="l5.6">     mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName, false);</span>
<a href="#l5.7"></a><span id="l5.7">     mAccountArcsOut-&gt;AppendElement(kNC_NameSort, false);</span>
<a href="#l5.8"></a><span id="l5.8">     mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort, false);</span>
<a href="#l5.9"></a><span id="l5.9">     mAccountArcsOut-&gt;AppendElement(kNC_PageTag, false);</span>
<a href="#l5.10"></a><span id="l5.10">   }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  *aResult = mAccountArcsOut;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  NS_IF_ADDREF(*aResult);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  NS_IF_ADDREF(*aResult = mAccountArcsOut);</span>
<a href="#l5.15"></a><span id="l5.15">   return NS_OK;</span>
<a href="#l5.16"></a><span id="l5.16"> }</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> nsresult</span>
<a href="#l5.19"></a><span id="l5.19"> nsMsgAccountManagerDataSource::getAccountRootArcs(nsIMutableArray **aResult)</span>
<a href="#l5.20"></a><span id="l5.20"> {</span>
<a href="#l5.21"></a><span id="l5.21">   nsresult rv;</span>
<a href="#l5.22"></a><span id="l5.22">   if (!mAccountRootArcsOut) {</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineat">@@ -786,18 +785,17 @@ nsMsgAccountManagerDataSource::getAccoun</span>
<a href="#l5.24"></a><span id="l5.24">     mAccountRootArcsOut-&gt;AppendElement(kNC_Name, false);</span>
<a href="#l5.25"></a><span id="l5.25">     mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeName, false);</span>
<a href="#l5.26"></a><span id="l5.26">     mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName, false);</span>
<a href="#l5.27"></a><span id="l5.27">     mAccountRootArcsOut-&gt;AppendElement(kNC_NameSort, false);</span>
<a href="#l5.28"></a><span id="l5.28">     mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort, false);</span>
<a href="#l5.29"></a><span id="l5.29">     mAccountRootArcsOut-&gt;AppendElement(kNC_PageTag, false);</span>
<a href="#l5.30"></a><span id="l5.30">   }</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  *aResult = mAccountRootArcsOut;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-  NS_IF_ADDREF(*aResult);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  NS_IF_ADDREF(*aResult = mAccountRootArcsOut);</span>
<a href="#l5.35"></a><span id="l5.35">   return NS_OK;</span>
<a href="#l5.36"></a><span id="l5.36"> }</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38"> NS_IMETHODIMP</span>
<a href="#l5.39"></a><span id="l5.39"> nsMsgAccountManagerDataSource::HasArcOut(nsIRDFResource *source, nsIRDFResource *aArc, bool *result)</span>
<a href="#l5.40"></a><span id="l5.40"> {</span>
<a href="#l5.41"></a><span id="l5.41">   if (aArc == kNC_Settings) {</span>
<a href="#l5.42"></a><span id="l5.42">     // based on createSettingsResources()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1013,18 +1013,17 @@ NS_IMETHODIMP nsMsgDBView::SetCellText(i</span>
<a href="#l6.4"></a><span id="l6.4"> NS_IMETHODIMP nsMsgDBView::GetRowCount(int32_t *aRowCount)</span>
<a href="#l6.5"></a><span id="l6.5"> {</span>
<a href="#l6.6"></a><span id="l6.6">   *aRowCount = GetSize();</span>
<a href="#l6.7"></a><span id="l6.7">   return NS_OK;</span>
<a href="#l6.8"></a><span id="l6.8"> }</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> NS_IMETHODIMP nsMsgDBView::GetSelection(nsITreeSelection * *aSelection)</span>
<a href="#l6.11"></a><span id="l6.11"> {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  *aSelection = mTreeSelection;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  NS_IF_ADDREF(*aSelection);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  NS_IF_ADDREF(*aSelection = mTreeSelection);</span>
<a href="#l6.15"></a><span id="l6.15">   return NS_OK;</span>
<a href="#l6.16"></a><span id="l6.16"> }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> NS_IMETHODIMP nsMsgDBView::SetSelection(nsITreeSelection * aSelection)</span>
<a href="#l6.19"></a><span id="l6.19"> {</span>
<a href="#l6.20"></a><span id="l6.20">   mTreeSelection = aSelection;</span>
<a href="#l6.21"></a><span id="l6.21">   return NS_OK;</span>
<a href="#l6.22"></a><span id="l6.22"> }</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineat">@@ -1619,18 +1618,17 @@ nsresult nsMsgDBView::GetMsgHdrForViewIn</span>
<a href="#l6.24"></a><span id="l6.24">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">   nsMsgKey key = m_keys[index];</span>
<a href="#l6.27"></a><span id="l6.27">   if (key == nsMsgKey_None || !m_db)</span>
<a href="#l6.28"></a><span id="l6.28">     return NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   if (key == m_cachedMsgKey)</span>
<a href="#l6.31"></a><span id="l6.31">   {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    *msgHdr = m_cachedHdr;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    NS_IF_ADDREF(*msgHdr);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+    NS_IF_ADDREF(*msgHdr = m_cachedHdr);</span>
<a href="#l6.35"></a><span id="l6.35">   }</span>
<a href="#l6.36"></a><span id="l6.36">   else</span>
<a href="#l6.37"></a><span id="l6.37">   {</span>
<a href="#l6.38"></a><span id="l6.38">     rv = m_db-&gt;GetMsgHdrForKey(key, msgHdr);</span>
<a href="#l6.39"></a><span id="l6.39">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.40"></a><span id="l6.40">     {</span>
<a href="#l6.41"></a><span id="l6.41">       m_cachedHdr = *msgHdr;</span>
<a href="#l6.42"></a><span id="l6.42">       m_cachedMsgKey = key;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineat">@@ -7775,19 +7773,16 @@ NS_IMETHODIMP nsMsgDBView::SelectMsgByKe</span>
<a href="#l6.44"></a><span id="l6.44">   return NS_OK;</span>
<a href="#l6.45"></a><span id="l6.45"> }</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47"> NS_IMETHODIMP</span>
<a href="#l6.48"></a><span id="l6.48"> nsMsgDBView::CloneDBView(nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater, nsIMsgDBView **_retval)</span>
<a href="#l6.49"></a><span id="l6.49"> {</span>
<a href="#l6.50"></a><span id="l6.50">   nsMsgDBView* newMsgDBView = new nsMsgDBView();</span>
<a href="#l6.51"></a><span id="l6.51"> </span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-  if (!newMsgDBView)</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-</span>
<a href="#l6.55"></a><span id="l6.55">   nsresult rv = CopyDBView(newMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l6.56"></a><span id="l6.56">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58">   NS_IF_ADDREF(*_retval = newMsgDBView);</span>
<a href="#l6.59"></a><span id="l6.59">   return NS_OK;</span>
<a href="#l6.60"></a><span id="l6.60"> }</span>
<a href="#l6.61"></a><span id="l6.61"> </span>
<a href="#l6.62"></a><span id="l6.62"> nsresult nsMsgDBView::CopyDBView(nsMsgDBView *aNewMsgDBView, nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater)</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineat">@@ -7958,17 +7953,17 @@ NS_IMETHODIMP nsMsgDBView::nsMsgViewHdrE</span>
<a href="#l6.64"></a><span id="l6.64">   // Ignore dummy header. We won't have empty groups, so</span>
<a href="#l6.65"></a><span id="l6.65">   // we know the view index is good.</span>
<a href="#l6.66"></a><span id="l6.66">   if (m_view-&gt;m_flags[m_curHdrIndex] &amp; MSG_VIEW_FLAG_DUMMY)</span>
<a href="#l6.67"></a><span id="l6.67">     ++m_curHdrIndex;</span>
<a href="#l6.68"></a><span id="l6.68"> </span>
<a href="#l6.69"></a><span id="l6.69">   nsCOMPtr&lt;nsIMsgDBHdr&gt; nextHdr;</span>
<a href="#l6.70"></a><span id="l6.70"> </span>
<a href="#l6.71"></a><span id="l6.71">   nsresult rv = m_view-&gt;GetMsgHdrForViewIndex(m_curHdrIndex++, getter_AddRefs(nextHdr));</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-  NS_IF_ADDREF(*aItem = nextHdr);</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+  nextHdr.forget(aItem);</span>
<a href="#l6.74"></a><span id="l6.74">   return rv;</span>
<a href="#l6.75"></a><span id="l6.75"> }</span>
<a href="#l6.76"></a><span id="l6.76"> </span>
<a href="#l6.77"></a><span id="l6.77"> NS_IMETHODIMP nsMsgDBView::nsMsgViewHdrEnumerator::HasMoreElements(bool *aResult)</span>
<a href="#l6.78"></a><span id="l6.78"> {</span>
<a href="#l6.79"></a><span id="l6.79">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l6.80"></a><span id="l6.80">   *aResult = m_curHdrIndex &lt; m_view-&gt;GetSize();</span>
<a href="#l6.81"></a><span id="l6.81">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCacheElement.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCacheElement.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -33,19 +33,16 @@ NS_IMETHODIMP nsMsgFolderCacheElement::S</span>
<a href="#l7.4"></a><span id="l7.4"> {</span>
<a href="#l7.5"></a><span id="l7.5">   m_folderKey = aFolderKey;</span>
<a href="#l7.6"></a><span id="l7.6">   return NS_OK;</span>
<a href="#l7.7"></a><span id="l7.7"> }</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> void nsMsgFolderCacheElement::SetOwningCache(nsMsgFolderCache *owningCache)</span>
<a href="#l7.10"></a><span id="l7.10"> {</span>
<a href="#l7.11"></a><span id="l7.11">   m_owningCache = owningCache;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  // circular reference, don't do it.</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  //  if (owningCache)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-  //    NS_ADDREF(owningCache);</span>
<a href="#l7.15"></a><span id="l7.15"> }</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> NS_IMETHODIMP nsMsgFolderCacheElement::GetStringProperty(const char *propertyName, nsACString&amp; result)</span>
<a href="#l7.18"></a><span id="l7.18"> {</span>
<a href="#l7.19"></a><span id="l7.19">   NS_ENSURE_ARG_POINTER(propertyName);</span>
<a href="#l7.20"></a><span id="l7.20">   NS_ENSURE_TRUE(m_mdbRow &amp;&amp; m_owningCache, NS_ERROR_FAILURE);</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">   mdb_token property_token;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1086,18 +1086,17 @@ nsMsgFolderDataSource::createServerIsDef</span>
<a href="#l8.4"></a><span id="l8.4">     nsCOMPtr &lt;nsIPop3IncomingServer&gt; pop3Server = do_QueryInterface(incomingServer);</span>
<a href="#l8.5"></a><span id="l8.5">     if (pop3Server)</span>
<a href="#l8.6"></a><span id="l8.6">     {</span>
<a href="#l8.7"></a><span id="l8.7">       nsCString deferredToServer;</span>
<a href="#l8.8"></a><span id="l8.8">       pop3Server-&gt;GetDeferredToAccount(deferredToServer);</span>
<a href="#l8.9"></a><span id="l8.9">       isDeferred = !deferredToServer.IsEmpty();</span>
<a href="#l8.10"></a><span id="l8.10">     }</span>
<a href="#l8.11"></a><span id="l8.11">   }</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  *target = (isDeferred) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  NS_IF_ADDREF(*target = isDeferred ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.15"></a><span id="l8.15">   return NS_OK;</span>
<a href="#l8.16"></a><span id="l8.16"> }</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> nsresult</span>
<a href="#l8.19"></a><span id="l8.19"> nsMsgFolderDataSource::createFolderCanCreateFoldersOnServerNode(nsIMsgFolder* folder,</span>
<a href="#l8.20"></a><span id="l8.20">                                                                  nsIRDFNode **target)</span>
<a href="#l8.21"></a><span id="l8.21"> {</span>
<a href="#l8.22"></a><span id="l8.22">   nsresult rv;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineat">@@ -1105,21 +1104,17 @@ nsMsgFolderDataSource::createFolderCanCr</span>
<a href="#l8.24"></a><span id="l8.24">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l8.25"></a><span id="l8.25">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l8.26"></a><span id="l8.26">   if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">   bool canCreateFoldersOnServer;</span>
<a href="#l8.29"></a><span id="l8.29">   rv = server-&gt;GetCanCreateFoldersOnServer(&amp;canCreateFoldersOnServer);</span>
<a href="#l8.30"></a><span id="l8.30">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-  if (canCreateFoldersOnServer)</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-    *target = kTrueLiteral;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-  else</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-    *target = kFalseLiteral;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  NS_IF_ADDREF(*target = canCreateFoldersOnServer ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">   return NS_OK;</span>
<a href="#l8.40"></a><span id="l8.40"> }</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42"> nsresult</span>
<a href="#l8.43"></a><span id="l8.43"> nsMsgFolderDataSource::createFolderCanFileMessagesOnServerNode(nsIMsgFolder* folder,</span>
<a href="#l8.44"></a><span id="l8.44">                                                                  nsIRDFNode **target)</span>
<a href="#l8.45"></a><span id="l8.45"> {</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineat">@@ -1128,109 +1123,97 @@ nsMsgFolderDataSource::createFolderCanFi</span>
<a href="#l8.47"></a><span id="l8.47">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l8.48"></a><span id="l8.48">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l8.49"></a><span id="l8.49">   if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l8.50"></a><span id="l8.50"> </span>
<a href="#l8.51"></a><span id="l8.51">   bool canFileMessagesOnServer;</span>
<a href="#l8.52"></a><span id="l8.52">   rv = server-&gt;GetCanFileMessagesOnServer(&amp;canFileMessagesOnServer);</span>
<a href="#l8.53"></a><span id="l8.53">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-  *target = (canFileMessagesOnServer) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+  NS_IF_ADDREF(*target = canFileMessagesOnServer ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.58"></a><span id="l8.58"> </span>
<a href="#l8.59"></a><span id="l8.59">   return NS_OK;</span>
<a href="#l8.60"></a><span id="l8.60"> }</span>
<a href="#l8.61"></a><span id="l8.61"> </span>
<a href="#l8.62"></a><span id="l8.62"> </span>
<a href="#l8.63"></a><span id="l8.63"> nsresult</span>
<a href="#l8.64"></a><span id="l8.64"> nsMsgFolderDataSource::createFolderIsServerNode(nsIMsgFolder* folder,</span>
<a href="#l8.65"></a><span id="l8.65">                                                   nsIRDFNode **target)</span>
<a href="#l8.66"></a><span id="l8.66"> {</span>
<a href="#l8.67"></a><span id="l8.67">   nsresult rv;</span>
<a href="#l8.68"></a><span id="l8.68">   bool isServer;</span>
<a href="#l8.69"></a><span id="l8.69">   rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l8.70"></a><span id="l8.70">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.71"></a><span id="l8.71"> </span>
<a href="#l8.72"></a><span id="l8.72">   *target = nullptr;</span>
<a href="#l8.73"></a><span id="l8.73"> </span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-  if (isServer)</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-    *target = kTrueLiteral;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-  else</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-    *target = kFalseLiteral;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+  NS_IF_ADDREF(*target = isServer ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.80"></a><span id="l8.80">   return NS_OK;</span>
<a href="#l8.81"></a><span id="l8.81"> }</span>
<a href="#l8.82"></a><span id="l8.82"> </span>
<a href="#l8.83"></a><span id="l8.83"> nsresult</span>
<a href="#l8.84"></a><span id="l8.84"> nsMsgFolderDataSource::createFolderNoSelectNode(nsIMsgFolder* folder,</span>
<a href="#l8.85"></a><span id="l8.85">                                                   nsIRDFNode **target)</span>
<a href="#l8.86"></a><span id="l8.86"> {</span>
<a href="#l8.87"></a><span id="l8.87">   nsresult rv;</span>
<a href="#l8.88"></a><span id="l8.88">   bool noSelect;</span>
<a href="#l8.89"></a><span id="l8.89">   rv = folder-&gt;GetNoSelect(&amp;noSelect);</span>
<a href="#l8.90"></a><span id="l8.90">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.91"></a><span id="l8.91"> </span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-  *target = (noSelect) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+  NS_IF_ADDREF(*target = noSelect ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.95"></a><span id="l8.95">   return NS_OK;</span>
<a href="#l8.96"></a><span id="l8.96"> }</span>
<a href="#l8.97"></a><span id="l8.97"> </span>
<a href="#l8.98"></a><span id="l8.98"> nsresult</span>
<a href="#l8.99"></a><span id="l8.99"> nsMsgFolderDataSource::createInVFEditSearchScopeNode(nsIMsgFolder* folder,</span>
<a href="#l8.100"></a><span id="l8.100">                                                   nsIRDFNode **target)</span>
<a href="#l8.101"></a><span id="l8.101"> {</span>
<a href="#l8.102"></a><span id="l8.102">   bool inVFEditSearchScope = false;</span>
<a href="#l8.103"></a><span id="l8.103">   folder-&gt;GetInVFEditSearchScope(&amp;inVFEditSearchScope);</span>
<a href="#l8.104"></a><span id="l8.104"> </span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-  *target = inVFEditSearchScope ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+  NS_IF_ADDREF(*target = inVFEditSearchScope ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.108"></a><span id="l8.108">   return NS_OK;</span>
<a href="#l8.109"></a><span id="l8.109"> }</span>
<a href="#l8.110"></a><span id="l8.110"> </span>
<a href="#l8.111"></a><span id="l8.111"> nsresult</span>
<a href="#l8.112"></a><span id="l8.112"> nsMsgFolderDataSource::createFolderVirtualNode(nsIMsgFolder* folder,</span>
<a href="#l8.113"></a><span id="l8.113">                                                   nsIRDFNode **target)</span>
<a href="#l8.114"></a><span id="l8.114"> {</span>
<a href="#l8.115"></a><span id="l8.115">   uint32_t folderFlags;</span>
<a href="#l8.116"></a><span id="l8.116">   folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l8.117"></a><span id="l8.117"> </span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-  *target = (folderFlags &amp; nsMsgFolderFlags::Virtual) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+  NS_IF_ADDREF(*target = (folderFlags &amp; nsMsgFolderFlags::Virtual) ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.121"></a><span id="l8.121">   return NS_OK;</span>
<a href="#l8.122"></a><span id="l8.122"> }</span>
<a href="#l8.123"></a><span id="l8.123"> </span>
<a href="#l8.124"></a><span id="l8.124"> </span>
<a href="#l8.125"></a><span id="l8.125"> nsresult</span>
<a href="#l8.126"></a><span id="l8.126"> nsMsgFolderDataSource::createFolderImapSharedNode(nsIMsgFolder* folder,</span>
<a href="#l8.127"></a><span id="l8.127">                                                   nsIRDFNode **target)</span>
<a href="#l8.128"></a><span id="l8.128"> {</span>
<a href="#l8.129"></a><span id="l8.129">   nsresult rv;</span>
<a href="#l8.130"></a><span id="l8.130">   bool imapShared;</span>
<a href="#l8.131"></a><span id="l8.131">   rv = folder-&gt;GetImapShared(&amp;imapShared);</span>
<a href="#l8.132"></a><span id="l8.132">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.133"></a><span id="l8.133"> </span>
<a href="#l8.134"></a><span id="l8.134" class="difflineminus">-  *target = (imapShared) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineplus">+  NS_IF_ADDREF(*target = imapShared ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.137"></a><span id="l8.137">   return NS_OK;</span>
<a href="#l8.138"></a><span id="l8.138"> }</span>
<a href="#l8.139"></a><span id="l8.139"> </span>
<a href="#l8.140"></a><span id="l8.140"> </span>
<a href="#l8.141"></a><span id="l8.141"> nsresult</span>
<a href="#l8.142"></a><span id="l8.142"> nsMsgFolderDataSource::createFolderSynchronizeNode(nsIMsgFolder* folder,</span>
<a href="#l8.143"></a><span id="l8.143">                                                   nsIRDFNode **target)</span>
<a href="#l8.144"></a><span id="l8.144"> {</span>
<a href="#l8.145"></a><span id="l8.145">   nsresult rv;</span>
<a href="#l8.146"></a><span id="l8.146">   bool sync;</span>
<a href="#l8.147"></a><span id="l8.147">   rv = folder-&gt;GetFlag(nsMsgFolderFlags::Offline, &amp;sync);</span>
<a href="#l8.148"></a><span id="l8.148">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.149"></a><span id="l8.149"> </span>
<a href="#l8.150"></a><span id="l8.150" class="difflineminus">-  *target = nullptr;</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineminus">-</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineminus">-  *target = (sync) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineplus">+  NS_IF_ADDREF(*target = sync ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.155"></a><span id="l8.155">   return NS_OK;</span>
<a href="#l8.156"></a><span id="l8.156"> }</span>
<a href="#l8.157"></a><span id="l8.157"> </span>
<a href="#l8.158"></a><span id="l8.158"> nsresult</span>
<a href="#l8.159"></a><span id="l8.159"> nsMsgFolderDataSource::createFolderSyncDisabledNode(nsIMsgFolder* folder,</span>
<a href="#l8.160"></a><span id="l8.160">                                                   nsIRDFNode **target)</span>
<a href="#l8.161"></a><span id="l8.161"> {</span>
<a href="#l8.162"></a><span id="l8.162"> </span>
<a href="#l8.163"></a><span id="l8.163" class="difflineat">@@ -1243,19 +1226,20 @@ nsMsgFolderDataSource::createFolderSyncD</span>
<a href="#l8.164"></a><span id="l8.164"> </span>
<a href="#l8.165"></a><span id="l8.165">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l8.166"></a><span id="l8.166">   if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l8.167"></a><span id="l8.167"> </span>
<a href="#l8.168"></a><span id="l8.168">   nsCString serverType;</span>
<a href="#l8.169"></a><span id="l8.169">   rv = server-&gt;GetType(serverType);</span>
<a href="#l8.170"></a><span id="l8.170">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.171"></a><span id="l8.171"> </span>
<a href="#l8.172"></a><span id="l8.172" class="difflineminus">-  *target = isServer || MsgLowerCaseEqualsLiteral(serverType, &quot;none&quot;) || MsgLowerCaseEqualsLiteral(serverType, &quot;pop3&quot;) ?</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineminus">-            kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineplus">+  NS_IF_ADDREF(*target = (isServer || MsgLowerCaseEqualsLiteral(serverType, &quot;none&quot;) ||</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineplus">+                                      MsgLowerCaseEqualsLiteral(serverType, &quot;pop3&quot;)) ?</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineplus">+              kTrueLiteral : kFalseLiteral</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+  );</span>
<a href="#l8.179"></a><span id="l8.179">   return NS_OK;</span>
<a href="#l8.180"></a><span id="l8.180"> }</span>
<a href="#l8.181"></a><span id="l8.181"> </span>
<a href="#l8.182"></a><span id="l8.182"> nsresult</span>
<a href="#l8.183"></a><span id="l8.183"> nsMsgFolderDataSource::createCanSearchMessages(nsIMsgFolder* folder,</span>
<a href="#l8.184"></a><span id="l8.184">                                                                  nsIRDFNode **target)</span>
<a href="#l8.185"></a><span id="l8.185"> {</span>
<a href="#l8.186"></a><span id="l8.186">   nsresult rv;</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineat">@@ -1263,18 +1247,17 @@ nsMsgFolderDataSource::createCanSearchMe</span>
<a href="#l8.188"></a><span id="l8.188">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l8.189"></a><span id="l8.189">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l8.190"></a><span id="l8.190">   if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l8.191"></a><span id="l8.191"> </span>
<a href="#l8.192"></a><span id="l8.192">   bool canSearchMessages;</span>
<a href="#l8.193"></a><span id="l8.193">   rv = server-&gt;GetCanSearchMessages(&amp;canSearchMessages);</span>
<a href="#l8.194"></a><span id="l8.194">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.195"></a><span id="l8.195"> </span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-  *target = (canSearchMessages) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineplus">+  NS_IF_ADDREF(*target = canSearchMessages ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.199"></a><span id="l8.199"> </span>
<a href="#l8.200"></a><span id="l8.200">   return NS_OK;</span>
<a href="#l8.201"></a><span id="l8.201"> }</span>
<a href="#l8.202"></a><span id="l8.202"> </span>
<a href="#l8.203"></a><span id="l8.203"> nsresult</span>
<a href="#l8.204"></a><span id="l8.204"> nsMsgFolderDataSource::createFolderOpenNode(nsIMsgFolder *folder, nsIRDFNode **target)</span>
<a href="#l8.205"></a><span id="l8.205"> {</span>
<a href="#l8.206"></a><span id="l8.206">   NS_ENSURE_ARG_POINTER(target);</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineat">@@ -1286,19 +1269,17 @@ nsMsgFolderDataSource::createFolderOpenN</span>
<a href="#l8.208"></a><span id="l8.208">   if (NS_FAILED(rv))</span>
<a href="#l8.209"></a><span id="l8.209">     return NS_RDF_NO_VALUE;</span>
<a href="#l8.210"></a><span id="l8.210"> </span>
<a href="#l8.211"></a><span id="l8.211">   bool closed;</span>
<a href="#l8.212"></a><span id="l8.212">   rv = folder-&gt;GetFlag(nsMsgFolderFlags::Elided, &amp;closed);</span>
<a href="#l8.213"></a><span id="l8.213">   if (NS_FAILED(rv))</span>
<a href="#l8.214"></a><span id="l8.214">     return rv;</span>
<a href="#l8.215"></a><span id="l8.215"> </span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-  *target = (closed) ? kFalseLiteral : kTrueLiteral;</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineminus">-</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+  NS_IF_ADDREF(*target = closed ? kFalseLiteral : kTrueLiteral);</span>
<a href="#l8.220"></a><span id="l8.220">   return NS_OK;</span>
<a href="#l8.221"></a><span id="l8.221"> }</span>
<a href="#l8.222"></a><span id="l8.222"> </span>
<a href="#l8.223"></a><span id="l8.223"> nsresult</span>
<a href="#l8.224"></a><span id="l8.224"> nsMsgFolderDataSource::createFolderIsSecureNode(nsIMsgFolder* folder,</span>
<a href="#l8.225"></a><span id="l8.225">                                                   nsIRDFNode **target)</span>
<a href="#l8.226"></a><span id="l8.226"> {</span>
<a href="#l8.227"></a><span id="l8.227">   nsresult rv;</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineat">@@ -1307,101 +1288,94 @@ nsMsgFolderDataSource::createFolderIsSec</span>
<a href="#l8.229"></a><span id="l8.229">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l8.230"></a><span id="l8.230">   rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l8.231"></a><span id="l8.231"> </span>
<a href="#l8.232"></a><span id="l8.232">   if (NS_SUCCEEDED(rv) &amp;&amp; server) {</span>
<a href="#l8.233"></a><span id="l8.233">     rv = server-&gt;GetIsSecure(&amp;isSecure);</span>
<a href="#l8.234"></a><span id="l8.234">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.235"></a><span id="l8.235">   }</span>
<a href="#l8.236"></a><span id="l8.236"> </span>
<a href="#l8.237"></a><span id="l8.237" class="difflineminus">-  *target = (isSecure) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.238"></a><span id="l8.238" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineplus">+  NS_IF_ADDREF(*target = isSecure ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.240"></a><span id="l8.240">   return NS_OK;</span>
<a href="#l8.241"></a><span id="l8.241"> }</span>
<a href="#l8.242"></a><span id="l8.242"> </span>
<a href="#l8.243"></a><span id="l8.243"> </span>
<a href="#l8.244"></a><span id="l8.244"> nsresult</span>
<a href="#l8.245"></a><span id="l8.245"> nsMsgFolderDataSource::createFolderCanSubscribeNode(nsIMsgFolder* folder,</span>
<a href="#l8.246"></a><span id="l8.246">                                                   nsIRDFNode **target)</span>
<a href="#l8.247"></a><span id="l8.247"> {</span>
<a href="#l8.248"></a><span id="l8.248">   nsresult rv;</span>
<a href="#l8.249"></a><span id="l8.249">   bool canSubscribe;</span>
<a href="#l8.250"></a><span id="l8.250">   rv = folder-&gt;GetCanSubscribe(&amp;canSubscribe);</span>
<a href="#l8.251"></a><span id="l8.251">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.252"></a><span id="l8.252"> </span>
<a href="#l8.253"></a><span id="l8.253" class="difflineminus">-  *target = (canSubscribe) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.255"></a><span id="l8.255" class="difflineplus">+  NS_IF_ADDREF(*target = canSubscribe ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.256"></a><span id="l8.256">   return NS_OK;</span>
<a href="#l8.257"></a><span id="l8.257"> }</span>
<a href="#l8.258"></a><span id="l8.258"> </span>
<a href="#l8.259"></a><span id="l8.259"> nsresult</span>
<a href="#l8.260"></a><span id="l8.260"> nsMsgFolderDataSource::createFolderSupportsOfflineNode(nsIMsgFolder* folder,</span>
<a href="#l8.261"></a><span id="l8.261">                                                   nsIRDFNode **target)</span>
<a href="#l8.262"></a><span id="l8.262"> {</span>
<a href="#l8.263"></a><span id="l8.263">   nsresult rv;</span>
<a href="#l8.264"></a><span id="l8.264">   bool supportsOffline;</span>
<a href="#l8.265"></a><span id="l8.265">   rv = folder-&gt;GetSupportsOffline(&amp;supportsOffline);</span>
<a href="#l8.266"></a><span id="l8.266">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l8.267"></a><span id="l8.267"> </span>
<a href="#l8.268"></a><span id="l8.268" class="difflineminus">-  *target = (supportsOffline) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.269"></a><span id="l8.269" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.270"></a><span id="l8.270" class="difflineplus">+  NS_IF_ADDREF(*target = supportsOffline ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.271"></a><span id="l8.271">   return NS_OK;</span>
<a href="#l8.272"></a><span id="l8.272"> }</span>
<a href="#l8.273"></a><span id="l8.273"> </span>
<a href="#l8.274"></a><span id="l8.274"> nsresult</span>
<a href="#l8.275"></a><span id="l8.275"> nsMsgFolderDataSource::createFolderCanFileMessagesNode(nsIMsgFolder* folder,</span>
<a href="#l8.276"></a><span id="l8.276">                                                   nsIRDFNode **target)</span>
<a href="#l8.277"></a><span id="l8.277"> {</span>
<a href="#l8.278"></a><span id="l8.278">   nsresult rv;</span>
<a href="#l8.279"></a><span id="l8.279">   bool canFileMessages;</span>
<a href="#l8.280"></a><span id="l8.280">   rv = folder-&gt;GetCanFileMessages(&amp;canFileMessages);</span>
<a href="#l8.281"></a><span id="l8.281">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.282"></a><span id="l8.282"> </span>
<a href="#l8.283"></a><span id="l8.283" class="difflineminus">-  *target = (canFileMessages) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.284"></a><span id="l8.284" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.285"></a><span id="l8.285" class="difflineplus">+  NS_IF_ADDREF(*target = canFileMessages ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.286"></a><span id="l8.286">   return NS_OK;</span>
<a href="#l8.287"></a><span id="l8.287"> }</span>
<a href="#l8.288"></a><span id="l8.288"> </span>
<a href="#l8.289"></a><span id="l8.289"> nsresult</span>
<a href="#l8.290"></a><span id="l8.290"> nsMsgFolderDataSource::createFolderCanCreateSubfoldersNode(nsIMsgFolder* folder,</span>
<a href="#l8.291"></a><span id="l8.291">                                                   nsIRDFNode **target)</span>
<a href="#l8.292"></a><span id="l8.292"> {</span>
<a href="#l8.293"></a><span id="l8.293">   nsresult rv;</span>
<a href="#l8.294"></a><span id="l8.294">   bool canCreateSubfolders;</span>
<a href="#l8.295"></a><span id="l8.295">   rv = folder-&gt;GetCanCreateSubfolders(&amp;canCreateSubfolders);</span>
<a href="#l8.296"></a><span id="l8.296">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.297"></a><span id="l8.297"> </span>
<a href="#l8.298"></a><span id="l8.298" class="difflineminus">-  *target = (canCreateSubfolders) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.299"></a><span id="l8.299" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.300"></a><span id="l8.300" class="difflineplus">+  NS_IF_ADDREF(*target = canCreateSubfolders ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.301"></a><span id="l8.301">   return NS_OK;</span>
<a href="#l8.302"></a><span id="l8.302"> }</span>
<a href="#l8.303"></a><span id="l8.303"> </span>
<a href="#l8.304"></a><span id="l8.304"> nsresult</span>
<a href="#l8.305"></a><span id="l8.305"> nsMsgFolderDataSource::createFolderCanRenameNode(nsIMsgFolder* folder,</span>
<a href="#l8.306"></a><span id="l8.306">                                                   nsIRDFNode **target)</span>
<a href="#l8.307"></a><span id="l8.307"> {</span>
<a href="#l8.308"></a><span id="l8.308">   bool canRename;</span>
<a href="#l8.309"></a><span id="l8.309">   nsresult rv = folder-&gt;GetCanRename(&amp;canRename);</span>
<a href="#l8.310"></a><span id="l8.310">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.311"></a><span id="l8.311"> </span>
<a href="#l8.312"></a><span id="l8.312" class="difflineminus">-  *target = (canRename) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.313"></a><span id="l8.313" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.314"></a><span id="l8.314" class="difflineplus">+  NS_IF_ADDREF(*target = canRename ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.315"></a><span id="l8.315">   return NS_OK;</span>
<a href="#l8.316"></a><span id="l8.316"> }</span>
<a href="#l8.317"></a><span id="l8.317"> </span>
<a href="#l8.318"></a><span id="l8.318"> nsresult</span>
<a href="#l8.319"></a><span id="l8.319"> nsMsgFolderDataSource::createFolderCanCompactNode(nsIMsgFolder* folder,</span>
<a href="#l8.320"></a><span id="l8.320">                                                   nsIRDFNode **target)</span>
<a href="#l8.321"></a><span id="l8.321"> {</span>
<a href="#l8.322"></a><span id="l8.322">   bool canCompact;</span>
<a href="#l8.323"></a><span id="l8.323">   nsresult rv = folder-&gt;GetCanCompact(&amp;canCompact);</span>
<a href="#l8.324"></a><span id="l8.324">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.325"></a><span id="l8.325"> </span>
<a href="#l8.326"></a><span id="l8.326" class="difflineminus">-  *target = (canCompact) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l8.328"></a><span id="l8.328" class="difflineplus">+  NS_IF_ADDREF(*target = canCompact ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l8.329"></a><span id="l8.329">   return NS_OK;</span>
<a href="#l8.330"></a><span id="l8.330"> }</span>
<a href="#l8.331"></a><span id="l8.331"> </span>
<a href="#l8.332"></a><span id="l8.332"> </span>
<a href="#l8.333"></a><span id="l8.333"> nsresult</span>
<a href="#l8.334"></a><span id="l8.334"> nsMsgFolderDataSource::createTotalMessagesNode(nsIMsgFolder *folder,</span>
<a href="#l8.335"></a><span id="l8.335">                                                nsIRDFNode **target)</span>
<a href="#l8.336"></a><span id="l8.336"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -553,18 +553,17 @@ NS_IMETHODIMP nsMsgGroupThreadEnumerator</span>
<a href="#l9.4"></a><span id="l9.4">   if (mNeedToPrefetch)</span>
<a href="#l9.5"></a><span id="l9.5">     Prefetch();</span>
<a href="#l9.6"></a><span id="l9.6">   *aResult = !mDone;</span>
<a href="#l9.7"></a><span id="l9.7">   return NS_OK;</span>
<a href="#l9.8"></a><span id="l9.8"> }</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> NS_IMETHODIMP nsMsgGroupThread::EnumerateMessages(nsMsgKey parentKey, nsISimpleEnumerator* *result)</span>
<a href="#l9.11"></a><span id="l9.11"> {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  nsMsgGroupThreadEnumerator* e = new nsMsgGroupThreadEnumerator(this, parentKey, nullptr, nullptr);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  NS_ADDREF(*result = e);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  NS_ADDREF(*result = new nsMsgGroupThreadEnumerator(this, parentKey, nullptr, nullptr));</span>
<a href="#l9.15"></a><span id="l9.15">   return NS_OK;</span>
<a href="#l9.16"></a><span id="l9.16"> }</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> #if 0</span>
<a href="#l9.19"></a><span id="l9.19"> nsresult nsMsgGroupThread::ReparentMsgsWithInvalidParent(uint32_t numChildren, nsMsgKey threadParentKey)</span>
<a href="#l9.20"></a><span id="l9.20"> {</span>
<a href="#l9.21"></a><span id="l9.21">   nsresult ret = NS_OK;</span>
<a href="#l9.22"></a><span id="l9.22">   // run through looking for messages that don't have a correct parent,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -483,17 +483,17 @@ nsMsgMailSession::GetDataFilesDir(const </span>
<a href="#l10.4"></a><span id="l10.4">                              NS_GET_IID(nsIFile),</span>
<a href="#l10.5"></a><span id="l10.5">                              getter_AddRefs(defaultsDir));</span>
<a href="#l10.6"></a><span id="l10.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">   rv = defaultsDir-&gt;AppendNative(nsDependentCString(dirName));</span>
<a href="#l10.9"></a><span id="l10.9">   if (NS_SUCCEEDED(rv))</span>
<a href="#l10.10"></a><span id="l10.10">     rv = GetSelectedLocaleDataDir(defaultsDir);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  NS_IF_ADDREF(*dataFilesDir = defaultsDir);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  defaultsDir.forget(dataFilesDir);</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">   return rv;</span>
<a href="#l10.16"></a><span id="l10.16"> }</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> /********************************************************************************/</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> NS_IMPL_ISUPPORTS(nsMsgShutdownService, nsIMsgShutdownService, nsIUrlListener, nsIObserver)</span>
<a href="#l10.21"></a><span id="l10.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgOfflineManager.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -50,18 +50,17 @@ nsMsgOfflineManager::nsMsgOfflineManager</span>
<a href="#l11.4"></a><span id="l11.4"> nsMsgOfflineManager::~nsMsgOfflineManager()</span>
<a href="#l11.5"></a><span id="l11.5"> {</span>
<a href="#l11.6"></a><span id="l11.6"> }</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> /* attribute nsIMsgWindow window; */</span>
<a href="#l11.9"></a><span id="l11.9"> NS_IMETHODIMP nsMsgOfflineManager::GetWindow(nsIMsgWindow * *aWindow)</span>
<a href="#l11.10"></a><span id="l11.10"> {</span>
<a href="#l11.11"></a><span id="l11.11">   NS_ENSURE_ARG(aWindow);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  *aWindow = m_window;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  NS_IF_ADDREF(*aWindow);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  NS_IF_ADDREF(*aWindow = m_window);</span>
<a href="#l11.15"></a><span id="l11.15">   return NS_OK;</span>
<a href="#l11.16"></a><span id="l11.16"> }</span>
<a href="#l11.17"></a><span id="l11.17"> NS_IMETHODIMP nsMsgOfflineManager::SetWindow(nsIMsgWindow * aWindow)</span>
<a href="#l11.18"></a><span id="l11.18"> {</span>
<a href="#l11.19"></a><span id="l11.19">   m_window = aWindow;</span>
<a href="#l11.20"></a><span id="l11.20">   if (m_window)</span>
<a href="#l11.21"></a><span id="l11.21">     m_window-&gt;GetStatusFeedback(getter_AddRefs(m_statusFeedback));</span>
<a href="#l11.22"></a><span id="l11.22">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -44,20 +44,16 @@ NS_IMETHODIMP nsMsgQuickSearchDBView::Op</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> NS_IMETHODIMP</span>
<a href="#l12.6"></a><span id="l12.6"> nsMsgQuickSearchDBView::CloneDBView(nsIMessenger *aMessengerInstance,</span>
<a href="#l12.7"></a><span id="l12.7">                                     nsIMsgWindow *aMsgWindow,</span>
<a href="#l12.8"></a><span id="l12.8">                                     nsIMsgDBViewCommandUpdater *aCmdUpdater,</span>
<a href="#l12.9"></a><span id="l12.9">                                     nsIMsgDBView **_retval)</span>
<a href="#l12.10"></a><span id="l12.10"> {</span>
<a href="#l12.11"></a><span id="l12.11">   nsMsgQuickSearchDBView* newMsgDBView = new nsMsgQuickSearchDBView();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  if (!newMsgDBView)</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-</span>
<a href="#l12.16"></a><span id="l12.16">   nsresult rv = CopyDBView(newMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l12.17"></a><span id="l12.17">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">   NS_IF_ADDREF(*_retval = newMsgDBView);</span>
<a href="#l12.20"></a><span id="l12.20">   return NS_OK;</span>
<a href="#l12.21"></a><span id="l12.21"> }</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> NS_IMETHODIMP</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineat">@@ -426,22 +422,22 @@ nsresult nsMsgQuickSearchDBView::GetFirs</span>
<a href="#l12.25"></a><span id="l12.25">   nsCOMPtr&lt;nsIMsgDBHdr&gt; rootParent;</span>
<a href="#l12.26"></a><span id="l12.26">   int32_t rootIndex;</span>
<a href="#l12.27"></a><span id="l12.27">   threadHdr-&gt;GetRootHdr(&amp;rootIndex, getter_AddRefs(rootParent));</span>
<a href="#l12.28"></a><span id="l12.28">   if (rootParent)</span>
<a href="#l12.29"></a><span id="l12.29">     rootParent-&gt;GetMessageKey(&amp;threadRootKey);</span>
<a href="#l12.30"></a><span id="l12.30">   else</span>
<a href="#l12.31"></a><span id="l12.31">     threadHdr-&gt;GetThreadKey(&amp;threadRootKey);</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  nsCOMPtr &lt;nsIMsgDBHdr&gt; retHdr;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  nsCOMPtr&lt;nsIMsgDBHdr&gt; retHdr;</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36">   // iterate over thread, finding mgsHdr in view with the lowest level.</span>
<a href="#l12.37"></a><span id="l12.37">   for (uint32_t childIndex = 0; childIndex &lt; numChildren; childIndex++)</span>
<a href="#l12.38"></a><span id="l12.38">   {</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-    nsCOMPtr &lt;nsIMsgDBHdr&gt; child;</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+    nsCOMPtr&lt;nsIMsgDBHdr&gt; child;</span>
<a href="#l12.41"></a><span id="l12.41">     rv = threadHdr-&gt;GetChildHdrAt(childIndex, getter_AddRefs(child));</span>
<a href="#l12.42"></a><span id="l12.42">     if (NS_SUCCEEDED(rv) &amp;&amp; child)</span>
<a href="#l12.43"></a><span id="l12.43">     {</span>
<a href="#l12.44"></a><span id="l12.44">       nsMsgKey msgKey;</span>
<a href="#l12.45"></a><span id="l12.45">       child-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47">       // this works because we've already sorted m_keys by id.</span>
<a href="#l12.48"></a><span id="l12.48">       nsMsgViewIndex keyIndex = m_origKeys.BinaryIndexOf(msgKey);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineat">@@ -477,17 +473,17 @@ nsresult nsMsgQuickSearchDBView::GetFirs</span>
<a href="#l12.50"></a><span id="l12.50">         if (level &lt; minLevel)</span>
<a href="#l12.51"></a><span id="l12.51">         {</span>
<a href="#l12.52"></a><span id="l12.52">           minLevel = level;</span>
<a href="#l12.53"></a><span id="l12.53">           retHdr = child;</span>
<a href="#l12.54"></a><span id="l12.54">         }</span>
<a href="#l12.55"></a><span id="l12.55">       }</span>
<a href="#l12.56"></a><span id="l12.56">     }</span>
<a href="#l12.57"></a><span id="l12.57">   }</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-  NS_IF_ADDREF(*result = retHdr);</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+  retHdr.forget(result);</span>
<a href="#l12.60"></a><span id="l12.60">   return NS_OK; </span>
<a href="#l12.61"></a><span id="l12.61"> }</span>
<a href="#l12.62"></a><span id="l12.62"> </span>
<a href="#l12.63"></a><span id="l12.63"> nsresult nsMsgQuickSearchDBView::SortThreads(nsMsgViewSortTypeValue sortType, nsMsgViewSortOrderValue sortOrder)</span>
<a href="#l12.64"></a><span id="l12.64"> {</span>
<a href="#l12.65"></a><span id="l12.65">   // don't need to sort by threads for group view.</span>
<a href="#l12.66"></a><span id="l12.66">   if (m_viewFlags &amp; nsMsgViewFlagsType::kGroupBySort)</span>
<a href="#l12.67"></a><span id="l12.67">     return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFDataSource.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -279,18 +279,17 @@ nsMsgRDFDataSource::Observe(nsISupports </span>
<a href="#l13.4"></a><span id="l13.4"> }</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> NS_IMETHODIMP nsMsgRDFDataSource::GetWindow(nsIMsgWindow * *aWindow)</span>
<a href="#l13.8"></a><span id="l13.8"> {</span>
<a href="#l13.9"></a><span id="l13.9">   if(!aWindow)</span>
<a href="#l13.10"></a><span id="l13.10">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  *aWindow = mWindow;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  NS_IF_ADDREF(*aWindow);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  NS_IF_ADDREF(*aWindow = mWindow);</span>
<a href="#l13.15"></a><span id="l13.15">   return NS_OK;</span>
<a href="#l13.16"></a><span id="l13.16"> }</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18"> NS_IMETHODIMP nsMsgRDFDataSource::SetWindow(nsIMsgWindow * aWindow)</span>
<a href="#l13.19"></a><span id="l13.19"> {</span>
<a href="#l13.20"></a><span id="l13.20">   mWindow = aWindow;</span>
<a href="#l13.21"></a><span id="l13.21">   return NS_OK;</span>
<a href="#l13.22"></a><span id="l13.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgRDFUtils.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgRDFUtils.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -19,46 +19,44 @@ nsresult createNode(const char16_t *str,</span>
<a href="#l14.4"></a><span id="l14.4">   if (str) {</span>
<a href="#l14.5"></a><span id="l14.5">     rv = rdfService-&gt;GetLiteral(str, getter_AddRefs(value));</span>
<a href="#l14.6"></a><span id="l14.6">   } </span>
<a href="#l14.7"></a><span id="l14.7">   else {</span>
<a href="#l14.8"></a><span id="l14.8">     rv = rdfService-&gt;GetLiteral(EmptyString().get(), getter_AddRefs(value));</span>
<a href="#l14.9"></a><span id="l14.9">   }</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    *node = value;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    NS_IF_ADDREF(*node);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+    value.forget(node);</span>
<a href="#l14.15"></a><span id="l14.15">   }</span>
<a href="#l14.16"></a><span id="l14.16">   return rv;</span>
<a href="#l14.17"></a><span id="l14.17"> }</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> nsresult createIntNode(int32_t value, nsIRDFNode **node, nsIRDFService *rdfService)</span>
<a href="#l14.20"></a><span id="l14.20"> {</span>
<a href="#l14.21"></a><span id="l14.21">   *node = nullptr;</span>
<a href="#l14.22"></a><span id="l14.22">   nsresult rv; </span>
<a href="#l14.23"></a><span id="l14.23">   if (!rdfService) return NS_ERROR_NULL_POINTER;  </span>
<a href="#l14.24"></a><span id="l14.24">   nsCOMPtr&lt;nsIRDFInt&gt; num;</span>
<a href="#l14.25"></a><span id="l14.25">   rv = rdfService-&gt;GetIntLiteral(value, getter_AddRefs(num));</span>
<a href="#l14.26"></a><span id="l14.26">   if(NS_SUCCEEDED(rv)) {</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-    *node = num;</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-    NS_IF_ADDREF(*node);</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+    num.forget(node);</span>
<a href="#l14.30"></a><span id="l14.30">   }</span>
<a href="#l14.31"></a><span id="l14.31">   return rv;</span>
<a href="#l14.32"></a><span id="l14.32"> }</span>
<a href="#l14.33"></a><span id="l14.33"> </span>
<a href="#l14.34"></a><span id="l14.34"> nsresult createBlobNode(uint8_t *value, uint32_t &amp;length, nsIRDFNode **node, nsIRDFService *rdfService)</span>
<a href="#l14.35"></a><span id="l14.35"> {</span>
<a href="#l14.36"></a><span id="l14.36">   NS_ENSURE_ARG_POINTER(node);</span>
<a href="#l14.37"></a><span id="l14.37">   NS_ENSURE_ARG_POINTER(rdfService);</span>
<a href="#l14.38"></a><span id="l14.38">   </span>
<a href="#l14.39"></a><span id="l14.39">   *node = nullptr;</span>
<a href="#l14.40"></a><span id="l14.40">   nsCOMPtr&lt;nsIRDFBlob&gt; blob;</span>
<a href="#l14.41"></a><span id="l14.41">   nsresult rv = rdfService-&gt;GetBlobLiteral(value, length, getter_AddRefs(blob));</span>
<a href="#l14.42"></a><span id="l14.42">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-  NS_IF_ADDREF(*node = blob);</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+  blob.forget(node);</span>
<a href="#l14.45"></a><span id="l14.45">   return rv;</span>
<a href="#l14.46"></a><span id="l14.46"> }</span>
<a href="#l14.47"></a><span id="l14.47"> </span>
<a href="#l14.48"></a><span id="l14.48"> nsresult GetTargetHasAssertion(nsIRDFDataSource *dataSource, nsIRDFResource* folderResource,</span>
<a href="#l14.49"></a><span id="l14.49">                                nsIRDFResource *property,bool tv, nsIRDFNode *target,bool* hasAssertion)</span>
<a href="#l14.50"></a><span id="l14.50"> {</span>
<a href="#l14.51"></a><span id="l14.51">   NS_ENSURE_ARG_POINTER(hasAssertion);</span>
<a href="#l14.52"></a><span id="l14.52">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -77,20 +77,16 @@ nsMsgSearchDBView::Open(nsIMsgFolder *fo</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5"> NS_IMETHODIMP</span>
<a href="#l15.6"></a><span id="l15.6"> nsMsgSearchDBView::CloneDBView(nsIMessenger *aMessengerInstance,</span>
<a href="#l15.7"></a><span id="l15.7">                                nsIMsgWindow *aMsgWindow,</span>
<a href="#l15.8"></a><span id="l15.8">                                nsIMsgDBViewCommandUpdater *aCmdUpdater,</span>
<a href="#l15.9"></a><span id="l15.9">                                nsIMsgDBView **_retval)</span>
<a href="#l15.10"></a><span id="l15.10"> {</span>
<a href="#l15.11"></a><span id="l15.11">   nsMsgSearchDBView* newMsgDBView = new nsMsgSearchDBView();</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  if (!newMsgDBView)</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-</span>
<a href="#l15.16"></a><span id="l15.16">   nsresult rv = CopyDBView(newMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l15.17"></a><span id="l15.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   NS_IF_ADDREF(*_retval = newMsgDBView);</span>
<a href="#l15.20"></a><span id="l15.20">   return NS_OK;</span>
<a href="#l15.21"></a><span id="l15.21"> }</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSpecialViews.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSpecialViews.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -68,20 +68,16 @@ nsresult nsMsgThreadsWithUnreadDBView::A</span>
<a href="#l16.4"></a><span id="l16.4">     m_totalUnwantedMessagesInView++;</span>
<a href="#l16.5"></a><span id="l16.5">   return rv;</span>
<a href="#l16.6"></a><span id="l16.6"> }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> NS_IMETHODIMP</span>
<a href="#l16.9"></a><span id="l16.9"> nsMsgThreadsWithUnreadDBView::CloneDBView(nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater, nsIMsgDBView **_retval)</span>
<a href="#l16.10"></a><span id="l16.10"> {</span>
<a href="#l16.11"></a><span id="l16.11">   nsMsgThreadsWithUnreadDBView* newMsgDBView = new nsMsgThreadsWithUnreadDBView();</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  if (!newMsgDBView)</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-</span>
<a href="#l16.16"></a><span id="l16.16">   nsresult rv = CopyDBView(newMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l16.17"></a><span id="l16.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">   NS_IF_ADDREF(*_retval = newMsgDBView);</span>
<a href="#l16.20"></a><span id="l16.20">   return NS_OK;</span>
<a href="#l16.21"></a><span id="l16.21"> }</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23"> NS_IMETHODIMP nsMsgThreadsWithUnreadDBView::GetNumMsgsInView(int32_t *aNumMsgs)</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineat">@@ -153,20 +149,16 @@ nsresult nsMsgWatchedThreadsWithUnreadDB</span>
<a href="#l16.25"></a><span id="l16.25">   m_totalUnwantedMessagesInView++;</span>
<a href="#l16.26"></a><span id="l16.26">   return rv;</span>
<a href="#l16.27"></a><span id="l16.27"> }</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29"> NS_IMETHODIMP</span>
<a href="#l16.30"></a><span id="l16.30"> nsMsgWatchedThreadsWithUnreadDBView::CloneDBView(nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow, nsIMsgDBViewCommandUpdater *aCmdUpdater, nsIMsgDBView **_retval)</span>
<a href="#l16.31"></a><span id="l16.31"> {</span>
<a href="#l16.32"></a><span id="l16.32">   nsMsgWatchedThreadsWithUnreadDBView* newMsgDBView = new nsMsgWatchedThreadsWithUnreadDBView();</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-  if (!newMsgDBView)</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-</span>
<a href="#l16.37"></a><span id="l16.37">   nsresult rv = CopyDBView(newMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l16.38"></a><span id="l16.38">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l16.39"></a><span id="l16.39"> </span>
<a href="#l16.40"></a><span id="l16.40">   NS_IF_ADDREF(*_retval = newMsgDBView);</span>
<a href="#l16.41"></a><span id="l16.41">   return NS_OK;</span>
<a href="#l16.42"></a><span id="l16.42"> }</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -150,23 +150,25 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l17.4"></a><span id="l17.4">         NS_ERROR(&quot;how did we get in the wrong thread?&quot;);</span>
<a href="#l17.5"></a><span id="l17.5">         parent = nullptr;</span>
<a href="#l17.6"></a><span id="l17.6">       }</span>
<a href="#l17.7"></a><span id="l17.7">       break;</span>
<a href="#l17.8"></a><span id="l17.8">     }</span>
<a href="#l17.9"></a><span id="l17.9">   }</span>
<a href="#l17.10"></a><span id="l17.10">   if (parent)</span>
<a href="#l17.11"></a><span id="l17.11">   {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    if (outParent)</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-      NS_ADDREF(*outParent = parent);</span>
<a href="#l17.14"></a><span id="l17.14">     uint32_t parentLevel = m_levels[parentIndex];</span>
<a href="#l17.15"></a><span id="l17.15">     nsMsgKey parentKey;</span>
<a href="#l17.16"></a><span id="l17.16">     parent-&gt;GetMessageKey(&amp;parentKey);</span>
<a href="#l17.17"></a><span id="l17.17">     nsCOMPtr&lt;nsIMsgFolder&gt; parentFolder;</span>
<a href="#l17.18"></a><span id="l17.18">     parent-&gt;GetFolder(getter_AddRefs(parentFolder));</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+    if (outParent)</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+      parent.forget(outParent);</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+</span>
<a href="#l17.23"></a><span id="l17.23">     // iterate over our parents' children until we find one we're older than,</span>
<a href="#l17.24"></a><span id="l17.24">     // and insert ourselves before it, or as the last child. In other words,</span>
<a href="#l17.25"></a><span id="l17.25">     // insert, sorted by date.</span>
<a href="#l17.26"></a><span id="l17.26">     uint32_t msgDate, childDate;</span>
<a href="#l17.27"></a><span id="l17.27">     newHdr-&gt;GetDateInSeconds(&amp;msgDate);</span>
<a href="#l17.28"></a><span id="l17.28">     nsCOMPtr&lt;nsIMsgDBHdr&gt; child;</span>
<a href="#l17.29"></a><span id="l17.29">     nsMsgViewIndex i;</span>
<a href="#l17.30"></a><span id="l17.30">     nsMsgViewIndex insertIndex = m_keys.Length();</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineat">@@ -234,17 +236,17 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l17.32"></a><span id="l17.32">         m_levels[i] = m_levels[1] + 1;</span>
<a href="#l17.33"></a><span id="l17.33">     }</span>
<a href="#l17.34"></a><span id="l17.34">     else</span>
<a href="#l17.35"></a><span id="l17.35">     {</span>
<a href="#l17.36"></a><span id="l17.36">       m_keys.AppendElement(newHdrKey);</span>
<a href="#l17.37"></a><span id="l17.37">       m_levels.AppendElement(1);</span>
<a href="#l17.38"></a><span id="l17.38">       m_folders.AppendObject(newHdrFolder);</span>
<a href="#l17.39"></a><span id="l17.39">       if (outParent)</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-        NS_IF_ADDREF(*outParent = rootHdr);</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+        rootHdr.forget(outParent);</span>
<a href="#l17.42"></a><span id="l17.42">       whereInserted = m_keys.Length() -1;</span>
<a href="#l17.43"></a><span id="l17.43">     }</span>
<a href="#l17.44"></a><span id="l17.44">   }</span>
<a href="#l17.45"></a><span id="l17.45"> </span>
<a href="#l17.46"></a><span id="l17.46">   // ### TODO handle the case where the root header starts </span>
<a href="#l17.47"></a><span id="l17.47">   // with Re, and the new one doesn't, and is earlier. In that</span>
<a href="#l17.48"></a><span id="l17.48">   // case, we want to promote the new header to root.</span>
<a href="#l17.49"></a><span id="l17.49"> </span>
<a href="#l17.50"></a><span id="l17.50" class="difflineat">@@ -461,17 +463,17 @@ NS_IMETHODIMP nsMsgXFViewThread::GetFirs</span>
<a href="#l17.51"></a><span id="l17.51">       </span>
<a href="#l17.52"></a><span id="l17.52">       bool isRead;</span>
<a href="#l17.53"></a><span id="l17.53">       nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l17.54"></a><span id="l17.54">       nsresult rv = m_folders[childIndex]-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l17.55"></a><span id="l17.55">       if (NS_SUCCEEDED(rv))</span>
<a href="#l17.56"></a><span id="l17.56">         rv = db-&gt;IsRead(msgKey, &amp;isRead);</span>
<a href="#l17.57"></a><span id="l17.57">       if (NS_SUCCEEDED(rv) &amp;&amp; !isRead)</span>
<a href="#l17.58"></a><span id="l17.58">       {</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-        NS_ADDREF(*aResult = child);</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+        child.forget(aResult);</span>
<a href="#l17.61"></a><span id="l17.61">         break;</span>
<a href="#l17.62"></a><span id="l17.62">       }</span>
<a href="#l17.63"></a><span id="l17.63">     }</span>
<a href="#l17.64"></a><span id="l17.64">   }</span>
<a href="#l17.65"></a><span id="l17.65">   return rv;</span>
<a href="#l17.66"></a><span id="l17.66"> }</span>
<a href="#l17.67"></a><span id="l17.67"> NS_IMETHODIMP nsMsgXFViewThread::EnumerateMessages(nsMsgKey aParentKey,</span>
<a href="#l17.68"></a><span id="l17.68">                                                    nsISimpleEnumerator **aResult)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -58,20 +58,16 @@ NS_IMETHODIMP nsMsgXFVirtualFolderDBView</span>
<a href="#l18.4"></a><span id="l18.4">   return nsMsgSearchDBView::Close();</span>
<a href="#l18.5"></a><span id="l18.5"> }</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> NS_IMETHODIMP</span>
<a href="#l18.8"></a><span id="l18.8"> nsMsgXFVirtualFolderDBView::CloneDBView(nsIMessenger *aMessengerInstance, nsIMsgWindow *aMsgWindow,</span>
<a href="#l18.9"></a><span id="l18.9">                                         nsIMsgDBViewCommandUpdater *aCmdUpdater, nsIMsgDBView **_retval)</span>
<a href="#l18.10"></a><span id="l18.10"> {</span>
<a href="#l18.11"></a><span id="l18.11">   nsMsgXFVirtualFolderDBView* newMsgDBView = new nsMsgXFVirtualFolderDBView();</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-  if (!newMsgDBView)</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-    return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-</span>
<a href="#l18.16"></a><span id="l18.16">   nsresult rv = CopyDBView(newMsgDBView, aMessengerInstance, aMsgWindow, aCmdUpdater);</span>
<a href="#l18.17"></a><span id="l18.17">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">   NS_IF_ADDREF(*_retval = newMsgDBView);</span>
<a href="#l18.20"></a><span id="l18.20">   return NS_OK;</span>
<a href="#l18.21"></a><span id="l18.21"> }</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribableServer.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -326,20 +326,17 @@ nsSubscribableServer::SetSubscribeListen</span>
<a href="#l19.4"></a><span id="l19.4"> 	mSubscribeListener = aListener;</span>
<a href="#l19.5"></a><span id="l19.5"> 	return NS_OK;</span>
<a href="#l19.6"></a><span id="l19.6"> }</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> NS_IMETHODIMP</span>
<a href="#l19.9"></a><span id="l19.9"> nsSubscribableServer::GetSubscribeListener(nsISubscribeListener **aListener)</span>
<a href="#l19.10"></a><span id="l19.10"> {</span>
<a href="#l19.11"></a><span id="l19.11"> 	if (!aListener) return NS_ERROR_NULL_POINTER;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-	if (mSubscribeListener) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-			*aListener = mSubscribeListener;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-			NS_ADDREF(*aListener);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-	}</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+	NS_IF_ADDREF(*aListener = mSubscribeListener);</span>
<a href="#l19.17"></a><span id="l19.17"> 	return NS_OK;</span>
<a href="#l19.18"></a><span id="l19.18"> }</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20"> NS_IMETHODIMP</span>
<a href="#l19.21"></a><span id="l19.21"> nsSubscribableServer::SubscribeCleanup()</span>
<a href="#l19.22"></a><span id="l19.22"> {</span>
<a href="#l19.23"></a><span id="l19.23"> 	NS_ASSERTION(false,&quot;override this.&quot;);</span>
<a href="#l19.24"></a><span id="l19.24"> 	return NS_ERROR_FAILURE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/src/nsSubscribeDataSource.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/src/nsSubscribeDataSource.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -156,25 +156,25 @@ nsSubscribeDataSource::GetTarget(nsIRDFR</span>
<a href="#l20.4"></a><span id="l20.4">         </span>
<a href="#l20.5"></a><span id="l20.5">         return childResource-&gt;QueryInterface(NS_GET_IID(nsIRDFNode), (void**) target);</span>
<a href="#l20.6"></a><span id="l20.6">     }</span>
<a href="#l20.7"></a><span id="l20.7">     else if (property == kNC_Subscribed.get()) {</span>
<a href="#l20.8"></a><span id="l20.8">         bool isSubscribed;</span>
<a href="#l20.9"></a><span id="l20.9">         rv = server-&gt;IsSubscribed(relativePath, &amp;isSubscribed);</span>
<a href="#l20.10"></a><span id="l20.10">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.11"></a><span id="l20.11">     </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        NS_IF_ADDREF(*target = (isSubscribed ? kTrueLiteral : kFalseLiteral));</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+        NS_IF_ADDREF(*target = isSubscribed ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l20.14"></a><span id="l20.14">         return NS_OK;</span>
<a href="#l20.15"></a><span id="l20.15">     }</span>
<a href="#l20.16"></a><span id="l20.16">     else if (property == kNC_Subscribable.get()) {</span>
<a href="#l20.17"></a><span id="l20.17">         bool isSubscribable;</span>
<a href="#l20.18"></a><span id="l20.18">         rv = server-&gt;IsSubscribable(relativePath, &amp;isSubscribable);</span>
<a href="#l20.19"></a><span id="l20.19">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-        </span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-        NS_IF_ADDREF(*target = (isSubscribable ? kTrueLiteral : kFalseLiteral));</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+        NS_IF_ADDREF(*target = isSubscribable ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l20.24"></a><span id="l20.24">         return NS_OK;</span>
<a href="#l20.25"></a><span id="l20.25">     }</span>
<a href="#l20.26"></a><span id="l20.26">     else if (property == kNC_ServerType.get()) {</span>
<a href="#l20.27"></a><span id="l20.27">         nsCString serverTypeStr;</span>
<a href="#l20.28"></a><span id="l20.28">         rv = GetServerType(server, serverTypeStr);</span>
<a href="#l20.29"></a><span id="l20.29">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31">         nsCOMPtr&lt;nsIRDFLiteral&gt; serverType;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

