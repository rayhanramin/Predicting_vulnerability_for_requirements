<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1335:1e7d1a981aa20f2e28f1d314b280577a38634ac0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1e7d1a981aa20f2e28f1d314b280577a38634ac0" />
<meta property="og:url" content="/comm-central/rev/1e7d1a981aa20f2e28f1d314b280577a38634ac0" />
<meta property="og:description" content="Bug 467965 Improve some of the string interfaces on nsISmtpServer. r/sr=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1e7d1a981aa20f2e28f1d314b280577a38634ac0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1e7d1a981aa20f2e28f1d314b280577a38634ac0">shortlog</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1e7d1a981aa20f2e28f1d314b280577a38634ac0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0">files</a> |
changeset |
<a href="/comm-central/raw-rev/1e7d1a981aa20f2e28f1d314b280577a38634ac0">raw</a>  | <a href="/comm-central/archive/1e7d1a981aa20f2e28f1d314b280577a38634ac0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=467965">Bug 467965</a> Improve some of the string interfaces on nsISmtpServer. r/sr=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 05 Dec 2008 09:28:47 +0000</td></tr>

<tr>
 <td>changeset 1335</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1e7d1a981aa20f2e28f1d314b280577a38634ac0">1e7d1a981aa20f2e28f1d314b280577a38634ac0</a></td>
</tr>



<tr>
<td>parent 1334</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ac75a8511ec8089a4e1ef7c32dd2dbc525894b3a">ac75a8511ec8089a4e1ef7c32dd2dbc525894b3a</a>
</td>
</tr>

<tr>
<td>child 1336</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/89b309ce721c9a8a1308b87227e5d798899a6a23">89b309ce721c9a8a1308b87227e5d798899a6a23</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1e7d1a981aa20f2e28f1d314b280577a38634ac0">1046</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 05 Dec 2008 09:30:36 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1e7d1a981aa2 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1e7d1a981aa20f2e28f1d314b280577a38634ac0">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&newProject=comm-central&newRevision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&newProject=comm-central&newRevision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&newProject=comm-central&newRevision=1e7d1a981aa20f2e28f1d314b280577a38634ac0&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=467965">467965</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=467965">Bug 467965</a> Improve some of the string interfaces on nsISmtpServer. r/sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/public/nsISmtpServer.idl">mailnews/compose/public/nsISmtpServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/public/nsISmtpServer.idl">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/public/nsISmtpServer.idl">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/public/nsISmtpServer.idl">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/public/nsISmtpServer.idl">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/public/nsISmtpServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.h">mailnews/compose/src/nsSmtpProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.h">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.h">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.h">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.h">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraWin32.cpp">mailnews/import/eudora/src/nsEudoraWin32.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraWin32.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraWin32.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraWin32.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraWin32.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/eudora/src/nsEudoraWin32.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/oexpress/nsOESettings.cpp">mailnews/import/oexpress/nsOESettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/oexpress/nsOESettings.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/oexpress/nsOESettings.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/oexpress/nsOESettings.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/oexpress/nsOESettings.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/oexpress/nsOESettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/outlook/src/nsOutlookSettings.cpp">mailnews/import/outlook/src/nsOutlookSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/outlook/src/nsOutlookSettings.cpp">file</a> |
<a href="/comm-central/annotate/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/outlook/src/nsOutlookSettings.cpp">annotate</a> |
<a href="/comm-central/diff/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/outlook/src/nsOutlookSettings.cpp">diff</a> |
<a href="/comm-central/comparison/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/outlook/src/nsOutlookSettings.cpp">comparison</a> |
<a href="/comm-central/log/1e7d1a981aa20f2e28f1d314b280577a38634ac0/mailnews/import/outlook/src/nsOutlookSettings.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/compose/public/nsISmtpServer.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/compose/public/nsISmtpServer.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -43,33 +43,33 @@ interface nsIUrlListener;</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> /**</span>
<a href="#l1.6"></a><span id="l1.6">  * This interface represents a single SMTP Server. A SMTP server instance may be</span>
<a href="#l1.7"></a><span id="l1.7">  * created/obtained from nsIMsgAccountManager.</span>
<a href="#l1.8"></a><span id="l1.8">  *</span>
<a href="#l1.9"></a><span id="l1.9">  * Most of the attributes will set/get preferences from the main preferences</span>
<a href="#l1.10"></a><span id="l1.10">  * file.</span>
<a href="#l1.11"></a><span id="l1.11">  */</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-[scriptable, uuid(71f5d415-094d-4a32-899b-2256c2de6876)]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+[scriptable, uuid(67725a6a-ddab-4fed-97f1-e58105c23c0e)]</span>
<a href="#l1.14"></a><span id="l1.14"> interface nsISmtpServer : nsISupports {</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">   /// A unique identifier for the server.</span>
<a href="#l1.17"></a><span id="l1.17">   attribute string key;</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">   /// A user supplied description for the server.</span>
<a href="#l1.20"></a><span id="l1.20">   attribute AUTF8String description;</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">   /// The server's hostname.</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-  attribute string hostname;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+  attribute ACString hostname;</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   /// The server's port.</span>
<a href="#l1.27"></a><span id="l1.27">   attribute PRInt32 port;</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">   /// The username to access the server with (if required)</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  attribute string username;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+  attribute ACString username;</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">   /**</span>
<a href="#l1.34"></a><span id="l1.34">    * The password to access the server with (if required).</span>
<a href="#l1.35"></a><span id="l1.35">    *</span>
<a href="#l1.36"></a><span id="l1.36">    * @note this is stored within the server instance but not within preferences.</span>
<a href="#l1.37"></a><span id="l1.37">    * It can be specified/saved here to avoid prompting the user constantly for</span>
<a href="#l1.38"></a><span id="l1.38">    * the sending password.</span>
<a href="#l1.39"></a><span id="l1.39">    */</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineat">@@ -106,17 +106,17 @@ interface nsISmtpServer : nsISupports {</span>
<a href="#l1.41"></a><span id="l1.41">    * server. Reflects the value of the mail.smtpserver.*.hello_argument pref.</span>
<a href="#l1.42"></a><span id="l1.42">    * This is mainly useful where ISPs don't bother providing PTR records for</span>
<a href="#l1.43"></a><span id="l1.43">    * their servers and therefore users get an error on sending. See bug 244030</span>
<a href="#l1.44"></a><span id="l1.44">    * for more discussion.</span>
<a href="#l1.45"></a><span id="l1.45">    */</span>
<a href="#l1.46"></a><span id="l1.46">   readonly attribute string helloArgument;</span>
<a href="#l1.47"></a><span id="l1.47"> </span>
<a href="#l1.48"></a><span id="l1.48">   /// Returns the URI of the server (smtp:///)</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-  readonly attribute string serverURI;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+  readonly attribute ACString serverURI;</span>
<a href="#l1.51"></a><span id="l1.51"> </span>
<a href="#l1.52"></a><span id="l1.52">   /**</span>
<a href="#l1.53"></a><span id="l1.53">    * Gets a password for this server, using a UI prompt if necessary.</span>
<a href="#l1.54"></a><span id="l1.54">    *</span>
<a href="#l1.55"></a><span id="l1.55">    * @param promptString  The string to prompt the user with when asking for</span>
<a href="#l1.56"></a><span id="l1.56">    *                      the password.</span>
<a href="#l1.57"></a><span id="l1.57">    * @param promptTitle   The title of the prompt.</span>
<a href="#l1.58"></a><span id="l1.58">    * @param netPrompt     An nsIAuthPrompt instance to use for the password</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineat">@@ -137,17 +137,17 @@ interface nsISmtpServer : nsISupports {</span>
<a href="#l1.60"></a><span id="l1.60">    * @param netPrompt     An nsIAuthPrompt instance to use for the password</span>
<a href="#l1.61"></a><span id="l1.61">    *                      prompt.</span>
<a href="#l1.62"></a><span id="l1.62">    * @param userid        The username to use (may be null if no password was</span>
<a href="#l1.63"></a><span id="l1.63">    *                      obtained).</span>
<a href="#l1.64"></a><span id="l1.64">    * @param password      The password to use (may be empty if no password was</span>
<a href="#l1.65"></a><span id="l1.65">    *                      obtained).</span>
<a href="#l1.66"></a><span id="l1.66">    */  </span>
<a href="#l1.67"></a><span id="l1.67">   void getUsernamePasswordWithUI(in wstring promptString, in wstring promptTitle,</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-                                 in nsIAuthPrompt netPrompt, out string userid,</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+                                 in nsIAuthPrompt netPrompt, out ACString userid,</span>
<a href="#l1.70"></a><span id="l1.70">                                  out ACString password);</span>
<a href="#l1.71"></a><span id="l1.71"> </span>
<a href="#l1.72"></a><span id="l1.72">   /**</span>
<a href="#l1.73"></a><span id="l1.73">    * Calling this will *remove* the saved password for this server from the</span>
<a href="#l1.74"></a><span id="l1.74">    * password manager and from the stored value.</span>
<a href="#l1.75"></a><span id="l1.75">    */</span>
<a href="#l1.76"></a><span id="l1.76">   void forgetPassword();</span>
<a href="#l1.77"></a><span id="l1.77"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3899,17 +3899,17 @@ nsMsgComposeAndSend::FormatStringWithSMT</span>
<a href="#l2.4"></a><span id="l2.4">   nsCOMPtr&lt;nsISmtpService&gt; smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l2.5"></a><span id="l2.5">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">   // Get the smtp hostname and format the string.</span>
<a href="#l2.8"></a><span id="l2.8">   nsCString smtpHostName;</span>
<a href="#l2.9"></a><span id="l2.9">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l2.10"></a><span id="l2.10">   rv = smtpService-&gt;GetSmtpServerByIdentity(mUserIdentity, getter_AddRefs(smtpServer));</span>
<a href="#l2.11"></a><span id="l2.11">   if (NS_SUCCEEDED(rv))</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    smtpServer-&gt;GetHostname(getter_Copies(smtpHostName));</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">   nsAutoString hostStr;</span>
<a href="#l2.16"></a><span id="l2.16">   CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l2.17"></a><span id="l2.17">   const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l2.18"></a><span id="l2.18">   if (NS_SUCCEEDED(rv))</span>
<a href="#l2.19"></a><span id="l2.19">     mComposeBundle-&gt;FormatStringFromID(NS_ERROR_GET_CODE(aMsgId), params, 1, aString);</span>
<a href="#l2.20"></a><span id="l2.20">   return rv;</span>
<a href="#l2.21"></a><span id="l2.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.6"></a><span id="l3.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l3.7"></a><span id="l3.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l3.8"></a><span id="l3.8">  *</span>
<a href="#l3.9"></a><span id="l3.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l3.10"></a><span id="l3.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l3.11"></a><span id="l3.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l3.12"></a><span id="l3.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l3.13"></a><span id="l3.13">  *</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineat">@@ -1041,17 +1041,17 @@ PRInt32 nsSmtpProtocol::AuthLoginRespons</span>
<a href="#l3.15"></a><span id="l3.15">           // if LOGIN enabled, clear it if we failed.</span>
<a href="#l3.16"></a><span id="l3.16">           ClearFlag(SMTP_AUTH_LOGIN_ENABLED);</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18">         // Only forget the password if we've no mechanism left.</span>
<a href="#l3.19"></a><span id="l3.19">         if (!TestFlag(SMTP_AUTH_ANY_ENABLED))</span>
<a href="#l3.20"></a><span id="l3.20">         {</span>
<a href="#l3.21"></a><span id="l3.21">             smtpServer-&gt;ForgetPassword();</span>
<a href="#l3.22"></a><span id="l3.22">             if (m_usernamePrompted)</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-                smtpServer-&gt;SetUsername(&quot;&quot;);</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+              smtpServer-&gt;SetUsername(EmptyCString());</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">             // Let's restore the original auth flags from SendEhloResponse</span>
<a href="#l3.27"></a><span id="l3.27">             // so we can try them again with new password and username</span>
<a href="#l3.28"></a><span id="l3.28">             RestoreAuthFlags();</span>
<a href="#l3.29"></a><span id="l3.29">             // except for gssapi, which doesn't care about the new password.</span>
<a href="#l3.30"></a><span id="l3.30">             ClearFlag(SMTP_AUTH_GSSAPI_ENABLED);</span>
<a href="#l3.31"></a><span id="l3.31">         }</span>
<a href="#l3.32"></a><span id="l3.32"> </span>
<a href="#l3.33"></a><span id="l3.33" class="difflineat">@@ -1072,22 +1072,26 @@ PRInt32 nsSmtpProtocol::AuthGSSAPIFirst(</span>
<a href="#l3.34"></a><span id="l3.34">   nsCAutoString command(&quot;AUTH GSSAPI &quot;);</span>
<a href="#l3.35"></a><span id="l3.35">   nsCAutoString resp;</span>
<a href="#l3.36"></a><span id="l3.36">   nsCAutoString service(&quot;smtp@&quot;);</span>
<a href="#l3.37"></a><span id="l3.37">   nsCString hostName;</span>
<a href="#l3.38"></a><span id="l3.38">   nsCString userName;</span>
<a href="#l3.39"></a><span id="l3.39">   nsresult rv;</span>
<a href="#l3.40"></a><span id="l3.40">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l3.41"></a><span id="l3.41">   rv = m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-  if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-  rv = smtpServer-&gt;GetUsername(getter_Copies(userName));</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-  if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-  rv = smtpServer-&gt;GetHostname(getter_Copies(hostName));</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-  if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+  rv = smtpServer-&gt;GetUsername(userName);</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+  rv = smtpServer-&gt;GetHostname(hostName);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+    return NS_ERROR_FAILURE;</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58">  service.Append(hostName);</span>
<a href="#l3.59"></a><span id="l3.59">   rv = DoGSSAPIStep1(service.get(), userName.get(), resp);</span>
<a href="#l3.60"></a><span id="l3.60">   if (NS_FAILED(rv))</span>
<a href="#l3.61"></a><span id="l3.61">   {</span>
<a href="#l3.62"></a><span id="l3.62">     m_nextState = SMTP_AUTH_PROCESS_STATE;</span>
<a href="#l3.63"></a><span id="l3.63">     ClearFlag(SMTP_AUTH_GSSAPI_ENABLED);</span>
<a href="#l3.64"></a><span id="l3.64">     return 0;</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineat">@@ -1159,20 +1163,20 @@ PRInt32 nsSmtpProtocol::AuthLoginStep1()</span>
<a href="#l3.66"></a><span id="l3.66">   PRInt32 status = 0;</span>
<a href="#l3.67"></a><span id="l3.67">   nsCString username;</span>
<a href="#l3.68"></a><span id="l3.68">   char *base64Str = nsnull;</span>
<a href="#l3.69"></a><span id="l3.69">   nsCAutoString password;</span>
<a href="#l3.70"></a><span id="l3.70">   nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l3.71"></a><span id="l3.71">   rv = m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l3.72"></a><span id="l3.72">   if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l3.73"></a><span id="l3.73"> </span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-  rv = smtpServer-&gt;GetUsername(getter_Copies(username));</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+  rv = smtpServer-&gt;GetUsername(username);</span>
<a href="#l3.76"></a><span id="l3.76">   if (username.IsEmpty())</span>
<a href="#l3.77"></a><span id="l3.77">   {</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-    rv = GetUsernamePassword(getter_Copies(username), password);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    rv = GetUsernamePassword(username, password);</span>
<a href="#l3.80"></a><span id="l3.80">     m_usernamePrompted = PR_TRUE;</span>
<a href="#l3.81"></a><span id="l3.81">     if (username.IsEmpty() || password.IsEmpty())</span>
<a href="#l3.82"></a><span id="l3.82">       return NS_ERROR_SMTP_PASSWORD_UNDEFINED;</span>
<a href="#l3.83"></a><span id="l3.83">   }</span>
<a href="#l3.84"></a><span id="l3.84"> </span>
<a href="#l3.85"></a><span id="l3.85">   GetPassword(password);</span>
<a href="#l3.86"></a><span id="l3.86">   if (password.IsEmpty())</span>
<a href="#l3.87"></a><span id="l3.87">   {</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineat">@@ -1271,17 +1275,17 @@ PRInt32 nsSmtpProtocol::AuthLoginStep2()</span>
<a href="#l3.89"></a><span id="l3.89">           encodedDigest.Append(hexVal);</span>
<a href="#l3.90"></a><span id="l3.90">         }</span>
<a href="#l3.91"></a><span id="l3.91"> </span>
<a href="#l3.92"></a><span id="l3.92">         nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l3.93"></a><span id="l3.93">         rv = m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l3.94"></a><span id="l3.94">         if (NS_FAILED(rv)) return NS_ERROR_FAILURE;</span>
<a href="#l3.95"></a><span id="l3.95"> </span>
<a href="#l3.96"></a><span id="l3.96">         nsCString userName;</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-        rv = smtpServer-&gt;GetUsername(getter_Copies(userName));</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+        rv = smtpServer-&gt;GetUsername(userName);</span>
<a href="#l3.99"></a><span id="l3.99"> </span>
<a href="#l3.100"></a><span id="l3.100">         PR_snprintf(buffer, sizeof(buffer), &quot;%s %s&quot;, userName.get(), encodedDigest.get());</span>
<a href="#l3.101"></a><span id="l3.101">         char *base64Str = PL_Base64Encode(buffer, strlen(buffer), nsnull);</span>
<a href="#l3.102"></a><span id="l3.102">         PR_snprintf(buffer, sizeof(buffer), &quot;%s&quot; CRLF, base64Str);</span>
<a href="#l3.103"></a><span id="l3.103">         NS_Free(base64Str);</span>
<a href="#l3.104"></a><span id="l3.104">       }</span>
<a href="#l3.105"></a><span id="l3.105">       if (NS_FAILED(rv))</span>
<a href="#l3.106"></a><span id="l3.106">         PR_snprintf(buffer, sizeof(buffer), &quot;*&quot; CRLF);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineat">@@ -1887,28 +1891,28 @@ nsSmtpProtocol::GetPassword(nsCString &amp;a</span>
<a href="#l3.108"></a><span id="l3.108">     nsCOMPtr &lt;nsIPrefService&gt; prefs = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l3.109"></a><span id="l3.109">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.110"></a><span id="l3.110"> </span>
<a href="#l3.111"></a><span id="l3.111">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l3.112"></a><span id="l3.112">     rv = prefs-&gt;GetBranch(nsnull, getter_AddRefs(prefBranch));</span>
<a href="#l3.113"></a><span id="l3.113">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.114"></a><span id="l3.114"> </span>
<a href="#l3.115"></a><span id="l3.115">     nsCString username;</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-    rv = smtpServer-&gt;GetUsername(getter_Copies(username));</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+    rv = smtpServer-&gt;GetUsername(username);</span>
<a href="#l3.118"></a><span id="l3.118">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.119"></a><span id="l3.119"> </span>
<a href="#l3.120"></a><span id="l3.120">     NS_ConvertASCIItoUTF16 usernameUTF16(username);</span>
<a href="#l3.121"></a><span id="l3.121">     const PRUnichar *formatStrings[] =</span>
<a href="#l3.122"></a><span id="l3.122">     {</span>
<a href="#l3.123"></a><span id="l3.123">       usernameUTF16.get(),</span>
<a href="#l3.124"></a><span id="l3.124">       nsnull  // this will be overwritten in some cases.</span>
<a href="#l3.125"></a><span id="l3.125">     };</span>
<a href="#l3.126"></a><span id="l3.126"> </span>
<a href="#l3.127"></a><span id="l3.127">     nsCString hostname;</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-    rv = smtpServer-&gt;GetHostname(getter_Copies(hostname));</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+    rv = smtpServer-&gt;GetHostname(hostname);</span>
<a href="#l3.130"></a><span id="l3.130">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.131"></a><span id="l3.131"> </span>
<a href="#l3.132"></a><span id="l3.132">     nsAutoString hostnameUTF16;</span>
<a href="#l3.133"></a><span id="l3.133">     CopyASCIItoUTF16(hostname, hostnameUTF16);</span>
<a href="#l3.134"></a><span id="l3.134">     formatStrings[1] = hostnameUTF16.get();</span>
<a href="#l3.135"></a><span id="l3.135"> </span>
<a href="#l3.136"></a><span id="l3.136">     rv = PromptForPassword(smtpServer, smtpUrl, formatStrings, aPassword);</span>
<a href="#l3.137"></a><span id="l3.137">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineat">@@ -1947,49 +1951,44 @@ nsSmtpProtocol::PromptForPassword(nsISmt</span>
<a href="#l3.139"></a><span id="l3.139"> </span>
<a href="#l3.140"></a><span id="l3.140">   rv = aSmtpServer-&gt;GetPasswordWithUI(passwordPromptString.get(), passwordTitle.get(),</span>
<a href="#l3.141"></a><span id="l3.141">     netPrompt, aPassword);</span>
<a href="#l3.142"></a><span id="l3.142">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.143"></a><span id="l3.143">   return rv;</span>
<a href="#l3.144"></a><span id="l3.144"> }</span>
<a href="#l3.145"></a><span id="l3.145"> </span>
<a href="#l3.146"></a><span id="l3.146"> nsresult</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-nsSmtpProtocol::GetUsernamePassword(char **aUsername, nsACString &amp;aPassword)</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+nsSmtpProtocol::GetUsernamePassword(nsACString &amp;aUsername,</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+                                    nsACString &amp;aPassword)</span>
<a href="#l3.150"></a><span id="l3.150"> {</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aUsername);</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-</span>
<a href="#l3.153"></a><span id="l3.153">     nsresult rv;</span>
<a href="#l3.154"></a><span id="l3.154">     nsCOMPtr&lt;nsISmtpUrl&gt; smtpUrl = do_QueryInterface(m_runningURL, &amp;rv);</span>
<a href="#l3.155"></a><span id="l3.155">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.156"></a><span id="l3.156"> </span>
<a href="#l3.157"></a><span id="l3.157">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l3.158"></a><span id="l3.158">     rv = smtpUrl-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l3.159"></a><span id="l3.159">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.160"></a><span id="l3.160"> </span>
<a href="#l3.161"></a><span id="l3.161">     rv = smtpServer-&gt;GetPassword(aPassword);</span>
<a href="#l3.162"></a><span id="l3.162">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.163"></a><span id="l3.163"> </span>
<a href="#l3.164"></a><span id="l3.164">     if (!aPassword.IsEmpty())</span>
<a href="#l3.165"></a><span id="l3.165">     {</span>
<a href="#l3.166"></a><span id="l3.166">         rv = smtpServer-&gt;GetUsername(aUsername);</span>
<a href="#l3.167"></a><span id="l3.167">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.168"></a><span id="l3.168"> </span>
<a href="#l3.169"></a><span id="l3.169" class="difflineminus">-        if (*aUsername &amp;&amp; **aUsername)</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-            return rv;</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineminus">-</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-        // empty username</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-        NS_Free(*aUsername);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-        *aUsername = 0;</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+        if (!aUsername.IsEmpty())</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+          return rv;</span>
<a href="#l3.177"></a><span id="l3.177">     }</span>
<a href="#l3.178"></a><span id="l3.178">     // empty password</span>
<a href="#l3.179"></a><span id="l3.179"> </span>
<a href="#l3.180"></a><span id="l3.180">     aPassword.Truncate();</span>
<a href="#l3.181"></a><span id="l3.181"> </span>
<a href="#l3.182"></a><span id="l3.182">     nsCString hostname;</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-    rv = smtpServer-&gt;GetHostname(getter_Copies(hostname));</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+    rv = smtpServer-&gt;GetHostname(hostname);</span>
<a href="#l3.185"></a><span id="l3.185">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.186"></a><span id="l3.186"> </span>
<a href="#l3.187"></a><span id="l3.187">     const PRUnichar *formatStrings[] =</span>
<a href="#l3.188"></a><span id="l3.188">     {</span>
<a href="#l3.189"></a><span id="l3.189">       NS_ConvertASCIItoUTF16(hostname).get(),</span>
<a href="#l3.190"></a><span id="l3.190">       nsnull</span>
<a href="#l3.191"></a><span id="l3.191">     };</span>
<a href="#l3.192"></a><span id="l3.192"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -240,17 +240,17 @@ private:</span>
<a href="#l4.4"></a><span id="l4.4">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l4.5"></a><span id="l4.5">     // End of Protocol Methods</span>
<a href="#l4.6"></a><span id="l4.6">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">     PRInt32 SendMessageInFile();</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">     void AppendHelloArgument(nsACString&amp; aResult);</span>
<a href="#l4.11"></a><span id="l4.11">     nsresult GetPassword(nsCString &amp;aPassword);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    nsresult GetUsernamePassword(char **aUsername, nsACString &amp;aPassword);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    nsresult GetUsernamePassword(nsACString &amp;aUsername, nsACString &amp;aPassword);</span>
<a href="#l4.14"></a><span id="l4.14">     nsresult PromptForPassword(nsISmtpServer *aSmtpServer, nsISmtpUrl *aSmtpUrl, </span>
<a href="#l4.15"></a><span id="l4.15">                                const PRUnichar **formatStrings, </span>
<a href="#l4.16"></a><span id="l4.16">                                nsACString &amp;aPassword);</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">     void BackupAuthFlags();</span>
<a href="#l4.19"></a><span id="l4.19">     void RestoreAuthFlags();</span>
<a href="#l4.20"></a><span id="l4.20">     PRInt32 m_origAuthFlags;</span>
<a href="#l4.21"></a><span id="l4.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.7"></a><span id="l5.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.8"></a><span id="l5.8">  *</span>
<a href="#l5.9"></a><span id="l5.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.10"></a><span id="l5.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.11"></a><span id="l5.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l5.12"></a><span id="l5.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l5.13"></a><span id="l5.13">  *</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineat">@@ -111,34 +111,35 @@ nsresult nsSmtpServer::getPrefs()</span>
<a href="#l5.15"></a><span id="l5.15">         if (NS_FAILED(rv))</span>
<a href="#l5.16"></a><span id="l5.16">             return rv;</span>
<a href="#l5.17"></a><span id="l5.17">     }</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">     return NS_OK;</span>
<a href="#l5.20"></a><span id="l5.20"> }</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> NS_IMETHODIMP</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-nsSmtpServer::GetHostname(char * *aHostname)</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+nsSmtpServer::GetHostname(nsACString &amp;aHostname)</span>
<a href="#l5.25"></a><span id="l5.25"> {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-    nsresult rv;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aHostname);</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-    rv = mPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, aHostname);</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-        *aHostname=nsnull;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  nsCString result;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, getter_Copies(result));</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    aHostname.Truncate();</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  else</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+    aHostname = result;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+  return NS_OK;</span>
<a href="#l5.40"></a><span id="l5.40"> }</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42"> NS_IMETHODIMP</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-nsSmtpServer::SetHostname(const char * aHostname)</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+nsSmtpServer::SetHostname(const nsACString &amp;aHostname)</span>
<a href="#l5.45"></a><span id="l5.45"> {</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-    if (aHostname)</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-        return mPrefBranch-&gt;SetCharPref(&quot;hostname&quot;, aHostname);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-    else</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-        mPrefBranch-&gt;ClearUserPref(&quot;hostname&quot;);</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  if (aHostname.IsEmpty())</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+    return mPrefBranch-&gt;ClearUserPref(&quot;hostname&quot;);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+  return mPrefBranch-&gt;SetCharPref(&quot;hostname&quot;, PromiseFlatCString(aHostname).get());</span>
<a href="#l5.55"></a><span id="l5.55"> }</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57"> NS_IMETHODIMP</span>
<a href="#l5.58"></a><span id="l5.58"> nsSmtpServer::GetDescription(nsACString &amp;aDescription)</span>
<a href="#l5.59"></a><span id="l5.59"> {</span>
<a href="#l5.60"></a><span id="l5.60">     nsCString temp;</span>
<a href="#l5.61"></a><span id="l5.61">     mPrefBranch-&gt;GetCharPref(&quot;description&quot;, getter_Copies(temp));</span>
<a href="#l5.62"></a><span id="l5.62">     aDescription.Assign(temp);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineat">@@ -293,34 +294,34 @@ nsSmtpServer::getIntPrefWithDefault(cons</span>
<a href="#l5.64"></a><span id="l5.64"> </span>
<a href="#l5.65"></a><span id="l5.65"> NS_IMETHODIMP</span>
<a href="#l5.66"></a><span id="l5.66"> nsSmtpServer::SetAuthMethod(PRInt32 authMethod)</span>
<a href="#l5.67"></a><span id="l5.67"> {</span>
<a href="#l5.68"></a><span id="l5.68">     return mPrefBranch-&gt;SetIntPref(&quot;auth_method&quot;, authMethod);</span>
<a href="#l5.69"></a><span id="l5.69"> }</span>
<a href="#l5.70"></a><span id="l5.70"> </span>
<a href="#l5.71"></a><span id="l5.71"> NS_IMETHODIMP</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-nsSmtpServer::GetUsername(char * *aUsername)</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+nsSmtpServer::GetUsername(nsACString &amp;aUsername)</span>
<a href="#l5.74"></a><span id="l5.74"> {</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-    nsresult rv;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aUsername);</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-    rv = mPrefBranch-&gt;GetCharPref(&quot;username&quot;, aUsername);</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-        *aUsername = nsnull;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+  nsCString result;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;username&quot;, getter_Copies(result));</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+    aUsername.Truncate();</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+  else</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+    aUsername = result;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+  return NS_OK;</span>
<a href="#l5.88"></a><span id="l5.88"> }</span>
<a href="#l5.89"></a><span id="l5.89"> </span>
<a href="#l5.90"></a><span id="l5.90"> NS_IMETHODIMP</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-nsSmtpServer::SetUsername(const char * aUsername)</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+nsSmtpServer::SetUsername(const nsACString &amp;aUsername)</span>
<a href="#l5.93"></a><span id="l5.93"> {</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-    if (aUsername)</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-        return mPrefBranch-&gt;SetCharPref(&quot;username&quot;, aUsername);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-    else</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-        mPrefBranch-&gt;ClearUserPref(&quot;username&quot;);</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+  if (aUsername.IsEmpty())</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+    return mPrefBranch-&gt;ClearUserPref(&quot;username&quot;);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+  return mPrefBranch-&gt;SetCharPref(&quot;username&quot;, PromiseFlatCString(aUsername).get());</span>
<a href="#l5.103"></a><span id="l5.103"> }</span>
<a href="#l5.104"></a><span id="l5.104"> </span>
<a href="#l5.105"></a><span id="l5.105"> NS_IMETHODIMP</span>
<a href="#l5.106"></a><span id="l5.106"> nsSmtpServer::GetPassword(nsACString&amp; aPassword)</span>
<a href="#l5.107"></a><span id="l5.107"> {</span>
<a href="#l5.108"></a><span id="l5.108">     if (m_password.IsEmpty() &amp;&amp; !m_logonFailed)</span>
<a href="#l5.109"></a><span id="l5.109">     {</span>
<a href="#l5.110"></a><span id="l5.110">       // try to avoid prompting the user for another password. If the user has set</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineat">@@ -355,18 +356,18 @@ nsSmtpServer::GetPassword(nsACString&amp; aP</span>
<a href="#l5.112"></a><span id="l5.112">           nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l5.113"></a><span id="l5.113">           NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.114"></a><span id="l5.114">           prefBranch-&gt;GetBoolPref(&quot;mail.smtp.useMatchingHostNameServer&quot;, &amp;useMatchingHostNameServer);</span>
<a href="#l5.115"></a><span id="l5.115">           prefBranch-&gt;GetBoolPref(&quot;mail.smtp.useMatchingDomainServer&quot;, &amp;useMatchingDomainServer);</span>
<a href="#l5.116"></a><span id="l5.116">           if (useMatchingHostNameServer || useMatchingDomainServer)</span>
<a href="#l5.117"></a><span id="l5.117">           {</span>
<a href="#l5.118"></a><span id="l5.118">             nsCString userName;</span>
<a href="#l5.119"></a><span id="l5.119">             nsCString hostName;</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-            GetHostname(getter_Copies(hostName));</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-            GetUsername(getter_Copies(userName));</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+            GetHostname(hostName);</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+            GetUsername(userName);</span>
<a href="#l5.124"></a><span id="l5.124">             if (useMatchingHostNameServer)</span>
<a href="#l5.125"></a><span id="l5.125">               // pass in empty type and port=0, to match imap and pop3.</span>
<a href="#l5.126"></a><span id="l5.126">               accountManager-&gt;FindRealServer(userName, hostName, EmptyCString(), 0, getter_AddRefs(incomingServerToUse));</span>
<a href="#l5.127"></a><span id="l5.127">             PRInt32 dotPos = -1;</span>
<a href="#l5.128"></a><span id="l5.128">             if (!incomingServerToUse &amp;&amp; useMatchingDomainServer</span>
<a href="#l5.129"></a><span id="l5.129">               &amp;&amp; (dotPos = hostName.FindChar('.')) != kNotFound)</span>
<a href="#l5.130"></a><span id="l5.130">             {</span>
<a href="#l5.131"></a><span id="l5.131">               hostName.Cut(0, dotPos);</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineat">@@ -442,17 +443,17 @@ nsSmtpServer::GetPasswordWithUI(const PR</span>
<a href="#l5.133"></a><span id="l5.133">         NS_ENSURE_ARG_POINTER(aDialog);</span>
<a href="#l5.134"></a><span id="l5.134"> </span>
<a href="#l5.135"></a><span id="l5.135">         // prompt the user for the password</span>
<a href="#l5.136"></a><span id="l5.136">         if (NS_SUCCEEDED(rv))</span>
<a href="#l5.137"></a><span id="l5.137">         {</span>
<a href="#l5.138"></a><span id="l5.138">             nsString uniPassword;</span>
<a href="#l5.139"></a><span id="l5.139">             PRBool okayValue = PR_TRUE;</span>
<a href="#l5.140"></a><span id="l5.140">             nsCString serverUri;</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-            rv = GetServerURI(getter_Copies(serverUri));</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+            rv = GetServerURI(serverUri);</span>
<a href="#l5.143"></a><span id="l5.143">             if (NS_FAILED(rv))</span>
<a href="#l5.144"></a><span id="l5.144">                 return rv;</span>
<a href="#l5.145"></a><span id="l5.145">             nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l5.146"></a><span id="l5.146">             PRBool passwordProtectLocalCache = PR_FALSE;</span>
<a href="#l5.147"></a><span id="l5.147"> </span>
<a href="#l5.148"></a><span id="l5.148">             (void) prefBranch-&gt;GetBoolPref( &quot;mail.password_protect_local_cache&quot;, &amp;passwordProtectLocalCache);</span>
<a href="#l5.149"></a><span id="l5.149"> </span>
<a href="#l5.150"></a><span id="l5.150">             PRUint32 savePasswordType = (passwordProtectLocalCache) ? nsIAuthPrompt::SAVE_PASSWORD_FOR_SESSION : nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY;</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineat">@@ -480,52 +481,51 @@ nsSmtpServer::GetPasswordWithUI(const PR</span>
<a href="#l5.152"></a><span id="l5.152"> </span>
<a href="#l5.153"></a><span id="l5.153">     return GetPassword(aPassword);</span>
<a href="#l5.154"></a><span id="l5.154"> }</span>
<a href="#l5.155"></a><span id="l5.155"> </span>
<a href="#l5.156"></a><span id="l5.156"> NS_IMETHODIMP</span>
<a href="#l5.157"></a><span id="l5.157"> nsSmtpServer::GetUsernamePasswordWithUI(const PRUnichar * aPromptMessage, const</span>
<a href="#l5.158"></a><span id="l5.158">                                 PRUnichar *aPromptTitle,</span>
<a href="#l5.159"></a><span id="l5.159">                                 nsIAuthPrompt* aDialog,</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-                                char **aUsername,</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+                                nsACString &amp;aUsername,</span>
<a href="#l5.162"></a><span id="l5.162">                                 nsACString &amp;aPassword)</span>
<a href="#l5.163"></a><span id="l5.163"> {</span>
<a href="#l5.164"></a><span id="l5.164">     nsresult rv = NS_OK;</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aUsername);</span>
<a href="#l5.166"></a><span id="l5.166"> </span>
<a href="#l5.167"></a><span id="l5.167">     if (m_password.IsEmpty()) {</span>
<a href="#l5.168"></a><span id="l5.168">         NS_ENSURE_ARG_POINTER(aDialog);</span>
<a href="#l5.169"></a><span id="l5.169">         // prompt the user for the password</span>
<a href="#l5.170"></a><span id="l5.170">         if (NS_SUCCEEDED(rv))</span>
<a href="#l5.171"></a><span id="l5.171">         {</span>
<a href="#l5.172"></a><span id="l5.172">             nsString uniUsername;</span>
<a href="#l5.173"></a><span id="l5.173">             nsString uniPassword;</span>
<a href="#l5.174"></a><span id="l5.174">             PRBool okayValue = PR_TRUE;</span>
<a href="#l5.175"></a><span id="l5.175">             nsCString serverUri;</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-            rv = GetServerURI(getter_Copies(serverUri));</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+            rv = GetServerURI(serverUri);</span>
<a href="#l5.178"></a><span id="l5.178">             if (NS_FAILED(rv))</span>
<a href="#l5.179"></a><span id="l5.179">                 return rv;</span>
<a href="#l5.180"></a><span id="l5.180">             rv = aDialog-&gt;PromptUsernameAndPassword(aPromptTitle, aPromptMessage,</span>
<a href="#l5.181"></a><span id="l5.181">                                          NS_ConvertASCIItoUTF16(serverUri).get(), nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l5.182"></a><span id="l5.182">                                          getter_Copies(uniUsername), getter_Copies(uniPassword), &amp;okayValue);</span>
<a href="#l5.183"></a><span id="l5.183">             if (NS_FAILED(rv))</span>
<a href="#l5.184"></a><span id="l5.184">                 return rv;</span>
<a href="#l5.185"></a><span id="l5.185"> </span>
<a href="#l5.186"></a><span id="l5.186">             if (!okayValue) // if the user pressed cancel, just return NULL;</span>
<a href="#l5.187"></a><span id="l5.187">             {</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-                *aUsername = nsnull;</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-                aPassword.Truncate();</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-                return rv;</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineplus">+              aUsername.Truncate();</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineplus">+              aPassword.Truncate();</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineplus">+              return rv;</span>
<a href="#l5.194"></a><span id="l5.194">             }</span>
<a href="#l5.195"></a><span id="l5.195"> </span>
<a href="#l5.196"></a><span id="l5.196">             // we got a userid and password back...so remember it</span>
<a href="#l5.197"></a><span id="l5.197">             nsCString aCStr;</span>
<a href="#l5.198"></a><span id="l5.198"> </span>
<a href="#l5.199"></a><span id="l5.199">             LossyCopyUTF16toASCII(uniUsername, aCStr);</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-            rv = SetUsername(aCStr.get());</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+            rv = SetUsername(aCStr);</span>
<a href="#l5.202"></a><span id="l5.202">             if (NS_FAILED(rv))</span>
<a href="#l5.203"></a><span id="l5.203">                 return rv;</span>
<a href="#l5.204"></a><span id="l5.204"> </span>
<a href="#l5.205"></a><span id="l5.205">             LossyCopyUTF16toASCII(uniPassword, aCStr);</span>
<a href="#l5.206"></a><span id="l5.206">             rv = SetPassword(aCStr);</span>
<a href="#l5.207"></a><span id="l5.207">             if (NS_FAILED(rv))</span>
<a href="#l5.208"></a><span id="l5.208">                 return rv;</span>
<a href="#l5.209"></a><span id="l5.209">         } // if we got a prompt dialog</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineat">@@ -540,17 +540,17 @@ nsSmtpServer::GetUsernamePasswordWithUI(</span>
<a href="#l5.211"></a><span id="l5.211"> NS_IMETHODIMP</span>
<a href="#l5.212"></a><span id="l5.212"> nsSmtpServer::ForgetPassword()</span>
<a href="#l5.213"></a><span id="l5.213"> {</span>
<a href="#l5.214"></a><span id="l5.214">     nsresult rv;</span>
<a href="#l5.215"></a><span id="l5.215">     nsCOMPtr&lt;nsIObserverService&gt; observerService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv);</span>
<a href="#l5.216"></a><span id="l5.216">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.217"></a><span id="l5.217"> </span>
<a href="#l5.218"></a><span id="l5.218">     nsCString serverUri;</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineminus">-    rv = GetServerURI(getter_Copies(serverUri));</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+    rv = GetServerURI(serverUri);</span>
<a href="#l5.221"></a><span id="l5.221">     if (NS_FAILED(rv))</span>
<a href="#l5.222"></a><span id="l5.222">         return rv;</span>
<a href="#l5.223"></a><span id="l5.223"> </span>
<a href="#l5.224"></a><span id="l5.224">     nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l5.225"></a><span id="l5.225">     NS_NewURI(getter_AddRefs(uri), serverUri);</span>
<a href="#l5.226"></a><span id="l5.226"> </span>
<a href="#l5.227"></a><span id="l5.227">     //this is need to make sure wallet service has been created</span>
<a href="#l5.228"></a><span id="l5.228">     rv = CreateServicesForPasswordManager();</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineat">@@ -560,48 +560,47 @@ nsSmtpServer::ForgetPassword()</span>
<a href="#l5.230"></a><span id="l5.230">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.231"></a><span id="l5.231"> </span>
<a href="#l5.232"></a><span id="l5.232">     rv = SetPassword(EmptyCString());</span>
<a href="#l5.233"></a><span id="l5.233">     m_logonFailed = PR_TRUE;</span>
<a href="#l5.234"></a><span id="l5.234">     return rv;</span>
<a href="#l5.235"></a><span id="l5.235"> }</span>
<a href="#l5.236"></a><span id="l5.236"> </span>
<a href="#l5.237"></a><span id="l5.237"> NS_IMETHODIMP</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineminus">-nsSmtpServer::GetServerURI(char **aResult)</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineplus">+nsSmtpServer::GetServerURI(nsACString &amp;aResult)</span>
<a href="#l5.240"></a><span id="l5.240"> {</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l5.242"></a><span id="l5.242">     nsresult rv;</span>
<a href="#l5.243"></a><span id="l5.243">     nsCAutoString uri;</span>
<a href="#l5.244"></a><span id="l5.244"> </span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-    uri += &quot;smtp&quot;;</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-    uri += &quot;://&quot;;</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineplus">+    uri.AssignLiteral(&quot;smtp&quot;);</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineplus">+    uri.AppendLiteral(&quot;://&quot;);</span>
<a href="#l5.249"></a><span id="l5.249"> </span>
<a href="#l5.250"></a><span id="l5.250">     nsCString username;</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineminus">-    rv = GetUsername(getter_Copies(username));</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineplus">+    rv = GetUsername(username);</span>
<a href="#l5.253"></a><span id="l5.253"> </span>
<a href="#l5.254"></a><span id="l5.254">     if (NS_SUCCEEDED(rv) &amp;&amp; !username.IsEmpty()) {</span>
<a href="#l5.255"></a><span id="l5.255">         nsCString escapedUsername;</span>
<a href="#l5.256"></a><span id="l5.256">         MsgEscapeString(username, nsINetUtil::ESCAPE_XALPHAS, escapedUsername);</span>
<a href="#l5.257"></a><span id="l5.257">         // not all servers have a username</span>
<a href="#l5.258"></a><span id="l5.258">         uri.Append(escapedUsername);</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineminus">-        uri += '@';</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+        uri.AppendLiteral(&quot;@&quot;);</span>
<a href="#l5.261"></a><span id="l5.261">     }</span>
<a href="#l5.262"></a><span id="l5.262"> </span>
<a href="#l5.263"></a><span id="l5.263">     nsCString hostname;</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineminus">-    rv = GetHostname(getter_Copies(hostname));</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineplus">+    rv = GetHostname(hostname);</span>
<a href="#l5.266"></a><span id="l5.266"> </span>
<a href="#l5.267"></a><span id="l5.267">     if (NS_SUCCEEDED(rv) &amp;&amp; !hostname.IsEmpty()) {</span>
<a href="#l5.268"></a><span id="l5.268">         nsCString escapedHostname;</span>
<a href="#l5.269"></a><span id="l5.269">         *((char **)getter_Copies(escapedHostname)) =</span>
<a href="#l5.270"></a><span id="l5.270">             nsEscape(hostname.get(), url_Path);</span>
<a href="#l5.271"></a><span id="l5.271">         // not all servers have a hostname</span>
<a href="#l5.272"></a><span id="l5.272">         uri.Append(escapedHostname);</span>
<a href="#l5.273"></a><span id="l5.273">     }</span>
<a href="#l5.274"></a><span id="l5.274"> </span>
<a href="#l5.275"></a><span id="l5.275" class="difflineminus">-    *aResult = ToNewCString(uri);</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+    aResult = uri;</span>
<a href="#l5.277"></a><span id="l5.277">     return NS_OK;</span>
<a href="#l5.278"></a><span id="l5.278"> }</span>
<a href="#l5.279"></a><span id="l5.279"> </span>
<a href="#l5.280"></a><span id="l5.280"> NS_IMETHODIMP</span>
<a href="#l5.281"></a><span id="l5.281"> nsSmtpServer::ClearAllValues()</span>
<a href="#l5.282"></a><span id="l5.282"> {</span>
<a href="#l5.283"></a><span id="l5.283">   return mPrefBranch-&gt;DeleteBranch(&quot;&quot;);</span>
<a href="#l5.284"></a><span id="l5.284"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -173,18 +173,18 @@ nsresult NS_MsgBuildSmtpUrl(nsIFile * aF</span>
<a href="#l6.4"></a><span id="l6.4">   // other stuff from, we need to use default values....</span>
<a href="#l6.5"></a><span id="l6.5">   // ..for testing purposes....</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">     nsCString smtpHostName;</span>
<a href="#l6.8"></a><span id="l6.8">     nsCString smtpUserName;</span>
<a href="#l6.9"></a><span id="l6.9">     PRInt32 smtpPort;</span>
<a href="#l6.10"></a><span id="l6.10">     PRInt32 trySSL;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    aSmtpServer-&gt;GetHostname(getter_Copies(smtpHostName));</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-    aSmtpServer-&gt;GetUsername(getter_Copies(smtpUserName));</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    aSmtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    aSmtpServer-&gt;GetUsername(smtpUserName);</span>
<a href="#l6.16"></a><span id="l6.16">     aSmtpServer-&gt;GetPort(&amp;smtpPort);</span>
<a href="#l6.17"></a><span id="l6.17">     aSmtpServer-&gt;GetTrySSL(&amp;trySSL);</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19">     if (!smtpPort)</span>
<a href="#l6.20"></a><span id="l6.20">       smtpPort = (trySSL == PREF_SECURE_ALWAYS_SMTPS) ? </span>
<a href="#l6.21"></a><span id="l6.21">         nsISmtpUrl::DEFAULT_SMTPS_PORT :  nsISmtpUrl::DEFAULT_SMTP_PORT;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">   nsresult rv;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineat">@@ -772,22 +772,22 @@ nsSmtpService::DeleteSmtpServer(nsISmtpS</span>
<a href="#l6.25"></a><span id="l6.25"> }</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27"> PRBool</span>
<a href="#l6.28"></a><span id="l6.28"> nsSmtpService::findServerByHostname(nsISmtpServer *aServer, void *aData)</span>
<a href="#l6.29"></a><span id="l6.29"> {</span>
<a href="#l6.30"></a><span id="l6.30">   findServerByHostnameEntry *entry = (findServerByHostnameEntry*)aData;</span>
<a href="#l6.31"></a><span id="l6.31"> </span>
<a href="#l6.32"></a><span id="l6.32">   nsCString hostname;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-  nsresult rv = aServer-&gt;GetHostname(getter_Copies(hostname));</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+  nsresult rv = aServer-&gt;GetHostname(hostname);</span>
<a href="#l6.35"></a><span id="l6.35">   if (NS_FAILED(rv))</span>
<a href="#l6.36"></a><span id="l6.36">     return PR_TRUE;</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38">   nsCString username;</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-  rv = aServer-&gt;GetUsername(getter_Copies(username));</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+  rv = aServer-&gt;GetUsername(username);</span>
<a href="#l6.41"></a><span id="l6.41">   if (NS_FAILED(rv))</span>
<a href="#l6.42"></a><span id="l6.42">     return PR_TRUE;</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44">   PRBool checkHostname = !entry-&gt;hostname.IsEmpty();</span>
<a href="#l6.45"></a><span id="l6.45">   PRBool checkUsername = !entry-&gt;username.IsEmpty();</span>
<a href="#l6.46"></a><span id="l6.46">     </span>
<a href="#l6.47"></a><span id="l6.47">   if ((!checkHostname ||</span>
<a href="#l6.48"></a><span id="l6.48">        (entry-&gt;hostname.Equals(hostname, nsCaseInsensitiveCStringComparator())) &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1104,17 +1104,17 @@ NS_IMETHODIMP nsMsgMdnGenerator::OnStopR</span>
<a href="#l7.4"></a><span id="l7.4">     nsCOMPtr&lt;nsISmtpService&gt; smtpService(do_GetService(NS_SMTPSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l7.5"></a><span id="l7.5">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">     // Get the smtp hostname and format the string.</span>
<a href="#l7.8"></a><span id="l7.8">     nsCString smtpHostName;</span>
<a href="#l7.9"></a><span id="l7.9">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l7.10"></a><span id="l7.10">     rv = smtpService-&gt;GetSmtpServerByIdentity(m_identity, getter_AddRefs(smtpServer));</span>
<a href="#l7.11"></a><span id="l7.11">     if (NS_SUCCEEDED(rv)) </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      smtpServer-&gt;GetHostname(getter_Copies(smtpHostName));</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      smtpServer-&gt;GetHostname(smtpHostName);</span>
<a href="#l7.14"></a><span id="l7.14">      </span>
<a href="#l7.15"></a><span id="l7.15">     nsAutoString hostStr;</span>
<a href="#l7.16"></a><span id="l7.16">     CopyASCIItoUTF16(smtpHostName, hostStr);</span>
<a href="#l7.17"></a><span id="l7.17">     const PRUnichar *params[] = { hostStr.get() };</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">     nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l7.20"></a><span id="l7.20">     nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l7.21"></a><span id="l7.21">     NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -919,19 +919,19 @@ void nsEudoraMac::SetSmtpServer( nsIMsgA</span>
<a href="#l8.4"></a><span id="l8.4">       IMPORT_LOG1( &quot;SMTP server already exists: %s\n&quot;, pServer);</span>
<a href="#l8.5"></a><span id="l8.5">       return;</span>
<a href="#l8.6"></a><span id="l8.6">     }</span>
<a href="#l8.7"></a><span id="l8.7">     nsCOMPtr&lt;nsISmtpServer&gt;    smtpServer;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">     rv = smtpService-&gt;CreateSmtpServer( getter_AddRefs( smtpServer));</span>
<a href="#l8.10"></a><span id="l8.10">     if (NS_SUCCEEDED( rv) &amp;&amp; smtpServer)</span>
<a href="#l8.11"></a><span id="l8.11">     {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      smtpServer-&gt;SetHostname( pServer);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      smtpServer-&gt;SetHostname(nsDependentCString(pServer));</span>
<a href="#l8.14"></a><span id="l8.14">       if (pUser)</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-        smtpServer-&gt;SetUsername( pUser);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+        smtpServer-&gt;SetUsername(nsDependentCString(pUser));</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">       IMPORT_LOG1( &quot;Created new SMTP server: %s\n&quot;, pServer);</span>
<a href="#l8.19"></a><span id="l8.19">     }</span>
<a href="#l8.20"></a><span id="l8.20">   }</span>
<a href="#l8.21"></a><span id="l8.21"> }</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24"> nsresult nsEudoraMac::GetAttachmentInfo( const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachment)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1024,19 +1024,19 @@ void nsEudoraWin32::SetSmtpServer( nsIMs</span>
<a href="#l9.4"></a><span id="l9.4">       IMPORT_LOG1( &quot;SMTP server already exists: %s\n&quot;, pServer);</span>
<a href="#l9.5"></a><span id="l9.5">       return;</span>
<a href="#l9.6"></a><span id="l9.6">     }</span>
<a href="#l9.7"></a><span id="l9.7">     nsCOMPtr&lt;nsISmtpServer&gt;    smtpServer;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">     rv = smtpService-&gt;CreateSmtpServer( getter_AddRefs( smtpServer));</span>
<a href="#l9.10"></a><span id="l9.10">     if (NS_SUCCEEDED( rv) &amp;&amp; smtpServer)</span>
<a href="#l9.11"></a><span id="l9.11">     {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-      smtpServer-&gt;SetHostname( pServer);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+      smtpServer-&gt;SetHostname(nsDependentCString(pServer));</span>
<a href="#l9.14"></a><span id="l9.14">       if (pUser)</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-        smtpServer-&gt;SetUsername( pUser);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+        smtpServer-&gt;SetUsername(nsDependentCString(pUser));</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">       IMPORT_LOG1( &quot;Created new SMTP server: %s\n&quot;, pServer);</span>
<a href="#l9.19"></a><span id="l9.19">     }</span>
<a href="#l9.20"></a><span id="l9.20">   }</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> nsresult nsEudoraWin32::GetAttachmentInfo( const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachmentName)</span>
<a href="#l9.24"></a><span id="l9.24"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -610,15 +610,15 @@ void OESettings::SetSmtpServer( nsIMsgAc</span>
<a href="#l10.4"></a><span id="l10.4">     if (NS_SUCCEEDED( rv) &amp;&amp; foundServer) {</span>
<a href="#l10.5"></a><span id="l10.5">       IMPORT_LOG1( &quot;SMTP server already exists: %s\n&quot;, pServer);</span>
<a href="#l10.6"></a><span id="l10.6">       return;</span>
<a href="#l10.7"></a><span id="l10.7">     }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l10.10"></a><span id="l10.10">     rv = smtpService-&gt;CreateSmtpServer( getter_AddRefs( smtpServer));</span>
<a href="#l10.11"></a><span id="l10.11">     if (NS_SUCCEEDED( rv) &amp;&amp; smtpServer) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-      smtpServer-&gt;SetHostname( pServer);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+      smtpServer-&gt;SetHostname(nsDependentCString(pServer));</span>
<a href="#l10.14"></a><span id="l10.14">       if (!user.IsEmpty())</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-        smtpServer-&gt;SetUsername( user.get());</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+        smtpServer-&gt;SetUsername(user);</span>
<a href="#l10.17"></a><span id="l10.17">       IMPORT_LOG1( &quot;Created new SMTP server: %s\n&quot;, pServer);</span>
<a href="#l10.18"></a><span id="l10.18">     }</span>
<a href="#l10.19"></a><span id="l10.19">   }</span>
<a href="#l10.20"></a><span id="l10.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -534,16 +534,16 @@ void OutlookSettings::SetSmtpServer(nsIM</span>
<a href="#l11.4"></a><span id="l11.4">     rv = smtpService-&gt;FindServer( user.get(), pServer, getter_AddRefs( foundServer));</span>
<a href="#l11.5"></a><span id="l11.5">     if (NS_SUCCEEDED( rv) &amp;&amp; foundServer) {</span>
<a href="#l11.6"></a><span id="l11.6">       IMPORT_LOG1( &quot;SMTP server already exists: %s\n&quot;, pServer);</span>
<a href="#l11.7"></a><span id="l11.7">       return;</span>
<a href="#l11.8"></a><span id="l11.8">     }</span>
<a href="#l11.9"></a><span id="l11.9">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l11.10"></a><span id="l11.10">     rv = smtpService-&gt;CreateSmtpServer( getter_AddRefs( smtpServer));</span>
<a href="#l11.11"></a><span id="l11.11">     if (NS_SUCCEEDED( rv) &amp;&amp; smtpServer) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-      smtpServer-&gt;SetHostname( pServer);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+      smtpServer-&gt;SetHostname(nsDependentCString(pServer));</span>
<a href="#l11.14"></a><span id="l11.14">       if (!user.IsEmpty())</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-        smtpServer-&gt;SetUsername(user.get());</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+        smtpServer-&gt;SetUsername(user);</span>
<a href="#l11.17"></a><span id="l11.17">       IMPORT_LOG1( &quot;Ceated new SMTP server: %s\n&quot;, pServer);</span>
<a href="#l11.18"></a><span id="l11.18">     }</span>
<a href="#l11.19"></a><span id="l11.19">   }</span>
<a href="#l11.20"></a><span id="l11.20"> }</span>
<a href="#l11.21"></a><span id="l11.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

