<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24167:1d4bfcd37323197cd282c81f187de216257ede62</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1d4bfcd37323197cd282c81f187de216257ede62" />
<meta property="og:url" content="/comm-central/rev/1d4bfcd37323197cd282c81f187de216257ede62" />
<meta property="og:description" content="Bug 1455471 - comment and white-space fixes, minor style tweaks. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1d4bfcd37323197cd282c81f187de216257ede62 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1d4bfcd37323197cd282c81f187de216257ede62">shortlog</a> |
<a href="/comm-central/log/1d4bfcd37323197cd282c81f187de216257ede62">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1d4bfcd37323197cd282c81f187de216257ede62">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1d4bfcd37323197cd282c81f187de216257ede62">files</a> |
changeset |
<a href="/comm-central/raw-rev/1d4bfcd37323197cd282c81f187de216257ede62">raw</a>  | <a href="/comm-central/archive/1d4bfcd37323197cd282c81f187de216257ede62.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1455471">Bug 1455471</a> - comment and white-space fixes, minor style tweaks. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 29 Jun 2018 20:48:14 +0200</td></tr>

<tr>
 <td>changeset 24167</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1d4bfcd37323197cd282c81f187de216257ede62">1d4bfcd37323197cd282c81f187de216257ede62</a></td>
</tr>



<tr>
<td>parent 24166</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/58b1612f62fe79fe70ef52294c04c5a8cfe2da7c">58b1612f62fe79fe70ef52294c04c5a8cfe2da7c</a>
</td>
</tr>

<tr>
<td>child 24168</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/80d117100cd2f91b716bf0bc20d3ca8f03f5710e">80d117100cd2f91b716bf0bc20d3ca8f03f5710e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1d4bfcd37323197cd282c81f187de216257ede62">14568</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 29 Jun 2018 22:46:05 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@7d3a1ddf8dd6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7d3a1ddf8dd6ffe812027a1d037519f96536049b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7d3a1ddf8dd6ffe812027a1d037519f96536049b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7d3a1ddf8dd6ffe812027a1d037519f96536049b&newProject=comm-central&newRevision=1d4bfcd37323197cd282c81f187de216257ede62&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7d3a1ddf8dd6ffe812027a1d037519f96536049b&newProject=comm-central&newRevision=1d4bfcd37323197cd282c81f187de216257ede62&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7d3a1ddf8dd6ffe812027a1d037519f96536049b&newProject=comm-central&newRevision=1d4bfcd37323197cd282c81f187de216257ede62&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1455471">1455471</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1455471">Bug 1455471</a> - comment and white-space fixes, minor style tweaks. r=darktrojan</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/1d4bfcd37323197cd282c81f187de216257ede62/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-mail.js">mail/components/extensions/parent/ext-mail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-mail.js">file</a> |
<a href="/comm-central/annotate/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-mail.js">annotate</a> |
<a href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-mail.js">diff</a> |
<a href="/comm-central/comparison/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-mail.js">comparison</a> |
<a href="/comm-central/log/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-mail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-tabs.js">mail/components/extensions/parent/ext-tabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-tabs.js">file</a> |
<a href="/comm-central/annotate/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-tabs.js">annotate</a> |
<a href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-tabs.js">diff</a> |
<a href="/comm-central/comparison/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-tabs.js">comparison</a> |
<a href="/comm-central/log/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-tabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-windows.js">mail/components/extensions/parent/ext-windows.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-windows.js">file</a> |
<a href="/comm-central/annotate/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-windows.js">annotate</a> |
<a href="/comm-central/diff/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-windows.js">diff</a> |
<a href="/comm-central/comparison/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-windows.js">comparison</a> |
<a href="/comm-central/log/1d4bfcd37323197cd282c81f187de216257ede62/mail/components/extensions/parent/ext-windows.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -67,17 +67,17 @@ var folderListener = {</span>
<a href="#l1.4"></a><span id="l1.4">     OnItemAdded: function(parentItem, item) { },</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">     OnItemRemoved: function(parentItem, item) { },</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">     OnItemPropertyChanged: function(item, property, oldValue, newValue) { },</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">     OnItemIntPropertyChanged: function(item, property, oldValue, newValue) {</span>
<a href="#l1.11"></a><span id="l1.11">       if (item == gFolderDisplay.displayedFolder) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        if(property == &quot;TotalMessages&quot; || property == &quot;TotalUnreadMessages&quot;) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        if (property == &quot;TotalMessages&quot; || property == &quot;TotalUnreadMessages&quot;) {</span>
<a href="#l1.14"></a><span id="l1.14">           UpdateStatusMessageCounts(gFolderDisplay.displayedFolder);</span>
<a href="#l1.15"></a><span id="l1.15">         }</span>
<a href="#l1.16"></a><span id="l1.16">       }</span>
<a href="#l1.17"></a><span id="l1.17">     },</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">     OnItemBoolPropertyChanged: function(item, property, oldValue, newValue) { },</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">     OnItemUnicharPropertyChanged: function(item, property, oldValue, newValue) { },</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -749,18 +749,18 @@ function loadExtraTabs()</span>
<a href="#l1.23"></a><span id="l1.23">     // special position. So select the last tab opened.</span>
<a href="#l1.24"></a><span id="l1.24">     tabmail.switchToTab(tabmail.tabInfo[tabmail.tabInfo.length-1])</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">     return;</span>
<a href="#l1.27"></a><span id="l1.27">   }</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">   if (tab.action == &quot;open&quot;) {</span>
<a href="#l1.30"></a><span id="l1.30">     for (let i = 0; i &lt; tab.tabs.length; i++)</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      if(&quot;tabType&quot; in tab.tabs[i])</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-        tabmail.openTab(tab.tabs[i].tabType,tab.tabs[i].tabParams);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+      if (&quot;tabType&quot; in tab.tabs[i])</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+        tabmail.openTab(tab.tabs[i].tabType, tab.tabs[i].tabParams);</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36">     return;</span>
<a href="#l1.37"></a><span id="l1.37">   }</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39"> }</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41"> /**</span>
<a href="#l1.42"></a><span id="l1.42">  * Loads the given message header at window open. Exactly one out of this and</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineat">@@ -786,19 +786,20 @@ function loadStartFolder(initialUri)</span>
<a href="#l1.44"></a><span id="l1.44">     let loadFolder = !atStartupRestoreTabs(!!initialUri);</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46">     if (initialUri)</span>
<a href="#l1.47"></a><span id="l1.47">       loadFolder = true;</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49">     //First get default account</span>
<a href="#l1.50"></a><span id="l1.50">     try</span>
<a href="#l1.51"></a><span id="l1.51">     {</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-        if(initialUri)</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+        if (initialUri)</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+        {</span>
<a href="#l1.56"></a><span id="l1.56">             startFolder = MailUtils.getFolderForURI(initialUri);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+        }</span>
<a href="#l1.58"></a><span id="l1.58">         else</span>
<a href="#l1.59"></a><span id="l1.59">         {</span>
<a href="#l1.60"></a><span id="l1.60">             try {</span>
<a href="#l1.61"></a><span id="l1.61">                 var defaultAccount = accountManager.defaultAccount;</span>
<a href="#l1.62"></a><span id="l1.62">             } catch (x) {</span>
<a href="#l1.63"></a><span id="l1.63">                 return; // exception caused by no default account, ignore it.</span>
<a href="#l1.64"></a><span id="l1.64">             }</span>
<a href="#l1.65"></a><span id="l1.65"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -863,28 +863,27 @@</span>
<a href="#l2.4"></a><span id="l2.4">               let targetTabmail = aTargetWindow.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l2.5"></a><span id="l2.5">               targetTabmail.restoreTab(tab);</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">               if (aTargetPosition) {</span>
<a href="#l2.8"></a><span id="l2.8">                 let droppedTab = targetTabmail.tabInfo[targetTabmail.tabInfo.length - 1];</span>
<a href="#l2.9"></a><span id="l2.9">                 targetTabmail.moveTabTo(droppedTab, aTargetPosition);</span>
<a href="#l2.10"></a><span id="l2.10">               }</span>
<a href="#l2.11"></a><span id="l2.11">               return aTargetWindow;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+            }</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+            let features = [&quot;chrome&quot;];</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+            if (aTargetWindow === &quot;popup&quot;) {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+              features.push(&quot;dialog&quot;, &quot;resizable&quot;, &quot;minimizable&quot;, &quot;centerscreen&quot;, &quot;titlebar&quot;, &quot;close&quot;);</span>
<a href="#l2.16"></a><span id="l2.16">             } else {</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-              let features = [&quot;chrome&quot;];</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-              if (aTargetWindow === &quot;popup&quot;) {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-                features.push(&quot;dialog&quot;, &quot;resizable&quot;, &quot;minimizable&quot;, &quot;centerscreen&quot;, &quot;titlebar&quot;, &quot;close&quot;);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-              } else {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-                features.push(&quot;dialog=no&quot;, &quot;all&quot;, &quot;status&quot;, &quot;toolbar&quot;);</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-              }</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-              return window.openDialog(&quot;chrome://messenger/content/&quot;, &quot;_blank&quot;,</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-                 features.join(&quot;,&quot;), null,</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-                 { action : &quot;restore&quot;, tabs: [tab] } ).focus();</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+              features.push(&quot;dialog=no&quot;, &quot;all&quot;, &quot;status&quot;, &quot;toolbar&quot;);</span>
<a href="#l2.28"></a><span id="l2.28">             }</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+            return window.openDialog(&quot;chrome://messenger/content/&quot;, &quot;_blank&quot;,</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+              features.join(&quot;,&quot;), null,</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+              { action : &quot;restore&quot;, tabs: [tab] } ).focus();</span>
<a href="#l2.33"></a><span id="l2.33">           ]]&gt;</span>
<a href="#l2.34"></a><span id="l2.34">         &lt;/body&gt;</span>
<a href="#l2.35"></a><span id="l2.35">       &lt;/method&gt;</span>
<a href="#l2.36"></a><span id="l2.36">       &lt;method name=&quot;moveTabTo&quot;&gt;</span>
<a href="#l2.37"></a><span id="l2.37">         &lt;parameter name=&quot;aTabIndexNodeOrInfo&quot;/&gt;</span>
<a href="#l2.38"></a><span id="l2.38">         &lt;parameter name=&quot;aIndex&quot;/&gt;</span>
<a href="#l2.39"></a><span id="l2.39">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.40"></a><span id="l2.40">           let [oldIdx, tab, tabNode] =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -31,28 +31,28 @@ const getSender = (extension, target, se</span>
<a href="#l3.4"></a><span id="l3.4">   if (tabId != null &amp;&amp; tabId &gt;= 0) {</span>
<a href="#l3.5"></a><span id="l3.5">     let tab = extension.tabManager.get(tabId, null);</span>
<a href="#l3.6"></a><span id="l3.6">     if (tab) {</span>
<a href="#l3.7"></a><span id="l3.7">       sender.tab = tab.convert();</span>
<a href="#l3.8"></a><span id="l3.8">     }</span>
<a href="#l3.9"></a><span id="l3.9">   }</span>
<a href="#l3.10"></a><span id="l3.10"> };</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-// Used by Extension.jsm</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+// Used by Extension.jsm.</span>
<a href="#l3.14"></a><span id="l3.14"> global.tabGetSender = getSender;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> global.makeWidgetId = id =&gt; {</span>
<a href="#l3.17"></a><span id="l3.17">   id = id.toLowerCase();</span>
<a href="#l3.18"></a><span id="l3.18">   // FIXME: This allows for collisions.</span>
<a href="#l3.19"></a><span id="l3.19">   return id.replace(/[^a-z0-9_-]/g, &quot;_&quot;);</span>
<a href="#l3.20"></a><span id="l3.20"> };</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23"> /**</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">- * Gets the tab browser for the tabmail tabInfo</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+ * Gets the tab browser for the tabmail tabInfo.</span>
<a href="#l3.26"></a><span id="l3.26">  *</span>
<a href="#l3.27"></a><span id="l3.27">  * @param {NativeTabInfo} nativeTabInfo     The tabInfo object to get the browser for</span>
<a href="#l3.28"></a><span id="l3.28">  * @return {?XULElement}                    The browser element for the tab</span>
<a href="#l3.29"></a><span id="l3.29">  */</span>
<a href="#l3.30"></a><span id="l3.30"> function getTabBrowser(nativeTabInfo) {</span>
<a href="#l3.31"></a><span id="l3.31">   if (!nativeTabInfo) {</span>
<a href="#l3.32"></a><span id="l3.32">     return null;</span>
<a href="#l3.33"></a><span id="l3.33">   }</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineat">@@ -65,22 +65,22 @@ function getTabBrowser(nativeTabInfo) {</span>
<a href="#l3.35"></a><span id="l3.35">     return nativeTabInfo.mode.tabType.getBrowser(nativeTabInfo);</span>
<a href="#l3.36"></a><span id="l3.36">   }</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38">   return null;</span>
<a href="#l3.39"></a><span id="l3.39"> }</span>
<a href="#l3.40"></a><span id="l3.40"> global.getTabBrowser = getTabBrowser;</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42"> /**</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">- * Thw window tracker tracks opening and closing Thunderbird windows. Each window has an id, which</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+ * The window tracker tracks opening and closing Thunderbird windows. Each window has an id, which</span>
<a href="#l3.45"></a><span id="l3.45">  * is mapped to native window objects.</span>
<a href="#l3.46"></a><span id="l3.46">  */</span>
<a href="#l3.47"></a><span id="l3.47"> class WindowTracker extends WindowTrackerBase {</span>
<a href="#l3.48"></a><span id="l3.48">   /**</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-   * Adds a tab progress listener to the given mail window</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+   * Adds a tab progress listener to the given mail window.</span>
<a href="#l3.51"></a><span id="l3.51">    *</span>
<a href="#l3.52"></a><span id="l3.52">    * @param {DOMWindow} window      The mail window to which to add the listener.</span>
<a href="#l3.53"></a><span id="l3.53">    * @param {Object} listener       The listener to add</span>
<a href="#l3.54"></a><span id="l3.54">    */</span>
<a href="#l3.55"></a><span id="l3.55">   addProgressListener(window, listener) {</span>
<a href="#l3.56"></a><span id="l3.56">     let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l3.57"></a><span id="l3.57">     tabmail.addTabsProgressListener(listener);</span>
<a href="#l3.58"></a><span id="l3.58">   }</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineat">@@ -189,33 +189,33 @@ global.WindowEventManager = class extend</span>
<a href="#l3.60"></a><span id="l3.60">         windowTracker.removeListener(event, listener2);</span>
<a href="#l3.61"></a><span id="l3.61">       };</span>
<a href="#l3.62"></a><span id="l3.62">     });</span>
<a href="#l3.63"></a><span id="l3.63">   }</span>
<a href="#l3.64"></a><span id="l3.64"> };</span>
<a href="#l3.65"></a><span id="l3.65"> </span>
<a href="#l3.66"></a><span id="l3.66"> /**</span>
<a href="#l3.67"></a><span id="l3.67">  * Tracks the opening and closing of tabs and maps them between their numeric WebExtension ID and</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">- * the native tab info objects</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+ * the native tab info objects.</span>
<a href="#l3.70"></a><span id="l3.70">  */</span>
<a href="#l3.71"></a><span id="l3.71"> class TabTracker extends TabTrackerBase {</span>
<a href="#l3.72"></a><span id="l3.72">   constructor() {</span>
<a href="#l3.73"></a><span id="l3.73">     super();</span>
<a href="#l3.74"></a><span id="l3.74"> </span>
<a href="#l3.75"></a><span id="l3.75">     this._tabs = new WeakMap();</span>
<a href="#l3.76"></a><span id="l3.76">     this._browsers = new WeakMap();</span>
<a href="#l3.77"></a><span id="l3.77">     this._tabIds = new Map();</span>
<a href="#l3.78"></a><span id="l3.78">     this._nextId = 1;</span>
<a href="#l3.79"></a><span id="l3.79">     this._movingTabs = new Map();</span>
<a href="#l3.80"></a><span id="l3.80"> </span>
<a href="#l3.81"></a><span id="l3.81">     this._handleTabDestroyed = this._handleTabDestroyed.bind(this);</span>
<a href="#l3.82"></a><span id="l3.82">   }</span>
<a href="#l3.83"></a><span id="l3.83"> </span>
<a href="#l3.84"></a><span id="l3.84">   /**</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-   * Initialize tab tracking listeners the first time that an event listener is added</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+   * Initialize tab tracking listeners the first time that an event listener is added.</span>
<a href="#l3.87"></a><span id="l3.87">    */</span>
<a href="#l3.88"></a><span id="l3.88">   init() {</span>
<a href="#l3.89"></a><span id="l3.89">     if (this.initialized) {</span>
<a href="#l3.90"></a><span id="l3.90">       return;</span>
<a href="#l3.91"></a><span id="l3.91">     }</span>
<a href="#l3.92"></a><span id="l3.92">     this.initialized = true;</span>
<a href="#l3.93"></a><span id="l3.93"> </span>
<a href="#l3.94"></a><span id="l3.94">     this._handleWindowOpen = this._handleWindowOpen.bind(this);</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineat">@@ -248,17 +248,17 @@ class TabTracker extends TabTrackerBase </span>
<a href="#l3.96"></a><span id="l3.96">     this.init();</span>
<a href="#l3.97"></a><span id="l3.97"> </span>
<a href="#l3.98"></a><span id="l3.98">     id = this._nextId++;</span>
<a href="#l3.99"></a><span id="l3.99">     this.setId(nativeTabInfo, id);</span>
<a href="#l3.100"></a><span id="l3.100">     return id;</span>
<a href="#l3.101"></a><span id="l3.101">   }</span>
<a href="#l3.102"></a><span id="l3.102"> </span>
<a href="#l3.103"></a><span id="l3.103">   /**</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-   * Returns the tab id corresponding to the given browser element</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+   * Returns the tab id corresponding to the given browser element.</span>
<a href="#l3.106"></a><span id="l3.106">    *</span>
<a href="#l3.107"></a><span id="l3.107">    * @param {XULElement} browser        The &lt;browser&gt; element to retrieve for</span>
<a href="#l3.108"></a><span id="l3.108">    * @return {Integer}                  The tab's numeric ID</span>
<a href="#l3.109"></a><span id="l3.109">    */</span>
<a href="#l3.110"></a><span id="l3.110">   getBrowserTabId(browser) {</span>
<a href="#l3.111"></a><span id="l3.111">     let id = this._browsers.get(browser);</span>
<a href="#l3.112"></a><span id="l3.112">     if (id) {</span>
<a href="#l3.113"></a><span id="l3.113">       return id;</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineat">@@ -271,32 +271,32 @@ class TabTracker extends TabTrackerBase </span>
<a href="#l3.115"></a><span id="l3.115">       id = this.getId(tab);</span>
<a href="#l3.116"></a><span id="l3.116">       this._browsers.set(browser, id);</span>
<a href="#l3.117"></a><span id="l3.117">       return id;</span>
<a href="#l3.118"></a><span id="l3.118">     }</span>
<a href="#l3.119"></a><span id="l3.119">     return -1;</span>
<a href="#l3.120"></a><span id="l3.120">   }</span>
<a href="#l3.121"></a><span id="l3.121"> </span>
<a href="#l3.122"></a><span id="l3.122">   /**</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-   * Records the tab information for the given tabInfo object</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+   * Records the tab information for the given tabInfo object.</span>
<a href="#l3.125"></a><span id="l3.125">    *</span>
<a href="#l3.126"></a><span id="l3.126">    * @param {NativeTabInfo} nativeTabInfo       The tab info to record for</span>
<a href="#l3.127"></a><span id="l3.127">    * @param {Integer} id                        The tab id to record</span>
<a href="#l3.128"></a><span id="l3.128">    */</span>
<a href="#l3.129"></a><span id="l3.129">   setId(nativeTabInfo, id) {</span>
<a href="#l3.130"></a><span id="l3.130">     this._tabs.set(nativeTabInfo, id);</span>
<a href="#l3.131"></a><span id="l3.131">     let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l3.132"></a><span id="l3.132">     if (browser) {</span>
<a href="#l3.133"></a><span id="l3.133">       this._browsers.set(browser, id);</span>
<a href="#l3.134"></a><span id="l3.134">     }</span>
<a href="#l3.135"></a><span id="l3.135">     this._tabIds.set(id, nativeTabInfo);</span>
<a href="#l3.136"></a><span id="l3.136">   }</span>
<a href="#l3.137"></a><span id="l3.137"> </span>
<a href="#l3.138"></a><span id="l3.138">   /**</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-   * Function to call when a tab was close, deletes tab information for the tab</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+   * Function to call when a tab was close, deletes tab information for the tab.</span>
<a href="#l3.141"></a><span id="l3.141">    *</span>
<a href="#l3.142"></a><span id="l3.142">    * @param {Event} event                  The event triggering the detroyal</span>
<a href="#l3.143"></a><span id="l3.143">    * @param {{ nativeTabInfo:NativeTabInfo}}  The object containing tab info</span>
<a href="#l3.144"></a><span id="l3.144">    */</span>
<a href="#l3.145"></a><span id="l3.145">   _handleTabDestroyed(event, { nativeTabInfo }) {</span>
<a href="#l3.146"></a><span id="l3.146">     let id = this._tabs.get(nativeTabInfo);</span>
<a href="#l3.147"></a><span id="l3.147">     if (id) {</span>
<a href="#l3.148"></a><span id="l3.148">       this._tabs.delete(nativeTabInfo);</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineat">@@ -478,17 +478,17 @@ class TabTracker extends TabTrackerBase </span>
<a href="#l3.150"></a><span id="l3.150">     let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l3.151"></a><span id="l3.151">     let windowId = windowTracker.getId(browser.ownerGlobal);</span>
<a href="#l3.152"></a><span id="l3.152">     let tabId = this.getId(nativeTabInfo);</span>
<a href="#l3.153"></a><span id="l3.153"> </span>
<a href="#l3.154"></a><span id="l3.154">     this.emit(&quot;tab-removed&quot;, { nativeTabInfo, tabId, windowId, isWindowClosing });</span>
<a href="#l3.155"></a><span id="l3.155">   }</span>
<a href="#l3.156"></a><span id="l3.156"> </span>
<a href="#l3.157"></a><span id="l3.157">   /**</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-   * Returns tab id and window id for the given browser element</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+   * Returns tab id and window id for the given browser element.</span>
<a href="#l3.160"></a><span id="l3.160">    *</span>
<a href="#l3.161"></a><span id="l3.161">    * @param {Element} browser                       The browser element to check</span>
<a href="#l3.162"></a><span id="l3.162">    * @return {{ tabId:Integer, windowId:Integer }}  The browsing data for the element</span>
<a href="#l3.163"></a><span id="l3.163">    */</span>
<a href="#l3.164"></a><span id="l3.164">   getBrowserData(browser) {</span>
<a href="#l3.165"></a><span id="l3.165">     return {</span>
<a href="#l3.166"></a><span id="l3.166">       tabId: this.getBrowserTabId(browser),</span>
<a href="#l3.167"></a><span id="l3.167">       windowId: windowTracker.getId(browser.ownerGlobal)</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineat">@@ -508,145 +508,145 @@ class TabTracker extends TabTrackerBase </span>
<a href="#l3.169"></a><span id="l3.169">   }</span>
<a href="#l3.170"></a><span id="l3.170"> }</span>
<a href="#l3.171"></a><span id="l3.171"> </span>
<a href="#l3.172"></a><span id="l3.172"> tabTracker = new TabTracker();</span>
<a href="#l3.173"></a><span id="l3.173"> windowTracker = new WindowTracker();</span>
<a href="#l3.174"></a><span id="l3.174"> Object.assign(global, { tabTracker, windowTracker });</span>
<a href="#l3.175"></a><span id="l3.175"> </span>
<a href="#l3.176"></a><span id="l3.176"> /**</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">- * Extension-specific wrapper around a Thunderbird tab</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+ * Extension-specific wrapper around a Thunderbird tab.</span>
<a href="#l3.179"></a><span id="l3.179">  */</span>
<a href="#l3.180"></a><span id="l3.180"> class Tab extends TabBase {</span>
<a href="#l3.181"></a><span id="l3.181">   /** Returns the XUL browser for the tab. */</span>
<a href="#l3.182"></a><span id="l3.182">   get browser() {</span>
<a href="#l3.183"></a><span id="l3.183">     return getTabBrowser(this.nativeTab);</span>
<a href="#l3.184"></a><span id="l3.184">   }</span>
<a href="#l3.185"></a><span id="l3.185"> </span>
<a href="#l3.186"></a><span id="l3.186">   /** Returns the tabmail element for the tab. */</span>
<a href="#l3.187"></a><span id="l3.187">   get tabmail() {</span>
<a href="#l3.188"></a><span id="l3.188">     return this.browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l3.189"></a><span id="l3.189">   }</span>
<a href="#l3.190"></a><span id="l3.190"> </span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-  /** Returns the frame loader for the tab */</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+  /** Returns the frame loader for the tab. */</span>
<a href="#l3.193"></a><span id="l3.193">   get frameLoader() {</span>
<a href="#l3.194"></a><span id="l3.194">     // If we don't have a frameLoader yet, just return a dummy with no width and</span>
<a href="#l3.195"></a><span id="l3.195">     // height.</span>
<a href="#l3.196"></a><span id="l3.196">     return super.frameLoader || { lazyWidth: 0, lazyHeight: 0 };</span>
<a href="#l3.197"></a><span id="l3.197">   }</span>
<a href="#l3.198"></a><span id="l3.198"> </span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-  /** Returns the favIcon, without permission checks */</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+  /** Returns the favIcon, without permission checks. */</span>
<a href="#l3.201"></a><span id="l3.201">   get _favIconUrl() {</span>
<a href="#l3.202"></a><span id="l3.202">     return this.browser.mIconURL;</span>
<a href="#l3.203"></a><span id="l3.203">   }</span>
<a href="#l3.204"></a><span id="l3.204"> </span>
<a href="#l3.205"></a><span id="l3.205" class="difflineminus">-  /** Returns the last accessed time */</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+  /** Returns the last accessed time. */</span>
<a href="#l3.207"></a><span id="l3.207">   get lastAccessed() {</span>
<a href="#l3.208"></a><span id="l3.208">     return 0;</span>
<a href="#l3.209"></a><span id="l3.209">   }</span>
<a href="#l3.210"></a><span id="l3.210"> </span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-  /** Returns the audible state */</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineplus">+  /** Returns the audible state. */</span>
<a href="#l3.213"></a><span id="l3.213">   get audible() {</span>
<a href="#l3.214"></a><span id="l3.214">     return false;</span>
<a href="#l3.215"></a><span id="l3.215">   }</span>
<a href="#l3.216"></a><span id="l3.216"> </span>
<a href="#l3.217"></a><span id="l3.217" class="difflineminus">-  /** Returns the cookie store id */</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+  /** Returns the cookie store id. */</span>
<a href="#l3.219"></a><span id="l3.219">   get cookieStoreId() {</span>
<a href="#l3.220"></a><span id="l3.220">     return 0;</span>
<a href="#l3.221"></a><span id="l3.221">   }</span>
<a href="#l3.222"></a><span id="l3.222"> </span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-  /** Returns the discarded state */</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+  /** Returns the discarded state. */</span>
<a href="#l3.225"></a><span id="l3.225">   get discarded() {</span>
<a href="#l3.226"></a><span id="l3.226">     return false;</span>
<a href="#l3.227"></a><span id="l3.227">   }</span>
<a href="#l3.228"></a><span id="l3.228"> </span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-  /** Returns the tab height */</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+  /** Returns the tab height. */</span>
<a href="#l3.231"></a><span id="l3.231">   get height() {</span>
<a href="#l3.232"></a><span id="l3.232">     return this.frameLoader.lazyHeight;</span>
<a href="#l3.233"></a><span id="l3.233">   }</span>
<a href="#l3.234"></a><span id="l3.234"> </span>
<a href="#l3.235"></a><span id="l3.235" class="difflineminus">-  /** Returns hidden status */</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineplus">+  /** Returns hidden status. */</span>
<a href="#l3.237"></a><span id="l3.237">   get hidden() {</span>
<a href="#l3.238"></a><span id="l3.238">     return false;</span>
<a href="#l3.239"></a><span id="l3.239">   }</span>
<a href="#l3.240"></a><span id="l3.240"> </span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-  /** Returns the tab index */</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+  /** Returns the tab index. */</span>
<a href="#l3.243"></a><span id="l3.243">   get index() {</span>
<a href="#l3.244"></a><span id="l3.244">     return this.tabmail.tabInfo.filter(info =&gt; getTabBrowser(info)).indexOf(this.nativeTab);</span>
<a href="#l3.245"></a><span id="l3.245">   }</span>
<a href="#l3.246"></a><span id="l3.246"> </span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-  /** Returns information about the muted state of the tab */</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineplus">+  /** Returns information about the muted state of the tab. */</span>
<a href="#l3.249"></a><span id="l3.249">   get mutedInfo() {</span>
<a href="#l3.250"></a><span id="l3.250">     return { muted: false };</span>
<a href="#l3.251"></a><span id="l3.251">   }</span>
<a href="#l3.252"></a><span id="l3.252"> </span>
<a href="#l3.253"></a><span id="l3.253" class="difflineminus">-  /** Returns information about the sharing state of the tab */</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+  /** Returns information about the sharing state of the tab. */</span>
<a href="#l3.255"></a><span id="l3.255">   get sharingState() {</span>
<a href="#l3.256"></a><span id="l3.256">     return { camera: false, microphone: false, screen: false };</span>
<a href="#l3.257"></a><span id="l3.257">   }</span>
<a href="#l3.258"></a><span id="l3.258"> </span>
<a href="#l3.259"></a><span id="l3.259" class="difflineminus">-  /** Returns the pinned state of the tab */</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineplus">+  /** Returns the pinned state of the tab. */</span>
<a href="#l3.261"></a><span id="l3.261">   get pinned() {</span>
<a href="#l3.262"></a><span id="l3.262">     return false;</span>
<a href="#l3.263"></a><span id="l3.263">   }</span>
<a href="#l3.264"></a><span id="l3.264"> </span>
<a href="#l3.265"></a><span id="l3.265" class="difflineminus">-  /** Returns the active state of the tab */</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineplus">+  /** Returns the active state of the tab. */</span>
<a href="#l3.267"></a><span id="l3.267">   get active() {</span>
<a href="#l3.268"></a><span id="l3.268">     return this.nativeTab == this.tabmail.selectedTab;</span>
<a href="#l3.269"></a><span id="l3.269">   }</span>
<a href="#l3.270"></a><span id="l3.270"> </span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-  /** Returns the highlighted state of the tab */</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineplus">+  /** Returns the highlighted state of the tab. */</span>
<a href="#l3.273"></a><span id="l3.273">   get highlighted() {</span>
<a href="#l3.274"></a><span id="l3.274">     return this.active;</span>
<a href="#l3.275"></a><span id="l3.275">   }</span>
<a href="#l3.276"></a><span id="l3.276"> </span>
<a href="#l3.277"></a><span id="l3.277" class="difflineminus">-  /** Returns the selected state of the tab */</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineplus">+  /** Returns the selected state of the tab. */</span>
<a href="#l3.279"></a><span id="l3.279">   get selected() {</span>
<a href="#l3.280"></a><span id="l3.280">     return this.active;</span>
<a href="#l3.281"></a><span id="l3.281">   }</span>
<a href="#l3.282"></a><span id="l3.282"> </span>
<a href="#l3.283"></a><span id="l3.283" class="difflineminus">-  /** Returns the loading status of the tab */</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineplus">+  /** Returns the loading status of the tab. */</span>
<a href="#l3.285"></a><span id="l3.285">   get status() {</span>
<a href="#l3.286"></a><span id="l3.286">     return this.browser.webProgress.isLoadingDocument ? &quot;loading&quot; : &quot;complete&quot;;</span>
<a href="#l3.287"></a><span id="l3.287">   }</span>
<a href="#l3.288"></a><span id="l3.288"> </span>
<a href="#l3.289"></a><span id="l3.289" class="difflineminus">-  /** Returns the title of the tab, without permission checks */</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineplus">+  /** Returns the title of the tab, without permission checks. */</span>
<a href="#l3.291"></a><span id="l3.291">   get _title() {</span>
<a href="#l3.292"></a><span id="l3.292">     let tabNode = this.tabmail._getTabContextForTabbyThing(this.nativeTab)[2];</span>
<a href="#l3.293"></a><span id="l3.293">     return tabNode.getAttribute(&quot;label&quot;);</span>
<a href="#l3.294"></a><span id="l3.294">   }</span>
<a href="#l3.295"></a><span id="l3.295"> </span>
<a href="#l3.296"></a><span id="l3.296" class="difflineminus">-  /** Returns the width of the tab */</span>
<a href="#l3.297"></a><span id="l3.297" class="difflineplus">+  /** Returns the width of the tab. */</span>
<a href="#l3.298"></a><span id="l3.298">   get width() {</span>
<a href="#l3.299"></a><span id="l3.299">     return this.frameLoader.lazyWidth;</span>
<a href="#l3.300"></a><span id="l3.300">   }</span>
<a href="#l3.301"></a><span id="l3.301"> </span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-  /** Returns the native window object of the tab */</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineplus">+  /** Returns the native window object of the tab. */</span>
<a href="#l3.304"></a><span id="l3.304">   get window() {</span>
<a href="#l3.305"></a><span id="l3.305">     return this.browser.ownerGlobal;</span>
<a href="#l3.306"></a><span id="l3.306">   }</span>
<a href="#l3.307"></a><span id="l3.307"> </span>
<a href="#l3.308"></a><span id="l3.308" class="difflineminus">-  /** Returns the window id of the tab */</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineplus">+  /** Returns the window id of the tab. */</span>
<a href="#l3.310"></a><span id="l3.310">   get windowId() {</span>
<a href="#l3.311"></a><span id="l3.311">     return windowTracker.getId(this.window);</span>
<a href="#l3.312"></a><span id="l3.312">   }</span>
<a href="#l3.313"></a><span id="l3.313"> </span>
<a href="#l3.314"></a><span id="l3.314" class="difflineminus">-  /** Returns the article state of the tab */</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineplus">+  /** Returns the article state of the tab. */</span>
<a href="#l3.316"></a><span id="l3.316">   get isArticle() {</span>
<a href="#l3.317"></a><span id="l3.317">     return false;</span>
<a href="#l3.318"></a><span id="l3.318">   }</span>
<a href="#l3.319"></a><span id="l3.319"> </span>
<a href="#l3.320"></a><span id="l3.320" class="difflineminus">-  /** Returns the reader mode state of the tab */</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineplus">+  /** Returns the reader mode state of the tab. */</span>
<a href="#l3.322"></a><span id="l3.322">   get isInReaderMode() {</span>
<a href="#l3.323"></a><span id="l3.323">     return false;</span>
<a href="#l3.324"></a><span id="l3.324">   }</span>
<a href="#l3.325"></a><span id="l3.325"> }</span>
<a href="#l3.326"></a><span id="l3.326"> </span>
<a href="#l3.327"></a><span id="l3.327"> /**</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">- * Extension-specific wrapper around a Thunderbird window</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineplus">+ * Extension-specific wrapper around a Thunderbird window.</span>
<a href="#l3.330"></a><span id="l3.330">  */</span>
<a href="#l3.331"></a><span id="l3.331"> class Window extends WindowBase {</span>
<a href="#l3.332"></a><span id="l3.332">   /**</span>
<a href="#l3.333"></a><span id="l3.333">    * Update the geometry of the mail window.</span>
<a href="#l3.334"></a><span id="l3.334">    *</span>
<a href="#l3.335"></a><span id="l3.335">    * @param {Object} options</span>
<a href="#l3.336"></a><span id="l3.336">    *        An object containing new values for the window's geometry.</span>
<a href="#l3.337"></a><span id="l3.337">    * @param {integer} [options.left]</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineat">@@ -676,22 +676,22 @@ class Window extends WindowBase {</span>
<a href="#l3.339"></a><span id="l3.339">     }</span>
<a href="#l3.340"></a><span id="l3.340">   }</span>
<a href="#l3.341"></a><span id="l3.341"> </span>
<a href="#l3.342"></a><span id="l3.342">   /** Returns the tabmail element for the tab. */</span>
<a href="#l3.343"></a><span id="l3.343">   get tabmail() {</span>
<a href="#l3.344"></a><span id="l3.344">     return this.window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l3.345"></a><span id="l3.345">   }</span>
<a href="#l3.346"></a><span id="l3.346"> </span>
<a href="#l3.347"></a><span id="l3.347" class="difflineminus">-  /** Returns the title of the tab, without permission checks */</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineplus">+  /** Returns the title of the tab, without permission checks. */</span>
<a href="#l3.349"></a><span id="l3.349">   get _title() {</span>
<a href="#l3.350"></a><span id="l3.350">     return this.window.document.title;</span>
<a href="#l3.351"></a><span id="l3.351">   }</span>
<a href="#l3.352"></a><span id="l3.352"> </span>
<a href="#l3.353"></a><span id="l3.353" class="difflineminus">-  /** Returns the title of the tab, checking tab permissions */</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineplus">+  /** Returns the title of the tab, checking tab permissions. */</span>
<a href="#l3.355"></a><span id="l3.355">   get title() {</span>
<a href="#l3.356"></a><span id="l3.356">     // Thunderbird can have an empty active tab while a window is loading</span>
<a href="#l3.357"></a><span id="l3.357">     if (this.activeTab &amp;&amp; this.activeTab.hasTabPermission) {</span>
<a href="#l3.358"></a><span id="l3.358">       return this._title;</span>
<a href="#l3.359"></a><span id="l3.359">     }</span>
<a href="#l3.360"></a><span id="l3.360">     return null;</span>
<a href="#l3.361"></a><span id="l3.361">   }</span>
<a href="#l3.362"></a><span id="l3.362"> </span>
<a href="#l3.363"></a><span id="l3.363" class="difflineat">@@ -699,58 +699,58 @@ class Window extends WindowBase {</span>
<a href="#l3.364"></a><span id="l3.364">    * Sets the title preface of the window.</span>
<a href="#l3.365"></a><span id="l3.365">    *</span>
<a href="#l3.366"></a><span id="l3.366">    * @param {String} titlePreface       The title preface to set</span>
<a href="#l3.367"></a><span id="l3.367">    */</span>
<a href="#l3.368"></a><span id="l3.368">   setTitlePreface(titlePreface) {</span>
<a href="#l3.369"></a><span id="l3.369">     this.window.document.documentElement.setAttribute(&quot;titlepreface&quot;, titlePreface);</span>
<a href="#l3.370"></a><span id="l3.370">   }</span>
<a href="#l3.371"></a><span id="l3.371"> </span>
<a href="#l3.372"></a><span id="l3.372" class="difflineminus">-  /** Gets the foucsed state of the window */</span>
<a href="#l3.373"></a><span id="l3.373" class="difflineplus">+  /** Gets the foucsed state of the window. */</span>
<a href="#l3.374"></a><span id="l3.374">   get focused() {</span>
<a href="#l3.375"></a><span id="l3.375">     return this.window.document.hasFocus();</span>
<a href="#l3.376"></a><span id="l3.376">   }</span>
<a href="#l3.377"></a><span id="l3.377"> </span>
<a href="#l3.378"></a><span id="l3.378" class="difflineminus">-  /** Gets the top position of the window */</span>
<a href="#l3.379"></a><span id="l3.379" class="difflineplus">+  /** Gets the top position of the window. */</span>
<a href="#l3.380"></a><span id="l3.380">   get top() {</span>
<a href="#l3.381"></a><span id="l3.381">     return this.window.screenY;</span>
<a href="#l3.382"></a><span id="l3.382">   }</span>
<a href="#l3.383"></a><span id="l3.383"> </span>
<a href="#l3.384"></a><span id="l3.384" class="difflineminus">-  /** Gets the left position of the window */</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineplus">+  /** Gets the left position of the window. */</span>
<a href="#l3.386"></a><span id="l3.386">   get left() {</span>
<a href="#l3.387"></a><span id="l3.387">     return this.window.screenX;</span>
<a href="#l3.388"></a><span id="l3.388">   }</span>
<a href="#l3.389"></a><span id="l3.389"> </span>
<a href="#l3.390"></a><span id="l3.390" class="difflineminus">-  /** Gets the width of the window */</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineplus">+  /** Gets the width of the window. */</span>
<a href="#l3.392"></a><span id="l3.392">   get width() {</span>
<a href="#l3.393"></a><span id="l3.393">     return this.window.outerWidth;</span>
<a href="#l3.394"></a><span id="l3.394">   }</span>
<a href="#l3.395"></a><span id="l3.395"> </span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-  /** Gets the height of the window */</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineplus">+  /** Gets the height of the window. */</span>
<a href="#l3.398"></a><span id="l3.398">   get height() {</span>
<a href="#l3.399"></a><span id="l3.399">     return this.window.outerHeight;</span>
<a href="#l3.400"></a><span id="l3.400">   }</span>
<a href="#l3.401"></a><span id="l3.401"> </span>
<a href="#l3.402"></a><span id="l3.402" class="difflineminus">-  /** Gets the private browsing status of the window */</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineplus">+  /** Gets the private browsing status of the window. */</span>
<a href="#l3.404"></a><span id="l3.404">   get incognito() {</span>
<a href="#l3.405"></a><span id="l3.405">     return PrivateBrowsingUtils.isWindowPrivate(this.window);</span>
<a href="#l3.406"></a><span id="l3.406">   }</span>
<a href="#l3.407"></a><span id="l3.407"> </span>
<a href="#l3.408"></a><span id="l3.408" class="difflineminus">-  /** Checks if the window is considered always on top */</span>
<a href="#l3.409"></a><span id="l3.409" class="difflineplus">+  /** Checks if the window is considered always on top. */</span>
<a href="#l3.410"></a><span id="l3.410">   get alwaysOnTop() {</span>
<a href="#l3.411"></a><span id="l3.411">     return this.xulWindow.zLevel &gt;= Ci.nsIXULWindow.raisedZ;</span>
<a href="#l3.412"></a><span id="l3.412">   }</span>
<a href="#l3.413"></a><span id="l3.413"> </span>
<a href="#l3.414"></a><span id="l3.414" class="difflineminus">-  /** Checks if the window was the last one focused */</span>
<a href="#l3.415"></a><span id="l3.415" class="difflineplus">+  /** Checks if the window was the last one focused. */</span>
<a href="#l3.416"></a><span id="l3.416">   get isLastFocused() {</span>
<a href="#l3.417"></a><span id="l3.417">     return this.window === windowTracker.topWindow;</span>
<a href="#l3.418"></a><span id="l3.418">   }</span>
<a href="#l3.419"></a><span id="l3.419"> </span>
<a href="#l3.420"></a><span id="l3.420">   /**</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineminus">-   * Returns the window state for the given window</span>
<a href="#l3.422"></a><span id="l3.422" class="difflineplus">+   * Returns the window state for the given window.</span>
<a href="#l3.423"></a><span id="l3.423">    *</span>
<a href="#l3.424"></a><span id="l3.424">    * @param {DOMWindow} window      The window to check</span>
<a href="#l3.425"></a><span id="l3.425">    * @return {String}               &quot;maximized&quot;, &quot;minimized&quot;, &quot;normal&quot; or &quot;fullscreen&quot;</span>
<a href="#l3.426"></a><span id="l3.426">    */</span>
<a href="#l3.427"></a><span id="l3.427">   static getState(window) {</span>
<a href="#l3.428"></a><span id="l3.428">     const STATES = {</span>
<a href="#l3.429"></a><span id="l3.429">       [window.STATE_MAXIMIZED]: &quot;maximized&quot;,</span>
<a href="#l3.430"></a><span id="l3.430">       [window.STATE_MINIMIZED]: &quot;minimized&quot;,</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineat">@@ -758,23 +758,23 @@ class Window extends WindowBase {</span>
<a href="#l3.432"></a><span id="l3.432">     };</span>
<a href="#l3.433"></a><span id="l3.433">     let state = STATES[window.windowState];</span>
<a href="#l3.434"></a><span id="l3.434">     if (window.fullScreen) {</span>
<a href="#l3.435"></a><span id="l3.435">       state = &quot;fullscreen&quot;;</span>
<a href="#l3.436"></a><span id="l3.436">     }</span>
<a href="#l3.437"></a><span id="l3.437">     return state;</span>
<a href="#l3.438"></a><span id="l3.438">   }</span>
<a href="#l3.439"></a><span id="l3.439"> </span>
<a href="#l3.440"></a><span id="l3.440" class="difflineminus">-  /** Returns the window state for this specific window */</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineplus">+  /** Returns the window state for this specific window. */</span>
<a href="#l3.442"></a><span id="l3.442">   get state() {</span>
<a href="#l3.443"></a><span id="l3.443">     return Window.getState(this.window);</span>
<a href="#l3.444"></a><span id="l3.444">   }</span>
<a href="#l3.445"></a><span id="l3.445"> </span>
<a href="#l3.446"></a><span id="l3.446">   /**</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineminus">-   * Sets the window state for this speific window</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineplus">+   * Sets the window state for this speific window.</span>
<a href="#l3.449"></a><span id="l3.449">    *</span>
<a href="#l3.450"></a><span id="l3.450">    * @param {String} state          &quot;maximized&quot;, &quot;minimized&quot;, &quot;normal&quot; or &quot;fullscreen&quot;</span>
<a href="#l3.451"></a><span id="l3.451">    */</span>
<a href="#l3.452"></a><span id="l3.452">   set state(state) {</span>
<a href="#l3.453"></a><span id="l3.453">     let { window } = this;</span>
<a href="#l3.454"></a><span id="l3.454">     if (state !== &quot;fullscreen&quot; &amp;&amp; window.fullScreen) {</span>
<a href="#l3.455"></a><span id="l3.455">       window.fullScreen = false;</span>
<a href="#l3.456"></a><span id="l3.456">     }</span>
<a href="#l3.457"></a><span id="l3.457" class="difflineat">@@ -809,17 +809,17 @@ class Window extends WindowBase {</span>
<a href="#l3.458"></a><span id="l3.458">         break;</span>
<a href="#l3.459"></a><span id="l3.459"> </span>
<a href="#l3.460"></a><span id="l3.460">       default:</span>
<a href="#l3.461"></a><span id="l3.461">         throw new Error(`Unexpected window state: ${state}`);</span>
<a href="#l3.462"></a><span id="l3.462">     }</span>
<a href="#l3.463"></a><span id="l3.463">   }</span>
<a href="#l3.464"></a><span id="l3.464"> </span>
<a href="#l3.465"></a><span id="l3.465">   /**</span>
<a href="#l3.466"></a><span id="l3.466" class="difflineminus">-   * Retrieves the (relevant) tabs in this window</span>
<a href="#l3.467"></a><span id="l3.467" class="difflineplus">+   * Retrieves the (relevant) tabs in this window.</span>
<a href="#l3.468"></a><span id="l3.468">    *</span>
<a href="#l3.469"></a><span id="l3.469">    * @yields {Tab}      The wrapped Tab in this window</span>
<a href="#l3.470"></a><span id="l3.470">    */</span>
<a href="#l3.471"></a><span id="l3.471">   * getTabs() {</span>
<a href="#l3.472"></a><span id="l3.472">     let { tabManager } = this.extension;</span>
<a href="#l3.473"></a><span id="l3.473"> </span>
<a href="#l3.474"></a><span id="l3.474">     for (let nativeTabInfo of this.tabmail.tabInfo) {</span>
<a href="#l3.475"></a><span id="l3.475">       if (getTabBrowser(nativeTabInfo)) {</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineat">@@ -835,17 +835,17 @@ class Window extends WindowBase {</span>
<a href="#l3.477"></a><span id="l3.477">     let selectedTab = this.tabmail.selectedTab;</span>
<a href="#l3.478"></a><span id="l3.478">     if (selectedTab) {</span>
<a href="#l3.479"></a><span id="l3.479">       return tabManager.getWrapper(selectedTab);</span>
<a href="#l3.480"></a><span id="l3.480">     }</span>
<a href="#l3.481"></a><span id="l3.481">     return null;</span>
<a href="#l3.482"></a><span id="l3.482">   }</span>
<a href="#l3.483"></a><span id="l3.483"> </span>
<a href="#l3.484"></a><span id="l3.484">   /**</span>
<a href="#l3.485"></a><span id="l3.485" class="difflineminus">-   * Retrieves the tab at the given index</span>
<a href="#l3.486"></a><span id="l3.486" class="difflineplus">+   * Retrieves the tab at the given index.</span>
<a href="#l3.487"></a><span id="l3.487">    *</span>
<a href="#l3.488"></a><span id="l3.488">    * @param {Number} index      The index to look at</span>
<a href="#l3.489"></a><span id="l3.489">    * @return {Tab}              The wrapped tab at the index</span>
<a href="#l3.490"></a><span id="l3.490">    */</span>
<a href="#l3.491"></a><span id="l3.491">   getTabAtIndex(index) {</span>
<a href="#l3.492"></a><span id="l3.492">     let nativeTabInfo = this.tabmail.tabInfo.filter(info =&gt; getTabBrowser(info))[index];</span>
<a href="#l3.493"></a><span id="l3.493">     if (nativeTabInfo) {</span>
<a href="#l3.494"></a><span id="l3.494">       return tabManager.getWrapper(nativeTabInfo);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-tabs.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-tabs.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2,36 +2,36 @@</span>
<a href="#l4.4"></a><span id="l4.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.5"></a><span id="l4.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> ChromeUtils.defineModuleGetter(this, &quot;PromiseUtils&quot;,</span>
<a href="#l4.8"></a><span id="l4.8">                                &quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l4.9"></a><span id="l4.9"> var { ExtensionError } = ExtensionUtils;</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11"> /**</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- * A listener that allows waiting until tabs are fully loaded, e.g. off of about:blank</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+ * A listener that allows waiting until tabs are fully loaded, e.g. off of about:blank.</span>
<a href="#l4.14"></a><span id="l4.14">  */</span>
<a href="#l4.15"></a><span id="l4.15"> let tabListener = {</span>
<a href="#l4.16"></a><span id="l4.16">   tabReadyInitialized: false,</span>
<a href="#l4.17"></a><span id="l4.17">   tabReadyPromises: new WeakMap(),</span>
<a href="#l4.18"></a><span id="l4.18">   initializingTabs: new WeakSet(),</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">   /**</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-   * Initialize the progress listener for tab ready changes</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+   * Initialize the progress listener for tab ready changes.</span>
<a href="#l4.23"></a><span id="l4.23">    */</span>
<a href="#l4.24"></a><span id="l4.24">   initTabReady() {</span>
<a href="#l4.25"></a><span id="l4.25">     if (!this.tabReadyInitialized) {</span>
<a href="#l4.26"></a><span id="l4.26">       windowTracker.addListener(&quot;progress&quot;, this);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">       this.tabReadyInitialized = true;</span>
<a href="#l4.29"></a><span id="l4.29">     }</span>
<a href="#l4.30"></a><span id="l4.30">   },</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">   /**</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-   * Web Progress listener method for the location change</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+   * Web Progress listener method for the location change.</span>
<a href="#l4.35"></a><span id="l4.35">    *</span>
<a href="#l4.36"></a><span id="l4.36">    * @param {Element} browser               The browser element that caused the change</span>
<a href="#l4.37"></a><span id="l4.37">    * @param {nsIWebProgress} webProgress    The web progress for the location change</span>
<a href="#l4.38"></a><span id="l4.38">    * @param {nsIRequest} request            The xpcom request for this change</span>
<a href="#l4.39"></a><span id="l4.39">    * @param {nsIURI} locationURI            The target uri</span>
<a href="#l4.40"></a><span id="l4.40">    * @param {Integer} flags                 The web progress flags for this change</span>
<a href="#l4.41"></a><span id="l4.41">    */</span>
<a href="#l4.42"></a><span id="l4.42">   onLocationChange(browser, webProgress, request, locationURI, flags) {</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineat">@@ -47,17 +47,17 @@ let tabListener = {</span>
<a href="#l4.44"></a><span id="l4.44">       if (deferred) {</span>
<a href="#l4.45"></a><span id="l4.45">         deferred.resolve(nativeTabInfo);</span>
<a href="#l4.46"></a><span id="l4.46">         this.tabReadyPromises.delete(nativeTabInfo);</span>
<a href="#l4.47"></a><span id="l4.47">       }</span>
<a href="#l4.48"></a><span id="l4.48">     }</span>
<a href="#l4.49"></a><span id="l4.49">   },</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51">   /**</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-   * Promise that the given tab completes loading</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+   * Promise that the given tab completes loading.</span>
<a href="#l4.54"></a><span id="l4.54">    *</span>
<a href="#l4.55"></a><span id="l4.55">    * @param {NativeTabInfo} nativeTabInfo       The tabInfo describing the tab</span>
<a href="#l4.56"></a><span id="l4.56">    * @return {Promise&lt;NativeTabInfo&gt;}           Resolves when the tab completes loading</span>
<a href="#l4.57"></a><span id="l4.57">    */</span>
<a href="#l4.58"></a><span id="l4.58">   awaitTabReady(nativeTabInfo) {</span>
<a href="#l4.59"></a><span id="l4.59">     let deferred = this.tabReadyPromises.get(nativeTabInfo);</span>
<a href="#l4.60"></a><span id="l4.60">     if (!deferred) {</span>
<a href="#l4.61"></a><span id="l4.61">       deferred = PromiseUtils.defer();</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineat">@@ -69,27 +69,27 @@ let tabListener = {</span>
<a href="#l4.63"></a><span id="l4.63">         this.initTabReady();</span>
<a href="#l4.64"></a><span id="l4.64">         this.tabReadyPromises.set(nativeTabInfo, deferred);</span>
<a href="#l4.65"></a><span id="l4.65">       }</span>
<a href="#l4.66"></a><span id="l4.66">     }</span>
<a href="#l4.67"></a><span id="l4.67">     return deferred.promise;</span>
<a href="#l4.68"></a><span id="l4.68">   }</span>
<a href="#l4.69"></a><span id="l4.69"> };</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-// Attributes and properties used in the TabsUpdateFilterManager</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+// Attributes and properties used in the TabsUpdateFilterManager.</span>
<a href="#l4.73"></a><span id="l4.73"> const allAttrs = new Set([&quot;favIconUrl&quot;, &quot;title&quot;]);</span>
<a href="#l4.74"></a><span id="l4.74"> const allProperties = new Set([</span>
<a href="#l4.75"></a><span id="l4.75">   &quot;favIconUrl&quot;,</span>
<a href="#l4.76"></a><span id="l4.76">   &quot;status&quot;,</span>
<a href="#l4.77"></a><span id="l4.77">   &quot;title&quot;,</span>
<a href="#l4.78"></a><span id="l4.78"> ]);</span>
<a href="#l4.79"></a><span id="l4.79"> const restricted = new Set([&quot;url&quot;, &quot;favIconUrl&quot;, &quot;title&quot;]);</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81"> /**</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">- * An EventManager for the tabs.onUpdated listener</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+ * An EventManager for the tabs.onUpdated listener.</span>
<a href="#l4.84"></a><span id="l4.84">  */</span>
<a href="#l4.85"></a><span id="l4.85"> class TabsUpdateFilterEventManager extends EventManager {</span>
<a href="#l4.86"></a><span id="l4.86">   constructor(context) {</span>
<a href="#l4.87"></a><span id="l4.87">     let { extension } = context;</span>
<a href="#l4.88"></a><span id="l4.88">     let { tabManager } = extension;</span>
<a href="#l4.89"></a><span id="l4.89"> </span>
<a href="#l4.90"></a><span id="l4.90">     let register = (fire, filterProps) =&gt; {</span>
<a href="#l4.91"></a><span id="l4.91">       let filter = { ...filterProps };</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineat">@@ -225,30 +225,30 @@ class TabsUpdateFilterEventManager exten</span>
<a href="#l4.93"></a><span id="l4.93"> }</span>
<a href="#l4.94"></a><span id="l4.94"> </span>
<a href="#l4.95"></a><span id="l4.95"> this.tabs = class extends ExtensionAPI {</span>
<a href="#l4.96"></a><span id="l4.96">   getAPI(context) {</span>
<a href="#l4.97"></a><span id="l4.97">     let { extension } = context;</span>
<a href="#l4.98"></a><span id="l4.98">     let { tabManager } = extension;</span>
<a href="#l4.99"></a><span id="l4.99"> </span>
<a href="#l4.100"></a><span id="l4.100">     /**</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-     * Gets the tab for the given tab id, or the active tab if the id is null</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+     * Gets the tab for the given tab id, or the active tab if the id is null.</span>
<a href="#l4.103"></a><span id="l4.103">      *</span>
<a href="#l4.104"></a><span id="l4.104">      * @param {?Integer} tabId          The tab id to get</span>
<a href="#l4.105"></a><span id="l4.105">      * @return {Tab}                    The matching tab, or the active tab</span>
<a href="#l4.106"></a><span id="l4.106">      */</span>
<a href="#l4.107"></a><span id="l4.107">     function getTabOrActive(tabId) {</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-      if (tabId !== null) {</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+      if (tabId) {</span>
<a href="#l4.110"></a><span id="l4.110">         return tabTracker.getTab(tabId);</span>
<a href="#l4.111"></a><span id="l4.111">       }</span>
<a href="#l4.112"></a><span id="l4.112">       return tabTracker.activeTab;</span>
<a href="#l4.113"></a><span id="l4.113">     }</span>
<a href="#l4.114"></a><span id="l4.114"> </span>
<a href="#l4.115"></a><span id="l4.115">     /**</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-     * Promise that the tab with the given tab id is ready</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+     * Promise that the tab with the given tab id is ready.</span>
<a href="#l4.118"></a><span id="l4.118">      *</span>
<a href="#l4.119"></a><span id="l4.119">      * @param {Integer} tabId       The tab id to check</span>
<a href="#l4.120"></a><span id="l4.120">      * @return {Promise&lt;NativeTabInfo&gt;}     Resolved when the loading is complete</span>
<a href="#l4.121"></a><span id="l4.121">      */</span>
<a href="#l4.122"></a><span id="l4.122">     async function promiseTabWhenReady(tabId) {</span>
<a href="#l4.123"></a><span id="l4.123">       let tab;</span>
<a href="#l4.124"></a><span id="l4.124">       if (tabId === null) {</span>
<a href="#l4.125"></a><span id="l4.125">         tab = tabManager.getWrapper(tabTracker.activeTab);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineat">@@ -365,46 +365,46 @@ this.tabs = class extends ExtensionAPI {</span>
<a href="#l4.127"></a><span id="l4.127"> </span>
<a href="#l4.128"></a><span id="l4.128">         async create(createProperties) {</span>
<a href="#l4.129"></a><span id="l4.129">           let window = createProperties.windowId === null</span>
<a href="#l4.130"></a><span id="l4.130">               ? windowTracker.topNormalWindow</span>
<a href="#l4.131"></a><span id="l4.131">               : windowTracker.getWindow(createProperties.windowId, context);</span>
<a href="#l4.132"></a><span id="l4.132">           let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.133"></a><span id="l4.133"> </span>
<a href="#l4.134"></a><span id="l4.134">           let url;</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-          if (createProperties.url !== null) {</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+          if (createProperties.url) {</span>
<a href="#l4.137"></a><span id="l4.137">             url = context.uri.resolve(createProperties.url);</span>
<a href="#l4.138"></a><span id="l4.138"> </span>
<a href="#l4.139"></a><span id="l4.139">             if (!context.checkLoadURL(url, { dontReportErrors: true })) {</span>
<a href="#l4.140"></a><span id="l4.140">               return Promise.reject({ message: `Illegal URL: ${url}` });</span>
<a href="#l4.141"></a><span id="l4.141">             }</span>
<a href="#l4.142"></a><span id="l4.142">           }</span>
<a href="#l4.143"></a><span id="l4.143"> </span>
<a href="#l4.144"></a><span id="l4.144">           let currentTab = tabmail.selectedTab;</span>
<a href="#l4.145"></a><span id="l4.145"> </span>
<a href="#l4.146"></a><span id="l4.146">           let active = true;</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-          if (createProperties.active !== null) {</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+          if (createProperties.active) {</span>
<a href="#l4.149"></a><span id="l4.149">             active = createProperties.active;</span>
<a href="#l4.150"></a><span id="l4.150">           }</span>
<a href="#l4.151"></a><span id="l4.151"> </span>
<a href="#l4.152"></a><span id="l4.152">           tabListener.initTabReady();</span>
<a href="#l4.153"></a><span id="l4.153"> </span>
<a href="#l4.154"></a><span id="l4.154">           let nativeTabInfo = tabmail.openTab(&quot;contentTab&quot;, {</span>
<a href="#l4.155"></a><span id="l4.155">             contentPage: url || &quot;about:blank&quot;,</span>
<a href="#l4.156"></a><span id="l4.156">             background: !active</span>
<a href="#l4.157"></a><span id="l4.157">           });</span>
<a href="#l4.158"></a><span id="l4.158"> </span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-          if (createProperties.index !== null) {</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+          if (createProperties.index) {</span>
<a href="#l4.161"></a><span id="l4.161">             tabmail.moveTabTo(nativeTabInfo, createProperties.index);</span>
<a href="#l4.162"></a><span id="l4.162">             tabmail.updateCurrentTab();</span>
<a href="#l4.163"></a><span id="l4.163">           }</span>
<a href="#l4.164"></a><span id="l4.164"> </span>
<a href="#l4.165"></a><span id="l4.165">           if (createProperties.url &amp;&amp; createProperties.url !== &quot;about:blank&quot;) {</span>
<a href="#l4.166"></a><span id="l4.166">             // Mark tabs as initializing, so operations like `executeScript` wait until the</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-            // requested URL is loaded</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+            // requested URL is loaded.</span>
<a href="#l4.169"></a><span id="l4.169">             tabListener.initializingTabs.add(nativeTabInfo);</span>
<a href="#l4.170"></a><span id="l4.170">           }</span>
<a href="#l4.171"></a><span id="l4.171"> </span>
<a href="#l4.172"></a><span id="l4.172">           return tabManager.convert(nativeTabInfo, currentTab);</span>
<a href="#l4.173"></a><span id="l4.173">         },</span>
<a href="#l4.174"></a><span id="l4.174"> </span>
<a href="#l4.175"></a><span id="l4.175">         async remove(tabs) {</span>
<a href="#l4.176"></a><span id="l4.176">           if (!Array.isArray(tabs)) {</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineat">@@ -419,33 +419,33 @@ this.tabs = class extends ExtensionAPI {</span>
<a href="#l4.178"></a><span id="l4.178">           }</span>
<a href="#l4.179"></a><span id="l4.179">         },</span>
<a href="#l4.180"></a><span id="l4.180"> </span>
<a href="#l4.181"></a><span id="l4.181">         async update(tabId, updateProperties) {</span>
<a href="#l4.182"></a><span id="l4.182">           let nativeTabInfo = getTabOrActive(tabId);</span>
<a href="#l4.183"></a><span id="l4.183">           let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l4.184"></a><span id="l4.184">           let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.185"></a><span id="l4.185"> </span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-          if (updateProperties.url !== null) {</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+          if (updateProperties.url) {</span>
<a href="#l4.188"></a><span id="l4.188">             let url = context.uri.resolve(updateProperties.url);</span>
<a href="#l4.189"></a><span id="l4.189"> </span>
<a href="#l4.190"></a><span id="l4.190">             if (!context.checkLoadURL(url, { dontReportErrors: true })) {</span>
<a href="#l4.191"></a><span id="l4.191">               return Promise.reject({ message: `Illegal URL: ${url}` });</span>
<a href="#l4.192"></a><span id="l4.192">             }</span>
<a href="#l4.193"></a><span id="l4.193"> </span>
<a href="#l4.194"></a><span id="l4.194">             let options = {</span>
<a href="#l4.195"></a><span id="l4.195">               flags: updateProperties.loadReplace</span>
<a href="#l4.196"></a><span id="l4.196">                       ? Ci.nsIWebNavigation.LOAD_FLAGS_REPLACE_HISTORY</span>
<a href="#l4.197"></a><span id="l4.197">                       : Ci.nsIWebNavigation.LOAD_FLAGS_NONE,</span>
<a href="#l4.198"></a><span id="l4.198">               triggeringPrincipal: context.principal,</span>
<a href="#l4.199"></a><span id="l4.199">             };</span>
<a href="#l4.200"></a><span id="l4.200">             browser.loadURI(url, options);</span>
<a href="#l4.201"></a><span id="l4.201">           }</span>
<a href="#l4.202"></a><span id="l4.202"> </span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-          if (updateProperties.active !== null) {</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineplus">+          if (updateProperties.active) {</span>
<a href="#l4.205"></a><span id="l4.205">             if (updateProperties.active) {</span>
<a href="#l4.206"></a><span id="l4.206">               tabmail.selectedTab = nativeTabInfo;</span>
<a href="#l4.207"></a><span id="l4.207">             } else {</span>
<a href="#l4.208"></a><span id="l4.208">               // Not sure what to do here? Which tab should we select?</span>
<a href="#l4.209"></a><span id="l4.209">             }</span>
<a href="#l4.210"></a><span id="l4.210">           }</span>
<a href="#l4.211"></a><span id="l4.211"> </span>
<a href="#l4.212"></a><span id="l4.212">           return tabManager.convert(nativeTabInfo);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineat">@@ -471,31 +471,31 @@ this.tabs = class extends ExtensionAPI {</span>
<a href="#l4.214"></a><span id="l4.214">           if (context.tabId) {</span>
<a href="#l4.215"></a><span id="l4.215">             tabData = tabManager.get(context.tabId).convert();</span>
<a href="#l4.216"></a><span id="l4.216">           }</span>
<a href="#l4.217"></a><span id="l4.217">           return Promise.resolve(tabData);</span>
<a href="#l4.218"></a><span id="l4.218">         },</span>
<a href="#l4.219"></a><span id="l4.219"> </span>
<a href="#l4.220"></a><span id="l4.220">         async query(queryInfo) {</span>
<a href="#l4.221"></a><span id="l4.221">           if (!extension.hasPermission(&quot;tabs&quot;)) {</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-            if (queryInfo.url !== null || queryInfo.title !== null) {</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+            if (queryInfo.url || queryInfo.title) {</span>
<a href="#l4.224"></a><span id="l4.224">               return Promise.reject({ message: 'The &quot;tabs&quot; permission is required to use the query API with the &quot;url&quot; or &quot;title&quot; parameters' });</span>
<a href="#l4.225"></a><span id="l4.225">             }</span>
<a href="#l4.226"></a><span id="l4.226">           }</span>
<a href="#l4.227"></a><span id="l4.227"> </span>
<a href="#l4.228"></a><span id="l4.228">           queryInfo = Object.assign({}, queryInfo);</span>
<a href="#l4.229"></a><span id="l4.229"> </span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-          if (queryInfo.url !== null) {</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+          if (queryInfo.url) {</span>
<a href="#l4.232"></a><span id="l4.232">             queryInfo.url = new MatchPatternSet([].concat(queryInfo.url));</span>
<a href="#l4.233"></a><span id="l4.233">           }</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-          if (queryInfo.title !== null) {</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+          if (queryInfo.title) {</span>
<a href="#l4.236"></a><span id="l4.236">             queryInfo.title = new MatchGlob(queryInfo.title);</span>
<a href="#l4.237"></a><span id="l4.237">           }</span>
<a href="#l4.238"></a><span id="l4.238"> </span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-          // Make ext-tabs-base happy since it does a strict check</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+          // Make ext-tabs-base happy since it does a strict check.</span>
<a href="#l4.241"></a><span id="l4.241">           queryInfo.screen = null;</span>
<a href="#l4.242"></a><span id="l4.242"> </span>
<a href="#l4.243"></a><span id="l4.243">           return Array.from(tabManager.query(queryInfo, context), tab =&gt; tab.convert());</span>
<a href="#l4.244"></a><span id="l4.244">         },</span>
<a href="#l4.245"></a><span id="l4.245"> </span>
<a href="#l4.246"></a><span id="l4.246">         async executeScript(tabId, details) {</span>
<a href="#l4.247"></a><span id="l4.247">           // TODO make this work</span>
<a href="#l4.248"></a><span id="l4.248">           let tab = await promiseTabWhenReady(tabId);</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineat">@@ -519,17 +519,17 @@ this.tabs = class extends ExtensionAPI {</span>
<a href="#l4.250"></a><span id="l4.250"> </span>
<a href="#l4.251"></a><span id="l4.251">         async move(tabIds, moveProperties) {</span>
<a href="#l4.252"></a><span id="l4.252">           let tabsMoved = [];</span>
<a href="#l4.253"></a><span id="l4.253">           if (!Array.isArray(tabIds)) {</span>
<a href="#l4.254"></a><span id="l4.254">             tabIds = [tabIds];</span>
<a href="#l4.255"></a><span id="l4.255">           }</span>
<a href="#l4.256"></a><span id="l4.256"> </span>
<a href="#l4.257"></a><span id="l4.257">           let destinationWindow = null;</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-          if (moveProperties.windowId !== null) {</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+          if (moveProperties.windowId) {</span>
<a href="#l4.260"></a><span id="l4.260">             destinationWindow = windowTracker.getWindow(moveProperties.windowId);</span>
<a href="#l4.261"></a><span id="l4.261">             // Fail on an invalid window.</span>
<a href="#l4.262"></a><span id="l4.262">             if (!destinationWindow) {</span>
<a href="#l4.263"></a><span id="l4.263">               return Promise.reject({ message: `Invalid window ID: ${moveProperties.windowId}` });</span>
<a href="#l4.264"></a><span id="l4.264">             }</span>
<a href="#l4.265"></a><span id="l4.265">           }</span>
<a href="#l4.266"></a><span id="l4.266"> </span>
<a href="#l4.267"></a><span id="l4.267">           /*</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-windows.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-windows.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -61,32 +61,29 @@ this.windows = class extends ExtensionAP</span>
<a href="#l5.4"></a><span id="l5.4">         },</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">         getLastFocused: function(getInfo) {</span>
<a href="#l5.7"></a><span id="l5.7">           let window = windowTracker.topWindow;</span>
<a href="#l5.8"></a><span id="l5.8">           return Promise.resolve(windowManager.convert(window, getInfo));</span>
<a href="#l5.9"></a><span id="l5.9">         },</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">         getAll: function(getInfo) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          let doNotCheckTypes = getInfo === null || getInfo.windowTypes === null;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+          let doNotCheckTypes = !getInfo || !getInfo.windowTypes;</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-          function typeFilter(win) {</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-            return doNotCheckTypes || getInfo.windowTypes.includes(win.type);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-          }</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-          let windows = Array.from(windowManager.getAll(), win =&gt; win.convert(getInfo)).filter(typeFilter);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+          let windows = Array.from(windowManager.getAll(), win =&gt; win.convert(getInfo))</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+            .filter(win =&gt; doNotCheckTypes || getInfo.windowTypes.includes(win.type));</span>
<a href="#l5.22"></a><span id="l5.22">           return Promise.resolve(windows);</span>
<a href="#l5.23"></a><span id="l5.23">         },</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">         create: function(createData) {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-          let needResize = (createData.left !== null || createData.top !== null ||</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-                            createData.width !== null || createData.height !== null);</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+          let needResize = (createData.left || createData.top ||</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+                            createData.width || createData.height);</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31">           if (needResize) {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-            if (createData.state !== null &amp;&amp; createData.state != &quot;normal&quot;) {</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+            if (createData.state &amp;&amp; createData.state != &quot;normal&quot;) {</span>
<a href="#l5.34"></a><span id="l5.34">               return Promise.reject({ message: `&quot;state&quot;: &quot;${createData.state}&quot; may not be combined with &quot;left&quot;, &quot;top&quot;, &quot;width&quot;, or &quot;height&quot;` });</span>
<a href="#l5.35"></a><span id="l5.35">             }</span>
<a href="#l5.36"></a><span id="l5.36">             createData.state = &quot;normal&quot;;</span>
<a href="#l5.37"></a><span id="l5.37">           }</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">           let createWindowArgs = (urls) =&gt; {</span>
<a href="#l5.40"></a><span id="l5.40">             let args = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l5.41"></a><span id="l5.41">             let actionData = {</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineat">@@ -113,30 +110,30 @@ this.windows = class extends ExtensionAP</span>
<a href="#l5.43"></a><span id="l5.43">             // All other types create &quot;popup&quot;-type windows by default.</span>
<a href="#l5.44"></a><span id="l5.44">             features.push(&quot;dialog&quot;, &quot;resizable&quot;, &quot;minimizable&quot;, &quot;centerscreen&quot;, &quot;titlebar&quot;, &quot;close&quot;);</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">             if (createData.incognito) {</span>
<a href="#l5.47"></a><span id="l5.47">               features.push(&quot;private&quot;);</span>
<a href="#l5.48"></a><span id="l5.48">             }</span>
<a href="#l5.49"></a><span id="l5.49">           }</span>
<a href="#l5.50"></a><span id="l5.50"> </span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-          if (createData.tabId !== null) {</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-            if (createData.url !== null) {</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+          if (createData.tabId) {</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+            if (createData.url) {</span>
<a href="#l5.55"></a><span id="l5.55">               return Promise.reject({ message: &quot;`tabId` may not be used in conjunction with `url`&quot; });</span>
<a href="#l5.56"></a><span id="l5.56">             }</span>
<a href="#l5.57"></a><span id="l5.57"> </span>
<a href="#l5.58"></a><span id="l5.58">             if (createData.allowScriptsToClose) {</span>
<a href="#l5.59"></a><span id="l5.59">               return Promise.reject({ message: &quot;`tabId` may not be used in conjunction with `allowScriptsToClose`&quot; });</span>
<a href="#l5.60"></a><span id="l5.60">             }</span>
<a href="#l5.61"></a><span id="l5.61"> </span>
<a href="#l5.62"></a><span id="l5.62">             let nativeTabInfo = tabTracker.getTab(createData.tabId);</span>
<a href="#l5.63"></a><span id="l5.63">             let tabmail = getTabBrowser(nativeTabInfo).ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l5.64"></a><span id="l5.64">             let targetType = wantNormalWindow ? null : &quot;popup&quot;;</span>
<a href="#l5.65"></a><span id="l5.65">             window = tabmail.replaceTabWithWindow(nativeTabInfo, targetType)[0];</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-          } else if (createData.url !== null) { // eslint-disable-line no-negated-condition</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+          } else if (createData.url) {</span>
<a href="#l5.68"></a><span id="l5.68">             let uris = Array.isArray(createData.url) ? createData.url : [createData.url];</span>
<a href="#l5.69"></a><span id="l5.69">             let args = createWindowArgs(uris);</span>
<a href="#l5.70"></a><span id="l5.70">             window = Services.ww.openWindow(null, &quot;chrome://messenger/content/&quot;, &quot;_blank&quot;, features.join(&quot;,&quot;), args);</span>
<a href="#l5.71"></a><span id="l5.71">           } else {</span>
<a href="#l5.72"></a><span id="l5.72">             let args = null;</span>
<a href="#l5.73"></a><span id="l5.73">             if (!wantNormalWindow) {</span>
<a href="#l5.74"></a><span id="l5.74">               args = createWindowArgs([&quot;about:blank&quot;]);</span>
<a href="#l5.75"></a><span id="l5.75">             }</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineat">@@ -156,40 +153,40 @@ this.windows = class extends ExtensionAP</span>
<a href="#l5.77"></a><span id="l5.77">             if ([&quot;minimized&quot;, &quot;fullscreen&quot;, &quot;docked&quot;, &quot;normal&quot;, &quot;maximized&quot;].includes(createData.state)) {</span>
<a href="#l5.78"></a><span id="l5.78">               win.state = createData.state;</span>
<a href="#l5.79"></a><span id="l5.79">             }</span>
<a href="#l5.80"></a><span id="l5.80">             return win.convert({ populate: true });</span>
<a href="#l5.81"></a><span id="l5.81">           });</span>
<a href="#l5.82"></a><span id="l5.82">         },</span>
<a href="#l5.83"></a><span id="l5.83"> </span>
<a href="#l5.84"></a><span id="l5.84">         update: function(windowId, updateInfo) {</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-          if (updateInfo.state !== null &amp;&amp; updateInfo.state != &quot;normal&quot;) {</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-            if (updateInfo.left !== null || updateInfo.top !== null ||</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-                updateInfo.width !== null || updateInfo.height !== null) {</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+          if (updateInfo.state &amp;&amp; updateInfo.state != &quot;normal&quot;) {</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+            if (updateInfo.left || updateInfo.top ||</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+                updateInfo.width || updateInfo.height) {</span>
<a href="#l5.91"></a><span id="l5.91">               return Promise.reject({ message: `&quot;state&quot;: &quot;${updateInfo.state}&quot; may not be combined with &quot;left&quot;, &quot;top&quot;, &quot;width&quot;, or &quot;height&quot;` });</span>
<a href="#l5.92"></a><span id="l5.92">             }</span>
<a href="#l5.93"></a><span id="l5.93">           }</span>
<a href="#l5.94"></a><span id="l5.94"> </span>
<a href="#l5.95"></a><span id="l5.95">           let win = windowManager.get(windowId, context);</span>
<a href="#l5.96"></a><span id="l5.96">           if (updateInfo.focused) {</span>
<a href="#l5.97"></a><span id="l5.97">             Services.focus.activeWindow = win.window;</span>
<a href="#l5.98"></a><span id="l5.98">           }</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-          if (updateInfo.state !== null) {</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+          if (updateInfo.state) {</span>
<a href="#l5.102"></a><span id="l5.102">             win.state = updateInfo.state;</span>
<a href="#l5.103"></a><span id="l5.103">           }</span>
<a href="#l5.104"></a><span id="l5.104"> </span>
<a href="#l5.105"></a><span id="l5.105">           if (updateInfo.drawAttention) {</span>
<a href="#l5.106"></a><span id="l5.106">             // Bug 1257497 - Firefox can't cancel attention actions.</span>
<a href="#l5.107"></a><span id="l5.107">             win.window.getAttention();</span>
<a href="#l5.108"></a><span id="l5.108">           }</span>
<a href="#l5.109"></a><span id="l5.109"> </span>
<a href="#l5.110"></a><span id="l5.110">           win.updateGeometry(updateInfo);</span>
<a href="#l5.111"></a><span id="l5.111"> </span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-          if (updateInfo.titlePreface !== null) {</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+          if (updateInfo.titlePreface) {</span>
<a href="#l5.114"></a><span id="l5.114">             win.setTitlePreface(updateInfo.titlePreface);</span>
<a href="#l5.115"></a><span id="l5.115">             win.window.gBrowser.updateTitlebar();</span>
<a href="#l5.116"></a><span id="l5.116">           }</span>
<a href="#l5.117"></a><span id="l5.117"> </span>
<a href="#l5.118"></a><span id="l5.118">           // TODO: All the other properties, focused=false...</span>
<a href="#l5.119"></a><span id="l5.119"> </span>
<a href="#l5.120"></a><span id="l5.120">           return Promise.resolve(win.convert());</span>
<a href="#l5.121"></a><span id="l5.121">         },</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

