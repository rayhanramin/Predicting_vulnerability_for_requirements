<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20072:ff506e40c3a28846acd5313c8c93fe45bf30db8f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ff506e40c3a28846acd5313c8c93fe45bf30db8f" />
<meta property="og:url" content="/comm-central/rev/ff506e40c3a28846acd5313c8c93fe45bf30db8f" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable no-lonely-if rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ff506e40c3a28846acd5313c8c93fe45bf30db8f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ff506e40c3a28846acd5313c8c93fe45bf30db8f">shortlog</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ff506e40c3a28846acd5313c8c93fe45bf30db8f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f">files</a> |
changeset |
<a href="/comm-central/raw-rev/ff506e40c3a28846acd5313c8c93fe45bf30db8f">raw</a>  | <a href="/comm-central/archive/ff506e40c3a28846acd5313c8c93fe45bf30db8f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-lonely-if rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 14:05:54 +0200</td></tr>

<tr>
 <td>changeset 20072</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ff506e40c3a28846acd5313c8c93fe45bf30db8f">ff506e40c3a28846acd5313c8c93fe45bf30db8f</a></td>
</tr>



<tr>
<td>parent 20071</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3d474ac6379c7c7278e3d41fb40437d95b9f7470">3d474ac6379c7c7278e3d41fb40437d95b9f7470</a>
</td>
</tr>

<tr>
<td>child 20073</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2f2abb3fd4c9a47993c5861ed22d6d9f924c5480">2f2abb3fd4c9a47993c5861ed22d6d9f924c5480</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ff506e40c3a28846acd5313c8c93fe45bf30db8f">12308</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:23:00 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@3795d24fc794 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3795d24fc794dfd470961e3425aa3e056e2cd1e4">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=3795d24fc794dfd470961e3425aa3e056e2cd1e4&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3795d24fc794dfd470961e3425aa3e056e2cd1e4&newProject=comm-central&newRevision=3d474ac6379c7c7278e3d41fb40437d95b9f7470&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3795d24fc794dfd470961e3425aa3e056e2cd1e4&newProject=comm-central&newRevision=3d474ac6379c7c7278e3d41fb40437d95b9f7470&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=3795d24fc794dfd470961e3425aa3e056e2cd1e4&newProject=comm-central&newRevision=3d474ac6379c7c7278e3d41fb40437d95b9f7470&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-lonely-if rule. r=MakeMyDay

MozReview-Commit-ID: 5CSRa1woomx</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/agenda-listbox.xml">calendar/base/content/agenda-listbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/agenda-listbox.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/agenda-listbox.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/agenda-listbox.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/agenda-listbox.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/agenda-listbox.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-list-tree.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calEvent.js">calendar/base/src/calEvent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calEvent.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calEvent.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calEvent.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calEvent.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calEvent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/test/unit/test_alarm.js">calendar/test/unit/test_alarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/test/unit/test_alarm.js">file</a> |
<a href="/comm-central/annotate/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/test/unit/test_alarm.js">annotate</a> |
<a href="/comm-central/diff/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/test/unit/test_alarm.js">diff</a> |
<a href="/comm-central/comparison/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/test/unit/test_alarm.js">comparison</a> |
<a href="/comm-central/log/ff506e40c3a28846acd5313c8c93fe45bf30db8f/calendar/test/unit/test_alarm.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -358,18 +358,20 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">     // Restricts the use of parentheses to only where they are necessary</span>
<a href="#l1.6"></a><span id="l1.6">     // Disabled for now since this also removes parens around assignments, e.g. let foo = bar == baz</span>
<a href="#l1.7"></a><span id="l1.7">     // &quot;no-extra-parens&quot;: [2, &quot;all&quot;, { &quot;conditionalAssign&quot;: false, &quot;returnAssign&quot;: false, &quot;nestedBinaryExpressions&quot;: false }],</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Double quotes should be used.</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;quotes&quot;: [2, &quot;double&quot;, { &quot;avoidEscape&quot;: true }],</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Disallow if as the only statement in an else block.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;no-lonely-if&quot;: 2,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // Will enable these rules later</span>
<a href="#l1.16"></a><span id="l1.16">     &quot;block-spacing&quot;: 0,</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-    &quot;no-lonely-if&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">     &quot;computed-property-spacing&quot;: 0,</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.21"></a><span id="l1.21">     // easier updates in the future.</span>
<a href="#l1.22"></a><span id="l1.22">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.23"></a><span id="l1.23">   }</span>
<a href="#l1.24"></a><span id="l1.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -65,22 +65,20 @@</span>
<a href="#l2.4"></a><span id="l2.4">                 this.kCheckbox.label = this.getAttribute(&quot;title&quot;);</span>
<a href="#l2.5"></a><span id="l2.5">                 if (this.id == &quot;nextweek-header&quot;) {</span>
<a href="#l2.6"></a><span id="l2.6">                     if (duration &gt; 7) {</span>
<a href="#l2.7"></a><span id="l2.7">                         this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration / 7, &quot;weeks&quot;) + &quot;)&quot;;</span>
<a href="#l2.8"></a><span id="l2.8">                     } else {</span>
<a href="#l2.9"></a><span id="l2.9">                         this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration, &quot;days&quot;) + &quot;)&quot;;</span>
<a href="#l2.10"></a><span id="l2.10">                     }</span>
<a href="#l2.11"></a><span id="l2.11">                 }</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+            } else if (synthetic.duration == 1) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                this.kCheckbox.label = getDateFormatter().formatDate(synthetic.start);</span>
<a href="#l2.14"></a><span id="l2.14">             } else {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                if (synthetic.duration == 1) {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                    this.kCheckbox.label = getDateFormatter().formatDate(synthetic.start);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                } else {</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-                    this.kCheckbox.label = getDateFormatter().formatInterval(synthetic.start, synthetic.end);</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-                }</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+                this.kCheckbox.label = getDateFormatter().formatInterval(synthetic.start, synthetic.end);</span>
<a href="#l2.21"></a><span id="l2.21">             }</span>
<a href="#l2.22"></a><span id="l2.22">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.23"></a><span id="l2.23">       &lt;/method&gt;</span>
<a href="#l2.24"></a><span id="l2.24">       &lt;method name=&quot;getCheckbox&quot;&gt;</span>
<a href="#l2.25"></a><span id="l2.25">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l2.26"></a><span id="l2.26">             return this.kCheckbox;</span>
<a href="#l2.27"></a><span id="l2.27">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.28"></a><span id="l2.28">       &lt;/method&gt;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineat">@@ -224,37 +222,36 @@</span>
<a href="#l2.30"></a><span id="l2.30">             let longFormat = aPeriod.multiday || aPeriod.duration &gt; 1;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">             let duration = &quot;&quot;;</span>
<a href="#l2.33"></a><span id="l2.33">             let iconType = &quot;&quot;;</span>
<a href="#l2.34"></a><span id="l2.34">             if (startDate.compare(endDate) == 0) {</span>
<a href="#l2.35"></a><span id="l2.35">                 // event that starts and ends in the same day, midnight included</span>
<a href="#l2.36"></a><span id="l2.36">                 duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l2.37"></a><span id="l2.37">                                       : dateFormatter.formatTime(start);</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+            } else if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+                       startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+                // event spanning multiple days, start date within period</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+                iconType = &quot;start&quot;;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+                duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+                                      : dateFormatter.formatTime(start);</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+            } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+                       endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+                // event spanning multiple days, end date within period</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+                iconType = &quot;end&quot;;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+                if (endAtMidnight) {</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+                    duration = dateFormatter.formatDate(endDate) + &quot; &quot;;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+                    duration = longFormat ? duration + calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;)</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+                                          : calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+                } else {</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                    duration = longFormat ? dateFormatter.formatDateTime(end)</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+                                          : dateFormatter.formatTime(end);</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+                }</span>
<a href="#l2.56"></a><span id="l2.56">             } else {</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-                // event spanning multiple days</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-                if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-                     startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-                    iconType = &quot;start&quot;;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-                    duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-                                          : dateFormatter.formatTime(start);</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-                } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-                           endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-                    iconType = &quot;end&quot;;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-                    if (endAtMidnight) {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-                        duration = dateFormatter.formatDate(endDate) + &quot; &quot;;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-                        duration = longFormat ? duration + calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;)</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-                                              : calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-                    } else {</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-                        duration = longFormat ? dateFormatter.formatDateTime(end)</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-                                              : dateFormatter.formatTime(end);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-                    }</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-                } else {</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-                    iconType = &quot;continue&quot;;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-                }</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+                iconType = &quot;continue&quot;;</span>
<a href="#l2.78"></a><span id="l2.78">             }</span>
<a href="#l2.79"></a><span id="l2.79">             let multiDayImage = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-multiDayEvent-image&quot;);</span>
<a href="#l2.80"></a><span id="l2.80">             multiDayImage.setAttribute(&quot;type&quot;, iconType);</span>
<a href="#l2.81"></a><span id="l2.81">             let durationbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-event-start&quot;);</span>
<a href="#l2.82"></a><span id="l2.82">             durationbox.textContent = duration;</span>
<a href="#l2.83"></a><span id="l2.83"> </span>
<a href="#l2.84"></a><span id="l2.84">             // show items with time only (today &amp; tomorrow) as one line.</span>
<a href="#l2.85"></a><span id="l2.85">             if (longFormat) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -95,22 +95,20 @@</span>
<a href="#l3.4"></a><span id="l3.4">               if (startTime.compare(parentDate) == -1) {</span>
<a href="#l3.5"></a><span id="l3.5">                 if (comp == 1) {</span>
<a href="#l3.6"></a><span id="l3.6">                   label.value = &quot;↔&quot;;</span>
<a href="#l3.7"></a><span id="l3.7">                 } else if (comp == 0) {</span>
<a href="#l3.8"></a><span id="l3.8">                   label.value = &quot;↤&quot;;</span>
<a href="#l3.9"></a><span id="l3.9">                 } else {</span>
<a href="#l3.10"></a><span id="l3.10">                   label.value = &quot;⇥ &quot; + df.formatTime(endTime);</span>
<a href="#l3.11"></a><span id="l3.11">                 }</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+              } else if (comp == 1) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                label.value = &quot;⇤ &quot; + df.formatTime(startTime);</span>
<a href="#l3.14"></a><span id="l3.14">               } else {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-                if (comp == 1) {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-                  label.value = &quot;⇤ &quot; + df.formatTime(startTime);</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                } else {</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-                  label.value = df.formatTime(startTime);</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-                }</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+                label.value = df.formatTime(startTime);</span>
<a href="#l3.21"></a><span id="l3.21">               }</span>
<a href="#l3.22"></a><span id="l3.22">               label.setAttribute(&quot;time&quot;, &quot;true&quot;);</span>
<a href="#l3.23"></a><span id="l3.23">             }</span>
<a href="#l3.24"></a><span id="l3.24">           }</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">           this.setEditableLabel();</span>
<a href="#l3.27"></a><span id="l3.27">           this.setCSSClasses();</span>
<a href="#l3.28"></a><span id="l3.28">           return val;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1634,24 +1634,20 @@</span>
<a href="#l4.4"></a><span id="l4.4">           window.removeEventListener(&quot;keypress&quot;, col.onEventSweepKeypress, false);</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">           document.calendarEventColumnDragging = null;</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">           // if the user didn't sweep out at least a few pixels, ignore</span>
<a href="#l4.9"></a><span id="l4.9">           // unless we're in a different column</span>
<a href="#l4.10"></a><span id="l4.10">           if (dragState.origColumn == col) {</span>
<a href="#l4.11"></a><span id="l4.11">               let ignore = false;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-              if (col.getAttribute(&quot;orient&quot;) == &quot;vertical&quot;) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                  if (Math.abs(event.screenY - dragState.origLoc) &lt; 3) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                      ignore = true;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-                  }</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-              } else {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-                  if (Math.abs(event.screenX - dragState.origLoc) &lt; 3) {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-                      ignore = true;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-                  }</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+              let orient = col.getAttribute(&quot;orient&quot;);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+              let position = orient == &quot;vertical&quot; ? event.screenY : event.screenX;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+              if (Math.abs(position - dragState.origLoc) &lt; 3) {</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+                  ignore = true;</span>
<a href="#l4.24"></a><span id="l4.24">               }</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">               if (ignore) {</span>
<a href="#l4.27"></a><span id="l4.27">                   col.mDragState = null;</span>
<a href="#l4.28"></a><span id="l4.28">                   return;</span>
<a href="#l4.29"></a><span id="l4.29">               }</span>
<a href="#l4.30"></a><span id="l4.30">           }</span>
<a href="#l4.31"></a><span id="l4.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -797,22 +797,20 @@ var unifinderTreeView = {</span>
<a href="#l5.4"></a><span id="l5.4">         this.tree = tree;</span>
<a href="#l5.5"></a><span id="l5.5">     },</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">     toggleOpenState: function uTV_toggleOpenState(aRow) {},</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">     cycleHeader: function uTV_cycleHeader(col) {</span>
<a href="#l5.10"></a><span id="l5.10">         if (!this.selectedColumn) {</span>
<a href="#l5.11"></a><span id="l5.11">             this.sortDirection = &quot;ascending&quot;;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+        } else if (!this.sortDirection || this.sortDirection == &quot;descending&quot;) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+            this.sortDirection = &quot;ascending&quot;;</span>
<a href="#l5.14"></a><span id="l5.14">         } else {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-            if (!this.sortDirection || this.sortDirection == &quot;descending&quot;) {</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-                this.sortDirection = &quot;ascending&quot;;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-            } else {</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-                this.sortDirection = &quot;descending&quot;;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-            }</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+            this.sortDirection = &quot;descending&quot;;</span>
<a href="#l5.21"></a><span id="l5.21">         }</span>
<a href="#l5.22"></a><span id="l5.22">         this.selectedColumn = col.element;</span>
<a href="#l5.23"></a><span id="l5.23">         this.sortItems();</span>
<a href="#l5.24"></a><span id="l5.24">     },</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">     isEditable: function uTV_isEditable(aRow, aCol) {</span>
<a href="#l5.27"></a><span id="l5.27">         return false;</span>
<a href="#l5.28"></a><span id="l5.28">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -893,20 +893,18 @@</span>
<a href="#l6.4"></a><span id="l6.4">               // do we need to scroll in order to see the selected row?</span>
<a href="#l6.5"></a><span id="l6.5">               let listbox =</span>
<a href="#l6.6"></a><span id="l6.6">                   document.getAnonymousElementByAttribute(</span>
<a href="#l6.7"></a><span id="l6.7">                       self, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l6.8"></a><span id="l6.8">               let firstVisibleRow = listbox.getIndexOfFirstVisibleRow();</span>
<a href="#l6.9"></a><span id="l6.9">               let numOfVisibleRows = listbox.getNumberOfVisibleRows();</span>
<a href="#l6.10"></a><span id="l6.10">               if (aRow &lt;= firstVisibleRow) {</span>
<a href="#l6.11"></a><span id="l6.11">                   listbox.scrollToIndex(aRow - 1);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-              } else {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                  if (aRow - 1 &gt;= (firstVisibleRow + numOfVisibleRows)) {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                      listbox.scrollToIndex(aRow - numOfVisibleRows);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                  }</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+              } else if (aRow - 1 &gt;= (firstVisibleRow + numOfVisibleRows)) {</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+                  listbox.scrollToIndex(aRow - numOfVisibleRows);</span>
<a href="#l6.18"></a><span id="l6.18">               }</span>
<a href="#l6.19"></a><span id="l6.19">               let input =</span>
<a href="#l6.20"></a><span id="l6.20">                   document.getAnonymousElementByAttribute(</span>
<a href="#l6.21"></a><span id="l6.21">                       node, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l6.22"></a><span id="l6.22">               input.focus();</span>
<a href="#l6.23"></a><span id="l6.23">           };</span>
<a href="#l6.24"></a><span id="l6.24">           setTimeout(set_focus, 0);</span>
<a href="#l6.25"></a><span id="l6.25">         ]]&gt;&lt;/body&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -156,37 +156,35 @@ function initializeControls(rule) {</span>
<a href="#l7.4"></a><span id="l7.4">     let ruleComponentsEmpty = (byDayRuleComponent.length == 0 &amp;&amp;</span>
<a href="#l7.5"></a><span id="l7.5">                                byMonthDayRuleComponent.length == 0);</span>
<a href="#l7.6"></a><span id="l7.6">     if (ruleComponentsEmpty || rule.type != &quot;MONTHLY&quot;) {</span>
<a href="#l7.7"></a><span id="l7.7">         document.getElementById(&quot;monthly-group&quot;).selectedIndex = 1;</span>
<a href="#l7.8"></a><span id="l7.8">         document.getElementById(&quot;monthly-days&quot;).days = [startDate.day];</span>
<a href="#l7.9"></a><span id="l7.9">         let day = Math.floor((startDate.day - 1) / 7) + 1;</span>
<a href="#l7.10"></a><span id="l7.10">         setElementValue(&quot;monthly-ordinal&quot;, day);</span>
<a href="#l7.11"></a><span id="l7.11">         setElementValue(&quot;monthly-weekday&quot;, startDate.weekday + 1);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    } else {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-        if (everyWeekDay(byDayRuleComponent)) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-            // Every day of the month.</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-            document.getElementById(&quot;monthly-group&quot;).selectedIndex = 0;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-            setElementValue(&quot;monthly-ordinal&quot;, 0);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-            setElementValue(&quot;monthly-weekday&quot;, -1);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-        } else if (byDayRuleComponent.length &gt; 0) {</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-            // One of the first five days or weekdays of the month.</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-            document.getElementById(&quot;monthly-group&quot;).selectedIndex = 0;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-            let ruleInfo = getOrdinalAndWeekdayOfRule(byDayRuleComponent[0]);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-            setElementValue(&quot;monthly-ordinal&quot;, ruleInfo.ordinal);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-            setElementValue(&quot;monthly-weekday&quot;, ruleInfo.weekday);</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-        } else if (byMonthDayRuleComponent.length == 1 &amp;&amp; byMonthDayRuleComponent[0] == -1) {</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-            // The last day of the month.</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-            document.getElementById(&quot;monthly-group&quot;).selectedIndex = 0;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-            setElementValue(&quot;monthly-ordinal&quot;, byMonthDayRuleComponent[0]);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-            setElementValue(&quot;monthly-weekday&quot;, byMonthDayRuleComponent[0]);</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-        } else if (byMonthDayRuleComponent.length &gt; 0) {</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-            document.getElementById(&quot;monthly-group&quot;).selectedIndex = 1;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-            document.getElementById(&quot;monthly-days&quot;).days = byMonthDayRuleComponent;</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-        }</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    } else if (everyWeekDay(byDayRuleComponent)) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+        // Every day of the month.</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+        document.getElementById(&quot;monthly-group&quot;).selectedIndex = 0;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+        setElementValue(&quot;monthly-ordinal&quot;, 0);</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+        setElementValue(&quot;monthly-weekday&quot;, -1);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+    } else if (byDayRuleComponent.length &gt; 0) {</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+        // One of the first five days or weekdays of the month.</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+        document.getElementById(&quot;monthly-group&quot;).selectedIndex = 0;</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+        let ruleInfo = getOrdinalAndWeekdayOfRule(byDayRuleComponent[0]);</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+        setElementValue(&quot;monthly-ordinal&quot;, ruleInfo.ordinal);</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+        setElementValue(&quot;monthly-weekday&quot;, ruleInfo.weekday);</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+    } else if (byMonthDayRuleComponent.length == 1 &amp;&amp; byMonthDayRuleComponent[0] == -1) {</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+        // The last day of the month.</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+        document.getElementById(&quot;monthly-group&quot;).selectedIndex = 0;</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+        setElementValue(&quot;monthly-ordinal&quot;, byMonthDayRuleComponent[0]);</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+        setElementValue(&quot;monthly-weekday&quot;, byMonthDayRuleComponent[0]);</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+    } else if (byMonthDayRuleComponent.length &gt; 0) {</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+        document.getElementById(&quot;monthly-group&quot;).selectedIndex = 1;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+        document.getElementById(&quot;monthly-days&quot;).days = byMonthDayRuleComponent;</span>
<a href="#l7.52"></a><span id="l7.52">     }</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54">     // &quot;YEARLY&quot; ruletype</span>
<a href="#l7.55"></a><span id="l7.55">     if (byMonthRuleComponent.length == 0 || rule.type != &quot;YEARLY&quot;) {</span>
<a href="#l7.56"></a><span id="l7.56">         setElementValue(&quot;yearly-month-rule&quot;, startDate.month + 1);</span>
<a href="#l7.57"></a><span id="l7.57">         setElementValue(&quot;yearly-month-ordinal&quot;, startDate.month + 1);</span>
<a href="#l7.58"></a><span id="l7.58">         if (byMonthDayRuleComponent.length &gt; 0) {</span>
<a href="#l7.59"></a><span id="l7.59">             setControlsForByMonthDay_YearlyRule(startDate, byMonthDayRuleComponent[0]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -175,31 +175,29 @@ var TodayPane = {</span>
<a href="#l8.4"></a><span id="l8.4">         if (TodayPane.minidayDrag.session) {</span>
<a href="#l8.5"></a><span id="l8.5">             if (x * x + y * y &gt;= MIN_DRAG_DISTANCE_SQ) {</span>
<a href="#l8.6"></a><span id="l8.6">                 let distance = Math.floor(Math.sqrt(x * x + y * y) - Math.sqrt(MIN_DRAG_DISTANCE_SQ));</span>
<a href="#l8.7"></a><span id="l8.7">                 // Dragging on the left/right side, the day date decrease/increase</span>
<a href="#l8.8"></a><span id="l8.8">                 TodayPane.minidayDrag.distance = (x &gt; 0) ? distance : -distance;</span>
<a href="#l8.9"></a><span id="l8.9">             } else {</span>
<a href="#l8.10"></a><span id="l8.10">                 TodayPane.minidayDrag.distance = 0;</span>
<a href="#l8.11"></a><span id="l8.11">             }</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        } else {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+        } else if (x * x + y * y &gt; 9) {</span>
<a href="#l8.14"></a><span id="l8.14">             // move the mouse a bit before starting the drag session</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-            if (x * x + y * y &gt; 9) {</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-                window.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-                TodayPane.minidayDrag.session = true;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-                let dragCenterImage = document.getElementById(&quot;dragCenter-image&quot;);</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-                dragCenterImage.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-                // Move the starting point in the center so we have a fixed</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-                // point where stopping the day switching while still dragging</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-                let centerObj = dragCenterImage.boxObject;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-                TodayPane.minidayDrag.startX = Math.floor(centerObj.x + centerObj.width / 2);</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-                TodayPane.minidayDrag.startY = Math.floor(centerObj.y + centerObj.height / 2);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+            window.addEventListener(&quot;mouseout&quot;, TodayPane.stopSwitching, false);</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+            TodayPane.minidayDrag.session = true;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+            let dragCenterImage = document.getElementById(&quot;dragCenter-image&quot;);</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+            dragCenterImage.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+            // Move the starting point in the center so we have a fixed</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+            // point where stopping the day switching while still dragging</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+            let centerObj = dragCenterImage.boxObject;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+            TodayPane.minidayDrag.startX = Math.floor(centerObj.x + centerObj.width / 2);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+            TodayPane.minidayDrag.startY = Math.floor(centerObj.y + centerObj.height / 2);</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-                TodayPane.updateAdvanceTimer();</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-            }</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+            TodayPane.updateAdvanceTimer();</span>
<a href="#l8.38"></a><span id="l8.38">         }</span>
<a href="#l8.39"></a><span id="l8.39">     },</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41">     /**</span>
<a href="#l8.42"></a><span id="l8.42">      * Figure out the days switching speed according to the position (when</span>
<a href="#l8.43"></a><span id="l8.43">      * dragging) or time elapsed (when pressing buttons).</span>
<a href="#l8.44"></a><span id="l8.44">      */</span>
<a href="#l8.45"></a><span id="l8.45">     updateAdvanceTimer: function md_updateAdvanceTimer(aEvent, aDir) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -599,21 +599,19 @@</span>
<a href="#l9.4"></a><span id="l9.4">               // If we have a client point, get the row directly from the client</span>
<a href="#l9.5"></a><span id="l9.5">               // point.</span>
<a href="#l9.6"></a><span id="l9.6">               aRow = aRow || {};</span>
<a href="#l9.7"></a><span id="l9.7">               this.treebox.getCellAt(event.clientX,</span>
<a href="#l9.8"></a><span id="l9.8">                                      event.clientY,</span>
<a href="#l9.9"></a><span id="l9.9">                                      aRow,</span>
<a href="#l9.10"></a><span id="l9.10">                                      aCol || {},</span>
<a href="#l9.11"></a><span id="l9.11">                                      {});</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-          } else {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+          } else if (document.popupNode &amp;&amp; document.popupNode.contextCalendar) {</span>
<a href="#l9.14"></a><span id="l9.14">               // Otherwise, we can try to get the context calendar from the popupNode.</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-              if (document.popupNode &amp;&amp; document.popupNode.contextCalendar) {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-                  return document.popupNode.contextCalendar;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-              }</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+              return document.popupNode.contextCalendar;</span>
<a href="#l9.19"></a><span id="l9.19">           }</span>
<a href="#l9.20"></a><span id="l9.20">           return aRow &amp;&amp; aRow.value &gt; -1 &amp;&amp; this.mCalendarList[aRow.value];</span>
<a href="#l9.21"></a><span id="l9.21">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.22"></a><span id="l9.22">       &lt;/method&gt;</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">       &lt;method name=&quot;getCalendar&quot;&gt;</span>
<a href="#l9.25"></a><span id="l9.25">         &lt;!--</span>
<a href="#l9.26"></a><span id="l9.26">           - Get the calendar from a certain index.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -402,22 +402,20 @@</span>
<a href="#l10.4"></a><span id="l10.4">             if (pushModeCollapsedAttribute) {</span>
<a href="#l10.5"></a><span id="l10.5">                 if (!display) {</span>
<a href="#l10.6"></a><span id="l10.6">                     if (modeIndex == -1) {</span>
<a href="#l10.7"></a><span id="l10.7">                         collapsedModes.push(this.currentMode);</span>
<a href="#l10.8"></a><span id="l10.8">                         if (this.getAttribute(&quot;collapsedinmodes&quot;) == &quot;,&quot;) {</span>
<a href="#l10.9"></a><span id="l10.9">                             collapsedModes.splice(0, 2);</span>
<a href="#l10.10"></a><span id="l10.10">                         }</span>
<a href="#l10.11"></a><span id="l10.11">                     }</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                } else {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                    if (modeIndex &gt; -1) {</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                        collapsedModes.splice(modeIndex, 1);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-                        if (collapsedModes.join(&quot;,&quot;) == &quot;&quot;) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-                            collapsedModes[0] = &quot;,&quot;;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-                        }</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+                } else if (modeIndex &gt; -1) {</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+                    collapsedModes.splice(modeIndex, 1);</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+                    if (collapsedModes.join(&quot;,&quot;) == &quot;&quot;) {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+                        collapsedModes[0] = &quot;,&quot;;</span>
<a href="#l10.22"></a><span id="l10.22">                     }</span>
<a href="#l10.23"></a><span id="l10.23">                 }</span>
<a href="#l10.24"></a><span id="l10.24">                 this.setAttribute(&quot;collapsedinmodes&quot;, collapsedModes.join(&quot;,&quot;));</span>
<a href="#l10.25"></a><span id="l10.25">                 let id = this.getAttribute(&quot;id&quot;);</span>
<a href="#l10.26"></a><span id="l10.26">                 if (id) {</span>
<a href="#l10.27"></a><span id="l10.27">                     document.persist(id, &quot;collapsedinmodes&quot;);</span>
<a href="#l10.28"></a><span id="l10.28">                 }</span>
<a href="#l10.29"></a><span id="l10.29">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -968,21 +968,19 @@</span>
<a href="#l11.4"></a><span id="l11.4">         &lt;parameter name=&quot;aFreeBusy&quot;/&gt;</span>
<a href="#l11.5"></a><span id="l11.5">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.6"></a><span id="l11.6">             if (aFreeBusy == true) {</span>
<a href="#l11.7"></a><span id="l11.7">                 if (this.mObservesComposite == false) {</span>
<a href="#l11.8"></a><span id="l11.8">                     getCompositeCalendar().addObserver(this);</span>
<a href="#l11.9"></a><span id="l11.9">                     this.mObservesComposite = true;</span>
<a href="#l11.10"></a><span id="l11.10">                     this.getItems();</span>
<a href="#l11.11"></a><span id="l11.11">                  }</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-            } else {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                if (this.mObservesComposite == true) {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-                    getCompositeCalendar().removeObserver(this);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-                    this.mObservesComposite = false;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-                 }</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+            } else if (this.mObservesComposite == true) {</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+                getCompositeCalendar().removeObserver(this);</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+                this.mObservesComposite = false;</span>
<a href="#l11.20"></a><span id="l11.20">             }</span>
<a href="#l11.21"></a><span id="l11.21">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.22"></a><span id="l11.22">       &lt;/method&gt;</span>
<a href="#l11.23"></a><span id="l11.23">       &lt;method name=&quot;removeAttribute&quot;&gt;</span>
<a href="#l11.24"></a><span id="l11.24">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l11.25"></a><span id="l11.25">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.26"></a><span id="l11.26">           if (aAttr == &quot;freebusy&quot;) {</span>
<a href="#l11.27"></a><span id="l11.27">               this._setFreeBusy(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -183,50 +183,48 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l12.4"></a><span id="l12.4">                     // First, find out if the 'BYMONTHDAY' component contains</span>
<a href="#l12.5"></a><span id="l12.5">                     // any elements with a negative value lesser than -1 (&quot;the</span>
<a href="#l12.6"></a><span id="l12.6">                     // last day&quot;). If so we currently don't support any rule</span>
<a href="#l12.7"></a><span id="l12.7">                     if (component.some(function(element, index, array) {</span>
<a href="#l12.8"></a><span id="l12.8">                                            return element &lt; -1;</span>
<a href="#l12.9"></a><span id="l12.9">                                        })) {</span>
<a href="#l12.10"></a><span id="l12.10">                         // we don't support any other combination for now...</span>
<a href="#l12.11"></a><span id="l12.11">                         return getRString(&quot;ruleTooComplex&quot;);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+                    } else if (component.length == 1 &amp;&amp; component[0] == -1) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                        // i.e. one day, the last day of the month</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+                        let monthlyString = getRString(&quot;monthlyLastDayOfNth&quot;);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+                        ruleString = PluralForm.get(rule.interval, monthlyString)</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+                                               .replace(&quot;#1&quot;, rule.interval);</span>
<a href="#l12.17"></a><span id="l12.17">                     } else {</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-                        if (component.length == 1 &amp;&amp; component[0] == -1) {</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-                            // i.e. one day, the last day of the month</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-                            let monthlyString = getRString(&quot;monthlyLastDayOfNth&quot;);</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-                            ruleString = PluralForm.get(rule.interval, monthlyString)</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-                                                   .replace(&quot;#1&quot;, rule.interval);</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-                        } else {</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-                            // i.e. one or more monthdays every N months.</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+                        // i.e. one or more monthdays every N months.</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-                            // Build a string with a list of days separated with commas.</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-                            let day_string = &quot;&quot;;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-                            let lastDay = false;</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-                            for (let i = 0; i &lt; component.length; i++) {</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-                                if (component[i] == -1) {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-                                    lastDay = true;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-                                    continue;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-                                }</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-                                day_string += dateFormatter.formatDayWithOrdinal(component[i]) + &quot;, &quot;;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-                            }</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-                            if (lastDay) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-                                day_string += getRString(&quot;monthlyLastDay&quot;) + &quot;, &quot;;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+                        // Build a string with a list of days separated with commas.</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+                        let day_string = &quot;&quot;;</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+                        let lastDay = false;</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+                        for (let i = 0; i &lt; component.length; i++) {</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+                            if (component[i] == -1) {</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+                                lastDay = true;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+                                continue;</span>
<a href="#l12.46"></a><span id="l12.46">                             }</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-                            day_string = day_string.slice(0, -2)</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-                                                   .replace(/,(?= [^,]*$)/,</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-                                                            &quot; &quot; + getRString(&quot;repeatDetailsAnd&quot;));</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+                            day_string += dateFormatter.formatDayWithOrdinal(component[i]) + &quot;, &quot;;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+                        }</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+                        if (lastDay) {</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+                            day_string += getRString(&quot;monthlyLastDay&quot;) + &quot;, &quot;;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+                        }</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+                        day_string = day_string.slice(0, -2)</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+                                               .replace(/,(?= [^,]*$)/,</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+                                                        &quot; &quot; + getRString(&quot;repeatDetailsAnd&quot;));</span>
<a href="#l12.58"></a><span id="l12.58"> </span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-                            // Add the word &quot;day&quot; in plural form to the list of days then</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-                            // compose the final string with the interval of months</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-                            let monthlyDayString = getRString(&quot;monthlyDaysOfNth_day&quot;, [day_string]);</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-                            monthlyDayString = PluralForm.get(component.length, monthlyDayString);</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineminus">-                            let monthlyString = getRString(&quot;monthlyDaysOfNth&quot;, [monthlyDayString]);</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-                            ruleString = PluralForm.get(rule.interval, monthlyString)</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-                                                   .replace(&quot;#2&quot;, rule.interval);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-                        }</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+                        // Add the word &quot;day&quot; in plural form to the list of days then</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+                        // compose the final string with the interval of months</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+                        let monthlyDayString = getRString(&quot;monthlyDaysOfNth_day&quot;, [day_string]);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+                        monthlyDayString = PluralForm.get(component.length, monthlyDayString);</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+                        let monthlyString = getRString(&quot;monthlyDaysOfNth&quot;, [monthlyDayString]);</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+                        ruleString = PluralForm.get(rule.interval, monthlyString)</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+                                               .replace(&quot;#2&quot;, rule.interval);</span>
<a href="#l12.74"></a><span id="l12.74">                     }</span>
<a href="#l12.75"></a><span id="l12.75">                 } else {</span>
<a href="#l12.76"></a><span id="l12.76">                     let monthlyString = getRString(&quot;monthlyDaysOfNth&quot;, [startDate.day]);</span>
<a href="#l12.77"></a><span id="l12.77">                     ruleString = PluralForm.get(rule.interval, monthlyString)</span>
<a href="#l12.78"></a><span id="l12.78">                                            .replace(&quot;#2&quot;, rule.interval);</span>
<a href="#l12.79"></a><span id="l12.79">                 }</span>
<a href="#l12.80"></a><span id="l12.80">             } else if (rule.type == &quot;YEARLY&quot;) {</span>
<a href="#l12.81"></a><span id="l12.81">                 let bymonthday = null;</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineat">@@ -330,42 +328,40 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l12.83"></a><span id="l12.83">                              dateFormatter.formatDateShort(startDate),</span>
<a href="#l12.84"></a><span id="l12.84">                              dateFormatter.formatDateShort(untilDate)]);</span>
<a href="#l12.85"></a><span id="l12.85">                     }</span>
<a href="#l12.86"></a><span id="l12.86">                 } else {</span>
<a href="#l12.87"></a><span id="l12.87">                     detailsString = getRString(&quot;repeatDetailsInfiniteAllDay&quot;,</span>
<a href="#l12.88"></a><span id="l12.88">                                                [ruleString,</span>
<a href="#l12.89"></a><span id="l12.89">                                                 dateFormatter.formatDateShort(startDate)]);</span>
<a href="#l12.90"></a><span id="l12.90">                 }</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-            } else {</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-                if (rule.isFinite) {</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-                    if (rule.isByCount) {</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-                        let countString = getRString(&quot;repeatCount&quot;,</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-                            [ruleString,</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-                             dateFormatter.formatDateShort(startDate),</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-                             dateFormatter.formatTime(startDate),</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-                             dateFormatter.formatTime(endDate)]);</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-                        detailsString = PluralForm.get(rule.count, countString)</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-                                                  .replace(&quot;#5&quot;, rule.count);</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-                    } else {</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-                        let untilDate = rule.untilDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-                        detailsString = getRString(&quot;repeatDetailsUntil&quot;,</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-                            [ruleString,</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-                             dateFormatter.formatDateShort(startDate),</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-                             dateFormatter.formatDateShort(untilDate),</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-                             dateFormatter.formatTime(startDate),</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-                             dateFormatter.formatTime(endDate)]);</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-                    }</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-                } else {</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-                    detailsString = getRString(&quot;repeatDetailsInfinite&quot;,</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineplus">+            } else if (rule.isFinite) {</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+                if (rule.isByCount) {</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineplus">+                    let countString = getRString(&quot;repeatCount&quot;,</span>
<a href="#l12.115"></a><span id="l12.115">                         [ruleString,</span>
<a href="#l12.116"></a><span id="l12.116">                          dateFormatter.formatDateShort(startDate),</span>
<a href="#l12.117"></a><span id="l12.117">                          dateFormatter.formatTime(startDate),</span>
<a href="#l12.118"></a><span id="l12.118">                          dateFormatter.formatTime(endDate)]);</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+                    detailsString = PluralForm.get(rule.count, countString)</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+                                              .replace(&quot;#5&quot;, rule.count);</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+                } else {</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+                    let untilDate = rule.untilDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+                    detailsString = getRString(&quot;repeatDetailsUntil&quot;,</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+                        [ruleString,</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+                         dateFormatter.formatDateShort(startDate),</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+                         dateFormatter.formatDateShort(untilDate),</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+                         dateFormatter.formatTime(startDate),</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+                         dateFormatter.formatTime(endDate)]);</span>
<a href="#l12.129"></a><span id="l12.129">                 }</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+            } else {</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+                detailsString = getRString(&quot;repeatDetailsInfinite&quot;,</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+                    [ruleString,</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+                     dateFormatter.formatDateShort(startDate),</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+                     dateFormatter.formatTime(startDate),</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+                     dateFormatter.formatTime(endDate)]);</span>
<a href="#l12.136"></a><span id="l12.136">             }</span>
<a href="#l12.137"></a><span id="l12.137">             return detailsString;</span>
<a href="#l12.138"></a><span id="l12.138">         }</span>
<a href="#l12.139"></a><span id="l12.139">     }</span>
<a href="#l12.140"></a><span id="l12.140">     return null;</span>
<a href="#l12.141"></a><span id="l12.141"> }</span>
<a href="#l12.142"></a><span id="l12.142"> </span>
<a href="#l12.143"></a><span id="l12.143"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -617,23 +617,21 @@ calCachedCalendar.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4">                 break;</span>
<a href="#l13.5"></a><span id="l13.5">         }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">         return this.mUncachedCalendar.getProperty(aName);</span>
<a href="#l13.8"></a><span id="l13.8">     },</span>
<a href="#l13.9"></a><span id="l13.9">     refresh: function() {</span>
<a href="#l13.10"></a><span id="l13.10">         if (this.offline) {</span>
<a href="#l13.11"></a><span id="l13.11">             this.downstreamRefresh();</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-        } else {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        } else if (this.supportsChangeLog) {</span>
<a href="#l13.14"></a><span id="l13.14">             /* we first ensure that any remaining offline items are reconciled with the calendar server */</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-            if (this.supportsChangeLog) {</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-                this.playbackOfflineItems(this.downstreamRefresh.bind(this));</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-            } else {</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-                this.downstreamRefresh();</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-            }</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+            this.playbackOfflineItems(this.downstreamRefresh.bind(this));</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+        } else {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+            this.downstreamRefresh();</span>
<a href="#l13.23"></a><span id="l13.23">         }</span>
<a href="#l13.24"></a><span id="l13.24">     },</span>
<a href="#l13.25"></a><span id="l13.25">     downstreamRefresh: function() {</span>
<a href="#l13.26"></a><span id="l13.26">         if (this.mUncachedCalendar.canRefresh &amp;&amp; !this.offline) {</span>
<a href="#l13.27"></a><span id="l13.27">             return this.mUncachedCalendar.refresh(); // will trigger synchronize once the calendar is loaded</span>
<a href="#l13.28"></a><span id="l13.28">         } else {</span>
<a href="#l13.29"></a><span id="l13.29">             let this_ = this;</span>
<a href="#l13.30"></a><span id="l13.30">             return this.synchronize(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -886,22 +886,20 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">                                  aCalendar.getProperty(prop));</span>
<a href="#l14.5"></a><span id="l14.5">             }</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">             if (initialSortOrderPos != null) {</span>
<a href="#l14.8"></a><span id="l14.8">                 newCal.setProperty(&quot;initialSortOrderPos&quot;,</span>
<a href="#l14.9"></a><span id="l14.9">                                    initialSortOrderPos);</span>
<a href="#l14.10"></a><span id="l14.10">             }</span>
<a href="#l14.11"></a><span id="l14.11">             this.calMgr.registerCalendar(newCal);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        } else {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-            if (aCalendar.wrappedJSObject instanceof calCachedCalendar) {</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-                // any attempt to switch this flag will reset the cached calendar;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-                // could be useful for users in case the cache may be corrupted.</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-                aCalendar.wrappedJSObject.setupCachedCalendar();</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-            }</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+        } else if (aCalendar.wrappedJSObject instanceof calCachedCalendar) {</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+            // any attempt to switch this flag will reset the cached calendar;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+            // could be useful for users in case the cache may be corrupted.</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+            aCalendar.wrappedJSObject.setupCachedCalendar();</span>
<a href="#l14.22"></a><span id="l14.22">         }</span>
<a href="#l14.23"></a><span id="l14.23">     },</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">     onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l14.26"></a><span id="l14.26">         this.onPropertyChanged(aCalendar, aName, false, true);</span>
<a href="#l14.27"></a><span id="l14.27">     },</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29">     // Error announcer specific functions</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/src/calEvent.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/src/calEvent.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -183,23 +183,21 @@ calEvent.prototype = {</span>
<a href="#l15.4"></a><span id="l15.4">         if (endDate === undefined) {</span>
<a href="#l15.5"></a><span id="l15.5">             endDate = this.getProperty(&quot;DTEND&quot;);</span>
<a href="#l15.6"></a><span id="l15.6">             if (!endDate &amp;&amp; this.startDate) {</span>
<a href="#l15.7"></a><span id="l15.7">                 endDate = this.startDate.clone();</span>
<a href="#l15.8"></a><span id="l15.8">                 let dur = this.getProperty(&quot;DURATION&quot;);</span>
<a href="#l15.9"></a><span id="l15.9">                 if (dur) {</span>
<a href="#l15.10"></a><span id="l15.10">                     // If there is a duration set on the event, calculate the right end time.</span>
<a href="#l15.11"></a><span id="l15.11">                     endDate.addDuration(cal.createDuration(dur));</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-                } else {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+                } else if (endDate.isDate) {</span>
<a href="#l15.14"></a><span id="l15.14">                     // If the start time is a date-time the event ends on the same calendar</span>
<a href="#l15.15"></a><span id="l15.15">                     // date and time of day. If the start time is a date the events</span>
<a href="#l15.16"></a><span id="l15.16">                     // non-inclusive end is the end of the calendar date.</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-                    if (endDate.isDate) {</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-                        endDate.day += 1;</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-                    }</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+                    endDate.day += 1;</span>
<a href="#l15.21"></a><span id="l15.21">                 }</span>
<a href="#l15.22"></a><span id="l15.22">             }</span>
<a href="#l15.23"></a><span id="l15.23">             this.mEndDate = endDate;</span>
<a href="#l15.24"></a><span id="l15.24">         }</span>
<a href="#l15.25"></a><span id="l15.25">         return endDate;</span>
<a href="#l15.26"></a><span id="l15.26">     },</span>
<a href="#l15.27"></a><span id="l15.27"> </span>
<a href="#l15.28"></a><span id="l15.28">     set endDate(value) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -198,30 +198,28 @@ calTimezoneService.prototype = {</span>
<a href="#l16.4"></a><span id="l16.4">         if (!tz) {</span>
<a href="#l16.5"></a><span id="l16.5">             cal.ERROR(&quot;Couldn't find &quot; + tzid);</span>
<a href="#l16.6"></a><span id="l16.6">             return null;</span>
<a href="#l16.7"></a><span id="l16.7">         }</span>
<a href="#l16.8"></a><span id="l16.8">         if (!tz.zone) {</span>
<a href="#l16.9"></a><span id="l16.9">             if (tz.aliasTo) {</span>
<a href="#l16.10"></a><span id="l16.10">                 // This zone is an alias.</span>
<a href="#l16.11"></a><span id="l16.11">                 tz.zone = this.getTimezone(tz.aliasTo);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+            } else if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+                let parsedComp = ICAL.parse(&quot;BEGIN:VCALENDAR\r\n&quot; + tz.ics + &quot;\r\nEND:VCALENDAR&quot;);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+                let icalComp = new ICAL.Component(parsedComp);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+                let tzComp = icalComp.getFirstSubcomponent(&quot;vtimezone&quot;);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+                tz.zone = new calICALJSTimezone(ICAL.Timezone.fromData({</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+                    tzid: tzid,</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+                    component: tzComp,</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+                    latitude: tz.latitude,</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+                    longitude: tz.longitude</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+                }));</span>
<a href="#l16.22"></a><span id="l16.22">             } else {</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-                if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-                    let parsedComp = ICAL.parse(&quot;BEGIN:VCALENDAR\r\n&quot; + tz.ics + &quot;\r\nEND:VCALENDAR&quot;);</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-                    let icalComp = new ICAL.Component(parsedComp);</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-                    let tzComp = icalComp.getFirstSubcomponent(&quot;vtimezone&quot;);</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-                    tz.zone = new calICALJSTimezone(ICAL.Timezone.fromData({</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-                        tzid: tzid,</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-                        component: tzComp,</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-                        latitude: tz.latitude,</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-                        longitude: tz.longitude</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-                    }));</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-                } else {</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-                    tz.zone = new calLibicalTimezone(tzid, tz.ics, tz.latitude, tz.longitude);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-                }</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+                tz.zone = new calLibicalTimezone(tzid, tz.ics, tz.latitude, tz.longitude);</span>
<a href="#l16.37"></a><span id="l16.37">             }</span>
<a href="#l16.38"></a><span id="l16.38">         }</span>
<a href="#l16.39"></a><span id="l16.39">         return tz.zone;</span>
<a href="#l16.40"></a><span id="l16.40">     },</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42">     get timezoneIds() {</span>
<a href="#l16.43"></a><span id="l16.43">         let zones = [];</span>
<a href="#l16.44"></a><span id="l16.44">         for (let [k, v] of this.mZones.entries()) {</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineat">@@ -483,31 +481,29 @@ function guessSystemTimezone() {</span>
<a href="#l16.46"></a><span id="l16.46">                         continue; // period ends too early</span>
<a href="#l16.47"></a><span id="l16.47">                     }</span>
<a href="#l16.48"></a><span id="l16.48">                 } // else forever rule</span>
<a href="#l16.49"></a><span id="l16.49">             } // else no daylight rule</span>
<a href="#l16.50"></a><span id="l16.50"> </span>
<a href="#l16.51"></a><span id="l16.51">             // found period that covers today.</span>
<a href="#l16.52"></a><span id="l16.52">             if (!isForNextTransitionDate) {</span>
<a href="#l16.53"></a><span id="l16.53">                 return period;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-            } else {</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-                if (todayUTC.nativeTime &lt; periodStartCalDate.nativeTime) {</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-                    // already know periodStartCalDate &lt; oneYr from now,</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-                    // and transitions are at most once per year, so it is next.</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-                    return cal.dateTimeToJsDate(periodStartCalDate);</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-                } else if (rrule) {</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-                    // find next occurrence after today</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-                    periodCalRule.icalProperty = rrule;</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-                    let nextTransitionDate =</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-                        periodCalRule.getNextOccurrence(periodStartCalDate,</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-                                                        todayUTC);</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineminus">-                    // make sure rule doesn't end before next transition date.</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-                    if (nextTransitionDate) {</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-                        return cal.dateTimeToJsDate(nextTransitionDate);</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-                    }</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+            } else if (todayUTC.nativeTime &lt; periodStartCalDate.nativeTime) {</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+                // already know periodStartCalDate &lt; oneYr from now,</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+                // and transitions are at most once per year, so it is next.</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+                return cal.dateTimeToJsDate(periodStartCalDate);</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+            } else if (rrule) {</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+                // find next occurrence after today</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+                periodCalRule.icalProperty = rrule;</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+                let nextTransitionDate =</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+                    periodCalRule.getNextOccurrence(periodStartCalDate,</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+                                                    todayUTC);</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+                // make sure rule doesn't end before next transition date.</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+                if (nextTransitionDate) {</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+                    return cal.dateTimeToJsDate(nextTransitionDate);</span>
<a href="#l16.82"></a><span id="l16.82">                 }</span>
<a href="#l16.83"></a><span id="l16.83">             }</span>
<a href="#l16.84"></a><span id="l16.84">         }</span>
<a href="#l16.85"></a><span id="l16.85">         // no such period found</span>
<a href="#l16.86"></a><span id="l16.86">         return null;</span>
<a href="#l16.87"></a><span id="l16.87">     }</span>
<a href="#l16.88"></a><span id="l16.88"> </span>
<a href="#l16.89"></a><span id="l16.89">     function environmentVariableValue(varName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1129,21 +1129,19 @@ function checkIfInRange(item, rangeStart</span>
<a href="#l17.4"></a><span id="l17.4">     let end = ensureDateTime(endDate);</span>
<a href="#l17.5"></a><span id="l17.5">     let queryEnd = ensureDateTime(rangeEnd);</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">     if (start.compare(end) == 0) {</span>
<a href="#l17.8"></a><span id="l17.8">         if ((!queryStart || start.compare(queryStart) &gt;= 0) &amp;&amp;</span>
<a href="#l17.9"></a><span id="l17.9">             (!queryEnd || start.compare(queryEnd) &lt; 0)) {</span>
<a href="#l17.10"></a><span id="l17.10">             return startDate;</span>
<a href="#l17.11"></a><span id="l17.11">         }</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    } else {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-        if ((!queryEnd || start.compare(queryEnd) &lt; 0) &amp;&amp;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-            (!queryStart || end.compare(queryStart) &gt; 0)) {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-            return startDate;</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-        }</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+    } else if ((!queryEnd || start.compare(queryEnd) &lt; 0) &amp;&amp;</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+               (!queryStart || end.compare(queryStart) &gt; 0)) {</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+        return startDate;</span>
<a href="#l17.20"></a><span id="l17.20">     }</span>
<a href="#l17.21"></a><span id="l17.21">     return null;</span>
<a href="#l17.22"></a><span id="l17.22"> }</span>
<a href="#l17.23"></a><span id="l17.23"> </span>
<a href="#l17.24"></a><span id="l17.24"> /**</span>
<a href="#l17.25"></a><span id="l17.25">  * This function return the progress state of a task:</span>
<a href="#l17.26"></a><span id="l17.26">  * completed, overdue, duetoday, inprogress, future</span>
<a href="#l17.27"></a><span id="l17.27">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -268,40 +268,37 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l18.4"></a><span id="l18.4">                     // timed events last the default length.</span>
<a href="#l18.5"></a><span id="l18.5">                     eDate = sDate.clone();</span>
<a href="#l18.6"></a><span id="l18.6">                     if (sDate.isDate) {</span>
<a href="#l18.7"></a><span id="l18.7">                         // end date is exclusive, so set to next day after start.</span>
<a href="#l18.8"></a><span id="l18.8">                         eDate.day += 1;</span>
<a href="#l18.9"></a><span id="l18.9">                     } else {</span>
<a href="#l18.10"></a><span id="l18.10">                         eDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l18.11"></a><span id="l18.11">                     }</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+                } else if (sDate.isDate) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+                    // A time part for the startDate is missing or was</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+                    // not recognized. We have to throw away the endDates</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+                    // time part too for obtaining a valid event.</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+                    eDate.isDate = true;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+                    // Correct the eDate if duration is less than one day.</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+                    if (eDate.subtractDate(sDate).days &lt; 1) {</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+                        eDate = sDate.clone();</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+                        eDate.day += 1;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+                    }</span>
<a href="#l18.22"></a><span id="l18.22">                 } else {</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-                    // An endDate was found.</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-                    if (sDate.isDate) {</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-                        // A time part for the startDate is missing or was</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-                        // not recognized. We have to throw away the endDates</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-                        // time part too for obtaining a valid event.</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">-                        eDate.isDate = true;</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">-                        // Correct the eDate if duration is less than one day.</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-                        if (eDate.subtractDate(sDate).days &lt; 1) {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-                            eDate = sDate.clone();</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-                            eDate.day += 1;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-                        }</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-                    } else {</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">-                        // We now have a timed startDate and an endDate. If the</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-                        // end time is invalid set it to 23:59:00</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-                        if (eDate.isDate) {</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-                            eDate.isDate = false;</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-                            eDate.hour = 23;</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-                            eDate.minute = 59;</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-                        }</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-                        // Correct the duration to 0 seconds if it is negative.</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-                        if (eDate.subtractDate(sDate).isNegative) {</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-                            eDate = sDate.clone();</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-                        }</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+                    // We now have a timed startDate and an endDate. If the</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+                    // end time is invalid set it to 23:59:00</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+                    if (eDate.isDate) {</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+                        eDate.isDate = false;</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+                        eDate.hour = 23;</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+                        eDate.minute = 59;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+                    }</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+                    // Correct the duration to 0 seconds if it is negative.</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+                    if (eDate.subtractDate(sDate).isNegative) {</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+                        eDate = sDate.clone();</span>
<a href="#l18.56"></a><span id="l18.56">                     }</span>
<a href="#l18.57"></a><span id="l18.57">                 }</span>
<a href="#l18.58"></a><span id="l18.58">                 event.startDate = sDate;</span>
<a href="#l18.59"></a><span id="l18.59">                 event.endDate = eDate;</span>
<a href="#l18.60"></a><span id="l18.60"> </span>
<a href="#l18.61"></a><span id="l18.61">                 // Exists an alarm true/false column?</span>
<a href="#l18.62"></a><span id="l18.62">                 if (&quot;alarmIndex&quot; in args) {</span>
<a href="#l18.63"></a><span id="l18.63">                     // Is an alarm wanted for this event?</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineat">@@ -391,21 +388,19 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l18.65"></a><span id="l18.65">         }</span>
<a href="#l18.66"></a><span id="l18.66"> </span>
<a href="#l18.67"></a><span id="l18.67">         if (rt &amp;&amp; aLocale.timeAmPmIndex &amp;&amp;</span>
<a href="#l18.68"></a><span id="l18.68">             rt[aLocale.timeAmPmIndex] != aLocale.timePmString) {</span>
<a href="#l18.69"></a><span id="l18.69">             // AM</span>
<a href="#l18.70"></a><span id="l18.70">             if (dt.hour == 12) {</span>
<a href="#l18.71"></a><span id="l18.71">                 dt.hour = 0;</span>
<a href="#l18.72"></a><span id="l18.72">             }</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-        } else {</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-            // PM</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-            if (dt.hour &lt; 12) {</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-               dt.hour += 12;</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineminus">-            }</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+        } else if (dt.hour &lt; 12) {</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineplus">+           // PM</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineplus">+           dt.hour += 12;</span>
<a href="#l18.81"></a><span id="l18.81">         }</span>
<a href="#l18.82"></a><span id="l18.82">         return dt;</span>
<a href="#l18.83"></a><span id="l18.83">     },</span>
<a href="#l18.84"></a><span id="l18.84"> </span>
<a href="#l18.85"></a><span id="l18.85">     parseTextField: function parseTextField(aTextField) {</span>
<a href="#l18.86"></a><span id="l18.86">         return aTextField ? aTextField.replace(/&quot;&quot;/g, &quot;\&quot;&quot;) : &quot;&quot;;</span>
<a href="#l18.87"></a><span id="l18.87">     }</span>
<a href="#l18.88"></a><span id="l18.88"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1267,21 +1267,19 @@ function getRepeatTypeAndUntilDate(aItem</span>
<a href="#l19.4"></a><span id="l19.4">                                                 break;</span>
<a href="#l19.5"></a><span id="l19.5">                                             }</span>
<a href="#l19.6"></a><span id="l19.6">                                         }</span>
<a href="#l19.7"></a><span id="l19.7">                                         if (!found &amp;&amp; (!rule.isFinite || !rule.isByCount)) {</span>
<a href="#l19.8"></a><span id="l19.8">                                             repeatType = &quot;every.weekday&quot;;</span>
<a href="#l19.9"></a><span id="l19.9">                                             updateUntilDate(rule);</span>
<a href="#l19.10"></a><span id="l19.10">                                         }</span>
<a href="#l19.11"></a><span id="l19.11">                                     }</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-                                } else {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                                    if (!rule.isFinite || !rule.isByCount) {</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-                                        repeatType = &quot;daily&quot;;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-                                        updateUntilDate(rule);</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-                                    }</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+                                } else if (!rule.isFinite || !rule.isByCount) {</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+                                    repeatType = &quot;daily&quot;;</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+                                    updateUntilDate(rule);</span>
<a href="#l19.20"></a><span id="l19.20">                                 }</span>
<a href="#l19.21"></a><span id="l19.21">                             }</span>
<a href="#l19.22"></a><span id="l19.22">                         }</span>
<a href="#l19.23"></a><span id="l19.23">                         break;</span>
<a href="#l19.24"></a><span id="l19.24">                     case &quot;WEEKLY&quot;:</span>
<a href="#l19.25"></a><span id="l19.25">                         if (!checkRecurrenceRule(rule, [&quot;BYSECOND&quot;,</span>
<a href="#l19.26"></a><span id="l19.26">                                                         &quot;BYMINUTE&quot;,</span>
<a href="#l19.27"></a><span id="l19.27">                                                         &quot;BYDAY&quot;,</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineat">@@ -2181,34 +2179,32 @@ function addAttachment(attachment, cloud</span>
<a href="#l19.29"></a><span id="l19.29">                 uploadCloudAttachment(attachment, cloudProvider, listItem);</span>
<a href="#l19.30"></a><span id="l19.30">             } else {</span>
<a href="#l19.31"></a><span id="l19.31">                 let leafName = attachment.getParameter(&quot;FILENAME&quot;);</span>
<a href="#l19.32"></a><span id="l19.32">                 listItem.setAttribute(&quot;image&quot;, cloudProvider.iconClass);</span>
<a href="#l19.33"></a><span id="l19.33">                 if (leafName) {</span>
<a href="#l19.34"></a><span id="l19.34">                     listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l19.35"></a><span id="l19.35">                 }</span>
<a href="#l19.36"></a><span id="l19.36">             }</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+        } else if (attachment.uri.schemeIs(&quot;file&quot;)) {</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+            listItem.setAttribute(&quot;image&quot;, &quot;moz-icon://&quot; + attachment.uri);</span>
<a href="#l19.39"></a><span id="l19.39">         } else {</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-            if (attachment.uri.schemeIs(&quot;file&quot;)) {</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-                listItem.setAttribute(&quot;image&quot;, &quot;moz-icon://&quot; + attachment.uri);</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+            let leafName = attachment.getParameter(&quot;FILENAME&quot;);</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+            let providerType = attachment.getParameter(&quot;PROVIDER&quot;);</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+            let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+            if (leafName) {</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+                // TODO security issues?</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+                listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+            }</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+            if (providerType &amp;&amp; cloudFileEnabled) {</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineplus">+                let provider = cloudFileAccounts.getProviderForType(providerType);</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+                listItem.setAttribute(&quot;image&quot;, provider.iconClass);</span>
<a href="#l19.53"></a><span id="l19.53">             } else {</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-                let leafName = attachment.getParameter(&quot;FILENAME&quot;);</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-                let providerType = attachment.getParameter(&quot;PROVIDER&quot;);</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-                let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-                if (leafName) {</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-                    // TODO security issues?</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-                    listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-                }</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-                if (providerType &amp;&amp; cloudFileEnabled) {</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-                    let provider = cloudFileAccounts.getProviderForType(providerType);</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-                    listItem.setAttribute(&quot;image&quot;, provider.iconClass);</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-                } else {</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-                    listItem.setAttribute(&quot;image&quot;, &quot;moz-icon://dummy.html&quot;);</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-                }</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineplus">+                listItem.setAttribute(&quot;image&quot;, &quot;moz-icon://dummy.html&quot;);</span>
<a href="#l19.69"></a><span id="l19.69">             }</span>
<a href="#l19.70"></a><span id="l19.70">         }</span>
<a href="#l19.71"></a><span id="l19.71"> </span>
<a href="#l19.72"></a><span id="l19.72">         // Now that everything is set up, add it to the attachment box.</span>
<a href="#l19.73"></a><span id="l19.73">         documentLink.appendChild(listItem);</span>
<a href="#l19.74"></a><span id="l19.74"> </span>
<a href="#l19.75"></a><span id="l19.75">         // full attachment object is stored here</span>
<a href="#l19.76"></a><span id="l19.76">         listItem.attachment = attachment;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -1293,22 +1293,20 @@ calDavCalendar.prototype = {</span>
<a href="#l20.4"></a><span id="l20.4">                 this.mOfflineStorage.getItems.apply(this.mOfflineStorage, arguments);</span>
<a href="#l20.5"></a><span id="l20.5">             } else {</span>
<a href="#l20.6"></a><span id="l20.6">                 this.notifyOperationComplete(aListener,</span>
<a href="#l20.7"></a><span id="l20.7">                                              Components.results.NS_OK,</span>
<a href="#l20.8"></a><span id="l20.8">                                              cIOL.GET,</span>
<a href="#l20.9"></a><span id="l20.9">                                              null,</span>
<a href="#l20.10"></a><span id="l20.10">                                              null);</span>
<a href="#l20.11"></a><span id="l20.11">             }</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+        } else if (!this.checkedServerInfo) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+            this.mQueuedQueries.push(Array.from(arguments));</span>
<a href="#l20.14"></a><span id="l20.14">         } else {</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-            if (!this.checkedServerInfo) {</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-                this.mQueuedQueries.push(Array.from(arguments));</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-            } else {</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-                this.mOfflineStorage.getItems.apply(this.mOfflineStorage, arguments);</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-            }</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+            this.mOfflineStorage.getItems.apply(this.mOfflineStorage, arguments);</span>
<a href="#l20.21"></a><span id="l20.21">         }</span>
<a href="#l20.22"></a><span id="l20.22">     },</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">     fillACLProperties: function caldav_fillACLProperties() {</span>
<a href="#l20.25"></a><span id="l20.25">         let orgId = this.calendarUserAddress;</span>
<a href="#l20.26"></a><span id="l20.26">         if (orgId) {</span>
<a href="#l20.27"></a><span id="l20.27">             this.mACLProperties[&quot;organizerId&quot;] = orgId;</span>
<a href="#l20.28"></a><span id="l20.28">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -405,24 +405,22 @@ calMemoryCalendar.prototype = {</span>
<a href="#l21.4"></a><span id="l21.4"> </span>
<a href="#l21.5"></a><span id="l21.5">         // return occurrences?</span>
<a href="#l21.6"></a><span id="l21.6">         let itemReturnOccurrences = ((aItemFilter &amp; calICalendar.ITEM_FILTER_CLASS_OCCURRENCES) != 0);</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">         // figure out the return interface type</span>
<a href="#l21.9"></a><span id="l21.9">         let typeIID = null;</span>
<a href="#l21.10"></a><span id="l21.10">         if (itemReturnOccurrences) {</span>
<a href="#l21.11"></a><span id="l21.11">             typeIID = Components.interfaces.calIItemBase;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-        } else {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-            if (wantEvents &amp;&amp; wantTodos) {</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-                typeIID = Components.interfaces.calIItemBase;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-            } else if (wantEvents) {</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-                typeIID = Components.interfaces.calIEvent;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-            } else if (wantTodos) {</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">-                typeIID = Components.interfaces.calITodo;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-            }</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+        } else if (wantEvents &amp;&amp; wantTodos) {</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+            typeIID = Components.interfaces.calIItemBase;</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+        } else if (wantEvents) {</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+            typeIID = Components.interfaces.calIEvent;</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+        } else if (wantTodos) {</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+            typeIID = Components.interfaces.calITodo;</span>
<a href="#l21.26"></a><span id="l21.26">         }</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">         aRangeStart = cal.ensureDateTime(aRangeStart);</span>
<a href="#l21.29"></a><span id="l21.29">         aRangeEnd = cal.ensureDateTime(aRangeEnd);</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31"> </span>
<a href="#l21.32"></a><span id="l21.32">         let offline_filter = aItemFilter &amp;</span>
<a href="#l21.33"></a><span id="l21.33">             (calICalendar.ITEM_FILTER_OFFLINE_DELETED |</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1545,28 +1545,27 @@ upgrade.v22 = function upgrade_v22(db, v</span>
<a href="#l22.4"></a><span id="l22.4">                         ritem.type = aType;</span>
<a href="#l22.5"></a><span id="l22.5">                         ritem.isNegative = !!aIsNegative;</span>
<a href="#l22.6"></a><span id="l22.6">                         if (aCount) {</span>
<a href="#l22.7"></a><span id="l22.7">                             try {</span>
<a href="#l22.8"></a><span id="l22.8">                                 ritem.count = aCount;</span>
<a href="#l22.9"></a><span id="l22.9">                             } catch (exc) {</span>
<a href="#l22.10"></a><span id="l22.10">                                 // Don't fail if setting an invalid count</span>
<a href="#l22.11"></a><span id="l22.11">                             }</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+                        } else if (aEndDate) {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+                            let allday = (aTmpFlags &amp; CAL_ITEM_FLAG.EVENT_ALLDAY) != 0;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+                            let untilDate = newDateTime(aEndDate, allday ? &quot;&quot; : &quot;UTC&quot;);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+                            if (allday) {</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+                                untilDate.isDate = true;</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+                            }</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+                            ritem.untilDate = untilDate;</span>
<a href="#l22.19"></a><span id="l22.19">                         } else {</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-                            if (aEndDate) {</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-                                let allday = ((aTmpFlags &amp; CAL_ITEM_FLAG.EVENT_ALLDAY) != 0);</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-                                let untilDate = newDateTime(aEndDate, allday ? &quot;&quot; : &quot;UTC&quot;);</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">-                                if (allday) {</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-                                    untilDate.isDate = true;</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-                                }</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-                                ritem.untilDate = untilDate;</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">-                            } else {</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">-                                ritem.untilDate = null;</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineminus">-                            }</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+                            ritem.untilDate = null;</span>
<a href="#l22.31"></a><span id="l22.31">                         }</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+</span>
<a href="#l22.33"></a><span id="l22.33">                         try {</span>
<a href="#l22.34"></a><span id="l22.34">                             ritem.interval = aInterval;</span>
<a href="#l22.35"></a><span id="l22.35">                         } catch (exc) {</span>
<a href="#l22.36"></a><span id="l22.36">                             // Don't fail if setting an invalid interval</span>
<a href="#l22.37"></a><span id="l22.37">                         }</span>
<a href="#l22.38"></a><span id="l22.38"> </span>
<a href="#l22.39"></a><span id="l22.39">                         let rtypes = {</span>
<a href="#l22.40"></a><span id="l22.40">                             SECOND: aSecond,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -318,22 +318,20 @@</span>
<a href="#l23.4"></a><span id="l23.4">                                 (this.mValue.getFullYear() != aValue.getFullYear());</span>
<a href="#l23.5"></a><span id="l23.5">                 }</span>
<a href="#l23.6"></a><span id="l23.6">                 this.mValue = aValue;</span>
<a href="#l23.7"></a><span id="l23.7">                 this.kTextBox.value = formattedValue;</span>
<a href="#l23.8"></a><span id="l23.8">                 if (aRefresh &amp;&amp; dateChanged) {</span>
<a href="#l23.9"></a><span id="l23.9">                   this.fireEvent(&quot;change&quot;);</span>
<a href="#l23.10"></a><span id="l23.10">                 }</span>
<a href="#l23.11"></a><span id="l23.11">               }</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-            } else {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+            } else if (this.mValue) {</span>
<a href="#l23.14"></a><span id="l23.14">               // invalid date, revert to previous date</span>
<a href="#l23.15"></a><span id="l23.15">               // set textBox.value property, not attribute</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-              if (this.mValue) {</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-                this.kTextBox.value = this.formatDate(this.mValue);</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-              }</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+              this.kTextBox.value = this.formatDate(this.mValue);</span>
<a href="#l23.20"></a><span id="l23.20">             }</span>
<a href="#l23.21"></a><span id="l23.21">           ]]&gt;</span>
<a href="#l23.22"></a><span id="l23.22">         &lt;/body&gt;</span>
<a href="#l23.23"></a><span id="l23.23">       &lt;/method&gt;</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25">       &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l23.26"></a><span id="l23.26">         &lt;body&gt;</span>
<a href="#l23.27"></a><span id="l23.27">           &lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/test/unit/test_alarm.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/test/unit/test_alarm.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -446,23 +446,21 @@ function test_clone() {</span>
<a href="#l24.4"></a><span id="l24.4">     ok(newAlarm.isMutable);</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">     // Check if item is still the same</span>
<a href="#l24.7"></a><span id="l24.7">     // TODO This is not quite optimal, maybe someone can find a better way to do</span>
<a href="#l24.8"></a><span id="l24.8">     // the comparisons.</span>
<a href="#l24.9"></a><span id="l24.9">     for (let prop in propMap) {</span>
<a href="#l24.10"></a><span id="l24.10">         if (prop == &quot;item&quot;) {</span>
<a href="#l24.11"></a><span id="l24.11">             equal(alarm.item.icalString, newAlarm.item.icalString);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-        } else {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-            if ((alarm[prop] instanceof Ci.nsISupports &amp;&amp;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-                 alarm[prop].icalString != newAlarm[prop].icalString) ||</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-                !(alarm[prop] instanceof Ci.nsISupports) &amp;&amp;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-                  alarm[prop] != newAlarm[prop]) {</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-                do_throw(prop + &quot; differs, &quot; + alarm[prop] + &quot; == &quot; + newAlarm[prop]);</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-            }</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+        } else if ((alarm[prop] instanceof Ci.nsISupports &amp;&amp;</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+                    alarm[prop].icalString != newAlarm[prop].icalString) ||</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+                   !(alarm[prop] instanceof Ci.nsISupports) &amp;&amp;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+                     alarm[prop] != newAlarm[prop]) {</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+            do_throw(prop + &quot; differs, &quot; + alarm[prop] + &quot; == &quot; + newAlarm[prop]);</span>
<a href="#l24.24"></a><span id="l24.24">         }</span>
<a href="#l24.25"></a><span id="l24.25">     }</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">     // Check if changes on the cloned object do not affect the original object.</span>
<a href="#l24.28"></a><span id="l24.28">     for (let prop in clonePropMap) {</span>
<a href="#l24.29"></a><span id="l24.29">         newAlarm[prop] = clonePropMap[prop];</span>
<a href="#l24.30"></a><span id="l24.30">         dump(&quot;Checking &quot; + prop + &quot;...&quot;);</span>
<a href="#l24.31"></a><span id="l24.31">         notEqual(alarm[prop], newAlarm[prop]);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

