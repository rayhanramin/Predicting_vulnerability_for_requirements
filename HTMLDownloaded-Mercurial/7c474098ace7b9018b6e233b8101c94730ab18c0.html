<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4081:7c474098ace7b9018b6e233b8101c94730ab18c0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 7c474098ace7b9018b6e233b8101c94730ab18c0" />
<meta property="og:url" content="/comm-central/rev/7c474098ace7b9018b6e233b8101c94730ab18c0" />
<meta property="og:description" content="Bug 455714 - &quot;nsIAbCollection::getCardFromProperty and nsIAbCollection::cardForEmailAddress should be able to return multiple cards&quot; [r=Standard8,sr=bienvenu,a=Standard8]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 7c474098ace7b9018b6e233b8101c94730ab18c0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/7c474098ace7b9018b6e233b8101c94730ab18c0">shortlog</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/7c474098ace7b9018b6e233b8101c94730ab18c0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0">files</a> |
changeset |
<a href="/comm-central/raw-rev/7c474098ace7b9018b6e233b8101c94730ab18c0">raw</a>  | <a href="/comm-central/archive/7c474098ace7b9018b6e233b8101c94730ab18c0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=455714">Bug 455714</a> - &quot;nsIAbCollection::getCardFromProperty and nsIAbCollection::cardForEmailAddress should be able to return multiple cards&quot; [r=Standard8,sr=bienvenu,a=Standard8]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#67;&#101;&#115;&#97;&#114;&#32;&#79;&#108;&#105;&#118;&#101;&#105;&#114;&#97;&#32;&#60;&#99;&#100;&#111;&#108;&#105;&#118;&#101;&#105;&#46;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 07 Oct 2009 20:38:38 +0100</td></tr>

<tr>
 <td>changeset 4081</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/7c474098ace7b9018b6e233b8101c94730ab18c0">7c474098ace7b9018b6e233b8101c94730ab18c0</a></td>
</tr>



<tr>
<td>parent 4080</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c74ee52a58a36acfb069063eb5bd40343e9aa155">c74ee52a58a36acfb069063eb5bd40343e9aa155</a>
</td>
</tr>

<tr>
<td>child 4082</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/dfcd4aab7972c84c1ba5578a40f2fc3fda04c388">dfcd4aab7972c84c1ba5578a40f2fc3fda04c388</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=7c474098ace7b9018b6e233b8101c94730ab18c0">3188</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 07 Oct 2009 19:39:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@dfcd4aab7972 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=dfcd4aab7972c84c1ba5578a40f2fc3fda04c388">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=dfcd4aab7972c84c1ba5578a40f2fc3fda04c388&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dfcd4aab7972c84c1ba5578a40f2fc3fda04c388&newProject=comm-central&newRevision=c74ee52a58a36acfb069063eb5bd40343e9aa155&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dfcd4aab7972c84c1ba5578a40f2fc3fda04c388&newProject=comm-central&newRevision=c74ee52a58a36acfb069063eb5bd40343e9aa155&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=dfcd4aab7972c84c1ba5578a40f2fc3fda04c388&newProject=comm-central&newRevision=c74ee52a58a36acfb069063eb5bd40343e9aa155&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=455714">455714</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=455714">Bug 455714</a> - &quot;nsIAbCollection::getCardFromProperty and nsIAbCollection::cardForEmailAddress should be able to return multiple cards&quot; [r=Standard8,sr=bienvenu,a=Standard8]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAbCollection.idl">mailnews/addrbook/public/nsIAbCollection.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAbCollection.idl">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAbCollection.idl">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAbCollection.idl">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAbCollection.idl">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAbCollection.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAddrDatabase.idl">mailnews/addrbook/public/nsIAddrDatabase.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAddrDatabase.idl">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAddrDatabase.idl">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAddrDatabase.idl">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAddrDatabase.idl">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/public/nsIAddrDatabase.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbDirProperty.cpp">mailnews/addrbook/src/nsAbDirProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbDirProperty.cpp">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbDirProperty.cpp">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbDirProperty.cpp">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbDirProperty.cpp">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbDirProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.h">mailnews/addrbook/src/nsAbMDBDirectory.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.h">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.h">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.h">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.h">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAbMDBDirectory.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.cpp">mailnews/addrbook/src/nsAddrDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.cpp">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.cpp">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.h">mailnews/addrbook/src/nsAddrDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.h">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.h">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.h">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.h">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/src/nsAddrDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail.mab">mailnews/addrbook/test/unit/data/cardForEmail.mab</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail.mab">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail.mab">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail.mab">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail.mab">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail.mab">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail1.mab">mailnews/addrbook/test/unit/data/cardForEmail1.mab</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail1.mab">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail1.mab">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail1.mab">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail1.mab">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/data/cardForEmail1.mab">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_cardForEmail.js">mailnews/addrbook/test/unit/test_cardForEmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_cardForEmail.js">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_cardForEmail.js">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_cardForEmail.js">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_cardForEmail.js">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_cardForEmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">file</a> |
<a href="/comm-central/annotate/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">annotate</a> |
<a href="/comm-central/diff/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">diff</a> |
<a href="/comm-central/comparison/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">comparison</a> |
<a href="/comm-central/log/7c474098ace7b9018b6e233b8101c94730ab18c0/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbCollection.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbCollection.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -36,21 +36,22 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.5"></a><span id="l1.5">  *</span>
<a href="#l1.6"></a><span id="l1.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.7"></a><span id="l1.7">  </span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIAbItem.idl&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> interface nsIAbCard;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+interface nsISimpleEnumerator;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> /**</span>
<a href="#l1.15"></a><span id="l1.15">  * A collection of address book items.</span>
<a href="#l1.16"></a><span id="l1.16">  */</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-[scriptable, uuid(e6f97fdb-2e3e-46ad-974d-50f1388953c0)]</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+[scriptable, uuid(67f9d071-3853-4ba1-bd85-df108dd10625)]</span>
<a href="#l1.19"></a><span id="l1.19"> interface nsIAbCollection : nsIAbItem {</span>
<a href="#l1.20"></a><span id="l1.20">   </span>
<a href="#l1.21"></a><span id="l1.21">   /**</span>
<a href="#l1.22"></a><span id="l1.22">    * Returns true if this collection is read-only.</span>
<a href="#l1.23"></a><span id="l1.23">    */</span>
<a href="#l1.24"></a><span id="l1.24">   readonly attribute boolean readOnly;</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   /**</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineat">@@ -102,9 +103,25 @@ interface nsIAbCollection : nsIAbItem {</span>
<a href="#l1.28"></a><span id="l1.28">    * @param  aProperty      The property to look for.</span>
<a href="#l1.29"></a><span id="l1.29">    * @param  aValue         The value to search for.</span>
<a href="#l1.30"></a><span id="l1.30">    * @param  aCaseSensitive True if matching should be done case-sensitively.</span>
<a href="#l1.31"></a><span id="l1.31">    * @result                An nsIAbCard if one was found, else returns NULL.</span>
<a href="#l1.32"></a><span id="l1.32">    * @exception NS_ERROR_NOT_IMPLEMENTED If the collection cannot do this.</span>
<a href="#l1.33"></a><span id="l1.33">    */</span>
<a href="#l1.34"></a><span id="l1.34">   nsIAbCard getCardFromProperty(in string aProperty, in AUTF8String aValue,</span>
<a href="#l1.35"></a><span id="l1.35">                                 in boolean aCaseSensitive);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+  /**</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+   * Returns all address book cards with a specific property matching value</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+   *</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+   * This function is almost identical to getCardFromProperty, with the</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+   * exception of returning all cards rather than just the first.</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+   *</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+   * @param  aProperty      The property to look for.</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+   * @param  aValue         The value to search for.</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+   * @param  aCaseSensitive True if matching should be done case-sensitively.</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+   * @result                A nsISimpleEnumerator that holds nsIAbCard</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+   *                        instances.</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+   */</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+  nsISimpleEnumerator getCardsFromProperty(in string aProperty,</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                                           in AUTF8String aValue,</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+                                           in boolean aCaseSensitive);</span>
<a href="#l1.52"></a><span id="l1.52"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAddrDatabase.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAddrDatabase.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsIAbCard.idl&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsIAbDirectory.idl&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> interface nsIFile;</span>
<a href="#l2.8"></a><span id="l2.8"> interface nsIMdbTableRowCursor;</span>
<a href="#l2.9"></a><span id="l2.9"> interface nsIMdbEnv;</span>
<a href="#l2.10"></a><span id="l2.10"> interface nsIMdbRow;</span>
<a href="#l2.11"></a><span id="l2.11"> interface nsIArray;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+interface nsISimpleEnumerator;</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> %{C++</span>
<a href="#l2.15"></a><span id="l2.15"> // this is the prefix we for attributes that are specific</span>
<a href="#l2.16"></a><span id="l2.16"> // to the mozilla addressbook, and weren't in 4.x and aren't specified in</span>
<a href="#l2.17"></a><span id="l2.17"> // RFC 2789.  used when exporting and import LDIF</span>
<a href="#l2.18"></a><span id="l2.18"> // see nsTextAddress.cpp, nsAddressBook.cpp</span>
<a href="#l2.19"></a><span id="l2.19"> #define MOZ_AB_LDIF_PREFIX &quot;mozilla&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -67,17 +68,17 @@ interface nsIArray;</span>
<a href="#l2.22"></a><span id="l2.22"> #define kLowerPriEmailColumn      &quot;LowercasePrimaryEmail&quot;</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24"> // Palm Integration</span>
<a href="#l2.25"></a><span id="l2.25"> #define  CARD_ATTRIB_PALMID &quot;PalmRecId&quot;</span>
<a href="#l2.26"></a><span id="l2.26"> #define  CARD_ATTRIB_DISPLAY &quot;DisplayName&quot;</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28"> %}</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-[scriptable, uuid(14d89995-e6c5-11d8-9a39-000a95dc234c)]</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+[scriptable, uuid(8532d6db-95eb-48b3-8879-26e7168b90f7)]</span>
<a href="#l2.32"></a><span id="l2.32"> interface nsAddrDBCommitType </span>
<a href="#l2.33"></a><span id="l2.33"> {</span>
<a href="#l2.34"></a><span id="l2.34">   const long kSmallCommit = 0;</span>
<a href="#l2.35"></a><span id="l2.35">   const long kLargeCommit = 1;</span>
<a href="#l2.36"></a><span id="l2.36">   const long kSessionCommit = 2;</span>
<a href="#l2.37"></a><span id="l2.37">   const long kCompressCommit = 3;</span>
<a href="#l2.38"></a><span id="l2.38"> };</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40" class="difflineat">@@ -209,16 +210,32 @@ interface nsIAddrDatabase : nsIAddrDBAnn</span>
<a href="#l2.41"></a><span id="l2.41">    * @param  aCaseInsensitive Set to true for case-insenstive matching.</span>
<a href="#l2.42"></a><span id="l2.42">    * @result                  Returns an nsIAbCard if one is found, otherwise</span>
<a href="#l2.43"></a><span id="l2.43">    *                          NULL.</span>
<a href="#l2.44"></a><span id="l2.44">    */</span>
<a href="#l2.45"></a><span id="l2.45">   nsIAbCard getCardFromAttribute(in nsIAbDirectory aDirectory, in string aName,</span>
<a href="#l2.46"></a><span id="l2.46">                                  in AUTF8String aUTF8Value,</span>
<a href="#l2.47"></a><span id="l2.47">                                  in boolean aCaseInsensitive);</span>
<a href="#l2.48"></a><span id="l2.48"> </span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  /**</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+   * Gets all cards which matches the attribute/value pair supplied.</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+   *</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+   * @param  aDirectory       The current nsIAbDirectory associated with this</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+   *                          instance of the database.</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+   * @param  aName            The attribute to look up the value in.</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+   * @param  aUTF8Value       The value to look up in UTF8 format.</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+   * @param  aCaseInsensitive Set to true for case-insenstive matching.</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+   * @result                  Returns an nsISimpleEnumerator of nsIAbCard</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+   *                          instances.</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+   */</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  nsISimpleEnumerator getCardsFromAttribute(in nsIAbDirectory aDirectory,</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+                                            in string aName,</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+                                            in AUTF8String uUTF8Value,</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+                                            in boolean aCaseInsensitive);</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+</span>
<a href="#l2.65"></a><span id="l2.65">   PRBool findMailListbyUnicodeName(in wstring listName);</span>
<a href="#l2.66"></a><span id="l2.66"> </span>
<a href="#l2.67"></a><span id="l2.67">   void getCardCount(out PRUint32 count);</span>
<a href="#l2.68"></a><span id="l2.68"> </span>
<a href="#l2.69"></a><span id="l2.69">   [noscript] readonly attribute nsIMdbRow newRow;</span>
<a href="#l2.70"></a><span id="l2.70">   [noscript] readonly attribute nsIMdbRow newListRow;</span>
<a href="#l2.71"></a><span id="l2.71">   [noscript] void addCardRowToDB(in nsIMdbRow newRow);</span>
<a href="#l2.72"></a><span id="l2.72">   [noscript] void addLdifListMember(in nsIMdbRow row, in string value);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirProperty.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirProperty.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -319,16 +319,23 @@ NS_IMETHODIMP nsAbDirProperty::CardForEm</span>
<a href="#l3.4"></a><span id="l3.4"> { return NS_ERROR_NOT_IMPLEMENTED; }</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> NS_IMETHODIMP nsAbDirProperty::GetCardFromProperty(const char *aProperty,</span>
<a href="#l3.7"></a><span id="l3.7">                                                    const nsACString &amp;aValue,</span>
<a href="#l3.8"></a><span id="l3.8">                                                    PRBool caseSensitive,</span>
<a href="#l3.9"></a><span id="l3.9">                                                    nsIAbCard **result)</span>
<a href="#l3.10"></a><span id="l3.10"> { return NS_ERROR_NOT_IMPLEMENTED; }</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+NS_IMETHODIMP nsAbDirProperty::GetCardsFromProperty(const char *aProperty,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                                                    const nsACString &amp;aValue,</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+                                                    PRBool caseSensitive,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+                                                    nsISimpleEnumerator **result)</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+{ return NS_ERROR_NOT_IMPLEMENTED; }</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+</span>
<a href="#l3.19"></a><span id="l3.19"> NS_IMETHODIMP nsAbDirProperty::GetSupportsMailingLists(PRBool *aSupportsMailingsLists)</span>
<a href="#l3.20"></a><span id="l3.20"> {</span>
<a href="#l3.21"></a><span id="l3.21">   NS_ENSURE_ARG_POINTER(aSupportsMailingsLists);</span>
<a href="#l3.22"></a><span id="l3.22">   // We don't currently support nested mailing lists, so only return true if</span>
<a href="#l3.23"></a><span id="l3.23">   // we're not a mailing list.</span>
<a href="#l3.24"></a><span id="l3.24">   *aSupportsMailingsLists = !m_IsMailList;</span>
<a href="#l3.25"></a><span id="l3.25">   return NS_OK;</span>
<a href="#l3.26"></a><span id="l3.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1115,8 +1115,33 @@ NS_IMETHODIMP nsAbMDBDirectory::GetCardF</span>
<a href="#l4.4"></a><span id="l4.4">       return NS_OK;</span>
<a href="#l4.5"></a><span id="l4.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.6"></a><span id="l4.6">   }</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   // nsIAddrDatabase has aCaseInsensitive as its parameter</span>
<a href="#l4.9"></a><span id="l4.9">   return mDatabase-&gt;GetCardFromAttribute(this, aProperty, aValue,</span>
<a href="#l4.10"></a><span id="l4.10">                                          !caseSensitive, result);</span>
<a href="#l4.11"></a><span id="l4.11"> }</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+NS_IMETHODIMP nsAbMDBDirectory::GetCardsFromProperty(const char *aProperty,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                                                     const nsACString &amp;aValue,</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+                                                     PRBool caseSensitive,</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+                                                     nsISimpleEnumerator **result)</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+{</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  NS_ENSURE_ARG(aProperty);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+  NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  *result = nsnull;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  if (aValue.IsEmpty())</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+    return NS_OK;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  if (!mDatabase)</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+    nsresult rv = GetAbDatabase();</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+    if (rv == NS_ERROR_FILE_NOT_FOUND)</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+      return NS_OK;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  }</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+  return mDatabase-&gt;GetCardsFromAttribute(this, aProperty, aValue,</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                                          !caseSensitive, result);</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -99,16 +99,20 @@ public:</span>
<a href="#l5.4"></a><span id="l5.4">   NS_IMETHOD ModifyCard(nsIAbCard *aModifiedCard);</span>
<a href="#l5.5"></a><span id="l5.5">   NS_IMETHOD DropCard(nsIAbCard *card, PRBool needToCopyCard);</span>
<a href="#l5.6"></a><span id="l5.6">   NS_IMETHOD EditMailListToDatabase(nsIAbCard *listCard);</span>
<a href="#l5.7"></a><span id="l5.7">   NS_IMETHOD CardForEmailAddress(const nsACString &amp;aEmailAddress,</span>
<a href="#l5.8"></a><span id="l5.8">                                  nsIAbCard ** aAbCard);</span>
<a href="#l5.9"></a><span id="l5.9">   NS_IMETHOD GetCardFromProperty(const char *aProperty,</span>
<a href="#l5.10"></a><span id="l5.10">                                  const nsACString &amp;aValue,</span>
<a href="#l5.11"></a><span id="l5.11">                                  PRBool caseSensitive, nsIAbCard **result);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  NS_IMETHOD GetCardsFromProperty(const char *aProperty,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                                  const nsACString &amp;aValue,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+                                  PRBool caseSensitive,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                                  nsISimpleEnumerator **result);</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17">   // nsIAbDirectorySearch methods</span>
<a href="#l5.18"></a><span id="l5.18">   NS_DECL_NSIABDIRECTORYSEARCH</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">   // nsIAbDirSearchListener methods</span>
<a href="#l5.21"></a><span id="l5.21">   NS_DECL_NSIABDIRSEARCHLISTENER</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23"> protected:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -61,16 +61,18 @@</span>
<a href="#l6.4"></a><span id="l6.4"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l6.5"></a><span id="l6.5"> #include &quot;nsIPromptService.h&quot;</span>
<a href="#l6.6"></a><span id="l6.6"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l6.7"></a><span id="l6.7"> #include &quot;nsIFile.h&quot;</span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsXPCOMCIDInternal.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsIProperty.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsIVariant.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+#include &quot;nsCOMArray.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+#include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> #define ID_PAB_TABLE            1</span>
<a href="#l6.16"></a><span id="l6.16"> #define ID_DELETEDCARDS_TABLE           2</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> // There's two books by default, although Mac may have one more, so set this</span>
<a href="#l6.19"></a><span id="l6.19"> // to three. Its not going to affect much, but will save us a few reallocations</span>
<a href="#l6.20"></a><span id="l6.20"> // when the cache is allocated.</span>
<a href="#l6.21"></a><span id="l6.21"> const PRUint32 kInitialAddrDBCacheSize = 3;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -1357,17 +1359,17 @@ NS_IMETHODIMP nsAddrDatabase::AddListCar</span>
<a href="#l6.23"></a><span id="l6.23">   nsString email;</span>
<a href="#l6.24"></a><span id="l6.24">   aPCard-&gt;GetPrimaryEmail(email);</span>
<a href="#l6.25"></a><span id="l6.25">   if (!email.IsEmpty())</span>
<a href="#l6.26"></a><span id="l6.26">   {</span>
<a href="#l6.27"></a><span id="l6.27">     nsIMdbRow    *pCardRow = nsnull;</span>
<a href="#l6.28"></a><span id="l6.28">     // Please DO NOT change the 3rd param of GetRowFromAttribute() call to</span>
<a href="#l6.29"></a><span id="l6.29">     // PR_TRUE (ie, case insensitive) without reading bugs #128535 and #121478.</span>
<a href="#l6.30"></a><span id="l6.30">     err = GetRowFromAttribute(kPriEmailProperty, NS_ConvertUTF16toUTF8(email),</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-                              PR_FALSE /* retain case */, &amp;pCardRow);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+                              PR_FALSE /* retain case */, &amp;pCardRow, nsnull);</span>
<a href="#l6.33"></a><span id="l6.33">     PRBool cardWasAdded = PR_FALSE;</span>
<a href="#l6.34"></a><span id="l6.34">     if (NS_FAILED(err) || !pCardRow)</span>
<a href="#l6.35"></a><span id="l6.35">     {</span>
<a href="#l6.36"></a><span id="l6.36">       //New Email, then add a new row with this email</span>
<a href="#l6.37"></a><span id="l6.37">       err  = GetNewRow(&amp;pCardRow);</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39">       if (NS_SUCCEEDED(err) &amp;&amp; pCardRow)</span>
<a href="#l6.40"></a><span id="l6.40">       {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -1523,17 +1525,17 @@ NS_IMETHODIMP nsAddrDatabase::SetListAdd</span>
<a href="#l6.42"></a><span id="l6.42">     return AddIntColumn(aListRow, m_ListTotalColumnToken, aTotal);</span>
<a href="#l6.43"></a><span id="l6.43"> }</span>
<a href="#l6.44"></a><span id="l6.44"> </span>
<a href="#l6.45"></a><span id="l6.45"> NS_IMETHODIMP nsAddrDatabase::FindRowByCard(nsIAbCard * aCard,nsIMdbRow **aRow)</span>
<a href="#l6.46"></a><span id="l6.46"> {</span>
<a href="#l6.47"></a><span id="l6.47">     nsString primaryEmail;</span>
<a href="#l6.48"></a><span id="l6.48">     aCard-&gt;GetPrimaryEmail(primaryEmail);</span>
<a href="#l6.49"></a><span id="l6.49">     return GetRowForCharColumn(primaryEmail.get(), m_PriEmailColumnToken,</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-                               PR_TRUE, PR_TRUE, aRow);</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+                               PR_TRUE, PR_TRUE, aRow, nsnull);</span>
<a href="#l6.52"></a><span id="l6.52"> }</span>
<a href="#l6.53"></a><span id="l6.53"> </span>
<a href="#l6.54"></a><span id="l6.54"> nsresult nsAddrDatabase::GetAddressRowByPos(nsIMdbRow* listRow, PRUint16 pos, nsIMdbRow** cardRow)</span>
<a href="#l6.55"></a><span id="l6.55"> {</span>
<a href="#l6.56"></a><span id="l6.56">   if (!m_mdbStore || !listRow || !cardRow || !m_mdbEnv)</span>
<a href="#l6.57"></a><span id="l6.57">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l6.58"></a><span id="l6.58"> </span>
<a href="#l6.59"></a><span id="l6.59">   mdb_token listAddressColumnToken;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineat">@@ -2112,17 +2114,17 @@ NS_IMETHODIMP nsAddrDatabase::AddLdifLis</span>
<a href="#l6.61"></a><span id="l6.61">   nsCAutoString email;</span>
<a href="#l6.62"></a><span id="l6.62">   PRInt32 emailPos = valueString.Find(&quot;mail=&quot;);</span>
<a href="#l6.63"></a><span id="l6.63">   emailPos += strlen(&quot;mail=&quot;);</span>
<a href="#l6.64"></a><span id="l6.64">   email = Substring(valueString, emailPos);</span>
<a href="#l6.65"></a><span id="l6.65">   nsCOMPtr &lt;nsIMdbRow&gt; cardRow;</span>
<a href="#l6.66"></a><span id="l6.66">   // Please DO NOT change the 3rd param of GetRowFromAttribute() call to</span>
<a href="#l6.67"></a><span id="l6.67">   // PR_TRUE (ie, case insensitive) without reading bugs #128535 and #121478.</span>
<a href="#l6.68"></a><span id="l6.68">   nsresult rv = GetRowFromAttribute(kPriEmailProperty, email, PR_FALSE /* retain case */,</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-                                    getter_AddRefs(cardRow));</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+                                    getter_AddRefs(cardRow), nsnull);</span>
<a href="#l6.71"></a><span id="l6.71">   if (NS_SUCCEEDED(rv) &amp;&amp; cardRow)</span>
<a href="#l6.72"></a><span id="l6.72">   {</span>
<a href="#l6.73"></a><span id="l6.73">     mdbOid outOid;</span>
<a href="#l6.74"></a><span id="l6.74">     mdb_id rowID = 0;</span>
<a href="#l6.75"></a><span id="l6.75">     if (cardRow-&gt;GetOid(m_mdbEnv, &amp;outOid) == NS_OK)</span>
<a href="#l6.76"></a><span id="l6.76">       rowID = outOid.mOid_Id;</span>
<a href="#l6.77"></a><span id="l6.77"> </span>
<a href="#l6.78"></a><span id="l6.78">     // start from 1</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineat">@@ -3001,49 +3003,81 @@ nsresult nsAddrDatabase::GetListRowByRow</span>
<a href="#l6.80"></a><span id="l6.80">   rowOid.mOid_Id = rowID;</span>
<a href="#l6.81"></a><span id="l6.81"> </span>
<a href="#l6.82"></a><span id="l6.82">   return m_mdbStore-&gt;GetRow(m_mdbEnv, &amp;rowOid, dbRow);</span>
<a href="#l6.83"></a><span id="l6.83"> }</span>
<a href="#l6.84"></a><span id="l6.84"> </span>
<a href="#l6.85"></a><span id="l6.85"> nsresult nsAddrDatabase::GetRowFromAttribute(const char *aName,</span>
<a href="#l6.86"></a><span id="l6.86">                                              const nsACString &amp;aUTF8Value,</span>
<a href="#l6.87"></a><span id="l6.87">                                              PRBool aCaseInsensitive,</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-                                             nsIMdbRow **aCardRow)</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+                                             nsIMdbRow **aCardRow,</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+                                             mdb_pos *aRowPos)</span>
<a href="#l6.91"></a><span id="l6.91"> {</span>
<a href="#l6.92"></a><span id="l6.92">   NS_ENSURE_ARG_POINTER(aName);</span>
<a href="#l6.93"></a><span id="l6.93">   NS_ENSURE_ARG_POINTER(aCardRow);</span>
<a href="#l6.94"></a><span id="l6.94">   if (!m_mdbStore || !m_mdbEnv)</span>
<a href="#l6.95"></a><span id="l6.95">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l6.96"></a><span id="l6.96"> </span>
<a href="#l6.97"></a><span id="l6.97">   mdb_token token;</span>
<a href="#l6.98"></a><span id="l6.98">   m_mdbStore-&gt;StringToToken(m_mdbEnv, aName, &amp;token);</span>
<a href="#l6.99"></a><span id="l6.99">   NS_ConvertUTF8toUTF16 newUnicodeString(aUTF8Value);</span>
<a href="#l6.100"></a><span id="l6.100"> </span>
<a href="#l6.101"></a><span id="l6.101">   return GetRowForCharColumn(newUnicodeString.get(), token, PR_TRUE,</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-                             aCaseInsensitive, aCardRow);</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+                             aCaseInsensitive, aCardRow, aRowPos);</span>
<a href="#l6.104"></a><span id="l6.104"> }</span>
<a href="#l6.105"></a><span id="l6.105"> </span>
<a href="#l6.106"></a><span id="l6.106"> NS_IMETHODIMP nsAddrDatabase::GetCardFromAttribute(nsIAbDirectory *aDirectory,</span>
<a href="#l6.107"></a><span id="l6.107">                                                    const char *aName,</span>
<a href="#l6.108"></a><span id="l6.108">                                                    const nsACString &amp;aUTF8Value,</span>
<a href="#l6.109"></a><span id="l6.109">                                                    PRBool aCaseInsensitive,</span>
<a href="#l6.110"></a><span id="l6.110">                                                    nsIAbCard **aCardResult)</span>
<a href="#l6.111"></a><span id="l6.111"> {</span>
<a href="#l6.112"></a><span id="l6.112">   NS_ENSURE_ARG_POINTER(aCardResult);</span>
<a href="#l6.113"></a><span id="l6.113"> </span>
<a href="#l6.114"></a><span id="l6.114">   m_dbDirectory = aDirectory;</span>
<a href="#l6.115"></a><span id="l6.115">   nsCOMPtr&lt;nsIMdbRow&gt; cardRow;</span>
<a href="#l6.116"></a><span id="l6.116">   if (NS_SUCCEEDED(GetRowFromAttribute(aName, aUTF8Value, aCaseInsensitive,</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-                                       getter_AddRefs(cardRow))) &amp;&amp; cardRow)</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+                                       getter_AddRefs(cardRow), nsnull)) &amp;&amp; cardRow)</span>
<a href="#l6.119"></a><span id="l6.119">     return CreateABCard(cardRow, 0, aCardResult);</span>
<a href="#l6.120"></a><span id="l6.120"> </span>
<a href="#l6.121"></a><span id="l6.121">   *aCardResult = nsnull;</span>
<a href="#l6.122"></a><span id="l6.122">   return NS_OK;</span>
<a href="#l6.123"></a><span id="l6.123"> }</span>
<a href="#l6.124"></a><span id="l6.124"> </span>
<a href="#l6.125"></a><span id="l6.125" class="difflineplus">+NS_IMETHODIMP nsAddrDatabase::GetCardsFromAttribute(nsIAbDirectory *aDirectory,</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineplus">+                                                    const char *aName,</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineplus">+                                                    const nsACString &amp; aUTF8Value,</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineplus">+                                                    PRBool aCaseInsensitive,</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineplus">+                                                    nsISimpleEnumerator **cards)</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineplus">+{</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineplus">+  NS_ENSURE_ARG_POINTER(cards);</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineplus">+</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineplus">+  m_dbDirectory = aDirectory;</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineplus">+  nsCOMPtr&lt;nsIMdbRow&gt; row;</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+  PRBool done = PR_FALSE;</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineplus">+  nsCOMArray&lt;nsIAbCard&gt; list;</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+  nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+  mdb_pos rowPos = -1;</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineplus">+</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+  do</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+  {</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+    if (NS_SUCCEEDED(GetRowFromAttribute(aName, aUTF8Value, aCaseInsensitive,</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+                                         getter_AddRefs(row), &amp;rowPos)) &amp;&amp; row)</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineplus">+    {</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineplus">+      if (NS_FAILED(CreateABCard(row, 0, getter_AddRefs(card))))</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineplus">+        continue;</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineplus">+      list.AppendObject(card);</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+    }</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineplus">+    else</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineplus">+      done = PR_TRUE;</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineplus">+  } while (!done);</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineplus">+  return NS_NewArrayEnumerator(cards, list);</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineplus">+}</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineplus">+</span>
<a href="#l6.156"></a><span id="l6.156"> NS_IMETHODIMP nsAddrDatabase::AddListDirNode(nsIMdbRow * listRow)</span>
<a href="#l6.157"></a><span id="l6.157"> {</span>
<a href="#l6.158"></a><span id="l6.158">     nsresult rv = NS_OK;</span>
<a href="#l6.159"></a><span id="l6.159"> </span>
<a href="#l6.160"></a><span id="l6.160">     static NS_DEFINE_CID(kRDFServiceCID, NS_RDFSERVICE_CID);</span>
<a href="#l6.161"></a><span id="l6.161">     NS_WITH_PROXIED_SERVICE(nsIRDFService, rdfService, kRDFServiceCID,</span>
<a href="#l6.162"></a><span id="l6.162">                             NS_PROXY_TO_MAIN_THREAD, &amp;rv);</span>
<a href="#l6.163"></a><span id="l6.163">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineat">@@ -3085,17 +3119,17 @@ NS_IMETHODIMP nsAddrDatabase::AddListDir</span>
<a href="#l6.165"></a><span id="l6.165"> NS_IMETHODIMP nsAddrDatabase::FindMailListbyUnicodeName(const PRUnichar *listName, PRBool *exist)</span>
<a href="#l6.166"></a><span id="l6.166"> {</span>
<a href="#l6.167"></a><span id="l6.167">   nsAutoString unicodeString(listName);</span>
<a href="#l6.168"></a><span id="l6.168">   ToLowerCase(unicodeString);</span>
<a href="#l6.169"></a><span id="l6.169"> </span>
<a href="#l6.170"></a><span id="l6.170">   nsCOMPtr &lt;nsIMdbRow&gt; listRow;</span>
<a href="#l6.171"></a><span id="l6.171">   nsresult rv = GetRowForCharColumn(unicodeString.get(),</span>
<a href="#l6.172"></a><span id="l6.172">                                     m_LowerListNameColumnToken, PR_FALSE,</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineminus">-                                    PR_FALSE, getter_AddRefs(listRow));</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineplus">+                                    PR_FALSE, getter_AddRefs(listRow), nsnull);</span>
<a href="#l6.175"></a><span id="l6.175">   *exist = (NS_SUCCEEDED(rv) &amp;&amp; listRow);</span>
<a href="#l6.176"></a><span id="l6.176">   return rv;</span>
<a href="#l6.177"></a><span id="l6.177"> }</span>
<a href="#l6.178"></a><span id="l6.178"> </span>
<a href="#l6.179"></a><span id="l6.179"> NS_IMETHODIMP nsAddrDatabase::GetCardCount(PRUint32 *count)</span>
<a href="#l6.180"></a><span id="l6.180"> {</span>
<a href="#l6.181"></a><span id="l6.181">     mdb_err rv;</span>
<a href="#l6.182"></a><span id="l6.182">     mdb_count c;</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineat">@@ -3147,21 +3181,26 @@ nsAddrDatabase::HasRowButDeletedForCharC</span>
<a href="#l6.184"></a><span id="l6.184">     return (NS_SUCCEEDED(rv) &amp;&amp; hasRow);</span>
<a href="#l6.185"></a><span id="l6.185">   }</span>
<a href="#l6.186"></a><span id="l6.186"> </span>
<a href="#l6.187"></a><span id="l6.187">   rv = m_mdbStore-&gt;FindRow(m_mdbEnv, m_ListRowScopeToken,</span>
<a href="#l6.188"></a><span id="l6.188">     findColumn, &amp;sourceYarn,  &amp;outRowId, aFindRow);</span>
<a href="#l6.189"></a><span id="l6.189">   return (NS_SUCCEEDED(rv) &amp;&amp; *aFindRow);</span>
<a href="#l6.190"></a><span id="l6.190"> }</span>
<a href="#l6.191"></a><span id="l6.191"> </span>
<a href="#l6.192"></a><span id="l6.192" class="difflineplus">+/* @param aRowPos Contains the row position for multiple calls. Should be</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineplus">+ *                instantiated to -1 on the first call. Or can be null</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineplus">+ *                if you are not making multiple calls.</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineplus">+ */</span>
<a href="#l6.196"></a><span id="l6.196"> nsresult</span>
<a href="#l6.197"></a><span id="l6.197"> nsAddrDatabase::GetRowForCharColumn(const PRUnichar *unicodeStr,</span>
<a href="#l6.198"></a><span id="l6.198">                                     mdb_column findColumn, PRBool aIsCard,</span>
<a href="#l6.199"></a><span id="l6.199">                                     PRBool aCaseInsensitive,</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-                                    nsIMdbRow **aFindRow)</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+                                    nsIMdbRow **aFindRow,</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineplus">+                                    mdb_pos *aRowPos)</span>
<a href="#l6.203"></a><span id="l6.203"> {</span>
<a href="#l6.204"></a><span id="l6.204">   NS_ENSURE_ARG_POINTER(unicodeStr);</span>
<a href="#l6.205"></a><span id="l6.205">   NS_ENSURE_ARG_POINTER(aFindRow);</span>
<a href="#l6.206"></a><span id="l6.206">   if (!m_mdbEnv)</span>
<a href="#l6.207"></a><span id="l6.207">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l6.208"></a><span id="l6.208"> </span>
<a href="#l6.209"></a><span id="l6.209">   *aFindRow = nsnull;</span>
<a href="#l6.210"></a><span id="l6.210"> </span>
<a href="#l6.211"></a><span id="l6.211" class="difflineat">@@ -3179,17 +3218,17 @@ nsAddrDatabase::GetRowForCharColumn(cons</span>
<a href="#l6.212"></a><span id="l6.212">   // but if FindRow() returns something, we have to check if it is in the deleted table</span>
<a href="#l6.213"></a><span id="l6.213">   // if not in the deleted table we can return the row (we found a non-deleted card)</span>
<a href="#l6.214"></a><span id="l6.214">   // but if so, we have to search through the table of non-deleted cards</span>
<a href="#l6.215"></a><span id="l6.215">   // for a match.  If we find one, we return it.  but if not, we report that there are no</span>
<a href="#l6.216"></a><span id="l6.216">   // non-deleted cards.  This is the expensive part.  The worse case scenario is to have</span>
<a href="#l6.217"></a><span id="l6.217">   // deleted lots of cards, and then have a lot of non-deleted cards.</span>
<a href="#l6.218"></a><span id="l6.218">   // we'd have to call FindRow(), HasRow(), and then search the list of non-deleted cards</span>
<a href="#l6.219"></a><span id="l6.219">   // each time we call GetRowForCharColumn().</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-  if (!HasRowButDeletedForCharColumn(unicodeStr, findColumn, aIsCard, aFindRow))</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineplus">+  if (!aRowPos &amp;&amp; !HasRowButDeletedForCharColumn(unicodeStr, findColumn, aIsCard, aFindRow))</span>
<a href="#l6.222"></a><span id="l6.222">   {</span>
<a href="#l6.223"></a><span id="l6.223">     // If we have a row, it's the row for the non-delete card, so return NS_OK.</span>
<a href="#l6.224"></a><span id="l6.224">     // If we don't have a row, there are two possible conditions: either the</span>
<a href="#l6.225"></a><span id="l6.225">     // card does not exist, or we are doing case-insensitive searching and the</span>
<a href="#l6.226"></a><span id="l6.226">     // value isn't lowercase.</span>
<a href="#l6.227"></a><span id="l6.227"> </span>
<a href="#l6.228"></a><span id="l6.228">     // Valid result, return.</span>
<a href="#l6.229"></a><span id="l6.229">     if (*aFindRow)</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineat">@@ -3197,24 +3236,27 @@ nsAddrDatabase::GetRowForCharColumn(cons</span>
<a href="#l6.231"></a><span id="l6.231"> </span>
<a href="#l6.232"></a><span id="l6.232">     // We definitely don't have anything at this point if case-sensitive.</span>
<a href="#l6.233"></a><span id="l6.233">     if (!aCaseInsensitive)</span>
<a href="#l6.234"></a><span id="l6.234">       return NS_ERROR_FAILURE;</span>
<a href="#l6.235"></a><span id="l6.235">   }</span>
<a href="#l6.236"></a><span id="l6.236"> </span>
<a href="#l6.237"></a><span id="l6.237">   // check if there is a non-deleted card</span>
<a href="#l6.238"></a><span id="l6.238">   nsCOMPtr&lt;nsIMdbTableRowCursor&gt; rowCursor;</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-  mdb_pos rowPos;</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineplus">+  mdb_pos rowPos = -1;</span>
<a href="#l6.241"></a><span id="l6.241">   PRBool done = PR_FALSE;</span>
<a href="#l6.242"></a><span id="l6.242">   nsCOMPtr&lt;nsIMdbRow&gt; currentRow;</span>
<a href="#l6.243"></a><span id="l6.243">   nsAutoString columnValue;</span>
<a href="#l6.244"></a><span id="l6.244"> </span>
<a href="#l6.245"></a><span id="l6.245" class="difflineplus">+  if (aRowPos)</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineplus">+    rowPos = *aRowPos;</span>
<a href="#l6.247"></a><span id="l6.247" class="difflineplus">+</span>
<a href="#l6.248"></a><span id="l6.248">   mdb_scope targetScope = aIsCard ? m_CardRowScopeToken : m_ListRowScopeToken;</span>
<a href="#l6.249"></a><span id="l6.249"> </span>
<a href="#l6.250"></a><span id="l6.250" class="difflineminus">-  m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, -1, getter_AddRefs(rowCursor));</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineplus">+  m_mdbPabTable-&gt;GetTableRowCursor(m_mdbEnv, rowPos, getter_AddRefs(rowCursor));</span>
<a href="#l6.252"></a><span id="l6.252">   if (!rowCursor)</span>
<a href="#l6.253"></a><span id="l6.253">     return NS_ERROR_FAILURE;</span>
<a href="#l6.254"></a><span id="l6.254"> </span>
<a href="#l6.255"></a><span id="l6.255">   while (!done)</span>
<a href="#l6.256"></a><span id="l6.256">   {</span>
<a href="#l6.257"></a><span id="l6.257">     nsresult rv = rowCursor-&gt;NextRow(m_mdbEnv, getter_AddRefs(currentRow), &amp;rowPos);</span>
<a href="#l6.258"></a><span id="l6.258">     if (currentRow &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l6.259"></a><span id="l6.259">     {</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineat">@@ -3231,16 +3273,18 @@ nsAddrDatabase::GetRowForCharColumn(cons</span>
<a href="#l6.261"></a><span id="l6.261">         PRBool equals = aCaseInsensitive ?</span>
<a href="#l6.262"></a><span id="l6.262">           columnValue.Equals(unicodeStr, CaseInsensitiveCompare) :</span>
<a href="#l6.263"></a><span id="l6.263">           columnValue.Equals(unicodeStr);</span>
<a href="#l6.264"></a><span id="l6.264"> #endif</span>
<a href="#l6.265"></a><span id="l6.265"> </span>
<a href="#l6.266"></a><span id="l6.266">         if (NS_SUCCEEDED(rv) &amp;&amp; equals)</span>
<a href="#l6.267"></a><span id="l6.267">         {</span>
<a href="#l6.268"></a><span id="l6.268">           NS_IF_ADDREF(*aFindRow = currentRow);</span>
<a href="#l6.269"></a><span id="l6.269" class="difflineplus">+          if (aRowPos)</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineplus">+            *aRowPos = rowPos;</span>
<a href="#l6.271"></a><span id="l6.271">           return NS_OK;</span>
<a href="#l6.272"></a><span id="l6.272">         }</span>
<a href="#l6.273"></a><span id="l6.273">       }</span>
<a href="#l6.274"></a><span id="l6.274">     }</span>
<a href="#l6.275"></a><span id="l6.275">     else</span>
<a href="#l6.276"></a><span id="l6.276">       done = PR_TRUE;</span>
<a href="#l6.277"></a><span id="l6.277">   }</span>
<a href="#l6.278"></a><span id="l6.278">   return NS_ERROR_FAILURE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAddrDatabase.h</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAddrDatabase.h</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -83,16 +83,21 @@ public:</span>
<a href="#l7.4"></a><span id="l7.4">   NS_IMETHOD ContainsCard(nsIAbCard *card, PRBool *hasCard);</span>
<a href="#l7.5"></a><span id="l7.5">   NS_IMETHOD DeleteMailList(nsIAbDirectory *aMailList, nsIAbDirectory *aParent);</span>
<a href="#l7.6"></a><span id="l7.6">   NS_IMETHOD EditMailList(nsIAbDirectory *mailList, nsIAbCard *listCard, PRBool notify);</span>
<a href="#l7.7"></a><span id="l7.7">   NS_IMETHOD ContainsMailList(nsIAbDirectory *mailList, PRBool *hasCard);</span>
<a href="#l7.8"></a><span id="l7.8">   NS_IMETHOD DeleteCardFromMailList(nsIAbDirectory *mailList, nsIAbCard *card, PRBool aNotify);</span>
<a href="#l7.9"></a><span id="l7.9">   NS_IMETHOD GetCardFromAttribute(nsIAbDirectory *aDirectory, const char *aName,</span>
<a href="#l7.10"></a><span id="l7.10">                                   const nsACString &amp;aValue,</span>
<a href="#l7.11"></a><span id="l7.11">                                   PRBool aCaseInsensitive, nsIAbCard **card);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  NS_IMETHOD GetCardsFromAttribute(nsIAbDirectory *aDirectory,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                                   const char *aName,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+                                   const nsACString &amp; uUTF8Value,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+                                   PRBool aCaseInsensitive,</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+                                   nsISimpleEnumerator **cards);</span>
<a href="#l7.17"></a><span id="l7.17">   NS_IMETHOD GetNewRow(nsIMdbRow * *newRow);</span>
<a href="#l7.18"></a><span id="l7.18">   NS_IMETHOD GetNewListRow(nsIMdbRow * *newRow);</span>
<a href="#l7.19"></a><span id="l7.19">   NS_IMETHOD AddCardRowToDB(nsIMdbRow *newRow);</span>
<a href="#l7.20"></a><span id="l7.20">   NS_IMETHOD AddLdifListMember(nsIMdbRow* row, const char * value);</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">   NS_IMETHOD GetDeletedCardList(nsIArray **aResult);</span>
<a href="#l7.23"></a><span id="l7.23">   NS_IMETHOD GetDeletedCardCount(PRUint32 *aCount);</span>
<a href="#l7.24"></a><span id="l7.24">   NS_IMETHOD PurgeDeletedCardTable();</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineat">@@ -333,17 +338,18 @@ protected:</span>
<a href="#l7.26"></a><span id="l7.26">   nsresult CreateCard(nsIMdbRow* cardRow, mdb_id listRowID, nsIAbCard **result);</span>
<a href="#l7.27"></a><span id="l7.27">   nsresult CreateCardFromDeletedCardsTable(nsIMdbRow* cardRow, mdb_id listRowID, nsIAbCard **result);</span>
<a href="#l7.28"></a><span id="l7.28">   nsresult DeleteCardFromListRow(nsIMdbRow* pListRow, mdb_id cardRowID);</span>
<a href="#l7.29"></a><span id="l7.29">   void DeleteCardFromAllMailLists(mdb_id cardRowID);</span>
<a href="#l7.30"></a><span id="l7.30">   nsresult NotifyListEntryChange(PRUint32 abCode, nsIAbDirectory *dir);</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32">   nsresult AddLowercaseColumn(nsIMdbRow * row, mdb_token columnToken, const char* utf8String);</span>
<a href="#l7.33"></a><span id="l7.33">   nsresult GetRowFromAttribute(const char *aName, const nsACString &amp;aUTF8Value,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-                               PRBool aCaseInsensitive, nsIMdbRow  **aCardRow);</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+                               PRBool aCaseInsensitive, nsIMdbRow  **aCardRow,</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+                               mdb_pos *aRowPos);</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">   static nsTArray&lt;nsAddrDatabase*&gt;* m_dbCache;</span>
<a href="#l7.39"></a><span id="l7.39">   static nsTArray&lt;nsAddrDatabase*&gt;* GetDBCache();</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41">   // mdb bookkeeping stuff</span>
<a href="#l7.42"></a><span id="l7.42">   nsresult      InitExistingDB();</span>
<a href="#l7.43"></a><span id="l7.43">   nsresult      InitNewDB();</span>
<a href="#l7.44"></a><span id="l7.44">   nsresult      InitMDBInfo();</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineat">@@ -452,17 +458,18 @@ protected:</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47">   PRUint32      m_LastRecordKey;</span>
<a href="#l7.48"></a><span id="l7.48">   nsIAbDirectory*    m_dbDirectory;</span>
<a href="#l7.49"></a><span id="l7.49">   nsCOMPtr&lt;nsIMdbFactory&gt; mMdbFactory;</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51"> private:</span>
<a href="#l7.52"></a><span id="l7.52">   nsresult GetRowForCharColumn(const PRUnichar *unicodeStr,</span>
<a href="#l7.53"></a><span id="l7.53">                                mdb_column findColumn, PRBool bIsCard,</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-                               PRBool aCaseInsensitive, nsIMdbRow **findRow);</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+                               PRBool aCaseInsensitive, nsIMdbRow **findRow,</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+                               mdb_pos *aRowPos);</span>
<a href="#l7.57"></a><span id="l7.57">   PRBool HasRowButDeletedForCharColumn(const PRUnichar *unicodeStr, mdb_column findColumn, PRBool aIsCard, nsIMdbRow **aFindRow);</span>
<a href="#l7.58"></a><span id="l7.58">   nsresult OpenInternal(nsIFile *aMabFile, PRBool aCreate, nsIAddrDatabase **pCardDB);</span>
<a href="#l7.59"></a><span id="l7.59">   nsresult AlertAboutCorruptMabFile(const PRUnichar *aOldFileName, const PRUnichar *aNewFileName);</span>
<a href="#l7.60"></a><span id="l7.60">   nsresult AlertAboutLockedMabFile(const PRUnichar *aFileName);</span>
<a href="#l7.61"></a><span id="l7.61">   nsresult DisplayAlert(const PRUnichar *titleName, const PRUnichar *alertStringName,</span>
<a href="#l7.62"></a><span id="l7.62">                         const PRUnichar **formatStrings, PRInt32 numFormatStrings);</span>
<a href="#l7.63"></a><span id="l7.63"> };</span>
<a href="#l7.64"></a><span id="l7.64"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/data/cardForEmail.mab</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/data/cardForEmail.mab</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l8.4"></a><span id="l8.4"> // &lt;!-- &lt;mdb:mork:z v=&quot;1.4&quot;/&gt; --&gt;</span>
<a href="#l8.5"></a><span id="l8.5"> &lt; &lt;(a=c)&gt; // (f=iso-8859-1)</span>
<a href="#l8.6"></a><span id="l8.6">   (B8=LastModifiedDate)(B9=RecordKey)(BA=AddrCharSet)(BB=LastRecordKey)</span>
<a href="#l8.7"></a><span id="l8.7">   (BC=ns:addrbk:db:table:kind:pab)(BD=ListName)(BE=ListNickName)</span>
<a href="#l8.8"></a><span id="l8.8">   (BF=ListDescription)(C0=ListTotalAddresses)(C1=LowercaseListName)</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-  (C2=ns:addrbk:db:table:kind:deleted)</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+  (C2=ns:addrbk:db:table:kind:deleted)(C3=DbRowID)</span>
<a href="#l8.11"></a><span id="l8.11">   (80=ns:addrbk:db:row:scope:card:all)</span>
<a href="#l8.12"></a><span id="l8.12">   (81=ns:addrbk:db:row:scope:list:all)</span>
<a href="#l8.13"></a><span id="l8.13">   (82=ns:addrbk:db:row:scope:data:all)(83=FirstName)(84=LastName)</span>
<a href="#l8.14"></a><span id="l8.14">   (85=PhoneticFirstName)(86=PhoneticLastName)(87=DisplayName)</span>
<a href="#l8.15"></a><span id="l8.15">   (88=NickName)(89=PrimaryEmail)(8A=LowercasePrimaryEmail)</span>
<a href="#l8.16"></a><span id="l8.16">   (8B=SecondEmail)(8C=PreferMailFormat)(8D=PopularityIndex)</span>
<a href="#l8.17"></a><span id="l8.17">   (8E=AllowRemoteContent)(8F=WorkPhone)(90=HomePhone)(91=FaxNumber)</span>
<a href="#l8.18"></a><span id="l8.18">   (92=PagerNumber)(93=CellularNumber)(94=WorkPhoneType)(95=HomePhoneType)</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineat">@@ -17,45 +17,41 @@</span>
<a href="#l8.20"></a><span id="l8.20">   (9D=HomeZipCode)(9E=HomeCountry)(9F=WorkAddress)(A0=WorkAddress2)</span>
<a href="#l8.21"></a><span id="l8.21">   (A1=WorkCity)(A2=WorkState)(A3=WorkZipCode)(A4=WorkCountry)</span>
<a href="#l8.22"></a><span id="l8.22">   (A5=JobTitle)(A6=Department)(A7=Company)(A8=_AimScreenName)</span>
<a href="#l8.23"></a><span id="l8.23">   (A9=AnniversaryYear)(AA=AnniversaryMonth)(AB=AnniversaryDay)</span>
<a href="#l8.24"></a><span id="l8.24">   (AC=SpouseName)(AD=FamilyName)(AE=WebPage1)(AF=WebPage2)(B0=BirthYear)</span>
<a href="#l8.25"></a><span id="l8.25">   (B1=BirthMonth)(B2=BirthDay)(B3=Custom1)(B4=Custom2)(B5=Custom3)</span>
<a href="#l8.26"></a><span id="l8.26">   (B6=Custom4)(B7=Notes)&gt;</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-&lt;(80=0)&gt;</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-{1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-  [1:^82(^BB=0)]}</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-@$${1{@</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-&lt; &lt;(a=c)&gt; // (f=iso-8859-1)</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-  (C3=DbRowID)&gt;</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-&lt;(82=1)(81=Email)(83=Empty Email)(84=Empty)(85=)&gt;</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-{-1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-  [1:^82(^BB=1)]</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-  [-1(^84^81)(^C3=1)(^87^83)(^8E=0)(^8D=0)(^83^84)(^8C=0)(^B8=0)(^B9=1)</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-    (^89=)(^8A=)]}</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-@$$}1}@</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-@$${2{@</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-&lt;(89=2)(86=LastName1)(87=Custom41)(88=1237281794)(8A=http://WebPage11)</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-  (8B=NickName1)(8C=DisplayName1)(8D=WorkZipCode1)(8E=ScreenName1)(8F</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    =WorkAddress1)(90=HomeCountry1)(91=WorkPhone1)(92</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    =PrimaryEmail1@test.invalid)(93=HomeAddress11)(94</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-    =primaryemail1@test.invalid)(95=WorkCity1)(96</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+&lt;(BA=4)(81=Email)(82=1)(83=Empty Email)(80=0)(84=Empty)(85=)(86=LastName1)</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  (87=Custom41)(88=1237281794)(89=2)(8A=http://WebPage11)(8B=NickName1)</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  (8C=DisplayName1)(8D=WorkZipCode1)(8E=ScreenName1)(8F=WorkAddress1)</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+  (90=HomeCountry1)(91=WorkPhone1)(92=PrimaryEmail1@test.invalid)(93</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+    =HomeAddress11)(94=primaryemail1@test.invalid)(95=WorkCity1)(96</span>
<a href="#l8.55"></a><span id="l8.55">     =SecondEmail1$C3$90@test.invalid)(97=HomeZipCode1)(98=Custom31)</span>
<a href="#l8.56"></a><span id="l8.56">   (99=FaxNumber1)(9A=Custom11)(9B=HomePhone1)(9C=FirstName1)(9D=HomeCity1)</span>
<a href="#l8.57"></a><span id="l8.57">   (9E=PagerNumber1)(9F=CellularNumber1)(A0=WorkAddress21)(A1=WorkState1)</span>
<a href="#l8.58"></a><span id="l8.58">   (A2=HomeAddress21)(A3=http://WebPage21)(A4=Notes1)(A5=Custom21)(A6</span>
<a href="#l8.59"></a><span id="l8.59">     =Department1)(A7=WorkCountry1)(A8=HomeState1)(A9=JobTitle1)(AA</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-    =Organization1)&gt;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-{-1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-  [1:^82(^BB=2)]1 </span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-  [-2(^B0=)(^84^86)(^B6^87)(^8D=0)(^B8^88)(^B9=2)(^AF^8A)(^88^8B)(^87^8C)</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+    =Organization1)(B0=1245128765)(B1=johnd)(B2=John Doe)(B3=Doe)(B4</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+    =john.doe@mailinator.com)(B5=John)(AD=3)(B6=janed)(B7=Jane Doe)</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+  (B8=jane.doe@mailinator.com)(B9=Jane)&gt;</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+{1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+  [1:^82(^BB=4)]</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+  [1(^84^81)(^C3=1)(^87^83)(^8E=0)(^8D=0)(^83^84)(^8C=0)(^B8=0)(^B9=1)</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+    (^89=)(^8A=)]</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+  [2(^B0=)(^84^86)(^B6^87)(^8D=0)(^B8^88)(^B9=2)(^AF^8A)(^88^8B)(^87^8C)</span>
<a href="#l8.72"></a><span id="l8.72">     (^A3^8D)(^A8^8E)(^85=)(^9F^8F)(^9E^90)(^8F^91)(^89^92)(^99^93)(^8A^94)</span>
<a href="#l8.73"></a><span id="l8.73">     (^A1^95)(^8E=1)(^8B^96)(^9D^97)(^B5^98)(^91^99)(^B3^9A)(^90^9B)</span>
<a href="#l8.74"></a><span id="l8.74">     (^83^9C)(^9B^9D)(^92^9E)(^93^9F)(^8C=0)(^A0^A0)(^A2^A1)(^B2=)(^9A^A2)</span>
<a href="#l8.75"></a><span id="l8.75">     (^AE^A3)(^B7^A4)(^B4^A5)(^A6^A6)(^A4^A7)(^86=)(^9C^A8)(^C3=2)(^A5^A9)</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-    (^A7^AA)(^B1=)]}</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-@$$}2}@</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+    (^A7^AA)(^B1=)]</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+  [3(^B0=)(^B7=)(^B6=)(^B8^B0)(^88^B1)(^AE=)(^A6=)(^87^B2)(^B3=)(^A8=)</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+    (^84^B3)(^9F=)(^9E=)(^9C=)(^90=)(^8F=)(^89^B4)(^85=)(^A1=)(^99=)</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+    (^8E=0)(^8B=)(^8D=0)(^B5=)(^91=)(^B1=)(^A4=)(^9D=)(^9B=)(^92=)(^93=)</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+    (^8C=0)(^83^B5)(^A2=)(^B2=)(^9A=)(^B4=)(^A3=)(^86=)(^A0=)(^C3=3)</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+    (^A5=)(^A7=)(^AF=)(^8A^B4)(^B9=3)]</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+  [4(^B0=)(^B7=)(^B6=)(^B8=0)(^88^B6)(^AE=)(^A6=)(^87^B7)(^B3=)(^A8=)</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+    (^84^B3)(^9F=)(^9E=)(^9C=)(^90=)(^8F=)(^89^B8)(^85=)(^A1=)(^99=)</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+    (^8E=0)(^8B=)(^8D=0)(^B5=)(^91=)(^B1=)(^A4=)(^9D=)(^9B=)(^92=)(^93=)</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+    (^8C=0)(^83^B9)(^A2=)(^B2=)(^9A=)(^B4=)(^A3=)(^86=)(^A0=)(^C3=4)</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+    (^A5=)(^A7=)(^AF=)(^8A^B8)(^B9=4)]}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/addrbook/test/unit/data/cardForEmail1.mab</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,61 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+// &lt;!-- &lt;mdb:mork:z v=&quot;1.4&quot;/&gt; --&gt;</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+&lt; &lt;(a=c)&gt; // (f=iso-8859-1)</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+  (B8=LastModifiedDate)(B9=RecordKey)(BA=AddrCharSet)(BB=LastRecordKey)</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+  (BC=ns:addrbk:db:table:kind:pab)(BD=ListName)(BE=ListNickName)</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+  (BF=ListDescription)(C0=ListTotalAddresses)(C1=LowercaseListName)</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+  (C2=ns:addrbk:db:table:kind:deleted)</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+  (80=ns:addrbk:db:row:scope:card:all)</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+  (81=ns:addrbk:db:row:scope:list:all)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  (82=ns:addrbk:db:row:scope:data:all)(83=FirstName)(84=LastName)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  (85=PhoneticFirstName)(86=PhoneticLastName)(87=DisplayName)</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  (88=NickName)(89=PrimaryEmail)(8A=LowercasePrimaryEmail)</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+  (8B=SecondEmail)(8C=PreferMailFormat)(8D=PopularityIndex)</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+  (8E=AllowRemoteContent)(8F=WorkPhone)(90=HomePhone)(91=FaxNumber)</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+  (92=PagerNumber)(93=CellularNumber)(94=WorkPhoneType)(95=HomePhoneType)</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+  (96=FaxNumberType)(97=PagerNumberType)(98=CellularNumberType)</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+  (99=HomeAddress)(9A=HomeAddress2)(9B=HomeCity)(9C=HomeState)</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+  (9D=HomeZipCode)(9E=HomeCountry)(9F=WorkAddress)(A0=WorkAddress2)</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  (A1=WorkCity)(A2=WorkState)(A3=WorkZipCode)(A4=WorkCountry)</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+  (A5=JobTitle)(A6=Department)(A7=Company)(A8=_AimScreenName)</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  (A9=AnniversaryYear)(AA=AnniversaryMonth)(AB=AnniversaryDay)</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+  (AC=SpouseName)(AD=FamilyName)(AE=WebPage1)(AF=WebPage2)(B0=BirthYear)</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  (B1=BirthMonth)(B2=BirthDay)(B3=Custom1)(B4=Custom2)(B5=Custom3)</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+  (B6=Custom4)(B7=Notes)&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+&lt;(80=0)&gt;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+{1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+  [1:^82(^BB=0)]}</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+@$${1{@</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+&lt; &lt;(a=c)&gt; // (f=iso-8859-1)</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+  (C3=DbRowID)&gt;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+&lt;(82=1)(81=Email)(83=Empty Email)(84=Empty)(85=)&gt;</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+{-1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+  [1:^82(^BB=1)]</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+  [-1(^84^81)(^C3=1)(^87^83)(^8E=0)(^8D=0)(^83^84)(^8C=0)(^B8=0)(^B9=1)</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    (^89=)(^8A=)]}</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+@$$}1}@</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+@$${2{@</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+&lt;(89=2)(86=LastName1)(87=Custom41)(88=1237281794)(8A=http://WebPage11)</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  (8B=NickName1)(8C=DisplayName1)(8D=WorkZipCode1)(8E=ScreenName1)(8F</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+    =WorkAddress1)(90=HomeCountry1)(91=WorkPhone1)(92</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+    =PrimaryEmail1@test.invalid)(93=HomeAddress11)(94</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+    =primaryemail1@test.invalid)(95=WorkCity1)(96</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+    =SecondEmail1$C3$90@test.invalid)(97=HomeZipCode1)(98=Custom31)</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+  (99=FaxNumber1)(9A=Custom11)(9B=HomePhone1)(9C=FirstName1)(9D=HomeCity1)</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  (9E=PagerNumber1)(9F=CellularNumber1)(A0=WorkAddress21)(A1=WorkState1)</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+  (A2=HomeAddress21)(A3=http://WebPage21)(A4=Notes1)(A5=Custom21)(A6</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+    =Department1)(A7=WorkCountry1)(A8=HomeState1)(A9=JobTitle1)(AA</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+    =Organization1)&gt;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+{-1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+  [1:^82(^BB=2)]1 </span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+  [-2(^B0=)(^84^86)(^B6^87)(^8D=0)(^B8^88)(^B9=2)(^AF^8A)(^88^8B)(^87^8C)</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+    (^A3^8D)(^A8^8E)(^85=)(^9F^8F)(^9E^90)(^8F^91)(^89^92)(^99^93)(^8A^94)</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+    (^A1^95)(^8E=1)(^8B^96)(^9D^97)(^B5^98)(^91^99)(^B3^9A)(^90^9B)</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+    (^83^9C)(^9B^9D)(^92^9E)(^93^9F)(^8C=0)(^A0^A0)(^A2^A1)(^B2=)(^9A^A2)</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+    (^AE^A3)(^B7^A4)(^B4^A5)(^A6^A6)(^A4^A7)(^86=)(^9C^A8)(^C3=2)(^A5^A9)</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+    (^A7^AA)(^B1=)]}</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+@$$}2}@</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -72,9 +72,26 @@ function run_test() {</span>
<a href="#l10.4"></a><span id="l10.4">   check_correct_card(card);</span>
<a href="#l10.5"></a><span id="l10.5">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle1&quot;, false);</span>
<a href="#l10.6"></a><span id="l10.6">   check_correct_card(card);</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">   do_check_eq(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;jobtitle1&quot;, true), null);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;jobtitle1&quot;, false);</span>
<a href="#l10.11"></a><span id="l10.11">   check_correct_card(card);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  cards = AB.getCardsFromProperty(&quot;LastName&quot;, &quot;DOE&quot;, true);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+  do_check_false(cards.hasMoreElements());</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  cards = AB.getCardsFromProperty(&quot;LastName&quot;, &quot;Doe&quot;, true);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+  var i = 0;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+  var data = [ 'John', 'Jane' ];</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+  while (cards.hasMoreElements()) {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+    i++;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+    card = cards.getNext().QueryInterface(Components.interfaces.nsIAbCard);</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+    do_check_eq(card.lastName, 'Doe');</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+    var index = data.indexOf(card.firstName);</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+    do_check_neq(index, -1);</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+    delete data[index];</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+  }</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+  do_check_eq(i, 2);</span>
<a href="#l10.29"></a><span id="l10.29"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -90,17 +90,17 @@ acObserver.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4"> };</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> function run_test() {</span>
<a href="#l11.7"></a><span id="l11.7">   // Copy the data files into place</span>
<a href="#l11.8"></a><span id="l11.8">   var testAB = do_get_file(&quot;data/autocomplete.mab&quot;);</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">   testAB.copyTo(gProfileDir, kPABData.fileName);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  testAB = do_get_file(&quot;data/cardForEmail.mab&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  testAB = do_get_file(&quot;data/cardForEmail1.mab&quot;);</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">   testAB.copyTo(gProfileDir, kCABData.fileName);</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   // Test - Create a new search component</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">   var acs = Components.classes[&quot;@mozilla.org/autocomplete/search;1?name=addrbook&quot;]</span>
<a href="#l11.20"></a><span id="l11.20">     .getService(Components.interfaces.nsIAutoCompleteSearch);</span>
<a href="#l11.21"></a><span id="l11.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

