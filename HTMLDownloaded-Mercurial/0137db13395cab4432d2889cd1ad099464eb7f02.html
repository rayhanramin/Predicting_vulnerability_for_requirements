<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 167:0137db13395cab4432d2889cd1ad099464eb7f02</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0137db13395cab4432d2889cd1ad099464eb7f02" />
<meta property="og:url" content="/comm-central/rev/0137db13395cab4432d2889cd1ad099464eb7f02" />
<meta property="og:description" content="Bug 366482 – &quot;Edit as new&quot; for opened eml files results in a broken compose window" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0137db13395cab4432d2889cd1ad099464eb7f02 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0137db13395cab4432d2889cd1ad099464eb7f02">shortlog</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0137db13395cab4432d2889cd1ad099464eb7f02">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02">files</a> |
changeset |
<a href="/comm-central/raw-rev/0137db13395cab4432d2889cd1ad099464eb7f02">raw</a>  | <a href="/comm-central/archive/0137db13395cab4432d2889cd1ad099464eb7f02.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=366482">Bug 366482</a> – &quot;Edit as new&quot; for opened eml files results in a broken compose window
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 23 Aug 2008 17:07:53 +0100</td></tr>

<tr>
 <td>changeset 167</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0137db13395cab4432d2889cd1ad099464eb7f02">0137db13395cab4432d2889cd1ad099464eb7f02</a></td>
</tr>



<tr>
<td>parent 166</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/360c6d9b734189a506ba526d392fc555547bb0d7">360c6d9b734189a506ba526d392fc555547bb0d7</a>
</td>
</tr>

<tr>
<td>child 168</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/076411b96f5c9bf94d473b4b17cf3c5a3889397c">076411b96f5c9bf94d473b4b17cf3c5a3889397c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0137db13395cab4432d2889cd1ad099464eb7f02">143</a></td></tr>
<tr><td>push user</td><td>iann_cvs@blueyonder.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Sat, 23 Aug 2008 16:08:49 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0137db13395c [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0137db13395cab4432d2889cd1ad099464eb7f02">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0137db13395cab4432d2889cd1ad099464eb7f02&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0137db13395cab4432d2889cd1ad099464eb7f02&newProject=comm-central&newRevision=0137db13395cab4432d2889cd1ad099464eb7f02&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0137db13395cab4432d2889cd1ad099464eb7f02&newProject=comm-central&newRevision=0137db13395cab4432d2889cd1ad099464eb7f02&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0137db13395cab4432d2889cd1ad099464eb7f02&newProject=comm-central&newRevision=0137db13395cab4432d2889cd1ad099464eb7f02&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=366482">366482</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=366482">Bug 366482</a> – &quot;Edit as new&quot; for opened eml files results in a broken compose window
p=me r=bienvenu/daniel.boelzle sr=neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailCommands.js">mail/base/content/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailCommands.js">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailCommands.js">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailOverlay.xul">mail/base/content/mailOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailOverlay.xul">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailOverlay.xul">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailOverlay.xul">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailOverlay.xul">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mail/base/content/mailOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailCommands.js">mailnews/base/resources/content/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailCommands.js">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailCommands.js">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailOverlay.xul">mailnews/base/resources/content/mailOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailOverlay.xul">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailOverlay.xul">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailOverlay.xul">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailOverlay.xul">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/base/resources/content/mailOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/public/nsIMsgComposeService.idl">mailnews/compose/public/nsIMsgComposeService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/public/nsIMsgComposeService.idl">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/public/nsIMsgComposeService.idl">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/public/nsIMsgComposeService.idl">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/public/nsIMsgComposeService.idl">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/public/nsIMsgComposeService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.h">mailnews/compose/src/nsMsgComposeService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.h">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.h">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.h">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.h">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/compose/src/nsMsgComposeService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/cthandlers/glue/Makefile.in">mailnews/mime/cthandlers/glue/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/cthandlers/glue/Makefile.in">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/cthandlers/glue/Makefile.in">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/cthandlers/glue/Makefile.in">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/cthandlers/glue/Makefile.in">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/cthandlers/glue/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/public/nsIMimeStreamConverter.idl">mailnews/mime/public/nsIMimeStreamConverter.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/public/nsIMimeStreamConverter.idl">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/public/nsIMimeStreamConverter.idl">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/public/nsIMimeStreamConverter.idl">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/public/nsIMimeStreamConverter.idl">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/public/nsIMimeStreamConverter.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimedrft.cpp">mailnews/mime/src/mimedrft.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimedrft.cpp">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimedrft.cpp">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimedrft.cpp">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimedrft.cpp">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimedrft.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimemoz2.h">mailnews/mime/src/mimemoz2.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimemoz2.h">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimemoz2.h">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimemoz2.h">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimemoz2.h">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/mimemoz2.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.cpp">mailnews/mime/src/nsStreamConverter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.cpp">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.cpp">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.cpp">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.cpp">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.h">mailnews/mime/src/nsStreamConverter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.h">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.h">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.h">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.h">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/mailnews/mime/src/nsStreamConverter.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/suite/browser/mailNavigatorOverlay.xul">suite/browser/mailNavigatorOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0137db13395cab4432d2889cd1ad099464eb7f02/suite/browser/mailNavigatorOverlay.xul">file</a> |
<a href="/comm-central/annotate/0137db13395cab4432d2889cd1ad099464eb7f02/suite/browser/mailNavigatorOverlay.xul">annotate</a> |
<a href="/comm-central/diff/0137db13395cab4432d2889cd1ad099464eb7f02/suite/browser/mailNavigatorOverlay.xul">diff</a> |
<a href="/comm-central/comparison/0137db13395cab4432d2889cd1ad099464eb7f02/suite/browser/mailNavigatorOverlay.xul">comparison</a> |
<a href="/comm-central/log/0137db13395cab4432d2889cd1ad099464eb7f02/suite/browser/mailNavigatorOverlay.xul">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailCommands.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailCommands.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -227,23 +227,23 @@ function ComposeMessage(type, format, fo</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">     // dump(&quot;OpenComposeWindow with &quot; + identity + &quot;\n&quot;);</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">     // If the addressbook sidebar panel is open and has focus, get</span>
<a href="#l1.8"></a><span id="l1.8">     // the selected addresses from it.</span>
<a href="#l1.9"></a><span id="l1.9">     if (document.commandDispatcher.focusedWindow.document.documentElement.hasAttribute(&quot;selectedaddresses&quot;))</span>
<a href="#l1.10"></a><span id="l1.10">       NewMessageToSelectedAddresses(type, format, identity);</span>
<a href="#l1.11"></a><span id="l1.11">     else</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      msgComposeService.OpenComposeWindow(null, null, type, format, identity, msgWindow);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      msgComposeService.OpenComposeWindow(null, null, null, type, format, identity, msgWindow);</span>
<a href="#l1.14"></a><span id="l1.14">     return;</span>
<a href="#l1.15"></a><span id="l1.15">   }</span>
<a href="#l1.16"></a><span id="l1.16">   else if (type == msgComposeType.NewsPost)</span>
<a href="#l1.17"></a><span id="l1.17">   {</span>
<a href="#l1.18"></a><span id="l1.18">     // dump(&quot;OpenComposeWindow with &quot; + identity + &quot; and &quot; + newsgroup + &quot;\n&quot;);</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-    msgComposeService.OpenComposeWindow(null, newsgroup, type, format, identity, msgWindow);</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+    msgComposeService.OpenComposeWindow(null, null, newsgroup, type, format, identity, msgWindow);</span>
<a href="#l1.21"></a><span id="l1.21">     return;</span>
<a href="#l1.22"></a><span id="l1.22">   }</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24">   messenger.setWindow(window, msgWindow);</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   var object = null;</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28">   if (messageArray &amp;&amp; messageArray.length &gt; 0)</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineat">@@ -264,30 +264,30 @@ function ComposeMessage(type, format, fo</span>
<a href="#l1.30"></a><span id="l1.30">                type == msgComposeType.ReplyToList ||</span>
<a href="#l1.31"></a><span id="l1.31">                type == msgComposeType.ForwardInline ||</span>
<a href="#l1.32"></a><span id="l1.32">                type == msgComposeType.ReplyToGroup ||</span>
<a href="#l1.33"></a><span id="l1.33">                type == msgComposeType.ReplyToSender ||</span>
<a href="#l1.34"></a><span id="l1.34">                type == msgComposeType.ReplyToSenderAndGroup ||</span>
<a href="#l1.35"></a><span id="l1.35">                type == msgComposeType.Template ||</span>
<a href="#l1.36"></a><span id="l1.36">                type == msgComposeType.Draft)</span>
<a href="#l1.37"></a><span id="l1.37">       {</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-        msgComposeService.OpenComposeWindow(null, messageUri, type, format, identity, msgWindow);</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+        msgComposeService.OpenComposeWindow(null, hdr, messageUri, type, format, identity, msgWindow);</span>
<a href="#l1.40"></a><span id="l1.40">         // Limit the number of new compose windows to 8. Why 8 ? I like that number :-)</span>
<a href="#l1.41"></a><span id="l1.41">         if (i == 7)</span>
<a href="#l1.42"></a><span id="l1.42">           break;</span>
<a href="#l1.43"></a><span id="l1.43">       }</span>
<a href="#l1.44"></a><span id="l1.44">       else</span>
<a href="#l1.45"></a><span id="l1.45">       {</span>
<a href="#l1.46"></a><span id="l1.46">         if (i)</span>
<a href="#l1.47"></a><span id="l1.47">           uri += &quot;,&quot;</span>
<a href="#l1.48"></a><span id="l1.48">         uri += messageUri;</span>
<a href="#l1.49"></a><span id="l1.49">       }</span>
<a href="#l1.50"></a><span id="l1.50">     }</span>
<a href="#l1.51"></a><span id="l1.51">     if (type == msgComposeType.ForwardAsAttachment &amp;&amp; uri)</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-      msgComposeService.OpenComposeWindow(null, uri, type, format, identity, msgWindow);</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+      msgComposeService.OpenComposeWindow(null, null, uri, type, format, identity, msgWindow);</span>
<a href="#l1.54"></a><span id="l1.54">   }</span>
<a href="#l1.55"></a><span id="l1.55">   else</span>
<a href="#l1.56"></a><span id="l1.56">     dump(&quot;### nodeList is invalid\n&quot;);</span>
<a href="#l1.57"></a><span id="l1.57"> }</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59"> function NewMessageToSelectedAddresses(type, format, identity) {</span>
<a href="#l1.60"></a><span id="l1.60">   var abSidebarPanel = document.commandDispatcher.focusedWindow;</span>
<a href="#l1.61"></a><span id="l1.61">   var abResultsTree = abSidebarPanel.document.getElementById(&quot;abResultsTree&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailOverlay.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailOverlay.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -22,17 +22,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">         if (&quot;MsgNewMessage&quot; in window)</span>
<a href="#l2.5"></a><span id="l2.5">         {</span>
<a href="#l2.6"></a><span id="l2.6">           MsgNewMessage(null);</span>
<a href="#l2.7"></a><span id="l2.7">           return;</span>
<a href="#l2.8"></a><span id="l2.8">         }</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">         var msgComposeService = Components.classes[&quot;@mozilla.org/messengercompose;1&quot;].getService();</span>
<a href="#l2.11"></a><span id="l2.11">         msgComposeService = msgComposeService.QueryInterface(Components.interfaces.nsIMsgComposeService);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        msgComposeService.OpenComposeWindow(null, null,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        msgComposeService.OpenComposeWindow(null, null, null</span>
<a href="#l2.14"></a><span id="l2.14">                                             Components.interfaces.nsIMsgCompType.New,</span>
<a href="#l2.15"></a><span id="l2.15">                                             Components.interfaces.nsIMsgCompFormat.Default,</span>
<a href="#l2.16"></a><span id="l2.16">                                             null, null);</span>
<a href="#l2.17"></a><span id="l2.17">       }</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   ]]&gt;</span>
<a href="#l2.20"></a><span id="l2.20">   &lt;/script&gt;</span>
<a href="#l2.21"></a><span id="l2.21">          </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -524,17 +524,17 @@ function goOpenNewMessage()</span>
<a href="#l3.4"></a><span id="l3.4">   // if not, bring up the compose window to the default identity</span>
<a href="#l3.5"></a><span id="l3.5">   if (&quot;MsgNewMessage&quot; in window) {</span>
<a href="#l3.6"></a><span id="l3.6">     MsgNewMessage(null);</span>
<a href="#l3.7"></a><span id="l3.7">     return;</span>
<a href="#l3.8"></a><span id="l3.8">    }</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">    var msgComposeService = Components.classes[&quot;@mozilla.org/messengercompose;1&quot;].getService();</span>
<a href="#l3.11"></a><span id="l3.11">    msgComposeService = msgComposeService.QueryInterface(Components.interfaces.nsIMsgComposeService);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-   msgComposeService.OpenComposeWindow(null, null,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+   msgComposeService.OpenComposeWindow(null, null, null,</span>
<a href="#l3.14"></a><span id="l3.14">                                        Components.interfaces.nsIMsgCompType.New,</span>
<a href="#l3.15"></a><span id="l3.15">                                        Components.interfaces.nsIMsgCompFormat.Default,</span>
<a href="#l3.16"></a><span id="l3.16">                                        null, null);</span>
<a href="#l3.17"></a><span id="l3.17"> }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> function QuoteSelectedMessage()</span>
<a href="#l3.20"></a><span id="l3.20"> {</span>
<a href="#l3.21"></a><span id="l3.21">   var selectedURIs = GetSelectedMessages();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/resources/content/mailCommands.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/resources/content/mailCommands.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -191,23 +191,23 @@ function ComposeMessage(type, format, fo</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     // dump(&quot;OpenComposeWindow with &quot; + identity + &quot;\n&quot;);</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">     // If the addressbook sidebar panel is open and has focus, get</span>
<a href="#l4.8"></a><span id="l4.8">     // the selected addresses from it.</span>
<a href="#l4.9"></a><span id="l4.9">     if (document.commandDispatcher.focusedWindow.document.documentElement.hasAttribute(&quot;selectedaddresses&quot;))</span>
<a href="#l4.10"></a><span id="l4.10">       NewMessageToSelectedAddresses(type, format, identity);</span>
<a href="#l4.11"></a><span id="l4.11">     else</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      msgComposeService.OpenComposeWindow(null, null, type, format, identity, msgWindow);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      msgComposeService.OpenComposeWindow(null, null, null, type, format, identity, msgWindow);</span>
<a href="#l4.14"></a><span id="l4.14">     return;</span>
<a href="#l4.15"></a><span id="l4.15">   }</span>
<a href="#l4.16"></a><span id="l4.16">   else if (type == msgComposeType.NewsPost)</span>
<a href="#l4.17"></a><span id="l4.17">   {</span>
<a href="#l4.18"></a><span id="l4.18">     // dump(&quot;OpenComposeWindow with &quot; + identity + &quot; and &quot; + newsgroup + &quot;\n&quot;);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-    msgComposeService.OpenComposeWindow(null, newsgroup, type, format, identity, msgWindow);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+    msgComposeService.OpenComposeWindow(null, null, newsgroup, type, format, identity, msgWindow);</span>
<a href="#l4.21"></a><span id="l4.21">     return;</span>
<a href="#l4.22"></a><span id="l4.22">   }</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">   messenger.setWindow(window, msgWindow);</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">   var object = null;</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   if (messageArray &amp;&amp; messageArray.length &gt; 0)</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineat">@@ -247,30 +247,30 @@ function ComposeMessage(type, format, fo</span>
<a href="#l4.30"></a><span id="l4.30">         type == msgComposeType.ReplyToList ||</span>
<a href="#l4.31"></a><span id="l4.31">         type == msgComposeType.ForwardInline ||</span>
<a href="#l4.32"></a><span id="l4.32">         type == msgComposeType.ReplyToGroup ||</span>
<a href="#l4.33"></a><span id="l4.33">         type == msgComposeType.ReplyToSender ||</span>
<a href="#l4.34"></a><span id="l4.34">         type == msgComposeType.ReplyToSenderAndGroup ||</span>
<a href="#l4.35"></a><span id="l4.35">         type == msgComposeType.Template ||</span>
<a href="#l4.36"></a><span id="l4.36">         type == msgComposeType.Draft)</span>
<a href="#l4.37"></a><span id="l4.37">       {</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-        msgComposeService.OpenComposeWindow(null, messageUri, type, format, identity, msgWindow);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+        msgComposeService.OpenComposeWindow(null, hdr, messageUri, type, format, identity, msgWindow);</span>
<a href="#l4.40"></a><span id="l4.40">         // Limit the number of new compose windows to 8. Why 8 ? I like that number :-)</span>
<a href="#l4.41"></a><span id="l4.41">         if (i == 7)</span>
<a href="#l4.42"></a><span id="l4.42">           break;</span>
<a href="#l4.43"></a><span id="l4.43">       }</span>
<a href="#l4.44"></a><span id="l4.44">       else</span>
<a href="#l4.45"></a><span id="l4.45">       {</span>
<a href="#l4.46"></a><span id="l4.46">         if (i)</span>
<a href="#l4.47"></a><span id="l4.47">           uri += &quot;,&quot;</span>
<a href="#l4.48"></a><span id="l4.48">         uri += messageUri;</span>
<a href="#l4.49"></a><span id="l4.49">       }</span>
<a href="#l4.50"></a><span id="l4.50">     }</span>
<a href="#l4.51"></a><span id="l4.51">     if (type == msgComposeType.ForwardAsAttachment)</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-      msgComposeService.OpenComposeWindow(null, uri, type, format, identity, msgWindow);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+      msgComposeService.OpenComposeWindow(null, null, uri, type, format, identity, msgWindow);</span>
<a href="#l4.54"></a><span id="l4.54">   }</span>
<a href="#l4.55"></a><span id="l4.55">   else</span>
<a href="#l4.56"></a><span id="l4.56">     dump(&quot;### nodeList is invalid\n&quot;);</span>
<a href="#l4.57"></a><span id="l4.57"> }</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59"> function NewMessageToSelectedAddresses(type, format, identity) {</span>
<a href="#l4.60"></a><span id="l4.60">   var abSidebarPanel = document.commandDispatcher.focusedWindow;</span>
<a href="#l4.61"></a><span id="l4.61">   var abResultsTree = abSidebarPanel.document.getElementById(&quot;abResultsTree&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/resources/content/mailOverlay.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/resources/content/mailOverlay.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -25,17 +25,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">         if (&quot;MsgNewMessage&quot; in window)</span>
<a href="#l5.5"></a><span id="l5.5">         {</span>
<a href="#l5.6"></a><span id="l5.6">           MsgNewMessage(null);</span>
<a href="#l5.7"></a><span id="l5.7">           return;</span>
<a href="#l5.8"></a><span id="l5.8">         }</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">         var msgComposeService = Components.classes[&quot;@mozilla.org/messengercompose;1&quot;].getService();</span>
<a href="#l5.11"></a><span id="l5.11">         msgComposeService = msgComposeService.QueryInterface(Components.interfaces.nsIMsgComposeService);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-        msgComposeService.OpenComposeWindow(null, null,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+        msgComposeService.OpenComposeWindow(null, null, null, null,</span>
<a href="#l5.14"></a><span id="l5.14">                                             Components.interfaces.nsIMsgCompType.New,</span>
<a href="#l5.15"></a><span id="l5.15">                                             Components.interfaces.nsIMsgCompFormat.Default,</span>
<a href="#l5.16"></a><span id="l5.16">                                             null, null);</span>
<a href="#l5.17"></a><span id="l5.17">       }</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">   ]]&gt;</span>
<a href="#l5.20"></a><span id="l5.20">   &lt;/script&gt;</span>
<a href="#l5.21"></a><span id="l5.21">          </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/compose/public/nsIMsgComposeService.idl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/compose/public/nsIMsgComposeService.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -42,21 +42,24 @@</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> interface nsIURI;</span>
<a href="#l6.6"></a><span id="l6.6"> interface nsIDOMWindowInternal;</span>
<a href="#l6.7"></a><span id="l6.7"> interface nsIMsgWindow;</span>
<a href="#l6.8"></a><span id="l6.8"> interface nsIMsgIdentity;</span>
<a href="#l6.9"></a><span id="l6.9"> interface nsIMsgIncomingServer;</span>
<a href="#l6.10"></a><span id="l6.10"> interface nsIMsgDBHdr;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-[scriptable, uuid(BC1C0379-82EF-45ae-9710-DD4FA93252F7)]</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+[scriptable, uuid(ce5f77c8-f278-4ec7-b8dd-ea9dc84af137)]</span>
<a href="#l6.14"></a><span id="l6.14"> interface nsIMsgComposeService : nsISupports {</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">   /* we need a msg window because when we forward inline we may need progress */</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-  void OpenComposeWindow(in string msgComposeWindowURL, in string originalMsgURI, in MSG_ComposeType type, </span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+  void OpenComposeWindow(in string msgComposeWindowURL,</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                         in nsIMsgDBHdr msgHdr,</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+                         in string originalMsgURI,</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+                         in MSG_ComposeType type, </span>
<a href="#l6.22"></a><span id="l6.22">                          in MSG_ComposeFormat format,</span>
<a href="#l6.23"></a><span id="l6.23">                          in nsIMsgIdentity identity, </span>
<a href="#l6.24"></a><span id="l6.24">                          in nsIMsgWindow aMsgWindow);</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">     /* use this method to invoke a compose window given a mailto url.</span>
<a href="#l6.27"></a><span id="l6.27">      aMsgComposeWindowURL --&gt; can be null in most cases. If you have your own chrome</span>
<a href="#l6.28"></a><span id="l6.28">      url you want to use in brining up a compose window, pass it in here. </span>
<a href="#l6.29"></a><span id="l6.29">      aURI --&gt; the mailto url you want to use as the foundation for the data inside</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -529,17 +529,17 @@ nsMsgComposeService::GetOrigWindowSelect</span>
<a href="#l7.4"></a><span id="l7.4">   rv = docEncoder-&gt;EncodeToString(selHTML);</span>
<a href="#l7.5"></a><span id="l7.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.6"></a><span id="l7.6">   aSelHTML = NS_ConvertUTF16toUTF8(selHTML);</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">   return rv;</span>
<a href="#l7.9"></a><span id="l7.9"> }</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> NS_IMETHODIMP</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-nsMsgComposeService::OpenComposeWindow(const char *msgComposeWindowURL, const char *originalMsgURI,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+nsMsgComposeService::OpenComposeWindow(const char *msgComposeWindowURL, nsIMsgDBHdr *origMsgHdr, const char *originalMsgURI,</span>
<a href="#l7.14"></a><span id="l7.14">   MSG_ComposeType type, MSG_ComposeFormat format, nsIMsgIdentity * aIdentity, nsIMsgWindow *aMsgWindow)</span>
<a href="#l7.15"></a><span id="l7.15"> {</span>
<a href="#l7.16"></a><span id="l7.16">   nsresult rv;</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity = aIdentity;</span>
<a href="#l7.19"></a><span id="l7.19">   if (!identity)</span>
<a href="#l7.20"></a><span id="l7.20">     GetDefaultIdentity(getter_AddRefs(identity));</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -550,17 +550,17 @@ nsMsgComposeService::OpenComposeWindow(c</span>
<a href="#l7.23"></a><span id="l7.23">     || type == nsIMsgCompType::ReplyWithTemplate)</span>
<a href="#l7.24"></a><span id="l7.24">   {</span>
<a href="#l7.25"></a><span id="l7.25">       nsCAutoString uriToOpen(originalMsgURI);</span>
<a href="#l7.26"></a><span id="l7.26">       uriToOpen += (uriToOpen.FindChar('?') == kNotFound) ? &quot;?&quot; : &quot;&amp;&quot;;</span>
<a href="#l7.27"></a><span id="l7.27">       uriToOpen.Append(&quot;fetchCompleteMessage=true&quot;);</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">       return LoadDraftOrTemplate(uriToOpen, type == nsIMsgCompType::ForwardInline || type == nsIMsgCompType::Draft ?</span>
<a href="#l7.30"></a><span id="l7.30">                                  nsMimeOutput::nsMimeMessageDraftOrTemplate : nsMimeOutput::nsMimeMessageEditorTemplate,</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                                 identity, originalMsgURI, type == nsIMsgCompType::ForwardInline, aMsgWindow);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+                                 identity, originalMsgURI, origMsgHdr, type == nsIMsgCompType::ForwardInline, aMsgWindow);</span>
<a href="#l7.33"></a><span id="l7.33">   }</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">   nsCOMPtr&lt;nsIMsgComposeParams&gt; pMsgComposeParams (do_CreateInstance(NS_MSGCOMPOSEPARAMS_CONTRACTID, &amp;rv));</span>
<a href="#l7.36"></a><span id="l7.36">   if (NS_SUCCEEDED(rv) &amp;&amp; pMsgComposeParams)</span>
<a href="#l7.37"></a><span id="l7.37">   {</span>
<a href="#l7.38"></a><span id="l7.38">     nsCOMPtr&lt;nsIMsgCompFields&gt; pMsgCompFields (do_CreateInstance(NS_MSGCOMPFIELDS_CONTRACTID, &amp;rv));</span>
<a href="#l7.39"></a><span id="l7.39">     if (NS_SUCCEEDED(rv) &amp;&amp; pMsgCompFields)</span>
<a href="#l7.40"></a><span id="l7.40">     {</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -604,30 +604,17 @@ nsMsgComposeService::OpenComposeWindow(c</span>
<a href="#l7.42"></a><span id="l7.42">                          esc_FileBaseName|esc_Forced|esc_AlwaysCopy,</span>
<a href="#l7.43"></a><span id="l7.43">                          unescapedName);</span>
<a href="#l7.44"></a><span id="l7.44">           pMsgCompFields-&gt;SetNewsgroups(NS_ConvertUTF8toUTF16(unescapedName));</span>
<a href="#l7.45"></a><span id="l7.45">           pMsgCompFields-&gt;SetNewshost(host.get());</span>
<a href="#l7.46"></a><span id="l7.46">         }</span>
<a href="#l7.47"></a><span id="l7.47">         else</span>
<a href="#l7.48"></a><span id="l7.48">         {</span>
<a href="#l7.49"></a><span id="l7.49">           pMsgComposeParams-&gt;SetOriginalMsgURI(originalMsgURI);</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-          if (PL_strstr(originalMsgURI, &quot;type=application/x-message-display&quot;))</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-          {</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-            nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-            if (strncmp(originalMsgURI, &quot;file:&quot;, 5))</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-              rv = GetMsgDBHdrFromURI(originalMsgURI, getter_AddRefs(msgHdr));</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-            if (aMsgWindow &amp;&amp; !msgHdr)</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-            {</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-              nsCOMPtr &lt;nsIMsgHeaderSink&gt; headerSink;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-              rv = aMsgWindow-&gt;GetMsgHeaderSink(getter_AddRefs(headerSink));</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-              if (headerSink)</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-                rv = headerSink-&gt;GetDummyMsgHeader(getter_AddRefs(msgHdr));</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-            }</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-            pMsgComposeParams-&gt;SetOrigMsgHdr(msgHdr);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-          }</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+          pMsgComposeParams-&gt;SetOrigMsgHdr(origMsgHdr);</span>
<a href="#l7.65"></a><span id="l7.65">         }</span>
<a href="#l7.66"></a><span id="l7.66">       }</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68">       pMsgComposeParams-&gt;SetComposeFields(pMsgCompFields);</span>
<a href="#l7.69"></a><span id="l7.69"> </span>
<a href="#l7.70"></a><span id="l7.70">       if(mLogComposePerformance)</span>
<a href="#l7.71"></a><span id="l7.71">       {</span>
<a href="#l7.72"></a><span id="l7.72"> #ifdef MSGCOMP_TRACE_PERFORMANCE</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineat">@@ -1561,32 +1548,34 @@ nsMsgComposeService::GetMsgComposeForWin</span>
<a href="#l7.74"></a><span id="l7.74"> /**</span>
<a href="#l7.75"></a><span id="l7.75">  * LoadDraftOrTemplate</span>
<a href="#l7.76"></a><span id="l7.76">  *   Helper routine used to run msgURI through libmime in order to fetch the contents for a</span>
<a href="#l7.77"></a><span id="l7.77">  *   draft or template.</span>
<a href="#l7.78"></a><span id="l7.78">  */</span>
<a href="#l7.79"></a><span id="l7.79"> nsresult</span>
<a href="#l7.80"></a><span id="l7.80"> nsMsgComposeService::LoadDraftOrTemplate(const nsACString&amp; aMsgURI, nsMimeOutputType aOutType,</span>
<a href="#l7.81"></a><span id="l7.81">                                          nsIMsgIdentity * aIdentity, const char * aOriginalMsgURI,</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+                                         nsIMsgDBHdr * aOrigMsgHdr,</span>
<a href="#l7.83"></a><span id="l7.83">                                          PRBool aAddInlineHeaders, nsIMsgWindow *aMsgWindow)</span>
<a href="#l7.84"></a><span id="l7.84"> {</span>
<a href="#l7.85"></a><span id="l7.85">   nsresult rv;</span>
<a href="#l7.86"></a><span id="l7.86">   nsCOMPtr &lt;nsIMsgMessageService&gt; messageService;</span>
<a href="#l7.87"></a><span id="l7.87">   rv = GetMessageServiceFromURI(aMsgURI, getter_AddRefs(messageService));</span>
<a href="#l7.88"></a><span id="l7.88">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.89"></a><span id="l7.89"> </span>
<a href="#l7.90"></a><span id="l7.90">   // Now, we can create a mime parser (nsIStreamConverter)!</span>
<a href="#l7.91"></a><span id="l7.91">   nsCOMPtr&lt;nsIMimeStreamConverter&gt; mimeConverter =</span>
<a href="#l7.92"></a><span id="l7.92">     do_CreateInstance(NS_MAILNEWS_MIME_STREAM_CONVERTER_CONTRACTID, &amp;rv);</span>
<a href="#l7.93"></a><span id="l7.93">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.94"></a><span id="l7.94"> </span>
<a href="#l7.95"></a><span id="l7.95">   mimeConverter-&gt;SetMimeOutputType(aOutType);  // Set the type of output for libmime</span>
<a href="#l7.96"></a><span id="l7.96">   mimeConverter-&gt;SetForwardInline(aAddInlineHeaders);</span>
<a href="#l7.97"></a><span id="l7.97">   mimeConverter-&gt;SetIdentity(aIdentity);</span>
<a href="#l7.98"></a><span id="l7.98">   mimeConverter-&gt;SetOriginalMsgURI(aOriginalMsgURI);</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+  mimeConverter-&gt;SetOrigMsgHdr(aOrigMsgHdr);</span>
<a href="#l7.100"></a><span id="l7.100"> </span>
<a href="#l7.101"></a><span id="l7.101">   nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l7.102"></a><span id="l7.102">   PRBool fileUrl = StringBeginsWith(aMsgURI, NS_LITERAL_CSTRING(&quot;file:&quot;));</span>
<a href="#l7.103"></a><span id="l7.103">   if (fileUrl || nsDependentCString(aMsgURI).Find(&quot;&amp;type=application/x-message-display&quot;) &gt;= 0)</span>
<a href="#l7.104"></a><span id="l7.104">     rv = NS_NewURI(getter_AddRefs(url), aMsgURI);</span>
<a href="#l7.105"></a><span id="l7.105">   else</span>
<a href="#l7.106"></a><span id="l7.106">     rv = messageService-&gt;GetUrlForUri(PromiseFlatCString(aMsgURI).get(), getter_AddRefs(url), aMsgWindow);</span>
<a href="#l7.107"></a><span id="l7.107">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -96,17 +96,17 @@ private:</span>
<a href="#l8.4"></a><span id="l8.4">   PRInt32 mMaxRecycledWindows;</span>
<a href="#l8.5"></a><span id="l8.5">   nsMsgCachedWindowInfo *mCachedWindows;</span>
<a href="#l8.6"></a><span id="l8.6">   </span>
<a href="#l8.7"></a><span id="l8.7">   nsresult OpenWindow( const char *chrome, nsIMsgComposeParams *params);</span>
<a href="#l8.8"></a><span id="l8.8">   void CloseHiddenCachedWindow(nsIDOMWindowInternal *domWindow);</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">   nsresult LoadDraftOrTemplate(const nsACString&amp; aMsgURI, nsMimeOutputType aOutType, </span>
<a href="#l8.11"></a><span id="l8.11">                                nsIMsgIdentity * aIdentity, const char * aOriginalMsgURI, </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                               PRBool aAddInlineHeaders,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                               nsIMsgDBHdr * aOrigMsgHdr, PRBool aAddInlineHeaders,</span>
<a href="#l8.14"></a><span id="l8.14">                                nsIMsgWindow *aMsgWindow);</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">   nsresult ShowCachedComposeWindow(nsIDOMWindowInternal *aComposeWindow, PRBool aShow);</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">   // hash table mapping dom windows to nsIMsgCompose objects</span>
<a href="#l8.19"></a><span id="l8.19">   nsInterfaceHashtable&lt;nsISupportsHashKey, nsIWeakReference&gt; mOpenComposeWindows;</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   // When doing a reply and the settings are enabled, get the HTML of the selected text</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/mime/cthandlers/glue/Makefile.in</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/glue/Makefile.in</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -49,16 +49,17 @@ EXPORT_LIBRARY = 1</span>
<a href="#l9.4"></a><span id="l9.4"> MOZILLA_INTERNAL_API = 1</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> REQUIRES	= xpcom \</span>
<a href="#l9.7"></a><span id="l9.7"> 		  string \</span>
<a href="#l9.8"></a><span id="l9.8"> 		  pref \</span>
<a href="#l9.9"></a><span id="l9.9"> 		  uconv \</span>
<a href="#l9.10"></a><span id="l9.10"> 		  necko \</span>
<a href="#l9.11"></a><span id="l9.11"> 		  msgbase \</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+		  mailnews \</span>
<a href="#l9.13"></a><span id="l9.13"> 		  $(NULL)</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15"> CPPSRCS		= \</span>
<a href="#l9.16"></a><span id="l9.16"> 		mimexpcom.cpp \</span>
<a href="#l9.17"></a><span id="l9.17"> 		nsMimeContentTypeHandler.cpp \</span>
<a href="#l9.18"></a><span id="l9.18"> 		$(NULL)</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> EXPORTS     = nsMimeContentTypeHandler.h</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/mime/public/nsIMimeStreamConverter.idl</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/mime/public/nsIMimeStreamConverter.idl</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -40,16 +40,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">   for stream converters. Most of this code is just stuff that has been moved out</span>
<a href="#l10.5"></a><span id="l10.5">   of nsIStreamConverter.idl to make it more generic.</span>
<a href="#l10.6"></a><span id="l10.6"> */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsrootidl.idl&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIMimeHeaders.idl&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIMsgIdentity.idl&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+#include &quot;nsIMsgHdr.idl&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14"> interface nsIURI;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> typedef long nsMimeOutputType;</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> [scriptable, uuid(fdc2956e-d558-43fb-bfdd-fb9511229aa5)]</span>
<a href="#l10.19"></a><span id="l10.19"> interface nsMimeOutput</span>
<a href="#l10.20"></a><span id="l10.20"> {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -70,17 +71,17 @@ interface nsMimeOutput</span>
<a href="#l10.22"></a><span id="l10.22">   const long nsMimeUnknown = 15;</span>
<a href="#l10.23"></a><span id="l10.23"> };</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25"> [scriptable, uuid(FA81CAA0-6261-11d3-8311-00805F2A0107)]</span>
<a href="#l10.26"></a><span id="l10.26"> interface nsIMimeStreamConverterListener : nsISupports{</span>
<a href="#l10.27"></a><span id="l10.27">       void onHeadersReady(in nsIMimeHeaders headers);</span>
<a href="#l10.28"></a><span id="l10.28"> };</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-[scriptable, uuid(E4ED8892-3F9E-11d3-9896-001083010E9B)]</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+[scriptable, uuid(9b1d157b-4223-42f5-9bec-11c1ec34d609)]</span>
<a href="#l10.32"></a><span id="l10.32"> interface nsIMimeStreamConverter : nsISupports {</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">     /*</span>
<a href="#l10.35"></a><span id="l10.35">    * This is used to set the desired mime output type on the converer.</span>
<a href="#l10.36"></a><span id="l10.36">      */</span>
<a href="#l10.37"></a><span id="l10.37"> </span>
<a href="#l10.38"></a><span id="l10.38">   void SetMimeOutputType(in nsMimeOutputType aType);</span>
<a href="#l10.39"></a><span id="l10.39"> </span>
<a href="#l10.40"></a><span id="l10.40" class="difflineat">@@ -102,9 +103,10 @@ interface nsIMimeStreamConverter : nsISu</span>
<a href="#l10.41"></a><span id="l10.41">   */</span>
<a href="#l10.42"></a><span id="l10.42">   attribute PRBool forwardInline;</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44">   /*</span>
<a href="#l10.45"></a><span id="l10.45">   * This is used for OpenDraft, OpenEditorTemplate and Forward inline (which use OpenDraft)</span>
<a href="#l10.46"></a><span id="l10.46">   */</span>
<a href="#l10.47"></a><span id="l10.47">   attribute nsIMsgIdentity identity;</span>
<a href="#l10.48"></a><span id="l10.48">   attribute string originalMsgURI;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+  attribute nsIMsgDBHdr origMsgHdr;</span>
<a href="#l10.50"></a><span id="l10.50"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -181,17 +181,18 @@ mime_dump_attachments ( nsMsgAttachmentD</span>
<a href="#l11.4"></a><span id="l11.4"> #endif</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> nsresult</span>
<a href="#l11.7"></a><span id="l11.7"> CreateTheComposeWindow(nsIMsgCompFields *   compFields,</span>
<a href="#l11.8"></a><span id="l11.8">                        nsMsgAttachmentData *attachmentList,</span>
<a href="#l11.9"></a><span id="l11.9">                        MSG_ComposeType      composeType,</span>
<a href="#l11.10"></a><span id="l11.10">                        MSG_ComposeFormat    composeFormat,</span>
<a href="#l11.11"></a><span id="l11.11">                        nsIMsgIdentity *     identity,</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-                       const char *         originalMsgURI</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+                       const char *         originalMsgURI,</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+                       nsIMsgDBHdr *        origMsgHdr</span>
<a href="#l11.15"></a><span id="l11.15">                        )</span>
<a href="#l11.16"></a><span id="l11.16"> {</span>
<a href="#l11.17"></a><span id="l11.17">   nsresult            rv;</span>
<a href="#l11.18"></a><span id="l11.18">   MSG_ComposeFormat   format = nsIMsgCompFormat::Default;</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20"> #ifdef NS_DEBUG</span>
<a href="#l11.21"></a><span id="l11.21">   mime_dump_attachments ( attachmentList );</span>
<a href="#l11.22"></a><span id="l11.22"> #endif</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineat">@@ -252,16 +253,18 @@ CreateTheComposeWindow(nsIMsgCompFields </span>
<a href="#l11.24"></a><span id="l11.24">   if (NS_SUCCEEDED(rv) &amp;&amp; pMsgComposeParams)</span>
<a href="#l11.25"></a><span id="l11.25">   {</span>
<a href="#l11.26"></a><span id="l11.26">     pMsgComposeParams-&gt;SetType(composeType);</span>
<a href="#l11.27"></a><span id="l11.27">     pMsgComposeParams-&gt;SetFormat(format);</span>
<a href="#l11.28"></a><span id="l11.28">     pMsgComposeParams-&gt;SetIdentity(identity);</span>
<a href="#l11.29"></a><span id="l11.29">     pMsgComposeParams-&gt;SetComposeFields(compFields);</span>
<a href="#l11.30"></a><span id="l11.30">     if (originalMsgURI)</span>
<a href="#l11.31"></a><span id="l11.31">       pMsgComposeParams-&gt;SetOriginalMsgURI(originalMsgURI);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    if (origMsgHdr)</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+      pMsgComposeParams-&gt;SetOrigMsgHdr(origMsgHdr);</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35">     rv = msgComposeService-&gt;OpenComposeWindowWithParams(nsnull /* default chrome */, pMsgComposeParams);</span>
<a href="#l11.36"></a><span id="l11.36">   }</span>
<a href="#l11.37"></a><span id="l11.37">   return rv;</span>
<a href="#l11.38"></a><span id="l11.38"> }</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40"> nsresult</span>
<a href="#l11.41"></a><span id="l11.41"> CreateCompositionFields(const char        *from,</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineat">@@ -1537,67 +1540,67 @@ mime_parse_stream_complete (nsMIMESessio</span>
<a href="#l11.43"></a><span id="l11.43">       //</span>
<a href="#l11.44"></a><span id="l11.44">       // At this point, we need to create a message compose window or editor</span>
<a href="#l11.45"></a><span id="l11.45">       // window via XP-COM with the information that we have retrieved from</span>
<a href="#l11.46"></a><span id="l11.46">       // the message store.</span>
<a href="#l11.47"></a><span id="l11.47">       //</span>
<a href="#l11.48"></a><span id="l11.48">       if (mdd-&gt;format_out == nsMimeOutput::nsMimeMessageEditorTemplate)</span>
<a href="#l11.49"></a><span id="l11.49">       {</span>
<a href="#l11.50"></a><span id="l11.50">         fields-&gt;SetDraftId(mdd-&gt;url_name);</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-        CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Template, composeFormat, mdd-&gt;identity, mdd-&gt;originalMsgURI);</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+        CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Template, composeFormat, mdd-&gt;identity, mdd-&gt;originalMsgURI, mdd-&gt;origMsgHdr);</span>
<a href="#l11.53"></a><span id="l11.53">       }</span>
<a href="#l11.54"></a><span id="l11.54">       else</span>
<a href="#l11.55"></a><span id="l11.55">       {</span>
<a href="#l11.56"></a><span id="l11.56">         if (mdd-&gt;forwardInline)</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::ForwardInline, composeFormat, mdd-&gt;identity, mdd-&gt;originalMsgURI);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::ForwardInline, composeFormat, mdd-&gt;identity, mdd-&gt;originalMsgURI, mdd-&gt;origMsgHdr);</span>
<a href="#l11.59"></a><span id="l11.59">         else</span>
<a href="#l11.60"></a><span id="l11.60">         {</span>
<a href="#l11.61"></a><span id="l11.61">           fields-&gt;SetDraftId(mdd-&gt;url_name);</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Draft, composeFormat, mdd-&gt;identity, mdd-&gt;originalMsgURI);</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Draft, composeFormat, mdd-&gt;identity, mdd-&gt;originalMsgURI, mdd-&gt;origMsgHdr);</span>
<a href="#l11.64"></a><span id="l11.64">         }</span>
<a href="#l11.65"></a><span id="l11.65">       }</span>
<a href="#l11.66"></a><span id="l11.66">     }</span>
<a href="#l11.67"></a><span id="l11.67">     else</span>
<a href="#l11.68"></a><span id="l11.68">     {</span>
<a href="#l11.69"></a><span id="l11.69">       //</span>
<a href="#l11.70"></a><span id="l11.70">       // At this point, we need to create a message compose window via</span>
<a href="#l11.71"></a><span id="l11.71">       // XP-COM with the information that we have retrieved from the message store.</span>
<a href="#l11.72"></a><span id="l11.72">       //</span>
<a href="#l11.73"></a><span id="l11.73">       if (mdd-&gt;format_out == nsMimeOutput::nsMimeMessageEditorTemplate)</span>
<a href="#l11.74"></a><span id="l11.74">       {</span>
<a href="#l11.75"></a><span id="l11.75"> #ifdef NS_DEBUG</span>
<a href="#l11.76"></a><span id="l11.76">         printf(&quot;RICHIE: Time to create the EDITOR with this template - NO body!!!!\n&quot;);</span>
<a href="#l11.77"></a><span id="l11.77"> #endif</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineminus">-        CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Template, nsIMsgCompFormat::Default, mdd-&gt;identity, nsnull);</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+        CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Template, nsIMsgCompFormat::Default, mdd-&gt;identity, nsnull, mdd-&gt;origMsgHdr);</span>
<a href="#l11.80"></a><span id="l11.80">       }</span>
<a href="#l11.81"></a><span id="l11.81">       else</span>
<a href="#l11.82"></a><span id="l11.82">       {</span>
<a href="#l11.83"></a><span id="l11.83"> #ifdef NS_DEBUG</span>
<a href="#l11.84"></a><span id="l11.84">         printf(&quot;Time to create the composition window WITHOUT a body!!!!\n&quot;);</span>
<a href="#l11.85"></a><span id="l11.85"> #endif</span>
<a href="#l11.86"></a><span id="l11.86">         if (mdd-&gt;forwardInline)</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::ForwardInline, nsIMsgCompFormat::Default, mdd-&gt;identity, mdd-&gt;originalMsgURI);</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::ForwardInline, nsIMsgCompFormat::Default, mdd-&gt;identity, mdd-&gt;originalMsgURI, mdd-&gt;origMsgHdr);</span>
<a href="#l11.89"></a><span id="l11.89">         else</span>
<a href="#l11.90"></a><span id="l11.90">         {</span>
<a href="#l11.91"></a><span id="l11.91">           fields-&gt;SetDraftId(mdd-&gt;url_name);</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Draft, nsIMsgCompFormat::Default, mdd-&gt;identity, nsnull);</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+          CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::Draft, nsIMsgCompFormat::Default, mdd-&gt;identity, nsnull, mdd-&gt;origMsgHdr);</span>
<a href="#l11.94"></a><span id="l11.94">         }</span>
<a href="#l11.95"></a><span id="l11.95">       }</span>
<a href="#l11.96"></a><span id="l11.96">     }</span>
<a href="#l11.97"></a><span id="l11.97">   }</span>
<a href="#l11.98"></a><span id="l11.98">   else</span>
<a href="#l11.99"></a><span id="l11.99">   {</span>
<a href="#l11.100"></a><span id="l11.100">     CreateCompositionFields( from, repl, to, cc, bcc, fcc, grps, foll,</span>
<a href="#l11.101"></a><span id="l11.101">       org, subj, refs, 0, priority, news_host,</span>
<a href="#l11.102"></a><span id="l11.102">       GetMailXlateionPreference(),</span>
<a href="#l11.103"></a><span id="l11.103">       GetMailSigningPreference(),</span>
<a href="#l11.104"></a><span id="l11.104">       mdd-&gt;mailcharset,</span>
<a href="#l11.105"></a><span id="l11.105">       getter_AddRefs(fields));</span>
<a href="#l11.106"></a><span id="l11.106">     if (fields)</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineminus">-      CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::New, nsIMsgCompFormat::Default, mdd-&gt;identity, nsnull);</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+      CreateTheComposeWindow(fields, newAttachData, nsIMsgCompType::New, nsIMsgCompFormat::Default, mdd-&gt;identity, nsnull, mdd-&gt;origMsgHdr);</span>
<a href="#l11.109"></a><span id="l11.109">   }</span>
<a href="#l11.110"></a><span id="l11.110"> </span>
<a href="#l11.111"></a><span id="l11.111">   if ( mdd-&gt;headers )</span>
<a href="#l11.112"></a><span id="l11.112">     MimeHeaders_free ( mdd-&gt;headers );</span>
<a href="#l11.113"></a><span id="l11.113"> </span>
<a href="#l11.114"></a><span id="l11.114">   //</span>
<a href="#l11.115"></a><span id="l11.115">   // Free the original attachment structure...</span>
<a href="#l11.116"></a><span id="l11.116">   // Make sure we only cleanup the local copy of the memory and not kill</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineat">@@ -1618,16 +1621,17 @@ mime_parse_stream_complete (nsMIMESessio</span>
<a href="#l11.118"></a><span id="l11.118"> </span>
<a href="#l11.119"></a><span id="l11.119">     mime_free_attachments( mdd-&gt;attachments, mdd-&gt;attachments_count );</span>
<a href="#l11.120"></a><span id="l11.120">   }</span>
<a href="#l11.121"></a><span id="l11.121">   PR_FREEIF(mdd-&gt;mailcharset);</span>
<a href="#l11.122"></a><span id="l11.122"> </span>
<a href="#l11.123"></a><span id="l11.123">   mdd-&gt;identity = nsnull;</span>
<a href="#l11.124"></a><span id="l11.124">   PR_Free(mdd-&gt;url_name);</span>
<a href="#l11.125"></a><span id="l11.125">   PR_Free(mdd-&gt;originalMsgURI);</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+  mdd-&gt;origMsgHdr = nsnull;</span>
<a href="#l11.127"></a><span id="l11.127">   PR_Free(mdd);</span>
<a href="#l11.128"></a><span id="l11.128"> </span>
<a href="#l11.129"></a><span id="l11.129">   PR_FREEIF(host);</span>
<a href="#l11.130"></a><span id="l11.130">   PR_FREEIF(to_and_cc);</span>
<a href="#l11.131"></a><span id="l11.131">   PR_FREEIF(re_subject);</span>
<a href="#l11.132"></a><span id="l11.132">   PR_FREEIF(new_refs);</span>
<a href="#l11.133"></a><span id="l11.133">   PR_FREEIF(from);</span>
<a href="#l11.134"></a><span id="l11.134">   PR_FREEIF(repl);</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineat">@@ -2048,16 +2052,17 @@ mime_bridge_create_draft_stream(</span>
<a href="#l11.136"></a><span id="l11.136">     mdd-&gt;url_name = ToNewCString(urlString);</span>
<a href="#l11.137"></a><span id="l11.137">     if (!(mdd-&gt;url_name))</span>
<a href="#l11.138"></a><span id="l11.138">       goto FAIL;</span>
<a href="#l11.139"></a><span id="l11.139">   }</span>
<a href="#l11.140"></a><span id="l11.140"> </span>
<a href="#l11.141"></a><span id="l11.141">   newPluginObj2-&gt;GetForwardInline(&amp;mdd-&gt;forwardInline);</span>
<a href="#l11.142"></a><span id="l11.142">   newPluginObj2-&gt;GetIdentity(getter_AddRefs(mdd-&gt;identity));</span>
<a href="#l11.143"></a><span id="l11.143">   newPluginObj2-&gt;GetOriginalMsgURI(&amp;mdd-&gt;originalMsgURI);</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+  newPluginObj2-&gt;GetOrigMsgHdr(getter_AddRefs(mdd-&gt;origMsgHdr));</span>
<a href="#l11.145"></a><span id="l11.145">   mdd-&gt;format_out = format_out;</span>
<a href="#l11.146"></a><span id="l11.146">   mdd-&gt;options = new  MimeDisplayOptions ;</span>
<a href="#l11.147"></a><span id="l11.147">   if (!mdd-&gt;options)</span>
<a href="#l11.148"></a><span id="l11.148">     goto FAIL;</span>
<a href="#l11.149"></a><span id="l11.149"> </span>
<a href="#l11.150"></a><span id="l11.150">   mdd-&gt;options-&gt;url = strdup(mdd-&gt;url_name);</span>
<a href="#l11.151"></a><span id="l11.151">   mdd-&gt;options-&gt;format_out = format_out;     // output format</span>
<a href="#l11.152"></a><span id="l11.152">   mdd-&gt;options-&gt;decompose_file_p = PR_TRUE; /* new field in MimeDisplayOptions */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -153,16 +153,17 @@ struct mime_draft_data</span>
<a href="#l12.4"></a><span id="l12.4">   nsCOMPtr &lt;nsILocalFile&gt; tmpFile;</span>
<a href="#l12.5"></a><span id="l12.5">   nsCOMPtr &lt;nsIOutputStream&gt; tmpFileStream;      // output file handle</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7">   MimeDecoderData     *decoder_data;</span>
<a href="#l12.8"></a><span id="l12.8">   char                *mailcharset;        // get it from CHARSET of Content-Type</span>
<a href="#l12.9"></a><span id="l12.9">   PRBool              forwardInline;</span>
<a href="#l12.10"></a><span id="l12.10">   nsCOMPtr&lt;nsIMsgIdentity&gt;      identity;</span>
<a href="#l12.11"></a><span id="l12.11">   char                *originalMsgURI;     // the original URI of the message we are currently processing</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  nsCOMPtr&lt;nsIMsgDBHdr&gt;         origMsgHdr;</span>
<a href="#l12.13"></a><span id="l12.13"> };</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15"> ////////////////////////////////////////////////////////////////</span>
<a href="#l12.16"></a><span id="l12.16"> // Bridge routines for legacy mime code</span>
<a href="#l12.17"></a><span id="l12.17"> ////////////////////////////////////////////////////////////////</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> // Create bridge stream for libmime</span>
<a href="#l12.20"></a><span id="l12.20"> extern &quot;C&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -61,17 +61,16 @@</span>
<a href="#l13.4"></a><span id="l13.4"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;nsIMsgQuote.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsIScriptSecurityManager.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;mozITXTToHTMLConv.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#include &quot;nsStreamConverter.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsIInterfaceRequestorUtils.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> #include &quot;nsIAsyncInputStream.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsIAsyncOutputStream.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> #define PREF_MAIL_DISPLAY_GLYPH &quot;mail.display_glyph&quot;</span>
<a href="#l13.20"></a><span id="l13.20"> #define PREF_MAIL_DISPLAY_STRUCT &quot;mail.display_struct&quot;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -831,16 +830,31 @@ nsStreamConverter::SetOriginalMsgURI(con</span>
<a href="#l13.22"></a><span id="l13.22"> NS_IMETHODIMP</span>
<a href="#l13.23"></a><span id="l13.23"> nsStreamConverter::GetOriginalMsgURI(char ** result)</span>
<a href="#l13.24"></a><span id="l13.24"> {</span>
<a href="#l13.25"></a><span id="l13.25">   if (!result) return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.26"></a><span id="l13.26">   *result = ToNewCString(mOriginalMsgURI);</span>
<a href="#l13.27"></a><span id="l13.27">   return NS_OK;</span>
<a href="#l13.28"></a><span id="l13.28"> }</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+nsStreamConverter::SetOrigMsgHdr(nsIMsgDBHdr *aMsgHdr)</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+{</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+  mOrigMsgHdr = aMsgHdr;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+}</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+NS_IMETHODIMP</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+nsStreamConverter::GetOrigMsgHdr(nsIMsgDBHdr * *aMsgHdr)</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+{</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+  if (!aMsgHdr) return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+  NS_IF_ADDREF(*aMsgHdr = mOrigMsgHdr);</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+} </span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+</span>
<a href="#l13.45"></a><span id="l13.45"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.46"></a><span id="l13.46"> // Methods for nsIStreamListener...</span>
<a href="#l13.47"></a><span id="l13.47"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.48"></a><span id="l13.48"> //</span>
<a href="#l13.49"></a><span id="l13.49"> // Notify the client that data is available in the input stream.  This</span>
<a href="#l13.50"></a><span id="l13.50"> // method is called whenver data is written into the input stream by the</span>
<a href="#l13.51"></a><span id="l13.51"> // networking library...</span>
<a href="#l13.52"></a><span id="l13.52"> //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -97,16 +97,17 @@ private:</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">   nsCString                     mOverrideFormat;  // this is a possible override for emitter creation</span>
<a href="#l14.6"></a><span id="l14.6">   PRBool                        mWrapperOutput;   // Should we output the frame split message display </span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8">   nsCOMPtr&lt;nsIMimeStreamConverterListener&gt;  mMimeStreamConverterListener;</span>
<a href="#l14.9"></a><span id="l14.9">   PRBool                        mForwardInline;</span>
<a href="#l14.10"></a><span id="l14.10">   nsCOMPtr&lt;nsIMsgIdentity&gt;      mIdentity;</span>
<a href="#l14.11"></a><span id="l14.11">   nsCString                     mOriginalMsgURI;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+  nsCOMPtr&lt;nsIMsgDBHdr&gt;         mOrigMsgHdr;</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14">   nsCString                     mFromType;</span>
<a href="#l14.15"></a><span id="l14.15">   nsCString                     mToType;</span>
<a href="#l14.16"></a><span id="l14.16"> #ifdef DEBUG_mscott  </span>
<a href="#l14.17"></a><span id="l14.17">   PRTime mConvertContentTime;</span>
<a href="#l14.18"></a><span id="l14.18"> #endif</span>
<a href="#l14.19"></a><span id="l14.19">   nsIRequest *                  mPendingRequest;  // used when we need to delay to fire onStartRequest</span>
<a href="#l14.20"></a><span id="l14.20">   nsISupports *                 mPendingContext;  // used when we need to delay to fire onStartRequest</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/browser/mailNavigatorOverlay.xul</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/browser/mailNavigatorOverlay.xul</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -88,17 +88,17 @@</span>
<a href="#l15.4"></a><span id="l15.4">         if (&quot;MsgNewMessage&quot; in window)</span>
<a href="#l15.5"></a><span id="l15.5">         {</span>
<a href="#l15.6"></a><span id="l15.6">           MsgNewMessage(null);</span>
<a href="#l15.7"></a><span id="l15.7">           return;</span>
<a href="#l15.8"></a><span id="l15.8">         }</span>
<a href="#l15.9"></a><span id="l15.9">         </span>
<a href="#l15.10"></a><span id="l15.10">         var msgComposeService = Components.classes[&quot;@mozilla.org/messengercompose;1&quot;].getService();</span>
<a href="#l15.11"></a><span id="l15.11">         msgComposeService = msgComposeService.QueryInterface(Components.interfaces.nsIMsgComposeService);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        msgComposeService.OpenComposeWindow(null, null,</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        msgComposeService.OpenComposeWindow(null, null, null,</span>
<a href="#l15.14"></a><span id="l15.14">                                            Components.interfaces.nsIMsgCompType.New,</span>
<a href="#l15.15"></a><span id="l15.15">                                            Components.interfaces.nsIMsgCompFormat.Default,</span>
<a href="#l15.16"></a><span id="l15.16">                                            null, null);</span>
<a href="#l15.17"></a><span id="l15.17">       }</span>
<a href="#l15.18"></a><span id="l15.18">       else {</span>
<a href="#l15.19"></a><span id="l15.19">         openExternalMailer();</span>
<a href="#l15.20"></a><span id="l15.20">       }</span>
<a href="#l15.21"></a><span id="l15.21">     }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

