<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22505:497ee9e16aff5daeb90d253773876185893f1e62</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 497ee9e16aff5daeb90d253773876185893f1e62" />
<meta property="og:url" content="/comm-central/rev/497ee9e16aff5daeb90d253773876185893f1e62" />
<meta property="og:description" content="Backed out changeset 2bfef5c6f2a7: Bug 1415567 - Port bug 1414096 which was backed out. a=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 497ee9e16aff5daeb90d253773876185893f1e62 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/497ee9e16aff5daeb90d253773876185893f1e62">shortlog</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/497ee9e16aff5daeb90d253773876185893f1e62">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62">files</a> |
changeset |
<a href="/comm-central/raw-rev/497ee9e16aff5daeb90d253773876185893f1e62">raw</a>  | <a href="/comm-central/archive/497ee9e16aff5daeb90d253773876185893f1e62.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Backed out changeset 2bfef5c6f2a7: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1415567">Bug 1415567</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1414096">bug 1414096</a> which was backed out. a=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 08 Nov 2017 23:15:41 +0100</td></tr>

<tr>
 <td>changeset 22505</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/497ee9e16aff5daeb90d253773876185893f1e62">497ee9e16aff5daeb90d253773876185893f1e62</a></td>
</tr>



<tr>
<td>parent 22504</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3617ae4c65c86ddcc56f0b2b8651e7bbf73b0132">3617ae4c65c86ddcc56f0b2b8651e7bbf73b0132</a>
</td>
</tr>

<tr>
<td>child 22506</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7cf42e74929f17259b04eb45fe8e5bcc2dea9ec5">7cf42e74929f17259b04eb45fe8e5bcc2dea9ec5</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=497ee9e16aff5daeb90d253773876185893f1e62">13724</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 08 Nov 2017 22:20:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8412a6e55924 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8412a6e559247f8da9b64e88e11efd72d8d341b6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8412a6e559247f8da9b64e88e11efd72d8d341b6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8412a6e559247f8da9b64e88e11efd72d8d341b6&newProject=comm-central&newRevision=3617ae4c65c86ddcc56f0b2b8651e7bbf73b0132&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8412a6e559247f8da9b64e88e11efd72d8d341b6&newProject=comm-central&newRevision=3617ae4c65c86ddcc56f0b2b8651e7bbf73b0132&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8412a6e559247f8da9b64e88e11efd72d8d341b6&newProject=comm-central&newRevision=3617ae4c65c86ddcc56f0b2b8651e7bbf73b0132&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1415567">1415567</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1414096">1414096</a></td></tr>

<tr><td>backs out</td><td><a style="font-family: monospace" href="/comm-central/rev/2bfef5c6f2a706f63de9cf896ac2d8527a475a53">2bfef5c6f2a706f63de9cf896ac2d8527a475a53</a></td></tr>


</table></div>

<div class="page_body description">Backed out changeset 2bfef5c6f2a7: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1415567">Bug 1415567</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1414096">bug 1414096</a> which was backed out. a=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imAccounts.js">chat/components/src/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imAccounts.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imAccounts.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imCore.js">chat/components/src/imCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imCore.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imCore.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imCore.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imCore.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/chat/components/src/imCore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/modules/jsProtoHelper.jsm">chat/modules/jsProtoHelper.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/chat/modules/jsProtoHelper.jsm">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/chat/modules/jsProtoHelper.jsm">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/modules/jsProtoHelper.jsm">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/chat/modules/jsProtoHelper.jsm">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/chat/modules/jsProtoHelper.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/protocols/xmpp/xmpp.jsm">chat/protocols/xmpp/xmpp.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/chat/protocols/xmpp/xmpp.jsm">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/chat/protocols/xmpp/xmpp.jsm">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/chat/protocols/xmpp/xmpp.jsm">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/chat/protocols/xmpp/xmpp.jsm">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/chat/protocols/xmpp/xmpp.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editor.js">editor/ui/composer/content/editor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editor.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editor.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editor.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editor.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editorUtilities.js">editor/ui/composer/content/editorUtilities.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editorUtilities.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editorUtilities.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editorUtilities.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editorUtilities.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/editorUtilities.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/publishprefs.js">editor/ui/composer/content/publishprefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/publishprefs.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/publishprefs.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/publishprefs.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/publishprefs.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/editor/ui/composer/content/publishprefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/im/content/account.js">im/content/account.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/im/content/account.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/im/content/account.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/im/content/account.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/im/content/account.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/im/content/account.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/im/content/joinchat.js">im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/content/joinchat.js">mail/components/im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/imIncomingServer.js">mail/components/im/imIncomingServer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/imIncomingServer.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/imIncomingServer.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/imIncomingServer.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/imIncomingServer.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/im/imIncomingServer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/preferences/attachmentReminder.js">mail/components/preferences/attachmentReminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/preferences/attachmentReminder.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/preferences/attachmentReminder.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/preferences/attachmentReminder.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/preferences/attachmentReminder.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/mail/components/preferences/attachmentReminder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mailnews/extensions/smime/content/certFetchingStatus.js">mailnews/extensions/smime/content/certFetchingStatus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/mailnews/extensions/smime/content/certFetchingStatus.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/mailnews/extensions/smime/content/certFetchingStatus.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/mailnews/extensions/smime/content/certFetchingStatus.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/mailnews/extensions/smime/content/certFetchingStatus.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/mailnews/extensions/smime/content/certFetchingStatus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/browser/nsBrowserContentHandler.js">suite/browser/nsBrowserContentHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/suite/browser/nsBrowserContentHandler.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/suite/browser/nsBrowserContentHandler.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/browser/nsBrowserContentHandler.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/suite/browser/nsBrowserContentHandler.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/suite/browser/nsBrowserContentHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/common/utilityOverlay.js">suite/common/utilityOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/suite/common/utilityOverlay.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/suite/common/utilityOverlay.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/common/utilityOverlay.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/suite/common/utilityOverlay.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/suite/common/utilityOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/FeedWriter.js">suite/feeds/src/FeedWriter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/FeedWriter.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/FeedWriter.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/FeedWriter.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/FeedWriter.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/FeedWriter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/WebContentConverter.js">suite/feeds/src/WebContentConverter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/WebContentConverter.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/WebContentConverter.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/WebContentConverter.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/WebContentConverter.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/suite/feeds/src/WebContentConverter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/modules/test/unit/test_browser_sanitizer.js">suite/modules/test/unit/test_browser_sanitizer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/497ee9e16aff5daeb90d253773876185893f1e62/suite/modules/test/unit/test_browser_sanitizer.js">file</a> |
<a href="/comm-central/annotate/497ee9e16aff5daeb90d253773876185893f1e62/suite/modules/test/unit/test_browser_sanitizer.js">annotate</a> |
<a href="/comm-central/diff/497ee9e16aff5daeb90d253773876185893f1e62/suite/modules/test/unit/test_browser_sanitizer.js">diff</a> |
<a href="/comm-central/comparison/497ee9e16aff5daeb90d253773876185893f1e62/suite/modules/test/unit/test_browser_sanitizer.js">comparison</a> |
<a href="/comm-central/log/497ee9e16aff5daeb90d253773876185893f1e62/suite/modules/test/unit/test_browser_sanitizer.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/components/src/imAccounts.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/components/src/imAccounts.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -124,22 +124,27 @@ function imAccount(aKey, aName, aPrplId)</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   this.id = aKey;</span>
<a href="#l1.6"></a><span id="l1.6">   this.numericId = parseInt(aKey.substr(kAccountKeyPrefix.length));</span>
<a href="#l1.7"></a><span id="l1.7">   gAccountsService._keepAccount(this);</span>
<a href="#l1.8"></a><span id="l1.8">   this.prefBranch = Services.prefs.getBranch(kPrefAccountPrefix + aKey + &quot;.&quot;);</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">   if (aName) {</span>
<a href="#l1.11"></a><span id="l1.11">     this.name = aName;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    this.prefBranch.setStringPref(kPrefAccountName, aName);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+              .createInstance(Ci.nsISupportsString);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    str.data = aName;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+    this.prefBranch.setComplexValue(kPrefAccountName, Ci.nsISupportsString,</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+                                    str);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">     this.firstConnectionState = Ci.imIAccount.FIRST_CONNECTION_UNKNOWN;</span>
<a href="#l1.20"></a><span id="l1.20">   }</span>
<a href="#l1.21"></a><span id="l1.21">   else {</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-    this.name = this.prefBranch.getStringPref(kPrefAccountName);</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+    this.name = this.prefBranch.getComplexValue(kPrefAccountName,</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+                                                Ci.nsISupportsString).data;</span>
<a href="#l1.25"></a><span id="l1.25">   }</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   let prplId = aPrplId;</span>
<a href="#l1.28"></a><span id="l1.28">   if (prplId)</span>
<a href="#l1.29"></a><span id="l1.29">     this.prefBranch.setCharPref(kPrefAccountPrpl, prplId);</span>
<a href="#l1.30"></a><span id="l1.30">   else</span>
<a href="#l1.31"></a><span id="l1.31">     prplId = this.prefBranch.getCharPref(kPrefAccountPrpl);</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33" class="difflineat">@@ -166,17 +171,18 @@ function imAccount(aKey, aName, aPrplId)</span>
<a href="#l1.34"></a><span id="l1.34">     this.firstConnectionState = Ci.imIAccount.FIRST_CONNECTION_CRASHED;</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36">   Services.logins.initializationPromise.then(() =&gt; {</span>
<a href="#l1.37"></a><span id="l1.37">     // Try to convert old passwords stored in the preferences.</span>
<a href="#l1.38"></a><span id="l1.38">     // Don't try too hard if the user has canceled a master password prompt:</span>
<a href="#l1.39"></a><span id="l1.39">     // we don't want to display several of theses prompts at startup.</span>
<a href="#l1.40"></a><span id="l1.40">     if (gConvertingOldPasswords &amp;&amp; !this.protocol.noPassword) {</span>
<a href="#l1.41"></a><span id="l1.41">       try {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-        let password = this.prefBranch.getStringPref(kPrefAccountPassword);</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+        let password = this.prefBranch.getComplexValue(kPrefAccountPassword,</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+                                                       Ci.nsISupportsString).data;</span>
<a href="#l1.45"></a><span id="l1.45">         if (password &amp;&amp; !this.password)</span>
<a href="#l1.46"></a><span id="l1.46">           this.password = password;</span>
<a href="#l1.47"></a><span id="l1.47">       } catch (e) { /* No password saved in the prefs for this account. */ }</span>
<a href="#l1.48"></a><span id="l1.48">     }</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50">     // Check for errors that should prevent connection attempts.</span>
<a href="#l1.51"></a><span id="l1.51">     if (this._passwordRequired &amp;&amp; !this.password)</span>
<a href="#l1.52"></a><span id="l1.52">       this._connectionErrorReason = Ci.imIAccount.ERROR_MISSING_PASSWORD;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineat">@@ -227,17 +233,18 @@ imAccount.prototype = {</span>
<a href="#l1.54"></a><span id="l1.54">       this._finishedAutoLogin();</span>
<a href="#l1.55"></a><span id="l1.55">       this.timeOfLastConnect = Date.now();</span>
<a href="#l1.56"></a><span id="l1.56">       if (this.firstConnectionState != Ci.imIAccount.FIRST_CONNECTION_OK)</span>
<a href="#l1.57"></a><span id="l1.57">         this.firstConnectionState = Ci.imIAccount.FIRST_CONNECTION_OK;</span>
<a href="#l1.58"></a><span id="l1.58">       delete this.connectionStateMsg;</span>
<a href="#l1.59"></a><span id="l1.59"> </span>
<a href="#l1.60"></a><span id="l1.60">       if (this.canJoinChat &amp;&amp;</span>
<a href="#l1.61"></a><span id="l1.61">           this.prefBranch.prefHasUserValue(kPrefAccountAutoJoin)) {</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-        let autojoin = this.prefBranch.getStringPref(kPrefAccountAutoJoin);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+        let autojoin = this.prefBranch.getComplexValue(</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+          kPrefAccountAutoJoin, Ci.nsISupportsString).data;</span>
<a href="#l1.65"></a><span id="l1.65">         if (autojoin) {</span>
<a href="#l1.66"></a><span id="l1.66">           for (let room of autojoin.trim().split(/,\s*/)) {</span>
<a href="#l1.67"></a><span id="l1.67">             if (room)</span>
<a href="#l1.68"></a><span id="l1.68">               this.joinChat(this.getChatRoomDefaultFieldValues(room));</span>
<a href="#l1.69"></a><span id="l1.69">           }</span>
<a href="#l1.70"></a><span id="l1.70">         }</span>
<a href="#l1.71"></a><span id="l1.71">       }</span>
<a href="#l1.72"></a><span id="l1.72">     }</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineat">@@ -468,25 +475,30 @@ imAccount.prototype = {</span>
<a href="#l1.74"></a><span id="l1.74">   },</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76">   _sendUpdateNotification: function() {</span>
<a href="#l1.77"></a><span id="l1.77">     this._sendNotification(&quot;account-updated&quot;);</span>
<a href="#l1.78"></a><span id="l1.78">   },</span>
<a href="#l1.79"></a><span id="l1.79"> </span>
<a href="#l1.80"></a><span id="l1.80">   set alias(val) {</span>
<a href="#l1.81"></a><span id="l1.81">     if (val) {</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-      this.prefBranch.setStringPref(kPrefAccountAlias, val);</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+      let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+                .createInstance(Ci.nsISupportsString);</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+      str.data = val;</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+      this.prefBranch.setComplexValue(kPrefAccountAlias, Ci.nsISupportsString,</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+                                      str);</span>
<a href="#l1.88"></a><span id="l1.88">     }</span>
<a href="#l1.89"></a><span id="l1.89">     else</span>
<a href="#l1.90"></a><span id="l1.90">       this.prefBranch.deleteBranch(kPrefAccountAlias);</span>
<a href="#l1.91"></a><span id="l1.91">     this._sendUpdateNotification();</span>
<a href="#l1.92"></a><span id="l1.92">   },</span>
<a href="#l1.93"></a><span id="l1.93">   get alias() {</span>
<a href="#l1.94"></a><span id="l1.94">     try {</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-      return this.prefBranch.getStringPref(kPrefAccountAlias);</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+      return this.prefBranch.getComplexValue(kPrefAccountAlias,</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+                                             Ci.nsISupportsString).data;</span>
<a href="#l1.98"></a><span id="l1.98">     } catch (e) {</span>
<a href="#l1.99"></a><span id="l1.99">       return &quot;&quot;;</span>
<a href="#l1.100"></a><span id="l1.100">     }</span>
<a href="#l1.101"></a><span id="l1.101">   },</span>
<a href="#l1.102"></a><span id="l1.102"> </span>
<a href="#l1.103"></a><span id="l1.103">   _password: &quot;&quot;,</span>
<a href="#l1.104"></a><span id="l1.104">   get password() {</span>
<a href="#l1.105"></a><span id="l1.105">     if (this._password)</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineat">@@ -786,17 +798,21 @@ imAccount.prototype = {</span>
<a href="#l1.107"></a><span id="l1.107">   setInt: function(aName, aVal) {</span>
<a href="#l1.108"></a><span id="l1.108">     this.prefBranch.setIntPref(kAccountOptionPrefPrefix + aName, aVal);</span>
<a href="#l1.109"></a><span id="l1.109">     this._connectionInfoChanged();</span>
<a href="#l1.110"></a><span id="l1.110">     if (this.prplAccount)</span>
<a href="#l1.111"></a><span id="l1.111">       this.prplAccount.setInt(aName, aVal);</span>
<a href="#l1.112"></a><span id="l1.112">     SavePrefTimer.initTimer();</span>
<a href="#l1.113"></a><span id="l1.113">   },</span>
<a href="#l1.114"></a><span id="l1.114">   setString: function(aName, aVal) {</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineminus">-    this.prefBranch.setStringPref(kAccountOptionPrefPrefix + aName, aVal);</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+    let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+              .createInstance(Ci.nsISupportsString);</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+    str.data = aVal;</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+    this.prefBranch.setComplexValue(kAccountOptionPrefPrefix + aName,</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+                                    Ci.nsISupportsString, str);</span>
<a href="#l1.121"></a><span id="l1.121">     this._connectionInfoChanged();</span>
<a href="#l1.122"></a><span id="l1.122">     if (this.prplAccount)</span>
<a href="#l1.123"></a><span id="l1.123">       this.prplAccount.setString(aName, aVal);</span>
<a href="#l1.124"></a><span id="l1.124">     SavePrefTimer.initTimer();</span>
<a href="#l1.125"></a><span id="l1.125">   },</span>
<a href="#l1.126"></a><span id="l1.126">   save: function() { SavePrefTimer.saveNow(); },</span>
<a href="#l1.127"></a><span id="l1.127"> </span>
<a href="#l1.128"></a><span id="l1.128">   get HTMLEnabled() { return this._ensurePrplAccount.HTMLEnabled; },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/components/src/imCore.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/components/src/imCore.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -209,20 +209,25 @@ UserStatus.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">       Services.console.logStringMessage(&quot;Invalid userIconFileName preference&quot;);</span>
<a href="#l2.5"></a><span id="l2.5">       return null;</span>
<a href="#l2.6"></a><span id="l2.6">     }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">     return Services.io.newFileURI(file);</span>
<a href="#l2.9"></a><span id="l2.9">   },</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">   get displayName() {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    return Services.prefs.getStringPref(kPrefUserDisplayname);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    return Services.prefs.getComplexValue(kPrefUserDisplayname,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+                                          Ci.nsISupportsString).data;</span>
<a href="#l2.15"></a><span id="l2.15">   },</span>
<a href="#l2.16"></a><span id="l2.16">   set displayName(aDisplayName) {</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-    Services.prefs.setStringPref(kPrefUserDisplayname, aDisplayName);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+              .createInstance(Ci.nsISupportsString);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    str.data = aDisplayName;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+    Services.prefs.setComplexValue(kPrefUserDisplayname, Ci.nsISupportsString,</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+                                   str);</span>
<a href="#l2.23"></a><span id="l2.23">     this._notifyObservers(&quot;user-display-name-changed&quot;, aDisplayName);</span>
<a href="#l2.24"></a><span id="l2.24">   },</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26">   addObserver: function(aObserver) {</span>
<a href="#l2.27"></a><span id="l2.27">     if (!this._observers.includes(aObserver))</span>
<a href="#l2.28"></a><span id="l2.28">       this._observers.push(aObserver);</span>
<a href="#l2.29"></a><span id="l2.29">   },</span>
<a href="#l2.30"></a><span id="l2.30">   removeObserver: function(aObserver) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/chat/modules/jsProtoHelper.jsm</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/chat/modules/jsProtoHelper.jsm</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -214,17 +214,17 @@ var GenericAccountPrototype = {</span>
<a href="#l3.4"></a><span id="l3.4">     return this.prefs.prefHasUserValue(aName) ?</span>
<a href="#l3.5"></a><span id="l3.5">            this.prefs[&quot;get&quot; + aType + &quot;Pref&quot;](aName) :</span>
<a href="#l3.6"></a><span id="l3.6">            this.protocol._getOptionDefault(aName);</span>
<a href="#l3.7"></a><span id="l3.7">   },</span>
<a href="#l3.8"></a><span id="l3.8">   getInt: function(aName) { return this.getPref(aName, &quot;Int&quot;); },</span>
<a href="#l3.9"></a><span id="l3.9">   getBool: function(aName) { return this.getPref(aName, &quot;Bool&quot;); },</span>
<a href="#l3.10"></a><span id="l3.10">   getString: function(aName) {</span>
<a href="#l3.11"></a><span id="l3.11">     return this.prefs.prefHasUserValue(aName) ?</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-             this.prefs.getStringPref(aName) :</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+             this.prefs.getComplexValue(aName, Ci.nsISupportsString).data :</span>
<a href="#l3.14"></a><span id="l3.14">              this.protocol._getOptionDefault(aName);</span>
<a href="#l3.15"></a><span id="l3.15">   },</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17">   get prefs() {</span>
<a href="#l3.18"></a><span id="l3.18">     return this._prefs ||</span>
<a href="#l3.19"></a><span id="l3.19">            (this._prefs = Services.prefs.getBranch(&quot;messenger.account.&quot; +</span>
<a href="#l3.20"></a><span id="l3.20">                                                    this.imAccount.id + &quot;.options.&quot;));</span>
<a href="#l3.21"></a><span id="l3.21">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/protocols/xmpp/xmpp.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/protocols/xmpp/xmpp.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1317,17 +1317,20 @@ var XMPPAccountPrototype = {</span>
<a href="#l4.4"></a><span id="l4.4">       // because while connected it's the jid of the session that's</span>
<a href="#l4.5"></a><span id="l4.5">       // interesting.</span>
<a href="#l4.6"></a><span id="l4.6">       this._jid = this._setJID(this._jid.domain, this._jid.node, resource);</span>
<a href="#l4.7"></a><span id="l4.7">     }</span>
<a href="#l4.8"></a><span id="l4.8">     else if (this._jid.resource) {</span>
<a href="#l4.9"></a><span id="l4.9">       // If there is a resource in the account name (inherited from libpurple),</span>
<a href="#l4.10"></a><span id="l4.10">       // migrate it to the pref so it appears correctly in the advanced account</span>
<a href="#l4.11"></a><span id="l4.11">       // options next time.</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      this.prefs.setStringPref(&quot;resource&quot;, this._jid.resource);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                  .createInstance(Ci.nsISupportsString);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      str.data = this._jid.resource;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+      this.prefs.setComplexValue(&quot;resource&quot;, Ci.nsISupportsString, str);</span>
<a href="#l4.17"></a><span id="l4.17">     }</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">     this._connection =</span>
<a href="#l4.20"></a><span id="l4.20">       new XMPPSession(this.getString(&quot;server&quot;) || this._jid.domain,</span>
<a href="#l4.21"></a><span id="l4.21">                       this.getInt(&quot;port&quot;) || 5222,</span>
<a href="#l4.22"></a><span id="l4.22">                       this.getString(&quot;connection_security&quot;), this._jid,</span>
<a href="#l4.23"></a><span id="l4.23">                       this.imAccount.password, this);</span>
<a href="#l4.24"></a><span id="l4.24">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/editor/ui/composer/content/editor.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/editor/ui/composer/content/editor.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -2320,17 +2320,18 @@ function EditorSetDefaultPrefsAndDoctype</span>
<a href="#l5.4"></a><span id="l5.4">       editor.documentCharacterSet = prefCharsetString;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">     // let's start by assuming we have an author in case we don't have the pref</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">     var prefAuthorString = null;</span>
<a href="#l5.9"></a><span id="l5.9">     let authorFound = domdoc.querySelector('meta[name=&quot;author&quot;]');</span>
<a href="#l5.10"></a><span id="l5.10">     try</span>
<a href="#l5.11"></a><span id="l5.11">     {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      prefAuthorString = Services.prefs.getStringPref(&quot;editor.author&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      prefAuthorString = Services.prefs.getComplexValue(&quot;editor.author&quot;,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+                                                        Components.interfaces.nsISupportsString).data;</span>
<a href="#l5.15"></a><span id="l5.15">     }</span>
<a href="#l5.16"></a><span id="l5.16">     catch (ex) {}</span>
<a href="#l5.17"></a><span id="l5.17">     if (prefAuthorString &amp;&amp; prefAuthorString != 0 &amp;&amp; !authorFound &amp;&amp; headelement)</span>
<a href="#l5.18"></a><span id="l5.18">     {</span>
<a href="#l5.19"></a><span id="l5.19">       // create meta tag with 2 attributes</span>
<a href="#l5.20"></a><span id="l5.20">       element = domdoc.createElement(&quot;meta&quot;);</span>
<a href="#l5.21"></a><span id="l5.21">       if (element)</span>
<a href="#l5.22"></a><span id="l5.22">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/editor/ui/composer/content/editorUtilities.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/editor/ui/composer/content/editorUtilities.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -390,25 +390,28 @@ function GetFileProtocolHandler()</span>
<a href="#l6.4"></a><span id="l6.4"> {</span>
<a href="#l6.5"></a><span id="l6.5">   let handler = Services.io.getProtocolHandler(&quot;file&quot;);</span>
<a href="#l6.6"></a><span id="l6.6">   return handler.QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l6.7"></a><span id="l6.7"> }</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> function GetStringPref(name)</span>
<a href="#l6.10"></a><span id="l6.10"> {</span>
<a href="#l6.11"></a><span id="l6.11">   try {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    return Services.prefs.getStringPref(name);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    return Services.prefs.getComplexValue(name, Components.interfaces.nsISupportsString).data;</span>
<a href="#l6.14"></a><span id="l6.14">   } catch (e) {}</span>
<a href="#l6.15"></a><span id="l6.15">   return &quot;&quot;;</span>
<a href="#l6.16"></a><span id="l6.16"> }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> function SetStringPref(aPrefName, aPrefValue)</span>
<a href="#l6.19"></a><span id="l6.19"> {</span>
<a href="#l6.20"></a><span id="l6.20">   try {</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-    Services.prefs.setStringPref(aPrefName, aPrefValue);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+    let str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+                        .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+    str.data = aPrefValue;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+    Services.prefs.setComplexValue(aPrefName, Components.interfaces.nsISupportsString, str);</span>
<a href="#l6.26"></a><span id="l6.26">   }</span>
<a href="#l6.27"></a><span id="l6.27">   catch(e) {}</span>
<a href="#l6.28"></a><span id="l6.28"> }</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30"> // Set initial directory for a filepicker from URLs saved in prefs</span>
<a href="#l6.31"></a><span id="l6.31"> function SetFilePickerDirectory(filePicker, fileType)</span>
<a href="#l6.32"></a><span id="l6.32"> {</span>
<a href="#l6.33"></a><span id="l6.33">   if (filePicker)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/editor/ui/composer/content/publishprefs.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/editor/ui/composer/content/publishprefs.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -718,28 +718,31 @@ function FillInMatchingPublishData(publi</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> // Prefs that don't exist will through an exception,</span>
<a href="#l7.6"></a><span id="l7.6"> //  so just return an empty string</span>
<a href="#l7.7"></a><span id="l7.7"> function GetPublishStringPref(prefBranch, name)</span>
<a href="#l7.8"></a><span id="l7.8"> {</span>
<a href="#l7.9"></a><span id="l7.9">   if (prefBranch &amp;&amp; name)</span>
<a href="#l7.10"></a><span id="l7.10">   {</span>
<a href="#l7.11"></a><span id="l7.11">     try {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      return prefBranch.getStringPref(name);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      return prefBranch.getComplexValue(name, Components.interfaces.nsISupportsString).data;</span>
<a href="#l7.14"></a><span id="l7.14">     } catch (e) {}</span>
<a href="#l7.15"></a><span id="l7.15">   }</span>
<a href="#l7.16"></a><span id="l7.16">   return &quot;&quot;;</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> function SetPublishStringPref(prefBranch, name, value)</span>
<a href="#l7.20"></a><span id="l7.20"> {</span>
<a href="#l7.21"></a><span id="l7.21">   if (prefBranch &amp;&amp; name)</span>
<a href="#l7.22"></a><span id="l7.22">   {</span>
<a href="#l7.23"></a><span id="l7.23">     try {</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-        prefBranch.setStringPref(name, value);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+        var str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+                            .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+        str.data = value;</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+        prefBranch.setComplexValue(name, Components.interfaces.nsISupportsString, str);</span>
<a href="#l7.29"></a><span id="l7.29">     } catch (e) {}</span>
<a href="#l7.30"></a><span id="l7.30">   }</span>
<a href="#l7.31"></a><span id="l7.31"> }</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33"> // Assure that a publishing URL ends in &quot;/&quot;, &quot;=&quot;, &quot;&amp;&quot; or &quot;?&quot;</span>
<a href="#l7.34"></a><span id="l7.34"> // Username and password should always be extracted as separate fields</span>
<a href="#l7.35"></a><span id="l7.35"> //  and are not allowed to remain embedded in publishing URL</span>
<a href="#l7.36"></a><span id="l7.36"> function FormatUrlForPublishing(url)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/content/account.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/content/account.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -34,17 +34,17 @@ var account = {</span>
<a href="#l8.4"></a><span id="l8.4">     if (protoId == &quot;prpl-irc&quot; || protoId == &quot;prpl-jabber&quot; ||</span>
<a href="#l8.5"></a><span id="l8.5">         protoId == &quot;prpl-gtalk&quot;) {</span>
<a href="#l8.6"></a><span id="l8.6">       document.getElementById(&quot;optionalSeparator&quot;).hidden = false;</span>
<a href="#l8.7"></a><span id="l8.7">       document.getElementById(&quot;autojoinBox&quot;).hidden = false;</span>
<a href="#l8.8"></a><span id="l8.8">       var branch = Services.prefs.getBranch(&quot;messenger.account.&quot; +</span>
<a href="#l8.9"></a><span id="l8.9">                                             this.account.id + &quot;.&quot;);</span>
<a href="#l8.10"></a><span id="l8.10">       if (branch.prefHasUserValue(autoJoinPref)) {</span>
<a href="#l8.11"></a><span id="l8.11">         document.getElementById(&quot;autojoin&quot;).value =</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          branch.getStringPref(autoJoinPref);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+          branch.getComplexValue(autoJoinPref, Ci.nsISupportsString).data;</span>
<a href="#l8.14"></a><span id="l8.14">       }</span>
<a href="#l8.15"></a><span id="l8.15">     }</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17"> /* FIXME</span>
<a href="#l8.18"></a><span id="l8.18">     document.getElementById(&quot;newMailNotification&quot;).hidden =</span>
<a href="#l8.19"></a><span id="l8.19">       !this.proto.newMailNotification;</span>
<a href="#l8.20"></a><span id="l8.20"> */</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -126,17 +126,17 @@ var account = {</span>
<a href="#l8.23"></a><span id="l8.23">     if (this.prefs.prefHasUserValue(aOpt.name))</span>
<a href="#l8.24"></a><span id="l8.24">       return this.prefs.getIntPref(aOpt.name);</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">     return aOpt.getInt();</span>
<a href="#l8.27"></a><span id="l8.27">   },</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">   getString: function account_getString(aOpt) {</span>
<a href="#l8.30"></a><span id="l8.30">     if (this.prefs.prefHasUserValue(aOpt.name))</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-      return this.prefs.getStringPref(aOpt.name);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+      return this.prefs.getComplexValue(aOpt.name, Ci.nsISupportsString).data;</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34">     return aOpt.getString();</span>
<a href="#l8.35"></a><span id="l8.35">   },</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">   getListValue: function account_getListValue(aOpt) {</span>
<a href="#l8.38"></a><span id="l8.38">     if (this.prefs.prefHasUserValue(aOpt.name))</span>
<a href="#l8.39"></a><span id="l8.39">       return this.prefs.getCharPref(aOpt.name);</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -171,17 +171,20 @@ var account = {</span>
<a href="#l8.42"></a><span id="l8.42"> </span>
<a href="#l8.43"></a><span id="l8.43">     let protoId = this.proto.id;</span>
<a href="#l8.44"></a><span id="l8.44">     if (protoId == &quot;prpl-irc&quot; || protoId == &quot;prpl-jabber&quot; ||</span>
<a href="#l8.45"></a><span id="l8.45">         protoId == &quot;prpl-gtalk&quot;) {</span>
<a href="#l8.46"></a><span id="l8.46">       var branch = Services.prefs.getBranch(&quot;messenger.account.&quot; +</span>
<a href="#l8.47"></a><span id="l8.47">                                             this.account.id + &quot;.&quot;);</span>
<a href="#l8.48"></a><span id="l8.48">       var autojoin = this.getValue(&quot;autojoin&quot;);</span>
<a href="#l8.49"></a><span id="l8.49">       if (autojoin || branch.prefHasUserValue(autoJoinPref)) {</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-        branch.setStringPref(autoJoinPref, autojoin);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+        let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+                    .createInstance(Ci.nsISupportsString);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+        str.data = autojoin;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+        branch.setComplexValue(autoJoinPref, Ci.nsISupportsString, str);</span>
<a href="#l8.55"></a><span id="l8.55">       }</span>
<a href="#l8.56"></a><span id="l8.56">     }</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58">     if (this.proto.usePurpleProxy &amp;&amp;</span>
<a href="#l8.59"></a><span id="l8.59">         this.account.proxyInfo.key != this.proxy.key)</span>
<a href="#l8.60"></a><span id="l8.60">       this.account.proxyInfo = this.proxy;</span>
<a href="#l8.61"></a><span id="l8.61"> </span>
<a href="#l8.62"></a><span id="l8.62">     for (let opt of this.getProtoOptions()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/im/content/joinchat.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/im/content/joinchat.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -125,22 +125,25 @@ var joinChat = {</span>
<a href="#l9.4"></a><span id="l9.4">       if (nick)</span>
<a href="#l9.5"></a><span id="l9.5">         name += &quot;/&quot; + nick;</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">       let prefBranch =</span>
<a href="#l9.8"></a><span id="l9.8">         Services.prefs.getBranch(&quot;messenger.account.&quot; + account.id + &quot;.&quot;);</span>
<a href="#l9.9"></a><span id="l9.9">       let autojoin = [];</span>
<a href="#l9.10"></a><span id="l9.10">       if (prefBranch.prefHasUserValue(autoJoinPref)) {</span>
<a href="#l9.11"></a><span id="l9.11">         let prefValue =</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-          prefBranch.getStringPref(autoJoinPref);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+          prefBranch.getComplexValue(autoJoinPref, Ci.nsISupportsString).data;</span>
<a href="#l9.14"></a><span id="l9.14">         if (prefValue)</span>
<a href="#l9.15"></a><span id="l9.15">           autojoin = prefValue.split(&quot;,&quot;);</span>
<a href="#l9.16"></a><span id="l9.16">       }</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">       if (!autojoin.includes(name)) {</span>
<a href="#l9.19"></a><span id="l9.19">         autojoin.push(name);</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-        prefBranch.setStringPref(autoJoinPref, autojoin.join(&quot;,&quot;));</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+        let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+                    .createInstance(Ci.nsISupportsString);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+        str.data = autojoin.join(&quot;,&quot;);</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+        prefBranch.setComplexValue(autoJoinPref, Ci.nsISupportsString, str);</span>
<a href="#l9.25"></a><span id="l9.25">       }</span>
<a href="#l9.26"></a><span id="l9.26">     }</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28">     return true;</span>
<a href="#l9.29"></a><span id="l9.29">   }</span>
<a href="#l9.30"></a><span id="l9.30"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -5655,17 +5655,18 @@ function enableInlineSpellCheck(aEnableI</span>
<a href="#l10.4"></a><span id="l10.4"> function getMailToolbox()</span>
<a href="#l10.5"></a><span id="l10.5"> {</span>
<a href="#l10.6"></a><span id="l10.6">   return document.getElementById(&quot;compose-toolbox&quot;);</span>
<a href="#l10.7"></a><span id="l10.7"> }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> function getPref(aPrefName, aIsComplex) {</span>
<a href="#l10.10"></a><span id="l10.10">   const Ci = Components.interfaces;</span>
<a href="#l10.11"></a><span id="l10.11">   if (aIsComplex) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    return Services.prefs.getStringPref(aPrefName);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    return Services.prefs</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+                   .getComplexValue(aPrefName, Ci.nsISupportsString).data;</span>
<a href="#l10.15"></a><span id="l10.15">   }</span>
<a href="#l10.16"></a><span id="l10.16">   switch (Services.prefs.getPrefType(aPrefName)) {</span>
<a href="#l10.17"></a><span id="l10.17">     case Ci.nsIPrefBranch.PREF_BOOL:</span>
<a href="#l10.18"></a><span id="l10.18">       return Services.prefs.getBoolPref(aPrefName);</span>
<a href="#l10.19"></a><span id="l10.19">     case Ci.nsIPrefBranch.PREF_INT:</span>
<a href="#l10.20"></a><span id="l10.20">       return Services.prefs.getIntPref(aPrefName);</span>
<a href="#l10.21"></a><span id="l10.21">     case Ci.nsIPrefBranch.PREF_STRING:</span>
<a href="#l10.22"></a><span id="l10.22">       return Services.prefs.getCharPref(aPrefName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/im/content/joinchat.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/im/content/joinchat.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -134,22 +134,25 @@ var joinChat = {</span>
<a href="#l11.4"></a><span id="l11.4">       if (nick)</span>
<a href="#l11.5"></a><span id="l11.5">         name += &quot;/&quot; + nick;</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">       let prefBranch =</span>
<a href="#l11.8"></a><span id="l11.8">         Services.prefs.getBranch(&quot;messenger.account.&quot; + account.id + &quot;.&quot;);</span>
<a href="#l11.9"></a><span id="l11.9">       let autojoin = [];</span>
<a href="#l11.10"></a><span id="l11.10">       if (prefBranch.prefHasUserValue(autoJoinPref)) {</span>
<a href="#l11.11"></a><span id="l11.11">         let prefValue =</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-          prefBranch.getStringPref(autoJoinPref);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+          prefBranch.getComplexValue(autoJoinPref, Ci.nsISupportsString).data;</span>
<a href="#l11.14"></a><span id="l11.14">         if (prefValue)</span>
<a href="#l11.15"></a><span id="l11.15">           autojoin = prefValue.split(&quot;,&quot;);</span>
<a href="#l11.16"></a><span id="l11.16">       }</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">       if (!autojoin.includes(name)) {</span>
<a href="#l11.19"></a><span id="l11.19">         autojoin.push(name);</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-        prefBranch.setStringPref(autoJoinPref, autojoin.join(&quot;,&quot;));</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+        let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+                    .createInstance(Ci.nsISupportsString);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+        str.data = autojoin.join(&quot;,&quot;);</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+        prefBranch.setComplexValue(autoJoinPref, Ci.nsISupportsString, str);</span>
<a href="#l11.25"></a><span id="l11.25">       }</span>
<a href="#l11.26"></a><span id="l11.26">     }</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">     return true;</span>
<a href="#l11.29"></a><span id="l11.29">   }</span>
<a href="#l11.30"></a><span id="l11.30"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/im/imIncomingServer.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/im/imIncomingServer.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -95,24 +95,27 @@ imIncomingServer.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">   },</span>
<a href="#l12.5"></a><span id="l12.5">   get alias() { return this.imAccount.alias; },</span>
<a href="#l12.6"></a><span id="l12.6">   set alias(aAlias) {</span>
<a href="#l12.7"></a><span id="l12.7">     this.imAccount.alias = aAlias;</span>
<a href="#l12.8"></a><span id="l12.8">   },</span>
<a href="#l12.9"></a><span id="l12.9">   get autojoin() {</span>
<a href="#l12.10"></a><span id="l12.10">     try {</span>
<a href="#l12.11"></a><span id="l12.11">       let prefName = &quot;messenger.account.&quot; + this.imAccount.id + &quot;.autoJoin&quot;;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      return Services.prefs.getStringPref(prefName);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+      return Services.prefs.getComplexValue(prefName, Ci.nsISupportsString).data;</span>
<a href="#l12.14"></a><span id="l12.14">     } catch (e) {</span>
<a href="#l12.15"></a><span id="l12.15">       return &quot;&quot;;</span>
<a href="#l12.16"></a><span id="l12.16">     }</span>
<a href="#l12.17"></a><span id="l12.17">   },</span>
<a href="#l12.18"></a><span id="l12.18">   set autojoin(aAutoJoin) {</span>
<a href="#l12.19"></a><span id="l12.19">     let prefName = &quot;messenger.account.&quot; + this.imAccount.id + &quot;.autoJoin&quot;;</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-    Services.prefs.setStringPref(prefName, aAutoJoin);</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+    let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+                .createInstance(Ci.nsISupportsString);</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+    str.data = aAutoJoin;</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+    Services.prefs.setComplexValue(prefName, Ci.nsISupportsString, str);</span>
<a href="#l12.25"></a><span id="l12.25">   },</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   // This is used for user-visible advanced preferences.</span>
<a href="#l12.28"></a><span id="l12.28">   setUnicharValue: function(aPrefName, aValue) {</span>
<a href="#l12.29"></a><span id="l12.29">     if (aPrefName == &quot;autojoin&quot;)</span>
<a href="#l12.30"></a><span id="l12.30">       this.autojoin = aValue;</span>
<a href="#l12.31"></a><span id="l12.31">     else if (aPrefName == &quot;alias&quot;)</span>
<a href="#l12.32"></a><span id="l12.32">       this.alias = aValue;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineat">@@ -127,17 +130,18 @@ imIncomingServer.prototype = {</span>
<a href="#l12.34"></a><span id="l12.34">     if (aPrefName == &quot;alias&quot;)</span>
<a href="#l12.35"></a><span id="l12.35">       return this.alias;</span>
<a href="#l12.36"></a><span id="l12.36">     if (aPrefName == &quot;password&quot;)</span>
<a href="#l12.37"></a><span id="l12.37">       return this.password;</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39">     try {</span>
<a href="#l12.40"></a><span id="l12.40">       let prefName =</span>
<a href="#l12.41"></a><span id="l12.41">         &quot;messenger.account.&quot; + this.imAccount.id + &quot;.options.&quot; + aPrefName;</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-      return Services.prefs.getStringPref(prefName);</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+      return Services.prefs.getComplexValue(prefName,</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+                                            Ci.nsISupportsString).data;</span>
<a href="#l12.45"></a><span id="l12.45">     } catch (x) {</span>
<a href="#l12.46"></a><span id="l12.46">       return this._getDefault(aPrefName);</span>
<a href="#l12.47"></a><span id="l12.47">     }</span>
<a href="#l12.48"></a><span id="l12.48">   },</span>
<a href="#l12.49"></a><span id="l12.49">   setBoolValue: function(aPrefName, aValue) {</span>
<a href="#l12.50"></a><span id="l12.50">     this.imAccount.setBool(aPrefName, aValue);</span>
<a href="#l12.51"></a><span id="l12.51">   },</span>
<a href="#l12.52"></a><span id="l12.52">   getBoolValue: function(aPrefName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/preferences/attachmentReminder.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/preferences/attachmentReminder.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -72,12 +72,15 @@ var gAttachmentReminderOptionsDialog = {</span>
<a href="#l13.4"></a><span id="l13.4">   {</span>
<a href="#l13.5"></a><span id="l13.5">     var keywordList = &quot;&quot;;</span>
<a href="#l13.6"></a><span id="l13.6">     for (var i = 0; i &lt; this.keywordListBox.getRowCount(); i++) {</span>
<a href="#l13.7"></a><span id="l13.7">       keywordList += this.keywordListBox.getItemAtIndex(i).getAttribute(&quot;value&quot;);</span>
<a href="#l13.8"></a><span id="l13.8">       if (i != this.keywordListBox.getRowCount() - 1)</span>
<a href="#l13.9"></a><span id="l13.9">         keywordList += &quot;,&quot;;</span>
<a href="#l13.10"></a><span id="l13.10">     }</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    Services.prefs.setStringPref(&quot;mail.compose.attachment_reminder_keywords&quot;,</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                                 keywordList);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+    var str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+                        .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+    str.data = keywordList;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+    Services.prefs.setComplexValue(&quot;mail.compose.attachment_reminder_keywords&quot;,</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+                                   Components.interfaces.nsISupportsString, str);</span>
<a href="#l13.19"></a><span id="l13.19">   }</span>
<a href="#l13.20"></a><span id="l13.20"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/extensions/smime/content/certFetchingStatus.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/certFetchingStatus.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -40,17 +40,17 @@ function onLoad()</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">   setTimeout(search, 1);</span>
<a href="#l14.6"></a><span id="l14.6"> }</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> function search()</span>
<a href="#l14.9"></a><span id="l14.9"> {</span>
<a href="#l14.10"></a><span id="l14.10">   // get the login to authenticate as, if there is one</span>
<a href="#l14.11"></a><span id="l14.11">   try {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    gLogin = Services.prefs.getStringPref(gDirectoryPref + &quot;.auth.dn&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+    gLogin = Services.prefs.getComplexValue(gDirectoryPref + &quot;.auth.dn&quot;, Components.interfaces.nsISupportsString).data;</span>
<a href="#l14.14"></a><span id="l14.14">   } catch (ex) {</span>
<a href="#l14.15"></a><span id="l14.15">     // if we don't have this pref, no big deal</span>
<a href="#l14.16"></a><span id="l14.16">   }</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18">   try {</span>
<a href="#l14.19"></a><span id="l14.19">     let url = Services.prefs.getCharPref(gDirectoryPref + &quot;.uri&quot;);</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">     gLdapServerURL = Services.io</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/browser/nsBrowserContentHandler.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/browser/nsBrowserContentHandler.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -81,17 +81,18 @@ function getHomePageGroup()</span>
<a href="#l15.4"></a><span id="l15.4">   var count = 0;</span>
<a href="#l15.5"></a><span id="l15.5">   try {</span>
<a href="#l15.6"></a><span id="l15.6">     count = Services.prefs.getIntPref(&quot;browser.startup.homepage.count&quot;);</span>
<a href="#l15.7"></a><span id="l15.7">   } catch (e) {</span>
<a href="#l15.8"></a><span id="l15.8">   }</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   for (var i = 1; i &lt; count; ++i) {</span>
<a href="#l15.11"></a><span id="l15.11">     try {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-      homePage += '\n' + Services.prefs.getStringPref(&quot;browser.startup.homepage.&quot; + i);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+      homePage += '\n' + Services.prefs.getComplexValue(&quot;browser.startup.homepage.&quot; + i,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+                                                        nsISupportsString).data;</span>
<a href="#l15.15"></a><span id="l15.15">     } catch (e) {</span>
<a href="#l15.16"></a><span id="l15.16">     }</span>
<a href="#l15.17"></a><span id="l15.17">   }</span>
<a href="#l15.18"></a><span id="l15.18">   return homePage;</span>
<a href="#l15.19"></a><span id="l15.19"> }</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> function needHomePageOverride()</span>
<a href="#l15.22"></a><span id="l15.22"> {</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineat">@@ -145,17 +146,18 @@ function getURLToLoad()</span>
<a href="#l15.24"></a><span id="l15.24">   }</span>
<a href="#l15.25"></a><span id="l15.25"> </span>
<a href="#l15.26"></a><span id="l15.26">   try {</span>
<a href="#l15.27"></a><span id="l15.27">     switch (Services.prefs.getIntPref(&quot;browser.startup.page&quot;)) {</span>
<a href="#l15.28"></a><span id="l15.28">     case 1:</span>
<a href="#l15.29"></a><span id="l15.29">       return getHomePageGroup();</span>
<a href="#l15.30"></a><span id="l15.30"> </span>
<a href="#l15.31"></a><span id="l15.31">     case 2:</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-      return Services.prefs.getStringPref(&quot;browser.history.last_page_visited&quot;);</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+      return Services.prefs.getComplexValue(&quot;browser.history.last_page_visited&quot;,</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+                                            nsISupportsString).data;</span>
<a href="#l15.35"></a><span id="l15.35">     }</span>
<a href="#l15.36"></a><span id="l15.36">   } catch (e) {</span>
<a href="#l15.37"></a><span id="l15.37">   }</span>
<a href="#l15.38"></a><span id="l15.38"> </span>
<a href="#l15.39"></a><span id="l15.39">   return &quot;about:blank&quot;;</span>
<a href="#l15.40"></a><span id="l15.40"> }</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42"> function openWindow(parent, url, features, arg)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/common/utilityOverlay.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/common/utilityOverlay.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -137,24 +137,28 @@ function setProxyTypeUI()</span>
<a href="#l16.4"></a><span id="l16.4">   var onlineTooltip = &quot;onlineTooltip&quot; + GetIntPref(&quot;network.proxy.type&quot;, 0);</span>
<a href="#l16.5"></a><span id="l16.5">   panel.setAttribute(&quot;tooltiptext&quot;, gUtilityBundle.getString(onlineTooltip));</span>
<a href="#l16.6"></a><span id="l16.6"> }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> function SetStringPref(aPref, aValue)</span>
<a href="#l16.9"></a><span id="l16.9"> {</span>
<a href="#l16.10"></a><span id="l16.10">   const nsISupportsString = Components.interfaces.nsISupportsString;</span>
<a href="#l16.11"></a><span id="l16.11">   try {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    Services.prefs.setStringPref(aPref, aValue);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    var str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+                        .createInstance(nsISupportsString);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+    str.data = aValue;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+    Services.prefs.setComplexValue(aPref, nsISupportsString, str);</span>
<a href="#l16.17"></a><span id="l16.17">   } catch (e) {}</span>
<a href="#l16.18"></a><span id="l16.18"> }</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> function GetStringPref(name)</span>
<a href="#l16.21"></a><span id="l16.21"> {</span>
<a href="#l16.22"></a><span id="l16.22">   try {</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-    return Services.prefs.getStringPref(name);</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+    return Services.prefs.getComplexValue(name,</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+               Components.interfaces.nsISupportsString).data;</span>
<a href="#l16.26"></a><span id="l16.26">   } catch (e) {}</span>
<a href="#l16.27"></a><span id="l16.27">   return &quot;&quot;;</span>
<a href="#l16.28"></a><span id="l16.28"> }</span>
<a href="#l16.29"></a><span id="l16.29"> </span>
<a href="#l16.30"></a><span id="l16.30"> function GetLocalizedStringPref(aPrefName, aDefaultValue)</span>
<a href="#l16.31"></a><span id="l16.31"> {</span>
<a href="#l16.32"></a><span id="l16.32">   try {</span>
<a href="#l16.33"></a><span id="l16.33">     return Services.prefs.getComplexValue(aPrefName,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/feeds/src/FeedWriter.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/feeds/src/FeedWriter.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -760,17 +760,18 @@ FeedWriter.prototype = {</span>
<a href="#l17.4"></a><span id="l17.4">   },</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6">   _setSelectedHandler: function setSelectedHandler(feedType) {</span>
<a href="#l17.7"></a><span id="l17.7">     var handler = safeGetCharPref(getPrefReaderForType(feedType), &quot;messenger&quot;);</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">     switch (handler) {</span>
<a href="#l17.10"></a><span id="l17.10">       case &quot;web&quot;:</span>
<a href="#l17.11"></a><span id="l17.11">         if (this._handlersMenuList) {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-          var url = Services.prefs.getStringPref(getPrefWebForType(feedType));</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+          var url = Services.prefs.getComplexValue(getPrefWebForType(feedType),</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+                                                   Components.interfaces.nsISupportsString).data;</span>
<a href="#l17.15"></a><span id="l17.15">           var handlers = this._handlersMenuList.getElementsByAttribute(&quot;webhandlerurl&quot;, url);</span>
<a href="#l17.16"></a><span id="l17.16">           if (handlers.length == 0) {</span>
<a href="#l17.17"></a><span id="l17.17">             LOG(&quot;FeedWriter._setSelectedHandler: selected web handler isn't in the menulist&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">             return;</span>
<a href="#l17.19"></a><span id="l17.19">           }</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21">           handlers[0].doCommand();</span>
<a href="#l17.22"></a><span id="l17.22">         }</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineat">@@ -1113,17 +1114,21 @@ FeedWriter.prototype = {</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25">       selectedItem = this._getSelectedItemFromMenulist(this._handlersMenuList);</span>
<a href="#l17.26"></a><span id="l17.26">     }</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28">     if (selectedItem.hasAttribute(&quot;webhandlerurl&quot;)) {</span>
<a href="#l17.29"></a><span id="l17.29">       var webURI = selectedItem.getAttribute(&quot;webhandlerurl&quot;);</span>
<a href="#l17.30"></a><span id="l17.30">       Services.prefs.setCharPref(getPrefReaderForType(feedType), &quot;web&quot;);</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-      Services.prefs.setStringPref(getPrefWebForType(feedType), webURI);</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+      var supportsString = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+                                     .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+      supportsString.data = webURI;</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+      Services.prefs.setComplexValue(getPrefWebForType(feedType), Components.interfaces.nsISupportsString,</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+                                     supportsString);</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39">       var wccr = Components.classes[&quot;@mozilla.org/embeddor.implemented/web-content-handler-registrar;1&quot;]</span>
<a href="#l17.40"></a><span id="l17.40">                            .getService(Components.interfaces.nsIWebContentConverterService);</span>
<a href="#l17.41"></a><span id="l17.41">       var handler = wccr.getWebContentHandlerByURI(this._getMimeTypeForFeedType(feedType), webURI);</span>
<a href="#l17.42"></a><span id="l17.42">       if (handler) {</span>
<a href="#l17.43"></a><span id="l17.43">         if (useAsDefault)</span>
<a href="#l17.44"></a><span id="l17.44">           wccr.setAutoHandler(this._getMimeTypeForFeedType(feedType), handler);</span>
<a href="#l17.45"></a><span id="l17.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/feeds/src/WebContentConverter.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/feeds/src/WebContentConverter.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -636,17 +636,21 @@ WebContentConverterRegistrar.prototype =</span>
<a href="#l18.4"></a><span id="l18.4">     this._updateContentTypeHandlerMap(contentType, uri, title);</span>
<a href="#l18.5"></a><span id="l18.5">     this._saveContentHandlerToPrefs(contentType, uri, title);</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">     if (contentType == TYPE_MAYBE_FEED) {</span>
<a href="#l18.8"></a><span id="l18.8">       // Make the new handler the last-selected reader in the preview page</span>
<a href="#l18.9"></a><span id="l18.9">       // and make sure the preview page is shown the next time a feed is visited</span>
<a href="#l18.10"></a><span id="l18.10">       Services.prefs.setCharPref(PREF_SELECTED_READER, &quot;web&quot;);</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      Services.prefs.setStringPref(PREF_SELECTED_WEB, uri);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+      var supportsString = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+                                     .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+      supportsString.data = uri;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+      Services.prefs.setComplexValue(PREF_SELECTED_WEB, Components.interfaces.nsISupportsString,</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+                                     supportsString);</span>
<a href="#l18.18"></a><span id="l18.18">       Services.prefs.setCharPref(PREF_SELECTED_ACTION, &quot;ask&quot;);</span>
<a href="#l18.19"></a><span id="l18.19">       this._setAutoHandler(TYPE_MAYBE_FEED, null);</span>
<a href="#l18.20"></a><span id="l18.20">     }</span>
<a href="#l18.21"></a><span id="l18.21">   },</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">   /**</span>
<a href="#l18.24"></a><span id="l18.24">    * Update the content type -&gt; handler map. This mapping is not persisted, use</span>
<a href="#l18.25"></a><span id="l18.25">    * registerContentHandler or _saveContentHandlerToPrefs for that purpose.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -119,23 +119,27 @@ var sanTests = {</span>
<a href="#l19.4"></a><span id="l19.4">                                    .openDatabase(file);</span>
<a href="#l19.5"></a><span id="l19.5">         connection.createTable(&quot;urlbarhistory&quot;, &quot;url TEXT&quot;);</span>
<a href="#l19.6"></a><span id="l19.6">         connection.executeSimpleSQL(</span>
<a href="#l19.7"></a><span id="l19.7">           &quot;INSERT INTO urlbarhistory (url) VALUES ('Sanitizer')&quot;);</span>
<a href="#l19.8"></a><span id="l19.8">         connection.close();</span>
<a href="#l19.9"></a><span id="l19.9">       }</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11">       // Open location dialog.</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      Services.prefs.setStringPref(&quot;general.open_location.last_url&quot;, &quot;Sanitizer!&quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+      var supStr = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+                             .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+      supStr.data = &quot;Sanitizer!&quot;;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+      Services.prefs.setComplexValue(&quot;general.open_location.last_url&quot;,</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+                                      Components.interfaces.nsISupportsString, supStr);</span>
<a href="#l19.18"></a><span id="l19.18">     },</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">     check: function(aShouldBeCleared) {</span>
<a href="#l19.21"></a><span id="l19.21">       let locData;</span>
<a href="#l19.22"></a><span id="l19.22">       try {</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-        locData = Services.prefs.getStringPref(&quot;general.open_location.last_url&quot;);</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+        locData = Services.prefs.getComplexValue(&quot;general.open_location.last_url&quot;, Components.interfaces.nsISupportsString).data;</span>
<a href="#l19.25"></a><span id="l19.25">       } catch(ex) {}</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27">       do_check_eq(locData == &quot;Sanitizer!&quot;, !aShouldBeCleared);</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29">       var file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l19.30"></a><span id="l19.30">                            .getService(Components.interfaces.nsIProperties)</span>
<a href="#l19.31"></a><span id="l19.31">                            .get(&quot;ProfD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l19.32"></a><span id="l19.32">       file.append(&quot;urlbarhistory.sqlite&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

