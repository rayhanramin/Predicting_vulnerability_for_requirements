<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28504:74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c" />
<meta property="og:url" content="/comm-central/rev/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c" />
<meta property="og:description" content="Bug 1594000 - Convert remaining nsISimpleEnumerator users to use JS iteration in /calendar. r=pmorris" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">shortlog</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">files</a> |
changeset |
<a href="/comm-central/raw-rev/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">raw</a>  | <a href="/comm-central/archive/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">Bug 1594000</a> - Convert remaining nsISimpleEnumerator users to use JS iteration in /calendar. r=pmorris
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#104;&#117;&#115;&#104;&#105;&#108;&#32;&#77;&#105;&#115;&#116;&#114;&#121;&#32;&#60;&#107;&#104;&#117;&#115;&#104;&#105;&#108;&#51;&#50;&#52;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 10 Jan 2020 12:51:01 +0200</td></tr>

<tr>
 <td>changeset 28504</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c</a></td>
</tr>



<tr>
<td>parent 28503</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/be621c5c7cd39d8110eb6eb4d4ee6ee0552ffb99">be621c5c7cd39d8110eb6eb4d4ee6ee0552ffb99</a>
</td>
</tr>

<tr>
<td>child 28505</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/807fb40cb098724ffe7f938946646c2a01f8c74a">807fb40cb098724ffe7f938946646c2a01f8c74a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">16886</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Fri, 10 Jan 2020 10:53:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@74fb2e349d4e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c&newProject=comm-central&newRevision=be621c5c7cd39d8110eb6eb4d4ee6ee0552ffb99&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c&newProject=comm-central&newRevision=be621c5c7cd39d8110eb6eb4d4ee6ee0552ffb99&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c&newProject=comm-central&newRevision=be621c5c7cd39d8110eb6eb4d4ee6ee0552ffb99&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmorris%29&revcount=50">pmorris</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">1594000</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">Bug 1594000</a> - Convert remaining nsISimpleEnumerator users to use JS iteration in /calendar. r=pmorris</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-chrome-startup.js">calendar/base/content/calendar-chrome-startup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-chrome-startup.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-chrome-startup.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-chrome-startup.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-chrome-startup.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-chrome-startup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">calendar/base/content/dialogs/calendar-event-dialog-timezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/preferences/general.js">calendar/base/content/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/preferences/general.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/preferences/general.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/content/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calDateTimeUtils.jsm">calendar/base/modules/utils/calDateTimeUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calDateTimeUtils.jsm">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calDateTimeUtils.jsm">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calDateTimeUtils.jsm">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calDateTimeUtils.jsm">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calDateTimeUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calItemUtils.jsm">calendar/base/modules/utils/calItemUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calItemUtils.jsm">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calItemUtils.jsm">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calItemUtils.jsm">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calItemUtils.jsm">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/modules/utils/calItemUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/test/unit/test_timezone_definition.js">calendar/test/unit/test_timezone_definition.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/test/unit/test_timezone_definition.js">file</a> |
<a href="/comm-central/annotate/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/test/unit/test_timezone_definition.js">annotate</a> |
<a href="/comm-central/diff/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/test/unit/test_timezone_definition.js">diff</a> |
<a href="/comm-central/comparison/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/test/unit/test_timezone_definition.js">comparison</a> |
<a href="/comm-central/log/74fb2e349d4e09a6b5c956e4a5c83476ea23cc2c/calendar/test/unit/test_timezone_definition.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -4,17 +4,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> /* import-globals-from ../../lightning/content/messenger-overlay-sidebar.js */</span>
<a href="#l1.6"></a><span id="l1.6"> /* import-globals-from calendar-command-controller.js */</span>
<a href="#l1.7"></a><span id="l1.7"> /* import-globals-from calendar-management.js */</span>
<a href="#l1.8"></a><span id="l1.8"> /* import-globals-from calendar-ui-utils.js */</span>
<a href="#l1.9"></a><span id="l1.9"> /* import-globals-from calendar-views-utils.js */</span>
<a href="#l1.10"></a><span id="l1.10"> /* globals PanelUI */</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l1.13"></a><span id="l1.13"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.14"></a><span id="l1.14"> var { AppConstants } = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> /* exported commonInitCalendar, commonFinishCalendar */</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> /**</span>
<a href="#l1.19"></a><span id="l1.19">  * Common initialization steps for calendar chrome windows.</span>
<a href="#l1.20"></a><span id="l1.20">  */</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -127,17 +126,17 @@ var calendarWindowPrefs = {</span>
<a href="#l1.22"></a><span id="l1.22">    * @see nsIObserver</span>
<a href="#l1.23"></a><span id="l1.23">    */</span>
<a href="#l1.24"></a><span id="l1.24">   observe: function(aSubject, aTopic, aData) {</span>
<a href="#l1.25"></a><span id="l1.25">     if (aTopic == &quot;nsPref:changed&quot;) {</span>
<a href="#l1.26"></a><span id="l1.26">       switch (aData) {</span>
<a href="#l1.27"></a><span id="l1.27">         case &quot;calendar.view.useSystemColors&quot;: {</span>
<a href="#l1.28"></a><span id="l1.28">           let attributeValue =</span>
<a href="#l1.29"></a><span id="l1.29">             Services.prefs.getBoolPref(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-          for (let win of fixIterator(Services.ww.getWindowEnumerator())) {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+          for (let win of Services.ww.getWindowEnumerator()) {</span>
<a href="#l1.32"></a><span id="l1.32">             setElementValue(win.document.documentElement, attributeValue, &quot;systemcolors&quot;);</span>
<a href="#l1.33"></a><span id="l1.33">           }</span>
<a href="#l1.34"></a><span id="l1.34">           break;</span>
<a href="#l1.35"></a><span id="l1.35">         }</span>
<a href="#l1.36"></a><span id="l1.36">       }</span>
<a href="#l1.37"></a><span id="l1.37">     } else if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l1.38"></a><span id="l1.38">       let win = aSubject;</span>
<a href="#l1.39"></a><span id="l1.39">       win.addEventListener(&quot;load&quot;, () =&gt; {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -11,21 +11,20 @@ var { Services } = ChromeUtils.import(&quot;r</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> var calendarExtract = {</span>
<a href="#l2.6"></a><span id="l2.6">   onShowLocaleMenu: function(target) {</span>
<a href="#l2.7"></a><span id="l2.7">     let localeList = document.getElementById(target.id);</span>
<a href="#l2.8"></a><span id="l2.8">     let langs = [];</span>
<a href="#l2.9"></a><span id="l2.9">     let chrome = Cc[&quot;@mozilla.org/chrome/chrome-registry;1&quot;]</span>
<a href="#l2.10"></a><span id="l2.10">       .getService(Ci.nsIXULChromeRegistry)</span>
<a href="#l2.11"></a><span id="l2.11">       .QueryInterface(Ci.nsIToolkitChromeRegistry);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    let locales = chrome.getLocalesForPackage(&quot;calendar&quot;);</span>
<a href="#l2.13"></a><span id="l2.13">     let langRegex = /^(([^-]+)-*(.*))$/;</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-    while (locales.hasMore()) {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-      let localeParts = langRegex.exec(locales.getNext());</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    for (let locale of chrome.getLocalesForPackage(&quot;calendar&quot;)) {</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+      let localeParts = langRegex.exec(locale);</span>
<a href="#l2.19"></a><span id="l2.19">       let langName = localeParts[2];</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">       try {</span>
<a href="#l2.22"></a><span id="l2.22">         langName = cal.l10n.getAnyString(&quot;global&quot;, &quot;languageNames&quot;, langName);</span>
<a href="#l2.23"></a><span id="l2.23">       } catch (ex) {</span>
<a href="#l2.24"></a><span id="l2.24">         // If no language name is found that is ok, keep the technical term</span>
<a href="#l2.25"></a><span id="l2.25">       }</span>
<a href="#l2.26"></a><span id="l2.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -26,21 +26,20 @@ function onLoad() {</span>
<a href="#l3.4"></a><span id="l3.4">   // floating and UTC (if supported) at the top:</span>
<a href="#l3.5"></a><span id="l3.5">   if (args.calendar.getProperty(&quot;capabilities.timezones.floating.supported&quot;) !== false) {</span>
<a href="#l3.6"></a><span id="l3.6">     addMenuItem(tzMenuPopup, cal.dtz.floating.displayName, cal.dtz.floating.tzid);</span>
<a href="#l3.7"></a><span id="l3.7">   }</span>
<a href="#l3.8"></a><span id="l3.8">   if (args.calendar.getProperty(&quot;capabilities.timezones.UTC.supported&quot;) !== false) {</span>
<a href="#l3.9"></a><span id="l3.9">     addMenuItem(tzMenuPopup, cal.dtz.UTC.displayName, cal.dtz.UTC.tzid);</span>
<a href="#l3.10"></a><span id="l3.10">   }</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  let enumerator = tzProvider.timezoneIds;</span>
<a href="#l3.13"></a><span id="l3.13">   let tzids = {};</span>
<a href="#l3.14"></a><span id="l3.14">   let displayNames = [];</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  while (enumerator.hasMore()) {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-    let timezone = tzProvider.getTimezone(enumerator.getNext());</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  for (let timezoneId of tzProvider.timezoneIds) {</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+    let timezone = tzProvider.getTimezone(timezoneId);</span>
<a href="#l3.19"></a><span id="l3.19">     if (timezone &amp;&amp; !timezone.isFloating &amp;&amp; !timezone.isUTC) {</span>
<a href="#l3.20"></a><span id="l3.20">       let displayName = timezone.displayName;</span>
<a href="#l3.21"></a><span id="l3.21">       displayNames.push(displayName);</span>
<a href="#l3.22"></a><span id="l3.22">       tzids[displayName] = timezone.tzid;</span>
<a href="#l3.23"></a><span id="l3.23">     }</span>
<a href="#l3.24"></a><span id="l3.24">   }</span>
<a href="#l3.25"></a><span id="l3.25">   // the display names need to be sorted</span>
<a href="#l3.26"></a><span id="l3.26">   displayNames.sort((a, b) =&gt; a.localeCompare(b));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -302,19 +302,17 @@ var gDataMigrator = {</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     // We're lightning, check Sunbird</span>
<a href="#l4.6"></a><span id="l4.6">     if ((sbProf = this.getSunbirdProfile())) {</span>
<a href="#l4.7"></a><span id="l4.7">       profiles.push(sbProf);</span>
<a href="#l4.8"></a><span id="l4.8">     }</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">     // Now check all of the profiles in each of these folders for data</span>
<a href="#l4.11"></a><span id="l4.11">     for (let prof of profiles) {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      let dirEnum = prof.directoryEntries;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-      while (dirEnum.hasMoreElements()) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-        let profile = dirEnum.nextFile;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      for (let profile of prof.directoryEntries) {</span>
<a href="#l4.16"></a><span id="l4.16">         if (profile.isFile()) {</span>
<a href="#l4.17"></a><span id="l4.17">           continue;</span>
<a href="#l4.18"></a><span id="l4.18">         } else {</span>
<a href="#l4.19"></a><span id="l4.19">           profile.append(&quot;Calendar&quot;);</span>
<a href="#l4.20"></a><span id="l4.20">           if (profile.exists()) {</span>
<a href="#l4.21"></a><span id="l4.21">             migLOG(&quot;Found old extension directory at&quot; + profile.path);</span>
<a href="#l4.22"></a><span id="l4.22">             let title = &quot;Mozilla Calendar&quot;;</span>
<a href="#l4.23"></a><span id="l4.23">             migrators.push(new dataMigrator(title, extMigrator, [profile]));</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -328,22 +326,20 @@ var gDataMigrator = {</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">   /**</span>
<a href="#l4.27"></a><span id="l4.27">    * Checks to see if Apple's iCal is installed and offers to migrate any data</span>
<a href="#l4.28"></a><span id="l4.28">    * the user has created in it.</span>
<a href="#l4.29"></a><span id="l4.29">    */</span>
<a href="#l4.30"></a><span id="l4.30">   checkIcal: function() {</span>
<a href="#l4.31"></a><span id="l4.31">     function icalMigrate(aDataDir, aCallback) {</span>
<a href="#l4.32"></a><span id="l4.32">       aDataDir.append(&quot;Sources&quot;);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-      let dirs = aDataDir.directoryEntries;</span>
<a href="#l4.34"></a><span id="l4.34">       let calManager = cal.getCalendarManager();</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">       let i = 1;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-      while (dirs.hasMoreElements()) {</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-        let dataDir = dirs.nextFile;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+      for (let dataDir of aDataDir.directoryEntries) {</span>
<a href="#l4.40"></a><span id="l4.40">         let dataStore = dataDir.clone();</span>
<a href="#l4.41"></a><span id="l4.41">         dataStore.append(&quot;corestorage.ics&quot;);</span>
<a href="#l4.42"></a><span id="l4.42">         if (!dataStore.exists()) {</span>
<a href="#l4.43"></a><span id="l4.43">           continue;</span>
<a href="#l4.44"></a><span id="l4.44">         }</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">         let fileStream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;].createInstance(</span>
<a href="#l4.47"></a><span id="l4.47">           Ci.nsIFileInputStream</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineat">@@ -431,19 +427,17 @@ var gDataMigrator = {</span>
<a href="#l4.49"></a><span id="l4.49">           calendar.name = &quot;Evolution &quot; + i++;</span>
<a href="#l4.50"></a><span id="l4.50">           calManager.registerCalendar(calendar);</span>
<a href="#l4.51"></a><span id="l4.51">           cal.view.getCompositeCalendar(window).addCalendar(calendar);</span>
<a href="#l4.52"></a><span id="l4.52">         }</span>
<a href="#l4.53"></a><span id="l4.53">         return dataStore.exists();</span>
<a href="#l4.54"></a><span id="l4.54">       };</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56">       let calManager = cal.getCalendarManager();</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-      let dirs = aDataDir.directoryEntries;</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-      while (dirs.hasMoreElements()) {</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-        let dataDir = dirs.nextFile;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+      for (let dataDir of aDataDir.directoryEntries) {</span>
<a href="#l4.61"></a><span id="l4.61">         let dataStore = dataDir.clone();</span>
<a href="#l4.62"></a><span id="l4.62">         dataStore.append(&quot;calendar.ics&quot;);</span>
<a href="#l4.63"></a><span id="l4.63">         evoDataMigrate(dataStore);</span>
<a href="#l4.64"></a><span id="l4.64">       }</span>
<a href="#l4.65"></a><span id="l4.65"> </span>
<a href="#l4.66"></a><span id="l4.66">       aCallback();</span>
<a href="#l4.67"></a><span id="l4.67">     }</span>
<a href="#l4.68"></a><span id="l4.68"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/preferences/general.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/preferences/general.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -51,22 +51,21 @@ var gCalendarGeneralPane = {</span>
<a href="#l5.4"></a><span id="l5.4">     // deselect and reselect to update visible item title</span>
<a href="#l5.5"></a><span id="l5.5">     updateUnitLabelPlural(&quot;defaultlength&quot;, &quot;defaultlengthunit&quot;, &quot;minutes&quot;);</span>
<a href="#l5.6"></a><span id="l5.6">     this.updateDefaultTodoDates();</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">     let tzMenuList = document.getElementById(&quot;calendar-timezone-menulist&quot;);</span>
<a href="#l5.9"></a><span id="l5.9">     let tzMenuPopup = document.getElementById(&quot;calendar-timezone-menupopup&quot;);</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">     let tzService = cal.getTimezoneService();</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    let enumerator = tzService.timezoneIds;</span>
<a href="#l5.13"></a><span id="l5.13">     let tzids = {};</span>
<a href="#l5.14"></a><span id="l5.14">     let displayNames = [];</span>
<a href="#l5.15"></a><span id="l5.15">     // don't rely on what order the timezone-service gives you</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-    while (enumerator.hasMore()) {</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-      let timezone = tzService.getTimezone(enumerator.getNext());</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    for (let timezoneId of tzService.timezoneIds) {</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+      let timezone = tzService.getTimezone(timezoneId);</span>
<a href="#l5.20"></a><span id="l5.20">       if (timezone &amp;&amp; !timezone.isFloating &amp;&amp; !timezone.isUTC) {</span>
<a href="#l5.21"></a><span id="l5.21">         let displayName = timezone.displayName;</span>
<a href="#l5.22"></a><span id="l5.22">         displayNames.push(displayName);</span>
<a href="#l5.23"></a><span id="l5.23">         tzids[displayName] = timezone.tzid;</span>
<a href="#l5.24"></a><span id="l5.24">       }</span>
<a href="#l5.25"></a><span id="l5.25">     }</span>
<a href="#l5.26"></a><span id="l5.26">     // the display names need to be sorted</span>
<a href="#l5.27"></a><span id="l5.27">     displayNames.sort((a, b) =&gt; a.localeCompare(b));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/modules/utils/calDateTimeUtils.jsm</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/modules/utils/calDateTimeUtils.jsm</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -270,19 +270,17 @@ var caldtz = {</span>
<a href="#l6.4"></a><span id="l6.4">       // If offset does not match, go through timezones. This will</span>
<a href="#l6.5"></a><span id="l6.5">       // give you the first tz in the alphabet and kill daylight</span>
<a href="#l6.6"></a><span id="l6.6">       // savings time, but we have no other choice</span>
<a href="#l6.7"></a><span id="l6.7">       if (dateTime.timezoneOffset != offset_in_s) {</span>
<a href="#l6.8"></a><span id="l6.8">         // TODO A patch to Bug 363191 should make this more efficient.</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">         let tzService = cal.getTimezoneService();</span>
<a href="#l6.11"></a><span id="l6.11">         // Enumerate timezones, set them, check their offset</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        let enumerator = tzService.timezoneIds;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-        while (enumerator.hasMore()) {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-          let id = enumerator.getNext();</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+        for (let id of tzService.timezoneIds) {</span>
<a href="#l6.16"></a><span id="l6.16">           dateTime.timezone = tzService.getTimezone(id);</span>
<a href="#l6.17"></a><span id="l6.17">           if (dateTime.timezoneOffset == offset_in_s) {</span>
<a href="#l6.18"></a><span id="l6.18">             // This is our last step, so go ahead and return</span>
<a href="#l6.19"></a><span id="l6.19">             return dateTime;</span>
<a href="#l6.20"></a><span id="l6.20">           }</span>
<a href="#l6.21"></a><span id="l6.21">         }</span>
<a href="#l6.22"></a><span id="l6.22">         // We are still here: no timezone was found</span>
<a href="#l6.23"></a><span id="l6.23">         dateTime.timezone = cal.dtz.UTC;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/modules/utils/calItemUtils.jsm</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/modules/utils/calItemUtils.jsm</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -622,32 +622,28 @@ var calitem = {</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">   /**</span>
<a href="#l7.6"></a><span id="l7.6">    * Search for already open item dialog.</span>
<a href="#l7.7"></a><span id="l7.7">    *</span>
<a href="#l7.8"></a><span id="l7.8">    * @param aItem     The item of the dialog to search for.</span>
<a href="#l7.9"></a><span id="l7.9">    */</span>
<a href="#l7.10"></a><span id="l7.10">   findWindow: function(aItem) {</span>
<a href="#l7.11"></a><span id="l7.11">     // check for existing dialog windows</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    let list = Services.wm.getEnumerator(&quot;Calendar:EventDialog&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    while (list.hasMoreElements()) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-      let dlg = list.getNext();</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    for (let dlg of Services.wm.getEnumerator(&quot;Calendar:EventDialog&quot;)) {</span>
<a href="#l7.16"></a><span id="l7.16">       if (</span>
<a href="#l7.17"></a><span id="l7.17">         dlg.arguments[0] &amp;&amp;</span>
<a href="#l7.18"></a><span id="l7.18">         dlg.arguments[0].mode == &quot;modify&quot; &amp;&amp;</span>
<a href="#l7.19"></a><span id="l7.19">         dlg.arguments[0].calendarEvent &amp;&amp;</span>
<a href="#l7.20"></a><span id="l7.20">         dlg.arguments[0].calendarEvent.hashId == aItem.hashId</span>
<a href="#l7.21"></a><span id="l7.21">       ) {</span>
<a href="#l7.22"></a><span id="l7.22">         return dlg;</span>
<a href="#l7.23"></a><span id="l7.23">       }</span>
<a href="#l7.24"></a><span id="l7.24">     }</span>
<a href="#l7.25"></a><span id="l7.25">     // check for existing summary windows</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-    list = Services.wm.getEnumerator(&quot;Calendar:EventSummaryDialog&quot;);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-    while (list.hasMoreElements()) {</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-      let dlg = list.getNext();</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+    for (let dlg of Services.wm.getEnumerator(&quot;Calendar:EventSummaryDialog&quot;)) {</span>
<a href="#l7.30"></a><span id="l7.30">       if (dlg.calendarItem &amp;&amp; dlg.calendarItem.hashId == aItem.hashId) {</span>
<a href="#l7.31"></a><span id="l7.31">         return dlg;</span>
<a href="#l7.32"></a><span id="l7.32">       }</span>
<a href="#l7.33"></a><span id="l7.33">     }</span>
<a href="#l7.34"></a><span id="l7.34">     return null;</span>
<a href="#l7.35"></a><span id="l7.35">   },</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -766,18 +766,17 @@ function guessSystemTimezone() {</span>
<a href="#l8.4"></a><span id="l8.4">     }</span>
<a href="#l8.5"></a><span id="l8.5">   } catch (ex) {</span>
<a href="#l8.6"></a><span id="l8.6">     // Oh well, this didn't work, next option...</span>
<a href="#l8.7"></a><span id="l8.7">     Cu.reportError(ex);</span>
<a href="#l8.8"></a><span id="l8.8">   }</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">   // Third, try all known timezones.</span>
<a href="#l8.11"></a><span id="l8.11">   const tzIDs = tzSvc.timezoneIds;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  while (tzIDs.hasMore()) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    let tzId = tzIDs.getNext();</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  for (let tzId of tzIDs) {</span>
<a href="#l8.15"></a><span id="l8.15">     try {</span>
<a href="#l8.16"></a><span id="l8.16">       let score = checkTZ(tzId);</span>
<a href="#l8.17"></a><span id="l8.17">       switch (score) {</span>
<a href="#l8.18"></a><span id="l8.18">         case 0:</span>
<a href="#l8.19"></a><span id="l8.19">           break;</span>
<a href="#l8.20"></a><span id="l8.20">         case 1:</span>
<a href="#l8.21"></a><span id="l8.21">         case 2:</span>
<a href="#l8.22"></a><span id="l8.22">           if (score &gt; probableTZScore) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -2230,22 +2230,19 @@ function attachFile(cloudProvider) {</span>
<a href="#l9.4"></a><span id="l9.4">   if (lastDir) {</span>
<a href="#l9.5"></a><span id="l9.5">     filePicker.displayDirectory = lastDir;</span>
<a href="#l9.6"></a><span id="l9.6">   }</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">   filePicker.open(rv =&gt; {</span>
<a href="#l9.9"></a><span id="l9.9">     if (rv != Ci.nsIFilePicker.returnOK || !filePicker.files) {</span>
<a href="#l9.10"></a><span id="l9.10">       return;</span>
<a href="#l9.11"></a><span id="l9.11">     }</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    let files = filePicker.files;</span>
<a href="#l9.13"></a><span id="l9.13"> </span>
<a href="#l9.14"></a><span id="l9.14">     // Create the attachment</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-    while (files.hasMoreElements()) {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-      let file = files.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+    for (let file of filePicker.files) {</span>
<a href="#l9.19"></a><span id="l9.19">       let fileHandler = Services.io</span>
<a href="#l9.20"></a><span id="l9.20">         .getProtocolHandler(&quot;file&quot;)</span>
<a href="#l9.21"></a><span id="l9.21">         .QueryInterface(Ci.nsIFileProtocolHandler);</span>
<a href="#l9.22"></a><span id="l9.22">       let uriSpec = fileHandler.getURLSpecFromFile(file);</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">       if (!(uriSpec in gAttachMap)) {</span>
<a href="#l9.25"></a><span id="l9.25">         // If the attachment hasn't been added, then set the last display</span>
<a href="#l9.26"></a><span id="l9.26">         // directory.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -699,20 +699,18 @@ calICSCalendar.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">           // nsIFile.  That's not the end of the world.  We can</span>
<a href="#l10.5"></a><span id="l10.5">           // try to remove the file the next time around.</span>
<a href="#l10.6"></a><span id="l10.6">         }</span>
<a href="#l10.7"></a><span id="l10.7">       }</span>
<a href="#l10.8"></a><span id="l10.8">     }</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">     function purgeOldBackups() {</span>
<a href="#l10.11"></a><span id="l10.11">       // Enumerate files in the backupdir for expiry of old backups</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-      let dirEnum = backupDir.directoryEntries;</span>
<a href="#l10.13"></a><span id="l10.13">       let files = [];</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-      while (dirEnum.hasMoreElements()) {</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-        let file = dirEnum.nextFile;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+      for (let file of backupDir.directoryEntries) {</span>
<a href="#l10.17"></a><span id="l10.17">         if (file.isFile()) {</span>
<a href="#l10.18"></a><span id="l10.18">           files.push({ name: file.leafName, lastmodified: file.lastModifiedTime });</span>
<a href="#l10.19"></a><span id="l10.19">         }</span>
<a href="#l10.20"></a><span id="l10.20">       }</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">       if (doDailyBackup) {</span>
<a href="#l10.23"></a><span id="l10.23">         purgeBackupsByType(files, &quot;day&quot;);</span>
<a href="#l10.24"></a><span id="l10.24">       } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/unit/test_timezone_definition.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/unit/test_timezone_definition.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -33,40 +33,38 @@ add_task(async function zone_test() {</span>
<a href="#l11.4"></a><span id="l11.4">     ok(timezone.latitude &amp;&amp; !!timezone.latitude.match(/^[+-]\d{7}$/), &quot;Latitude test &quot; + aZoneId);</span>
<a href="#l11.5"></a><span id="l11.5">     ok(</span>
<a href="#l11.6"></a><span id="l11.6">       timezone.longitude &amp;&amp; !!timezone.longitude.match(/^[+-]\d{7}$/),</span>
<a href="#l11.7"></a><span id="l11.7">       &quot;Longitude test &quot; + aZoneId</span>
<a href="#l11.8"></a><span id="l11.8">     );</span>
<a href="#l11.9"></a><span id="l11.9">   }</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">   let tzs = cal.getTimezoneService();</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  let zones = tzs.timezoneIds;</span>
<a href="#l11.13"></a><span id="l11.13">   let foundZone = false;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-  while (zones.hasMore()) {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+  for (let zone of tzs.timezoneIds) {</span>
<a href="#l11.16"></a><span id="l11.16">     foundZone = true;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-    resolveZone(zones.getNext());</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+    resolveZone(zone);</span>
<a href="#l11.19"></a><span id="l11.19">   }</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">   ok(foundZone, &quot;There is at least one timezone&quot;);</span>
<a href="#l11.22"></a><span id="l11.22"> });</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24"> // check whether all tz aliases resolve to a tz definition</span>
<a href="#l11.25"></a><span id="l11.25"> add_task(async function alias_test() {</span>
<a href="#l11.26"></a><span id="l11.26">   function resolveAlias(aAliasId) {</span>
<a href="#l11.27"></a><span id="l11.27">     let timezone = tzs.getTimezone(aAliasId);</span>
<a href="#l11.28"></a><span id="l11.28">     let tzid = timezone &amp;&amp; timezone.tzid ? timezone.tzid : &quot;&quot;;</span>
<a href="#l11.29"></a><span id="l11.29">     notEqual(tzid, &quot;&quot;, &quot;Alias resolution &quot; + aAliasId + &quot; -&gt; &quot; + tzid);</span>
<a href="#l11.30"></a><span id="l11.30">   }</span>
<a href="#l11.31"></a><span id="l11.31"> </span>
<a href="#l11.32"></a><span id="l11.32">   let tzs = cal.getTimezoneService();</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-  let aliases = tzs.aliasIds;</span>
<a href="#l11.34"></a><span id="l11.34">   let foundAlias = false;</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-  while (aliases.hasMore()) {</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+  for (let aliasId of tzs.aliasIds) {</span>
<a href="#l11.37"></a><span id="l11.37">     foundAlias = true;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-    resolveAlias(aliases.getNext());</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+    resolveAlias(aliasId);</span>
<a href="#l11.40"></a><span id="l11.40">   }</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42">   ok(foundAlias, &quot;There is at least one alias&quot;);</span>
<a href="#l11.43"></a><span id="l11.43"> });</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45"> // Check completeness to avoid unintended removing of zones/aliases when updating zones.json</span>
<a href="#l11.46"></a><span id="l11.46"> // removed zones should at least remain as alias to not break UI like in bug 1210723.</span>
<a href="#l11.47"></a><span id="l11.47"> // previous.json is generated automatically by executing update-zones.py script</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

