<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28166:bb95517489e3a6e093a7210c83d9c99e0a812c9b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ bb95517489e3a6e093a7210c83d9c99e0a812c9b" />
<meta property="og:url" content="/comm-central/rev/bb95517489e3a6e093a7210c83d9c99e0a812c9b" />
<meta property="og:description" content="Bug 1590682 - Convert troublesome parts of calendar tests to real mochitest code; r=pmorris" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / bb95517489e3a6e093a7210c83d9c99e0a812c9b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/bb95517489e3a6e093a7210c83d9c99e0a812c9b">shortlog</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/bb95517489e3a6e093a7210c83d9c99e0a812c9b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b">files</a> |
changeset |
<a href="/comm-central/raw-rev/bb95517489e3a6e093a7210c83d9c99e0a812c9b">raw</a>  | <a href="/comm-central/archive/bb95517489e3a6e093a7210c83d9c99e0a812c9b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1590682">Bug 1590682</a> - Convert troublesome parts of calendar tests to real mochitest code; r=pmorris
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 07 Nov 2019 15:45:08 +1300</td></tr>

<tr>
 <td>changeset 28166</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/bb95517489e3a6e093a7210c83d9c99e0a812c9b">bb95517489e3a6e093a7210c83d9c99e0a812c9b</a></td>
</tr>



<tr>
<td>parent 28165</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0402e4370a3cb4093a253970c3b396b43791e783">0402e4370a3cb4093a253970c3b396b43791e783</a>
</td>
</tr>

<tr>
<td>child 28167</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4f748b7dc20dfb713f118f680cec8c2c8443862f">4f748b7dc20dfb713f118f680cec8c2c8443862f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=bb95517489e3a6e093a7210c83d9c99e0a812c9b">16685</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 14 Nov 2019 06:10:23 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@bb95517489e3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bb95517489e3a6e093a7210c83d9c99e0a812c9b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&newProject=comm-central&newRevision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&newProject=comm-central&newRevision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&newProject=comm-central&newRevision=bb95517489e3a6e093a7210c83d9c99e0a812c9b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmorris%29&revcount=50">pmorris</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1590682">1590682</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1590682">Bug 1590682</a> - Convert troublesome parts of calendar tests to real mochitest code; r=pmorris</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_localICS.js">calendar/test/browser/browser_localICS.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_localICS.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_localICS.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_localICS.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_localICS.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_localICS.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_timezones.js">calendar/test/browser/browser_timezones.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_timezones.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_timezones.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_timezones.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_timezones.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_timezones.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_todayPane.js">calendar/test/browser/browser_todayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_todayPane.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_todayPane.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_todayPane.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_todayPane.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/browser_todayPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_alarmDialog.js">calendar/test/browser/eventDialog/browser_alarmDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_alarmDialog.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_alarmDialog.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_alarmDialog.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_alarmDialog.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_alarmDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialog.js">calendar/test/browser/eventDialog/browser_eventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialog.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialog.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialog.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialog.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js">calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogSize.js">calendar/test/browser/eventDialog/browser_eventDialogSize.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogSize.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogSize.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogSize.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogSize.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_eventDialogSize.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_utf8.js">calendar/test/browser/eventDialog/browser_utf8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_utf8.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_utf8.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_utf8.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_utf8.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/eventDialog/browser_utf8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/preferences/browser_alarmDefaultValue.js">calendar/test/browser/preferences/browser_alarmDefaultValue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/preferences/browser_alarmDefaultValue.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/preferences/browser_alarmDefaultValue.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/preferences/browser_alarmDefaultValue.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/preferences/browser_alarmDefaultValue.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/preferences/browser_alarmDefaultValue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_annual.js">calendar/test/browser/recurrence/browser_annual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_annual.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_annual.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_annual.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_annual.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_annual.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_biweekly.js">calendar/test/browser/recurrence/browser_biweekly.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_biweekly.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_biweekly.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_biweekly.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_biweekly.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_biweekly.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_daily.js">calendar/test/browser/recurrence/browser_daily.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_daily.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_daily.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_daily.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_daily.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_daily.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">calendar/test/browser/recurrence/browser_lastDayOfMonth.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyN.js">calendar/test/browser/recurrence/browser_weeklyN.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyN.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyN.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyN.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyN.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyN.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyUntil.js">calendar/test/browser/recurrence/browser_weeklyUntil.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyUntil.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyUntil.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyUntil.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyUntil.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyUntil.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyWithException.js">calendar/test/browser/recurrence/browser_weeklyWithException.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyWithException.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyWithException.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyWithException.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyWithException.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrence/browser_weeklyWithException.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_annual.js">calendar/test/browser/recurrenceRotated/browser_annual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_annual.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_annual.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_annual.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_annual.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_annual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_biweekly.js">calendar/test/browser/recurrenceRotated/browser_biweekly.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_biweekly.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_biweekly.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_biweekly.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_biweekly.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_biweekly.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_daily.js">calendar/test/browser/recurrenceRotated/browser_daily.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_daily.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_daily.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_daily.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_daily.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_daily.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">calendar/test/browser/recurrenceRotated/browser_weeklyN.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_dayView.js">calendar/test/browser/views/browser_dayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_dayView.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_dayView.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_dayView.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_dayView.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_dayView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_monthView.js">calendar/test/browser/views/browser_monthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_monthView.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_monthView.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_monthView.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_monthView.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_monthView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_multiweekView.js">calendar/test/browser/views/browser_multiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_multiweekView.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_multiweekView.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_multiweekView.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_multiweekView.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_multiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_taskView.js">calendar/test/browser/views/browser_taskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_taskView.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_taskView.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_taskView.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_taskView.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_taskView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_weekView.js">calendar/test/browser/views/browser_weekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_weekView.js">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_weekView.js">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_weekView.js">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_weekView.js">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/browser/views/browser_weekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/CalendarUtils.jsm">calendar/test/modules/CalendarUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/CalendarUtils.jsm">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/CalendarUtils.jsm">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/CalendarUtils.jsm">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/CalendarUtils.jsm">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/CalendarUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/ItemEditingHelpers.jsm">calendar/test/modules/ItemEditingHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/ItemEditingHelpers.jsm">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/ItemEditingHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/ItemEditingHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/ItemEditingHelpers.jsm">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/calendar/test/modules/ItemEditingHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm">mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bb95517489e3a6e093a7210c83d9c99e0a812c9b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm">file</a> |
<a href="/comm-central/annotate/bb95517489e3a6e093a7210c83d9c99e0a812c9b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm">annotate</a> |
<a href="/comm-central/diff/bb95517489e3a6e093a7210c83d9c99e0a812c9b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm">diff</a> |
<a href="/comm-central/comparison/bb95517489e3a6e093a7210c83d9c99e0a812c9b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm">comparison</a> |
<a href="/comm-central/log/bb95517489e3a6e093a7210c83d9c99e0a812c9b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -3988,17 +3988,19 @@ function setAttendeeContext(aEvent) {</span>
<a href="#l1.4"></a><span id="l1.4">     document.getElementById(&quot;attendee-popup-sendemail-menuitem&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l1.5"></a><span id="l1.5">     document.getElementById(&quot;attendee-popup-sendtentativeemail-menuitem&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l1.6"></a><span id="l1.6">     document.getElementById(&quot;attendee-popup-first-separator&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">     // setup attendee specific menu items if appropriate otherwise hide respective menu items</span>
<a href="#l1.9"></a><span id="l1.9">     let mailto = document.getElementById(&quot;attendee-popup-emailattendee-menuitem&quot;);</span>
<a href="#l1.10"></a><span id="l1.10">     let remove = document.getElementById(&quot;attendee-popup-removeattendee-menuitem&quot;);</span>
<a href="#l1.11"></a><span id="l1.11">     let secondSeparator = document.getElementById(&quot;attendee-popup-second-separator&quot;);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    let attId = aEvent.target.parentNode.getAttribute(&quot;attendeeid&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    let attId =</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      aEvent.target.getAttribute(&quot;attendeeid&quot;) ||</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      aEvent.target.parentNode.getAttribute(&quot;attendeeid&quot;);</span>
<a href="#l1.16"></a><span id="l1.16">     let attendee = window.attendees.find(aAtt =&gt; aAtt.id == attId);</span>
<a href="#l1.17"></a><span id="l1.17">     if (attendee) {</span>
<a href="#l1.18"></a><span id="l1.18">       mailto.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l1.19"></a><span id="l1.19">       remove.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">       secondSeparator.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">       mailto.setAttribute(&quot;label&quot;, attendee.toString());</span>
<a href="#l1.23"></a><span id="l1.23">       mailto.attendee = attendee;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/test/browser/browser_localICS.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/test/browser/browser_localICS.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -38,20 +38,20 @@ add_task(async function testLocalICS() {</span>
<a href="#l2.4"></a><span id="l2.4">   plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, wizard =&gt; {</span>
<a href="#l2.5"></a><span id="l2.5">     handleNewCalendarWizard(wizard, calendarName, { network: { format: &quot;ics&quot; } });</span>
<a href="#l2.6"></a><span id="l2.6">   });</span>
<a href="#l2.7"></a><span id="l2.7">   controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l2.8"></a><span id="l2.8">   wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   // Create new event.</span>
<a href="#l2.11"></a><span id="l2.11">   let box = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  invokeEventDialog(controller, box, (event, iframe) =&gt; {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  await invokeEventDialog(controller, box, async (event, iframe) =&gt; {</span>
<a href="#l2.14"></a><span id="l2.14">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-    setData(event, iframe, { title: calendarName, calendar: calendarName });</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    await setData(event, iframe, { title: calendarName, calendar: calendarName });</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">     // save</span>
<a href="#l2.20"></a><span id="l2.20">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l2.21"></a><span id="l2.21">   });</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">   // Assert presence in view.</span>
<a href="#l2.24"></a><span id="l2.24">   controller.waitForElement(</span>
<a href="#l2.25"></a><span id="l2.25">     lookupEventBox(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/test/browser/browser_timezones.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/test/browser/browser_timezones.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -46,30 +46,30 @@ var TIMEZONES = [</span>
<a href="#l3.4"></a><span id="l3.4">   &quot;Australia/Adelaide&quot;,</span>
<a href="#l3.5"></a><span id="l3.5"> ];</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> add_task(async function testTimezones1_SetGMT() {</span>
<a href="#l3.8"></a><span id="l3.8">   Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, &quot;Europe/London&quot;);</span>
<a href="#l3.9"></a><span id="l3.9">   await setCalendarView(&quot;day&quot;);</span>
<a href="#l3.10"></a><span id="l3.10"> });</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-add_task(function testTimezones2_CreateEvents() {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+add_task(async function testTimezones2_CreateEvents() {</span>
<a href="#l3.14"></a><span id="l3.14">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">   // Create weekly recurring events in all TIMEZONES.</span>
<a href="#l3.17"></a><span id="l3.17">   let times = [[4, 30], [5, 0], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l3.18"></a><span id="l3.18">   let time = new Date();</span>
<a href="#l3.19"></a><span id="l3.19">   for (let i = 0; i &lt; TIMEZONES.length; i++) {</span>
<a href="#l3.20"></a><span id="l3.20">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, i + 11);</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+    await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l3.23"></a><span id="l3.23">       time.setHours(times[i][0]);</span>
<a href="#l3.24"></a><span id="l3.24">       time.setMinutes(times[i][1]);</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">       // Set event data.</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-      setData(event, iframe, {</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+      await setData(event, iframe, {</span>
<a href="#l3.29"></a><span id="l3.29">         title: TIMEZONES[i],</span>
<a href="#l3.30"></a><span id="l3.30">         repeat: &quot;weekly&quot;,</span>
<a href="#l3.31"></a><span id="l3.31">         repeatuntil: new Date(2009, 11, 31),</span>
<a href="#l3.32"></a><span id="l3.32">         starttime: time,</span>
<a href="#l3.33"></a><span id="l3.33">         timezone: TIMEZONES[i],</span>
<a href="#l3.34"></a><span id="l3.34">       });</span>
<a href="#l3.35"></a><span id="l3.35"> </span>
<a href="#l3.36"></a><span id="l3.36">       // save</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineat">@@ -249,21 +249,21 @@ function verify(dates, timezones, times)</span>
<a href="#l3.38"></a><span id="l3.38">     `;</span>
<a href="#l3.39"></a><span id="l3.39">   let timeLine = `</span>
<a href="#l3.40"></a><span id="l3.40">         ${DAY_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;scrollbox&quot;}/</span>
<a href="#l3.41"></a><span id="l3.41">         {&quot;class&quot;:&quot;timebar&quot;}/{&quot;class&quot;:&quot;timebarboxstack&quot;}/{&quot;class&quot;:&quot;topbox&quot;}</span>
<a href="#l3.42"></a><span id="l3.42">     `;</span>
<a href="#l3.43"></a><span id="l3.43">   let allowedDifference = 3;</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45">   /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-       xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-       a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-       But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-       on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-    */</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+     xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+     a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+     But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+     on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+  */</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">   for (let [selectedYear, selectedMonth, selectedDay, selectedTime] of datetimes()) {</span>
<a href="#l3.58"></a><span id="l3.58">     goToDate(controller, selectedYear, selectedMonth, selectedDay);</span>
<a href="#l3.59"></a><span id="l3.59"> </span>
<a href="#l3.60"></a><span id="l3.60">     // Find event with timezone tz.</span>
<a href="#l3.61"></a><span id="l3.61">     for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l3.62"></a><span id="l3.62">       let [correctHour, minutes, day] = selectedTime[tzIdx];</span>
<a href="#l3.63"></a><span id="l3.63"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/test/browser/browser_todayPane.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/test/browser/browser_todayPane.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -24,22 +24,22 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l4.6"></a><span id="l4.6"> var { eid, lookup, lookupEventBox, sleep } = helpersForController(controller);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> add_task(async function testTodayPane() {</span>
<a href="#l4.9"></a><span id="l4.9">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l4.10"></a><span id="l4.10">   await setCalendarView(&quot;day&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  let createEvent = (hour, name) =&gt; {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  let createEvent = async (hour, name) =&gt; {</span>
<a href="#l4.14"></a><span id="l4.14">     let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, hour);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+    await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l4.17"></a><span id="l4.17">       let { eid: eventid } = helpersForController(event);</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-      setData(event, iframe, { title: name });</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+      await setData(event, iframe, { title: name });</span>
<a href="#l4.21"></a><span id="l4.21">       event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l4.22"></a><span id="l4.22">     });</span>
<a href="#l4.23"></a><span id="l4.23">   };</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">   // Go to today and verify date.</span>
<a href="#l4.26"></a><span id="l4.26">   let dayPath = `${DAY_VIEW}/${LABELDAYBOX}/{&quot;flex&quot;:&quot;1&quot;}`;</span>
<a href="#l4.27"></a><span id="l4.27">   controller.waitThenClick(lookup(TODAY_BUTTON));</span>
<a href="#l4.28"></a><span id="l4.28">   controller.assert(() =&gt; lookup(dayPath).getNode().mDate.icalString == getIsoDate());</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineat">@@ -51,28 +51,28 @@ add_task(async function testTodayPane() </span>
<a href="#l4.30"></a><span id="l4.30">   let hour = new Date().getHours();</span>
<a href="#l4.31"></a><span id="l4.31">   let startHour = hour &lt; 18 ? hour + 6 : 23;</span>
<a href="#l4.32"></a><span id="l4.32">   let view = lookup(DAY_VIEW).getNode();</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">   if (startHour &lt; 8 || startHour &gt; 16) {</span>
<a href="#l4.35"></a><span id="l4.35">     view.scrollToMinute(60 * startHour);</span>
<a href="#l4.36"></a><span id="l4.36">   }</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-  createEvent(startHour, &quot;Today's Event&quot;);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  await createEvent(startHour, &quot;Today's Event&quot;);</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41">   // Reset view.</span>
<a href="#l4.42"></a><span id="l4.42">   view.scrollToMinute(60 * 8);</span>
<a href="#l4.43"></a><span id="l4.43"> </span>
<a href="#l4.44"></a><span id="l4.44">   // Go to tomorrow and add an event.</span>
<a href="#l4.45"></a><span id="l4.45">   viewForward(controller, 1);</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-  createEvent(9, &quot;Tomorrow's Event&quot;);</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+  await createEvent(9, &quot;Tomorrow's Event&quot;);</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49">   // Go 5 days forward and add an event.</span>
<a href="#l4.50"></a><span id="l4.50">   viewForward(controller, 5);</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-  createEvent(9, &quot;Future Event&quot;);</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+  await createEvent(9, &quot;Future Event&quot;);</span>
<a href="#l4.53"></a><span id="l4.53"> </span>
<a href="#l4.54"></a><span id="l4.54">   // Go to mail tab.</span>
<a href="#l4.55"></a><span id="l4.55">   controller.click(</span>
<a href="#l4.56"></a><span id="l4.56">     lookup(`</span>
<a href="#l4.57"></a><span id="l4.57">         /id(&quot;messengerWindow&quot;)/id(&quot;navigation-toolbox&quot;)/id(&quot;tabs-toolbar&quot;)/id(&quot;tabmail-tabs&quot;)/[1]/[0]</span>
<a href="#l4.58"></a><span id="l4.58">     `)</span>
<a href="#l4.59"></a><span id="l4.59">   );</span>
<a href="#l4.60"></a><span id="l4.60">   sleep();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/test/browser/eventDialog/browser_alarmDialog.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/test/browser/eventDialog/browser_alarmDialog.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -21,32 +21,32 @@ var {</span>
<a href="#l5.4"></a><span id="l5.4"> var { setData } = ChromeUtils.import(&quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;);</span>
<a href="#l5.5"></a><span id="l5.5"> var { plan_for_modal_dialog, wait_for_modal_dialog } = ChromeUtils.import(</span>
<a href="#l5.6"></a><span id="l5.6">   &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> );</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l5.10"></a><span id="l5.10"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-add_task(function testAlarmDialog() {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+add_task(async function testAlarmDialog() {</span>
<a href="#l5.14"></a><span id="l5.14">   let now = new Date();</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l5.17"></a><span id="l5.17">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l5.18"></a><span id="l5.18">   goToDate(controller, now.getFullYear(), now.getMonth() + 1, now.getDate());</span>
<a href="#l5.19"></a><span id="l5.19">   viewForward(controller, 1);</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21">   controller.click(lookupEventBox(&quot;day&quot;, ALLDAY, undefined, 1));</span>
<a href="#l5.22"></a><span id="l5.22">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">   // Create a new all-day event tomorrow.</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+  await invokeEventDialog(controller, null, async (event, iframe) =&gt; {</span>
<a href="#l5.27"></a><span id="l5.27">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l5.31"></a><span id="l5.31">       allday: true,</span>
<a href="#l5.32"></a><span id="l5.32">       reminder: &quot;1day&quot;,</span>
<a href="#l5.33"></a><span id="l5.33">     });</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">     // Prepare to dismiss the alarm.</span>
<a href="#l5.36"></a><span id="l5.36">     plan_for_modal_dialog(&quot;Calendar:AlarmWindow&quot;, alarm =&gt; {</span>
<a href="#l5.37"></a><span id="l5.37">       let { eid: alarmid } = helpersForController(alarm);</span>
<a href="#l5.38"></a><span id="l5.38">       alarm.waitThenClick(alarmid(&quot;alarm-dismiss-all-button&quot;));</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineat">@@ -55,20 +55,20 @@ add_task(function testAlarmDialog() {</span>
<a href="#l5.40"></a><span id="l5.40">     });</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l5.43"></a><span id="l5.43">   });</span>
<a href="#l5.44"></a><span id="l5.44">   wait_for_modal_dialog(&quot;Calendar:AlarmWindow&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">   // Change the reminder duration, this resets the alarm.</span>
<a href="#l5.47"></a><span id="l5.47">   let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, undefined, 1, undefined, EVENTPATH);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l5.50"></a><span id="l5.50">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-    setData(event, iframe, { reminder: &quot;2days&quot; });</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+    await setData(event, iframe, { reminder: &quot;2days&quot; });</span>
<a href="#l5.54"></a><span id="l5.54"> </span>
<a href="#l5.55"></a><span id="l5.55">     // Prepare to snooze the alarm.</span>
<a href="#l5.56"></a><span id="l5.56">     plan_for_modal_dialog(&quot;Calendar:AlarmWindow&quot;, alarm =&gt; {</span>
<a href="#l5.57"></a><span id="l5.57">       let { eid: alarmid } = helpersForController(alarm);</span>
<a href="#l5.58"></a><span id="l5.58">       let snoozeAllButton = alarmid(&quot;alarm-snooze-all-button&quot;);</span>
<a href="#l5.59"></a><span id="l5.59">       let popup = alarmid(&quot;alarm-snooze-all-popup&quot;).getNode();</span>
<a href="#l5.60"></a><span id="l5.60">       let menuitems = popup.querySelectorAll(&quot;:scope &gt; menuitem&quot;);</span>
<a href="#l5.61"></a><span id="l5.61"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/test/browser/eventDialog/browser_eventDialog.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/test/browser/eventDialog/browser_eventDialog.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -35,17 +35,17 @@ var { eid, lookup, lookupEventBox } = he</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> const EVENTTITLE = &quot;Event&quot;;</span>
<a href="#l6.6"></a><span id="l6.6"> const EVENTLOCATION = &quot;Location&quot;;</span>
<a href="#l6.7"></a><span id="l6.7"> const EVENTDESCRIPTION = &quot;Event Description&quot;;</span>
<a href="#l6.8"></a><span id="l6.8"> const EVENTATTENDEE = &quot;foo@bar.com&quot;;</span>
<a href="#l6.9"></a><span id="l6.9"> const EVENTURL = &quot;http://mozilla.org/&quot;;</span>
<a href="#l6.10"></a><span id="l6.10"> var firstDay;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-add_task(function testEventDialog() {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+add_task(async function testEventDialog() {</span>
<a href="#l6.14"></a><span id="l6.14">   let dateFormatter = cal.getDateFormatter();</span>
<a href="#l6.15"></a><span id="l6.15">   let now = new Date();</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l6.18"></a><span id="l6.18">   // Since from other tests we may be elsewhere, make sure we start today.</span>
<a href="#l6.19"></a><span id="l6.19">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">   goToDate(controller, now.getFullYear(), now.getMonth() + 1, now.getDate());</span>
<a href="#l6.21"></a><span id="l6.21">   viewBack(controller, 1);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -73,17 +73,17 @@ add_task(function testEventDialog() {</span>
<a href="#l6.23"></a><span id="l6.23">     cal.dtz.floating</span>
<a href="#l6.24"></a><span id="l6.24">   );</span>
<a href="#l6.25"></a><span id="l6.25">   let endTime = dateFormatter.formatTime(nextHour);</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">   // Create new event on first day in view.</span>
<a href="#l6.28"></a><span id="l6.28">   controller.click(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 1, null));</span>
<a href="#l6.29"></a><span id="l6.29">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  await invokeEventDialog(controller, null, async (event, iframe) =&gt; {</span>
<a href="#l6.33"></a><span id="l6.33">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l6.34"></a><span id="l6.34">     let { eid: iframeId } = helpersForController(iframe);</span>
<a href="#l6.35"></a><span id="l6.35">     let { iframeLookup, getDateTimePicker } = helpersForEditUI(iframe);</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37">     // First check all standard-values are set correctly.</span>
<a href="#l6.38"></a><span id="l6.38">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">     event.waitForElement(startTimeInput);</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -100,17 +100,17 @@ add_task(function testEventDialog() {</span>
<a href="#l6.42"></a><span id="l6.42">     let categories = cal.l10n.getAnyString(&quot;calendar&quot;, &quot;categories&quot;, &quot;categories2&quot;);</span>
<a href="#l6.43"></a><span id="l6.43">     // Pick 4th value in a comma-separated list.</span>
<a href="#l6.44"></a><span id="l6.44">     let category = categories.split(&quot;,&quot;)[4];</span>
<a href="#l6.45"></a><span id="l6.45">     // Calculate date to repeat until.</span>
<a href="#l6.46"></a><span id="l6.46">     let untildate = firstDay.clone();</span>
<a href="#l6.47"></a><span id="l6.47">     untildate.addDuration(cal.createDuration(&quot;P20D&quot;));</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49">     // Fill in the rest of the values.</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l6.52"></a><span id="l6.52">       title: EVENTTITLE,</span>
<a href="#l6.53"></a><span id="l6.53">       location: EVENTLOCATION,</span>
<a href="#l6.54"></a><span id="l6.54">       description: EVENTDESCRIPTION,</span>
<a href="#l6.55"></a><span id="l6.55">       categories: [category],</span>
<a href="#l6.56"></a><span id="l6.56">       repeat: &quot;daily&quot;,</span>
<a href="#l6.57"></a><span id="l6.57">       repeatuntil: cal.dtz.dateTimeToJsDate(untildate),</span>
<a href="#l6.58"></a><span id="l6.58">       reminder: &quot;5minutes&quot;,</span>
<a href="#l6.59"></a><span id="l6.59">       privacy: &quot;private&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/test/browser/eventDialog/browser_eventDialogModificationPrompt.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -24,78 +24,78 @@ var { setData } = ChromeUtils.import(&quot;re</span>
<a href="#l7.4"></a><span id="l7.4"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l7.7"></a><span id="l7.7"> var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> var { date1, date2, date3, data, newlines } = setupData();</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> // Test that closing an event dialog with no changes does not prompt for save.</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-add_task(function testEventDialogModificationPrompt() {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+add_task(async function testEventDialogModificationPrompt() {</span>
<a href="#l7.14"></a><span id="l7.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l7.15"></a><span id="l7.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.16"></a><span id="l7.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   let createbox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l7.19"></a><span id="l7.19">   let eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   // Create new event.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-  invokeEventDialog(controller, createbox, (event, iframe) =&gt; {</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  await invokeEventDialog(controller, createbox, async (event, iframe) =&gt; {</span>
<a href="#l7.24"></a><span id="l7.24">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">     let categories = cal.l10n.getAnyString(&quot;calendar&quot;, &quot;categories&quot;, &quot;categories2&quot;).split(&quot;,&quot;);</span>
<a href="#l7.27"></a><span id="l7.27">     data[0].categories.push(categories[0]);</span>
<a href="#l7.28"></a><span id="l7.28">     data[1].categories.push(categories[1], categories[2]);</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30">     // Enter first set of data.</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    setData(event, iframe, data[0]);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+    await setData(event, iframe, data[0]);</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">     // save</span>
<a href="#l7.35"></a><span id="l7.35">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l7.36"></a><span id="l7.36">   });</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">   // Open, but change nothing.</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-  invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+  await invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l7.41"></a><span id="l7.41">     // Escape the event window, there should be no prompt to save event.</span>
<a href="#l7.42"></a><span id="l7.42">     event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l7.43"></a><span id="l7.43">     // Wait to see if the prompt appears.</span>
<a href="#l7.44"></a><span id="l7.44">     controller.sleep(2000);</span>
<a href="#l7.45"></a><span id="l7.45">   });</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47">   // Open, change all values then revert the changes.</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-  invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+  await invokeEventDialog(controller, eventbox, async (event, iframe) =&gt; {</span>
<a href="#l7.50"></a><span id="l7.50">     // Change all values.</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-    setData(event, iframe, data[1]);</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+    await setData(event, iframe, data[1]);</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54">     // Edit all values back to original.</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-    setData(event, iframe, data[0]);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+    await setData(event, iframe, data[0]);</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58">     // Escape the event window, there should be no prompt to save event.</span>
<a href="#l7.59"></a><span id="l7.59">     event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l7.60"></a><span id="l7.60">     // Wait to see if the prompt appears.</span>
<a href="#l7.61"></a><span id="l7.61">     controller.sleep(2000);</span>
<a href="#l7.62"></a><span id="l7.62">   });</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64">   // Delete event.</span>
<a href="#l7.65"></a><span id="l7.65">   controller.click(eventbox);</span>
<a href="#l7.66"></a><span id="l7.66">   controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l7.67"></a><span id="l7.67">   controller.waitForElementNotPresent(eventbox);</span>
<a href="#l7.68"></a><span id="l7.68"> </span>
<a href="#l7.69"></a><span id="l7.69">   for (let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l7.70"></a><span id="l7.70">     // test set i</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-    invokeEventDialog(controller, createbox, (event, iframe) =&gt; {</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+    await invokeEventDialog(controller, createbox, async (event, iframe) =&gt; {</span>
<a href="#l7.73"></a><span id="l7.73">       let { eid: eventid } = helpersForController(event);</span>
<a href="#l7.74"></a><span id="l7.74"> </span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-      setData(event, iframe, newlines[i]);</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+      await setData(event, iframe, newlines[i]);</span>
<a href="#l7.77"></a><span id="l7.77">       event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l7.78"></a><span id="l7.78">     });</span>
<a href="#l7.79"></a><span id="l7.79"> </span>
<a href="#l7.80"></a><span id="l7.80">     // Open and close.</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-    invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-      setData(event, iframe, newlines[i]);</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+    await invokeEventDialog(controller, eventbox, async (event, iframe) =&gt; {</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+      await setData(event, iframe, newlines[i]);</span>
<a href="#l7.85"></a><span id="l7.85">       event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l7.86"></a><span id="l7.86">       // Wait to see if the prompt appears.</span>
<a href="#l7.87"></a><span id="l7.87">       controller.sleep(2000);</span>
<a href="#l7.88"></a><span id="l7.88">     });</span>
<a href="#l7.89"></a><span id="l7.89"> </span>
<a href="#l7.90"></a><span id="l7.90">     // Delete it.</span>
<a href="#l7.91"></a><span id="l7.91">     // XXX Somehow the event is selected at this point, this didn't use to</span>
<a href="#l7.92"></a><span id="l7.92">     // be the case and can't be reproduced manually.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/test/browser/eventDialog/browser_eventDialogSize.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/test/browser/eventDialog/browser_eventDialogSize.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -19,71 +19,71 @@ var controller = mozmill.getMail3PaneCon</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> const SMALL_TOLERANCE = 5;</span>
<a href="#l8.6"></a><span id="l8.6"> const LARGE_TOLERANCE = 10;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> add_task(function setupModule(module) {</span>
<a href="#l8.9"></a><span id="l8.9">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l8.10"></a><span id="l8.10"> });</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-add_task(function testEventDialog() {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+add_task(async function testEventDialog() {</span>
<a href="#l8.14"></a><span id="l8.14">   dump(&quot;#ltnNewEvent click\n&quot;);</span>
<a href="#l8.15"></a><span id="l8.15">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.18"></a><span id="l8.18">     checkLargeEnough(event, iframe);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     // Much larger than necessary.</span>
<a href="#l8.21"></a><span id="l8.21">     event.window.resizeTo(640, 690);</span>
<a href="#l8.22"></a><span id="l8.22">     checkWithinTolerance(event.window.outerWidth, 640);</span>
<a href="#l8.23"></a><span id="l8.23">     checkWithinTolerance(event.window.outerHeight, 690);</span>
<a href="#l8.24"></a><span id="l8.24">     event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l8.25"></a><span id="l8.25">   });</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27">   checkWithinTolerance(getPersistedValue(&quot;event&quot;, &quot;width&quot;), 640, LARGE_TOLERANCE);</span>
<a href="#l8.28"></a><span id="l8.28">   checkWithinTolerance(getPersistedValue(&quot;event&quot;, &quot;height&quot;), 690, LARGE_TOLERANCE);</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">   dump(&quot;#ltnNewEvent click\n&quot;);</span>
<a href="#l8.31"></a><span id="l8.31">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.34"></a><span id="l8.34">     checkWithinTolerance(event.window.outerWidth, 640, LARGE_TOLERANCE);</span>
<a href="#l8.35"></a><span id="l8.35">     checkWithinTolerance(event.window.outerHeight, 690, LARGE_TOLERANCE);</span>
<a href="#l8.36"></a><span id="l8.36">     checkLargeEnough(event, iframe);</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">     // Much smaller than necessary.</span>
<a href="#l8.39"></a><span id="l8.39">     event.window.resizeTo(350, 400);</span>
<a href="#l8.40"></a><span id="l8.40">     controller.assert(() =&gt; event.window.outerWidth &lt; 640);</span>
<a href="#l8.41"></a><span id="l8.41">     controller.assert(() =&gt; event.window.outerHeight &lt; 690);</span>
<a href="#l8.42"></a><span id="l8.42">     controller.assert(() =&gt; event.window.outerWidth &gt; 350);</span>
<a href="#l8.43"></a><span id="l8.43">     controller.assert(() =&gt; event.window.outerHeight &gt; 400);</span>
<a href="#l8.44"></a><span id="l8.44">     checkLargeEnough(event, iframe);</span>
<a href="#l8.45"></a><span id="l8.45">     event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l8.46"></a><span id="l8.46">   });</span>
<a href="#l8.47"></a><span id="l8.47"> </span>
<a href="#l8.48"></a><span id="l8.48">   dump(&quot;#ltnNewEvent click\n&quot;);</span>
<a href="#l8.49"></a><span id="l8.49">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.52"></a><span id="l8.52">     checkLargeEnough(event, iframe);</span>
<a href="#l8.53"></a><span id="l8.53"> </span>
<a href="#l8.54"></a><span id="l8.54">     // Much larger than necessary.</span>
<a href="#l8.55"></a><span id="l8.55">     event.window.resizeTo(640, 690);</span>
<a href="#l8.56"></a><span id="l8.56">     checkWithinTolerance(event.window.outerWidth, 640);</span>
<a href="#l8.57"></a><span id="l8.57">     checkWithinTolerance(event.window.outerHeight, 690);</span>
<a href="#l8.58"></a><span id="l8.58">     event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l8.59"></a><span id="l8.59">   });</span>
<a href="#l8.60"></a><span id="l8.60"> </span>
<a href="#l8.61"></a><span id="l8.61">   checkWithinTolerance(getPersistedValue(&quot;event&quot;, &quot;width&quot;), 640, LARGE_TOLERANCE);</span>
<a href="#l8.62"></a><span id="l8.62">   checkWithinTolerance(getPersistedValue(&quot;event&quot;, &quot;height&quot;), 690, LARGE_TOLERANCE);</span>
<a href="#l8.63"></a><span id="l8.63"> </span>
<a href="#l8.64"></a><span id="l8.64">   Assert.ok(true, &quot;Test ran to completion&quot;);</span>
<a href="#l8.65"></a><span id="l8.65"> });</span>
<a href="#l8.66"></a><span id="l8.66"> </span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-add_task(function testTaskDialog() {</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+add_task(async function testTaskDialog() {</span>
<a href="#l8.69"></a><span id="l8.69">   dump(&quot;#ltnNewTask click\n&quot;);</span>
<a href="#l8.70"></a><span id="l8.70">   controller.mainMenu.click(&quot;#ltnNewTask&quot;);</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  await invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l8.73"></a><span id="l8.73">     checkWithinTolerance(getPersistedValue(&quot;event&quot;, &quot;width&quot;), 640, LARGE_TOLERANCE);</span>
<a href="#l8.74"></a><span id="l8.74">     checkWithinTolerance(getPersistedValue(&quot;event&quot;, &quot;height&quot;), 690, LARGE_TOLERANCE);</span>
<a href="#l8.75"></a><span id="l8.75"> </span>
<a href="#l8.76"></a><span id="l8.76">     checkLargeEnough(task, iframe);</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">     // Much larger than necessary.</span>
<a href="#l8.79"></a><span id="l8.79">     task.window.resizeTo(650, 700);</span>
<a href="#l8.80"></a><span id="l8.80">     checkWithinTolerance(task.window.outerWidth, 650);</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineat">@@ -91,34 +91,34 @@ add_task(function testTaskDialog() {</span>
<a href="#l8.82"></a><span id="l8.82">     task.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l8.83"></a><span id="l8.83">   });</span>
<a href="#l8.84"></a><span id="l8.84"> </span>
<a href="#l8.85"></a><span id="l8.85">   checkWithinTolerance(getPersistedValue(&quot;task&quot;, &quot;width&quot;), 650, LARGE_TOLERANCE);</span>
<a href="#l8.86"></a><span id="l8.86">   checkWithinTolerance(getPersistedValue(&quot;task&quot;, &quot;height&quot;), 700, LARGE_TOLERANCE);</span>
<a href="#l8.87"></a><span id="l8.87"> </span>
<a href="#l8.88"></a><span id="l8.88">   dump(&quot;#ltnNewTask click\n&quot;);</span>
<a href="#l8.89"></a><span id="l8.89">   controller.mainMenu.click(&quot;#ltnNewTask&quot;);</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-  invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+  await invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l8.92"></a><span id="l8.92">     checkWithinTolerance(task.window.outerWidth, 650, LARGE_TOLERANCE);</span>
<a href="#l8.93"></a><span id="l8.93">     checkWithinTolerance(task.window.outerHeight, 700, LARGE_TOLERANCE);</span>
<a href="#l8.94"></a><span id="l8.94">     checkLargeEnough(task, iframe);</span>
<a href="#l8.95"></a><span id="l8.95"> </span>
<a href="#l8.96"></a><span id="l8.96">     // Much smaller than necessary.</span>
<a href="#l8.97"></a><span id="l8.97">     task.window.resizeTo(350, 400);</span>
<a href="#l8.98"></a><span id="l8.98">     controller.assert(() =&gt; task.window.outerWidth &lt; 650);</span>
<a href="#l8.99"></a><span id="l8.99">     controller.assert(() =&gt; task.window.outerHeight &lt; 700);</span>
<a href="#l8.100"></a><span id="l8.100">     controller.assert(() =&gt; task.window.outerWidth &gt; 350);</span>
<a href="#l8.101"></a><span id="l8.101">     controller.assert(() =&gt; task.window.outerHeight &gt; 400);</span>
<a href="#l8.102"></a><span id="l8.102">     checkLargeEnough(task, iframe);</span>
<a href="#l8.103"></a><span id="l8.103">     task.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l8.104"></a><span id="l8.104">   });</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106">   dump(&quot;#ltnNewTask click\n&quot;);</span>
<a href="#l8.107"></a><span id="l8.107">   controller.mainMenu.click(&quot;#ltnNewTask&quot;);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-  invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+  await invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l8.110"></a><span id="l8.110">     checkLargeEnough(task, iframe);</span>
<a href="#l8.111"></a><span id="l8.111"> </span>
<a href="#l8.112"></a><span id="l8.112">     // Much larger than necessary.</span>
<a href="#l8.113"></a><span id="l8.113">     task.window.resizeTo(650, 700);</span>
<a href="#l8.114"></a><span id="l8.114">     checkWithinTolerance(task.window.outerWidth, 650);</span>
<a href="#l8.115"></a><span id="l8.115">     checkWithinTolerance(task.window.outerHeight, 700);</span>
<a href="#l8.116"></a><span id="l8.116">     task.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l8.117"></a><span id="l8.117">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/browser/eventDialog/browser_utf8.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/browser/eventDialog/browser_utf8.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -18,42 +18,42 @@ var { setData } = ChromeUtils.import(&quot;re</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l9.8"></a><span id="l9.8"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> var UTF8STRING = &quot; 💣 💥  ☣  &quot;;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-add_task(function testUTF8() {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+add_task(async function testUTF8() {</span>
<a href="#l9.14"></a><span id="l9.14">   Services.prefs.setStringPref(&quot;calendar.categories.names&quot;, UTF8STRING);</span>
<a href="#l9.15"></a><span id="l9.15">   createCalendar(controller, UTF8STRING);</span>
<a href="#l9.16"></a><span id="l9.16">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">   // Create new event.</span>
<a href="#l9.19"></a><span id="l9.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l9.22"></a><span id="l9.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">     // Fill in name, location, description.</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l9.27"></a><span id="l9.27">       title: UTF8STRING,</span>
<a href="#l9.28"></a><span id="l9.28">       location: UTF8STRING,</span>
<a href="#l9.29"></a><span id="l9.29">       description: UTF8STRING,</span>
<a href="#l9.30"></a><span id="l9.30">       categories: [UTF8STRING],</span>
<a href="#l9.31"></a><span id="l9.31">     });</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33">     // save</span>
<a href="#l9.34"></a><span id="l9.34">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l9.35"></a><span id="l9.35">   });</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">   // open</span>
<a href="#l9.38"></a><span id="l9.38">   let eventPath = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${UTF8STRING.toLowerCase()}&quot;}`;</span>
<a href="#l9.39"></a><span id="l9.39">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, eventPath);</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l9.42"></a><span id="l9.42">     let { eid: iframeId } = helpersForController(iframe);</span>
<a href="#l9.43"></a><span id="l9.43"> </span>
<a href="#l9.44"></a><span id="l9.44">     // Check values.</span>
<a href="#l9.45"></a><span id="l9.45">     event.assertValue(iframeId(&quot;item-title&quot;), UTF8STRING);</span>
<a href="#l9.46"></a><span id="l9.46">     event.assertValue(iframeId(&quot;item-location&quot;), UTF8STRING);</span>
<a href="#l9.47"></a><span id="l9.47">     event.assertValue(iframeId(&quot;item-description&quot;), UTF8STRING);</span>
<a href="#l9.48"></a><span id="l9.48">     event.assert(() =&gt;</span>
<a href="#l9.49"></a><span id="l9.49">       iframeId(&quot;item-categories&quot;).getNode().querySelector(`</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/test/browser/preferences/browser_alarmDefaultValue.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/test/browser/preferences/browser_alarmDefaultValue.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -27,17 +27,17 @@ var { PluralForm } = ChromeUtils.import(</span>
<a href="#l10.4"></a><span id="l10.4"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> const DEFVALUE = 43;</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> var prefTab = null;</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-add_task(function testDefaultAlarms() {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+add_task(async function testDefaultAlarms() {</span>
<a href="#l10.14"></a><span id="l10.14">   let localeUnitString = cal.l10n.getCalString(&quot;unitDays&quot;);</span>
<a href="#l10.15"></a><span id="l10.15">   let unitString = PluralForm.get(DEFVALUE, localeUnitString).replace(&quot;#1&quot;, DEFVALUE);</span>
<a href="#l10.16"></a><span id="l10.16">   let alarmString = (...args) =&gt; cal.l10n.getString(&quot;calendar-alarms&quot;, ...args);</span>
<a href="#l10.17"></a><span id="l10.17">   let originStringEvent = alarmString(&quot;reminderCustomOriginBeginBeforeEvent&quot;);</span>
<a href="#l10.18"></a><span id="l10.18">   let originStringTask = alarmString(&quot;reminderCustomOriginBeginBeforeTask&quot;);</span>
<a href="#l10.19"></a><span id="l10.19">   let expectedEventReminder = alarmString(&quot;reminderCustomTitle&quot;, [unitString, originStringEvent]);</span>
<a href="#l10.20"></a><span id="l10.20">   let expectedTaskReminder = alarmString(&quot;reminderCustomTitle&quot;, [unitString, originStringTask]);</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -46,17 +46,17 @@ add_task(function testDefaultAlarms() {</span>
<a href="#l10.23"></a><span id="l10.23">     `;</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">   // Configure the lightning preferences.</span>
<a href="#l10.26"></a><span id="l10.26">   openLightningPrefs(handlePrefTab, controller);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   // Create New Event.</span>
<a href="#l10.29"></a><span id="l10.29">   controller.keypress(null, &quot;i&quot;, { shiftKey: false, accelKey: true });</span>
<a href="#l10.30"></a><span id="l10.30">   // Set up the event dialog controller.</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l10.33"></a><span id="l10.33">     let { xpath: eventpath, eid: eventid } = helpersForController(event);</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35">     // Check if the &quot;custom&quot; item was selected.</span>
<a href="#l10.36"></a><span id="l10.36">     event.assertDOMProperty(eventid(&quot;item-alarm&quot;), &quot;value&quot;, &quot;custom&quot;);</span>
<a href="#l10.37"></a><span id="l10.37">     let reminderDetailsVisible = eventpath(detailPath);</span>
<a href="#l10.38"></a><span id="l10.38">     event.assertDOMProperty(reminderDetailsVisible, &quot;value&quot;, expectedEventReminder);</span>
<a href="#l10.39"></a><span id="l10.39"> </span>
<a href="#l10.40"></a><span id="l10.40">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Reminder&quot;, handleReminderDialog);</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineat">@@ -64,17 +64,17 @@ add_task(function testDefaultAlarms() {</span>
<a href="#l10.42"></a><span id="l10.42">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Reminder&quot;);</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44">     // Close the event dialog.</span>
<a href="#l10.45"></a><span id="l10.45">     event.window.close();</span>
<a href="#l10.46"></a><span id="l10.46">   });</span>
<a href="#l10.47"></a><span id="l10.47"> </span>
<a href="#l10.48"></a><span id="l10.48">   // Create New Task.</span>
<a href="#l10.49"></a><span id="l10.49">   controller.keypress(null, &quot;d&quot;, { shiftKey: false, accelKey: true });</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-  invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+  await invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l10.52"></a><span id="l10.52">     let { xpath: taskpath, eid: taskid } = helpersForController(task);</span>
<a href="#l10.53"></a><span id="l10.53"> </span>
<a href="#l10.54"></a><span id="l10.54">     // Check if the &quot;custom&quot; item was selected.</span>
<a href="#l10.55"></a><span id="l10.55">     task.assertDOMProperty(taskid(&quot;item-alarm&quot;), &quot;value&quot;, &quot;custom&quot;);</span>
<a href="#l10.56"></a><span id="l10.56">     let reminderDetailsVisible = taskpath(detailPath);</span>
<a href="#l10.57"></a><span id="l10.57">     task.assertDOMProperty(reminderDetailsVisible, &quot;value&quot;, expectedTaskReminder);</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Reminder&quot;, handleReminderDialog);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_annual.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_annual.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -21,24 +21,24 @@ var {</span>
<a href="#l11.4"></a><span id="l11.4"> } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l11.7"></a><span id="l11.7"> var { getEventBoxPath, lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> const STARTYEAR = 1950;</span>
<a href="#l11.10"></a><span id="l11.10"> const EPOCH = 1970;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-add_task(function testAnnualRecurrence() {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+add_task(async function testAnnualRecurrence() {</span>
<a href="#l11.14"></a><span id="l11.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l11.15"></a><span id="l11.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.16"></a><span id="l11.16">   goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">   // Create yearly recurring all-day event.</span>
<a href="#l11.19"></a><span id="l11.19">   let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l11.22"></a><span id="l11.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;yearly&quot;, event);</span>
<a href="#l11.25"></a><span id="l11.25">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l11.26"></a><span id="l11.26">   });</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">   let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l11.29"></a><span id="l11.29">   for (let year of checkYears) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_biweekly.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_biweekly.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -21,24 +21,24 @@ var {</span>
<a href="#l12.4"></a><span id="l12.4">   viewForward,</span>
<a href="#l12.5"></a><span id="l12.5"> } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l12.8"></a><span id="l12.8"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> const HOUR = 8;</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-add_task(function testBiweeklyRecurrence() {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+add_task(async function testBiweeklyRecurrence() {</span>
<a href="#l12.14"></a><span id="l12.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l12.15"></a><span id="l12.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.16"></a><span id="l12.16">   goToDate(controller, 2009, 1, 31);</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18">   // Create biweekly event.</span>
<a href="#l12.19"></a><span id="l12.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l12.22"></a><span id="l12.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;bi.weekly&quot;, event);</span>
<a href="#l12.25"></a><span id="l12.25">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l12.26"></a><span id="l12.26">   });</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   // Check day view.</span>
<a href="#l12.29"></a><span id="l12.29">   for (let i = 0; i &lt; 4; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_daily.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_daily.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -23,27 +23,27 @@ var {</span>
<a href="#l13.4"></a><span id="l13.4"> } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l13.5"></a><span id="l13.5"> var { setData } = ChromeUtils.import(&quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;);</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l13.8"></a><span id="l13.8"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> const HOUR = 8;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-add_task(function testDailyRecurrence() {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+add_task(async function testDailyRecurrence() {</span>
<a href="#l13.14"></a><span id="l13.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l13.15"></a><span id="l13.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.16"></a><span id="l13.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   // Create daily event.</span>
<a href="#l13.19"></a><span id="l13.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l13.22"></a><span id="l13.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-    setData(event, iframe, { repeat: &quot;daily&quot;, repeatuntil: new Date(2009, 2, 20) });</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    await setData(event, iframe, { repeat: &quot;daily&quot;, repeatuntil: new Date(2009, 2, 20) });</span>
<a href="#l13.26"></a><span id="l13.26">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l13.27"></a><span id="l13.27">   });</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">   // Check day view for 7 days.</span>
<a href="#l13.30"></a><span id="l13.30">   let daybox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l13.31"></a><span id="l13.31">   controller.waitForElement(daybox);</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33">   for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineat">@@ -112,17 +112,17 @@ add_task(function testDailyRecurrence() </span>
<a href="#l13.35"></a><span id="l13.35">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.36"></a><span id="l13.36">   controller.assertNodeNotExist(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l13.37"></a><span id="l13.37"> </span>
<a href="#l13.38"></a><span id="l13.38">   // Go to previous day to edit event to occur only on weekdays.</span>
<a href="#l13.39"></a><span id="l13.39">   viewBack(controller, 1);</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l13.42"></a><span id="l13.42">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l13.45"></a><span id="l13.45">     let { eid: eventid, sleep: eventsleep } = helpersForController(event);</span>
<a href="#l13.46"></a><span id="l13.46"> </span>
<a href="#l13.47"></a><span id="l13.47">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;every.weekday&quot;, event);</span>
<a href="#l13.48"></a><span id="l13.48">     eventsleep();</span>
<a href="#l13.49"></a><span id="l13.49">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l13.50"></a><span id="l13.50">   });</span>
<a href="#l13.51"></a><span id="l13.51"> </span>
<a href="#l13.52"></a><span id="l13.52">   // Check day view for 7 days.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_lastDayOfMonth.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_lastDayOfMonth.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -27,24 +27,24 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l14.4"></a><span id="l14.4">   &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> );</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l14.8"></a><span id="l14.8"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> const HOUR = 8;</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-add_task(function testLastDayOfMonthRecurrence() {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+add_task(async function testLastDayOfMonthRecurrence() {</span>
<a href="#l14.14"></a><span id="l14.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l14.15"></a><span id="l14.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.16"></a><span id="l14.16">   goToDate(controller, 2008, 1, 31); // Start with a leap year.</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18">   // Create monthly recurring event.</span>
<a href="#l14.19"></a><span id="l14.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l14.22"></a><span id="l14.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l14.25"></a><span id="l14.25">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l14.26"></a><span id="l14.26">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l14.29"></a><span id="l14.29">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyN.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyN.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -30,24 +30,24 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l15.8"></a><span id="l15.8"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10"> const HOUR = 8;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-add_task(function testWeeklyNRecurrence() {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+add_task(async function testWeeklyNRecurrence() {</span>
<a href="#l15.14"></a><span id="l15.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l15.15"></a><span id="l15.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.16"></a><span id="l15.16">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18">   // Create weekly recurring event.</span>
<a href="#l15.19"></a><span id="l15.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l15.22"></a><span id="l15.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l15.25"></a><span id="l15.25">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l15.26"></a><span id="l15.26">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l15.27"></a><span id="l15.27">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">     event.click(eventid(&quot;button-saveandclose&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyUntil.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyUntil.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -32,24 +32,24 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l16.4"></a><span id="l16.4"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l16.7"></a><span id="l16.7"> var { lookupEventBox } = helpersForController(controller);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> const ENDDATE = new Date(2009, 0, 26); // Last Monday in month.</span>
<a href="#l16.10"></a><span id="l16.10"> const HOUR = 8;</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-add_task(function testWeeklyUntilRecurrence() {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+add_task(async function testWeeklyUntilRecurrence() {</span>
<a href="#l16.14"></a><span id="l16.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l16.15"></a><span id="l16.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.16"></a><span id="l16.16">   goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">   // Create weekly recurring event.</span>
<a href="#l16.19"></a><span id="l16.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l16.22"></a><span id="l16.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l16.25"></a><span id="l16.25">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l16.26"></a><span id="l16.26">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l16.27"></a><span id="l16.27">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">     event.click(eventid(&quot;button-saveandclose&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyWithException.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyWithException.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -37,49 +37,49 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l17.4"></a><span id="l17.4"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l17.7"></a><span id="l17.7"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> const HOUR = 8;</span>
<a href="#l17.10"></a><span id="l17.10"> const STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-add_task(function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+add_task(async function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l17.14"></a><span id="l17.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l17.15"></a><span id="l17.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.16"></a><span id="l17.16">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">   // Create weekly recurring event.</span>
<a href="#l17.19"></a><span id="l17.19">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l17.22"></a><span id="l17.22">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.23"></a><span id="l17.23"> </span>
<a href="#l17.24"></a><span id="l17.24">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l17.25"></a><span id="l17.25">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l17.26"></a><span id="l17.26">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l17.27"></a><span id="l17.27">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l17.28"></a><span id="l17.28"> </span>
<a href="#l17.29"></a><span id="l17.29">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l17.30"></a><span id="l17.30">   });</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32">   // Move 5th January occurrence to 6th January.</span>
<a href="#l17.33"></a><span id="l17.33">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l17.34"></a><span id="l17.34">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, false);</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+  await invokeEventDialog(controller, null, async (event, iframe) =&gt; {</span>
<a href="#l17.37"></a><span id="l17.37">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    setData(event, iframe, { startdate: STARTDATE, enddate: STARTDATE });</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+    await setData(event, iframe, { startdate: STARTDATE, enddate: STARTDATE });</span>
<a href="#l17.41"></a><span id="l17.41">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l17.42"></a><span id="l17.42">   });</span>
<a href="#l17.43"></a><span id="l17.43"> </span>
<a href="#l17.44"></a><span id="l17.44">   // Change recurrence rule.</span>
<a href="#l17.45"></a><span id="l17.45">   goToDate(controller, 2009, 1, 7);</span>
<a href="#l17.46"></a><span id="l17.46">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l17.47"></a><span id="l17.47">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l17.50"></a><span id="l17.50">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.51"></a><span id="l17.51">     let { iframeLookup } = helpersForEditUI(iframe);</span>
<a href="#l17.52"></a><span id="l17.52"> </span>
<a href="#l17.53"></a><span id="l17.53">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l17.54"></a><span id="l17.54">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, changeRecurrence);</span>
<a href="#l17.55"></a><span id="l17.55">     event.click(iframeLookup(REPEAT_DETAILS));</span>
<a href="#l17.56"></a><span id="l17.56">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l17.57"></a><span id="l17.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_annual.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_annual.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -21,28 +21,28 @@ var {</span>
<a href="#l18.4"></a><span id="l18.4"> } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l18.7"></a><span id="l18.7"> var { eid, getEventBoxPath, lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> const STARTYEAR = 1950;</span>
<a href="#l18.10"></a><span id="l18.10"> const EPOCH = 1970;</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-add_task(function testAnnualRecurrence() {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+add_task(async function testAnnualRecurrence() {</span>
<a href="#l18.14"></a><span id="l18.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l18.15"></a><span id="l18.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.16"></a><span id="l18.16">   goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">   // Rotate view.</span>
<a href="#l18.19"></a><span id="l18.19">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.20"></a><span id="l18.20">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22">   // Create yearly recurring all-day event.</span>
<a href="#l18.23"></a><span id="l18.23">   let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l18.26"></a><span id="l18.26">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;yearly&quot;, event);</span>
<a href="#l18.29"></a><span id="l18.29">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l18.30"></a><span id="l18.30">   });</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32">   let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l18.33"></a><span id="l18.33">   for (let year of checkYears) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_biweekly.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_biweekly.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -21,28 +21,28 @@ var {</span>
<a href="#l19.4"></a><span id="l19.4">   viewForward,</span>
<a href="#l19.5"></a><span id="l19.5"> } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l19.8"></a><span id="l19.8"> var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10"> const HOUR = 8;</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-add_task(function testBiweeklyRecurrence() {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+add_task(async function testBiweeklyRecurrence() {</span>
<a href="#l19.14"></a><span id="l19.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l19.15"></a><span id="l19.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.16"></a><span id="l19.16">   goToDate(controller, 2009, 1, 31);</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18">   // Rotate view.</span>
<a href="#l19.19"></a><span id="l19.19">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l19.20"></a><span id="l19.20">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">   // Create biweekly event.</span>
<a href="#l19.23"></a><span id="l19.23">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l19.26"></a><span id="l19.26">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;bi.weekly&quot;, event);</span>
<a href="#l19.29"></a><span id="l19.29">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l19.30"></a><span id="l19.30">   });</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32">   // Check day view.</span>
<a href="#l19.33"></a><span id="l19.33">   switchToView(controller, &quot;day&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_daily.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_daily.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -23,31 +23,31 @@ var {</span>
<a href="#l20.4"></a><span id="l20.4"> } = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l20.5"></a><span id="l20.5"> var { setData } = ChromeUtils.import(&quot;resource://testing-common/mozmill/ItemEditingHelpers.jsm&quot;);</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l20.8"></a><span id="l20.8"> var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10"> const HOUR = 8;</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-add_task(function testDailyRecurrence() {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+add_task(async function testDailyRecurrence() {</span>
<a href="#l20.14"></a><span id="l20.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l20.15"></a><span id="l20.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l20.16"></a><span id="l20.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18">   // Rotate view.</span>
<a href="#l20.19"></a><span id="l20.19">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l20.20"></a><span id="l20.20">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22">   // Create daily event.</span>
<a href="#l20.23"></a><span id="l20.23">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l20.26"></a><span id="l20.26">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">-    setData(event, iframe, { repeat: &quot;daily&quot;, repeatuntil: new Date(2009, 2, 20) });</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+    await setData(event, iframe, { repeat: &quot;daily&quot;, repeatuntil: new Date(2009, 2, 20) });</span>
<a href="#l20.30"></a><span id="l20.30">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l20.31"></a><span id="l20.31">   });</span>
<a href="#l20.32"></a><span id="l20.32"> </span>
<a href="#l20.33"></a><span id="l20.33">   // Check day view for 7 days.</span>
<a href="#l20.34"></a><span id="l20.34">   let daybox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l20.35"></a><span id="l20.35">   controller.waitForElement(daybox);</span>
<a href="#l20.36"></a><span id="l20.36"> </span>
<a href="#l20.37"></a><span id="l20.37">   for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineat">@@ -115,17 +115,17 @@ add_task(function testDailyRecurrence() </span>
<a href="#l20.39"></a><span id="l20.39">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l20.40"></a><span id="l20.40">   controller.assertNodeNotExist(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH));</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42">   // Go to previous day to edit event to occur only on weekdays.</span>
<a href="#l20.43"></a><span id="l20.43">   viewBack(controller, 1);</span>
<a href="#l20.44"></a><span id="l20.44"> </span>
<a href="#l20.45"></a><span id="l20.45">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l20.46"></a><span id="l20.46">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l20.49"></a><span id="l20.49">     let { eid: eventid, sleep: eventsleep } = helpersForController(event);</span>
<a href="#l20.50"></a><span id="l20.50"> </span>
<a href="#l20.51"></a><span id="l20.51">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;every.weekday&quot;, event);</span>
<a href="#l20.52"></a><span id="l20.52">     eventsleep();</span>
<a href="#l20.53"></a><span id="l20.53">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l20.54"></a><span id="l20.54">   });</span>
<a href="#l20.55"></a><span id="l20.55"> </span>
<a href="#l20.56"></a><span id="l20.56">   // Check day view for 7 days.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_lastDayOfMonth.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -27,29 +27,29 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l21.4"></a><span id="l21.4">   &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l21.5"></a><span id="l21.5"> );</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l21.8"></a><span id="l21.8"> var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> const HOUR = 8;</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-add_task(function testLastDayOfMonthRecurrence() {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+add_task(async function testLastDayOfMonthRecurrence() {</span>
<a href="#l21.14"></a><span id="l21.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l21.15"></a><span id="l21.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l21.16"></a><span id="l21.16">   goToDate(controller, 2008, 1, 31); // Start with a leap year.</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18">   // Rotate view.</span>
<a href="#l21.19"></a><span id="l21.19">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l21.20"></a><span id="l21.20">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l21.21"></a><span id="l21.21">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l21.22"></a><span id="l21.22"> </span>
<a href="#l21.23"></a><span id="l21.23">   // Create monthly recurring event.</span>
<a href="#l21.24"></a><span id="l21.24">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l21.27"></a><span id="l21.27">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l21.30"></a><span id="l21.30">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l21.31"></a><span id="l21.31">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l21.32"></a><span id="l21.32"> </span>
<a href="#l21.33"></a><span id="l21.33">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l21.34"></a><span id="l21.34">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_weeklyN.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_weeklyN.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -30,28 +30,28 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l22.8"></a><span id="l22.8"> var { eid, lookupEventBox } = helpersForController(controller);</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> const HOUR = 8;</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-add_task(function testWeeklyNRecurrence() {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+add_task(async function testWeeklyNRecurrence() {</span>
<a href="#l22.14"></a><span id="l22.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l22.15"></a><span id="l22.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l22.16"></a><span id="l22.16">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l22.17"></a><span id="l22.17"> </span>
<a href="#l22.18"></a><span id="l22.18">   // Rotate view.</span>
<a href="#l22.19"></a><span id="l22.19">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l22.20"></a><span id="l22.20">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22">   // Create weekly recurring event.</span>
<a href="#l22.23"></a><span id="l22.23">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l22.26"></a><span id="l22.26">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l22.27"></a><span id="l22.27"> </span>
<a href="#l22.28"></a><span id="l22.28">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l22.29"></a><span id="l22.29">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l22.30"></a><span id="l22.30">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l22.31"></a><span id="l22.31">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l22.32"></a><span id="l22.32"> </span>
<a href="#l22.33"></a><span id="l22.33">     event.click(eventid(&quot;button-saveandclose&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_weeklyUntil.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -52,22 +52,22 @@ add_task(function setupModule(module) {</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l23.6"></a><span id="l23.6">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l23.7"></a><span id="l23.7">   // Rotate view.</span>
<a href="#l23.8"></a><span id="l23.8">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l23.9"></a><span id="l23.9">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l23.10"></a><span id="l23.10"> });</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-add_task(function testWeeklyUntilRecurrence() {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+add_task(async function testWeeklyUntilRecurrence() {</span>
<a href="#l23.14"></a><span id="l23.14">   goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16">   // Create weekly recurring event.</span>
<a href="#l23.17"></a><span id="l23.17">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l23.20"></a><span id="l23.20">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l23.23"></a><span id="l23.23">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l23.24"></a><span id="l23.24">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l23.25"></a><span id="l23.25">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l23.26"></a><span id="l23.26"> </span>
<a href="#l23.27"></a><span id="l23.27">     event.click(eventid(&quot;button-saveandclose&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/test/browser/recurrenceRotated/browser_weeklyWithException.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -37,53 +37,53 @@ var { plan_for_modal_dialog, wait_for_mo</span>
<a href="#l24.4"></a><span id="l24.4"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l24.7"></a><span id="l24.7"> var { eid, lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> const HOUR = 8;</span>
<a href="#l24.10"></a><span id="l24.10"> const STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-add_task(function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+add_task(async function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l24.14"></a><span id="l24.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l24.15"></a><span id="l24.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.16"></a><span id="l24.16">   goToDate(controller, 2009, 1, 5);</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18">   // Rotate view.</span>
<a href="#l24.19"></a><span id="l24.19">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l24.20"></a><span id="l24.20">   controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l24.21"></a><span id="l24.21"> </span>
<a href="#l24.22"></a><span id="l24.22">   // Create weekly recurring event.</span>
<a href="#l24.23"></a><span id="l24.23">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+  await invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l24.26"></a><span id="l24.26">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l24.29"></a><span id="l24.29">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, setRecurrence);</span>
<a href="#l24.30"></a><span id="l24.30">     menulistSelect(eventid(&quot;item-repeat&quot;), &quot;custom&quot;, event);</span>
<a href="#l24.31"></a><span id="l24.31">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l24.32"></a><span id="l24.32"> </span>
<a href="#l24.33"></a><span id="l24.33">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l24.34"></a><span id="l24.34">   });</span>
<a href="#l24.35"></a><span id="l24.35"> </span>
<a href="#l24.36"></a><span id="l24.36">   // Move 5th January occurrence to 6th January.</span>
<a href="#l24.37"></a><span id="l24.37">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l24.38"></a><span id="l24.38">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, false);</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+  await invokeEventDialog(controller, null, async (event, iframe) =&gt; {</span>
<a href="#l24.41"></a><span id="l24.41">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-    setData(event, iframe, { startdate: STARTDATE, enddate: STARTDATE });</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    await setData(event, iframe, { startdate: STARTDATE, enddate: STARTDATE });</span>
<a href="#l24.45"></a><span id="l24.45">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l24.46"></a><span id="l24.46">   });</span>
<a href="#l24.47"></a><span id="l24.47"> </span>
<a href="#l24.48"></a><span id="l24.48">   // Change recurrence rule.</span>
<a href="#l24.49"></a><span id="l24.49">   goToDate(controller, 2009, 1, 7);</span>
<a href="#l24.50"></a><span id="l24.50">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l24.51"></a><span id="l24.51">   handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true);</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-  invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+  await invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l24.54"></a><span id="l24.54">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l24.55"></a><span id="l24.55">     let { iframeLookup } = helpersForEditUI(iframe);</span>
<a href="#l24.56"></a><span id="l24.56"> </span>
<a href="#l24.57"></a><span id="l24.57">     event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l24.58"></a><span id="l24.58">     plan_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, changeRecurrence);</span>
<a href="#l24.59"></a><span id="l24.59">     event.click(iframeLookup(REPEAT_DETAILS));</span>
<a href="#l24.60"></a><span id="l24.60">     wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l24.61"></a><span id="l24.61"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/test/browser/views/browser_dayView.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_dayView.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -28,61 +28,61 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l25.6"></a><span id="l25.6"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> const TITLE1 = &quot;Day View Event&quot;;</span>
<a href="#l25.9"></a><span id="l25.9"> const TITLE2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l25.10"></a><span id="l25.10"> const DESC = &quot;Day View Event Description&quot;;</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-add_task(function testDayView() {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+add_task(async function testDayView() {</span>
<a href="#l25.14"></a><span id="l25.14">   let dateFormatter = cal.getDateFormatter();</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l25.17"></a><span id="l25.17">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l25.18"></a><span id="l25.18">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20">   // Verify date in view.</span>
<a href="#l25.21"></a><span id="l25.21">   let day = lookup(`${DAY_VIEW}/${LABELDAYBOX}/{&quot;flex&quot;:&quot;1&quot;}`);</span>
<a href="#l25.22"></a><span id="l25.22">   controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24">   // Create event at 8 AM.</span>
<a href="#l25.25"></a><span id="l25.25">   let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l25.28"></a><span id="l25.28">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l25.29"></a><span id="l25.29">     let { getDateTimePicker } = helpersForEditUI(iframe);</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l25.32"></a><span id="l25.32">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l25.33"></a><span id="l25.33"> </span>
<a href="#l25.34"></a><span id="l25.34">     // Check that the start time is correct.</span>
<a href="#l25.35"></a><span id="l25.35">     let someDate = cal.createDateTime();</span>
<a href="#l25.36"></a><span id="l25.36">     someDate.resetTo(2009, 0, 1, 8, 0, 0, cal.dtz.floating);</span>
<a href="#l25.37"></a><span id="l25.37">     event.waitForElement(startTimeInput);</span>
<a href="#l25.38"></a><span id="l25.38">     event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l25.39"></a><span id="l25.39">     event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l25.40"></a><span id="l25.40"> </span>
<a href="#l25.41"></a><span id="l25.41">     // Fill in title, description and calendar.</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l25.44"></a><span id="l25.44">       title: TITLE1,</span>
<a href="#l25.45"></a><span id="l25.45">       description: DESC,</span>
<a href="#l25.46"></a><span id="l25.46">       calendar: CALENDARNAME,</span>
<a href="#l25.47"></a><span id="l25.47">     });</span>
<a href="#l25.48"></a><span id="l25.48"> </span>
<a href="#l25.49"></a><span id="l25.49">     // save</span>
<a href="#l25.50"></a><span id="l25.50">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l25.51"></a><span id="l25.51">   });</span>
<a href="#l25.52"></a><span id="l25.52"> </span>
<a href="#l25.53"></a><span id="l25.53">   // If it was created successfully, it can be opened.</span>
<a href="#l25.54"></a><span id="l25.54">   eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l25.57"></a><span id="l25.57">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l25.58"></a><span id="l25.58"> </span>
<a href="#l25.59"></a><span id="l25.59">     // Change title and save changes.</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineminus">-    setData(event, iframe, { title: TITLE2 });</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineplus">+    await setData(event, iframe, { title: TITLE2 });</span>
<a href="#l25.62"></a><span id="l25.62">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l25.63"></a><span id="l25.63">   });</span>
<a href="#l25.64"></a><span id="l25.64"> </span>
<a href="#l25.65"></a><span id="l25.65">   // Check if name was saved.</span>
<a href="#l25.66"></a><span id="l25.66">   let eventName = lookupEventBox(</span>
<a href="#l25.67"></a><span id="l25.67">     &quot;day&quot;,</span>
<a href="#l25.68"></a><span id="l25.68">     EVENT_BOX,</span>
<a href="#l25.69"></a><span id="l25.69">     null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/test/browser/views/browser_monthView.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_monthView.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -26,67 +26,67 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l26.6"></a><span id="l26.6"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> const TITLE1 = &quot;Month View Event&quot;;</span>
<a href="#l26.9"></a><span id="l26.9"> const TITLE2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l26.10"></a><span id="l26.10"> const DESC = &quot;Month View Event Description&quot;;</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-add_task(function testMonthView() {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+add_task(async function testMonthView() {</span>
<a href="#l26.14"></a><span id="l26.14">   let dateFormatter = cal.getDateFormatter();</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l26.17"></a><span id="l26.17">   switchToView(controller, &quot;month&quot;);</span>
<a href="#l26.18"></a><span id="l26.18">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20">   // Verify date.</span>
<a href="#l26.21"></a><span id="l26.21">   let day = lookup(`</span>
<a href="#l26.22"></a><span id="l26.22">         ${MONTH_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;monthgrid&quot;}/[0]/{&quot;selected&quot;:&quot;true&quot;}/[0]</span>
<a href="#l26.23"></a><span id="l26.23">     `);</span>
<a href="#l26.24"></a><span id="l26.24">   controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">   // Create event.</span>
<a href="#l26.27"></a><span id="l26.27">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings.</span>
<a href="#l26.28"></a><span id="l26.28">   let hour = new Date().getHours(); // Remember time at click.</span>
<a href="#l26.29"></a><span id="l26.29">   let eventBox = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 5);</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l26.32"></a><span id="l26.32">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l26.33"></a><span id="l26.33">     let { getDateTimePicker } = helpersForEditUI(iframe);</span>
<a href="#l26.34"></a><span id="l26.34"> </span>
<a href="#l26.35"></a><span id="l26.35">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l26.36"></a><span id="l26.36">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l26.37"></a><span id="l26.37"> </span>
<a href="#l26.38"></a><span id="l26.38">     // Check that the start time is correct.</span>
<a href="#l26.39"></a><span id="l26.39">     // Next full hour except last hour hour of the day.</span>
<a href="#l26.40"></a><span id="l26.40">     let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l26.41"></a><span id="l26.41">     let someDate = cal.dtz.now();</span>
<a href="#l26.42"></a><span id="l26.42">     someDate.resetTo(2009, 0, 1, nextHour, 0, 0, cal.dtz.floating);</span>
<a href="#l26.43"></a><span id="l26.43">     event.waitForElement(startTimeInput);</span>
<a href="#l26.44"></a><span id="l26.44">     event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l26.45"></a><span id="l26.45">     event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l26.46"></a><span id="l26.46"> </span>
<a href="#l26.47"></a><span id="l26.47">     // Fill in title, description and calendar.</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l26.50"></a><span id="l26.50">       title: TITLE1,</span>
<a href="#l26.51"></a><span id="l26.51">       description: DESC,</span>
<a href="#l26.52"></a><span id="l26.52">       calendar: CALENDARNAME,</span>
<a href="#l26.53"></a><span id="l26.53">     });</span>
<a href="#l26.54"></a><span id="l26.54"> </span>
<a href="#l26.55"></a><span id="l26.55">     // save</span>
<a href="#l26.56"></a><span id="l26.56">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l26.57"></a><span id="l26.57">   });</span>
<a href="#l26.58"></a><span id="l26.58"> </span>
<a href="#l26.59"></a><span id="l26.59">   // If it was created successfully, it can be opened.</span>
<a href="#l26.60"></a><span id="l26.60">   eventBox = lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 5, null, EVENTPATH);</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l26.63"></a><span id="l26.63">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l26.64"></a><span id="l26.64"> </span>
<a href="#l26.65"></a><span id="l26.65">     // Change title and save changes.</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineminus">-    setData(event, iframe, { title: TITLE2 });</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineplus">+    await setData(event, iframe, { title: TITLE2 });</span>
<a href="#l26.68"></a><span id="l26.68">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l26.69"></a><span id="l26.69">   });</span>
<a href="#l26.70"></a><span id="l26.70"> </span>
<a href="#l26.71"></a><span id="l26.71">   // Check if name was saved.</span>
<a href="#l26.72"></a><span id="l26.72">   let eventName = lookupEventBox(</span>
<a href="#l26.73"></a><span id="l26.73">     &quot;month&quot;,</span>
<a href="#l26.74"></a><span id="l26.74">     CANVAS_BOX,</span>
<a href="#l26.75"></a><span id="l26.75">     1,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/test/browser/views/browser_multiweekView.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_multiweekView.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -26,67 +26,67 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l27.4"></a><span id="l27.4"> </span>
<a href="#l27.5"></a><span id="l27.5"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l27.6"></a><span id="l27.6"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> const TITLE1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l27.9"></a><span id="l27.9"> const TITLE2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l27.10"></a><span id="l27.10"> const DESC = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-add_task(function setupModule(module) {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+add_task(async function setupModule(module) {</span>
<a href="#l27.14"></a><span id="l27.14">   let dateFormatter = cal.getDateFormatter();</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l27.17"></a><span id="l27.17">   switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l27.18"></a><span id="l27.18">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">   // Verify date.</span>
<a href="#l27.21"></a><span id="l27.21">   let day = lookup(`</span>
<a href="#l27.22"></a><span id="l27.22">         ${MULTIWEEK_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;monthgrid&quot;}/[0]/{&quot;selected&quot;:&quot;true&quot;}/[0]</span>
<a href="#l27.23"></a><span id="l27.23">     `);</span>
<a href="#l27.24"></a><span id="l27.24">   controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26">   // Create event.</span>
<a href="#l27.27"></a><span id="l27.27">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings.</span>
<a href="#l27.28"></a><span id="l27.28">   let hour = new Date().getHours(); // Remember time at click.</span>
<a href="#l27.29"></a><span id="l27.29">   let eventBox = lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, 5);</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l27.32"></a><span id="l27.32">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l27.33"></a><span id="l27.33">     let { getDateTimePicker } = helpersForEditUI(iframe);</span>
<a href="#l27.34"></a><span id="l27.34"> </span>
<a href="#l27.35"></a><span id="l27.35">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l27.36"></a><span id="l27.36">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38">     // Check that the start time is correct.</span>
<a href="#l27.39"></a><span id="l27.39">     // Next full hour except last hour hour of the day.</span>
<a href="#l27.40"></a><span id="l27.40">     let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l27.41"></a><span id="l27.41">     let someDate = cal.dtz.now();</span>
<a href="#l27.42"></a><span id="l27.42">     someDate.resetTo(2009, 0, 1, nextHour, 0, 0, cal.dtz.floating);</span>
<a href="#l27.43"></a><span id="l27.43">     event.waitForElement(startTimeInput);</span>
<a href="#l27.44"></a><span id="l27.44">     event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l27.45"></a><span id="l27.45">     event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l27.46"></a><span id="l27.46"> </span>
<a href="#l27.47"></a><span id="l27.47">     // Fill in title, description and calendar.</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l27.50"></a><span id="l27.50">       title: TITLE1,</span>
<a href="#l27.51"></a><span id="l27.51">       description: DESC,</span>
<a href="#l27.52"></a><span id="l27.52">       calendar: CALENDARNAME,</span>
<a href="#l27.53"></a><span id="l27.53">     });</span>
<a href="#l27.54"></a><span id="l27.54"> </span>
<a href="#l27.55"></a><span id="l27.55">     // save</span>
<a href="#l27.56"></a><span id="l27.56">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l27.57"></a><span id="l27.57">   });</span>
<a href="#l27.58"></a><span id="l27.58"> </span>
<a href="#l27.59"></a><span id="l27.59">   // If it was created successfully, it can be opened.</span>
<a href="#l27.60"></a><span id="l27.60">   eventBox = lookupEventBox(&quot;multiweek&quot;, CANVAS_BOX, 1, 5, null, EVENTPATH);</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l27.63"></a><span id="l27.63">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l27.64"></a><span id="l27.64"> </span>
<a href="#l27.65"></a><span id="l27.65">     // Change title and save changes.</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-    setData(event, iframe, { title: TITLE2 });</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineplus">+    await setData(event, iframe, { title: TITLE2 });</span>
<a href="#l27.68"></a><span id="l27.68">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l27.69"></a><span id="l27.69">   });</span>
<a href="#l27.70"></a><span id="l27.70"> </span>
<a href="#l27.71"></a><span id="l27.71">   // Check if name was saved.</span>
<a href="#l27.72"></a><span id="l27.72">   let eventName = lookupEventBox(</span>
<a href="#l27.73"></a><span id="l27.73">     &quot;multiweek&quot;,</span>
<a href="#l27.74"></a><span id="l27.74">     CANVAS_BOX,</span>
<a href="#l27.75"></a><span id="l27.75">     1,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/test/browser/views/browser_taskView.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_taskView.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -20,17 +20,17 @@ var controller = mozmill.getMail3PaneCon</span>
<a href="#l28.4"></a><span id="l28.4"> var { eid, lookup, sleep } = helpersForController(controller);</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6"> const TITLE = &quot;Task&quot;;</span>
<a href="#l28.7"></a><span id="l28.7"> const DESCRIPTION = &quot;1. Do A\n2. Do B&quot;;</span>
<a href="#l28.8"></a><span id="l28.8"> const PERCENTCOMPLETE = &quot;50&quot;;</span>
<a href="#l28.9"></a><span id="l28.9"> </span>
<a href="#l28.10"></a><span id="l28.10"> // Mozmill doesn't support trees yet, therefore completed checkbox and line-through style are not</span>
<a href="#l28.11"></a><span id="l28.11"> // checked.</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-add_task(function setupModule(module) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+add_task(async function setupModule(module) {</span>
<a href="#l28.14"></a><span id="l28.14">   let CALENDARID = createCalendar(controller, CALENDARNAME);</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">   // paths</span>
<a href="#l28.17"></a><span id="l28.17">   let treeChildren = `${TASK_VIEW}/[1]/id(&quot;calendar-task-tree&quot;)/{&quot;class&quot;:&quot;calendar-task-treechildren&quot;}`;</span>
<a href="#l28.18"></a><span id="l28.18">   let taskTree = TASK_VIEW + '[1]/id(&quot;calendar-task-tree&quot;)';</span>
<a href="#l28.19"></a><span id="l28.19">   let toolTip = '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;taskTreeTooltip&quot;)';</span>
<a href="#l28.20"></a><span id="l28.20">   let toolTipTable = toolTip + '/{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderTable&quot;}/';</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -56,24 +56,24 @@ add_task(function setupModule(module) {</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24">   // Last added task is automatically selected so verify detail window data.</span>
<a href="#l28.25"></a><span id="l28.25">   controller.assertJSProperty(eid(&quot;calendar-task-details-title&quot;), &quot;textContent&quot;, TITLE);</span>
<a href="#l28.26"></a><span id="l28.26"> </span>
<a href="#l28.27"></a><span id="l28.27">   // Open added task</span>
<a href="#l28.28"></a><span id="l28.28">   // Double-click on completion checkbox is ignored as opening action, so don't</span>
<a href="#l28.29"></a><span id="l28.29">   // click at immediate left where the checkbox is located.</span>
<a href="#l28.30"></a><span id="l28.30">   controller.doubleClick(lookup(treeChildren), 50, 0);</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-  invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+  await invokeEventDialog(controller, null, async (task, iframe) =&gt; {</span>
<a href="#l28.33"></a><span id="l28.33">     let { eid: taskid } = helpersForController(task);</span>
<a href="#l28.34"></a><span id="l28.34">     let { eid: iframeId } = helpersForController(iframe);</span>
<a href="#l28.35"></a><span id="l28.35"> </span>
<a href="#l28.36"></a><span id="l28.36">     // Verify calendar.</span>
<a href="#l28.37"></a><span id="l28.37">     controller.assertValue(iframeId(&quot;item-calendar&quot;), CALENDARNAME);</span>
<a href="#l28.38"></a><span id="l28.38"> </span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-    setData(task, iframe, {</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+    await setData(task, iframe, {</span>
<a href="#l28.41"></a><span id="l28.41">       status: &quot;needs-action&quot;,</span>
<a href="#l28.42"></a><span id="l28.42">       percent: PERCENTCOMPLETE,</span>
<a href="#l28.43"></a><span id="l28.43">       description: DESCRIPTION,</span>
<a href="#l28.44"></a><span id="l28.44">     });</span>
<a href="#l28.45"></a><span id="l28.45"> </span>
<a href="#l28.46"></a><span id="l28.46">     // save</span>
<a href="#l28.47"></a><span id="l28.47">     task.click(taskid(&quot;button-saveandclose&quot;));</span>
<a href="#l28.48"></a><span id="l28.48">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/test/browser/views/browser_weekView.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_weekView.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -27,65 +27,65 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l29.4"></a><span id="l29.4"> </span>
<a href="#l29.5"></a><span id="l29.5"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l29.6"></a><span id="l29.6"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8"> var TITLE1 = &quot;Week View Event&quot;;</span>
<a href="#l29.9"></a><span id="l29.9"> var TITLE2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l29.10"></a><span id="l29.10"> var DESC = &quot;Week View Event Description&quot;;</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-add_task(function testWeekView() {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+add_task(async function testWeekView() {</span>
<a href="#l29.14"></a><span id="l29.14">   let dateFormatter = cal.getDateFormatter();</span>
<a href="#l29.15"></a><span id="l29.15"> </span>
<a href="#l29.16"></a><span id="l29.16">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l29.17"></a><span id="l29.17">   switchToView(controller, &quot;week&quot;);</span>
<a href="#l29.18"></a><span id="l29.18">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l29.19"></a><span id="l29.19"> </span>
<a href="#l29.20"></a><span id="l29.20">   // Verify date.</span>
<a href="#l29.21"></a><span id="l29.21">   let day = lookup(`</span>
<a href="#l29.22"></a><span id="l29.22">         ${WEEK_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;headerbox&quot;}/</span>
<a href="#l29.23"></a><span id="l29.23">         {&quot;class&quot;:&quot;headerdaybox&quot;}/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l29.24"></a><span id="l29.24">     `);</span>
<a href="#l29.25"></a><span id="l29.25">   controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l29.26"></a><span id="l29.26"> </span>
<a href="#l29.27"></a><span id="l29.27">   // Create event at 8 AM.</span>
<a href="#l29.28"></a><span id="l29.28">   // Thursday of 2009-01-01 is 4th with default settings.</span>
<a href="#l29.29"></a><span id="l29.29">   let eventBox = lookupEventBox(&quot;week&quot;, CANVAS_BOX, null, 5, 8);</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l29.32"></a><span id="l29.32">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l29.33"></a><span id="l29.33">     let { getDateTimePicker } = helpersForEditUI(iframe);</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l29.36"></a><span id="l29.36">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l29.37"></a><span id="l29.37"> </span>
<a href="#l29.38"></a><span id="l29.38">     // Check that the start time is correct.</span>
<a href="#l29.39"></a><span id="l29.39">     event.waitForElement(startTimeInput);</span>
<a href="#l29.40"></a><span id="l29.40">     let someDate = cal.createDateTime();</span>
<a href="#l29.41"></a><span id="l29.41">     someDate.resetTo(2009, 0, 1, 8, 0, 0, cal.dtz.floating);</span>
<a href="#l29.42"></a><span id="l29.42">     event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l29.43"></a><span id="l29.43">     event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l29.44"></a><span id="l29.44"> </span>
<a href="#l29.45"></a><span id="l29.45">     // Fill in title, description and calendar.</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-    setData(event, iframe, {</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineplus">+    await setData(event, iframe, {</span>
<a href="#l29.48"></a><span id="l29.48">       title: TITLE1,</span>
<a href="#l29.49"></a><span id="l29.49">       description: DESC,</span>
<a href="#l29.50"></a><span id="l29.50">       calendar: CALENDARNAME,</span>
<a href="#l29.51"></a><span id="l29.51">     });</span>
<a href="#l29.52"></a><span id="l29.52"> </span>
<a href="#l29.53"></a><span id="l29.53">     // save</span>
<a href="#l29.54"></a><span id="l29.54">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l29.55"></a><span id="l29.55">   });</span>
<a href="#l29.56"></a><span id="l29.56"> </span>
<a href="#l29.57"></a><span id="l29.57">   // If it was created successfully, it can be opened.</span>
<a href="#l29.58"></a><span id="l29.58">   eventBox = lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, null, EVENTPATH);</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-  invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineplus">+  await invokeEventDialog(controller, eventBox, async (event, iframe) =&gt; {</span>
<a href="#l29.61"></a><span id="l29.61">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l29.62"></a><span id="l29.62"> </span>
<a href="#l29.63"></a><span id="l29.63">     // Change title and save changes.</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-    setData(event, iframe, { title: TITLE2 });</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineplus">+    await setData(event, iframe, { title: TITLE2 });</span>
<a href="#l29.66"></a><span id="l29.66">     event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l29.67"></a><span id="l29.67">   });</span>
<a href="#l29.68"></a><span id="l29.68"> </span>
<a href="#l29.69"></a><span id="l29.69">   // Check if name was saved.</span>
<a href="#l29.70"></a><span id="l29.70">   let eventName = lookupEventBox(</span>
<a href="#l29.71"></a><span id="l29.71">     &quot;week&quot;,</span>
<a href="#l29.72"></a><span id="l29.72">     EVENT_BOX,</span>
<a href="#l29.73"></a><span id="l29.73">     null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/test/modules/CalendarUtils.jsm</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/test/modules/CalendarUtils.jsm</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -296,17 +296,17 @@ function goToDate(controller, year, mont</span>
<a href="#l30.4"></a><span id="l30.4"> /**</span>
<a href="#l30.5"></a><span id="l30.5">  * Opens the event dialog by clicking on the (optional) box and executing the</span>
<a href="#l30.6"></a><span id="l30.6">  * body. The event dialog must be closed in the body function.</span>
<a href="#l30.7"></a><span id="l30.7">  *</span>
<a href="#l30.8"></a><span id="l30.8">  * @param controller    Main window controller</span>
<a href="#l30.9"></a><span id="l30.9">  * @param clickBox      The box to click on, or null if no box to click on.</span>
<a href="#l30.10"></a><span id="l30.10">  * @param body          The function to execute while the event dialog is open.</span>
<a href="#l30.11"></a><span id="l30.11">  */</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-function invokeEventDialog(controller, clickBox, body) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+async function invokeEventDialog(controller, clickBox, body) {</span>
<a href="#l30.14"></a><span id="l30.14">   if (clickBox) {</span>
<a href="#l30.15"></a><span id="l30.15">     controller.waitForElement(clickBox);</span>
<a href="#l30.16"></a><span id="l30.16">     controller.doubleClick(clickBox, 1, 1);</span>
<a href="#l30.17"></a><span id="l30.17">   }</span>
<a href="#l30.18"></a><span id="l30.18"> </span>
<a href="#l30.19"></a><span id="l30.19">   controller.waitFor(</span>
<a href="#l30.20"></a><span id="l30.20">     () =&gt; {</span>
<a href="#l30.21"></a><span id="l30.21">       return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0;</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -326,17 +326,17 @@ function invokeEventDialog(controller, c</span>
<a href="#l30.23"></a><span id="l30.23">     &quot;event-dialog did not load in time&quot;,</span>
<a href="#l30.24"></a><span id="l30.24">     10000</span>
<a href="#l30.25"></a><span id="l30.25">   );</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27">   // We can't use a full mozmill controller on an iframe, but we need</span>
<a href="#l30.28"></a><span id="l30.28">   // something for helpersForController.</span>
<a href="#l30.29"></a><span id="l30.29">   let mockIframeController = { window: iframe.contentWindow };</span>
<a href="#l30.30"></a><span id="l30.30"> </span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-  body(eventController, mockIframeController);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+  await body(eventController, mockIframeController);</span>
<a href="#l30.33"></a><span id="l30.33"> </span>
<a href="#l30.34"></a><span id="l30.34">   // Wait for close.</span>
<a href="#l30.35"></a><span id="l30.35">   controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l30.36"></a><span id="l30.36"> }</span>
<a href="#l30.37"></a><span id="l30.37"> </span>
<a href="#l30.38"></a><span id="l30.38"> /**</span>
<a href="#l30.39"></a><span id="l30.39">  * Gets the path for an event box.</span>
<a href="#l30.40"></a><span id="l30.40">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/test/modules/ItemEditingHelpers.jsm</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/test/modules/ItemEditingHelpers.jsm</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -11,39 +11,30 @@ this.EXPORTED_SYMBOLS = [</span>
<a href="#l31.4"></a><span id="l31.4">   &quot;PERCENT_COMPLETE_INPUT&quot;,</span>
<a href="#l31.5"></a><span id="l31.5">   &quot;DATE_INPUT&quot;,</span>
<a href="#l31.6"></a><span id="l31.6">   &quot;TIME_INPUT&quot;,</span>
<a href="#l31.7"></a><span id="l31.7">   &quot;REC_DLG_ACCEPT&quot;,</span>
<a href="#l31.8"></a><span id="l31.8">   &quot;REC_DLG_DAYS&quot;,</span>
<a href="#l31.9"></a><span id="l31.9">   &quot;REC_DLG_UNTIL_INPUT&quot;,</span>
<a href="#l31.10"></a><span id="l31.10">   &quot;helpersForEditUI&quot;,</span>
<a href="#l31.11"></a><span id="l31.11">   &quot;setData&quot;,</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  &quot;setReminderMenulist&quot;,</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-  &quot;setCategories&quot;,</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-  &quot;handleAddingAttachment&quot;,</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-  &quot;setTimezone&quot;,</span>
<a href="#l31.16"></a><span id="l31.16"> ];</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18"> var elementslib = ChromeUtils.import(&quot;resource://testing-common/mozmill/elementslib.jsm&quot;);</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+var { sendString, synthesizeKey, synthesizeMouseAtCenter } = ChromeUtils.import(</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+  &quot;resource://testing-common/mozmill/EventUtils.jsm&quot;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+);</span>
<a href="#l31.22"></a><span id="l31.22"> </span>
<a href="#l31.23"></a><span id="l31.23" class="difflineminus">-var {</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-  helpersForController,</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">-  menulistSelect,</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-  SHORT_SLEEP,</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-  TIMEOUT_MODAL_DIALOG,</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">-} = ChromeUtils.import(&quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;);</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineminus">-var { mark_failure } = ChromeUtils.import(</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-  &quot;resource://testing-common/mozmill/FolderDisplayHelpers.jsm&quot;</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">-var { augment_controller, plan_for_modal_dialog, wait_for_modal_dialog } = ChromeUtils.import(</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineminus">-  &quot;resource://testing-common/mozmill/WindowHelpers.jsm&quot;</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineplus">+var { helpersForController, menulistSelect } = ChromeUtils.import(</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineplus">+  &quot;resource://testing-common/mozmill/CalendarUtils.jsm&quot;</span>
<a href="#l31.36"></a><span id="l31.36"> );</span>
<a href="#l31.37"></a><span id="l31.37"> </span>
<a href="#l31.38"></a><span id="l31.38"> var { cal } = ChromeUtils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l31.39"></a><span id="l31.39"> var { Assert } = ChromeUtils.import(&quot;resource://testing-common/Assert.jsm&quot;);</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineplus">+var { BrowserTestUtils } = ChromeUtils.import(&quot;resource://testing-common/BrowserTestUtils.jsm&quot;);</span>
<a href="#l31.41"></a><span id="l31.41"> </span>
<a href="#l31.42"></a><span id="l31.42"> // Lookup paths and path-snippets.</span>
<a href="#l31.43"></a><span id="l31.43"> // These 5 have to be used with itemEditLookup().</span>
<a href="#l31.44"></a><span id="l31.44"> var CATEGORY_LIST = `</span>
<a href="#l31.45"></a><span id="l31.45">     id(&quot;event-grid&quot;)/id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-color-td&quot;)</span>
<a href="#l31.46"></a><span id="l31.46">     /id(&quot;item-categories&quot;)/id(&quot;item-categories-popup&quot;)</span>
<a href="#l31.47"></a><span id="l31.47"> `;</span>
<a href="#l31.48"></a><span id="l31.48"> var REPEAT_DETAILS = `</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineat">@@ -85,16 +76,20 @@ var REC_DLG_DAYS = `</span>
<a href="#l31.50"></a><span id="l31.50">     {&quot;flex&quot;:&quot;1&quot;}/[1]/id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)</span>
<a href="#l31.51"></a><span id="l31.51"> `;</span>
<a href="#l31.52"></a><span id="l31.52"> var REC_DLG_UNTIL_INPUT = `</span>
<a href="#l31.53"></a><span id="l31.53">     /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l31.54"></a><span id="l31.54">     id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/</span>
<a href="#l31.55"></a><span id="l31.55">     {&quot;class&quot;:&quot;datepicker-menulist&quot;}/{&quot;class&quot;:&quot;menulist-input&quot;}</span>
<a href="#l31.56"></a><span id="l31.56"> `;</span>
<a href="#l31.57"></a><span id="l31.57"> </span>
<a href="#l31.58"></a><span id="l31.58" class="difflineplus">+function sleep(window) {</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineplus">+  return new Promise(resolve =&gt; window.setTimeout(resolve));</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+}</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineplus">+</span>
<a href="#l31.62"></a><span id="l31.62"> function helpersForEditUI(controller) {</span>
<a href="#l31.63"></a><span id="l31.63">   function selector(sel) {</span>
<a href="#l31.64"></a><span id="l31.64">     return sel.trim().replace(/\n(\s*)/g, &quot;&quot;);</span>
<a href="#l31.65"></a><span id="l31.65">   }</span>
<a href="#l31.66"></a><span id="l31.66"> </span>
<a href="#l31.67"></a><span id="l31.67">   let isEvent = cal.item.isEvent(controller.window.calendarItem);</span>
<a href="#l31.68"></a><span id="l31.68"> </span>
<a href="#l31.69"></a><span id="l31.69">   let obj = {</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineat">@@ -197,415 +192,430 @@ function helpersForEditUI(controller) {</span>
<a href="#l31.71"></a><span id="l31.71">  *                      completed - Date object for tasks</span>
<a href="#l31.72"></a><span id="l31.72">  *                      percent - percent complete for tasks</span>
<a href="#l31.73"></a><span id="l31.73">  *                      freebusy - free/busy</span>
<a href="#l31.74"></a><span id="l31.74">  *                      attachment.add - url to add</span>
<a href="#l31.75"></a><span id="l31.75">  *                      attachment.remove - Label of url to remove. (without http://)</span>
<a href="#l31.76"></a><span id="l31.76">  *                      attendees.add - eMail of attendees to add, comma separated.</span>
<a href="#l31.77"></a><span id="l31.77">  *                      attendees.remove - eMail of attendees to remove, comma separated.</span>
<a href="#l31.78"></a><span id="l31.78">  */</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineminus">-function setData(dialog, iframe, data) {</span>
<a href="#l31.80"></a><span id="l31.80" class="difflineminus">-  let { eid, sleep, replaceText } = helpersForController(dialog);</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineplus">+async function setData(dialog, iframe, data) {</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineplus">+  function replaceText(input, text) {</span>
<a href="#l31.83"></a><span id="l31.83" class="difflineplus">+    synthesizeMouseAtCenter(input.getNode(), {}, iframe.window);</span>
<a href="#l31.84"></a><span id="l31.84" class="difflineplus">+    synthesizeKey(&quot;a&quot;, { accelKey: true }, iframe.window);</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineplus">+    sendString(text, iframe.window);</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineplus">+  }</span>
<a href="#l31.87"></a><span id="l31.87" class="difflineplus">+</span>
<a href="#l31.88"></a><span id="l31.88" class="difflineplus">+  let { eid } = helpersForController(dialog);</span>
<a href="#l31.89"></a><span id="l31.89">   let { eid: iframeid } = helpersForController(iframe);</span>
<a href="#l31.90"></a><span id="l31.90">   let { iframeLookup, getDateTimePicker } = helpersForEditUI(iframe);</span>
<a href="#l31.91"></a><span id="l31.91"> </span>
<a href="#l31.92"></a><span id="l31.92">   let isEvent = cal.item.isEvent(iframe.window.calendarItem);</span>
<a href="#l31.93"></a><span id="l31.93"> </span>
<a href="#l31.94"></a><span id="l31.94">   let startdateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l31.95"></a><span id="l31.95">   let enddateInput = getDateTimePicker(&quot;ENDDATE&quot;);</span>
<a href="#l31.96"></a><span id="l31.96">   let starttimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l31.97"></a><span id="l31.97">   let endtimeInput = getDateTimePicker(&quot;ENDTIME&quot;);</span>
<a href="#l31.98"></a><span id="l31.98">   let completeddateInput = getDateTimePicker(&quot;COMPLETEDDATE&quot;);</span>
<a href="#l31.99"></a><span id="l31.99">   let percentCompleteInput = iframeLookup(PERCENT_COMPLETE_INPUT);</span>
<a href="#l31.100"></a><span id="l31.100">   let untilDateInput = getDateTimePicker(&quot;UNTILDATE&quot;);</span>
<a href="#l31.101"></a><span id="l31.101"> </span>
<a href="#l31.102"></a><span id="l31.102">   let dateFormatter = cal.getDateFormatter();</span>
<a href="#l31.103"></a><span id="l31.103">   // Wait for input elements' values to be populated.</span>
<a href="#l31.104"></a><span id="l31.104" class="difflineminus">-  sleep();</span>
<a href="#l31.105"></a><span id="l31.105" class="difflineplus">+  await sleep(iframe.window);</span>
<a href="#l31.106"></a><span id="l31.106"> </span>
<a href="#l31.107"></a><span id="l31.107">   // title</span>
<a href="#l31.108"></a><span id="l31.108" class="difflineminus">-  if (data.title != undefined) {</span>
<a href="#l31.109"></a><span id="l31.109" class="difflineplus">+  if (data.title !== undefined) {</span>
<a href="#l31.110"></a><span id="l31.110">     let titleInput = iframeid(&quot;item-title&quot;);</span>
<a href="#l31.111"></a><span id="l31.111">     replaceText(titleInput, data.title);</span>
<a href="#l31.112"></a><span id="l31.112">   }</span>
<a href="#l31.113"></a><span id="l31.113"> </span>
<a href="#l31.114"></a><span id="l31.114">   // location</span>
<a href="#l31.115"></a><span id="l31.115" class="difflineminus">-  if (data.location != undefined) {</span>
<a href="#l31.116"></a><span id="l31.116" class="difflineplus">+  if (data.location !== undefined) {</span>
<a href="#l31.117"></a><span id="l31.117">     let locationInput = iframeid(&quot;item-location&quot;);</span>
<a href="#l31.118"></a><span id="l31.118">     replaceText(locationInput, data.location);</span>
<a href="#l31.119"></a><span id="l31.119">   }</span>
<a href="#l31.120"></a><span id="l31.120"> </span>
<a href="#l31.121"></a><span id="l31.121">   // categories</span>
<a href="#l31.122"></a><span id="l31.122" class="difflineminus">-  if (data.categories != undefined) {</span>
<a href="#l31.123"></a><span id="l31.123" class="difflineminus">-    setCategories(dialog, iframe, data.categories);</span>
<a href="#l31.124"></a><span id="l31.124" class="difflineplus">+  if (data.categories !== undefined) {</span>
<a href="#l31.125"></a><span id="l31.125" class="difflineplus">+    await setCategories(iframe.window, data.categories);</span>
<a href="#l31.126"></a><span id="l31.126" class="difflineplus">+    await sleep(iframe.window);</span>
<a href="#l31.127"></a><span id="l31.127">   }</span>
<a href="#l31.128"></a><span id="l31.128"> </span>
<a href="#l31.129"></a><span id="l31.129">   // calendar</span>
<a href="#l31.130"></a><span id="l31.130" class="difflineminus">-  if (data.calendar != undefined) {</span>
<a href="#l31.131"></a><span id="l31.131" class="difflineplus">+  if (data.calendar !== undefined) {</span>
<a href="#l31.132"></a><span id="l31.132">     menulistSelect(iframeid(&quot;item-calendar&quot;), data.calendar, dialog);</span>
<a href="#l31.133"></a><span id="l31.133" class="difflineplus">+    await sleep(iframe.window);</span>
<a href="#l31.134"></a><span id="l31.134">   }</span>
<a href="#l31.135"></a><span id="l31.135"> </span>
<a href="#l31.136"></a><span id="l31.136">   // all-day</span>
<a href="#l31.137"></a><span id="l31.137" class="difflineminus">-  if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l31.138"></a><span id="l31.138" class="difflineplus">+  if (data.allday !== undefined &amp;&amp; isEvent) {</span>
<a href="#l31.139"></a><span id="l31.139">     let checkbox = iframeid(&quot;event-all-day&quot;);</span>
<a href="#l31.140"></a><span id="l31.140">     if (checkbox.getNode().checked != data.allday) {</span>
<a href="#l31.141"></a><span id="l31.141" class="difflineminus">-      dialog.click(checkbox);</span>
<a href="#l31.142"></a><span id="l31.142" class="difflineminus">-      sleep();</span>
<a href="#l31.143"></a><span id="l31.143" class="difflineplus">+      synthesizeMouseAtCenter(checkbox.getNode(), {}, iframe.window);</span>
<a href="#l31.144"></a><span id="l31.144">     }</span>
<a href="#l31.145"></a><span id="l31.145" class="difflineminus">-    Assert.equal(checkbox.getNode().checked, data.allday);</span>
<a href="#l31.146"></a><span id="l31.146">   }</span>
<a href="#l31.147"></a><span id="l31.147"> </span>
<a href="#l31.148"></a><span id="l31.148">   // timezonedisplay</span>
<a href="#l31.149"></a><span id="l31.149">   if (data.timezonedisplay !== undefined) {</span>
<a href="#l31.150"></a><span id="l31.150">     let menuitem = eid(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l31.151"></a><span id="l31.151">     if (menuitem.getNode().getAttribute(&quot;checked&quot;) != data.timezonedisplay) {</span>
<a href="#l31.152"></a><span id="l31.152">       dialog.click(menuitem);</span>
<a href="#l31.153"></a><span id="l31.153">     }</span>
<a href="#l31.154"></a><span id="l31.154">   }</span>
<a href="#l31.155"></a><span id="l31.155"> </span>
<a href="#l31.156"></a><span id="l31.156">   // timezone</span>
<a href="#l31.157"></a><span id="l31.157">   if (data.timezone !== undefined) {</span>
<a href="#l31.158"></a><span id="l31.158" class="difflineminus">-    setTimezone(dialog, data.timezone);</span>
<a href="#l31.159"></a><span id="l31.159" class="difflineplus">+    await setTimezone(dialog.window, iframe.window, data.timezone);</span>
<a href="#l31.160"></a><span id="l31.160">   }</span>
<a href="#l31.161"></a><span id="l31.161"> </span>
<a href="#l31.162"></a><span id="l31.162">   // startdate</span>
<a href="#l31.163"></a><span id="l31.163" class="difflineminus">-  if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.164"></a><span id="l31.164" class="difflineplus">+  if (data.startdate !== undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.165"></a><span id="l31.165">     let startdate = dateFormatter.formatDateShort(</span>
<a href="#l31.166"></a><span id="l31.166">       cal.dtz.jsDateToDateTime(data.startdate, cal.dtz.floating)</span>
<a href="#l31.167"></a><span id="l31.167">     );</span>
<a href="#l31.168"></a><span id="l31.168"> </span>
<a href="#l31.169"></a><span id="l31.169">     if (!isEvent) {</span>
<a href="#l31.170"></a><span id="l31.170">       dialog.check(iframeid(&quot;todo-has-entrydate&quot;), true);</span>
<a href="#l31.171"></a><span id="l31.171">     }</span>
<a href="#l31.172"></a><span id="l31.172">     replaceText(startdateInput, startdate);</span>
<a href="#l31.173"></a><span id="l31.173">   }</span>
<a href="#l31.174"></a><span id="l31.174"> </span>
<a href="#l31.175"></a><span id="l31.175">   // starttime</span>
<a href="#l31.176"></a><span id="l31.176" class="difflineminus">-  if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.177"></a><span id="l31.177" class="difflineplus">+  if (data.starttime !== undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.178"></a><span id="l31.178">     let starttime = dateFormatter.formatTime(</span>
<a href="#l31.179"></a><span id="l31.179">       cal.dtz.jsDateToDateTime(data.starttime, cal.dtz.floating)</span>
<a href="#l31.180"></a><span id="l31.180">     );</span>
<a href="#l31.181"></a><span id="l31.181">     replaceText(starttimeInput, starttime);</span>
<a href="#l31.182"></a><span id="l31.182" class="difflineminus">-    sleep();</span>
<a href="#l31.183"></a><span id="l31.183" class="difflineplus">+    await sleep(iframe.window);</span>
<a href="#l31.184"></a><span id="l31.184">   }</span>
<a href="#l31.185"></a><span id="l31.185"> </span>
<a href="#l31.186"></a><span id="l31.186">   // enddate</span>
<a href="#l31.187"></a><span id="l31.187" class="difflineminus">-  if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.188"></a><span id="l31.188" class="difflineplus">+  if (data.enddate !== undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.189"></a><span id="l31.189">     let enddate = dateFormatter.formatDateShort(</span>
<a href="#l31.190"></a><span id="l31.190">       cal.dtz.jsDateToDateTime(data.enddate, cal.dtz.floating)</span>
<a href="#l31.191"></a><span id="l31.191">     );</span>
<a href="#l31.192"></a><span id="l31.192">     if (!isEvent) {</span>
<a href="#l31.193"></a><span id="l31.193">       dialog.check(iframeid(&quot;todo-has-duedate&quot;), true);</span>
<a href="#l31.194"></a><span id="l31.194">     }</span>
<a href="#l31.195"></a><span id="l31.195">     replaceText(enddateInput, enddate);</span>
<a href="#l31.196"></a><span id="l31.196">   }</span>
<a href="#l31.197"></a><span id="l31.197"> </span>
<a href="#l31.198"></a><span id="l31.198">   // endtime</span>
<a href="#l31.199"></a><span id="l31.199" class="difflineminus">-  if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.200"></a><span id="l31.200" class="difflineplus">+  if (data.endtime !== undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.201"></a><span id="l31.201">     let endtime = dateFormatter.formatTime(</span>
<a href="#l31.202"></a><span id="l31.202">       cal.dtz.jsDateToDateTime(data.endtime, cal.dtz.floating)</span>
<a href="#l31.203"></a><span id="l31.203">     );</span>
<a href="#l31.204"></a><span id="l31.204">     replaceText(endtimeInput, endtime);</span>
<a href="#l31.205"></a><span id="l31.205">   }</span>
<a href="#l31.206"></a><span id="l31.206"> </span>
<a href="#l31.207"></a><span id="l31.207">   // recurrence</span>
<a href="#l31.208"></a><span id="l31.208" class="difflineminus">-  if (data.repeat != undefined) {</span>
<a href="#l31.209"></a><span id="l31.209" class="difflineplus">+  if (data.repeat !== undefined) {</span>
<a href="#l31.210"></a><span id="l31.210">     menulistSelect(iframeid(&quot;item-repeat&quot;), data.repeat, dialog);</span>
<a href="#l31.211"></a><span id="l31.211">   }</span>
<a href="#l31.212"></a><span id="l31.212" class="difflineminus">-  if (data.repeatuntil != undefined &amp;&amp; data.repeatuntil.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.213"></a><span id="l31.213" class="difflineplus">+  if (data.repeatuntil !== undefined &amp;&amp; data.repeatuntil.constructor.name == &quot;Date&quot;) {</span>
<a href="#l31.214"></a><span id="l31.214">     // Only fill in date, when the Datepicker is visible.</span>
<a href="#l31.215"></a><span id="l31.215">     if (iframeid(&quot;repeat-deck&quot;).getNode().selectedIndex == 0) {</span>
<a href="#l31.216"></a><span id="l31.216">       let untildate = dateFormatter.formatDateShort(</span>
<a href="#l31.217"></a><span id="l31.217">         cal.dtz.jsDateToDateTime(data.repeatuntil, cal.dtz.floating)</span>
<a href="#l31.218"></a><span id="l31.218">       );</span>
<a href="#l31.219"></a><span id="l31.219">       replaceText(untilDateInput, untildate);</span>
<a href="#l31.220"></a><span id="l31.220">     }</span>
<a href="#l31.221"></a><span id="l31.221">   }</span>
<a href="#l31.222"></a><span id="l31.222"> </span>
<a href="#l31.223"></a><span id="l31.223">   // reminder</span>
<a href="#l31.224"></a><span id="l31.224" class="difflineminus">-  if (data.reminder != undefined) {</span>
<a href="#l31.225"></a><span id="l31.225" class="difflineminus">-    setReminderMenulist(dialog, iframeid(&quot;item-alarm&quot;).getNode(), data.reminder);</span>
<a href="#l31.226"></a><span id="l31.226" class="difflineplus">+  if (data.reminder !== undefined) {</span>
<a href="#l31.227"></a><span id="l31.227" class="difflineplus">+    await setReminderMenulist(iframe.window, data.reminder);</span>
<a href="#l31.228"></a><span id="l31.228">   }</span>
<a href="#l31.229"></a><span id="l31.229"> </span>
<a href="#l31.230"></a><span id="l31.230">   // priority</span>
<a href="#l31.231"></a><span id="l31.231" class="difflineminus">-  if (data.priority != undefined) {</span>
<a href="#l31.232"></a><span id="l31.232" class="difflineplus">+  if (data.priority !== undefined) {</span>
<a href="#l31.233"></a><span id="l31.233">     dialog.mainMenu.click(`#options-priority-${data.priority}-label`);</span>
<a href="#l31.234"></a><span id="l31.234">   }</span>
<a href="#l31.235"></a><span id="l31.235"> </span>
<a href="#l31.236"></a><span id="l31.236">   // privacy</span>
<a href="#l31.237"></a><span id="l31.237" class="difflineminus">-  if (data.privacy != undefined) {</span>
<a href="#l31.238"></a><span id="l31.238" class="difflineplus">+  if (data.privacy !== undefined) {</span>
<a href="#l31.239"></a><span id="l31.239">     dialog.click(eid(&quot;button-privacy&quot;));</span>
<a href="#l31.240"></a><span id="l31.240">     dialog.click(eid(`event-privacy-${data.privacy}-menuitem`));</span>
<a href="#l31.241"></a><span id="l31.241">     dialog.click(eid(&quot;button-privacy&quot;));</span>
<a href="#l31.242"></a><span id="l31.242" class="difflineminus">-    sleep();</span>
<a href="#l31.243"></a><span id="l31.243" class="difflineplus">+    await sleep(iframe.window);</span>
<a href="#l31.244"></a><span id="l31.244">   }</span>
<a href="#l31.245"></a><span id="l31.245"> </span>
<a href="#l31.246"></a><span id="l31.246">   // status</span>
<a href="#l31.247"></a><span id="l31.247" class="difflineminus">-  if (data.status != undefined) {</span>
<a href="#l31.248"></a><span id="l31.248" class="difflineplus">+  if (data.status !== undefined) {</span>
<a href="#l31.249"></a><span id="l31.249">     if (isEvent) {</span>
<a href="#l31.250"></a><span id="l31.250">       dialog.mainMenu.click(`#options-status-${data.status}-menuitem`);</span>
<a href="#l31.251"></a><span id="l31.251">     } else {</span>
<a href="#l31.252"></a><span id="l31.252">       menulistSelect(iframeid(&quot;todo-status&quot;), data.status.toUpperCase(), dialog);</span>
<a href="#l31.253"></a><span id="l31.253">     }</span>
<a href="#l31.254"></a><span id="l31.254">   }</span>
<a href="#l31.255"></a><span id="l31.255"> </span>
<a href="#l31.256"></a><span id="l31.256">   let currentStatus = iframeid(&quot;todo-status&quot;).getNode().value;</span>
<a href="#l31.257"></a><span id="l31.257"> </span>
<a href="#l31.258"></a><span id="l31.258">   // completed on</span>
<a href="#l31.259"></a><span id="l31.259" class="difflineminus">-  if (data.completed != undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l31.260"></a><span id="l31.260" class="difflineplus">+  if (data.completed !== undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l31.261"></a><span id="l31.261">     let completeddate = dateFormatter.formatDateShort(</span>
<a href="#l31.262"></a><span id="l31.262">       cal.dtz.jsDateToDateTime(data.completed, cal.dtz.floating)</span>
<a href="#l31.263"></a><span id="l31.263">     );</span>
<a href="#l31.264"></a><span id="l31.264">     if (currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l31.265"></a><span id="l31.265">       replaceText(completeddateInput, completeddate);</span>
<a href="#l31.266"></a><span id="l31.266">     }</span>
<a href="#l31.267"></a><span id="l31.267">   }</span>
<a href="#l31.268"></a><span id="l31.268"> </span>
<a href="#l31.269"></a><span id="l31.269">   // percent complete</span>
<a href="#l31.270"></a><span id="l31.270">   if (</span>
<a href="#l31.271"></a><span id="l31.271" class="difflineminus">-    data.percent != undefined &amp;&amp;</span>
<a href="#l31.272"></a><span id="l31.272" class="difflineplus">+    data.percent !== undefined &amp;&amp;</span>
<a href="#l31.273"></a><span id="l31.273">     (currentStatus == &quot;NEEDS-ACTION&quot; ||</span>
<a href="#l31.274"></a><span id="l31.274">       currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l31.275"></a><span id="l31.275">       currentStatus == &quot;COMPLETED&quot;)</span>
<a href="#l31.276"></a><span id="l31.276">   ) {</span>
<a href="#l31.277"></a><span id="l31.277">     replaceText(percentCompleteInput, data.percent);</span>
<a href="#l31.278"></a><span id="l31.278">   }</span>
<a href="#l31.279"></a><span id="l31.279"> </span>
<a href="#l31.280"></a><span id="l31.280">   // free/busy</span>
<a href="#l31.281"></a><span id="l31.281" class="difflineminus">-  if (data.freebusy != undefined) {</span>
<a href="#l31.282"></a><span id="l31.282" class="difflineplus">+  if (data.freebusy !== undefined) {</span>
<a href="#l31.283"></a><span id="l31.283">     dialog.mainMenu.click(`#options-freebusy-${data.freebusy}-menuitem`);</span>
<a href="#l31.284"></a><span id="l31.284">   }</span>
<a href="#l31.285"></a><span id="l31.285"> </span>
<a href="#l31.286"></a><span id="l31.286">   // description</span>
<a href="#l31.287"></a><span id="l31.287" class="difflineminus">-  if (data.description != undefined) {</span>
<a href="#l31.288"></a><span id="l31.288" class="difflineplus">+  if (data.description !== undefined) {</span>
<a href="#l31.289"></a><span id="l31.289">     dialog.click(iframeid(&quot;event-grid-tab-description&quot;));</span>
<a href="#l31.290"></a><span id="l31.290">     let descField = iframeLookup(DESCRIPTION_TEXTBOX);</span>
<a href="#l31.291"></a><span id="l31.291">     replaceText(descField, data.description);</span>
<a href="#l31.292"></a><span id="l31.292">   }</span>
<a href="#l31.293"></a><span id="l31.293"> </span>
<a href="#l31.294"></a><span id="l31.294">   // attachment</span>
<a href="#l31.295"></a><span id="l31.295" class="difflineminus">-  if (data.attachment != undefined) {</span>
<a href="#l31.296"></a><span id="l31.296" class="difflineminus">-    if (data.attachment.add != undefined) {</span>
<a href="#l31.297"></a><span id="l31.297" class="difflineminus">-      handleAddingAttachment(dialog, data.attachment.add);</span>
<a href="#l31.298"></a><span id="l31.298" class="difflineplus">+  if (data.attachment !== undefined) {</span>
<a href="#l31.299"></a><span id="l31.299" class="difflineplus">+    if (data.attachment.add !== undefined) {</span>
<a href="#l31.300"></a><span id="l31.300" class="difflineplus">+      await handleAddingAttachment(dialog.window, data.attachment.add);</span>
<a href="#l31.301"></a><span id="l31.301">     }</span>
<a href="#l31.302"></a><span id="l31.302" class="difflineminus">-    if (data.attachment.remove != undefined) {</span>
<a href="#l31.303"></a><span id="l31.303" class="difflineplus">+    if (data.attachment.remove !== undefined) {</span>
<a href="#l31.304"></a><span id="l31.304">       dialog.click(iframeid(&quot;event-grid-tab-attachments&quot;));</span>
<a href="#l31.305"></a><span id="l31.305">       let attachmentBox = iframeid(&quot;attachment-link&quot;);</span>
<a href="#l31.306"></a><span id="l31.306">       let attachments = attachmentBox.getNode().children;</span>
<a href="#l31.307"></a><span id="l31.307">       for (let attachment of attachments) {</span>
<a href="#l31.308"></a><span id="l31.308">         if (attachment.tooltipText.includes(data.attachment.remove)) {</span>
<a href="#l31.309"></a><span id="l31.309">           dialog.click(new elementslib.Elem(attachment));</span>
<a href="#l31.310"></a><span id="l31.310">           dialog.keypress(attachmentBox, &quot;VK_DELETE&quot;, {});</span>
<a href="#l31.311"></a><span id="l31.311">         }</span>
<a href="#l31.312"></a><span id="l31.312">       }</span>
<a href="#l31.313"></a><span id="l31.313">     }</span>
<a href="#l31.314"></a><span id="l31.314">   }</span>
<a href="#l31.315"></a><span id="l31.315"> </span>
<a href="#l31.316"></a><span id="l31.316">   // attendees</span>
<a href="#l31.317"></a><span id="l31.317" class="difflineminus">-  if (data.attendees != undefined) {</span>
<a href="#l31.318"></a><span id="l31.318" class="difflineplus">+  if (data.attendees !== undefined) {</span>
<a href="#l31.319"></a><span id="l31.319">     // Display attendees Tab.</span>
<a href="#l31.320"></a><span id="l31.320">     dialog.click(iframeid(&quot;event-grid-tab-attendees&quot;));</span>
<a href="#l31.321"></a><span id="l31.321">     // Make sure no notifications are sent, since handling this dialog is</span>
<a href="#l31.322"></a><span id="l31.322">     // not working when deleting a parent of a recurring event.</span>
<a href="#l31.323"></a><span id="l31.323">     let attendeeCheckbox = iframeid(&quot;notify-attendees-checkbox&quot;);</span>
<a href="#l31.324"></a><span id="l31.324">     if (!attendeeCheckbox.getNode().disabled) {</span>
<a href="#l31.325"></a><span id="l31.325">       dialog.check(attendeeCheckbox, false);</span>
<a href="#l31.326"></a><span id="l31.326">     }</span>
<a href="#l31.327"></a><span id="l31.327"> </span>
<a href="#l31.328"></a><span id="l31.328">     // add</span>
<a href="#l31.329"></a><span id="l31.329" class="difflineminus">-    if (data.attendees.add != undefined) {</span>
<a href="#l31.330"></a><span id="l31.330" class="difflineminus">-      addAttendees(dialog, iframe, data.attendees.add);</span>
<a href="#l31.331"></a><span id="l31.331" class="difflineplus">+    if (data.attendees.add !== undefined) {</span>
<a href="#l31.332"></a><span id="l31.332" class="difflineplus">+      await addAttendees(dialog.window, iframe.window, data.attendees.add);</span>
<a href="#l31.333"></a><span id="l31.333">     }</span>
<a href="#l31.334"></a><span id="l31.334">     // delete</span>
<a href="#l31.335"></a><span id="l31.335" class="difflineminus">-    if (data.attendees.remove != undefined) {</span>
<a href="#l31.336"></a><span id="l31.336" class="difflineminus">-      deleteAttendees(dialog, iframe, data.attendees.remove);</span>
<a href="#l31.337"></a><span id="l31.337" class="difflineplus">+    if (data.attendees.remove !== undefined) {</span>
<a href="#l31.338"></a><span id="l31.338" class="difflineplus">+      await deleteAttendees(iframe.window, data.attendees.remove);</span>
<a href="#l31.339"></a><span id="l31.339">     }</span>
<a href="#l31.340"></a><span id="l31.340">   }</span>
<a href="#l31.341"></a><span id="l31.341"> </span>
<a href="#l31.342"></a><span id="l31.342" class="difflineminus">-  sleep(SHORT_SLEEP);</span>
<a href="#l31.343"></a><span id="l31.343" class="difflineplus">+  await sleep(iframe.window);</span>
<a href="#l31.344"></a><span id="l31.344"> }</span>
<a href="#l31.345"></a><span id="l31.345"> </span>
<a href="#l31.346"></a><span id="l31.346"> /**</span>
<a href="#l31.347"></a><span id="l31.347">  * Select an item in the reminder menulist.</span>
<a href="#l31.348"></a><span id="l31.348">  * Custom reminders are not supported.</span>
<a href="#l31.349"></a><span id="l31.349">  *</span>
<a href="#l31.350"></a><span id="l31.350" class="difflineminus">- * @param controller      Mozmill controller of item-Iframe:</span>
<a href="#l31.351"></a><span id="l31.351" class="difflineminus">- * @param menulist        The reminder menulist node.</span>
<a href="#l31.352"></a><span id="l31.352" class="difflineplus">+ * @param iframeWindow    The event dialog iframe.</span>
<a href="#l31.353"></a><span id="l31.353">  * @param id              Identifying string of menuitem id.</span>
<a href="#l31.354"></a><span id="l31.354">  */</span>
<a href="#l31.355"></a><span id="l31.355" class="difflineminus">-function setReminderMenulist(controller, menulist, id) {</span>
<a href="#l31.356"></a><span id="l31.356" class="difflineminus">-  let { eid } = helpersForController(controller);</span>
<a href="#l31.357"></a><span id="l31.357" class="difflineplus">+async function setReminderMenulist(iframeWindow, id) {</span>
<a href="#l31.358"></a><span id="l31.358" class="difflineplus">+  let iframeDocument = iframeWindow.document;</span>
<a href="#l31.359"></a><span id="l31.359" class="difflineplus">+  let menulist = iframeDocument.getElementById(&quot;item-alarm&quot;);</span>
<a href="#l31.360"></a><span id="l31.360" class="difflineplus">+  let menuitem = iframeDocument.getElementById(`reminder-${id}-menuitem`);</span>
<a href="#l31.361"></a><span id="l31.361"> </span>
<a href="#l31.362"></a><span id="l31.362" class="difflineminus">-  let menuitem = eid(`reminder-${id}-menuitem`);</span>
<a href="#l31.363"></a><span id="l31.363" class="difflineminus">-  menulist.click();</span>
<a href="#l31.364"></a><span id="l31.364" class="difflineminus">-  controller.click(menuitem);</span>
<a href="#l31.365"></a><span id="l31.365" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l31.366"></a><span id="l31.366" class="difflineminus">-    return menulist.selectedItem.id == `reminder-${id}-menuitem`;</span>
<a href="#l31.367"></a><span id="l31.367" class="difflineminus">-  });</span>
<a href="#l31.368"></a><span id="l31.368" class="difflineplus">+  synthesizeMouseAtCenter(menulist, {}, iframeWindow);</span>
<a href="#l31.369"></a><span id="l31.369" class="difflineplus">+  await BrowserTestUtils.waitForEvent(menulist, &quot;popupshown&quot;);</span>
<a href="#l31.370"></a><span id="l31.370" class="difflineplus">+  synthesizeMouseAtCenter(menuitem, {}, iframeWindow);</span>
<a href="#l31.371"></a><span id="l31.371" class="difflineplus">+  await BrowserTestUtils.waitForEvent(menulist, &quot;popuphidden&quot;);</span>
<a href="#l31.372"></a><span id="l31.372" class="difflineplus">+  await sleep(iframeWindow);</span>
<a href="#l31.373"></a><span id="l31.373"> }</span>
<a href="#l31.374"></a><span id="l31.374"> </span>
<a href="#l31.375"></a><span id="l31.375"> /**</span>
<a href="#l31.376"></a><span id="l31.376">  * Set the categories in the event-dialog menulist-panel.</span>
<a href="#l31.377"></a><span id="l31.377">  *</span>
<a href="#l31.378"></a><span id="l31.378" class="difflineminus">- * @param dialog      Mozmill controller of event-dialog.</span>
<a href="#l31.379"></a><span id="l31.379" class="difflineminus">- * @param iframe      Controller of the iframe of the dialog.</span>
<a href="#l31.380"></a><span id="l31.380" class="difflineminus">- * @param index       Array containing the categories as strings - leave empty to clear.</span>
<a href="#l31.381"></a><span id="l31.381" class="difflineplus">+ * @param iframeWindow    The event dialog iframe.</span>
<a href="#l31.382"></a><span id="l31.382" class="difflineplus">+ * @param categories      Array containing the categories as strings - leave empty to clear.</span>
<a href="#l31.383"></a><span id="l31.383">  */</span>
<a href="#l31.384"></a><span id="l31.384" class="difflineminus">-function setCategories(dialog, iframe, categories) {</span>
<a href="#l31.385"></a><span id="l31.385" class="difflineminus">-  let { eid: iframeid } = helpersForController(iframe);</span>
<a href="#l31.386"></a><span id="l31.386" class="difflineminus">-  let { iframeLookup } = helpersForEditUI(iframe);</span>
<a href="#l31.387"></a><span id="l31.387" class="difflineminus">-  let categoryMenulist = iframeid(&quot;item-categories&quot;);</span>
<a href="#l31.388"></a><span id="l31.388" class="difflineminus">-  let categoryList = iframeLookup(CATEGORY_LIST);</span>
<a href="#l31.389"></a><span id="l31.389" class="difflineminus">-  dialog.click(categoryMenulist);</span>
<a href="#l31.390"></a><span id="l31.390" class="difflineminus">-  dialog.waitFor(() =&gt; categoryMenulist.getNode().open);</span>
<a href="#l31.391"></a><span id="l31.391" class="difflineminus">-  if (categoryMenulist.itemCount &gt; -1 &amp;&amp; categoryMenulist.itemCount &lt; categories.length) {</span>
<a href="#l31.392"></a><span id="l31.392" class="difflineminus">-    mark_failure([&quot;more categories than supported by current calendar&quot;]);</span>
<a href="#l31.393"></a><span id="l31.393" class="difflineminus">-  } else {</span>
<a href="#l31.394"></a><span id="l31.394" class="difflineminus">-    // Iterate over categories and check if needed.</span>
<a href="#l31.395"></a><span id="l31.395" class="difflineminus">-    let listItems = categoryList.getNode().children;</span>
<a href="#l31.396"></a><span id="l31.396" class="difflineminus">-    for (let item of listItems) {</span>
<a href="#l31.397"></a><span id="l31.397" class="difflineminus">-      let set = false;</span>
<a href="#l31.398"></a><span id="l31.398" class="difflineminus">-      if (categories.includes(item.label)) {</span>
<a href="#l31.399"></a><span id="l31.399" class="difflineminus">-        set = true;</span>
<a href="#l31.400"></a><span id="l31.400" class="difflineminus">-      }</span>
<a href="#l31.401"></a><span id="l31.401" class="difflineminus">-      if (set &amp;&amp; !item.getAttribute(&quot;checked&quot;)) {</span>
<a href="#l31.402"></a><span id="l31.402" class="difflineminus">-        item.setAttribute(&quot;checked&quot;, true);</span>
<a href="#l31.403"></a><span id="l31.403" class="difflineminus">-      } else if (!set &amp;&amp; item.getAttribute(&quot;checked&quot;)) {</span>
<a href="#l31.404"></a><span id="l31.404" class="difflineminus">-        item.removeAttribute(&quot;checked&quot;);</span>
<a href="#l31.405"></a><span id="l31.405" class="difflineminus">-      }</span>
<a href="#l31.406"></a><span id="l31.406" class="difflineplus">+async function setCategories(iframeWindow, categories) {</span>
<a href="#l31.407"></a><span id="l31.407" class="difflineplus">+  let iframeDocument = iframeWindow.document;</span>
<a href="#l31.408"></a><span id="l31.408" class="difflineplus">+  let menulist = iframeDocument.getElementById(&quot;item-categories&quot;);</span>
<a href="#l31.409"></a><span id="l31.409" class="difflineplus">+  let menupopup = iframeDocument.getElementById(&quot;item-categories-popup&quot;);</span>
<a href="#l31.410"></a><span id="l31.410" class="difflineplus">+</span>
<a href="#l31.411"></a><span id="l31.411" class="difflineplus">+  synthesizeMouseAtCenter(menulist, {}, iframeWindow);</span>
<a href="#l31.412"></a><span id="l31.412" class="difflineplus">+  await BrowserTestUtils.waitForEvent(menupopup, &quot;popupshown&quot;);</span>
<a href="#l31.413"></a><span id="l31.413" class="difflineplus">+</span>
<a href="#l31.414"></a><span id="l31.414" class="difflineplus">+  // Iterate over categories and check if needed.</span>
<a href="#l31.415"></a><span id="l31.415" class="difflineplus">+  for (let item of menupopup.children) {</span>
<a href="#l31.416"></a><span id="l31.416" class="difflineplus">+    if (categories.includes(item.label)) {</span>
<a href="#l31.417"></a><span id="l31.417" class="difflineplus">+      item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l31.418"></a><span id="l31.418" class="difflineplus">+    } else {</span>
<a href="#l31.419"></a><span id="l31.419" class="difflineplus">+      item.removeAttribute(&quot;checked&quot;);</span>
<a href="#l31.420"></a><span id="l31.420">     }</span>
<a href="#l31.421"></a><span id="l31.421">   }</span>
<a href="#l31.422"></a><span id="l31.422" class="difflineminus">-  categoryList.getNode().hidePopup();</span>
<a href="#l31.423"></a><span id="l31.423" class="difflineminus">-  dialog.click(iframeid(&quot;item-title&quot;));</span>
<a href="#l31.424"></a><span id="l31.424" class="difflineminus">-  dialog.sleep();</span>
<a href="#l31.425"></a><span id="l31.425" class="difflineplus">+</span>
<a href="#l31.426"></a><span id="l31.426" class="difflineplus">+  let hiddenPromise = BrowserTestUtils.waitForEvent(menupopup, &quot;popuphidden&quot;);</span>
<a href="#l31.427"></a><span id="l31.427" class="difflineplus">+  menupopup.hidePopup();</span>
<a href="#l31.428"></a><span id="l31.428" class="difflineplus">+  await hiddenPromise;</span>
<a href="#l31.429"></a><span id="l31.429"> }</span>
<a href="#l31.430"></a><span id="l31.430"> </span>
<a href="#l31.431"></a><span id="l31.431"> /**</span>
<a href="#l31.432"></a><span id="l31.432">  * Add an URL attachment.</span>
<a href="#l31.433"></a><span id="l31.433">  *</span>
<a href="#l31.434"></a><span id="l31.434" class="difflineminus">- * @param controller        Mozmill window controller</span>
<a href="#l31.435"></a><span id="l31.435" class="difflineminus">- * @param url               URL to be added</span>
<a href="#l31.436"></a><span id="l31.436" class="difflineplus">+ * @param dialogWindow    The event dialog.</span>
<a href="#l31.437"></a><span id="l31.437" class="difflineplus">+ * @param url             URL to be added</span>
<a href="#l31.438"></a><span id="l31.438">  */</span>
<a href="#l31.439"></a><span id="l31.439" class="difflineminus">-function handleAddingAttachment(controller, url) {</span>
<a href="#l31.440"></a><span id="l31.440" class="difflineminus">-  let { eid } = helpersForController(controller);</span>
<a href="#l31.441"></a><span id="l31.441" class="difflineminus">-  plan_for_modal_dialog(&quot;commonDialog&quot;, attachment =&gt; {</span>
<a href="#l31.442"></a><span id="l31.442" class="difflineminus">-    let { lookup: cdlglookup, eid: cdlgid } = helpersForController(attachment);</span>
<a href="#l31.443"></a><span id="l31.443" class="difflineminus">-    attachment.waitForElement(cdlgid(&quot;loginTextbox&quot;));</span>
<a href="#l31.444"></a><span id="l31.444" class="difflineminus">-    cdlgid(&quot;loginTextbox&quot;).getNode().value = url;</span>
<a href="#l31.445"></a><span id="l31.445" class="difflineminus">-    attachment.click(</span>
<a href="#l31.446"></a><span id="l31.446" class="difflineminus">-      cdlglookup(`</span>
<a href="#l31.447"></a><span id="l31.447" class="difflineminus">-            /id(&quot;commonDialog&quot;)/shadow/{&quot;class&quot;:&quot;dialog-button-box&quot;}/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l31.448"></a><span id="l31.448" class="difflineminus">-        `)</span>
<a href="#l31.449"></a><span id="l31.449" class="difflineplus">+async function handleAddingAttachment(dialogWindow, url) {</span>
<a href="#l31.450"></a><span id="l31.450" class="difflineplus">+  let dialogDocument = dialogWindow.document;</span>
<a href="#l31.451"></a><span id="l31.451" class="difflineplus">+</span>
<a href="#l31.452"></a><span id="l31.452" class="difflineplus">+  synthesizeMouseAtCenter(dialogDocument.getElementById(&quot;button-url&quot;), {}, dialogWindow);</span>
<a href="#l31.453"></a><span id="l31.453" class="difflineplus">+  await BrowserTestUtils.promiseAlertDialog(undefined, undefined, attachmentWindow =&gt; {</span>
<a href="#l31.454"></a><span id="l31.454" class="difflineplus">+    let attachmentDocument = attachmentWindow.document;</span>
<a href="#l31.455"></a><span id="l31.455" class="difflineplus">+</span>
<a href="#l31.456"></a><span id="l31.456" class="difflineplus">+    attachmentDocument.getElementById(&quot;loginTextbox&quot;).value = url;</span>
<a href="#l31.457"></a><span id="l31.457" class="difflineplus">+    synthesizeMouseAtCenter(</span>
<a href="#l31.458"></a><span id="l31.458" class="difflineplus">+      attachmentDocument.documentElement.getButton(&quot;accept&quot;),</span>
<a href="#l31.459"></a><span id="l31.459" class="difflineplus">+      {},</span>
<a href="#l31.460"></a><span id="l31.460" class="difflineplus">+      attachmentWindow</span>
<a href="#l31.461"></a><span id="l31.461">     );</span>
<a href="#l31.462"></a><span id="l31.462">   });</span>
<a href="#l31.463"></a><span id="l31.463" class="difflineminus">-  controller.click(eid(&quot;button-url&quot;));</span>
<a href="#l31.464"></a><span id="l31.464" class="difflineminus">-</span>
<a href="#l31.465"></a><span id="l31.465" class="difflineminus">-  wait_for_modal_dialog(&quot;commonDialog&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l31.466"></a><span id="l31.466" class="difflineplus">+  await sleep(dialogWindow);</span>
<a href="#l31.467"></a><span id="l31.467"> }</span>
<a href="#l31.468"></a><span id="l31.468"> </span>
<a href="#l31.469"></a><span id="l31.469"> /**</span>
<a href="#l31.470"></a><span id="l31.470">  * Add attendees to the event.</span>
<a href="#l31.471"></a><span id="l31.471">  *</span>
<a href="#l31.472"></a><span id="l31.472" class="difflineminus">- * @param dialog            The controller of the Edit Dialog.</span>
<a href="#l31.473"></a><span id="l31.473" class="difflineminus">- * @param innerFrame        The controller of the item iframe.</span>
<a href="#l31.474"></a><span id="l31.474" class="difflineplus">+ * @param dialogWindow      The event dialog.</span>
<a href="#l31.475"></a><span id="l31.475" class="difflineplus">+ * @param iframeWindow      The event dialog iframe.</span>
<a href="#l31.476"></a><span id="l31.476">  * @param attendeesString   Comma separated list of eMail-Addresses to add.</span>
<a href="#l31.477"></a><span id="l31.477">  */</span>
<a href="#l31.478"></a><span id="l31.478" class="difflineminus">-function addAttendees(dialog, innerFrame, attendeesString) {</span>
<a href="#l31.479"></a><span id="l31.479" class="difflineminus">-  let { eid: dlgid } = helpersForController(dialog);</span>
<a href="#l31.480"></a><span id="l31.480" class="difflineplus">+async function addAttendees(dialogWindow, iframeWindow, attendeesString) {</span>
<a href="#l31.481"></a><span id="l31.481" class="difflineplus">+  let dialogDocument = dialogWindow.document;</span>
<a href="#l31.482"></a><span id="l31.482"> </span>
<a href="#l31.483"></a><span id="l31.483">   let attendees = attendeesString.split(&quot;,&quot;);</span>
<a href="#l31.484"></a><span id="l31.484">   for (let attendee of attendees) {</span>
<a href="#l31.485"></a><span id="l31.485" class="difflineminus">-    let calAttendee = innerFrame.window.attendees.find(aAtt =&gt; aAtt.id == `mailto:${attendee}`);</span>
<a href="#l31.486"></a><span id="l31.486" class="difflineplus">+    let calAttendee = iframeWindow.attendees.find(aAtt =&gt; aAtt.id == `mailto:${attendee}`);</span>
<a href="#l31.487"></a><span id="l31.487">     // Only add if not already present.</span>
<a href="#l31.488"></a><span id="l31.488">     if (!calAttendee) {</span>
<a href="#l31.489"></a><span id="l31.489" class="difflineminus">-      plan_for_modal_dialog(&quot;Calendar:EventDialog:Attendees&quot;, attDialog =&gt; {</span>
<a href="#l31.490"></a><span id="l31.490" class="difflineminus">-        let { lookup: attlookup, eid: attid } = helpersForController(attDialog);</span>
<a href="#l31.491"></a><span id="l31.491" class="difflineplus">+      synthesizeMouseAtCenter(dialogDocument.getElementById(&quot;button-attendees&quot;), {}, dialogWindow);</span>
<a href="#l31.492"></a><span id="l31.492" class="difflineplus">+      await BrowserTestUtils.promiseAlertDialog(</span>
<a href="#l31.493"></a><span id="l31.493" class="difflineplus">+        undefined,</span>
<a href="#l31.494"></a><span id="l31.494" class="difflineplus">+        &quot;chrome://calendar/content/calendar-event-dialog-attendees.xul&quot;,</span>
<a href="#l31.495"></a><span id="l31.495" class="difflineplus">+        async attendeesWindow =&gt; {</span>
<a href="#l31.496"></a><span id="l31.496" class="difflineplus">+          await sleep(attendeesWindow);</span>
<a href="#l31.497"></a><span id="l31.497" class="difflineplus">+          let attendeesDocument = attendeesWindow.document;</span>
<a href="#l31.498"></a><span id="l31.498"> </span>
<a href="#l31.499"></a><span id="l31.499" class="difflineminus">-        let input = attid(&quot;attendees-list&quot;);</span>
<a href="#l31.500"></a><span id="l31.500" class="difflineminus">-        // As starting point is always the last entered Attendee, we have</span>
<a href="#l31.501"></a><span id="l31.501" class="difflineminus">-        // to advance to not overwrite it.</span>
<a href="#l31.502"></a><span id="l31.502" class="difflineminus">-        attDialog.waitFor(</span>
<a href="#l31.503"></a><span id="l31.503" class="difflineminus">-          () =&gt; attDialog.window.document.activeElement.getAttribute(&quot;is&quot;) == &quot;autocomplete-input&quot;</span>
<a href="#l31.504"></a><span id="l31.504" class="difflineminus">-        );</span>
<a href="#l31.505"></a><span id="l31.505" class="difflineminus">-        attDialog.keypress(input, &quot;VK_TAB&quot;, {});</span>
<a href="#l31.506"></a><span id="l31.506" class="difflineminus">-        attDialog.waitFor(</span>
<a href="#l31.507"></a><span id="l31.507" class="difflineminus">-          () =&gt;</span>
<a href="#l31.508"></a><span id="l31.508" class="difflineminus">-            attDialog.window.document.activeElement.getAttribute(&quot;is&quot;) == &quot;autocomplete-input&quot; &amp;&amp;</span>
<a href="#l31.509"></a><span id="l31.509" class="difflineminus">-            attDialog.window.document.activeElement.getAttribute(&quot;value&quot;) == null</span>
<a href="#l31.510"></a><span id="l31.510" class="difflineminus">-        );</span>
<a href="#l31.511"></a><span id="l31.511" class="difflineminus">-        attDialog.type(input, attendee);</span>
<a href="#l31.512"></a><span id="l31.512" class="difflineminus">-        attDialog.click(</span>
<a href="#l31.513"></a><span id="l31.513" class="difflineminus">-          attlookup(`</span>
<a href="#l31.514"></a><span id="l31.514" class="difflineminus">-                    /id(&quot;calendar-event-dialog-attendees-v2&quot;)/shadow/</span>
<a href="#l31.515"></a><span id="l31.515" class="difflineminus">-                    {&quot;class&quot;:&quot;dialog-button-box&quot;}/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l31.516"></a><span id="l31.516" class="difflineminus">-                `)</span>
<a href="#l31.517"></a><span id="l31.517" class="difflineminus">-        );</span>
<a href="#l31.518"></a><span id="l31.518" class="difflineminus">-      });</span>
<a href="#l31.519"></a><span id="l31.519" class="difflineminus">-      dialog.click(dlgid(&quot;button-attendees&quot;));</span>
<a href="#l31.520"></a><span id="l31.520" class="difflineminus">-      wait_for_modal_dialog(&quot;Calendar:EventDialog:Attendees&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l31.521"></a><span id="l31.521" class="difflineplus">+          // As starting point is always the last entered Attendee, we have</span>
<a href="#l31.522"></a><span id="l31.522" class="difflineplus">+          // to advance to not overwrite it.</span>
<a href="#l31.523"></a><span id="l31.523" class="difflineplus">+          await sleep(attendeesWindow);</span>
<a href="#l31.524"></a><span id="l31.524" class="difflineplus">+          Assert.equal(attendeesDocument.activeElement.getAttribute(&quot;is&quot;), &quot;autocomplete-input&quot;);</span>
<a href="#l31.525"></a><span id="l31.525" class="difflineplus">+          synthesizeKey(&quot;VK_TAB&quot;, {}, attendeesWindow);</span>
<a href="#l31.526"></a><span id="l31.526" class="difflineplus">+          Assert.equal(attendeesDocument.activeElement.getAttribute(&quot;is&quot;), &quot;autocomplete-input&quot;);</span>
<a href="#l31.527"></a><span id="l31.527" class="difflineplus">+          Assert.equal(attendeesDocument.activeElement.getAttribute(&quot;value&quot;), null);</span>
<a href="#l31.528"></a><span id="l31.528" class="difflineplus">+          sendString(attendee, attendeesWindow);</span>
<a href="#l31.529"></a><span id="l31.529" class="difflineplus">+          synthesizeMouseAtCenter(</span>
<a href="#l31.530"></a><span id="l31.530" class="difflineplus">+            attendeesDocument.documentElement.getButton(&quot;accept&quot;),</span>
<a href="#l31.531"></a><span id="l31.531" class="difflineplus">+            {},</span>
<a href="#l31.532"></a><span id="l31.532" class="difflineplus">+            attendeesWindow</span>
<a href="#l31.533"></a><span id="l31.533" class="difflineplus">+          );</span>
<a href="#l31.534"></a><span id="l31.534" class="difflineplus">+        }</span>
<a href="#l31.535"></a><span id="l31.535" class="difflineplus">+      );</span>
<a href="#l31.536"></a><span id="l31.536" class="difflineplus">+      await sleep(iframeWindow);</span>
<a href="#l31.537"></a><span id="l31.537">     }</span>
<a href="#l31.538"></a><span id="l31.538">   }</span>
<a href="#l31.539"></a><span id="l31.539"> }</span>
<a href="#l31.540"></a><span id="l31.540"> </span>
<a href="#l31.541"></a><span id="l31.541"> /**</span>
<a href="#l31.542"></a><span id="l31.542">  * Delete attendees from the event.</span>
<a href="#l31.543"></a><span id="l31.543">  *</span>
<a href="#l31.544"></a><span id="l31.544" class="difflineminus">- * @param dialog            The controller of the Edit Dialog.</span>
<a href="#l31.545"></a><span id="l31.545" class="difflineminus">- * @param innerFrame        The controller of the item iframe.</span>
<a href="#l31.546"></a><span id="l31.546" class="difflineplus">+ * @param iframeWindow      The event dialog iframe.</span>
<a href="#l31.547"></a><span id="l31.547">  * @param attendeesString   Comma separated list of eMail-Addresses to delete.</span>
<a href="#l31.548"></a><span id="l31.548">  */</span>
<a href="#l31.549"></a><span id="l31.549" class="difflineminus">-function deleteAttendees(event, innerFrame, attendeesString) {</span>
<a href="#l31.550"></a><span id="l31.550" class="difflineminus">-  let { eid: iframeid } = helpersForController(innerFrame);</span>
<a href="#l31.551"></a><span id="l31.551" class="difflineminus">-  let { iframeLookup } = helpersForEditUI(innerFrame);</span>
<a href="#l31.552"></a><span id="l31.552" class="difflineplus">+async function deleteAttendees(iframeWindow, attendeesString) {</span>
<a href="#l31.553"></a><span id="l31.553" class="difflineplus">+  let iframeDocument = iframeWindow.document;</span>
<a href="#l31.554"></a><span id="l31.554" class="difflineplus">+  let menupopup = iframeDocument.getElementById(&quot;attendee-popup&quot;);</span>
<a href="#l31.555"></a><span id="l31.555"> </span>
<a href="#l31.556"></a><span id="l31.556">   // Now delete the attendees.</span>
<a href="#l31.557"></a><span id="l31.557">   let attendees = attendeesString.split(&quot;,&quot;);</span>
<a href="#l31.558"></a><span id="l31.558">   for (let attendee of attendees) {</span>
<a href="#l31.559"></a><span id="l31.559" class="difflineminus">-    let attendeeToDelete = iframeLookup(`${ATTENDEES_ROW}/{&quot;attendeeid&quot;:&quot;mailto:${attendee}&quot;}`);</span>
<a href="#l31.560"></a><span id="l31.560" class="difflineplus">+    let attendeeToDelete = iframeDocument.querySelector(</span>
<a href="#l31.561"></a><span id="l31.561" class="difflineplus">+      `.item-attendees-row [attendeeid=&quot;mailto:${attendee}&quot;]`</span>
<a href="#l31.562"></a><span id="l31.562" class="difflineplus">+    );</span>
<a href="#l31.563"></a><span id="l31.563">     if (attendeeToDelete) {</span>
<a href="#l31.564"></a><span id="l31.564" class="difflineminus">-      augment_controller(event);</span>
<a href="#l31.565"></a><span id="l31.565" class="difflineminus">-      event.rightClick(attendeeToDelete);</span>
<a href="#l31.566"></a><span id="l31.566" class="difflineminus">-      event.click_menus_in_sequence(iframeid(&quot;attendee-popup&quot;).getNode(), [</span>
<a href="#l31.567"></a><span id="l31.567" class="difflineminus">-        { id: &quot;attendee-popup-removeattendee-menuitem&quot; },</span>
<a href="#l31.568"></a><span id="l31.568" class="difflineminus">-      ]);</span>
<a href="#l31.569"></a><span id="l31.569" class="difflineplus">+      attendeeToDelete.focus();</span>
<a href="#l31.570"></a><span id="l31.570" class="difflineplus">+      synthesizeMouseAtCenter(attendeeToDelete, { type: &quot;contextmenu&quot; }, iframeWindow);</span>
<a href="#l31.571"></a><span id="l31.571" class="difflineplus">+      await BrowserTestUtils.waitForEvent(menupopup, &quot;popupshown&quot;);</span>
<a href="#l31.572"></a><span id="l31.572" class="difflineplus">+      synthesizeMouseAtCenter(</span>
<a href="#l31.573"></a><span id="l31.573" class="difflineplus">+        iframeDocument.getElementById(&quot;attendee-popup-removeattendee-menuitem&quot;),</span>
<a href="#l31.574"></a><span id="l31.574" class="difflineplus">+        {},</span>
<a href="#l31.575"></a><span id="l31.575" class="difflineplus">+        iframeWindow</span>
<a href="#l31.576"></a><span id="l31.576" class="difflineplus">+      );</span>
<a href="#l31.577"></a><span id="l31.577" class="difflineplus">+      await BrowserTestUtils.waitForEvent(menupopup, &quot;popuphidden&quot;);</span>
<a href="#l31.578"></a><span id="l31.578">     }</span>
<a href="#l31.579"></a><span id="l31.579" class="difflineminus">-    event.waitForElementNotPresent(attendeeToDelete);</span>
<a href="#l31.580"></a><span id="l31.580">   }</span>
<a href="#l31.581"></a><span id="l31.581" class="difflineplus">+  await sleep(iframeWindow);</span>
<a href="#l31.582"></a><span id="l31.582"> }</span>
<a href="#l31.583"></a><span id="l31.583"> </span>
<a href="#l31.584"></a><span id="l31.584"> /**</span>
<a href="#l31.585"></a><span id="l31.585">  * Set the timezone for the item</span>
<a href="#l31.586"></a><span id="l31.586">  *</span>
<a href="#l31.587"></a><span id="l31.587" class="difflineminus">- * @param event           The controller of the Edit Dialog.</span>
<a href="#l31.588"></a><span id="l31.588" class="difflineplus">+ * @param dialogWindow    The event dialog.</span>
<a href="#l31.589"></a><span id="l31.589" class="difflineplus">+ * @param iframeWindow    The event dialog iframe.</span>
<a href="#l31.590"></a><span id="l31.590">  * @param timezone        String identifying the Timezone.</span>
<a href="#l31.591"></a><span id="l31.591">  */</span>
<a href="#l31.592"></a><span id="l31.592" class="difflineminus">-function setTimezone(event, timezone) {</span>
<a href="#l31.593"></a><span id="l31.593" class="difflineminus">-  let { eid: eventid } = helpersForController(event);</span>
<a href="#l31.594"></a><span id="l31.594" class="difflineminus">-  let eventCallback = function(zone, tzcontroller) {</span>
<a href="#l31.595"></a><span id="l31.595" class="difflineminus">-    let { lookup: tzlookup, xpath: tzpath } = helpersForController(tzcontroller);</span>
<a href="#l31.596"></a><span id="l31.596" class="difflineplus">+async function setTimezone(dialogWindow, iframeWindow, timezone) {</span>
<a href="#l31.597"></a><span id="l31.597" class="difflineplus">+  let dialogDocument = dialogWindow.document;</span>
<a href="#l31.598"></a><span id="l31.598" class="difflineplus">+  let iframeDocument = iframeWindow.document;</span>
<a href="#l31.599"></a><span id="l31.599"> </span>
<a href="#l31.600"></a><span id="l31.600" class="difflineminus">-    let item = tzpath(`</span>
<a href="#l31.601"></a><span id="l31.601" class="difflineminus">-            /*[name()='dialog']/*[name()='menulist'][1]/*[name()='menupopup'][1]/</span>
<a href="#l31.602"></a><span id="l31.602" class="difflineminus">-            *[@value='${zone}']</span>
<a href="#l31.603"></a><span id="l31.603" class="difflineminus">-        `);</span>
<a href="#l31.604"></a><span id="l31.604" class="difflineminus">-    tzcontroller.waitForElement(item);</span>
<a href="#l31.605"></a><span id="l31.605" class="difflineminus">-    tzcontroller.click(item);</span>
<a href="#l31.606"></a><span id="l31.606" class="difflineminus">-    tzcontroller.click(</span>
<a href="#l31.607"></a><span id="l31.607" class="difflineminus">-      tzlookup(`</span>
<a href="#l31.608"></a><span id="l31.608" class="difflineminus">-            /id(&quot;calendar-event-dialog-timezone&quot;)/shadow/</span>
<a href="#l31.609"></a><span id="l31.609" class="difflineminus">-            {&quot;class&quot;:&quot;dialog-button-box&quot;}/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l31.610"></a><span id="l31.610" class="difflineminus">-        `)</span>
<a href="#l31.611"></a><span id="l31.611" class="difflineminus">-    );</span>
<a href="#l31.612"></a><span id="l31.612" class="difflineminus">-  };</span>
<a href="#l31.613"></a><span id="l31.613" class="difflineplus">+  let menuitem = dialogDocument.getElementById(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l31.614"></a><span id="l31.614" class="difflineplus">+  let label = iframeDocument.getElementById(&quot;timezone-starttime&quot;);</span>
<a href="#l31.615"></a><span id="l31.615" class="difflineplus">+  let menupopup = iframeDocument.getElementById(&quot;timezone-popup&quot;);</span>
<a href="#l31.616"></a><span id="l31.616" class="difflineplus">+  let customMenuitem = iframeDocument.getElementById(&quot;timezone-custom-menuitem&quot;);</span>
<a href="#l31.617"></a><span id="l31.617"> </span>
<a href="#l31.618"></a><span id="l31.618" class="difflineminus">-  if (eventid(&quot;timezone-starttime&quot;).getNode().collapsed) {</span>
<a href="#l31.619"></a><span id="l31.619" class="difflineminus">-    let menuitem = eventid(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l31.620"></a><span id="l31.620" class="difflineminus">-    event.click(menuitem);</span>
<a href="#l31.621"></a><span id="l31.621" class="difflineplus">+  if (!BrowserTestUtils.is_visible(label)) {</span>
<a href="#l31.622"></a><span id="l31.622" class="difflineplus">+    menuitem.click();</span>
<a href="#l31.623"></a><span id="l31.623" class="difflineplus">+    await sleep(iframeWindow);</span>
<a href="#l31.624"></a><span id="l31.624">   }</span>
<a href="#l31.625"></a><span id="l31.625"> </span>
<a href="#l31.626"></a><span id="l31.626" class="difflineminus">-  plan_for_modal_dialog(&quot;Calendar:EventDialog:Timezone&quot;, eventCallback.bind(null, timezone));</span>
<a href="#l31.627"></a><span id="l31.627" class="difflineminus">-  event.waitForElement(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l31.628"></a><span id="l31.628" class="difflineminus">-  event.click(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l31.629"></a><span id="l31.629" class="difflineminus">-  event.click(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l31.630"></a><span id="l31.630" class="difflineminus">-  event.waitForElement(eventid(&quot;timezone-custom-menuitem&quot;));</span>
<a href="#l31.631"></a><span id="l31.631" class="difflineminus">-  event.click(eventid(&quot;timezone-custom-menuitem&quot;));</span>
<a href="#l31.632"></a><span id="l31.632" class="difflineminus">-  wait_for_modal_dialog(&quot;Calendar:EventDialog:Timezone&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l31.633"></a><span id="l31.633" class="difflineplus">+  Assert.ok(BrowserTestUtils.is_visible(label));</span>
<a href="#l31.634"></a><span id="l31.634" class="difflineplus">+  synthesizeMouseAtCenter(label, {}, iframeWindow);</span>
<a href="#l31.635"></a><span id="l31.635" class="difflineplus">+  await BrowserTestUtils.waitForEvent(menupopup, &quot;popupshown&quot;);</span>
<a href="#l31.636"></a><span id="l31.636" class="difflineplus">+  synthesizeMouseAtCenter(customMenuitem, {}, iframeWindow);</span>
<a href="#l31.637"></a><span id="l31.637" class="difflineplus">+</span>
<a href="#l31.638"></a><span id="l31.638" class="difflineplus">+  await BrowserTestUtils.promiseAlertDialog(</span>
<a href="#l31.639"></a><span id="l31.639" class="difflineplus">+    undefined,</span>
<a href="#l31.640"></a><span id="l31.640" class="difflineplus">+    &quot;chrome://calendar/content/calendar-event-dialog-timezone.xul&quot;,</span>
<a href="#l31.641"></a><span id="l31.641" class="difflineplus">+    async timezoneWindow =&gt; {</span>
<a href="#l31.642"></a><span id="l31.642" class="difflineplus">+      let timezoneDocument = timezoneWindow.document;</span>
<a href="#l31.643"></a><span id="l31.643" class="difflineplus">+      let timezoneMenulist = timezoneDocument.getElementById(&quot;timezone-menulist&quot;);</span>
<a href="#l31.644"></a><span id="l31.644" class="difflineplus">+      let timezoneMenuitem = timezoneMenulist.querySelector(`[value=&quot;${timezone}&quot;]`);</span>
<a href="#l31.645"></a><span id="l31.645" class="difflineplus">+</span>
<a href="#l31.646"></a><span id="l31.646" class="difflineplus">+      synthesizeMouseAtCenter(timezoneMenulist, {}, timezoneWindow);</span>
<a href="#l31.647"></a><span id="l31.647" class="difflineplus">+      await BrowserTestUtils.waitForEvent(timezoneMenulist, &quot;popupshown&quot;);</span>
<a href="#l31.648"></a><span id="l31.648" class="difflineplus">+      timezoneMenuitem.scrollIntoView();</span>
<a href="#l31.649"></a><span id="l31.649" class="difflineplus">+      synthesizeMouseAtCenter(timezoneMenuitem, {}, timezoneWindow);</span>
<a href="#l31.650"></a><span id="l31.650" class="difflineplus">+      await BrowserTestUtils.waitForEvent(timezoneMenulist, &quot;popuphidden&quot;);</span>
<a href="#l31.651"></a><span id="l31.651" class="difflineplus">+      await sleep(timezoneWindow);</span>
<a href="#l31.652"></a><span id="l31.652" class="difflineplus">+</span>
<a href="#l31.653"></a><span id="l31.653" class="difflineplus">+      synthesizeMouseAtCenter(</span>
<a href="#l31.654"></a><span id="l31.654" class="difflineplus">+        timezoneDocument.documentElement.getButton(&quot;accept&quot;),</span>
<a href="#l31.655"></a><span id="l31.655" class="difflineplus">+        {},</span>
<a href="#l31.656"></a><span id="l31.656" class="difflineplus">+        timezoneWindow</span>
<a href="#l31.657"></a><span id="l31.657" class="difflineplus">+      );</span>
<a href="#l31.658"></a><span id="l31.658" class="difflineplus">+    }</span>
<a href="#l31.659"></a><span id="l31.659" class="difflineplus">+  );</span>
<a href="#l31.660"></a><span id="l31.660" class="difflineplus">+</span>
<a href="#l31.661"></a><span id="l31.661" class="difflineplus">+  await new Promise(resolve =&gt; iframeWindow.setTimeout(resolve, 500));</span>
<a href="#l31.662"></a><span id="l31.662"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/EventUtils.jsm</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,11 +1,14 @@</span>
<a href="#l32.4"></a><span id="l32.4"> // Export all available functions for Mozmill</span>
<a href="#l32.5"></a><span id="l32.5"> var EXPORTED_SYMBOLS = [</span>
<a href="#l32.6"></a><span id="l32.6" class="difflineplus">+  &quot;sendChar&quot;,</span>
<a href="#l32.7"></a><span id="l32.7" class="difflineplus">+  &quot;sendString&quot;,</span>
<a href="#l32.8"></a><span id="l32.8">   &quot;synthesizeMouse&quot;,</span>
<a href="#l32.9"></a><span id="l32.9" class="difflineplus">+  &quot;synthesizeMouseAtCenter&quot;,</span>
<a href="#l32.10"></a><span id="l32.10">   &quot;synthesizeMouseScroll&quot;,</span>
<a href="#l32.11"></a><span id="l32.11">   &quot;synthesizeKey&quot;,</span>
<a href="#l32.12"></a><span id="l32.12">   &quot;synthesizeMouseExpectEvent&quot;,</span>
<a href="#l32.13"></a><span id="l32.13"> ];</span>
<a href="#l32.14"></a><span id="l32.14"> </span>
<a href="#l32.15"></a><span id="l32.15"> const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17"> /**</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineat">@@ -33,16 +36,71 @@ function _parseModifiers(aEvent) {</span>
<a href="#l32.19"></a><span id="l32.19">       ? Ci.nsIDOMWindowUtils.MODIFIER_META</span>
<a href="#l32.20"></a><span id="l32.20">       : Ci.nsIDOMWindowUtils.MODIFIER_CONTROL;</span>
<a href="#l32.21"></a><span id="l32.21">   }</span>
<a href="#l32.22"></a><span id="l32.22"> </span>
<a href="#l32.23"></a><span id="l32.23">   return mval;</span>
<a href="#l32.24"></a><span id="l32.24"> }</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26"> /**</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineplus">+ * Send the char aChar to the focused element.  This method handles casing of</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineplus">+ * chars (sends the right charcode, and sends a shift key for uppercase chars).</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineplus">+ * No other modifiers are handled at this point.</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+ *</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+ * For now this method only works for ASCII characters and emulates the shift</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+ * key state on US keyboard layout.</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+ */</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+function sendChar(aChar, aWindow) {</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineplus">+  var hasShift;</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineplus">+  // Emulate US keyboard layout for the shiftKey state.</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+  switch (aChar) {</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+    case &quot;!&quot;:</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+    case &quot;@&quot;:</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+    case &quot;#&quot;:</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+    case &quot;$&quot;:</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+    case &quot;%&quot;:</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+    case &quot;^&quot;:</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+    case &quot;&amp;&quot;:</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+    case &quot;*&quot;:</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+    case &quot;(&quot;:</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineplus">+    case &quot;)&quot;:</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+    case &quot;_&quot;:</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+    case &quot;+&quot;:</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineplus">+    case &quot;{&quot;:</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+    case &quot;}&quot;:</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineplus">+    case &quot;:&quot;:</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+    case '&quot;':</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineplus">+    case &quot;|&quot;:</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+    case &quot;&lt;&quot;:</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+    case &quot;&gt;&quot;:</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+    case &quot;?&quot;:</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+      hasShift = true;</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineplus">+      break;</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineplus">+    default:</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineplus">+      hasShift =</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineplus">+        aChar.toLowerCase() != aChar.toUpperCase() &amp;&amp;</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+        aChar == aChar.toUpperCase();</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+      break;</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+  }</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineplus">+  synthesizeKey(aChar, { shiftKey: hasShift }, aWindow);</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineplus">+}</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineplus">+</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineplus">+/**</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+ * Send the string aStr to the focused element.</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineplus">+ *</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineplus">+ * For now this method only works for ASCII characters and emulates the shift</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineplus">+ * key state on US keyboard layout.</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineplus">+ */</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineplus">+function sendString(aStr, aWindow) {</span>
<a href="#l32.76"></a><span id="l32.76" class="difflineplus">+  for (var i = 0; i &lt; aStr.length; ++i) {</span>
<a href="#l32.77"></a><span id="l32.77" class="difflineplus">+    sendChar(aStr.charAt(i), aWindow);</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineplus">+  }</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineplus">+}</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineplus">+</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineplus">+/**</span>
<a href="#l32.82"></a><span id="l32.82">  * Synthesize a mouse event on a target. The actual client point is determined</span>
<a href="#l32.83"></a><span id="l32.83">  * by taking the aTarget's client box and offsetting it by aOffsetX and</span>
<a href="#l32.84"></a><span id="l32.84">  * aOffsetY. This allows mouse clicks to be simulated by calling this method.</span>
<a href="#l32.85"></a><span id="l32.85">  *</span>
<a href="#l32.86"></a><span id="l32.86">  * aEvent is an object which may contain the properties:</span>
<a href="#l32.87"></a><span id="l32.87">  *   shiftKey, ctrlKey, altKey, metaKey, accessKey, clickCount, button, type</span>
<a href="#l32.88"></a><span id="l32.88">  *</span>
<a href="#l32.89"></a><span id="l32.89">  * If the type is specified, an mouse event of that type is fired. Otherwise,</span>
<a href="#l32.90"></a><span id="l32.90" class="difflineat">@@ -81,16 +139,38 @@ function synthesizeMouse(aTarget, aOffse</span>
<a href="#l32.91"></a><span id="l32.91">         modifiers</span>
<a href="#l32.92"></a><span id="l32.92">       );</span>
<a href="#l32.93"></a><span id="l32.93">       utils.sendMouseEvent(&quot;mouseup&quot;, left, top, button, clickCount, modifiers);</span>
<a href="#l32.94"></a><span id="l32.94">     }</span>
<a href="#l32.95"></a><span id="l32.95">   }</span>
<a href="#l32.96"></a><span id="l32.96"> }</span>
<a href="#l32.97"></a><span id="l32.97"> </span>
<a href="#l32.98"></a><span id="l32.98"> /**</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineplus">+ * Call synthesizeMouse with coordinates at the center of aTarget.</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineplus">+ *</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineplus">+ * aEvent is an object which may contain the properties:</span>
<a href="#l32.102"></a><span id="l32.102" class="difflineplus">+ *   shiftKey, ctrlKey, altKey, metaKey, accessKey, clickCount, button, type</span>
<a href="#l32.103"></a><span id="l32.103" class="difflineplus">+ *</span>
<a href="#l32.104"></a><span id="l32.104" class="difflineplus">+ * If the type is specified, an mouse event of that type is fired. Otherwise,</span>
<a href="#l32.105"></a><span id="l32.105" class="difflineplus">+ * a mousedown followed by a mouse up is performed.</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineplus">+ *</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineplus">+ * aWindow is optional, and defaults to the current window object.</span>
<a href="#l32.108"></a><span id="l32.108" class="difflineplus">+ */</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineplus">+function synthesizeMouseAtCenter(aTarget, aEvent, aWindow) {</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineplus">+  var rect = aTarget.getBoundingClientRect();</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineplus">+  return synthesizeMouse(</span>
<a href="#l32.112"></a><span id="l32.112" class="difflineplus">+    aTarget,</span>
<a href="#l32.113"></a><span id="l32.113" class="difflineplus">+    rect.width / 2,</span>
<a href="#l32.114"></a><span id="l32.114" class="difflineplus">+    rect.height / 2,</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineplus">+    aEvent,</span>
<a href="#l32.116"></a><span id="l32.116" class="difflineplus">+    aWindow</span>
<a href="#l32.117"></a><span id="l32.117" class="difflineplus">+  );</span>
<a href="#l32.118"></a><span id="l32.118" class="difflineplus">+}</span>
<a href="#l32.119"></a><span id="l32.119" class="difflineplus">+</span>
<a href="#l32.120"></a><span id="l32.120" class="difflineplus">+/**</span>
<a href="#l32.121"></a><span id="l32.121">  * Synthesize a mouse scroll event on a target. The actual client point is determined</span>
<a href="#l32.122"></a><span id="l32.122">  * by taking the aTarget's client box and offsetting it by aOffsetX and</span>
<a href="#l32.123"></a><span id="l32.123">  * aOffsetY.</span>
<a href="#l32.124"></a><span id="l32.124">  *</span>
<a href="#l32.125"></a><span id="l32.125">  * aEvent is an object which may contain the properties:</span>
<a href="#l32.126"></a><span id="l32.126">  *   shiftKey, ctrlKey, altKey, metaKey, accessKey, button, type, axis, delta, hasPixels</span>
<a href="#l32.127"></a><span id="l32.127">  *</span>
<a href="#l32.128"></a><span id="l32.128">  * If the type is specified, a mouse scroll event of that type is fired. Otherwise,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

