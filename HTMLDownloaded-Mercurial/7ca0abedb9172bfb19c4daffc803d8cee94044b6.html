<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26535:7ca0abedb9172bfb19c4daffc803d8cee94044b6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 7ca0abedb9172bfb19c4daffc803d8cee94044b6" />
<meta property="og:url" content="/comm-central/rev/7ca0abedb9172bfb19c4daffc803d8cee94044b6" />
<meta property="og:description" content="Bug 1515877 - Turn on ESLint in mailnews/import; r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 7ca0abedb9172bfb19c4daffc803d8cee94044b6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/7ca0abedb9172bfb19c4daffc803d8cee94044b6">shortlog</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/7ca0abedb9172bfb19c4daffc803d8cee94044b6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6">files</a> |
changeset |
<a href="/comm-central/raw-rev/7ca0abedb9172bfb19c4daffc803d8cee94044b6">raw</a>  | <a href="/comm-central/archive/7ca0abedb9172bfb19c4daffc803d8cee94044b6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515877">Bug 1515877</a> - Turn on ESLint in mailnews/import; r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 08 May 2019 15:55:21 +1200</td></tr>

<tr>
 <td>changeset 26535</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/7ca0abedb9172bfb19c4daffc803d8cee94044b6">7ca0abedb9172bfb19c4daffc803d8cee94044b6</a></td>
</tr>



<tr>
<td>parent 26534</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5e693bbfa3fc0ed6d93fa9b87f3e139fd5a6938d">5e693bbfa3fc0ed6d93fa9b87f3e139fd5a6938d</a>
</td>
</tr>

<tr>
<td>child 26536</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5544aead04dfb062b7aa0aa0db874af499a6df94">5544aead04dfb062b7aa0aa0db874af499a6df94</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=7ca0abedb9172bfb19c4daffc803d8cee94044b6">15885</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Wed, 08 May 2019 03:56:04 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@305d1bc1bda9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=305d1bc1bda9880aea7801204f3b5e27766f38f3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=305d1bc1bda9880aea7801204f3b5e27766f38f3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=305d1bc1bda9880aea7801204f3b5e27766f38f3&newProject=comm-central&newRevision=fb00935549d335953b7689234103884ae8283c6d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=305d1bc1bda9880aea7801204f3b5e27766f38f3&newProject=comm-central&newRevision=fb00935549d335953b7689234103884ae8283c6d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=305d1bc1bda9880aea7801204f3b5e27766f38f3&newProject=comm-central&newRevision=fb00935549d335953b7689234103884ae8283c6d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515877">1515877</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515877">Bug 1515877</a> - Turn on ESLint in mailnews/import; r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/.eslintignore">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/.eslintignore">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/.eslintignore">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/.eslintignore">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/fieldMapImport.js">mailnews/import/content/fieldMapImport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/fieldMapImport.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/fieldMapImport.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/fieldMapImport.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/fieldMapImport.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/fieldMapImport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/import-test.html">mailnews/import/content/import-test.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/import-test.html">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/import-test.html">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/import-test.html">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/import-test.html">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/import-test.html">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/importDialog.js">mailnews/import/content/importDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/importDialog.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/importDialog.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/importDialog.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/importDialog.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/content/importDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/.eslintrc.js">mailnews/import/test/unit/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/head_import.js">mailnews/import/test/unit/head_import.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/head_import.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/head_import.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/head_import.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/head_import.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/head_import.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/TestMailImporter.js">mailnews/import/test/unit/resources/TestMailImporter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/TestMailImporter.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/TestMailImporter.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/TestMailImporter.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/TestMailImporter.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/TestMailImporter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/import_helper.js">mailnews/import/test/unit/resources/import_helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/import_helper.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/import_helper.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/import_helper.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/import_helper.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/import_helper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/mock_windows_reg_factory.js">mailnews/import/test/unit/resources/mock_windows_reg_factory.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/mock_windows_reg_factory.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/mock_windows_reg_factory.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/mock_windows_reg_factory.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/mock_windows_reg_factory.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/resources/mock_windows_reg_factory.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_addressbook.js">mailnews/import/test/unit/test_becky_addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_addressbook.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_addressbook.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_addressbook.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_addressbook.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_filters.js">mailnews/import/test/unit/test_becky_filters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_filters.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_filters.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_filters.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_filters.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_becky_filters.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_263304.js">mailnews/import/test/unit/test_bug_263304.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_263304.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_263304.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_263304.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_263304.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_263304.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_437556.js">mailnews/import/test/unit/test_bug_437556.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_437556.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_437556.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_437556.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_437556.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_bug_437556.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import.js">mailnews/import/test/unit/test_csv_import.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import_quote.js">mailnews/import/test/unit/test_csv_import_quote.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import_quote.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import_quote.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import_quote.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import_quote.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_csv_import_quote.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_ldif_import.js">mailnews/import/test/unit/test_ldif_import.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_ldif_import.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_ldif_import.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_ldif_import.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_ldif_import.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_ldif_import.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_outlook_settings.js">mailnews/import/test/unit/test_outlook_settings.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_outlook_settings.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_outlook_settings.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_outlook_settings.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_outlook_settings.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_outlook_settings.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_shiftjis_csv.js">mailnews/import/test/unit/test_shiftjis_csv.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_shiftjis_csv.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_shiftjis_csv.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_shiftjis_csv.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_shiftjis_csv.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_shiftjis_csv.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_utf16_csv.js">mailnews/import/test/unit/test_utf16_csv.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_utf16_csv.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_utf16_csv.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_utf16_csv.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_utf16_csv.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_utf16_csv.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_vcard_import.js">mailnews/import/test/unit/test_vcard_import.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_vcard_import.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_vcard_import.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_vcard_import.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_vcard_import.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_vcard_import.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_winmail.js">mailnews/import/test/unit/test_winmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_winmail.js">file</a> |
<a href="/comm-central/annotate/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_winmail.js">annotate</a> |
<a href="/comm-central/diff/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_winmail.js">diff</a> |
<a href="/comm-central/comparison/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_winmail.js">comparison</a> |
<a href="/comm-central/log/7ca0abedb9172bfb19c4daffc803d8cee94044b6/mailnews/import/test/unit/test_winmail.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -59,17 +59,16 @@ editor/ui/dialogs/content/EdSnapToGrid.j</span>
<a href="#l1.4"></a><span id="l1.4"> editor/ui/dialogs/content/EdSnapToGrid.xul</span>
<a href="#l1.5"></a><span id="l1.5"> editor/ui/texzilla/**</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> # mailnews exclusions</span>
<a href="#l1.8"></a><span id="l1.8"> mailnews/mailnews.js</span>
<a href="#l1.9"></a><span id="l1.9"> mailnews/extensions/dsn/content/dsn.js</span>
<a href="#l1.10"></a><span id="l1.10"> mailnews/extensions/mdn/content/mdn.js</span>
<a href="#l1.11"></a><span id="l1.11"> mailnews/extensions/smime/content/smime.js</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-mailnews/import/*</span>
<a href="#l1.13"></a><span id="l1.13"> mailnews/intl/*</span>
<a href="#l1.14"></a><span id="l1.14"> mailnews/jsaccount/*</span>
<a href="#l1.15"></a><span id="l1.15"> mailnews/mime/*</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> # mail exclusions</span>
<a href="#l1.18"></a><span id="l1.18"> mail/app/profile/all-thunderbird.js</span>
<a href="#l1.19"></a><span id="l1.19"> mail/app/profile/channel-prefs.js</span>
<a href="#l1.20"></a><span id="l1.20"> mail/app/profile/prefs.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/import/content/fieldMapImport.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/import/content/fieldMapImport.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -11,31 +11,30 @@ var gPreviousButton;</span>
<a href="#l2.4"></a><span id="l2.4"> var gNextButton;</span>
<a href="#l2.5"></a><span id="l2.5"> var gMoveUpButton;</span>
<a href="#l2.6"></a><span id="l2.6"> var gMoveDownButton;</span>
<a href="#l2.7"></a><span id="l2.7"> var gListbox;</span>
<a href="#l2.8"></a><span id="l2.8"> var gSkipFirstRecordButton;</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> document.addEventListener(&quot;dialogaccept&quot;, FieldImportOKButton);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-function OnLoadFieldMapImport()</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-{</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+function OnLoadFieldMapImport() {</span>
<a href="#l2.15"></a><span id="l2.15">   top.importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l2.16"></a><span id="l2.16">                         .getService(Ci.nsIImportService);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">   // We need a field map object...</span>
<a href="#l2.19"></a><span id="l2.19">   // assume we have one passed in? or just make one?</span>
<a href="#l2.20"></a><span id="l2.20">   if (window.arguments &amp;&amp; window.arguments[0]) {</span>
<a href="#l2.21"></a><span id="l2.21">     top.fieldMap = window.arguments[0].fieldMap;</span>
<a href="#l2.22"></a><span id="l2.22">     top.addInterface = window.arguments[0].addInterface;</span>
<a href="#l2.23"></a><span id="l2.23">     top.dialogResult = window.arguments[0].result;</span>
<a href="#l2.24"></a><span id="l2.24">   }</span>
<a href="#l2.25"></a><span id="l2.25">   if (top.fieldMap == null) {</span>
<a href="#l2.26"></a><span id="l2.26">     top.fieldMap = top.importService.CreateNewFieldMap();</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-    top.fieldMap.DefaultFieldMap( top.fieldMap.numMozFields);</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    top.fieldMap.DefaultFieldMap(top.fieldMap.numMozFields);</span>
<a href="#l2.29"></a><span id="l2.29">   }</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">   gMoveUpButton = document.getElementById(&quot;upButton&quot;);</span>
<a href="#l2.32"></a><span id="l2.32">   gMoveDownButton = document.getElementById(&quot;downButton&quot;);</span>
<a href="#l2.33"></a><span id="l2.33">   gPreviousButton = document.getElementById(&quot;previous&quot;);</span>
<a href="#l2.34"></a><span id="l2.34">   gNextButton = document.getElementById(&quot;next&quot;);</span>
<a href="#l2.35"></a><span id="l2.35">   gListbox = document.getElementById(&quot;fieldList&quot;);</span>
<a href="#l2.36"></a><span id="l2.36">   gSkipFirstRecordButton = document.getElementById(&quot;skipFirstRecord&quot;);</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineat">@@ -44,48 +43,45 @@ function OnLoadFieldMapImport()</span>
<a href="#l2.38"></a><span id="l2.38">   gSkipFirstRecordButton.checked = top.fieldMap.skipFirstRecord;</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40">   ListFields();</span>
<a href="#l2.41"></a><span id="l2.41">   Browse(1);</span>
<a href="#l2.42"></a><span id="l2.42">   gListbox.selectedItem = gListbox.getItemAtIndex(0);</span>
<a href="#l2.43"></a><span id="l2.43">   disableMoveButtons();</span>
<a href="#l2.44"></a><span id="l2.44"> }</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-function IndexInMap( index)</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-{</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+function IndexInMap(index) {</span>
<a href="#l2.49"></a><span id="l2.49">   var count = top.fieldMap.mapSize;</span>
<a href="#l2.50"></a><span id="l2.50">   for (var i = 0; i &lt; count; i++) {</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-    if (top.fieldMap.GetFieldMap( i) == index)</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-      return( true);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+    if (top.fieldMap.GetFieldMap(i) == index)</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+      return true;</span>
<a href="#l2.55"></a><span id="l2.55">   }</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-  return( false);</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+  return false;</span>
<a href="#l2.59"></a><span id="l2.59"> }</span>
<a href="#l2.60"></a><span id="l2.60"> </span>
<a href="#l2.61"></a><span id="l2.61"> function ListFields() {</span>
<a href="#l2.62"></a><span id="l2.62">   if (top.fieldMap == null)</span>
<a href="#l2.63"></a><span id="l2.63">     return;</span>
<a href="#l2.64"></a><span id="l2.64"> </span>
<a href="#l2.65"></a><span id="l2.65">   var count = top.fieldMap.mapSize;</span>
<a href="#l2.66"></a><span id="l2.66">   var index;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-  var i;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-  for (i = 0; i &lt; count; i++) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-    index = top.fieldMap.GetFieldMap( i);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-    AddFieldToList(top.fieldMap.GetFieldDescription( index), index, top.fieldMap.GetFieldActive( i));</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+  for (let i = 0; i &lt; count; i++) {</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+    index = top.fieldMap.GetFieldMap(i);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    AddFieldToList(top.fieldMap.GetFieldDescription(index), index, top.fieldMap.GetFieldActive(i));</span>
<a href="#l2.74"></a><span id="l2.74">   }</span>
<a href="#l2.75"></a><span id="l2.75"> </span>
<a href="#l2.76"></a><span id="l2.76">   count = top.fieldMap.numMozFields;</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-  for (i = 0; i &lt; count; i++) {</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-    if (!IndexInMap( i))</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-      AddFieldToList(top.fieldMap.GetFieldDescription( i), i, false);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+  for (let i = 0; i &lt; count; i++) {</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    if (!IndexInMap(i))</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+      AddFieldToList(top.fieldMap.GetFieldDescription(i), i, false);</span>
<a href="#l2.83"></a><span id="l2.83">   }</span>
<a href="#l2.84"></a><span id="l2.84"> }</span>
<a href="#l2.85"></a><span id="l2.85"> </span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-function CreateField(name, index, on)</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-{</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+function CreateField(name, index, on) {</span>
<a href="#l2.89"></a><span id="l2.89">   var item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l2.90"></a><span id="l2.90">   item.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<a href="#l2.91"></a><span id="l2.91">   item.setAttribute(&quot;field-index&quot;, index);</span>
<a href="#l2.92"></a><span id="l2.92">   item.setAttribute(&quot;allowevents&quot;, &quot;true&quot;);</span>
<a href="#l2.93"></a><span id="l2.93"> </span>
<a href="#l2.94"></a><span id="l2.94">   var checkboxCell = document.createElement(&quot;hbox&quot;);</span>
<a href="#l2.95"></a><span id="l2.95">   checkboxCell.setAttribute(&quot;style&quot;, &quot;width: var(--column1width)&quot;);</span>
<a href="#l2.96"></a><span id="l2.96">   let checkbox = document.createElement(&quot;checkbox&quot;);</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineat">@@ -104,95 +100,85 @@ function CreateField(name, index, on)</span>
<a href="#l2.98"></a><span id="l2.98">   secondCell.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.99"></a><span id="l2.99"> </span>
<a href="#l2.100"></a><span id="l2.100">   item.appendChild(checkboxCell);</span>
<a href="#l2.101"></a><span id="l2.101">   item.appendChild(firstCell);</span>
<a href="#l2.102"></a><span id="l2.102">   item.appendChild(secondCell);</span>
<a href="#l2.103"></a><span id="l2.103">   return item;</span>
<a href="#l2.104"></a><span id="l2.104"> }</span>
<a href="#l2.105"></a><span id="l2.105"> </span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-function AddFieldToList(name, index, on)</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-{</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+function AddFieldToList(name, index, on) {</span>
<a href="#l2.109"></a><span id="l2.109">   var item = CreateField(name, index, on);</span>
<a href="#l2.110"></a><span id="l2.110">   gListbox.appendChild(item);</span>
<a href="#l2.111"></a><span id="l2.111"> }</span>
<a href="#l2.112"></a><span id="l2.112"> </span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-function cellClicked(event)</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-{</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+function cellClicked(event) {</span>
<a href="#l2.116"></a><span id="l2.116">   if (event.button == 0) {</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-    var on = gListbox.selectedItem.firstChild.getAttribute('checked');</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-    gListbox.selectedItem.firstChild.setAttribute('checked', (on != &quot;true&quot;));</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+    var on = gListbox.selectedItem.firstChild.getAttribute(&quot;checked&quot;);</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+    gListbox.selectedItem.firstChild.setAttribute(&quot;checked&quot;, (on != &quot;true&quot;));</span>
<a href="#l2.121"></a><span id="l2.121">   }</span>
<a href="#l2.122"></a><span id="l2.122"> }</span>
<a href="#l2.123"></a><span id="l2.123"> </span>
<a href="#l2.124"></a><span id="l2.124"> // The &quot;Move Up/Move Down&quot; buttons should move the items in the left column</span>
<a href="#l2.125"></a><span id="l2.125"> // up/down but the values in the right column should not change.</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-function moveItem(up)</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-{</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+function moveItem(up) {</span>
<a href="#l2.129"></a><span id="l2.129">   var selectedItem = gListbox.selectedItem;</span>
<a href="#l2.130"></a><span id="l2.130">   var swapPartner = (up ? gListbox.getPreviousItem(selectedItem, 1)</span>
<a href="#l2.131"></a><span id="l2.131">                         : gListbox.getNextItem(selectedItem, 1));</span>
<a href="#l2.132"></a><span id="l2.132"> </span>
<a href="#l2.133"></a><span id="l2.133">   var tmpLabel = swapPartner.lastChild.getAttribute(&quot;value&quot;);</span>
<a href="#l2.134"></a><span id="l2.134">   swapPartner.lastChild.setAttribute(&quot;value&quot;, selectedItem.lastChild.getAttribute(&quot;value&quot;));</span>
<a href="#l2.135"></a><span id="l2.135">   selectedItem.lastChild.setAttribute(&quot;value&quot;, tmpLabel);</span>
<a href="#l2.136"></a><span id="l2.136"> </span>
<a href="#l2.137"></a><span id="l2.137">   var newItemPosition = (up ? selectedItem.nextSibling : selectedItem);</span>
<a href="#l2.138"></a><span id="l2.138">   gListbox.insertBefore(swapPartner, newItemPosition);</span>
<a href="#l2.139"></a><span id="l2.139">   gListbox.ensureElementIsVisible(selectedItem);</span>
<a href="#l2.140"></a><span id="l2.140">   disableMoveButtons();</span>
<a href="#l2.141"></a><span id="l2.141"> }</span>
<a href="#l2.142"></a><span id="l2.142"> </span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-function disableMoveButtons()</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-{</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+function disableMoveButtons() {</span>
<a href="#l2.146"></a><span id="l2.146">   var selectedIndex = gListbox.selectedIndex;</span>
<a href="#l2.147"></a><span id="l2.147">   gMoveUpButton.disabled = (selectedIndex == 0);</span>
<a href="#l2.148"></a><span id="l2.148">   gMoveDownButton.disabled = (selectedIndex == (gListbox.getRowCount() - 1));</span>
<a href="#l2.149"></a><span id="l2.149"> }</span>
<a href="#l2.150"></a><span id="l2.150"> </span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-function ShowSampleData(data)</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-{</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+function ShowSampleData(data) {</span>
<a href="#l2.154"></a><span id="l2.154">   var fields = data.split(&quot;\n&quot;);</span>
<a href="#l2.155"></a><span id="l2.155">   for (var i = 0; i &lt; gListbox.getRowCount(); i++)</span>
<a href="#l2.156"></a><span id="l2.156">     gListbox.getItemAtIndex(i).lastChild.setAttribute(&quot;value&quot;, (i &lt; fields.length) ? fields[i] : &quot;&quot;);</span>
<a href="#l2.157"></a><span id="l2.157"> }</span>
<a href="#l2.158"></a><span id="l2.158"> </span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-function FetchSampleData(num)</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-{</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+function FetchSampleData(num) {</span>
<a href="#l2.162"></a><span id="l2.162">   if (!top.addInterface)</span>
<a href="#l2.163"></a><span id="l2.163">     return false;</span>
<a href="#l2.164"></a><span id="l2.164"> </span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-  var data = top.addInterface.GetData( &quot;sampleData-&quot; + num);</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+  var data = top.addInterface.GetData(&quot;sampleData-&quot; + num);</span>
<a href="#l2.167"></a><span id="l2.167">   if (!(data instanceof Ci.nsISupportsString))</span>
<a href="#l2.168"></a><span id="l2.168">     return false;</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-  ShowSampleData( data.data);</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+  ShowSampleData(data.data);</span>
<a href="#l2.171"></a><span id="l2.171">   return true;</span>
<a href="#l2.172"></a><span id="l2.172"> }</span>
<a href="#l2.173"></a><span id="l2.173"> </span>
<a href="#l2.174"></a><span id="l2.174" class="difflineminus">-function Browse(step)</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineminus">-{</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+function Browse(step) {</span>
<a href="#l2.177"></a><span id="l2.177">   recordNum += step;</span>
<a href="#l2.178"></a><span id="l2.178">   if (FetchSampleData(recordNum - 1))</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineminus">-    document.getElementById('recordNumber').setAttribute('value', (&quot;&quot; + recordNum));</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+    document.getElementById(&quot;recordNumber&quot;).setAttribute(&quot;value&quot;, (&quot;&quot; + recordNum));</span>
<a href="#l2.181"></a><span id="l2.181"> </span>
<a href="#l2.182"></a><span id="l2.182">   gPreviousButton.disabled = (recordNum == 1);</span>
<a href="#l2.183"></a><span id="l2.183">   gNextButton.disabled = (addInterface.GetData(&quot;sampleData-&quot; + recordNum) == null);</span>
<a href="#l2.184"></a><span id="l2.184"> }</span>
<a href="#l2.185"></a><span id="l2.185"> </span>
<a href="#l2.186"></a><span id="l2.186" class="difflineminus">-function FieldImportOKButton()</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineminus">-{</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+function FieldImportOKButton() {</span>
<a href="#l2.189"></a><span id="l2.189">   var max = gListbox.getRowCount();</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineminus">-  var fIndex;</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineminus">-  var on;</span>
<a href="#l2.192"></a><span id="l2.192">   // Ensure field map is the right size</span>
<a href="#l2.193"></a><span id="l2.193">   top.fieldMap.SetFieldMapSize(max);</span>
<a href="#l2.194"></a><span id="l2.194"> </span>
<a href="#l2.195"></a><span id="l2.195" class="difflineminus">-  for (var i = 0; i &lt; max; i++) {</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineminus">-    fIndex = gListbox.getItemAtIndex(i).getAttribute( 'field-index');</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineminus">-    on = gListbox.getItemAtIndex(i).firstChild.getAttribute('checked');</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineminus">-    top.fieldMap.SetFieldMap( i, fIndex);</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-    top.fieldMap.SetFieldActive( i, (on == &quot;true&quot;));</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+  for (let i = 0; i &lt; max; i++) {</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+    let fIndex = gListbox.getItemAtIndex(i).getAttribute(&quot;field-index&quot;);</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineplus">+    let on = gListbox.getItemAtIndex(i).firstChild.getAttribute(&quot;checked&quot;);</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineplus">+    top.fieldMap.SetFieldMap(i, fIndex);</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+    top.fieldMap.SetFieldActive(i, (on == &quot;true&quot;));</span>
<a href="#l2.205"></a><span id="l2.205">   }</span>
<a href="#l2.206"></a><span id="l2.206"> </span>
<a href="#l2.207"></a><span id="l2.207">   top.fieldMap.skipFirstRecord = gSkipFirstRecordButton.checked;</span>
<a href="#l2.208"></a><span id="l2.208"> </span>
<a href="#l2.209"></a><span id="l2.209">   top.dialogResult.ok = true;</span>
<a href="#l2.210"></a><span id="l2.210"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/import/content/import-test.html</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/import/content/import-test.html</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -2,35 +2,30 @@</span>
<a href="#l3.4"></a><span id="l3.4">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.5"></a><span id="l3.5">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> &lt;html&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> &lt;body&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10"> &lt;script&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-function toImport(importType)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-{</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-	/*</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-	window.openDialog(&quot;chrome:/messenger/content/fieldMapImport.xul&quot;,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-					  &quot;fieldMapImportDialog&quot;,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-					  &quot;chrome,modal&quot;);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-	*/</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-	window.openDialog(&quot;chrome:/messenger/content/importDialog.xul&quot;,</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-					  &quot;&quot;,</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-					  &quot;chrome,modal&quot;,</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-					  {importType:importType});</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+function toImport(importType) {</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+  // window.openDialog(&quot;chrome:/messenger/content/fieldMapImport.xul&quot;,</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+  //                   &quot;fieldMapImportDialog&quot;,</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+  //                   &quot;chrome,modal&quot;);</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+  window.openDialog(&quot;chrome:/messenger/content/importDialog.xul&quot;,</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+                    &quot;&quot;,</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+                    &quot;chrome,modal&quot;,</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+                    {importType});</span>
<a href="#l3.32"></a><span id="l3.32"> }</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-</span>
<a href="#l3.35"></a><span id="l3.35"> &lt;/script&gt;</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37"> &lt;p&gt;</span>
<a href="#l3.38"></a><span id="l3.38"> &lt;form name=&quot;form&quot;&gt;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-&lt;input type=&quot;button&quot; value=&quot;Import Address Books&quot; onclick=&quot;toImport( 'addressbook');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-&lt;input type=&quot;button&quot; value=&quot;Import Mail&quot; onclick=&quot;toImport( 'mail');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-&lt;input type=&quot;button&quot; value=&quot;Import Settings&quot; onclick=&quot;toImport( 'settings');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-&lt;input type=&quot;button&quot; value=&quot;Import Filters&quot; onclick=&quot;toImport( 'filters');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-&lt;form&gt; </span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+&lt;input type=&quot;button&quot; value=&quot;Import Address Books&quot; onclick=&quot;toImport('addressbook');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+&lt;input type=&quot;button&quot; value=&quot;Import Mail&quot; onclick=&quot;toImport('mail');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+&lt;input type=&quot;button&quot; value=&quot;Import Settings&quot; onclick=&quot;toImport('settings');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+&lt;input type=&quot;button&quot; value=&quot;Import Filters&quot; onclick=&quot;toImport('filters');&quot;&gt;&lt;br&gt;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+&lt;/form&gt;</span>
<a href="#l3.49"></a><span id="l3.49"> </span>
<a href="#l3.50"></a><span id="l3.50"> &lt;/body&gt;</span>
<a href="#l3.51"></a><span id="l3.51"> &lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/import/content/importDialog.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/import/content/importDialog.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,16 +1,18 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l4.5"></a><span id="l4.5">  *</span>
<a href="#l4.6"></a><span id="l4.6">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.7"></a><span id="l4.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.8"></a><span id="l4.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> &quot;use strict&quot;;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+/* import-globals-from ../../extensions/newsblog/content/feed-subscriptions.js */</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.15"></a><span id="l4.15"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> var gImportType = null;</span>
<a href="#l4.18"></a><span id="l4.18"> var gImportMsgsBundle;</span>
<a href="#l4.19"></a><span id="l4.19"> var gFeedsBundle;</span>
<a href="#l4.20"></a><span id="l4.20"> var gImportService = null;</span>
<a href="#l4.21"></a><span id="l4.21"> var gSuccessStr = null;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -18,18 +20,17 @@ var gErrorStr = null;</span>
<a href="#l4.23"></a><span id="l4.23"> var gInputStr = null;</span>
<a href="#l4.24"></a><span id="l4.24"> var gProgressInfo = null;</span>
<a href="#l4.25"></a><span id="l4.25"> var gSelectedModuleName = null;</span>
<a href="#l4.26"></a><span id="l4.26"> var gAddInterface = null;</span>
<a href="#l4.27"></a><span id="l4.27"> var gNewFeedAcctCreated = false;</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29"> var nsISupportsString = Ci.nsISupportsString;</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-function OnLoadImportDialog()</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-{</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+function OnLoadImportDialog() {</span>
<a href="#l4.34"></a><span id="l4.34">   gImportMsgsBundle = document.getElementById(&quot;bundle_importMsgs&quot;);</span>
<a href="#l4.35"></a><span id="l4.35">   gFeedsBundle = document.getElementById(&quot;bundle_feeds&quot;);</span>
<a href="#l4.36"></a><span id="l4.36">   gImportService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l4.37"></a><span id="l4.37">                      .getService(Ci.nsIImportService);</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39">   gProgressInfo = { };</span>
<a href="#l4.40"></a><span id="l4.40">   gProgressInfo.progressWindow = null;</span>
<a href="#l4.41"></a><span id="l4.41">   gProgressInfo.importInterface = null;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineat">@@ -43,334 +44,295 @@ function OnLoadImportDialog()</span>
<a href="#l4.43"></a><span id="l4.43">                   .createInstance(nsISupportsString);</span>
<a href="#l4.44"></a><span id="l4.44">   gErrorStr = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l4.45"></a><span id="l4.45">                 .createInstance(nsISupportsString);</span>
<a href="#l4.46"></a><span id="l4.46">   gInputStr = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l4.47"></a><span id="l4.47">                 .createInstance(nsISupportsString);</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49">   // look in arguments[0] for parameters</span>
<a href="#l4.50"></a><span id="l4.50">   if ((&quot;arguments&quot; in window) &amp;&amp; window.arguments.length &gt;= 1 &amp;&amp;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-      (&quot;importType&quot; in window.arguments[0]) &amp;&amp; window.arguments[0].importType)</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-  {</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+      (&quot;importType&quot; in window.arguments[0]) &amp;&amp; window.arguments[0].importType) {</span>
<a href="#l4.54"></a><span id="l4.54">     // keep parameters in global for later</span>
<a href="#l4.55"></a><span id="l4.55">     gImportType = window.arguments[0].importType;</span>
<a href="#l4.56"></a><span id="l4.56">     gProgressInfo.importType = gImportType;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-  }</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-  else</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-  {</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+  } else {</span>
<a href="#l4.61"></a><span id="l4.61">     gImportType = &quot;all&quot;;</span>
<a href="#l4.62"></a><span id="l4.62">     gProgressInfo.importType = &quot;all&quot;;</span>
<a href="#l4.63"></a><span id="l4.63">   }</span>
<a href="#l4.64"></a><span id="l4.64"> </span>
<a href="#l4.65"></a><span id="l4.65">   SetUpImportType();</span>
<a href="#l4.66"></a><span id="l4.66"> </span>
<a href="#l4.67"></a><span id="l4.67">   // on startup, set the focus to the control element</span>
<a href="#l4.68"></a><span id="l4.68">   // for accessibility reasons.</span>
<a href="#l4.69"></a><span id="l4.69">   // if we used the wizardOverlay, we would get this for free.</span>
<a href="#l4.70"></a><span id="l4.70">   // see bug #101874</span>
<a href="#l4.71"></a><span id="l4.71">   document.getElementById(&quot;importFields&quot;).focus();</span>
<a href="#l4.72"></a><span id="l4.72"> }</span>
<a href="#l4.73"></a><span id="l4.73"> </span>
<a href="#l4.74"></a><span id="l4.74"> </span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-function SetUpImportType()</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-{</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+function SetUpImportType() {</span>
<a href="#l4.78"></a><span id="l4.78">   // set dialog title</span>
<a href="#l4.79"></a><span id="l4.79">   document.getElementById(&quot;importFields&quot;).value = gImportType;</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81">   // Mac migration not working right now, so disable it.</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  if (Services.appinfo.OS == &quot;Darwin&quot;)</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-  {</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+  if (Services.appinfo.OS == &quot;Darwin&quot;) {</span>
<a href="#l4.85"></a><span id="l4.85">     document.getElementById(&quot;allRadio&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l4.86"></a><span id="l4.86">     if (gImportType == &quot;all&quot;)</span>
<a href="#l4.87"></a><span id="l4.87">       document.getElementById(&quot;importFields&quot;).value = &quot;addressbook&quot;;</span>
<a href="#l4.88"></a><span id="l4.88">   }</span>
<a href="#l4.89"></a><span id="l4.89"> </span>
<a href="#l4.90"></a><span id="l4.90">   let descriptionDeck = document.getElementById(&quot;selectDescriptionDeck&quot;);</span>
<a href="#l4.91"></a><span id="l4.91">   descriptionDeck.selectedIndex = 0;</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-  if (gImportType == &quot;feeds&quot;)</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-  {</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+  if (gImportType == &quot;feeds&quot;) {</span>
<a href="#l4.95"></a><span id="l4.95">     descriptionDeck.selectedIndex = 1;</span>
<a href="#l4.96"></a><span id="l4.96">     ListFeedAccounts();</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+  } else {</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+    ListModules();</span>
<a href="#l4.99"></a><span id="l4.99">   }</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-  else</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-    ListModules();</span>
<a href="#l4.102"></a><span id="l4.102"> }</span>
<a href="#l4.103"></a><span id="l4.103"> </span>
<a href="#l4.104"></a><span id="l4.104"> </span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-function SetDivText(id, text)</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-{</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+function SetDivText(id, text) {</span>
<a href="#l4.108"></a><span id="l4.108">   var div = document.getElementById(id);</span>
<a href="#l4.109"></a><span id="l4.109"> </span>
<a href="#l4.110"></a><span id="l4.110">   if (div) {</span>
<a href="#l4.111"></a><span id="l4.111">     if (!div.hasChildNodes()) {</span>
<a href="#l4.112"></a><span id="l4.112">       var textNode = document.createTextNode(text);</span>
<a href="#l4.113"></a><span id="l4.113">       div.appendChild(textNode);</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-    }</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-    else if (div.childNodes.length == 1) {</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+    } else if (div.childNodes.length == 1) {</span>
<a href="#l4.117"></a><span id="l4.117">       div.childNodes[0].nodeValue = text;</span>
<a href="#l4.118"></a><span id="l4.118">     }</span>
<a href="#l4.119"></a><span id="l4.119">   }</span>
<a href="#l4.120"></a><span id="l4.120"> }</span>
<a href="#l4.121"></a><span id="l4.121"> </span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-function CheckIfLocalFolderExists()</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-{</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+function CheckIfLocalFolderExists() {</span>
<a href="#l4.125"></a><span id="l4.125">   try {</span>
<a href="#l4.126"></a><span id="l4.126">     if (MailServices.accounts.localFoldersServer)</span>
<a href="#l4.127"></a><span id="l4.127">       gProgressInfo.localFolderExists = true;</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-  }</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-  catch (ex) {</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+  } catch (ex) {</span>
<a href="#l4.131"></a><span id="l4.131">     gProgressInfo.localFolderExists = false;</span>
<a href="#l4.132"></a><span id="l4.132">   }</span>
<a href="#l4.133"></a><span id="l4.133"> }</span>
<a href="#l4.134"></a><span id="l4.134"> </span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-async function ImportDialogOKButton()</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-{</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+async function ImportDialogOKButton() {</span>
<a href="#l4.138"></a><span id="l4.138">   var listbox = document.getElementById(&quot;moduleList&quot;);</span>
<a href="#l4.139"></a><span id="l4.139">   var deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.140"></a><span id="l4.140">   var header = document.getElementById(&quot;header&quot;);</span>
<a href="#l4.141"></a><span id="l4.141">   var progressMeterEl = document.getElementById(&quot;progressMeter&quot;);</span>
<a href="#l4.142"></a><span id="l4.142">   progressMeterEl.value = 0;</span>
<a href="#l4.143"></a><span id="l4.143">   var progressStatusEl = document.getElementById(&quot;progressStatus&quot;);</span>
<a href="#l4.144"></a><span id="l4.144">   var progressTitleEl = document.getElementById(&quot;progressTitle&quot;);</span>
<a href="#l4.145"></a><span id="l4.145"> </span>
<a href="#l4.146"></a><span id="l4.146">   // better not mess around with navigation at this point</span>
<a href="#l4.147"></a><span id="l4.147">   var nextButton = document.getElementById(&quot;forward&quot;);</span>
<a href="#l4.148"></a><span id="l4.148">   nextButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l4.149"></a><span id="l4.149">   var backButton = document.getElementById(&quot;back&quot;);</span>
<a href="#l4.150"></a><span id="l4.150">   backButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l4.151"></a><span id="l4.151"> </span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-  if (listbox &amp;&amp; (listbox.selectedCount == 1))</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-  {</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+  if (listbox &amp;&amp; (listbox.selectedCount == 1)) {</span>
<a href="#l4.155"></a><span id="l4.155">     let module = &quot;&quot;;</span>
<a href="#l4.156"></a><span id="l4.156">     let name = &quot;&quot;;</span>
<a href="#l4.157"></a><span id="l4.157">     gImportType = document.getElementById(&quot;importFields&quot;).value;</span>
<a href="#l4.158"></a><span id="l4.158">     let index = listbox.selectedItem.getAttribute(&quot;list-index&quot;);</span>
<a href="#l4.159"></a><span id="l4.159">     if (index == -1)</span>
<a href="#l4.160"></a><span id="l4.160">       return false;</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-    if (gImportType == &quot;feeds&quot;)</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+    if (gImportType == &quot;feeds&quot;) {</span>
<a href="#l4.163"></a><span id="l4.163">       module = &quot;Feeds&quot;;</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-    else</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    {</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineplus">+    } else {</span>
<a href="#l4.167"></a><span id="l4.167">       module = gImportService.GetModule(gImportType, index);</span>
<a href="#l4.168"></a><span id="l4.168">       name = gImportService.GetModuleName(gImportType, index);</span>
<a href="#l4.169"></a><span id="l4.169">     }</span>
<a href="#l4.170"></a><span id="l4.170">     gSelectedModuleName = name;</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-    if (module)</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineminus">-    {</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+    if (module) {</span>
<a href="#l4.174"></a><span id="l4.174">       // Fix for Bug 57839 &amp; 85219</span>
<a href="#l4.175"></a><span id="l4.175">       // We use localFoldersServer(in nsIMsgAccountManager) to check if Local Folder exists.</span>
<a href="#l4.176"></a><span id="l4.176">       // We need to check localFoldersServer before importing &quot;mail&quot;, &quot;settings&quot;, or &quot;filters&quot;.</span>
<a href="#l4.177"></a><span id="l4.177">       // Reason: We will create an account with an incoming server of type &quot;none&quot; after</span>
<a href="#l4.178"></a><span id="l4.178">       // importing &quot;mail&quot;, so the localFoldersServer is valid even though the Local Folder</span>
<a href="#l4.179"></a><span id="l4.179">       // is not created.</span>
<a href="#l4.180"></a><span id="l4.180">       if (gImportType == &quot;mail&quot; || gImportType == &quot;settings&quot; || gImportType == &quot;filters&quot;)</span>
<a href="#l4.181"></a><span id="l4.181">         CheckIfLocalFolderExists();</span>
<a href="#l4.182"></a><span id="l4.182"> </span>
<a href="#l4.183"></a><span id="l4.183">       let meterText = &quot;&quot;;</span>
<a href="#l4.184"></a><span id="l4.184">       let error = {};</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineminus">-      switch(gImportType)</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineminus">-      {</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+      switch (gImportType) {</span>
<a href="#l4.188"></a><span id="l4.188">         case &quot;mail&quot;:</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-          if (ImportMail(module, gSuccessStr, gErrorStr))</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineminus">-          {</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+          if (ImportMail(module, gSuccessStr, gErrorStr)) {</span>
<a href="#l4.192"></a><span id="l4.192">             // We think it was a success, either, we need to</span>
<a href="#l4.193"></a><span id="l4.193">             // wait for the import to finish</span>
<a href="#l4.194"></a><span id="l4.194">             // or we are done!</span>
<a href="#l4.195"></a><span id="l4.195">             if (gProgressInfo.importInterface == null) {</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineminus">-              ShowImportResults(true, 'Mail');</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineminus">-              return true;</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-            }</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-            else {</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-              meterText = gImportMsgsBundle.getFormattedString('MailProgressMeterText',</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-                                                               [ name ]);</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-              header.setAttribute(&quot;description&quot;, meterText);</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-              progressStatusEl.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-              progressTitleEl.setAttribute(&quot;label&quot;, meterText);</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-              deck.selectedIndex = 2;</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineminus">-              gProgressInfo.progressWindow = window;</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineminus">-              gProgressInfo.intervalState = setInterval(ContinueImportCallback, 100);</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineplus">+              ShowImportResults(true, &quot;Mail&quot;);</span>
<a href="#l4.211"></a><span id="l4.211">               return true;</span>
<a href="#l4.212"></a><span id="l4.212">             }</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineplus">+            meterText = gImportMsgsBundle.getFormattedString(&quot;MailProgressMeterText&quot;, [ name ]);</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineplus">+            header.setAttribute(&quot;description&quot;, meterText);</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+            progressStatusEl.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+            progressTitleEl.setAttribute(&quot;label&quot;, meterText);</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineplus">+</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineplus">+            deck.selectedIndex = 2;</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineplus">+            gProgressInfo.progressWindow = window;</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+            gProgressInfo.intervalState = setInterval(ContinueImportCallback, 100);</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+            return true;</span>
<a href="#l4.224"></a><span id="l4.224">           }</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineminus">-          else</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineminus">-          {</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineminus">-            ShowImportResults(false, 'Mail');</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineminus">-            // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineminus">-            // Enable next, so they can try again.</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineminus">-            nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineminus">-            // Also enable back button so that users can pick other import options.</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-            backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-            return false;</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-          }</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-          break;</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineplus">+          ShowImportResults(false, &quot;Mail&quot;);</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineplus">+          // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineplus">+          // Enable next, so they can try again.</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+          nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+          // Also enable back button so that users can pick other import options.</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+          backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+          return false;</span>
<a href="#l4.244"></a><span id="l4.244"> </span>
<a href="#l4.245"></a><span id="l4.245">         case &quot;feeds&quot;:</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-          if (await ImportFeeds())</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-          {</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+          if (await ImportFeeds()) {</span>
<a href="#l4.249"></a><span id="l4.249">             // Successful completion of pre processing and launch of async import.</span>
<a href="#l4.250"></a><span id="l4.250">             meterText = document.getElementById(&quot;description&quot;).textContent;</span>
<a href="#l4.251"></a><span id="l4.251">             header.setAttribute(&quot;description&quot;, meterText);</span>
<a href="#l4.252"></a><span id="l4.252"> </span>
<a href="#l4.253"></a><span id="l4.253">             progressStatusEl.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l4.254"></a><span id="l4.254">             progressTitleEl.setAttribute(&quot;label&quot;, meterText);</span>
<a href="#l4.255"></a><span id="l4.255">             progressMeterEl.removeAttribute(&quot;value&quot;);</span>
<a href="#l4.256"></a><span id="l4.256"> </span>
<a href="#l4.257"></a><span id="l4.257">             deck.selectedIndex = 2;</span>
<a href="#l4.258"></a><span id="l4.258">             return true;</span>
<a href="#l4.259"></a><span id="l4.259">           }</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-          else</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-          {</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-            // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-            // Enable next, so they can try again.</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-            nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-            // Also enable back button so that users can pick other import options.</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-            backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-            return false;</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-          }</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-          break;</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+          // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+          // Enable next, so they can try again.</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineplus">+          nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+          // Also enable back button so that users can pick other import options.</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+          backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+          return false;</span>
<a href="#l4.277"></a><span id="l4.277"> </span>
<a href="#l4.278"></a><span id="l4.278">         case &quot;addressbook&quot;:</span>
<a href="#l4.279"></a><span id="l4.279">           if (await ImportAddress(module, gSuccessStr, gErrorStr)) {</span>
<a href="#l4.280"></a><span id="l4.280">             // We think it was a success, either, we need to</span>
<a href="#l4.281"></a><span id="l4.281">             // wait for the import to finish</span>
<a href="#l4.282"></a><span id="l4.282">             // or we are done!</span>
<a href="#l4.283"></a><span id="l4.283">             if (gProgressInfo.importInterface == null) {</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-              ShowImportResults(true, 'Address');</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+              ShowImportResults(true, &quot;Address&quot;);</span>
<a href="#l4.286"></a><span id="l4.286">               return true;</span>
<a href="#l4.287"></a><span id="l4.287">             }</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-            else {</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-              meterText = gImportMsgsBundle.getFormattedString('AddrProgressMeterText',</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-                                                               [ name ]);</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-              header.setAttribute(&quot;description&quot;, meterText);</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineplus">+            meterText = gImportMsgsBundle.getFormattedString(&quot;AddrProgressMeterText&quot;, [ name ]);</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineplus">+            header.setAttribute(&quot;description&quot;, meterText);</span>
<a href="#l4.295"></a><span id="l4.295"> </span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-              progressStatusEl.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-              progressTitleEl.setAttribute(&quot;label&quot;, meterText);</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineplus">+            progressStatusEl.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineplus">+            progressTitleEl.setAttribute(&quot;label&quot;, meterText);</span>
<a href="#l4.300"></a><span id="l4.300"> </span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-              deck.selectedIndex = 2;</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-              gProgressInfo.progressWindow = window;</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-              gProgressInfo.intervalState = setInterval(ContinueImportCallback, 100);</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineplus">+            deck.selectedIndex = 2;</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineplus">+            gProgressInfo.progressWindow = window;</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineplus">+            gProgressInfo.intervalState = setInterval(ContinueImportCallback, 100);</span>
<a href="#l4.307"></a><span id="l4.307"> </span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-              return true;</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-            }</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineplus">+            return true;</span>
<a href="#l4.311"></a><span id="l4.311">           }</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-          else</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-          {</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-            ShowImportResults(false, 'Address');</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-            // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-            // Enable next, so they can try again.</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-            nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-            // Also enable back button so that users can pick other import options.</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-            backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-            return false;</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-          }</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-          break;</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineplus">+</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineplus">+          ShowImportResults(false, &quot;Address&quot;);</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineplus">+          // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineplus">+          // Enable next, so they can try again.</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineplus">+          nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineplus">+          // Also enable back button so that users can pick other import options.</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineplus">+          backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineplus">+          return false;</span>
<a href="#l4.331"></a><span id="l4.331"> </span>
<a href="#l4.332"></a><span id="l4.332">         case &quot;settings&quot;:</span>
<a href="#l4.333"></a><span id="l4.333">           error.value = null;</span>
<a href="#l4.334"></a><span id="l4.334">           let newAccount = {};</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-          if (!(await ImportSettings(module, newAccount, error)))</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-          {</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+          if (!(await ImportSettings(module, newAccount, error))) {</span>
<a href="#l4.338"></a><span id="l4.338">             if (error.value)</span>
<a href="#l4.339"></a><span id="l4.339">               ShowImportResultsRaw(gImportMsgsBundle.getString(&quot;ImportSettingsFailed&quot;),</span>
<a href="#l4.340"></a><span id="l4.340">                                    null, false);</span>
<a href="#l4.341"></a><span id="l4.341">             // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.342"></a><span id="l4.342">             // Enable next, so they can try again.</span>
<a href="#l4.343"></a><span id="l4.343">             nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.344"></a><span id="l4.344">             // Also enable back button so that users can pick other import options.</span>
<a href="#l4.345"></a><span id="l4.345">             backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.346"></a><span id="l4.346">             return false;</span>
<a href="#l4.347"></a><span id="l4.347">           }</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-          else</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-            ShowImportResultsRaw(</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-             gImportMsgsBundle.getFormattedString(&quot;ImportSettingsSuccess&quot;, [ name ]),</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-             null, true);</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineplus">+          ShowImportResultsRaw(</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineplus">+            gImportMsgsBundle.getFormattedString(&quot;ImportSettingsSuccess&quot;, [ name ]),</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineplus">+            null, true);</span>
<a href="#l4.355"></a><span id="l4.355">           break;</span>
<a href="#l4.356"></a><span id="l4.356"> </span>
<a href="#l4.357"></a><span id="l4.357">         case &quot;filters&quot;:</span>
<a href="#l4.358"></a><span id="l4.358">           error.value = null;</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineminus">-          if (!ImportFilters(module, error))</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineminus">-          {</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineplus">+          if (!ImportFilters(module, error)) {</span>
<a href="#l4.362"></a><span id="l4.362">             if (error.value)</span>
<a href="#l4.363"></a><span id="l4.363">               ShowImportResultsRaw(</span>
<a href="#l4.364"></a><span id="l4.364">                 gImportMsgsBundle.getFormattedString(&quot;ImportFiltersFailed&quot;, [ name ]),</span>
<a href="#l4.365"></a><span id="l4.365">                 error.value, false);</span>
<a href="#l4.366"></a><span id="l4.366">             // Re-enable the next button, as we are here, because the user cancelled the picking.</span>
<a href="#l4.367"></a><span id="l4.367">             // Enable next, so they can try again.</span>
<a href="#l4.368"></a><span id="l4.368">             nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.369"></a><span id="l4.369">             // Also enable back button so that users can pick other import options.</span>
<a href="#l4.370"></a><span id="l4.370">             backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.371"></a><span id="l4.371">             return false;</span>
<a href="#l4.372"></a><span id="l4.372">           }</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-          else</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-          {</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineminus">-            if (error.value)</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineminus">-              ShowImportResultsRaw(</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineminus">-                gImportMsgsBundle.getFormattedString('ImportFiltersPartial', [ name ]),</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineminus">-                error.value, true);</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-            else</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-              ShowImportResultsRaw(</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-                gImportMsgsBundle.getFormattedString('ImportFiltersSuccess', [ name ]),</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-                null, true);</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineplus">+</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineplus">+          if (error.value) {</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineplus">+            ShowImportResultsRaw(</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineplus">+              gImportMsgsBundle.getFormattedString(&quot;ImportFiltersPartial&quot;, [ name ]),</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineplus">+              error.value, true</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineplus">+            );</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineplus">+          } else {</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineplus">+            ShowImportResultsRaw(</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineplus">+              gImportMsgsBundle.getFormattedString(&quot;ImportFiltersSuccess&quot;, [ name ]),</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineplus">+              null, true</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineplus">+            );</span>
<a href="#l4.394"></a><span id="l4.394">           }</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineplus">+</span>
<a href="#l4.396"></a><span id="l4.396">           break;</span>
<a href="#l4.397"></a><span id="l4.397">       }</span>
<a href="#l4.398"></a><span id="l4.398">     }</span>
<a href="#l4.399"></a><span id="l4.399">   }</span>
<a href="#l4.400"></a><span id="l4.400"> </span>
<a href="#l4.401"></a><span id="l4.401">   return true;</span>
<a href="#l4.402"></a><span id="l4.402"> }</span>
<a href="#l4.403"></a><span id="l4.403"> </span>
<a href="#l4.404"></a><span id="l4.404" class="difflineminus">-function SetStatusText(val)</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineminus">-{</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineplus">+function SetStatusText(val) {</span>
<a href="#l4.407"></a><span id="l4.407">   var progressStatus = document.getElementById(&quot;progressStatus&quot;);</span>
<a href="#l4.408"></a><span id="l4.408">   progressStatus.setAttribute(&quot;label&quot;, val);</span>
<a href="#l4.409"></a><span id="l4.409"> }</span>
<a href="#l4.410"></a><span id="l4.410"> </span>
<a href="#l4.411"></a><span id="l4.411" class="difflineminus">-function SetProgress(val)</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineminus">-{</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineplus">+function SetProgress(val) {</span>
<a href="#l4.414"></a><span id="l4.414">   var progressMeter = document.getElementById(&quot;progressMeter&quot;);</span>
<a href="#l4.415"></a><span id="l4.415">   progressMeter.value = val;</span>
<a href="#l4.416"></a><span id="l4.416"> }</span>
<a href="#l4.417"></a><span id="l4.417"> </span>
<a href="#l4.418"></a><span id="l4.418" class="difflineminus">-function ContinueImportCallback()</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineminus">-{</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineplus">+function ContinueImportCallback() {</span>
<a href="#l4.421"></a><span id="l4.421">   gProgressInfo.mainWindow.ContinueImport(gProgressInfo);</span>
<a href="#l4.422"></a><span id="l4.422"> }</span>
<a href="#l4.423"></a><span id="l4.423"> </span>
<a href="#l4.424"></a><span id="l4.424" class="difflineminus">-function ImportSelectionChanged()</span>
<a href="#l4.425"></a><span id="l4.425" class="difflineminus">-{</span>
<a href="#l4.426"></a><span id="l4.426" class="difflineminus">-  let listbox = document.getElementById('moduleList');</span>
<a href="#l4.427"></a><span id="l4.427" class="difflineminus">-  let acctNameBox = document.getElementById('acctName-box');</span>
<a href="#l4.428"></a><span id="l4.428" class="difflineminus">-  if (listbox &amp;&amp; (listbox.selectedCount == 1))</span>
<a href="#l4.429"></a><span id="l4.429" class="difflineminus">-  {</span>
<a href="#l4.430"></a><span id="l4.430" class="difflineplus">+function ImportSelectionChanged() {</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineplus">+  let listbox = document.getElementById(&quot;moduleList&quot;);</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineplus">+  let acctNameBox = document.getElementById(&quot;acctName-box&quot;);</span>
<a href="#l4.433"></a><span id="l4.433" class="difflineplus">+  if (listbox &amp;&amp; (listbox.selectedCount == 1)) {</span>
<a href="#l4.434"></a><span id="l4.434">     let index = listbox.selectedItem.getAttribute(&quot;list-index&quot;);</span>
<a href="#l4.435"></a><span id="l4.435">     if (index == -1)</span>
<a href="#l4.436"></a><span id="l4.436">       return;</span>
<a href="#l4.437"></a><span id="l4.437" class="difflineminus">-    acctNameBox.setAttribute('style', 'visibility: hidden;');</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-    if (gImportType == &quot;feeds&quot;)</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-    {</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-      if (index == 0)</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineminus">-      {</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineminus">-        SetDivText('description', gFeedsBundle.getString('ImportFeedsNewAccount'));</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineplus">+    acctNameBox.setAttribute(&quot;style&quot;, &quot;visibility: hidden;&quot;);</span>
<a href="#l4.444"></a><span id="l4.444" class="difflineplus">+    if (gImportType == &quot;feeds&quot;) {</span>
<a href="#l4.445"></a><span id="l4.445" class="difflineplus">+      if (index == 0) {</span>
<a href="#l4.446"></a><span id="l4.446" class="difflineplus">+        SetDivText(&quot;description&quot;, gFeedsBundle.getString(&quot;ImportFeedsNewAccount&quot;));</span>
<a href="#l4.447"></a><span id="l4.447">         let defaultName = gFeedsBundle.getString(&quot;feeds-accountname&quot;);</span>
<a href="#l4.448"></a><span id="l4.448">         document.getElementById(&quot;acctName&quot;).value = defaultName;</span>
<a href="#l4.449"></a><span id="l4.449" class="difflineminus">-        acctNameBox.removeAttribute('style');</span>
<a href="#l4.450"></a><span id="l4.450" class="difflineplus">+        acctNameBox.removeAttribute(&quot;style&quot;);</span>
<a href="#l4.451"></a><span id="l4.451" class="difflineplus">+      } else {</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineplus">+        SetDivText(&quot;description&quot;, gFeedsBundle.getString(&quot;ImportFeedsExistingAccount&quot;));</span>
<a href="#l4.453"></a><span id="l4.453">       }</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-      else</span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-        SetDivText('description', gFeedsBundle.getString('ImportFeedsExistingAccount'));</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineplus">+    } else {</span>
<a href="#l4.457"></a><span id="l4.457" class="difflineplus">+      SetDivText(&quot;description&quot;, gImportService.GetModuleDescription(gImportType, index));</span>
<a href="#l4.458"></a><span id="l4.458">     }</span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-    else</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-      SetDivText(&quot;description&quot;, gImportService.GetModuleDescription(gImportType, index));</span>
<a href="#l4.461"></a><span id="l4.461">   }</span>
<a href="#l4.462"></a><span id="l4.462"> }</span>
<a href="#l4.463"></a><span id="l4.463"> </span>
<a href="#l4.464"></a><span id="l4.464" class="difflineminus">-function CompareImportModuleName(a, b)</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineminus">-{</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineplus">+function CompareImportModuleName(a, b) {</span>
<a href="#l4.467"></a><span id="l4.467">   if (a.name &gt; b.name)</span>
<a href="#l4.468"></a><span id="l4.468">     return 1;</span>
<a href="#l4.469"></a><span id="l4.469">   if (a.name &lt; b.name)</span>
<a href="#l4.470"></a><span id="l4.470">     return -1;</span>
<a href="#l4.471"></a><span id="l4.471">   return 0;</span>
<a href="#l4.472"></a><span id="l4.472"> }</span>
<a href="#l4.473"></a><span id="l4.473"> </span>
<a href="#l4.474"></a><span id="l4.474"> function ListModules() {</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineat">@@ -393,25 +355,24 @@ function ListModules() {</span>
<a href="#l4.476"></a><span id="l4.476">   // sort the array of modules by name, so that they'll show up in the right order</span>
<a href="#l4.477"></a><span id="l4.477">   moduleArray.sort(CompareImportModuleName);</span>
<a href="#l4.478"></a><span id="l4.478"> </span>
<a href="#l4.479"></a><span id="l4.479">   for (i = 0; i &lt; count; i++) {</span>
<a href="#l4.480"></a><span id="l4.480">     AddModuleToList(moduleArray[i].name, moduleArray[i].index);</span>
<a href="#l4.481"></a><span id="l4.481">   }</span>
<a href="#l4.482"></a><span id="l4.482"> }</span>
<a href="#l4.483"></a><span id="l4.483"> </span>
<a href="#l4.484"></a><span id="l4.484" class="difflineminus">-function AddModuleToList(moduleName, index)</span>
<a href="#l4.485"></a><span id="l4.485" class="difflineminus">-{</span>
<a href="#l4.486"></a><span id="l4.486" class="difflineplus">+function AddModuleToList(moduleName, index) {</span>
<a href="#l4.487"></a><span id="l4.487">   var body = document.getElementById(&quot;moduleList&quot;);</span>
<a href="#l4.488"></a><span id="l4.488"> </span>
<a href="#l4.489"></a><span id="l4.489">   let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l4.490"></a><span id="l4.490">   let label = document.createElement(&quot;label&quot;);</span>
<a href="#l4.491"></a><span id="l4.491">   label.setAttribute(&quot;value&quot;, moduleName);</span>
<a href="#l4.492"></a><span id="l4.492">   item.appendChild(label);</span>
<a href="#l4.493"></a><span id="l4.493" class="difflineminus">-  item.setAttribute('list-index', index);</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineplus">+  item.setAttribute(&quot;list-index&quot;, index);</span>
<a href="#l4.495"></a><span id="l4.495">   body.appendChild(item);</span>
<a href="#l4.496"></a><span id="l4.496"> }</span>
<a href="#l4.497"></a><span id="l4.497"> </span>
<a href="#l4.498"></a><span id="l4.498"> function ListFeedAccounts() {</span>
<a href="#l4.499"></a><span id="l4.499">   let body = document.getElementById(&quot;moduleList&quot;);</span>
<a href="#l4.500"></a><span id="l4.500">   while (body.hasChildNodes())</span>
<a href="#l4.501"></a><span id="l4.501">     body.lastChild.remove();</span>
<a href="#l4.502"></a><span id="l4.502"> </span>
<a href="#l4.503"></a><span id="l4.503" class="difflineat">@@ -437,132 +398,120 @@ function ListFeedAccounts() {</span>
<a href="#l4.504"></a><span id="l4.504">   }, this);</span>
<a href="#l4.505"></a><span id="l4.505"> </span>
<a href="#l4.506"></a><span id="l4.506">   if (index)</span>
<a href="#l4.507"></a><span id="l4.507">     // If there is an existing feed account, select the first one.</span>
<a href="#l4.508"></a><span id="l4.508">     body.selectedIndex = 1;</span>
<a href="#l4.509"></a><span id="l4.509"> }</span>
<a href="#l4.510"></a><span id="l4.510"> </span>
<a href="#l4.511"></a><span id="l4.511"> function ContinueImport(info) {</span>
<a href="#l4.512"></a><span id="l4.512" class="difflineminus">-  var isMail = info.importType == 'mail';</span>
<a href="#l4.513"></a><span id="l4.513" class="difflineplus">+  var isMail = info.importType == &quot;mail&quot;;</span>
<a href="#l4.514"></a><span id="l4.514">   var clear = true;</span>
<a href="#l4.515"></a><span id="l4.515">   var deck;</span>
<a href="#l4.516"></a><span id="l4.516">   var pcnt;</span>
<a href="#l4.517"></a><span id="l4.517"> </span>
<a href="#l4.518"></a><span id="l4.518">   if (info.importInterface) {</span>
<a href="#l4.519"></a><span id="l4.519">     if (!info.importInterface.ContinueImport()) {</span>
<a href="#l4.520"></a><span id="l4.520">       info.importSuccess = false;</span>
<a href="#l4.521"></a><span id="l4.521">       clearInterval(info.intervalState);</span>
<a href="#l4.522"></a><span id="l4.522">       if (info.progressWindow != null) {</span>
<a href="#l4.523"></a><span id="l4.523">         deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.524"></a><span id="l4.524">         deck.selectedIndex = 3;</span>
<a href="#l4.525"></a><span id="l4.525">         info.progressWindow = null;</span>
<a href="#l4.526"></a><span id="l4.526">       }</span>
<a href="#l4.527"></a><span id="l4.527"> </span>
<a href="#l4.528"></a><span id="l4.528" class="difflineminus">-      ShowImportResults(false, isMail ? 'Mail' : 'Address');</span>
<a href="#l4.529"></a><span id="l4.529" class="difflineminus">-    }</span>
<a href="#l4.530"></a><span id="l4.530" class="difflineminus">-    else if ((pcnt = info.importInterface.GetProgress()) &lt; 100) {</span>
<a href="#l4.531"></a><span id="l4.531" class="difflineplus">+      ShowImportResults(false, isMail ? &quot;Mail&quot; : &quot;Address&quot;);</span>
<a href="#l4.532"></a><span id="l4.532" class="difflineplus">+    } else if ((pcnt = info.importInterface.GetProgress()) &lt; 100) {</span>
<a href="#l4.533"></a><span id="l4.533">       clear = false;</span>
<a href="#l4.534"></a><span id="l4.534">       if (info.progressWindow != null) {</span>
<a href="#l4.535"></a><span id="l4.535">         if (pcnt &lt; 5)</span>
<a href="#l4.536"></a><span id="l4.536">           pcnt = 5;</span>
<a href="#l4.537"></a><span id="l4.537">         SetProgress(pcnt);</span>
<a href="#l4.538"></a><span id="l4.538">         if (isMail) {</span>
<a href="#l4.539"></a><span id="l4.539">           let mailName = info.importInterface.GetData(&quot;currentMailbox&quot;);</span>
<a href="#l4.540"></a><span id="l4.540">           if (mailName) {</span>
<a href="#l4.541"></a><span id="l4.541">             mailName = mailName.QueryInterface(Ci.nsISupportsString);</span>
<a href="#l4.542"></a><span id="l4.542">             if (mailName)</span>
<a href="#l4.543"></a><span id="l4.543">               SetStatusText(mailName.data);</span>
<a href="#l4.544"></a><span id="l4.544">           }</span>
<a href="#l4.545"></a><span id="l4.545">         }</span>
<a href="#l4.546"></a><span id="l4.546">       }</span>
<a href="#l4.547"></a><span id="l4.547" class="difflineminus">-    }</span>
<a href="#l4.548"></a><span id="l4.548" class="difflineminus">-    else {</span>
<a href="#l4.549"></a><span id="l4.549" class="difflineplus">+    } else {</span>
<a href="#l4.550"></a><span id="l4.550">       dump(&quot;*** WARNING! sometimes this shows results too early. \n&quot;);</span>
<a href="#l4.551"></a><span id="l4.551">       dump(&quot;    something screwy here. this used to work fine.\n&quot;);</span>
<a href="#l4.552"></a><span id="l4.552">       clearInterval(info.intervalState);</span>
<a href="#l4.553"></a><span id="l4.553">       info.importSuccess = true;</span>
<a href="#l4.554"></a><span id="l4.554">       if (info.progressWindow) {</span>
<a href="#l4.555"></a><span id="l4.555">         deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.556"></a><span id="l4.556">         deck.selectedIndex = 3;</span>
<a href="#l4.557"></a><span id="l4.557">         info.progressWindow = null;</span>
<a href="#l4.558"></a><span id="l4.558">       }</span>
<a href="#l4.559"></a><span id="l4.559"> </span>
<a href="#l4.560"></a><span id="l4.560" class="difflineminus">-      ShowImportResults(true, isMail ? 'Mail' : 'Address');</span>
<a href="#l4.561"></a><span id="l4.561" class="difflineplus">+      ShowImportResults(true, isMail ? &quot;Mail&quot; : &quot;Address&quot;);</span>
<a href="#l4.562"></a><span id="l4.562">     }</span>
<a href="#l4.563"></a><span id="l4.563">   }</span>
<a href="#l4.564"></a><span id="l4.564">   if (clear) {</span>
<a href="#l4.565"></a><span id="l4.565">     info.intervalState = null;</span>
<a href="#l4.566"></a><span id="l4.566">     info.importInterface = null;</span>
<a href="#l4.567"></a><span id="l4.567">   }</span>
<a href="#l4.568"></a><span id="l4.568"> }</span>
<a href="#l4.569"></a><span id="l4.569"> </span>
<a href="#l4.570"></a><span id="l4.570"> </span>
<a href="#l4.571"></a><span id="l4.571" class="difflineminus">-function ShowResults(doesWantProgress, result)</span>
<a href="#l4.572"></a><span id="l4.572" class="difflineminus">-{</span>
<a href="#l4.573"></a><span id="l4.573" class="difflineminus">-  if (result)</span>
<a href="#l4.574"></a><span id="l4.574" class="difflineminus">-  {</span>
<a href="#l4.575"></a><span id="l4.575" class="difflineminus">-    if (doesWantProgress)</span>
<a href="#l4.576"></a><span id="l4.576" class="difflineminus">-    {</span>
<a href="#l4.577"></a><span id="l4.577" class="difflineplus">+function ShowResults(doesWantProgress, result) {</span>
<a href="#l4.578"></a><span id="l4.578" class="difflineplus">+  if (result) {</span>
<a href="#l4.579"></a><span id="l4.579" class="difflineplus">+    if (doesWantProgress) {</span>
<a href="#l4.580"></a><span id="l4.580">       let deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.581"></a><span id="l4.581">       let header = document.getElementById(&quot;header&quot;);</span>
<a href="#l4.582"></a><span id="l4.582">       let progressStatusEl = document.getElementById(&quot;progressStatus&quot;);</span>
<a href="#l4.583"></a><span id="l4.583">       let progressTitleEl = document.getElementById(&quot;progressTitle&quot;);</span>
<a href="#l4.584"></a><span id="l4.584"> </span>
<a href="#l4.585"></a><span id="l4.585">       let meterText = gImportMsgsBundle.getFormattedString(&quot;AddrProgressMeterText&quot;, [ name ]);</span>
<a href="#l4.586"></a><span id="l4.586">       header.setAttribute(&quot;description&quot;, meterText);</span>
<a href="#l4.587"></a><span id="l4.587"> </span>
<a href="#l4.588"></a><span id="l4.588">       progressStatusEl.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l4.589"></a><span id="l4.589">       progressTitleEl.setAttribute(&quot;label&quot;, meterText);</span>
<a href="#l4.590"></a><span id="l4.590"> </span>
<a href="#l4.591"></a><span id="l4.591">       deck.selectedIndex = 2;</span>
<a href="#l4.592"></a><span id="l4.592">       gProgressInfo.progressWindow = window;</span>
<a href="#l4.593"></a><span id="l4.593">       gProgressInfo.intervalState = setInterval(ContinueImportCallback, 100);</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineminus">-    }</span>
<a href="#l4.595"></a><span id="l4.595" class="difflineminus">-    else</span>
<a href="#l4.596"></a><span id="l4.596" class="difflineminus">-    {</span>
<a href="#l4.597"></a><span id="l4.597" class="difflineminus">-      ShowImportResults(true, 'Address');</span>
<a href="#l4.598"></a><span id="l4.598" class="difflineplus">+    } else {</span>
<a href="#l4.599"></a><span id="l4.599" class="difflineplus">+      ShowImportResults(true, &quot;Address&quot;);</span>
<a href="#l4.600"></a><span id="l4.600">     }</span>
<a href="#l4.601"></a><span id="l4.601" class="difflineminus">-  }</span>
<a href="#l4.602"></a><span id="l4.602" class="difflineminus">-  else</span>
<a href="#l4.603"></a><span id="l4.603" class="difflineminus">-  {</span>
<a href="#l4.604"></a><span id="l4.604" class="difflineminus">-    ShowImportResults(false, 'Address');</span>
<a href="#l4.605"></a><span id="l4.605" class="difflineplus">+  } else {</span>
<a href="#l4.606"></a><span id="l4.606" class="difflineplus">+    ShowImportResults(false, &quot;Address&quot;);</span>
<a href="#l4.607"></a><span id="l4.607">   }</span>
<a href="#l4.608"></a><span id="l4.608"> </span>
<a href="#l4.609"></a><span id="l4.609">   return true;</span>
<a href="#l4.610"></a><span id="l4.610"> }</span>
<a href="#l4.611"></a><span id="l4.611"> </span>
<a href="#l4.612"></a><span id="l4.612" class="difflineminus">-function ShowImportResults(good, module)</span>
<a href="#l4.613"></a><span id="l4.613" class="difflineminus">-{</span>
<a href="#l4.614"></a><span id="l4.614" class="difflineplus">+function ShowImportResults(good, module) {</span>
<a href="#l4.615"></a><span id="l4.615">   // String keys for ImportSettingsSuccess, ImportSettingsFailed,</span>
<a href="#l4.616"></a><span id="l4.616">   // ImportMailSuccess, ImportMailFailed, ImportAddressSuccess,</span>
<a href="#l4.617"></a><span id="l4.617">   // ImportAddressFailed, ImportFiltersSuccess, and ImportFiltersFailed.</span>
<a href="#l4.618"></a><span id="l4.618" class="difflineminus">-  var modSuccess = 'Import' + module + 'Success';</span>
<a href="#l4.619"></a><span id="l4.619" class="difflineminus">-  var modFailed = 'Import' + module + 'Failed';</span>
<a href="#l4.620"></a><span id="l4.620" class="difflineplus">+  var modSuccess = &quot;Import&quot; + module + &quot;Success&quot;;</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineplus">+  var modFailed = &quot;Import&quot; + module + &quot;Failed&quot;;</span>
<a href="#l4.622"></a><span id="l4.622"> </span>
<a href="#l4.623"></a><span id="l4.623">   // The callers seem to set 'good' to true even if there's something</span>
<a href="#l4.624"></a><span id="l4.624">   // in the error log. So we should only make it a success case if</span>
<a href="#l4.625"></a><span id="l4.625">   // error log/str is empty.</span>
<a href="#l4.626"></a><span id="l4.626">   var results, title;</span>
<a href="#l4.627"></a><span id="l4.627">   var moduleName = gSelectedModuleName ? gSelectedModuleName : &quot;&quot;;</span>
<a href="#l4.628"></a><span id="l4.628">   if (good &amp;&amp; !gErrorStr.data) {</span>
<a href="#l4.629"></a><span id="l4.629">     title = gImportMsgsBundle.getFormattedString(modSuccess, [ moduleName ]);</span>
<a href="#l4.630"></a><span id="l4.630">     results = gSuccessStr.data;</span>
<a href="#l4.631"></a><span id="l4.631" class="difflineminus">-  }</span>
<a href="#l4.632"></a><span id="l4.632" class="difflineminus">-  else if (gErrorStr.data) {</span>
<a href="#l4.633"></a><span id="l4.633" class="difflineplus">+  } else if (gErrorStr.data) {</span>
<a href="#l4.634"></a><span id="l4.634">     title = gImportMsgsBundle.getFormattedString(modFailed, [ moduleName ]);</span>
<a href="#l4.635"></a><span id="l4.635">     results = gErrorStr.data;</span>
<a href="#l4.636"></a><span id="l4.636">   }</span>
<a href="#l4.637"></a><span id="l4.637"> </span>
<a href="#l4.638"></a><span id="l4.638">   if (results &amp;&amp; title)</span>
<a href="#l4.639"></a><span id="l4.639">     ShowImportResultsRaw(title, results, good);</span>
<a href="#l4.640"></a><span id="l4.640"> }</span>
<a href="#l4.641"></a><span id="l4.641"> </span>
<a href="#l4.642"></a><span id="l4.642" class="difflineminus">-function ShowImportResultsRaw(title, results, good)</span>
<a href="#l4.643"></a><span id="l4.643" class="difflineminus">-{</span>
<a href="#l4.644"></a><span id="l4.644" class="difflineplus">+function ShowImportResultsRaw(title, results, good) {</span>
<a href="#l4.645"></a><span id="l4.645">   SetDivText(&quot;status&quot;, title);</span>
<a href="#l4.646"></a><span id="l4.646">   var header = document.getElementById(&quot;header&quot;);</span>
<a href="#l4.647"></a><span id="l4.647">   header.setAttribute(&quot;description&quot;, title);</span>
<a href="#l4.648"></a><span id="l4.648">   dump(&quot;*** results = &quot; + results + &quot;\n&quot;);</span>
<a href="#l4.649"></a><span id="l4.649">   attachStrings(&quot;results&quot;, results);</span>
<a href="#l4.650"></a><span id="l4.650">   var deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.651"></a><span id="l4.651">   deck.selectedIndex = 3;</span>
<a href="#l4.652"></a><span id="l4.652">   var nextButton = document.getElementById(&quot;forward&quot;);</span>
<a href="#l4.653"></a><span id="l4.653" class="difflineat">@@ -577,29 +526,28 @@ function ShowImportResultsRaw(title, res</span>
<a href="#l4.654"></a><span id="l4.654">   // importing &quot;mail&quot; and &quot;settings&quot;</span>
<a href="#l4.655"></a><span id="l4.655">   var checkLocalFolder = (gProgressInfo.importType == &quot;mail&quot; ||</span>
<a href="#l4.656"></a><span id="l4.656">                           gProgressInfo.importType == &quot;settings&quot;);</span>
<a href="#l4.657"></a><span id="l4.657">   if (good &amp;&amp; checkLocalFolder &amp;&amp; !gProgressInfo.localFolderExists) {</span>
<a href="#l4.658"></a><span id="l4.658">     MailServices.accounts.createLocalMailAccount();</span>
<a href="#l4.659"></a><span id="l4.659">   }</span>
<a href="#l4.660"></a><span id="l4.660"> }</span>
<a href="#l4.661"></a><span id="l4.661"> </span>
<a href="#l4.662"></a><span id="l4.662" class="difflineminus">-function attachStrings(aNode, aString)</span>
<a href="#l4.663"></a><span id="l4.663" class="difflineminus">-{</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineplus">+function attachStrings(aNode, aString) {</span>
<a href="#l4.665"></a><span id="l4.665">   var attachNode = document.getElementById(aNode);</span>
<a href="#l4.666"></a><span id="l4.666">   if (!aString) {</span>
<a href="#l4.667"></a><span id="l4.667">     attachNode.parentNode.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l4.668"></a><span id="l4.668">     return;</span>
<a href="#l4.669"></a><span id="l4.669">   }</span>
<a href="#l4.670"></a><span id="l4.670">   var strings = aString.split(&quot;\n&quot;);</span>
<a href="#l4.671"></a><span id="l4.671">   for (let string of strings) {</span>
<a href="#l4.672"></a><span id="l4.672">     if (string) {</span>
<a href="#l4.673"></a><span id="l4.673">       let currNode = document.createTextNode(string);</span>
<a href="#l4.674"></a><span id="l4.674">       attachNode.appendChild(currNode);</span>
<a href="#l4.675"></a><span id="l4.675" class="difflineminus">-      let br = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, 'br');</span>
<a href="#l4.676"></a><span id="l4.676" class="difflineplus">+      let br = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;br&quot;);</span>
<a href="#l4.677"></a><span id="l4.677">       attachNode.appendChild(br);</span>
<a href="#l4.678"></a><span id="l4.678">     }</span>
<a href="#l4.679"></a><span id="l4.679">   }</span>
<a href="#l4.680"></a><span id="l4.680"> }</span>
<a href="#l4.681"></a><span id="l4.681"> </span>
<a href="#l4.682"></a><span id="l4.682"> /**</span>
<a href="#l4.683"></a><span id="l4.683">  * Show the file picker.</span>
<a href="#l4.684"></a><span id="l4.684">  * @return {Promise} the selected file, or null</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineat">@@ -622,17 +570,17 @@ function promptForFile(fp) {</span>
<a href="#l4.686"></a><span id="l4.686">   This is only useful in upgrading - import the settings first, then</span>
<a href="#l4.687"></a><span id="l4.687">   import mail into the account returned from ImportSettings, then</span>
<a href="#l4.688"></a><span id="l4.688">   import address books.</span>
<a href="#l4.689"></a><span id="l4.689">   An error string is returned as error.value</span>
<a href="#l4.690"></a><span id="l4.690"> */</span>
<a href="#l4.691"></a><span id="l4.691"> async function ImportSettings(module, newAccount, error) {</span>
<a href="#l4.692"></a><span id="l4.692">   var setIntf = module.GetImportInterface(&quot;settings&quot;);</span>
<a href="#l4.693"></a><span id="l4.693">   if (!(setIntf instanceof Ci.nsIImportSettings)) {</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineminus">-    error.value = gImportMsgsBundle.getString('ImportSettingsBadModule');</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineplus">+    error.value = gImportMsgsBundle.getString(&quot;ImportSettingsBadModule&quot;);</span>
<a href="#l4.696"></a><span id="l4.696">     return false;</span>
<a href="#l4.697"></a><span id="l4.697">   }</span>
<a href="#l4.698"></a><span id="l4.698"> </span>
<a href="#l4.699"></a><span id="l4.699">   // determine if we can auto find the settings or if we need to ask the user</span>
<a href="#l4.700"></a><span id="l4.700">   var location = {};</span>
<a href="#l4.701"></a><span id="l4.701">   var description = {};</span>
<a href="#l4.702"></a><span id="l4.702">   var result = setIntf.AutoLocate(description, location);</span>
<a href="#l4.703"></a><span id="l4.703">   if (!result) {</span>
<a href="#l4.704"></a><span id="l4.704" class="difflineat">@@ -645,62 +593,58 @@ async function ImportSettings(module, ne</span>
<a href="#l4.705"></a><span id="l4.705">           let file = null;</span>
<a href="#l4.706"></a><span id="l4.706">           try {</span>
<a href="#l4.707"></a><span id="l4.707">             filePicker.init(window,</span>
<a href="#l4.708"></a><span id="l4.708">                             gImportMsgsBundle.getString(&quot;ImportSelectSettings&quot;),</span>
<a href="#l4.709"></a><span id="l4.709">                             filePicker.modeOpen);</span>
<a href="#l4.710"></a><span id="l4.710">             filePicker.appendFilters(filePicker.filterAll);</span>
<a href="#l4.711"></a><span id="l4.711"> </span>
<a href="#l4.712"></a><span id="l4.712">             file = await promptForFile(filePicker);</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineminus">-          }</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineminus">-          catch(ex) {</span>
<a href="#l4.715"></a><span id="l4.715" class="difflineplus">+          } catch (ex) {</span>
<a href="#l4.716"></a><span id="l4.716">             Cu.reportError(ex);</span>
<a href="#l4.717"></a><span id="l4.717">             error.value = null;</span>
<a href="#l4.718"></a><span id="l4.718">             return false;</span>
<a href="#l4.719"></a><span id="l4.719">           }</span>
<a href="#l4.720"></a><span id="l4.720">           if (file != null) {</span>
<a href="#l4.721"></a><span id="l4.721">             setIntf.SetLocation(file);</span>
<a href="#l4.722"></a><span id="l4.722" class="difflineminus">-          }</span>
<a href="#l4.723"></a><span id="l4.723" class="difflineminus">-          else {</span>
<a href="#l4.724"></a><span id="l4.724" class="difflineplus">+          } else {</span>
<a href="#l4.725"></a><span id="l4.725">             error.value = null;</span>
<a href="#l4.726"></a><span id="l4.726">             return false;</span>
<a href="#l4.727"></a><span id="l4.727">           }</span>
<a href="#l4.728"></a><span id="l4.728" class="difflineminus">-      }</span>
<a href="#l4.729"></a><span id="l4.729" class="difflineminus">-      else {</span>
<a href="#l4.730"></a><span id="l4.730" class="difflineminus">-        error.value = gImportMsgsBundle.getString('ImportSettingsNotFound');</span>
<a href="#l4.731"></a><span id="l4.731" class="difflineplus">+      } else {</span>
<a href="#l4.732"></a><span id="l4.732" class="difflineplus">+        error.value = gImportMsgsBundle.getString(&quot;ImportSettingsNotFound&quot;);</span>
<a href="#l4.733"></a><span id="l4.733">         return false;</span>
<a href="#l4.734"></a><span id="l4.734">       }</span>
<a href="#l4.735"></a><span id="l4.735" class="difflineminus">-    }</span>
<a href="#l4.736"></a><span id="l4.736" class="difflineminus">-    else {</span>
<a href="#l4.737"></a><span id="l4.737" class="difflineminus">-      error.value = gImportMsgsBundle.getString('ImportSettingsNotFound');</span>
<a href="#l4.738"></a><span id="l4.738" class="difflineplus">+    } else {</span>
<a href="#l4.739"></a><span id="l4.739" class="difflineplus">+      error.value = gImportMsgsBundle.getString(&quot;ImportSettingsNotFound&quot;);</span>
<a href="#l4.740"></a><span id="l4.740">       return false;</span>
<a href="#l4.741"></a><span id="l4.741">     }</span>
<a href="#l4.742"></a><span id="l4.742">   }</span>
<a href="#l4.743"></a><span id="l4.743"> </span>
<a href="#l4.744"></a><span id="l4.744">   // interesting, we need to return the account that new</span>
<a href="#l4.745"></a><span id="l4.745">   // mail should be imported into?</span>
<a href="#l4.746"></a><span id="l4.746">   // that's really only useful for &quot;Upgrade&quot;</span>
<a href="#l4.747"></a><span id="l4.747">   result = setIntf.Import(newAccount);</span>
<a href="#l4.748"></a><span id="l4.748">   if (!result) {</span>
<a href="#l4.749"></a><span id="l4.749" class="difflineminus">-    error.value = gImportMsgsBundle.getString('ImportSettingsFailed');</span>
<a href="#l4.750"></a><span id="l4.750" class="difflineplus">+    error.value = gImportMsgsBundle.getString(&quot;ImportSettingsFailed&quot;);</span>
<a href="#l4.751"></a><span id="l4.751">   }</span>
<a href="#l4.752"></a><span id="l4.752">   return result;</span>
<a href="#l4.753"></a><span id="l4.753"> }</span>
<a href="#l4.754"></a><span id="l4.754"> </span>
<a href="#l4.755"></a><span id="l4.755"> async function ImportMail(module, success, error) {</span>
<a href="#l4.756"></a><span id="l4.756">   if (gProgressInfo.importInterface || gProgressInfo.intervalState) {</span>
<a href="#l4.757"></a><span id="l4.757" class="difflineminus">-    error.data = gImportMsgsBundle.getString('ImportAlreadyInProgress');</span>
<a href="#l4.758"></a><span id="l4.758" class="difflineplus">+    error.data = gImportMsgsBundle.getString(&quot;ImportAlreadyInProgress&quot;);</span>
<a href="#l4.759"></a><span id="l4.759">     return false;</span>
<a href="#l4.760"></a><span id="l4.760">   }</span>
<a href="#l4.761"></a><span id="l4.761"> </span>
<a href="#l4.762"></a><span id="l4.762">   gProgressInfo.importSuccess = false;</span>
<a href="#l4.763"></a><span id="l4.763"> </span>
<a href="#l4.764"></a><span id="l4.764">   var mailInterface = module.GetImportInterface(&quot;mail&quot;);</span>
<a href="#l4.765"></a><span id="l4.765">   if (!(mailInterface instanceof Ci.nsIImportGeneric)) {</span>
<a href="#l4.766"></a><span id="l4.766" class="difflineminus">-    error.data = gImportMsgsBundle.getString('ImportMailBadModule');</span>
<a href="#l4.767"></a><span id="l4.767" class="difflineplus">+    error.data = gImportMsgsBundle.getString(&quot;ImportMailBadModule&quot;);</span>
<a href="#l4.768"></a><span id="l4.768">     return false;</span>
<a href="#l4.769"></a><span id="l4.769">   }</span>
<a href="#l4.770"></a><span id="l4.770"> </span>
<a href="#l4.771"></a><span id="l4.771">   var loc = mailInterface.GetData(&quot;mailLocation&quot;);</span>
<a href="#l4.772"></a><span id="l4.772"> </span>
<a href="#l4.773"></a><span id="l4.773">   if (loc == null) {</span>
<a href="#l4.774"></a><span id="l4.774">     // No location found, check to see if we can ask the user.</span>
<a href="#l4.775"></a><span id="l4.775">     if (mailInterface.GetStatus(&quot;canUserSetLocation&quot;) != 0) {</span>
<a href="#l4.776"></a><span id="l4.776" class="difflineat">@@ -711,81 +655,78 @@ async function ImportMail(module, succes</span>
<a href="#l4.777"></a><span id="l4.777">                             gImportMsgsBundle.getString(&quot;ImportSelectMailDir&quot;),</span>
<a href="#l4.778"></a><span id="l4.778">                             filePicker.modeGetFolder);</span>
<a href="#l4.779"></a><span id="l4.779">             filePicker.appendFilters(filePicker.filterAll);</span>
<a href="#l4.780"></a><span id="l4.780">             let file = await promptForFile(filePicker);</span>
<a href="#l4.781"></a><span id="l4.781">             if (!file) {</span>
<a href="#l4.782"></a><span id="l4.782">               return false;</span>
<a href="#l4.783"></a><span id="l4.783">             }</span>
<a href="#l4.784"></a><span id="l4.784">             mailInterface.SetData(&quot;mailLocation&quot;, file);</span>
<a href="#l4.785"></a><span id="l4.785" class="difflineminus">-          } catch(ex) {</span>
<a href="#l4.786"></a><span id="l4.786" class="difflineplus">+          } catch (ex) {</span>
<a href="#l4.787"></a><span id="l4.787">             Cu.reportError(ex);</span>
<a href="#l4.788"></a><span id="l4.788">             // don't show an error when we return!</span>
<a href="#l4.789"></a><span id="l4.789">             return false;</span>
<a href="#l4.790"></a><span id="l4.790">           }</span>
<a href="#l4.791"></a><span id="l4.791" class="difflineminus">-      }</span>
<a href="#l4.792"></a><span id="l4.792" class="difflineminus">-      else {</span>
<a href="#l4.793"></a><span id="l4.793" class="difflineminus">-        error.data = gImportMsgsBundle.getString('ImportMailNotFound');</span>
<a href="#l4.794"></a><span id="l4.794" class="difflineplus">+      } else {</span>
<a href="#l4.795"></a><span id="l4.795" class="difflineplus">+        error.data = gImportMsgsBundle.getString(&quot;ImportMailNotFound&quot;);</span>
<a href="#l4.796"></a><span id="l4.796">         return false;</span>
<a href="#l4.797"></a><span id="l4.797">       }</span>
<a href="#l4.798"></a><span id="l4.798" class="difflineminus">-    }</span>
<a href="#l4.799"></a><span id="l4.799" class="difflineminus">-    else {</span>
<a href="#l4.800"></a><span id="l4.800" class="difflineminus">-      error.data = gImportMsgsBundle.getString('ImportMailNotFound');</span>
<a href="#l4.801"></a><span id="l4.801" class="difflineplus">+    } else {</span>
<a href="#l4.802"></a><span id="l4.802" class="difflineplus">+      error.data = gImportMsgsBundle.getString(&quot;ImportMailNotFound&quot;);</span>
<a href="#l4.803"></a><span id="l4.803">       return false;</span>
<a href="#l4.804"></a><span id="l4.804">     }</span>
<a href="#l4.805"></a><span id="l4.805">   }</span>
<a href="#l4.806"></a><span id="l4.806"> </span>
<a href="#l4.807"></a><span id="l4.807">   if (mailInterface.WantsProgress()) {</span>
<a href="#l4.808"></a><span id="l4.808">    if (mailInterface.BeginImport(success, error)) {</span>
<a href="#l4.809"></a><span id="l4.809">       gProgressInfo.importInterface = mailInterface;</span>
<a href="#l4.810"></a><span id="l4.810">       // intervalState = setInterval(ContinueImport, 100);</span>
<a href="#l4.811"></a><span id="l4.811">       return true;</span>
<a href="#l4.812"></a><span id="l4.812">     }</span>
<a href="#l4.813"></a><span id="l4.813" class="difflineminus">-    else</span>
<a href="#l4.814"></a><span id="l4.814" class="difflineminus">-      return false;</span>
<a href="#l4.815"></a><span id="l4.815" class="difflineplus">+    return false;</span>
<a href="#l4.816"></a><span id="l4.816">   }</span>
<a href="#l4.817"></a><span id="l4.817">   return mailInterface.BeginImport(success, error);</span>
<a href="#l4.818"></a><span id="l4.818"> }</span>
<a href="#l4.819"></a><span id="l4.819"> </span>
<a href="#l4.820"></a><span id="l4.820"> </span>
<a href="#l4.821"></a><span id="l4.821"> // The address import!  A little more complicated than the mail import</span>
<a href="#l4.822"></a><span id="l4.822"> // due to field maps...</span>
<a href="#l4.823"></a><span id="l4.823"> async function ImportAddress(module, success, error) {</span>
<a href="#l4.824"></a><span id="l4.824">   if (gProgressInfo.importInterface || gProgressInfo.intervalState) {</span>
<a href="#l4.825"></a><span id="l4.825" class="difflineminus">-    error.data = gImportMsgsBundle.getString('ImportAlreadyInProgress');</span>
<a href="#l4.826"></a><span id="l4.826" class="difflineplus">+    error.data = gImportMsgsBundle.getString(&quot;ImportAlreadyInProgress&quot;);</span>
<a href="#l4.827"></a><span id="l4.827">     return false;</span>
<a href="#l4.828"></a><span id="l4.828">   }</span>
<a href="#l4.829"></a><span id="l4.829"> </span>
<a href="#l4.830"></a><span id="l4.830">   gProgressInfo.importSuccess = false;</span>
<a href="#l4.831"></a><span id="l4.831"> </span>
<a href="#l4.832"></a><span id="l4.832">   gAddInterface = module.GetImportInterface(&quot;addressbook&quot;);</span>
<a href="#l4.833"></a><span id="l4.833">   if (!(gAddInterface instanceof Ci.nsIImportGeneric)) {</span>
<a href="#l4.834"></a><span id="l4.834" class="difflineminus">-    error.data = gImportMsgsBundle.getString('ImportAddressBadModule');</span>
<a href="#l4.835"></a><span id="l4.835" class="difflineplus">+    error.data = gImportMsgsBundle.getString(&quot;ImportAddressBadModule&quot;);</span>
<a href="#l4.836"></a><span id="l4.836">     return false;</span>
<a href="#l4.837"></a><span id="l4.837">   }</span>
<a href="#l4.838"></a><span id="l4.838"> </span>
<a href="#l4.839"></a><span id="l4.839">   var loc = gAddInterface.GetStatus(&quot;autoFind&quot;);</span>
<a href="#l4.840"></a><span id="l4.840">   if (loc == 0) {</span>
<a href="#l4.841"></a><span id="l4.841">     loc = gAddInterface.GetData(&quot;addressLocation&quot;);</span>
<a href="#l4.842"></a><span id="l4.842">     if ((loc instanceof Ci.nsIFile) &amp;&amp; !loc.exists)</span>
<a href="#l4.843"></a><span id="l4.843">       loc = null;</span>
<a href="#l4.844"></a><span id="l4.844">   }</span>
<a href="#l4.845"></a><span id="l4.845"> </span>
<a href="#l4.846"></a><span id="l4.846">   if (loc == null) {</span>
<a href="#l4.847"></a><span id="l4.847">     // Couldn't find the address book, see if we can</span>
<a href="#l4.848"></a><span id="l4.848">     // as the user for the location or not?</span>
<a href="#l4.849"></a><span id="l4.849">     if (gAddInterface.GetStatus(&quot;canUserSetLocation&quot;) == 0) {</span>
<a href="#l4.850"></a><span id="l4.850">       // an autofind address book that could not be found!</span>
<a href="#l4.851"></a><span id="l4.851" class="difflineminus">-      error.data = gImportMsgsBundle.getString('ImportAddressNotFound');</span>
<a href="#l4.852"></a><span id="l4.852" class="difflineplus">+      error.data = gImportMsgsBundle.getString(&quot;ImportAddressNotFound&quot;);</span>
<a href="#l4.853"></a><span id="l4.853">       return false;</span>
<a href="#l4.854"></a><span id="l4.854">     }</span>
<a href="#l4.855"></a><span id="l4.855"> </span>
<a href="#l4.856"></a><span id="l4.856">     let filePicker = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance();</span>
<a href="#l4.857"></a><span id="l4.857">     if (!(filePicker instanceof Ci.nsIFilePicker)) {</span>
<a href="#l4.858"></a><span id="l4.858" class="difflineminus">-      error.data = gImportMsgsBundle.getString('ImportAddressNotFound');</span>
<a href="#l4.859"></a><span id="l4.859" class="difflineplus">+      error.data = gImportMsgsBundle.getString(&quot;ImportAddressNotFound&quot;);</span>
<a href="#l4.860"></a><span id="l4.860">       return false;</span>
<a href="#l4.861"></a><span id="l4.861">     }</span>
<a href="#l4.862"></a><span id="l4.862"> </span>
<a href="#l4.863"></a><span id="l4.863">     // The address book location was not found.</span>
<a href="#l4.864"></a><span id="l4.864">     // Determine if we need to ask for a directory</span>
<a href="#l4.865"></a><span id="l4.865">     // or a single file.</span>
<a href="#l4.866"></a><span id="l4.866">     let file = null;</span>
<a href="#l4.867"></a><span id="l4.867">     let fileIsDirectory = false;</span>
<a href="#l4.868"></a><span id="l4.868" class="difflineat">@@ -795,44 +736,43 @@ async function ImportAddress(module, suc</span>
<a href="#l4.869"></a><span id="l4.869">         filePicker.init(window,</span>
<a href="#l4.870"></a><span id="l4.870">                         gImportMsgsBundle.getString(&quot;ImportSelectAddrDir&quot;),</span>
<a href="#l4.871"></a><span id="l4.871">                         filePicker.modeGetFolder);</span>
<a href="#l4.872"></a><span id="l4.872">         filePicker.appendFilters(filePicker.filterAll);</span>
<a href="#l4.873"></a><span id="l4.873">         file = await promptForFile(filePicker);</span>
<a href="#l4.874"></a><span id="l4.874">         if (file &amp;&amp; file.path) {</span>
<a href="#l4.875"></a><span id="l4.875">           fileIsDirectory = true;</span>
<a href="#l4.876"></a><span id="l4.876">         }</span>
<a href="#l4.877"></a><span id="l4.877" class="difflineminus">-      } catch(ex) {</span>
<a href="#l4.878"></a><span id="l4.878" class="difflineplus">+      } catch (ex) {</span>
<a href="#l4.879"></a><span id="l4.879">         Cu.reportError(ex);</span>
<a href="#l4.880"></a><span id="l4.880">         file = null;</span>
<a href="#l4.881"></a><span id="l4.881">       }</span>
<a href="#l4.882"></a><span id="l4.882" class="difflineminus">-    }</span>
<a href="#l4.883"></a><span id="l4.883" class="difflineminus">-    else {</span>
<a href="#l4.884"></a><span id="l4.884" class="difflineplus">+    } else {</span>
<a href="#l4.885"></a><span id="l4.885">       // ask for file</span>
<a href="#l4.886"></a><span id="l4.886">       try {</span>
<a href="#l4.887"></a><span id="l4.887">         filePicker.init(window,</span>
<a href="#l4.888"></a><span id="l4.888">                         gImportMsgsBundle.getString(&quot;ImportSelectAddrFile&quot;),</span>
<a href="#l4.889"></a><span id="l4.889">                         filePicker.modeOpen);</span>
<a href="#l4.890"></a><span id="l4.890">         let addressbookBundle = document.getElementById(&quot;bundle_addressbook&quot;);</span>
<a href="#l4.891"></a><span id="l4.891">         if (gSelectedModuleName ==</span>
<a href="#l4.892"></a><span id="l4.892">             document.getElementById(&quot;bundle_vcardImportMsgs&quot;)</span>
<a href="#l4.893"></a><span id="l4.893">                     .getString(&quot;vCardImportName&quot;)) {</span>
<a href="#l4.894"></a><span id="l4.894" class="difflineminus">-          filePicker.appendFilter(addressbookBundle.getString('VCFFiles'), &quot;*.vcf&quot;);</span>
<a href="#l4.895"></a><span id="l4.895" class="difflineplus">+          filePicker.appendFilter(addressbookBundle.getString(&quot;VCFFiles&quot;), &quot;*.vcf&quot;);</span>
<a href="#l4.896"></a><span id="l4.896">         } else {</span>
<a href="#l4.897"></a><span id="l4.897" class="difflineminus">-          filePicker.appendFilter(addressbookBundle.getString('LDIFFiles'), &quot;*.ldi; *.ldif&quot;);</span>
<a href="#l4.898"></a><span id="l4.898" class="difflineminus">-          filePicker.appendFilter(addressbookBundle.getString('CSVFiles'), &quot;*.csv&quot;);</span>
<a href="#l4.899"></a><span id="l4.899" class="difflineminus">-          filePicker.appendFilter(addressbookBundle.getString('TABFiles'), &quot;*.tab; *.txt&quot;);</span>
<a href="#l4.900"></a><span id="l4.900" class="difflineminus">-          filePicker.appendFilter(addressbookBundle.getString('SupportedABFiles'), &quot;.csv; *.ldi; *.ldif; *.tab; *.txt&quot;);</span>
<a href="#l4.901"></a><span id="l4.901" class="difflineplus">+          filePicker.appendFilter(addressbookBundle.getString(&quot;LDIFFiles&quot;), &quot;*.ldi; *.ldif&quot;);</span>
<a href="#l4.902"></a><span id="l4.902" class="difflineplus">+          filePicker.appendFilter(addressbookBundle.getString(&quot;CSVFiles&quot;), &quot;*.csv&quot;);</span>
<a href="#l4.903"></a><span id="l4.903" class="difflineplus">+          filePicker.appendFilter(addressbookBundle.getString(&quot;TABFiles&quot;), &quot;*.tab; *.txt&quot;);</span>
<a href="#l4.904"></a><span id="l4.904" class="difflineplus">+          filePicker.appendFilter(addressbookBundle.getString(&quot;SupportedABFiles&quot;), &quot;.csv; *.ldi; *.ldif; *.tab; *.txt&quot;);</span>
<a href="#l4.905"></a><span id="l4.905">           filePicker.appendFilters(filePicker.filterAll);</span>
<a href="#l4.906"></a><span id="l4.906">           // Use &quot;Supported Address Book Files&quot; as default file filter.</span>
<a href="#l4.907"></a><span id="l4.907">           filePicker.filterIndex = 3;</span>
<a href="#l4.908"></a><span id="l4.908">         }</span>
<a href="#l4.909"></a><span id="l4.909"> </span>
<a href="#l4.910"></a><span id="l4.910">         file = await promptForFile(filePicker);</span>
<a href="#l4.911"></a><span id="l4.911" class="difflineminus">-      } catch(ex) {</span>
<a href="#l4.912"></a><span id="l4.912" class="difflineplus">+      } catch (ex) {</span>
<a href="#l4.913"></a><span id="l4.913">         Cu.reportError(ex);</span>
<a href="#l4.914"></a><span id="l4.914">         file = null;</span>
<a href="#l4.915"></a><span id="l4.915">       }</span>
<a href="#l4.916"></a><span id="l4.916">     }</span>
<a href="#l4.917"></a><span id="l4.917"> </span>
<a href="#l4.918"></a><span id="l4.918">     if (!file) {</span>
<a href="#l4.919"></a><span id="l4.919">       return false;</span>
<a href="#l4.920"></a><span id="l4.920">     }</span>
<a href="#l4.921"></a><span id="l4.921" class="difflineat">@@ -850,19 +790,21 @@ async function ImportAddress(module, suc</span>
<a href="#l4.922"></a><span id="l4.922">   var map = gAddInterface.GetData(&quot;fieldMap&quot;);</span>
<a href="#l4.923"></a><span id="l4.923">   if (map instanceof Ci.nsIImportFieldMap) {</span>
<a href="#l4.924"></a><span id="l4.924">     let result = {};</span>
<a href="#l4.925"></a><span id="l4.925">     result.ok = false;</span>
<a href="#l4.926"></a><span id="l4.926">     window.openDialog(</span>
<a href="#l4.927"></a><span id="l4.927">       &quot;chrome://messenger/content/fieldMapImport.xul&quot;,</span>
<a href="#l4.928"></a><span id="l4.928">       &quot;&quot;,</span>
<a href="#l4.929"></a><span id="l4.929">       &quot;chrome,modal,titlebar&quot;,</span>
<a href="#l4.930"></a><span id="l4.930" class="difflineminus">-      { fieldMap: map,</span>
<a href="#l4.931"></a><span id="l4.931" class="difflineplus">+      {</span>
<a href="#l4.932"></a><span id="l4.932" class="difflineplus">+        fieldMap: map,</span>
<a href="#l4.933"></a><span id="l4.933">         addInterface: gAddInterface,</span>
<a href="#l4.934"></a><span id="l4.934" class="difflineminus">-        result: result });</span>
<a href="#l4.935"></a><span id="l4.935" class="difflineplus">+        result,</span>
<a href="#l4.936"></a><span id="l4.936" class="difflineplus">+      });</span>
<a href="#l4.937"></a><span id="l4.937"> </span>
<a href="#l4.938"></a><span id="l4.938">     if (!result.ok)</span>
<a href="#l4.939"></a><span id="l4.939">       return false;</span>
<a href="#l4.940"></a><span id="l4.940">   }</span>
<a href="#l4.941"></a><span id="l4.941"> </span>
<a href="#l4.942"></a><span id="l4.942">   if (gAddInterface.WantsProgress()) {</span>
<a href="#l4.943"></a><span id="l4.943">     if (gAddInterface.BeginImport(success, error)) {</span>
<a href="#l4.944"></a><span id="l4.944">       gProgressInfo.importInterface = gAddInterface;</span>
<a href="#l4.945"></a><span id="l4.945" class="difflineat">@@ -875,137 +817,126 @@ async function ImportAddress(module, suc</span>
<a href="#l4.946"></a><span id="l4.946">   return gAddInterface.BeginImport(success, error);</span>
<a href="#l4.947"></a><span id="l4.947"> }</span>
<a href="#l4.948"></a><span id="l4.948"> </span>
<a href="#l4.949"></a><span id="l4.949"> /*</span>
<a href="#l4.950"></a><span id="l4.950">   Import filters from a specific module.</span>
<a href="#l4.951"></a><span id="l4.951">   Returns false if it failed and true if it succeeded.</span>
<a href="#l4.952"></a><span id="l4.952">   An error string is returned as error.value.</span>
<a href="#l4.953"></a><span id="l4.953"> */</span>
<a href="#l4.954"></a><span id="l4.954" class="difflineminus">-function ImportFilters(module, error)</span>
<a href="#l4.955"></a><span id="l4.955" class="difflineminus">-{</span>
<a href="#l4.956"></a><span id="l4.956" class="difflineplus">+function ImportFilters(module, error) {</span>
<a href="#l4.957"></a><span id="l4.957">   if (gProgressInfo.importInterface || gProgressInfo.intervalState) {</span>
<a href="#l4.958"></a><span id="l4.958" class="difflineminus">-    error.data = gImportMsgsBundle.getString('ImportAlreadyInProgress');</span>
<a href="#l4.959"></a><span id="l4.959" class="difflineplus">+    error.data = gImportMsgsBundle.getString(&quot;ImportAlreadyInProgress&quot;);</span>
<a href="#l4.960"></a><span id="l4.960">     return false;</span>
<a href="#l4.961"></a><span id="l4.961">   }</span>
<a href="#l4.962"></a><span id="l4.962"> </span>
<a href="#l4.963"></a><span id="l4.963">   gProgressInfo.importSuccess = false;</span>
<a href="#l4.964"></a><span id="l4.964"> </span>
<a href="#l4.965"></a><span id="l4.965">   var filtersInterface = module.GetImportInterface(&quot;filters&quot;);</span>
<a href="#l4.966"></a><span id="l4.966">   if (!(filtersInterface instanceof Ci.nsIImportFilters)) {</span>
<a href="#l4.967"></a><span id="l4.967" class="difflineminus">-    error.data = gImportMsgsBundle.getString('ImportFiltersBadModule');</span>
<a href="#l4.968"></a><span id="l4.968" class="difflineplus">+    error.data = gImportMsgsBundle.getString(&quot;ImportFiltersBadModule&quot;);</span>
<a href="#l4.969"></a><span id="l4.969">     return false;</span>
<a href="#l4.970"></a><span id="l4.970">   }</span>
<a href="#l4.971"></a><span id="l4.971"> </span>
<a href="#l4.972"></a><span id="l4.972">   return filtersInterface.Import(error);</span>
<a href="#l4.973"></a><span id="l4.973"> }</span>
<a href="#l4.974"></a><span id="l4.974"> </span>
<a href="#l4.975"></a><span id="l4.975"> /*</span>
<a href="#l4.976"></a><span id="l4.976">   Import feeds.</span>
<a href="#l4.977"></a><span id="l4.977"> */</span>
<a href="#l4.978"></a><span id="l4.978" class="difflineminus">-async function ImportFeeds()</span>
<a href="#l4.979"></a><span id="l4.979" class="difflineminus">-{</span>
<a href="#l4.980"></a><span id="l4.980" class="difflineplus">+async function ImportFeeds() {</span>
<a href="#l4.981"></a><span id="l4.981">   // Get file and file url to open from filepicker.</span>
<a href="#l4.982"></a><span id="l4.982">   let [openFile, openFileUrl] = await FeedSubscriptions.opmlPickOpenFile();</span>
<a href="#l4.983"></a><span id="l4.983"> </span>
<a href="#l4.984"></a><span id="l4.984">   let acctName;</span>
<a href="#l4.985"></a><span id="l4.985">   let acctNewExist = gFeedsBundle.getString(&quot;ImportFeedsExisting&quot;);</span>
<a href="#l4.986"></a><span id="l4.986">   let fileName = openFile.path;</span>
<a href="#l4.987"></a><span id="l4.987">   let server = document.getElementById(&quot;moduleList&quot;).selectedItem.server;</span>
<a href="#l4.988"></a><span id="l4.988">   gNewFeedAcctCreated = false;</span>
<a href="#l4.989"></a><span id="l4.989"> </span>
<a href="#l4.990"></a><span id="l4.990" class="difflineminus">-  if (!server)</span>
<a href="#l4.991"></a><span id="l4.991" class="difflineminus">-  {</span>
<a href="#l4.992"></a><span id="l4.992" class="difflineplus">+  if (!server) {</span>
<a href="#l4.993"></a><span id="l4.993">     // Create a new Feeds account.</span>
<a href="#l4.994"></a><span id="l4.994">     acctName = document.getElementById(&quot;acctName&quot;).value;</span>
<a href="#l4.995"></a><span id="l4.995">     server = FeedUtils.createRssAccount(acctName).incomingServer;</span>
<a href="#l4.996"></a><span id="l4.996">     acctNewExist = gFeedsBundle.getString(&quot;ImportFeedsNew&quot;);</span>
<a href="#l4.997"></a><span id="l4.997">     gNewFeedAcctCreated = true;</span>
<a href="#l4.998"></a><span id="l4.998">   }</span>
<a href="#l4.999"></a><span id="l4.999"> </span>
<a href="#l4.1000"></a><span id="l4.1000">   acctName = server.rootFolder.prettyName;</span>
<a href="#l4.1001"></a><span id="l4.1001"> </span>
<a href="#l4.1002"></a><span id="l4.1002" class="difflineminus">-  let callback = function(aStatusReport, aLastFolder , aFeedWin)</span>
<a href="#l4.1003"></a><span id="l4.1003" class="difflineminus">-  {</span>
<a href="#l4.1004"></a><span id="l4.1004" class="difflineplus">+  let callback = function(aStatusReport, aLastFolder, aFeedWin) {</span>
<a href="#l4.1005"></a><span id="l4.1005">     let message = gFeedsBundle.getFormattedString(&quot;ImportFeedsDone&quot;,</span>
<a href="#l4.1006"></a><span id="l4.1006">                                                   [fileName, acctNewExist, acctName]);</span>
<a href="#l4.1007"></a><span id="l4.1007">     ShowImportResultsRaw(message + &quot;  &quot; + aStatusReport, null, true);</span>
<a href="#l4.1008"></a><span id="l4.1008">     document.getElementById(&quot;back&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.1009"></a><span id="l4.1009"> </span>
<a href="#l4.1010"></a><span id="l4.1010">     let subscriptionsWindow = Services.wm.getMostRecentWindow(&quot;Mail:News-BlogSubscriptions&quot;);</span>
<a href="#l4.1011"></a><span id="l4.1011" class="difflineminus">-    if (subscriptionsWindow)</span>
<a href="#l4.1012"></a><span id="l4.1012" class="difflineminus">-    {</span>
<a href="#l4.1013"></a><span id="l4.1013" class="difflineplus">+    if (subscriptionsWindow) {</span>
<a href="#l4.1014"></a><span id="l4.1014">       let feedWin = subscriptionsWindow.FeedSubscriptions;</span>
<a href="#l4.1015"></a><span id="l4.1015">       if (aLastFolder)</span>
<a href="#l4.1016"></a><span id="l4.1016">         feedWin.FolderListener.folderAdded(aLastFolder);</span>
<a href="#l4.1017"></a><span id="l4.1017"> </span>
<a href="#l4.1018"></a><span id="l4.1018">       feedWin.mActionMode = null;</span>
<a href="#l4.1019"></a><span id="l4.1019">       feedWin.updateButtons(feedWin.mView.currentItem);</span>
<a href="#l4.1020"></a><span id="l4.1020">       feedWin.clearStatusInfo();</span>
<a href="#l4.1021"></a><span id="l4.1021">       feedWin.updateStatusItem(&quot;statusText&quot;, aStatusReport);</span>
<a href="#l4.1022"></a><span id="l4.1022">     }</span>
<a href="#l4.1023"></a><span id="l4.1023" class="difflineminus">-  }</span>
<a href="#l4.1024"></a><span id="l4.1024" class="difflineplus">+  };</span>
<a href="#l4.1025"></a><span id="l4.1025"> </span>
<a href="#l4.1026"></a><span id="l4.1026">   if (!(await FeedSubscriptions.importOPMLFile(openFile, openFileUrl, server, callback)))</span>
<a href="#l4.1027"></a><span id="l4.1027">     return false;</span>
<a href="#l4.1028"></a><span id="l4.1028"> </span>
<a href="#l4.1029"></a><span id="l4.1029">   let subscriptionsWindow = Services.wm.getMostRecentWindow(&quot;Mail:News-BlogSubscriptions&quot;);</span>
<a href="#l4.1030"></a><span id="l4.1030" class="difflineminus">-  if (subscriptionsWindow)</span>
<a href="#l4.1031"></a><span id="l4.1031" class="difflineminus">-  {</span>
<a href="#l4.1032"></a><span id="l4.1032" class="difflineplus">+  if (subscriptionsWindow) {</span>
<a href="#l4.1033"></a><span id="l4.1033">     let feedWin = subscriptionsWindow.FeedSubscriptions;</span>
<a href="#l4.1034"></a><span id="l4.1034">     feedWin.mActionMode = feedWin.kImportingOPML;</span>
<a href="#l4.1035"></a><span id="l4.1035">     feedWin.updateButtons(null);</span>
<a href="#l4.1036"></a><span id="l4.1036">     let statusReport = gFeedsBundle.getString(&quot;subscribe-loading&quot;);</span>
<a href="#l4.1037"></a><span id="l4.1037">     feedWin.updateStatusItem(&quot;statusText&quot;, statusReport);</span>
<a href="#l4.1038"></a><span id="l4.1038">     feedWin.updateStatusItem(&quot;progressMeter&quot;, &quot;?&quot;);</span>
<a href="#l4.1039"></a><span id="l4.1039">   }</span>
<a href="#l4.1040"></a><span id="l4.1040"> </span>
<a href="#l4.1041"></a><span id="l4.1041">   return true;</span>
<a href="#l4.1042"></a><span id="l4.1042"> }</span>
<a href="#l4.1043"></a><span id="l4.1043"> </span>
<a href="#l4.1044"></a><span id="l4.1044" class="difflineminus">-function SwitchType(newType)</span>
<a href="#l4.1045"></a><span id="l4.1045" class="difflineminus">-{</span>
<a href="#l4.1046"></a><span id="l4.1046" class="difflineplus">+function SwitchType(newType) {</span>
<a href="#l4.1047"></a><span id="l4.1047">   if (gImportType == newType)</span>
<a href="#l4.1048"></a><span id="l4.1048">     return;</span>
<a href="#l4.1049"></a><span id="l4.1049"> </span>
<a href="#l4.1050"></a><span id="l4.1050">   gImportType = newType;</span>
<a href="#l4.1051"></a><span id="l4.1051">   gProgressInfo.importType = newType;</span>
<a href="#l4.1052"></a><span id="l4.1052"> </span>
<a href="#l4.1053"></a><span id="l4.1053">   SetUpImportType();</span>
<a href="#l4.1054"></a><span id="l4.1054"> </span>
<a href="#l4.1055"></a><span id="l4.1055" class="difflineminus">-  SetDivText('description', &quot;&quot;);</span>
<a href="#l4.1056"></a><span id="l4.1056" class="difflineplus">+  SetDivText(&quot;description&quot;, &quot;&quot;);</span>
<a href="#l4.1057"></a><span id="l4.1057"> }</span>
<a href="#l4.1058"></a><span id="l4.1058"> </span>
<a href="#l4.1059"></a><span id="l4.1059"> </span>
<a href="#l4.1060"></a><span id="l4.1060" class="difflineminus">-function next()</span>
<a href="#l4.1061"></a><span id="l4.1061" class="difflineminus">-{</span>
<a href="#l4.1062"></a><span id="l4.1062" class="difflineplus">+function next() {</span>
<a href="#l4.1063"></a><span id="l4.1063">   var deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.1064"></a><span id="l4.1064">   switch (deck.selectedIndex) {</span>
<a href="#l4.1065"></a><span id="l4.1065">   case &quot;0&quot;:</span>
<a href="#l4.1066"></a><span id="l4.1066">     let backButton = document.getElementById(&quot;back&quot;);</span>
<a href="#l4.1067"></a><span id="l4.1067">     backButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.1068"></a><span id="l4.1068">     let radioGroup = document.getElementById(&quot;importFields&quot;);</span>
<a href="#l4.1069"></a><span id="l4.1069"> </span>
<a href="#l4.1070"></a><span id="l4.1070" class="difflineminus">-    if (radioGroup.value == &quot;all&quot;)</span>
<a href="#l4.1071"></a><span id="l4.1071" class="difflineminus">-    {</span>
<a href="#l4.1072"></a><span id="l4.1072" class="difflineplus">+    if (radioGroup.value == &quot;all&quot;) {</span>
<a href="#l4.1073"></a><span id="l4.1073">       let args = { closeMigration: true };</span>
<a href="#l4.1074"></a><span id="l4.1074">       let SEAMONKEY_ID = &quot;{92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}&quot;;</span>
<a href="#l4.1075"></a><span id="l4.1075">       if (Services.appinfo.ID == SEAMONKEY_ID) {</span>
<a href="#l4.1076"></a><span id="l4.1076">         window.openDialog(&quot;chrome://communicator/content/migration/migration.xul&quot;,</span>
<a href="#l4.1077"></a><span id="l4.1077">                           &quot;&quot;, &quot;chrome,dialog,modal,centerscreen&quot;);</span>
<a href="#l4.1078"></a><span id="l4.1078">       } else {</span>
<a href="#l4.1079"></a><span id="l4.1079">         // Running as Thunderbird or its clone.</span>
<a href="#l4.1080"></a><span id="l4.1080">         window.openDialog(&quot;chrome://messenger/content/migration/migration.xul&quot;,</span>
<a href="#l4.1081"></a><span id="l4.1081">                           &quot;&quot;, &quot;chrome,dialog,modal,centerscreen&quot;, null, null, null, args);</span>
<a href="#l4.1082"></a><span id="l4.1082">       }</span>
<a href="#l4.1083"></a><span id="l4.1083">       if (args.closeMigration)</span>
<a href="#l4.1084"></a><span id="l4.1084">         close();</span>
<a href="#l4.1085"></a><span id="l4.1085" class="difflineminus">-    }</span>
<a href="#l4.1086"></a><span id="l4.1086" class="difflineminus">-    else</span>
<a href="#l4.1087"></a><span id="l4.1087" class="difflineminus">-    {</span>
<a href="#l4.1088"></a><span id="l4.1088" class="difflineplus">+    } else {</span>
<a href="#l4.1089"></a><span id="l4.1089">       SwitchType(radioGroup.value);</span>
<a href="#l4.1090"></a><span id="l4.1090">       deck.selectedIndex = 1;</span>
<a href="#l4.1091"></a><span id="l4.1091">       document.getElementById(&quot;modulesFound&quot;).selectedIndex =</span>
<a href="#l4.1092"></a><span id="l4.1092">         (document.getElementById(&quot;moduleList&quot;).itemCount &gt; 0) ? 0 : 1;</span>
<a href="#l4.1093"></a><span id="l4.1093">       SelectFirstItem();</span>
<a href="#l4.1094"></a><span id="l4.1094">       enableAdvance();</span>
<a href="#l4.1095"></a><span id="l4.1095">     }</span>
<a href="#l4.1096"></a><span id="l4.1096">     break;</span>
<a href="#l4.1097"></a><span id="l4.1097" class="difflineat">@@ -1013,36 +944,33 @@ function next()</span>
<a href="#l4.1098"></a><span id="l4.1098">     ImportDialogOKButton();</span>
<a href="#l4.1099"></a><span id="l4.1099">     break;</span>
<a href="#l4.1100"></a><span id="l4.1100">   case &quot;3&quot;:</span>
<a href="#l4.1101"></a><span id="l4.1101">     close();</span>
<a href="#l4.1102"></a><span id="l4.1102">     break;</span>
<a href="#l4.1103"></a><span id="l4.1103">   }</span>
<a href="#l4.1104"></a><span id="l4.1104"> }</span>
<a href="#l4.1105"></a><span id="l4.1105"> </span>
<a href="#l4.1106"></a><span id="l4.1106" class="difflineminus">-function SelectFirstItem()</span>
<a href="#l4.1107"></a><span id="l4.1107" class="difflineminus">-{</span>
<a href="#l4.1108"></a><span id="l4.1108" class="difflineplus">+function SelectFirstItem() {</span>
<a href="#l4.1109"></a><span id="l4.1109">   var listbox = document.getElementById(&quot;moduleList&quot;);</span>
<a href="#l4.1110"></a><span id="l4.1110">   if ((listbox.selectedIndex == -1) &amp;&amp; (listbox.itemCount &gt; 0))</span>
<a href="#l4.1111"></a><span id="l4.1111">     listbox.selectedIndex = 0;</span>
<a href="#l4.1112"></a><span id="l4.1112">   ImportSelectionChanged();</span>
<a href="#l4.1113"></a><span id="l4.1113"> }</span>
<a href="#l4.1114"></a><span id="l4.1114"> </span>
<a href="#l4.1115"></a><span id="l4.1115" class="difflineminus">-function enableAdvance()</span>
<a href="#l4.1116"></a><span id="l4.1116" class="difflineminus">-{</span>
<a href="#l4.1117"></a><span id="l4.1117" class="difflineplus">+function enableAdvance() {</span>
<a href="#l4.1118"></a><span id="l4.1118">   var listbox = document.getElementById(&quot;moduleList&quot;);</span>
<a href="#l4.1119"></a><span id="l4.1119">   var nextButton = document.getElementById(&quot;forward&quot;);</span>
<a href="#l4.1120"></a><span id="l4.1120">   if (listbox.selectedCount &gt; 0)</span>
<a href="#l4.1121"></a><span id="l4.1121">     nextButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l4.1122"></a><span id="l4.1122">   else</span>
<a href="#l4.1123"></a><span id="l4.1123">     nextButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l4.1124"></a><span id="l4.1124"> }</span>
<a href="#l4.1125"></a><span id="l4.1125"> </span>
<a href="#l4.1126"></a><span id="l4.1126" class="difflineminus">-function back()</span>
<a href="#l4.1127"></a><span id="l4.1127" class="difflineminus">-{</span>
<a href="#l4.1128"></a><span id="l4.1128" class="difflineplus">+function back() {</span>
<a href="#l4.1129"></a><span id="l4.1129">   var deck = document.getElementById(&quot;stateDeck&quot;);</span>
<a href="#l4.1130"></a><span id="l4.1130">   var backButton = document.getElementById(&quot;back&quot;);</span>
<a href="#l4.1131"></a><span id="l4.1131">   var nextButton = document.getElementById(&quot;forward&quot;);</span>
<a href="#l4.1132"></a><span id="l4.1132">   switch (deck.selectedIndex) {</span>
<a href="#l4.1133"></a><span id="l4.1133">   case &quot;1&quot;:</span>
<a href="#l4.1134"></a><span id="l4.1134">     backButton.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l4.1135"></a><span id="l4.1135">     nextButton.label = nextButton.getAttribute(&quot;nextval&quot;);</span>
<a href="#l4.1136"></a><span id="l4.1136">     nextButton.removeAttribute(&quot;disabled&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mailnews/import/test/unit/.eslintrc.js</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+module.exports = {</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+  &quot;extends&quot;: &quot;plugin:mozilla/xpcshell-test&quot;,</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+  &quot;rules&quot;: {</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+    &quot;func-names&quot;: &quot;off&quot;,</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    &quot;mozilla/import-headjs-globals&quot;: &quot;error&quot;,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    &quot;no-unused-vars&quot;: [&quot;error&quot;, {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+      &quot;args&quot;: &quot;none&quot;,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+      &quot;vars&quot;: &quot;all&quot;,</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+    }],</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+  },</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/import/test/unit/head_import.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/import/test/unit/head_import.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -3,16 +3,18 @@ var {MailServices} = ChromeUtils.import(</span>
<a href="#l6.4"></a><span id="l6.4"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> var CC = Components.Constructor;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> // Ensure the profile directory is set up</span>
<a href="#l6.9"></a><span id="l6.9"> do_get_profile();</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> // Import the required setup scripts.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+/* import-globals-from ../../../test/resources/abSetup.js */</span>
<a href="#l6.13"></a><span id="l6.13"> load(&quot;../../../resources/abSetup.js&quot;);</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> // Import the script with basic import functions</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+/* import-globals-from resources/import_helper.js */</span>
<a href="#l6.17"></a><span id="l6.17"> load(&quot;resources/import_helper.js&quot;);</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19"> registerCleanupFunction(function() {</span>
<a href="#l6.20"></a><span id="l6.20">   load(&quot;../../../resources/mailShutdown.js&quot;);</span>
<a href="#l6.21"></a><span id="l6.21"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/TestMailImporter.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/TestMailImporter.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,103 +1,99 @@</span>
<a href="#l7.4"></a><span id="l7.4"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> function TestMailImpoter() {</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">-};</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+}</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> TestMailImpoter.prototype = {</span>
<a href="#l7.11"></a><span id="l7.11">   classID: Components.ID(&quot;{a81438ef-aca1-41a5-9b3a-3ccfbbe4f5e1}&quot;),</span>
<a href="#l7.12"></a><span id="l7.12"> </span>
<a href="#l7.13"></a><span id="l7.13">   QueryInterface: ChromeUtils.generateQI([Ci.nsIImportModule,</span>
<a href="#l7.14"></a><span id="l7.14">                                           Ci.nsIImportMail]),</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">   contractID: &quot;@mozilla.org/import/test;1&quot;,</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   _xpcom_categories: [{</span>
<a href="#l7.19"></a><span id="l7.19">     category: &quot;mailnewsimport&quot;,</span>
<a href="#l7.20"></a><span id="l7.20">     entry: &quot;{a81438ef-aca1-41a5-9b3a-3ccfbbe4f5e1}&quot;,</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-    value: &quot;mail&quot;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+    value: &quot;mail&quot;,</span>
<a href="#l7.23"></a><span id="l7.23">   }],</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">   name: &quot;Test mail import module&quot;,</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   description: &quot;Test module for mail import&quot;,</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">   supports: &quot;mail&quot;,</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">   supportsUpgrade: true,</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  GetImportInterface: function(type) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  GetImportInterface(type) {</span>
<a href="#l7.35"></a><span id="l7.35">     if (type != &quot;mail&quot;)</span>
<a href="#l7.36"></a><span id="l7.36">       return null;</span>
<a href="#l7.37"></a><span id="l7.37">     let importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l7.38"></a><span id="l7.38">                         .createInstance(Ci.nsIImportService);</span>
<a href="#l7.39"></a><span id="l7.39">     let genericInterface = importService.CreateNewGenericMail();</span>
<a href="#l7.40"></a><span id="l7.40">     genericInterface.SetData(&quot;mailInterface&quot;, this);</span>
<a href="#l7.41"></a><span id="l7.41">     let name = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l7.42"></a><span id="l7.42">                .createInstance(Ci.nsISupportsString);</span>
<a href="#l7.43"></a><span id="l7.43">     name.data = &quot;TestMailImporter&quot;;</span>
<a href="#l7.44"></a><span id="l7.44">     genericInterface.SetData(&quot;name&quot;, name);</span>
<a href="#l7.45"></a><span id="l7.45">     return genericInterface;</span>
<a href="#l7.46"></a><span id="l7.46">   },</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-  GetDefaultLocation: function(location, found, userVerify) {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+  GetDefaultLocation(location, found, userVerify) {</span>
<a href="#l7.50"></a><span id="l7.50">     found = false;</span>
<a href="#l7.51"></a><span id="l7.51">     userVerify = false;</span>
<a href="#l7.52"></a><span id="l7.52">   },</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-  _createMailboxDescriptor: function(path, name, depth) {</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+  _createMailboxDescriptor(path, name, depth) {</span>
<a href="#l7.56"></a><span id="l7.56">     let importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l7.57"></a><span id="l7.57">                         .createInstance(Ci.nsIImportService);</span>
<a href="#l7.58"></a><span id="l7.58">     let descriptor = importService.CreateNewMailboxDescriptor();</span>
<a href="#l7.59"></a><span id="l7.59">     descriptor.size = 100;</span>
<a href="#l7.60"></a><span id="l7.60">     descriptor.depth = depth;</span>
<a href="#l7.61"></a><span id="l7.61">     descriptor.SetDisplayName(name);</span>
<a href="#l7.62"></a><span id="l7.62">     descriptor.file.initWithPath(path);</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64">     return descriptor;</span>
<a href="#l7.65"></a><span id="l7.65">   },</span>
<a href="#l7.66"></a><span id="l7.66"> </span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-  _collectMailboxesInDirectory: function(directory, depth, result) {</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  _collectMailboxesInDirectory(directory, depth, result) {</span>
<a href="#l7.69"></a><span id="l7.69">     let descriptor = this._createMailboxDescriptor(directory.path,</span>
<a href="#l7.70"></a><span id="l7.70">                                                    directory.leafName,</span>
<a href="#l7.71"></a><span id="l7.71">                                                    depth);</span>
<a href="#l7.72"></a><span id="l7.72">     result.appendElement(descriptor);</span>
<a href="#l7.73"></a><span id="l7.73">     let entries = directory.directoryEntries;</span>
<a href="#l7.74"></a><span id="l7.74">     while (entries.hasMoreElements()) {</span>
<a href="#l7.75"></a><span id="l7.75">       let entry = entries.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l7.76"></a><span id="l7.76">       if (entry.isDirectory())</span>
<a href="#l7.77"></a><span id="l7.77">         this._collectMailboxesInDirectory(entry, depth + 1, result);</span>
<a href="#l7.78"></a><span id="l7.78">     }</span>
<a href="#l7.79"></a><span id="l7.79">   },</span>
<a href="#l7.80"></a><span id="l7.80"> </span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-  FindMailboxes: function(location) {</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+  FindMailboxes(location) {</span>
<a href="#l7.83"></a><span id="l7.83">     let result = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l7.84"></a><span id="l7.84">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l7.85"></a><span id="l7.85">     this._collectMailboxesInDirectory(location, 0, result);</span>
<a href="#l7.86"></a><span id="l7.86"> </span>
<a href="#l7.87"></a><span id="l7.87">     return result;</span>
<a href="#l7.88"></a><span id="l7.88">   },</span>
<a href="#l7.89"></a><span id="l7.89"> </span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-  ImportMailbox: function(source,</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-                          destination,</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-                          errorLog,</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-                          successLog,</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-                          fatalError) {</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+  ImportMailbox(source, destination, errorLog, successLog, fatalError) {</span>
<a href="#l7.96"></a><span id="l7.96">     this.progress = 0;</span>
<a href="#l7.97"></a><span id="l7.97">     let msgStore = destination.msgStore;</span>
<a href="#l7.98"></a><span id="l7.98"> </span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-    let entries = directory.directoryEntries;</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+    let entries = source.directoryEntries;</span>
<a href="#l7.101"></a><span id="l7.101">     while (entries.hasMoreElements()) {</span>
<a href="#l7.102"></a><span id="l7.102">       let entry = entries.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l7.103"></a><span id="l7.103">       if (!entry.isFile())</span>
<a href="#l7.104"></a><span id="l7.104">         continue;</span>
<a href="#l7.105"></a><span id="l7.105"> </span>
<a href="#l7.106"></a><span id="l7.106" class="difflineminus">-      let newMsgHdr = new Object;</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-      let reusable = new Object;</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+      let newMsgHdr = {};</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+      let reusable = {};</span>
<a href="#l7.110"></a><span id="l7.110">       let outputStream = msgStore.getNewMsgOutputStream(destination,</span>
<a href="#l7.111"></a><span id="l7.111">                                                         newMsgHdr,</span>
<a href="#l7.112"></a><span id="l7.112">                                                         reusable);</span>
<a href="#l7.113"></a><span id="l7.113"> </span>
<a href="#l7.114"></a><span id="l7.114">       let inputStream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l7.115"></a><span id="l7.115">                          .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l7.116"></a><span id="l7.116">       inputStream.init(entry, -1, -1, 0);</span>
<a href="#l7.117"></a><span id="l7.117">       let count = inputStream.available();</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineat">@@ -109,19 +105,19 @@ TestMailImpoter.prototype = {</span>
<a href="#l7.119"></a><span id="l7.119">       }</span>
<a href="#l7.120"></a><span id="l7.120">       msgStore.finishNewMessage(outputStream, newMsgHdr);</span>
<a href="#l7.121"></a><span id="l7.121">       inputStream.close();</span>
<a href="#l7.122"></a><span id="l7.122">       outputStream.close();</span>
<a href="#l7.123"></a><span id="l7.123">     }</span>
<a href="#l7.124"></a><span id="l7.124">     this.progress = 100;</span>
<a href="#l7.125"></a><span id="l7.125">   },</span>
<a href="#l7.126"></a><span id="l7.126"> </span>
<a href="#l7.127"></a><span id="l7.127" class="difflineminus">-  GetImportProgress: function() {</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+  GetImportProgress() {</span>
<a href="#l7.129"></a><span id="l7.129">     return this.progress;</span>
<a href="#l7.130"></a><span id="l7.130">   },</span>
<a href="#l7.131"></a><span id="l7.131"> </span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-  translateFolderName: function(folderName) {</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+  translateFolderName(folderName) {</span>
<a href="#l7.134"></a><span id="l7.134">     return folderName;</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineminus">-  }</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+  },</span>
<a href="#l7.137"></a><span id="l7.137"> </span>
<a href="#l7.138"></a><span id="l7.138"> };</span>
<a href="#l7.139"></a><span id="l7.139"> </span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-var NSGetFactory = XPCOMUtils.generateNSGetFactory([TestMailImpoter]);</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+this.NSGetFactory = XPCOMUtils.generateNSGetFactory([TestMailImpoter]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,9 +1,8 @@</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l8.5"></a><span id="l8.5"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> // used by checkProgress to periodically check the progress of the import</span>
<a href="#l8.8"></a><span id="l8.8"> var gGenericImportHelper;</span>
<a href="#l8.9"></a><span id="l8.9"> /**</span>
<a href="#l8.10"></a><span id="l8.10">  * GenericImportHelper</span>
<a href="#l8.11"></a><span id="l8.11">  * The parent class of AbImportHelper, MailImportHelper, SettingsImportHelper</span>
<a href="#l8.12"></a><span id="l8.12">  *                     and FiltersImportHelper.</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineat">@@ -13,38 +12,36 @@ var gGenericImportHelper;</span>
<a href="#l8.14"></a><span id="l8.14">  *                    The string to search the module names for, such as</span>
<a href="#l8.15"></a><span id="l8.15">  *                    &quot;Text file&quot; to find the import module for comma-separated</span>
<a href="#l8.16"></a><span id="l8.16">  *                    value, LDIF, and tab-delimited files.</span>
<a href="#l8.17"></a><span id="l8.17">  * @param aFile       An instance of nsIFile to import.</span>
<a href="#l8.18"></a><span id="l8.18">  *</span>
<a href="#l8.19"></a><span id="l8.19">  * @constructor</span>
<a href="#l8.20"></a><span id="l8.20">  * @class</span>
<a href="#l8.21"></a><span id="l8.21">  */</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-function GenericImportHelper(aModuleType, aModuleSearchString, aFile)</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-{</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+function GenericImportHelper(aModuleType, aModuleSearchString, aFile) {</span>
<a href="#l8.25"></a><span id="l8.25">   gGenericImportHelper = null;</span>
<a href="#l8.26"></a><span id="l8.26">   if (![&quot;addressbook&quot;, &quot;mail&quot;, &quot;settings&quot;, &quot;filters&quot;].includes(aModuleType))</span>
<a href="#l8.27"></a><span id="l8.27">     do_throw(&quot;Unexpected type passed to the GenericImportHelper constructor&quot;);</span>
<a href="#l8.28"></a><span id="l8.28">   this.mModuleType = aModuleType;</span>
<a href="#l8.29"></a><span id="l8.29">   this.mModuleSearchString = aModuleSearchString;</span>
<a href="#l8.30"></a><span id="l8.30">   this.mInterface = this._findInterface();</span>
<a href="#l8.31"></a><span id="l8.31">   Assert.ok(this.mInterface !== null);</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">   this.mFile = aFile; // checked in the beginImport method</span>
<a href="#l8.34"></a><span id="l8.34"> }</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-GenericImportHelper.prototype =</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-{</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+GenericImportHelper.prototype = {</span>
<a href="#l8.39"></a><span id="l8.39">   interfaceType: Ci.nsIImportGeneric,</span>
<a href="#l8.40"></a><span id="l8.40">   /**</span>
<a href="#l8.41"></a><span id="l8.41">    * GenericImportHelper.beginImport</span>
<a href="#l8.42"></a><span id="l8.42">    * Imports the given address book export or mail data and invoke</span>
<a href="#l8.43"></a><span id="l8.43">    * checkProgress of child class to check the data,</span>
<a href="#l8.44"></a><span id="l8.44">    */</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-  beginImport: function() {</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+  beginImport() {</span>
<a href="#l8.47"></a><span id="l8.47">     Assert.ok(this.mFile instanceof Ci.nsIFile &amp;&amp; this.mFile.exists());</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49">     if (this.mModuleType == &quot;addressbook&quot;)</span>
<a href="#l8.50"></a><span id="l8.50">       this.mInterface.SetData(&quot;addressLocation&quot;, this.mFile);</span>
<a href="#l8.51"></a><span id="l8.51">     else if (this.mModuleType == &quot;mail&quot;)</span>
<a href="#l8.52"></a><span id="l8.52">       this.mInterface.SetData(&quot;mailLocation&quot;, this.mFile);</span>
<a href="#l8.53"></a><span id="l8.53"> </span>
<a href="#l8.54"></a><span id="l8.54">     Assert.ok(this.mInterface.WantsProgress());</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineat">@@ -52,65 +49,65 @@ GenericImportHelper.prototype =</span>
<a href="#l8.56"></a><span id="l8.56">     do_test_pending();</span>
<a href="#l8.57"></a><span id="l8.57">     this.checkProgress();</span>
<a href="#l8.58"></a><span id="l8.58">   },</span>
<a href="#l8.59"></a><span id="l8.59">   /**</span>
<a href="#l8.60"></a><span id="l8.60">    * GenericImportHelper.getInterface</span>
<a href="#l8.61"></a><span id="l8.61">    *</span>
<a href="#l8.62"></a><span id="l8.62">    * @return An nsIImportGeneric import interface.</span>
<a href="#l8.63"></a><span id="l8.63">    */</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-  getInterface: function() {</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+  getInterface() {</span>
<a href="#l8.66"></a><span id="l8.66">     return this.mInterface;</span>
<a href="#l8.67"></a><span id="l8.67">   },</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-  _findInterface: function() {</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+  _findInterface() {</span>
<a href="#l8.71"></a><span id="l8.71">     var importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l8.72"></a><span id="l8.72">                         .getService(Ci.nsIImportService);</span>
<a href="#l8.73"></a><span id="l8.73">     var count = importService.GetModuleCount(this.mModuleType);</span>
<a href="#l8.74"></a><span id="l8.74"> </span>
<a href="#l8.75"></a><span id="l8.75">     // Iterate through each import module until the one being searched for is</span>
<a href="#l8.76"></a><span id="l8.76">     // found and then return the ImportInterface of that module</span>
<a href="#l8.77"></a><span id="l8.77">     for (var i = 0; i &lt; count; i++) {</span>
<a href="#l8.78"></a><span id="l8.78">       // Check if the current module fits the search string gets the interface</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-      if (importService.GetModuleName(this.mModuleType, i).indexOf(this.mModuleSearchString) != -1) {</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+      if (importService.GetModuleName(this.mModuleType, i).includes(this.mModuleSearchString)) {</span>
<a href="#l8.81"></a><span id="l8.81">         return importService.GetModule(this.mModuleType, i)</span>
<a href="#l8.82"></a><span id="l8.82">                             .GetImportInterface(this.mModuleType)</span>
<a href="#l8.83"></a><span id="l8.83">                             .QueryInterface(this.interfaceType);</span>
<a href="#l8.84"></a><span id="l8.84">       }</span>
<a href="#l8.85"></a><span id="l8.85">     }</span>
<a href="#l8.86"></a><span id="l8.86">     return null; // it wasn't found</span>
<a href="#l8.87"></a><span id="l8.87">   },</span>
<a href="#l8.88"></a><span id="l8.88">   /**</span>
<a href="#l8.89"></a><span id="l8.89">    * GenericImportHelper.checkProgress</span>
<a href="#l8.90"></a><span id="l8.90">    * Checks the progress of an import every 200 milliseconds until it is</span>
<a href="#l8.91"></a><span id="l8.91">    * complete.  Checks the test results if there is an original address book,</span>
<a href="#l8.92"></a><span id="l8.92">    * otherwise evaluates the optional command, or calls do_test_finished().</span>
<a href="#l8.93"></a><span id="l8.93">    */</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-  checkProgress: function() {</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineplus">+  checkProgress() {</span>
<a href="#l8.96"></a><span id="l8.96">     Assert.ok(this.mInterface &amp;&amp;</span>
<a href="#l8.97"></a><span id="l8.97">               this.mInterface instanceof Ci.nsIImportGeneric);</span>
<a href="#l8.98"></a><span id="l8.98">     Assert.ok(this.mInterface.ContinueImport());</span>
<a href="#l8.99"></a><span id="l8.99">     // if the import isn't done, check again in 200 milliseconds.</span>
<a href="#l8.100"></a><span id="l8.100">     if (this.mInterface.GetProgress() != 100) {</span>
<a href="#l8.101"></a><span id="l8.101">       // use the helper object to check the progress of the import after 200 ms</span>
<a href="#l8.102"></a><span id="l8.102">       gGenericImportHelper = this;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-      do_timeout(200, function(){gGenericImportHelper.checkProgress();});</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+      do_timeout(200, function() { gGenericImportHelper.checkProgress(); });</span>
<a href="#l8.105"></a><span id="l8.105">     } else { // if it is done, check the results or finish the test.</span>
<a href="#l8.106"></a><span id="l8.106">       this.checkResults();</span>
<a href="#l8.107"></a><span id="l8.107">       do_test_finished();</span>
<a href="#l8.108"></a><span id="l8.108">     }</span>
<a href="#l8.109"></a><span id="l8.109">   },</span>
<a href="#l8.110"></a><span id="l8.110"> </span>
<a href="#l8.111"></a><span id="l8.111">   /**</span>
<a href="#l8.112"></a><span id="l8.112">    * GenericImportHelper.checkResults</span>
<a href="#l8.113"></a><span id="l8.113">    * Checks the results of the import.</span>
<a href="#l8.114"></a><span id="l8.114">    * Child class should implement this method.</span>
<a href="#l8.115"></a><span id="l8.115">    */</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-  checkResults: function() {</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-  }</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+  checkResults() {</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineplus">+  },</span>
<a href="#l8.120"></a><span id="l8.120"> };</span>
<a href="#l8.121"></a><span id="l8.121"> </span>
<a href="#l8.122"></a><span id="l8.122"> /**</span>
<a href="#l8.123"></a><span id="l8.123">  * AbImportHelper</span>
<a href="#l8.124"></a><span id="l8.124">  * A helper for Address Book imports. To use, supply at least the file and type.</span>
<a href="#l8.125"></a><span id="l8.125">  * If you would like the results checked, add a new array in the addressbook</span>
<a href="#l8.126"></a><span id="l8.126">  * JSON file in the resources folder and supply aAbName and aJsonName.</span>
<a href="#l8.127"></a><span id="l8.127">  * See AB_README for more information.</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineat">@@ -123,18 +120,17 @@ GenericImportHelper.prototype =</span>
<a href="#l8.129"></a><span id="l8.129">  * Optional parameters: Include if you would like the import checked.</span>
<a href="#l8.130"></a><span id="l8.130">  * @param aAbName   The name the address book will have (the filename without</span>
<a href="#l8.131"></a><span id="l8.131">  *                  the extension).</span>
<a href="#l8.132"></a><span id="l8.132">  * @param aJsonName The name of the array in addressbook.json with the cards</span>
<a href="#l8.133"></a><span id="l8.133">  *                  to compare with the imported cards.</span>
<a href="#l8.134"></a><span id="l8.134">  * @constructor</span>
<a href="#l8.135"></a><span id="l8.135">  * @class</span>
<a href="#l8.136"></a><span id="l8.136">  */</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineminus">-function AbImportHelper(aFile, aModuleSearchString, aAbName, aJsonName)</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-{</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineplus">+function AbImportHelper(aFile, aModuleSearchString, aAbName, aJsonName) {</span>
<a href="#l8.140"></a><span id="l8.140">   GenericImportHelper.call(this, &quot;addressbook&quot;, aModuleSearchString, aFile);</span>
<a href="#l8.141"></a><span id="l8.141"> </span>
<a href="#l8.142"></a><span id="l8.142">   this.mAbName = aAbName;</span>
<a href="#l8.143"></a><span id="l8.143">   /* Attribute notes:  The attributes listed in the declaration below are</span>
<a href="#l8.144"></a><span id="l8.144">    * supported by all three text export/import types. PreferMailFormat is only</span>
<a href="#l8.145"></a><span id="l8.145">    * supported by LDIF.</span>
<a href="#l8.146"></a><span id="l8.146">    * The following are not supported: anniversaryYear, anniversaryMonth,</span>
<a href="#l8.147"></a><span id="l8.147">    * anniversaryDay, popularityIndex, isMailList, mailListURI, lastModifiedDate.</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineat">@@ -152,84 +148,83 @@ function AbImportHelper(aFile, aModuleSe</span>
<a href="#l8.149"></a><span id="l8.149">   if (this.mFile.leafName.toLowerCase().endsWith(&quot;.ldif&quot;)) {</span>
<a href="#l8.150"></a><span id="l8.150">     // LDIF: add PreferMailFormat</span>
<a href="#l8.151"></a><span id="l8.151">     this.mSupportedAttributes = supportedAttributes.concat([&quot;PreferMailFormat&quot;]);</span>
<a href="#l8.152"></a><span id="l8.152">   } else if (this.mFile.leafName.toLowerCase().endsWith(&quot;.csv&quot;)) {</span>
<a href="#l8.153"></a><span id="l8.153">     this.mSupportedAttributes = supportedAttributes;</span>
<a href="#l8.154"></a><span id="l8.154">     this.setFieldMap(this.getDefaultFieldMap(true));</span>
<a href="#l8.155"></a><span id="l8.155">   } else if (this.mFile.leafName.toLowerCase().endsWith(&quot;.vcf&quot;)) {</span>
<a href="#l8.156"></a><span id="l8.156">     this.mSupportedAttributes = supportedAttributes;</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-  };</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+  }</span>
<a href="#l8.159"></a><span id="l8.159"> </span>
<a href="#l8.160"></a><span id="l8.160">   // get the &quot;cards&quot; from the JSON file, if necessary</span>
<a href="#l8.161"></a><span id="l8.161">   if (aJsonName)</span>
<a href="#l8.162"></a><span id="l8.162">     this.mJsonCards = this.getJsonCards(aJsonName);</span>
<a href="#l8.163"></a><span id="l8.163"> }</span>
<a href="#l8.164"></a><span id="l8.164"> </span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-AbImportHelper.prototype =</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-{</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+AbImportHelper.prototype = {</span>
<a href="#l8.168"></a><span id="l8.168">   __proto__: GenericImportHelper.prototype,</span>
<a href="#l8.169"></a><span id="l8.169">   /**</span>
<a href="#l8.170"></a><span id="l8.170">    * AbImportHelper.getDefaultFieldMap</span>
<a href="#l8.171"></a><span id="l8.171">    * Returns the default field map.</span>
<a href="#l8.172"></a><span id="l8.172">    *</span>
<a href="#l8.173"></a><span id="l8.173">    * @param aSkipFirstRecord True if the first record of the text file should</span>
<a href="#l8.174"></a><span id="l8.174">    *                         be skipped.</span>
<a href="#l8.175"></a><span id="l8.175">    * @return A default field map.</span>
<a href="#l8.176"></a><span id="l8.176">    */</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineminus">-  getDefaultFieldMap: function(aSkipFirstRecord) {</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+  getDefaultFieldMap(aSkipFirstRecord) {</span>
<a href="#l8.179"></a><span id="l8.179">     var importService = Cc[&quot;@mozilla.org/import/import-service;1&quot;]</span>
<a href="#l8.180"></a><span id="l8.180">                          .getService(Ci.nsIImportService);</span>
<a href="#l8.181"></a><span id="l8.181">     var fieldMap = importService.CreateNewFieldMap();</span>
<a href="#l8.182"></a><span id="l8.182"> </span>
<a href="#l8.183"></a><span id="l8.183">     fieldMap.DefaultFieldMap(fieldMap.numMozFields);</span>
<a href="#l8.184"></a><span id="l8.184">     fieldMap.skipFirstRecord = aSkipFirstRecord;</span>
<a href="#l8.185"></a><span id="l8.185"> </span>
<a href="#l8.186"></a><span id="l8.186">     return fieldMap;</span>
<a href="#l8.187"></a><span id="l8.187">   },</span>
<a href="#l8.188"></a><span id="l8.188"> </span>
<a href="#l8.189"></a><span id="l8.189">   /**</span>
<a href="#l8.190"></a><span id="l8.190">    * AbImportHelper.setFieldMap</span>
<a href="#l8.191"></a><span id="l8.191">    * Set the field map.</span>
<a href="#l8.192"></a><span id="l8.192">    *</span>
<a href="#l8.193"></a><span id="l8.193">    * @param aFieldMap The field map used for address book import.</span>
<a href="#l8.194"></a><span id="l8.194">    */</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineminus">-  setFieldMap: function(aFieldMap) {</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineplus">+  setFieldMap(aFieldMap) {</span>
<a href="#l8.197"></a><span id="l8.197">     this.mInterface.SetData(&quot;fieldMap&quot;, aFieldMap);</span>
<a href="#l8.198"></a><span id="l8.198">   },</span>
<a href="#l8.199"></a><span id="l8.199"> </span>
<a href="#l8.200"></a><span id="l8.200">   /**</span>
<a href="#l8.201"></a><span id="l8.201">    * AbImportHelper.setAddressLocation</span>
<a href="#l8.202"></a><span id="l8.202">    * Set the the location of the address book.</span>
<a href="#l8.203"></a><span id="l8.203">    *</span>
<a href="#l8.204"></a><span id="l8.204">    * @param aLocation The location of the source address book.</span>
<a href="#l8.205"></a><span id="l8.205">    */</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineminus">-  setAddressBookLocation: function(aLocation) {</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineplus">+  setAddressBookLocation(aLocation) {</span>
<a href="#l8.208"></a><span id="l8.208">     this.mInterface.SetData(&quot;addressLocation&quot;, aLocation);</span>
<a href="#l8.209"></a><span id="l8.209">   },</span>
<a href="#l8.210"></a><span id="l8.210"> </span>
<a href="#l8.211"></a><span id="l8.211">   /**</span>
<a href="#l8.212"></a><span id="l8.212">    * AbImportHelper.setAddressDestination</span>
<a href="#l8.213"></a><span id="l8.213">    * Set the the destination of the address book.</span>
<a href="#l8.214"></a><span id="l8.214">    *</span>
<a href="#l8.215"></a><span id="l8.215">    * @param aDestination   URI of destination address book or null if</span>
<a href="#l8.216"></a><span id="l8.216">    *                       new address books will be created.</span>
<a href="#l8.217"></a><span id="l8.217">    */</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineminus">-  setAddressDestination: function(aDestination) {</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+  setAddressDestination(aDestination) {</span>
<a href="#l8.220"></a><span id="l8.220">     this.mInterface.SetData(&quot;addressDestination&quot;, aDestination);</span>
<a href="#l8.221"></a><span id="l8.221">   },</span>
<a href="#l8.222"></a><span id="l8.222"> </span>
<a href="#l8.223"></a><span id="l8.223">   /**</span>
<a href="#l8.224"></a><span id="l8.224">    * AbImportHelper.checkResults</span>
<a href="#l8.225"></a><span id="l8.225">    * Checks the results of the import.</span>
<a href="#l8.226"></a><span id="l8.226">    * Ensures the an address book was created, then compares the supported</span>
<a href="#l8.227"></a><span id="l8.227">    * attributes of each card with the card(s) in the JSON array.</span>
<a href="#l8.228"></a><span id="l8.228">    * Calls do_test_finished() when done</span>
<a href="#l8.229"></a><span id="l8.229">    */</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineminus">-  checkResults: function() {</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+  checkResults() {</span>
<a href="#l8.232"></a><span id="l8.232">     if (!this.mJsonCards)</span>
<a href="#l8.233"></a><span id="l8.233">       do_throw(&quot;The address book must be setup before checking results&quot;);</span>
<a href="#l8.234"></a><span id="l8.234">     // When do_test_pending() was called and there is an error the test hangs.</span>
<a href="#l8.235"></a><span id="l8.235">     // This try/catch block will catch any errors and call do_throw() with the</span>
<a href="#l8.236"></a><span id="l8.236">     // error to throw the error and avoid the hang.</span>
<a href="#l8.237"></a><span id="l8.237">     try {</span>
<a href="#l8.238"></a><span id="l8.238">       // make sure an address book was created</span>
<a href="#l8.239"></a><span id="l8.239">       var newAb = this.getAbByName(this.mAbName);</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineat">@@ -242,27 +237,29 @@ AbImportHelper.prototype =</span>
<a href="#l8.241"></a><span id="l8.241">       for (; iter.hasMoreElements(); count++) {</span>
<a href="#l8.242"></a><span id="l8.242">         var importedCard = iter.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l8.243"></a><span id="l8.243">         this.compareCards(this.mJsonCards[count], importedCard);</span>
<a href="#l8.244"></a><span id="l8.244">       }</span>
<a href="#l8.245"></a><span id="l8.245">       // make sure there are the same number of cards in the address book and</span>
<a href="#l8.246"></a><span id="l8.246">       // the JSON array</span>
<a href="#l8.247"></a><span id="l8.247">       Assert.equal(count, this.mJsonCards.length);</span>
<a href="#l8.248"></a><span id="l8.248">       do_test_finished();</span>
<a href="#l8.249"></a><span id="l8.249" class="difflineminus">-    } catch(e) { do_throw(e); }</span>
<a href="#l8.250"></a><span id="l8.250" class="difflineplus">+    } catch (e) {</span>
<a href="#l8.251"></a><span id="l8.251" class="difflineplus">+      do_throw(e);</span>
<a href="#l8.252"></a><span id="l8.252" class="difflineplus">+    }</span>
<a href="#l8.253"></a><span id="l8.253">   },</span>
<a href="#l8.254"></a><span id="l8.254">   /**</span>
<a href="#l8.255"></a><span id="l8.255">    * AbImportHelper.getAbByName</span>
<a href="#l8.256"></a><span id="l8.256">    * Returns the Address Book (if any) with the given name.</span>
<a href="#l8.257"></a><span id="l8.257">    *</span>
<a href="#l8.258"></a><span id="l8.258">    * @param aName The name of the Address Book to find.</span>
<a href="#l8.259"></a><span id="l8.259">    * @return An nsIAbDirectory, if found.</span>
<a href="#l8.260"></a><span id="l8.260">    *         null if the requested Address Book could not be found.</span>
<a href="#l8.261"></a><span id="l8.261">    */</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineminus">-  getAbByName: function(aName) {</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineplus">+  getAbByName(aName) {</span>
<a href="#l8.264"></a><span id="l8.264">     Assert.ok(aName &amp;&amp; aName.length &gt; 0);</span>
<a href="#l8.265"></a><span id="l8.265"> </span>
<a href="#l8.266"></a><span id="l8.266">     var iter = MailServices.ab.directories;</span>
<a href="#l8.267"></a><span id="l8.267">     var data = null;</span>
<a href="#l8.268"></a><span id="l8.268">     while (iter.hasMoreElements()) {</span>
<a href="#l8.269"></a><span id="l8.269">       data = iter.getNext();</span>
<a href="#l8.270"></a><span id="l8.270">       if (data instanceof Ci.nsIAbDirectory)</span>
<a href="#l8.271"></a><span id="l8.271">         if (data.dirName == aName)</span>
<a href="#l8.272"></a><span id="l8.272" class="difflineat">@@ -273,33 +270,33 @@ AbImportHelper.prototype =</span>
<a href="#l8.273"></a><span id="l8.273">   /**</span>
<a href="#l8.274"></a><span id="l8.274">    * AbImportHelper.compareCards</span>
<a href="#l8.275"></a><span id="l8.275">    * Compares a JSON &quot;card&quot; with an imported card and throws an error if the</span>
<a href="#l8.276"></a><span id="l8.276">    * values of a supported attribute are different.</span>
<a href="#l8.277"></a><span id="l8.277">    *</span>
<a href="#l8.278"></a><span id="l8.278">    * @param aJsonCard The object decoded from addressbook.json.</span>
<a href="#l8.279"></a><span id="l8.279">    * @param aCard     The imported card to compare with.</span>
<a href="#l8.280"></a><span id="l8.280">    */</span>
<a href="#l8.281"></a><span id="l8.281" class="difflineminus">-  compareCards: function(aJsonCard, aCard) {</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineplus">+  compareCards(aJsonCard, aCard) {</span>
<a href="#l8.283"></a><span id="l8.283">     for (var i in aJsonCard)</span>
<a href="#l8.284"></a><span id="l8.284" class="difflineminus">-      if (this.mSupportedAttributes.indexOf(i) &gt;= 0)</span>
<a href="#l8.285"></a><span id="l8.285" class="difflineplus">+      if (this.mSupportedAttributes.includes(i))</span>
<a href="#l8.286"></a><span id="l8.286">         Assert.equal(aJsonCard[i], aCard.getProperty(i, &quot;BAD&quot;));</span>
<a href="#l8.287"></a><span id="l8.287">   },</span>
<a href="#l8.288"></a><span id="l8.288">   /**</span>
<a href="#l8.289"></a><span id="l8.289">    * AbImportHelper.getJsonCards</span>
<a href="#l8.290"></a><span id="l8.290">    * Gets an array of &quot;cards&quot; from the JSON file addressbook.json located in the</span>
<a href="#l8.291"></a><span id="l8.291">    * mailnews/import/test/resources folder.  The array should contain objects</span>
<a href="#l8.292"></a><span id="l8.292">    * with the expected properties and values of the cards in the imported</span>
<a href="#l8.293"></a><span id="l8.293">    * address book.</span>
<a href="#l8.294"></a><span id="l8.294">    * See addressbook.json for an example and AB_README for more details.</span>
<a href="#l8.295"></a><span id="l8.295">    *</span>
<a href="#l8.296"></a><span id="l8.296">    * @param aName The name of the array in addressbook.json.</span>
<a href="#l8.297"></a><span id="l8.297">    * @return An array of &quot;cards&quot;.</span>
<a href="#l8.298"></a><span id="l8.298">    */</span>
<a href="#l8.299"></a><span id="l8.299" class="difflineminus">-  getJsonCards: function(aName) {</span>
<a href="#l8.300"></a><span id="l8.300" class="difflineplus">+  getJsonCards(aName) {</span>
<a href="#l8.301"></a><span id="l8.301">     if (!aName)</span>
<a href="#l8.302"></a><span id="l8.302">       do_throw(&quot;Error - getJSONAb requires an address book name&quot;);</span>
<a href="#l8.303"></a><span id="l8.303">     var file = do_get_file(&quot;resources/addressbook.json&quot;);</span>
<a href="#l8.304"></a><span id="l8.304">     if (!file || !file.exists() || !file.isFile())</span>
<a href="#l8.305"></a><span id="l8.305">       do_throw(&quot;Unable to get JSON file&quot;);</span>
<a href="#l8.306"></a><span id="l8.306"> </span>
<a href="#l8.307"></a><span id="l8.307">     var fis = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l8.308"></a><span id="l8.308">                .createInstance(Ci.nsIFileInputStream);</span>
<a href="#l8.309"></a><span id="l8.309" class="difflineat">@@ -307,57 +304,55 @@ AbImportHelper.prototype =</span>
<a href="#l8.310"></a><span id="l8.310">     var istream = Cc[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l8.311"></a><span id="l8.311">                    .createInstance(Ci.nsIConverterInputStream);</span>
<a href="#l8.312"></a><span id="l8.312">     var replacementChar = Ci.nsIConverterInputStream</span>
<a href="#l8.313"></a><span id="l8.313">                             .DEFAULT_REPLACEMENT_CHARACTER;</span>
<a href="#l8.314"></a><span id="l8.314">     istream.init(fis, &quot;UTF-8&quot;, 1024, replacementChar);</span>
<a href="#l8.315"></a><span id="l8.315">     var json = &quot;&quot;;</span>
<a href="#l8.316"></a><span id="l8.316">     var str = {};</span>
<a href="#l8.317"></a><span id="l8.317">     // get the entire file into the json string</span>
<a href="#l8.318"></a><span id="l8.318" class="difflineminus">-    while(istream.readString(4096, str) != 0)</span>
<a href="#l8.319"></a><span id="l8.319" class="difflineplus">+    while (istream.readString(4096, str) != 0)</span>
<a href="#l8.320"></a><span id="l8.320">       json += str.value;</span>
<a href="#l8.321"></a><span id="l8.321">     // close the input streams</span>
<a href="#l8.322"></a><span id="l8.322">     istream.close();</span>
<a href="#l8.323"></a><span id="l8.323">     fis.close();</span>
<a href="#l8.324"></a><span id="l8.324">     // decode the JSON and get the array of cards</span>
<a href="#l8.325"></a><span id="l8.325">     var arr = JSON.parse(json)[aName];</span>
<a href="#l8.326"></a><span id="l8.326">     Assert.ok(arr &amp;&amp; arr.length &gt; 0);</span>
<a href="#l8.327"></a><span id="l8.327">     return arr;</span>
<a href="#l8.328"></a><span id="l8.328">   },</span>
<a href="#l8.329"></a><span id="l8.329"> </span>
<a href="#l8.330"></a><span id="l8.330" class="difflineminus">-  setSupportedAttributes: function(attributes) {</span>
<a href="#l8.331"></a><span id="l8.331" class="difflineplus">+  setSupportedAttributes(attributes) {</span>
<a href="#l8.332"></a><span id="l8.332">     this.mSupportedAttributes = attributes;</span>
<a href="#l8.333"></a><span id="l8.333" class="difflineminus">-  }</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineplus">+  },</span>
<a href="#l8.335"></a><span id="l8.335"> };</span>
<a href="#l8.336"></a><span id="l8.336"> </span>
<a href="#l8.337"></a><span id="l8.337"> /**</span>
<a href="#l8.338"></a><span id="l8.338">  * MailImportHelper</span>
<a href="#l8.339"></a><span id="l8.339">  * A helper for mail imports.</span>
<a href="#l8.340"></a><span id="l8.340">  *</span>
<a href="#l8.341"></a><span id="l8.341">  * @param aFile      An instance of nsIFile to import.</span>
<a href="#l8.342"></a><span id="l8.342">  * @param aModuleSearchString</span>
<a href="#l8.343"></a><span id="l8.343">  *                   The string to search the module names for, such as</span>
<a href="#l8.344"></a><span id="l8.344">  *                   &quot;Outlook Express&quot;, etc.</span>
<a href="#l8.345"></a><span id="l8.345">  * @param aExpected  An instance of nsIFile to compare with the imported</span>
<a href="#l8.346"></a><span id="l8.346">  *                   folders.</span>
<a href="#l8.347"></a><span id="l8.347">  *</span>
<a href="#l8.348"></a><span id="l8.348">  * @constructor</span>
<a href="#l8.349"></a><span id="l8.349">  * @class</span>
<a href="#l8.350"></a><span id="l8.350">  */</span>
<a href="#l8.351"></a><span id="l8.351" class="difflineminus">-function MailImportHelper(aFile, aModuleSearchString, aExpected)</span>
<a href="#l8.352"></a><span id="l8.352" class="difflineminus">-{</span>
<a href="#l8.353"></a><span id="l8.353" class="difflineplus">+function MailImportHelper(aFile, aModuleSearchString, aExpected) {</span>
<a href="#l8.354"></a><span id="l8.354">   GenericImportHelper.call(this, &quot;mail&quot;, aModuleSearchString, aFile);</span>
<a href="#l8.355"></a><span id="l8.355">   this.mExpected = aExpected;</span>
<a href="#l8.356"></a><span id="l8.356"> }</span>
<a href="#l8.357"></a><span id="l8.357"> </span>
<a href="#l8.358"></a><span id="l8.358" class="difflineminus">-MailImportHelper.prototype =</span>
<a href="#l8.359"></a><span id="l8.359" class="difflineminus">-{</span>
<a href="#l8.360"></a><span id="l8.360" class="difflineplus">+MailImportHelper.prototype = {</span>
<a href="#l8.361"></a><span id="l8.361">   __proto__: GenericImportHelper.prototype,</span>
<a href="#l8.362"></a><span id="l8.362">   interfaceType: Ci.nsIImportGeneric,</span>
<a href="#l8.363"></a><span id="l8.363" class="difflineminus">-  _checkEqualFolder: function(expectedFolder, actualFolder) {</span>
<a href="#l8.364"></a><span id="l8.364" class="difflineplus">+  _checkEqualFolder(expectedFolder, actualFolder) {</span>
<a href="#l8.365"></a><span id="l8.365">     Assert.equal(expectedFolder.leafName, actualFolder.name);</span>
<a href="#l8.366"></a><span id="l8.366">     let expectedSubFolderCount = 0;</span>
<a href="#l8.367"></a><span id="l8.367"> </span>
<a href="#l8.368"></a><span id="l8.368">     let expectedEnumerator = expectedFolder.directoryEntries;</span>
<a href="#l8.369"></a><span id="l8.369">     let expectedSubFolders = [];</span>
<a href="#l8.370"></a><span id="l8.370">     while (expectedEnumerator.hasMoreElements()) {</span>
<a href="#l8.371"></a><span id="l8.371">       let entry = expectedEnumerator.getNext().QueryInterface(Ci.nsIFile);</span>
<a href="#l8.372"></a><span id="l8.372">       if (entry.isDirectory()) {</span>
<a href="#l8.373"></a><span id="l8.373" class="difflineat">@@ -370,201 +365,197 @@ MailImportHelper.prototype =</span>
<a href="#l8.374"></a><span id="l8.374">     let actualEnumerator = actualFolder.subFolders;</span>
<a href="#l8.375"></a><span id="l8.375">     for (let i = 0; i &lt; expectedSubFolderCount; i++) {</span>
<a href="#l8.376"></a><span id="l8.376">       let expectedSubFolder = expectedSubFolders[i];</span>
<a href="#l8.377"></a><span id="l8.377">       let actualSubFolder = actualEnumerator.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l8.378"></a><span id="l8.378">       this._checkEqualFolder(expectedSubFolder, actualSubFolder);</span>
<a href="#l8.379"></a><span id="l8.379">     }</span>
<a href="#l8.380"></a><span id="l8.380">   },</span>
<a href="#l8.381"></a><span id="l8.381"> </span>
<a href="#l8.382"></a><span id="l8.382" class="difflineminus">-  checkResults: function() {</span>
<a href="#l8.383"></a><span id="l8.383" class="difflineplus">+  checkResults() {</span>
<a href="#l8.384"></a><span id="l8.384">     let rootFolder = MailServices.accounts.localFoldersServer.rootFolder;</span>
<a href="#l8.385"></a><span id="l8.385">     Assert.ok(rootFolder.containsChildNamed(this.mFile.leafName));</span>
<a href="#l8.386"></a><span id="l8.386">     let importedFolder = rootFolder.getChildNamed(this.mFile.leafName);</span>
<a href="#l8.387"></a><span id="l8.387">     Assert.notEqual(importedFolder, null);</span>
<a href="#l8.388"></a><span id="l8.388"> </span>
<a href="#l8.389"></a><span id="l8.389">     this._checkEqualFolder(this.mExpected, importedFolder);</span>
<a href="#l8.390"></a><span id="l8.390" class="difflineminus">-  }</span>
<a href="#l8.391"></a><span id="l8.391" class="difflineminus">-}</span>
<a href="#l8.392"></a><span id="l8.392" class="difflineplus">+  },</span>
<a href="#l8.393"></a><span id="l8.393" class="difflineplus">+};</span>
<a href="#l8.394"></a><span id="l8.394"> </span>
<a href="#l8.395"></a><span id="l8.395"> /**</span>
<a href="#l8.396"></a><span id="l8.396">  * SettingsImportHelper</span>
<a href="#l8.397"></a><span id="l8.397">  * A helper for settings imports.</span>
<a href="#l8.398"></a><span id="l8.398">  *</span>
<a href="#l8.399"></a><span id="l8.399">  * @param aFile      An instance of nsIFile to import, can be null.</span>
<a href="#l8.400"></a><span id="l8.400">  * @param aModuleSearchString</span>
<a href="#l8.401"></a><span id="l8.401">  *                   The string to search the module names for, such as</span>
<a href="#l8.402"></a><span id="l8.402">  *                   &quot;Outlook Express&quot;, etc.</span>
<a href="#l8.403"></a><span id="l8.403">  * @param aExpected  An array of object which has incomingServer, identity</span>
<a href="#l8.404"></a><span id="l8.404">  *                   and smtpSever to compare with imported nsIMsgAccount.</span>
<a href="#l8.405"></a><span id="l8.405">  *</span>
<a href="#l8.406"></a><span id="l8.406">  * @constructor</span>
<a href="#l8.407"></a><span id="l8.407">  * @class</span>
<a href="#l8.408"></a><span id="l8.408">  */</span>
<a href="#l8.409"></a><span id="l8.409" class="difflineminus">-function SettingsImportHelper(aFile, aModuleSearchString, aExpected)</span>
<a href="#l8.410"></a><span id="l8.410" class="difflineminus">-{</span>
<a href="#l8.411"></a><span id="l8.411" class="difflineplus">+function SettingsImportHelper(aFile, aModuleSearchString, aExpected) {</span>
<a href="#l8.412"></a><span id="l8.412">   GenericImportHelper.call(this, &quot;settings&quot;, aModuleSearchString, aFile);</span>
<a href="#l8.413"></a><span id="l8.413">   this.mExpected = aExpected;</span>
<a href="#l8.414"></a><span id="l8.414"> }</span>
<a href="#l8.415"></a><span id="l8.415"> </span>
<a href="#l8.416"></a><span id="l8.416" class="difflineminus">-SettingsImportHelper.prototype =</span>
<a href="#l8.417"></a><span id="l8.417" class="difflineminus">-{</span>
<a href="#l8.418"></a><span id="l8.418" class="difflineplus">+SettingsImportHelper.prototype = {</span>
<a href="#l8.419"></a><span id="l8.419">   __proto__: GenericImportHelper.prototype,</span>
<a href="#l8.420"></a><span id="l8.420">   interfaceType: Ci.nsIImportSettings,</span>
<a href="#l8.421"></a><span id="l8.421">   /**</span>
<a href="#l8.422"></a><span id="l8.422">    * SettingsImportHelper.beginImport</span>
<a href="#l8.423"></a><span id="l8.423">    * Imports settings from a specific file or auto-located if the file is null,</span>
<a href="#l8.424"></a><span id="l8.424">    * and compare the import results with the expected array.</span>
<a href="#l8.425"></a><span id="l8.425">    */</span>
<a href="#l8.426"></a><span id="l8.426" class="difflineminus">-  beginImport: function() {</span>
<a href="#l8.427"></a><span id="l8.427" class="difflineplus">+  beginImport() {</span>
<a href="#l8.428"></a><span id="l8.428">     this._ensureNoAccounts();</span>
<a href="#l8.429"></a><span id="l8.429">     if (this.mFile)</span>
<a href="#l8.430"></a><span id="l8.430">       this.mInterface.SetLocation(this.mFile);</span>
<a href="#l8.431"></a><span id="l8.431">     else</span>
<a href="#l8.432"></a><span id="l8.432">       Assert.equal(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l8.433"></a><span id="l8.433">     Assert.equal(true, this.mInterface.Import({}));</span>
<a href="#l8.434"></a><span id="l8.434">     this.checkResults();</span>
<a href="#l8.435"></a><span id="l8.435">   },</span>
<a href="#l8.436"></a><span id="l8.436"> </span>
<a href="#l8.437"></a><span id="l8.437" class="difflineminus">-  _ensureNoAccounts: function() {</span>
<a href="#l8.438"></a><span id="l8.438" class="difflineplus">+  _ensureNoAccounts() {</span>
<a href="#l8.439"></a><span id="l8.439">     let accounts = MailServices.accounts.accounts;</span>
<a href="#l8.440"></a><span id="l8.440"> </span>
<a href="#l8.441"></a><span id="l8.441">     for (let i = 0; i &lt; accounts.length; i++) {</span>
<a href="#l8.442"></a><span id="l8.442">       let account = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l8.443"></a><span id="l8.443">       MailServices.accounts.removeAccount(account);</span>
<a href="#l8.444"></a><span id="l8.444">     }</span>
<a href="#l8.445"></a><span id="l8.445">   },</span>
<a href="#l8.446"></a><span id="l8.446"> </span>
<a href="#l8.447"></a><span id="l8.447" class="difflineminus">-  _checkSmtpServer: function(expected, actual) {</span>
<a href="#l8.448"></a><span id="l8.448" class="difflineplus">+  _checkSmtpServer(expected, actual) {</span>
<a href="#l8.449"></a><span id="l8.449">     Assert.equal(expected.port, actual.port);</span>
<a href="#l8.450"></a><span id="l8.450">     Assert.equal(expected.username, actual.username);</span>
<a href="#l8.451"></a><span id="l8.451">     Assert.equal(expected.authMethod, actual.authMethod);</span>
<a href="#l8.452"></a><span id="l8.452">     Assert.equal(expected.socketType, actual.socketType);</span>
<a href="#l8.453"></a><span id="l8.453">   },</span>
<a href="#l8.454"></a><span id="l8.454"> </span>
<a href="#l8.455"></a><span id="l8.455" class="difflineminus">-  _checkIdentity: function(expected, actual) {</span>
<a href="#l8.456"></a><span id="l8.456" class="difflineplus">+  _checkIdentity(expected, actual) {</span>
<a href="#l8.457"></a><span id="l8.457">     Assert.equal(expected.fullName, actual.fullName);</span>
<a href="#l8.458"></a><span id="l8.458">     Assert.equal(expected.email, actual.email);</span>
<a href="#l8.459"></a><span id="l8.459">     Assert.equal(expected.replyTo, actual.replyTo);</span>
<a href="#l8.460"></a><span id="l8.460">     Assert.equal(expected.organization, actual.organization);</span>
<a href="#l8.461"></a><span id="l8.461">   },</span>
<a href="#l8.462"></a><span id="l8.462"> </span>
<a href="#l8.463"></a><span id="l8.463" class="difflineminus">-  _checkPop3IncomingServer: function(expected, actual) {</span>
<a href="#l8.464"></a><span id="l8.464" class="difflineplus">+  _checkPop3IncomingServer(expected, actual) {</span>
<a href="#l8.465"></a><span id="l8.465">     Assert.equal(expected.leaveMessagesOnServer, actual.leaveMessagesOnServer);</span>
<a href="#l8.466"></a><span id="l8.466">     Assert.equal(expected.deleteMailLeftOnServer, actual.deleteMailLeftOnServer);</span>
<a href="#l8.467"></a><span id="l8.467">     Assert.equal(expected.deleteByAgeFromServer, actual.deleteByAgeFromServer);</span>
<a href="#l8.468"></a><span id="l8.468">     Assert.equal(expected.numDaysToLeaveOnServer, actual.numDaysToLeaveOnServer);</span>
<a href="#l8.469"></a><span id="l8.469">   },</span>
<a href="#l8.470"></a><span id="l8.470"> </span>
<a href="#l8.471"></a><span id="l8.471" class="difflineminus">-  _checkIncomingServer: function(expected, actual) {</span>
<a href="#l8.472"></a><span id="l8.472" class="difflineplus">+  _checkIncomingServer(expected, actual) {</span>
<a href="#l8.473"></a><span id="l8.473">     Assert.equal(expected.type, actual.type);</span>
<a href="#l8.474"></a><span id="l8.474">     Assert.equal(expected.port, actual.port);</span>
<a href="#l8.475"></a><span id="l8.475">     Assert.equal(expected.username, actual.username);</span>
<a href="#l8.476"></a><span id="l8.476">     Assert.equal(expected.isSecure, actual.isSecure);</span>
<a href="#l8.477"></a><span id="l8.477">     Assert.equal(expected.hostName, actual.hostName);</span>
<a href="#l8.478"></a><span id="l8.478">     Assert.equal(expected.prettyName, actual.prettyName);</span>
<a href="#l8.479"></a><span id="l8.479">     Assert.equal(expected.authMethod, actual.authMethod);</span>
<a href="#l8.480"></a><span id="l8.480">     Assert.equal(expected.socketType, actual.socketType);</span>
<a href="#l8.481"></a><span id="l8.481">     Assert.equal(expected.doBiff, actual.doBiff);</span>
<a href="#l8.482"></a><span id="l8.482">     Assert.equal(expected.biffMinutes, actual.biffMinutes);</span>
<a href="#l8.483"></a><span id="l8.483"> </span>
<a href="#l8.484"></a><span id="l8.484">     if (expected.type == &quot;pop3&quot;)</span>
<a href="#l8.485"></a><span id="l8.485">       this._checkPop3IncomingServer(expected, actual.QueryInterface(Ci.nsIPop3IncomingServer));</span>
<a href="#l8.486"></a><span id="l8.486">   },</span>
<a href="#l8.487"></a><span id="l8.487"> </span>
<a href="#l8.488"></a><span id="l8.488" class="difflineminus">-  _checkAccount: function(expected, actual) {</span>
<a href="#l8.489"></a><span id="l8.489" class="difflineplus">+  _checkAccount(expected, actual) {</span>
<a href="#l8.490"></a><span id="l8.490">     this._checkIncomingServer(expected.incomingServer, actual.incomingServer);</span>
<a href="#l8.491"></a><span id="l8.491"> </span>
<a href="#l8.492"></a><span id="l8.492">     Assert.equal(1, actual.identities.length);</span>
<a href="#l8.493"></a><span id="l8.493">     let actualIdentity = actual.identities.queryElementAt(0, Ci.nsIMsgIdentity);</span>
<a href="#l8.494"></a><span id="l8.494">     this._checkIdentity(expected.identity, actualIdentity);</span>
<a href="#l8.495"></a><span id="l8.495"> </span>
<a href="#l8.496"></a><span id="l8.496">     if (expected.incomingServer.type != &quot;nntp&quot;) {</span>
<a href="#l8.497"></a><span id="l8.497">       let actualSmtpServer = MailServices.smtp.getServerByKey(actualIdentity.smtpServerKey);</span>
<a href="#l8.498"></a><span id="l8.498">       this._checkSmtpServer(expected.smtpServer, actualSmtpServer);</span>
<a href="#l8.499"></a><span id="l8.499">     }</span>
<a href="#l8.500"></a><span id="l8.500">   },</span>
<a href="#l8.501"></a><span id="l8.501"> </span>
<a href="#l8.502"></a><span id="l8.502" class="difflineminus">-  _isLocalMailAccount: function(account) {</span>
<a href="#l8.503"></a><span id="l8.503" class="difflineplus">+  _isLocalMailAccount(account) {</span>
<a href="#l8.504"></a><span id="l8.504">     return (account.incomingServer.type == &quot;none&quot; &amp;&amp;</span>
<a href="#l8.505"></a><span id="l8.505">             account.incomingServer.username == &quot;nobody&quot; &amp;&amp;</span>
<a href="#l8.506"></a><span id="l8.506">             account.incomingServer.hostName == &quot;Local Folders&quot;);</span>
<a href="#l8.507"></a><span id="l8.507">   },</span>
<a href="#l8.508"></a><span id="l8.508"> </span>
<a href="#l8.509"></a><span id="l8.509" class="difflineminus">-  _findExpectedAccount: function(account) {</span>
<a href="#l8.510"></a><span id="l8.510" class="difflineplus">+  _findExpectedAccount(account) {</span>
<a href="#l8.511"></a><span id="l8.511">     return this.mExpected.filter(function(expectedAccount) {</span>
<a href="#l8.512"></a><span id="l8.512">       return (expectedAccount.incomingServer.type == account.incomingServer.type &amp;&amp;</span>
<a href="#l8.513"></a><span id="l8.513">               expectedAccount.incomingServer.username == account.incomingServer.username &amp;&amp;</span>
<a href="#l8.514"></a><span id="l8.514">               expectedAccount.incomingServer.hostName == account.incomingServer.hostName);</span>
<a href="#l8.515"></a><span id="l8.515">     });</span>
<a href="#l8.516"></a><span id="l8.516">   },</span>
<a href="#l8.517"></a><span id="l8.517"> </span>
<a href="#l8.518"></a><span id="l8.518" class="difflineminus">-  checkResults: function() {</span>
<a href="#l8.519"></a><span id="l8.519" class="difflineminus">-    accounts = MailServices.accounts.accounts;</span>
<a href="#l8.520"></a><span id="l8.520" class="difflineplus">+  checkResults() {</span>
<a href="#l8.521"></a><span id="l8.521" class="difflineplus">+    let accounts = MailServices.accounts.accounts;</span>
<a href="#l8.522"></a><span id="l8.522">     for (let i = 0; i &lt; accounts.length - 1; i++) {</span>
<a href="#l8.523"></a><span id="l8.523">       let actualAccount = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l8.524"></a><span id="l8.524">       if (this._isLocalMailAccount(actualAccount))</span>
<a href="#l8.525"></a><span id="l8.525">         continue;</span>
<a href="#l8.526"></a><span id="l8.526">       let expectedAccounts = this._findExpectedAccount(actualAccount);</span>
<a href="#l8.527"></a><span id="l8.527">       Assert.notEqual(null, expectedAccounts);</span>
<a href="#l8.528"></a><span id="l8.528">       Assert.equal(1, expectedAccounts.length);</span>
<a href="#l8.529"></a><span id="l8.529">       this._checkAccount(expectedAccounts[0], actualAccount);</span>
<a href="#l8.530"></a><span id="l8.530">     }</span>
<a href="#l8.531"></a><span id="l8.531" class="difflineminus">-  }</span>
<a href="#l8.532"></a><span id="l8.532" class="difflineminus">-}</span>
<a href="#l8.533"></a><span id="l8.533" class="difflineplus">+  },</span>
<a href="#l8.534"></a><span id="l8.534" class="difflineplus">+};</span>
<a href="#l8.535"></a><span id="l8.535"> </span>
<a href="#l8.536"></a><span id="l8.536"> /**</span>
<a href="#l8.537"></a><span id="l8.537">  * FiltersImportHelper</span>
<a href="#l8.538"></a><span id="l8.538">  * A helper for filter imports.</span>
<a href="#l8.539"></a><span id="l8.539">  *</span>
<a href="#l8.540"></a><span id="l8.540">  * @param aFile      An instance of nsIFile to import.</span>
<a href="#l8.541"></a><span id="l8.541">  * @param aModuleSearchString</span>
<a href="#l8.542"></a><span id="l8.542">  *                   The string to search the module names for, such as</span>
<a href="#l8.543"></a><span id="l8.543">  *                   &quot;Outlook Express&quot;, etc.</span>
<a href="#l8.544"></a><span id="l8.544">  * @param aExpected  The number of filters that should exists after import.</span>
<a href="#l8.545"></a><span id="l8.545">  *</span>
<a href="#l8.546"></a><span id="l8.546">  * @constructor</span>
<a href="#l8.547"></a><span id="l8.547">  * @class</span>
<a href="#l8.548"></a><span id="l8.548">  */</span>
<a href="#l8.549"></a><span id="l8.549" class="difflineminus">-function FiltersImportHelper(aFile, aModuleSearchString, aExpected)</span>
<a href="#l8.550"></a><span id="l8.550" class="difflineminus">-{</span>
<a href="#l8.551"></a><span id="l8.551" class="difflineplus">+function FiltersImportHelper(aFile, aModuleSearchString, aExpected) {</span>
<a href="#l8.552"></a><span id="l8.552">   GenericImportHelper.call(this, &quot;filters&quot;, aModuleSearchString, aFile);</span>
<a href="#l8.553"></a><span id="l8.553">   this.mExpected = aExpected;</span>
<a href="#l8.554"></a><span id="l8.554"> }</span>
<a href="#l8.555"></a><span id="l8.555"> </span>
<a href="#l8.556"></a><span id="l8.556" class="difflineminus">-FiltersImportHelper.prototype =</span>
<a href="#l8.557"></a><span id="l8.557" class="difflineminus">-{</span>
<a href="#l8.558"></a><span id="l8.558" class="difflineplus">+FiltersImportHelper.prototype = {</span>
<a href="#l8.559"></a><span id="l8.559">   __proto__: GenericImportHelper.prototype,</span>
<a href="#l8.560"></a><span id="l8.560">   interfaceType: Ci.nsIImportFilters,</span>
<a href="#l8.561"></a><span id="l8.561"> </span>
<a href="#l8.562"></a><span id="l8.562">   /**</span>
<a href="#l8.563"></a><span id="l8.563">    * FiltersImportHelper.beginImport</span>
<a href="#l8.564"></a><span id="l8.564">    * Imports filters from a specific file/folder or auto-located if the file is null,</span>
<a href="#l8.565"></a><span id="l8.565">    * and compare the import results with the expected array.</span>
<a href="#l8.566"></a><span id="l8.566">    */</span>
<a href="#l8.567"></a><span id="l8.567" class="difflineminus">-  beginImport: function() {</span>
<a href="#l8.568"></a><span id="l8.568" class="difflineplus">+  beginImport() {</span>
<a href="#l8.569"></a><span id="l8.569">     if (this.mFile)</span>
<a href="#l8.570"></a><span id="l8.570">       this.mInterface.SetLocation(this.mFile);</span>
<a href="#l8.571"></a><span id="l8.571">     else</span>
<a href="#l8.572"></a><span id="l8.572">       Assert.equal(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l8.573"></a><span id="l8.573">     Assert.equal(true, this.mInterface.Import({}));</span>
<a href="#l8.574"></a><span id="l8.574">     this.checkResults();</span>
<a href="#l8.575"></a><span id="l8.575">   },</span>
<a href="#l8.576"></a><span id="l8.576"> </span>
<a href="#l8.577"></a><span id="l8.577" class="difflineminus">-  _loopOverFilters: function(aFilterList, aCondition) {</span>
<a href="#l8.578"></a><span id="l8.578" class="difflineplus">+  _loopOverFilters(aFilterList, aCondition) {</span>
<a href="#l8.579"></a><span id="l8.579">     let result = 0;</span>
<a href="#l8.580"></a><span id="l8.580">     for (let i = 0; i &lt; aFilterList.filterCount; i++) {</span>
<a href="#l8.581"></a><span id="l8.581">       let filter = aFilterList.getFilterAt(i);</span>
<a href="#l8.582"></a><span id="l8.582">       if (aCondition(filter))</span>
<a href="#l8.583"></a><span id="l8.583">         result++;</span>
<a href="#l8.584"></a><span id="l8.584">     }</span>
<a href="#l8.585"></a><span id="l8.585">     return result;</span>
<a href="#l8.586"></a><span id="l8.586">   },</span>
<a href="#l8.587"></a><span id="l8.587"> </span>
<a href="#l8.588"></a><span id="l8.588" class="difflineminus">-  checkResults: function() {</span>
<a href="#l8.589"></a><span id="l8.589" class="difflineplus">+  checkResults() {</span>
<a href="#l8.590"></a><span id="l8.590">     let expected = this.mExpected;</span>
<a href="#l8.591"></a><span id="l8.591">     let server = MailServices.accounts.localFoldersServer;</span>
<a href="#l8.592"></a><span id="l8.592">     let filterList = server.getFilterList(null);</span>
<a href="#l8.593"></a><span id="l8.593">     if (&quot;count&quot; in expected)</span>
<a href="#l8.594"></a><span id="l8.594">       Assert.equal(filterList.filterCount, expected.count);</span>
<a href="#l8.595"></a><span id="l8.595">     if (&quot;enabled&quot; in expected)</span>
<a href="#l8.596"></a><span id="l8.596">       Assert.equal(this._loopOverFilters(filterList, f =&gt; f.enabled), expected.enabled);</span>
<a href="#l8.597"></a><span id="l8.597">     if (&quot;incoming&quot; in expected) {</span>
<a href="#l8.598"></a><span id="l8.598" class="difflineat">@@ -572,13 +563,13 @@ FiltersImportHelper.prototype =</span>
<a href="#l8.599"></a><span id="l8.599">                                          f =&gt; (f.filterType &amp; Ci.nsMsgFilterType.InboxRule)),</span>
<a href="#l8.600"></a><span id="l8.600">                                          expected.incoming);</span>
<a href="#l8.601"></a><span id="l8.601">     }</span>
<a href="#l8.602"></a><span id="l8.602">     if (&quot;outgoing&quot; in expected) {</span>
<a href="#l8.603"></a><span id="l8.603">       Assert.equal(this._loopOverFilters(filterList,</span>
<a href="#l8.604"></a><span id="l8.604">                                          f =&gt; (f.filterType &amp; Ci.nsMsgFilterType.PostOutgoing)),</span>
<a href="#l8.605"></a><span id="l8.605">                                          expected.outgoing);</span>
<a href="#l8.606"></a><span id="l8.606">     }</span>
<a href="#l8.607"></a><span id="l8.607" class="difflineminus">-  }</span>
<a href="#l8.608"></a><span id="l8.608" class="difflineminus">-}</span>
<a href="#l8.609"></a><span id="l8.609" class="difflineplus">+  },</span>
<a href="#l8.610"></a><span id="l8.610" class="difflineplus">+};</span>
<a href="#l8.611"></a><span id="l8.611"> </span>
<a href="#l8.612"></a><span id="l8.612"> </span>
<a href="#l8.613"></a><span id="l8.613"> do_load_manifest(&quot;resources/TestMailImporter.manifest&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/mock_windows_reg_factory.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/mock_windows_reg_factory.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -4,68 +4,69 @@ var gUuid;</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> function MockWindowsRegKey(registryData) {</span>
<a href="#l9.6"></a><span id="l9.6">   this._registryData = registryData;</span>
<a href="#l9.7"></a><span id="l9.7"> }</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> MockWindowsRegKey.prototype = {</span>
<a href="#l9.10"></a><span id="l9.10">   QueryInterface: ChromeUtils.generateQI([Ci.nsIWindowsRegKey]),</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  open: function(aRootKey, aRelPath, aMode) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  open(aRootKey, aRelPath, aMode) {</span>
<a href="#l9.14"></a><span id="l9.14">     if (!this._registryData[aRelPath])</span>
<a href="#l9.15"></a><span id="l9.15">       throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l9.16"></a><span id="l9.16">     this._keyPath = aRelPath;</span>
<a href="#l9.17"></a><span id="l9.17">   },</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-  close: function() {</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+  close() {</span>
<a href="#l9.21"></a><span id="l9.21">   },</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-  openChild: function(aRelPath, aMode) {</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  openChild(aRelPath, aMode) {</span>
<a href="#l9.25"></a><span id="l9.25">     if (!this._registryData[this._keyPath] ||</span>
<a href="#l9.26"></a><span id="l9.26">         !this._registryData[this._keyPath][aRelPath])</span>
<a href="#l9.27"></a><span id="l9.27">       throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l9.28"></a><span id="l9.28"> </span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-    child = new MockWindowsRegKey({});</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+    let child = new MockWindowsRegKey({});</span>
<a href="#l9.31"></a><span id="l9.31">     let newKeyPath = this._keyPath + &quot;\\&quot; + aRelPath;</span>
<a href="#l9.32"></a><span id="l9.32">     child._keyPath = newKeyPath;</span>
<a href="#l9.33"></a><span id="l9.33">     child._registryData[newKeyPath] =</span>
<a href="#l9.34"></a><span id="l9.34">       this._registryData[this._keyPath][aRelPath];</span>
<a href="#l9.35"></a><span id="l9.35">     return child;</span>
<a href="#l9.36"></a><span id="l9.36">   },</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38">   get childCount() {</span>
<a href="#l9.39"></a><span id="l9.39">     return Object.keys(this._registryData[this._keyPath]).length;</span>
<a href="#l9.40"></a><span id="l9.40">   },</span>
<a href="#l9.41"></a><span id="l9.41"> </span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-  getChildName: function(aIndex) {</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+  getChildName(aIndex) {</span>
<a href="#l9.44"></a><span id="l9.44">     let keys = Object.keys(this._registryData[this._keyPath]);</span>
<a href="#l9.45"></a><span id="l9.45">     let keyAtIndex = keys[aIndex];</span>
<a href="#l9.46"></a><span id="l9.46">     if (!keyAtIndex)</span>
<a href="#l9.47"></a><span id="l9.47">       throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49">     return keyAtIndex;</span>
<a href="#l9.50"></a><span id="l9.50">   },</span>
<a href="#l9.51"></a><span id="l9.51"> </span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-  _readValue: function(aName) {</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  _readValue(aName) {</span>
<a href="#l9.54"></a><span id="l9.54">     if (!this._registryData[this._keyPath] ||</span>
<a href="#l9.55"></a><span id="l9.55">         !this._registryData[this._keyPath][aName])</span>
<a href="#l9.56"></a><span id="l9.56">       throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l9.57"></a><span id="l9.57"> </span>
<a href="#l9.58"></a><span id="l9.58">     return this._registryData[this._keyPath][aName];</span>
<a href="#l9.59"></a><span id="l9.59">   },</span>
<a href="#l9.60"></a><span id="l9.60"> </span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-  readIntValue: function(aName) {</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+  readIntValue(aName) {</span>
<a href="#l9.63"></a><span id="l9.63">     return this._readValue(aName);</span>
<a href="#l9.64"></a><span id="l9.64">   },</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-  readStringValue: function(aName) {</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+  readStringValue(aName) {</span>
<a href="#l9.68"></a><span id="l9.68">     return this._readValue(aName);</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-  }</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+  },</span>
<a href="#l9.71"></a><span id="l9.71"> };</span>
<a href="#l9.72"></a><span id="l9.72"> </span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+/* exported setup_mock_registry, teardown_mock_registry */</span>
<a href="#l9.74"></a><span id="l9.74"> function setup_mock_registry(mockRegistry) {</span>
<a href="#l9.75"></a><span id="l9.75">   gUuid = MockFactory.register(&quot;@mozilla.org/windows-registry-key;1&quot;,</span>
<a href="#l9.76"></a><span id="l9.76">                               MockWindowsRegKey, mockRegistry);</span>
<a href="#l9.77"></a><span id="l9.77"> }</span>
<a href="#l9.78"></a><span id="l9.78"> </span>
<a href="#l9.79"></a><span id="l9.79"> function teardown_mock_registry() {</span>
<a href="#l9.80"></a><span id="l9.80">   MockFactory.unregister(gUuid);</span>
<a href="#l9.81"></a><span id="l9.81"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/test/unit/test_becky_addressbook.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_becky_addressbook.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l10.4"></a><span id="l10.4"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-function run_test()</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">-{</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+function run_test() {</span>
<a href="#l10.9"></a><span id="l10.9">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l10.10"></a><span id="l10.10">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  MailServices.ab;</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14">   let file = do_get_file(&quot;resources/becky/addressbooks&quot;);</span>
<a href="#l10.15"></a><span id="l10.15">   let helper = new AbImportHelper(file, &quot;Becky!&quot;, &quot;addressbooks&quot;,</span>
<a href="#l10.16"></a><span id="l10.16">                                   &quot;becky_addressbook&quot;);</span>
<a href="#l10.17"></a><span id="l10.17">   let vcfSupportedAttributes =</span>
<a href="#l10.18"></a><span id="l10.18">     [&quot;FirstName&quot;, &quot;LastName&quot;, &quot;DisplayName&quot;, &quot;NickName&quot;, &quot;PrimaryEmail&quot;,</span>
<a href="#l10.19"></a><span id="l10.19">      &quot;SecondEmail&quot;, &quot;WorkPhone&quot;, &quot;HomePhone&quot;, &quot;FaxNumber&quot;, &quot;PagerNumber&quot;,</span>
<a href="#l10.20"></a><span id="l10.20">      &quot;CellularNumber&quot;, &quot;HomeAddress&quot;, &quot;HomeAddress2&quot;, &quot;HomeCity&quot;, &quot;HomeState&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/test/unit/test_becky_filters.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_becky_filters.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l11.4"></a><span id="l11.4"> const {localAccountUtils} = ChromeUtils.import(&quot;resource://testing-common/mailnews/localAccountUtils.js&quot;);</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-function run_test()</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">-{</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+function run_test() {</span>
<a href="#l11.9"></a><span id="l11.9">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l11.12"></a><span id="l11.12">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  MailServices.ab;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">   // Import incoming filters.</span>
<a href="#l11.17"></a><span id="l11.17">   let file = do_get_file(&quot;resources/becky/filters/IFilter.def&quot;);</span>
<a href="#l11.18"></a><span id="l11.18">   let helper1 = new FiltersImportHelper(file, &quot;Becky!&quot;,</span>
<a href="#l11.19"></a><span id="l11.19">                                         { count: 3, enabled: 2, incoming: 3, outgoing: 0 });</span>
<a href="#l11.20"></a><span id="l11.20">   helper1.beginImport();</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22">   // Import outgoing filters.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/test/unit/test_bug_263304.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_bug_263304.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -3,17 +3,16 @@</span>
<a href="#l12.4"></a><span id="l12.4">  * (LDIF) with a labeledURI and checks the accuracy of the imported contact.</span>
<a href="#l12.5"></a><span id="l12.5">  *</span>
<a href="#l12.6"></a><span id="l12.6">  * This test checks for the following bug:</span>
<a href="#l12.7"></a><span id="l12.7">  *   - Bug 264405: The Address Book doesn't show the LDAP-field &quot;labeledURI&quot;</span>
<a href="#l12.8"></a><span id="l12.8">  *                 as Website</span>
<a href="#l12.9"></a><span id="l12.9">  */</span>
<a href="#l12.10"></a><span id="l12.10"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-function run_test()</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-{</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+function run_test() {</span>
<a href="#l12.15"></a><span id="l12.15">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l12.16"></a><span id="l12.16">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-  var abMgr = MailServices.ab;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+  MailServices.ab;</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">   var file = do_get_file(&quot;resources/bug_263304.ldif&quot;);</span>
<a href="#l12.21"></a><span id="l12.21">   new AbImportHelper(file, &quot;Text file&quot;, &quot;bug_263304&quot;, &quot;bug_263304&quot;).beginImport();</span>
<a href="#l12.22"></a><span id="l12.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/test/unit/test_bug_437556.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_bug_437556.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,14 +1,13 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /**</span>
<a href="#l13.5"></a><span id="l13.5">  * Test for a regression of Bug 437556: mailnews crashes while importing an</span>
<a href="#l13.6"></a><span id="l13.6">  * address book if a field map is required but not set.</span>
<a href="#l13.7"></a><span id="l13.7">  */</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">-function run_test()</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-{</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+function run_test() {</span>
<a href="#l13.11"></a><span id="l13.11">   var file = do_get_file(&quot;resources/basic_addressbook.csv&quot;);</span>
<a href="#l13.12"></a><span id="l13.12">   var errorStr = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l13.13"></a><span id="l13.13">                   .createInstance(Ci.nsISupportsString);</span>
<a href="#l13.14"></a><span id="l13.14">   // get the Address Book text import interface and make sure it succeeded</span>
<a href="#l13.15"></a><span id="l13.15">   var helper = new AbImportHelper(file, &quot;Text file&quot;);</span>
<a href="#l13.16"></a><span id="l13.16">   helper.setFieldMap(null);</span>
<a href="#l13.17"></a><span id="l13.17">   helper.setAddressBookLocation(file);</span>
<a href="#l13.18"></a><span id="l13.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/import/test/unit/test_csv_import.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_csv_import.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -3,18 +3,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * format and checks the accuracy of the imported address book's cards.</span>
<a href="#l14.5"></a><span id="l14.5">  * The current export contains only one card with most fields full.</span>
<a href="#l14.6"></a><span id="l14.6">  *</span>
<a href="#l14.7"></a><span id="l14.7">  * This test also checks for the following bugs:</span>
<a href="#l14.8"></a><span id="l14.8">  *   -Bug 439819: LDIF import does not include mozillahomestreet.</span>
<a href="#l14.9"></a><span id="l14.9">  *   -Bug 182128: Edit Card, Notes on several lines appear on one after</span>
<a href="#l14.10"></a><span id="l14.10">  *                export/import in text format *(only tests the import).</span>
<a href="#l14.11"></a><span id="l14.11">  */</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-function run_test()</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-{</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+function run_test() {</span>
<a href="#l14.15"></a><span id="l14.15">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l14.16"></a><span id="l14.16">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+  MailServices.ab;</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   let file = do_get_file(&quot;resources/basic_csv_addressbook.csv&quot;);</span>
<a href="#l14.21"></a><span id="l14.21">   new AbImportHelper(file, &quot;csv&quot;, &quot;basic_csv_addressbook&quot;,</span>
<a href="#l14.22"></a><span id="l14.22">                      &quot;csv_import&quot;).beginImport();</span>
<a href="#l14.23"></a><span id="l14.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/import/test/unit/test_csv_import_quote.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_csv_import_quote.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /**</span>
<a href="#l15.5"></a><span id="l15.5">  * Tests importing quoted csv address books.</span>
<a href="#l15.6"></a><span id="l15.6">  */</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">-function run_test()</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">-{</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+function run_test() {</span>
<a href="#l15.10"></a><span id="l15.10">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l15.11"></a><span id="l15.11">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  MailServices.ab;</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15">   let file = do_get_file(&quot;resources/quote.csv&quot;);</span>
<a href="#l15.16"></a><span id="l15.16">   new AbImportHelper(file, &quot;csv&quot;, &quot;quote&quot;,</span>
<a href="#l15.17"></a><span id="l15.17">                      &quot;quote_csv&quot;).beginImport();</span>
<a href="#l15.18"></a><span id="l15.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/import/test/unit/test_ldif_import.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_ldif_import.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -5,18 +5,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">  *</span>
<a href="#l16.5"></a><span id="l16.5">  * This test also checks for the following bugs:</span>
<a href="#l16.6"></a><span id="l16.6">  *   -Bug 439819: LDIF import does not include mozillahomestreet.</span>
<a href="#l16.7"></a><span id="l16.7">  *   -Bug 182128: Edit Card, Notes on several lines appear on one after</span>
<a href="#l16.8"></a><span id="l16.8">  *                export/import in text format *(only tests the import).</span>
<a href="#l16.9"></a><span id="l16.9">  */</span>
<a href="#l16.10"></a><span id="l16.10"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-function run_test()</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-{</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+function run_test() {</span>
<a href="#l16.15"></a><span id="l16.15">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l16.16"></a><span id="l16.16">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-  var abMgr = MailServices.ab;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+  MailServices.ab;</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20">   var file = do_get_file(&quot;resources/basic_ldif_addressbook.ldif&quot;);</span>
<a href="#l16.21"></a><span id="l16.21">   new AbImportHelper(file, &quot;Text file&quot;, &quot;basic_ldif_addressbook&quot;,</span>
<a href="#l16.22"></a><span id="l16.22">                      &quot;basic_addressbook&quot;).beginImport();</span>
<a href="#l16.23"></a><span id="l16.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/import/test/unit/test_outlook_settings.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_outlook_settings.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,105 +1,105 @@</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l17.5"></a><span id="l17.5"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+/* import-globals-from resources/mock_windows_reg_factory.js */</span>
<a href="#l17.8"></a><span id="l17.8"> load(&quot;resources/mock_windows_reg_factory.js&quot;);</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> function POP3Account() {}</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12"> POP3Account.prototype = {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  'Account Name': 'POP3 Account Name',</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-  'POP3 Server': 'pop.host.invalid',</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-  'POP3 User Name': 'pop3user',</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-  'Leave Mail On Server': 1,</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-  'SMTP Server': 'smtp.host.invalid',</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-  'SMTP Display Name': 'SMTP Display Name',</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-  'SMTP Email Address': 'pop3user@host.invalid',</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-  'SMTP Reply To Email Address': 'pop3user@host.invalid',</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-  'SMTP Organization Name': 'SMTP Organization Name',</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-  'SMTP User Name': 'smtpuser'</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+  &quot;Account Name&quot;: &quot;POP3 Account Name&quot;,</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+  &quot;POP3 Server&quot;: &quot;pop.host.invalid&quot;,</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+  &quot;POP3 User Name&quot;: &quot;pop3user&quot;,</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+  &quot;Leave Mail On Server&quot;: 1,</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+  &quot;SMTP Server&quot;: &quot;smtp.host.invalid&quot;,</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+  &quot;SMTP Display Name&quot;: &quot;SMTP Display Name&quot;,</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+  &quot;SMTP Email Address&quot;: &quot;pop3user@host.invalid&quot;,</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  &quot;SMTP Reply To Email Address&quot;: &quot;pop3user@host.invalid&quot;,</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  &quot;SMTP Organization Name&quot;: &quot;SMTP Organization Name&quot;,</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  &quot;SMTP User Name&quot;: &quot;smtpuser&quot;,</span>
<a href="#l17.33"></a><span id="l17.33"> };</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35"> function IMAPAccount() {}</span>
<a href="#l17.36"></a><span id="l17.36"> </span>
<a href="#l17.37"></a><span id="l17.37"> IMAPAccount.prototype = {</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-  'Account Name': 'IMAP Account Name',</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-  'IMAP Server': 'imap.host.invalid',</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-  'IMAP User Name': 'imapuser',</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-  'SMTP Server': 'smtp.host.invalid',</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-  'SMTP Display Name': 'SMTP Display Name',</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-  'SMTP Email Address': 'imapuser@host.invalid',</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-  'SMTP Reply To Email Address': 'imapuser@host.invalid',</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-  'SMTP Organization Name': 'SMTP Organization Name',</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-  'SMTP User Name': 'smtpuser'</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+  &quot;Account Name&quot;: &quot;IMAP Account Name&quot;,</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+  &quot;IMAP Server&quot;: &quot;imap.host.invalid&quot;,</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  &quot;IMAP User Name&quot;: &quot;imapuser&quot;,</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+  &quot;SMTP Server&quot;: &quot;smtp.host.invalid&quot;,</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  &quot;SMTP Display Name&quot;: &quot;SMTP Display Name&quot;,</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+  &quot;SMTP Email Address&quot;: &quot;imapuser@host.invalid&quot;,</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+  &quot;SMTP Reply To Email Address&quot;: &quot;imapuser@host.invalid&quot;,</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+  &quot;SMTP Organization Name&quot;: &quot;SMTP Organization Name&quot;,</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+  &quot;SMTP User Name&quot;: &quot;smtpuser&quot;,</span>
<a href="#l17.56"></a><span id="l17.56"> };</span>
<a href="#l17.57"></a><span id="l17.57"> </span>
<a href="#l17.58"></a><span id="l17.58"> /* Outlook 98 */</span>
<a href="#l17.59"></a><span id="l17.59"> function Outlook98Registry(defaultAccount) {</span>
<a href="#l17.60"></a><span id="l17.60">   this._defaultAccount = defaultAccount;</span>
<a href="#l17.61"></a><span id="l17.61"> }</span>
<a href="#l17.62"></a><span id="l17.62"> </span>
<a href="#l17.63"></a><span id="l17.63"> Outlook98Registry.prototype = {</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-  get 'Software\\Microsoft\\Office\\8.0\\Outlook\\OMI Account Manager'() {</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+  get &quot;Software\\Microsoft\\Office\\8.0\\Outlook\\OMI Account Manager&quot;() {</span>
<a href="#l17.66"></a><span id="l17.66">     return {</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-      'Default Mail Account': '00000001',</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-      '00000001': this._defaultAccount</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+      &quot;Default Mail Account&quot;: &quot;00000001&quot;,</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+      &quot;00000001&quot;: this._defaultAccount,</span>
<a href="#l17.71"></a><span id="l17.71">     };</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-  }</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+  },</span>
<a href="#l17.74"></a><span id="l17.74"> };</span>
<a href="#l17.75"></a><span id="l17.75"> </span>
<a href="#l17.76"></a><span id="l17.76"> /* Outlook 2003 - */</span>
<a href="#l17.77"></a><span id="l17.77"> function Outlook2003Registry(defaultAccount) {</span>
<a href="#l17.78"></a><span id="l17.78">   this._defaultAccount = defaultAccount;</span>
<a href="#l17.79"></a><span id="l17.79"> }</span>
<a href="#l17.80"></a><span id="l17.80"> </span>
<a href="#l17.81"></a><span id="l17.81"> Outlook2003Registry.prototype = {</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-  get 'Software\\Microsoft\\Office\\Outlook\\OMI Account Manager'() {</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+  get &quot;Software\\Microsoft\\Office\\Outlook\\OMI Account Manager&quot;() {</span>
<a href="#l17.84"></a><span id="l17.84">     return {</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-      'Default Mail Account': '00000001',</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-      '00000001': this._defaultAccount</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+      &quot;Default Mail Account&quot;: &quot;00000001&quot;,</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+      &quot;00000001&quot;: this._defaultAccount,</span>
<a href="#l17.89"></a><span id="l17.89">     };</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-  }</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+  },</span>
<a href="#l17.92"></a><span id="l17.92"> };</span>
<a href="#l17.93"></a><span id="l17.93"> </span>
<a href="#l17.94"></a><span id="l17.94"> var expectedPop3Account = {</span>
<a href="#l17.95"></a><span id="l17.95">   incomingServer: {</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-    type: 'pop3',</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineminus">-    hostName: 'pop.invalid.host',</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-    username: 'pop3user',</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineminus">-    leaveMessagesOnServer: true</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+    type: &quot;pop3&quot;,</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+    hostName: &quot;pop.invalid.host&quot;,</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+    username: &quot;pop3user&quot;,</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+    leaveMessagesOnServer: true,</span>
<a href="#l17.104"></a><span id="l17.104">   },</span>
<a href="#l17.105"></a><span id="l17.105">   identity: {</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-    fullName: 'SMTP Display Name',</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-    email: 'pop3user@host.invalid',</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-    replyTo: 'pop3user@host.invalid',</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-    organization: 'SMTP Organization Name'</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+    fullName: &quot;SMTP Display Name&quot;,</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+    email: &quot;pop3user@host.invalid&quot;,</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+    replyTo: &quot;pop3user@host.invalid&quot;,</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineplus">+    organization: &quot;SMTP Organization Name&quot;,</span>
<a href="#l17.114"></a><span id="l17.114">   },</span>
<a href="#l17.115"></a><span id="l17.115">   smtpServer: {</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-    hostname: 'smtp.invalid.host',</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-    username: 'smtpuser'</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineminus">-  }</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+    hostname: &quot;smtp.invalid.host&quot;,</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+    username: &quot;smtpuser&quot;,</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+  },</span>
<a href="#l17.122"></a><span id="l17.122"> };</span>
<a href="#l17.123"></a><span id="l17.123"> </span>
<a href="#l17.124"></a><span id="l17.124"> var expectedImapAccount = {</span>
<a href="#l17.125"></a><span id="l17.125">   incomingServer: {</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineminus">-    type: 'imap',</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-    hostName: 'imap.invalid.host',</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineminus">-    username: 'imapuser'</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+    type: &quot;imap&quot;,</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+    hostName: &quot;imap.invalid.host&quot;,</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+    username: &quot;imapuser&quot;,</span>
<a href="#l17.132"></a><span id="l17.132">   },</span>
<a href="#l17.133"></a><span id="l17.133">   identity: {</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineminus">-    fullName: 'SMTP Display Name',</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineminus">-    email: 'imapuser@host.invalid',</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineminus">-    replyTo: 'imapuser@host.invalid',</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineminus">-    organization: 'SMTP Organization Name'</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineplus">+    fullName: &quot;SMTP Display Name&quot;,</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineplus">+    email: &quot;imapuser@host.invalid&quot;,</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+    replyTo: &quot;imapuser@host.invalid&quot;,</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+    organization: &quot;SMTP Organization Name&quot;,</span>
<a href="#l17.142"></a><span id="l17.142">   },</span>
<a href="#l17.143"></a><span id="l17.143">   smtpServer: {</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-    hostname: 'smtp.invalid.host',</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineminus">-    username: 'smtpuser'</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineminus">-  }</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+    hostname: &quot;smtp.invalid.host&quot;,</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+    username: &quot;smtpuser&quot;,</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+  },</span>
<a href="#l17.150"></a><span id="l17.150"> };</span>
<a href="#l17.151"></a><span id="l17.151"> </span>
<a href="#l17.152"></a><span id="l17.152"> function teardown() {</span>
<a href="#l17.153"></a><span id="l17.153">   let smtpServers = MailServices.smtp.servers;</span>
<a href="#l17.154"></a><span id="l17.154"> </span>
<a href="#l17.155"></a><span id="l17.155">   while (smtpServers.hasMoreElements()) {</span>
<a href="#l17.156"></a><span id="l17.156">     let server = smtpServers.getNext().QueryInterface(Ci.nsISmtpServer);</span>
<a href="#l17.157"></a><span id="l17.157">     MailServices.smtp.deleteServer(server);</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineat">@@ -107,17 +107,17 @@ function teardown() {</span>
<a href="#l17.159"></a><span id="l17.159"> </span>
<a href="#l17.160"></a><span id="l17.160">   teardown_mock_registry();</span>
<a href="#l17.161"></a><span id="l17.161"> }</span>
<a href="#l17.162"></a><span id="l17.162"> </span>
<a href="#l17.163"></a><span id="l17.163"> function _test(registry, expectedAccount) {</span>
<a href="#l17.164"></a><span id="l17.164">   try {</span>
<a href="#l17.165"></a><span id="l17.165">     setup_mock_registry(registry);</span>
<a href="#l17.166"></a><span id="l17.166">     new SettingsImportHelper(null, &quot;Outlook&quot;, [expectedAccount]).beginImport();</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineminus">-  } catch(e) {</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+  } catch (e) {</span>
<a href="#l17.169"></a><span id="l17.169">     teardown();</span>
<a href="#l17.170"></a><span id="l17.170">     do_throw(e);</span>
<a href="#l17.171"></a><span id="l17.171">   }</span>
<a href="#l17.172"></a><span id="l17.172">   teardown();</span>
<a href="#l17.173"></a><span id="l17.173"> }</span>
<a href="#l17.174"></a><span id="l17.174"> </span>
<a href="#l17.175"></a><span id="l17.175"> function run_test() {</span>
<a href="#l17.176"></a><span id="l17.176">   _test(new Outlook2003Registry(new POP3Account()), expectedPop3Account);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/import/test/unit/test_shiftjis_csv.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_shiftjis_csv.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1,20 +1,19 @@</span>
<a href="#l18.4"></a><span id="l18.4"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6" class="difflineminus">-function run_test()</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineminus">-{</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+function run_test() {</span>
<a href="#l18.9"></a><span id="l18.9">   Services.prefs.setCharPref(&quot;intl.charset.detector&quot;, &quot;ja_parallel_state_machine&quot;);</span>
<a href="#l18.10"></a><span id="l18.10">   registerCleanupFunction(function() {</span>
<a href="#l18.11"></a><span id="l18.11">       Services.prefs.clearUserPref(&quot;intl.charset.detector&quot;);</span>
<a href="#l18.12"></a><span id="l18.12">   });</span>
<a href="#l18.13"></a><span id="l18.13"> </span>
<a href="#l18.14"></a><span id="l18.14">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l18.15"></a><span id="l18.15">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  MailServices.ab;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">   let file = do_get_file(&quot;resources/shiftjis_addressbook.csv&quot;);</span>
<a href="#l18.20"></a><span id="l18.20">   let helper = new AbImportHelper(file, &quot;csv&quot;,</span>
<a href="#l18.21"></a><span id="l18.21">                                   &quot;shiftjis_addressbook&quot;, &quot;shiftjis_csv&quot;);</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">   helper.setFieldMap(helper.getDefaultFieldMap(true));</span>
<a href="#l18.24"></a><span id="l18.24">   helper.beginImport();</span>
<a href="#l18.25"></a><span id="l18.25"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/import/test/unit/test_utf16_csv.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_utf16_csv.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l19.4"></a><span id="l19.4"> var {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6" class="difflineminus">-function run_test()</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">-{</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+function run_test() {</span>
<a href="#l19.9"></a><span id="l19.9">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l19.10"></a><span id="l19.10">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+  MailServices.ab;</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14">   let file = do_get_file(&quot;resources/utf16_addressbook.csv&quot;);</span>
<a href="#l19.15"></a><span id="l19.15">   let helper = new AbImportHelper(file, &quot;csv&quot;,</span>
<a href="#l19.16"></a><span id="l19.16">                                   &quot;utf16_addressbook&quot;, &quot;utf16_csv&quot;);</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18">   helper.setFieldMap(helper.getDefaultFieldMap(true));</span>
<a href="#l19.19"></a><span id="l19.19">   helper.beginImport();</span>
<a href="#l19.20"></a><span id="l19.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/import/test/unit/test_vcard_import.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_vcard_import.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -3,21 +3,20 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * format and checks the accuracy of the imported address book's cards.</span>
<a href="#l20.5"></a><span id="l20.5">  * The current export contains only one card with most fields full.</span>
<a href="#l20.6"></a><span id="l20.6">  *</span>
<a href="#l20.7"></a><span id="l20.7">  * This test also checks for the following bugs:</span>
<a href="#l20.8"></a><span id="l20.8">  *   -Bug 439819: LDIF import does not include mozillahomestreet.</span>
<a href="#l20.9"></a><span id="l20.9">  *   -Bug 182128: Edit Card, Notes on several lines appear on one after</span>
<a href="#l20.10"></a><span id="l20.10">  *                export/import in text format *(only tests the import).</span>
<a href="#l20.11"></a><span id="l20.11">  */</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-function run_test()</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-{</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+function run_test() {</span>
<a href="#l20.15"></a><span id="l20.15">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l20.16"></a><span id="l20.16">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-  let abMgr = MailServices.ab;</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+  MailServices.ab;</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20">   // test regular import (e.g. from file exported by another mail client)</span>
<a href="#l20.21"></a><span id="l20.21">   let file = do_get_file(&quot;resources/basic_vcard_addressbook.vcf&quot;);</span>
<a href="#l20.22"></a><span id="l20.22">   new AbImportHelper(file, &quot;vcf&quot;, &quot;basic_vcard_addressbook&quot;,</span>
<a href="#l20.23"></a><span id="l20.23">                      &quot;vcard_import&quot;).beginImport();</span>
<a href="#l20.24"></a><span id="l20.24"> </span>
<a href="#l20.25"></a><span id="l20.25">   // test import against file with extra newlines (e.g. as copy-pasted by</span>
<a href="#l20.26"></a><span id="l20.26">   // hand, a relatively unlikely but still reasonable use case to cover)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/import/test/unit/test_winmail.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_winmail.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,159 +1,160 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /**</span>
<a href="#l21.5"></a><span id="l21.5">  * Basic tests for importing accounts of Windows Live Mail.</span>
<a href="#l21.6"></a><span id="l21.6">  */</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+/* import-globals-from resources/mock_windows_reg_factory.js */</span>
<a href="#l21.9"></a><span id="l21.9"> load(&quot;resources/mock_windows_reg_factory.js&quot;);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> var expectedPop3TestTestAccount = {</span>
<a href="#l21.12"></a><span id="l21.12">   incomingServer: {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    type: 'pop3',</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-    hostName: 'pop3.test.test',</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-    prettyName: 'testpopaccountname',</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+    type: &quot;pop3&quot;,</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+    hostName: &quot;pop3.test.test&quot;,</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+    prettyName: &quot;testpopaccountname&quot;,</span>
<a href="#l21.19"></a><span id="l21.19">     port: 110,</span>
<a href="#l21.20"></a><span id="l21.20">     socketType: 0,</span>
<a href="#l21.21"></a><span id="l21.21">     doBiff: true,</span>
<a href="#l21.22"></a><span id="l21.22">     biffMinutes: 2,</span>
<a href="#l21.23"></a><span id="l21.23">     isSecure: false,</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-    username: 'testpopusername',</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+    username: &quot;testpopusername&quot;,</span>
<a href="#l21.26"></a><span id="l21.26">     authMethod: Ci.nsMsgAuthMethod.passwordCleartext,</span>
<a href="#l21.27"></a><span id="l21.27">     leaveMessagesOnServer: false,</span>
<a href="#l21.28"></a><span id="l21.28">     deleteMailLeftOnServer: false,</span>
<a href="#l21.29"></a><span id="l21.29">     deleteByAgeFromServer: false,</span>
<a href="#l21.30"></a><span id="l21.30">     numDaysToLeaveOnServer: 7,</span>
<a href="#l21.31"></a><span id="l21.31">   },</span>
<a href="#l21.32"></a><span id="l21.32">   identity: {</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-    fullName: 'popdisplayname',</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-    organization: '',</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-    email: 'testpop@invalid.invalid',</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+    fullName: &quot;popdisplayname&quot;,</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+    organization: &quot;&quot;,</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+    email: &quot;testpop@invalid.invalid&quot;,</span>
<a href="#l21.39"></a><span id="l21.39">   },</span>
<a href="#l21.40"></a><span id="l21.40">   smtpServer: {</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-    hostname: 'smtp.pop.test',</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+    hostname: &quot;smtp.pop.test&quot;,</span>
<a href="#l21.43"></a><span id="l21.43">     port: 0, // default port</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-    username: '',</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+    username: &quot;&quot;,</span>
<a href="#l21.46"></a><span id="l21.46">     authMethod: Ci.nsMsgAuthMethod.none,</span>
<a href="#l21.47"></a><span id="l21.47">     socketType: 0,</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-  }</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+  },</span>
<a href="#l21.50"></a><span id="l21.50"> };</span>
<a href="#l21.51"></a><span id="l21.51"> </span>
<a href="#l21.52"></a><span id="l21.52"> var expectedNewsMozillaOrgAccount = {</span>
<a href="#l21.53"></a><span id="l21.53">   incomingServer: {</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-    type: 'nntp',</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-    hostName: 'testnews.mozilla.org',</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-    prettyName: 'accountnamemozillanews',</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+    type: &quot;nntp&quot;,</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+    hostName: &quot;testnews.mozilla.org&quot;,</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+    prettyName: &quot;accountnamemozillanews&quot;,</span>
<a href="#l21.60"></a><span id="l21.60">     port: 119,</span>
<a href="#l21.61"></a><span id="l21.61">     socketType: 0,</span>
<a href="#l21.62"></a><span id="l21.62">     isSecure: false,</span>
<a href="#l21.63"></a><span id="l21.63">     authMethod: Ci.nsMsgAuthMethod.passwordCleartext,</span>
<a href="#l21.64"></a><span id="l21.64">     doBiff: false,</span>
<a href="#l21.65"></a><span id="l21.65">     biffMinutes: 10, // default value</span>
<a href="#l21.66"></a><span id="l21.66">   },</span>
<a href="#l21.67"></a><span id="l21.67">   identity: {</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">-    fullName: 'test',</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">-    organization: '',</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-    email: 'mozillanews@invalid.invalid',</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+    fullName: &quot;test&quot;,</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+    organization: &quot;&quot;,</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+    email: &quot;mozillanews@invalid.invalid&quot;,</span>
<a href="#l21.74"></a><span id="l21.74">   },</span>
<a href="#l21.75"></a><span id="l21.75"> };</span>
<a href="#l21.76"></a><span id="l21.76"> </span>
<a href="#l21.77"></a><span id="l21.77"> var expectedMicrosoftCommunitiesAccount = {</span>
<a href="#l21.78"></a><span id="l21.78">   incomingServer: {</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-    type: 'nntp',</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineminus">-    hostName: 'testmsnews.microsoft.invalid',</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineminus">-    prettyName: 'Microsoft Communities Test',</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+    type: &quot;nntp&quot;,</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+    hostName: &quot;testmsnews.microsoft.invalid&quot;,</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+    prettyName: &quot;Microsoft Communities Test&quot;,</span>
<a href="#l21.85"></a><span id="l21.85">     port: 119,</span>
<a href="#l21.86"></a><span id="l21.86">     socketType: 0,</span>
<a href="#l21.87"></a><span id="l21.87">     isSecure: false,</span>
<a href="#l21.88"></a><span id="l21.88">     authMethod: Ci.nsMsgAuthMethod.passwordCleartext,</span>
<a href="#l21.89"></a><span id="l21.89">     doBiff: false,</span>
<a href="#l21.90"></a><span id="l21.90">     biffMinutes: 10, // default value</span>
<a href="#l21.91"></a><span id="l21.91">   },</span>
<a href="#l21.92"></a><span id="l21.92">   identity: {</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineminus">-    fullName: '',</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineminus">-    organization: '',</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+    fullName: &quot;&quot;,</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+    organization: &quot;&quot;,</span>
<a href="#l21.97"></a><span id="l21.97">   },</span>
<a href="#l21.98"></a><span id="l21.98"> };</span>
<a href="#l21.99"></a><span id="l21.99"> </span>
<a href="#l21.100"></a><span id="l21.100"> var expectedDonHallNntpAccount = {</span>
<a href="#l21.101"></a><span id="l21.101">   incomingServer: {</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-    type: 'nntp',</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-    hostName: 'news.wingtiptoys.invalid',</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-    prettyName: 'donhallnntp',</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineplus">+    type: &quot;nntp&quot;,</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineplus">+    hostName: &quot;news.wingtiptoys.invalid&quot;,</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+    prettyName: &quot;donhallnntp&quot;,</span>
<a href="#l21.108"></a><span id="l21.108">     port: 563,</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-    username: 'don',</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineplus">+    username: &quot;don&quot;,</span>
<a href="#l21.111"></a><span id="l21.111">     isSecure: false,</span>
<a href="#l21.112"></a><span id="l21.112">     authMethod: Ci.nsMsgAuthMethod.secure,</span>
<a href="#l21.113"></a><span id="l21.113">     socketType: 0,</span>
<a href="#l21.114"></a><span id="l21.114">     doBiff: false,</span>
<a href="#l21.115"></a><span id="l21.115">     biffMinutes: 10, // default value</span>
<a href="#l21.116"></a><span id="l21.116">   },</span>
<a href="#l21.117"></a><span id="l21.117">   identity: {</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineminus">-    fullName: 'Don Hall',</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-    organization: 'Wingtip Toys',</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-    email: 'don@wingtiptoys.invalid',</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-    replyTo: 'don@wingtiptoys.invalid',</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineplus">+    fullName: &quot;Don Hall&quot;,</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineplus">+    organization: &quot;Wingtip Toys&quot;,</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+    email: &quot;don@wingtiptoys.invalid&quot;,</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+    replyTo: &quot;don@wingtiptoys.invalid&quot;,</span>
<a href="#l21.126"></a><span id="l21.126">   },</span>
<a href="#l21.127"></a><span id="l21.127"> };</span>
<a href="#l21.128"></a><span id="l21.128"> </span>
<a href="#l21.129"></a><span id="l21.129"> var expectedDonHallImapAccount = {</span>
<a href="#l21.130"></a><span id="l21.130">   incomingServer: {</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineminus">-    type: 'imap',</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineminus">-    hostName: 'mail.wingtiptoys.invalid',</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineminus">-    prettyName: 'donhallimap',</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineplus">+    type: &quot;imap&quot;,</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineplus">+    hostName: &quot;mail.wingtiptoys.invalid&quot;,</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineplus">+    prettyName: &quot;donhallimap&quot;,</span>
<a href="#l21.137"></a><span id="l21.137">     port: 993,</span>
<a href="#l21.138"></a><span id="l21.138">     isSecure: true,</span>
<a href="#l21.139"></a><span id="l21.139">     doBiff: true,</span>
<a href="#l21.140"></a><span id="l21.140">     biffMinutes: 2,</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineminus">-    username: 'don',</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineplus">+    username: &quot;don&quot;,</span>
<a href="#l21.143"></a><span id="l21.143">     authMethod: Ci.nsMsgAuthMethod.secure,</span>
<a href="#l21.144"></a><span id="l21.144">     socketType: 0,</span>
<a href="#l21.145"></a><span id="l21.145">   },</span>
<a href="#l21.146"></a><span id="l21.146">   identity: {</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineminus">-    fullName: 'Don Hall',</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineminus">-    organization: 'Wingtip Toys',</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineminus">-    email: 'don@wingtiptoys.invalid',</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineminus">-    replyTo: 'don@wingtiptoys.invalid',</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineplus">+    fullName: &quot;Don Hall&quot;,</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineplus">+    organization: &quot;Wingtip Toys&quot;,</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineplus">+    email: &quot;don@wingtiptoys.invalid&quot;,</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineplus">+    replyTo: &quot;don@wingtiptoys.invalid&quot;,</span>
<a href="#l21.155"></a><span id="l21.155">   },</span>
<a href="#l21.156"></a><span id="l21.156">   smtpServer: {</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineminus">-    hostname: 'smtp.wingtiptoys.invalid',</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineminus">-    username: 'don',</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineplus">+    hostname: &quot;smtp.wingtiptoys.invalid&quot;,</span>
<a href="#l21.160"></a><span id="l21.160" class="difflineplus">+    username: &quot;don&quot;,</span>
<a href="#l21.161"></a><span id="l21.161">     port: 25,</span>
<a href="#l21.162"></a><span id="l21.162">     socketType: Ci.nsMsgSocketType.SSL,</span>
<a href="#l21.163"></a><span id="l21.163">     authMethod: Ci.nsMsgAuthMethod.secure,</span>
<a href="#l21.164"></a><span id="l21.164" class="difflineminus">-  }</span>
<a href="#l21.165"></a><span id="l21.165" class="difflineplus">+  },</span>
<a href="#l21.166"></a><span id="l21.166"> };</span>
<a href="#l21.167"></a><span id="l21.167"> </span>
<a href="#l21.168"></a><span id="l21.168"> var expectedAccounts = [expectedPop3TestTestAccount,</span>
<a href="#l21.169"></a><span id="l21.169">                         expectedNewsMozillaOrgAccount,</span>
<a href="#l21.170"></a><span id="l21.170">                         expectedMicrosoftCommunitiesAccount,</span>
<a href="#l21.171"></a><span id="l21.171">                         expectedDonHallNntpAccount,</span>
<a href="#l21.172"></a><span id="l21.172">                         expectedDonHallImapAccount];</span>
<a href="#l21.173"></a><span id="l21.173"> </span>
<a href="#l21.174"></a><span id="l21.174"> function WinLiveMailRegistry(rootPath) {</span>
<a href="#l21.175"></a><span id="l21.175">   this._rootPath = rootPath;</span>
<a href="#l21.176"></a><span id="l21.176"> }</span>
<a href="#l21.177"></a><span id="l21.177"> </span>
<a href="#l21.178"></a><span id="l21.178"> WinLiveMailRegistry.prototype = {</span>
<a href="#l21.179"></a><span id="l21.179" class="difflineminus">-  get 'Software\\Microsoft\\Windows Live Mail'() {</span>
<a href="#l21.180"></a><span id="l21.180" class="difflineplus">+  get &quot;Software\\Microsoft\\Windows Live Mail&quot;() {</span>
<a href="#l21.181"></a><span id="l21.181">     return {</span>
<a href="#l21.182"></a><span id="l21.182" class="difflineminus">-      'Default Mail Account': 'fill in mail account',</span>
<a href="#l21.183"></a><span id="l21.183" class="difflineminus">-      'Default News Account': 'fill in news account',</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineminus">-      'Store Root': this._rootPath,</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineminus">-      'mail':  {</span>
<a href="#l21.186"></a><span id="l21.186" class="difflineminus">-        'Poll For Mail': 120000</span>
<a href="#l21.187"></a><span id="l21.187" class="difflineminus">-      }</span>
<a href="#l21.188"></a><span id="l21.188" class="difflineplus">+      &quot;Default Mail Account&quot;: &quot;fill in mail account&quot;,</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineplus">+      &quot;Default News Account&quot;: &quot;fill in news account&quot;,</span>
<a href="#l21.190"></a><span id="l21.190" class="difflineplus">+      &quot;Store Root&quot;: this._rootPath,</span>
<a href="#l21.191"></a><span id="l21.191" class="difflineplus">+      &quot;mail&quot;:  {</span>
<a href="#l21.192"></a><span id="l21.192" class="difflineplus">+        &quot;Poll For Mail&quot;: 120000,</span>
<a href="#l21.193"></a><span id="l21.193" class="difflineplus">+      },</span>
<a href="#l21.194"></a><span id="l21.194">     };</span>
<a href="#l21.195"></a><span id="l21.195">   },</span>
<a href="#l21.196"></a><span id="l21.196"> };</span>
<a href="#l21.197"></a><span id="l21.197"> </span>
<a href="#l21.198"></a><span id="l21.198" class="difflineminus">-function _test(registry, expectedAccounts) {</span>
<a href="#l21.199"></a><span id="l21.199" class="difflineplus">+function _test(registry) {</span>
<a href="#l21.200"></a><span id="l21.200">   try {</span>
<a href="#l21.201"></a><span id="l21.201">     setup_mock_registry(registry);</span>
<a href="#l21.202"></a><span id="l21.202">     new SettingsImportHelper(null, &quot;Windows Live Mail&quot;, expectedAccounts).beginImport();</span>
<a href="#l21.203"></a><span id="l21.203" class="difflineminus">-  } catch(e) {</span>
<a href="#l21.204"></a><span id="l21.204" class="difflineplus">+  } catch (e) {</span>
<a href="#l21.205"></a><span id="l21.205">     teardown();</span>
<a href="#l21.206"></a><span id="l21.206">     do_throw(e);</span>
<a href="#l21.207"></a><span id="l21.207">   }</span>
<a href="#l21.208"></a><span id="l21.208">   teardown();</span>
<a href="#l21.209"></a><span id="l21.209"> }</span>
<a href="#l21.210"></a><span id="l21.210"> </span>
<a href="#l21.211"></a><span id="l21.211"> function teardown() {</span>
<a href="#l21.212"></a><span id="l21.212">   let smtpServers = MailServices.smtp.servers;</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineat">@@ -163,10 +164,10 @@ function teardown() {</span>
<a href="#l21.214"></a><span id="l21.214">     MailServices.smtp.deleteServer(server);</span>
<a href="#l21.215"></a><span id="l21.215">   }</span>
<a href="#l21.216"></a><span id="l21.216"> </span>
<a href="#l21.217"></a><span id="l21.217">   teardown_mock_registry();</span>
<a href="#l21.218"></a><span id="l21.218"> }</span>
<a href="#l21.219"></a><span id="l21.219"> </span>
<a href="#l21.220"></a><span id="l21.220"> function run_test() {</span>
<a href="#l21.221"></a><span id="l21.221">   let root = do_get_file(&quot;resources/WindowsLiveMail&quot;);</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineminus">-  _test(new WinLiveMailRegistry(root.path), expectedAccounts);</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineplus">+  _test(new WinLiveMailRegistry(root.path));</span>
<a href="#l21.224"></a><span id="l21.224"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

