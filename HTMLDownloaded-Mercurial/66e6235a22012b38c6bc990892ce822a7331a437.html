<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 16197:66e6235a22012b38c6bc990892ce822a7331a437</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 66e6235a22012b38c6bc990892ce822a7331a437" />
<meta property="og:url" content="/comm-central/rev/66e6235a22012b38c6bc990892ce822a7331a437" />
<meta property="og:description" content="Bug 957495 - Add new error message if adding message header to database fails. ui-r=Josiah, r=irving" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 66e6235a22012b38c6bc990892ce822a7331a437 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/66e6235a22012b38c6bc990892ce822a7331a437">shortlog</a> |
<a href="/comm-central/log/66e6235a22012b38c6bc990892ce822a7331a437">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/66e6235a22012b38c6bc990892ce822a7331a437">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/66e6235a22012b38c6bc990892ce822a7331a437">files</a> |
changeset |
<a href="/comm-central/raw-rev/66e6235a22012b38c6bc990892ce822a7331a437">raw</a>  | <a href="/comm-central/archive/66e6235a22012b38c6bc990892ce822a7331a437.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=957495">Bug 957495</a> - Add new error message if adding message header to database fails. ui-r=Josiah, r=irving
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 11 May 2014 05:04:00 -0400</td></tr>

<tr>
 <td>changeset 16197</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/66e6235a22012b38c6bc990892ce822a7331a437">66e6235a22012b38c6bc990892ce822a7331a437</a></td>
</tr>



<tr>
<td>parent 16196</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b0b68d22439b9b17298bd599f9b7ce338c4d717f">b0b68d22439b9b17298bd599f9b7ce338c4d717f</a>
</td>
</tr>

<tr>
<td>child 16198</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9f5b1f06702d545071e343d57ede6e72584c17dd">9f5b1f06702d545071e343d57ede6e72584c17dd</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=66e6235a22012b38c6bc990892ce822a7331a437">10127</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 15 May 2014 12:29:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@66e6235a2201 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=66e6235a22012b38c6bc990892ce822a7331a437">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=66e6235a22012b38c6bc990892ce822a7331a437&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=66e6235a22012b38c6bc990892ce822a7331a437&newProject=comm-central&newRevision=66e6235a22012b38c6bc990892ce822a7331a437&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=66e6235a22012b38c6bc990892ce822a7331a437&newProject=comm-central&newRevision=66e6235a22012b38c6bc990892ce822a7331a437&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=66e6235a22012b38c6bc990892ce822a7331a437&newProject=comm-central&newRevision=66e6235a22012b38c6bc990892ce822a7331a437&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Josiah%29&revcount=50">Josiah</a>, <a href="/comm-central/log?rev=reviewer%28irving%29&revcount=50">irving</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=957495">957495</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=957495">Bug 957495</a> - Add new error message if adding message header to database fails. ui-r=Josiah, r=irving</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e6235a22012b38c6bc990892ce822a7331a437/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e6235a22012b38c6bc990892ce822a7331a437/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/66e6235a22012b38c6bc990892ce822a7331a437/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/66e6235a22012b38c6bc990892ce822a7331a437/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/66e6235a22012b38c6bc990892ce822a7331a437/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/66e6235a22012b38c6bc990892ce822a7331a437/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/66e6235a22012b38c6bc990892ce822a7331a437/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e6235a22012b38c6bc990892ce822a7331a437/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/66e6235a22012b38c6bc990892ce822a7331a437/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/66e6235a22012b38c6bc990892ce822a7331a437/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/66e6235a22012b38c6bc990892ce822a7331a437/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/66e6235a22012b38c6bc990892ce822a7331a437/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/66e6235a22012b38c6bc990892ce822a7331a437/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/66e6235a22012b38c6bc990892ce822a7331a437/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/66e6235a22012b38c6bc990892ce822a7331a437/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/66e6235a22012b38c6bc990892ce822a7331a437/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/66e6235a22012b38c6bc990892ce822a7331a437/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/66e6235a22012b38c6bc990892ce822a7331a437/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -76,16 +76,17 @@ confirmFolderDeletionForFilter=Deleting </span>
<a href="#l1.4"></a><span id="l1.4"> alertFilterChanged=Filters associated with this folder will be updated.</span>
<a href="#l1.5"></a><span id="l1.5"> filterDisabled=The folder '%S' could not be found, so filter(s) associated with this folder will be disabled. Verify that the folder exists, and that filters point to a valid destination folder.</span>
<a href="#l1.6"></a><span id="l1.6"> filterFolderDeniedLocked=The messages could not be filtered to folder '%S' because another operation is in progress.</span>
<a href="#l1.7"></a><span id="l1.7"> parsingFolderFailed=Unable to open the folder %S because it is in use by some other operation. Please wait for that operation to finish and then select the folder again.</span>
<a href="#l1.8"></a><span id="l1.8"> deletingMsgsFailed=Unable to delete messages in folder %S because it is in use by some other operation. Please wait for that operation to finish and then try again.</span>
<a href="#l1.9"></a><span id="l1.9"> alertFilterCheckbox=Do not warn me again.</span>
<a href="#l1.10"></a><span id="l1.10"> compactFolderDeniedLock=The folder '%S' cannot be compacted because another operation is in progress. Please try again later.</span>
<a href="#l1.11"></a><span id="l1.11"> compactFolderWriteFailed=The folder '%S' could not be compacted because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+filterFolderHdrAddFailed=The messages could not be filtered to folder '%S' because adding a message to it failed. Verify that the folder is displaying properly or try to repair it from the folder properties.</span>
<a href="#l1.13"></a><span id="l1.13"> filterFolderWriteFailed=The messages could not be filtered to folder '%S' because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l1.14"></a><span id="l1.14"> copyMsgWriteFailed=The messages could not be moved or copied to folder '%S' because writing to folder failed. To gain disk space, from the File menu, first choose Empty Trash, and then choose Compact Folders, and then try again.</span>
<a href="#l1.15"></a><span id="l1.15"> cantMoveMsgWOBodyOffline=While working offline, you cannot move or copy messages that were not downloaded for offline use. From the Mail window, open the File menu, choose Offline, then uncheck Work Offline, and then try again.</span>
<a href="#l1.16"></a><span id="l1.16"> operationFailedFolderBusy=The operation failed because another operation is using the folder. Please wait for that operation to finish and then try again.</span>
<a href="#l1.17"></a><span id="l1.17"> folderRenameFailed=The folder could not be renamed. Perhaps the folder is being reparsed, or the new name is not a valid folder name.</span>
<a href="#l1.18"></a><span id="l1.18"> # LOCALIZATION NOTE(verboseFolderFormat): %1$S is folder name, %2$S is server name</span>
<a href="#l1.19"></a><span id="l1.19"> verboseFolderFormat=%1$S on %2$S</span>
<a href="#l1.20"></a><span id="l1.20"> # LOCALIZATION NOTE(filterFolderTruncateFailed): %1$S is replaced by the folder name, %2$S is replaced by the brandShortName</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -2503,32 +2503,33 @@ nsresult nsParseNewMailState::MoveIncorp</span>
<a href="#l2.4"></a><span id="l2.4">                    &quot;failed to open mail db parsing folder&quot;);</span>
<a href="#l2.5"></a><span id="l2.5">   nsCOMPtr&lt;nsIMsgDBHdr&gt; newHdr;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">   if (destMailDB)</span>
<a href="#l2.8"></a><span id="l2.8">     rv = destMailDB-&gt;CopyHdrFromExistingHdr(nsMsgKey_None, mailHdr, true,</span>
<a href="#l2.9"></a><span id="l2.9">                                             getter_AddRefs(newHdr));</span>
<a href="#l2.10"></a><span id="l2.10">   if (NS_SUCCEEDED(rv) &amp;&amp; !newHdr)</span>
<a href="#l2.11"></a><span id="l2.11">     rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  if (NS_FAILED(rv))</span>
<a href="#l2.15"></a><span id="l2.15">   {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-    rv = AppendMsgFromStream(inputStream, newHdr, messageLength,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                             destIFolder);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    destIFolder-&gt;ThrowAlertMsg(&quot;filterFolderHdrAddFailed&quot;, msgWindow);</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  } else {</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    rv = AppendMsgFromStream(inputStream, newHdr, messageLength, destIFolder);</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+    if (NS_FAILED(rv))</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      destIFolder-&gt;ThrowAlertMsg(&quot;filterFolderWriteFailed&quot;, msgWindow);</span>
<a href="#l2.23"></a><span id="l2.23">   }</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">   if (NS_FAILED(rv))</span>
<a href="#l2.26"></a><span id="l2.26">   {</span>
<a href="#l2.27"></a><span id="l2.27">     if (destMailDB)</span>
<a href="#l2.28"></a><span id="l2.28">       destMailDB-&gt;Close(true);</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-    if (destIFolder)</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-    {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-      destIFolder-&gt;ReleaseSemaphore(myISupports);</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-      destIFolder-&gt;ThrowAlertMsg(&quot;filterFolderWriteFailed&quot;, msgWindow);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-    }</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    destIFolder-&gt;ReleaseSemaphore(myISupports);</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+</span>
<a href="#l2.37"></a><span id="l2.37">     return NS_MSG_ERROR_WRITING_MAIL_FOLDER;</span>
<a href="#l2.38"></a><span id="l2.38">   }</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40">   bool movedMsgIsNew = false;</span>
<a href="#l2.41"></a><span id="l2.41">   // if we have made it this far then the message has successfully been written to the new folder</span>
<a href="#l2.42"></a><span id="l2.42">   // now add the header to the destMailDB.</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">   uint32_t newFlags;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -68,21 +68,22 @@ autoCompactAllFoldersTitle=Compact Folde</span>
<a href="#l3.4"></a><span id="l3.4"> autoCompactAllFolders=Do you wish to compact all local and offline folders to save disk space?</span>
<a href="#l3.5"></a><span id="l3.5"> autoCompactAlwaysAskCheckbox=Always ask me before compacting folders automatically</span>
<a href="#l3.6"></a><span id="l3.6"> compactNowButton=Co&amp;mpact Now</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> confirmFolderDeletionForFilter=Deleting the folder '%S' will disable its associated filter(s). Are you sure you want to delete the folder?</span>
<a href="#l3.9"></a><span id="l3.9"> alertFilterChanged=Filters associated with this folder will be updated.</span>
<a href="#l3.10"></a><span id="l3.10"> filterDisabled=The folder '%S' could not be found, so filter(s) associated with this folder will be disabled. Verify that the folder exists, and that filters point to a valid destination folder.</span>
<a href="#l3.11"></a><span id="l3.11"> filterFolderDeniedLocked=The messages could not be filtered to folder '%S' because another operation is in progress.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-parsingFolderFailed=Unable to open the folder %S because it is in use by some other operation. Please wait for that operation to finish and then select the folder again. </span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+parsingFolderFailed=Unable to open the folder %S because it is in use by some other operation. Please wait for that operation to finish and then select the folder again.</span>
<a href="#l3.14"></a><span id="l3.14"> deletingMsgsFailed=Unable to delete messages in folder %S because it is in use by some other operation. Please wait for that operation to finish and then try again.</span>
<a href="#l3.15"></a><span id="l3.15"> alertFilterCheckbox=Do not warn me again.</span>
<a href="#l3.16"></a><span id="l3.16"> compactFolderDeniedLock=The folder '%S' cannot be compacted because another operation is in progress. Please try again later.</span>
<a href="#l3.17"></a><span id="l3.17"> compactFolderWriteFailed=The folder '%S' could not be compacted because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+filterFolderHdrAddFailed=The messages could not be filtered to folder '%S' because adding a message to it failed. Verify that the folder is displaying properly or try to repair it from the folder properties.</span>
<a href="#l3.19"></a><span id="l3.19"> filterFolderWriteFailed=The messages could not be filtered to folder '%S' because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l3.20"></a><span id="l3.20"> copyMsgWriteFailed=The messages could not be moved or copied to folder '%S' because writing to folder failed. To gain disk space, from the File menu, first choose Empty Trash, and then choose Compact Folders, and then try again.</span>
<a href="#l3.21"></a><span id="l3.21"> cantMoveMsgWOBodyOffline=While working offline, you cannot move or copy messages that were not downloaded for offline use. From the Mail window, open the File menu, choose Offline, then uncheck Work Offline, and then try again.</span>
<a href="#l3.22"></a><span id="l3.22"> operationFailedFolderBusy=The operation failed because another operation is using the folder. Please wait for that operation to finish and then try again.</span>
<a href="#l3.23"></a><span id="l3.23"> folderRenameFailed=The folder could not be renamed. Perhaps the folder is being reparsed, or the new name is not a valid folder name.</span>
<a href="#l3.24"></a><span id="l3.24"> # LOCALIZATION NOTE(verboseFolderFormat): %1$S is folder name, %2$S is server name</span>
<a href="#l3.25"></a><span id="l3.25"> verboseFolderFormat=%1$S on %2$S</span>
<a href="#l3.26"></a><span id="l3.26"> # LOCALIZATION NOTE(filterFolderTruncateFailed): %1$S is replaced by the folder name, %2$S is replaced by the brandShortName</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

