<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7512:c831c107de255938939497b8b70e07da333410f7</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ c831c107de255938939497b8b70e07da333410f7" />
<meta property="og:url" content="/comm-central/rev/c831c107de255938939497b8b70e07da333410f7" />
<meta property="og:description" content="Bug 647481 - Remove nsInt64, nsUint64 and nsTime from comm-central r=neil sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / c831c107de255938939497b8b70e07da333410f7 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/c831c107de255938939497b8b70e07da333410f7">shortlog</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/c831c107de255938939497b8b70e07da333410f7">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7">files</a> |
changeset |
<a href="/comm-central/raw-rev/c831c107de255938939497b8b70e07da333410f7">raw</a>  | <a href="/comm-central/archive/c831c107de255938939497b8b70e07da333410f7.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=647481">Bug 647481</a> - Remove nsInt64, nsUint64 and nsTime from comm-central r=neil sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 06 Apr 2011 21:18:36 +0100</td></tr>

<tr>
 <td>changeset 7512</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/c831c107de255938939497b8b70e07da333410f7">c831c107de255938939497b8b70e07da333410f7</a></td>
</tr>



<tr>
<td>parent 7508</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ce7a512aff7ae3beea08d527439df45745a3d488">ce7a512aff7ae3beea08d527439df45745a3d488</a>
</td>
</tr>

<tr>
<td>child 7513</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/000c04a87624ce94e1efbb9ee22c4a1184f2bb14">000c04a87624ce94e1efbb9ee22c4a1184f2bb14</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=c831c107de255938939497b8b70e07da333410f7">5756</a></td></tr>
<tr><td>push user</td><td>iann_cvs@blueyonder.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Wed, 06 Apr 2011 20:18:01 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c831c107de25 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c831c107de255938939497b8b70e07da333410f7">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c831c107de255938939497b8b70e07da333410f7&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c831c107de255938939497b8b70e07da333410f7&newProject=comm-central&newRevision=c831c107de255938939497b8b70e07da333410f7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c831c107de255938939497b8b70e07da333410f7&newProject=comm-central&newRevision=c831c107de255938939497b8b70e07da333410f7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c831c107de255938939497b8b70e07da333410f7&newProject=comm-central&newRevision=c831c107de255938939497b8b70e07da333410f7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28neil%29&revcount=50">neil</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=647481">647481</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=647481">Bug 647481</a> - Remove nsInt64, nsUint64 and nsTime from comm-central r=neil sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerOSXIntegration.h">mailnews/base/src/nsMessengerOSXIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerOSXIntegration.h">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerOSXIntegration.h">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerOSXIntegration.h">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerOSXIntegration.h">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerOSXIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerWinIntegration.h">mailnews/base/src/nsMessengerWinIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerWinIntegration.h">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerWinIntegration.h">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerWinIntegration.h">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerWinIntegration.h">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMessengerWinIntegration.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.cpp">mailnews/base/src/nsMsgBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.h">mailnews/base/src/nsMsgBiffManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.h">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.h">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.h">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.h">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgBiffManager.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgProgress.cpp">mailnews/base/src/nsMsgProgress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgProgress.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgProgress.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgProgress.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgProgress.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgProgress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.cpp">mailnews/base/src/nsMsgPurgeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.h">mailnews/base/src/nsMsgPurgeService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.h">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.h">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.h">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.h">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgPurgeService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgStatusFeedback.cpp">mailnews/base/src/nsMsgStatusFeedback.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgStatusFeedback.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgStatusFeedback.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgStatusFeedback.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgStatusFeedback.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/src/nsMsgStatusFeedback.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgFileStream.cpp">mailnews/base/util/nsMsgFileStream.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgFileStream.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgFileStream.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgFileStream.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgFileStream.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgFileStream.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgProtocol.cpp">mailnews/base/util/nsMsgProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgProtocol.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgProtocol.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/base/util/nsMsgProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsMailboxProtocol.cpp">mailnews/local/src/nsMailboxProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsMailboxProtocol.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsMailboxProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsMailboxProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsMailboxProtocol.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsMailboxProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.h">mailnews/local/src/nsParseMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.h">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.h">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.h">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.h">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsParseMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNNTPProtocol.cpp">mailnews/news/src/nsNNTPProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNNTPProtocol.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNNTPProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNNTPProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNNTPProtocol.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNNTPProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/c831c107de255938939497b8b70e07da333410f7/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -35,17 +35,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l1.5"></a><span id="l1.5">  *</span>
<a href="#l1.6"></a><span id="l1.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIFile.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l1.17"></a><span id="l1.17"> #include &quot;NSReg.h&quot;</span>
<a href="#l1.18"></a><span id="l1.18"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l1.19"></a><span id="l1.19"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l1.20"></a><span id="l1.20"> #include &quot;nsISupportsPrimitives.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -53,17 +53,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsIMsgImapMailFolder.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsMsgSearchImap.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsMsgLocalSearch.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsMsgSearchNews.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsMsgSearchValue.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-#include &quot;nsTime.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l2.14"></a><span id="l2.14"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l2.15"></a><span id="l2.15"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l2.16"></a><span id="l2.16"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l2.17"></a><span id="l2.17"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l2.18"></a><span id="l2.18"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l2.19"></a><span id="l2.19"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> #include &quot;nsIFileStreams.h&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -876,17 +875,16 @@ NS_IMETHODIMP nsMsgSearchTerm::MatchFold</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> NS_IMETHODIMP nsMsgSearchTerm::MatchUint32HdrProperty(nsIMsgDBHdr *aHdr, PRBool *aResult)</span>
<a href="#l2.24"></a><span id="l2.24"> {</span>
<a href="#l2.25"></a><span id="l2.25">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l2.26"></a><span id="l2.26">   NS_ENSURE_ARG_POINTER(aHdr);</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">   PRUint32 dbHdrValue;</span>
<a href="#l2.29"></a><span id="l2.29">   aHdr-&gt;GetUint32Property(m_hdrProperty.get(), &amp;dbHdrValue);</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">   PRBool result = PR_FALSE;</span>
<a href="#l2.33"></a><span id="l2.33">   switch (m_operator)</span>
<a href="#l2.34"></a><span id="l2.34">   {</span>
<a href="#l2.35"></a><span id="l2.35">   case nsMsgSearchOp::IsGreaterThan:</span>
<a href="#l2.36"></a><span id="l2.36">     if (dbHdrValue &gt; m_value.u.msgStatus)</span>
<a href="#l2.37"></a><span id="l2.37">       result = PR_TRUE;</span>
<a href="#l2.38"></a><span id="l2.38">     break;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineat">@@ -1234,29 +1232,28 @@ nsresult nsMsgSearchTerm::GetLocalTimes </span>
<a href="#l2.40"></a><span id="l2.40"> </span>
<a href="#l2.41"></a><span id="l2.41"> </span>
<a href="#l2.42"></a><span id="l2.42"> nsresult nsMsgSearchTerm::MatchDate (PRTime dateToMatch, PRBool *pResult)</span>
<a href="#l2.43"></a><span id="l2.43"> {</span>
<a href="#l2.44"></a><span id="l2.44">   NS_ENSURE_ARG_POINTER(pResult);</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46">   nsresult err = NS_OK;</span>
<a href="#l2.47"></a><span id="l2.47">   PRBool result = PR_FALSE;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-  nsTime t_date(dateToMatch);</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50">   switch (m_operator)</span>
<a href="#l2.51"></a><span id="l2.51">   {</span>
<a href="#l2.52"></a><span id="l2.52">   case nsMsgSearchOp::IsBefore:</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-    if (t_date &lt; nsTime(m_value.u.date))</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+    if (dateToMatch &lt; m_value.u.date)</span>
<a href="#l2.55"></a><span id="l2.55">       result = PR_TRUE;</span>
<a href="#l2.56"></a><span id="l2.56">     break;</span>
<a href="#l2.57"></a><span id="l2.57">   case nsMsgSearchOp::IsAfter:</span>
<a href="#l2.58"></a><span id="l2.58">     {</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-      nsTime adjustedDate = nsTime(m_value.u.date);</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+      PRTime adjustedDate = m_value.u.date;</span>
<a href="#l2.61"></a><span id="l2.61">       adjustedDate += 60*60*24; // we want to be greater than the next day....</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-      if (t_date &gt; adjustedDate)</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+      if (dateToMatch &gt; adjustedDate)</span>
<a href="#l2.64"></a><span id="l2.64">         result = PR_TRUE;</span>
<a href="#l2.65"></a><span id="l2.65">     }</span>
<a href="#l2.66"></a><span id="l2.66">     break;</span>
<a href="#l2.67"></a><span id="l2.67">   case nsMsgSearchOp::Is:</span>
<a href="#l2.68"></a><span id="l2.68">     {</span>
<a href="#l2.69"></a><span id="l2.69">       PRExplodedTime tmToMatch, tmThis;</span>
<a href="#l2.70"></a><span id="l2.70">       if (NS_OK == GetLocalTimes (dateToMatch, m_value.u.date, tmToMatch, tmThis))</span>
<a href="#l2.71"></a><span id="l2.71">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerOSXIntegration.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -42,17 +42,16 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #define __nsMessengerOSXIntegration_h</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsITimer.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &quot;nsIAlertsService.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> #define NS_MESSENGEROSXINTEGRATION_CID \</span>
<a href="#l3.17"></a><span id="l3.17">   {0xaa83266, 0x4225, 0x4c4b, \</span>
<a href="#l3.18"></a><span id="l3.18">   {0x93, 0xf8, 0x94, 0xb1, 0x82, 0x58, 0x6f, 0x93}}</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20"> class nsIStringBundle;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -47,17 +47,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &lt;shellapi.h&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsITimer.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> // this function is exported by shell32.dll version 5.60 or later (Windows XP or greater)</span>
<a href="#l4.17"></a><span id="l4.17"> extern &quot;C&quot;</span>
<a href="#l4.18"></a><span id="l4.18"> {</span>
<a href="#l4.19"></a><span id="l4.19"> typedef HRESULT (__stdcall *fnSHSetUnreadMailCount)(LPCWSTR pszMailAddress, DWORD dwCount, LPCWSTR pszShellExecuteCommand);</span>
<a href="#l4.20"></a><span id="l4.20"> typedef HRESULT (__stdcall *fnSHEnumerateUnreadMailAccounts)(HKEY hKeyUser, DWORD dwIndex, LPCWSTR pszMailAddress, int cchMailAddress);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -142,18 +142,17 @@ NS_IMETHODIMP nsMsgBiffManager::AddServe</span>
<a href="#l5.4"></a><span id="l5.4">   if (biffMinutes &gt; 0)</span>
<a href="#l5.5"></a><span id="l5.5">   {</span>
<a href="#l5.6"></a><span id="l5.6">     PRInt32 serverIndex = FindServer(server);</span>
<a href="#l5.7"></a><span id="l5.7">     // Only add it if it hasn't been added already.</span>
<a href="#l5.8"></a><span id="l5.8">     if (serverIndex == -1)</span>
<a href="#l5.9"></a><span id="l5.9">     {</span>
<a href="#l5.10"></a><span id="l5.10">       nsBiffEntry biffEntry;</span>
<a href="#l5.11"></a><span id="l5.11">       biffEntry.server = server;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      nsTime currentTime;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-      rv = SetNextBiffTime(biffEntry, currentTime);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+      rv = SetNextBiffTime(biffEntry, PR_Now());</span>
<a href="#l5.15"></a><span id="l5.15">       if (NS_FAILED(rv))</span>
<a href="#l5.16"></a><span id="l5.16">         return rv;</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">       AddBiffEntry(biffEntry);</span>
<a href="#l5.19"></a><span id="l5.19">       SetupNextBiff();</span>
<a href="#l5.20"></a><span id="l5.20">     }</span>
<a href="#l5.21"></a><span id="l5.21">   }</span>
<a href="#l5.22"></a><span id="l5.22">   return NS_OK;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineat">@@ -224,29 +223,29 @@ nsresult nsMsgBiffManager::AddBiffEntry(</span>
<a href="#l5.24"></a><span id="l5.24">     if (biffEntry.nextBiffTime &lt; mBiffArray[i].nextBiffTime)</span>
<a href="#l5.25"></a><span id="l5.25">       break;</span>
<a href="#l5.26"></a><span id="l5.26">   }</span>
<a href="#l5.27"></a><span id="l5.27">   PR_LOG(MsgBiffLogModule, PR_LOG_ALWAYS, (&quot;inserting biff entry at %d\n&quot;, i));</span>
<a href="#l5.28"></a><span id="l5.28">   mBiffArray.InsertElementAt(i, biffEntry);</span>
<a href="#l5.29"></a><span id="l5.29">   return NS_OK;</span>
<a href="#l5.30"></a><span id="l5.30"> }</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-nsresult nsMsgBiffManager::SetNextBiffTime(nsBiffEntry &amp;biffEntry, const nsTime currentTime)</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+nsresult nsMsgBiffManager::SetNextBiffTime(nsBiffEntry &amp;biffEntry, PRTime currentTime)</span>
<a href="#l5.34"></a><span id="l5.34"> {</span>
<a href="#l5.35"></a><span id="l5.35">   nsIMsgIncomingServer *server = biffEntry.server;</span>
<a href="#l5.36"></a><span id="l5.36">   if (!server)</span>
<a href="#l5.37"></a><span id="l5.37">     return NS_ERROR_FAILURE;</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">   PRInt32 biffInterval;</span>
<a href="#l5.40"></a><span id="l5.40">   nsresult rv = server-&gt;GetBiffMinutes(&amp;biffInterval);</span>
<a href="#l5.41"></a><span id="l5.41">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43">   // Add biffInterval, converted in microseconds, to current time.</span>
<a href="#l5.44"></a><span id="l5.44">   // Force 64-bit multiplication.</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-  nsTime chosenTimeInterval = biffInterval * 60000000LL;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+  PRTime chosenTimeInterval = biffInterval * 60000000LL;</span>
<a href="#l5.47"></a><span id="l5.47">   biffEntry.nextBiffTime = currentTime + chosenTimeInterval;</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49">   // Check if we should jitter.</span>
<a href="#l5.50"></a><span id="l5.50">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs = do_GetService(NS_PREFSERVICE_CONTRACTID);</span>
<a href="#l5.51"></a><span id="l5.51">   if (prefs)</span>
<a href="#l5.52"></a><span id="l5.52">   {</span>
<a href="#l5.53"></a><span id="l5.53">     PRBool shouldUseBiffJitter = PR_FALSE;</span>
<a href="#l5.54"></a><span id="l5.54">     prefs-&gt;GetBoolPref(PREF_BIFF_JITTER, &amp;shouldUseBiffJitter);</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineat">@@ -267,32 +266,32 @@ nsresult nsMsgBiffManager::SetNextBiffTi</span>
<a href="#l5.56"></a><span id="l5.56"> }</span>
<a href="#l5.57"></a><span id="l5.57"> </span>
<a href="#l5.58"></a><span id="l5.58"> nsresult nsMsgBiffManager::SetupNextBiff()</span>
<a href="#l5.59"></a><span id="l5.59"> {</span>
<a href="#l5.60"></a><span id="l5.60">   if (mBiffArray.Length() &gt; 0)</span>
<a href="#l5.61"></a><span id="l5.61">   {</span>
<a href="#l5.62"></a><span id="l5.62">     // Get the next biff entry</span>
<a href="#l5.63"></a><span id="l5.63">     const nsBiffEntry &amp;biffEntry = mBiffArray[0];</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-    nsTime currentTime;</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-    nsInt64 biffDelay;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-    nsInt64 ms(1000);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+    PRTime currentTime = PR_Now();</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+    PRInt64 biffDelay;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+    PRInt64 ms(1000);</span>
<a href="#l5.70"></a><span id="l5.70"> </span>
<a href="#l5.71"></a><span id="l5.71">     if (currentTime &gt; biffEntry.nextBiffTime)</span>
<a href="#l5.72"></a><span id="l5.72">     {</span>
<a href="#l5.73"></a><span id="l5.73">       PRInt64 microSecondsPerSecond;</span>
<a href="#l5.74"></a><span id="l5.74"> </span>
<a href="#l5.75"></a><span id="l5.75">       LL_I2L(microSecondsPerSecond, PR_USEC_PER_SEC);</span>
<a href="#l5.76"></a><span id="l5.76">       LL_MUL(biffDelay, 30, microSecondsPerSecond); //let's wait 30 seconds before firing biff again</span>
<a href="#l5.77"></a><span id="l5.77">     }</span>
<a href="#l5.78"></a><span id="l5.78">     else</span>
<a href="#l5.79"></a><span id="l5.79">       biffDelay = biffEntry.nextBiffTime - currentTime;</span>
<a href="#l5.80"></a><span id="l5.80"> </span>
<a href="#l5.81"></a><span id="l5.81">     // Convert biffDelay into milliseconds</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-    nsInt64 timeInMS = biffDelay / ms;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+    PRInt64 timeInMS = biffDelay / ms;</span>
<a href="#l5.84"></a><span id="l5.84">     PRUint32 timeInMSUint32 = (PRUint32)timeInMS;</span>
<a href="#l5.85"></a><span id="l5.85"> </span>
<a href="#l5.86"></a><span id="l5.86">     // Can't currently reset a timer when it's in the process of</span>
<a href="#l5.87"></a><span id="l5.87">     // calling Notify. So, just release the timer here and create a new one.</span>
<a href="#l5.88"></a><span id="l5.88">     if (mBiffTimer)</span>
<a href="#l5.89"></a><span id="l5.89">       mBiffTimer-&gt;Cancel();</span>
<a href="#l5.90"></a><span id="l5.90"> </span>
<a href="#l5.91"></a><span id="l5.91">     PR_LOG(MsgBiffLogModule, PR_LOG_ALWAYS, (&quot;setting %d timer\n&quot;, timeInMSUint32));</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineat">@@ -302,17 +301,17 @@ nsresult nsMsgBiffManager::SetupNextBiff</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94">   }</span>
<a href="#l5.95"></a><span id="l5.95">   return NS_OK;</span>
<a href="#l5.96"></a><span id="l5.96"> }</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98"> //This is the function that does a biff on all of the servers whose time it is to biff.</span>
<a href="#l5.99"></a><span id="l5.99"> nsresult nsMsgBiffManager::PerformBiff()</span>
<a href="#l5.100"></a><span id="l5.100"> {</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-  nsTime currentTime;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineplus">+  PRTime currentTime = PR_Now();</span>
<a href="#l5.103"></a><span id="l5.103">   nsCOMArray&lt;nsIMsgFolder&gt; targetFolders;</span>
<a href="#l5.104"></a><span id="l5.104">   PR_LOG(MsgBiffLogModule, PR_LOG_ALWAYS, (&quot;performing biffs\n&quot;));</span>
<a href="#l5.105"></a><span id="l5.105"> </span>
<a href="#l5.106"></a><span id="l5.106">   PRUint32 count = mBiffArray.Length();</span>
<a href="#l5.107"></a><span id="l5.107">   for (PRUint32 i = 0; i &lt; count; i++)</span>
<a href="#l5.108"></a><span id="l5.108">   {</span>
<a href="#l5.109"></a><span id="l5.109">     // Take a copy of the entry rather than the a reference so that we can</span>
<a href="#l5.110"></a><span id="l5.110">     // remove and add if necessary, but keep the references and memory alive.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgBiffManager.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgBiffManager.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -37,24 +37,23 @@</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5"> #ifndef NSMSGBIFFMANAGER_H</span>
<a href="#l6.6"></a><span id="l6.6"> #define NSMSGBIFFMANAGER_H</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> #include &quot;msgCore.h&quot;</span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsIMsgBiffManager.h&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> #include &quot;nsITimer.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nsTArray.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#include &quot;nsTime.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14"> #include &quot;nsIIncomingServerListener.h&quot;</span>
<a href="#l6.15"></a><span id="l6.15"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> typedef struct {</span>
<a href="#l6.18"></a><span id="l6.18"> 	nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-	nsTime nextBiffTime;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+	PRTime nextBiffTime;</span>
<a href="#l6.21"></a><span id="l6.21"> } nsBiffEntry;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24"> class nsMsgBiffManager</span>
<a href="#l6.25"></a><span id="l6.25"> 	: public nsIMsgBiffManager,</span>
<a href="#l6.26"></a><span id="l6.26"> 		public nsIIncomingServerListener,</span>
<a href="#l6.27"></a><span id="l6.27"> 		public nsSupportsWeakReference</span>
<a href="#l6.28"></a><span id="l6.28"> {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineat">@@ -65,17 +64,17 @@ public:</span>
<a href="#l6.30"></a><span id="l6.30"> 	NS_DECL_ISUPPORTS</span>
<a href="#l6.31"></a><span id="l6.31"> 	NS_DECL_NSIMSGBIFFMANAGER</span>
<a href="#l6.32"></a><span id="l6.32"> 	NS_DECL_NSIINCOMINGSERVERLISTENER</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34"> 	nsresult PerformBiff();</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36"> protected:</span>
<a href="#l6.37"></a><span id="l6.37"> 	PRInt32 FindServer(nsIMsgIncomingServer *server);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-	nsresult SetNextBiffTime(nsBiffEntry &amp;biffEntry, const nsTime currentTime);</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+	nsresult SetNextBiffTime(nsBiffEntry &amp;biffEntry, PRTime currentTime);</span>
<a href="#l6.40"></a><span id="l6.40"> 	nsresult SetupNextBiff();</span>
<a href="#l6.41"></a><span id="l6.41"> 	nsresult AddBiffEntry(nsBiffEntry &amp;biffEntry);</span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43"> protected:</span>
<a href="#l6.44"></a><span id="l6.44">   nsCOMPtr&lt;nsITimer&gt; mBiffTimer;</span>
<a href="#l6.45"></a><span id="l6.45">   nsTArray&lt;nsBiffEntry&gt; mBiffArray;</span>
<a href="#l6.46"></a><span id="l6.46">   PRBool mHaveShutdown;</span>
<a href="#l6.47"></a><span id="l6.47">   PRBool mInited;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgProgress.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -39,17 +39,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #include &quot;nsMsgProgress.h&quot;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;nsIBaseWindow.h&quot;</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> #include &quot;nsNetError.h&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l7.14"></a><span id="l7.14"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l7.15"></a><span id="l7.15"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l7.16"></a><span id="l7.16"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> NS_IMPL_THREADSAFE_ADDREF(nsMsgProgress)</span>
<a href="#l7.19"></a><span id="l7.19"> NS_IMPL_THREADSAFE_RELEASE(nsMsgProgress)</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -277,18 +276,18 @@ NS_IMETHODIMP nsMsgProgress::GetMsgWindo</span>
<a href="#l7.22"></a><span id="l7.22">   return NS_OK;</span>
<a href="#l7.23"></a><span id="l7.23"> }</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> NS_IMETHODIMP nsMsgProgress::OnProgress(nsIRequest *request, nsISupports* ctxt,</span>
<a href="#l7.26"></a><span id="l7.26">                                         PRUint64 aProgress, PRUint64 aProgressMax)</span>
<a href="#l7.27"></a><span id="l7.27"> {</span>
<a href="#l7.28"></a><span id="l7.28">   // XXX: What should the nsIWebProgress be?</span>
<a href="#l7.29"></a><span id="l7.29">   // XXX: This truncates 64-bit to 32-bit</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  return OnProgressChange(nsnull, request, nsUint64(aProgress), nsUint64(aProgressMax),</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                          nsUint64(aProgress) /* current total progress */, nsUint64(aProgressMax) /* max total progress */);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  return OnProgressChange(nsnull, request, PRInt32(aProgress), PRInt32(aProgressMax),</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+                          PRInt32(aProgress) /* current total progress */, PRInt32(aProgressMax) /* max total progress */);</span>
<a href="#l7.34"></a><span id="l7.34"> }</span>
<a href="#l7.35"></a><span id="l7.35"> </span>
<a href="#l7.36"></a><span id="l7.36"> NS_IMETHODIMP nsMsgProgress::OnStatus(nsIRequest *request, nsISupports* ctxt,</span>
<a href="#l7.37"></a><span id="l7.37">                                       nsresult aStatus, const PRUnichar* aStatusArg)</span>
<a href="#l7.38"></a><span id="l7.38"> {</span>
<a href="#l7.39"></a><span id="l7.39">   nsresult rv;</span>
<a href="#l7.40"></a><span id="l7.40">   nsCOMPtr&lt;nsIStringBundleService&gt; sbs = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l7.41"></a><span id="l7.41">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPurgeService.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPurgeService.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -177,17 +177,17 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l8.4"></a><span id="l8.4">   if (NS_SUCCEEDED(rv) &amp;&amp; allServers)</span>
<a href="#l8.5"></a><span id="l8.5">   {</span>
<a href="#l8.6"></a><span id="l8.6">     PRUint32 numServers;</span>
<a href="#l8.7"></a><span id="l8.7">     rv = allServers-&gt;Count(&amp;numServers);</span>
<a href="#l8.8"></a><span id="l8.8">     PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;%d servers&quot;, numServers));</span>
<a href="#l8.9"></a><span id="l8.9">     nsCOMPtr&lt;nsIMsgFolder&gt; folderToPurge;</span>
<a href="#l8.10"></a><span id="l8.10">     PRIntervalTime startTime = PR_IntervalNow();</span>
<a href="#l8.11"></a><span id="l8.11">     PRInt32 purgeIntervalToUse;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    nsTime oldestPurgeTime = 0; // we're going to pick the least-recently purged folder</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    PRTime oldestPurgeTime = 0; // we're going to pick the least-recently purged folder</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">     // apply retention settings to folders that haven't had retention settings</span>
<a href="#l8.16"></a><span id="l8.16">     // applied in mMinDelayBetweenPurges minutes (default 8 hours)</span>
<a href="#l8.17"></a><span id="l8.17">     // Because we get last purge time from the folder cache,</span>
<a href="#l8.18"></a><span id="l8.18">     // this code won't open db's for folders until it decides it needs</span>
<a href="#l8.19"></a><span id="l8.19">     // to apply retention settings, and since nsIMsgFolder::ApplyRetentionSettings</span>
<a href="#l8.20"></a><span id="l8.20">     // will close any db's it opens, this code won't leave db's open.</span>
<a href="#l8.21"></a><span id="l8.21">     for (PRUint32 serverIndex=0; serverIndex &lt; numServers; serverIndex++)</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -217,17 +217,17 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l8.23"></a><span id="l8.23">           {</span>
<a href="#l8.24"></a><span id="l8.24">             childFolder = do_QueryElementAt(childFolders, index);</span>
<a href="#l8.25"></a><span id="l8.25">             if (childFolder)</span>
<a href="#l8.26"></a><span id="l8.26">             {</span>
<a href="#l8.27"></a><span id="l8.27">               PRUint32 folderFlags;</span>
<a href="#l8.28"></a><span id="l8.28">               (void) childFolder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l8.29"></a><span id="l8.29">               if (folderFlags &amp; nsMsgFolderFlags::Virtual)</span>
<a href="#l8.30"></a><span id="l8.30">                 continue;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-              nsTime curFolderLastPurgeTime=0;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+              PRTime curFolderLastPurgeTime = 0;</span>
<a href="#l8.33"></a><span id="l8.33">               nsCString curFolderLastPurgeTimeString, curFolderUri;</span>
<a href="#l8.34"></a><span id="l8.34">               rv = childFolder-&gt;GetStringProperty(&quot;LastPurgeTime&quot;, curFolderLastPurgeTimeString);</span>
<a href="#l8.35"></a><span id="l8.35">               if (NS_FAILED(rv))</span>
<a href="#l8.36"></a><span id="l8.36">                 continue; // it is ok to fail, go on to next folder</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">               if (!curFolderLastPurgeTimeString.IsEmpty())</span>
<a href="#l8.39"></a><span id="l8.39">               {</span>
<a href="#l8.40"></a><span id="l8.40">                 PRInt64 theTime;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -236,21 +236,20 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l8.42"></a><span id="l8.42">               }</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44">               childFolder-&gt;GetURI(curFolderUri);</span>
<a href="#l8.45"></a><span id="l8.45">               PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;%s curFolderLastPurgeTime=%s (if blank, then never)&quot;, curFolderUri.get(), curFolderLastPurgeTimeString.get()));</span>
<a href="#l8.46"></a><span id="l8.46"> </span>
<a href="#l8.47"></a><span id="l8.47">               // check if this folder is due to purge</span>
<a href="#l8.48"></a><span id="l8.48">               // has to have been purged at least mMinDelayBetweenPurges minutes ago</span>
<a href="#l8.49"></a><span id="l8.49">               // we don't want to purge the folders all the time - once a day is good enough</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-              nsInt64 minDelayBetweenPurges(mMinDelayBetweenPurges);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-              nsInt64 microSecondsPerMinute(60000000);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-              nsTime nextPurgeTime = curFolderLastPurgeTime + (minDelayBetweenPurges * microSecondsPerMinute);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-              nsTime currentTime; // nsTime defaults to PR_Now</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-              if (nextPurgeTime &lt; currentTime)</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+              PRInt64 minDelayBetweenPurges(mMinDelayBetweenPurges);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+              PRInt64 microSecondsPerMinute(60000000);</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+              PRTime nextPurgeTime = curFolderLastPurgeTime + (minDelayBetweenPurges * microSecondsPerMinute);</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+              if (nextPurgeTime &lt; PR_Now())</span>
<a href="#l8.59"></a><span id="l8.59">               {</span>
<a href="#l8.60"></a><span id="l8.60">                 PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;purging %s&quot;, curFolderUri.get()));</span>
<a href="#l8.61"></a><span id="l8.61">                 childFolder-&gt;ApplyRetentionSettings();</span>
<a href="#l8.62"></a><span id="l8.62">               }</span>
<a href="#l8.63"></a><span id="l8.63">               PRIntervalTime elapsedTime;</span>
<a href="#l8.64"></a><span id="l8.64">               LL_SUB(elapsedTime, PR_IntervalNow(), startTime);</span>
<a href="#l8.65"></a><span id="l8.65">               // check if more than 500 milliseconds have elapsed in this purge process</span>
<a href="#l8.66"></a><span id="l8.66">               if (PR_IntervalToMilliseconds(elapsedTime) &gt; 500)</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineat">@@ -310,17 +309,17 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l8.68"></a><span id="l8.68">         // skip this account</span>
<a href="#l8.69"></a><span id="l8.69">         nsCOMPtr&lt;nsIMsgFolder&gt; junkFolder;</span>
<a href="#l8.70"></a><span id="l8.70">         GetExistingFolder(junkFolderURI, getter_AddRefs(junkFolder));</span>
<a href="#l8.71"></a><span id="l8.71"> </span>
<a href="#l8.72"></a><span id="l8.72">         PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] %s exists? %s (if doesn't exist, don't purge)&quot;, serverIndex, junkFolderURI.get(), junkFolder ? &quot;true&quot; : &quot;false&quot;));</span>
<a href="#l8.73"></a><span id="l8.73">         if (!junkFolder)</span>
<a href="#l8.74"></a><span id="l8.74">           continue;</span>
<a href="#l8.75"></a><span id="l8.75"> </span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-        nsTime curJunkFolderLastPurgeTime=0;</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+        PRTime curJunkFolderLastPurgeTime = 0;</span>
<a href="#l8.78"></a><span id="l8.78">         nsCString curJunkFolderLastPurgeTimeString;</span>
<a href="#l8.79"></a><span id="l8.79">         rv = junkFolder-&gt;GetStringProperty(&quot;curJunkFolderLastPurgeTime&quot;, curJunkFolderLastPurgeTimeString);</span>
<a href="#l8.80"></a><span id="l8.80">         if (NS_FAILED(rv))</span>
<a href="#l8.81"></a><span id="l8.81">           continue; // it is ok to fail, junk folder may not exist</span>
<a href="#l8.82"></a><span id="l8.82"> </span>
<a href="#l8.83"></a><span id="l8.83">         if (!curJunkFolderLastPurgeTimeString.IsEmpty())</span>
<a href="#l8.84"></a><span id="l8.84">         {</span>
<a href="#l8.85"></a><span id="l8.85">           PRInt64 theTime;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineat">@@ -328,19 +327,18 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l8.87"></a><span id="l8.87">           curJunkFolderLastPurgeTime = theTime;</span>
<a href="#l8.88"></a><span id="l8.88">         }</span>
<a href="#l8.89"></a><span id="l8.89"> </span>
<a href="#l8.90"></a><span id="l8.90">         PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] %s curJunkFolderLastPurgeTime=%s (if blank, then never)&quot;, serverIndex, junkFolderURI.get(), curJunkFolderLastPurgeTimeString.get()));</span>
<a href="#l8.91"></a><span id="l8.91"> </span>
<a href="#l8.92"></a><span id="l8.92">         // check if this account is due to purge</span>
<a href="#l8.93"></a><span id="l8.93">         // has to have been purged at least mMinDelayBetweenPurges minutes ago</span>
<a href="#l8.94"></a><span id="l8.94">         // we don't want to purge the folders all the time</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-        nsTime nextPurgeTime = curJunkFolderLastPurgeTime + nsInt64(mMinDelayBetweenPurges * 60000000 /* convert mMinDelayBetweenPurges to into microseconds */);</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-        nsTime currentTime;</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-        if (nextPurgeTime &lt; currentTime)</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+        PRTime nextPurgeTime = curJunkFolderLastPurgeTime + mMinDelayBetweenPurges * 60000000 /* convert mMinDelayBetweenPurges to into microseconds */;</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+        if (nextPurgeTime &lt; PR_Now())</span>
<a href="#l8.100"></a><span id="l8.100">         {</span>
<a href="#l8.101"></a><span id="l8.101">           PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] last purge greater than min delay&quot;, serverIndex));</span>
<a href="#l8.102"></a><span id="l8.102"> </span>
<a href="#l8.103"></a><span id="l8.103">           nsCOMPtr &lt;nsIMsgIncomingServer&gt; junkFolderServer;</span>
<a href="#l8.104"></a><span id="l8.104">           rv = junkFolder-&gt;GetServer(getter_AddRefs(junkFolderServer));</span>
<a href="#l8.105"></a><span id="l8.105">           NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l8.106"></a><span id="l8.106"> </span>
<a href="#l8.107"></a><span id="l8.107">           PRBool serverBusy = PR_FALSE;</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineat">@@ -358,24 +356,24 @@ nsresult nsMsgPurgeService::PerformPurge</span>
<a href="#l8.109"></a><span id="l8.109">           PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] (server busy? %s)&quot;, serverIndex, serverBusy ? &quot;true&quot; : &quot;false&quot;));</span>
<a href="#l8.110"></a><span id="l8.110">           PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] (serverRequiresPassword? %s)&quot;, serverIndex, serverRequiresPassword ? &quot;true&quot; : &quot;false&quot;));</span>
<a href="#l8.111"></a><span id="l8.111">           PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] (passwordPromptRequired? %s)&quot;, serverIndex, passwordPromptRequired ? &quot;true&quot; : &quot;false&quot;));</span>
<a href="#l8.112"></a><span id="l8.112">           if (canSearchMessages &amp;&amp; !mSearchSession &amp;&amp; !serverBusy &amp;&amp; (!serverRequiresPassword || !passwordPromptRequired))</span>
<a href="#l8.113"></a><span id="l8.113">           {</span>
<a href="#l8.114"></a><span id="l8.114">             PRInt32 purgeInterval;</span>
<a href="#l8.115"></a><span id="l8.115">             spamSettings-&gt;GetPurgeInterval(&amp;purgeInterval);</span>
<a href="#l8.116"></a><span id="l8.116"> </span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-            if ((oldestPurgeTime == nsInt64(0)) || (curJunkFolderLastPurgeTime &lt; oldestPurgeTime))</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+            if ((oldestPurgeTime == 0) || (curJunkFolderLastPurgeTime &lt; oldestPurgeTime))</span>
<a href="#l8.119"></a><span id="l8.119">             {</span>
<a href="#l8.120"></a><span id="l8.120">               PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] purging! searching for messages older than %d days&quot;, serverIndex, purgeInterval));</span>
<a href="#l8.121"></a><span id="l8.121">               oldestPurgeTime = curJunkFolderLastPurgeTime;</span>
<a href="#l8.122"></a><span id="l8.122">               purgeIntervalToUse = purgeInterval;</span>
<a href="#l8.123"></a><span id="l8.123">               folderToPurge = junkFolder;</span>
<a href="#l8.124"></a><span id="l8.124">               // if we've never purged this folder, do it...</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-              if (curJunkFolderLastPurgeTime == nsInt64(0))</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+              if (curJunkFolderLastPurgeTime == 0)</span>
<a href="#l8.127"></a><span id="l8.127">                 break;</span>
<a href="#l8.128"></a><span id="l8.128">             }</span>
<a href="#l8.129"></a><span id="l8.129">           }</span>
<a href="#l8.130"></a><span id="l8.130">           else {</span>
<a href="#l8.131"></a><span id="l8.131">             NS_ASSERTION(canSearchMessages, &quot;unexpected, you should be able to search&quot;);</span>
<a href="#l8.132"></a><span id="l8.132">             PR_LOG(MsgPurgeLogModule, PR_LOG_ALWAYS, (&quot;[%d] not a good time for this server, try again later&quot;, serverIndex));</span>
<a href="#l8.133"></a><span id="l8.133">           }</span>
<a href="#l8.134"></a><span id="l8.134">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/src/nsMsgPurgeService.h</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgPurgeService.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -40,17 +40,16 @@</span>
<a href="#l9.4"></a><span id="l9.4"> #ifndef NSMSGPURGESERVICE_H</span>
<a href="#l9.5"></a><span id="l9.5"> #define NSMSGPURGESERVICE_H</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> #include &quot;msgCore.h&quot;</span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;nsIMsgPurgeService.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsIMsgSearchSession.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsITimer.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-#include &quot;nsTime.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> #include &quot;nsIMsgSearchNotify.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l9.17"></a><span id="l9.17"> #include &quot;nsIMsgFolderCacheElement.h&quot;</span>
<a href="#l9.18"></a><span id="l9.18"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> class nsMsgPurgeService</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgStatusFeedback.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -42,17 +42,16 @@</span>
<a href="#l10.4"></a><span id="l10.4"> #include &quot;nsMsgStatusFeedback.h&quot;</span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;nsIDocumentViewer.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;nsIDocument.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsIDOMElement.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIDocShellTreeItem.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIChannel.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;prinrval.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsITimelineService.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;nsIMimeMiscStatus.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l10.18"></a><span id="l10.18"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l10.19"></a><span id="l10.19"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l10.20"></a><span id="l10.20"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -302,18 +301,18 @@ NS_IMETHODIMP nsMsgStatusFeedback::SetWr</span>
<a href="#l10.22"></a><span id="l10.22">   return NS_OK;</span>
<a href="#l10.23"></a><span id="l10.23"> }</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25"> NS_IMETHODIMP nsMsgStatusFeedback::OnProgress(nsIRequest *request, nsISupports* ctxt, </span>
<a href="#l10.26"></a><span id="l10.26">                                           PRUint64 aProgress, PRUint64 aProgressMax)</span>
<a href="#l10.27"></a><span id="l10.27"> {</span>
<a href="#l10.28"></a><span id="l10.28">   // XXX: What should the nsIWebProgress be?</span>
<a href="#l10.29"></a><span id="l10.29">   // XXX: this truncates 64-bit to 32-bit</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-  return OnProgressChange(nsnull, request, nsUint64(aProgress), nsUint64(aProgressMax), </span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-                          nsUint64(aProgress) /* current total progress */, nsUint64(aProgressMax) /* max total progress */);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  return OnProgressChange(nsnull, request, PRInt32(aProgress), PRInt32(aProgressMax), </span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+                          PRInt32(aProgress) /* current total progress */, PRInt32(aProgressMax) /* max total progress */);</span>
<a href="#l10.34"></a><span id="l10.34"> }</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36"> NS_IMETHODIMP nsMsgStatusFeedback::OnStatus(nsIRequest *request, nsISupports* ctxt, </span>
<a href="#l10.37"></a><span id="l10.37">                                             nsresult aStatus, const PRUnichar* aStatusArg)</span>
<a href="#l10.38"></a><span id="l10.38"> {</span>
<a href="#l10.39"></a><span id="l10.39">   nsresult rv;</span>
<a href="#l10.40"></a><span id="l10.40">   nsCOMPtr&lt;nsIStringBundleService&gt; sbs = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l10.41"></a><span id="l10.41">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -67,17 +67,16 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l11.5"></a><span id="l11.5"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsISpamSettings.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> #include &quot;nsReadLine.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsParserCIID.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &quot;nsIParser.h&quot;</span>
<a href="#l11.16"></a><span id="l11.16"> #include &quot;nsIHTMLContentSink.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #include &quot;nsIContentSerializer.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> #include &quot;nsLayoutCID.h&quot;</span>
<a href="#l11.19"></a><span id="l11.19"> #include &quot;nsIHTMLToTextSink.h&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> #include &quot;nsIDocumentEncoder.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgFileStream.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgFileStream.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,11 +1,10 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> #include &quot;nsMsgFileStream.h&quot;</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> #include &quot;prerr.h&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;prerror.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> /* From nsDebugImpl.cpp: */</span>
<a href="#l12.11"></a><span id="l12.11"> static nsresult</span>
<a href="#l12.12"></a><span id="l12.12"> ErrorAccordingToNSPR()</span>
<a href="#l12.13"></a><span id="l12.13"> {</span>
<a href="#l12.14"></a><span id="l12.14">     PRErrorCode err = PR_GetError();</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineat">@@ -47,31 +46,31 @@ nsresult nsMsgFileStream::InitWithFile(n</span>
<a href="#l12.16"></a><span id="l12.16"> }</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> NS_IMETHODIMP</span>
<a href="#l12.19"></a><span id="l12.19"> nsMsgFileStream::Seek(PRInt32 whence, PRInt64 offset)</span>
<a href="#l12.20"></a><span id="l12.20"> {</span>
<a href="#l12.21"></a><span id="l12.21">   if (mFileDesc == nsnull)</span>
<a href="#l12.22"></a><span id="l12.22">     return NS_BASE_STREAM_CLOSED;</span>
<a href="#l12.23"></a><span id="l12.23">   </span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-  nsInt64 cnt = PR_Seek64(mFileDesc, offset, (PRSeekWhence)whence);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-  if (cnt == nsInt64(-1)) {</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+  PRInt64 cnt = PR_Seek64(mFileDesc, offset, (PRSeekWhence)whence);</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+  if (cnt == PRInt64(-1)) {</span>
<a href="#l12.28"></a><span id="l12.28">     return ErrorAccordingToNSPR();</span>
<a href="#l12.29"></a><span id="l12.29">   }</span>
<a href="#l12.30"></a><span id="l12.30">   return NS_OK;</span>
<a href="#l12.31"></a><span id="l12.31"> }</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33"> NS_IMETHODIMP</span>
<a href="#l12.34"></a><span id="l12.34"> nsMsgFileStream::Tell(PRInt64 *result)</span>
<a href="#l12.35"></a><span id="l12.35"> {</span>
<a href="#l12.36"></a><span id="l12.36">   if (mFileDesc == nsnull)</span>
<a href="#l12.37"></a><span id="l12.37">     return NS_BASE_STREAM_CLOSED;</span>
<a href="#l12.38"></a><span id="l12.38">   </span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-  nsInt64 cnt = PR_Seek64(mFileDesc, 0, PR_SEEK_CUR);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-  if (cnt == nsInt64(-1)) {</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+  PRInt64 cnt = PR_Seek64(mFileDesc, 0, PR_SEEK_CUR);</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+  if (cnt == PRInt64(-1)) {</span>
<a href="#l12.43"></a><span id="l12.43">     return ErrorAccordingToNSPR();</span>
<a href="#l12.44"></a><span id="l12.44">   }</span>
<a href="#l12.45"></a><span id="l12.45">   *result = cnt;</span>
<a href="#l12.46"></a><span id="l12.46">   return NS_OK;</span>
<a href="#l12.47"></a><span id="l12.47"> }</span>
<a href="#l12.48"></a><span id="l12.48"> </span>
<a href="#l12.49"></a><span id="l12.49"> NS_IMETHODIMP</span>
<a href="#l12.50"></a><span id="l12.50"> nsMsgFileStream::SetEOF()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgProtocol.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -294,18 +294,18 @@ nsresult nsMsgProtocol::OpenFileSocket(n</span>
<a href="#l13.4"></a><span id="l13.4">   rv = NS_NewLocalFileInputStream(getter_AddRefs(stream), file);</span>
<a href="#l13.5"></a><span id="l13.5">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">   // create input stream transport</span>
<a href="#l13.8"></a><span id="l13.8">   nsCOMPtr&lt;nsIStreamTransportService&gt; sts =</span>
<a href="#l13.9"></a><span id="l13.9">       do_GetService(NS_STREAMTRANSPORTSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l13.10"></a><span id="l13.10">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  rv = sts-&gt;CreateInputTransport(stream, nsInt64(aStartPosition),</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                                 nsInt64(aReadCount), PR_TRUE,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  rv = sts-&gt;CreateInputTransport(stream, PRInt64(aStartPosition),</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+                                 PRInt64(aReadCount), PR_TRUE,</span>
<a href="#l13.16"></a><span id="l13.16">                                  getter_AddRefs(m_transport));</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18">   m_socketIsOpen = PR_FALSE;</span>
<a href="#l13.19"></a><span id="l13.19">   return rv;</span>
<a href="#l13.20"></a><span id="l13.20"> }</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22"> nsresult nsMsgProtocol::GetTopmostMsgWindow(nsIMsgWindow **aWindow)</span>
<a href="#l13.23"></a><span id="l13.23"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -53,17 +53,16 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #include &quot;nsMsgThread.h&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> #include &quot;nsIMsgSearchTerm.h&quot;</span>
<a href="#l14.6"></a><span id="l14.6"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l14.7"></a><span id="l14.7"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l14.8"></a><span id="l14.8"> #include &quot;nsMorkCID.h&quot;</span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nsIMdbFactoryFactory.h&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #include &quot;prlog.h&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;prprf.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#include &quot;nsTime.h&quot;</span>
<a href="#l14.13"></a><span id="l14.13"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l14.14"></a><span id="l14.14"> #include &quot;nsILocale.h&quot;</span>
<a href="#l14.15"></a><span id="l14.15"> #include &quot;nsLocaleCID.h&quot;</span>
<a href="#l14.16"></a><span id="l14.16"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l14.17"></a><span id="l14.17"> #include &quot;nsILocaleService.h&quot;</span>
<a href="#l14.18"></a><span id="l14.18"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l14.19"></a><span id="l14.19"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l14.20"></a><span id="l14.20"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -2638,32 +2637,28 @@ NS_IMETHODIMP nsMsgDatabase::MarkReadByD</span>
<a href="#l14.22"></a><span id="l14.22">   nsMsgHdr  *pHeader;</span>
<a href="#l14.23"></a><span id="l14.23">   PRInt32 numChanged = 0;</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">   nsISimpleEnumerator* hdrs;</span>
<a href="#l14.26"></a><span id="l14.26">   rv = EnumerateMessages(&amp;hdrs);</span>
<a href="#l14.27"></a><span id="l14.27">   if (NS_FAILED(rv))</span>
<a href="#l14.28"></a><span id="l14.28">     return rv;</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-  nsTime t_startDate(startDate);</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  nsTime t_endDate(endDate);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-</span>
<a href="#l14.33"></a><span id="l14.33">   PRBool hasMore = PR_FALSE;</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35">   while (NS_SUCCEEDED(rv = hdrs-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore)</span>
<a href="#l14.36"></a><span id="l14.36">   {</span>
<a href="#l14.37"></a><span id="l14.37">     rv = hdrs-&gt;GetNext((nsISupports**)&amp;pHeader);</span>
<a href="#l14.38"></a><span id="l14.38">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;nsMsgDBEnumerator broken&quot;);</span>
<a href="#l14.39"></a><span id="l14.39">     if (NS_FAILED(rv)) break;</span>
<a href="#l14.40"></a><span id="l14.40"> </span>
<a href="#l14.41"></a><span id="l14.41">     PRTime headerDate;</span>
<a href="#l14.42"></a><span id="l14.42">     (void)pHeader-&gt;GetDate(&amp;headerDate);</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-    nsTime t_headerDate(headerDate);</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-    if (t_headerDate &gt; t_startDate &amp;&amp; t_headerDate &lt;= t_endDate)</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+    if (headerDate &gt; startDate &amp;&amp; headerDate &lt;= endDate)</span>
<a href="#l14.48"></a><span id="l14.48">     {</span>
<a href="#l14.49"></a><span id="l14.49">       PRBool isRead;</span>
<a href="#l14.50"></a><span id="l14.50">       nsMsgKey key;</span>
<a href="#l14.51"></a><span id="l14.51">       (void)pHeader-&gt;GetMessageKey(&amp;key);</span>
<a href="#l14.52"></a><span id="l14.52">       IsRead(key, &amp;isRead);</span>
<a href="#l14.53"></a><span id="l14.53">       if (!isRead)</span>
<a href="#l14.54"></a><span id="l14.54">       {</span>
<a href="#l14.55"></a><span id="l14.55">         numChanged++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -104,17 +104,16 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #include &quot;nsIWebNavigation.h&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsIMAPNamespace.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsIMsgFolderCompactor.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;nsIMimeHeaders.h&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;nsIMsgMdnGenerator.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsISpamSettings.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> #include &lt;time.h&gt;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsIMsgMailNewsUrl.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsEmbedCID.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsIMsgComposeService.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsICacheEntryDescriptor.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> #include &quot;nsIMsgIdentity.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -95,17 +95,16 @@</span>
<a href="#l16.4"></a><span id="l16.4"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;nsImapProtocol.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l16.8"></a><span id="l16.8"> #include &quot;nsIStreamConverterService.h&quot;</span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;nsIAutoSyncManager.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15"> #define PREF_MAIL_ROOT_IMAP &quot;mail.root.imap&quot;            // old - for backward compatibility only</span>
<a href="#l16.16"></a><span id="l16.16"> #define PREF_MAIL_ROOT_IMAP_REL &quot;mail.root.imap-rel&quot;</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18"> static NS_DEFINE_CID(kImapUrlCID, NS_IMAPURL_CID);</span>
<a href="#l16.19"></a><span id="l16.19"> static NS_DEFINE_CID(kCImapMockChannel, NS_IMAPMOCKCHANNEL_CID);</span>
<a href="#l16.20"></a><span id="l16.20"> static NS_DEFINE_CID(kCacheServiceCID, NS_CACHESERVICE_CID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -3923,19 +3923,18 @@ nsMsgLocalMailFolder::WarnIfLocalFileToo</span>
<a href="#l17.4"></a><span id="l17.4">   *aTooBig = PR_FALSE;</span>
<a href="#l17.5"></a><span id="l17.5">   PRInt64 sizeOnDisk;</span>
<a href="#l17.6"></a><span id="l17.6">   nsCOMPtr &lt;nsILocalFile&gt; filePath;</span>
<a href="#l17.7"></a><span id="l17.7">   nsresult rv = GetFilePath(getter_AddRefs(filePath));</span>
<a href="#l17.8"></a><span id="l17.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.9"></a><span id="l17.9">   rv = filePath-&gt;GetFileSize(&amp;sizeOnDisk);</span>
<a href="#l17.10"></a><span id="l17.10">   if (NS_SUCCEEDED(rv))</span>
<a href="#l17.11"></a><span id="l17.11">   {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    const nsInt64 kMaxFolderSize = 0xFFF00000;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    nsInt64 folderSize(sizeOnDisk);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-    if (folderSize &gt; kMaxFolderSize)</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+    const PRInt64 kMaxFolderSize = 0xFFF00000;</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+    if (sizeOnDisk &gt; kMaxFolderSize)</span>
<a href="#l17.17"></a><span id="l17.17">     {</span>
<a href="#l17.18"></a><span id="l17.18">       ThrowAlertMsg(&quot;mailboxTooLarge&quot;, aWindow);</span>
<a href="#l17.19"></a><span id="l17.19">       *aTooBig = PR_TRUE;</span>
<a href="#l17.20"></a><span id="l17.20">     }</span>
<a href="#l17.21"></a><span id="l17.21">   }</span>
<a href="#l17.22"></a><span id="l17.22">   else</span>
<a href="#l17.23"></a><span id="l17.23">   {</span>
<a href="#l17.24"></a><span id="l17.24">       // We are failing to obtain the size in the first place!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxProtocol.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxProtocol.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -102,18 +102,18 @@ nsresult nsMailboxProtocol::OpenMultiple</span>
<a href="#l18.4"></a><span id="l18.4"> {</span>
<a href="#l18.5"></a><span id="l18.5">   nsresult rv;</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">   nsCOMPtr&lt;nsIStreamTransportService&gt; serv =</span>
<a href="#l18.8"></a><span id="l18.8">       do_GetService(NS_STREAMTRANSPORTSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l18.9"></a><span id="l18.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">   // XXX 64-bit</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  rv = serv-&gt;CreateInputTransport(m_multipleMsgMoveCopyStream, nsInt64(offset),</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                                  nsInt64(size), PR_FALSE,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+  rv = serv-&gt;CreateInputTransport(m_multipleMsgMoveCopyStream, PRInt64(offset),</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+                                  PRInt64(size), PR_FALSE,</span>
<a href="#l18.16"></a><span id="l18.16">                                   getter_AddRefs(m_transport));</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">   return rv;</span>
<a href="#l18.19"></a><span id="l18.19"> }</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21"> nsresult nsMailboxProtocol::OpenFileSocketForReuse(nsIURI * aURL, PRUint32 aStartPosition, PRInt32 aReadCount)</span>
<a href="#l18.22"></a><span id="l18.22"> {</span>
<a href="#l18.23"></a><span id="l18.23">   NS_ENSURE_ARG_POINTER(aURL);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -113,18 +113,17 @@ NS_IMETHODIMP nsMsgMailboxParser::OnData</span>
<a href="#l19.4"></a><span id="l19.4">     nsCOMPtr&lt;nsIURI&gt; url = do_QueryInterface(ctxt, &amp;rv);</span>
<a href="#l19.5"></a><span id="l19.5">     if (NS_SUCCEEDED(rv))</span>
<a href="#l19.6"></a><span id="l19.6">         rv = ProcessMailboxInputStream(url, aIStream, aLength);</span>
<a href="#l19.7"></a><span id="l19.7">     return rv;</span>
<a href="#l19.8"></a><span id="l19.8"> }</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10"> NS_IMETHODIMP nsMsgMailboxParser::OnStartRequest(nsIRequest *request, nsISupports *ctxt)</span>
<a href="#l19.11"></a><span id="l19.11"> {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    nsTime currentTime;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-    m_startTime = currentTime;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+    m_startTime = PR_Now();</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17">     // extract the appropriate event sinks from the url and initialize them in our protocol data</span>
<a href="#l19.18"></a><span id="l19.18">     // the URL should be queried for a nsIMailboxURL. If it doesn't support a mailbox URL interface then</span>
<a href="#l19.19"></a><span id="l19.19">     // we have an error.</span>
<a href="#l19.20"></a><span id="l19.20">     nsresult rv = NS_OK;</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">     nsCOMPtr&lt;nsIIOService&gt; ioServ(do_GetService(NS_IOSERVICE_CONTRACTID, &amp;rv));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.h</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.h</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -44,17 +44,16 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;nsMsgLineBuffer.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-#include &quot;nsTime.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13"> #include &quot;nsIDBChangeListener.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14"> #include &quot;nsIWeakReference.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> #include &quot;nsIWeakReferenceUtils.h&quot;</span>
<a href="#l20.16"></a><span id="l20.16"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l20.17"></a><span id="l20.17"> #include &quot;nsImapMoveCoalescer.h&quot;</span>
<a href="#l20.18"></a><span id="l20.18"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -214,17 +213,17 @@ protected:</span>
<a href="#l20.22"></a><span id="l20.22">   nsString        m_folderName;</span>
<a href="#l20.23"></a><span id="l20.23">   nsCString       m_inboxUri;</span>
<a href="#l20.24"></a><span id="l20.24">   nsByteArray     m_inputStream;</span>
<a href="#l20.25"></a><span id="l20.25">   PRInt32         m_obuffer_size;</span>
<a href="#l20.26"></a><span id="l20.26">   char            *m_obuffer;</span>
<a href="#l20.27"></a><span id="l20.27">   PRUint32        m_graph_progress_total;</span>
<a href="#l20.28"></a><span id="l20.28">   PRUint32        m_graph_progress_received;</span>
<a href="#l20.29"></a><span id="l20.29">   PRBool          m_parsingDone;</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-  nsTime          m_startTime;</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+  PRTime          m_startTime;</span>
<a href="#l20.32"></a><span id="l20.32"> private:</span>
<a href="#l20.33"></a><span id="l20.33">   // the following flag is used to determine when a url is currently being run. It is cleared on calls</span>
<a href="#l20.34"></a><span id="l20.34">   // to ::StopBinding and it is set whenever we call Load on a url</span>
<a href="#l20.35"></a><span id="l20.35">   PRBool    m_urlInProgress;</span>
<a href="#l20.36"></a><span id="l20.36">   nsWeakPtr m_folder;</span>
<a href="#l20.37"></a><span id="l20.37">   void Init();</span>
<a href="#l20.38"></a><span id="l20.38">   void ReleaseFolderLock();</span>
<a href="#l20.39"></a><span id="l20.39"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -689,17 +689,17 @@ void nsPop3Protocol::UpdateStatusWithStr</span>
<a href="#l21.4"></a><span id="l21.4">         NS_ASSERTION(NS_SUCCEEDED(rv), &quot;dropping error result&quot;);</span>
<a href="#l21.5"></a><span id="l21.5">     }</span>
<a href="#l21.6"></a><span id="l21.6"> }</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> void nsPop3Protocol::UpdateProgressPercent (PRUint32 totalDone, PRUint32 total)</span>
<a href="#l21.9"></a><span id="l21.9"> {</span>
<a href="#l21.10"></a><span id="l21.10">   // XXX 64-bit</span>
<a href="#l21.11"></a><span id="l21.11">   if (mProgressEventSink)</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    mProgressEventSink-&gt;OnProgress(this, m_channelContext, nsUint64(totalDone), nsUint64(total));</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+    mProgressEventSink-&gt;OnProgress(this, m_channelContext, PRUint64(totalDone), PRUint64(total));</span>
<a href="#l21.14"></a><span id="l21.14"> }</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16"> // note:  SetUsername() expects an unescaped string</span>
<a href="#l21.17"></a><span id="l21.17"> // do not pass in an escaped string</span>
<a href="#l21.18"></a><span id="l21.18"> void nsPop3Protocol::SetUsername(const char* name)</span>
<a href="#l21.19"></a><span id="l21.19"> {</span>
<a href="#l21.20"></a><span id="l21.20">   NS_ASSERTION(name, &quot;no name specified!&quot;);</span>
<a href="#l21.21"></a><span id="l21.21">     if (name)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -56,17 +56,16 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l22.5"></a><span id="l22.5"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;prprf.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsLocalMailFolder.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsIMailboxUrl.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l22.14"></a><span id="l22.14"> #include &quot;nsLocalStrings.h&quot;</span>
<a href="#l22.15"></a><span id="l22.15"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l22.16"></a><span id="l22.16"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l22.17"></a><span id="l22.17"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19"> #define PREF_MAIL_ROOT_POP3 &quot;mail.root.pop3&quot;        // old - for backward compatibility only</span>
<a href="#l22.20"></a><span id="l22.20"> #define PREF_MAIL_ROOT_POP3_REL &quot;mail.root.pop3-rel&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -5140,18 +5140,18 @@ nsresult nsNNTPProtocol::CloseSocket()</span>
<a href="#l23.4"></a><span id="l23.4">   CleanupAfterRunningUrl(); // is this needed?</span>
<a href="#l23.5"></a><span id="l23.5">   return nsMsgProtocol::CloseSocket();</span>
<a href="#l23.6"></a><span id="l23.6"> }</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> void nsNNTPProtocol::SetProgressBarPercent(PRUint32 aProgress, PRUint32 aProgressMax)</span>
<a href="#l23.9"></a><span id="l23.9"> {</span>
<a href="#l23.10"></a><span id="l23.10">   // XXX 64-bit</span>
<a href="#l23.11"></a><span id="l23.11">   if (mProgressEventSink)</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    mProgressEventSink-&gt;OnProgress(this, m_channelContext, nsUint64(aProgress),</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-                                   nsUint64(aProgressMax));</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+    mProgressEventSink-&gt;OnProgress(this, m_channelContext, PRUint64(aProgress),</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+                                   PRUint64(aProgressMax));</span>
<a href="#l23.16"></a><span id="l23.16"> }</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18"> nsresult</span>
<a href="#l23.19"></a><span id="l23.19"> nsNNTPProtocol::SetProgressStatus(const PRUnichar *aMessage)</span>
<a href="#l23.20"></a><span id="l23.20"> {</span>
<a href="#l23.21"></a><span id="l23.21">   nsresult rv = NS_OK;</span>
<a href="#l23.22"></a><span id="l23.22">   if (mProgressEventSink)</span>
<a href="#l23.23"></a><span id="l23.23">     rv = mProgressEventSink-&gt;OnStatus(this, m_channelContext, NS_OK, aMessage);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -46,17 +46,16 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;nsINntpService.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &quot;nsINNTPProtocol.h&quot;</span>
<a href="#l24.8"></a><span id="l24.8"> #include &quot;nsMsgNewsCID.h&quot;</span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;nsNNTPProtocol.h&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-#include &quot;nsInt64.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l24.14"></a><span id="l24.14"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l24.15"></a><span id="l24.15"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l24.16"></a><span id="l24.16"> #include &quot;nntpCore.h&quot;</span>
<a href="#l24.17"></a><span id="l24.17"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l24.18"></a><span id="l24.18"> #include &quot;nsITreeColumns.h&quot;</span>
<a href="#l24.19"></a><span id="l24.19"> #include &quot;nsIDOMElement.h&quot;</span>
<a href="#l24.20"></a><span id="l24.20"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineat">@@ -275,17 +274,17 @@ nsNntpIncomingServer::GetNewsrcRootPath(</span>
<a href="#l24.22"></a><span id="l24.22"> /* static */ void nsNntpIncomingServer::OnNewsrcSaveTimer(nsITimer *timer, void *voidIncomingServer)</span>
<a href="#l24.23"></a><span id="l24.23"> {</span>
<a href="#l24.24"></a><span id="l24.24">   nsNntpIncomingServer *incomingServer = (nsNntpIncomingServer*)voidIncomingServer;</span>
<a href="#l24.25"></a><span id="l24.25">   incomingServer-&gt;WriteNewsrcFile();</span>
<a href="#l24.26"></a><span id="l24.26"> }</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28"> nsresult nsNntpIncomingServer::SetupNewsrcSaveTimer()</span>
<a href="#l24.29"></a><span id="l24.29"> {</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-  nsInt64 ms(300000);   // hard code, 5 minutes.</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+  PRInt64 ms(300000);   // hard code, 5 minutes.</span>
<a href="#l24.32"></a><span id="l24.32">   //Convert biffDelay into milliseconds</span>
<a href="#l24.33"></a><span id="l24.33">   PRUint32 timeInMSUint32 = (PRUint32)ms;</span>
<a href="#l24.34"></a><span id="l24.34">   //Can't currently reset a timer when it's in the process of</span>
<a href="#l24.35"></a><span id="l24.35">   //calling Notify. So, just release the timer here and create a new one.</span>
<a href="#l24.36"></a><span id="l24.36">   if(mNewsrcSaveTimer)</span>
<a href="#l24.37"></a><span id="l24.37">     mNewsrcSaveTimer-&gt;Cancel();</span>
<a href="#l24.38"></a><span id="l24.38">   mNewsrcSaveTimer = do_CreateInstance(&quot;@mozilla.org/timer;1&quot;);</span>
<a href="#l24.39"></a><span id="l24.39">   mNewsrcSaveTimer-&gt;InitWithFuncCallback(OnNewsrcSaveTimer, (void*)this, timeInMSUint32,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

