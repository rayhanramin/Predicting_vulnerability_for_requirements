<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11150:7b18f78f1ad9e2815583531bb1a913945654b877</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 7b18f78f1ad9e2815583531bb1a913945654b877" />
<meta property="og:url" content="/comm-central/rev/7b18f78f1ad9e2815583531bb1a913945654b877" />
<meta property="og:description" content="Bug 794628 - Console is flooded and trashed with calFilterProperties debug messages r=mmecca" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 7b18f78f1ad9e2815583531bb1a913945654b877 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/7b18f78f1ad9e2815583531bb1a913945654b877">shortlog</a> |
<a href="/comm-central/log/7b18f78f1ad9e2815583531bb1a913945654b877">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/7b18f78f1ad9e2815583531bb1a913945654b877">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/7b18f78f1ad9e2815583531bb1a913945654b877">files</a> |
changeset |
<a href="/comm-central/raw-rev/7b18f78f1ad9e2815583531bb1a913945654b877">raw</a>  | <a href="/comm-central/archive/7b18f78f1ad9e2815583531bb1a913945654b877.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=794628">Bug 794628</a> - Console is flooded and trashed with calFilterProperties debug messages r=mmecca
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#116;&#101;&#102;&#97;&#110;&#32;&#83;&#105;&#116;&#116;&#101;&#114;&#32;&#60;&#115;&#115;&#105;&#116;&#116;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 28 Sep 2012 14:44:46 +0200</td></tr>

<tr>
 <td>changeset 11150</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/7b18f78f1ad9e2815583531bb1a913945654b877">7b18f78f1ad9e2815583531bb1a913945654b877</a></td>
</tr>



<tr>
<td>parent 11149</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/811000b2e134b888c5bc908247d8ec152a0a56c4">811000b2e134b888c5bc908247d8ec152a0a56c4</a>
</td>
</tr>

<tr>
<td>child 11151</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/82d5e37e3a60821cdb98a67c268bbff79460c1ae">82d5e37e3a60821cdb98a67c268bbff79460c1ae</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=7b18f78f1ad9e2815583531bb1a913945654b877">8364</a></td></tr>
<tr><td>push user</td><td>ssitter@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 28 Sep 2012 12:44:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@7b18f78f1ad9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7b18f78f1ad9e2815583531bb1a913945654b877">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7b18f78f1ad9e2815583531bb1a913945654b877&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7b18f78f1ad9e2815583531bb1a913945654b877&newProject=comm-central&newRevision=7b18f78f1ad9e2815583531bb1a913945654b877&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7b18f78f1ad9e2815583531bb1a913945654b877&newProject=comm-central&newRevision=7b18f78f1ad9e2815583531bb1a913945654b877&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7b18f78f1ad9e2815583531bb1a913945654b877&newProject=comm-central&newRevision=7b18f78f1ad9e2815583531bb1a913945654b877&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mmecca%29&revcount=50">mmecca</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=794628">794628</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=794628">Bug 794628</a> - Console is flooded and trashed with calFilterProperties debug messages r=mmecca</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b18f78f1ad9e2815583531bb1a913945654b877/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b18f78f1ad9e2815583531bb1a913945654b877/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/7b18f78f1ad9e2815583531bb1a913945654b877/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/7b18f78f1ad9e2815583531bb1a913945654b877/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/7b18f78f1ad9e2815583531bb1a913945654b877/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/7b18f78f1ad9e2815583531bb1a913945654b877/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,86 +1,86 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> /**</span>
<a href="#l1.9"></a><span id="l1.9">  * Object that contains a set of filter properties that may be used by a calFilter object</span>
<a href="#l1.10"></a><span id="l1.10">  * to filter a set of items.</span>
<a href="#l1.11"></a><span id="l1.11">  * Supported filter properties:</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">- *   start, end:   Specifies the relative date range to use when calculating the filter date </span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+ *   start, end:   Specifies the relative date range to use when calculating the filter date</span>
<a href="#l1.14"></a><span id="l1.14">  *               range. The relative date range may relative to the current date and time, the</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">- *               currently selected date, or the dates range of the current view. The actual </span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">- *               date range used to filter items will be calculated by the calFilter object </span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">- *               by using the updateFilterDates function, which may be called multiple times </span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+ *               currently selected date, or the dates range of the current view. The actual</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+ *               date range used to filter items will be calculated by the calFilter object</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+ *               by using the updateFilterDates function, which may be called multiple times</span>
<a href="#l1.21"></a><span id="l1.21">  *               to reflect changes in the current date and time, and changes to the view.</span>
<a href="#l1.22"></a><span id="l1.22">  *</span>
<a href="#l1.23"></a><span id="l1.23">  *</span>
<a href="#l1.24"></a><span id="l1.24">  *                 The properties may be set to one of the folowing values:</span>
<a href="#l1.25"></a><span id="l1.25">  *               - FILTER_DATE_ALL: An unbound date range.</span>
<a href="#l1.26"></a><span id="l1.26">  *               - FILTER_DATE_XXX: One of the defined relative date ranges.</span>
<a href="#l1.27"></a><span id="l1.27">  *               - A string that may be converted to a calIDuration object that will be used</span>
<a href="#l1.28"></a><span id="l1.28">  *                 as an offset to the current date and time.</span>
<a href="#l1.29"></a><span id="l1.29">  *</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">- *                 The start and end properties may have values representing different relative </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+ *                 The start and end properties may have values representing different relative</span>
<a href="#l1.32"></a><span id="l1.32">  *               date ranges, in which case the filter start date will be calculated as the start</span>
<a href="#l1.33"></a><span id="l1.33">  *               of the relative range specified by the start property, while the filter end date</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">- *               will be calculated as the end of the relative range specified by the end </span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+ *               will be calculated as the end of the relative range specified by the end</span>
<a href="#l1.36"></a><span id="l1.36">  *               property.</span>
<a href="#l1.37"></a><span id="l1.37">  *</span>
<a href="#l1.38"></a><span id="l1.38">  *   due:          Specifies the filter property for the due date of tasks. This filter has no</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">- *               effect when filtering events. </span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+ *               effect when filtering events.</span>
<a href="#l1.41"></a><span id="l1.41">  *</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">- *                 The property has a bit field value, with the FILTER_DUE_XXX bit flags set </span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+ *                 The property has a bit field value, with the FILTER_DUE_XXX bit flags set</span>
<a href="#l1.44"></a><span id="l1.44">  *               to indicate that tasks with the corresponding due property value should match</span>
<a href="#l1.45"></a><span id="l1.45">  *               the filter.</span>
<a href="#l1.46"></a><span id="l1.46">  *</span>
<a href="#l1.47"></a><span id="l1.47">  *                 If the value is set to null the due date will not be considered when filtering.</span>
<a href="#l1.48"></a><span id="l1.48">  *</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">- *   status:       Specifies the filter property for the status of tasks. This filter has no </span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+ *   status:       Specifies the filter property for the status of tasks. This filter has no</span>
<a href="#l1.51"></a><span id="l1.51">  *               effect when filtering events.</span>
<a href="#l1.52"></a><span id="l1.52">  *</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">- *                 The property has a bit field value, with the FILTER_STATUS_XXX bit flags set </span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+ *                 The property has a bit field value, with the FILTER_STATUS_XXX bit flags set</span>
<a href="#l1.55"></a><span id="l1.55">  *               to indicate that tasks with the corresponding status property value should match</span>
<a href="#l1.56"></a><span id="l1.56">  *               the filter.</span>
<a href="#l1.57"></a><span id="l1.57">  *</span>
<a href="#l1.58"></a><span id="l1.58">  *                 If the value is set to null the status will not be considered when filtering.</span>
<a href="#l1.59"></a><span id="l1.59">  *</span>
<a href="#l1.60"></a><span id="l1.60">  *   category:     Specifies the filter property for the item category.</span>
<a href="#l1.61"></a><span id="l1.61">  *</span>
<a href="#l1.62"></a><span id="l1.62">  *                 The property may be set to one of the folowing values:</span>
<a href="#l1.63"></a><span id="l1.63">  *               - null: The item category will not be considered when filtering.</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">- *               - A string: The item will match the filter if any of it's categories match the </span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+ *               - A string: The item will match the filter if any of it's categories match the</span>
<a href="#l1.66"></a><span id="l1.66">  *               category specified by the property.</span>
<a href="#l1.67"></a><span id="l1.67">  *               - An array: The item will match the filter if any of it's categories match any</span>
<a href="#l1.68"></a><span id="l1.68">  *               of the categories contained in the Array specified by the property.</span>
<a href="#l1.69"></a><span id="l1.69">  *</span>
<a href="#l1.70"></a><span id="l1.70">  *   occurrences:  Specifies the filter property for returning occurrences of repeating items.</span>
<a href="#l1.71"></a><span id="l1.71">  *</span>
<a href="#l1.72"></a><span id="l1.72">  *                 The property may be set to one of the folowing values:</span>
<a href="#l1.73"></a><span id="l1.73">  *               - null, FILTER_OCCURRENCES_BOUND: The default occurrence handling. Occurrences</span>
<a href="#l1.74"></a><span id="l1.74">  *               will be returned only for date ranges with a bound end date.</span>
<a href="#l1.75"></a><span id="l1.75">  *               - FILTER_OCCURRENCES_NONE: Only the parent items will be returned.</span>
<a href="#l1.76"></a><span id="l1.76">  *               - FILTER_OCCURRENCES_PAST_AND_NEXT: Returns past occurrences and the next future</span>
<a href="#l1.77"></a><span id="l1.77">  *               matching occurrence if one is found.</span>
<a href="#l1.78"></a><span id="l1.78">  *</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">- *   onfilter:     A callback function that may be used to apply additional custom filter </span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+ *   onfilter:     A callback function that may be used to apply additional custom filter</span>
<a href="#l1.81"></a><span id="l1.81">  *               constraints. If specified, the callback function will be called after any other</span>
<a href="#l1.82"></a><span id="l1.82">  *               specified filter properties are tested.</span>
<a href="#l1.83"></a><span id="l1.83">  *</span>
<a href="#l1.84"></a><span id="l1.84">  *                 The callback function will be called with the following parameters:</span>
<a href="#l1.85"></a><span id="l1.85">  *               - function(aItem, aResults, aFilterProperties, aFilter)</span>
<a href="#l1.86"></a><span id="l1.86">  *                   @param aItem               The item being tested.</span>
<a href="#l1.87"></a><span id="l1.87">  *                   @param aResults            The results of the test of the other specified</span>
<a href="#l1.88"></a><span id="l1.88">  *                                              filter properties.</span>
<a href="#l1.89"></a><span id="l1.89">  *                   @param aFilterProperties   The current filter properties being tested.</span>
<a href="#l1.90"></a><span id="l1.90">  *                   @param aFilter             The calFilter object performing the filter test.</span>
<a href="#l1.91"></a><span id="l1.91">  *</span>
<a href="#l1.92"></a><span id="l1.92">  *                 If specified, the callback function is responsible for returning a value that</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">- *               can be converted to true if the item should match the filter, or a value that </span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+ *               can be converted to true if the item should match the filter, or a value that</span>
<a href="#l1.95"></a><span id="l1.95">  *               can be converted to false otherwise. The return value will override the results</span>
<a href="#l1.96"></a><span id="l1.96">  *               of the testing of any other specified filter properties.</span>
<a href="#l1.97"></a><span id="l1.97">  */</span>
<a href="#l1.98"></a><span id="l1.98"> function calFilterProperties() {</span>
<a href="#l1.99"></a><span id="l1.99">     this.wrappedJSObject = this;</span>
<a href="#l1.100"></a><span id="l1.100"> }</span>
<a href="#l1.101"></a><span id="l1.101"> </span>
<a href="#l1.102"></a><span id="l1.102"> calFilterProperties.prototype = {</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineat">@@ -113,17 +113,17 @@ calFilterProperties.prototype = {</span>
<a href="#l1.104"></a><span id="l1.104">     start: null,</span>
<a href="#l1.105"></a><span id="l1.105">     end: null,</span>
<a href="#l1.106"></a><span id="l1.106">     due: null,</span>
<a href="#l1.107"></a><span id="l1.107">     status: null,</span>
<a href="#l1.108"></a><span id="l1.108">     category: null,</span>
<a href="#l1.109"></a><span id="l1.109">     occurrences: null,</span>
<a href="#l1.110"></a><span id="l1.110"> </span>
<a href="#l1.111"></a><span id="l1.111">     onfilter: null,</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-    </span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+</span>
<a href="#l1.114"></a><span id="l1.114">     equals: function cFP_equals(aFilterProps) {</span>
<a href="#l1.115"></a><span id="l1.115">         if (!(aFilterProps instanceof calFilterProperties)) {</span>
<a href="#l1.116"></a><span id="l1.116">             return false;</span>
<a href="#l1.117"></a><span id="l1.117">         }</span>
<a href="#l1.118"></a><span id="l1.118">         let props = [&quot;start&quot;, &quot;end&quot;, &quot;due&quot;, &quot;status&quot;, &quot;category&quot;, &quot;occurrences&quot;, &quot;onfilter&quot;];</span>
<a href="#l1.119"></a><span id="l1.119">         return props.every(function(prop) {</span>
<a href="#l1.120"></a><span id="l1.120">             return (this[prop] == aFilterProps[prop]);</span>
<a href="#l1.121"></a><span id="l1.121">         }, this);</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineat">@@ -137,27 +137,27 @@ calFilterProperties.prototype = {</span>
<a href="#l1.123"></a><span id="l1.123">         }, this);</span>
<a href="#l1.124"></a><span id="l1.124"> </span>
<a href="#l1.125"></a><span id="l1.125">         return cl;</span>
<a href="#l1.126"></a><span id="l1.126">     },</span>
<a href="#l1.127"></a><span id="l1.127"> </span>
<a href="#l1.128"></a><span id="l1.128">     LOG: function cFP_LOG(aString) {</span>
<a href="#l1.129"></a><span id="l1.129">         cal.LOG(&quot;[calFilterProperties] &quot; +</span>
<a href="#l1.130"></a><span id="l1.130">                 (aString || &quot;&quot;) +</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-                &quot;\n  start: &quot; + this.start +</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-                &quot;\n  end: &quot; + this.end +</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-                &quot;\n  status: &quot; + this.status +</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-                &quot;\n  due: &quot; + this.due +</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-                &quot;\n  category: &quot; + this.category);</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+                &quot; start=&quot; + this.start +</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+                &quot; end=&quot; + this.end +</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+                &quot; status=&quot; + this.status +</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+                &quot; due=&quot; + this.due +</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+                &quot; category=&quot; + this.category);</span>
<a href="#l1.141"></a><span id="l1.141">     }</span>
<a href="#l1.142"></a><span id="l1.142"> };</span>
<a href="#l1.143"></a><span id="l1.143"> </span>
<a href="#l1.144"></a><span id="l1.144"> /**</span>
<a href="#l1.145"></a><span id="l1.145">  * Object that allows filtering of a set of items using a set of filter properties. A set</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">- * of property filters may be defined by a filter name, which may then be used to apply </span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+ * of property filters may be defined by a filter name, which may then be used to apply</span>
<a href="#l1.148"></a><span id="l1.148">  * the defined filter properties. A set of commonly used property filters are predefined.</span>
<a href="#l1.149"></a><span id="l1.149">  */</span>
<a href="#l1.150"></a><span id="l1.150"> function calFilter() {</span>
<a href="#l1.151"></a><span id="l1.151">     this.wrappedJSObject = this;</span>
<a href="#l1.152"></a><span id="l1.152">     this.mFilterProperties = new calFilterProperties();</span>
<a href="#l1.153"></a><span id="l1.153">     this.initDefinedFilters();</span>
<a href="#l1.154"></a><span id="l1.154">     this.mMaxIterations = cal.getPrefSafe(&quot;calendar.filter.maxiterations&quot;, 50);</span>
<a href="#l1.155"></a><span id="l1.155"> }</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineat">@@ -172,31 +172,31 @@ calFilter.prototype = {</span>
<a href="#l1.157"></a><span id="l1.157">     mToday: null,</span>
<a href="#l1.158"></a><span id="l1.158">     mTomorrow: null,</span>
<a href="#l1.159"></a><span id="l1.159">     mMaxIterations: 50,</span>
<a href="#l1.160"></a><span id="l1.160"> </span>
<a href="#l1.161"></a><span id="l1.161">     /**</span>
<a href="#l1.162"></a><span id="l1.162">      * Initializes the predefined filters.</span>
<a href="#l1.163"></a><span id="l1.163">      */</span>
<a href="#l1.164"></a><span id="l1.164">     initDefinedFilters: function cF_initDefinedFilters() {</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-        let filters = [&quot;all&quot;, &quot;notstarted&quot;, &quot;overdue&quot;, &quot;open&quot;, &quot;completed&quot;, &quot;throughcurrent&quot;, </span>
<a href="#l1.166"></a><span id="l1.166" class="difflineminus">-                       &quot;throughtoday&quot;, &quot;throughsevendays&quot;, &quot;today&quot;, &quot;thisCalendarMonth&quot;, </span>
<a href="#l1.167"></a><span id="l1.167" class="difflineplus">+        let filters = [&quot;all&quot;, &quot;notstarted&quot;, &quot;overdue&quot;, &quot;open&quot;, &quot;completed&quot;, &quot;throughcurrent&quot;,</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+                       &quot;throughtoday&quot;, &quot;throughsevendays&quot;, &quot;today&quot;, &quot;thisCalendarMonth&quot;,</span>
<a href="#l1.169"></a><span id="l1.169">                        &quot;future&quot;, &quot;current&quot;, &quot;currentview&quot;];</span>
<a href="#l1.170"></a><span id="l1.170">         filters.forEach(function(filter) {</span>
<a href="#l1.171"></a><span id="l1.171">             if (!(filter in this.mDefinedFilters)) {</span>
<a href="#l1.172"></a><span id="l1.172">                 this.defineFilter(filter, this.getPreDefinedFilterProperties(filter));</span>
<a href="#l1.173"></a><span id="l1.173">             }</span>
<a href="#l1.174"></a><span id="l1.174">         }, this);</span>
<a href="#l1.175"></a><span id="l1.175">     },</span>
<a href="#l1.176"></a><span id="l1.176"> </span>
<a href="#l1.177"></a><span id="l1.177">     /**</span>
<a href="#l1.178"></a><span id="l1.178">      * Gets the filter properties for a predefined filter.</span>
<a href="#l1.179"></a><span id="l1.179">      *</span>
<a href="#l1.180"></a><span id="l1.180">      * @param aFilter   The name of the filter to retrieve the filter properties for.</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineminus">-     * @result          The filter properties for the specified filter, or null if the filter </span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+     * @result          The filter properties for the specified filter, or null if the filter</span>
<a href="#l1.183"></a><span id="l1.183">      *                  not predefined.</span>
<a href="#l1.184"></a><span id="l1.184">      */</span>
<a href="#l1.185"></a><span id="l1.185">     getPreDefinedFilterProperties: function cF_getPreDefinedFilterProperties(aFilter) {</span>
<a href="#l1.186"></a><span id="l1.186">         let props = new calFilterProperties();</span>
<a href="#l1.187"></a><span id="l1.187"> </span>
<a href="#l1.188"></a><span id="l1.188">         if (!aFilter) {</span>
<a href="#l1.189"></a><span id="l1.189">             return props;</span>
<a href="#l1.190"></a><span id="l1.190">         }</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineat">@@ -225,31 +225,31 @@ calFilter.prototype = {</span>
<a href="#l1.192"></a><span id="l1.192">                 break;</span>
<a href="#l1.193"></a><span id="l1.193">             case &quot;completed&quot;:</span>
<a href="#l1.194"></a><span id="l1.194">                 props.status = props.FILTER_STATUS_COMPLETED_TODAY | props.FILTER_STATUS_COMPLETED_BEFORE;</span>
<a href="#l1.195"></a><span id="l1.195">                 props.due = props.FILTER_DUE_ALL;</span>
<a href="#l1.196"></a><span id="l1.196">                 props.start = props.FILTER_DATE_ALL;</span>
<a href="#l1.197"></a><span id="l1.197">                 props.end = props.FILTER_DATE_SELECTED_OR_NOW;</span>
<a href="#l1.198"></a><span id="l1.198">                 break;</span>
<a href="#l1.199"></a><span id="l1.199">             case &quot;throughcurrent&quot;:</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineminus">-                props.status = props.FILTER_STATUS_INCOMPLETE | props.FILTER_STATUS_IN_PROGRESS | </span>
<a href="#l1.201"></a><span id="l1.201" class="difflineplus">+                props.status = props.FILTER_STATUS_INCOMPLETE | props.FILTER_STATUS_IN_PROGRESS |</span>
<a href="#l1.202"></a><span id="l1.202">                                props.FILTER_STATUS_COMPLETED_TODAY;</span>
<a href="#l1.203"></a><span id="l1.203">                 props.due = props.FILTER_DUE_ALL;</span>
<a href="#l1.204"></a><span id="l1.204">                 props.start = props.FILTER_DATE_ALL;</span>
<a href="#l1.205"></a><span id="l1.205">                 props.end = props.FILTER_DATE_SELECTED_OR_NOW;</span>
<a href="#l1.206"></a><span id="l1.206">                 break;</span>
<a href="#l1.207"></a><span id="l1.207">             case &quot;throughtoday&quot;:</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineminus">-                props.status = props.FILTER_STATUS_INCOMPLETE | props.FILTER_STATUS_IN_PROGRESS | </span>
<a href="#l1.209"></a><span id="l1.209" class="difflineplus">+                props.status = props.FILTER_STATUS_INCOMPLETE | props.FILTER_STATUS_IN_PROGRESS |</span>
<a href="#l1.210"></a><span id="l1.210">                                props.FILTER_STATUS_COMPLETED_TODAY;</span>
<a href="#l1.211"></a><span id="l1.211">                 props.due = props.FILTER_DUE_ALL;</span>
<a href="#l1.212"></a><span id="l1.212">                 props.start = props.FILTER_DATE_ALL;</span>
<a href="#l1.213"></a><span id="l1.213">                 props.end = props.FILTER_DATE_TODAY;</span>
<a href="#l1.214"></a><span id="l1.214">                 break;</span>
<a href="#l1.215"></a><span id="l1.215">             case &quot;throughsevendays&quot;:</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineminus">-                props.status = props.FILTER_STATUS_INCOMPLETE | props.FILTER_STATUS_IN_PROGRESS | </span>
<a href="#l1.217"></a><span id="l1.217" class="difflineplus">+                props.status = props.FILTER_STATUS_INCOMPLETE | props.FILTER_STATUS_IN_PROGRESS |</span>
<a href="#l1.218"></a><span id="l1.218">                                props.FILTER_STATUS_COMPLETED_TODAY;</span>
<a href="#l1.219"></a><span id="l1.219">                 props.due = props.FILTER_DUE_ALL;</span>
<a href="#l1.220"></a><span id="l1.220">                 props.start = props.FILTER_DATE_ALL;</span>
<a href="#l1.221"></a><span id="l1.221">                 props.end = &quot;P7D&quot;;</span>
<a href="#l1.222"></a><span id="l1.222">                 break;</span>
<a href="#l1.223"></a><span id="l1.223"> </span>
<a href="#l1.224"></a><span id="l1.224">             // Predefined Event filters</span>
<a href="#l1.225"></a><span id="l1.225">             case &quot;today&quot;:</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineat">@@ -281,17 +281,17 @@ calFilter.prototype = {</span>
<a href="#l1.227"></a><span id="l1.227">                 props.end = props.FILTER_DATE_ALL;</span>
<a href="#l1.228"></a><span id="l1.228">         }</span>
<a href="#l1.229"></a><span id="l1.229"> </span>
<a href="#l1.230"></a><span id="l1.230">         return props;</span>
<a href="#l1.231"></a><span id="l1.231">     },</span>
<a href="#l1.232"></a><span id="l1.232"> </span>
<a href="#l1.233"></a><span id="l1.233">     /**</span>
<a href="#l1.234"></a><span id="l1.234">      * Defines a set of filter properties so that they may be applied by the filter name. If</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineminus">-     * the specified filter name is already defined, it's associated filter properties will be </span>
<a href="#l1.236"></a><span id="l1.236" class="difflineplus">+     * the specified filter name is already defined, it's associated filter properties will be</span>
<a href="#l1.237"></a><span id="l1.237">      * replaced.</span>
<a href="#l1.238"></a><span id="l1.238">      *</span>
<a href="#l1.239"></a><span id="l1.239">      * @param aFilterName         The name to define the filter properties as.</span>
<a href="#l1.240"></a><span id="l1.240">      * @param aFilterProperties   The filter properties to define.</span>
<a href="#l1.241"></a><span id="l1.241">      */</span>
<a href="#l1.242"></a><span id="l1.242">     defineFilter: function cF_defineFilter(aFilterName, aFilterProperties) {</span>
<a href="#l1.243"></a><span id="l1.243">         if (!(aFilterProperties instanceof calFilterProperties)) {</span>
<a href="#l1.244"></a><span id="l1.244">             return;</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineat">@@ -314,17 +314,17 @@ calFilter.prototype = {</span>
<a href="#l1.246"></a><span id="l1.246">             return null;</span>
<a href="#l1.247"></a><span id="l1.247">         }</span>
<a href="#l1.248"></a><span id="l1.248">     },</span>
<a href="#l1.249"></a><span id="l1.249"> </span>
<a href="#l1.250"></a><span id="l1.250">     /**</span>
<a href="#l1.251"></a><span id="l1.251">      * Returns the filter name that a set of filter properties were previously defined as.</span>
<a href="#l1.252"></a><span id="l1.252">      *</span>
<a href="#l1.253"></a><span id="l1.253">      * @param aFilterProperties   The filter properties previously defined.</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineminus">-     * @return                    The name of the first filter name that the properties </span>
<a href="#l1.255"></a><span id="l1.255" class="difflineplus">+     * @return                    The name of the first filter name that the properties</span>
<a href="#l1.256"></a><span id="l1.256">      *                            were defined as, or null if the filter properties were</span>
<a href="#l1.257"></a><span id="l1.257">      *                            not previously defined.</span>
<a href="#l1.258"></a><span id="l1.258">      */</span>
<a href="#l1.259"></a><span id="l1.259">     getDefinedFilterName: function cF_getDefinedFilterName(aFilterProperties) {</span>
<a href="#l1.260"></a><span id="l1.260">         for (filter in this.mDefinedFilters) {</span>
<a href="#l1.261"></a><span id="l1.261">             if (this.mDefinedFilters[filter].equals(aFilterProperties)) {</span>
<a href="#l1.262"></a><span id="l1.262">                 return filter;</span>
<a href="#l1.263"></a><span id="l1.263">             }</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineat">@@ -447,32 +447,32 @@ calFilter.prototype = {</span>
<a href="#l1.265"></a><span id="l1.265">                      ((props.due &amp; props.FILTER_DUE_TODAY) ||</span>
<a href="#l1.266"></a><span id="l1.266">                       !(due &amp;&amp; (due.compare(now) &gt;= 0) &amp;&amp; (due.compare(tomorrow) &lt; 0))) &amp;&amp;</span>
<a href="#l1.267"></a><span id="l1.267">                      ((props.due &amp; props.FILTER_DUE_FUTURE) ||</span>
<a href="#l1.268"></a><span id="l1.268">                       !(due &amp;&amp; (due.compare(tomorrow) &gt;= 0))) &amp;&amp;</span>
<a href="#l1.269"></a><span id="l1.269">                      ((props.due &amp; props.FILTER_DUE_NONE) ||</span>
<a href="#l1.270"></a><span id="l1.270">                       !(due == null));</span>
<a href="#l1.271"></a><span id="l1.271">         }</span>
<a href="#l1.272"></a><span id="l1.272"> </span>
<a href="#l1.273"></a><span id="l1.273" class="difflineminus">-        // Call the filter properties onfilter callback if set. The return value of the </span>
<a href="#l1.274"></a><span id="l1.274" class="difflineplus">+        // Call the filter properties onfilter callback if set. The return value of the</span>
<a href="#l1.275"></a><span id="l1.275">         // callback function will override the result of this function.</span>
<a href="#l1.276"></a><span id="l1.276">         if (props.onfilter &amp;&amp; (typeof(props.onfilter) == &quot;function&quot;)) {</span>
<a href="#l1.277"></a><span id="l1.277">             return props.onfilter(aItem, result, props, this);</span>
<a href="#l1.278"></a><span id="l1.278">         }</span>
<a href="#l1.279"></a><span id="l1.279"> </span>
<a href="#l1.280"></a><span id="l1.280">         return result;</span>
<a href="#l1.281"></a><span id="l1.281">     },</span>
<a href="#l1.282"></a><span id="l1.282"> </span>
<a href="#l1.283"></a><span id="l1.283">     /**</span>
<a href="#l1.284"></a><span id="l1.284">      * Calculates the date from a date filter property.</span>
<a href="#l1.285"></a><span id="l1.285">      *</span>
<a href="#l1.286"></a><span id="l1.286">      * @param prop                The value of the date filter property to calculate for. May</span>
<a href="#l1.287"></a><span id="l1.287">      *                            be a constant specifying a relative date range, or a string</span>
<a href="#l1.288"></a><span id="l1.288">      *                            representing a duration offset from the current date time.</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineminus">-     * @param start               If true, the function will return the date value for the </span>
<a href="#l1.290"></a><span id="l1.290" class="difflineplus">+     * @param start               If true, the function will return the date value for the</span>
<a href="#l1.291"></a><span id="l1.291">      *                            start of the relative date range, otherwise it will return the</span>
<a href="#l1.292"></a><span id="l1.292">      *                            date value for the end of the date range.</span>
<a href="#l1.293"></a><span id="l1.293">      * @return                    The calculated date for the property.</span>
<a href="#l1.294"></a><span id="l1.294">      */</span>
<a href="#l1.295"></a><span id="l1.295">     getDateForProperty: function cF_getDateForProperty(prop, start) {</span>
<a href="#l1.296"></a><span id="l1.296">         let props = this.mFilterProperties || new calFilterProperties();</span>
<a href="#l1.297"></a><span id="l1.297">         let result = null;</span>
<a href="#l1.298"></a><span id="l1.298">         let selectedDate = this.mSelectedDate || currentView().selectedDay || cal.now();</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineat">@@ -560,17 +560,17 @@ calFilter.prototype = {</span>
<a href="#l1.300"></a><span id="l1.300">      *</span>
<a href="#l1.301"></a><span id="l1.301">      * @return:                    The start date of the current filter date range, or null if</span>
<a href="#l1.302"></a><span id="l1.302">      *                             the date range has an unbound start date.</span>
<a href="#l1.303"></a><span id="l1.303">      */</span>
<a href="#l1.304"></a><span id="l1.304">     get startDate() {</span>
<a href="#l1.305"></a><span id="l1.305">         return this.mStartDate;</span>
<a href="#l1.306"></a><span id="l1.306">     },</span>
<a href="#l1.307"></a><span id="l1.307"> </span>
<a href="#l1.308"></a><span id="l1.308" class="difflineminus">-    /** </span>
<a href="#l1.309"></a><span id="l1.309" class="difflineplus">+    /**</span>
<a href="#l1.310"></a><span id="l1.310">      * Sets the start date for the current filter date range. This will override the date range</span>
<a href="#l1.311"></a><span id="l1.311">      * calculated from the filter properties by the getDatesForFilter function.</span>
<a href="#l1.312"></a><span id="l1.312">      */</span>
<a href="#l1.313"></a><span id="l1.313">     set startDate(aStartDate) {</span>
<a href="#l1.314"></a><span id="l1.314">         return (this.mStartDate = aStartDate);</span>
<a href="#l1.315"></a><span id="l1.315">     },</span>
<a href="#l1.316"></a><span id="l1.316"> </span>
<a href="#l1.317"></a><span id="l1.317">     /**</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineat">@@ -578,17 +578,17 @@ calFilter.prototype = {</span>
<a href="#l1.319"></a><span id="l1.319">      *</span>
<a href="#l1.320"></a><span id="l1.320">      * @return:                    The end date of the current filter date range, or null if</span>
<a href="#l1.321"></a><span id="l1.321">      *                             the date range has an unbound end date.</span>
<a href="#l1.322"></a><span id="l1.322">      */</span>
<a href="#l1.323"></a><span id="l1.323">     get endDate() {</span>
<a href="#l1.324"></a><span id="l1.324">         return this.mEndDate;</span>
<a href="#l1.325"></a><span id="l1.325">     },</span>
<a href="#l1.326"></a><span id="l1.326"> </span>
<a href="#l1.327"></a><span id="l1.327" class="difflineminus">-    /** </span>
<a href="#l1.328"></a><span id="l1.328" class="difflineplus">+    /**</span>
<a href="#l1.329"></a><span id="l1.329">      * Sets the end date for the current filter date range. This will override the date range</span>
<a href="#l1.330"></a><span id="l1.330">      * calculated from the filter properties by the getDatesForFilter function.</span>
<a href="#l1.331"></a><span id="l1.331">      */</span>
<a href="#l1.332"></a><span id="l1.332">     set endDate(aEndDate) {</span>
<a href="#l1.333"></a><span id="l1.333">         return (this.mEndDate = aEndDate);</span>
<a href="#l1.334"></a><span id="l1.334">     },</span>
<a href="#l1.335"></a><span id="l1.335"> </span>
<a href="#l1.336"></a><span id="l1.336">     /**</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineat">@@ -678,17 +678,17 @@ calFilter.prototype = {</span>
<a href="#l1.338"></a><span id="l1.338">         } else {</span>
<a href="#l1.339"></a><span id="l1.339">             this.mFilterProperties = new calFilterProperties();</span>
<a href="#l1.340"></a><span id="l1.340">         }</span>
<a href="#l1.341"></a><span id="l1.341"> </span>
<a href="#l1.342"></a><span id="l1.342">         if (!this.mFilterProperties) {</span>
<a href="#l1.343"></a><span id="l1.343">             cal.WARN(&quot;[calFilter] Unable to apply filter &quot; + aFilter);</span>
<a href="#l1.344"></a><span id="l1.344">         } else {</span>
<a href="#l1.345"></a><span id="l1.345">             this.updateFilterDates();</span>
<a href="#l1.346"></a><span id="l1.346" class="difflineminus">-            this.mFilterProperties.LOG(&quot;Applying filter:&quot;);</span>
<a href="#l1.347"></a><span id="l1.347" class="difflineplus">+            // this.mFilterProperties.LOG(&quot;Applying filter:&quot;);</span>
<a href="#l1.348"></a><span id="l1.348">         }</span>
<a href="#l1.349"></a><span id="l1.349">     },</span>
<a href="#l1.350"></a><span id="l1.350"> </span>
<a href="#l1.351"></a><span id="l1.351">     /**</span>
<a href="#l1.352"></a><span id="l1.352">      * Calculates the current start and end dates for the currently applied filter, and updates</span>
<a href="#l1.353"></a><span id="l1.353">      * the current filter start and end dates. This function can be used to update the date range</span>
<a href="#l1.354"></a><span id="l1.354">      * for date range filters that are relative to the selected date or current date and time.</span>
<a href="#l1.355"></a><span id="l1.355">      *</span>
<a href="#l1.356"></a><span id="l1.356" class="difflineat">@@ -710,21 +710,21 @@ calFilter.prototype = {</span>
<a href="#l1.357"></a><span id="l1.357">         return [startDate, endDate];</span>
<a href="#l1.358"></a><span id="l1.358">     },</span>
<a href="#l1.359"></a><span id="l1.359"> </span>
<a href="#l1.360"></a><span id="l1.360">     /**</span>
<a href="#l1.361"></a><span id="l1.361">      * Filters an array of items, returning a new array containing the items that match</span>
<a href="#l1.362"></a><span id="l1.362">      * the currently applied filter properties and text filter.</span>
<a href="#l1.363"></a><span id="l1.363">      *</span>
<a href="#l1.364"></a><span id="l1.364">      * @param aItems              The array of items to check.</span>
<a href="#l1.365"></a><span id="l1.365" class="difflineminus">-     * @param aCallback           An optional callback function to be called with each item and </span>
<a href="#l1.366"></a><span id="l1.366" class="difflineplus">+     * @param aCallback           An optional callback function to be called with each item and</span>
<a href="#l1.367"></a><span id="l1.367">      *                            the result of it's filter test.</span>
<a href="#l1.368"></a><span id="l1.368" class="difflineminus">-     * @return                    A new array containing the items that match the filters, or </span>
<a href="#l1.369"></a><span id="l1.369" class="difflineplus">+     * @return                    A new array containing the items that match the filters, or</span>
<a href="#l1.370"></a><span id="l1.370">      *                            null if no filter has been applied.</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineminus">-     */  </span>
<a href="#l1.372"></a><span id="l1.372" class="difflineplus">+     */</span>
<a href="#l1.373"></a><span id="l1.373">     filterItems: function cF_filterItems(aItems, aCallback) {</span>
<a href="#l1.374"></a><span id="l1.374">         if (!this.mFilterProperties) {</span>
<a href="#l1.375"></a><span id="l1.375">             return null;</span>
<a href="#l1.376"></a><span id="l1.376">         }</span>
<a href="#l1.377"></a><span id="l1.377"> </span>
<a href="#l1.378"></a><span id="l1.378">         return aItems.filter(function(aItem) {</span>
<a href="#l1.379"></a><span id="l1.379">             let result = this.propertyFilter(aItem) &amp;&amp; this.textFilter(aItem);</span>
<a href="#l1.380"></a><span id="l1.380"> </span>
<a href="#l1.381"></a><span id="l1.381" class="difflineat">@@ -735,40 +735,40 @@ calFilter.prototype = {</span>
<a href="#l1.382"></a><span id="l1.382">             return result;</span>
<a href="#l1.383"></a><span id="l1.383">         }, this);</span>
<a href="#l1.384"></a><span id="l1.384">     },</span>
<a href="#l1.385"></a><span id="l1.385"> </span>
<a href="#l1.386"></a><span id="l1.386">     /**</span>
<a href="#l1.387"></a><span id="l1.387">      * Checks if the item matches the currently applied filter properties and text filter.</span>
<a href="#l1.388"></a><span id="l1.388">      *</span>
<a href="#l1.389"></a><span id="l1.389">      * @param aItem               The item to check.</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineminus">-     * @return                    Returns true if the item matches the filters, </span>
<a href="#l1.391"></a><span id="l1.391" class="difflineplus">+     * @return                    Returns true if the item matches the filters,</span>
<a href="#l1.392"></a><span id="l1.392">      *                            false otherwise.</span>
<a href="#l1.393"></a><span id="l1.393" class="difflineminus">-     */     </span>
<a href="#l1.394"></a><span id="l1.394" class="difflineplus">+     */</span>
<a href="#l1.395"></a><span id="l1.395">     isItemInFilters: function cF_isItemInFilters(aItem) {</span>
<a href="#l1.396"></a><span id="l1.396">         return (this.propertyFilter(aItem) &amp;&amp; this.textFilter(aItem));</span>
<a href="#l1.397"></a><span id="l1.397">     },</span>
<a href="#l1.398"></a><span id="l1.398"> </span>
<a href="#l1.399"></a><span id="l1.399">     /**</span>
<a href="#l1.400"></a><span id="l1.400">      * Finds the next occurrence of a repeating item that matches the currently applied</span>
<a href="#l1.401"></a><span id="l1.401">      * filter properties.</span>
<a href="#l1.402"></a><span id="l1.402">      *</span>
<a href="#l1.403"></a><span id="l1.403">      * @param aItem               The parent item to find the next occurrence of.</span>
<a href="#l1.404"></a><span id="l1.404" class="difflineminus">-     * @return                    Returns the next occurrence that matches the filters, </span>
<a href="#l1.405"></a><span id="l1.405" class="difflineplus">+     * @return                    Returns the next occurrence that matches the filters,</span>
<a href="#l1.406"></a><span id="l1.406">      *                            or null if no match is found.</span>
<a href="#l1.407"></a><span id="l1.407">      */</span>
<a href="#l1.408"></a><span id="l1.408">     getNextOccurrence: function cF_getNextOccurrence(aItem) {</span>
<a href="#l1.409"></a><span id="l1.409">         if (!aItem.recurrenceInfo) {</span>
<a href="#l1.410"></a><span id="l1.410">             return this.isItemInFilters(aItem) ? aItem : null;</span>
<a href="#l1.411"></a><span id="l1.411">         }</span>
<a href="#l1.412"></a><span id="l1.412"> </span>
<a href="#l1.413"></a><span id="l1.413">         let count = 0;</span>
<a href="#l1.414"></a><span id="l1.414">         let start = cal.now();</span>
<a href="#l1.415"></a><span id="l1.415"> </span>
<a href="#l1.416"></a><span id="l1.416" class="difflineminus">-        // If the base item matches the filter, we need to check each future occurrence. </span>
<a href="#l1.417"></a><span id="l1.417" class="difflineplus">+        // If the base item matches the filter, we need to check each future occurrence.</span>
<a href="#l1.418"></a><span id="l1.418">         // Otherwise, we only need to check the exceptions.</span>
<a href="#l1.419"></a><span id="l1.419">         if (this.isItemInFilters(aItem)) {</span>
<a href="#l1.420"></a><span id="l1.420">             while (count++ &lt; this.mMaxIterations) {</span>
<a href="#l1.421"></a><span id="l1.421">                 let next = aItem.recurrenceInfo.getNextOccurrence(start);</span>
<a href="#l1.422"></a><span id="l1.422">                 if (!next) {</span>
<a href="#l1.423"></a><span id="l1.423">                    // there are no more occurrences</span>
<a href="#l1.424"></a><span id="l1.424">                     return null;</span>
<a href="#l1.425"></a><span id="l1.425">                 }</span>
<a href="#l1.426"></a><span id="l1.426" class="difflineat">@@ -799,31 +799,31 @@ calFilter.prototype = {</span>
<a href="#l1.427"></a><span id="l1.427">     },</span>
<a href="#l1.428"></a><span id="l1.428"> </span>
<a href="#l1.429"></a><span id="l1.429">     /**</span>
<a href="#l1.430"></a><span id="l1.430">      * Gets the occurrences of a repeating item that match the currently applied</span>
<a href="#l1.431"></a><span id="l1.431">      * filter properties and date range.</span>
<a href="#l1.432"></a><span id="l1.432">      *</span>
<a href="#l1.433"></a><span id="l1.433">      * @param aItem               The parent item to find occurrence of.</span>
<a href="#l1.434"></a><span id="l1.434">      * @return                    Returns an array containing the occurrences that</span>
<a href="#l1.435"></a><span id="l1.435" class="difflineminus">-     *                            match the filters, an empty array if there are no </span>
<a href="#l1.436"></a><span id="l1.436" class="difflineplus">+     *                            match the filters, an empty array if there are no</span>
<a href="#l1.437"></a><span id="l1.437">      *                            matches, or null if the filter is not initialized.</span>
<a href="#l1.438"></a><span id="l1.438">      */</span>
<a href="#l1.439"></a><span id="l1.439">     getOccurrences: function cF_getOccurrences(aItem) {</span>
<a href="#l1.440"></a><span id="l1.440">         if (!this.mFilterProperties) {</span>
<a href="#l1.441"></a><span id="l1.441">             return null;</span>
<a href="#l1.442"></a><span id="l1.442">         }</span>
<a href="#l1.443"></a><span id="l1.443">         let props = this.mFilterProperties;</span>
<a href="#l1.444"></a><span id="l1.444">         let occs;</span>
<a href="#l1.445"></a><span id="l1.445"> </span>
<a href="#l1.446"></a><span id="l1.446">         if (!aItem.recurrenceInfo || (!props.occurrences &amp;&amp; !this.mEndDate) ||</span>
<a href="#l1.447"></a><span id="l1.447">             props.occurrences == props.FILTER_OCCURRENCES_NONE) {</span>
<a href="#l1.448"></a><span id="l1.448">             // either this isn't a repeating item, the occurrence filter specifies that</span>
<a href="#l1.449"></a><span id="l1.449">             // we don't want occurrences, or we have a default occurrence filter with an</span>
<a href="#l1.450"></a><span id="l1.450" class="difflineminus">-            // unbound date range, so we return just the unexpanded item. </span>
<a href="#l1.451"></a><span id="l1.451" class="difflineplus">+            // unbound date range, so we return just the unexpanded item.</span>
<a href="#l1.452"></a><span id="l1.452">             occs = [aItem];</span>
<a href="#l1.453"></a><span id="l1.453">         } else {</span>
<a href="#l1.454"></a><span id="l1.454">             occs = aItem.getOccurrencesBetween(this.mStartDate || cal.createDateTime(),</span>
<a href="#l1.455"></a><span id="l1.455">                                                this.mEndDate || cal.now(), {});</span>
<a href="#l1.456"></a><span id="l1.456">             if ((props.occurrences == props.FILTER_OCCURRENCES_PAST_AND_NEXT) &amp;&amp;</span>
<a href="#l1.457"></a><span id="l1.457">                 !this.mEndDate) {</span>
<a href="#l1.458"></a><span id="l1.458">                 // we have an unbound date range and the occurrence filter specifies</span>
<a href="#l1.459"></a><span id="l1.459">                 // that we also want the next matching occurrence if available.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

