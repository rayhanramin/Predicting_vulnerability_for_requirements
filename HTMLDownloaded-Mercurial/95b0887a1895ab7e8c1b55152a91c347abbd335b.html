<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24135:95b0887a1895ab7e8c1b55152a91c347abbd335b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 95b0887a1895ab7e8c1b55152a91c347abbd335b" />
<meta property="og:url" content="/comm-central/rev/95b0887a1895ab7e8c1b55152a91c347abbd335b" />
<meta property="og:description" content="Bug 1455471 - Implement Thunderbird WebExtensions tabs and windows API. r=darktrojan DONTBUILD" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 95b0887a1895ab7e8c1b55152a91c347abbd335b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/95b0887a1895ab7e8c1b55152a91c347abbd335b">shortlog</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/95b0887a1895ab7e8c1b55152a91c347abbd335b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b">files</a> |
changeset |
<a href="/comm-central/raw-rev/95b0887a1895ab7e8c1b55152a91c347abbd335b">raw</a>  | <a href="/comm-central/archive/95b0887a1895ab7e8c1b55152a91c347abbd335b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1455471">Bug 1455471</a> - Implement Thunderbird WebExtensions tabs and windows API. r=darktrojan DONTBUILD
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 29 Mar 2018 08:01:04 +0200</td></tr>

<tr>
 <td>changeset 24135</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/95b0887a1895ab7e8c1b55152a91c347abbd335b">95b0887a1895ab7e8c1b55152a91c347abbd335b</a></td>
</tr>



<tr>
<td>parent 24134</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9046e6ee5675da05b7031367b8e9e3eb8b08fda1">9046e6ee5675da05b7031367b8e9e3eb8b08fda1</a>
</td>
</tr>

<tr>
<td>child 24136</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7c455c3e60260772e74cb1f8fb40fc79b4fad5b6">7c455c3e60260772e74cb1f8fb40fc79b4fad5b6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=95b0887a1895ab7e8c1b55152a91c347abbd335b">14551</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 25 Jun 2018 09:45:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@95b0887a1895 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=95b0887a1895ab7e8c1b55152a91c347abbd335b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=95b0887a1895ab7e8c1b55152a91c347abbd335b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=95b0887a1895ab7e8c1b55152a91c347abbd335b&newProject=comm-central&newRevision=9046e6ee5675da05b7031367b8e9e3eb8b08fda1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=95b0887a1895ab7e8c1b55152a91c347abbd335b&newProject=comm-central&newRevision=9046e6ee5675da05b7031367b8e9e3eb8b08fda1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=95b0887a1895ab7e8c1b55152a91c347abbd335b&newProject=comm-central&newRevision=9046e6ee5675da05b7031367b8e9e3eb8b08fda1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1455471">1455471</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1455471">Bug 1455471</a> - Implement Thunderbird WebExtensions tabs and windows API. r=darktrojan DONTBUILD

MozReview-Commit-ID: IOnF6GOfG4m</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/.eslintignore">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/.eslintignore">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/.eslintignore">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/.eslintignore">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/specialTabs.js">mail/base/content/specialTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/specialTabs.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/specialTabs.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/specialTabs.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/specialTabs.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/specialTabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-mail.js">mail/components/extensions/child/ext-mail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-mail.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-mail.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-mail.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-mail.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-mail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-tabs.js">mail/components/extensions/child/ext-tabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-tabs.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-tabs.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-tabs.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-tabs.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/child/ext-tabs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/ext-mail.json">mail/components/extensions/ext-mail.json</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/ext-mail.json">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/ext-mail.json">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/ext-mail.json">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/ext-mail.json">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/ext-mail.json">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/extensions-mail.manifest">mail/components/extensions/extensions-mail.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/extensions-mail.manifest">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/extensions-mail.manifest">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/extensions-mail.manifest">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/extensions-mail.manifest">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/extensions-mail.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/jar.mn">mail/components/extensions/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/jar.mn">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/jar.mn">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/jar.mn">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/jar.mn">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/moz.build">mail/components/extensions/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/moz.build">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/moz.build">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/moz.build">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/moz.build">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-mail.js">mail/components/extensions/parent/ext-mail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-mail.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-mail.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-mail.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-mail.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-mail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-tabs.js">mail/components/extensions/parent/ext-tabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-tabs.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-tabs.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-tabs.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-tabs.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-tabs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-windows.js">mail/components/extensions/parent/ext-windows.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-windows.js">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-windows.js">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-windows.js">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-windows.js">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/parent/ext-windows.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/LICENSE">mail/components/extensions/schemas/LICENSE</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/LICENSE">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/LICENSE">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/LICENSE">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/LICENSE">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/LICENSE">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/tabs.json">mail/components/extensions/schemas/tabs.json</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/tabs.json">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/tabs.json">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/tabs.json">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/tabs.json">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/tabs.json">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/windows.json">mail/components/extensions/schemas/windows.json</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/windows.json">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/windows.json">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/windows.json">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/windows.json">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/extensions/schemas/windows.json">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/moz.build">mail/components/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/moz.build">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/moz.build">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/moz.build">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/moz.build">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/components/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/installer/package-manifest.in">mail/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/95b0887a1895ab7e8c1b55152a91c347abbd335b/mail/installer/package-manifest.in">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -19,20 +19,34 @@ testing/**</span>
<a href="#l1.4"></a><span id="l1.4"> # We ignore all these directories by default, until we get them enabled.</span>
<a href="#l1.5"></a><span id="l1.5"> # If you are enabling a directory, please add directory specific exclusions</span>
<a href="#l1.6"></a><span id="l1.6"> # below.</span>
<a href="#l1.7"></a><span id="l1.7"> build/**</span>
<a href="#l1.8"></a><span id="l1.8"> chat/**</span>
<a href="#l1.9"></a><span id="l1.9"> editor/**</span>
<a href="#l1.10"></a><span id="l1.10"> im/**</span>
<a href="#l1.11"></a><span id="l1.11"> ldap/**</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-mail/**</span>
<a href="#l1.13"></a><span id="l1.13"> mailnews/**</span>
<a href="#l1.14"></a><span id="l1.14"> suite/**</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+# mail exclusions</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+mail/app/**</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+mail/base/**</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+mail/branding/**</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+mail/config/**</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+mail/extensions/**</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+mail/installer/**</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+mail/locales/**</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+mail/test/**</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+mail/themes/**</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+# mail/components exclusions</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+mail/components/*</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+!mail/components/extensions</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+</span>
<a href="#l1.31"></a><span id="l1.31"> # calendar/ exclusions</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33"> # prefs files</span>
<a href="#l1.34"></a><span id="l1.34"> calendar/lightning/content/lightning.js</span>
<a href="#l1.35"></a><span id="l1.35"> calendar/locales/en-US/lightning-l10n.js</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37"> # third party library</span>
<a href="#l1.38"></a><span id="l1.38"> calendar/base/modules/ical.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -330,17 +330,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">     &lt;hbox id=&quot;titlebar-fullscreen-button&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> #endif</span>
<a href="#l2.6"></a><span id="l2.6">   &lt;/hbox&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> &lt;/vbox&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">   &lt;!-- navigation-toolbox with main menubar and tabs toolbar --&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> #include mainNavigationToolbox.inc</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    &lt;toolbar id=&quot;tabs-toolbar&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    &lt;toolbar id=&quot;tabs-toolbar&quot; class=&quot;chromeclass-toolbar&quot;&gt;</span>
<a href="#l2.14"></a><span id="l2.14">       &lt;!-- class tabmail-tabs is unused and only maintained for add-ons. --&gt;</span>
<a href="#l2.15"></a><span id="l2.15">       &lt;tabs flex=&quot;1&quot;</span>
<a href="#l2.16"></a><span id="l2.16">             id=&quot;tabmail-tabs&quot;</span>
<a href="#l2.17"></a><span id="l2.17">             align=&quot;end&quot;</span>
<a href="#l2.18"></a><span id="l2.18">             setfocus=&quot;false&quot;</span>
<a href="#l2.19"></a><span id="l2.19">             onclick=&quot;document.getElementById('tabmail').onTabClick(event);&quot;</span>
<a href="#l2.20"></a><span id="l2.20">             class=&quot;tabmail-tabs&quot;</span>
<a href="#l2.21"></a><span id="l2.21">             tooltip=&quot;tabmail-tabs-tooltip&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -717,17 +717,20 @@ function loadExtraTabs()</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   if (!(&quot;arguments&quot; in window) || window.arguments.length &lt; 2)</span>
<a href="#l3.6"></a><span id="l3.6">     return;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   let tab = window.arguments[1];</span>
<a href="#l3.9"></a><span id="l3.9">   if ((!tab) || (typeof tab != &quot;object&quot;))</span>
<a href="#l3.10"></a><span id="l3.10">     return;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  let tabmail =  document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  if (&quot;wrappedJSObject&quot; in tab)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    tab = tab.wrappedJSObject;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18">   // we got no action, so suppose its &quot;legacy&quot; code</span>
<a href="#l3.19"></a><span id="l3.19">   if (!(&quot;action&quot; in tab)) {</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">     if (&quot;tabType&quot; in tab)</span>
<a href="#l3.22"></a><span id="l3.22">       tabmail.openTab(tab.tabType, tab.tabParams);</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24">     return;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineat">@@ -745,20 +748,19 @@ function loadExtraTabs()</span>
<a href="#l3.26"></a><span id="l3.26">     // we currently do not support opening in background or opening a</span>
<a href="#l3.27"></a><span id="l3.27">     // special position. So select the last tab opened.</span>
<a href="#l3.28"></a><span id="l3.28">     tabmail.switchToTab(tabmail.tabInfo[tabmail.tabInfo.length-1])</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30">     return;</span>
<a href="#l3.31"></a><span id="l3.31">   }</span>
<a href="#l3.32"></a><span id="l3.32"> </span>
<a href="#l3.33"></a><span id="l3.33">   if (tab.action == &quot;open&quot;) {</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-</span>
<a href="#l3.35"></a><span id="l3.35">     for (let i = 0; i &lt; tab.tabs.length; i++)</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-      if(&quot;tabType&quot; in tabs.tab[i])</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-        tabmail.openTab(tabs.tab[i].tabType,tabs.tab[i].tabParams);</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+      if(&quot;tabType&quot; in tab.tabs[i])</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+        tabmail.openTab(tab.tabs[i].tabType,tab.tabs[i].tabParams);</span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41">     return;</span>
<a href="#l3.42"></a><span id="l3.42">   }</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44"> }</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46"> /**</span>
<a href="#l3.47"></a><span id="l3.47">  * Loads the given message header at window open. Exactly one out of this and</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineat">@@ -1789,16 +1791,22 @@ var TabsInTitlebar = {</span>
<a href="#l3.49"></a><span id="l3.49"> </span>
<a href="#l3.50"></a><span id="l3.50">   update() {</span>
<a href="#l3.51"></a><span id="l3.51">     if (!this._initialized || window.fullScreen) {</span>
<a href="#l3.52"></a><span id="l3.52">       return;</span>
<a href="#l3.53"></a><span id="l3.53">     }</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55">     let allowed = this.systemSupported &amp;&amp;</span>
<a href="#l3.56"></a><span id="l3.56">                   (Object.keys(this._disallowed)).length == 0;</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+    if (document.documentElement.getAttribute(&quot;chromehidden&quot;).includes(&quot;toolbar&quot;)) {</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+      // Don't draw in titlebar in case of a popup window</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+      allowed = false;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+    }</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+</span>
<a href="#l3.63"></a><span id="l3.63">     if (allowed) {</span>
<a href="#l3.64"></a><span id="l3.64">       document.documentElement.setAttribute(&quot;tabsintitlebar&quot;, &quot;true&quot;);</span>
<a href="#l3.65"></a><span id="l3.65">       if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l3.66"></a><span id="l3.66">         document.documentElement.setAttribute(&quot;chromemargin&quot;, &quot;0,-1,-1,-1&quot;);</span>
<a href="#l3.67"></a><span id="l3.67">         document.documentElement.removeAttribute(&quot;drawtitle&quot;);</span>
<a href="#l3.68"></a><span id="l3.68">       } else {</span>
<a href="#l3.69"></a><span id="l3.69">         document.documentElement.setAttribute(&quot;chromemargin&quot;, &quot;0,2,2,2&quot;);</span>
<a href="#l3.70"></a><span id="l3.70">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/specialTabs.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/specialTabs.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -291,28 +291,31 @@ var contentTabBaseType = {</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">       aDocument.getElementById(&quot;category-box&quot;)</span>
<a href="#l4.6"></a><span id="l4.6">                .insertBefore(hbox, aDocument.getElementById(&quot;categories&quot;));</span>
<a href="#l4.7"></a><span id="l4.7">     },</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">     // about:preferences</span>
<a href="#l4.10"></a><span id="l4.10">     null],</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  shouldSwitchTo: function onSwitchTo({contentPage: aContentPage}) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  shouldSwitchTo: function onSwitchTo({contentPage: aContentPage, duplicate: aDuplicate}) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    if (aDuplicate) {</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      return -1;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+    }</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+</span>
<a href="#l4.18"></a><span id="l4.18">     let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">     let tabInfo = tabmail.tabInfo;</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">     // Remove any anchors - especially for the about: pages, we just want</span>
<a href="#l4.22"></a><span id="l4.22">     // to re-use the same tab.</span>
<a href="#l4.23"></a><span id="l4.23">     let regEx = new RegExp(&quot;#.*&quot;);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     let contentUrl = aContentPage.replace(regEx, &quot;&quot;);</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-    for (let selectedIndex = 0; selectedIndex &lt; tabInfo.length;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-         ++selectedIndex) {</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+    for (let selectedIndex = 0; selectedIndex &lt; tabInfo.length; ++selectedIndex) {</span>
<a href="#l4.30"></a><span id="l4.30">       if (tabInfo[selectedIndex].mode.name == this.name &amp;&amp;</span>
<a href="#l4.31"></a><span id="l4.31">           tabInfo[selectedIndex].browser.currentURI.spec</span>
<a href="#l4.32"></a><span id="l4.32">                                 .replace(regEx, &quot;&quot;) == contentUrl) {</span>
<a href="#l4.33"></a><span id="l4.33">         // Ensure we go to the correct location on the page.</span>
<a href="#l4.34"></a><span id="l4.34">         tabInfo[selectedIndex].browser</span>
<a href="#l4.35"></a><span id="l4.35">                               .setAttribute(&quot;src&quot;, aContentPage);</span>
<a href="#l4.36"></a><span id="l4.36">         return selectedIndex;</span>
<a href="#l4.37"></a><span id="l4.37">       }</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineat">@@ -814,18 +817,19 @@ var specialTabs = {</span>
<a href="#l4.39"></a><span id="l4.39">       return {</span>
<a href="#l4.40"></a><span id="l4.40">         tabURI: aTab.browser.currentURI.spec,</span>
<a href="#l4.41"></a><span id="l4.41">         clickHandler: onClick ? onClick : null</span>
<a href="#l4.42"></a><span id="l4.42">       };</span>
<a href="#l4.43"></a><span id="l4.43">     },</span>
<a href="#l4.44"></a><span id="l4.44">     restoreTab: function onRestoreTab(aTabmail, aPersistedState) {</span>
<a href="#l4.45"></a><span id="l4.45">       aTabmail.openTab(&quot;contentTab&quot;, { contentPage: aPersistedState.tabURI,</span>
<a href="#l4.46"></a><span id="l4.46">                                        clickHandler: aPersistedState.clickHandler,</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+                                       duplicate: aPersistedState.duplicate,</span>
<a href="#l4.48"></a><span id="l4.48">                                        background: true } );</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-    },</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    }</span>
<a href="#l4.51"></a><span id="l4.51">   },</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53">   /**</span>
<a href="#l4.54"></a><span id="l4.54">    * Split a version number into a triple (major, minor, extension)</span>
<a href="#l4.55"></a><span id="l4.55">    * For example, 7.0.1 =&gt; [7, 0, 1]</span>
<a href="#l4.56"></a><span id="l4.56">    *             10.1a3 =&gt; [10, 1, a3]</span>
<a href="#l4.57"></a><span id="l4.57">    *             10.0 =&gt; [10, 0, &quot;&quot;]</span>
<a href="#l4.58"></a><span id="l4.58">    * This could be a static function, but no current reason for it to</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -269,17 +269,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">     &lt;/resources&gt;</span>
<a href="#l5.5"></a><span id="l5.5">     &lt;content&gt;</span>
<a href="#l5.6"></a><span id="l5.6">       &lt;xul:tabbox anonid=&quot;tabbox&quot; class=&quot;tabmail-tabbox&quot; flex=&quot;1&quot; eventnode=&quot;document&quot;&gt;</span>
<a href="#l5.7"></a><span id="l5.7">         &lt;!-- Remember, user of this binding, you need to provide tabpanels!  --&gt;</span>
<a href="#l5.8"></a><span id="l5.8">         &lt;children includes=&quot;tabpanels&quot;/&gt;</span>
<a href="#l5.9"></a><span id="l5.9">       &lt;/xul:tabbox&gt;</span>
<a href="#l5.10"></a><span id="l5.10">     &lt;/content&gt;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    &lt;implementation implements=&quot;nsIController&quot;&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    &lt;implementation implements=&quot;nsIController, nsIWebProgressListener, nsIWebProgressListener2&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14">       &lt;constructor&gt;</span>
<a href="#l5.15"></a><span id="l5.15">         window.controllers.insertControllerAt(0, this);</span>
<a href="#l5.16"></a><span id="l5.16">         this._restoringTabState = null;</span>
<a href="#l5.17"></a><span id="l5.17">         ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l5.18"></a><span id="l5.18">       &lt;/constructor&gt;</span>
<a href="#l5.19"></a><span id="l5.19">       &lt;destructor&gt;</span>
<a href="#l5.20"></a><span id="l5.20">         window.controllers.removeController(this);</span>
<a href="#l5.21"></a><span id="l5.21">       &lt;/destructor&gt;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -314,16 +314,19 @@</span>
<a href="#l5.23"></a><span id="l5.23">         new Array()</span>
<a href="#l5.24"></a><span id="l5.24">       &lt;/field&gt;</span>
<a href="#l5.25"></a><span id="l5.25">       &lt;field name=&quot;recentlyClosedTabs&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l5.26"></a><span id="l5.26">         new Array();</span>
<a href="#l5.27"></a><span id="l5.27">       &lt;/field&gt;</span>
<a href="#l5.28"></a><span id="l5.28">       &lt;field name=&quot;mLastTabOpener&quot;&gt;</span>
<a href="#l5.29"></a><span id="l5.29">         null</span>
<a href="#l5.30"></a><span id="l5.30">       &lt;/field&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+      &lt;field name=&quot;mTabsProgressListeners&quot;&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+        new Set();</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l5.34"></a><span id="l5.34">       &lt;method name=&quot;createTooltip&quot;&gt;</span>
<a href="#l5.35"></a><span id="l5.35">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l5.36"></a><span id="l5.36">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.37"></a><span id="l5.37">           event.stopPropagation();</span>
<a href="#l5.38"></a><span id="l5.38">           var tab = document.tooltipNode;</span>
<a href="#l5.39"></a><span id="l5.39">           if (tab.localName != &quot;tab&quot; || this.tabContainer.draggedTab) {</span>
<a href="#l5.40"></a><span id="l5.40">             event.preventDefault();</span>
<a href="#l5.41"></a><span id="l5.41">             return;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineat">@@ -498,17 +501,17 @@</span>
<a href="#l5.43"></a><span id="l5.43">             }</span>
<a href="#l5.44"></a><span id="l5.44">           }</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">           if (!background)</span>
<a href="#l5.47"></a><span id="l5.47">             // we need to save the state before it gets corrupted</span>
<a href="#l5.48"></a><span id="l5.48">             this.saveCurrentTabState();</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50">           let tab = {mode: tabMode, busy: false, canClose: true,</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-                     thinking: false, _ext: {}};</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+                     thinking: false, beforeTabOpen: true, _ext: {}};</span>
<a href="#l5.53"></a><span id="l5.53">           tabMode.tabs.push(tab);</span>
<a href="#l5.54"></a><span id="l5.54"> </span>
<a href="#l5.55"></a><span id="l5.55">           var t = document.createElementNS(</span>
<a href="#l5.56"></a><span id="l5.56">             &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l5.57"></a><span id="l5.57">             &quot;tab&quot;);</span>
<a href="#l5.58"></a><span id="l5.58">           tab.tabNode = t;</span>
<a href="#l5.59"></a><span id="l5.59">           t.maxWidth = this.tabContainer.mTabMaxWidth;</span>
<a href="#l5.60"></a><span id="l5.60">           t.minWidth = this.tabContainer.mTabMinWidth;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineat">@@ -596,16 +599,32 @@</span>
<a href="#l5.62"></a><span id="l5.62">           // for styling purposes, apply the type to the tab...</span>
<a href="#l5.63"></a><span id="l5.63">           t.setAttribute('type', tab.mode.type);</span>
<a href="#l5.64"></a><span id="l5.64"> </span>
<a href="#l5.65"></a><span id="l5.65">           if (!background)</span>
<a href="#l5.66"></a><span id="l5.66">             // Update the toolbar status - we don't need to do menus as they</span>
<a href="#l5.67"></a><span id="l5.67">             // do themselves when we open them.</span>
<a href="#l5.68"></a><span id="l5.68">             UpdateMailToolbar(&quot;tabmail&quot;);</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+          let moving = restoreState ? restoreState.moving : null;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+          // Dispatch tab opening event</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+          let evt = new CustomEvent(&quot;TabOpen&quot;, { bubbles: true, detail: { tabInfo: tab, moving } });</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+          t.dispatchEvent(evt);</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+          delete tab.beforeTabOpen;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+          // Register browser progress listeners</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+          let browser = this.getBrowserForTab(tab);</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+          if (browser) {</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+            // It would probably be better to have the tabs register this listener, since the</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+            // browser can change. This wasn't trivial to do while implementing basic WebExtension</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+            // support, so let's assume one browser only for now.</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+            browser.webProgress.addProgressListener(this, Ci.nsIWebProgress.NOTIFY_ALL);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+          }</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+</span>
<a href="#l5.86"></a><span id="l5.86">           return tab;</span>
<a href="#l5.87"></a><span id="l5.87">         } catch (e) {</span>
<a href="#l5.88"></a><span id="l5.88">           logException(e);</span>
<a href="#l5.89"></a><span id="l5.89">           return null;</span>
<a href="#l5.90"></a><span id="l5.90">         }</span>
<a href="#l5.91"></a><span id="l5.91">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.92"></a><span id="l5.92">       &lt;/method&gt;</span>
<a href="#l5.93"></a><span id="l5.93">       &lt;method name=&quot;selectTabByMode&quot;&gt;</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineat">@@ -711,16 +730,22 @@</span>
<a href="#l5.95"></a><span id="l5.95">             // whether its tabs can be closed or not. For instance, contentTabs</span>
<a href="#l5.96"></a><span id="l5.96">             // and chromeTabs run onbeforeunload event handlers that may</span>
<a href="#l5.97"></a><span id="l5.97">             // exercise their right to prompt the user for confirmation before</span>
<a href="#l5.98"></a><span id="l5.98">             // closing.</span>
<a href="#l5.99"></a><span id="l5.99">             let tryCloseFunc = tab.mode.tryCloseTab || tab.mode.tabType.tryCloseTab;</span>
<a href="#l5.100"></a><span id="l5.100">             if (tryCloseFunc &amp;&amp; !tryCloseFunc.call(tab.mode.tabType, tab))</span>
<a href="#l5.101"></a><span id="l5.101">               return;</span>
<a href="#l5.102"></a><span id="l5.102"> </span>
<a href="#l5.103"></a><span id="l5.103" class="difflineplus">+            let evt = new CustomEvent(&quot;TabClose&quot;, {</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+              bubbles: true,</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+              detail: { tabInfo: tab, moving: tab.moving }</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+            });</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+            tabNode.dispatchEvent(evt);</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+</span>
<a href="#l5.109"></a><span id="l5.109">             for (let tabMonitor of this.tabMonitors) {</span>
<a href="#l5.110"></a><span id="l5.110">               if (&quot;onTabClosing&quot; in tabMonitor)</span>
<a href="#l5.111"></a><span id="l5.111">                 tabMonitor.onTabClosing(tab);</span>
<a href="#l5.112"></a><span id="l5.112">             }</span>
<a href="#l5.113"></a><span id="l5.113"> </span>
<a href="#l5.114"></a><span id="l5.114">             if (!aNoUndo) {</span>
<a href="#l5.115"></a><span id="l5.115">               // Allow user to undo accidentally closed tabs</span>
<a href="#l5.116"></a><span id="l5.116">               let session = this.persistTab(tab);</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineat">@@ -797,16 +822,18 @@</span>
<a href="#l5.118"></a><span id="l5.118">               if ((tab != thisTab) &amp;&amp; tab.canClose)</span>
<a href="#l5.119"></a><span id="l5.119">                 this.closeTab(tab, aNoUndo);</span>
<a href="#l5.120"></a><span id="l5.120">             }</span>
<a href="#l5.121"></a><span id="l5.121">           ]]&gt;</span>
<a href="#l5.122"></a><span id="l5.122">         &lt;/body&gt;</span>
<a href="#l5.123"></a><span id="l5.123">       &lt;/method&gt;</span>
<a href="#l5.124"></a><span id="l5.124">       &lt;method name=&quot;replaceTabWithWindow&quot;&gt;</span>
<a href="#l5.125"></a><span id="l5.125">         &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+        &lt;parameter name=&quot;aTargetWindow&quot;/&gt;</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineplus">+        &lt;parameter name=&quot;aTargetPosition&quot;/&gt;</span>
<a href="#l5.128"></a><span id="l5.128">         &lt;body&gt;</span>
<a href="#l5.129"></a><span id="l5.129">           &lt;![CDATA[</span>
<a href="#l5.130"></a><span id="l5.130">             if (this.tabInfo.length &lt;= 1)</span>
<a href="#l5.131"></a><span id="l5.131">               return null;</span>
<a href="#l5.132"></a><span id="l5.132"> </span>
<a href="#l5.133"></a><span id="l5.133">             let tab = this._getTabContextForTabbyThing(aTab, false)[1];</span>
<a href="#l5.134"></a><span id="l5.134"> </span>
<a href="#l5.135"></a><span id="l5.135">             if (!tab.canClose)</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineat">@@ -816,82 +843,103 @@</span>
<a href="#l5.137"></a><span id="l5.137">             tab = this.persistTab(tab);</span>
<a href="#l5.138"></a><span id="l5.138">             if (!tab)</span>
<a href="#l5.139"></a><span id="l5.139">               return null;</span>
<a href="#l5.140"></a><span id="l5.140"> </span>
<a href="#l5.141"></a><span id="l5.141">             // Converting to JSON and back again creates clean javascript</span>
<a href="#l5.142"></a><span id="l5.142">             // object with absolutely no references to our current window.</span>
<a href="#l5.143"></a><span id="l5.143">             tab = JSON.parse(JSON.stringify(tab));</span>
<a href="#l5.144"></a><span id="l5.144"> </span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+            // Set up an identifier for the move, consumers may want to correlate TabClose and</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+            // TabOpen events.</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+            let moveSession = Cc[&quot;@mozilla.org/uuid-generator;1&quot;]</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+              .getService(Ci.nsIUUIDGenerator)</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+              .generateUUID().toString();</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+            tab.moving = moveSession;</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+            aTab.moving = moveSession;</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+</span>
<a href="#l5.154"></a><span id="l5.154">             this.closeTab(aTab,true);</span>
<a href="#l5.155"></a><span id="l5.155"> </span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-            return window.openDialog(&quot;chrome://messenger/content/&quot;, &quot;_blank&quot;,</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-               &quot;chrome,dialog=no,all&quot;, null,</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-               { action : &quot;restore&quot;, tabs: [tab] } ).focus();</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+            if (aTargetWindow &amp;&amp; aTargetWindow !== &quot;popup&quot;) {</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+              let targetTabmail = aTargetWindow.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+              targetTabmail.restoreTab(tab);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+              if (aTargetPosition) {</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+                let droppedTab = targetTabmail.tabInfo[targetTabmail.tabInfo.length - 1];</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+                targetTabmail.moveTabTo(droppedTab, aTargetPosition);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+              }</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+              return aTargetWindow;</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+            } else {</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+              let features = [&quot;chrome&quot;];</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+              if (aTargetWindow === &quot;popup&quot;) {</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+                features.push(&quot;dialog&quot;, &quot;resizable&quot;, &quot;minimizable&quot;, &quot;centerscreen&quot;, &quot;titlebar&quot;, &quot;close&quot;);</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+              } else {</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+                features.push(&quot;dialog=no&quot;, &quot;all&quot;, &quot;status&quot;, &quot;toolbar&quot;);</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+              }</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+              return window.openDialog(&quot;chrome://messenger/content/&quot;, &quot;_blank&quot;,</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+                 features.join(&quot;,&quot;), null,</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineplus">+                 { action : &quot;restore&quot;, tabs: [tab] } ).focus();</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineplus">+            }</span>
<a href="#l5.180"></a><span id="l5.180">           ]]&gt;</span>
<a href="#l5.181"></a><span id="l5.181">         &lt;/body&gt;</span>
<a href="#l5.182"></a><span id="l5.182">       &lt;/method&gt;</span>
<a href="#l5.183"></a><span id="l5.183">       &lt;method name=&quot;moveTabTo&quot;&gt;</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+        &lt;parameter name=&quot;aTabIndexNodeOrInfo&quot;/&gt;</span>
<a href="#l5.186"></a><span id="l5.186">         &lt;parameter name=&quot;aIndex&quot;/&gt;</span>
<a href="#l5.187"></a><span id="l5.187">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-          if ((!aTab) || (aTab.tagName != &quot;tab&quot;))</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-            return -1;</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-          let oldIdx = this.tabContainer.getIndexOfItem(aTab);</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-          if (oldIdx &lt; 0)</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineplus">+          let [oldIdx, tab, tabNode] =</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+            this._getTabContextForTabbyThing(aTabIndexNodeOrInfo, false);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+          if (!tab || !tabNode || tabNode.tagName != &quot;tab&quot; || oldIdx &lt; 0 || oldIdx == aIndex) {</span>
<a href="#l5.198"></a><span id="l5.198">             return -1;</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-          if (oldIdx == aIndex)</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineminus">-            return -1;</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineminus">-</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-          // Cache the old tabInfo</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineminus">-          let tab = this.tabInfo[oldIdx]</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-          if (!tab)</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineminus">-            return -1;</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineminus">-</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineminus">-          // remove the entries form tabInfo, tabMode and the tabContainer</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+          }</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+          // remove the entries from tabInfo, tabMode and the tabContainer</span>
<a href="#l5.213"></a><span id="l5.213">           this.tabInfo.splice(oldIdx, 1);</span>
<a href="#l5.214"></a><span id="l5.214">           tab.mode.tabs.splice(tab.mode.tabs.indexOf(tab), 1);</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineminus">-          aTab.remove();</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineminus">-</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+          tabNode.remove();</span>
<a href="#l5.218"></a><span id="l5.218"> </span>
<a href="#l5.219"></a><span id="l5.219">           // as we removed items, we might need to update indices</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineminus">-          if (oldIdx &lt; aIndex)</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineminus">-            aIndex --;</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+          if (oldIdx &lt; aIndex) {</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+            aIndex--;</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+          }</span>
<a href="#l5.225"></a><span id="l5.225"> </span>
<a href="#l5.226"></a><span id="l5.226">           // Read it into tabInfo and the tabContainer</span>
<a href="#l5.227"></a><span id="l5.227">           this.tabInfo.splice(aIndex, 0, tab);</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineminus">-          this.tabContainer.insertBefore(aTab, this.tabContainer.childNodes[aIndex]);</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+          this.tabContainer.insertBefore(tabNode, this.tabContainer.childNodes[aIndex]);</span>
<a href="#l5.230"></a><span id="l5.230"> </span>
<a href="#l5.231"></a><span id="l5.231">           // Now it's getting a bit ugly, as tabModes stores redundant</span>
<a href="#l5.232"></a><span id="l5.232">           // information we need to get it in sync with tabInfo.</span>
<a href="#l5.233"></a><span id="l5.233">           //</span>
<a href="#l5.234"></a><span id="l5.234">           // As tabModes.tabs is a subset of tabInfo, every tab can be mapped</span>
<a href="#l5.235"></a><span id="l5.235">           // to a tabInfo index. So we check for each tab in tabModes if it is</span>
<a href="#l5.236"></a><span id="l5.236">           // directly in front of our moved tab. We do this by looking up the</span>
<a href="#l5.237"></a><span id="l5.237">           // index in tabInfo and compare it with the moved tab's index. If we</span>
<a href="#l5.238"></a><span id="l5.238">           // found our tab, we insert the moved tab directly behind into tabModes</span>
<a href="#l5.239"></a><span id="l5.239"> </span>
<a href="#l5.240"></a><span id="l5.240">           // In case find no tab we simply append it</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-          let modeIdx = tab.mode.tabs.length+1;</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineplus">+          let modeIdx = tab.mode.tabs.length + 1;</span>
<a href="#l5.243"></a><span id="l5.243"> </span>
<a href="#l5.244"></a><span id="l5.244">           for (let i = 0; i &lt; tab.mode.tabs.length; i++) {</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-</span>
<a href="#l5.246"></a><span id="l5.246">             if (this.tabInfo.indexOf(tab.mode.tabs[i]) &lt; aIndex)</span>
<a href="#l5.247"></a><span id="l5.247">               continue;</span>
<a href="#l5.248"></a><span id="l5.248"> </span>
<a href="#l5.249"></a><span id="l5.249">             modeIdx = i;</span>
<a href="#l5.250"></a><span id="l5.250">             break;</span>
<a href="#l5.251"></a><span id="l5.251">           }</span>
<a href="#l5.252"></a><span id="l5.252"> </span>
<a href="#l5.253"></a><span id="l5.253">           tab.mode.tabs.splice(modeIdx, 0, tab);</span>
<a href="#l5.254"></a><span id="l5.254"> </span>
<a href="#l5.255"></a><span id="l5.255" class="difflineplus">+          let evt = new CustomEvent(&quot;TabMove&quot;, {</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineplus">+            bubbles: true, view: window, detail: { idx: oldIdx, tabInfo: tab }</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineplus">+          });</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineplus">+          tabNode.dispatchEvent(evt);</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineplus">+</span>
<a href="#l5.260"></a><span id="l5.260">           return aIndex;</span>
<a href="#l5.261"></a><span id="l5.261">          ]]&gt;</span>
<a href="#l5.262"></a><span id="l5.262">          &lt;/body&gt;</span>
<a href="#l5.263"></a><span id="l5.263">        &lt;/method&gt;</span>
<a href="#l5.264"></a><span id="l5.264">        &lt;method name=&quot;persistTab&quot;&gt;</span>
<a href="#l5.265"></a><span id="l5.265">          &lt;parameter name=&quot;tab&quot;/&gt;</span>
<a href="#l5.266"></a><span id="l5.266">          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.267"></a><span id="l5.267">            /* Returns null in case persist fails */</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineat">@@ -1051,43 +1099,51 @@</span>
<a href="#l5.269"></a><span id="l5.269"> </span>
<a href="#l5.270"></a><span id="l5.270">               let tabCloseFunc = tab.mode.closeTab || tab.mode.tabType.closeTab;</span>
<a href="#l5.271"></a><span id="l5.271">               tabCloseFunc.call(tab.mode.tabType, tab);</span>
<a href="#l5.272"></a><span id="l5.272">             }</span>
<a href="#l5.273"></a><span id="l5.273">           ]]&gt;</span>
<a href="#l5.274"></a><span id="l5.274">         &lt;/body&gt;</span>
<a href="#l5.275"></a><span id="l5.275">       &lt;/method&gt;</span>
<a href="#l5.276"></a><span id="l5.276"> </span>
<a href="#l5.277"></a><span id="l5.277" class="difflineminus">-      &lt;property name=&quot;selectedTab&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineplus">+      &lt;property name=&quot;selectedTab&quot;&gt;</span>
<a href="#l5.279"></a><span id="l5.279">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.280"></a><span id="l5.280">           if (!this.currentTabInfo)</span>
<a href="#l5.281"></a><span id="l5.281">             this.currentTabInfo = this.tabInfo[0];</span>
<a href="#l5.282"></a><span id="l5.282"> </span>
<a href="#l5.283"></a><span id="l5.283">           return this.currentTabInfo;</span>
<a href="#l5.284"></a><span id="l5.284">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineplus">+          this.switchToTab(val);</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l5.288"></a><span id="l5.288">       &lt;/property&gt;</span>
<a href="#l5.289"></a><span id="l5.289"> </span>
<a href="#l5.290"></a><span id="l5.290">       &lt;!-- getBrowserForSelectedTab is required as some toolkit functions</span>
<a href="#l5.291"></a><span id="l5.291">            require a getBrowser() function. --&gt;</span>
<a href="#l5.292"></a><span id="l5.292">       &lt;method name=&quot;getBrowserForSelectedTab&quot;&gt;</span>
<a href="#l5.293"></a><span id="l5.293">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.294"></a><span id="l5.294">           if (!this.currentTabInfo)</span>
<a href="#l5.295"></a><span id="l5.295">             this.currentTabInfo = this.tabInfo[0];</span>
<a href="#l5.296"></a><span id="l5.296"> </span>
<a href="#l5.297"></a><span id="l5.297">           let tab = this.currentTabInfo;</span>
<a href="#l5.298"></a><span id="l5.298">           if (!tab)</span>
<a href="#l5.299"></a><span id="l5.299">             return null;</span>
<a href="#l5.300"></a><span id="l5.300"> </span>
<a href="#l5.301"></a><span id="l5.301" class="difflineminus">-          let browserFunc = tab.mode.getBrowser || tab.mode.tabType.getBrowser;</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineminus">-          if (browserFunc)</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineminus">-            return browserFunc.call(tab.mode.tabType, tab);</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineminus">-</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineminus">-          return null;</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineplus">+          return this.getBrowserForTab(tab);</span>
<a href="#l5.307"></a><span id="l5.307">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.308"></a><span id="l5.308">       &lt;/method&gt;</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineplus">+</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineplus">+      &lt;method name=&quot;getBrowserForTab&quot;&gt;</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineplus">+        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineplus">+          let browserFunc = aTab ? aTab.mode.getBrowser || aTab.mode.tabType.getBrowser : null;</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineplus">+          return browserFunc ? browserFunc.call(aTab.mode.tabType, aTab) : null;</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineplus">+</span>
<a href="#l5.318"></a><span id="l5.318">       &lt;!-- getBrowserForDocument is used to find the browser for a specific</span>
<a href="#l5.319"></a><span id="l5.319">            document that's been loaded --&gt;</span>
<a href="#l5.320"></a><span id="l5.320">       &lt;method name=&quot;getBrowserForDocument&quot;&gt;</span>
<a href="#l5.321"></a><span id="l5.321">         &lt;parameter name=&quot;aDocument&quot;/&gt;</span>
<a href="#l5.322"></a><span id="l5.322">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.323"></a><span id="l5.323">           for (let i = 0; i &lt; this.tabInfo.length; ++i) {</span>
<a href="#l5.324"></a><span id="l5.324">             let browserFunc = this.tabInfo[i].mode.getBrowser ||</span>
<a href="#l5.325"></a><span id="l5.325">                               this.tabInfo[i].mode.tabType.getBrowser;</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineat">@@ -1116,16 +1172,27 @@</span>
<a href="#l5.327"></a><span id="l5.327">               if (possBrowser &amp;&amp;</span>
<a href="#l5.328"></a><span id="l5.328">                   possBrowser.contentDocument.documentElement.id == aDocumentId)</span>
<a href="#l5.329"></a><span id="l5.329">                 return this.tabInfo[i];</span>
<a href="#l5.330"></a><span id="l5.330">             }</span>
<a href="#l5.331"></a><span id="l5.331">           }</span>
<a href="#l5.332"></a><span id="l5.332">           return null;</span>
<a href="#l5.333"></a><span id="l5.333">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.334"></a><span id="l5.334">       &lt;/method&gt;</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineplus">+      &lt;method name=&quot;getTabForBrowser&quot;&gt;</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineplus">+        &lt;parameter name=&quot;aBrowser&quot;/&gt;</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineplus">+          for (let tabInfo of this.tabInfo) {</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineplus">+            if (this.getBrowserForTab(tabInfo) == aBrowser) {</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineplus">+              return tabInfo;</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineplus">+            }</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineplus">+          }</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineplus">+          return null;</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.346"></a><span id="l5.346">       &lt;method name=&quot;removeCurrentTab&quot;&gt;</span>
<a href="#l5.347"></a><span id="l5.347">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.348"></a><span id="l5.348">           this.removeTabByNode(</span>
<a href="#l5.349"></a><span id="l5.349">             this.tabContainer.childNodes[this.tabContainer.selectedIndex]);</span>
<a href="#l5.350"></a><span id="l5.350">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.351"></a><span id="l5.351">       &lt;/method&gt;</span>
<a href="#l5.352"></a><span id="l5.352">       &lt;method name=&quot;switchToTab&quot;&gt;</span>
<a href="#l5.353"></a><span id="l5.353">         &lt;parameter name=&quot;aTabIndexNodeOrInfo&quot;/&gt;</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineat">@@ -1180,16 +1247,20 @@</span>
<a href="#l5.355"></a><span id="l5.355"> </span>
<a href="#l5.356"></a><span id="l5.356">               // Update the toolbar status - we don't need to do menus as they</span>
<a href="#l5.357"></a><span id="l5.357">               // do themselves when we open them.</span>
<a href="#l5.358"></a><span id="l5.358">               UpdateMailToolbar(&quot;tabmail&quot;);</span>
<a href="#l5.359"></a><span id="l5.359"> </span>
<a href="#l5.360"></a><span id="l5.360">               // We switched tabs, so we don't need to know the last tab</span>
<a href="#l5.361"></a><span id="l5.361">               // opener anymore.</span>
<a href="#l5.362"></a><span id="l5.362">               this.mLastTabOpener = null;</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineplus">+</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineplus">+              let evt = new CustomEvent(&quot;TabSelect&quot;, { bubbles: true, detail: { tabInfo: tab } });</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineplus">+              this.tabContainer.selectedItem.dispatchEvent(evt);</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineplus">+</span>
<a href="#l5.367"></a><span id="l5.367">             }</span>
<a href="#l5.368"></a><span id="l5.368">           ]]&gt;</span>
<a href="#l5.369"></a><span id="l5.369">         &lt;/body&gt;</span>
<a href="#l5.370"></a><span id="l5.370">       &lt;/method&gt;</span>
<a href="#l5.371"></a><span id="l5.371">       &lt;method name=&quot;saveCurrentTabState&quot;&gt;</span>
<a href="#l5.372"></a><span id="l5.372">         &lt;body&gt;</span>
<a href="#l5.373"></a><span id="l5.373">           &lt;![CDATA[</span>
<a href="#l5.374"></a><span id="l5.374">             if (!this.currentTabInfo)</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineat">@@ -1222,34 +1293,50 @@</span>
<a href="#l5.376"></a><span id="l5.376">             let [iTab, tab, tabNode] =</span>
<a href="#l5.377"></a><span id="l5.377">               this._getTabContextForTabbyThing(aTabNodeOrInfo, true);</span>
<a href="#l5.378"></a><span id="l5.378"> </span>
<a href="#l5.379"></a><span id="l5.379">             if (tab)</span>
<a href="#l5.380"></a><span id="l5.380">             {</span>
<a href="#l5.381"></a><span id="l5.381">               let tabNode =</span>
<a href="#l5.382"></a><span id="l5.382">                 this.tabContainer.childNodes[iTab];</span>
<a href="#l5.383"></a><span id="l5.383"> </span>
<a href="#l5.384"></a><span id="l5.384" class="difflineplus">+              let defaultTabTitle = document.documentElement.getAttribute(&quot;defaultTabTitle&quot;);</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineplus">+              let oldLabel = tabNode.getAttribute(&quot;label&quot;);</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineplus">+              let newLabel = aTabNodeOrInfo ? tab.title : defaultTabTitle;</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineplus">+</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineplus">+              if (oldLabel == newLabel) {</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineplus">+                return;</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineplus">+              }</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineplus">+</span>
<a href="#l5.392"></a><span id="l5.392">               let titleChangeFunc = tab.mode.onTitleChanged ||</span>
<a href="#l5.393"></a><span id="l5.393">                                     tab.mode.tabType.onTitleChanged;</span>
<a href="#l5.394"></a><span id="l5.394">               if (titleChangeFunc)</span>
<a href="#l5.395"></a><span id="l5.395">                 titleChangeFunc.call(tab.mode.tabType, tab, tabNode);</span>
<a href="#l5.396"></a><span id="l5.396"> </span>
<a href="#l5.397"></a><span id="l5.397">               for (let tabMonitor of this.tabMonitors) {</span>
<a href="#l5.398"></a><span id="l5.398">                 tabMonitor.onTabTitleChanged(tab);</span>
<a href="#l5.399"></a><span id="l5.399">               }</span>
<a href="#l5.400"></a><span id="l5.400"> </span>
<a href="#l5.401"></a><span id="l5.401">               // If the displayed tab is the one at the moment of creation</span>
<a href="#l5.402"></a><span id="l5.402">               // (aTabNodeOrInfo is null), set the default title as its title.</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineminus">-              tabNode.setAttribute(&quot;label&quot;, aTabNodeOrInfo ?</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineminus">-                                            tab.title :</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineminus">-                                            document.documentElement.getAttribute(&quot;defaultTabTitle&quot;));</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineplus">+              tabNode.setAttribute(&quot;label&quot;, newLabel);</span>
<a href="#l5.407"></a><span id="l5.407"> </span>
<a href="#l5.408"></a><span id="l5.408">               // Update the window title if we're the displayed tab.</span>
<a href="#l5.409"></a><span id="l5.409">               if (iTab == this.tabContainer.selectedIndex)</span>
<a href="#l5.410"></a><span id="l5.410">                 this.setDocumentTitle(tab);</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineplus">+</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineplus">+              // Notify tab title change</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineplus">+              if (!tab.beforeTabOpen) {</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineplus">+                let evt = new CustomEvent(&quot;TabAttrModified&quot;, {</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineplus">+                  bubbles: true,</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineplus">+                  cancelable: false,</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineplus">+                  detail: { changed: [&quot;label&quot;], tabInfo: tab }</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineplus">+                });</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineplus">+                tabNode.dispatchEvent(evt);</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineplus">+              }</span>
<a href="#l5.421"></a><span id="l5.421">             }</span>
<a href="#l5.422"></a><span id="l5.422">           ]]&gt;</span>
<a href="#l5.423"></a><span id="l5.423">         &lt;/body&gt;</span>
<a href="#l5.424"></a><span id="l5.424">       &lt;/method&gt;</span>
<a href="#l5.425"></a><span id="l5.425">       &lt;!--</span>
<a href="#l5.426"></a><span id="l5.426">         - Sets the tab icon to the specified url, or removes the icon if no</span>
<a href="#l5.427"></a><span id="l5.427">         - url is specified. Note that this may override css provided images.</span>
<a href="#l5.428"></a><span id="l5.428">         --&gt;</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineat">@@ -1258,16 +1345,26 @@</span>
<a href="#l5.430"></a><span id="l5.430">         &lt;parameter name=&quot;aIcon&quot;/&gt;</span>
<a href="#l5.431"></a><span id="l5.431">         &lt;body&gt;</span>
<a href="#l5.432"></a><span id="l5.432">           &lt;![CDATA[</span>
<a href="#l5.433"></a><span id="l5.433">             let [iTab, tab, tabNode] =</span>
<a href="#l5.434"></a><span id="l5.434">               this._getTabContextForTabbyThing(aTabNodeOrInfo, true);</span>
<a href="#l5.435"></a><span id="l5.435"> </span>
<a href="#l5.436"></a><span id="l5.436">             if (tab) {</span>
<a href="#l5.437"></a><span id="l5.437">               let tabNode = this.tabContainer.childNodes[iTab];</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineplus">+              let oldIcon = tabNode.getAttribute(&quot;image&quot;);</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineplus">+</span>
<a href="#l5.440"></a><span id="l5.440" class="difflineplus">+              if (oldIcon != aIcon &amp;&amp; !tab.beforeTabOpen) {</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineplus">+                let evt = new CustomEvent(&quot;TabAttrModified&quot;, {</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineplus">+                  bubbles: true,</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineplus">+                  cancelable: false,</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineplus">+                  detail: { changed: [&quot;image&quot;], tabInfo: tab }</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineplus">+                });</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineplus">+                tabNode.dispatchEvent(evt);</span>
<a href="#l5.447"></a><span id="l5.447" class="difflineplus">+              }</span>
<a href="#l5.448"></a><span id="l5.448"> </span>
<a href="#l5.449"></a><span id="l5.449">               if (aIcon)</span>
<a href="#l5.450"></a><span id="l5.450">                 tabNode.setAttribute(&quot;image&quot;, aIcon);</span>
<a href="#l5.451"></a><span id="l5.451">               else</span>
<a href="#l5.452"></a><span id="l5.452">                 tabNode.removeAttribute(&quot;image&quot;);</span>
<a href="#l5.453"></a><span id="l5.453">             }</span>
<a href="#l5.454"></a><span id="l5.454">           ]]&gt;</span>
<a href="#l5.455"></a><span id="l5.455">         &lt;/body&gt;</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineat">@@ -1520,16 +1617,137 @@</span>
<a href="#l5.457"></a><span id="l5.457">               docTitle += docElement.getAttribute(&quot;titlemenuseparator&quot;) +</span>
<a href="#l5.458"></a><span id="l5.458">                           docElement.getAttribute(&quot;titlemodifier&quot;);</span>
<a href="#l5.459"></a><span id="l5.459">             }</span>
<a href="#l5.460"></a><span id="l5.460"> </span>
<a href="#l5.461"></a><span id="l5.461">             document.title = docTitle;</span>
<a href="#l5.462"></a><span id="l5.462">           ]]&gt;</span>
<a href="#l5.463"></a><span id="l5.463">         &lt;/body&gt;</span>
<a href="#l5.464"></a><span id="l5.464">       &lt;/method&gt;</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineplus">+      &lt;method name=&quot;addTabsProgressListener&quot;&gt;</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineplus">+        &lt;parameter name=&quot;aListener&quot;/&gt;</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineplus">+            this.mTabsProgressListeners.add(aListener);</span>
<a href="#l5.470"></a><span id="l5.470" class="difflineplus">+           ]]&gt;</span>
<a href="#l5.471"></a><span id="l5.471" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.472"></a><span id="l5.472" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.473"></a><span id="l5.473" class="difflineplus">+      &lt;method name=&quot;removeTabsProgressListener&quot;&gt;</span>
<a href="#l5.474"></a><span id="l5.474" class="difflineplus">+        &lt;parameter name=&quot;aListener&quot;/&gt;</span>
<a href="#l5.475"></a><span id="l5.475" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.477"></a><span id="l5.477" class="difflineplus">+            this.mTabsProgressListeners.delete(aListener);</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineplus">+           ]]&gt;</span>
<a href="#l5.479"></a><span id="l5.479" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.480"></a><span id="l5.480" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.481"></a><span id="l5.481" class="difflineplus">+      &lt;method name=&quot;_callTabListeners&quot;&gt;</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineplus">+        &lt;parameter name=&quot;aMethod&quot;/&gt;</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineplus">+        &lt;parameter name=&quot;aArgs&quot;/&gt;</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineplus">+            for (let listener of  this.mTabsProgressListeners.values()) {</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineplus">+              if (aMethod in listener) {</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineplus">+                try {</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineplus">+                  listener[aMethod](...aArgs);</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineplus">+                } catch (e) {</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineplus">+                  Cu.reportError(e);</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineplus">+                }</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineplus">+              }</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineplus">+            }</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineplus">+           ]]&gt;</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineplus">+      &lt;method name=&quot;onProgressChange&quot;&gt;</span>
<a href="#l5.499"></a><span id="l5.499" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineplus">+        &lt;parameter name=&quot;aRequest&quot;/&gt;</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineplus">+        &lt;parameter name=&quot;aCurSelf&quot;/&gt;</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineplus">+        &lt;parameter name=&quot;aMaxSelf&quot;/&gt;</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineplus">+        &lt;parameter name=&quot;aCurTotal&quot;/&gt;</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineplus">+        &lt;parameter name=&quot;aMaxTotal&quot;/&gt;</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.508"></a><span id="l5.508" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.509"></a><span id="l5.509" class="difflineplus">+          this._callTabListeners(&quot;onProgressChange&quot;, [browser, ...arguments]);</span>
<a href="#l5.510"></a><span id="l5.510" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.511"></a><span id="l5.511" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.512"></a><span id="l5.512" class="difflineplus">+      &lt;method name=&quot;onProgressChange64&quot;&gt;</span>
<a href="#l5.513"></a><span id="l5.513" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.514"></a><span id="l5.514" class="difflineplus">+        &lt;parameter name=&quot;aRequest&quot;/&gt;</span>
<a href="#l5.515"></a><span id="l5.515" class="difflineplus">+        &lt;parameter name=&quot;aCurSelf&quot;/&gt;</span>
<a href="#l5.516"></a><span id="l5.516" class="difflineplus">+        &lt;parameter name=&quot;aMaxSelf&quot;/&gt;</span>
<a href="#l5.517"></a><span id="l5.517" class="difflineplus">+        &lt;parameter name=&quot;aCurTotal&quot;/&gt;</span>
<a href="#l5.518"></a><span id="l5.518" class="difflineplus">+        &lt;parameter name=&quot;aMaxTotal&quot;/&gt;</span>
<a href="#l5.519"></a><span id="l5.519" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.520"></a><span id="l5.520" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.521"></a><span id="l5.521" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.522"></a><span id="l5.522" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.523"></a><span id="l5.523" class="difflineplus">+          this._callTabListeners(&quot;onProgressChange64&quot;, [browser, ...arguments]);</span>
<a href="#l5.524"></a><span id="l5.524" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineplus">+      &lt;method name=&quot;onLocationChange&quot;&gt;</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineplus">+        &lt;parameter name=&quot;aRequest&quot;/&gt;</span>
<a href="#l5.529"></a><span id="l5.529" class="difflineplus">+        &lt;parameter name=&quot;aLocationURI&quot;/&gt;</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineplus">+        &lt;parameter name=&quot;aFlags&quot;/&gt;</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.534"></a><span id="l5.534" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineplus">+          this._callTabListeners(&quot;onLocationChange&quot;, [browser, ...arguments]);</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineplus">+      &lt;method name=&quot;onStateChange&quot;&gt;</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.540"></a><span id="l5.540" class="difflineplus">+        &lt;parameter name=&quot;aRequest&quot;/&gt;</span>
<a href="#l5.541"></a><span id="l5.541" class="difflineplus">+        &lt;parameter name=&quot;aStateFlags&quot;/&gt;</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineplus">+        &lt;parameter name=&quot;aStatus&quot;/&gt;</span>
<a href="#l5.543"></a><span id="l5.543" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.544"></a><span id="l5.544" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.545"></a><span id="l5.545" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.546"></a><span id="l5.546" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.547"></a><span id="l5.547" class="difflineplus">+          this._callTabListeners(&quot;onStateChange&quot;, [browser, ...arguments]);</span>
<a href="#l5.548"></a><span id="l5.548" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.549"></a><span id="l5.549" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineplus">+      &lt;method name=&quot;onStatusChange&quot;&gt;</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineplus">+        &lt;parameter name=&quot;aRequest&quot;/&gt;</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineplus">+        &lt;parameter name=&quot;aStatus&quot;/&gt;</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineplus">+        &lt;parameter name=&quot;aMessage&quot;/&gt;</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineplus">+          this._callTabListeners(&quot;onStatusChange&quot;, [browser, ...arguments]);</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineplus">+      &lt;method name=&quot;onSecurityChange&quot;&gt;</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineplus">+        &lt;parameter name=&quot;aRequest&quot;/&gt;</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineplus">+        &lt;parameter name=&quot;aState&quot;/&gt;</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineplus">+          this._callTabListeners(&quot;onSecurityChange&quot;, [browser, ...arguments]);</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.573"></a><span id="l5.573" class="difflineplus">+      &lt;method name=&quot;onRefreshAttempted&quot;&gt;</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineplus">+        &lt;parameter name=&quot;aWebProgress&quot;/&gt;</span>
<a href="#l5.575"></a><span id="l5.575" class="difflineplus">+        &lt;parameter name=&quot;aURI&quot;/&gt;</span>
<a href="#l5.576"></a><span id="l5.576" class="difflineplus">+        &lt;parameter name=&quot;aDelay&quot;/&gt;</span>
<a href="#l5.577"></a><span id="l5.577" class="difflineplus">+        &lt;parameter name=&quot;aSameURI&quot;/&gt;</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineplus">+          let browser = aWebProgress.QueryInterface(Ci.nsIDocShellTreeItem)</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineplus">+                                    .sameTypeRootTreeItem</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineplus">+                                    .chromeEventHandler;</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineplus">+          this._callTabListeners(&quot;onRefreshAttempted&quot;, [browser, ...arguments]);</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineplus">+</span>
<a href="#l5.586"></a><span id="l5.586">     &lt;/implementation&gt;</span>
<a href="#l5.587"></a><span id="l5.587">   &lt;/binding&gt;</span>
<a href="#l5.588"></a><span id="l5.588"> </span>
<a href="#l5.589"></a><span id="l5.589">   &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l5.590"></a><span id="l5.590">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tab&quot;&gt;</span>
<a href="#l5.591"></a><span id="l5.591">     &lt;content closetabtext=&quot;&amp;closeTab.label;&quot; context=&quot;tabContextMenu&quot;&gt;</span>
<a href="#l5.592"></a><span id="l5.592">       &lt;xul:stack class=&quot;tab-stack&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l5.593"></a><span id="l5.593">         &lt;xul:vbox xbl:inherits=&quot;pinned,selected,titlechanged&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mail/components/extensions/child/ext-mail.js</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,15 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+extensions.registerModules({</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+  tabs: {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    url: &quot;chrome://messenger/content/child/ext-tabs.js&quot;,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    scopes: [&quot;addon_child&quot;],</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    paths: [</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+      [&quot;tabs&quot;],</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+    ],</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+  }</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/mail/components/extensions/child/ext-tabs.js</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,39 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+this.tabs = class extends ExtensionAPI {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  getAPI(context) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    return {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+      tabs: {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+        connect: function(tabId, connectInfo) {</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+          let name = &quot;&quot;;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+          if (connectInfo &amp;&amp; connectInfo.name !== null) {</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+            name = connectInfo.name;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+          }</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+          let recipient = {</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+            extensionId: context.extension.id,</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+            tabId,</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+          };</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+          if (connectInfo &amp;&amp; connectInfo.frameId !== null) {</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+            recipient.frameId = connectInfo.frameId;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+          }</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+          return context.messenger.connect(context.messageManager, name, recipient);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+        },</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+        sendMessage: function(tabId, message, options, responseCallback) {</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+          let recipient = {</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+            extensionId: context.extension.id,</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+            tabId: tabId,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+          };</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+          if (options &amp;&amp; options.frameId !== null) {</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+            recipient.frameId = options.frameId;</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+          }</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+          return context.messenger.sendMessage(context.messageManager, message, recipient, responseCallback);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+        },</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+      },</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+    };</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  }</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mail/components/extensions/ext-mail.json</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,18 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+{</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+  &quot;tabs&quot;: {</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+    &quot;url&quot;: &quot;chrome://messenger/content/parent/ext-tabs.js&quot;,</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+    &quot;schema&quot;: &quot;chrome://messenger/content/schemas/tabs.json&quot;,</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+    &quot;scopes&quot;: [&quot;addon_parent&quot;],</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+    &quot;paths&quot;: [</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+      [&quot;tabs&quot;]</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+    ]</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  },</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  &quot;windows&quot;: {</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    &quot;url&quot;: &quot;chrome://messenger/content/parent/ext-windows.js&quot;,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    &quot;schema&quot;: &quot;chrome://messenger/content/schemas/windows.json&quot;,</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+    &quot;scopes&quot;: [&quot;addon_parent&quot;],</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+    &quot;paths&quot;: [</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+      [&quot;windows&quot;]</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+    ]</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+  }</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mail/components/extensions/extensions-mail.manifest</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+category webextension-modules mail chrome://messenger/content/ext-mail.json</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+category webextension-scripts c-mail chrome://messenger/content/parent/ext-mail.js</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+category webextension-scripts-addon mail chrome://messenger/content/child/ext-mail.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mail/components/extensions/jar.mn</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,16 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+messenger.jar:</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+    content/messenger/ext-mail.json                (ext-mail.json)</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+    content/messenger/parent/ext-mail.js           (parent/ext-mail.js)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    content/messenger/parent/ext-tabs.js           (parent/ext-tabs.js)</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+    content/messenger/parent/ext-windows.js        (parent/ext-windows.js)</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+    content/messenger/child/ext-tabs.js            (child/ext-tabs.js)</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+    content/messenger/child/ext-mail.js            (child/ext-mail.js)</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+    content/messenger/schemas/tabs.json     (schemas/tabs.json)</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+    content/messenger/schemas/windows.json  (schemas/windows.json)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mail/components/extensions/moz.build</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,9 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+EXTRA_COMPONENTS += [</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+    'extensions-mail.manifest',</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+]</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+JAR_MANIFESTS += ['jar.mn']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,954 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+ChromeUtils.defineModuleGetter(this, &quot;PrivateBrowsingUtils&quot;,</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+                               &quot;resource://gre/modules/PrivateBrowsingUtils.jsm&quot;);</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+var {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  ExtensionError,</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  defineLazyGetter,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+} = ExtensionUtils;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+let tabTracker;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+let windowTracker;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+// This function is pretty tightly tied to Extension.jsm.</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+// Its job is to fill in the |tab| property of the sender.</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+const getSender = (extension, target, sender) =&gt; {</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+  let tabId = -1;</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+  if (&quot;tabId&quot; in sender) {</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+    // The message came from a privileged extension page running in a tab. In</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+    // that case, it should include a tabId property (which is filled in by the</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+    // page-open listener below).</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+    tabId = sender.tabId;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+    delete sender.tabId;</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+  } else if (ExtensionUtils.instanceOf(target, &quot;XULElement&quot;) ||</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+             ExtensionUtils.instanceOf(target, &quot;HTMLIFrameElement&quot;)) {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+    tabId = tabTracker.getBrowserData(target).tabId;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+  }</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  if (tabId != null &amp;&amp; tabId &gt;= 0) {</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+    let tab = extension.tabManager.get(tabId, null);</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+    if (tab) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+      sender.tab = tab.convert();</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+    }</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+  }</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+};</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+// Used by Extension.jsm</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+global.tabGetSender = getSender;</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+global.makeWidgetId = id =&gt; {</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+  id = id.toLowerCase();</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+  // FIXME: This allows for collisions.</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+  return id.replace(/[^a-z0-9_-]/g, &quot;_&quot;);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+};</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+/**</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+ * Gets the tab browser for the tabmail tabInfo</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+ *</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+ * @param {NativeTabInfo} nativeTabInfo     The tabInfo object to get the browser for</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+ * @return {?XULElement}                    The browser element for the tab</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+ */</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+function getTabBrowser(nativeTabInfo) {</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+  if (!nativeTabInfo) {</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+    return null;</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+  }</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+  if (nativeTabInfo.mode.getBrowser) {</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+    return nativeTabInfo.mode.getBrowser(nativeTabInfo);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+  }</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+  if (nativeTabInfo.mode.tabType.getBrowser) {</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+    return nativeTabInfo.mode.tabType.getBrowser(nativeTabInfo);</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+  }</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+  return null;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+}</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+global.getTabBrowser = getTabBrowser;</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+/**</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+ * Thw window tracker tracks opening and closing Thunderbird windows. Each window has an id, which</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+ * is mapped to native window objects.</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+ */</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+class WindowTracker extends WindowTrackerBase {</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+  /**</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+   * Adds a tab progress listener to the given mail window</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+   *</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+   * @param {DOMWindow} window      The mail window to which to add the listener.</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+   * @param {Object} listener       The listener to add</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineplus">+   */</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+  addProgressListener(window, listener) {</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+    let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+    tabmail.addTabsProgressListener(listener);</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+  }</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineplus">+</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+  /**</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+   * Removes a tab progress listener from the given mail window.</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+   *</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+   * @param {DOMWindow} window      The mail window from which to remove the listener.</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+   * @param {Object} listener       The listener to remove</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineplus">+   */</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineplus">+  removeProgressListener(window, listener) {</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineplus">+    let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+    tabmail.removeTabsProgressListener(listener);</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineplus">+  }</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineplus">+</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineplus">+  /**</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+   * Determines if the passed window object is a mail window. The function name is for base class</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+   * compatibility with gecko.</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineplus">+   *</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineplus">+   * @param {DOMWindow} window      The window to check</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+   * @return {Boolean}              True, if the window is a mail window</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+   */</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+  isBrowserWindow(window) {</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+    let { documentElement } = window.document;</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineplus">+</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+    return documentElement.getAttribute(&quot;windowtype&quot;) === &quot;mail:3pane&quot;;</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineplus">+  }</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineplus">+</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+  /**</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+   * The currently active, or topmost, mail window, or null if no mail window is currently open.</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+   *</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+   * @property {?DOMWindow} topWindow</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+   * @readonly</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+   */</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+  get topWindow() {</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+    return Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+  }</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+  /**</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+   * The currently active, or topmost, mail window, or null if no mail window is currently open.</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+   * Will only return the topmost &quot;normal&quot; (i.e., not popup) window.</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+   *</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+   * @property {?DOMWindow} topNormalWindow</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+   * @readonly</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+   */</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+  get topNormalWindow() {</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+    let win = null;</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineplus">+      let windowList = Services.wm.getZOrderDOMWindowEnumerator(&quot;mail:3pane&quot;, true);</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineplus">+      if (!windowList.hasMoreElements()) {</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+        return null;</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineplus">+      }</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineplus">+      win = windowList.getNext();</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineplus">+      while (win.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineplus">+        if (!windowList.hasMoreElements()) {</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+          return null;</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineplus">+        }</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineplus">+        win = windowList.getNext();</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+      }</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineplus">+    } else {</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+      // Platforms other than Windows have a broken z-order...</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+      win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;, true);</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineplus">+</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineplus">+      // If we're lucky, this isn't a popup, and we can just return this.</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+      if (win &amp;&amp; win.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineplus">+        win = null;</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineplus">+        let windowList = Services.wm.getEnumerator(&quot;mail:3pane&quot;, true);</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineplus">+        // This is oldest to newest, so this gets a bit ugly.</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineplus">+        while (windowList.hasMoreElements()) {</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+          let nextWin = windowList.getNext();</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineplus">+          if (!nextWin.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineplus">+            win = nextWin;</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineplus">+          }</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineplus">+        }</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineplus">+      }</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineplus">+    }</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+    return win;</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineplus">+  }</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineplus">+}</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineplus">+</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineplus">+/**</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineplus">+ * An event manager API provider which listens for a DOM event in any mail</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineplus">+ * window, and calls the given listener function whenever an event is received.</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineplus">+ * That listener function receives a `fire` object, which it can use to dispatch</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineplus">+ * events to the extension, and a DOM event object.</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineplus">+ *</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineplus">+ * @param {BaseContext} context</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineplus">+ *        The extension context which the event manager belongs to.</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineplus">+ * @param {string} name</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineplus">+ *        The API name of the event manager, e.g.,&quot;runtime.onMessage&quot;.</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineplus">+ * @param {string} event</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineplus">+ *        The name of the DOM event to listen for.</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineplus">+ * @param {function} listener</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+ *        The listener function to call when a DOM event is received.</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+ */</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineplus">+global.WindowEventManager = class extends EventManager {</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineplus">+  constructor(context, name, event, listener) {</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineplus">+    super(context, name, fire =&gt; {</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineplus">+      let listener2 = listener.bind(null, fire);</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineplus">+</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineplus">+      windowTracker.addListener(event, listener2);</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineplus">+      return () =&gt; {</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineplus">+        windowTracker.removeListener(event, listener2);</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineplus">+      };</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineplus">+    });</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineplus">+  }</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineplus">+};</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineplus">+</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineplus">+/**</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineplus">+ * Tracks the opening and closing of tabs and maps them between their numeric WebExtension ID and</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineplus">+ * the native tab info objects</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+ */</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineplus">+class TabTracker extends TabTrackerBase {</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+  constructor() {</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+    super();</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineplus">+</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+    this._tabs = new WeakMap();</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineplus">+    this._browsers = new WeakMap();</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineplus">+    this._tabIds = new Map();</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineplus">+    this._nextId = 1;</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineplus">+    this._movingTabs = new Map();</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineplus">+</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineplus">+    this._handleTabDestroyed = this._handleTabDestroyed.bind(this);</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineplus">+  }</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineplus">+</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineplus">+  /**</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineplus">+   * Initialize tab tracking listeners the first time that an event listener is added</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineplus">+   */</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+  init() {</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineplus">+    if (this.initialized) {</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineplus">+      return;</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineplus">+    }</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineplus">+    this.initialized = true;</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineplus">+</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineplus">+    this._handleWindowOpen = this._handleWindowOpen.bind(this);</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineplus">+    this._handleWindowClose = this._handleWindowClose.bind(this);</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineplus">+</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineplus">+    windowTracker.addListener(&quot;TabClose&quot;, this);</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineplus">+    windowTracker.addListener(&quot;TabOpen&quot;, this);</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineplus">+    windowTracker.addListener(&quot;TabSelect&quot;, this);</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineplus">+    windowTracker.addOpenListener(this._handleWindowOpen);</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+    windowTracker.addCloseListener(this._handleWindowClose);</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineplus">+</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineplus">+    /* eslint-disable mozilla/balanced-listeners */</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineplus">+    this.on(&quot;tab-detached&quot;, this._handleTabDestroyed);</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+    this.on(&quot;tab-removed&quot;, this._handleTabDestroyed);</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineplus">+    /* eslint-enable mozilla/balanced-listeners */</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineplus">+  }</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineplus">+</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineplus">+  /**</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineplus">+   * Returns the numeric ID for the given native tab.</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineplus">+   *</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo       The tabmail tabInfo for which to return an ID</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineplus">+   * @return {Integer}                          The tab's numeric ID</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineplus">+   */</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineplus">+  getId(nativeTabInfo) {</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineplus">+    let id = this._tabs.get(nativeTabInfo);</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineplus">+    if (id) {</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineplus">+      return id;</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineplus">+    }</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineplus">+</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineplus">+    this.init();</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineplus">+</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineplus">+    id = this._nextId++;</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineplus">+    this.setId(nativeTabInfo, id);</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineplus">+    return id;</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineplus">+  }</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineplus">+</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineplus">+  /**</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+   * Returns the tab id corresponding to the given browser element</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+   *</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+   * @param {XULElement} browser        The &lt;browser&gt; element to retrieve for</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineplus">+   * @return {Integer}                  The tab's numeric ID</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineplus">+   */</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+  getBrowserTabId(browser) {</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineplus">+    let id = this._browsers.get(browser);</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineplus">+    if (id) {</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineplus">+      return id;</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineplus">+    }</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineplus">+</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineplus">+    let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineplus">+    let tab = tabmail &amp;&amp; tabmail.tabInfo.find(info =&gt; getTabBrowser(info) == browser);</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineplus">+</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineplus">+    if (tab) {</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineplus">+      id = this.getId(tab);</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineplus">+      this._browsers.set(browser, id);</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineplus">+      return id;</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineplus">+    }</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineplus">+    return -1;</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineplus">+  }</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineplus">+</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineplus">+  /**</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineplus">+   * Records the tab information for the given tabInfo object</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineplus">+   *</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo       The tab info to record for</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineplus">+   * @param {Integer} id                        The tab id to record</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineplus">+   */</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineplus">+  setId(nativeTabInfo, id) {</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineplus">+    this._tabs.set(nativeTabInfo, id);</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineplus">+    let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineplus">+    if (browser) {</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineplus">+      this._browsers.set(browser, id);</span>
<a href="#l12.293"></a><span id="l12.293" class="difflineplus">+    }</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineplus">+    this._tabIds.set(id, nativeTabInfo);</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineplus">+  }</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineplus">+</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineplus">+  /**</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineplus">+   * Function to call when a tab was close, deletes tab information for the tab</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineplus">+   *</span>
<a href="#l12.300"></a><span id="l12.300" class="difflineplus">+   * @param {Event} event                  The event triggering the detroyal</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineplus">+   * @param {{ nativeTabInfo:NativeTabInfo}}  The object containing tab info</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineplus">+   */</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineplus">+  _handleTabDestroyed(event, { nativeTabInfo }) {</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineplus">+    let id = this._tabs.get(nativeTabInfo);</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineplus">+    if (id) {</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineplus">+      this._tabs.delete(nativeTabInfo);</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineplus">+      if (this._tabIds.get(id) === nativeTabInfo) {</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineplus">+        this._tabIds.delete(id);</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineplus">+      }</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineplus">+    }</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+  }</span>
<a href="#l12.312"></a><span id="l12.312" class="difflineplus">+</span>
<a href="#l12.313"></a><span id="l12.313" class="difflineplus">+  /**</span>
<a href="#l12.314"></a><span id="l12.314" class="difflineplus">+   * Returns the native tab with the given numeric ID.</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineplus">+   *</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineplus">+   * @param {Integer} tabId     The numeric ID of the tab to return.</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineplus">+   * @param {*} default_        The value to return if no tab exists with the given ID.</span>
<a href="#l12.318"></a><span id="l12.318" class="difflineplus">+   * @return {NativeTabInfo}    The tab information for the given id.</span>
<a href="#l12.319"></a><span id="l12.319" class="difflineplus">+   */</span>
<a href="#l12.320"></a><span id="l12.320" class="difflineplus">+  getTab(tabId, default_ = undefined) {</span>
<a href="#l12.321"></a><span id="l12.321" class="difflineplus">+    let nativeTabInfo = this._tabIds.get(tabId);</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineplus">+    if (nativeTabInfo) {</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineplus">+      return nativeTabInfo;</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineplus">+    }</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineplus">+    if (default_ !== undefined) {</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineplus">+      return default_;</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineplus">+    }</span>
<a href="#l12.328"></a><span id="l12.328" class="difflineplus">+    throw new ExtensionError(`Invalid tab ID: ${tabId}`);</span>
<a href="#l12.329"></a><span id="l12.329" class="difflineplus">+  }</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineplus">+</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineplus">+  /**</span>
<a href="#l12.332"></a><span id="l12.332" class="difflineplus">+   * Handles load events for recently-opened windows, and adds additional</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineplus">+   * listeners which may only be safely added when the window is fully loaded.</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineplus">+   *</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineplus">+   * @param {Event} event       A DOM event to handle.</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineplus">+   */</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineplus">+  handleEvent(event) {</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineplus">+    let nativeTabInfo = event.detail.tabInfo;</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineplus">+    if (!getTabBrowser(nativeTabInfo)) {</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineplus">+      // We don't care about events for tabs that don't have a browser</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineplus">+      return;</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineplus">+    }</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineplus">+</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineplus">+    switch (event.type) {</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineplus">+      case &quot;TabOpen&quot;: {</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineplus">+        // Save the current tab, since the newly-created tab will likely be</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineplus">+        // active by the time the promise below resolves and the event is</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineplus">+        // dispatched.</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineplus">+        let tabmail = event.target.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineplus">+        let currentTab = tabmail.selectedTab;</span>
<a href="#l12.351"></a><span id="l12.351" class="difflineplus">+</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineplus">+        // We need to delay sending this event until the next tick, since the</span>
<a href="#l12.353"></a><span id="l12.353" class="difflineplus">+        // tab does not have its final index when the TabOpen event is dispatched.</span>
<a href="#l12.354"></a><span id="l12.354" class="difflineplus">+        Promise.resolve().then(() =&gt; {</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineplus">+          if (event.detail.moving) {</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineplus">+            let srcTabId = this._movingTabs.get(event.detail.moving);</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineplus">+            this.setId(nativeTabInfo, srcTabId);</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineplus">+            this._movingTabs.delete(event.detail.moving);</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineplus">+</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineplus">+            this.emitAttached(nativeTabInfo);</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineplus">+          } else {</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineplus">+            this.emitCreated(nativeTabInfo, currentTab);</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineplus">+          }</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineplus">+        });</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineplus">+        break;</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineplus">+      }</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineplus">+</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineplus">+      case &quot;TabClose&quot;: {</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineplus">+        if (event.detail.moving) {</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineplus">+          this._movingTabs.set(event.detail.moving, this.getId(nativeTabInfo));</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineplus">+          this.emitDetached(nativeTabInfo);</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineplus">+        } else {</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineplus">+          this.emitRemoved(nativeTabInfo, false);</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineplus">+        }</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineplus">+        break;</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineplus">+      }</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineplus">+</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineplus">+      case &quot;TabSelect&quot;:</span>
<a href="#l12.379"></a><span id="l12.379" class="difflineplus">+        // Because we are delaying calling emitCreated above, we also need to</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineplus">+        // delay sending this event because it shouldn't fire before onCreated.</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineplus">+        Promise.resolve().then(() =&gt; {</span>
<a href="#l12.382"></a><span id="l12.382" class="difflineplus">+          this.emitActivated(nativeTabInfo);</span>
<a href="#l12.383"></a><span id="l12.383" class="difflineplus">+        });</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineplus">+        break;</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineplus">+    }</span>
<a href="#l12.386"></a><span id="l12.386" class="difflineplus">+  }</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineplus">+</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineplus">+  /**</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineplus">+   * A private method which is called whenever a new mail window is opened, and dispatches the</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineplus">+   * necessary events for it.</span>
<a href="#l12.391"></a><span id="l12.391" class="difflineplus">+   *</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineplus">+   * @param {DOMWindow} window      The window being opened.</span>
<a href="#l12.393"></a><span id="l12.393" class="difflineplus">+   */</span>
<a href="#l12.394"></a><span id="l12.394" class="difflineplus">+  _handleWindowOpen(window) {</span>
<a href="#l12.395"></a><span id="l12.395" class="difflineplus">+    let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.396"></a><span id="l12.396" class="difflineplus">+    for (let nativeTabInfo of tabmail.tabInfo) {</span>
<a href="#l12.397"></a><span id="l12.397" class="difflineplus">+      if (!getTabBrowser(nativeTabInfo)) {</span>
<a href="#l12.398"></a><span id="l12.398" class="difflineplus">+        continue;</span>
<a href="#l12.399"></a><span id="l12.399" class="difflineplus">+      }</span>
<a href="#l12.400"></a><span id="l12.400" class="difflineplus">+      this.emitCreated(nativeTabInfo);</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineplus">+    }</span>
<a href="#l12.402"></a><span id="l12.402" class="difflineplus">+  }</span>
<a href="#l12.403"></a><span id="l12.403" class="difflineplus">+</span>
<a href="#l12.404"></a><span id="l12.404" class="difflineplus">+  /**</span>
<a href="#l12.405"></a><span id="l12.405" class="difflineplus">+   * A private method which is called whenever a mail window is closed, and dispatches the necessary</span>
<a href="#l12.406"></a><span id="l12.406" class="difflineplus">+   * events for it.</span>
<a href="#l12.407"></a><span id="l12.407" class="difflineplus">+   *</span>
<a href="#l12.408"></a><span id="l12.408" class="difflineplus">+   * @param {DOMWindow} window      The window being closed.</span>
<a href="#l12.409"></a><span id="l12.409" class="difflineplus">+   */</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineplus">+  _handleWindowClose(window) {</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineplus">+    let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.412"></a><span id="l12.412" class="difflineplus">+    for (let nativeTabInfo of tabmail.tabInfo) {</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineplus">+      if (!getTabBrowser(nativeTabInfo)) {</span>
<a href="#l12.414"></a><span id="l12.414" class="difflineplus">+        continue;</span>
<a href="#l12.415"></a><span id="l12.415" class="difflineplus">+      }</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineplus">+      this.emitRemoved(nativeTabInfo, true);</span>
<a href="#l12.417"></a><span id="l12.417" class="difflineplus">+    }</span>
<a href="#l12.418"></a><span id="l12.418" class="difflineplus">+  }</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineplus">+</span>
<a href="#l12.420"></a><span id="l12.420" class="difflineplus">+  /**</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineplus">+   * Emits a &quot;tab-activated&quot; event for the given tab info.</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineplus">+   *</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo   The tab info which has been activated.</span>
<a href="#l12.424"></a><span id="l12.424" class="difflineplus">+   */</span>
<a href="#l12.425"></a><span id="l12.425" class="difflineplus">+  emitActivated(nativeTabInfo) {</span>
<a href="#l12.426"></a><span id="l12.426" class="difflineplus">+    let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l12.427"></a><span id="l12.427" class="difflineplus">+</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineplus">+    this.emit(&quot;tab-activated&quot;, {</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineplus">+      tabId: this.getId(nativeTabInfo),</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineplus">+      windowId: windowTracker.getId(browser.ownerGlobal)</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineplus">+    });</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineplus">+  }</span>
<a href="#l12.433"></a><span id="l12.433" class="difflineplus">+</span>
<a href="#l12.434"></a><span id="l12.434" class="difflineplus">+  /**</span>
<a href="#l12.435"></a><span id="l12.435" class="difflineplus">+   * Emits a &quot;tab-attached&quot; event for the given tab info.</span>
<a href="#l12.436"></a><span id="l12.436" class="difflineplus">+   *</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo   The tab info which is being attached.</span>
<a href="#l12.438"></a><span id="l12.438" class="difflineplus">+   */</span>
<a href="#l12.439"></a><span id="l12.439" class="difflineplus">+  emitAttached(nativeTabInfo) {</span>
<a href="#l12.440"></a><span id="l12.440" class="difflineplus">+    let tabId = this.getId(nativeTabInfo);</span>
<a href="#l12.441"></a><span id="l12.441" class="difflineplus">+    let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l12.442"></a><span id="l12.442" class="difflineplus">+    let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.443"></a><span id="l12.443" class="difflineplus">+    let tabIndex = tabmail._getTabContextForTabbyThing(nativeTabInfo)[0];</span>
<a href="#l12.444"></a><span id="l12.444" class="difflineplus">+    let newWindowId = windowTracker.getId(browser.ownerGlobal);</span>
<a href="#l12.445"></a><span id="l12.445" class="difflineplus">+</span>
<a href="#l12.446"></a><span id="l12.446" class="difflineplus">+    this.emit(&quot;tab-attached&quot;, { nativeTabInfo, tabId, newWindowId, newPosition: tabIndex });</span>
<a href="#l12.447"></a><span id="l12.447" class="difflineplus">+  }</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineplus">+</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineplus">+  /**</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineplus">+   * Emits a &quot;tab-detached&quot; event for the given tab info.</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineplus">+   *</span>
<a href="#l12.452"></a><span id="l12.452" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo   The tab info which is being detached.</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineplus">+   */</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineplus">+  emitDetached(nativeTabInfo) {</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineplus">+    let tabId = this.getId(nativeTabInfo);</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineplus">+    let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l12.457"></a><span id="l12.457" class="difflineplus">+    let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.458"></a><span id="l12.458" class="difflineplus">+    let tabIndex = tabmail._getTabContextForTabbyThing(nativeTabInfo)[0];</span>
<a href="#l12.459"></a><span id="l12.459" class="difflineplus">+    let oldWindowId = windowTracker.getId(browser.ownerGlobal);</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineplus">+</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineplus">+    this.emit(&quot;tab-detached&quot;, { nativeTabInfo, tabId, oldWindowId, oldPosition: tabIndex });</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineplus">+  }</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineplus">+</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineplus">+  /**</span>
<a href="#l12.465"></a><span id="l12.465" class="difflineplus">+   * Emits a &quot;tab-created&quot; event for the given tab info.</span>
<a href="#l12.466"></a><span id="l12.466" class="difflineplus">+   *</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo   The tab info which is being created.</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineplus">+   * @param {?NativeTab} currentTab         The tab info for the currently active tab.</span>
<a href="#l12.469"></a><span id="l12.469" class="difflineplus">+   */</span>
<a href="#l12.470"></a><span id="l12.470" class="difflineplus">+  emitCreated(nativeTabInfo, currentTab) {</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineplus">+    this.emit(&quot;tab-created&quot;, { nativeTabInfo, currentTab });</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineplus">+  }</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineplus">+</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineplus">+  /**</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineplus">+   * Emits a &quot;tab-removed&quot; event for the given tab info.</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineplus">+   *</span>
<a href="#l12.477"></a><span id="l12.477" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo   The tab info in the window to which the tab is being</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineplus">+   *                                          removed</span>
<a href="#l12.479"></a><span id="l12.479" class="difflineplus">+   * @param {Boolean} isWindowClosing       If true, the window with these tabs is closing</span>
<a href="#l12.480"></a><span id="l12.480" class="difflineplus">+   */</span>
<a href="#l12.481"></a><span id="l12.481" class="difflineplus">+  emitRemoved(nativeTabInfo, isWindowClosing) {</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineplus">+    let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineplus">+    let windowId = windowTracker.getId(browser.ownerGlobal);</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineplus">+    let tabId = this.getId(nativeTabInfo);</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineplus">+</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineplus">+    this.emit(&quot;tab-removed&quot;, { nativeTabInfo, tabId, windowId, isWindowClosing });</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineplus">+  }</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineplus">+</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineplus">+  /**</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineplus">+   * Returns tab id and window id for the given browser element</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineplus">+   *</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineplus">+   * @param {Element} browser                       The browser element to check</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineplus">+   * @return {{ tabId:Integer, windowId:Integer }}  The browsing data for the element</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineplus">+   */</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineplus">+  getBrowserData(browser) {</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineplus">+    return {</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineplus">+      tabId: this.getBrowserTabId(browser),</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineplus">+      windowId: windowTracker.getId(browser.ownerGlobal)</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineplus">+    };</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineplus">+  }</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineplus">+</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineplus">+  /**</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineplus">+   * Returns the active tab info for the given window</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineplus">+   *</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineplus">+   * @property {?NativeTabInfo} activeTab       The active tab</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineplus">+   * @readonly</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineplus">+   */</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineplus">+  get activeTab() {</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineplus">+    let window = windowTracker.topWindow;</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineplus">+    let tabmail = window &amp;&amp; window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineplus">+    return tabmail ? tabmail.selectedTab : null;</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineplus">+  }</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineplus">+}</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineplus">+</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineplus">+tabTracker = new TabTracker();</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineplus">+windowTracker = new WindowTracker();</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineplus">+Object.assign(global, { tabTracker, windowTracker });</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineplus">+</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineplus">+/**</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineplus">+ * Extension-specific wrapper around a Thunderbird tab</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineplus">+ */</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineplus">+class Tab extends TabBase {</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineplus">+  /** Returns the XUL browser for the tab. */</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineplus">+  get browser() {</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineplus">+    return getTabBrowser(this.nativeTab);</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineplus">+  }</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineplus">+</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineplus">+  /** Returns the tabmail element for the tab. */</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineplus">+  get tabmail() {</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineplus">+    return this.browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineplus">+  }</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineplus">+</span>
<a href="#l12.533"></a><span id="l12.533" class="difflineplus">+  /** Returns the frame loader for the tab */</span>
<a href="#l12.534"></a><span id="l12.534" class="difflineplus">+  get frameLoader() {</span>
<a href="#l12.535"></a><span id="l12.535" class="difflineplus">+    // If we don't have a frameLoader yet, just return a dummy with no width and</span>
<a href="#l12.536"></a><span id="l12.536" class="difflineplus">+    // height.</span>
<a href="#l12.537"></a><span id="l12.537" class="difflineplus">+    return super.frameLoader || { lazyWidth: 0, lazyHeight: 0 };</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineplus">+  }</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineplus">+</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineplus">+  /** Returns the favIcon, without permission checks */</span>
<a href="#l12.541"></a><span id="l12.541" class="difflineplus">+  get _favIconUrl() {</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineplus">+    return this.browser.mIconURL;</span>
<a href="#l12.543"></a><span id="l12.543" class="difflineplus">+  }</span>
<a href="#l12.544"></a><span id="l12.544" class="difflineplus">+</span>
<a href="#l12.545"></a><span id="l12.545" class="difflineplus">+  /** Returns the last accessed time */</span>
<a href="#l12.546"></a><span id="l12.546" class="difflineplus">+  get lastAccessed() {</span>
<a href="#l12.547"></a><span id="l12.547" class="difflineplus">+    return 0;</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineplus">+  }</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineplus">+</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineplus">+  /** Returns the audible state */</span>
<a href="#l12.551"></a><span id="l12.551" class="difflineplus">+  get audible() {</span>
<a href="#l12.552"></a><span id="l12.552" class="difflineplus">+    return false;</span>
<a href="#l12.553"></a><span id="l12.553" class="difflineplus">+  }</span>
<a href="#l12.554"></a><span id="l12.554" class="difflineplus">+</span>
<a href="#l12.555"></a><span id="l12.555" class="difflineplus">+  /** Returns the cookie store id */</span>
<a href="#l12.556"></a><span id="l12.556" class="difflineplus">+  get cookieStoreId() {</span>
<a href="#l12.557"></a><span id="l12.557" class="difflineplus">+    return 0;</span>
<a href="#l12.558"></a><span id="l12.558" class="difflineplus">+  }</span>
<a href="#l12.559"></a><span id="l12.559" class="difflineplus">+</span>
<a href="#l12.560"></a><span id="l12.560" class="difflineplus">+  /** Returns the discarded state */</span>
<a href="#l12.561"></a><span id="l12.561" class="difflineplus">+  get discarded() {</span>
<a href="#l12.562"></a><span id="l12.562" class="difflineplus">+    return false;</span>
<a href="#l12.563"></a><span id="l12.563" class="difflineplus">+  }</span>
<a href="#l12.564"></a><span id="l12.564" class="difflineplus">+</span>
<a href="#l12.565"></a><span id="l12.565" class="difflineplus">+  /** Returns the tab height */</span>
<a href="#l12.566"></a><span id="l12.566" class="difflineplus">+  get height() {</span>
<a href="#l12.567"></a><span id="l12.567" class="difflineplus">+    return this.frameLoader.lazyHeight;</span>
<a href="#l12.568"></a><span id="l12.568" class="difflineplus">+  }</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineplus">+</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineplus">+  /** Returns hidden status */</span>
<a href="#l12.571"></a><span id="l12.571" class="difflineplus">+  get hidden() {</span>
<a href="#l12.572"></a><span id="l12.572" class="difflineplus">+    return false;</span>
<a href="#l12.573"></a><span id="l12.573" class="difflineplus">+  }</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineplus">+</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineplus">+  /** Returns the tab index */</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineplus">+  get index() {</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineplus">+    return this.tabmail.tabInfo.filter(info =&gt; getTabBrowser(info)).indexOf(this.nativeTab);</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineplus">+  }</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineplus">+</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineplus">+  /** Returns information about the muted state of the tab */</span>
<a href="#l12.581"></a><span id="l12.581" class="difflineplus">+  get mutedInfo() {</span>
<a href="#l12.582"></a><span id="l12.582" class="difflineplus">+    return { muted: false };</span>
<a href="#l12.583"></a><span id="l12.583" class="difflineplus">+  }</span>
<a href="#l12.584"></a><span id="l12.584" class="difflineplus">+</span>
<a href="#l12.585"></a><span id="l12.585" class="difflineplus">+  /** Returns information about the sharing state of the tab */</span>
<a href="#l12.586"></a><span id="l12.586" class="difflineplus">+  get sharingState() {</span>
<a href="#l12.587"></a><span id="l12.587" class="difflineplus">+    return { camera: false, microphone: false, screen: false };</span>
<a href="#l12.588"></a><span id="l12.588" class="difflineplus">+  }</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineplus">+</span>
<a href="#l12.590"></a><span id="l12.590" class="difflineplus">+  /** Returns the pinned state of the tab */</span>
<a href="#l12.591"></a><span id="l12.591" class="difflineplus">+  get pinned() {</span>
<a href="#l12.592"></a><span id="l12.592" class="difflineplus">+    return false;</span>
<a href="#l12.593"></a><span id="l12.593" class="difflineplus">+  }</span>
<a href="#l12.594"></a><span id="l12.594" class="difflineplus">+</span>
<a href="#l12.595"></a><span id="l12.595" class="difflineplus">+  /** Returns the active state of the tab */</span>
<a href="#l12.596"></a><span id="l12.596" class="difflineplus">+  get active() {</span>
<a href="#l12.597"></a><span id="l12.597" class="difflineplus">+    return this.nativeTab == this.tabmail.selectedTab;</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineplus">+  }</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineplus">+</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineplus">+  /** Returns the highlighted state of the tab */</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineplus">+  get highlighted() {</span>
<a href="#l12.602"></a><span id="l12.602" class="difflineplus">+    return this.active;</span>
<a href="#l12.603"></a><span id="l12.603" class="difflineplus">+  }</span>
<a href="#l12.604"></a><span id="l12.604" class="difflineplus">+</span>
<a href="#l12.605"></a><span id="l12.605" class="difflineplus">+  /** Returns the selected state of the tab */</span>
<a href="#l12.606"></a><span id="l12.606" class="difflineplus">+  get selected() {</span>
<a href="#l12.607"></a><span id="l12.607" class="difflineplus">+    return this.active;</span>
<a href="#l12.608"></a><span id="l12.608" class="difflineplus">+  }</span>
<a href="#l12.609"></a><span id="l12.609" class="difflineplus">+</span>
<a href="#l12.610"></a><span id="l12.610" class="difflineplus">+  /** Returns the loading status of the tab */</span>
<a href="#l12.611"></a><span id="l12.611" class="difflineplus">+  get status() {</span>
<a href="#l12.612"></a><span id="l12.612" class="difflineplus">+    return this.browser.webProgress.isLoadingDocument ? &quot;loading&quot; : &quot;complete&quot;;</span>
<a href="#l12.613"></a><span id="l12.613" class="difflineplus">+  }</span>
<a href="#l12.614"></a><span id="l12.614" class="difflineplus">+</span>
<a href="#l12.615"></a><span id="l12.615" class="difflineplus">+  /** Returns the title of the tab, without permission checks */</span>
<a href="#l12.616"></a><span id="l12.616" class="difflineplus">+  get _title() {</span>
<a href="#l12.617"></a><span id="l12.617" class="difflineplus">+    let tabNode = this.tabmail._getTabContextForTabbyThing(this.nativeTab)[2];</span>
<a href="#l12.618"></a><span id="l12.618" class="difflineplus">+    return tabNode.getAttribute(&quot;label&quot;);</span>
<a href="#l12.619"></a><span id="l12.619" class="difflineplus">+  }</span>
<a href="#l12.620"></a><span id="l12.620" class="difflineplus">+</span>
<a href="#l12.621"></a><span id="l12.621" class="difflineplus">+  /** Returns the width of the tab */</span>
<a href="#l12.622"></a><span id="l12.622" class="difflineplus">+  get width() {</span>
<a href="#l12.623"></a><span id="l12.623" class="difflineplus">+    return this.frameLoader.lazyWidth;</span>
<a href="#l12.624"></a><span id="l12.624" class="difflineplus">+  }</span>
<a href="#l12.625"></a><span id="l12.625" class="difflineplus">+</span>
<a href="#l12.626"></a><span id="l12.626" class="difflineplus">+  /** Returns the native window object of the tab */</span>
<a href="#l12.627"></a><span id="l12.627" class="difflineplus">+  get window() {</span>
<a href="#l12.628"></a><span id="l12.628" class="difflineplus">+    return this.browser.ownerGlobal;</span>
<a href="#l12.629"></a><span id="l12.629" class="difflineplus">+  }</span>
<a href="#l12.630"></a><span id="l12.630" class="difflineplus">+</span>
<a href="#l12.631"></a><span id="l12.631" class="difflineplus">+  /** Returns the window id of the tab */</span>
<a href="#l12.632"></a><span id="l12.632" class="difflineplus">+  get windowId() {</span>
<a href="#l12.633"></a><span id="l12.633" class="difflineplus">+    return windowTracker.getId(this.window);</span>
<a href="#l12.634"></a><span id="l12.634" class="difflineplus">+  }</span>
<a href="#l12.635"></a><span id="l12.635" class="difflineplus">+</span>
<a href="#l12.636"></a><span id="l12.636" class="difflineplus">+  /** Returns the article state of the tab */</span>
<a href="#l12.637"></a><span id="l12.637" class="difflineplus">+  get isArticle() {</span>
<a href="#l12.638"></a><span id="l12.638" class="difflineplus">+    return false;</span>
<a href="#l12.639"></a><span id="l12.639" class="difflineplus">+  }</span>
<a href="#l12.640"></a><span id="l12.640" class="difflineplus">+</span>
<a href="#l12.641"></a><span id="l12.641" class="difflineplus">+  /** Returns the reader mode state of the tab */</span>
<a href="#l12.642"></a><span id="l12.642" class="difflineplus">+  get isInReaderMode() {</span>
<a href="#l12.643"></a><span id="l12.643" class="difflineplus">+    return false;</span>
<a href="#l12.644"></a><span id="l12.644" class="difflineplus">+  }</span>
<a href="#l12.645"></a><span id="l12.645" class="difflineplus">+}</span>
<a href="#l12.646"></a><span id="l12.646" class="difflineplus">+</span>
<a href="#l12.647"></a><span id="l12.647" class="difflineplus">+/**</span>
<a href="#l12.648"></a><span id="l12.648" class="difflineplus">+ * Extension-specific wrapper around a Thunderbird window</span>
<a href="#l12.649"></a><span id="l12.649" class="difflineplus">+ */</span>
<a href="#l12.650"></a><span id="l12.650" class="difflineplus">+class Window extends WindowBase {</span>
<a href="#l12.651"></a><span id="l12.651" class="difflineplus">+  /**</span>
<a href="#l12.652"></a><span id="l12.652" class="difflineplus">+   * Update the geometry of the mail window.</span>
<a href="#l12.653"></a><span id="l12.653" class="difflineplus">+   *</span>
<a href="#l12.654"></a><span id="l12.654" class="difflineplus">+   * @param {Object} options</span>
<a href="#l12.655"></a><span id="l12.655" class="difflineplus">+   *        An object containing new values for the window's geometry.</span>
<a href="#l12.656"></a><span id="l12.656" class="difflineplus">+   * @param {integer} [options.left]</span>
<a href="#l12.657"></a><span id="l12.657" class="difflineplus">+   *        The new pixel distance of the left side of the mail window from</span>
<a href="#l12.658"></a><span id="l12.658" class="difflineplus">+   *        the left of the screen.</span>
<a href="#l12.659"></a><span id="l12.659" class="difflineplus">+   * @param {integer} [options.top]</span>
<a href="#l12.660"></a><span id="l12.660" class="difflineplus">+   *        The new pixel distance of the top side of the mail window from</span>
<a href="#l12.661"></a><span id="l12.661" class="difflineplus">+   *        the top of the screen.</span>
<a href="#l12.662"></a><span id="l12.662" class="difflineplus">+   * @param {integer} [options.width]</span>
<a href="#l12.663"></a><span id="l12.663" class="difflineplus">+   *        The new pixel width of the window.</span>
<a href="#l12.664"></a><span id="l12.664" class="difflineplus">+   * @param {integer} [options.height]</span>
<a href="#l12.665"></a><span id="l12.665" class="difflineplus">+   *        The new pixel height of the window.</span>
<a href="#l12.666"></a><span id="l12.666" class="difflineplus">+   */</span>
<a href="#l12.667"></a><span id="l12.667" class="difflineplus">+  updateGeometry(options) {</span>
<a href="#l12.668"></a><span id="l12.668" class="difflineplus">+    let { window } = this;</span>
<a href="#l12.669"></a><span id="l12.669" class="difflineplus">+</span>
<a href="#l12.670"></a><span id="l12.670" class="difflineplus">+    if (options.left !== null || options.top !== null) {</span>
<a href="#l12.671"></a><span id="l12.671" class="difflineplus">+      let left = options.left === null ? window.screenX : options.left;</span>
<a href="#l12.672"></a><span id="l12.672" class="difflineplus">+      let top = options.top === null ? window.screenY : options.top;</span>
<a href="#l12.673"></a><span id="l12.673" class="difflineplus">+      window.moveTo(left, top);</span>
<a href="#l12.674"></a><span id="l12.674" class="difflineplus">+    }</span>
<a href="#l12.675"></a><span id="l12.675" class="difflineplus">+</span>
<a href="#l12.676"></a><span id="l12.676" class="difflineplus">+    if (options.width !== null || options.height !== null) {</span>
<a href="#l12.677"></a><span id="l12.677" class="difflineplus">+      let width = options.width === null ? window.outerWidth : options.width;</span>
<a href="#l12.678"></a><span id="l12.678" class="difflineplus">+      let height = options.height === null ? window.outerHeight : options.height;</span>
<a href="#l12.679"></a><span id="l12.679" class="difflineplus">+      window.resizeTo(width, height);</span>
<a href="#l12.680"></a><span id="l12.680" class="difflineplus">+    }</span>
<a href="#l12.681"></a><span id="l12.681" class="difflineplus">+  }</span>
<a href="#l12.682"></a><span id="l12.682" class="difflineplus">+</span>
<a href="#l12.683"></a><span id="l12.683" class="difflineplus">+  /** Returns the tabmail element for the tab. */</span>
<a href="#l12.684"></a><span id="l12.684" class="difflineplus">+  get tabmail() {</span>
<a href="#l12.685"></a><span id="l12.685" class="difflineplus">+    return this.window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l12.686"></a><span id="l12.686" class="difflineplus">+  }</span>
<a href="#l12.687"></a><span id="l12.687" class="difflineplus">+</span>
<a href="#l12.688"></a><span id="l12.688" class="difflineplus">+  /** Returns the title of the tab, without permission checks */</span>
<a href="#l12.689"></a><span id="l12.689" class="difflineplus">+  get _title() {</span>
<a href="#l12.690"></a><span id="l12.690" class="difflineplus">+    return this.window.document.title;</span>
<a href="#l12.691"></a><span id="l12.691" class="difflineplus">+  }</span>
<a href="#l12.692"></a><span id="l12.692" class="difflineplus">+</span>
<a href="#l12.693"></a><span id="l12.693" class="difflineplus">+  /** Returns the title of the tab, checking tab permissions */</span>
<a href="#l12.694"></a><span id="l12.694" class="difflineplus">+  get title() {</span>
<a href="#l12.695"></a><span id="l12.695" class="difflineplus">+    // Thunderbird can have an empty active tab while a window is loading</span>
<a href="#l12.696"></a><span id="l12.696" class="difflineplus">+    if (this.activeTab &amp;&amp; this.activeTab.hasTabPermission) {</span>
<a href="#l12.697"></a><span id="l12.697" class="difflineplus">+      return this._title;</span>
<a href="#l12.698"></a><span id="l12.698" class="difflineplus">+    }</span>
<a href="#l12.699"></a><span id="l12.699" class="difflineplus">+    return null;</span>
<a href="#l12.700"></a><span id="l12.700" class="difflineplus">+  }</span>
<a href="#l12.701"></a><span id="l12.701" class="difflineplus">+</span>
<a href="#l12.702"></a><span id="l12.702" class="difflineplus">+  /**</span>
<a href="#l12.703"></a><span id="l12.703" class="difflineplus">+   * Sets the title preface of the window.</span>
<a href="#l12.704"></a><span id="l12.704" class="difflineplus">+   *</span>
<a href="#l12.705"></a><span id="l12.705" class="difflineplus">+   * @param {String} titlePreface       The title preface to set</span>
<a href="#l12.706"></a><span id="l12.706" class="difflineplus">+   */</span>
<a href="#l12.707"></a><span id="l12.707" class="difflineplus">+  setTitlePreface(titlePreface) {</span>
<a href="#l12.708"></a><span id="l12.708" class="difflineplus">+    this.window.document.documentElement.setAttribute(&quot;titlepreface&quot;, titlePreface);</span>
<a href="#l12.709"></a><span id="l12.709" class="difflineplus">+  }</span>
<a href="#l12.710"></a><span id="l12.710" class="difflineplus">+</span>
<a href="#l12.711"></a><span id="l12.711" class="difflineplus">+  /** Gets the foucsed state of the window */</span>
<a href="#l12.712"></a><span id="l12.712" class="difflineplus">+  get focused() {</span>
<a href="#l12.713"></a><span id="l12.713" class="difflineplus">+    return this.window.document.hasFocus();</span>
<a href="#l12.714"></a><span id="l12.714" class="difflineplus">+  }</span>
<a href="#l12.715"></a><span id="l12.715" class="difflineplus">+</span>
<a href="#l12.716"></a><span id="l12.716" class="difflineplus">+  /** Gets the top position of the window */</span>
<a href="#l12.717"></a><span id="l12.717" class="difflineplus">+  get top() {</span>
<a href="#l12.718"></a><span id="l12.718" class="difflineplus">+    return this.window.screenY;</span>
<a href="#l12.719"></a><span id="l12.719" class="difflineplus">+  }</span>
<a href="#l12.720"></a><span id="l12.720" class="difflineplus">+</span>
<a href="#l12.721"></a><span id="l12.721" class="difflineplus">+  /** Gets the left position of the window */</span>
<a href="#l12.722"></a><span id="l12.722" class="difflineplus">+  get left() {</span>
<a href="#l12.723"></a><span id="l12.723" class="difflineplus">+    return this.window.screenX;</span>
<a href="#l12.724"></a><span id="l12.724" class="difflineplus">+  }</span>
<a href="#l12.725"></a><span id="l12.725" class="difflineplus">+</span>
<a href="#l12.726"></a><span id="l12.726" class="difflineplus">+  /** Gets the width of the window */</span>
<a href="#l12.727"></a><span id="l12.727" class="difflineplus">+  get width() {</span>
<a href="#l12.728"></a><span id="l12.728" class="difflineplus">+    return this.window.outerWidth;</span>
<a href="#l12.729"></a><span id="l12.729" class="difflineplus">+  }</span>
<a href="#l12.730"></a><span id="l12.730" class="difflineplus">+</span>
<a href="#l12.731"></a><span id="l12.731" class="difflineplus">+  /** Gets the height of the window */</span>
<a href="#l12.732"></a><span id="l12.732" class="difflineplus">+  get height() {</span>
<a href="#l12.733"></a><span id="l12.733" class="difflineplus">+    return this.window.outerHeight;</span>
<a href="#l12.734"></a><span id="l12.734" class="difflineplus">+  }</span>
<a href="#l12.735"></a><span id="l12.735" class="difflineplus">+</span>
<a href="#l12.736"></a><span id="l12.736" class="difflineplus">+  /** Gets the private browsing status of the window */</span>
<a href="#l12.737"></a><span id="l12.737" class="difflineplus">+  get incognito() {</span>
<a href="#l12.738"></a><span id="l12.738" class="difflineplus">+    return PrivateBrowsingUtils.isWindowPrivate(this.window);</span>
<a href="#l12.739"></a><span id="l12.739" class="difflineplus">+  }</span>
<a href="#l12.740"></a><span id="l12.740" class="difflineplus">+</span>
<a href="#l12.741"></a><span id="l12.741" class="difflineplus">+  /** Checks if the window is considered always on top */</span>
<a href="#l12.742"></a><span id="l12.742" class="difflineplus">+  get alwaysOnTop() {</span>
<a href="#l12.743"></a><span id="l12.743" class="difflineplus">+    return this.xulWindow.zLevel &gt;= Ci.nsIXULWindow.raisedZ;</span>
<a href="#l12.744"></a><span id="l12.744" class="difflineplus">+  }</span>
<a href="#l12.745"></a><span id="l12.745" class="difflineplus">+</span>
<a href="#l12.746"></a><span id="l12.746" class="difflineplus">+  /** Checks if the window was the last one focused */</span>
<a href="#l12.747"></a><span id="l12.747" class="difflineplus">+  get isLastFocused() {</span>
<a href="#l12.748"></a><span id="l12.748" class="difflineplus">+    return this.window === windowTracker.topWindow;</span>
<a href="#l12.749"></a><span id="l12.749" class="difflineplus">+  }</span>
<a href="#l12.750"></a><span id="l12.750" class="difflineplus">+</span>
<a href="#l12.751"></a><span id="l12.751" class="difflineplus">+  /**</span>
<a href="#l12.752"></a><span id="l12.752" class="difflineplus">+   * Returns the window state for the given window</span>
<a href="#l12.753"></a><span id="l12.753" class="difflineplus">+   *</span>
<a href="#l12.754"></a><span id="l12.754" class="difflineplus">+   * @param {DOMWindow} window      The window to check</span>
<a href="#l12.755"></a><span id="l12.755" class="difflineplus">+   * @return {String}               &quot;maximized&quot;, &quot;minimized&quot;, &quot;normal&quot; or &quot;fullscreen&quot;</span>
<a href="#l12.756"></a><span id="l12.756" class="difflineplus">+   */</span>
<a href="#l12.757"></a><span id="l12.757" class="difflineplus">+  static getState(window) {</span>
<a href="#l12.758"></a><span id="l12.758" class="difflineplus">+    const STATES = {</span>
<a href="#l12.759"></a><span id="l12.759" class="difflineplus">+      [window.STATE_MAXIMIZED]: &quot;maximized&quot;,</span>
<a href="#l12.760"></a><span id="l12.760" class="difflineplus">+      [window.STATE_MINIMIZED]: &quot;minimized&quot;,</span>
<a href="#l12.761"></a><span id="l12.761" class="difflineplus">+      [window.STATE_NORMAL]: &quot;normal&quot;,</span>
<a href="#l12.762"></a><span id="l12.762" class="difflineplus">+    };</span>
<a href="#l12.763"></a><span id="l12.763" class="difflineplus">+    let state = STATES[window.windowState];</span>
<a href="#l12.764"></a><span id="l12.764" class="difflineplus">+    if (window.fullScreen) {</span>
<a href="#l12.765"></a><span id="l12.765" class="difflineplus">+      state = &quot;fullscreen&quot;;</span>
<a href="#l12.766"></a><span id="l12.766" class="difflineplus">+    }</span>
<a href="#l12.767"></a><span id="l12.767" class="difflineplus">+    return state;</span>
<a href="#l12.768"></a><span id="l12.768" class="difflineplus">+  }</span>
<a href="#l12.769"></a><span id="l12.769" class="difflineplus">+</span>
<a href="#l12.770"></a><span id="l12.770" class="difflineplus">+  /** Returns the window state for this specific window */</span>
<a href="#l12.771"></a><span id="l12.771" class="difflineplus">+  get state() {</span>
<a href="#l12.772"></a><span id="l12.772" class="difflineplus">+    return Window.getState(this.window);</span>
<a href="#l12.773"></a><span id="l12.773" class="difflineplus">+  }</span>
<a href="#l12.774"></a><span id="l12.774" class="difflineplus">+</span>
<a href="#l12.775"></a><span id="l12.775" class="difflineplus">+  /**</span>
<a href="#l12.776"></a><span id="l12.776" class="difflineplus">+   * Sets the window state for this speific window</span>
<a href="#l12.777"></a><span id="l12.777" class="difflineplus">+   *</span>
<a href="#l12.778"></a><span id="l12.778" class="difflineplus">+   * @param {String} state          &quot;maximized&quot;, &quot;minimized&quot;, &quot;normal&quot; or &quot;fullscreen&quot;</span>
<a href="#l12.779"></a><span id="l12.779" class="difflineplus">+   */</span>
<a href="#l12.780"></a><span id="l12.780" class="difflineplus">+  set state(state) {</span>
<a href="#l12.781"></a><span id="l12.781" class="difflineplus">+    let { window } = this;</span>
<a href="#l12.782"></a><span id="l12.782" class="difflineplus">+    if (state !== &quot;fullscreen&quot; &amp;&amp; window.fullScreen) {</span>
<a href="#l12.783"></a><span id="l12.783" class="difflineplus">+      window.fullScreen = false;</span>
<a href="#l12.784"></a><span id="l12.784" class="difflineplus">+    }</span>
<a href="#l12.785"></a><span id="l12.785" class="difflineplus">+</span>
<a href="#l12.786"></a><span id="l12.786" class="difflineplus">+    switch (state) {</span>
<a href="#l12.787"></a><span id="l12.787" class="difflineplus">+      case &quot;maximized&quot;:</span>
<a href="#l12.788"></a><span id="l12.788" class="difflineplus">+        window.maximize();</span>
<a href="#l12.789"></a><span id="l12.789" class="difflineplus">+        break;</span>
<a href="#l12.790"></a><span id="l12.790" class="difflineplus">+</span>
<a href="#l12.791"></a><span id="l12.791" class="difflineplus">+      case &quot;minimized&quot;:</span>
<a href="#l12.792"></a><span id="l12.792" class="difflineplus">+      case &quot;docked&quot;:</span>
<a href="#l12.793"></a><span id="l12.793" class="difflineplus">+        window.minimize();</span>
<a href="#l12.794"></a><span id="l12.794" class="difflineplus">+        break;</span>
<a href="#l12.795"></a><span id="l12.795" class="difflineplus">+</span>
<a href="#l12.796"></a><span id="l12.796" class="difflineplus">+      case &quot;normal&quot;:</span>
<a href="#l12.797"></a><span id="l12.797" class="difflineplus">+        // Restore sometimes returns the window to its previous state, rather</span>
<a href="#l12.798"></a><span id="l12.798" class="difflineplus">+        // than to the &quot;normal&quot; state, so it may need to be called anywhere from</span>
<a href="#l12.799"></a><span id="l12.799" class="difflineplus">+        // zero to two times.</span>
<a href="#l12.800"></a><span id="l12.800" class="difflineplus">+        window.restore();</span>
<a href="#l12.801"></a><span id="l12.801" class="difflineplus">+        if (window.windowState !== window.STATE_NORMAL) {</span>
<a href="#l12.802"></a><span id="l12.802" class="difflineplus">+          window.restore();</span>
<a href="#l12.803"></a><span id="l12.803" class="difflineplus">+        }</span>
<a href="#l12.804"></a><span id="l12.804" class="difflineplus">+        if (window.windowState !== window.STATE_NORMAL) {</span>
<a href="#l12.805"></a><span id="l12.805" class="difflineplus">+          // And on OS-X, where normal vs. maximized is basically a heuristic,</span>
<a href="#l12.806"></a><span id="l12.806" class="difflineplus">+          // we need to cheat.</span>
<a href="#l12.807"></a><span id="l12.807" class="difflineplus">+          window.sizeToContent();</span>
<a href="#l12.808"></a><span id="l12.808" class="difflineplus">+        }</span>
<a href="#l12.809"></a><span id="l12.809" class="difflineplus">+        break;</span>
<a href="#l12.810"></a><span id="l12.810" class="difflineplus">+</span>
<a href="#l12.811"></a><span id="l12.811" class="difflineplus">+      case &quot;fullscreen&quot;:</span>
<a href="#l12.812"></a><span id="l12.812" class="difflineplus">+        window.fullScreen = true;</span>
<a href="#l12.813"></a><span id="l12.813" class="difflineplus">+        break;</span>
<a href="#l12.814"></a><span id="l12.814" class="difflineplus">+</span>
<a href="#l12.815"></a><span id="l12.815" class="difflineplus">+      default:</span>
<a href="#l12.816"></a><span id="l12.816" class="difflineplus">+        throw new Error(`Unexpected window state: ${state}`);</span>
<a href="#l12.817"></a><span id="l12.817" class="difflineplus">+    }</span>
<a href="#l12.818"></a><span id="l12.818" class="difflineplus">+  }</span>
<a href="#l12.819"></a><span id="l12.819" class="difflineplus">+</span>
<a href="#l12.820"></a><span id="l12.820" class="difflineplus">+  /**</span>
<a href="#l12.821"></a><span id="l12.821" class="difflineplus">+   * Retrieves the (relevant) tabs in this window</span>
<a href="#l12.822"></a><span id="l12.822" class="difflineplus">+   *</span>
<a href="#l12.823"></a><span id="l12.823" class="difflineplus">+   * @yields {Tab}      The wrapped Tab in this window</span>
<a href="#l12.824"></a><span id="l12.824" class="difflineplus">+   */</span>
<a href="#l12.825"></a><span id="l12.825" class="difflineplus">+  * getTabs() {</span>
<a href="#l12.826"></a><span id="l12.826" class="difflineplus">+    let { tabManager } = this.extension;</span>
<a href="#l12.827"></a><span id="l12.827" class="difflineplus">+</span>
<a href="#l12.828"></a><span id="l12.828" class="difflineplus">+    for (let nativeTabInfo of this.tabmail.tabInfo) {</span>
<a href="#l12.829"></a><span id="l12.829" class="difflineplus">+      if (getTabBrowser(nativeTabInfo)) {</span>
<a href="#l12.830"></a><span id="l12.830" class="difflineplus">+        // Only tabs that have a browser element</span>
<a href="#l12.831"></a><span id="l12.831" class="difflineplus">+        yield tabManager.getWrapper(nativeTabInfo);</span>
<a href="#l12.832"></a><span id="l12.832" class="difflineplus">+      }</span>
<a href="#l12.833"></a><span id="l12.833" class="difflineplus">+    }</span>
<a href="#l12.834"></a><span id="l12.834" class="difflineplus">+  }</span>
<a href="#l12.835"></a><span id="l12.835" class="difflineplus">+</span>
<a href="#l12.836"></a><span id="l12.836" class="difflineplus">+  /** Retrieves the active tab in this window */</span>
<a href="#l12.837"></a><span id="l12.837" class="difflineplus">+  get activeTab() {</span>
<a href="#l12.838"></a><span id="l12.838" class="difflineplus">+    let { tabManager } = this.extension;</span>
<a href="#l12.839"></a><span id="l12.839" class="difflineplus">+    let selectedTab = this.tabmail.selectedTab;</span>
<a href="#l12.840"></a><span id="l12.840" class="difflineplus">+    if (selectedTab) {</span>
<a href="#l12.841"></a><span id="l12.841" class="difflineplus">+      return tabManager.getWrapper(selectedTab);</span>
<a href="#l12.842"></a><span id="l12.842" class="difflineplus">+    }</span>
<a href="#l12.843"></a><span id="l12.843" class="difflineplus">+    return null;</span>
<a href="#l12.844"></a><span id="l12.844" class="difflineplus">+  }</span>
<a href="#l12.845"></a><span id="l12.845" class="difflineplus">+</span>
<a href="#l12.846"></a><span id="l12.846" class="difflineplus">+  /**</span>
<a href="#l12.847"></a><span id="l12.847" class="difflineplus">+   * Retrieves the tab at the given index</span>
<a href="#l12.848"></a><span id="l12.848" class="difflineplus">+   *</span>
<a href="#l12.849"></a><span id="l12.849" class="difflineplus">+   * @param {Number} index      The index to look at</span>
<a href="#l12.850"></a><span id="l12.850" class="difflineplus">+   * @return {Tab}              The wrapped tab at the index</span>
<a href="#l12.851"></a><span id="l12.851" class="difflineplus">+   */</span>
<a href="#l12.852"></a><span id="l12.852" class="difflineplus">+  getTabAtIndex(index) {</span>
<a href="#l12.853"></a><span id="l12.853" class="difflineplus">+    let nativeTabInfo = this.tabmail.tabInfo.filter(info =&gt; getTabBrowser(info))[index];</span>
<a href="#l12.854"></a><span id="l12.854" class="difflineplus">+    if (nativeTabInfo) {</span>
<a href="#l12.855"></a><span id="l12.855" class="difflineplus">+      return tabManager.getWrapper(nativeTabInfo);</span>
<a href="#l12.856"></a><span id="l12.856" class="difflineplus">+    }</span>
<a href="#l12.857"></a><span id="l12.857" class="difflineplus">+    return null;</span>
<a href="#l12.858"></a><span id="l12.858" class="difflineplus">+  }</span>
<a href="#l12.859"></a><span id="l12.859" class="difflineplus">+}</span>
<a href="#l12.860"></a><span id="l12.860" class="difflineplus">+</span>
<a href="#l12.861"></a><span id="l12.861" class="difflineplus">+Object.assign(global, { Tab, Window });</span>
<a href="#l12.862"></a><span id="l12.862" class="difflineplus">+</span>
<a href="#l12.863"></a><span id="l12.863" class="difflineplus">+/**</span>
<a href="#l12.864"></a><span id="l12.864" class="difflineplus">+ * Manages native tabs, their wrappers, and their dynamic permissions for a particular extension.</span>
<a href="#l12.865"></a><span id="l12.865" class="difflineplus">+ */</span>
<a href="#l12.866"></a><span id="l12.866" class="difflineplus">+class TabManager extends TabManagerBase {</span>
<a href="#l12.867"></a><span id="l12.867" class="difflineplus">+  /**</span>
<a href="#l12.868"></a><span id="l12.868" class="difflineplus">+   * Returns a Tab wrapper for the tab with the given ID.</span>
<a href="#l12.869"></a><span id="l12.869" class="difflineplus">+   *</span>
<a href="#l12.870"></a><span id="l12.870" class="difflineplus">+   * @param {integer} tabId     The ID of the tab for which to return a wrapper.</span>
<a href="#l12.871"></a><span id="l12.871" class="difflineplus">+   * @param {*} default_        The value to return if no tab exists with the given ID.</span>
<a href="#l12.872"></a><span id="l12.872" class="difflineplus">+   * @return {Tab|*}            The wrapped tab, or the default value</span>
<a href="#l12.873"></a><span id="l12.873" class="difflineplus">+   */</span>
<a href="#l12.874"></a><span id="l12.874" class="difflineplus">+  get(tabId, default_ = undefined) {</span>
<a href="#l12.875"></a><span id="l12.875" class="difflineplus">+    let nativeTabInfo = tabTracker.getTab(tabId, default_);</span>
<a href="#l12.876"></a><span id="l12.876" class="difflineplus">+</span>
<a href="#l12.877"></a><span id="l12.877" class="difflineplus">+    if (nativeTabInfo) {</span>
<a href="#l12.878"></a><span id="l12.878" class="difflineplus">+      return this.getWrapper(nativeTabInfo);</span>
<a href="#l12.879"></a><span id="l12.879" class="difflineplus">+    }</span>
<a href="#l12.880"></a><span id="l12.880" class="difflineplus">+    return default_;</span>
<a href="#l12.881"></a><span id="l12.881" class="difflineplus">+  }</span>
<a href="#l12.882"></a><span id="l12.882" class="difflineplus">+</span>
<a href="#l12.883"></a><span id="l12.883" class="difflineplus">+  /**</span>
<a href="#l12.884"></a><span id="l12.884" class="difflineplus">+   * If the extension has requested activeTab permission, grant it those permissions for the current</span>
<a href="#l12.885"></a><span id="l12.885" class="difflineplus">+   * inner window in the given native tab.</span>
<a href="#l12.886"></a><span id="l12.886" class="difflineplus">+   *</span>
<a href="#l12.887"></a><span id="l12.887" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo       The native tab for which to grant permissions.</span>
<a href="#l12.888"></a><span id="l12.888" class="difflineplus">+   */</span>
<a href="#l12.889"></a><span id="l12.889" class="difflineplus">+  addActiveTabPermission(nativeTabInfo = tabTracker.activeTab) {</span>
<a href="#l12.890"></a><span id="l12.890" class="difflineplus">+    super.addActiveTabPermission(nativeTabInfo);</span>
<a href="#l12.891"></a><span id="l12.891" class="difflineplus">+  }</span>
<a href="#l12.892"></a><span id="l12.892" class="difflineplus">+</span>
<a href="#l12.893"></a><span id="l12.893" class="difflineplus">+  /**</span>
<a href="#l12.894"></a><span id="l12.894" class="difflineplus">+   * Revoke the extension's activeTab permissions for the current inner window of the given native</span>
<a href="#l12.895"></a><span id="l12.895" class="difflineplus">+   * tab.</span>
<a href="#l12.896"></a><span id="l12.896" class="difflineplus">+   *</span>
<a href="#l12.897"></a><span id="l12.897" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo       The native tab for which to revoke permissions.</span>
<a href="#l12.898"></a><span id="l12.898" class="difflineplus">+   */</span>
<a href="#l12.899"></a><span id="l12.899" class="difflineplus">+  revokeActiveTabPermission(nativeTabInfo = tabTracker.activeTab) {</span>
<a href="#l12.900"></a><span id="l12.900" class="difflineplus">+    super.revokeActiveTabPermission(nativeTabInfo);</span>
<a href="#l12.901"></a><span id="l12.901" class="difflineplus">+  }</span>
<a href="#l12.902"></a><span id="l12.902" class="difflineplus">+</span>
<a href="#l12.903"></a><span id="l12.903" class="difflineplus">+  /**</span>
<a href="#l12.904"></a><span id="l12.904" class="difflineplus">+   * Returns a new Tab instance wrapping the given native tab info.</span>
<a href="#l12.905"></a><span id="l12.905" class="difflineplus">+   *</span>
<a href="#l12.906"></a><span id="l12.906" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo       The native tab for which to return a wrapper.</span>
<a href="#l12.907"></a><span id="l12.907" class="difflineplus">+   * @return {Tab}                              The wrapped native tab</span>
<a href="#l12.908"></a><span id="l12.908" class="difflineplus">+   */</span>
<a href="#l12.909"></a><span id="l12.909" class="difflineplus">+  wrapTab(nativeTabInfo) {</span>
<a href="#l12.910"></a><span id="l12.910" class="difflineplus">+    return new Tab(this.extension, nativeTabInfo, tabTracker.getId(nativeTabInfo));</span>
<a href="#l12.911"></a><span id="l12.911" class="difflineplus">+  }</span>
<a href="#l12.912"></a><span id="l12.912" class="difflineplus">+}</span>
<a href="#l12.913"></a><span id="l12.913" class="difflineplus">+</span>
<a href="#l12.914"></a><span id="l12.914" class="difflineplus">+/**</span>
<a href="#l12.915"></a><span id="l12.915" class="difflineplus">+ * Manages native browser windows and their wrappers for a particular extension.</span>
<a href="#l12.916"></a><span id="l12.916" class="difflineplus">+ */</span>
<a href="#l12.917"></a><span id="l12.917" class="difflineplus">+class WindowManager extends WindowManagerBase {</span>
<a href="#l12.918"></a><span id="l12.918" class="difflineplus">+  /**</span>
<a href="#l12.919"></a><span id="l12.919" class="difflineplus">+   * Returns a Window wrapper for the mail window with the given ID.</span>
<a href="#l12.920"></a><span id="l12.920" class="difflineplus">+   *</span>
<a href="#l12.921"></a><span id="l12.921" class="difflineplus">+   * @param {Integer} windowId      The ID of the browser window for which to return a wrapper.</span>
<a href="#l12.922"></a><span id="l12.922" class="difflineplus">+   * @param {BaseContext} context   The extension context for which the matching is being performed.</span>
<a href="#l12.923"></a><span id="l12.923" class="difflineplus">+   *                                  Used to determine the current window for relevant properties.</span>
<a href="#l12.924"></a><span id="l12.924" class="difflineplus">+   * @return {Window}               The wrapped window</span>
<a href="#l12.925"></a><span id="l12.925" class="difflineplus">+   */</span>
<a href="#l12.926"></a><span id="l12.926" class="difflineplus">+  get(windowId, context) {</span>
<a href="#l12.927"></a><span id="l12.927" class="difflineplus">+    let window = windowTracker.getWindow(windowId, context);</span>
<a href="#l12.928"></a><span id="l12.928" class="difflineplus">+    return this.getWrapper(window);</span>
<a href="#l12.929"></a><span id="l12.929" class="difflineplus">+  }</span>
<a href="#l12.930"></a><span id="l12.930" class="difflineplus">+</span>
<a href="#l12.931"></a><span id="l12.931" class="difflineplus">+  /**</span>
<a href="#l12.932"></a><span id="l12.932" class="difflineplus">+   * Yields an iterator of WindowBase wrappers for each currently existing browser window.</span>
<a href="#l12.933"></a><span id="l12.933" class="difflineplus">+   *</span>
<a href="#l12.934"></a><span id="l12.934" class="difflineplus">+   * @yields {Window}</span>
<a href="#l12.935"></a><span id="l12.935" class="difflineplus">+   */</span>
<a href="#l12.936"></a><span id="l12.936" class="difflineplus">+  * getAll() {</span>
<a href="#l12.937"></a><span id="l12.937" class="difflineplus">+    for (let window of windowTracker.browserWindows()) {</span>
<a href="#l12.938"></a><span id="l12.938" class="difflineplus">+      yield this.getWrapper(window);</span>
<a href="#l12.939"></a><span id="l12.939" class="difflineplus">+    }</span>
<a href="#l12.940"></a><span id="l12.940" class="difflineplus">+  }</span>
<a href="#l12.941"></a><span id="l12.941" class="difflineplus">+</span>
<a href="#l12.942"></a><span id="l12.942" class="difflineplus">+  /**</span>
<a href="#l12.943"></a><span id="l12.943" class="difflineplus">+   * Returns a new Window instance wrapping the given mail window.</span>
<a href="#l12.944"></a><span id="l12.944" class="difflineplus">+   *</span>
<a href="#l12.945"></a><span id="l12.945" class="difflineplus">+   * @param {DOMWindow} window      The mail window for which to return a wrapper.</span>
<a href="#l12.946"></a><span id="l12.946" class="difflineplus">+   * @returns {Window}              The wrapped window</span>
<a href="#l12.947"></a><span id="l12.947" class="difflineplus">+   */</span>
<a href="#l12.948"></a><span id="l12.948" class="difflineplus">+  wrapWindow(window) {</span>
<a href="#l12.949"></a><span id="l12.949" class="difflineplus">+    return new Window(this.extension, window, windowTracker.getId(window));</span>
<a href="#l12.950"></a><span id="l12.950" class="difflineplus">+  }</span>
<a href="#l12.951"></a><span id="l12.951" class="difflineplus">+}</span>
<a href="#l12.952"></a><span id="l12.952" class="difflineplus">+</span>
<a href="#l12.953"></a><span id="l12.953" class="difflineplus">+extensions.on(&quot;startup&quot;, (type, extension) =&gt; { // eslint-disable-line mozilla/balanced-listeners</span>
<a href="#l12.954"></a><span id="l12.954" class="difflineplus">+  defineLazyGetter(extension, &quot;tabManager&quot;,</span>
<a href="#l12.955"></a><span id="l12.955" class="difflineplus">+                   () =&gt; new TabManager(extension));</span>
<a href="#l12.956"></a><span id="l12.956" class="difflineplus">+  defineLazyGetter(extension, &quot;windowManager&quot;,</span>
<a href="#l12.957"></a><span id="l12.957" class="difflineplus">+                   () =&gt; new WindowManager(extension));</span>
<a href="#l12.958"></a><span id="l12.958" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mail/components/extensions/parent/ext-tabs.js</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,617 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+ChromeUtils.defineModuleGetter(this, &quot;PromiseUtils&quot;,</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+                               &quot;resource://gre/modules/PromiseUtils.jsm&quot;);</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+var { ExtensionError } = ExtensionUtils;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+/**</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+ * A listener that allows waiting until tabs are fully loaded, e.g. off of about:blank</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+ */</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+let tabListener = {</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+  tabReadyInitialized: false,</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+  tabReadyPromises: new WeakMap(),</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+  initializingTabs: new WeakSet(),</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+  /**</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+   * Initialize the progress listener for tab ready changes</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+   */</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+  initTabReady() {</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    if (!this.tabReadyInitialized) {</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+      windowTracker.addListener(&quot;progress&quot;, this);</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+      this.tabReadyInitialized = true;</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+    }</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+  },</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  /**</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+   * Web Progress listener method for the location change</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+   *</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+   * @param {Element} browser               The browser element that caused the change</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+   * @param {nsIWebProgress} webProgress    The web progress for the location change</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+   * @param {nsIRequest} request            The xpcom request for this change</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+   * @param {nsIURI} locationURI            The target uri</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+   * @param {Integer} flags                 The web progress flags for this change</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+   */</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+  onLocationChange(browser, webProgress, request, locationURI, flags) {</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+    if (webProgress.isTopLevel) {</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+      let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+      let nativeTabInfo = tabmail.getTabForBrowser(browser);</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+      // Now we are certain that the first page in the tab was loaded.</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+      this.initializingTabs.delete(nativeTabInfo);</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+      // browser.innerWindowID is now set, resolve the promises if any.</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+      let deferred = this.tabReadyPromises.get(nativeTabInfo);</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+      if (deferred) {</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+        deferred.resolve(nativeTabInfo);</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+        this.tabReadyPromises.delete(nativeTabInfo);</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+      }</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+    }</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+  },</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+  /**</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+   * Promise that the given tab completes loading</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+   *</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+   * @param {NativeTabInfo} nativeTabInfo       The tabInfo describing the tab</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+   * @return {Promise&lt;NativeTabInfo&gt;}           Resolves when the tab completes loading</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+   */</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+  awaitTabReady(nativeTabInfo) {</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+    let deferred = this.tabReadyPromises.get(nativeTabInfo);</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+    if (!deferred) {</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+      deferred = PromiseUtils.defer();</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+      let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+      if (!this.initializingTabs.has(nativeTabInfo) &amp;&amp;</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+          (browser.innerWindowID || browser.currentURI.spec === &quot;about:blank&quot;)) {</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+        deferred.resolve(nativeTabInfo);</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+      } else {</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+        this.initTabReady();</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+        this.tabReadyPromises.set(nativeTabInfo, deferred);</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+      }</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+    }</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+    return deferred.promise;</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+  }</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+};</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+// Attributes and properties used in the TabsUpdateFilterManager</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+const allAttrs = new Set([&quot;favIconUrl&quot;, &quot;title&quot;]);</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+const allProperties = new Set([</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+  &quot;favIconUrl&quot;,</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+  &quot;status&quot;,</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+  &quot;title&quot;,</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+]);</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+const restricted = new Set([&quot;url&quot;, &quot;favIconUrl&quot;, &quot;title&quot;]);</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+/**</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+ * An EventManager for the tabs.onUpdated listener</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+ */</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+class TabsUpdateFilterEventManager extends EventManager {</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+  constructor(context) {</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+    let { extension } = context;</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+    let { tabManager } = extension;</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+    let register = (fire, filterProps) =&gt; {</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+      let filter = { ...filterProps };</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+      if (filter.urls) {</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+        filter.urls = new MatchPatternSet(filter.urls);</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+      }</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+      let needsModified = true;</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+      if (filter.properties) {</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+        // Default is to listen for all events.</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+        needsModified = filter.properties.some(prop =&gt; allAttrs.has(prop));</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+        filter.properties = new Set(filter.properties);</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+      } else {</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+        filter.properties = allProperties;</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+      }</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+      function sanitize(changeInfo) {</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+        let result = {};</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+        let nonempty = false;</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+        let hasTabs = extension.hasPermission(&quot;tabs&quot;);</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+        for (let prop in changeInfo) {</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+          if (hasTabs || !restricted.has(prop)) {</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+            nonempty = true;</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+            result[prop] = changeInfo[prop];</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+          }</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+        }</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+        return nonempty &amp;&amp; result;</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+      }</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineplus">+      function getWindowID(windowId) {</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineplus">+        if (windowId === Window.WINDOW_ID_CURRENT) {</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineplus">+          return windowTracker.getId(windowTracker.topWindow);</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+        }</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+        return windowId;</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineplus">+      }</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+      function matchFilters(tab, changed) {</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+        if (!filterProps) {</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+          return true;</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+        }</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+        if (filter.tabId != null &amp;&amp; tab.id != filter.tabId) {</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+          return false;</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+        }</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+        if (filter.windowId != null &amp;&amp; tab.windowId != getWindowID(filter.windowId)) {</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+          return false;</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+        }</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+        if (filter.urls) {</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+          // We check permission first because tab.uri is null if !hasTabPermission.</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+          return tab.hasTabPermission &amp;&amp; filter.urls.matches(tab.uri);</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+        }</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+        return true;</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+      }</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+      let fireForTab = (tab, changed) =&gt; {</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+        if (!matchFilters(tab, changed)) {</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+          return;</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+        }</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+        let changeInfo = sanitize(changed);</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineplus">+        if (changeInfo) {</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineplus">+          fire.async(tab.id, changeInfo, tab.convert());</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+        }</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineplus">+      };</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineplus">+</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineplus">+      let listener = event =&gt; {</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+        let needed = [];</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+        if (event.type == &quot;TabAttrModified&quot;) {</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+          let changed = event.detail.changed;</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineplus">+          if (changed.includes(&quot;image&quot;) &amp;&amp; filter.properties.has(&quot;favIconUrl&quot;)) {</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+            needed.push(&quot;favIconUrl&quot;);</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+          }</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+          if (changed.includes(&quot;label&quot;) &amp;&amp; filter.properties.has(&quot;title&quot;)) {</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+            needed.push(&quot;title&quot;);</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+          }</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineplus">+        }</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineplus">+</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineplus">+        let tab = tabManager.getWrapper(event.detail.tabInfo);</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineplus">+        let changeInfo = {};</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineplus">+        for (let prop of needed) {</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+          changeInfo[prop] = tab[prop];</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineplus">+        }</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineplus">+</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+        fireForTab(tab, changeInfo);</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineplus">+      };</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineplus">+</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineplus">+      let statusListener = ({ browser, status, url }) =&gt; {</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+        let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineplus">+        let nativeTabInfo = tabmail.getTabForBrowser(browser);</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+        if (nativeTabInfo) {</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+          let changed = { status };</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+          if (url) {</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+            changed.url = url;</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+          }</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineplus">+</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineplus">+          fireForTab(tabManager.getWrapper(nativeTabInfo), changed);</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+        }</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+      };</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineplus">+</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+      if (needsModified) {</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineplus">+        windowTracker.addListener(&quot;TabAttrModified&quot;, listener);</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+      }</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineplus">+      if (filter.properties.has(&quot;status&quot;)) {</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineplus">+        windowTracker.addListener(&quot;status&quot;, statusListener);</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+      }</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+      return () =&gt; {</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineplus">+        if (needsModified) {</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineplus">+          windowTracker.removeListener(&quot;TabAttrModified&quot;, listener);</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+        }</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineplus">+        if (filter.properties.has(&quot;status&quot;)) {</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineplus">+          windowTracker.removeListener(&quot;status&quot;, statusListener);</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+        }</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineplus">+      };</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineplus">+    };</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineplus">+</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineplus">+    super({</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineplus">+      context,</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+      name: &quot;tabs.onUpdated&quot;,</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineplus">+      register,</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineplus">+    });</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineplus">+  }</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineplus">+</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineplus">+  addListener(callback, filter) {</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+    let { extension } = this.context;</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineplus">+    if (filter &amp;&amp; filter.urls &amp;&amp;</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineplus">+        (!extension.hasPermission(&quot;tabs&quot;) &amp;&amp; !extension.hasPermission(&quot;activeTab&quot;))) {</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineplus">+      Cu.reportError(&quot;Url filtering in tabs.onUpdated requires \&quot;tabs\&quot; or \&quot;activeTab\&quot; permission.&quot;);</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineplus">+      return false;</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineplus">+    }</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineplus">+    return super.addListener(callback, filter);</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineplus">+  }</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineplus">+}</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineplus">+</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineplus">+this.tabs = class extends ExtensionAPI {</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineplus">+  getAPI(context) {</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineplus">+    let { extension } = context;</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineplus">+    let { tabManager } = extension;</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineplus">+</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineplus">+    /**</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineplus">+     * Gets the tab for the given tab id, or the active tab if the id is null</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineplus">+     *</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineplus">+     * @param {?Integer} tabId          The tab id to get</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineplus">+     * @return {Tab}                    The matching tab, or the active tab</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineplus">+     */</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineplus">+    function getTabOrActive(tabId) {</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineplus">+      if (tabId !== null) {</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineplus">+        return tabTracker.getTab(tabId);</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineplus">+      }</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineplus">+      return tabTracker.activeTab;</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineplus">+    }</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineplus">+</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineplus">+    /**</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineplus">+     * Promise that the tab with the given tab id is ready</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineplus">+     *</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineplus">+     * @param {Integer} tabId       The tab id to check</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineplus">+     * @return {Promise&lt;NativeTabInfo&gt;}     Resolved when the loading is complete</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineplus">+     */</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineplus">+    async function promiseTabWhenReady(tabId) {</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineplus">+      let tab;</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineplus">+      if (tabId === null) {</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineplus">+        tab = tabManager.getWrapper(tabTracker.activeTab);</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineplus">+      } else {</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineplus">+        tab = tabManager.get(tabId);</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineplus">+      }</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineplus">+</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineplus">+      await tabListener.awaitTabReady(tab.nativeTab);</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineplus">+</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineplus">+      return tab;</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineplus">+    }</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineplus">+</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineplus">+    return {</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+      tabs: {</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineplus">+        onActivated: new EventManager({</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineplus">+          context,</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineplus">+          name: &quot;tabs.onActivated&quot;,</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineplus">+            let listener = (eventName, event) =&gt; {</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineplus">+              fire.async(event);</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineplus">+            };</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineplus">+</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineplus">+            tabTracker.on(&quot;tab-activated&quot;, listener);</span>
<a href="#l13.279"></a><span id="l13.279" class="difflineplus">+            return () =&gt; {</span>
<a href="#l13.280"></a><span id="l13.280" class="difflineplus">+              tabTracker.off(&quot;tab-activated&quot;, listener);</span>
<a href="#l13.281"></a><span id="l13.281" class="difflineplus">+            };</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineplus">+          }</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineplus">+        }).api(),</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineplus">+</span>
<a href="#l13.285"></a><span id="l13.285" class="difflineplus">+        onCreated: new EventManager({</span>
<a href="#l13.286"></a><span id="l13.286" class="difflineplus">+          context,</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineplus">+          name: &quot;tabs.onCreated&quot;,</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineplus">+            let listener = (eventName, event) =&gt; {</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineplus">+              fire.async(tabManager.convert(event.nativeTabInfo, event.currentTab));</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineplus">+            };</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineplus">+</span>
<a href="#l13.293"></a><span id="l13.293" class="difflineplus">+            tabTracker.on(&quot;tab-created&quot;, listener);</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineplus">+            return () =&gt; {</span>
<a href="#l13.295"></a><span id="l13.295" class="difflineplus">+              tabTracker.off(&quot;tab-created&quot;, listener);</span>
<a href="#l13.296"></a><span id="l13.296" class="difflineplus">+            };</span>
<a href="#l13.297"></a><span id="l13.297" class="difflineplus">+          }</span>
<a href="#l13.298"></a><span id="l13.298" class="difflineplus">+        }).api(),</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineplus">+</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineplus">+        onAttached: new EventManager({</span>
<a href="#l13.301"></a><span id="l13.301" class="difflineplus">+          context,</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineplus">+          name: &quot;tabs.onAttached&quot;,</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineplus">+            let listener = (eventName, event) =&gt; {</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineplus">+              fire.async(event.tabId, { newWindowId: event.newWindowId, newPosition: event.newPosition });</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineplus">+            };</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineplus">+</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineplus">+            tabTracker.on(&quot;tab-attached&quot;, listener);</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineplus">+            return () =&gt; {</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineplus">+              tabTracker.off(&quot;tab-attached&quot;, listener);</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineplus">+            };</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineplus">+          },</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineplus">+        }).api(),</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineplus">+</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineplus">+        onDetached: new EventManager({</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineplus">+          context,</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineplus">+          name: &quot;tabs.onDetached&quot;,</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineplus">+            let listener = (eventName, event) =&gt; {</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineplus">+              fire.async(event.tabId, { oldWindowId: event.oldWindowId, oldPosition: event.oldPosition });</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineplus">+            };</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineplus">+</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineplus">+            tabTracker.on(&quot;tab-detached&quot;, listener);</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineplus">+            return () =&gt; {</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineplus">+              tabTracker.off(&quot;tab-detached&quot;, listener);</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineplus">+            };</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineplus">+          },</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineplus">+        }).api(),</span>
<a href="#l13.329"></a><span id="l13.329" class="difflineplus">+</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineplus">+        onRemoved: new EventManager({</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineplus">+          context,</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineplus">+          name: &quot;tabs.onRemoved&quot;,</span>
<a href="#l13.333"></a><span id="l13.333" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineplus">+            let listener = (eventName, event) =&gt; {</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineplus">+              fire.async(event.tabId, { windowId: event.windowId, isWindowClosing: event.isWindowClosing });</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineplus">+            };</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineplus">+</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineplus">+            tabTracker.on(&quot;tab-removed&quot;, listener);</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineplus">+            return () =&gt; {</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineplus">+              tabTracker.off(&quot;tab-removed&quot;, listener);</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineplus">+            };</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineplus">+          }</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineplus">+        }).api(),</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineplus">+</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineplus">+        onMoved: new EventManager({</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineplus">+          context,</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineplus">+          name: &quot;tabs.onMoved&quot;,</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineplus">+            let moveListener = event =&gt; {</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineplus">+              let nativeTab = event.originalTarget;</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineplus">+              let nativeTabInfo = event.detail.tabInfo;</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineplus">+              let tabmail = nativeTab.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineplus">+</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineplus">+              fire.async(tabTracker.getId(nativeTabInfo), {</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineplus">+                windowId: windowTracker.getId(nativeTab.ownerGlobal),</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineplus">+                fromIndex: event.detail.idx,</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineplus">+                toIndex: tabmail.tabInfo.indexOf(nativeTabInfo)</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineplus">+              });</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineplus">+            };</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineplus">+</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineplus">+            windowTracker.addListener(&quot;TabMove&quot;, moveListener);</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineplus">+            return () =&gt; {</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineplus">+              windowTracker.removeListener(&quot;TabMove&quot;, moveListener);</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineplus">+            };</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineplus">+          }</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineplus">+        }).api(),</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineplus">+</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineplus">+        onUpdated: new TabsUpdateFilterEventManager(context).api(),</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineplus">+</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineplus">+        async create(createProperties) {</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineplus">+          let window = createProperties.windowId === null</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineplus">+              ? windowTracker.topNormalWindow</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineplus">+              : windowTracker.getWindow(createProperties.windowId, context);</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineplus">+          let tabmail = window.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.375"></a><span id="l13.375" class="difflineplus">+</span>
<a href="#l13.376"></a><span id="l13.376" class="difflineplus">+          let url;</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineplus">+          if (createProperties.url !== null) {</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineplus">+            url = context.uri.resolve(createProperties.url);</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineplus">+</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineplus">+            if (!context.checkLoadURL(url, { dontReportErrors: true })) {</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineplus">+              return Promise.reject({ message: `Illegal URL: ${url}` });</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineplus">+            }</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineplus">+          }</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineplus">+</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineplus">+          let currentTab = tabmail.selectedTab;</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineplus">+</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineplus">+          let active = true;</span>
<a href="#l13.388"></a><span id="l13.388" class="difflineplus">+          if (createProperties.active !== null) {</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineplus">+            active = createProperties.active;</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineplus">+          }</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineplus">+</span>
<a href="#l13.392"></a><span id="l13.392" class="difflineplus">+          tabListener.initTabReady();</span>
<a href="#l13.393"></a><span id="l13.393" class="difflineplus">+</span>
<a href="#l13.394"></a><span id="l13.394" class="difflineplus">+          let nativeTabInfo = tabmail.openTab(&quot;contentTab&quot;, {</span>
<a href="#l13.395"></a><span id="l13.395" class="difflineplus">+            contentPage: url || &quot;about:blank&quot;,</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineplus">+            background: !active</span>
<a href="#l13.397"></a><span id="l13.397" class="difflineplus">+          });</span>
<a href="#l13.398"></a><span id="l13.398" class="difflineplus">+</span>
<a href="#l13.399"></a><span id="l13.399" class="difflineplus">+          if (createProperties.index !== null) {</span>
<a href="#l13.400"></a><span id="l13.400" class="difflineplus">+            tabmail.moveTabTo(nativeTabInfo, createProperties.index);</span>
<a href="#l13.401"></a><span id="l13.401" class="difflineplus">+            tabmail.updateCurrentTab();</span>
<a href="#l13.402"></a><span id="l13.402" class="difflineplus">+          }</span>
<a href="#l13.403"></a><span id="l13.403" class="difflineplus">+</span>
<a href="#l13.404"></a><span id="l13.404" class="difflineplus">+          if (createProperties.url &amp;&amp; createProperties.url !== &quot;about:blank&quot;) {</span>
<a href="#l13.405"></a><span id="l13.405" class="difflineplus">+            // Mark tabs as initializing, so operations like `executeScript` wait until the</span>
<a href="#l13.406"></a><span id="l13.406" class="difflineplus">+            // requested URL is loaded</span>
<a href="#l13.407"></a><span id="l13.407" class="difflineplus">+            tabListener.initializingTabs.add(nativeTabInfo);</span>
<a href="#l13.408"></a><span id="l13.408" class="difflineplus">+          }</span>
<a href="#l13.409"></a><span id="l13.409" class="difflineplus">+</span>
<a href="#l13.410"></a><span id="l13.410" class="difflineplus">+          return tabManager.convert(nativeTabInfo, currentTab);</span>
<a href="#l13.411"></a><span id="l13.411" class="difflineplus">+        },</span>
<a href="#l13.412"></a><span id="l13.412" class="difflineplus">+</span>
<a href="#l13.413"></a><span id="l13.413" class="difflineplus">+        async remove(tabs) {</span>
<a href="#l13.414"></a><span id="l13.414" class="difflineplus">+          if (!Array.isArray(tabs)) {</span>
<a href="#l13.415"></a><span id="l13.415" class="difflineplus">+            tabs = [tabs];</span>
<a href="#l13.416"></a><span id="l13.416" class="difflineplus">+          }</span>
<a href="#l13.417"></a><span id="l13.417" class="difflineplus">+</span>
<a href="#l13.418"></a><span id="l13.418" class="difflineplus">+          for (let tabId of tabs) {</span>
<a href="#l13.419"></a><span id="l13.419" class="difflineplus">+            let nativeTabInfo = tabTracker.getTab(tabId);</span>
<a href="#l13.420"></a><span id="l13.420" class="difflineplus">+            let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l13.421"></a><span id="l13.421" class="difflineplus">+            let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.422"></a><span id="l13.422" class="difflineplus">+            tabmail.closeTab(nativeTabInfo);</span>
<a href="#l13.423"></a><span id="l13.423" class="difflineplus">+          }</span>
<a href="#l13.424"></a><span id="l13.424" class="difflineplus">+        },</span>
<a href="#l13.425"></a><span id="l13.425" class="difflineplus">+</span>
<a href="#l13.426"></a><span id="l13.426" class="difflineplus">+        async update(tabId, updateProperties) {</span>
<a href="#l13.427"></a><span id="l13.427" class="difflineplus">+          let nativeTabInfo = getTabOrActive(tabId);</span>
<a href="#l13.428"></a><span id="l13.428" class="difflineplus">+          let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l13.429"></a><span id="l13.429" class="difflineplus">+          let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.430"></a><span id="l13.430" class="difflineplus">+</span>
<a href="#l13.431"></a><span id="l13.431" class="difflineplus">+          if (updateProperties.url !== null) {</span>
<a href="#l13.432"></a><span id="l13.432" class="difflineplus">+            let url = context.uri.resolve(updateProperties.url);</span>
<a href="#l13.433"></a><span id="l13.433" class="difflineplus">+</span>
<a href="#l13.434"></a><span id="l13.434" class="difflineplus">+            if (!context.checkLoadURL(url, { dontReportErrors: true })) {</span>
<a href="#l13.435"></a><span id="l13.435" class="difflineplus">+              return Promise.reject({ message: `Illegal URL: ${url}` });</span>
<a href="#l13.436"></a><span id="l13.436" class="difflineplus">+            }</span>
<a href="#l13.437"></a><span id="l13.437" class="difflineplus">+</span>
<a href="#l13.438"></a><span id="l13.438" class="difflineplus">+            let options = {</span>
<a href="#l13.439"></a><span id="l13.439" class="difflineplus">+              flags: updateProperties.loadReplace</span>
<a href="#l13.440"></a><span id="l13.440" class="difflineplus">+                      ? Ci.nsIWebNavigation.LOAD_FLAGS_REPLACE_HISTORY</span>
<a href="#l13.441"></a><span id="l13.441" class="difflineplus">+                      : Ci.nsIWebNavigation.LOAD_FLAGS_NONE,</span>
<a href="#l13.442"></a><span id="l13.442" class="difflineplus">+              triggeringPrincipal: context.principal,</span>
<a href="#l13.443"></a><span id="l13.443" class="difflineplus">+            };</span>
<a href="#l13.444"></a><span id="l13.444" class="difflineplus">+            browser.loadURI(url, options);</span>
<a href="#l13.445"></a><span id="l13.445" class="difflineplus">+          }</span>
<a href="#l13.446"></a><span id="l13.446" class="difflineplus">+</span>
<a href="#l13.447"></a><span id="l13.447" class="difflineplus">+          if (updateProperties.active !== null) {</span>
<a href="#l13.448"></a><span id="l13.448" class="difflineplus">+            if (updateProperties.active) {</span>
<a href="#l13.449"></a><span id="l13.449" class="difflineplus">+              tabmail.selectedTab = nativeTabInfo;</span>
<a href="#l13.450"></a><span id="l13.450" class="difflineplus">+            } else {</span>
<a href="#l13.451"></a><span id="l13.451" class="difflineplus">+              // Not sure what to do here? Which tab should we select?</span>
<a href="#l13.452"></a><span id="l13.452" class="difflineplus">+            }</span>
<a href="#l13.453"></a><span id="l13.453" class="difflineplus">+          }</span>
<a href="#l13.454"></a><span id="l13.454" class="difflineplus">+</span>
<a href="#l13.455"></a><span id="l13.455" class="difflineplus">+          return tabManager.convert(nativeTabInfo);</span>
<a href="#l13.456"></a><span id="l13.456" class="difflineplus">+        },</span>
<a href="#l13.457"></a><span id="l13.457" class="difflineplus">+</span>
<a href="#l13.458"></a><span id="l13.458" class="difflineplus">+        async reload(tabId, reloadProperties) {</span>
<a href="#l13.459"></a><span id="l13.459" class="difflineplus">+          let nativeTabInfo = getTabOrActive(tabId);</span>
<a href="#l13.460"></a><span id="l13.460" class="difflineplus">+          let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l13.461"></a><span id="l13.461" class="difflineplus">+</span>
<a href="#l13.462"></a><span id="l13.462" class="difflineplus">+          let flags = Ci.nsIWebNavigation.LOAD_FLAGS_NONE;</span>
<a href="#l13.463"></a><span id="l13.463" class="difflineplus">+          if (reloadProperties &amp;&amp; reloadProperties.bypassCache) {</span>
<a href="#l13.464"></a><span id="l13.464" class="difflineplus">+            flags |= Ci.nsIWebNavigation.LOAD_FLAGS_BYPASS_CACHE;</span>
<a href="#l13.465"></a><span id="l13.465" class="difflineplus">+          }</span>
<a href="#l13.466"></a><span id="l13.466" class="difflineplus">+          browser.reloadWithFlags(flags);</span>
<a href="#l13.467"></a><span id="l13.467" class="difflineplus">+        },</span>
<a href="#l13.468"></a><span id="l13.468" class="difflineplus">+</span>
<a href="#l13.469"></a><span id="l13.469" class="difflineplus">+        async get(tabId) {</span>
<a href="#l13.470"></a><span id="l13.470" class="difflineplus">+          return tabManager.get(tabId).convert();</span>
<a href="#l13.471"></a><span id="l13.471" class="difflineplus">+        },</span>
<a href="#l13.472"></a><span id="l13.472" class="difflineplus">+</span>
<a href="#l13.473"></a><span id="l13.473" class="difflineplus">+        getCurrent() {</span>
<a href="#l13.474"></a><span id="l13.474" class="difflineplus">+          let tabData;</span>
<a href="#l13.475"></a><span id="l13.475" class="difflineplus">+          if (context.tabId) {</span>
<a href="#l13.476"></a><span id="l13.476" class="difflineplus">+            tabData = tabManager.get(context.tabId).convert();</span>
<a href="#l13.477"></a><span id="l13.477" class="difflineplus">+          }</span>
<a href="#l13.478"></a><span id="l13.478" class="difflineplus">+          return Promise.resolve(tabData);</span>
<a href="#l13.479"></a><span id="l13.479" class="difflineplus">+        },</span>
<a href="#l13.480"></a><span id="l13.480" class="difflineplus">+</span>
<a href="#l13.481"></a><span id="l13.481" class="difflineplus">+        async query(queryInfo) {</span>
<a href="#l13.482"></a><span id="l13.482" class="difflineplus">+          if (!extension.hasPermission(&quot;tabs&quot;)) {</span>
<a href="#l13.483"></a><span id="l13.483" class="difflineplus">+            if (queryInfo.url !== null || queryInfo.title !== null) {</span>
<a href="#l13.484"></a><span id="l13.484" class="difflineplus">+              return Promise.reject({ message: 'The &quot;tabs&quot; permission is required to use the query API with the &quot;url&quot; or &quot;title&quot; parameters' });</span>
<a href="#l13.485"></a><span id="l13.485" class="difflineplus">+            }</span>
<a href="#l13.486"></a><span id="l13.486" class="difflineplus">+          }</span>
<a href="#l13.487"></a><span id="l13.487" class="difflineplus">+</span>
<a href="#l13.488"></a><span id="l13.488" class="difflineplus">+          queryInfo = Object.assign({}, queryInfo);</span>
<a href="#l13.489"></a><span id="l13.489" class="difflineplus">+</span>
<a href="#l13.490"></a><span id="l13.490" class="difflineplus">+          if (queryInfo.url !== null) {</span>
<a href="#l13.491"></a><span id="l13.491" class="difflineplus">+            queryInfo.url = new MatchPatternSet([].concat(queryInfo.url));</span>
<a href="#l13.492"></a><span id="l13.492" class="difflineplus">+          }</span>
<a href="#l13.493"></a><span id="l13.493" class="difflineplus">+          if (queryInfo.title !== null) {</span>
<a href="#l13.494"></a><span id="l13.494" class="difflineplus">+            queryInfo.title = new MatchGlob(queryInfo.title);</span>
<a href="#l13.495"></a><span id="l13.495" class="difflineplus">+          }</span>
<a href="#l13.496"></a><span id="l13.496" class="difflineplus">+</span>
<a href="#l13.497"></a><span id="l13.497" class="difflineplus">+          // Make ext-tabs-base happy since it does a strict check</span>
<a href="#l13.498"></a><span id="l13.498" class="difflineplus">+          queryInfo.screen = null;</span>
<a href="#l13.499"></a><span id="l13.499" class="difflineplus">+</span>
<a href="#l13.500"></a><span id="l13.500" class="difflineplus">+          return Array.from(tabManager.query(queryInfo, context), tab =&gt; tab.convert());</span>
<a href="#l13.501"></a><span id="l13.501" class="difflineplus">+        },</span>
<a href="#l13.502"></a><span id="l13.502" class="difflineplus">+</span>
<a href="#l13.503"></a><span id="l13.503" class="difflineplus">+        async executeScript(tabId, details) {</span>
<a href="#l13.504"></a><span id="l13.504" class="difflineplus">+          // TODO make this work</span>
<a href="#l13.505"></a><span id="l13.505" class="difflineplus">+          let tab = await promiseTabWhenReady(tabId);</span>
<a href="#l13.506"></a><span id="l13.506" class="difflineplus">+</span>
<a href="#l13.507"></a><span id="l13.507" class="difflineplus">+          return tab.executeScript(context, details);</span>
<a href="#l13.508"></a><span id="l13.508" class="difflineplus">+        },</span>
<a href="#l13.509"></a><span id="l13.509" class="difflineplus">+</span>
<a href="#l13.510"></a><span id="l13.510" class="difflineplus">+        async insertCSS(tabId, details) {</span>
<a href="#l13.511"></a><span id="l13.511" class="difflineplus">+          // TODO make this work</span>
<a href="#l13.512"></a><span id="l13.512" class="difflineplus">+          let tab = await promiseTabWhenReady(tabId);</span>
<a href="#l13.513"></a><span id="l13.513" class="difflineplus">+</span>
<a href="#l13.514"></a><span id="l13.514" class="difflineplus">+          return tab.insertCSS(context, details);</span>
<a href="#l13.515"></a><span id="l13.515" class="difflineplus">+        },</span>
<a href="#l13.516"></a><span id="l13.516" class="difflineplus">+</span>
<a href="#l13.517"></a><span id="l13.517" class="difflineplus">+        async removeCSS(tabId, details) {</span>
<a href="#l13.518"></a><span id="l13.518" class="difflineplus">+          // TODO make this work</span>
<a href="#l13.519"></a><span id="l13.519" class="difflineplus">+          let tab = await promiseTabWhenReady(tabId);</span>
<a href="#l13.520"></a><span id="l13.520" class="difflineplus">+</span>
<a href="#l13.521"></a><span id="l13.521" class="difflineplus">+          return tab.removeCSS(context, details);</span>
<a href="#l13.522"></a><span id="l13.522" class="difflineplus">+        },</span>
<a href="#l13.523"></a><span id="l13.523" class="difflineplus">+</span>
<a href="#l13.524"></a><span id="l13.524" class="difflineplus">+        async move(tabIds, moveProperties) {</span>
<a href="#l13.525"></a><span id="l13.525" class="difflineplus">+          let tabsMoved = [];</span>
<a href="#l13.526"></a><span id="l13.526" class="difflineplus">+          if (!Array.isArray(tabIds)) {</span>
<a href="#l13.527"></a><span id="l13.527" class="difflineplus">+            tabIds = [tabIds];</span>
<a href="#l13.528"></a><span id="l13.528" class="difflineplus">+          }</span>
<a href="#l13.529"></a><span id="l13.529" class="difflineplus">+</span>
<a href="#l13.530"></a><span id="l13.530" class="difflineplus">+          let destinationWindow = null;</span>
<a href="#l13.531"></a><span id="l13.531" class="difflineplus">+          if (moveProperties.windowId !== null) {</span>
<a href="#l13.532"></a><span id="l13.532" class="difflineplus">+            destinationWindow = windowTracker.getWindow(moveProperties.windowId);</span>
<a href="#l13.533"></a><span id="l13.533" class="difflineplus">+            // Fail on an invalid window.</span>
<a href="#l13.534"></a><span id="l13.534" class="difflineplus">+            if (!destinationWindow) {</span>
<a href="#l13.535"></a><span id="l13.535" class="difflineplus">+              return Promise.reject({ message: `Invalid window ID: ${moveProperties.windowId}` });</span>
<a href="#l13.536"></a><span id="l13.536" class="difflineplus">+            }</span>
<a href="#l13.537"></a><span id="l13.537" class="difflineplus">+          }</span>
<a href="#l13.538"></a><span id="l13.538" class="difflineplus">+</span>
<a href="#l13.539"></a><span id="l13.539" class="difflineplus">+          /*</span>
<a href="#l13.540"></a><span id="l13.540" class="difflineplus">+            Indexes are maintained on a per window basis so that a call to</span>
<a href="#l13.541"></a><span id="l13.541" class="difflineplus">+              move([tabA, tabB], {index: 0})</span>
<a href="#l13.542"></a><span id="l13.542" class="difflineplus">+                -&gt; tabA to 0, tabB to 1 if tabA and tabB are in the same window</span>
<a href="#l13.543"></a><span id="l13.543" class="difflineplus">+              move([tabA, tabB], {index: 0})</span>
<a href="#l13.544"></a><span id="l13.544" class="difflineplus">+                -&gt; tabA to 0, tabB to 0 if tabA and tabB are in different windows</span>
<a href="#l13.545"></a><span id="l13.545" class="difflineplus">+          */</span>
<a href="#l13.546"></a><span id="l13.546" class="difflineplus">+          let indexMap = new Map();</span>
<a href="#l13.547"></a><span id="l13.547" class="difflineplus">+          let lastInsertion = new Map();</span>
<a href="#l13.548"></a><span id="l13.548" class="difflineplus">+</span>
<a href="#l13.549"></a><span id="l13.549" class="difflineplus">+          let tabs = tabIds.map(tabId =&gt; tabTracker.getTab(tabId));</span>
<a href="#l13.550"></a><span id="l13.550" class="difflineplus">+          for (let nativeTabInfo of tabs) {</span>
<a href="#l13.551"></a><span id="l13.551" class="difflineplus">+            // If the window is not specified, use the window from the tab.</span>
<a href="#l13.552"></a><span id="l13.552" class="difflineplus">+            let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l13.553"></a><span id="l13.553" class="difflineplus">+</span>
<a href="#l13.554"></a><span id="l13.554" class="difflineplus">+            let srcwindow = browser.ownerGlobal;</span>
<a href="#l13.555"></a><span id="l13.555" class="difflineplus">+            let tgtwindow = destinationWindow || browser.ownerGlobal;</span>
<a href="#l13.556"></a><span id="l13.556" class="difflineplus">+            let tgttabmail = tgtwindow.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.557"></a><span id="l13.557" class="difflineplus">+            let srctabmail = srcwindow.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.558"></a><span id="l13.558" class="difflineplus">+</span>
<a href="#l13.559"></a><span id="l13.559" class="difflineplus">+            // If we are not moving the tab to a different window, and the window</span>
<a href="#l13.560"></a><span id="l13.560" class="difflineplus">+            // only has one tab, do nothing.</span>
<a href="#l13.561"></a><span id="l13.561" class="difflineplus">+            if (srcwindow == tgtwindow &amp;&amp; srctabmail.tabInfo.length === 1) {</span>
<a href="#l13.562"></a><span id="l13.562" class="difflineplus">+              continue;</span>
<a href="#l13.563"></a><span id="l13.563" class="difflineplus">+            }</span>
<a href="#l13.564"></a><span id="l13.564" class="difflineplus">+</span>
<a href="#l13.565"></a><span id="l13.565" class="difflineplus">+            let insertionPoint = indexMap.get(tgtwindow) || moveProperties.index;</span>
<a href="#l13.566"></a><span id="l13.566" class="difflineplus">+            // If the index is -1 it should go to the end of the tabs.</span>
<a href="#l13.567"></a><span id="l13.567" class="difflineplus">+            if (insertionPoint == -1) {</span>
<a href="#l13.568"></a><span id="l13.568" class="difflineplus">+              insertionPoint = tgttabmail.tabInfo.length;</span>
<a href="#l13.569"></a><span id="l13.569" class="difflineplus">+            }</span>
<a href="#l13.570"></a><span id="l13.570" class="difflineplus">+</span>
<a href="#l13.571"></a><span id="l13.571" class="difflineplus">+            let tabPosition = srctabmail.tabInfo.indexOf(nativeTabInfo);</span>
<a href="#l13.572"></a><span id="l13.572" class="difflineplus">+</span>
<a href="#l13.573"></a><span id="l13.573" class="difflineplus">+            // If this is not the first tab to be inserted into this window and</span>
<a href="#l13.574"></a><span id="l13.574" class="difflineplus">+            // the insertion point is the same as the last insertion and</span>
<a href="#l13.575"></a><span id="l13.575" class="difflineplus">+            // the tab is further to the right than the current insertion point</span>
<a href="#l13.576"></a><span id="l13.576" class="difflineplus">+            // then you need to bump up the insertion point. See bug 1323311.</span>
<a href="#l13.577"></a><span id="l13.577" class="difflineplus">+            if (lastInsertion.has(tgtwindow) &amp;&amp;</span>
<a href="#l13.578"></a><span id="l13.578" class="difflineplus">+                lastInsertion.get(tgtwindow) === insertionPoint &amp;&amp;</span>
<a href="#l13.579"></a><span id="l13.579" class="difflineplus">+                tabPosition &gt; insertionPoint) {</span>
<a href="#l13.580"></a><span id="l13.580" class="difflineplus">+              insertionPoint++;</span>
<a href="#l13.581"></a><span id="l13.581" class="difflineplus">+              indexMap.set(tgtwindow, insertionPoint);</span>
<a href="#l13.582"></a><span id="l13.582" class="difflineplus">+            }</span>
<a href="#l13.583"></a><span id="l13.583" class="difflineplus">+</span>
<a href="#l13.584"></a><span id="l13.584" class="difflineplus">+            if (srcwindow == tgtwindow) {</span>
<a href="#l13.585"></a><span id="l13.585" class="difflineplus">+              // If the window we are moving is the same, just move the tab.</span>
<a href="#l13.586"></a><span id="l13.586" class="difflineplus">+              tgttabmail.moveTabTo(nativeTabInfo, insertionPoint);</span>
<a href="#l13.587"></a><span id="l13.587" class="difflineplus">+            } else {</span>
<a href="#l13.588"></a><span id="l13.588" class="difflineplus">+              // If the window we are moving the tab in is different, then move the tab</span>
<a href="#l13.589"></a><span id="l13.589" class="difflineplus">+              // to the new window.</span>
<a href="#l13.590"></a><span id="l13.590" class="difflineplus">+              srctabmail.replaceTabWithWindow(nativeTabInfo, tgtwindow, insertionPoint);</span>
<a href="#l13.591"></a><span id="l13.591" class="difflineplus">+              nativeTabInfo = tgttabmail.tabInfo[insertionPoint] ||</span>
<a href="#l13.592"></a><span id="l13.592" class="difflineplus">+                tgttabmail.tabInfo[tgttabmail.tabInfo.length - 1];</span>
<a href="#l13.593"></a><span id="l13.593" class="difflineplus">+            }</span>
<a href="#l13.594"></a><span id="l13.594" class="difflineplus">+            lastInsertion.set(tgtwindow, tabPosition);</span>
<a href="#l13.595"></a><span id="l13.595" class="difflineplus">+            tabsMoved.push(nativeTabInfo);</span>
<a href="#l13.596"></a><span id="l13.596" class="difflineplus">+          }</span>
<a href="#l13.597"></a><span id="l13.597" class="difflineplus">+</span>
<a href="#l13.598"></a><span id="l13.598" class="difflineplus">+          return tabsMoved.map(nativeTabInfo =&gt; tabManager.convert(nativeTabInfo));</span>
<a href="#l13.599"></a><span id="l13.599" class="difflineplus">+        },</span>
<a href="#l13.600"></a><span id="l13.600" class="difflineplus">+</span>
<a href="#l13.601"></a><span id="l13.601" class="difflineplus">+        duplicate(tabId) {</span>
<a href="#l13.602"></a><span id="l13.602" class="difflineplus">+          let nativeTabInfo = tabTracker.getTab(tabId);</span>
<a href="#l13.603"></a><span id="l13.603" class="difflineplus">+          let browser = getTabBrowser(nativeTabInfo);</span>
<a href="#l13.604"></a><span id="l13.604" class="difflineplus">+          let tabmail = browser.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l13.605"></a><span id="l13.605" class="difflineplus">+</span>
<a href="#l13.606"></a><span id="l13.606" class="difflineplus">+          // This is our best approximation of duplicating tabs. It might produce unreliable results</span>
<a href="#l13.607"></a><span id="l13.607" class="difflineplus">+          let state = tabmail.persistTab(nativeTabInfo);</span>
<a href="#l13.608"></a><span id="l13.608" class="difflineplus">+          let mode = tabmail.tabModes[state.mode];</span>
<a href="#l13.609"></a><span id="l13.609" class="difflineplus">+          state.state.duplicate = true;</span>
<a href="#l13.610"></a><span id="l13.610" class="difflineplus">+</span>
<a href="#l13.611"></a><span id="l13.611" class="difflineplus">+          if (mode.tabs.length &amp;&amp; mode.tabs.length == mode.maxTabs) {</span>
<a href="#l13.612"></a><span id="l13.612" class="difflineplus">+            throw new ExtensionError(`Maximum number of ${state.mode} tabs reached`);</span>
<a href="#l13.613"></a><span id="l13.613" class="difflineplus">+          } else {</span>
<a href="#l13.614"></a><span id="l13.614" class="difflineplus">+            tabmail.restoreTab(state);</span>
<a href="#l13.615"></a><span id="l13.615" class="difflineplus">+            return tabManager.convert(mode.tabs[mode.tabs.length - 1]);</span>
<a href="#l13.616"></a><span id="l13.616" class="difflineplus">+          }</span>
<a href="#l13.617"></a><span id="l13.617" class="difflineplus">+        }</span>
<a href="#l13.618"></a><span id="l13.618" class="difflineplus">+      }</span>
<a href="#l13.619"></a><span id="l13.619" class="difflineplus">+    };</span>
<a href="#l13.620"></a><span id="l13.620" class="difflineplus">+  }</span>
<a href="#l13.621"></a><span id="l13.621" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/mail/components/extensions/parent/ext-windows.js</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,212 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+// The ext-* files are imported into the same scopes.</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+/* import-globals-from ext-mail.js */</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+this.windows = class extends ExtensionAPI {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+  getAPI(context) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+    const { extension } = context;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+    const { windowManager } = extension;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+    return {</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+      windows: {</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+        onCreated: new WindowEventManager(context, &quot;windows.onCreated&quot;, &quot;domwindowopened&quot;, (fire, window) =&gt; {</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+          fire.async(windowManager.convert(window));</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+        }).api(),</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+        onRemoved: new WindowEventManager(context, &quot;windows.onRemoved&quot;, &quot;domwindowclosed&quot;, (fire, window) =&gt; {</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+          fire.async(windowTracker.getId(window));</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+        }).api(),</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+        onFocusChanged: new EventManager({</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+          context,</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+          name: &quot;windows.onFocusChanged&quot;,</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+          register: fire =&gt; {</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+            // Keep track of the last windowId used to fire an onFocusChanged event</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+            let lastOnFocusChangedWindowId;</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+            let listener = event =&gt; {</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+              // Wait a tick to avoid firing a superfluous WINDOW_ID_NONE</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+              // event when switching focus between two Firefox windows.</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+              Promise.resolve().then(() =&gt; {</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+                let window = Services.focus.activeWindow;</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+                let windowId = window ? windowTracker.getId(window) : Window.WINDOW_ID_NONE;</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+                if (windowId !== lastOnFocusChangedWindowId) {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+                  fire.async(windowId);</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+                  lastOnFocusChangedWindowId = windowId;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+                }</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+              });</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+            };</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+            windowTracker.addListener(&quot;focus&quot;, listener);</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+            windowTracker.addListener(&quot;blur&quot;, listener);</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+            return () =&gt; {</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+              windowTracker.removeListener(&quot;focus&quot;, listener);</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+              windowTracker.removeListener(&quot;blur&quot;, listener);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+            };</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+          }</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+        }).api(),</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+        get: function(windowId, getInfo) {</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+          let window = windowTracker.getWindow(windowId, context);</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+          if (!window) {</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+            return Promise.reject({ message: `Invalid window ID: ${windowId}` });</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+          }</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+          return Promise.resolve(windowManager.convert(window, getInfo));</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+        },</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+        getCurrent: function(getInfo) {</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+          let window = context.currentWindow || windowTracker.topWindow;</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+          return Promise.resolve(windowManager.convert(window, getInfo));</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+        },</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+        getLastFocused: function(getInfo) {</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+          let window = windowTracker.topWindow;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+          return Promise.resolve(windowManager.convert(window, getInfo));</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+        },</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+        getAll: function(getInfo) {</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+          let doNotCheckTypes = getInfo === null || getInfo.windowTypes === null;</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+          function typeFilter(win) {</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+            return doNotCheckTypes || getInfo.windowTypes.includes(win.type);</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+          }</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+          let windows = Array.from(windowManager.getAll(), win =&gt; win.convert(getInfo)).filter(typeFilter);</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+          return Promise.resolve(windows);</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+        },</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+        create: function(createData) {</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+          let needResize = (createData.left !== null || createData.top !== null ||</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+                            createData.width !== null || createData.height !== null);</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+          if (needResize) {</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+            if (createData.state !== null &amp;&amp; createData.state != &quot;normal&quot;) {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+              return Promise.reject({ message: `&quot;state&quot;: &quot;${createData.state}&quot; may not be combined with &quot;left&quot;, &quot;top&quot;, &quot;width&quot;, or &quot;height&quot;` });</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+            }</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+            createData.state = &quot;normal&quot;;</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+          }</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+          let createWindowArgs = (urls) =&gt; {</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+            let args = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+            let actionData = {</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+              action: &quot;open&quot;,</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+              tabs: urls.map(url =&gt; ({ tabType: &quot;contentTab&quot;, tabParams: { contentPage: url } }))</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+            };</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+            actionData.wrappedJSObject = actionData;</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+            args.appendElement(null);</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+            args.appendElement(actionData);</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+            return args;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+          };</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+          let window;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+          let wantNormalWindow = createData.type === null || createData.type == &quot;normal&quot;;</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+          let features = [&quot;chrome&quot;];</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+          if (wantNormalWindow) {</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+            features.push(&quot;dialog=no&quot;, &quot;all&quot;, &quot;status&quot;, &quot;toolbar&quot;);</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+            if (createData.incognito) {</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+              // A private mode mail window isn't useful for Thunderbird</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+              return Promise.reject({ message: &quot;`incognito` is currently not supported for normal windows&quot; });</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+            }</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+          } else {</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+            // All other types create &quot;popup&quot;-type windows by default.</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+            features.push(&quot;dialog&quot;, &quot;resizable&quot;, &quot;minimizable&quot;, &quot;centerscreen&quot;, &quot;titlebar&quot;, &quot;close&quot;);</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+            if (createData.incognito) {</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+              features.push(&quot;private&quot;);</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineplus">+            }</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineplus">+          }</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineplus">+</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineplus">+          if (createData.tabId !== null) {</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineplus">+            if (createData.url !== null) {</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+              return Promise.reject({ message: &quot;`tabId` may not be used in conjunction with `url`&quot; });</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+            }</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineplus">+            if (createData.allowScriptsToClose) {</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+              return Promise.reject({ message: &quot;`tabId` may not be used in conjunction with `allowScriptsToClose`&quot; });</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+            }</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineplus">+</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+            let nativeTabInfo = tabTracker.getTab(createData.tabId);</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+            let tabmail = getTabBrowser(nativeTabInfo).ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+            let targetType = wantNormalWindow ? null : &quot;popup&quot;;</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineplus">+            window = tabmail.replaceTabWithWindow(nativeTabInfo, targetType)[0];</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineplus">+          } else if (createData.url !== null) { // eslint-disable-line no-negated-condition</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineplus">+            let uris = Array.isArray(createData.url) ? createData.url : [createData.url];</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineplus">+            let args = createWindowArgs(uris);</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineplus">+            window = Services.ww.openWindow(null, &quot;chrome://messenger/content/&quot;, &quot;_blank&quot;, features.join(&quot;,&quot;), args);</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+          } else {</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+            let args = null;</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+            if (!wantNormalWindow) {</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+              args = createWindowArgs([&quot;about:blank&quot;]);</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+            }</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineplus">+            window = Services.ww.openWindow(null, &quot;chrome://messenger/content/&quot;, &quot;_blank&quot;, features.join(&quot;,&quot;), args);</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+          }</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineplus">+          let win = windowManager.getWrapper(window);</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineplus">+          win.updateGeometry(createData);</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineplus">+</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineplus">+          // TODO: focused, type</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineplus">+</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineplus">+          return new Promise(resolve =&gt; {</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineplus">+            window.addEventListener(&quot;load&quot;, () =&gt; {</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineplus">+              resolve();</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineplus">+            }, { once: true });</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineplus">+          }).then(() =&gt; {</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineplus">+            if ([&quot;minimized&quot;, &quot;fullscreen&quot;, &quot;docked&quot;, &quot;normal&quot;, &quot;maximized&quot;].includes(createData.state)) {</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineplus">+              win.state = createData.state;</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineplus">+            }</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineplus">+            return win.convert({ populate: true });</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineplus">+          });</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineplus">+        },</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineplus">+</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+        update: function(windowId, updateInfo) {</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineplus">+          if (updateInfo.state !== null &amp;&amp; updateInfo.state != &quot;normal&quot;) {</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineplus">+            if (updateInfo.left !== null || updateInfo.top !== null ||</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineplus">+                updateInfo.width !== null || updateInfo.height !== null) {</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineplus">+              return Promise.reject({ message: `&quot;state&quot;: &quot;${updateInfo.state}&quot; may not be combined with &quot;left&quot;, &quot;top&quot;, &quot;width&quot;, or &quot;height&quot;` });</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineplus">+            }</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineplus">+          }</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineplus">+          let win = windowManager.get(windowId, context);</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineplus">+          if (updateInfo.focused) {</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineplus">+            Services.focus.activeWindow = win.window;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineplus">+          }</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineplus">+</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineplus">+          if (updateInfo.state !== null) {</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineplus">+            win.state = updateInfo.state;</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+          }</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineplus">+          if (updateInfo.drawAttention) {</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineplus">+            // Bug 1257497 - Firefox can't cancel attention actions.</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineplus">+            win.window.getAttention();</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineplus">+          }</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineplus">+</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineplus">+          win.updateGeometry(updateInfo);</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineplus">+</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineplus">+          if (updateInfo.titlePreface !== null) {</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineplus">+            win.setTitlePreface(updateInfo.titlePreface);</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineplus">+            win.window.gBrowser.updateTitlebar();</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineplus">+          }</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineplus">+</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineplus">+          // TODO: All the other properties, focused=false...</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineplus">+</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineplus">+          return Promise.resolve(win.convert());</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineplus">+        },</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineplus">+</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineplus">+        remove: function(windowId) {</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineplus">+          let window = windowTracker.getWindow(windowId, context);</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineplus">+          window.close();</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineplus">+</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineplus">+          return new Promise(resolve =&gt; {</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineplus">+            let listener = () =&gt; {</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineplus">+              windowTracker.removeListener(&quot;domwindowclosed&quot;, listener);</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineplus">+              resolve();</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineplus">+            };</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineplus">+            windowTracker.addListener(&quot;domwindowclosed&quot;, listener);</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineplus">+          });</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineplus">+        },</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineplus">+      },</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineplus">+    };</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineplus">+  }</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/mail/components/extensions/schemas/LICENSE</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,27 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+// Copyright (c) 2006-2008 The Chromium Authors. All rights reserved.</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+//</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+// Redistribution and use in source and binary forms, with or without</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+// modification, are permitted provided that the following conditions are</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+// met:</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+//</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+//    * Redistributions of source code must retain the above copyright</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+// notice, this list of conditions and the following disclaimer.</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+//    * Redistributions in binary form must reproduce the above</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+// copyright notice, this list of conditions and the following disclaimer</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+// in the documentation and/or other materials provided with the</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+// distribution.</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+//    * Neither the name of Google Inc. nor the names of its</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+// contributors may be used to endorse or promote products derived from</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+// this software without specific prior written permission.</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+//</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+// &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/mail/components/extensions/schemas/tabs.json</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,685 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+// Copyright (c) 2012 The Chromium Authors. All rights reserved.</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+// Use of this source code is governed by a BSD-style license that can be</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+// found in the LICENSE file.</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+[</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+  {</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+    &quot;namespace&quot;: &quot;manifest&quot;,</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+    &quot;types&quot;: [</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+      {</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+        &quot;$extend&quot;: &quot;OptionalPermission&quot;,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+        &quot;choices&quot;: [{</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+          &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+          &quot;enum&quot;: [</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+            &quot;activeTab&quot;,</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+            &quot;tabs&quot;,</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+            &quot;tabHide&quot;</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+          ]</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+        }]</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+      }</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+    ]</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+  },</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+  {</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+    &quot;namespace&quot;: &quot;tabs&quot;,</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+    &quot;description&quot;: &quot;Use the &lt;code&gt;browser.tabs&lt;/code&gt; API to interact with the browser's tab system. You can use this API to create, modify, and rearrange tabs in the browser.&quot;,</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+    &quot;types&quot;: [</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+      {</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+        &quot;id&quot;: &quot;Tab&quot;,</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+        &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+        &quot;properties&quot;: {</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+          &quot;id&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: -1, &quot;optional&quot;: true, &quot;description&quot;: &quot;The ID of the tab. Tab IDs are unique within a browser session. Under some circumstances a Tab may not be assigned an ID, for example when querying foreign tabs using the $(ref:sessions) API, in which case a session ID may be present. Tab ID can also be set to $(ref:tabs.TAB_ID_NONE) for apps and devtools windows.&quot;},</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+          &quot;index&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: -1, &quot;description&quot;: &quot;The zero-based index of the tab within its window.&quot;},</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+          &quot;windowId&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true, &quot;minimum&quot;: 0, &quot;description&quot;: &quot;The ID of the window the tab is contained within.&quot;},</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+          &quot;selected&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;description&quot;: &quot;Whether the tab is selected.&quot;, &quot;deprecated&quot;: &quot;Please use $(ref:tabs.Tab.highlighted).&quot;, &quot;unsupported&quot;: true},</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+          &quot;highlighted&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;description&quot;: &quot;Whether the tab is highlighted. Works as an alias of active&quot;},</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+          &quot;active&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;description&quot;: &quot;Whether the tab is active in its window. (Does not necessarily mean the window is focused.)&quot;},</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+          &quot;lastAccessed&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;The last time the tab was accessed as the number of milliseconds since epoch.&quot;},</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+          &quot;url&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;permissions&quot;: [&quot;tabs&quot;], &quot;description&quot;: &quot;The URL the tab is displaying. This property is only present if the extension's manifest includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;},</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+          &quot;title&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;permissions&quot;: [&quot;tabs&quot;], &quot;description&quot;: &quot;The title of the tab. This property is only present if the extension's manifest includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;},</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+          &quot;favIconUrl&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;permissions&quot;: [&quot;tabs&quot;], &quot;description&quot;: &quot;The URL of the tab's favicon. This property is only present if the extension's manifest includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission. It may also be an empty string if the tab is loading.&quot;},</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+          &quot;status&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;Either &lt;em&gt;loading&lt;/em&gt; or &lt;em&gt;complete&lt;/em&gt;.&quot;},</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+          &quot;width&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;The width of the tab in pixels.&quot;},</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+          &quot;height&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true, &quot;description&quot;: &quot;The height of the tab in pixels.&quot;}</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+        }</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+      },</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+      {</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+        &quot;id&quot;: &quot;TabStatus&quot;,</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+        &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+        &quot;enum&quot;: [&quot;loading&quot;, &quot;complete&quot;],</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+        &quot;description&quot;: &quot;Whether the tabs have completed loading.&quot;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+      },</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+      {</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+        &quot;id&quot;: &quot;WindowType&quot;,</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+        &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+        &quot;enum&quot;: [&quot;normal&quot;, &quot;popup&quot;, &quot;panel&quot;, &quot;app&quot;, &quot;devtools&quot;],</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+        &quot;description&quot;: &quot;The type of window.&quot;</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+      },</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+      {</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+        &quot;id&quot;: &quot;UpdatePropertyName&quot;,</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+        &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+        &quot;enum&quot;: [</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+          &quot;favIconUrl&quot;,</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+          &quot;status&quot;,</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+          &quot;title&quot;</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+        ],</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+        &quot;description&quot;: &quot;Event names supported in onUpdated.&quot;</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+      },</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+      {</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+        &quot;id&quot;: &quot;UpdateFilter&quot;,</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+        &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+        &quot;description&quot;: &quot;An object describing filters to apply to tabs.onUpdated events.&quot;,</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+        &quot;properties&quot;: {</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+          &quot;urls&quot;: {</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+            &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+            &quot;description&quot;: &quot;A list of URLs or URL patterns. Events that cannot match any of the URLs will be filtered out.  Filtering with urls requires the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; or  &lt;code&gt;\&quot;activeTab\&quot;&lt;/code&gt; permission.&quot;,</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+            &quot;items&quot;: { &quot;type&quot;: &quot;string&quot; },</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+            &quot;minItems&quot;: 1</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+          },</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+          &quot;properties&quot;: {</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+            &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+            &quot;description&quot;: &quot;A list of property names. Events that do not match any of the names will be filtered out.&quot;,</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+            &quot;items&quot;: { &quot;$ref&quot;: &quot;UpdatePropertyName&quot; },</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+            &quot;minItems&quot;: 1</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+          },</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+          &quot;tabId&quot;: { &quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true },</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+          &quot;windowId&quot;: { &quot;type&quot;: &quot;integer&quot;, &quot;optional&quot;: true }</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+        }</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+      }</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+    ],</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+    &quot;properties&quot;: {</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+      &quot;TAB_ID_NONE&quot;: {</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+        &quot;value&quot;: -1,</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+        &quot;description&quot;: &quot;An ID which represents the absence of a browser tab.&quot;</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+      }</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+    },</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+    &quot;functions&quot;: [</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+      {</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+        &quot;name&quot;: &quot;get&quot;,</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+        &quot;description&quot;: &quot;Retrieves details about the specified tab.&quot;,</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+          {</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+            &quot;minimum&quot;: 0</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineplus">+          },</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineplus">+          {</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+              {&quot;name&quot;: &quot;tab&quot;, &quot;$ref&quot;: &quot;Tab&quot;}</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+            ]</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+          }</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineplus">+        ]</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineplus">+      },</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineplus">+      {</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+        &quot;name&quot;: &quot;getCurrent&quot;,</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineplus">+        &quot;description&quot;: &quot;Gets the tab that this script call is being made from. May be undefined if called from a non-tab context (for example: a background page or popup view).&quot;,</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineplus">+          {</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+              {</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineplus">+                &quot;name&quot;: &quot;tab&quot;,</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+                &quot;$ref&quot;: &quot;Tab&quot;,</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineplus">+                &quot;optional&quot;: true</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineplus">+              }</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+            ]</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+          }</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineplus">+        ]</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineplus">+      },</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineplus">+      {</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+        &quot;name&quot;: &quot;create&quot;,</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+        &quot;description&quot;: &quot;Creates a new tab.&quot;,</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineplus">+          {</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineplus">+            &quot;name&quot;: &quot;createProperties&quot;,</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+              &quot;windowId&quot;: {</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineplus">+                &quot;minimum&quot;: -2,</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineplus">+                &quot;description&quot;: &quot;The window to create the new tab in. Defaults to the $(topic:current-window)[current window].&quot;</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineplus">+              },</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineplus">+              &quot;index&quot;: {</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineplus">+                &quot;description&quot;: &quot;The position the tab should take in the window. The provided value will be clamped to between zero and the number of tabs in the window.&quot;</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineplus">+              },</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineplus">+              &quot;url&quot;: {</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineplus">+                &quot;description&quot;: &quot;The URL to navigate the tab to initially. Fully-qualified URLs must include a scheme (i.e. 'http://www.google.com', not 'www.google.com'). Relative URLs will be relative to the current page within the extension. Defaults to the New Tab Page.&quot;</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+              },</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+              &quot;active&quot;: {</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tab should become the active tab in the window. Does not affect whether the window is focused (see $(ref:windows.update)). Defaults to &lt;var&gt;true&lt;/var&gt;.&quot;</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineplus">+              },</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineplus">+              &quot;selected&quot;: {</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineplus">+                &quot;deprecated&quot;: &quot;Please use &lt;em&gt;active&lt;/em&gt;.&quot;,</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineplus">+                &quot;unsupported&quot;: true,</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tab should become the selected tab in the window. Defaults to &lt;var&gt;true&lt;/var&gt;&quot;</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineplus">+              }</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineplus">+            }</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineplus">+          },</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineplus">+          {</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+              {</span>
<a href="#l16.188"></a><span id="l16.188" class="difflineplus">+                &quot;name&quot;: &quot;tab&quot;,</span>
<a href="#l16.189"></a><span id="l16.189" class="difflineplus">+                &quot;$ref&quot;: &quot;Tab&quot;,</span>
<a href="#l16.190"></a><span id="l16.190" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineplus">+                &quot;description&quot;: &quot;Details about the created tab. Will contain the ID of the new tab.&quot;</span>
<a href="#l16.192"></a><span id="l16.192" class="difflineplus">+              }</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineplus">+            ]</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineplus">+          }</span>
<a href="#l16.195"></a><span id="l16.195" class="difflineplus">+        ]</span>
<a href="#l16.196"></a><span id="l16.196" class="difflineplus">+      },</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineplus">+      {</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineplus">+        &quot;name&quot;: &quot;duplicate&quot;,</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.200"></a><span id="l16.200" class="difflineplus">+        &quot;description&quot;: &quot;Duplicates a tab.&quot;,</span>
<a href="#l16.201"></a><span id="l16.201" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.202"></a><span id="l16.202" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineplus">+          {</span>
<a href="#l16.204"></a><span id="l16.204" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l16.207"></a><span id="l16.207" class="difflineplus">+            &quot;description&quot;: &quot;The ID of the tab which is to be duplicated.&quot;</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineplus">+          },</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineplus">+          {</span>
<a href="#l16.210"></a><span id="l16.210" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.211"></a><span id="l16.211" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.213"></a><span id="l16.213" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineplus">+              {</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineplus">+                &quot;name&quot;: &quot;tab&quot;,</span>
<a href="#l16.216"></a><span id="l16.216" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineplus">+                &quot;description&quot;: &quot;Details about the duplicated tab. The $(ref:tabs.Tab) object doesn't contain &lt;code&gt;url&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;favIconUrl&lt;/code&gt; if the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission has not been requested.&quot;,</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+                &quot;$ref&quot;: &quot;Tab&quot;</span>
<a href="#l16.219"></a><span id="l16.219" class="difflineplus">+              }</span>
<a href="#l16.220"></a><span id="l16.220" class="difflineplus">+            ]</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineplus">+          }</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineplus">+        ]</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineplus">+      },</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineplus">+      {</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineplus">+        &quot;name&quot;: &quot;query&quot;,</span>
<a href="#l16.226"></a><span id="l16.226" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineplus">+        &quot;description&quot;: &quot;Gets all tabs that have the specified properties, or all tabs if no properties are specified.&quot;,</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.229"></a><span id="l16.229" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineplus">+          {</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineplus">+            &quot;name&quot;: &quot;queryInfo&quot;,</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineplus">+              &quot;active&quot;: {</span>
<a href="#l16.235"></a><span id="l16.235" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.236"></a><span id="l16.236" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.237"></a><span id="l16.237" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are active in their windows.&quot;</span>
<a href="#l16.238"></a><span id="l16.238" class="difflineplus">+              },</span>
<a href="#l16.239"></a><span id="l16.239" class="difflineplus">+              &quot;highlighted&quot;: {</span>
<a href="#l16.240"></a><span id="l16.240" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are highlighted.  Works as an alias of active.&quot;</span>
<a href="#l16.243"></a><span id="l16.243" class="difflineplus">+              },</span>
<a href="#l16.244"></a><span id="l16.244" class="difflineplus">+              &quot;currentWindow&quot;: {</span>
<a href="#l16.245"></a><span id="l16.245" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.246"></a><span id="l16.246" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.247"></a><span id="l16.247" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are in the $(topic:current-window)[current window].&quot;</span>
<a href="#l16.248"></a><span id="l16.248" class="difflineplus">+              },</span>
<a href="#l16.249"></a><span id="l16.249" class="difflineplus">+              &quot;lastFocusedWindow&quot;: {</span>
<a href="#l16.250"></a><span id="l16.250" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.252"></a><span id="l16.252" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs are in the last focused window.&quot;</span>
<a href="#l16.253"></a><span id="l16.253" class="difflineplus">+              },</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineplus">+              &quot;status&quot;: {</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineplus">+                &quot;$ref&quot;: &quot;TabStatus&quot;,</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tabs have completed loading.&quot;</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineplus">+              },</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineplus">+              &quot;title&quot;: {</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.261"></a><span id="l16.261" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.262"></a><span id="l16.262" class="difflineplus">+                &quot;description&quot;: &quot;Match page titles against a pattern.&quot;</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineplus">+              },</span>
<a href="#l16.264"></a><span id="l16.264" class="difflineplus">+              &quot;url&quot;: {</span>
<a href="#l16.265"></a><span id="l16.265" class="difflineplus">+                &quot;choices&quot;: [</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineplus">+                  {&quot;type&quot;: &quot;string&quot;},</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineplus">+                  {&quot;type&quot;: &quot;array&quot;, &quot;items&quot;: {&quot;type&quot;: &quot;string&quot;}}</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineplus">+                ],</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineplus">+                &quot;description&quot;: &quot;Match tabs against one or more $(topic:match_patterns)[URL patterns]. Note that fragment identifiers are not matched.&quot;</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineplus">+              },</span>
<a href="#l16.272"></a><span id="l16.272" class="difflineplus">+              &quot;windowId&quot;: {</span>
<a href="#l16.273"></a><span id="l16.273" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.274"></a><span id="l16.274" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.275"></a><span id="l16.275" class="difflineplus">+                &quot;minimum&quot;: -2,</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineplus">+                &quot;description&quot;: &quot;The ID of the parent window, or $(ref:windows.WINDOW_ID_CURRENT) for the $(topic:current-window)[current window].&quot;</span>
<a href="#l16.277"></a><span id="l16.277" class="difflineplus">+              },</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineplus">+              &quot;windowType&quot;: {</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineplus">+                &quot;$ref&quot;: &quot;WindowType&quot;,</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.281"></a><span id="l16.281" class="difflineplus">+                &quot;description&quot;: &quot;The type of window the tabs are in.&quot;</span>
<a href="#l16.282"></a><span id="l16.282" class="difflineplus">+              },</span>
<a href="#l16.283"></a><span id="l16.283" class="difflineplus">+              &quot;index&quot;: {</span>
<a href="#l16.284"></a><span id="l16.284" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.285"></a><span id="l16.285" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.286"></a><span id="l16.286" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l16.287"></a><span id="l16.287" class="difflineplus">+                &quot;description&quot;: &quot;The position of the tabs within their windows.&quot;</span>
<a href="#l16.288"></a><span id="l16.288" class="difflineplus">+              }</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineplus">+            }</span>
<a href="#l16.290"></a><span id="l16.290" class="difflineplus">+          },</span>
<a href="#l16.291"></a><span id="l16.291" class="difflineplus">+          {</span>
<a href="#l16.292"></a><span id="l16.292" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.293"></a><span id="l16.293" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.294"></a><span id="l16.294" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.295"></a><span id="l16.295" class="difflineplus">+              {</span>
<a href="#l16.296"></a><span id="l16.296" class="difflineplus">+                &quot;name&quot;: &quot;result&quot;,</span>
<a href="#l16.297"></a><span id="l16.297" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l16.298"></a><span id="l16.298" class="difflineplus">+                &quot;items&quot;: {</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineplus">+                  &quot;$ref&quot;: &quot;Tab&quot;</span>
<a href="#l16.300"></a><span id="l16.300" class="difflineplus">+                }</span>
<a href="#l16.301"></a><span id="l16.301" class="difflineplus">+              }</span>
<a href="#l16.302"></a><span id="l16.302" class="difflineplus">+            ]</span>
<a href="#l16.303"></a><span id="l16.303" class="difflineplus">+          }</span>
<a href="#l16.304"></a><span id="l16.304" class="difflineplus">+        ]</span>
<a href="#l16.305"></a><span id="l16.305" class="difflineplus">+      },</span>
<a href="#l16.306"></a><span id="l16.306" class="difflineplus">+      {</span>
<a href="#l16.307"></a><span id="l16.307" class="difflineplus">+        &quot;name&quot;: &quot;update&quot;,</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.309"></a><span id="l16.309" class="difflineplus">+        &quot;description&quot;: &quot;Modifies the properties of a tab. Properties that are not specified in &lt;var&gt;updateProperties&lt;/var&gt; are not modified.&quot;,</span>
<a href="#l16.310"></a><span id="l16.310" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.311"></a><span id="l16.311" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.312"></a><span id="l16.312" class="difflineplus">+          {</span>
<a href="#l16.313"></a><span id="l16.313" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.314"></a><span id="l16.314" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.315"></a><span id="l16.315" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l16.316"></a><span id="l16.316" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.317"></a><span id="l16.317" class="difflineplus">+            &quot;description&quot;: &quot;Defaults to the selected tab of the $(topic:current-window)[current window].&quot;</span>
<a href="#l16.318"></a><span id="l16.318" class="difflineplus">+          },</span>
<a href="#l16.319"></a><span id="l16.319" class="difflineplus">+          {</span>
<a href="#l16.320"></a><span id="l16.320" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.321"></a><span id="l16.321" class="difflineplus">+            &quot;name&quot;: &quot;updateProperties&quot;,</span>
<a href="#l16.322"></a><span id="l16.322" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.323"></a><span id="l16.323" class="difflineplus">+              &quot;url&quot;: {</span>
<a href="#l16.324"></a><span id="l16.324" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.325"></a><span id="l16.325" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.326"></a><span id="l16.326" class="difflineplus">+                &quot;description&quot;: &quot;A URL to navigate the tab to.&quot;</span>
<a href="#l16.327"></a><span id="l16.327" class="difflineplus">+              },</span>
<a href="#l16.328"></a><span id="l16.328" class="difflineplus">+              &quot;active&quot;: {</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.330"></a><span id="l16.330" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.331"></a><span id="l16.331" class="difflineplus">+                &quot;description&quot;: &quot;Whether the tab should be active. Does not affect whether the window is focused (see $(ref:windows.update)).&quot;</span>
<a href="#l16.332"></a><span id="l16.332" class="difflineplus">+              }</span>
<a href="#l16.333"></a><span id="l16.333" class="difflineplus">+            }</span>
<a href="#l16.334"></a><span id="l16.334" class="difflineplus">+          },</span>
<a href="#l16.335"></a><span id="l16.335" class="difflineplus">+          {</span>
<a href="#l16.336"></a><span id="l16.336" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.337"></a><span id="l16.337" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.338"></a><span id="l16.338" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.340"></a><span id="l16.340" class="difflineplus">+              {</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineplus">+                &quot;name&quot;: &quot;tab&quot;,</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineplus">+                &quot;$ref&quot;: &quot;Tab&quot;,</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineplus">+                &quot;description&quot;: &quot;Details about the updated tab. The $(ref:tabs.Tab) object doesn't contain &lt;code&gt;url&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;favIconUrl&lt;/code&gt; if the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission has not been requested.&quot;</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineplus">+              }</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineplus">+            ]</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineplus">+          }</span>
<a href="#l16.348"></a><span id="l16.348" class="difflineplus">+        ]</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineplus">+      },</span>
<a href="#l16.350"></a><span id="l16.350" class="difflineplus">+      {</span>
<a href="#l16.351"></a><span id="l16.351" class="difflineplus">+        &quot;name&quot;: &quot;move&quot;,</span>
<a href="#l16.352"></a><span id="l16.352" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.353"></a><span id="l16.353" class="difflineplus">+        &quot;description&quot;: &quot;Moves one or more tabs to a new position within its window, or to a new window. Note that tabs can only be moved to and from normal (window.type === \&quot;normal\&quot;) windows.&quot;,</span>
<a href="#l16.354"></a><span id="l16.354" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.355"></a><span id="l16.355" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.356"></a><span id="l16.356" class="difflineplus">+          {</span>
<a href="#l16.357"></a><span id="l16.357" class="difflineplus">+            &quot;name&quot;: &quot;tabIds&quot;,</span>
<a href="#l16.358"></a><span id="l16.358" class="difflineplus">+            &quot;description&quot;: &quot;The tab or list of tabs to move.&quot;,</span>
<a href="#l16.359"></a><span id="l16.359" class="difflineplus">+            &quot;choices&quot;: [</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineplus">+              {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineplus">+              {&quot;type&quot;: &quot;array&quot;, &quot;items&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0}}</span>
<a href="#l16.362"></a><span id="l16.362" class="difflineplus">+            ]</span>
<a href="#l16.363"></a><span id="l16.363" class="difflineplus">+          },</span>
<a href="#l16.364"></a><span id="l16.364" class="difflineplus">+          {</span>
<a href="#l16.365"></a><span id="l16.365" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.366"></a><span id="l16.366" class="difflineplus">+            &quot;name&quot;: &quot;moveProperties&quot;,</span>
<a href="#l16.367"></a><span id="l16.367" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.368"></a><span id="l16.368" class="difflineplus">+              &quot;windowId&quot;: {</span>
<a href="#l16.369"></a><span id="l16.369" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.370"></a><span id="l16.370" class="difflineplus">+                &quot;minimum&quot;: -2,</span>
<a href="#l16.371"></a><span id="l16.371" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.372"></a><span id="l16.372" class="difflineplus">+                &quot;description&quot;: &quot;Defaults to the window the tab is currently in.&quot;</span>
<a href="#l16.373"></a><span id="l16.373" class="difflineplus">+              },</span>
<a href="#l16.374"></a><span id="l16.374" class="difflineplus">+              &quot;index&quot;: {</span>
<a href="#l16.375"></a><span id="l16.375" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.376"></a><span id="l16.376" class="difflineplus">+                &quot;minimum&quot;: -1,</span>
<a href="#l16.377"></a><span id="l16.377" class="difflineplus">+                &quot;description&quot;: &quot;The position to move the window to. -1 will place the tab at the end of the window.&quot;</span>
<a href="#l16.378"></a><span id="l16.378" class="difflineplus">+              }</span>
<a href="#l16.379"></a><span id="l16.379" class="difflineplus">+            }</span>
<a href="#l16.380"></a><span id="l16.380" class="difflineplus">+          },</span>
<a href="#l16.381"></a><span id="l16.381" class="difflineplus">+          {</span>
<a href="#l16.382"></a><span id="l16.382" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.383"></a><span id="l16.383" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.384"></a><span id="l16.384" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.385"></a><span id="l16.385" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.386"></a><span id="l16.386" class="difflineplus">+              {</span>
<a href="#l16.387"></a><span id="l16.387" class="difflineplus">+                &quot;name&quot;: &quot;tabs&quot;,</span>
<a href="#l16.388"></a><span id="l16.388" class="difflineplus">+                &quot;description&quot;: &quot;Details about the moved tabs.&quot;,</span>
<a href="#l16.389"></a><span id="l16.389" class="difflineplus">+                &quot;choices&quot;: [</span>
<a href="#l16.390"></a><span id="l16.390" class="difflineplus">+                  {&quot;$ref&quot;: &quot;Tab&quot;},</span>
<a href="#l16.391"></a><span id="l16.391" class="difflineplus">+                  {&quot;type&quot;: &quot;array&quot;, &quot;items&quot;: {&quot;$ref&quot;: &quot;Tab&quot;}}</span>
<a href="#l16.392"></a><span id="l16.392" class="difflineplus">+                ]</span>
<a href="#l16.393"></a><span id="l16.393" class="difflineplus">+              }</span>
<a href="#l16.394"></a><span id="l16.394" class="difflineplus">+            ]</span>
<a href="#l16.395"></a><span id="l16.395" class="difflineplus">+          }</span>
<a href="#l16.396"></a><span id="l16.396" class="difflineplus">+        ]</span>
<a href="#l16.397"></a><span id="l16.397" class="difflineplus">+      },</span>
<a href="#l16.398"></a><span id="l16.398" class="difflineplus">+      {</span>
<a href="#l16.399"></a><span id="l16.399" class="difflineplus">+        &quot;name&quot;: &quot;reload&quot;,</span>
<a href="#l16.400"></a><span id="l16.400" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.401"></a><span id="l16.401" class="difflineplus">+        &quot;description&quot;: &quot;Reload a tab.&quot;,</span>
<a href="#l16.402"></a><span id="l16.402" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.403"></a><span id="l16.403" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.404"></a><span id="l16.404" class="difflineplus">+          {</span>
<a href="#l16.405"></a><span id="l16.405" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.406"></a><span id="l16.406" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.407"></a><span id="l16.407" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l16.408"></a><span id="l16.408" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.409"></a><span id="l16.409" class="difflineplus">+            &quot;description&quot;: &quot;The ID of the tab to reload; defaults to the selected tab of the current window.&quot;</span>
<a href="#l16.410"></a><span id="l16.410" class="difflineplus">+          },</span>
<a href="#l16.411"></a><span id="l16.411" class="difflineplus">+          {</span>
<a href="#l16.412"></a><span id="l16.412" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.413"></a><span id="l16.413" class="difflineplus">+            &quot;name&quot;: &quot;reloadProperties&quot;,</span>
<a href="#l16.414"></a><span id="l16.414" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.415"></a><span id="l16.415" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.416"></a><span id="l16.416" class="difflineplus">+              &quot;bypassCache&quot;: {</span>
<a href="#l16.417"></a><span id="l16.417" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l16.418"></a><span id="l16.418" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.419"></a><span id="l16.419" class="difflineplus">+                &quot;description&quot;: &quot;Whether using any local cache. Default is false.&quot;</span>
<a href="#l16.420"></a><span id="l16.420" class="difflineplus">+              }</span>
<a href="#l16.421"></a><span id="l16.421" class="difflineplus">+            }</span>
<a href="#l16.422"></a><span id="l16.422" class="difflineplus">+          },</span>
<a href="#l16.423"></a><span id="l16.423" class="difflineplus">+          {</span>
<a href="#l16.424"></a><span id="l16.424" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.425"></a><span id="l16.425" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.426"></a><span id="l16.426" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.427"></a><span id="l16.427" class="difflineplus">+            &quot;parameters&quot;: []</span>
<a href="#l16.428"></a><span id="l16.428" class="difflineplus">+          }</span>
<a href="#l16.429"></a><span id="l16.429" class="difflineplus">+        ]</span>
<a href="#l16.430"></a><span id="l16.430" class="difflineplus">+      },</span>
<a href="#l16.431"></a><span id="l16.431" class="difflineplus">+      {</span>
<a href="#l16.432"></a><span id="l16.432" class="difflineplus">+        &quot;name&quot;: &quot;remove&quot;,</span>
<a href="#l16.433"></a><span id="l16.433" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.434"></a><span id="l16.434" class="difflineplus">+        &quot;description&quot;: &quot;Closes one or more tabs.&quot;,</span>
<a href="#l16.435"></a><span id="l16.435" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.436"></a><span id="l16.436" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.437"></a><span id="l16.437" class="difflineplus">+          {</span>
<a href="#l16.438"></a><span id="l16.438" class="difflineplus">+            &quot;name&quot;: &quot;tabIds&quot;,</span>
<a href="#l16.439"></a><span id="l16.439" class="difflineplus">+            &quot;description&quot;: &quot;The tab or list of tabs to close.&quot;,</span>
<a href="#l16.440"></a><span id="l16.440" class="difflineplus">+            &quot;choices&quot;: [</span>
<a href="#l16.441"></a><span id="l16.441" class="difflineplus">+              {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.442"></a><span id="l16.442" class="difflineplus">+              {&quot;type&quot;: &quot;array&quot;, &quot;items&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0}}</span>
<a href="#l16.443"></a><span id="l16.443" class="difflineplus">+            ]</span>
<a href="#l16.444"></a><span id="l16.444" class="difflineplus">+          },</span>
<a href="#l16.445"></a><span id="l16.445" class="difflineplus">+          {</span>
<a href="#l16.446"></a><span id="l16.446" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.447"></a><span id="l16.447" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.448"></a><span id="l16.448" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.449"></a><span id="l16.449" class="difflineplus">+            &quot;parameters&quot;: []</span>
<a href="#l16.450"></a><span id="l16.450" class="difflineplus">+          }</span>
<a href="#l16.451"></a><span id="l16.451" class="difflineplus">+        ]</span>
<a href="#l16.452"></a><span id="l16.452" class="difflineplus">+      },</span>
<a href="#l16.453"></a><span id="l16.453" class="difflineplus">+      {</span>
<a href="#l16.454"></a><span id="l16.454" class="difflineplus">+        &quot;name&quot;: &quot;executeScript&quot;,</span>
<a href="#l16.455"></a><span id="l16.455" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.456"></a><span id="l16.456" class="difflineplus">+        &quot;description&quot;: &quot;Injects JavaScript code into a page. For details, see the $(topic:content_scripts)[programmatic injection] section of the content scripts doc.&quot;,</span>
<a href="#l16.457"></a><span id="l16.457" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.458"></a><span id="l16.458" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.459"></a><span id="l16.459" class="difflineplus">+          {</span>
<a href="#l16.460"></a><span id="l16.460" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.461"></a><span id="l16.461" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.462"></a><span id="l16.462" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l16.463"></a><span id="l16.463" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.464"></a><span id="l16.464" class="difflineplus">+            &quot;description&quot;: &quot;The ID of the tab in which to run the script; defaults to the active tab of the current window.&quot;</span>
<a href="#l16.465"></a><span id="l16.465" class="difflineplus">+          },</span>
<a href="#l16.466"></a><span id="l16.466" class="difflineplus">+          {</span>
<a href="#l16.467"></a><span id="l16.467" class="difflineplus">+            &quot;$ref&quot;: &quot;extensionTypes.InjectDetails&quot;,</span>
<a href="#l16.468"></a><span id="l16.468" class="difflineplus">+            &quot;name&quot;: &quot;details&quot;,</span>
<a href="#l16.469"></a><span id="l16.469" class="difflineplus">+            &quot;description&quot;: &quot;Details of the script to run.&quot;</span>
<a href="#l16.470"></a><span id="l16.470" class="difflineplus">+          },</span>
<a href="#l16.471"></a><span id="l16.471" class="difflineplus">+          {</span>
<a href="#l16.472"></a><span id="l16.472" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.473"></a><span id="l16.473" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.474"></a><span id="l16.474" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.475"></a><span id="l16.475" class="difflineplus">+            &quot;description&quot;: &quot;Called after all the JavaScript has been executed.&quot;,</span>
<a href="#l16.476"></a><span id="l16.476" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l16.477"></a><span id="l16.477" class="difflineplus">+              {</span>
<a href="#l16.478"></a><span id="l16.478" class="difflineplus">+                &quot;name&quot;: &quot;result&quot;,</span>
<a href="#l16.479"></a><span id="l16.479" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.480"></a><span id="l16.480" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l16.481"></a><span id="l16.481" class="difflineplus">+                &quot;items&quot;: {&quot;type&quot;: &quot;any&quot;},</span>
<a href="#l16.482"></a><span id="l16.482" class="difflineplus">+                &quot;description&quot;: &quot;The result of the script in every injected frame.&quot;</span>
<a href="#l16.483"></a><span id="l16.483" class="difflineplus">+              }</span>
<a href="#l16.484"></a><span id="l16.484" class="difflineplus">+            ]</span>
<a href="#l16.485"></a><span id="l16.485" class="difflineplus">+          }</span>
<a href="#l16.486"></a><span id="l16.486" class="difflineplus">+        ]</span>
<a href="#l16.487"></a><span id="l16.487" class="difflineplus">+      },</span>
<a href="#l16.488"></a><span id="l16.488" class="difflineplus">+      {</span>
<a href="#l16.489"></a><span id="l16.489" class="difflineplus">+        &quot;name&quot;: &quot;insertCSS&quot;,</span>
<a href="#l16.490"></a><span id="l16.490" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.491"></a><span id="l16.491" class="difflineplus">+        &quot;description&quot;: &quot;Injects CSS into a page. For details, see the $(topic:content_scripts)[programmatic injection] section of the content scripts doc.&quot;,</span>
<a href="#l16.492"></a><span id="l16.492" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.493"></a><span id="l16.493" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.494"></a><span id="l16.494" class="difflineplus">+          {</span>
<a href="#l16.495"></a><span id="l16.495" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.496"></a><span id="l16.496" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.497"></a><span id="l16.497" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l16.498"></a><span id="l16.498" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.499"></a><span id="l16.499" class="difflineplus">+            &quot;description&quot;: &quot;The ID of the tab in which to insert the CSS; defaults to the active tab of the current window.&quot;</span>
<a href="#l16.500"></a><span id="l16.500" class="difflineplus">+          },</span>
<a href="#l16.501"></a><span id="l16.501" class="difflineplus">+          {</span>
<a href="#l16.502"></a><span id="l16.502" class="difflineplus">+            &quot;$ref&quot;: &quot;extensionTypes.InjectDetails&quot;,</span>
<a href="#l16.503"></a><span id="l16.503" class="difflineplus">+            &quot;name&quot;: &quot;details&quot;,</span>
<a href="#l16.504"></a><span id="l16.504" class="difflineplus">+            &quot;description&quot;: &quot;Details of the CSS text to insert.&quot;</span>
<a href="#l16.505"></a><span id="l16.505" class="difflineplus">+          },</span>
<a href="#l16.506"></a><span id="l16.506" class="difflineplus">+          {</span>
<a href="#l16.507"></a><span id="l16.507" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.508"></a><span id="l16.508" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.509"></a><span id="l16.509" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.510"></a><span id="l16.510" class="difflineplus">+            &quot;description&quot;: &quot;Called when all the CSS has been inserted.&quot;,</span>
<a href="#l16.511"></a><span id="l16.511" class="difflineplus">+            &quot;parameters&quot;: []</span>
<a href="#l16.512"></a><span id="l16.512" class="difflineplus">+          }</span>
<a href="#l16.513"></a><span id="l16.513" class="difflineplus">+        ]</span>
<a href="#l16.514"></a><span id="l16.514" class="difflineplus">+      },</span>
<a href="#l16.515"></a><span id="l16.515" class="difflineplus">+      {</span>
<a href="#l16.516"></a><span id="l16.516" class="difflineplus">+        &quot;name&quot;: &quot;removeCSS&quot;,</span>
<a href="#l16.517"></a><span id="l16.517" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.518"></a><span id="l16.518" class="difflineplus">+        &quot;description&quot;: &quot;Removes injected CSS from a page. For details, see the $(topic:content_scripts)[programmatic injection] section of the content scripts doc.&quot;,</span>
<a href="#l16.519"></a><span id="l16.519" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l16.520"></a><span id="l16.520" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.521"></a><span id="l16.521" class="difflineplus">+          {</span>
<a href="#l16.522"></a><span id="l16.522" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.523"></a><span id="l16.523" class="difflineplus">+            &quot;name&quot;: &quot;tabId&quot;,</span>
<a href="#l16.524"></a><span id="l16.524" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l16.525"></a><span id="l16.525" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.526"></a><span id="l16.526" class="difflineplus">+            &quot;description&quot;: &quot;The ID of the tab from which to remove the injected CSS; defaults to the active tab of the current window.&quot;</span>
<a href="#l16.527"></a><span id="l16.527" class="difflineplus">+          },</span>
<a href="#l16.528"></a><span id="l16.528" class="difflineplus">+          {</span>
<a href="#l16.529"></a><span id="l16.529" class="difflineplus">+            &quot;$ref&quot;: &quot;extensionTypes.InjectDetails&quot;,</span>
<a href="#l16.530"></a><span id="l16.530" class="difflineplus">+            &quot;name&quot;: &quot;details&quot;,</span>
<a href="#l16.531"></a><span id="l16.531" class="difflineplus">+            &quot;description&quot;: &quot;Details of the CSS text to remove.&quot;</span>
<a href="#l16.532"></a><span id="l16.532" class="difflineplus">+          },</span>
<a href="#l16.533"></a><span id="l16.533" class="difflineplus">+          {</span>
<a href="#l16.534"></a><span id="l16.534" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.535"></a><span id="l16.535" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l16.536"></a><span id="l16.536" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.537"></a><span id="l16.537" class="difflineplus">+            &quot;description&quot;: &quot;Called when all the CSS has been removed.&quot;,</span>
<a href="#l16.538"></a><span id="l16.538" class="difflineplus">+            &quot;parameters&quot;: []</span>
<a href="#l16.539"></a><span id="l16.539" class="difflineplus">+          }</span>
<a href="#l16.540"></a><span id="l16.540" class="difflineplus">+        ]</span>
<a href="#l16.541"></a><span id="l16.541" class="difflineplus">+      }</span>
<a href="#l16.542"></a><span id="l16.542" class="difflineplus">+    ],</span>
<a href="#l16.543"></a><span id="l16.543" class="difflineplus">+    &quot;events&quot;: [</span>
<a href="#l16.544"></a><span id="l16.544" class="difflineplus">+      {</span>
<a href="#l16.545"></a><span id="l16.545" class="difflineplus">+        &quot;name&quot;: &quot;onCreated&quot;,</span>
<a href="#l16.546"></a><span id="l16.546" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.547"></a><span id="l16.547" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a tab is created. Note that the tab's URL may not be set at the time this event fired, but you can listen to onUpdated events to be notified when a URL is set.&quot;,</span>
<a href="#l16.548"></a><span id="l16.548" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.549"></a><span id="l16.549" class="difflineplus">+          {</span>
<a href="#l16.550"></a><span id="l16.550" class="difflineplus">+            &quot;$ref&quot;: &quot;Tab&quot;,</span>
<a href="#l16.551"></a><span id="l16.551" class="difflineplus">+            &quot;name&quot;: &quot;tab&quot;,</span>
<a href="#l16.552"></a><span id="l16.552" class="difflineplus">+            &quot;description&quot;: &quot;Details of the tab that was created.&quot;</span>
<a href="#l16.553"></a><span id="l16.553" class="difflineplus">+          }</span>
<a href="#l16.554"></a><span id="l16.554" class="difflineplus">+        ]</span>
<a href="#l16.555"></a><span id="l16.555" class="difflineplus">+      },</span>
<a href="#l16.556"></a><span id="l16.556" class="difflineplus">+      {</span>
<a href="#l16.557"></a><span id="l16.557" class="difflineplus">+        &quot;name&quot;: &quot;onUpdated&quot;,</span>
<a href="#l16.558"></a><span id="l16.558" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.559"></a><span id="l16.559" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a tab is updated.&quot;,</span>
<a href="#l16.560"></a><span id="l16.560" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.561"></a><span id="l16.561" class="difflineplus">+          {&quot;type&quot;: &quot;integer&quot;, &quot;name&quot;: &quot;tabId&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.562"></a><span id="l16.562" class="difflineplus">+          {</span>
<a href="#l16.563"></a><span id="l16.563" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.564"></a><span id="l16.564" class="difflineplus">+            &quot;name&quot;: &quot;changeInfo&quot;,</span>
<a href="#l16.565"></a><span id="l16.565" class="difflineplus">+            &quot;description&quot;: &quot;Lists the changes to the state of the tab that was updated.&quot;,</span>
<a href="#l16.566"></a><span id="l16.566" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.567"></a><span id="l16.567" class="difflineplus">+              &quot;status&quot;: {</span>
<a href="#l16.568"></a><span id="l16.568" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.569"></a><span id="l16.569" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.570"></a><span id="l16.570" class="difflineplus">+                &quot;description&quot;: &quot;The status of the tab. Can be either &lt;em&gt;loading&lt;/em&gt; or &lt;em&gt;complete&lt;/em&gt;.&quot;</span>
<a href="#l16.571"></a><span id="l16.571" class="difflineplus">+              },</span>
<a href="#l16.572"></a><span id="l16.572" class="difflineplus">+              &quot;url&quot;: {</span>
<a href="#l16.573"></a><span id="l16.573" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.574"></a><span id="l16.574" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.575"></a><span id="l16.575" class="difflineplus">+                &quot;description&quot;: &quot;The tab's URL if it has changed.&quot;</span>
<a href="#l16.576"></a><span id="l16.576" class="difflineplus">+              },</span>
<a href="#l16.577"></a><span id="l16.577" class="difflineplus">+              &quot;favIconUrl&quot;: {</span>
<a href="#l16.578"></a><span id="l16.578" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l16.579"></a><span id="l16.579" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l16.580"></a><span id="l16.580" class="difflineplus">+                &quot;description&quot;: &quot;The tab's new favicon URL.&quot;</span>
<a href="#l16.581"></a><span id="l16.581" class="difflineplus">+              }</span>
<a href="#l16.582"></a><span id="l16.582" class="difflineplus">+            }</span>
<a href="#l16.583"></a><span id="l16.583" class="difflineplus">+          },</span>
<a href="#l16.584"></a><span id="l16.584" class="difflineplus">+          {</span>
<a href="#l16.585"></a><span id="l16.585" class="difflineplus">+            &quot;$ref&quot;: &quot;Tab&quot;,</span>
<a href="#l16.586"></a><span id="l16.586" class="difflineplus">+            &quot;name&quot;: &quot;tab&quot;,</span>
<a href="#l16.587"></a><span id="l16.587" class="difflineplus">+            &quot;description&quot;: &quot;Gives the state of the tab that was updated.&quot;</span>
<a href="#l16.588"></a><span id="l16.588" class="difflineplus">+          }</span>
<a href="#l16.589"></a><span id="l16.589" class="difflineplus">+        ],</span>
<a href="#l16.590"></a><span id="l16.590" class="difflineplus">+        &quot;extraParameters&quot;: [</span>
<a href="#l16.591"></a><span id="l16.591" class="difflineplus">+          {</span>
<a href="#l16.592"></a><span id="l16.592" class="difflineplus">+            &quot;$ref&quot;: &quot;UpdateFilter&quot;,</span>
<a href="#l16.593"></a><span id="l16.593" class="difflineplus">+            &quot;name&quot;: &quot;filter&quot;,</span>
<a href="#l16.594"></a><span id="l16.594" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l16.595"></a><span id="l16.595" class="difflineplus">+            &quot;description&quot;: &quot;A set of filters that restricts the events that will be sent to this listener.&quot;</span>
<a href="#l16.596"></a><span id="l16.596" class="difflineplus">+          }</span>
<a href="#l16.597"></a><span id="l16.597" class="difflineplus">+        ]</span>
<a href="#l16.598"></a><span id="l16.598" class="difflineplus">+      },</span>
<a href="#l16.599"></a><span id="l16.599" class="difflineplus">+      {</span>
<a href="#l16.600"></a><span id="l16.600" class="difflineplus">+        &quot;name&quot;: &quot;onMoved&quot;,</span>
<a href="#l16.601"></a><span id="l16.601" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.602"></a><span id="l16.602" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a tab is moved within a window. Only one move event is fired, representing the tab the user directly moved. Move events are not fired for the other tabs that must move in response. This event is not fired when a tab is moved between windows. For that, see $(ref:tabs.onDetached).&quot;,</span>
<a href="#l16.603"></a><span id="l16.603" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.604"></a><span id="l16.604" class="difflineplus">+          {&quot;type&quot;: &quot;integer&quot;, &quot;name&quot;: &quot;tabId&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.605"></a><span id="l16.605" class="difflineplus">+          {</span>
<a href="#l16.606"></a><span id="l16.606" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.607"></a><span id="l16.607" class="difflineplus">+            &quot;name&quot;: &quot;moveInfo&quot;,</span>
<a href="#l16.608"></a><span id="l16.608" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.609"></a><span id="l16.609" class="difflineplus">+              &quot;windowId&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.610"></a><span id="l16.610" class="difflineplus">+              &quot;fromIndex&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.611"></a><span id="l16.611" class="difflineplus">+              &quot;toIndex&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0}</span>
<a href="#l16.612"></a><span id="l16.612" class="difflineplus">+            }</span>
<a href="#l16.613"></a><span id="l16.613" class="difflineplus">+          }</span>
<a href="#l16.614"></a><span id="l16.614" class="difflineplus">+        ]</span>
<a href="#l16.615"></a><span id="l16.615" class="difflineplus">+      },</span>
<a href="#l16.616"></a><span id="l16.616" class="difflineplus">+      {</span>
<a href="#l16.617"></a><span id="l16.617" class="difflineplus">+        &quot;name&quot;: &quot;onActivated&quot;,</span>
<a href="#l16.618"></a><span id="l16.618" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.619"></a><span id="l16.619" class="difflineplus">+        &quot;description&quot;: &quot;Fires when the active tab in a window changes. Note that the tab's URL may not be set at the time this event fired, but you can listen to onUpdated events to be notified when a URL is set.&quot;,</span>
<a href="#l16.620"></a><span id="l16.620" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.621"></a><span id="l16.621" class="difflineplus">+          {</span>
<a href="#l16.622"></a><span id="l16.622" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.623"></a><span id="l16.623" class="difflineplus">+            &quot;name&quot;: &quot;activeInfo&quot;,</span>
<a href="#l16.624"></a><span id="l16.624" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.625"></a><span id="l16.625" class="difflineplus">+              &quot;tabId&quot;: {</span>
<a href="#l16.626"></a><span id="l16.626" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.627"></a><span id="l16.627" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l16.628"></a><span id="l16.628" class="difflineplus">+                &quot;description&quot;: &quot;The ID of the tab that has become active.&quot;</span>
<a href="#l16.629"></a><span id="l16.629" class="difflineplus">+              },</span>
<a href="#l16.630"></a><span id="l16.630" class="difflineplus">+              &quot;windowId&quot;: {</span>
<a href="#l16.631"></a><span id="l16.631" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l16.632"></a><span id="l16.632" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l16.633"></a><span id="l16.633" class="difflineplus">+                &quot;description&quot;: &quot;The ID of the window the active tab changed inside of.&quot;</span>
<a href="#l16.634"></a><span id="l16.634" class="difflineplus">+              }</span>
<a href="#l16.635"></a><span id="l16.635" class="difflineplus">+            }</span>
<a href="#l16.636"></a><span id="l16.636" class="difflineplus">+          }</span>
<a href="#l16.637"></a><span id="l16.637" class="difflineplus">+        ]</span>
<a href="#l16.638"></a><span id="l16.638" class="difflineplus">+      },</span>
<a href="#l16.639"></a><span id="l16.639" class="difflineplus">+      {</span>
<a href="#l16.640"></a><span id="l16.640" class="difflineplus">+        &quot;name&quot;: &quot;onDetached&quot;,</span>
<a href="#l16.641"></a><span id="l16.641" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.642"></a><span id="l16.642" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a tab is detached from a window, for example because it is being moved between windows.&quot;,</span>
<a href="#l16.643"></a><span id="l16.643" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.644"></a><span id="l16.644" class="difflineplus">+          {&quot;type&quot;: &quot;integer&quot;, &quot;name&quot;: &quot;tabId&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.645"></a><span id="l16.645" class="difflineplus">+          {</span>
<a href="#l16.646"></a><span id="l16.646" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.647"></a><span id="l16.647" class="difflineplus">+            &quot;name&quot;: &quot;detachInfo&quot;,</span>
<a href="#l16.648"></a><span id="l16.648" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.649"></a><span id="l16.649" class="difflineplus">+              &quot;oldWindowId&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.650"></a><span id="l16.650" class="difflineplus">+              &quot;oldPosition&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0}</span>
<a href="#l16.651"></a><span id="l16.651" class="difflineplus">+            }</span>
<a href="#l16.652"></a><span id="l16.652" class="difflineplus">+          }</span>
<a href="#l16.653"></a><span id="l16.653" class="difflineplus">+        ]</span>
<a href="#l16.654"></a><span id="l16.654" class="difflineplus">+      },</span>
<a href="#l16.655"></a><span id="l16.655" class="difflineplus">+      {</span>
<a href="#l16.656"></a><span id="l16.656" class="difflineplus">+        &quot;name&quot;: &quot;onAttached&quot;,</span>
<a href="#l16.657"></a><span id="l16.657" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.658"></a><span id="l16.658" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a tab is attached to a window, for example because it was moved between windows.&quot;,</span>
<a href="#l16.659"></a><span id="l16.659" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.660"></a><span id="l16.660" class="difflineplus">+          {&quot;type&quot;: &quot;integer&quot;, &quot;name&quot;: &quot;tabId&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.661"></a><span id="l16.661" class="difflineplus">+          {</span>
<a href="#l16.662"></a><span id="l16.662" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.663"></a><span id="l16.663" class="difflineplus">+            &quot;name&quot;: &quot;attachInfo&quot;,</span>
<a href="#l16.664"></a><span id="l16.664" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.665"></a><span id="l16.665" class="difflineplus">+              &quot;newWindowId&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.666"></a><span id="l16.666" class="difflineplus">+              &quot;newPosition&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0}</span>
<a href="#l16.667"></a><span id="l16.667" class="difflineplus">+            }</span>
<a href="#l16.668"></a><span id="l16.668" class="difflineplus">+          }</span>
<a href="#l16.669"></a><span id="l16.669" class="difflineplus">+        ]</span>
<a href="#l16.670"></a><span id="l16.670" class="difflineplus">+      },</span>
<a href="#l16.671"></a><span id="l16.671" class="difflineplus">+      {</span>
<a href="#l16.672"></a><span id="l16.672" class="difflineplus">+        &quot;name&quot;: &quot;onRemoved&quot;,</span>
<a href="#l16.673"></a><span id="l16.673" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l16.674"></a><span id="l16.674" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a tab is closed.&quot;,</span>
<a href="#l16.675"></a><span id="l16.675" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l16.676"></a><span id="l16.676" class="difflineplus">+          {&quot;type&quot;: &quot;integer&quot;, &quot;name&quot;: &quot;tabId&quot;, &quot;minimum&quot;: 0},</span>
<a href="#l16.677"></a><span id="l16.677" class="difflineplus">+          {</span>
<a href="#l16.678"></a><span id="l16.678" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l16.679"></a><span id="l16.679" class="difflineplus">+            &quot;name&quot;: &quot;removeInfo&quot;,</span>
<a href="#l16.680"></a><span id="l16.680" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l16.681"></a><span id="l16.681" class="difflineplus">+              &quot;windowId&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;minimum&quot;: 0, &quot;description&quot;: &quot;The window whose tab is closed.&quot; },</span>
<a href="#l16.682"></a><span id="l16.682" class="difflineplus">+              &quot;isWindowClosing&quot;: {&quot;type&quot;: &quot;boolean&quot;, &quot;description&quot;: &quot;True when the tab is being closed because its window is being closed.&quot; }</span>
<a href="#l16.683"></a><span id="l16.683" class="difflineplus">+            }</span>
<a href="#l16.684"></a><span id="l16.684" class="difflineplus">+          }</span>
<a href="#l16.685"></a><span id="l16.685" class="difflineplus">+        ]</span>
<a href="#l16.686"></a><span id="l16.686" class="difflineplus">+      }</span>
<a href="#l16.687"></a><span id="l16.687" class="difflineplus">+    ]</span>
<a href="#l16.688"></a><span id="l16.688" class="difflineplus">+  }</span>
<a href="#l16.689"></a><span id="l16.689" class="difflineplus">+]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mail/components/extensions/schemas/windows.json</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,523 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+// Copyright (c) 2012 The Chromium Authors. All rights reserved.</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+// Use of this source code is governed by a BSD-style license that can be</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+// found in the LICENSE file.</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+[</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+  {</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+    &quot;namespace&quot;: &quot;windows&quot;,</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+    &quot;description&quot;: &quot;Use the &lt;code&gt;browser.windows&lt;/code&gt; API to interact with browser windows. You can use this API to create, modify, and rearrange windows in the browser.&quot;,</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    &quot;types&quot;: [</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+      {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+        &quot;id&quot;: &quot;WindowType&quot;,</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+        &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+        &quot;description&quot;: &quot;The type of browser window this is. Under some circumstances a Window may not be assigned type property, for example when querying closed windows from the $(ref:sessions) API.&quot;,</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+        &quot;enum&quot;: [&quot;normal&quot;, &quot;popup&quot;, &quot;panel&quot;, &quot;app&quot;, &quot;devtools&quot;]</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+      },</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+      {</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+        &quot;id&quot;: &quot;WindowState&quot;,</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+        &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+        &quot;description&quot;: &quot;The state of this browser window. Under some circumstances a Window may not be assigned state property, for example when querying closed windows from the $(ref:sessions) API.&quot;,</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+        &quot;enum&quot;: [&quot;normal&quot;, &quot;minimized&quot;, &quot;maximized&quot;, &quot;fullscreen&quot;, &quot;docked&quot;]</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+      },</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+      {</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+        &quot;id&quot;: &quot;Window&quot;,</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+        &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+        &quot;properties&quot;: {</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+          &quot;id&quot;: {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+            &quot;description&quot;: &quot;The ID of the window. Window IDs are unique within a browser session. Under some circumstances a Window may not be assigned an ID, for example when querying windows using the $(ref:sessions) API, in which case a session ID may be present.&quot;</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+          },</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+          &quot;focused&quot;: {</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+            &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+            &quot;description&quot;: &quot;Whether the window is currently the focused window.&quot;</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+          },</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+          &quot;top&quot;: {</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+            &quot;description&quot;: &quot;The offset of the window from the top edge of the screen in pixels. Under some circumstances a Window may not be assigned top property, for example when querying closed windows from the $(ref:sessions) API.&quot;</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+          },</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+          &quot;left&quot;: {</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+            &quot;description&quot;: &quot;The offset of the window from the left edge of the screen in pixels. Under some circumstances a Window may not be assigned left property, for example when querying closed windows from the $(ref:sessions) API.&quot;</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+          },</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+          &quot;width&quot;: {</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+            &quot;description&quot;: &quot;The width of the window, including the frame, in pixels. Under some circumstances a Window may not be assigned width property, for example when querying closed windows from the $(ref:sessions) API.&quot;</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+          },</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+          &quot;height&quot;: {</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+            &quot;description&quot;: &quot;The height of the window, including the frame, in pixels. Under some circumstances a Window may not be assigned height property, for example when querying closed windows from the $(ref:sessions) API.&quot;</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+          },</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+          &quot;tabs&quot;: {</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+            &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+            &quot;items&quot;: { &quot;$ref&quot;: &quot;tabs.Tab&quot; },</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+            &quot;description&quot;: &quot;Array of $(ref:tabs.Tab) objects representing the current tabs in the window.&quot;</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+          },</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+          &quot;incognito&quot;: {</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+            &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+            &quot;description&quot;: &quot;Whether the window is incognito.&quot;</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+          },</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+          &quot;type&quot;: {</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+            &quot;$ref&quot;: &quot;WindowType&quot;,</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+            &quot;description&quot;: &quot;The type of browser window this is.&quot;</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+          },</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+          &quot;state&quot;: {</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+            &quot;$ref&quot;: &quot;WindowState&quot;,</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+            &quot;description&quot;: &quot;The state of this browser window.&quot;</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+          },</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+          &quot;alwaysOnTop&quot;: {</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+            &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+            &quot;description&quot;: &quot;Whether the window is set to be always on top.&quot;</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+          },</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+          &quot;sessionId&quot;: {</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+            &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+            &quot;description&quot;: &quot;The session ID used to uniquely identify a Window obtained from the $(ref:sessions) API.&quot;</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+          },</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+          &quot;title&quot;: {</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+            &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+            &quot;description&quot;: &quot;The title of the window. Read-only.&quot;</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+          }</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+        }</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+      },</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+      {</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+        &quot;id&quot;: &quot;CreateType&quot;,</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+        &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+        &quot;description&quot;: &quot;Specifies what type of browser window to create. The 'panel' and 'detached_panel' types create a popup unless the '--enable-panels' flag is set.&quot;,</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+        &quot;enum&quot;: [&quot;normal&quot;, &quot;popup&quot;, &quot;panel&quot;, &quot;detached_panel&quot;]</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+      }</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+    ],</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+    &quot;properties&quot;: {</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+      &quot;WINDOW_ID_NONE&quot;: {</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+        &quot;value&quot;: -1,</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+        &quot;description&quot;: &quot;The windowId value that represents the absence of a browser window.&quot;</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+      },</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+      &quot;WINDOW_ID_CURRENT&quot;: {</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineplus">+        &quot;value&quot;: -2,</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+        &quot;description&quot;: &quot;The windowId value that represents the $(topic:current-window)[current window].&quot;</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+      }</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+    },</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineplus">+    &quot;functions&quot;: [</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineplus">+      {</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineplus">+        &quot;name&quot;: &quot;get&quot;,</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineplus">+        &quot;description&quot;: &quot;Gets details about a window.&quot;,</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+          {</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+            &quot;name&quot;: &quot;windowId&quot;,</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+            &quot;minimum&quot;: -2</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+          },</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+          {</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+            &quot;name&quot;: &quot;getInfo&quot;,</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+            &quot;description&quot;: &quot;&quot;,</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+              &quot;populate&quot;: {</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineplus">+                &quot;description&quot;: &quot;If true, the $(ref:windows.Window) object will have a &lt;var&gt;tabs&lt;/var&gt; property that contains a list of the $(ref:tabs.Tab) objects. The &lt;code&gt;Tab&lt;/code&gt; objects only contain the &lt;code&gt;url&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;favIconUrl&lt;/code&gt; properties if the extension's manifest file includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineplus">+              },</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineplus">+              &quot;windowTypes&quot;: {</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineplus">+                &quot;items&quot;: {</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineplus">+                  &quot;$ref&quot;: &quot;WindowType&quot;</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+                },</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineplus">+                &quot;description&quot;: &quot;If set, the $(ref:windows.Window) returned will be filtered based on its type. If unset the default filter is set to &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineplus">+              }</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+            }</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+          },</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineplus">+          {</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineplus">+              {</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineplus">+                &quot;name&quot;: &quot;window&quot;,</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineplus">+                &quot;$ref&quot;: &quot;Window&quot;</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineplus">+              }</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineplus">+            ]</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineplus">+          }</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineplus">+        ]</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineplus">+      },</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineplus">+      {</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+        &quot;name&quot;: &quot;getCurrent&quot;,</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineplus">+        &quot;description&quot;: &quot;Gets the $(topic:current-window)[current window].&quot;,</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineplus">+          {</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineplus">+            &quot;name&quot;: &quot;getInfo&quot;,</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+            &quot;description&quot;: &quot;&quot;,</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+              &quot;populate&quot;: {</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+                &quot;description&quot;: &quot;If true, the $(ref:windows.Window) object will have a &lt;var&gt;tabs&lt;/var&gt; property that contains a list of the $(ref:tabs.Tab) objects. The &lt;code&gt;Tab&lt;/code&gt; objects only contain the &lt;code&gt;url&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;favIconUrl&lt;/code&gt; properties if the extension's manifest file includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+              },</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineplus">+              &quot;windowTypes&quot;: {</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineplus">+                &quot;items&quot;: { &quot;$ref&quot;: &quot;WindowType&quot; },</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+                &quot;description&quot;: &quot;If set, the $(ref:windows.Window) returned will be filtered based on its type. If unset the default filter is set to &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+              }</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+            }</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+          },</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+          {</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineplus">+              {</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineplus">+                &quot;name&quot;: &quot;window&quot;,</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineplus">+                &quot;$ref&quot;: &quot;Window&quot;</span>
<a href="#l17.190"></a><span id="l17.190" class="difflineplus">+              }</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineplus">+            ]</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineplus">+          }</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineplus">+        ]</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineplus">+      },</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineplus">+      {</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineplus">+        &quot;name&quot;: &quot;getLastFocused&quot;,</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+        &quot;description&quot;: &quot;Gets the window that was most recently focused &amp;mdash; typically the window 'on top'.&quot;,</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+          {</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineplus">+            &quot;name&quot;: &quot;getInfo&quot;,</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+            &quot;description&quot;: &quot;&quot;,</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineplus">+              &quot;populate&quot;: {</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+                &quot;description&quot;: &quot;If true, the $(ref:windows.Window) object will have a &lt;var&gt;tabs&lt;/var&gt; property that contains a list of the $(ref:tabs.Tab) objects. The &lt;code&gt;Tab&lt;/code&gt; objects only contain the &lt;code&gt;url&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;favIconUrl&lt;/code&gt; properties if the extension's manifest file includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+              },</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+              &quot;windowTypes&quot;: {</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+                &quot;items&quot;: { &quot;$ref&quot;: &quot;WindowType&quot; },</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineplus">+                &quot;description&quot;: &quot;If set, the $(ref:windows.Window) returned will be filtered based on its type. If unset the default filter is set to &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineplus">+              }</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineplus">+            }</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+          },</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+          {</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+              {</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineplus">+                &quot;name&quot;: &quot;window&quot;,</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+                &quot;$ref&quot;: &quot;Window&quot;</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineplus">+              }</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineplus">+            ]</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineplus">+          }</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineplus">+        ]</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineplus">+      },</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+      {</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineplus">+        &quot;name&quot;: &quot;getAll&quot;,</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineplus">+        &quot;description&quot;: &quot;Gets all windows.&quot;,</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineplus">+          {</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineplus">+            &quot;name&quot;: &quot;getInfo&quot;,</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineplus">+            &quot;description&quot;: &quot;&quot;,</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineplus">+              &quot;populate&quot;: {</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineplus">+                &quot;description&quot;: &quot;If true, each $(ref:windows.Window) object will have a &lt;var&gt;tabs&lt;/var&gt; property that contains a list of the $(ref:tabs.Tab) objects for that window. The &lt;code&gt;Tab&lt;/code&gt; objects only contain the &lt;code&gt;url&lt;/code&gt;, &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;favIconUrl&lt;/code&gt; properties if the extension's manifest file includes the &lt;code&gt;\&quot;tabs\&quot;&lt;/code&gt; permission.&quot;</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineplus">+              },</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineplus">+              &quot;windowTypes&quot;: {</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineplus">+                &quot;items&quot;: { &quot;$ref&quot;: &quot;WindowType&quot; },</span>
<a href="#l17.252"></a><span id="l17.252" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineplus">+                &quot;description&quot;: &quot;If set, the $(ref:windows.Window) returned will be filtered based on its type. If unset the default filter is set to &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineplus">+              }</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineplus">+            }</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineplus">+          },</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineplus">+          {</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+              {</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+                &quot;name&quot;: &quot;windows&quot;,</span>
<a href="#l17.263"></a><span id="l17.263" class="difflineplus">+                &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.264"></a><span id="l17.264" class="difflineplus">+                &quot;items&quot;: { &quot;$ref&quot;: &quot;Window&quot; }</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineplus">+              }</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+            ]</span>
<a href="#l17.267"></a><span id="l17.267" class="difflineplus">+          }</span>
<a href="#l17.268"></a><span id="l17.268" class="difflineplus">+        ]</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineplus">+      },</span>
<a href="#l17.270"></a><span id="l17.270" class="difflineplus">+      {</span>
<a href="#l17.271"></a><span id="l17.271" class="difflineplus">+        &quot;name&quot;: &quot;create&quot;,</span>
<a href="#l17.272"></a><span id="l17.272" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.273"></a><span id="l17.273" class="difflineplus">+        &quot;description&quot;: &quot;Creates (opens) a new browser with any optional sizing, position or default URL provided.&quot;,</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.275"></a><span id="l17.275" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.276"></a><span id="l17.276" class="difflineplus">+          {</span>
<a href="#l17.277"></a><span id="l17.277" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.278"></a><span id="l17.278" class="difflineplus">+            &quot;name&quot;: &quot;createData&quot;,</span>
<a href="#l17.279"></a><span id="l17.279" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.280"></a><span id="l17.280" class="difflineplus">+            &quot;default&quot;: {},</span>
<a href="#l17.281"></a><span id="l17.281" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l17.282"></a><span id="l17.282" class="difflineplus">+              &quot;url&quot;: {</span>
<a href="#l17.283"></a><span id="l17.283" class="difflineplus">+                &quot;description&quot;: &quot;A URL or array of URLs to open as tabs in the window. Fully-qualified URLs must include a scheme (i.e. 'http://www.google.com', not 'www.google.com'). Relative URLs will be relative to the current page within the extension. Defaults to the New Tab Page.&quot;,</span>
<a href="#l17.284"></a><span id="l17.284" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.285"></a><span id="l17.285" class="difflineplus">+                &quot;choices&quot;: [</span>
<a href="#l17.286"></a><span id="l17.286" class="difflineplus">+                  { &quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;relativeUrl&quot; },</span>
<a href="#l17.287"></a><span id="l17.287" class="difflineplus">+                  {</span>
<a href="#l17.288"></a><span id="l17.288" class="difflineplus">+                    &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.289"></a><span id="l17.289" class="difflineplus">+                    &quot;items&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;relativeUrl&quot; }</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineplus">+                  }</span>
<a href="#l17.291"></a><span id="l17.291" class="difflineplus">+                ]</span>
<a href="#l17.292"></a><span id="l17.292" class="difflineplus">+              },</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineplus">+              &quot;tabId&quot;: {</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.297"></a><span id="l17.297" class="difflineplus">+                &quot;description&quot;: &quot;The id of the tab for which you want to adopt to the new window.&quot;</span>
<a href="#l17.298"></a><span id="l17.298" class="difflineplus">+              },</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineplus">+              &quot;left&quot;: {</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.301"></a><span id="l17.301" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+                &quot;description&quot;: &quot;The number of pixels to position the new window from the left edge of the screen. If not specified, the new window is offset naturally from the last focused window. This value is ignored for panels.&quot;</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineplus">+              },</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineplus">+              &quot;top&quot;: {</span>
<a href="#l17.305"></a><span id="l17.305" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.307"></a><span id="l17.307" class="difflineplus">+                &quot;description&quot;: &quot;The number of pixels to position the new window from the top edge of the screen. If not specified, the new window is offset naturally from the last focused window. This value is ignored for panels.&quot;</span>
<a href="#l17.308"></a><span id="l17.308" class="difflineplus">+              },</span>
<a href="#l17.309"></a><span id="l17.309" class="difflineplus">+              &quot;width&quot;: {</span>
<a href="#l17.310"></a><span id="l17.310" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.311"></a><span id="l17.311" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+                &quot;description&quot;: &quot;The width in pixels of the new window, including the frame. If not specified defaults to a natural width.&quot;</span>
<a href="#l17.314"></a><span id="l17.314" class="difflineplus">+              },</span>
<a href="#l17.315"></a><span id="l17.315" class="difflineplus">+              &quot;height&quot;: {</span>
<a href="#l17.316"></a><span id="l17.316" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.317"></a><span id="l17.317" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l17.318"></a><span id="l17.318" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.319"></a><span id="l17.319" class="difflineplus">+                &quot;description&quot;: &quot;The height in pixels of the new window, including the frame. If not specified defaults to a natural height.&quot;</span>
<a href="#l17.320"></a><span id="l17.320" class="difflineplus">+              },</span>
<a href="#l17.321"></a><span id="l17.321" class="difflineplus">+              &quot;focused&quot;: {</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineplus">+                &quot;unsupported&quot;: true,</span>
<a href="#l17.323"></a><span id="l17.323" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.324"></a><span id="l17.324" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.325"></a><span id="l17.325" class="difflineplus">+                &quot;description&quot;: &quot;If true, opens an active window. If false, opens an inactive window.&quot;</span>
<a href="#l17.326"></a><span id="l17.326" class="difflineplus">+              },</span>
<a href="#l17.327"></a><span id="l17.327" class="difflineplus">+              &quot;incognito&quot;: {</span>
<a href="#l17.328"></a><span id="l17.328" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineplus">+                &quot;description&quot;: &quot;Whether the new window should be an incognito window.&quot;</span>
<a href="#l17.331"></a><span id="l17.331" class="difflineplus">+              },</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineplus">+              &quot;type&quot;: {</span>
<a href="#l17.333"></a><span id="l17.333" class="difflineplus">+                &quot;$ref&quot;: &quot;CreateType&quot;,</span>
<a href="#l17.334"></a><span id="l17.334" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineplus">+                &quot;description&quot;: &quot;Specifies what type of browser window to create. The 'panel' and 'detached_panel' types create a popup unless the '--enable-panels' flag is set.&quot;</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineplus">+              },</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineplus">+              &quot;state&quot;: {</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineplus">+                &quot;$ref&quot;: &quot;WindowState&quot;,</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.340"></a><span id="l17.340" class="difflineplus">+                &quot;description&quot;: &quot;The initial state of the window. The 'minimized', 'maximized' and 'fullscreen' states cannot be combined with 'left', 'top', 'width' or 'height'.&quot;</span>
<a href="#l17.341"></a><span id="l17.341" class="difflineplus">+              },</span>
<a href="#l17.342"></a><span id="l17.342" class="difflineplus">+              &quot;allowScriptsToClose&quot;: {</span>
<a href="#l17.343"></a><span id="l17.343" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.344"></a><span id="l17.344" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.345"></a><span id="l17.345" class="difflineplus">+                &quot;description&quot;: &quot;Allow scripts to close the window.&quot;</span>
<a href="#l17.346"></a><span id="l17.346" class="difflineplus">+              },</span>
<a href="#l17.347"></a><span id="l17.347" class="difflineplus">+              &quot;titlePreface&quot;: {</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.349"></a><span id="l17.349" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.350"></a><span id="l17.350" class="difflineplus">+                &quot;description&quot;: &quot;A string to add to the beginning of the window title.&quot;</span>
<a href="#l17.351"></a><span id="l17.351" class="difflineplus">+              }</span>
<a href="#l17.352"></a><span id="l17.352" class="difflineplus">+            },</span>
<a href="#l17.353"></a><span id="l17.353" class="difflineplus">+            &quot;optional&quot;: true</span>
<a href="#l17.354"></a><span id="l17.354" class="difflineplus">+          },</span>
<a href="#l17.355"></a><span id="l17.355" class="difflineplus">+          {</span>
<a href="#l17.356"></a><span id="l17.356" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.357"></a><span id="l17.357" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.359"></a><span id="l17.359" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l17.360"></a><span id="l17.360" class="difflineplus">+              {</span>
<a href="#l17.361"></a><span id="l17.361" class="difflineplus">+                &quot;name&quot;: &quot;window&quot;,</span>
<a href="#l17.362"></a><span id="l17.362" class="difflineplus">+                &quot;$ref&quot;: &quot;Window&quot;,</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineplus">+                &quot;description&quot;: &quot;Contains details about the created window.&quot;,</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineplus">+                &quot;optional&quot;: true</span>
<a href="#l17.365"></a><span id="l17.365" class="difflineplus">+              }</span>
<a href="#l17.366"></a><span id="l17.366" class="difflineplus">+            ]</span>
<a href="#l17.367"></a><span id="l17.367" class="difflineplus">+          }</span>
<a href="#l17.368"></a><span id="l17.368" class="difflineplus">+        ]</span>
<a href="#l17.369"></a><span id="l17.369" class="difflineplus">+      },</span>
<a href="#l17.370"></a><span id="l17.370" class="difflineplus">+      {</span>
<a href="#l17.371"></a><span id="l17.371" class="difflineplus">+        &quot;name&quot;: &quot;update&quot;,</span>
<a href="#l17.372"></a><span id="l17.372" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.373"></a><span id="l17.373" class="difflineplus">+        &quot;description&quot;: &quot;Updates the properties of a window. Specify only the properties that you want to change; unspecified properties will be left unchanged.&quot;,</span>
<a href="#l17.374"></a><span id="l17.374" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.375"></a><span id="l17.375" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.376"></a><span id="l17.376" class="difflineplus">+          {</span>
<a href="#l17.377"></a><span id="l17.377" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.378"></a><span id="l17.378" class="difflineplus">+            &quot;name&quot;: &quot;windowId&quot;,</span>
<a href="#l17.379"></a><span id="l17.379" class="difflineplus">+            &quot;minimum&quot;: -2</span>
<a href="#l17.380"></a><span id="l17.380" class="difflineplus">+          },</span>
<a href="#l17.381"></a><span id="l17.381" class="difflineplus">+          {</span>
<a href="#l17.382"></a><span id="l17.382" class="difflineplus">+            &quot;type&quot;: &quot;object&quot;,</span>
<a href="#l17.383"></a><span id="l17.383" class="difflineplus">+            &quot;name&quot;: &quot;updateInfo&quot;,</span>
<a href="#l17.384"></a><span id="l17.384" class="difflineplus">+            &quot;properties&quot;: {</span>
<a href="#l17.385"></a><span id="l17.385" class="difflineplus">+              &quot;left&quot;: {</span>
<a href="#l17.386"></a><span id="l17.386" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.387"></a><span id="l17.387" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.388"></a><span id="l17.388" class="difflineplus">+                &quot;description&quot;: &quot;The offset from the left edge of the screen to move the window to in pixels. This value is ignored for panels.&quot;</span>
<a href="#l17.389"></a><span id="l17.389" class="difflineplus">+              },</span>
<a href="#l17.390"></a><span id="l17.390" class="difflineplus">+              &quot;top&quot;: {</span>
<a href="#l17.391"></a><span id="l17.391" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.392"></a><span id="l17.392" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.393"></a><span id="l17.393" class="difflineplus">+                &quot;description&quot;: &quot;The offset from the top edge of the screen to move the window to in pixels. This value is ignored for panels.&quot;</span>
<a href="#l17.394"></a><span id="l17.394" class="difflineplus">+              },</span>
<a href="#l17.395"></a><span id="l17.395" class="difflineplus">+              &quot;width&quot;: {</span>
<a href="#l17.396"></a><span id="l17.396" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.397"></a><span id="l17.397" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l17.398"></a><span id="l17.398" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.399"></a><span id="l17.399" class="difflineplus">+                &quot;description&quot;: &quot;The width to resize the window to in pixels. This value is ignored for panels.&quot;</span>
<a href="#l17.400"></a><span id="l17.400" class="difflineplus">+              },</span>
<a href="#l17.401"></a><span id="l17.401" class="difflineplus">+              &quot;height&quot;: {</span>
<a href="#l17.402"></a><span id="l17.402" class="difflineplus">+                &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.403"></a><span id="l17.403" class="difflineplus">+                &quot;minimum&quot;: 0,</span>
<a href="#l17.404"></a><span id="l17.404" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.405"></a><span id="l17.405" class="difflineplus">+                &quot;description&quot;: &quot;The height to resize the window to in pixels. This value is ignored for panels.&quot;</span>
<a href="#l17.406"></a><span id="l17.406" class="difflineplus">+              },</span>
<a href="#l17.407"></a><span id="l17.407" class="difflineplus">+              &quot;focused&quot;: {</span>
<a href="#l17.408"></a><span id="l17.408" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.409"></a><span id="l17.409" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.410"></a><span id="l17.410" class="difflineplus">+                &quot;description&quot;: &quot;If true, brings the window to the front. If false, brings the next window in the z-order to the front.&quot;</span>
<a href="#l17.411"></a><span id="l17.411" class="difflineplus">+              },</span>
<a href="#l17.412"></a><span id="l17.412" class="difflineplus">+              &quot;drawAttention&quot;: {</span>
<a href="#l17.413"></a><span id="l17.413" class="difflineplus">+                &quot;type&quot;: &quot;boolean&quot;,</span>
<a href="#l17.414"></a><span id="l17.414" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.415"></a><span id="l17.415" class="difflineplus">+                &quot;description&quot;: &quot;If true, causes the window to be displayed in a manner that draws the user's attention to the window, without changing the focused window. The effect lasts until the user changes focus to the window. This option has no effect if the window already has focus. Set to false to cancel a previous draw attention request.&quot;</span>
<a href="#l17.416"></a><span id="l17.416" class="difflineplus">+              },</span>
<a href="#l17.417"></a><span id="l17.417" class="difflineplus">+              &quot;state&quot;: {</span>
<a href="#l17.418"></a><span id="l17.418" class="difflineplus">+                &quot;$ref&quot;: &quot;WindowState&quot;,</span>
<a href="#l17.419"></a><span id="l17.419" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.420"></a><span id="l17.420" class="difflineplus">+                &quot;description&quot;: &quot;The new state of the window. The 'minimized', 'maximized' and 'fullscreen' states cannot be combined with 'left', 'top', 'width' or 'height'.&quot;</span>
<a href="#l17.421"></a><span id="l17.421" class="difflineplus">+              },</span>
<a href="#l17.422"></a><span id="l17.422" class="difflineplus">+              &quot;titlePreface&quot;: {</span>
<a href="#l17.423"></a><span id="l17.423" class="difflineplus">+                &quot;type&quot;: &quot;string&quot;,</span>
<a href="#l17.424"></a><span id="l17.424" class="difflineplus">+                &quot;optional&quot;: true,</span>
<a href="#l17.425"></a><span id="l17.425" class="difflineplus">+                &quot;description&quot;: &quot;A string to add to the beginning of the window title.&quot;</span>
<a href="#l17.426"></a><span id="l17.426" class="difflineplus">+              }</span>
<a href="#l17.427"></a><span id="l17.427" class="difflineplus">+            }</span>
<a href="#l17.428"></a><span id="l17.428" class="difflineplus">+          },</span>
<a href="#l17.429"></a><span id="l17.429" class="difflineplus">+          {</span>
<a href="#l17.430"></a><span id="l17.430" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.431"></a><span id="l17.431" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.432"></a><span id="l17.432" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.433"></a><span id="l17.433" class="difflineplus">+            &quot;parameters&quot;: [</span>
<a href="#l17.434"></a><span id="l17.434" class="difflineplus">+              {</span>
<a href="#l17.435"></a><span id="l17.435" class="difflineplus">+                &quot;name&quot;: &quot;window&quot;,</span>
<a href="#l17.436"></a><span id="l17.436" class="difflineplus">+                &quot;$ref&quot;: &quot;Window&quot;</span>
<a href="#l17.437"></a><span id="l17.437" class="difflineplus">+              }</span>
<a href="#l17.438"></a><span id="l17.438" class="difflineplus">+            ]</span>
<a href="#l17.439"></a><span id="l17.439" class="difflineplus">+          }</span>
<a href="#l17.440"></a><span id="l17.440" class="difflineplus">+        ]</span>
<a href="#l17.441"></a><span id="l17.441" class="difflineplus">+      },</span>
<a href="#l17.442"></a><span id="l17.442" class="difflineplus">+      {</span>
<a href="#l17.443"></a><span id="l17.443" class="difflineplus">+        &quot;name&quot;: &quot;remove&quot;,</span>
<a href="#l17.444"></a><span id="l17.444" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.445"></a><span id="l17.445" class="difflineplus">+        &quot;description&quot;: &quot;Removes (closes) a window, and all the tabs inside it.&quot;,</span>
<a href="#l17.446"></a><span id="l17.446" class="difflineplus">+        &quot;async&quot;: &quot;callback&quot;,</span>
<a href="#l17.447"></a><span id="l17.447" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.448"></a><span id="l17.448" class="difflineplus">+          {</span>
<a href="#l17.449"></a><span id="l17.449" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.450"></a><span id="l17.450" class="difflineplus">+            &quot;name&quot;: &quot;windowId&quot;,</span>
<a href="#l17.451"></a><span id="l17.451" class="difflineplus">+            &quot;minimum&quot;: 0</span>
<a href="#l17.452"></a><span id="l17.452" class="difflineplus">+          },</span>
<a href="#l17.453"></a><span id="l17.453" class="difflineplus">+          {</span>
<a href="#l17.454"></a><span id="l17.454" class="difflineplus">+            &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.455"></a><span id="l17.455" class="difflineplus">+            &quot;name&quot;: &quot;callback&quot;,</span>
<a href="#l17.456"></a><span id="l17.456" class="difflineplus">+            &quot;optional&quot;: true,</span>
<a href="#l17.457"></a><span id="l17.457" class="difflineplus">+            &quot;parameters&quot;: []</span>
<a href="#l17.458"></a><span id="l17.458" class="difflineplus">+          }</span>
<a href="#l17.459"></a><span id="l17.459" class="difflineplus">+        ]</span>
<a href="#l17.460"></a><span id="l17.460" class="difflineplus">+      }</span>
<a href="#l17.461"></a><span id="l17.461" class="difflineplus">+    ],</span>
<a href="#l17.462"></a><span id="l17.462" class="difflineplus">+    &quot;events&quot;: [</span>
<a href="#l17.463"></a><span id="l17.463" class="difflineplus">+      {</span>
<a href="#l17.464"></a><span id="l17.464" class="difflineplus">+        &quot;name&quot;: &quot;onCreated&quot;,</span>
<a href="#l17.465"></a><span id="l17.465" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.466"></a><span id="l17.466" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a window is created.&quot;,</span>
<a href="#l17.467"></a><span id="l17.467" class="difflineplus">+        &quot;filters&quot;: [</span>
<a href="#l17.468"></a><span id="l17.468" class="difflineplus">+          {</span>
<a href="#l17.469"></a><span id="l17.469" class="difflineplus">+            &quot;name&quot;: &quot;windowTypes&quot;,</span>
<a href="#l17.470"></a><span id="l17.470" class="difflineplus">+            &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.471"></a><span id="l17.471" class="difflineplus">+            &quot;items&quot;: { &quot;$ref&quot;: &quot;WindowType&quot; },</span>
<a href="#l17.472"></a><span id="l17.472" class="difflineplus">+            &quot;description&quot;: &quot;Conditions that the window's type being created must satisfy. By default it will satisfy &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.473"></a><span id="l17.473" class="difflineplus">+          }</span>
<a href="#l17.474"></a><span id="l17.474" class="difflineplus">+        ],</span>
<a href="#l17.475"></a><span id="l17.475" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.476"></a><span id="l17.476" class="difflineplus">+          {</span>
<a href="#l17.477"></a><span id="l17.477" class="difflineplus">+            &quot;$ref&quot;: &quot;Window&quot;,</span>
<a href="#l17.478"></a><span id="l17.478" class="difflineplus">+            &quot;name&quot;: &quot;window&quot;,</span>
<a href="#l17.479"></a><span id="l17.479" class="difflineplus">+            &quot;description&quot;: &quot;Details of the window that was created.&quot;</span>
<a href="#l17.480"></a><span id="l17.480" class="difflineplus">+          }</span>
<a href="#l17.481"></a><span id="l17.481" class="difflineplus">+        ]</span>
<a href="#l17.482"></a><span id="l17.482" class="difflineplus">+      },</span>
<a href="#l17.483"></a><span id="l17.483" class="difflineplus">+      {</span>
<a href="#l17.484"></a><span id="l17.484" class="difflineplus">+        &quot;name&quot;: &quot;onRemoved&quot;,</span>
<a href="#l17.485"></a><span id="l17.485" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.486"></a><span id="l17.486" class="difflineplus">+        &quot;description&quot;: &quot;Fired when a window is removed (closed).&quot;,</span>
<a href="#l17.487"></a><span id="l17.487" class="difflineplus">+        &quot;filters&quot;: [</span>
<a href="#l17.488"></a><span id="l17.488" class="difflineplus">+          {</span>
<a href="#l17.489"></a><span id="l17.489" class="difflineplus">+            &quot;name&quot;: &quot;windowTypes&quot;,</span>
<a href="#l17.490"></a><span id="l17.490" class="difflineplus">+            &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.491"></a><span id="l17.491" class="difflineplus">+            &quot;items&quot;: { &quot;$ref&quot;: &quot;WindowType&quot; },</span>
<a href="#l17.492"></a><span id="l17.492" class="difflineplus">+            &quot;description&quot;: &quot;Conditions that the window's type being removed must satisfy. By default it will satisfy &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.493"></a><span id="l17.493" class="difflineplus">+          }</span>
<a href="#l17.494"></a><span id="l17.494" class="difflineplus">+        ],</span>
<a href="#l17.495"></a><span id="l17.495" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.496"></a><span id="l17.496" class="difflineplus">+          {</span>
<a href="#l17.497"></a><span id="l17.497" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.498"></a><span id="l17.498" class="difflineplus">+            &quot;name&quot;: &quot;windowId&quot;,</span>
<a href="#l17.499"></a><span id="l17.499" class="difflineplus">+            &quot;minimum&quot;: 0,</span>
<a href="#l17.500"></a><span id="l17.500" class="difflineplus">+            &quot;description&quot;: &quot;ID of the removed window.&quot;</span>
<a href="#l17.501"></a><span id="l17.501" class="difflineplus">+          }</span>
<a href="#l17.502"></a><span id="l17.502" class="difflineplus">+        ]</span>
<a href="#l17.503"></a><span id="l17.503" class="difflineplus">+      },</span>
<a href="#l17.504"></a><span id="l17.504" class="difflineplus">+      {</span>
<a href="#l17.505"></a><span id="l17.505" class="difflineplus">+        &quot;name&quot;: &quot;onFocusChanged&quot;,</span>
<a href="#l17.506"></a><span id="l17.506" class="difflineplus">+        &quot;type&quot;: &quot;function&quot;,</span>
<a href="#l17.507"></a><span id="l17.507" class="difflineplus">+        &quot;description&quot;: &quot;Fired when the currently focused window changes. Will be $(ref:windows.WINDOW_ID_NONE) if all browser windows have lost focus. Note: On some Linux window managers, WINDOW_ID_NONE will always be sent immediately preceding a switch from one browser window to another.&quot;,</span>
<a href="#l17.508"></a><span id="l17.508" class="difflineplus">+        &quot;filters&quot;: [</span>
<a href="#l17.509"></a><span id="l17.509" class="difflineplus">+          {</span>
<a href="#l17.510"></a><span id="l17.510" class="difflineplus">+            &quot;name&quot;: &quot;windowTypes&quot;,</span>
<a href="#l17.511"></a><span id="l17.511" class="difflineplus">+            &quot;type&quot;: &quot;array&quot;,</span>
<a href="#l17.512"></a><span id="l17.512" class="difflineplus">+            &quot;items&quot;: { &quot;$ref&quot;: &quot;WindowType&quot; },</span>
<a href="#l17.513"></a><span id="l17.513" class="difflineplus">+            &quot;description&quot;: &quot;Conditions that the window's type being removed must satisfy. By default it will satisfy &lt;code&gt;['app', 'normal', 'panel', 'popup']&lt;/code&gt;, with &lt;code&gt;'app'&lt;/code&gt; and &lt;code&gt;'panel'&lt;/code&gt; window types limited to the extension's own windows.&quot;</span>
<a href="#l17.514"></a><span id="l17.514" class="difflineplus">+          }</span>
<a href="#l17.515"></a><span id="l17.515" class="difflineplus">+        ],</span>
<a href="#l17.516"></a><span id="l17.516" class="difflineplus">+        &quot;parameters&quot;: [</span>
<a href="#l17.517"></a><span id="l17.517" class="difflineplus">+          {</span>
<a href="#l17.518"></a><span id="l17.518" class="difflineplus">+            &quot;type&quot;: &quot;integer&quot;,</span>
<a href="#l17.519"></a><span id="l17.519" class="difflineplus">+            &quot;name&quot;: &quot;windowId&quot;,</span>
<a href="#l17.520"></a><span id="l17.520" class="difflineplus">+            &quot;minimum&quot;: -1,</span>
<a href="#l17.521"></a><span id="l17.521" class="difflineplus">+            &quot;description&quot;: &quot;ID of the newly focused window.&quot;</span>
<a href="#l17.522"></a><span id="l17.522" class="difflineplus">+          }</span>
<a href="#l17.523"></a><span id="l17.523" class="difflineplus">+        ]</span>
<a href="#l17.524"></a><span id="l17.524" class="difflineplus">+      }</span>
<a href="#l17.525"></a><span id="l17.525" class="difflineplus">+    ]</span>
<a href="#l17.526"></a><span id="l17.526" class="difflineplus">+  }</span>
<a href="#l17.527"></a><span id="l17.527" class="difflineplus">+]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/moz.build</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/moz.build</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> # Only Mac and Windows have search integration components, but we include at</span>
<a href="#l18.6"></a><span id="l18.6"> # least one module from search/ on all platforms</span>
<a href="#l18.7"></a><span id="l18.7"> DIRS += [</span>
<a href="#l18.8"></a><span id="l18.8">     'compose',</span>
<a href="#l18.9"></a><span id="l18.9">     'cloudfile',</span>
<a href="#l18.10"></a><span id="l18.10">     'devtools',</span>
<a href="#l18.11"></a><span id="l18.11">     'downloads',</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+    'extensions',</span>
<a href="#l18.13"></a><span id="l18.13">     'preferences',</span>
<a href="#l18.14"></a><span id="l18.14">     'addrbook',</span>
<a href="#l18.15"></a><span id="l18.15">     'migration',</span>
<a href="#l18.16"></a><span id="l18.16">     'activity',</span>
<a href="#l18.17"></a><span id="l18.17">     'search',</span>
<a href="#l18.18"></a><span id="l18.18">     'about-support',</span>
<a href="#l18.19"></a><span id="l18.19">     'accountcreation',</span>
<a href="#l18.20"></a><span id="l18.20">     'wintaskbar',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/installer/package-manifest.in</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/installer/package-manifest.in</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -570,16 +570,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> @RESPATH@/contentaccessible/*</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6"> ; svg</span>
<a href="#l19.7"></a><span id="l19.7"> @RESPATH@/res/svg.css</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> ; [Extensions]</span>
<a href="#l19.10"></a><span id="l19.10"> @RESPATH@/components/extensions-toolkit.manifest</span>
<a href="#l19.11"></a><span id="l19.11"> @RESPATH@/components/extension-process-script.js</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+@RESPATH@/components/extensions-mail.manifest</span>
<a href="#l19.13"></a><span id="l19.13"> </span>
<a href="#l19.14"></a><span id="l19.14"> ; [Personal Security Manager]</span>
<a href="#l19.15"></a><span id="l19.15"> ;</span>
<a href="#l19.16"></a><span id="l19.16"> ; NSS libraries are signed in the staging directory,</span>
<a href="#l19.17"></a><span id="l19.17"> ; meaning their .chk files are created there directly.</span>
<a href="#l19.18"></a><span id="l19.18"> ;</span>
<a href="#l19.19"></a><span id="l19.19"> #ifndef MOZ_SYSTEM_NSS</span>
<a href="#l19.20"></a><span id="l19.20"> #if defined(XP_LINUX) &amp;&amp; !defined(ANDROID)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

