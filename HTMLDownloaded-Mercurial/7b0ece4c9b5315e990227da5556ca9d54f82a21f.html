<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3458:7b0ece4c9b5315e990227da5556ca9d54f82a21f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 7b0ece4c9b5315e990227da5556ca9d54f82a21f" />
<meta property="og:url" content="/comm-central/rev/7b0ece4c9b5315e990227da5556ca9d54f82a21f" />
<meta property="og:description" content="Bug 460960 - (smtabmail) Port Thunderbird tabbed interface to MailNews" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 7b0ece4c9b5315e990227da5556ca9d54f82a21f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/7b0ece4c9b5315e990227da5556ca9d54f82a21f">shortlog</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/7b0ece4c9b5315e990227da5556ca9d54f82a21f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f">files</a> |
changeset |
<a href="/comm-central/raw-rev/7b0ece4c9b5315e990227da5556ca9d54f82a21f">raw</a>  | <a href="/comm-central/archive/7b0ece4c9b5315e990227da5556ca9d54f82a21f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=460960">Bug 460960</a> - (smtabmail) Port Thunderbird tabbed interface to MailNews
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#97;&#114;&#115;&#116;&#101;&#110;&#32;&#68;&#252;&#115;&#116;&#101;&#114;&#108;&#111;&#104;&#32;&#60;&#109;&#110;&#121;&#114;&#111;&#109;&#121;&#114;&#64;&#116;&#112;&#114;&#97;&#99;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 31 Aug 2009 22:46:26 +0100</td></tr>

<tr>
 <td>changeset 3458</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/7b0ece4c9b5315e990227da5556ca9d54f82a21f">7b0ece4c9b5315e990227da5556ca9d54f82a21f</a></td>
</tr>



<tr>
<td>parent 3457</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e7c2a5448c9e103dd57a00fb904358248883c80c">e7c2a5448c9e103dd57a00fb904358248883c80c</a>
</td>
</tr>

<tr>
<td>child 3459</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/959519662e65b039c4e048d2e23524ec33005a8c">959519662e65b039c4e048d2e23524ec33005a8c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=7b0ece4c9b5315e990227da5556ca9d54f82a21f">2807</a></td></tr>
<tr><td>push user</td><td>iann_cvs@blueyonder.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Mon, 31 Aug 2009 21:49:40 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@7b0ece4c9b53 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7b0ece4c9b5315e990227da5556ca9d54f82a21f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&newProject=comm-central&newRevision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&newProject=comm-central&newRevision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&newProject=comm-central&newRevision=7b0ece4c9b5315e990227da5556ca9d54f82a21f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=460960">460960</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=460960">Bug 460960</a> - (smtabmail) Port Thunderbird tabbed interface to MailNews
r=IanN sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/mailnews/mailnews.js">mailnews/mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/mailnews/mailnews.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/mailnews/mailnews.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/mailnews/mailnews.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/mailnews/mailnews.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/mailnews/mailnews.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/browser/browser-prefs.js">suite/browser/browser-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/browser/browser-prefs.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/browser/browser-prefs.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/browser/browser-prefs.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/browser/browser-prefs.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/browser/browser-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/commandglue.js">suite/mailnews/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/commandglue.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/commandglue.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/commandglue.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/commandglue.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/jar.mn">suite/mailnews/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/jar.mn">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/jar.mn">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/jar.mn">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/jar.mn">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mail3PaneWindowCommands.js">suite/mailnews/mail3PaneWindowCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mail3PaneWindowCommands.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mail3PaneWindowCommands.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mail3PaneWindowCommands.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mail3PaneWindowCommands.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mail3PaneWindowCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailContextMenus.js">suite/mailnews/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindow.js">suite/mailnews/mailWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindow.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindow.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindow.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindow.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.js">suite/mailnews/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.xul">suite/mailnews/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messageWindow.xul">suite/mailnews/messageWindow.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messageWindow.xul">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messageWindow.xul">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messageWindow.xul">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messageWindow.xul">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messageWindow.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.css">suite/mailnews/messenger.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.xul">suite/mailnews/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.xul">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.xul">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.xul">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.xul">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgHdrViewOverlay.js">suite/mailnews/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgMail3PaneWindow.js">suite/mailnews/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewNavigation.js">suite/mailnews/msgViewNavigation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewNavigation.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewNavigation.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewNavigation.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewNavigation.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewNavigation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewPickerOverlay.js">suite/mailnews/msgViewPickerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewPickerOverlay.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewPickerOverlay.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewPickerOverlay.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewPickerOverlay.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/msgViewPickerOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.js">suite/mailnews/search/SearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.xul">suite/mailnews/search/SearchDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.xul">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.xul">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.xul">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.xul">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/search/SearchDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/searchBar.js">suite/mailnews/searchBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/searchBar.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/searchBar.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/searchBar.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/searchBar.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/searchBar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.js">suite/mailnews/tabmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.xml">suite/mailnews/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.xml">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.xml">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/threadPane.js">suite/mailnews/threadPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/threadPane.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/threadPane.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/threadPane.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/threadPane.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/threadPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/widgetglue.js">suite/mailnews/widgetglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/widgetglue.js">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/widgetglue.js">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/widgetglue.js">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/widgetglue.js">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/mailnews/widgetglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/messenger/mailWindow1.css">suite/themes/classic/mac/messenger/mailWindow1.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/messenger/mailWindow1.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/messenger/mailWindow1.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/messenger/mailWindow1.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/messenger/mailWindow1.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/messenger/mailWindow1.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/navigator/tabbrowser.css">suite/themes/classic/mac/navigator/tabbrowser.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/navigator/tabbrowser.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/navigator/tabbrowser.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/navigator/tabbrowser.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/navigator/tabbrowser.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/mac/navigator/tabbrowser.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/folderPane.css">suite/themes/classic/messenger/folderPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/folderPane.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/folderPane.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/folderPane.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/folderPane.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/folderPane.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/mailWindow1.css">suite/themes/classic/messenger/mailWindow1.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/mailWindow1.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/mailWindow1.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/mailWindow1.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/mailWindow1.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/mailWindow1.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/threadPane.css">suite/themes/classic/messenger/threadPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/threadPane.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/threadPane.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/threadPane.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/threadPane.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/classic/messenger/threadPane.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/folderPane.css">suite/themes/modern/messenger/folderPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/folderPane.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/folderPane.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/folderPane.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/folderPane.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/folderPane.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/mailWindow1.css">suite/themes/modern/messenger/mailWindow1.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/mailWindow1.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/mailWindow1.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/mailWindow1.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/mailWindow1.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/mailWindow1.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/threadPane.css">suite/themes/modern/messenger/threadPane.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/threadPane.css">file</a> |
<a href="/comm-central/annotate/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/threadPane.css">annotate</a> |
<a href="/comm-central/diff/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/threadPane.css">diff</a> |
<a href="/comm-central/comparison/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/threadPane.css">comparison</a> |
<a href="/comm-central/log/7b0ece4c9b5315e990227da5556ca9d54f82a21f/suite/themes/modern/messenger/threadPane.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/mailnews.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/mailnews.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l1.6"></a><span id="l1.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l1.7"></a><span id="l1.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l1.8"></a><span id="l1.8">  *</span>
<a href="#l1.9"></a><span id="l1.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l1.10"></a><span id="l1.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l1.11"></a><span id="l1.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l1.12"></a><span id="l1.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l1.13"></a><span id="l1.13">  *</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineat">@@ -387,17 +387,16 @@ pref(&quot;mailnews.customDBHeaders&quot;, &quot;&quot;);</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> // close standalone message window when deleting the displayed message</span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;mail.close_message_window.on_delete&quot;, false);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> #ifdef MOZ_SUITE</span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;mailnews.reuse_message_window&quot;, true);</span>
<a href="#l1.21"></a><span id="l1.21"> #endif</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-pref(&quot;mailnews.reuse_thread_window2&quot;, false);</span>
<a href="#l1.24"></a><span id="l1.24"> pref(&quot;mailnews.open_window_warning&quot;, 10); // warn user if they attempt to open more than this many messages at once</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26"> pref(&quot;mailnews.start_page.enabled&quot;, true);</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> pref(&quot;mailnews.remember_selected_message&quot;, true);</span>
<a href="#l1.29"></a><span id="l1.29"> pref(&quot;mailnews.scroll_to_new_message&quot;, true);</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31"> // if true, any click on a column header other than the thread column will unthread the view</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/browser-prefs.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/browser-prefs.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.6"></a><span id="l2.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l2.7"></a><span id="l2.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l2.8"></a><span id="l2.8">  *</span>
<a href="#l2.9"></a><span id="l2.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l2.10"></a><span id="l2.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l2.11"></a><span id="l2.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l2.12"></a><span id="l2.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l2.13"></a><span id="l2.13">  *</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineat">@@ -203,29 +203,42 @@ pref(&quot;places.frecency.defaultVisitBonus&quot;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> // bonus (in percent) for place types for frecency calculations</span>
<a href="#l2.17"></a><span id="l2.17"> pref(&quot;places.frecency.unvisitedBookmarkBonus&quot;, 140);</span>
<a href="#l2.18"></a><span id="l2.18"> pref(&quot;places.frecency.unvisitedTypedBonus&quot;, 200);</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> // Tabbed browser</span>
<a href="#l2.21"></a><span id="l2.21"> pref(&quot;browser.tabs.loadDivertedInBackground&quot;, false);</span>
<a href="#l2.22"></a><span id="l2.22"> pref(&quot;browser.tabs.loadInBackground&quot;, false);</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+pref(&quot;browser.tabs.opentabfor.doubleclick&quot;, false);</span>
<a href="#l2.24"></a><span id="l2.24"> pref(&quot;browser.tabs.opentabfor.middleclick&quot;, false);</span>
<a href="#l2.25"></a><span id="l2.25"> pref(&quot;browser.tabs.opentabfor.urlbar&quot;, false);</span>
<a href="#l2.26"></a><span id="l2.26"> pref(&quot;browser.tabs.tooltippreview.enable&quot;, true);</span>
<a href="#l2.27"></a><span id="l2.27"> pref(&quot;browser.tabs.tooltippreview.width&quot;, 300);</span>
<a href="#l2.28"></a><span id="l2.28"> pref(&quot;browser.tabs.autoHide&quot;, true);</span>
<a href="#l2.29"></a><span id="l2.29"> pref(&quot;browser.tabs.forceHide&quot;, false);</span>
<a href="#l2.30"></a><span id="l2.30"> pref(&quot;browser.tabs.warnOnClose&quot;, true);</span>
<a href="#l2.31"></a><span id="l2.31"> pref(&quot;browser.tabs.warnOnCloseOther&quot;, true);</span>
<a href="#l2.32"></a><span id="l2.32"> pref(&quot;browser.tabs.warnOnOpen&quot;, true);</span>
<a href="#l2.33"></a><span id="l2.33"> pref(&quot;browser.tabs.maxOpenBeforeWarn&quot;, 15);</span>
<a href="#l2.34"></a><span id="l2.34"> // 0 = append, 1 = replace</span>
<a href="#l2.35"></a><span id="l2.35"> pref(&quot;browser.tabs.loadGroup&quot;, 1);</span>
<a href="#l2.36"></a><span id="l2.36"> </span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+// tab width and clipping</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+pref(&quot;browser.tabs.tabMinWidth&quot;, 100);</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+pref(&quot;browser.tabs.tabMaxWidth&quot;, 250);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+pref(&quot;browser.tabs.tabClipWidth&quot;, 140);</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+// Where to show tab close buttons:</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+// 0  on active tab only</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+// 1  on all tabs until tabClipWidth is reached, then active tab only</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+// 2  no close buttons at all</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+// 3  at the end of the tabstrip</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+pref(&quot;browser.tabs.closeButtons&quot;, 3);</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+</span>
<a href="#l2.49"></a><span id="l2.49"> // lets new tab/window load something different than first window</span>
<a href="#l2.50"></a><span id="l2.50"> // -1 - use navigator startup preference</span>
<a href="#l2.51"></a><span id="l2.51"> //  0 - loads blank page</span>
<a href="#l2.52"></a><span id="l2.52"> //  1 - loads home page</span>
<a href="#l2.53"></a><span id="l2.53"> //  2 - loads last page visited</span>
<a href="#l2.54"></a><span id="l2.54"> pref(&quot;browser.tabs.loadOnNewTab&quot;, 0);</span>
<a href="#l2.55"></a><span id="l2.55"> pref(&quot;browser.windows.loadOnNewWindow&quot;, 1);</span>
<a href="#l2.56"></a><span id="l2.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/mailnews/commandglue.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/mailnews/commandglue.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l3.8"></a><span id="l3.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l3.9"></a><span id="l3.9">  *</span>
<a href="#l3.10"></a><span id="l3.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l3.11"></a><span id="l3.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l3.12"></a><span id="l3.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l3.13"></a><span id="l3.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l3.14"></a><span id="l3.14">  *</span>
<a href="#l3.15"></a><span id="l3.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineat">@@ -143,16 +143,21 @@ function setTitleFromFolder(msgfolder, s</span>
<a href="#l3.17"></a><span id="l3.17">         if (end) title += &quot; &quot; + end;</span>
<a href="#l3.18"></a><span id="l3.18">       }</span>
<a href="#l3.19"></a><span id="l3.19">     }</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">     if (!/Mac/.test(navigator.platform))</span>
<a href="#l3.22"></a><span id="l3.22">       title += &quot; - &quot; + gBrandBundle.getString(&quot;brandShortName&quot;);</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24">     document.title = title;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+  // Notify the current tab, it might want to update also.</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+  var tabmail = GetTabMail();</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+  tabmail.saveCurrentTabState(); // gDBView may have changed!</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+  tabmail.setTabTitle();</span>
<a href="#l3.30"></a><span id="l3.30"> }</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32"> function UpdateMailToolbar(caller)</span>
<a href="#l3.33"></a><span id="l3.33"> {</span>
<a href="#l3.34"></a><span id="l3.34">   //dump(&quot;XXX update mail-toolbar &quot; + caller + &quot;\n&quot;);</span>
<a href="#l3.35"></a><span id="l3.35">   document.commandDispatcher.updateCommands('mail-toolbar');</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37">   // hook for extra toolbar items</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineat">@@ -354,25 +359,26 @@ function RerootFolder(uri, newFolder, vi</span>
<a href="#l3.39"></a><span id="l3.39">         oldFolder.msgDatabase = null;</span>
<a href="#l3.40"></a><span id="l3.40">   }</span>
<a href="#l3.41"></a><span id="l3.41">   // that should have initialized gDBView, now re-root the thread pane</span>
<a href="#l3.42"></a><span id="l3.42">   RerootThreadPane();</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44">   UpdateLocationBar(gMsgFolderSelected);</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46">   UpdateStatusMessageCounts(gMsgFolderSelected);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-  </span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+</span>
<a href="#l3.49"></a><span id="l3.49">   UpdateMailToolbar(&quot;reroot folder in 3 pane&quot;);</span>
<a href="#l3.50"></a><span id="l3.50">   // hook for extra toolbar items</span>
<a href="#l3.51"></a><span id="l3.51">   var observerService = Components.classes[&quot;@mozilla.org/observer-service;1&quot;].getService(Components.interfaces.nsIObserverService);</span>
<a href="#l3.52"></a><span id="l3.52">   observerService.notifyObservers(window, &quot;mail:updateToolbarItems&quot;, null);</span>
<a href="#l3.53"></a><span id="l3.53">   // this is to kick off cross-folder searches for virtual folders.</span>
<a href="#l3.54"></a><span id="l3.54">   if (gSearchSession &amp;&amp; !gVirtualFolderTerms) // another var might be better...</span>
<a href="#l3.55"></a><span id="l3.55">   {</span>
<a href="#l3.56"></a><span id="l3.56">     viewDebug(&quot;doing a xf folder search in rerootFolder\n&quot;);</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+    gCurrentLoadingFolderURI = &quot;&quot;;</span>
<a href="#l3.58"></a><span id="l3.58">     ViewChangeByFolder(newFolder);</span>
<a href="#l3.59"></a><span id="l3.59">     gPreQuickSearchView = null; // don't remember the cross folder search</span>
<a href="#l3.60"></a><span id="l3.60">     ScrollToMessageAfterFolderLoad(newFolder);</span>
<a href="#l3.61"></a><span id="l3.61">   }</span>
<a href="#l3.62"></a><span id="l3.62"> }</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64"> function SwitchView(command)</span>
<a href="#l3.65"></a><span id="l3.65"> {</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineat">@@ -719,50 +725,16 @@ function CreateDBView(msgFolder, viewTyp</span>
<a href="#l3.67"></a><span id="l3.67">   // suppress message display if appropriate.</span>
<a href="#l3.68"></a><span id="l3.68">   gDBView.suppressMsgDisplay = IsMessagePaneCollapsed();</span>
<a href="#l3.69"></a><span id="l3.69"> </span>
<a href="#l3.70"></a><span id="l3.70">   UpdateSortIndicators(gCurSortType, sortOrder);</span>
<a href="#l3.71"></a><span id="l3.71">   var ObserverService = Components.classes[&quot;@mozilla.org/observer-service;1&quot;].getService(Components.interfaces.nsIObserverService);</span>
<a href="#l3.72"></a><span id="l3.72">   ObserverService.notifyObservers(msgFolder, &quot;MsgCreateDBView&quot;, viewType + &quot;:&quot; + viewFlags);</span>
<a href="#l3.73"></a><span id="l3.73"> }</span>
<a href="#l3.74"></a><span id="l3.74"> </span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-function ChangeMessagePaneVisibility(now_hidden)</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-{</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-  // We also have to disable the Message/Attachments menuitem.</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-  // It will be enabled when loading a message with attachments</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-  // (see messageHeaderSink.handleAttachment).</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-  var node = document.getElementById(&quot;msgAttachmentMenu&quot;);</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-  if (node &amp;&amp; now_hidden)</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-    node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-  if (gDBView) {</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-    // clear the subject, collapsing won't automatically do this</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-    setTitleFromFolder(GetThreadPaneFolder(), null);</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-    // the collapsed state is the state after we released the mouse </span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-    // so we take it as it is</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-    gDBView.suppressMsgDisplay = now_hidden;</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-    // set the subject, uncollapsing won't automatically do this</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-    gDBView.loadMessageByUrl(&quot;about:blank&quot;);</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-    gDBView.selectionChanged();</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-  }</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-  var event = document.createEvent('Events');</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-  if (now_hidden) {</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-    event.initEvent('messagepane-hide', false, true);</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-  }</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-  else {</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-    event.initEvent('messagepane-unhide', false, true);</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-  }</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-  document.getElementById(&quot;messengerWindow&quot;).dispatchEvent(event);</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-}</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-function OnClickThreadAndMessagePaneSplitter()</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-{</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-  ChangeMessagePaneVisibility(IsMessagePaneCollapsed());</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-}</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-</span>
<a href="#l3.109"></a><span id="l3.109"> function FolderPaneSelectionChange()</span>
<a href="#l3.110"></a><span id="l3.110"> {</span>
<a href="#l3.111"></a><span id="l3.111">     var folderTree = GetFolderTree();</span>
<a href="#l3.112"></a><span id="l3.112">     var folderSelection = folderTree.view.selection;</span>
<a href="#l3.113"></a><span id="l3.113"> </span>
<a href="#l3.114"></a><span id="l3.114">     // This prevents a folder from being loaded in the case that the user</span>
<a href="#l3.115"></a><span id="l3.115">     // has right-clicked on a folder different from the one that was</span>
<a href="#l3.116"></a><span id="l3.116">     // originally highlighted.  On a right-click, the highlight (selection)</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineat">@@ -867,17 +839,18 @@ function FolderPaneSelectionChange()</span>
<a href="#l3.118"></a><span id="l3.118">                   dbFolderInfo = null;</span>
<a href="#l3.119"></a><span id="l3.119">                 }</span>
<a href="#l3.120"></a><span id="l3.120">               }</span>
<a href="#l3.121"></a><span id="l3.121">               catch (ex)</span>
<a href="#l3.122"></a><span id="l3.122">               {</span>
<a href="#l3.123"></a><span id="l3.123">                 dump(&quot;failed to get view &amp; sort values.  ex = &quot; + ex +&quot;\n&quot;);</span>
<a href="#l3.124"></a><span id="l3.124">               }</span>
<a href="#l3.125"></a><span id="l3.125">             }</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-            if (gDBView &amp;&amp; gDBView.viewType == nsMsgViewType.eShowQuickSearchResults)</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+            // clear cached view if we have no db or a pending quick search</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+            if (!gDBView || gDBView.viewType == nsMsgViewType.eShowQuickSearchResults)</span>
<a href="#l3.129"></a><span id="l3.129">             {</span>
<a href="#l3.130"></a><span id="l3.130">               if (gPreQuickSearchView) //close cached view before quick search</span>
<a href="#l3.131"></a><span id="l3.131">               {</span>
<a href="#l3.132"></a><span id="l3.132">                 gPreQuickSearchView.close();</span>
<a href="#l3.133"></a><span id="l3.133">                 gPreQuickSearchView = null;  </span>
<a href="#l3.134"></a><span id="l3.134">               }</span>
<a href="#l3.135"></a><span id="l3.135">               var searchInput = document.getElementById(&quot;searchInput&quot;);  //reset the search input on folder switch</span>
<a href="#l3.136"></a><span id="l3.136">               if (searchInput) </span>
<a href="#l3.137"></a><span id="l3.137" class="difflineat">@@ -888,18 +861,22 @@ function FolderPaneSelectionChange()</span>
<a href="#l3.138"></a><span id="l3.138">             if (gXFVirtualFolderTerms)</span>
<a href="#l3.139"></a><span id="l3.139">               viewType = nsMsgViewType.eShowVirtualFolderResults;</span>
<a href="#l3.140"></a><span id="l3.140">             else if (gSearchEmailAddress || gVirtualFolderTerms)</span>
<a href="#l3.141"></a><span id="l3.141">               viewType = nsMsgViewType.eShowQuickSearchResults;</span>
<a href="#l3.142"></a><span id="l3.142">             else if (viewType == nsMsgViewType.eShowQuickSearchResults)</span>
<a href="#l3.143"></a><span id="l3.143">               viewType = nsMsgViewType.eShowAllThreads;  //override viewType - we don't want to start w/ quick search</span>
<a href="#l3.144"></a><span id="l3.144">             ChangeFolder(realFolder, msgFolder, viewType, viewFlags, sortType, sortOrder);</span>
<a href="#l3.145"></a><span id="l3.145">            if (gVirtualFolderTerms)</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-             gDBView.viewFolder = msgFolder;        </span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-    }</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+             gDBView.viewFolder = msgFolder;</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+    let tabmail = GetTabMail();</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+    tabmail.saveCurrentTabState(); // gDBView may have changed!</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+    tabmail.setTabTitle();</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+  }</span>
<a href="#l3.154"></a><span id="l3.154">     else</span>
<a href="#l3.155"></a><span id="l3.155">     {</span>
<a href="#l3.156"></a><span id="l3.156">         msgWindow.openFolder = null;</span>
<a href="#l3.157"></a><span id="l3.157">         ClearThreadPane();</span>
<a href="#l3.158"></a><span id="l3.158">     }</span>
<a href="#l3.159"></a><span id="l3.159"> </span>
<a href="#l3.160"></a><span id="l3.160">     if (gAccountCentralLoaded)</span>
<a href="#l3.161"></a><span id="l3.161">       UpdateMailToolbar(&quot;gAccountCentralLoaded&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/mailnews/jar.mn</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/mailnews/jar.mn</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -19,16 +19,18 @@ messenger.jar:</span>
<a href="#l4.4"></a><span id="l4.4"> % overlay chrome://messenger/content/mailWindowOverlay.xul                     chrome://messenger/content/msgViewPickerOverlay.xul</span>
<a href="#l4.5"></a><span id="l4.5">     content/messenger/msgViewPickerOverlay.xul</span>
<a href="#l4.6"></a><span id="l4.6">     content/messenger/msgViewPickerOverlay.js</span>
<a href="#l4.7"></a><span id="l4.7">     content/messenger/mailViewSetup.js</span>
<a href="#l4.8"></a><span id="l4.8">     content/messenger/mailViewSetup.xul</span>
<a href="#l4.9"></a><span id="l4.9">     content/messenger/mailViewList.xul</span>
<a href="#l4.10"></a><span id="l4.10">     content/messenger/mailViewList.js</span>
<a href="#l4.11"></a><span id="l4.11">     content/messenger/mailWidgets.xml</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+    content/messenger/tabmail.xml</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    content/messenger/tabmail.js</span>
<a href="#l4.14"></a><span id="l4.14">     content/messenger/messenger.css</span>
<a href="#l4.15"></a><span id="l4.15">     content/messenger/messenger.xul</span>
<a href="#l4.16"></a><span id="l4.16">     content/messenger/mailWindowOverlay.xul</span>
<a href="#l4.17"></a><span id="l4.17">     content/messenger/mailWindowOverlay.js</span>
<a href="#l4.18"></a><span id="l4.18">     content/messenger/msgSelectOffline.xul</span>
<a href="#l4.19"></a><span id="l4.19">     content/messenger/mailWindow.js</span>
<a href="#l4.20"></a><span id="l4.20">     content/messenger/messageWindow.xul</span>
<a href="#l4.21"></a><span id="l4.21">     content/messenger/messageWindow.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.8"></a><span id="l5.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.9"></a><span id="l5.9">  *</span>
<a href="#l5.10"></a><span id="l5.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.11"></a><span id="l5.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.12"></a><span id="l5.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l5.13"></a><span id="l5.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l5.14"></a><span id="l5.14">  *</span>
<a href="#l5.15"></a><span id="l5.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineat">@@ -457,27 +457,28 @@ var DefaultController =</span>
<a href="#l5.17"></a><span id="l5.17">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l5.18"></a><span id="l5.18">         return IsAccountOfflineEnabled();</span>
<a href="#l5.19"></a><span id="l5.19">       default:</span>
<a href="#l5.20"></a><span id="l5.20">         return false;</span>
<a href="#l5.21"></a><span id="l5.21">     }</span>
<a href="#l5.22"></a><span id="l5.22">     return false;</span>
<a href="#l5.23"></a><span id="l5.23">   },</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-	doCommand: function(command)</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-	{</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+  doCommand: function(command)</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+  {</span>
<a href="#l5.29"></a><span id="l5.29">     // if the user invoked a key short cut then it is possible that we got here for a command which is</span>
<a href="#l5.30"></a><span id="l5.30">     // really disabled. kick out if the command should be disabled.</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    if (!this.isCommandEnabled(command)) return;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-   </span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-		switch ( command )</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-		{</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-			case &quot;cmd_close&quot;:</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-				CloseMailWindow();</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-				break;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+    if (!this.isCommandEnabled(command))</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+      return;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+    switch (command)</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+    {</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+      case &quot;cmd_close&quot;:</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+        MsgCloseCurrentTab();</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+        break;</span>
<a href="#l5.46"></a><span id="l5.46">       case &quot;button_getNewMessages&quot;:</span>
<a href="#l5.47"></a><span id="l5.47"> 			case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l5.48"></a><span id="l5.48"> 				MsgGetMessage();</span>
<a href="#l5.49"></a><span id="l5.49"> 				break;</span>
<a href="#l5.50"></a><span id="l5.50">       case &quot;cmd_getMsgsForAuthAccounts&quot;:</span>
<a href="#l5.51"></a><span id="l5.51">         MsgGetMessagesForAllAuthenticatedAccounts();</span>
<a href="#l5.52"></a><span id="l5.52">         break;</span>
<a href="#l5.53"></a><span id="l5.53"> 			case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineat">@@ -806,25 +807,21 @@ function WhichPaneHasFocus()</span>
<a href="#l5.55"></a><span id="l5.55"> }</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57"> function SetupCommandUpdateHandlers()</span>
<a href="#l5.58"></a><span id="l5.58"> {</span>
<a href="#l5.59"></a><span id="l5.59">   // folder pane</span>
<a href="#l5.60"></a><span id="l5.60">   var widget = GetFolderTree();</span>
<a href="#l5.61"></a><span id="l5.61">   if (widget)</span>
<a href="#l5.62"></a><span id="l5.62">     widget.controllers.appendController(FolderPaneController);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-  top.controllers.insertControllerAt(0, DefaultController);</span>
<a href="#l5.65"></a><span id="l5.65"> }</span>
<a href="#l5.66"></a><span id="l5.66"> </span>
<a href="#l5.67"></a><span id="l5.67"> // Called from &lt;msgMail3PaneWindow.js&gt;.</span>
<a href="#l5.68"></a><span id="l5.68"> function UnloadCommandUpdateHandlers()</span>
<a href="#l5.69"></a><span id="l5.69"> {</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-  top.controllers.removeController(DefaultController);</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-</span>
<a href="#l5.72"></a><span id="l5.72">   var widget = GetFolderTree();</span>
<a href="#l5.73"></a><span id="l5.73">   if (widget)</span>
<a href="#l5.74"></a><span id="l5.74">     widget.controllers.removeController(FolderPaneController);</span>
<a href="#l5.75"></a><span id="l5.75"> }</span>
<a href="#l5.76"></a><span id="l5.76"> </span>
<a href="#l5.77"></a><span id="l5.77"> function IsSendUnsentMsgsEnabled(folderResource)</span>
<a href="#l5.78"></a><span id="l5.78"> {</span>
<a href="#l5.79"></a><span id="l5.79">   var msgSendLater =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/mailnews/mailContextMenus.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/mailnews/mailContextMenus.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineminus">-/* -*- Mode: C; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.6"></a><span id="l6.6"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.7"></a><span id="l6.7">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.8"></a><span id="l6.8">  *</span>
<a href="#l6.9"></a><span id="l6.9">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.10"></a><span id="l6.10">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.11"></a><span id="l6.11">  * the License. You may obtain a copy of the License at</span>
<a href="#l6.12"></a><span id="l6.12">  * http://www.mozilla.org/MPL/</span>
<a href="#l6.13"></a><span id="l6.13">  *</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineat">@@ -138,17 +138,17 @@ function FillMailContextMenu(aTarget)</span>
<a href="#l6.15"></a><span id="l6.15">   var showMailItems = inThreadPane ||</span>
<a href="#l6.16"></a><span id="l6.16">                       (!gContextMenu.onImage &amp;&amp; !gContextMenu.onLink);</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">   // Select-all and copy are only available in the message-pane</span>
<a href="#l6.19"></a><span id="l6.19">   ShowMenuItem(&quot;context-selectall&quot;, single &amp;&amp; !inThreadPane);</span>
<a href="#l6.20"></a><span id="l6.20">   ShowMenuItem(&quot;context-copy&quot;, !inThreadPane);</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">   ShowMenuItem(&quot;mailContext-openNewWindow&quot;, inThreadPane &amp;&amp; single);</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-  ShowMenuItem(&quot;mailContext-openNewTab&quot;, inThreadPane);</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+  ShowMenuItem(&quot;mailContext-openNewTab&quot;,    inThreadPane &amp;&amp; single);</span>
<a href="#l6.25"></a><span id="l6.25">   ShowMenuItem(&quot;mailContext-downloadflagged&quot;,</span>
<a href="#l6.26"></a><span id="l6.26">                inThreadPane || (numSelected &gt; 1));</span>
<a href="#l6.27"></a><span id="l6.27">   ShowMenuItem(&quot;mailContext-downloadselected&quot;,</span>
<a href="#l6.28"></a><span id="l6.28">                inThreadPane || (numSelected &gt; 1));</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   ShowMenuItem(&quot;mailContext-editAsNew&quot;, showMailItems &amp;&amp; oneOrMore);</span>
<a href="#l6.31"></a><span id="l6.31">   ShowMenuItem(&quot;mailContext-replySender&quot;, showMailItems &amp;&amp; single);</span>
<a href="#l6.32"></a><span id="l6.32">   ShowMenuItem(&quot;mailContext-replyNewsgroup&quot;,</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineat">@@ -258,19 +258,22 @@ function FillFolderPaneContextMenu()</span>
<a href="#l6.34"></a><span id="l6.34">                        gMessengerBundle.getString(&quot;getMessagesFor&quot;));</span>
<a href="#l6.35"></a><span id="l6.35">     else</span>
<a href="#l6.36"></a><span id="l6.36">       SetMenuItemLabel(&quot;folderPaneContext-getMessages&quot;,</span>
<a href="#l6.37"></a><span id="l6.37">                        gMessengerBundle.getString(&quot;getMessages&quot;));</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39">   ShowMenuItem(&quot;folderPaneContext-getMessages&quot;, (numSelected &lt;= 1) &amp;&amp; canGetMessages);</span>
<a href="#l6.40"></a><span id="l6.40">   EnableMenuItem(&quot;folderPaneContext-getMessages&quot;, true);</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-  ShowMenuItem(&quot;folderPaneContext-openNewWindow&quot;, (numSelected &lt;= 1) &amp;&amp; !isServer);</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+  ShowMenuItem(&quot;folderPaneContext-openNewWindow&quot;, (numSelected &lt;= 1));</span>
<a href="#l6.44"></a><span id="l6.44">   EnableMenuItem(&quot;folderPaneContext-openNewWindow&quot;, true);</span>
<a href="#l6.45"></a><span id="l6.45"> </span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+  ShowMenuItem(&quot;folderPaneContext-openNewTab&quot;, (numSelected &lt;= 1));</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+  EnableMenuItem(&quot;folderPaneContext-openNewTab&quot;, true);</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+</span>
<a href="#l6.49"></a><span id="l6.49">   SetupRenameMenuItem(folder, numSelected, isServer, serverType, specialFolder);</span>
<a href="#l6.50"></a><span id="l6.50">   SetupRemoveMenuItem(folder, numSelected, isServer, serverType, specialFolder);</span>
<a href="#l6.51"></a><span id="l6.51">   SetupCompactMenuItem(folder, numSelected);</span>
<a href="#l6.52"></a><span id="l6.52"> </span>
<a href="#l6.53"></a><span id="l6.53">   ShowMenuItem(&quot;folderPaneContext-emptyTrash&quot;, (numSelected &lt;= 1) &amp;&amp; (specialFolder == 'Trash'));</span>
<a href="#l6.54"></a><span id="l6.54">   EnableMenuItem(&quot;folderPaneContext-emptyTrash&quot;, true);</span>
<a href="#l6.55"></a><span id="l6.55">   ShowMenuItem(&quot;folderPaneContext-emptyJunk&quot;, (numSelected &lt;= 1) &amp;&amp; (specialFolder == 'Junk'));</span>
<a href="#l6.56"></a><span id="l6.56">   EnableMenuItem(&quot;folderPaneContext-emptyJunk&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/mailWindow.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/mailWindow.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineminus">-/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l7.8"></a><span id="l7.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l7.9"></a><span id="l7.9">  *</span>
<a href="#l7.10"></a><span id="l7.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l7.11"></a><span id="l7.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l7.12"></a><span id="l7.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l7.13"></a><span id="l7.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l7.14"></a><span id="l7.14">  *</span>
<a href="#l7.15"></a><span id="l7.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineat">@@ -39,21 +39,19 @@</span>
<a href="#l7.17"></a><span id="l7.17">  *</span>
<a href="#l7.18"></a><span id="l7.18">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">  //This file stores variables common to mail windows</span>
<a href="#l7.21"></a><span id="l7.21"> var messengerContractID        = &quot;@mozilla.org/messenger;1&quot;;</span>
<a href="#l7.22"></a><span id="l7.22"> var statusFeedbackContractID   = &quot;@mozilla.org/messenger/statusfeedback;1&quot;;</span>
<a href="#l7.23"></a><span id="l7.23"> var mailSessionContractID      = &quot;@mozilla.org/messenger/services/session;1&quot;;</span>
<a href="#l7.24"></a><span id="l7.24"> var secureUIContractID         = &quot;@mozilla.org/secure_browser_ui;1&quot;;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-var prefContractID             = &quot;@mozilla.org/preferences-service;1&quot;;</span>
<a href="#l7.26"></a><span id="l7.26"> var msgWindowContractID      = &quot;@mozilla.org/messenger/msgwindow;1&quot;;</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> var messenger;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-var pref;</span>
<a href="#l7.30"></a><span id="l7.30"> var statusFeedback;</span>
<a href="#l7.31"></a><span id="l7.31"> var msgWindow;</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33"> var msgComposeService;</span>
<a href="#l7.34"></a><span id="l7.34"> var accountManager;</span>
<a href="#l7.35"></a><span id="l7.35"> var RDF;</span>
<a href="#l7.36"></a><span id="l7.36"> var msgComposeType;</span>
<a href="#l7.37"></a><span id="l7.37"> var msgComposeFormat;</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineat">@@ -94,45 +92,36 @@ function OnMailWindowUnload()</span>
<a href="#l7.39"></a><span id="l7.39">   }</span>
<a href="#l7.40"></a><span id="l7.40">   </span>
<a href="#l7.41"></a><span id="l7.41">   var dbview = GetDBView();</span>
<a href="#l7.42"></a><span id="l7.42">   if (dbview) {</span>
<a href="#l7.43"></a><span id="l7.43">     dbview.close(); </span>
<a href="#l7.44"></a><span id="l7.44">   }</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">   var mailSession = Components.classes[mailSessionContractID].getService();</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-  if(mailSession)</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-  {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-    mailSession = mailSession.QueryInterface(Components.interfaces.nsIMsgMailSession);</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-    if(mailSession)</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-    {</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-      mailSession.RemoveFolderListener(folderListener);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-    }</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-  }</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+  if (mailSession instanceof Components.interfaces.nsIMsgMailSession)</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+    mailSession.RemoveFolderListener(folderListener);</span>
<a href="#l7.58"></a><span id="l7.58">   mailSession.RemoveMsgWindow(msgWindow);</span>
<a href="#l7.59"></a><span id="l7.59">   messenger.setWindow(null, null);</span>
<a href="#l7.60"></a><span id="l7.60"> </span>
<a href="#l7.61"></a><span id="l7.61">   msgWindow.closeWindow();</span>
<a href="#l7.62"></a><span id="l7.62"> }</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64"> function CreateMessenger()</span>
<a href="#l7.65"></a><span id="l7.65"> {</span>
<a href="#l7.66"></a><span id="l7.66">   messenger = Components.classes[messengerContractID].createInstance();</span>
<a href="#l7.67"></a><span id="l7.67">   messenger = messenger.QueryInterface(Components.interfaces.nsIMessenger);</span>
<a href="#l7.68"></a><span id="l7.68"> }</span>
<a href="#l7.69"></a><span id="l7.69"> </span>
<a href="#l7.70"></a><span id="l7.70"> function CreateMailWindowGlobals()</span>
<a href="#l7.71"></a><span id="l7.71"> {</span>
<a href="#l7.72"></a><span id="l7.72">   // get the messenger instance</span>
<a href="#l7.73"></a><span id="l7.73">   CreateMessenger();</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-  pref = Components.classes[prefContractID]</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-                   .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  // force pref service initialization</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+  GetPrefService();</span>
<a href="#l7.80"></a><span id="l7.80">   //Create windows status feedback</span>
<a href="#l7.81"></a><span id="l7.81">   // set the JS implementation of status feedback before creating the c++ one..</span>
<a href="#l7.82"></a><span id="l7.82">   window.MsgStatusFeedback = new nsMsgStatusFeedback();</span>
<a href="#l7.83"></a><span id="l7.83">   // double register the status feedback object as the xul browser window implementation</span>
<a href="#l7.84"></a><span id="l7.84">   window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l7.85"></a><span id="l7.85">         .getInterface(Components.interfaces.nsIWebNavigation)</span>
<a href="#l7.86"></a><span id="l7.86">         .QueryInterface(Components.interfaces.nsIDocShellTreeItem).treeOwner</span>
<a href="#l7.87"></a><span id="l7.87">         .QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineat">@@ -199,28 +188,28 @@ function InitMsgWindow()</span>
<a href="#l7.89"></a><span id="l7.89"> {</span>
<a href="#l7.90"></a><span id="l7.90">   msgWindow.windowCommands = new nsMsgWindowCommands();</span>
<a href="#l7.91"></a><span id="l7.91">   // set the domWindow before setting the status feedback and header sink objects</span>
<a href="#l7.92"></a><span id="l7.92">   msgWindow.domWindow = window;  </span>
<a href="#l7.93"></a><span id="l7.93">   msgWindow.statusFeedback = statusFeedback;</span>
<a href="#l7.94"></a><span id="l7.94">   msgWindow.msgHeaderSink = messageHeaderSink;</span>
<a href="#l7.95"></a><span id="l7.95">   mailSession.AddMsgWindow(msgWindow);</span>
<a href="#l7.96"></a><span id="l7.96"> </span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-  var messagepane = document.getElementById(&quot;messagepane&quot;);</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineplus">+  var messagepane = getMessageBrowser();</span>
<a href="#l7.99"></a><span id="l7.99">   messagepane.docShell.allowAuth = false;</span>
<a href="#l7.100"></a><span id="l7.100">   msgWindow.rootDocShell.allowAuth = true;</span>
<a href="#l7.101"></a><span id="l7.101">   msgWindow.rootDocShell.appType = Components.interfaces.nsIDocShell.APP_TYPE_MAIL;</span>
<a href="#l7.102"></a><span id="l7.102">   // Ensure we don't load xul error pages into the main window</span>
<a href="#l7.103"></a><span id="l7.103">   msgWindow.rootDocShell.useErrorPages = false;</span>
<a href="#l7.104"></a><span id="l7.104"> }</span>
<a href="#l7.105"></a><span id="l7.105"> </span>
<a href="#l7.106"></a><span id="l7.106"> function messagePaneOnResize(event)</span>
<a href="#l7.107"></a><span id="l7.107"> {</span>
<a href="#l7.108"></a><span id="l7.108">   // scale any overflowing images</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-  var messagepane = document.getElementById(&quot;messagepane&quot;);</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+  var messagepane = getMessageBrowser();</span>
<a href="#l7.111"></a><span id="l7.111">   var doc = messagepane.contentDocument;</span>
<a href="#l7.112"></a><span id="l7.112">   var imgs = doc.images;</span>
<a href="#l7.113"></a><span id="l7.113">   for each (var img in imgs)</span>
<a href="#l7.114"></a><span id="l7.114">   {</span>
<a href="#l7.115"></a><span id="l7.115">     if (img.className == &quot;moz-attached-image&quot;)</span>
<a href="#l7.116"></a><span id="l7.116">     {</span>
<a href="#l7.117"></a><span id="l7.117">       if (img.naturalWidth &lt;= doc.width)</span>
<a href="#l7.118"></a><span id="l7.118">       {</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineat">@@ -572,97 +561,16 @@ function loadStartPage()</span>
<a href="#l7.120"></a><span id="l7.120">   }</span>
<a href="#l7.121"></a><span id="l7.121">   catch (ex)</span>
<a href="#l7.122"></a><span id="l7.122">   {</span>
<a href="#l7.123"></a><span id="l7.123">     dump(&quot;Error loading start page.\n&quot;);</span>
<a href="#l7.124"></a><span id="l7.124">     return;</span>
<a href="#l7.125"></a><span id="l7.125">   }</span>
<a href="#l7.126"></a><span id="l7.126"> }</span>
<a href="#l7.127"></a><span id="l7.127"> </span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-// When the ThreadPane is hidden via the displayDeck, we should collapse the</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineminus">-// elements that are only meaningful to the thread pane. When AccountCentral is</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineminus">-// shown via the displayDeck, we need to switch the displayDeck to show the</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineminus">-// accountCentralBox, and load the iframe in the AccountCentral box with</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-// corresponding page.</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-function ShowAccountCentral()</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineminus">-{</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineminus">-    try</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineminus">-    {</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-        document.getElementById(&quot;displayDeck&quot;).selectedPanel = accountCentralBox;</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineminus">-        var acctCentralPage = pref.getComplexValue(&quot;mailnews.account_central_page.url&quot;,</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineminus">-                                                   Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-        window.frames[&quot;accountCentralPane&quot;].location.href = acctCentralPage;</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineminus">-    }</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineminus">-    catch (ex)</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineminus">-    {</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineminus">-        dump(&quot;Error loading AccountCentral page -&gt; &quot; + ex + &quot;\n&quot;);</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineminus">-        return;</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineminus">-    }</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-}</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineminus">-</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineminus">-function ShowingAccountCentral()</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineminus">-{</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineminus">-    if (!IsFolderPaneCollapsed())</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineminus">-        GetFolderTree().focus();</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineminus">-    gAccountCentralLoaded = true;</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineminus">-}</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineminus">-</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineminus">-function HidingAccountCentral()</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineminus">-{</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineminus">-    gAccountCentralLoaded = false;</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-}</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineminus">-</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-function ShowThreadPane()</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineminus">-{</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineminus">-    document.getElementById(&quot;displayDeck&quot;).selectedPanel =</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineminus">-        document.getElementById(&quot;threadPaneBox&quot;);</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">-}</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">-</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineminus">-function ShowingThreadPane()</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">-{</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineminus">-    gSearchBox.collapsed = false;</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineminus">-    var threadPaneSplitter = document.getElementById(&quot;threadpane-splitter&quot;);</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">-    threadPaneSplitter.collapsed = false;</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineminus">-    if (!threadPaneSplitter.hidden &amp;&amp; threadPaneSplitter.getAttribute(&quot;state&quot;) != &quot;collapsed&quot;)</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineminus">-    {</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineminus">-        GetMessagePane().collapsed = false;</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineminus">-        // XXX We need to force the tree to refresh its new height</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineminus">-        // so that it will correctly scroll to the newest message</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineminus">-        GetThreadTree().boxObject.height;</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineminus">-    }</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineminus">-    document.getElementById(&quot;key_toggleMessagePane&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineminus">-}</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineminus">-</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineminus">-function HidingThreadPane()</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-{</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineminus">-    ClearThreadPane();</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineminus">-    GetUnreadCountElement().hidden = true;</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineminus">-    GetTotalCountElement().hidden = true;</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineminus">-    GetMessagePane().collapsed = true;</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineminus">-    document.getElementById(&quot;threadpane-splitter&quot;).collapsed = true;</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineminus">-    gSearchBox.collapsed = true;</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineminus">-    document.getElementById(&quot;key_toggleMessagePane&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineminus">-}</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineminus">-</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineminus">-function ObserveDisplayDeckChange(event)</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineminus">-{</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineminus">-    var selectedPanel = document.getElementById(&quot;displayDeck&quot;).selectedPanel;</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineminus">-    var nowSelected = selectedPanel ? selectedPanel.id : &quot;&quot;;</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineminus">-</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineminus">-    if (nowSelected == &quot;threadPaneBox&quot;)</span>
<a href="#l7.199"></a><span id="l7.199" class="difflineminus">-        ShowingThreadPane();</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineminus">-    else</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineminus">-        HidingThreadPane();</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineminus">-    </span>
<a href="#l7.203"></a><span id="l7.203" class="difflineminus">-    if (nowSelected == &quot;accountCentralBox&quot;)</span>
<a href="#l7.204"></a><span id="l7.204" class="difflineminus">-        ShowingAccountCentral();</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineminus">-    else</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineminus">-        HidingAccountCentral();</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineminus">-}</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineminus">-</span>
<a href="#l7.209"></a><span id="l7.209"> // Given the server, open the twisty and the set the selection</span>
<a href="#l7.210"></a><span id="l7.210"> // on inbox of that server. </span>
<a href="#l7.211"></a><span id="l7.211"> // prompt if offline.</span>
<a href="#l7.212"></a><span id="l7.212"> function OpenInboxForServer(server)</span>
<a href="#l7.213"></a><span id="l7.213"> {</span>
<a href="#l7.214"></a><span id="l7.214">     try {</span>
<a href="#l7.215"></a><span id="l7.215">         ShowThreadPane();</span>
<a href="#l7.216"></a><span id="l7.216">         var inboxFolder = GetInboxFolder(server);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineminus">-/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.8"></a><span id="l8.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.9"></a><span id="l8.9">  *</span>
<a href="#l8.10"></a><span id="l8.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.11"></a><span id="l8.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.12"></a><span id="l8.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l8.13"></a><span id="l8.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l8.14"></a><span id="l8.14">  *</span>
<a href="#l8.15"></a><span id="l8.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineat">@@ -41,24 +41,26 @@</span>
<a href="#l8.17"></a><span id="l8.17">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.18"></a><span id="l8.18">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.19"></a><span id="l8.19">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.20"></a><span id="l8.20">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.21"></a><span id="l8.21">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.22"></a><span id="l8.22">  *</span>
<a href="#l8.23"></a><span id="l8.23">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-// Flags from nsMsgMessageFlags.h</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-const MDN_DISPOSE_TYPE_DISPLAYED = 0;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-const MSG_DB_LARGE_COMMIT        = 1;</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-const kClassicMailLayout = 0;</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-const kWideMailLayout = 1;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/folderUtils.jsm&quot;);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+const kClassicMailLayout  = 0;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+const kWideMailLayout     = 1;</span>
<a href="#l8.35"></a><span id="l8.35"> const kVerticalMailLayout = 2;</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+const kMouseButtonLeft   = 0;</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+const kMouseButtonMiddle = 1;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+const kMouseButtonRight  = 2;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+</span>
<a href="#l8.41"></a><span id="l8.41"> // Per message header flags to keep track of whether the user is allowing remote</span>
<a href="#l8.42"></a><span id="l8.42"> // content for a particular message.</span>
<a href="#l8.43"></a><span id="l8.43"> // if you change or add more values to these constants, be sure to modify</span>
<a href="#l8.44"></a><span id="l8.44"> // the corresponding definitions in nsMsgContentPolicy.cpp</span>
<a href="#l8.45"></a><span id="l8.45"> const kNoRemoteContentPolicy = 0;</span>
<a href="#l8.46"></a><span id="l8.46"> const kBlockRemoteContent = 1;</span>
<a href="#l8.47"></a><span id="l8.47"> const kAllowRemoteContent = 2;</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49" class="difflineat">@@ -157,50 +159,59 @@ function InitEditMessagesMenu()</span>
<a href="#l8.50"></a><span id="l8.50"> {</span>
<a href="#l8.51"></a><span id="l8.51">   goSetMenuValue('cmd_delete', 'valueDefault');</span>
<a href="#l8.52"></a><span id="l8.52">   goSetAccessKey('cmd_delete', 'valueDefaultAccessKey');</span>
<a href="#l8.53"></a><span id="l8.53">   document.commandDispatcher.updateCommands('create-menu-edit');</span>
<a href="#l8.54"></a><span id="l8.54"> }</span>
<a href="#l8.55"></a><span id="l8.55"> </span>
<a href="#l8.56"></a><span id="l8.56"> function InitGoMessagesMenu()</span>
<a href="#l8.57"></a><span id="l8.57"> {</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+  // deactivate the folders in the go menu if we don't have a folderpane</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+  document.getElementById(&quot;mailFolderPane&quot;)</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+          .setAttribute(&quot;disabled&quot;, IsFolderPaneCollapsed());</span>
<a href="#l8.61"></a><span id="l8.61">   document.commandDispatcher.updateCommands('create-menu-go');</span>
<a href="#l8.62"></a><span id="l8.62"> }</span>
<a href="#l8.63"></a><span id="l8.63"> </span>
<a href="#l8.64"></a><span id="l8.64"> function view_init()</span>
<a href="#l8.65"></a><span id="l8.65"> {</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-  var isFeed = IsFeedItem();</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-</span>
<a href="#l8.68"></a><span id="l8.68">   if (!gMessengerBundle)</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-      gMessengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  var message_menuitem = document.getElementById('menu_showMessagePane');</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-  if (message_menuitem &amp;&amp; !message_menuitem.hidden) {</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-      message_menuitem.setAttribute('checked', !IsMessagePaneCollapsed());</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-      message_menuitem.setAttribute('disabled', gAccountCentralLoaded);</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+    gMessengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+  var message_menuitem = document.getElementById(&quot;menu_showMessagePane&quot;);</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+  if (message_menuitem &amp;&amp; !message_menuitem.hidden)</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+  {</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+    message_menuitem.setAttribute(&quot;checked&quot;, !IsMessagePaneCollapsed());</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+    message_menuitem.setAttribute(&quot;disabled&quot;, gAccountCentralLoaded);</span>
<a href="#l8.82"></a><span id="l8.82">   }</span>
<a href="#l8.83"></a><span id="l8.83"> </span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-  var folderPane_menuitem = document.getElementById('menu_showFolderPane');</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+  var threadpane_menuitem = document.getElementById(&quot;menu_showThreadPane&quot;);</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+  if (threadpane_menuitem &amp;&amp; !threadpane_menuitem.hidden)</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+  {</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+    threadpane_menuitem.setAttribute(&quot;checked&quot;, !IsDisplayDeckCollapsed());</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+    threadpane_menuitem.setAttribute(&quot;disabled&quot;, gAccountCentralLoaded);</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+  }</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+  var folderPane_menuitem = document.getElementById(&quot;menu_showFolderPane&quot;);</span>
<a href="#l8.93"></a><span id="l8.93">   if (folderPane_menuitem &amp;&amp; !folderPane_menuitem.hidden)</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-    folderPane_menuitem.setAttribute('checked', !IsFolderPaneCollapsed());</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-  var sort_menuitem = document.getElementById('viewSortMenu');</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-  if (sort_menuitem) {</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+    folderPane_menuitem.setAttribute(&quot;checked&quot;, !IsFolderPaneCollapsed());</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+  var sort_menuitem = document.getElementById(&quot;viewSortMenu&quot;);</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+  if (sort_menuitem)</span>
<a href="#l8.102"></a><span id="l8.102">     sort_menuitem.setAttribute(&quot;disabled&quot;, gAccountCentralLoaded);</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-  }</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-  var view_menuitem = document.getElementById('viewMessageViewMenu');</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-  if (view_menuitem) {</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+  var view_menuitem = document.getElementById(&quot;viewMessageViewMenu&quot;);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+  if (view_menuitem)</span>
<a href="#l8.109"></a><span id="l8.109">     view_menuitem.setAttribute(&quot;disabled&quot;, gAccountCentralLoaded);</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-  }</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-  var threads_menuitem = document.getElementById('viewMessagesMenu');</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-  if (threads_menuitem) {</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+  var threads_menuitem = document.getElementById(&quot;viewMessagesMenu&quot;);</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+  if (threads_menuitem)</span>
<a href="#l8.116"></a><span id="l8.116">     threads_menuitem.setAttribute(&quot;disabled&quot;, gAccountCentralLoaded);</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-  }</span>
<a href="#l8.118"></a><span id="l8.118"> </span>
<a href="#l8.119"></a><span id="l8.119">   // Initialize the Message Body menuitem</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+  var isFeed = IsFeedItem();</span>
<a href="#l8.121"></a><span id="l8.121">   document.getElementById('viewBodyMenu').hidden = isFeed;</span>
<a href="#l8.122"></a><span id="l8.122"> </span>
<a href="#l8.123"></a><span id="l8.123">   // Initialize the Show Feed Summary menu</span>
<a href="#l8.124"></a><span id="l8.124">   var viewFeedSummary = document.getElementById('viewFeedSummary');</span>
<a href="#l8.125"></a><span id="l8.125">   var winType = document.documentElement.getAttribute('windowtype');</span>
<a href="#l8.126"></a><span id="l8.126">   if (winType != &quot;mail:3pane&quot;)</span>
<a href="#l8.127"></a><span id="l8.127">     viewFeedSummary.hidden = !gShowFeedSummary;</span>
<a href="#l8.128"></a><span id="l8.128">   else</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineat">@@ -804,17 +815,17 @@ function PopulateHistoryMenu(menuPopup, </span>
<a href="#l8.130"></a><span id="l8.130"> </span>
<a href="#l8.131"></a><span id="l8.131"> function NavigateToUri(target)</span>
<a href="#l8.132"></a><span id="l8.132"> {</span>
<a href="#l8.133"></a><span id="l8.133">   var historyIndex = target.getAttribute('value');</span>
<a href="#l8.134"></a><span id="l8.134">   let folderUri = target.folder.URI;</span>
<a href="#l8.135"></a><span id="l8.135">   var msgUri = messenger.getMsgUriAtNavigatePos(historyIndex);</span>
<a href="#l8.136"></a><span id="l8.136">   let msgHdrKey = messenger.msgHdrFromURI(msgUri).messageKey;</span>
<a href="#l8.137"></a><span id="l8.137">   messenger.navigatePos += Number(historyIndex);</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-  if (folderURI == GetThreadPaneFolder().URI)</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineplus">+  if (folderUri == GetThreadPaneFolder().URI)</span>
<a href="#l8.140"></a><span id="l8.140">   {</span>
<a href="#l8.141"></a><span id="l8.141">     gDBView.selectMsgByKey(msgHdrKey);</span>
<a href="#l8.142"></a><span id="l8.142">   }</span>
<a href="#l8.143"></a><span id="l8.143">   else</span>
<a href="#l8.144"></a><span id="l8.144">   {</span>
<a href="#l8.145"></a><span id="l8.145">     gStartMsgKey = msgHdrKey;</span>
<a href="#l8.146"></a><span id="l8.146">     SelectFolder(folderUri);</span>
<a href="#l8.147"></a><span id="l8.147">   }</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineat">@@ -1594,28 +1605,26 @@ function MsgOpenNewWindowForFolder(uri, </span>
<a href="#l8.149"></a><span id="l8.149">   if (uriToOpen) {</span>
<a href="#l8.150"></a><span id="l8.150">    // get the messenger window open service and ask it to open a new window for us</span>
<a href="#l8.151"></a><span id="l8.151">    var mailWindowService = Components.classes[&quot;@mozilla.org/messenger/windowservice;1&quot;].getService(Components.interfaces.nsIMessengerWindowService);</span>
<a href="#l8.152"></a><span id="l8.152">    if (mailWindowService)</span>
<a href="#l8.153"></a><span id="l8.153">      mailWindowService.openMessengerWindowWithUri(&quot;mail:3pane&quot;, uriToOpen, keyToSelect);</span>
<a href="#l8.154"></a><span id="l8.154">   }</span>
<a href="#l8.155"></a><span id="l8.155"> }</span>
<a href="#l8.156"></a><span id="l8.156"> </span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-// passing in the view, so this will work for search and the thread pane</span>
<a href="#l8.158"></a><span id="l8.158"> function MsgOpenSelectedMessages()</span>
<a href="#l8.159"></a><span id="l8.159"> {</span>
<a href="#l8.160"></a><span id="l8.160">   // Toggle message body (rss summary) and content-base url in message</span>
<a href="#l8.161"></a><span id="l8.161">   // pane per pref, otherwise open summary or web page in new window.</span>
<a href="#l8.162"></a><span id="l8.162">   if (IsFeedItem() &amp;&amp; GetFeedOpenHandler() == 2) {</span>
<a href="#l8.163"></a><span id="l8.163">     FeedSetContentViewToggle();</span>
<a href="#l8.164"></a><span id="l8.164">     return;</span>
<a href="#l8.165"></a><span id="l8.165">   }</span>
<a href="#l8.166"></a><span id="l8.166"> </span>
<a href="#l8.167"></a><span id="l8.167">   var dbView = GetDBView();</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineminus">-</span>
<a href="#l8.169"></a><span id="l8.169">   var indices = GetSelectedIndices(dbView);</span>
<a href="#l8.170"></a><span id="l8.170">   var numMessages = indices.length;</span>
<a href="#l8.171"></a><span id="l8.171"> </span>
<a href="#l8.172"></a><span id="l8.172">   gWindowReuse = gPrefBranch.getBoolPref(&quot;mailnews.reuse_message_window&quot;);</span>
<a href="#l8.173"></a><span id="l8.173">   // This is a radio type button pref, currently with only 2 buttons.</span>
<a href="#l8.174"></a><span id="l8.174">   // We need to keep the pref type as 'bool' for backwards compatibility</span>
<a href="#l8.175"></a><span id="l8.175">   // with 4.x migrated prefs.  For future radio button(s), please use another</span>
<a href="#l8.176"></a><span id="l8.176">   // pref (either 'bool' or 'int' type) to describe it.</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineat">@@ -2167,17 +2176,16 @@ function SetUpToolbarButtons(uri)</span>
<a href="#l8.178"></a><span id="l8.178"> }</span>
<a href="#l8.179"></a><span id="l8.179"> </span>
<a href="#l8.180"></a><span id="l8.180"> var gMessageBrowser;</span>
<a href="#l8.181"></a><span id="l8.181"> </span>
<a href="#l8.182"></a><span id="l8.182"> function getMessageBrowser()</span>
<a href="#l8.183"></a><span id="l8.183"> {</span>
<a href="#l8.184"></a><span id="l8.184">   if (!gMessageBrowser)</span>
<a href="#l8.185"></a><span id="l8.185">     gMessageBrowser = document.getElementById(&quot;messagepane&quot;);</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineminus">-</span>
<a href="#l8.187"></a><span id="l8.187">   return gMessageBrowser;</span>
<a href="#l8.188"></a><span id="l8.188"> }</span>
<a href="#l8.189"></a><span id="l8.189"> </span>
<a href="#l8.190"></a><span id="l8.190"> function getMarkupDocumentViewer()</span>
<a href="#l8.191"></a><span id="l8.191"> {</span>
<a href="#l8.192"></a><span id="l8.192">   return getMessageBrowser().markupDocumentViewer;</span>
<a href="#l8.193"></a><span id="l8.193"> }</span>
<a href="#l8.194"></a><span id="l8.194"> </span>
<a href="#l8.195"></a><span id="l8.195" class="difflineat">@@ -2723,16 +2731,22 @@ function ClearPendingReadTimer()</span>
<a href="#l8.196"></a><span id="l8.196"> function OnMsgParsed(aUrl)</span>
<a href="#l8.197"></a><span id="l8.197"> {</span>
<a href="#l8.198"></a><span id="l8.198">   // If rss feed (has 'content-base' header), show summary or load web</span>
<a href="#l8.199"></a><span id="l8.199">   // page per pref; earliest we have content DOM is here (onMsgParsed).</span>
<a href="#l8.200"></a><span id="l8.200">   FeedSetContentView();</span>
<a href="#l8.201"></a><span id="l8.201"> </span>
<a href="#l8.202"></a><span id="l8.202">   gMessageNotificationBar.setPhishingMsg(aUrl);</span>
<a href="#l8.203"></a><span id="l8.203"> </span>
<a href="#l8.204"></a><span id="l8.204" class="difflineplus">+  // notify anyone (e.g., extensions) who's interested in when a message is loaded.</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineplus">+  var msgURI = GetLoadedMessage();</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineplus">+  var observerService = Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineplus">+                                  .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineplus">+  observerService.notifyObservers(msgWindow.msgHeaderSink, &quot;MsgMsgDisplayed&quot;, msgURI);</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+</span>
<a href="#l8.210"></a><span id="l8.210">   // scale any overflowing images</span>
<a href="#l8.211"></a><span id="l8.211">   var doc = getMessageBrowser().contentDocument;</span>
<a href="#l8.212"></a><span id="l8.212">   var imgs = doc.getElementsByTagName(&quot;img&quot;);</span>
<a href="#l8.213"></a><span id="l8.213">   for each (var img in imgs)</span>
<a href="#l8.214"></a><span id="l8.214">   {</span>
<a href="#l8.215"></a><span id="l8.215">     if (img.className == &quot;moz-attached-image&quot; &amp;&amp; img.naturalWidth &gt; doc.width)</span>
<a href="#l8.216"></a><span id="l8.216">     {</span>
<a href="#l8.217"></a><span id="l8.217">       if (img.hasAttribute(&quot;shrinktofit&quot;))</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineat">@@ -2890,27 +2904,32 @@ function HandleMDNResponse(aUrl)</span>
<a href="#l8.219"></a><span id="l8.219">   var DNTHeader = mimeHdr.extractHeader(&quot;Disposition-Notification-To&quot;, false);</span>
<a href="#l8.220"></a><span id="l8.220">   var oldDNTHeader = mimeHdr.extractHeader(&quot;Return-Receipt-To&quot;, false);</span>
<a href="#l8.221"></a><span id="l8.221">   if (!DNTHeader &amp;&amp; !oldDNTHeader)</span>
<a href="#l8.222"></a><span id="l8.222">     return;</span>
<a href="#l8.223"></a><span id="l8.223"> </span>
<a href="#l8.224"></a><span id="l8.224">   // Everything looks good so far, let's generate the MDN response.</span>
<a href="#l8.225"></a><span id="l8.225">   var mdnGenerator = Components.classes[&quot;@mozilla.org/messenger-mdn/generator;1&quot;].</span>
<a href="#l8.226"></a><span id="l8.226">                                   createInstance(Components.interfaces.nsIMsgMdnGenerator);</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineminus">-  mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder, msgHdr.messageKey, mimeHdr, false);</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineplus">+  mdnGenerator.process(Components.interfaces.nsIMsgMdnGenerator.eDisplayed,</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineplus">+                       msgWindow,</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+                       msgFolder,</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+                       msgHdr.messageKey,</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineplus">+                       mimeHdr,</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+                       false);</span>
<a href="#l8.234"></a><span id="l8.234"> </span>
<a href="#l8.235"></a><span id="l8.235">   // Reset mark msg MDN &quot;Sent&quot; and &quot;Not Needed&quot;.</span>
<a href="#l8.236"></a><span id="l8.236">   msgHdr.flags = (msgFlags &amp;</span>
<a href="#l8.237"></a><span id="l8.237">                   ~Components.interfaces.nsMsgMessageFlags.MDNReportNeeded);</span>
<a href="#l8.238"></a><span id="l8.238">   msgHdr.OrFlags(Components.interfaces.nsMsgMessageFlags.MDNReportSent);</span>
<a href="#l8.239"></a><span id="l8.239"> </span>
<a href="#l8.240"></a><span id="l8.240">   // Commit db changes.</span>
<a href="#l8.241"></a><span id="l8.241">   var msgdb = msgFolder.msgDatabase;</span>
<a href="#l8.242"></a><span id="l8.242">   if (msgdb)</span>
<a href="#l8.243"></a><span id="l8.243" class="difflineminus">-    msgdb.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l8.244"></a><span id="l8.244" class="difflineplus">+    msgdb.Commit(Components.interfaces.nsMsgDBCommitType.kLargeCommit);</span>
<a href="#l8.245"></a><span id="l8.245"> }</span>
<a href="#l8.246"></a><span id="l8.246"> </span>
<a href="#l8.247"></a><span id="l8.247"> function MsgSearchMessages()</span>
<a href="#l8.248"></a><span id="l8.248"> {</span>
<a href="#l8.249"></a><span id="l8.249">   var preselectedFolder = null;</span>
<a href="#l8.250"></a><span id="l8.250">   if (&quot;GetFirstSelectedMsgFolder&quot; in window)</span>
<a href="#l8.251"></a><span id="l8.251">     preselectedFolder = GetFirstSelectedMsgFolder();</span>
<a href="#l8.252"></a><span id="l8.252"> </span>
<a href="#l8.253"></a><span id="l8.253" class="difflineat">@@ -3102,18 +3121,17 @@ function FeedSetContentView(val)</span>
<a href="#l8.254"></a><span id="l8.254">   if (showSummary) {</span>
<a href="#l8.255"></a><span id="l8.255">     if (gShowFeedSummaryToggle) {</span>
<a href="#l8.256"></a><span id="l8.256">       if (gDBView &amp;&amp; GetNumSelectedMessages() == 1) {</span>
<a href="#l8.257"></a><span id="l8.257">         ReloadMessage();</span>
<a href="#l8.258"></a><span id="l8.258">       }</span>
<a href="#l8.259"></a><span id="l8.259">     }</span>
<a href="#l8.260"></a><span id="l8.260">   }</span>
<a href="#l8.261"></a><span id="l8.261">   else if(contentBase.headerValue) {</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineminus">-    document.getElementById(&quot;messagepane&quot;)</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineminus">-            .loadURI(contentBase.headerValue, null, null);</span>
<a href="#l8.264"></a><span id="l8.264" class="difflineplus">+    getMessageBrowser().loadURI(contentBase.headerValue, null, null);</span>
<a href="#l8.265"></a><span id="l8.265">     gShowFeedSummaryToggle = false;</span>
<a href="#l8.266"></a><span id="l8.266">   }</span>
<a href="#l8.267"></a><span id="l8.267"> }</span>
<a href="#l8.268"></a><span id="l8.268"> </span>
<a href="#l8.269"></a><span id="l8.269"> function getMailToolbox()</span>
<a href="#l8.270"></a><span id="l8.270"> {</span>
<a href="#l8.271"></a><span id="l8.271">   return document.getElementById(&quot;mail-toolbox&quot;);</span>
<a href="#l8.272"></a><span id="l8.272"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/mailnews/mailWindowOverlay.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -78,16 +78,21 @@</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l9.7"></a><span id="l9.7">   &lt;stringbundle id=&quot;bundle_offlinePrompts&quot; src=&quot;chrome://messenger/locale/offline.properties&quot;/&gt;</span>
<a href="#l9.8"></a><span id="l9.8">   &lt;stringbundle id=&quot;bundle_viewZoom&quot;/&gt;</span>
<a href="#l9.9"></a><span id="l9.9">   &lt;stringbundle id=&quot;findBundle&quot; src=&quot;chrome://global/locale/finddialog.properties&quot;/&gt;</span>
<a href="#l9.10"></a><span id="l9.10"> &lt;/stringbundleset&gt;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+&lt;broadcasterset id=&quot;mailBroadcasters&quot;&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  &lt;!-- Go Menu --&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  &lt;broadcaster id=&quot;mailFolderPane&quot;/&gt;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+&lt;/broadcasterset&gt;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17"> &lt;!-- Performance optimization...we include utilityOverlay.xul which defines some command sets</span>
<a href="#l9.18"></a><span id="l9.18">      which are updated based on events like focus and select. We have our own custom events</span>
<a href="#l9.19"></a><span id="l9.19">      which we use to optmize when we do command updating. To avoid unnecessary command updating,</span>
<a href="#l9.20"></a><span id="l9.20">      we are going to override the events the global edit menu items and select edit menu items</span>
<a href="#l9.21"></a><span id="l9.21">      are updated on with events of our own controlling.</span>
<a href="#l9.22"></a><span id="l9.22">  --&gt;</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24"> &lt;commandset id=&quot;globalEditMenuItems&quot;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineat">@@ -324,16 +329,20 @@</span>
<a href="#l9.26"></a><span id="l9.26">   &lt;command id=&quot;cmd_deleteJunk&quot; oncommand=&quot;goDoCommand('cmd_deleteJunk');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l9.27"></a><span id="l9.27">   &lt;command id=&quot;cmd_search&quot; oncommand=&quot;goDoCommand('cmd_search')&quot;/&gt;</span>
<a href="#l9.28"></a><span id="l9.28"> &lt;/commandset&gt;</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30"> &lt;keyset id=&quot;mailKeys&quot;&gt;</span>
<a href="#l9.31"></a><span id="l9.31">   &lt;key id=&quot;space&quot; key=&quot; &quot; modifiers=&quot;shift any&quot; oncommand=&quot;SpaceHit(event);&quot;/&gt;</span>
<a href="#l9.32"></a><span id="l9.32"> </span>
<a href="#l9.33"></a><span id="l9.33">   &lt;!-- File Menu --&gt;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+  &lt;key id=&quot;key_newTab&quot;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+       key=&quot;&amp;newTabCmd.key;&quot;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+       modifiers=&quot;accel&quot;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+       oncommand=&quot;MsgOpenNewTab();&quot;/&gt;</span>
<a href="#l9.38"></a><span id="l9.38">   &lt;key id=&quot;key_newNavigator&quot;/&gt;</span>
<a href="#l9.39"></a><span id="l9.39">   &lt;key id=&quot;key_newBlankPage&quot;/&gt;</span>
<a href="#l9.40"></a><span id="l9.40">   &lt;key id=&quot;key_close&quot;/&gt;</span>
<a href="#l9.41"></a><span id="l9.41">   &lt;key id=&quot;key_quit&quot;/&gt;</span>
<a href="#l9.42"></a><span id="l9.42">   &lt;!-- Edit Menu --&gt;</span>
<a href="#l9.43"></a><span id="l9.43">   &lt;key id=&quot;key_undo&quot;/&gt;</span>
<a href="#l9.44"></a><span id="l9.44">   &lt;key id=&quot;key_redo&quot;/&gt;</span>
<a href="#l9.45"></a><span id="l9.45">   &lt;key id=&quot;key_cut&quot;/&gt;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineat">@@ -400,18 +409,29 @@</span>
<a href="#l9.47"></a><span id="l9.47">   &lt;key keycode=&quot;VK_TAB&quot; oncommand=&quot;SwitchPaneFocus(event);&quot; modifiers=&quot;control,shift&quot;/&gt;</span>
<a href="#l9.48"></a><span id="l9.48">   &lt;key keycode=&quot;VK_TAB&quot; oncommand=&quot;SwitchPaneFocus(event);&quot; modifiers=&quot;control&quot;/&gt;</span>
<a href="#l9.49"></a><span id="l9.49">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchPaneFocus(event);&quot; modifiers=&quot;control,shift&quot;/&gt;</span>
<a href="#l9.50"></a><span id="l9.50">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchPaneFocus(event);&quot; modifiers=&quot;control&quot;/&gt;</span>
<a href="#l9.51"></a><span id="l9.51">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchPaneFocus(event);&quot; modifiers=&quot;shift&quot;/&gt;</span>
<a href="#l9.52"></a><span id="l9.52">   &lt;key keycode=&quot;VK_F6&quot; oncommand=&quot;SwitchPaneFocus(event);&quot;/&gt;</span>
<a href="#l9.53"></a><span id="l9.53"> </span>
<a href="#l9.54"></a><span id="l9.54">   &lt;!-- View Toggle Keys (F8/F9) --&gt;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-  &lt;key id=&quot;key_toggleMessagePane&quot; keycode=&quot;VK_F8&quot; oncommand=&quot;MsgToggleMessagePane();&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-  &lt;key id=&quot;key_toggleFolderPane&quot; keycode=&quot;VK_F9&quot; oncommand=&quot;MsgToggleSplitter('gray_vertical_splitter');&quot; observes=&quot;mailDisableKeys&quot;/&gt;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+  &lt;key id=&quot;key_toggleFolderPane&quot;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+       keycode=&quot;VK_F9&quot;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+       oncommand=&quot;MsgToggleFolderPane(true);&quot;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+       observes=&quot;mailDisableKeys&quot;/&gt;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+  &lt;key id=&quot;key_toggleThreadPane&quot;</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+       keycode=&quot;VK_F8&quot;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+       modifiers=&quot;shift&quot;</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+       oncommand=&quot;MsgToggleThreadPane();&quot;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+       disabled=&quot;true&quot;/&gt;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+  &lt;key id=&quot;key_toggleMessagePane&quot;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+       keycode=&quot;VK_F8&quot;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+       oncommand=&quot;MsgToggleMessagePane(true);&quot;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+       disabled=&quot;true&quot;/&gt;</span>
<a href="#l9.70"></a><span id="l9.70"> </span>
<a href="#l9.71"></a><span id="l9.71">   &lt;!-- Tag Keys --&gt;</span>
<a href="#l9.72"></a><span id="l9.72">   &lt;!-- Includes both shifted and not, for Azerty and other layouts where the</span>
<a href="#l9.73"></a><span id="l9.73">        numeric keys are shifted. --&gt;</span>
<a href="#l9.74"></a><span id="l9.74">   &lt;key id=&quot;key_tag0&quot; key=&quot;&amp;tagCmd0.key;&quot; modifiers=&quot;shift any&quot;</span>
<a href="#l9.75"></a><span id="l9.75">        oncommand=&quot;RemoveAllMessageTags();&quot;/&gt;</span>
<a href="#l9.76"></a><span id="l9.76">   &lt;key id=&quot;key_tag1&quot; key=&quot;&amp;tagCmd1.key;&quot; modifiers=&quot;shift any&quot;</span>
<a href="#l9.77"></a><span id="l9.77">        oncommand=&quot;ToggleMessageTagKey(1);&quot;/&gt;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineat">@@ -438,32 +458,32 @@</span>
<a href="#l9.79"></a><span id="l9.79">        modifiers=&quot;accel&quot;</span>
<a href="#l9.80"></a><span id="l9.80">        oncommand=&quot;focusElement(document.getElementById('searchInput'));&quot;/&gt;</span>
<a href="#l9.81"></a><span id="l9.81"> </span>
<a href="#l9.82"></a><span id="l9.82"> &lt;/keyset&gt;</span>
<a href="#l9.83"></a><span id="l9.83"> </span>
<a href="#l9.84"></a><span id="l9.84">   &lt;popup id=&quot;folderPaneContext&quot;</span>
<a href="#l9.85"></a><span id="l9.85">          onpopupshowing=&quot;return FillFolderPaneContextMenu();&quot;</span>
<a href="#l9.86"></a><span id="l9.86">          onpopuphiding=&quot;if (event.target == this) FolderPaneOnPopupHiding();&quot;&gt;</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-</span>
<a href="#l9.88"></a><span id="l9.88">     &lt;menuitem id=&quot;folderPaneContext-getMessages&quot;</span>
<a href="#l9.89"></a><span id="l9.89">               label=&quot;&amp;folderContextGetMessages.label;&quot;</span>
<a href="#l9.90"></a><span id="l9.90">               accesskey=&quot;&amp;folderContextGetMessages.accesskey;&quot;</span>
<a href="#l9.91"></a><span id="l9.91">               oncommand=&quot;MsgGetMessage();&quot;/&gt;</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-</span>
<a href="#l9.93"></a><span id="l9.93">     &lt;menuitem id=&quot;folderPaneContext-openNewWindow&quot;</span>
<a href="#l9.94"></a><span id="l9.94">               label=&quot;&amp;folderContextOpenNewWindow.label;&quot;</span>
<a href="#l9.95"></a><span id="l9.95">               accesskey=&quot;&amp;folderContextOpenNewWindow.accesskey;&quot;</span>
<a href="#l9.96"></a><span id="l9.96">               oncommand=&quot;MsgOpenNewWindowForFolder(null,-1);&quot;/&gt;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineminus">-</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+    &lt;menuitem id=&quot;folderPaneContext-openNewTab&quot;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+              label=&quot;&amp;folderContextOpenNewTab.label;&quot;</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+              accesskey=&quot;&amp;folderContextOpenNewTab.accesskey;&quot;</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+              oncommand=&quot;MsgOpenNewTabForFolder();&quot;/&gt;</span>
<a href="#l9.102"></a><span id="l9.102">     &lt;menuitem id=&quot;folderPaneContext-searchMessages&quot;</span>
<a href="#l9.103"></a><span id="l9.103">               label=&quot;&amp;folderContextSearchMessages.label;&quot;</span>
<a href="#l9.104"></a><span id="l9.104">               accesskey=&quot;&amp;folderContextSearchMessages.accesskey;&quot;</span>
<a href="#l9.105"></a><span id="l9.105">               command=&quot;cmd_search&quot;/&gt;</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-</span>
<a href="#l9.107"></a><span id="l9.107">     &lt;menuitem id=&quot;folderPaneContext-subscribe&quot;</span>
<a href="#l9.108"></a><span id="l9.108">         label=&quot;&amp;folderContextSubscribe.label;&quot;</span>
<a href="#l9.109"></a><span id="l9.109">         accesskey=&quot;&amp;folderContextSubscribe.accesskey;&quot;</span>
<a href="#l9.110"></a><span id="l9.110">         oncommand=&quot;MsgSubscribe();&quot;/&gt;</span>
<a href="#l9.111"></a><span id="l9.111">     &lt;menuitem id=&quot;folderPaneContext-newsUnsubscribe&quot;</span>
<a href="#l9.112"></a><span id="l9.112">         label=&quot;&amp;folderContextUnsubscribe.label;&quot;</span>
<a href="#l9.113"></a><span id="l9.113">         accesskey=&quot;&amp;folderContextUnsubscribe.accesskey;&quot;</span>
<a href="#l9.114"></a><span id="l9.114">         oncommand=&quot;MsgUnsubscribe();&quot;/&gt;</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineat">@@ -542,16 +562,20 @@</span>
<a href="#l9.116"></a><span id="l9.116">               accesskey=&quot;&amp;copyCmd.accesskey;&quot;</span>
<a href="#l9.117"></a><span id="l9.117">               command=&quot;cmd_copy&quot;/&gt;</span>
<a href="#l9.118"></a><span id="l9.118">     &lt;menuitem id=&quot;context-searchselect&quot;</span>
<a href="#l9.119"></a><span id="l9.119">               oncommand=&quot;MsgOpenSearch(gContextMenu.searchSelected(), event.shiftKey);&quot;/&gt;</span>
<a href="#l9.120"></a><span id="l9.120">     &lt;menuitem id=&quot;mailContext-openNewWindow&quot;</span>
<a href="#l9.121"></a><span id="l9.121">               label=&quot;&amp;contextOpenNewWindow.label;&quot;</span>
<a href="#l9.122"></a><span id="l9.122">               accesskey=&quot;&amp;contextOpenNewWindow.accesskey;&quot;</span>
<a href="#l9.123"></a><span id="l9.123">               oncommand=&quot;MsgOpenNewWindowForMessage();&quot;/&gt;</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+    &lt;menuitem id=&quot;mailContext-openNewTab&quot;</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+              label=&quot;&amp;contextOpenNewTab.label;&quot;</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+              accesskey=&quot;&amp;contextOpenNewTab.accesskey;&quot;</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+              oncommand=&quot;MsgOpenNewTabForMessage();&quot;/&gt;</span>
<a href="#l9.128"></a><span id="l9.128">     &lt;menuseparator id=&quot;mailContext-sep-open&quot;/&gt;</span>
<a href="#l9.129"></a><span id="l9.129">     &lt;menuitem id=&quot;mailContext-replySender&quot;</span>
<a href="#l9.130"></a><span id="l9.130">               label=&quot;&amp;contextReplySender.label;&quot;</span>
<a href="#l9.131"></a><span id="l9.131">               accesskey=&quot;&amp;contextReplySender.accesskey;&quot;</span>
<a href="#l9.132"></a><span id="l9.132">               oncommand=&quot;MsgReplySender(event);&quot;/&gt;</span>
<a href="#l9.133"></a><span id="l9.133">     &lt;menuitem id=&quot;mailContext-replyNewsgroup&quot;</span>
<a href="#l9.134"></a><span id="l9.134">               label=&quot;&amp;contextReplyNewsgroup.label;&quot;</span>
<a href="#l9.135"></a><span id="l9.135">               accesskey=&quot;&amp;contextReplyNewsgroup.accesskey;&quot;</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineat">@@ -930,26 +954,33 @@</span>
<a href="#l9.137"></a><span id="l9.137">   &lt;menu id=&quot;menu_File&quot; &gt;</span>
<a href="#l9.138"></a><span id="l9.138">     &lt;menupopup id=&quot;menu_FilePopup&quot; onpopupshowing=&quot;file_init();&quot;&gt;</span>
<a href="#l9.139"></a><span id="l9.139">       &lt;menu id=&quot;menu_New&quot;&gt;</span>
<a href="#l9.140"></a><span id="l9.140">         &lt;menupopup id=&quot;menu_NewPopup&quot; onpopupshowing=&quot;menu_new_init();&quot;&gt;</span>
<a href="#l9.141"></a><span id="l9.141">           &lt;menuitem label=&quot;&amp;newNewMsgCmd.label;&quot;</span>
<a href="#l9.142"></a><span id="l9.142">                     accesskey=&quot;&amp;newNewMsgCmd.accesskey;&quot;</span>
<a href="#l9.143"></a><span id="l9.143">                     key=&quot;key_newMessage&quot;</span>
<a href="#l9.144"></a><span id="l9.144">                     oncommand=&quot;MsgNewMessage(null);&quot;/&gt;</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-          &lt;menuitem id=&quot;menu_newFolder&quot; label=&quot;&amp;newFolderCmd.label;&quot;</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineminus">-                     oncommand=&quot;MsgNewFolder(NewFolder);&quot;</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-                     accesskey=&quot;&amp;newFolderCmd.accesskey;&quot;/&gt;</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+          &lt;menuitem id=&quot;menu_newFolder&quot;</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+                    label=&quot;&amp;newFolderCmd.label;&quot;</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineplus">+                    accesskey=&quot;&amp;newFolderCmd.accesskey;&quot;</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+                    oncommand=&quot;MsgNewFolder(NewFolder);&quot;/&gt;</span>
<a href="#l9.152"></a><span id="l9.152">           &lt;menuitem id=&quot;menu_newVirtualFolder&quot; label=&quot;&amp;newVirtualFolderCmd.label;&quot;</span>
<a href="#l9.153"></a><span id="l9.153">                     oncommand=&quot;MsgVirtualFolderProperties(false);&quot;</span>
<a href="#l9.154"></a><span id="l9.154">                     accesskey=&quot;&amp;newVirtualFolderCmd.accesskey;&quot;/&gt;</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-          &lt;menuitem id=&quot;newAccountMenuItem&quot; label=&quot;&amp;newAccountCmd.label;&quot;</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-                     accesskey=&quot;&amp;newAccountCmd.accesskey;&quot;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-                     oncommand=&quot;MsgAccountWizard();&quot;/&gt;</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineplus">+          &lt;menuitem id=&quot;newAccountMenuItem&quot;</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+                    label=&quot;&amp;newAccountCmd.label;&quot;</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineplus">+                    accesskey=&quot;&amp;newAccountCmd.accesskey;&quot;</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineplus">+                    oncommand=&quot;MsgAccountWizard();&quot;/&gt;</span>
<a href="#l9.162"></a><span id="l9.162">           &lt;menuseparator id=&quot;newPopupMenuSeparator&quot;/&gt;</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+          &lt;menuitem id=&quot;menu_newTab&quot;</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+                    label=&quot;&amp;newTabCmd.label;&quot;</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+                    accesskey=&quot;&amp;newTabCmd.accesskey;&quot;</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineplus">+                    key=&quot;key_newTab&quot;</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineplus">+                    oncommand=&quot;MsgOpenNewTab();&quot;/&gt;</span>
<a href="#l9.168"></a><span id="l9.168">           &lt;menuitem id=&quot;menu_newNavigator&quot;/&gt;</span>
<a href="#l9.169"></a><span id="l9.169">           &lt;menuitem id=&quot;menu_newEditor&quot;/&gt;</span>
<a href="#l9.170"></a><span id="l9.170">         &lt;/menupopup&gt;</span>
<a href="#l9.171"></a><span id="l9.171">       &lt;/menu&gt;</span>
<a href="#l9.172"></a><span id="l9.172">       &lt;menuitem id=&quot;openMessageFileMenuitem&quot; label=&quot;&amp;openMessageFileCmd.label;&quot;</span>
<a href="#l9.173"></a><span id="l9.173">         key=&quot;key_openFileMessage&quot;</span>
<a href="#l9.174"></a><span id="l9.174">         accesskey=&quot;&amp;openMessageFileCmd.accesskey;&quot;</span>
<a href="#l9.175"></a><span id="l9.175">         oncommand=&quot;MsgOpenFromFile();&quot;/&gt;</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineat">@@ -1147,21 +1178,36 @@</span>
<a href="#l9.177"></a><span id="l9.177">         &lt;menupopup id=&quot;view_layout_popup&quot; onpopupshowing=&quot;InitViewLayoutStyleMenu(event)&quot;&gt;</span>
<a href="#l9.178"></a><span id="l9.178">           &lt;menuitem id=&quot;messagePaneClassic&quot; type=&quot;radio&quot; label=&quot;&amp;messagePaneClassic.label;&quot; name=&quot;viewlayoutgroup&quot;</span>
<a href="#l9.179"></a><span id="l9.179">                     accesskey=&quot;&amp;messagePaneClassic.accesskey;&quot; oncommand=&quot;ChangeMailLayout(kClassicMailLayout);&quot;/&gt;</span>
<a href="#l9.180"></a><span id="l9.180">           &lt;menuitem id=&quot;messagePaneWide&quot; type=&quot;radio&quot; label=&quot;&amp;messagePaneWide.label;&quot; name=&quot;viewlayoutgroup&quot;</span>
<a href="#l9.181"></a><span id="l9.181">                     accesskey=&quot;&amp;messagePaneWide.accesskey;&quot; oncommand=&quot;ChangeMailLayout(kWideMailLayout);&quot;/&gt;</span>
<a href="#l9.182"></a><span id="l9.182">           &lt;menuitem id=&quot;messagePaneVertical&quot; type=&quot;radio&quot; label=&quot;&amp;messagePaneVertical.label;&quot; name=&quot;viewlayoutgroup&quot;</span>
<a href="#l9.183"></a><span id="l9.183">                     accesskey=&quot;&amp;messagePaneVertical.accesskey;&quot; oncommand=&quot;ChangeMailLayout(kVerticalMailLayout);&quot;/&gt;</span>
<a href="#l9.184"></a><span id="l9.184">           &lt;menuseparator id=&quot;viewMenuAfterPaneVerticalSeparator&quot;/&gt;</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-          &lt;menuitem id=&quot;menu_showMessagePane&quot; type=&quot;checkbox&quot; label=&quot;&amp;showMessagePaneCmd.label;&quot; key=&quot;key_toggleMessagePane&quot;</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-                    accesskey=&quot;&amp;showMessagePaneCmd.accesskey;&quot; oncommand=&quot;MsgToggleMessagePane();&quot;</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineplus">+          &lt;menuitem id=&quot;menu_showMessagePane&quot;</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineplus">+                    type=&quot;checkbox&quot;</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineplus">+                    label=&quot;&amp;showMessagePaneCmd.label;&quot;</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineplus">+                    accesskey=&quot;&amp;showMessagePaneCmd.accesskey;&quot;</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineplus">+                    key=&quot;key_toggleMessagePane&quot;</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineplus">+                    oncommand=&quot;MsgToggleMessagePane(true);&quot;</span>
<a href="#l9.193"></a><span id="l9.193">                     observes=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-          &lt;menuitem id=&quot;menu_showFolderPane&quot; type=&quot;checkbox&quot; label=&quot;&amp;showFolderPaneCmd.label;&quot; key=&quot;key_toggleFolderPane&quot;</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineminus">-                    accesskey=&quot;&amp;showFolderPaneCmd.accesskey;&quot; oncommand=&quot;MsgToggleSplitter('gray_vertical_splitter');&quot;</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+          &lt;menuitem id=&quot;menu_showThreadPane&quot;</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineplus">+                    type=&quot;checkbox&quot;</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineplus">+                    label=&quot;&amp;showThreadPaneCmd.label;&quot;</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineplus">+                    accesskey=&quot;&amp;showThreadPaneCmd.accesskey;&quot;</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineplus">+                    key=&quot;key_toggleThreadPane&quot;</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+                    oncommand=&quot;MsgToggleThreadPane();&quot;</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineplus">+                    observes=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+          &lt;menuitem id=&quot;menu_showFolderPane&quot;</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+                    type=&quot;checkbox&quot;</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+                    label=&quot;&amp;showFolderPaneCmd.label;&quot;</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+                    accesskey=&quot;&amp;showFolderPaneCmd.accesskey;&quot;</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineplus">+                    key=&quot;key_toggleFolderPane&quot;</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineplus">+                    oncommand=&quot;MsgToggleFolderPane(true);&quot;</span>
<a href="#l9.209"></a><span id="l9.209">                     observes=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l9.210"></a><span id="l9.210">         &lt;/menupopup&gt;</span>
<a href="#l9.211"></a><span id="l9.211">       &lt;/menu&gt;</span>
<a href="#l9.212"></a><span id="l9.212">       &lt;menuseparator id=&quot;viewMessagesMenuSeparator&quot; observes=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l9.213"></a><span id="l9.213">       &lt;menu id=&quot;viewSortMenu&quot; label=&quot;&amp;sortMenu.label;&quot;</span>
<a href="#l9.214"></a><span id="l9.214">             accesskey=&quot;&amp;sortMenu.accesskey;&quot; observes=&quot;mailHideMenus&quot;&gt;</span>
<a href="#l9.215"></a><span id="l9.215">         &lt;menupopup id=&quot;menu_viewSortPopup&quot; onpopupshowing=&quot;InitViewSortByMenu()&quot;&gt;</span>
<a href="#l9.216"></a><span id="l9.216">           &lt;menuitem id=&quot;sortByDateMenuitem&quot; type=&quot;radio&quot; name=&quot;sortby&quot; label=&quot;&amp;sortByDateCmd.label;&quot; accesskey=&quot;&amp;sortByDateCmd.accesskey;&quot; oncommand=&quot;MsgSortThreadPane('byDate')&quot;/&gt;</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineat">@@ -1389,16 +1435,17 @@</span>
<a href="#l9.218"></a><span id="l9.218">                 accesskey=&quot;&amp;startPageCmd.accesskey;&quot; command=&quot;cmd_goStartPage&quot;</span>
<a href="#l9.219"></a><span id="l9.219">                 observes=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l9.220"></a><span id="l9.220">       &lt;menuseparator id=&quot;goNextAfterStartPageSeparator&quot; observes=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l9.221"></a><span id="l9.221">     &lt;/menupopup&gt;</span>
<a href="#l9.222"></a><span id="l9.222">     &lt;template&gt;</span>
<a href="#l9.223"></a><span id="l9.223">       &lt;rule iscontainer=&quot;true&quot; isempty=&quot;false&quot;&gt;</span>
<a href="#l9.224"></a><span id="l9.224">         &lt;menupopup&gt;</span>
<a href="#l9.225"></a><span id="l9.225">           &lt;menu uri=&quot;rdf:*&quot; class=&quot;folderMenuItem menu-iconic&quot;</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineplus">+                observes=&quot;mailFolderPane&quot;</span>
<a href="#l9.227"></a><span id="l9.227">               SpecialFolder=&quot;rdf:http://home.netscape.com/NC-rdf#SpecialFolder&quot;</span>
<a href="#l9.228"></a><span id="l9.228">               BiffState=&quot;rdf:http://home.netscape.com/NC-rdf#BiffState&quot;</span>
<a href="#l9.229"></a><span id="l9.229">               IsServer=&quot;rdf:http://home.netscape.com/NC-rdf#IsServer&quot;</span>
<a href="#l9.230"></a><span id="l9.230">               IsSecure=&quot;rdf:http://home.netscape.com/NC-rdf#IsSecure&quot;</span>
<a href="#l9.231"></a><span id="l9.231">               ServerType=&quot;rdf:http://home.netscape.com/NC-rdf#ServerType&quot;</span>
<a href="#l9.232"></a><span id="l9.232">               HasUnreadMessages=&quot;rdf:http://home.netscape.com/NC-rdf#HasUnreadMessages&quot;</span>
<a href="#l9.233"></a><span id="l9.233">               NewMessages=&quot;rdf:http://home.netscape.com/NC-rdf#NewMessages&quot;</span>
<a href="#l9.234"></a><span id="l9.234">               SubfoldersHaveUnreadMessages=&quot;rdf:http://home.netscape.com/NC-rdf#SubfoldersHaveUnreadMessages&quot;</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineat">@@ -1418,16 +1465,17 @@</span>
<a href="#l9.236"></a><span id="l9.236">               &lt;menuseparator/&gt;</span>
<a href="#l9.237"></a><span id="l9.237">             &lt;/menupopup&gt;</span>
<a href="#l9.238"></a><span id="l9.238">           &lt;/menu&gt;</span>
<a href="#l9.239"></a><span id="l9.239">         &lt;/menupopup&gt;</span>
<a href="#l9.240"></a><span id="l9.240">       &lt;/rule&gt;</span>
<a href="#l9.241"></a><span id="l9.241">       &lt;rule&gt;</span>
<a href="#l9.242"></a><span id="l9.242">         &lt;menupopup&gt;</span>
<a href="#l9.243"></a><span id="l9.243">           &lt;menuitem uri=&quot;rdf:*&quot; value=&quot;rdf:*&quot; class=&quot;folderMenuItem menuitem-iconic&quot;</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineplus">+                    observes=&quot;mailFolderPane&quot;</span>
<a href="#l9.245"></a><span id="l9.245">               SpecialFolder=&quot;rdf:http://home.netscape.com/NC-rdf#SpecialFolder&quot;</span>
<a href="#l9.246"></a><span id="l9.246">               BiffState=&quot;rdf:http://home.netscape.com/NC-rdf#BiffState&quot;</span>
<a href="#l9.247"></a><span id="l9.247">               IsServer=&quot;rdf:http://home.netscape.com/NC-rdf#IsServer&quot;</span>
<a href="#l9.248"></a><span id="l9.248">               IsSecure=&quot;rdf:http://home.netscape.com/NC-rdf#IsSecure&quot;</span>
<a href="#l9.249"></a><span id="l9.249">               ServerType=&quot;rdf:http://home.netscape.com/NC-rdf#ServerType&quot;</span>
<a href="#l9.250"></a><span id="l9.250">               HasUnreadMessages=&quot;rdf:http://home.netscape.com/NC-rdf#HasUnreadMessages&quot;</span>
<a href="#l9.251"></a><span id="l9.251">               NewMessages=&quot;rdf:http://home.netscape.com/NC-rdf#NewMessages&quot;</span>
<a href="#l9.252"></a><span id="l9.252">               SubfoldersHaveUnreadMessages=&quot;rdf:http://home.netscape.com/NC-rdf#SubfoldersHaveUnreadMessages&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/mailnews/messageWindow.xul</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/mailnews/messageWindow.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -75,16 +75,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/messageWindow.js&quot;/&gt;</span>
<a href="#l10.5"></a><span id="l10.5">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l10.6"></a><span id="l10.6">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mailContextMenus.js&quot;/&gt;</span>
<a href="#l10.7"></a><span id="l10.7">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/phishingDetector.js&quot;/&gt;</span>
<a href="#l10.8"></a><span id="l10.8">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/contentAreaClick.js&quot;/&gt;</span>
<a href="#l10.9"></a><span id="l10.9">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l10.10"></a><span id="l10.10">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/msgViewNavigation.js&quot;/&gt;</span>
<a href="#l10.11"></a><span id="l10.11">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/widgetglue.js&quot;/&gt;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/tabmail.js&quot;/&gt;</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14">   &lt;commandset id=&quot;mailCommands&quot;&gt;</span>
<a href="#l10.15"></a><span id="l10.15">     &lt;commandset id=&quot;mailFileMenuItems&quot;/&gt;</span>
<a href="#l10.16"></a><span id="l10.16">     &lt;commandset id=&quot;mailDownloadCommands&quot;/&gt;</span>
<a href="#l10.17"></a><span id="l10.17">     &lt;commandset id=&quot;mailViewMenuItems&quot;/&gt;</span>
<a href="#l10.18"></a><span id="l10.18">     &lt;commandset id=&quot;mailEditMenuItems&quot;/&gt;</span>
<a href="#l10.19"></a><span id="l10.19">     &lt;commandset id=&quot;mailSearchMenuItems&quot;/&gt;</span>
<a href="#l10.20"></a><span id="l10.20">     &lt;commandset id=&quot;mailGoMenuItems&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/mailnews/messenger.css</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/mailnews/messenger.css</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -199,8 +199,57 @@ folderSummaryMessage</span>
<a href="#l11.4"></a><span id="l11.4"> .foldersTreeChildren::-moz-tree-twisty</span>
<a href="#l11.5"></a><span id="l11.5"> {</span>
<a href="#l11.6"></a><span id="l11.6">   width: 0px;</span>
<a href="#l11.7"></a><span id="l11.7"> }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> dummy.usesMailWidgets {</span>
<a href="#l11.10"></a><span id="l11.10">   -moz-binding: url(&quot;chrome://messenger/content/mailWidgets.xml#dummy&quot;);</span>
<a href="#l11.11"></a><span id="l11.11"> }</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+/* tabmail */</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+#tabmail</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+{</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail&quot;);</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+}</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+.tabmail-tabs {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;);</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+}</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+.tabmail-arrowscrollbox {</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-arrowscrollbox&quot;);</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+}</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+.tabmail-tab {</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;);</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+}</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+.tabs-newbutton {</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-new-tab-button&quot;);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  display: none;</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+}</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+.tabmail-tabs[closebuttons=&quot;closeatend&quot;] .tabs-newbutton {</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+  display: -moz-box;</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+}</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+.tab-close-button,</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+.tabs-closebutton {</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-close-tab-button&quot;);</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+}</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+.tab-close-button {</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+  display: none;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+}</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+.tabmail-tabs:not([closebuttons=&quot;noclose&quot;]):not([closebuttons=&quot;closeatend&quot;]) &gt; .tabmail-tab[selected=&quot;true&quot;] &gt; .tab-close-button {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  display: -moz-box;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+}</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+.tabmail-tabs[closebuttons=&quot;alltabs&quot;] .tab-close-button {</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+  display: -moz-box;</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+}</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+.tabs-alltabs-popup {</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-alltabs-popup&quot;);</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/mailnews/messenger.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/mailnews/messenger.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -55,16 +55,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> &lt;window id=&quot;messengerWindow&quot;</span>
<a href="#l12.5"></a><span id="l12.5">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l12.6"></a><span id="l12.6">         xmlns:nc=&quot;http://home.netscape.com/NC-rdf#&quot;</span>
<a href="#l12.7"></a><span id="l12.7">         title=&quot;&amp;messengerWindow.title;&quot;</span>
<a href="#l12.8"></a><span id="l12.8">         titlemodifier=&quot;&amp;titleModifier.label;&quot;</span>
<a href="#l12.9"></a><span id="l12.9">         titlemenuseparator=&quot;&amp;titleSeparator.label;&quot;</span>
<a href="#l12.10"></a><span id="l12.10">         onload=&quot;OnLoadMessenger()&quot;</span>
<a href="#l12.11"></a><span id="l12.11">         onunload=&quot;OnUnloadMessenger()&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+        onclose=&quot;return MailWindowIsClosing();&quot;</span>
<a href="#l12.13"></a><span id="l12.13">         style=&quot;width: 60em; height: 40em;&quot;</span>
<a href="#l12.14"></a><span id="l12.14">         screenX=&quot;10&quot; screenY=&quot;10&quot;</span>
<a href="#l12.15"></a><span id="l12.15">         persist=&quot;width height screenX screenY sizemode&quot;</span>
<a href="#l12.16"></a><span id="l12.16">         windowtype=&quot;mail:3pane&quot;&gt;</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18"> &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l12.19"></a><span id="l12.19">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l12.20"></a><span id="l12.20">   &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -81,16 +82,17 @@</span>
<a href="#l12.22"></a><span id="l12.22"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mailContextMenus.js&quot;/&gt;</span>
<a href="#l12.23"></a><span id="l12.23"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/messengerdnd.js&quot;/&gt;</span>
<a href="#l12.24"></a><span id="l12.24"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/accountUtils.js&quot;/&gt;</span>
<a href="#l12.25"></a><span id="l12.25"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/mail-offline.js&quot;/&gt;</span>
<a href="#l12.26"></a><span id="l12.26"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/phishingDetector.js&quot;/&gt;</span>
<a href="#l12.27"></a><span id="l12.27"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/contentAreaClick.js&quot;/&gt;</span>
<a href="#l12.28"></a><span id="l12.28"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l12.29"></a><span id="l12.29"> &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/searchBar.js&quot;/&gt;</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+&lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/tabmail.js&quot;/&gt;</span>
<a href="#l12.31"></a><span id="l12.31"> </span>
<a href="#l12.32"></a><span id="l12.32"> &lt;commandset id=&quot;mailCommands&quot;&gt;</span>
<a href="#l12.33"></a><span id="l12.33">   &lt;commandset id=&quot;mailFileMenuItems&quot;/&gt;</span>
<a href="#l12.34"></a><span id="l12.34">   &lt;commandset id=&quot;mailDownloadCommands&quot;/&gt;</span>
<a href="#l12.35"></a><span id="l12.35">   &lt;commandset id=&quot;mailViewMenuItems&quot;/&gt;</span>
<a href="#l12.36"></a><span id="l12.36">   &lt;commandset id=&quot;mailEditMenuItems&quot;/&gt;</span>
<a href="#l12.37"></a><span id="l12.37">   &lt;commandset id=&quot;mailEditContextMenuItems&quot;/&gt;</span>
<a href="#l12.38"></a><span id="l12.38">   &lt;commandset id=&quot;mailSearchMenuItems&quot;/&gt;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -110,121 +112,153 @@</span>
<a href="#l12.40"></a><span id="l12.40">   &lt;commandset id=&quot;tasksCommands&quot;/&gt;</span>
<a href="#l12.41"></a><span id="l12.41"> &lt;/commandset&gt;</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43"> &lt;broadcasterset id=&quot;mailBroadcasters&quot;&gt;</span>
<a href="#l12.44"></a><span id="l12.44">   &lt;broadcaster id=&quot;mailHideMenus&quot;/&gt;</span>
<a href="#l12.45"></a><span id="l12.45">   &lt;broadcaster id=&quot;mailDisableKeys&quot;/&gt;</span>
<a href="#l12.46"></a><span id="l12.46">   &lt;!-- File Menu --&gt;</span>
<a href="#l12.47"></a><span id="l12.47">   &lt;broadcaster id=&quot;Communicator:WorkMode&quot;/&gt;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-  &lt;!-- Edit Menu --&gt;</span>
<a href="#l12.49"></a><span id="l12.49"> &lt;/broadcasterset&gt;</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51"> &lt;keyset id=&quot;mailKeys&quot;&gt;</span>
<a href="#l12.52"></a><span id="l12.52">   &lt;keyset id=&quot;tasksKeys&quot;/&gt;</span>
<a href="#l12.53"></a><span id="l12.53"> &lt;/keyset&gt;</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55"> &lt;popupset id=&quot;mainPopupSet&quot;/&gt;</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineminus">-</span>
<a href="#l12.57"></a><span id="l12.57"> &lt;popup id=&quot;mailContext&quot;/&gt;</span>
<a href="#l12.58"></a><span id="l12.58"> &lt;popup id=&quot;folderPaneContext&quot;/&gt;</span>
<a href="#l12.59"></a><span id="l12.59"> &lt;popup id=&quot;attachmentListContext&quot;/&gt;</span>
<a href="#l12.60"></a><span id="l12.60"> &lt;tooltip id=&quot;attachmentListTooltip&quot;/&gt;</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-</span>
<a href="#l12.62"></a><span id="l12.62"> &lt;popup id=&quot;copyUrlPopup&quot;/&gt;</span>
<a href="#l12.63"></a><span id="l12.63"> &lt;popup id=&quot;toolbar-context-menu&quot;/&gt;</span>
<a href="#l12.64"></a><span id="l12.64"> &lt;popup id=&quot;messageIdContext&quot;/&gt;</span>
<a href="#l12.65"></a><span id="l12.65"> &lt;popup id=&quot;emailAddressPopup&quot;/&gt;</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-</span>
<a href="#l12.67"></a><span id="l12.67"> &lt;tooltip id=&quot;folderpopup&quot; class=&quot;folderSummaryPopup&quot;/&gt;</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-</span>
<a href="#l12.69"></a><span id="l12.69"> &lt;tooltip id=&quot;aHTMLTooltip&quot; onpopupshowing=&quot;return FillInHTMLTooltip(document.tooltipNode);&quot;/&gt;</span>
<a href="#l12.70"></a><span id="l12.70"> </span>
<a href="#l12.71"></a><span id="l12.71">   &lt;toolbox id=&quot;mail-toolbox&quot; class=&quot;toolbox-top&quot;&gt;</span>
<a href="#l12.72"></a><span id="l12.72">     &lt;toolbar id=&quot;mail-toolbar-menubar2&quot;&gt;</span>
<a href="#l12.73"></a><span id="l12.73">       &lt;toolbaritem id=&quot;menubar-items&quot;&gt;</span>
<a href="#l12.74"></a><span id="l12.74">         &lt;menubar id=&quot;mail-menubar&quot;/&gt;</span>
<a href="#l12.75"></a><span id="l12.75">       &lt;/toolbaritem&gt;</span>
<a href="#l12.76"></a><span id="l12.76">     &lt;/toolbar&gt;</span>
<a href="#l12.77"></a><span id="l12.77">     &lt;toolbar id=&quot;msgToolbar&quot;/&gt;</span>
<a href="#l12.78"></a><span id="l12.78">     &lt;toolbarset id=&quot;customToolbars&quot; context=&quot;toolbar-context-menu&quot;/&gt;</span>
<a href="#l12.79"></a><span id="l12.79">     &lt;toolbar id=&quot;msgLocationToolbar&quot;/&gt;</span>
<a href="#l12.80"></a><span id="l12.80">   &lt;/toolbox&gt;</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-  &lt;!-- The main mail three pane frame --&gt;</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-  &lt;box id=&quot;mailContent&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-    &lt;box id=&quot;messengerBox&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot; minheight=&quot;100&quot; height=&quot;100&quot; persist=&quot;height&quot;&gt;</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-      &lt;vbox id=&quot;folderPaneBox&quot; minwidth=&quot;100&quot; width=&quot;200&quot; persist=&quot;collapsed width&quot;&gt;</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-        &lt;tree id=&quot;folderTree&quot;</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-              treelines=&quot;true&quot;</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-              keepcurrentinview=&quot;true&quot;</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-              flex=&quot;1&quot;</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-              context=&quot;folderPaneContext&quot;</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-              class=&quot;window-focusborder&quot;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-              focusring=&quot;false&quot;&gt;</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-          &lt;treechildren tooltip=&quot;folderpopup&quot;/&gt;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-        &lt;/tree&gt;</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+  &lt;panel id=&quot;customizeToolbarSheetPopup&quot;/&gt;</span>
<a href="#l12.97"></a><span id="l12.97"> </span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-      &lt;splitter id=&quot;gray_vertical_splitter&quot; collapse=&quot;before&quot; persist=&quot;state&quot; resizeafter=&quot;grow&quot;&gt;</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-        &lt;grippy/&gt;</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-      &lt;/splitter&gt;</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-      &lt;box id=&quot;messagesBox&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-        &lt;hbox id=&quot;searchBoxHolder&quot;/&gt;</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-        &lt;deck id=&quot;displayDeck&quot; flex=&quot;1&quot; selectedIndex=&quot;0&quot;</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-              minheight=&quot;100&quot; height=&quot;100&quot; persist=&quot;height&quot;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-              onselect=&quot;ObserveDisplayDeckChange(event)&quot;&gt;</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-          &lt;!-- first panel in displayDeck is Account Central --&gt;</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-          &lt;vbox id=&quot;accountCentralBox&quot;&gt;</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-            &lt;iframe name=&quot;accountCentralPane&quot; width=&quot;150&quot; flex=&quot;1&quot; src=&quot;about:blank&quot;/&gt;</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-          &lt;/vbox&gt;</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineminus">-          &lt;!-- second panel is the threadPane --&gt;</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineminus">-          &lt;hbox id=&quot;threadPaneBox&quot;&gt;</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineminus">-            &lt;tree id=&quot;threadTree&quot;</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-                  treelines=&quot;true&quot;</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-                  keepcurrentinview=&quot;true&quot;</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-                  flex=&quot;1&quot;</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+  &lt;!-- XXX This extension point (tabmail-container) is only temporary!</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+           (See bug 460252 for details.)</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+           We will readd a mechanism for sidebar panes in bug 178003.</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+    --&gt;</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+  &lt;hbox id=&quot;tabmail-container&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+    &lt;tabbrowser id=&quot;tabmail&quot; flex=&quot;1&quot; panelcontainer=&quot;tabpanelcontainer&quot;&gt;</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+      &lt;box id=&quot;tabmail-buttons&quot; orientation=&quot;horizontal&quot;/&gt;</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+      &lt;tabpanels id=&quot;tabpanelcontainer&quot; flex=&quot;1&quot; class=&quot;plain&quot; selectedIndex=&quot;0&quot;&gt;</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+        &lt;!-- The main mail three pane frame --&gt;</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+        &lt;box id=&quot;mailContent&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+          &lt;box id=&quot;messengerBox&quot;</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+               orient=&quot;horizontal&quot;</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+               flex=&quot;1&quot;</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+               minheight=&quot;100&quot;</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+               height=&quot;100&quot;</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+               persist=&quot;height&quot;&gt;</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+            &lt;vbox id=&quot;folderPaneBox&quot;</span>
<a href="#l12.134"></a><span id="l12.134">                   minwidth=&quot;100&quot;</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-                  width=&quot;100&quot;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineminus">-                  persist=&quot;width&quot;</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-                  context=&quot;mailContext&quot;</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineminus">-                  class=&quot;window-focusborder&quot;</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-                  focusring=&quot;false&quot;/&gt;</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-          &lt;!-- extensions may overlay in additional panels; don't assume that there are only 2! --&gt;</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-        &lt;/deck&gt;</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineplus">+                  width=&quot;200&quot;</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+                  persist=&quot;collapsed width hidden&quot;&gt;</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineplus">+              &lt;tree id=&quot;folderTree&quot;</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+                    treelines=&quot;true&quot;</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineplus">+                    keepcurrentinview=&quot;true&quot;</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+                    flex=&quot;1&quot;</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineplus">+                    context=&quot;folderPaneContext&quot;</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+                    class=&quot;window-focusborder&quot;</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+                    focusring=&quot;false&quot;&gt;</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineplus">+                &lt;treechildren tooltip=&quot;folderpopup&quot;/&gt;</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineplus">+              &lt;/tree&gt;</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+            &lt;/vbox&gt;</span>
<a href="#l12.155"></a><span id="l12.155"> </span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-        &lt;!-- if you change this id, please change GetThreadAndMessagePaneSplitter() and MsgToggleMessagePane() --&gt;</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-        &lt;splitter id=&quot;threadpane-splitter&quot; collapse=&quot;after&quot; persist=&quot;state hidden&quot; collapsed=&quot;true&quot;</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-                  oncommand=&quot;OnClickThreadAndMessagePaneSplitter()&quot;&gt;</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-          &lt;grippy/&gt;</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-        &lt;/splitter&gt;</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineminus">-</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineminus">-        &lt;vbox id=&quot;messagepanebox&quot; flex=&quot;2&quot; minheight=&quot;100&quot; height=&quot;200&quot;</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-              minwidth=&quot;100&quot; width=&quot;200&quot; persist=&quot;height width&quot;</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-              class=&quot;window-focusborder&quot; focusring=&quot;false&quot;&gt;</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-          &lt;deck id=&quot;msgNotificationBar&quot;/&gt;</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+            &lt;splitter id=&quot;folderpane-splitter&quot;</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+                      collapse=&quot;before&quot;</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineplus">+                      resizeafter=&quot;grow&quot;</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineplus">+                      persist=&quot;state collapsed&quot;</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineplus">+                      oncommand=&quot;MsgToggleFolderPane(false);&quot;&gt;</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineplus">+              &lt;grippy/&gt;</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineplus">+            &lt;/splitter&gt;</span>
<a href="#l12.173"></a><span id="l12.173"> </span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-          &lt;hbox id=&quot;msgHeaderView&quot;/&gt;</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineplus">+            &lt;box id=&quot;messagesBox&quot; orient=&quot;vertical&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineplus">+              &lt;deck id=&quot;displayDeck&quot;</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineplus">+                    flex=&quot;1&quot;</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineplus">+                    selectedIndex=&quot;0&quot;</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineplus">+                    minheight=&quot;100&quot;</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineplus">+                    height=&quot;100&quot;</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineplus">+                    persist=&quot;height&quot;</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineplus">+                    onselect=&quot;ObserveDisplayDeckChange(event);&quot;&gt;</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineplus">+                &lt;!-- first panel in displayDeck is Account Central --&gt;</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+                &lt;vbox id=&quot;accountCentralBox&quot;&gt;</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+                  &lt;iframe name=&quot;accountCentralPane&quot;</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineplus">+                          width=&quot;150&quot;</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineplus">+                          flex=&quot;1&quot;</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineplus">+                          src=&quot;about:blank&quot;/&gt;</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineplus">+                &lt;/vbox&gt;</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineplus">+                &lt;!-- second panel is the threadPane --&gt;</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineplus">+                &lt;vbox id=&quot;threadPaneBox&quot;&gt;</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineplus">+                  &lt;hbox id=&quot;searchBoxHolder&quot;/&gt;</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineplus">+                  &lt;tree id=&quot;threadTree&quot;</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineplus">+                        treelines=&quot;true&quot;</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineplus">+                        keepcurrentinview=&quot;true&quot;</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineplus">+                        flex=&quot;1&quot;</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineplus">+                        minwidth=&quot;100&quot;</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineplus">+                        width=&quot;100&quot;</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineplus">+                        persist=&quot;width&quot;</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineplus">+                        context=&quot;mailContext&quot;</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineplus">+                        class=&quot;window-focusborder&quot;</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+                        focusring=&quot;false&quot;/&gt;</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineplus">+                &lt;/vbox&gt;</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+                &lt;!-- extensions may overlay in additional panels; don't assume that there are only 2! --&gt;</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+              &lt;/deck&gt;</span>
<a href="#l12.206"></a><span id="l12.206"> </span>
<a href="#l12.207"></a><span id="l12.207" class="difflineminus">-          &lt;browser id=&quot;messagepane&quot;</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineminus">-                   name=&quot;messagepane&quot;</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineminus">-                   height=&quot;0&quot;</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineminus">-                   flex=&quot;1&quot;</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-                   minwidth=&quot;1&quot;</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineminus">-                   minheight=&quot;1&quot;</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineminus">-                   tooltip=&quot;aHTMLTooltip&quot;</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineminus">-                   context=&quot;mailContext&quot;</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineminus">-                   disablesecurity=&quot;true&quot;</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineminus">-                   disablehistory=&quot;true&quot;</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineminus">-                   autofind=&quot;false&quot;</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineminus">-                   type=&quot;content-primary&quot;</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineminus">-                   onresize=&quot;return messagePaneOnResize(event);&quot;</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineminus">-                   onclick=&quot;return messagePaneOnClick(event);&quot;/&gt;</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineminus">-        &lt;/vbox&gt;</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineminus">-      &lt;/box&gt;</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineminus">-    &lt;/box&gt;</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-  &lt;/box&gt;</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-  &lt;panel id=&quot;customizeToolbarSheetPopup&quot;/&gt;</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineplus">+              &lt;!-- if you change this id, please change GetThreadAndMessagePaneSplitter() and MsgToggleMessagePane() --&gt;</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineplus">+              &lt;splitter id=&quot;threadpane-splitter&quot;</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineplus">+                        collapse=&quot;after&quot;</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineplus">+                        persist=&quot;state collapsed hidden&quot;</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineplus">+                        collapsed=&quot;true&quot;</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineplus">+                        oncommand=&quot;MsgToggleMessagePane(false);&quot;&gt;</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+                &lt;grippy/&gt;</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineplus">+              &lt;/splitter&gt;</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineplus">+</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineplus">+              &lt;vbox id=&quot;messagepanebox&quot;</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+                    flex=&quot;2&quot;</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineplus">+                    minheight=&quot;100&quot;</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineplus">+                    height=&quot;200&quot;</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineplus">+                    minwidth=&quot;100&quot;</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineplus">+                    width=&quot;200&quot;</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineplus">+                    persist=&quot;height width&quot;</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineplus">+                    class=&quot;window-focusborder&quot;</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineplus">+                    focusring=&quot;false&quot;&gt;</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineplus">+                &lt;deck id=&quot;msgNotificationBar&quot;/&gt;</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineplus">+                &lt;hbox id=&quot;msgHeaderView&quot;/&gt;</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineplus">+                &lt;browser id=&quot;messagepane&quot;</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineplus">+                         name=&quot;messagepane&quot;</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineplus">+                         height=&quot;0&quot;</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineplus">+                         flex=&quot;1&quot;</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineplus">+                         minwidth=&quot;1&quot;</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineplus">+                         minheight=&quot;1&quot;</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineplus">+                         tooltip=&quot;aHTMLTooltip&quot;</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineplus">+                         context=&quot;mailContext&quot;</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineplus">+                         disablesecurity=&quot;true&quot;</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineplus">+                         disablehistory=&quot;true&quot;</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineplus">+                         autofind=&quot;false&quot;</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineplus">+                         type=&quot;content-primary&quot;</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineplus">+                         onresize=&quot;return messagePaneOnResize(event);&quot;</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineplus">+                         onclick=&quot;return messagePaneOnClick(event);&quot;/&gt;</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+              &lt;/vbox&gt;</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+            &lt;/box&gt;</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+          &lt;/box&gt;</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineplus">+        &lt;/box&gt;</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineplus">+      &lt;/tabpanels&gt;</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+    &lt;/tabbrowser&gt;</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l12.267"></a><span id="l12.267"> </span>
<a href="#l12.268"></a><span id="l12.268">   &lt;statusbar id=&quot;status-bar&quot; class=&quot;chromeclass-status mailwindow-statusbar&quot;/&gt;</span>
<a href="#l12.269"></a><span id="l12.269"> &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/mailnews/msgHdrViewOverlay.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/mailnews/msgHdrViewOverlay.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.8"></a><span id="l13.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.9"></a><span id="l13.9">  *</span>
<a href="#l13.10"></a><span id="l13.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.11"></a><span id="l13.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.12"></a><span id="l13.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l13.13"></a><span id="l13.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l13.14"></a><span id="l13.14">  *</span>
<a href="#l13.15"></a><span id="l13.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineat">@@ -258,37 +258,35 @@ function OnLoadMsgHeaderPane()</span>
<a href="#l13.17"></a><span id="l13.17">   gShowReferences = pref.getBoolPref(&quot;mailnews.headers.showReferences&quot;);</span>
<a href="#l13.18"></a><span id="l13.18">   gShowMessageId = pref.getBoolPref(&quot;mailnews.headers.showMessageId&quot;);</span>
<a href="#l13.19"></a><span id="l13.19">   gExtraExpandedHeaders = pref.getCharPref(&quot;mailnews.headers.extraExpandedHeaders&quot;);</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21">   pref.addObserver(&quot;mail.showCondensedAddresses&quot;, MsgHdrViewObserver, false);</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">   initializeHeaderViewTables();</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-  var toggleHeaderView = document.getElementById(&quot;msgHeaderView&quot;);</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+  var toggleHeaderView = GetHeaderPane();</span>
<a href="#l13.27"></a><span id="l13.27">   var initialCollapsedSetting = toggleHeaderView.getAttribute(&quot;state&quot;);</span>
<a href="#l13.28"></a><span id="l13.28">   if (initialCollapsedSetting == &quot;true&quot;)</span>
<a href="#l13.29"></a><span id="l13.29">     gCollapsedHeaderViewMode = true;   </span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31">   // dispatch an event letting any listeners know that we have loaded the message pane</span>
<a href="#l13.32"></a><span id="l13.32">   var event = document.createEvent('Events');</span>
<a href="#l13.33"></a><span id="l13.33">   event.initEvent('messagepane-loaded', false, true);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  var headerViewElement = document.getElementById(&quot;msgHeaderView&quot;);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-  headerViewElement.dispatchEvent(event);</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+  toggleHeaderView.dispatchEvent(event);</span>
<a href="#l13.37"></a><span id="l13.37"> }</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39"> function OnUnloadMsgHeaderPane()</span>
<a href="#l13.40"></a><span id="l13.40"> {</span>
<a href="#l13.41"></a><span id="l13.41">   pref.removeObserver(&quot;mail.showCondensedAddresses&quot;, MsgHdrViewObserver);</span>
<a href="#l13.42"></a><span id="l13.42"> </span>
<a href="#l13.43"></a><span id="l13.43">   // dispatch an event letting any listeners know that we have unloaded the message pane</span>
<a href="#l13.44"></a><span id="l13.44">   var event = document.createEvent('Events');</span>
<a href="#l13.45"></a><span id="l13.45">   event.initEvent('messagepane-unloaded', false, true);</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-  var headerViewElement = document.getElementById(&quot;msgHeaderView&quot;);</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-  headerViewElement.dispatchEvent(event);</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+  GetHeaderPane().dispatchEvent(event);</span>
<a href="#l13.49"></a><span id="l13.49"> }</span>
<a href="#l13.50"></a><span id="l13.50"> </span>
<a href="#l13.51"></a><span id="l13.51"> const MsgHdrViewObserver =</span>
<a href="#l13.52"></a><span id="l13.52"> {</span>
<a href="#l13.53"></a><span id="l13.53">   observe: function(subject, topic, prefName)</span>
<a href="#l13.54"></a><span id="l13.54">   {</span>
<a href="#l13.55"></a><span id="l13.55">     // verify that we're changing the mail pane config pref</span>
<a href="#l13.56"></a><span id="l13.56">     if (topic == &quot;nsPref:changed&quot;)</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineat">@@ -713,24 +711,23 @@ function updateHeaderViews()</span>
<a href="#l13.58"></a><span id="l13.58">   }</span>
<a href="#l13.59"></a><span id="l13.59">   else</span>
<a href="#l13.60"></a><span id="l13.60">   {</span>
<a href="#l13.61"></a><span id="l13.61">     showHeaderView(gExpandedHeaderView);</span>
<a href="#l13.62"></a><span id="l13.62">     displayAttachmentsForExpandedView();</span>
<a href="#l13.63"></a><span id="l13.63">   }</span>
<a href="#l13.64"></a><span id="l13.64"> }</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-function ToggleHeaderView ()</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+function ToggleHeaderView()</span>
<a href="#l13.68"></a><span id="l13.68"> {</span>
<a href="#l13.69"></a><span id="l13.69">   var expandedNode = document.getElementById(&quot;expandedHeaderView&quot;);</span>
<a href="#l13.70"></a><span id="l13.70">   var collapsedNode = document.getElementById(&quot;collapsedHeaderView&quot;);</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-  var toggleHeaderView = document.getElementById(&quot;msgHeaderView&quot;);</span>
<a href="#l13.72"></a><span id="l13.72"> </span>
<a href="#l13.73"></a><span id="l13.73">   if (gCollapsedHeaderViewMode)</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-  {          </span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+  {</span>
<a href="#l13.76"></a><span id="l13.76">     gCollapsedHeaderViewMode = false;</span>
<a href="#l13.77"></a><span id="l13.77">     // hide the current view</span>
<a href="#l13.78"></a><span id="l13.78">     hideHeaderView(gCollapsedHeaderView);</span>
<a href="#l13.79"></a><span id="l13.79">     // update the current view</span>
<a href="#l13.80"></a><span id="l13.80">     UpdateMessageHeaders();</span>
<a href="#l13.81"></a><span id="l13.81">     </span>
<a href="#l13.82"></a><span id="l13.82">     // now uncollapse / collapse the right views</span>
<a href="#l13.83"></a><span id="l13.83">     expandedNode.collapsed = false;</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineat">@@ -744,16 +741,17 @@ function ToggleHeaderView ()</span>
<a href="#l13.85"></a><span id="l13.85">     // update the current view</span>
<a href="#l13.86"></a><span id="l13.86">     UpdateMessageHeaders();</span>
<a href="#l13.87"></a><span id="l13.87">     </span>
<a href="#l13.88"></a><span id="l13.88">     // now uncollapse / collapse the right views</span>
<a href="#l13.89"></a><span id="l13.89">     collapsedNode.collapsed = false;</span>
<a href="#l13.90"></a><span id="l13.90">     expandedNode.collapsed = true;</span>
<a href="#l13.91"></a><span id="l13.91">   }  </span>
<a href="#l13.92"></a><span id="l13.92"> </span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+  var toggleHeaderView = GetHeaderPane();</span>
<a href="#l13.94"></a><span id="l13.94">   if (gCollapsedHeaderViewMode)</span>
<a href="#l13.95"></a><span id="l13.95">     toggleHeaderView.setAttribute(&quot;state&quot;, &quot;true&quot;);</span>
<a href="#l13.96"></a><span id="l13.96">   else</span>
<a href="#l13.97"></a><span id="l13.97">     toggleHeaderView.setAttribute(&quot;state&quot;, &quot;false&quot;);</span>
<a href="#l13.98"></a><span id="l13.98"> }</span>
<a href="#l13.99"></a><span id="l13.99"> </span>
<a href="#l13.100"></a><span id="l13.100"> // default method for updating a header value into a header entry</span>
<a href="#l13.101"></a><span id="l13.101"> function updateHeaderValue(headerEntry, headerValue)</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineat">@@ -908,17 +906,17 @@ function ShowMessageHeaderPane()</span>
<a href="#l13.103"></a><span id="l13.103">     node = document.getElementById(&quot;expandedHeaderView&quot;);</span>
<a href="#l13.104"></a><span id="l13.104">     if (node)</span>
<a href="#l13.105"></a><span id="l13.105">       node.collapsed = false;</span>
<a href="#l13.106"></a><span id="l13.106">   }</span>
<a href="#l13.107"></a><span id="l13.107"> </span>
<a href="#l13.108"></a><span id="l13.108">   /* workaround for 39655 */</span>
<a href="#l13.109"></a><span id="l13.109">   if (gFolderJustSwitched) </span>
<a href="#l13.110"></a><span id="l13.110">   {</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineminus">-    var el = document.getElementById(&quot;msgHeaderView&quot;);</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+    let el = GetHeaderPane();</span>
<a href="#l13.113"></a><span id="l13.113">     el.setAttribute(&quot;style&quot;, el.getAttribute(&quot;style&quot;));</span>
<a href="#l13.114"></a><span id="l13.114">     gFolderJustSwitched = false;    </span>
<a href="#l13.115"></a><span id="l13.115">   }</span>
<a href="#l13.116"></a><span id="l13.116"> }</span>
<a href="#l13.117"></a><span id="l13.117"> </span>
<a href="#l13.118"></a><span id="l13.118"> function HideMessageHeaderPane()</span>
<a href="#l13.119"></a><span id="l13.119"> {</span>
<a href="#l13.120"></a><span id="l13.120">   var node = document.getElementById(&quot;collapsedHeaderView&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.8"></a><span id="l14.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.9"></a><span id="l14.9">  *</span>
<a href="#l14.10"></a><span id="l14.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.11"></a><span id="l14.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.12"></a><span id="l14.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l14.13"></a><span id="l14.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l14.14"></a><span id="l14.14">  *</span>
<a href="#l14.15"></a><span id="l14.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineat">@@ -20,16 +20,17 @@</span>
<a href="#l14.17"></a><span id="l14.17">  * Portions created by the Initial Developer are Copyright (C) 1998-1999</span>
<a href="#l14.18"></a><span id="l14.18">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l14.19"></a><span id="l14.19">  *</span>
<a href="#l14.20"></a><span id="l14.20">  * Contributor(s):</span>
<a href="#l14.21"></a><span id="l14.21">  *   Jan Varga (varga@ku.sk)</span>
<a href="#l14.22"></a><span id="l14.22">  *   Hkan Waara (hwaara@chello.se)</span>
<a href="#l14.23"></a><span id="l14.23">  *   Neil Rashbrook (neil@parkwaycc.co.uk)</span>
<a href="#l14.24"></a><span id="l14.24">  *   Seth Spitzer &lt;sspitzer@netscape.com&gt;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+ *   Karsten Dsterloh &lt;mnyromyr@tprac.de&gt;</span>
<a href="#l14.26"></a><span id="l14.26">  *</span>
<a href="#l14.27"></a><span id="l14.27">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.28"></a><span id="l14.28">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l14.29"></a><span id="l14.29">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.30"></a><span id="l14.30">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.31"></a><span id="l14.31">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.32"></a><span id="l14.32">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.33"></a><span id="l14.33">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineat">@@ -43,20 +44,18 @@</span>
<a href="#l14.35"></a><span id="l14.35"> /* This is where functions related to the 3 pane window are kept */</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37"> // from MailNewsTypes.h</span>
<a href="#l14.38"></a><span id="l14.38"> const nsMsgKey_None = 0xFFFFFFFF;</span>
<a href="#l14.39"></a><span id="l14.39"> const nsMsgViewIndex_None = 0xFFFFFFFF;</span>
<a href="#l14.40"></a><span id="l14.40"> const kMailCheckOncePrefName = &quot;mail.startup.enabledMailCheckOnce&quot;;</span>
<a href="#l14.41"></a><span id="l14.41"> </span>
<a href="#l14.42"></a><span id="l14.42"> var gFolderTree;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-var gMessagePane;</span>
<a href="#l14.44"></a><span id="l14.44"> var gSearchInput;</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-var gThreadAndMessagePaneSplitter = null;</span>
<a href="#l14.47"></a><span id="l14.47"> var gUnreadCount = null;</span>
<a href="#l14.48"></a><span id="l14.48"> var gTotalCount = null;</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50"> var gCurrentLoadingFolderURI;</span>
<a href="#l14.51"></a><span id="l14.51"> var gCurrentFolderToReroot;</span>
<a href="#l14.52"></a><span id="l14.52"> var gCurrentLoadingFolderSortType = 0;</span>
<a href="#l14.53"></a><span id="l14.53"> var gCurrentLoadingFolderSortOrder = 0;</span>
<a href="#l14.54"></a><span id="l14.54"> var gCurrentLoadingFolderViewType = 0;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineat">@@ -87,16 +86,18 @@ var gThreadPaneDeleteOrMoveOccurred = fa</span>
<a href="#l14.56"></a><span id="l14.56"> var gHaveLoadedMessage;</span>
<a href="#l14.57"></a><span id="l14.57"> </span>
<a href="#l14.58"></a><span id="l14.58"> var gDisplayStartupPage = false;</span>
<a href="#l14.59"></a><span id="l14.59"> </span>
<a href="#l14.60"></a><span id="l14.60"> function SelectAndScrollToKey(aMsgKey)</span>
<a href="#l14.61"></a><span id="l14.61"> {</span>
<a href="#l14.62"></a><span id="l14.62">   // select the desired message</span>
<a href="#l14.63"></a><span id="l14.63">   // if the key isn't found, we won't select anything</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+  if (!gDBView)</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+    return false;</span>
<a href="#l14.66"></a><span id="l14.66">   gDBView.selectMsgByKey(aMsgKey);</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68">   // is there a selection?</span>
<a href="#l14.69"></a><span id="l14.69">   // if not, bail out.</span>
<a href="#l14.70"></a><span id="l14.70">   var indicies = GetSelectedIndices(gDBView);</span>
<a href="#l14.71"></a><span id="l14.71">   if (!indicies || !indicies.length)</span>
<a href="#l14.72"></a><span id="l14.72">     return false;</span>
<a href="#l14.73"></a><span id="l14.73"> </span>
<a href="#l14.74"></a><span id="l14.74" class="difflineat">@@ -121,17 +122,17 @@ function ScrollToMessageAfterFolderLoad(</span>
<a href="#l14.75"></a><span id="l14.75">       scrolled = SelectAndScrollToKey(lastMessageLoaded);</span>
<a href="#l14.76"></a><span id="l14.76">   }</span>
<a href="#l14.77"></a><span id="l14.77"> </span>
<a href="#l14.78"></a><span id="l14.78">   if (!scrolled)</span>
<a href="#l14.79"></a><span id="l14.79">   {</span>
<a href="#l14.80"></a><span id="l14.80">     // if we still haven't scrolled,</span>
<a href="#l14.81"></a><span id="l14.81">     // scroll to the newest, which might be the top or the bottom</span>
<a href="#l14.82"></a><span id="l14.82">     // depending on our sort order and sort type</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-    if (gDBView.sortOrder == nsMsgViewSortOrder.ascending)</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+    if (gDBView &amp;&amp; gDBView.sortOrder == nsMsgViewSortOrder.ascending)</span>
<a href="#l14.85"></a><span id="l14.85">     {</span>
<a href="#l14.86"></a><span id="l14.86">       switch (gDBView.sortType)</span>
<a href="#l14.87"></a><span id="l14.87">       {</span>
<a href="#l14.88"></a><span id="l14.88">         case nsMsgViewSortType.byDate:</span>
<a href="#l14.89"></a><span id="l14.89">         case nsMsgViewSortType.byReceived:</span>
<a href="#l14.90"></a><span id="l14.90">         case nsMsgViewSortType.byId:</span>
<a href="#l14.91"></a><span id="l14.91">         case nsMsgViewSortType.byThread:</span>
<a href="#l14.92"></a><span id="l14.92">          scrolled = ScrollToMessage(nsMsgNavigationType.lastMessage, true, false /* selectMessage */);</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineat">@@ -142,37 +143,58 @@ function ScrollToMessageAfterFolderLoad(</span>
<a href="#l14.94"></a><span id="l14.94">     // if still we haven't scrolled,</span>
<a href="#l14.95"></a><span id="l14.95">     // scroll to the top.</span>
<a href="#l14.96"></a><span id="l14.96">     if (!scrolled)</span>
<a href="#l14.97"></a><span id="l14.97">       EnsureRowInThreadTreeIsVisible(0);</span>
<a href="#l14.98"></a><span id="l14.98">   }</span>
<a href="#l14.99"></a><span id="l14.99"> }</span>
<a href="#l14.100"></a><span id="l14.100"> </span>
<a href="#l14.101"></a><span id="l14.101"> // the folderListener object</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-var folderListener = {</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-    OnItemAdded: function(parentItem, item) { },</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+var folderListener =</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+{</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+  OnItemAdded:   function(parentItem, item) {},</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+  OnItemRemoved: function(parentItem, item) {},</span>
<a href="#l14.108"></a><span id="l14.108"> </span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-    OnItemRemoved: function(parentItem, item) { },</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-    OnItemPropertyChanged: function(item, property, oldValue, newValue) { },</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+  OnItemPropertyChanged:        function(item, property, oldValue, newValue) {},</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+  OnItemBoolPropertyChanged:    function(item, property, oldValue, newValue) {},</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+  OnItemUnicharPropertyChanged: function(item, property, oldValue, newValue) {},</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+  OnItemPropertyFlagChanged:    function(item, property, oldFlag,  newFlag)  {},</span>
<a href="#l14.116"></a><span id="l14.116"> </span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-    OnItemIntPropertyChanged: function(item, property, oldValue, newValue) {</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-      if (item == gMsgFolderSelected) {</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-        if(property.toString() == &quot;TotalMessages&quot; || property.toString() == &quot;TotalUnreadMessages&quot;) {</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-          UpdateStatusMessageCounts(gMsgFolderSelected);</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-          item = item.QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-          UpdateLocationBar(item);</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineplus">+  OnItemIntPropertyChanged: function(item, property, oldValue, newValue)</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineplus">+  {</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineplus">+    // handle the currently visible folder</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineplus">+    if (item == gMsgFolderSelected)</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+    {</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+      let prop = property.toString();</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+      if (prop == &quot;TotalMessages&quot; || prop == &quot;TotalUnreadMessages&quot;)</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineplus">+      {</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+        UpdateStatusMessageCounts(gMsgFolderSelected);</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+        item = item.QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineplus">+        UpdateLocationBar(item);</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+      }</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+    }</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineplus">+    // check folders shown in tabs</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineplus">+    if (item instanceof Components.interfaces.nsIMsgFolder)</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineplus">+    {</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineplus">+      // find corresponding tabinfos</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineplus">+      // we may have the folder openened in more than one tab</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+      let tabmail = GetTabMail();</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+      for (let i = 0; i &lt; tabmail.tabInfo.length; ++i)</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+      {</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+        // if we never switched away from the tab, we only have just one</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+        let tabFolder = tabmail.tabInfo[i].msgSelectedFolder || gMsgFolderSelected;</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineplus">+        if (tabFolder == item)</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+        {</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+          // update tab title incl. any icon styles</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineplus">+          tabmail.setTabTitle(tabmail.tabInfo[i]);</span>
<a href="#l14.151"></a><span id="l14.151">         }</span>
<a href="#l14.152"></a><span id="l14.152">       }</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-    },</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-    OnItemBoolPropertyChanged: function(item, property, oldValue, newValue) { },</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-    OnItemUnicharPropertyChanged: function(item, property, oldValue, newValue) { },</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-    OnItemPropertyFlagChanged: function(item, property, oldFlag, newFlag) { },</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineplus">+    }</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineplus">+  },</span>
<a href="#l14.161"></a><span id="l14.161"> </span>
<a href="#l14.162"></a><span id="l14.162">     OnItemEvent: function(folder, event) {</span>
<a href="#l14.163"></a><span id="l14.163">       var eventType = event.toString();</span>
<a href="#l14.164"></a><span id="l14.164">       if (eventType == &quot;FolderLoaded&quot;) {</span>
<a href="#l14.165"></a><span id="l14.165">         if (folder) {</span>
<a href="#l14.166"></a><span id="l14.166">           const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l14.167"></a><span id="l14.167">           var scrolled = false;</span>
<a href="#l14.168"></a><span id="l14.168">           var msgFolder = folder.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineat">@@ -229,17 +251,18 @@ var folderListener = {</span>
<a href="#l14.170"></a><span id="l14.170">             // gSearchNotificationListener.OnSearchDone (see searchBar.js).</span>
<a href="#l14.171"></a><span id="l14.171">             if (!scrolled &amp;&amp; !(gMsgFolderSelected.flags &amp; nsMsgFolderFlags.Virtual))</span>
<a href="#l14.172"></a><span id="l14.172">               ScrollToMessageAfterFolderLoad(msgFolder);</span>
<a href="#l14.173"></a><span id="l14.173">             SetBusyCursor(window, false);</span>
<a href="#l14.174"></a><span id="l14.174">           }</span>
<a href="#l14.175"></a><span id="l14.175">           // Folder loading is over,</span>
<a href="#l14.176"></a><span id="l14.176">           // now issue quick search if there is an email address.</span>
<a href="#l14.177"></a><span id="l14.177">           viewDebug(&quot;in folder loaded gVirtualFolderTerms = &quot; + gVirtualFolderTerms + &quot;\n&quot;);</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-          viewDebug(&quot;in folder loaded gMsgFolderSelected = &quot; + gMsgFolderSelected.URI + &quot;\n&quot;);</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineplus">+          viewDebug(&quot;in folder loaded gMsgFolderSelected = &quot; +</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineplus">+                    gMsgFolderSelected &amp;&amp; gMsgFolderSelected.URI + &quot;\n&quot;);</span>
<a href="#l14.181"></a><span id="l14.181">           if (rerootingFolder)</span>
<a href="#l14.182"></a><span id="l14.182">           {</span>
<a href="#l14.183"></a><span id="l14.183">             if (gSearchEmailAddress)</span>
<a href="#l14.184"></a><span id="l14.184">             {</span>
<a href="#l14.185"></a><span id="l14.185">               Search(gSearchEmailAddress);</span>
<a href="#l14.186"></a><span id="l14.186">               gSearchEmailAddress = null;</span>
<a href="#l14.187"></a><span id="l14.187">             }</span>
<a href="#l14.188"></a><span id="l14.188">             else if (gVirtualFolderTerms)</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineat">@@ -633,35 +656,36 @@ var gThreePaneIncomingServerListener = {</span>
<a href="#l14.190"></a><span id="l14.190">           // we've made a new selection, we're done</span>
<a href="#l14.191"></a><span id="l14.191">           return;</span>
<a href="#l14.192"></a><span id="l14.192">         }</span>
<a href="#l14.193"></a><span id="l14.193">       }</span>
<a href="#l14.194"></a><span id="l14.194">     }</span>
<a href="#l14.195"></a><span id="l14.195"> }</span>
<a href="#l14.196"></a><span id="l14.196"> </span>
<a href="#l14.197"></a><span id="l14.197"> function UpdateMailPaneConfig() {</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-  const dynamicIds = [&quot;messagesBox&quot;, &quot;mailContent&quot;, &quot;threadPaneBox&quot;];</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineplus">+  const dynamicIds = [&quot;messagesBox&quot;, &quot;mailContent&quot;, &quot;messengerBox&quot;];</span>
<a href="#l14.200"></a><span id="l14.200">   var desiredId = dynamicIds[pref.getIntPref(&quot;mail.pane_config.dynamic&quot;)];</span>
<a href="#l14.201"></a><span id="l14.201">   var messagePane = GetMessagePane();</span>
<a href="#l14.202"></a><span id="l14.202">   if (messagePane.parentNode.id != desiredId) {</span>
<a href="#l14.203"></a><span id="l14.203">     ClearAttachmentList();</span>
<a href="#l14.204"></a><span id="l14.204">     var messagePaneSplitter = GetThreadAndMessagePaneSplitter();</span>
<a href="#l14.205"></a><span id="l14.205">     var desiredParent = document.getElementById(desiredId);</span>
<a href="#l14.206"></a><span id="l14.206">     // See Bug 381992. The ctor for the browser element will fire again when we</span>
<a href="#l14.207"></a><span id="l14.207">     // re-insert the messagePaneBox back into the document.</span>
<a href="#l14.208"></a><span id="l14.208">     // But the dtor doesn't fire when the element is removed from the document.</span>
<a href="#l14.209"></a><span id="l14.209">     // Manually call destroy here to avoid a nasty leak.</span>
<a href="#l14.210"></a><span id="l14.210">     getMessageBrowser().destroy();</span>
<a href="#l14.211"></a><span id="l14.211">     desiredParent.appendChild(messagePaneSplitter);</span>
<a href="#l14.212"></a><span id="l14.212">     desiredParent.appendChild(messagePane);</span>
<a href="#l14.213"></a><span id="l14.213">     messagePaneSplitter.orient = desiredParent.orient;</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineminus">-    messenger.setWindow(null, null);</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineminus">-    messenger.setWindow(window, msgWindow);</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineminus">-    if (gDBView &amp;&amp; GetNumSelectedMessages() == 1)</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineminus">-      gDBView.reloadMessage();</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineplus">+    // Reroot message display</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineplus">+    InvalidateTabDBs();</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineplus">+    let tabmail = GetTabMail();</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineplus">+    tabmail.currentTabInfo = null;</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineplus">+    tabmail.updateCurrentTab();</span>
<a href="#l14.223"></a><span id="l14.223">   }</span>
<a href="#l14.224"></a><span id="l14.224"> }</span>
<a href="#l14.225"></a><span id="l14.225"> </span>
<a href="#l14.226"></a><span id="l14.226"> const MailPaneConfigObserver = {</span>
<a href="#l14.227"></a><span id="l14.227">   observe: function observe(subject, topic, prefName) {</span>
<a href="#l14.228"></a><span id="l14.228">     // verify that we're changing the mail pane config pref</span>
<a href="#l14.229"></a><span id="l14.229">     if (topic == &quot;nsPref:changed&quot;)</span>
<a href="#l14.230"></a><span id="l14.230">       UpdateMailPaneConfig();</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineat">@@ -673,16 +697,22 @@ function OnLoadMessenger()</span>
<a href="#l14.232"></a><span id="l14.232"> {</span>
<a href="#l14.233"></a><span id="l14.233">   AddMailOfflineObserver();</span>
<a href="#l14.234"></a><span id="l14.234">   CreateMailWindowGlobals();</span>
<a href="#l14.235"></a><span id="l14.235">   pref.addObserver(&quot;mail.pane_config.dynamic&quot;, MailPaneConfigObserver, false);</span>
<a href="#l14.236"></a><span id="l14.236">   UpdateMailPaneConfig();</span>
<a href="#l14.237"></a><span id="l14.237">   Create3PaneGlobals();</span>
<a href="#l14.238"></a><span id="l14.238">   verifyAccounts(null, false);</span>
<a href="#l14.239"></a><span id="l14.239"> </span>
<a href="#l14.240"></a><span id="l14.240" class="difflineplus">+  // initialize tabmail system - see tabmail.js and tabmail.xml for details</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineplus">+  let tabmail = GetTabMail();</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineplus">+  tabmail.registerTabType(gMailNewsTabsType);</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineplus">+  tabmail.openFirstTab();</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineplus">+  window.tryToClose = MailWindowIsClosing;</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineplus">+</span>
<a href="#l14.246"></a><span id="l14.246">   InitMsgWindow();</span>
<a href="#l14.247"></a><span id="l14.247">   messenger.setWindow(window, msgWindow);</span>
<a href="#l14.248"></a><span id="l14.248"> </span>
<a href="#l14.249"></a><span id="l14.249">   InitializeDataSources();</span>
<a href="#l14.250"></a><span id="l14.250">   InitPanes();</span>
<a href="#l14.251"></a><span id="l14.251"> </span>
<a href="#l14.252"></a><span id="l14.252">   MigrateJunkMailSettings();</span>
<a href="#l14.253"></a><span id="l14.253"> </span>
<a href="#l14.254"></a><span id="l14.254" class="difflineat">@@ -742,22 +772,56 @@ function OnLoadMessenger()</span>
<a href="#l14.255"></a><span id="l14.255"> }</span>
<a href="#l14.256"></a><span id="l14.256"> </span>
<a href="#l14.257"></a><span id="l14.257"> function OnUnloadMessenger()</span>
<a href="#l14.258"></a><span id="l14.258"> {</span>
<a href="#l14.259"></a><span id="l14.259">   pref.removeObserver(&quot;mail.pane_config.dynamic&quot;, MailPaneConfigObserver, false);</span>
<a href="#l14.260"></a><span id="l14.260"> </span>
<a href="#l14.261"></a><span id="l14.261">   OnLeavingFolder(gMsgFolderSelected);  // mark all read in current folder</span>
<a href="#l14.262"></a><span id="l14.262">   accountManager.removeIncomingServerListener(gThreePaneIncomingServerListener);</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineplus">+  GetTabMail().closeTabs();</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineplus">+</span>
<a href="#l14.265"></a><span id="l14.265">   // FIX ME - later we will be able to use onload from the overlay</span>
<a href="#l14.266"></a><span id="l14.266">   OnUnloadMsgHeaderPane();</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineplus">+  UnloadPanes();</span>
<a href="#l14.268"></a><span id="l14.268" class="difflineplus">+  OnMailWindowUnload();</span>
<a href="#l14.269"></a><span id="l14.269" class="difflineplus">+}</span>
<a href="#l14.270"></a><span id="l14.270"> </span>
<a href="#l14.271"></a><span id="l14.271" class="difflineminus">-  UnloadPanes();</span>
<a href="#l14.272"></a><span id="l14.272" class="difflineminus">-</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineminus">-  OnMailWindowUnload();</span>
<a href="#l14.274"></a><span id="l14.274" class="difflineplus">+// we probably want to warn if more than one tab is closed</span>
<a href="#l14.275"></a><span id="l14.275" class="difflineplus">+function MailWindowIsClosing()</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineplus">+{</span>
<a href="#l14.277"></a><span id="l14.277" class="difflineplus">+  let reallyClose = true;</span>
<a href="#l14.278"></a><span id="l14.278" class="difflineplus">+  let numtabs = GetTabMail().tabInfo.length;</span>
<a href="#l14.279"></a><span id="l14.279" class="difflineplus">+  if (numtabs &gt; 1)</span>
<a href="#l14.280"></a><span id="l14.280" class="difflineplus">+  {</span>
<a href="#l14.281"></a><span id="l14.281" class="difflineplus">+    let shouldPrompt = pref.getBoolPref(&quot;browser.tabs.warnOnClose&quot;);</span>
<a href="#l14.282"></a><span id="l14.282" class="difflineplus">+    if (shouldPrompt)</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineplus">+    {</span>
<a href="#l14.284"></a><span id="l14.284" class="difflineplus">+      let promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l14.285"></a><span id="l14.285" class="difflineplus">+                                    .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l14.286"></a><span id="l14.286" class="difflineplus">+      // default to true: if it were false, we wouldn't get this far</span>
<a href="#l14.287"></a><span id="l14.287" class="difflineplus">+      let warnOnClose = {value: true};</span>
<a href="#l14.288"></a><span id="l14.288" class="difflineplus">+      let buttonPressed = promptService.confirmEx(</span>
<a href="#l14.289"></a><span id="l14.289" class="difflineplus">+        window,</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineplus">+        gMessengerBundle.getString('tabs.closeWarningTitle'),</span>
<a href="#l14.291"></a><span id="l14.291" class="difflineplus">+        gMessengerBundle.getFormattedString(&quot;tabs.closeWarning&quot;, [numtabs], 1),</span>
<a href="#l14.292"></a><span id="l14.292" class="difflineplus">+        (promptService.BUTTON_TITLE_IS_STRING * promptService.BUTTON_POS_0) +</span>
<a href="#l14.293"></a><span id="l14.293" class="difflineplus">+          (promptService.BUTTON_TITLE_CANCEL * promptService.BUTTON_POS_1),</span>
<a href="#l14.294"></a><span id="l14.294" class="difflineplus">+        gMessengerBundle.getString('tabs.closeButton'),</span>
<a href="#l14.295"></a><span id="l14.295" class="difflineplus">+        null,</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineplus">+        null,</span>
<a href="#l14.297"></a><span id="l14.297" class="difflineplus">+        gMessengerBundle.getString('tabs.closeWarningPromptMe'),</span>
<a href="#l14.298"></a><span id="l14.298" class="difflineplus">+        warnOnClose);</span>
<a href="#l14.299"></a><span id="l14.299" class="difflineplus">+      reallyClose = (buttonPressed == 0);</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineplus">+      // don't set the pref unless OK was pressed and it's false</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineplus">+      if (reallyClose &amp;&amp; !warnOnClose.value)</span>
<a href="#l14.302"></a><span id="l14.302" class="difflineplus">+        pref.setBoolPref(&quot;browser.tabs.warnOnClose&quot;, false);</span>
<a href="#l14.303"></a><span id="l14.303" class="difflineplus">+    }</span>
<a href="#l14.304"></a><span id="l14.304" class="difflineplus">+  }</span>
<a href="#l14.305"></a><span id="l14.305" class="difflineplus">+  return reallyClose;</span>
<a href="#l14.306"></a><span id="l14.306"> }</span>
<a href="#l14.307"></a><span id="l14.307"> </span>
<a href="#l14.308"></a><span id="l14.308"> function NotifyObservers(aSubject, aTopic, aData)</span>
<a href="#l14.309"></a><span id="l14.309"> {</span>
<a href="#l14.310"></a><span id="l14.310">   Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l14.311"></a><span id="l14.311">             .getService(Components.interfaces.nsIObserverService)</span>
<a href="#l14.312"></a><span id="l14.312">             .notifyObservers(aSubject, aTopic, aData);</span>
<a href="#l14.313"></a><span id="l14.313"> }</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineat">@@ -778,17 +842,16 @@ function loadStartFolder(initialUri)</span>
<a href="#l14.315"></a><span id="l14.315">     var isLoginAtStartUpEnabled = false;</span>
<a href="#l14.316"></a><span id="l14.316"> </span>
<a href="#l14.317"></a><span id="l14.317">     //First get default account</span>
<a href="#l14.318"></a><span id="l14.318">     try</span>
<a href="#l14.319"></a><span id="l14.319">     {</span>
<a href="#l14.320"></a><span id="l14.320">         if (!initialUri)</span>
<a href="#l14.321"></a><span id="l14.321">         {</span>
<a href="#l14.322"></a><span id="l14.322">             // Startup time.</span>
<a href="#l14.323"></a><span id="l14.323" class="difflineminus">-</span>
<a href="#l14.324"></a><span id="l14.324">             defaultServer = accountManager.defaultAccount.incomingServer;</span>
<a href="#l14.325"></a><span id="l14.325"> </span>
<a href="#l14.326"></a><span id="l14.326">             // set the initialUri to the server, so we select it</span>
<a href="#l14.327"></a><span id="l14.327">             // so we'll get account central</span>
<a href="#l14.328"></a><span id="l14.328">             initialUri = defaultServer.serverURI;</span>
<a href="#l14.329"></a><span id="l14.329"> </span>
<a href="#l14.330"></a><span id="l14.330">             // Enable check new mail once by turning checkmail pref 'on' to bring</span>
<a href="#l14.331"></a><span id="l14.331">             // all users to one plane. This allows all users to go to Inbox. User can</span>
<a href="#l14.332"></a><span id="l14.332" class="difflineat">@@ -1057,23 +1120,16 @@ function GetFolderTree()</span>
<a href="#l14.333"></a><span id="l14.333"> </span>
<a href="#l14.334"></a><span id="l14.334"> function GetSearchInput()</span>
<a href="#l14.335"></a><span id="l14.335"> {</span>
<a href="#l14.336"></a><span id="l14.336">   if (!gSearchInput)</span>
<a href="#l14.337"></a><span id="l14.337">     gSearchInput = document.getElementById(&quot;searchInput&quot;);</span>
<a href="#l14.338"></a><span id="l14.338">   return gSearchInput;</span>
<a href="#l14.339"></a><span id="l14.339"> }</span>
<a href="#l14.340"></a><span id="l14.340"> </span>
<a href="#l14.341"></a><span id="l14.341" class="difflineminus">-function GetMessagePane()</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineminus">-{</span>
<a href="#l14.343"></a><span id="l14.343" class="difflineminus">-  if (!gMessagePane)</span>
<a href="#l14.344"></a><span id="l14.344" class="difflineminus">-    gMessagePane = document.getElementById(&quot;messagepanebox&quot;);</span>
<a href="#l14.345"></a><span id="l14.345" class="difflineminus">-  return gMessagePane;</span>
<a href="#l14.346"></a><span id="l14.346" class="difflineminus">-}</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineminus">-</span>
<a href="#l14.348"></a><span id="l14.348"> function GetMessagePaneFrame()</span>
<a href="#l14.349"></a><span id="l14.349"> {</span>
<a href="#l14.350"></a><span id="l14.350">   return window.content;</span>
<a href="#l14.351"></a><span id="l14.351"> }</span>
<a href="#l14.352"></a><span id="l14.352"> </span>
<a href="#l14.353"></a><span id="l14.353"> function FindInSidebar(currentWindow, id)</span>
<a href="#l14.354"></a><span id="l14.354"> {</span>
<a href="#l14.355"></a><span id="l14.355">   var item = currentWindow.document.getElementById(id);</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineat">@@ -1085,47 +1141,30 @@ function FindInSidebar(currentWindow, id</span>
<a href="#l14.357"></a><span id="l14.357">     var frameItem = FindInSidebar(currentWindow.frames[i], id);</span>
<a href="#l14.358"></a><span id="l14.358">     if (frameItem)</span>
<a href="#l14.359"></a><span id="l14.359">       return frameItem;</span>
<a href="#l14.360"></a><span id="l14.360">   }</span>
<a href="#l14.361"></a><span id="l14.361"> </span>
<a href="#l14.362"></a><span id="l14.362">   return null;</span>
<a href="#l14.363"></a><span id="l14.363"> }</span>
<a href="#l14.364"></a><span id="l14.364"> </span>
<a href="#l14.365"></a><span id="l14.365" class="difflineminus">-function GetThreadAndMessagePaneSplitter()</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineminus">-{</span>
<a href="#l14.367"></a><span id="l14.367" class="difflineminus">-  if (!gThreadAndMessagePaneSplitter)</span>
<a href="#l14.368"></a><span id="l14.368" class="difflineminus">-    gThreadAndMessagePaneSplitter = document.getElementById('threadpane-splitter');</span>
<a href="#l14.369"></a><span id="l14.369" class="difflineminus">-  return gThreadAndMessagePaneSplitter;</span>
<a href="#l14.370"></a><span id="l14.370" class="difflineminus">-}</span>
<a href="#l14.371"></a><span id="l14.371" class="difflineminus">-</span>
<a href="#l14.372"></a><span id="l14.372"> function GetUnreadCountElement()</span>
<a href="#l14.373"></a><span id="l14.373"> {</span>
<a href="#l14.374"></a><span id="l14.374">   if (!gUnreadCount)</span>
<a href="#l14.375"></a><span id="l14.375">     gUnreadCount = document.getElementById('unreadMessageCount');</span>
<a href="#l14.376"></a><span id="l14.376">   return gUnreadCount;</span>
<a href="#l14.377"></a><span id="l14.377"> }</span>
<a href="#l14.378"></a><span id="l14.378"> </span>
<a href="#l14.379"></a><span id="l14.379"> function GetTotalCountElement()</span>
<a href="#l14.380"></a><span id="l14.380"> {</span>
<a href="#l14.381"></a><span id="l14.381">   if (!gTotalCount)</span>
<a href="#l14.382"></a><span id="l14.382">     gTotalCount = document.getElementById('totalMessageCount');</span>
<a href="#l14.383"></a><span id="l14.383">   return gTotalCount;</span>
<a href="#l14.384"></a><span id="l14.384"> }</span>
<a href="#l14.385"></a><span id="l14.385"> </span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-function IsMessagePaneCollapsed()</span>
<a href="#l14.387"></a><span id="l14.387" class="difflineminus">-{</span>
<a href="#l14.388"></a><span id="l14.388" class="difflineminus">-  return GetMessagePane().collapsed;</span>
<a href="#l14.389"></a><span id="l14.389" class="difflineminus">-}</span>
<a href="#l14.390"></a><span id="l14.390" class="difflineminus">-</span>
<a href="#l14.391"></a><span id="l14.391" class="difflineminus">-function IsFolderPaneCollapsed()</span>
<a href="#l14.392"></a><span id="l14.392" class="difflineminus">-{</span>
<a href="#l14.393"></a><span id="l14.393" class="difflineminus">-  return GetFolderTree().parentNode.collapsed;</span>
<a href="#l14.394"></a><span id="l14.394" class="difflineminus">-}</span>
<a href="#l14.395"></a><span id="l14.395" class="difflineminus">-</span>
<a href="#l14.396"></a><span id="l14.396"> function FindMessenger()</span>
<a href="#l14.397"></a><span id="l14.397"> {</span>
<a href="#l14.398"></a><span id="l14.398">   return messenger;</span>
<a href="#l14.399"></a><span id="l14.399"> }</span>
<a href="#l14.400"></a><span id="l14.400"> </span>
<a href="#l14.401"></a><span id="l14.401"> function ClearThreadPaneSelection()</span>
<a href="#l14.402"></a><span id="l14.402"> {</span>
<a href="#l14.403"></a><span id="l14.403">   try {</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineat">@@ -1138,22 +1177,22 @@ function ClearThreadPaneSelection()</span>
<a href="#l14.405"></a><span id="l14.405">   }</span>
<a href="#l14.406"></a><span id="l14.406">   catch (ex) {</span>
<a href="#l14.407"></a><span id="l14.407">     dump(&quot;ClearThreadPaneSelection: ex = &quot; + ex + &quot;\n&quot;);</span>
<a href="#l14.408"></a><span id="l14.408">   }</span>
<a href="#l14.409"></a><span id="l14.409"> }</span>
<a href="#l14.410"></a><span id="l14.410"> </span>
<a href="#l14.411"></a><span id="l14.411"> function ClearMessagePane()</span>
<a href="#l14.412"></a><span id="l14.412"> {</span>
<a href="#l14.413"></a><span id="l14.413" class="difflineminus">-  if(gHaveLoadedMessage)</span>
<a href="#l14.414"></a><span id="l14.414" class="difflineplus">+  if (gHaveLoadedMessage)</span>
<a href="#l14.415"></a><span id="l14.415">   {</span>
<a href="#l14.416"></a><span id="l14.416">     gHaveLoadedMessage = false;</span>
<a href="#l14.417"></a><span id="l14.417">     gCurrentDisplayedMessage = null;</span>
<a href="#l14.418"></a><span id="l14.418">     if (GetMessagePaneFrame().location.href != &quot;about:blank&quot;)</span>
<a href="#l14.419"></a><span id="l14.419" class="difflineminus">-        GetMessagePaneFrame().location.href = &quot;about:blank&quot;;</span>
<a href="#l14.420"></a><span id="l14.420" class="difflineplus">+      GetMessagePaneFrame().location.href = &quot;about:blank&quot;;</span>
<a href="#l14.421"></a><span id="l14.421"> </span>
<a href="#l14.422"></a><span id="l14.422">     // hide the message header view AND the message pane...</span>
<a href="#l14.423"></a><span id="l14.423">     HideMessageHeaderPane();</span>
<a href="#l14.424"></a><span id="l14.424">     gMessageNotificationBar.clearMsgNotifications();</span>
<a href="#l14.425"></a><span id="l14.425">     ClearPendingReadTimer();</span>
<a href="#l14.426"></a><span id="l14.426">   }</span>
<a href="#l14.427"></a><span id="l14.427"> }</span>
<a href="#l14.428"></a><span id="l14.428"> </span>
<a href="#l14.429"></a><span id="l14.429" class="difflineat">@@ -1171,88 +1210,107 @@ function GetSelectedFolderIndex()</span>
<a href="#l14.430"></a><span id="l14.430"> function ChangeSelectionWithoutContentLoad(event, tree)</span>
<a href="#l14.431"></a><span id="l14.431"> {</span>
<a href="#l14.432"></a><span id="l14.432">     var treeBoxObj = tree.treeBoxObject;</span>
<a href="#l14.433"></a><span id="l14.433">     var treeSelection = tree.view.selection;</span>
<a href="#l14.434"></a><span id="l14.434"> </span>
<a href="#l14.435"></a><span id="l14.435">     var row = treeBoxObj.getRowAt(event.clientX, event.clientY);</span>
<a href="#l14.436"></a><span id="l14.436">     // make sure that row.value is valid so that it doesn't mess up</span>
<a href="#l14.437"></a><span id="l14.437">     // the call to ensureRowIsVisible().</span>
<a href="#l14.438"></a><span id="l14.438" class="difflineminus">-    if((row &gt;= 0) &amp;&amp; !treeSelection.isSelected(row))</span>
<a href="#l14.439"></a><span id="l14.439" class="difflineplus">+    if ((row &gt;= 0) &amp;&amp; !treeSelection.isSelected(row))</span>
<a href="#l14.440"></a><span id="l14.440">     {</span>
<a href="#l14.441"></a><span id="l14.441">         var saveCurrentIndex = treeSelection.currentIndex;</span>
<a href="#l14.442"></a><span id="l14.442">         treeSelection.selectEventsSuppressed = true;</span>
<a href="#l14.443"></a><span id="l14.443">         treeSelection.select(row);</span>
<a href="#l14.444"></a><span id="l14.444">         treeSelection.currentIndex = saveCurrentIndex;</span>
<a href="#l14.445"></a><span id="l14.445">         treeBoxObj.ensureRowIsVisible(row);</span>
<a href="#l14.446"></a><span id="l14.446">         treeSelection.selectEventsSuppressed = false;</span>
<a href="#l14.447"></a><span id="l14.447"> </span>
<a href="#l14.448"></a><span id="l14.448">         // Keep track of which row in the thread pane is currently selected.</span>
<a href="#l14.449"></a><span id="l14.449" class="difflineminus">-        if(tree.id == &quot;threadTree&quot;)</span>
<a href="#l14.450"></a><span id="l14.450" class="difflineplus">+        if (tree.id == &quot;threadTree&quot;)</span>
<a href="#l14.451"></a><span id="l14.451">           gThreadPaneCurrentSelectedIndex = row;</span>
<a href="#l14.452"></a><span id="l14.452">     }</span>
<a href="#l14.453"></a><span id="l14.453">     event.stopPropagation();</span>
<a href="#l14.454"></a><span id="l14.454"> }</span>
<a href="#l14.455"></a><span id="l14.455"> </span>
<a href="#l14.456"></a><span id="l14.456"> function TreeOnMouseDown(event)</span>
<a href="#l14.457"></a><span id="l14.457"> {</span>
<a href="#l14.458"></a><span id="l14.458" class="difflineminus">-    // Detect right mouse click and change the highlight to the row</span>
<a href="#l14.459"></a><span id="l14.459" class="difflineminus">-    // where the click happened without loading the message headers in</span>
<a href="#l14.460"></a><span id="l14.460" class="difflineminus">-    // the Folder or Thread Pane.</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineminus">-    if (event.button == 2)</span>
<a href="#l14.462"></a><span id="l14.462" class="difflineminus">-    {</span>
<a href="#l14.463"></a><span id="l14.463" class="difflineminus">-      gRightMouseButtonDown = true;</span>
<a href="#l14.464"></a><span id="l14.464" class="difflineminus">-      ChangeSelectionWithoutContentLoad(event, event.target.parentNode);</span>
<a href="#l14.465"></a><span id="l14.465" class="difflineminus">-    }</span>
<a href="#l14.466"></a><span id="l14.466" class="difflineminus">-    else</span>
<a href="#l14.467"></a><span id="l14.467" class="difflineminus">-      gRightMouseButtonDown = false;</span>
<a href="#l14.468"></a><span id="l14.468" class="difflineplus">+  // Detect right mouse click and change the highlight to the row</span>
<a href="#l14.469"></a><span id="l14.469" class="difflineplus">+  // where the click happened without loading the message headers in</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineplus">+  // the Folder or Thread Pane.</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineplus">+  // Same for middle click, which will open the folder/message in a tab.</span>
<a href="#l14.472"></a><span id="l14.472" class="difflineplus">+  gRightMouseButtonDown = event.button == kMouseButtonRight;</span>
<a href="#l14.473"></a><span id="l14.473" class="difflineplus">+  if (!gRightMouseButtonDown)</span>
<a href="#l14.474"></a><span id="l14.474" class="difflineplus">+    gRightMouseButtonDown = AllowOpenTabOnMiddleClick() &amp;&amp;</span>
<a href="#l14.475"></a><span id="l14.475" class="difflineplus">+                            event.button == kMouseButtonMiddle;</span>
<a href="#l14.476"></a><span id="l14.476" class="difflineplus">+  if (gRightMouseButtonDown)</span>
<a href="#l14.477"></a><span id="l14.477" class="difflineplus">+    ChangeSelectionWithoutContentLoad(event, event.target.parentNode);</span>
<a href="#l14.478"></a><span id="l14.478"> }</span>
<a href="#l14.479"></a><span id="l14.479"> </span>
<a href="#l14.480"></a><span id="l14.480"> function FolderPaneOnClick(event)</span>
<a href="#l14.481"></a><span id="l14.481"> {</span>
<a href="#l14.482"></a><span id="l14.482" class="difflineminus">-    // we only care about button 0 (left click) events</span>
<a href="#l14.483"></a><span id="l14.483" class="difflineminus">-    if (event.button != 0)</span>
<a href="#l14.484"></a><span id="l14.484" class="difflineminus">-        return;</span>
<a href="#l14.485"></a><span id="l14.485" class="difflineplus">+  // we may want to open the folder in a new tab on middle click</span>
<a href="#l14.486"></a><span id="l14.486" class="difflineplus">+  if (event.button == kMouseButtonMiddle)</span>
<a href="#l14.487"></a><span id="l14.487" class="difflineplus">+  {</span>
<a href="#l14.488"></a><span id="l14.488" class="difflineplus">+    if (AllowOpenTabOnMiddleClick())</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineplus">+    {</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineplus">+      MsgOpenNewTabForFolder();</span>
<a href="#l14.491"></a><span id="l14.491" class="difflineplus">+      RestoreSelectionWithoutContentLoad(GetFolderTree());</span>
<a href="#l14.492"></a><span id="l14.492" class="difflineplus">+      return;</span>
<a href="#l14.493"></a><span id="l14.493" class="difflineplus">+    }</span>
<a href="#l14.494"></a><span id="l14.494" class="difflineplus">+  }</span>
<a href="#l14.495"></a><span id="l14.495"> </span>
<a href="#l14.496"></a><span id="l14.496" class="difflineminus">-    var folderTree = GetFolderTree();</span>
<a href="#l14.497"></a><span id="l14.497" class="difflineminus">-    var row = {};</span>
<a href="#l14.498"></a><span id="l14.498" class="difflineminus">-    var col = {};</span>
<a href="#l14.499"></a><span id="l14.499" class="difflineminus">-    var elt = {};</span>
<a href="#l14.500"></a><span id="l14.500" class="difflineminus">-    folderTree.treeBoxObject.getCellAt(event.clientX, event.clientY, row, col, elt);</span>
<a href="#l14.501"></a><span id="l14.501" class="difflineminus">-    if (row.value == -1) {</span>
<a href="#l14.502"></a><span id="l14.502" class="difflineminus">-      if (event.originalTarget.localName == &quot;treecol&quot;)</span>
<a href="#l14.503"></a><span id="l14.503" class="difflineminus">-      {</span>
<a href="#l14.504"></a><span id="l14.504" class="difflineminus">-        // clicking on the name column in the folder pane should not sort</span>
<a href="#l14.505"></a><span id="l14.505" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l14.506"></a><span id="l14.506" class="difflineminus">-      }</span>
<a href="#l14.507"></a><span id="l14.507" class="difflineminus">-    }</span>
<a href="#l14.508"></a><span id="l14.508" class="difflineminus">-    else if ((event.originalTarget.localName == &quot;slider&quot;) ||</span>
<a href="#l14.509"></a><span id="l14.509" class="difflineminus">-             (event.originalTarget.localName == &quot;scrollbarbutton&quot;)) {</span>
<a href="#l14.510"></a><span id="l14.510" class="difflineplus">+  // otherwise, we only care about left click events</span>
<a href="#l14.511"></a><span id="l14.511" class="difflineplus">+  if (event.button != kMouseButtonLeft)</span>
<a href="#l14.512"></a><span id="l14.512" class="difflineplus">+    return;</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineplus">+</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineplus">+  var folderTree = GetFolderTree();</span>
<a href="#l14.515"></a><span id="l14.515" class="difflineplus">+  var row = {}, col = {}, elt = {};</span>
<a href="#l14.516"></a><span id="l14.516" class="difflineplus">+  folderTree.treeBoxObject.getCellAt(event.clientX, event.clientY, row, col, elt);</span>
<a href="#l14.517"></a><span id="l14.517" class="difflineplus">+  if (row.value == -1)</span>
<a href="#l14.518"></a><span id="l14.518" class="difflineplus">+  {</span>
<a href="#l14.519"></a><span id="l14.519" class="difflineplus">+    if (event.originalTarget.localName == &quot;treecol&quot;)</span>
<a href="#l14.520"></a><span id="l14.520" class="difflineplus">+    {</span>
<a href="#l14.521"></a><span id="l14.521" class="difflineplus">+      // clicking on the name column in the folder pane should not sort</span>
<a href="#l14.522"></a><span id="l14.522">       event.stopPropagation();</span>
<a href="#l14.523"></a><span id="l14.523">     }</span>
<a href="#l14.524"></a><span id="l14.524" class="difflineminus">-    else if ((event.detail == 2) &amp;&amp; (elt.value != &quot;twisty&quot;) &amp;&amp;</span>
<a href="#l14.525"></a><span id="l14.525" class="difflineminus">-             (folderTree.view.getLevel(row.value) != 0)) {</span>
<a href="#l14.526"></a><span id="l14.526" class="difflineminus">-      FolderPaneDoubleClick(row.value, event);</span>
<a href="#l14.527"></a><span id="l14.527" class="difflineminus">-    }</span>
<a href="#l14.528"></a><span id="l14.528" class="difflineplus">+  }</span>
<a href="#l14.529"></a><span id="l14.529" class="difflineplus">+  else if ((event.originalTarget.localName == &quot;slider&quot;) ||</span>
<a href="#l14.530"></a><span id="l14.530" class="difflineplus">+           (event.originalTarget.localName == &quot;scrollbarbutton&quot;))</span>
<a href="#l14.531"></a><span id="l14.531" class="difflineplus">+  {</span>
<a href="#l14.532"></a><span id="l14.532" class="difflineplus">+    event.stopPropagation();</span>
<a href="#l14.533"></a><span id="l14.533" class="difflineplus">+  }</span>
<a href="#l14.534"></a><span id="l14.534" class="difflineplus">+  else if ((event.detail == 2) &amp;&amp;</span>
<a href="#l14.535"></a><span id="l14.535" class="difflineplus">+           (elt.value != &quot;twisty&quot;) &amp;&amp;</span>
<a href="#l14.536"></a><span id="l14.536" class="difflineplus">+           (folderTree.view.getLevel(row.value) != 0))</span>
<a href="#l14.537"></a><span id="l14.537" class="difflineplus">+  {</span>
<a href="#l14.538"></a><span id="l14.538" class="difflineplus">+    FolderPaneDoubleClick(row.value, event);</span>
<a href="#l14.539"></a><span id="l14.539" class="difflineplus">+  }</span>
<a href="#l14.540"></a><span id="l14.540"> }</span>
<a href="#l14.541"></a><span id="l14.541"> </span>
<a href="#l14.542"></a><span id="l14.542"> function FolderPaneDoubleClick(folderIndex, event)</span>
<a href="#l14.543"></a><span id="l14.543"> {</span>
<a href="#l14.544"></a><span id="l14.544" class="difflineminus">-    if (!pref.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;))</span>
<a href="#l14.545"></a><span id="l14.545" class="difflineminus">-    {</span>
<a href="#l14.546"></a><span id="l14.546" class="difflineminus">-      var folderResource = GetFolderResource(GetFolderTree(), folderIndex);</span>
<a href="#l14.547"></a><span id="l14.547" class="difflineminus">-      // Open a new msg window only if we are double clicking on</span>
<a href="#l14.548"></a><span id="l14.548" class="difflineminus">-      // folders or newsgroups.</span>
<a href="#l14.549"></a><span id="l14.549" class="difflineminus">-      MsgOpenNewWindowForFolder(folderResource.Value, -1 /* key */);</span>
<a href="#l14.550"></a><span id="l14.550" class="difflineplus">+  // In tabmail land, lazyness is dead!</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineplus">+  // We either open the folder in a tab or a new window...</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineplus">+  if (AllowOpenTabOnDoubleClick())</span>
<a href="#l14.553"></a><span id="l14.553" class="difflineplus">+  {</span>
<a href="#l14.554"></a><span id="l14.554" class="difflineplus">+    MsgOpenNewTabForFolder();</span>
<a href="#l14.555"></a><span id="l14.555" class="difflineplus">+  }</span>
<a href="#l14.556"></a><span id="l14.556" class="difflineplus">+  else</span>
<a href="#l14.557"></a><span id="l14.557" class="difflineplus">+  {</span>
<a href="#l14.558"></a><span id="l14.558" class="difflineplus">+    let folderResource = GetFolderResource(GetFolderTree(), folderIndex);</span>
<a href="#l14.559"></a><span id="l14.559" class="difflineplus">+    // Open a new msg window only if we are double clicking on</span>
<a href="#l14.560"></a><span id="l14.560" class="difflineplus">+    // folders or newsgroups.</span>
<a href="#l14.561"></a><span id="l14.561" class="difflineplus">+    MsgOpenNewWindowForFolder(folderResource.Value, nsMsgKey_None);</span>
<a href="#l14.562"></a><span id="l14.562" class="difflineplus">+  }</span>
<a href="#l14.563"></a><span id="l14.563"> </span>
<a href="#l14.564"></a><span id="l14.564" class="difflineminus">-      // double clicking should not toggle the open / close state of the</span>
<a href="#l14.565"></a><span id="l14.565" class="difflineminus">-      // folder.  this will happen if we don't prevent the event from</span>
<a href="#l14.566"></a><span id="l14.566" class="difflineminus">-      // bubbling to the default handler in tree.xml</span>
<a href="#l14.567"></a><span id="l14.567" class="difflineminus">-      event.stopPropagation();</span>
<a href="#l14.568"></a><span id="l14.568" class="difflineminus">-    }</span>
<a href="#l14.569"></a><span id="l14.569" class="difflineplus">+  // Double-clicking should not toggle the open/close state of the folder.</span>
<a href="#l14.570"></a><span id="l14.570" class="difflineplus">+  // This will happen if we don't prevent the event from bubbling to the</span>
<a href="#l14.571"></a><span id="l14.571" class="difflineplus">+  // default handler in tree.xml.</span>
<a href="#l14.572"></a><span id="l14.572" class="difflineplus">+  event.stopPropagation();</span>
<a href="#l14.573"></a><span id="l14.573"> }</span>
<a href="#l14.574"></a><span id="l14.574"> </span>
<a href="#l14.575"></a><span id="l14.575"> function ChangeSelection(tree, newIndex)</span>
<a href="#l14.576"></a><span id="l14.576"> {</span>
<a href="#l14.577"></a><span id="l14.577">     if(newIndex &gt;= 0)</span>
<a href="#l14.578"></a><span id="l14.578">     {</span>
<a href="#l14.579"></a><span id="l14.579">         tree.view.selection.select(newIndex);</span>
<a href="#l14.580"></a><span id="l14.580">         tree.treeBoxObject.ensureRowIsVisible(newIndex);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/mailnews/msgViewNavigation.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/mailnews/msgViewNavigation.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l15.8"></a><span id="l15.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l15.9"></a><span id="l15.9">  *</span>
<a href="#l15.10"></a><span id="l15.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l15.11"></a><span id="l15.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l15.12"></a><span id="l15.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l15.13"></a><span id="l15.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l15.14"></a><span id="l15.14">  *</span>
<a href="#l15.15"></a><span id="l15.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/mailnews/msgViewPickerOverlay.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/mailnews/msgViewPickerOverlay.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.8"></a><span id="l16.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l16.9"></a><span id="l16.9">  *</span>
<a href="#l16.10"></a><span id="l16.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l16.11"></a><span id="l16.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l16.12"></a><span id="l16.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l16.13"></a><span id="l16.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l16.14"></a><span id="l16.14">  *</span>
<a href="#l16.15"></a><span id="l16.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineat">@@ -139,17 +139,17 @@ function ViewChangeByFolder(aFolder)</span>
<a href="#l16.17"></a><span id="l16.17"> {</span>
<a href="#l16.18"></a><span id="l16.18">   var result = GetMailViewForFolder(aFolder);</span>
<a href="#l16.19"></a><span id="l16.19">   ViewChangeByValue(result);</span>
<a href="#l16.20"></a><span id="l16.20"> }</span>
<a href="#l16.21"></a><span id="l16.21"> </span>
<a href="#l16.22"></a><span id="l16.22"> function GetLabelForValue(aValue)</span>
<a href="#l16.23"></a><span id="l16.23"> {</span>
<a href="#l16.24"></a><span id="l16.24">   var label = &quot;&quot;;</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-  let viewPickerPopup = document.getElementById(&quot;viewPickerPopup&quot;);</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+  var viewPickerPopup = document.getElementById(&quot;viewPickerPopup&quot;);</span>
<a href="#l16.27"></a><span id="l16.27">   if (viewPickerPopup)</span>
<a href="#l16.28"></a><span id="l16.28">   {</span>
<a href="#l16.29"></a><span id="l16.29">     // grab the label for the menulist from one of its menuitems</span>
<a href="#l16.30"></a><span id="l16.30">     var selectedItems = viewPickerPopup.getElementsByAttribute(&quot;value&quot;, aValue);</span>
<a href="#l16.31"></a><span id="l16.31">     if (!selectedItems || !selectedItems.length)</span>
<a href="#l16.32"></a><span id="l16.32">     {</span>
<a href="#l16.33"></a><span id="l16.33">       // we may have a new item</span>
<a href="#l16.34"></a><span id="l16.34">       RefreshAllViewPopups(viewPickerPopup, true);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineat">@@ -172,22 +172,24 @@ function UpdateViewPicker(aValue, aLabel</span>
<a href="#l16.36"></a><span id="l16.36">   {</span>
<a href="#l16.37"></a><span id="l16.37">     viewPicker.value = aValue;</span>
<a href="#l16.38"></a><span id="l16.38">     viewPicker.setAttribute(&quot;label&quot;, aLabel);</span>
<a href="#l16.39"></a><span id="l16.39">   }</span>
<a href="#l16.40"></a><span id="l16.40"> }</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42"> function GetFolderInfo(aFolder)</span>
<a href="#l16.43"></a><span id="l16.43"> {</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-  if (aFolder)</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+  // accounts may not have a msgDatabase, eg. Movemail or RSS</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+  try</span>
<a href="#l16.47"></a><span id="l16.47">   {</span>
<a href="#l16.48"></a><span id="l16.48">     var db = aFolder.msgDatabase;</span>
<a href="#l16.49"></a><span id="l16.49">     if (db)</span>
<a href="#l16.50"></a><span id="l16.50">       return db.dBFolderInfo;</span>
<a href="#l16.51"></a><span id="l16.51">   }</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+  catch (ex) {}</span>
<a href="#l16.53"></a><span id="l16.53">   return null;</span>
<a href="#l16.54"></a><span id="l16.54"> }</span>
<a href="#l16.55"></a><span id="l16.55"> </span>
<a href="#l16.56"></a><span id="l16.56"> </span>
<a href="#l16.57"></a><span id="l16.57"> function GetMailViewForFolder(aFolder)</span>
<a href="#l16.58"></a><span id="l16.58"> {</span>
<a href="#l16.59"></a><span id="l16.59">   var val = &quot;&quot;;</span>
<a href="#l16.60"></a><span id="l16.60">   var folderInfo = GetFolderInfo(aFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/mailnews/search/SearchDialog.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/mailnews/search/SearchDialog.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.8"></a><span id="l17.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.9"></a><span id="l17.9">  *</span>
<a href="#l17.10"></a><span id="l17.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.11"></a><span id="l17.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.12"></a><span id="l17.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l17.13"></a><span id="l17.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l17.14"></a><span id="l17.14">  *</span>
<a href="#l17.15"></a><span id="l17.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/mailnews/search/SearchDialog.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/mailnews/search/SearchDialog.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -73,16 +73,18 @@</span>
<a href="#l18.4"></a><span id="l18.4">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l18.5"></a><span id="l18.5">           src=&quot;chrome://messenger/content/mailWindowOverlay.js&quot;/&gt;</span>
<a href="#l18.6"></a><span id="l18.6">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l18.7"></a><span id="l18.7">           src=&quot;chrome://messenger/content/commandglue.js&quot;/&gt;</span>
<a href="#l18.8"></a><span id="l18.8">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l18.9"></a><span id="l18.9">           src=&quot;chrome://messenger/content/SearchDialog.js&quot;/&gt;</span>
<a href="#l18.10"></a><span id="l18.10">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l18.11"></a><span id="l18.11">           src=&quot;chrome://messenger/content/messengerdnd.js&quot;/&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+          src=&quot;chrome://messenger/content/tabmail.js&quot;/&gt;</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   &lt;commands id=&quot;commands&quot;&gt;</span>
<a href="#l18.16"></a><span id="l18.16">     &lt;commandset id=&quot;mailSearchItems&quot;</span>
<a href="#l18.17"></a><span id="l18.17">                 commandupdater=&quot;true&quot;</span>
<a href="#l18.18"></a><span id="l18.18">                 events=&quot;mail-search&quot;</span>
<a href="#l18.19"></a><span id="l18.19">                 oncommandupdate=&quot;goUpdateSearchItems(this)&quot;&gt;</span>
<a href="#l18.20"></a><span id="l18.20">       &lt;command id=&quot;cmd_open&quot; oncommand=&quot;goDoCommand('cmd_open')&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l18.21"></a><span id="l18.21">       &lt;command id=&quot;button_delete&quot; oncommand=&quot;goDoCommand('button_delete')&quot; disabled=&quot;true&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/mailnews/searchBar.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/mailnews/searchBar.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.8"></a><span id="l19.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.9"></a><span id="l19.9">  *</span>
<a href="#l19.10"></a><span id="l19.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.11"></a><span id="l19.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.12"></a><span id="l19.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l19.13"></a><span id="l19.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l19.14"></a><span id="l19.14">  *</span>
<a href="#l19.15"></a><span id="l19.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineat">@@ -91,17 +91,17 @@ var gSearchNotificationListener =</span>
<a href="#l19.17"></a><span id="l19.17">          (!gSearchInput || gSearchInput.value == &quot;&quot; || gSearchInput.showingSearchCriteria))</span>
<a href="#l19.18"></a><span id="l19.18">         {</span>
<a href="#l19.19"></a><span id="l19.19">           var vFolder = GetMsgFolderFromUri(gCurrentVirtualFolderUri, false);</span>
<a href="#l19.20"></a><span id="l19.20">           var dbFolderInfo = vFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l19.21"></a><span id="l19.21">           dbFolderInfo.numUnreadMessages = gNumUnreadMessages;</span>
<a href="#l19.22"></a><span id="l19.22">           dbFolderInfo.numMessages = gNumTotalMessages;</span>
<a href="#l19.23"></a><span id="l19.23">           vFolder.updateSummaryTotals(true); // force update from db.</span>
<a href="#l19.24"></a><span id="l19.24">           var msgdb = vFolder.msgDatabase;</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">-          msgdb.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+          msgdb.Commit(Components.interfaces.nsMsgDBCommitType.kLargeCommit);</span>
<a href="#l19.27"></a><span id="l19.27">           // now that we have finished loading a virtual folder,</span>
<a href="#l19.28"></a><span id="l19.28">           // scroll to the correct message if there is at least one.</span>
<a href="#l19.29"></a><span id="l19.29">           if (vFolder.getTotalMessages(false) &gt; 0)</span>
<a href="#l19.30"></a><span id="l19.30">             ScrollToMessageAfterFolderLoad(vFolder);</span>
<a href="#l19.31"></a><span id="l19.31">         }</span>
<a href="#l19.32"></a><span id="l19.32">     },</span>
<a href="#l19.33"></a><span id="l19.33"> </span>
<a href="#l19.34"></a><span id="l19.34">     onNewSearch: function()</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineat">@@ -188,19 +188,19 @@ function initializeSearchBar()</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37"> function onEnterInSearchBar()</span>
<a href="#l19.38"></a><span id="l19.38"> {</span>
<a href="#l19.39"></a><span id="l19.39">    if (!gSearchBundle)</span>
<a href="#l19.40"></a><span id="l19.40">      getDocumentElements();</span>
<a href="#l19.41"></a><span id="l19.41">    viewDebug (&quot;onEnterInSearchBar gSearchInput.value = &quot; /* + gSearchInput.value + &quot; showing criteria = &quot; + gSearchInput.showingSearchCriteria */ +&quot;\n&quot;);</span>
<a href="#l19.42"></a><span id="l19.42">    if (gSearchInput.value == &quot;&quot;  /* || gSearchInput.showingSearchCriteria */) </span>
<a href="#l19.43"></a><span id="l19.43">    {</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-     </span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-     if (gDBView.viewType == nsMsgViewType.eShowQuickSearchResults </span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-        || gDBView.viewType == nsMsgViewType.eShowVirtualFolderResults)</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+    let viewType = gDBView &amp;&amp; gDBView.viewType;</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+    if (viewType == nsMsgViewType.eShowQuickSearchResults ||</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+        viewType == nsMsgViewType.eShowVirtualFolderResults)</span>
<a href="#l19.50"></a><span id="l19.50">      {</span>
<a href="#l19.51"></a><span id="l19.51">        statusFeedback.showStatusString(&quot;&quot;);</span>
<a href="#l19.52"></a><span id="l19.52">        disableQuickSearchClearButton();</span>
<a href="#l19.53"></a><span id="l19.53"> </span>
<a href="#l19.54"></a><span id="l19.54">        viewDebug (&quot;onEnterInSearchBar gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot; </span>
<a href="#l19.55"></a><span id="l19.55">         + gVirtualFolderTerms + &quot;gXFVirtualFolderTerms = &quot; + gXFVirtualFolderTerms + &quot;\n&quot;);</span>
<a href="#l19.56"></a><span id="l19.56">        var addTerms = gDefaultSearchViewTerms || gVirtualFolderTerms || gXFVirtualFolderTerms;</span>
<a href="#l19.57"></a><span id="l19.57">        if (addTerms)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/suite/mailnews/tabmail.js</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,1025 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+ *</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+ *</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+ * License.</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+ *</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+ * The Original Code is SeaMonkey Tabmail code.</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+ *</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+ *   Karsten Dsterloh &lt;mnromyr@tprac.de&gt;</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+ * based upon the tabmail work by</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+ *   David Bienvenu &lt;bienvenu@nventure.com&gt;.</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+ *   Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+ *   Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+ * and other code by various artists from all over the place in mailnews.</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+ *</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+ * Contributor(s):</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+ *</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+ * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+ * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+ *</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+// common pref object for all windows using tabmail</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+// alas, it's a legacy name without a 'g' prefix</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+var pref = null;</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+function GetPrefService()</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+{</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+  if (!pref)</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+    pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+                     .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+  return pref;</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+}</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+// Traditionally, mailnews tabs come in two flavours: &quot;folder&quot; and</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+// &quot;message&quot; tabs. But these modes are just mere default settings on tab</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+// creation, defining layout, URI to load, etc.</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+// The user can turn a &quot;message&quot; tab into a &quot;folder&quot; tab just by unhiding</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+// the folder pane (F9) and hiding the message pane (F8), and vice versa.</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+// Tab title and icon will change accordingly.</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+// Both flavours are just instances of the basic &quot;3pane&quot; mode, triggered by</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+// a bitwise or combination of these possible pane values:</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineplus">+const kTabShowNoPane      = 0;</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+const kTabShowFolderPane  = 1 &lt;&lt; 0;</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+const kTabShowMessagePane = 1 &lt;&lt; 1;</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+const kTabShowThreadPane  = 1 &lt;&lt; 2;</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineplus">+const kTabShowAcctCentral = 1 &lt;&lt; 3;</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineplus">+// predefined mode masks</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineplus">+const kTabMaskDisplayDeck = kTabShowThreadPane | kTabShowAcctCentral;</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineplus">+// predefined traditional flavours</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineplus">+const kTabModeFolder      = kTabShowFolderPane | kTabShowThreadPane | kTabShowMessagePane;</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+const kTabModeMessage     = kTabShowMessagePane;  // message tab</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineplus">+</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineplus">+</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineplus">+// global mailnews tab definition object</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+var gMailNewsTabsType =</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineplus">+{</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+  name: &quot;mailnews&quot;,</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineplus">+  panelId: &quot;mailContent&quot;,</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineplus">+</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineplus">+  modes:</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+  {</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineplus">+    &quot;3pane&quot;:</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineplus">+    {</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineplus">+      isDefault: true,</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineplus">+      type: &quot;3pane&quot;,</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineplus">+</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineplus">+      // aTabInfo belongs to the newly created tab,</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineplus">+      // aModeBits is a combination of kTabShow* layout bits (or null),</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineplus">+      // aFolderURI designates the folder to select (or null)</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineplus">+      // aMsgHdr designates the message to select (or null)</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineplus">+      openTab: function(aTabInfo, aModeBits, aFolderURI, aMsgHdr)</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineplus">+      {</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineplus">+        // clone the current 3pane state before overriding parts of it</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineplus">+        this.saveTabState(aTabInfo);</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineplus">+</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineplus">+        // aModeBits must have at least one bit set</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineplus">+        // if not, we just copy the current state</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineplus">+        let cloneMode = !aModeBits;</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+        if (cloneMode)</span>
<a href="#l20.105"></a><span id="l20.105" class="difflineplus">+          aModeBits = this.getCurrentModeBits() || kTabModeFolder;</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineplus">+        aTabInfo.modeBits = aModeBits;</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineplus">+        // Currently, we only check for kTabModeMessage vs. kTabModeFolder,</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineplus">+        // but in theory we could distinguish in much more detail!</span>
<a href="#l20.109"></a><span id="l20.109" class="difflineplus">+        let messageId = null;</span>
<a href="#l20.110"></a><span id="l20.110" class="difflineplus">+        if (aModeBits == kTabModeMessage || cloneMode)</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineplus">+        {</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineplus">+          if (!aMsgHdr &amp;&amp; gDBView)</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineplus">+          {</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineplus">+            try</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineplus">+            {</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineplus">+              // duplicate current message tab if nothing else is specified</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineplus">+              aMsgHdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l20.118"></a><span id="l20.118" class="difflineplus">+              // Use the header's folder - this will open a msg in a virtual folder view</span>
<a href="#l20.119"></a><span id="l20.119" class="difflineplus">+              // in its real folder, which is needed if the msg wouldn't be in a new</span>
<a href="#l20.120"></a><span id="l20.120" class="difflineplus">+              // view with the same terms - e.g., it's read and the view is unread only.</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineplus">+              // If we cloned the view, we wouldn't have to do this.</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineplus">+              if (aTabInfo.switchToNewTab)</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineplus">+              {</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineplus">+                // Fix it so we won't try to load the previously loaded message.</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineplus">+                aMsgHdr.folder.lastMessageLoaded = nsMsgKey_None;</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineplus">+              }</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineplus">+              aFolderURI = aMsgHdr.folder.URI;</span>
<a href="#l20.128"></a><span id="l20.128" class="difflineplus">+            }</span>
<a href="#l20.129"></a><span id="l20.129" class="difflineplus">+            catch (ex) {}</span>
<a href="#l20.130"></a><span id="l20.130" class="difflineplus">+          }</span>
<a href="#l20.131"></a><span id="l20.131" class="difflineplus">+          if (aMsgHdr)</span>
<a href="#l20.132"></a><span id="l20.132" class="difflineplus">+            messageId = aMsgHdr.messageId;</span>
<a href="#l20.133"></a><span id="l20.133" class="difflineplus">+          aTabInfo.clearSplitter = true;</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineplus">+        }</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineplus">+</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineplus">+        if (!messageId)</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineplus">+        {</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineplus">+          // only sanitize the URL, if possible</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineplus">+          let clearSplitter = aModeBits == kTabModeFolder;</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineplus">+          if (!aFolderURI)</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineplus">+          {</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineplus">+            // Use GetSelectedMsgFolders() to find out which folder to open</span>
<a href="#l20.143"></a><span id="l20.143" class="difflineplus">+            // instead of GetLoadedMsgFolder().URI. This is required because on a</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineplus">+            // right-click, the currentIndex value will be different from the</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineplus">+            // actual row that is highlighted. GetSelectedMsgFolders() will</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineplus">+            // return the message that is highlighted.</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineplus">+            let msgFolder = GetSelectedMsgFolders()[0];</span>
<a href="#l20.148"></a><span id="l20.148" class="difflineplus">+            aFolderURI = msgFolder.URI;</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineplus">+            // don't kill the splitter settings for account central</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineplus">+            clearSplitter &amp;= !msgFolder.isServer;</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineplus">+          }</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineplus">+          aMsgHdr = null;</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineplus">+          aTabInfo.clearSplitter = clearSplitter;</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineplus">+        }</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineplus">+        aTabInfo.uriToOpen = aFolderURI;</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+        aTabInfo.hdr = aMsgHdr;</span>
<a href="#l20.157"></a><span id="l20.157" class="difflineplus">+        aTabInfo.selectedMsgId = messageId;</span>
<a href="#l20.158"></a><span id="l20.158" class="difflineplus">+</span>
<a href="#l20.159"></a><span id="l20.159" class="difflineplus">+        // call superclass logic</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineplus">+        this.openTab(aTabInfo);</span>
<a href="#l20.161"></a><span id="l20.161" class="difflineplus">+      },</span>
<a href="#l20.162"></a><span id="l20.162" class="difflineplus">+</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineplus">+      // We can close all mailnews tabs - but one.</span>
<a href="#l20.164"></a><span id="l20.164" class="difflineplus">+      // Closing the last mailnews tab would destroy our mailnews functionality.</span>
<a href="#l20.165"></a><span id="l20.165" class="difflineplus">+      canCloseTab: function(aTabInfo)</span>
<a href="#l20.166"></a><span id="l20.166" class="difflineplus">+      {</span>
<a href="#l20.167"></a><span id="l20.167" class="difflineplus">+        return aTabInfo.mode.tabs.length &gt; 1;</span>
<a href="#l20.168"></a><span id="l20.168" class="difflineplus">+      }</span>
<a href="#l20.169"></a><span id="l20.169" class="difflineplus">+    }</span>
<a href="#l20.170"></a><span id="l20.170" class="difflineplus">+  },</span>
<a href="#l20.171"></a><span id="l20.171" class="difflineplus">+</span>
<a href="#l20.172"></a><span id="l20.172" class="difflineplus">+  // combines the current pane visibility states into a mode bit mask</span>
<a href="#l20.173"></a><span id="l20.173" class="difflineplus">+  getCurrentModeBits: function()</span>
<a href="#l20.174"></a><span id="l20.174" class="difflineplus">+  {</span>
<a href="#l20.175"></a><span id="l20.175" class="difflineplus">+    let modeBits = kTabShowNoPane;</span>
<a href="#l20.176"></a><span id="l20.176" class="difflineplus">+    if (!IsFolderPaneCollapsed())</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineplus">+      modeBits |= kTabShowFolderPane;</span>
<a href="#l20.178"></a><span id="l20.178" class="difflineplus">+    if (!IsDisplayDeckCollapsed())</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineplus">+    {</span>
<a href="#l20.180"></a><span id="l20.180" class="difflineplus">+      // currently, the display deck has only two panes</span>
<a href="#l20.181"></a><span id="l20.181" class="difflineplus">+      if (gAccountCentralLoaded)</span>
<a href="#l20.182"></a><span id="l20.182" class="difflineplus">+        modeBits |= kTabShowAcctCentral;</span>
<a href="#l20.183"></a><span id="l20.183" class="difflineplus">+      else</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineplus">+        modeBits |= kTabShowThreadPane;</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineplus">+    }</span>
<a href="#l20.186"></a><span id="l20.186" class="difflineplus">+    if (!IsMessagePaneCollapsed())</span>
<a href="#l20.187"></a><span id="l20.187" class="difflineplus">+      modeBits |= kTabShowMessagePane;</span>
<a href="#l20.188"></a><span id="l20.188" class="difflineplus">+    return modeBits;</span>
<a href="#l20.189"></a><span id="l20.189" class="difflineplus">+  },</span>
<a href="#l20.190"></a><span id="l20.190" class="difflineplus">+</span>
<a href="#l20.191"></a><span id="l20.191" class="difflineplus">+  _updatePaneLayout: function(aTabInfo)</span>
<a href="#l20.192"></a><span id="l20.192" class="difflineplus">+  {</span>
<a href="#l20.193"></a><span id="l20.193" class="difflineplus">+    // first show all needed panes, then hide all unwanted ones</span>
<a href="#l20.194"></a><span id="l20.194" class="difflineplus">+    // (we have to keep this order to avoid hiding all panes!)</span>
<a href="#l20.195"></a><span id="l20.195" class="difflineplus">+    let showFolderPane  = aTabInfo.modeBits &amp; kTabShowFolderPane;</span>
<a href="#l20.196"></a><span id="l20.196" class="difflineplus">+    let showMessagePane = aTabInfo.modeBits &amp; kTabShowMessagePane;</span>
<a href="#l20.197"></a><span id="l20.197" class="difflineplus">+    let showDisplayDeck = aTabInfo.modeBits &amp; (kTabShowThreadPane | kTabShowAcctCentral);</span>
<a href="#l20.198"></a><span id="l20.198" class="difflineplus">+    if (showMessagePane &amp;&amp; IsMessagePaneCollapsed())</span>
<a href="#l20.199"></a><span id="l20.199" class="difflineplus">+      MsgToggleMessagePane(true); // show message pane</span>
<a href="#l20.200"></a><span id="l20.200" class="difflineplus">+    if (showDisplayDeck &amp;&amp; IsDisplayDeckCollapsed())</span>
<a href="#l20.201"></a><span id="l20.201" class="difflineplus">+      MsgToggleThreadPane();      // show thread pane</span>
<a href="#l20.202"></a><span id="l20.202" class="difflineplus">+    if (showFolderPane &amp;&amp; IsFolderPaneCollapsed())</span>
<a href="#l20.203"></a><span id="l20.203" class="difflineplus">+      MsgToggleFolderPane(true);  // show folder pane</span>
<a href="#l20.204"></a><span id="l20.204" class="difflineplus">+    if (!showMessagePane &amp;&amp; !IsMessagePaneCollapsed())</span>
<a href="#l20.205"></a><span id="l20.205" class="difflineplus">+      MsgToggleMessagePane(true); // hide message pane</span>
<a href="#l20.206"></a><span id="l20.206" class="difflineplus">+    if (!showDisplayDeck &amp;&amp; !IsDisplayDeckCollapsed())</span>
<a href="#l20.207"></a><span id="l20.207" class="difflineplus">+      MsgToggleThreadPane();      // hide thread pane</span>
<a href="#l20.208"></a><span id="l20.208" class="difflineplus">+    if (!showFolderPane &amp;&amp; !IsFolderPaneCollapsed())</span>
<a href="#l20.209"></a><span id="l20.209" class="difflineplus">+      MsgToggleFolderPane(true);  // hide folder pane</span>
<a href="#l20.210"></a><span id="l20.210" class="difflineplus">+    UpdateLayoutVisibility();</span>
<a href="#l20.211"></a><span id="l20.211" class="difflineplus">+  },</span>
<a href="#l20.212"></a><span id="l20.212" class="difflineplus">+</span>
<a href="#l20.213"></a><span id="l20.213" class="difflineplus">+  /**</span>
<a href="#l20.214"></a><span id="l20.214" class="difflineplus">+   * Create the new tab's state, which engenders some side effects.</span>
<a href="#l20.215"></a><span id="l20.215" class="difflineplus">+   * Part of our contract is that we leave the tab in the selected state.</span>
<a href="#l20.216"></a><span id="l20.216" class="difflineplus">+   */</span>
<a href="#l20.217"></a><span id="l20.217" class="difflineplus">+  openTab: function(aTabInfo)</span>
<a href="#l20.218"></a><span id="l20.218" class="difflineplus">+  {</span>
<a href="#l20.219"></a><span id="l20.219" class="difflineplus">+    // each tab gets its own messenger instance</span>
<a href="#l20.220"></a><span id="l20.220" class="difflineplus">+    // for undo/redo, backwards/forwards, etc.</span>
<a href="#l20.221"></a><span id="l20.221" class="difflineplus">+    messenger = Components.classes[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l20.222"></a><span id="l20.222" class="difflineplus">+                          .createInstance(Components.interfaces.nsIMessenger);</span>
<a href="#l20.223"></a><span id="l20.223" class="difflineplus">+    messenger.setWindow(window, msgWindow);</span>
<a href="#l20.224"></a><span id="l20.224" class="difflineplus">+    aTabInfo.messenger = messenger;</span>
<a href="#l20.225"></a><span id="l20.225" class="difflineplus">+</span>
<a href="#l20.226"></a><span id="l20.226" class="difflineplus">+    // remember the currently selected folder</span>
<a href="#l20.227"></a><span id="l20.227" class="difflineplus">+    aTabInfo.msgSelectedFolder = gMsgFolderSelected;</span>
<a href="#l20.228"></a><span id="l20.228" class="difflineplus">+</span>
<a href="#l20.229"></a><span id="l20.229" class="difflineplus">+    // show tab if permitted</span>
<a href="#l20.230"></a><span id="l20.230" class="difflineplus">+    if (aTabInfo.switchToNewTab)</span>
<a href="#l20.231"></a><span id="l20.231" class="difflineplus">+      this.showTab(aTabInfo);</span>
<a href="#l20.232"></a><span id="l20.232" class="difflineplus">+  },</span>
<a href="#l20.233"></a><span id="l20.233" class="difflineplus">+</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineplus">+  showTab: function(aTabInfo)</span>
<a href="#l20.235"></a><span id="l20.235" class="difflineplus">+  {</span>
<a href="#l20.236"></a><span id="l20.236" class="difflineplus">+    // don't allow saveTabState while restoring a tab</span>
<a href="#l20.237"></a><span id="l20.237" class="difflineplus">+    aTabInfo.lock = true;</span>
<a href="#l20.238"></a><span id="l20.238" class="difflineplus">+    // set the messagepane as the primary browser for content</span>
<a href="#l20.239"></a><span id="l20.239" class="difflineplus">+    getMessageBrowser().setAttribute(&quot;type&quot;, &quot;content-primary&quot;);</span>
<a href="#l20.240"></a><span id="l20.240" class="difflineplus">+</span>
<a href="#l20.241"></a><span id="l20.241" class="difflineplus">+    if (aTabInfo.uriToOpen)</span>
<a href="#l20.242"></a><span id="l20.242" class="difflineplus">+    {</span>
<a href="#l20.243"></a><span id="l20.243" class="difflineplus">+      // Clear selection, because context clicking on a folder and opening in a</span>
<a href="#l20.244"></a><span id="l20.244" class="difflineplus">+      // new tab needs to have SelectFolder think the selection has changed.</span>
<a href="#l20.245"></a><span id="l20.245" class="difflineplus">+      // We also need to clear these globals to subvert the code that prevents</span>
<a href="#l20.246"></a><span id="l20.246" class="difflineplus">+      // folder loads when things haven't changed.</span>
<a href="#l20.247"></a><span id="l20.247" class="difflineplus">+      let folderTree = GetFolderTree();</span>
<a href="#l20.248"></a><span id="l20.248" class="difflineplus">+      folderTree.view.selection.clearSelection();</span>
<a href="#l20.249"></a><span id="l20.249" class="difflineplus">+      folderTree.view.selection.currentIndex = -1;</span>
<a href="#l20.250"></a><span id="l20.250" class="difflineplus">+      gMsgFolderSelected = null;</span>
<a href="#l20.251"></a><span id="l20.251" class="difflineplus">+      msgWindow.openFolder = null;</span>
<a href="#l20.252"></a><span id="l20.252" class="difflineplus">+</span>
<a href="#l20.253"></a><span id="l20.253" class="difflineplus">+      // clear gDBView so we won't try to close it</span>
<a href="#l20.254"></a><span id="l20.254" class="difflineplus">+      gDBView = null;</span>
<a href="#l20.255"></a><span id="l20.255" class="difflineplus">+</span>
<a href="#l20.256"></a><span id="l20.256" class="difflineplus">+      // reroot the message sink (we might have switched layout)</span>
<a href="#l20.257"></a><span id="l20.257" class="difflineplus">+      messenger.setWindow(null, null);</span>
<a href="#l20.258"></a><span id="l20.258" class="difflineplus">+      messenger.setWindow(window, msgWindow);</span>
<a href="#l20.259"></a><span id="l20.259" class="difflineplus">+</span>
<a href="#l20.260"></a><span id="l20.260" class="difflineplus">+      // Clear thread pane selection - otherwise, the tree tries to impose the</span>
<a href="#l20.261"></a><span id="l20.261" class="difflineplus">+      // the current selection on the new view.</span>
<a href="#l20.262"></a><span id="l20.262" class="difflineplus">+      let msgHdr = aTabInfo.hdr;</span>
<a href="#l20.263"></a><span id="l20.263" class="difflineplus">+      let msgId  = aTabInfo.selectedMsgId;</span>
<a href="#l20.264"></a><span id="l20.264" class="difflineplus">+      SelectFolder(aTabInfo.uriToOpen);</span>
<a href="#l20.265"></a><span id="l20.265" class="difflineplus">+      let folderResource = RDF.GetResource(aTabInfo.uriToOpen);</span>
<a href="#l20.266"></a><span id="l20.266" class="difflineplus">+      if (folderResource instanceof Components.interfaces.nsIMsgFolder)</span>
<a href="#l20.267"></a><span id="l20.267" class="difflineplus">+        aTabInfo.msgSelectedFolder = folderResource;</span>
<a href="#l20.268"></a><span id="l20.268" class="difflineplus">+      delete aTabInfo.uriToOpen; // destroy after use!</span>
<a href="#l20.269"></a><span id="l20.269" class="difflineplus">+      // restore our message data</span>
<a href="#l20.270"></a><span id="l20.270" class="difflineplus">+      aTabInfo.hdr = msgHdr;</span>
<a href="#l20.271"></a><span id="l20.271" class="difflineplus">+      aTabInfo.selectedMsgId = msgId;</span>
<a href="#l20.272"></a><span id="l20.272" class="difflineplus">+</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineplus">+      aTabInfo.dbView = gDBView;</span>
<a href="#l20.274"></a><span id="l20.274" class="difflineplus">+      UpdateMailToolbar(&quot;new tab&quot;);</span>
<a href="#l20.275"></a><span id="l20.275" class="difflineplus">+    }</span>
<a href="#l20.276"></a><span id="l20.276" class="difflineplus">+</span>
<a href="#l20.277"></a><span id="l20.277" class="difflineplus">+    // restore layout if present</span>
<a href="#l20.278"></a><span id="l20.278" class="difflineplus">+    ShowThreadPane();</span>
<a href="#l20.279"></a><span id="l20.279" class="difflineplus">+    // Some modes (e.g. new message tabs) need to initially hide the splitters,</span>
<a href="#l20.280"></a><span id="l20.280" class="difflineplus">+    // this is marked by aTabInfo.clearSplitter=true.</span>
<a href="#l20.281"></a><span id="l20.281" class="difflineplus">+    let clearSplitter = &quot;clearSplitter&quot; in aTabInfo &amp;&amp; aTabInfo.clearSplitter;</span>
<a href="#l20.282"></a><span id="l20.282" class="difflineplus">+    if (clearSplitter)</span>
<a href="#l20.283"></a><span id="l20.283" class="difflineplus">+    {</span>
<a href="#l20.284"></a><span id="l20.284" class="difflineplus">+      aTabInfo.messageSplitter.collapsible = true;</span>
<a href="#l20.285"></a><span id="l20.285" class="difflineplus">+      aTabInfo.folderSplitter.collapsible  = true;</span>
<a href="#l20.286"></a><span id="l20.286" class="difflineplus">+      delete aTabInfo.clearSplitter;</span>
<a href="#l20.287"></a><span id="l20.287" class="difflineplus">+    }</span>
<a href="#l20.288"></a><span id="l20.288" class="difflineplus">+    SetSplitterState(GetThreadAndMessagePaneSplitter(), aTabInfo.messageSplitter);</span>
<a href="#l20.289"></a><span id="l20.289" class="difflineplus">+    SetSplitterState(GetFolderPaneSplitter(),           aTabInfo.folderSplitter);</span>
<a href="#l20.290"></a><span id="l20.290" class="difflineplus">+    this._updatePaneLayout(aTabInfo);</span>
<a href="#l20.291"></a><span id="l20.291" class="difflineplus">+    ClearMessagePane();</span>
<a href="#l20.292"></a><span id="l20.292" class="difflineplus">+    // force header pane twisty state restoration by toggling from the opposite</span>
<a href="#l20.293"></a><span id="l20.293" class="difflineplus">+    if (gCollapsedHeaderViewMode != aTabInfo.headerViewMode)</span>
<a href="#l20.294"></a><span id="l20.294" class="difflineplus">+      ToggleHeaderView();</span>
<a href="#l20.295"></a><span id="l20.295" class="difflineplus">+</span>
<a href="#l20.296"></a><span id="l20.296" class="difflineplus">+    // restore globals</span>
<a href="#l20.297"></a><span id="l20.297" class="difflineplus">+    messenger = aTabInfo.messenger;</span>
<a href="#l20.298"></a><span id="l20.298" class="difflineplus">+    gDBView = aTabInfo.dbView;</span>
<a href="#l20.299"></a><span id="l20.299" class="difflineplus">+    gSearchSession = aTabInfo.searchSession;</span>
<a href="#l20.300"></a><span id="l20.300" class="difflineplus">+    let folderToSelect = aTabInfo.msgSelectedFolder || gDBView &amp;&amp; gDBView.msgFolder;</span>
<a href="#l20.301"></a><span id="l20.301" class="difflineplus">+</span>
<a href="#l20.302"></a><span id="l20.302" class="difflineplus">+    // restore view state if we had one</span>
<a href="#l20.303"></a><span id="l20.303" class="difflineplus">+    let folderTree = GetFolderTree();</span>
<a href="#l20.304"></a><span id="l20.304" class="difflineplus">+    let row = EnsureFolderIndex(folderTree.builderView, folderToSelect);</span>
<a href="#l20.305"></a><span id="l20.305" class="difflineplus">+    let treeBoxObj = folderTree.treeBoxObject;</span>
<a href="#l20.306"></a><span id="l20.306" class="difflineplus">+    let folderTreeSelection = treeBoxObj.view.selection;</span>
<a href="#l20.307"></a><span id="l20.307" class="difflineplus">+</span>
<a href="#l20.308"></a><span id="l20.308" class="difflineplus">+    // make sure that row.value is valid so that it doesn't mess up</span>
<a href="#l20.309"></a><span id="l20.309" class="difflineplus">+    // the call to ensureRowIsVisible()</span>
<a href="#l20.310"></a><span id="l20.310" class="difflineplus">+    if ((row &gt;= 0) &amp;&amp; !folderTreeSelection.isSelected(row))</span>
<a href="#l20.311"></a><span id="l20.311" class="difflineplus">+    {</span>
<a href="#l20.312"></a><span id="l20.312" class="difflineplus">+      gMsgFolderSelected = folderToSelect;</span>
<a href="#l20.313"></a><span id="l20.313" class="difflineplus">+      msgWindow.openFolder = folderToSelect;</span>
<a href="#l20.314"></a><span id="l20.314" class="difflineplus">+      folderTreeSelection.select(row);</span>
<a href="#l20.315"></a><span id="l20.315" class="difflineplus">+      treeBoxObj.ensureRowIsVisible(row);</span>
<a href="#l20.316"></a><span id="l20.316" class="difflineplus">+    }</span>
<a href="#l20.317"></a><span id="l20.317" class="difflineplus">+</span>
<a href="#l20.318"></a><span id="l20.318" class="difflineplus">+    if (gDBView)</span>
<a href="#l20.319"></a><span id="l20.319" class="difflineplus">+    {</span>
<a href="#l20.320"></a><span id="l20.320" class="difflineplus">+      // This sets the thread pane tree's view to the gDBView view.</span>
<a href="#l20.321"></a><span id="l20.321" class="difflineplus">+      UpdateSortIndicators(gDBView.sortType, gDBView.sortOrder);</span>
<a href="#l20.322"></a><span id="l20.322" class="difflineplus">+      RerootThreadPane();</span>
<a href="#l20.323"></a><span id="l20.323" class="difflineplus">+</span>
<a href="#l20.324"></a><span id="l20.324" class="difflineplus">+      // We don't want to reapply the mailview (threadpane changes by switching</span>
<a href="#l20.325"></a><span id="l20.325" class="difflineplus">+      // tabs alone would be rather surprising), just update the viewpicker</span>
<a href="#l20.326"></a><span id="l20.326" class="difflineplus">+      // and resave the new view.</span>
<a href="#l20.327"></a><span id="l20.327" class="difflineplus">+      UpdateViewPickerByValue(aTabInfo.mailView);</span>
<a href="#l20.328"></a><span id="l20.328" class="difflineplus">+      SetMailViewForFolder(folderToSelect, aTabInfo.mailView);</span>
<a href="#l20.329"></a><span id="l20.329" class="difflineplus">+</span>
<a href="#l20.330"></a><span id="l20.330" class="difflineplus">+      // restore quick search</span>
<a href="#l20.331"></a><span id="l20.331" class="difflineplus">+      GetSearchInput().value = aTabInfo.searchInput;</span>
<a href="#l20.332"></a><span id="l20.332" class="difflineplus">+</span>
<a href="#l20.333"></a><span id="l20.333" class="difflineplus">+      // We need to restore the selection to what it was when we switched away</span>
<a href="#l20.334"></a><span id="l20.334" class="difflineplus">+      // from this tab. We need to remember the selected keys, instead of the</span>
<a href="#l20.335"></a><span id="l20.335" class="difflineplus">+      // selected indices, since the view might have changed. But maybe the</span>
<a href="#l20.336"></a><span id="l20.336" class="difflineplus">+      // selectedIndices adjust as items are added/removed from the (hidden)</span>
<a href="#l20.337"></a><span id="l20.337" class="difflineplus">+      // view.</span>
<a href="#l20.338"></a><span id="l20.338" class="difflineplus">+      try</span>
<a href="#l20.339"></a><span id="l20.339" class="difflineplus">+      {</span>
<a href="#l20.340"></a><span id="l20.340" class="difflineplus">+        if (aTabInfo.selectedMsgId &amp;&amp; aTabInfo.msgSelectedFolder)</span>
<a href="#l20.341"></a><span id="l20.341" class="difflineplus">+        {</span>
<a href="#l20.342"></a><span id="l20.342" class="difflineplus">+          // We clear the selection in order to generate an event when we</span>
<a href="#l20.343"></a><span id="l20.343" class="difflineplus">+          // re-select our message. This destroys aTabInfo.selectedMsgId.</span>
<a href="#l20.344"></a><span id="l20.344" class="difflineplus">+          let selectedMsgId = aTabInfo.selectedMsgId;</span>
<a href="#l20.345"></a><span id="l20.345" class="difflineplus">+          ClearThreadPaneSelection();</span>
<a href="#l20.346"></a><span id="l20.346" class="difflineplus">+          aTabInfo.selectedMsgId = selectedMsgId;</span>
<a href="#l20.347"></a><span id="l20.347" class="difflineplus">+          let msgDB = aTabInfo.msgSelectedFolder.msgDatabase;</span>
<a href="#l20.348"></a><span id="l20.348" class="difflineplus">+          let msgHdr = msgDB.getMsgHdrForMessageID(aTabInfo.selectedMsgId);</span>
<a href="#l20.349"></a><span id="l20.349" class="difflineplus">+          setTimeout(gDBView.selectFolderMsgByKey,</span>
<a href="#l20.350"></a><span id="l20.350" class="difflineplus">+                     0,</span>
<a href="#l20.351"></a><span id="l20.351" class="difflineplus">+                     aTabInfo.msgSelectedFolder,</span>
<a href="#l20.352"></a><span id="l20.352" class="difflineplus">+                     msgHdr.messageKey);</span>
<a href="#l20.353"></a><span id="l20.353" class="difflineplus">+        }</span>
<a href="#l20.354"></a><span id="l20.354" class="difflineplus">+        // We do not clear the selection if there was more than one message</span>
<a href="#l20.355"></a><span id="l20.355" class="difflineplus">+        // displayed.  this leaves our selection intact. there was originally</span>
<a href="#l20.356"></a><span id="l20.356" class="difflineplus">+        // some claim that the selection might lose synchronization with the</span>
<a href="#l20.357"></a><span id="l20.357" class="difflineplus">+        // view, but this is unsubstantiated.  said comment came from the</span>
<a href="#l20.358"></a><span id="l20.358" class="difflineplus">+        // original code that stored information on the selected rows, but</span>
<a href="#l20.359"></a><span id="l20.359" class="difflineplus">+        // then failed to do anything with it, probably because there is no</span>
<a href="#l20.360"></a><span id="l20.360" class="difflineplus">+        // existing API call that accomplishes it.</span>
<a href="#l20.361"></a><span id="l20.361" class="difflineplus">+      }</span>
<a href="#l20.362"></a><span id="l20.362" class="difflineplus">+      catch (ex)</span>
<a href="#l20.363"></a><span id="l20.363" class="difflineplus">+      {</span>
<a href="#l20.364"></a><span id="l20.364" class="difflineplus">+        dump(ex);</span>
<a href="#l20.365"></a><span id="l20.365" class="difflineplus">+      }</span>
<a href="#l20.366"></a><span id="l20.366" class="difflineplus">+      GetThreadTree().treeBoxObject.scrollToRow(aTabInfo.firstVisibleRow);</span>
<a href="#l20.367"></a><span id="l20.367" class="difflineplus">+    }</span>
<a href="#l20.368"></a><span id="l20.368" class="difflineplus">+    else if (gMsgFolderSelected.isServer)</span>
<a href="#l20.369"></a><span id="l20.369" class="difflineplus">+    {</span>
<a href="#l20.370"></a><span id="l20.370" class="difflineplus">+      // Load AccountCentral page here.</span>
<a href="#l20.371"></a><span id="l20.371" class="difflineplus">+      ShowAccountCentral();</span>
<a href="#l20.372"></a><span id="l20.372" class="difflineplus">+    }</span>
<a href="#l20.373"></a><span id="l20.373" class="difflineplus">+    UpdateLocationBar(gMsgFolderSelected);</span>
<a href="#l20.374"></a><span id="l20.374" class="difflineplus">+    UpdateMailToolbar(&quot;tab changed&quot;);</span>
<a href="#l20.375"></a><span id="l20.375" class="difflineplus">+    delete aTabInfo.lock;</span>
<a href="#l20.376"></a><span id="l20.376" class="difflineplus">+  },</span>
<a href="#l20.377"></a><span id="l20.377" class="difflineplus">+</span>
<a href="#l20.378"></a><span id="l20.378" class="difflineplus">+  closeTab: function(aTabInfo)</span>
<a href="#l20.379"></a><span id="l20.379" class="difflineplus">+  {</span>
<a href="#l20.380"></a><span id="l20.380" class="difflineplus">+    if (aTabInfo.dbView)</span>
<a href="#l20.381"></a><span id="l20.381" class="difflineplus">+      aTabInfo.dbView.close();</span>
<a href="#l20.382"></a><span id="l20.382" class="difflineplus">+    if (aTabInfo.messenger)</span>
<a href="#l20.383"></a><span id="l20.383" class="difflineplus">+      aTabInfo.messenger.setWindow(null, null);</span>
<a href="#l20.384"></a><span id="l20.384" class="difflineplus">+  },</span>
<a href="#l20.385"></a><span id="l20.385" class="difflineplus">+</span>
<a href="#l20.386"></a><span id="l20.386" class="difflineplus">+  // called when switching away from aTabInfo</span>
<a href="#l20.387"></a><span id="l20.387" class="difflineplus">+  saveTabState: function(aTabInfo)</span>
<a href="#l20.388"></a><span id="l20.388" class="difflineplus">+  {</span>
<a href="#l20.389"></a><span id="l20.389" class="difflineplus">+    if (aTabInfo.lock)</span>
<a href="#l20.390"></a><span id="l20.390" class="difflineplus">+      return;</span>
<a href="#l20.391"></a><span id="l20.391" class="difflineplus">+</span>
<a href="#l20.392"></a><span id="l20.392" class="difflineplus">+    // save message db data and view filters</span>
<a href="#l20.393"></a><span id="l20.393" class="difflineplus">+    aTabInfo.messenger = messenger;</span>
<a href="#l20.394"></a><span id="l20.394" class="difflineplus">+    aTabInfo.dbView = gDBView;</span>
<a href="#l20.395"></a><span id="l20.395" class="difflineplus">+    aTabInfo.searchSession = gSearchSession;</span>
<a href="#l20.396"></a><span id="l20.396" class="difflineplus">+    aTabInfo.msgSelectedFolder = gMsgFolderSelected;</span>
<a href="#l20.397"></a><span id="l20.397" class="difflineplus">+    aTabInfo.selectedMsgId = null;</span>
<a href="#l20.398"></a><span id="l20.398" class="difflineplus">+    if (gDBView)</span>
<a href="#l20.399"></a><span id="l20.399" class="difflineplus">+    {</span>
<a href="#l20.400"></a><span id="l20.400" class="difflineplus">+      // save thread pane scroll position</span>
<a href="#l20.401"></a><span id="l20.401" class="difflineplus">+      aTabInfo.firstVisibleRow = GetThreadTree().treeBoxObject.getFirstVisibleRow();</span>
<a href="#l20.402"></a><span id="l20.402" class="difflineplus">+</span>
<a href="#l20.403"></a><span id="l20.403" class="difflineplus">+      let curMsgViewIndex = gDBView.currentlyDisplayedMessage;</span>
<a href="#l20.404"></a><span id="l20.404" class="difflineplus">+      if (curMsgViewIndex != nsMsgViewIndex_None)</span>
<a href="#l20.405"></a><span id="l20.405" class="difflineplus">+      {</span>
<a href="#l20.406"></a><span id="l20.406" class="difflineplus">+        try // there may not be a selected message.</span>
<a href="#l20.407"></a><span id="l20.407" class="difflineplus">+        {</span>
<a href="#l20.408"></a><span id="l20.408" class="difflineplus">+          // the currentlyDisplayedMessage is not always the first selected</span>
<a href="#l20.409"></a><span id="l20.409" class="difflineplus">+          // message, e.g. on a right click for the context menu</span>
<a href="#l20.410"></a><span id="l20.410" class="difflineplus">+          let curMsgHdr = gDBView.getMsgHdrAt(curMsgViewIndex);</span>
<a href="#l20.411"></a><span id="l20.411" class="difflineplus">+          aTabInfo.selectedMsgId = curMsgHdr.messageId;</span>
<a href="#l20.412"></a><span id="l20.412" class="difflineplus">+        }</span>
<a href="#l20.413"></a><span id="l20.413" class="difflineplus">+        catch (ex) {}</span>
<a href="#l20.414"></a><span id="l20.414" class="difflineplus">+      }</span>
<a href="#l20.415"></a><span id="l20.415" class="difflineplus">+      if (!aTabInfo.selectedMsgId)</span>
<a href="#l20.416"></a><span id="l20.416" class="difflineplus">+        aTabInfo.msgSelectedFolder = gDBView.msgFolder;</span>
<a href="#l20.417"></a><span id="l20.417" class="difflineplus">+    }</span>
<a href="#l20.418"></a><span id="l20.418" class="difflineplus">+    aTabInfo.mailView = GetMailViewForFolder(aTabInfo.msgSelectedFolder);</span>
<a href="#l20.419"></a><span id="l20.419" class="difflineplus">+</span>
<a href="#l20.420"></a><span id="l20.420" class="difflineplus">+    // remember layout</span>
<a href="#l20.421"></a><span id="l20.421" class="difflineplus">+    aTabInfo.modeBits = this.getCurrentModeBits();</span>
<a href="#l20.422"></a><span id="l20.422" class="difflineplus">+    aTabInfo.messageSplitter = GetSplitterState(GetThreadAndMessagePaneSplitter());</span>
<a href="#l20.423"></a><span id="l20.423" class="difflineplus">+    aTabInfo.folderSplitter  = GetSplitterState(GetFolderPaneSplitter());</span>
<a href="#l20.424"></a><span id="l20.424" class="difflineplus">+</span>
<a href="#l20.425"></a><span id="l20.425" class="difflineplus">+    // header pane twisty state</span>
<a href="#l20.426"></a><span id="l20.426" class="difflineplus">+    aTabInfo.headerViewMode = gCollapsedHeaderViewMode;</span>
<a href="#l20.427"></a><span id="l20.427" class="difflineplus">+</span>
<a href="#l20.428"></a><span id="l20.428" class="difflineplus">+    // quick search</span>
<a href="#l20.429"></a><span id="l20.429" class="difflineplus">+    aTabInfo.searchInput = GetSearchInput().value;</span>
<a href="#l20.430"></a><span id="l20.430" class="difflineplus">+  },</span>
<a href="#l20.431"></a><span id="l20.431" class="difflineplus">+</span>
<a href="#l20.432"></a><span id="l20.432" class="difflineplus">+  onTitleChanged: function(aTabInfo, aTabNode)</span>
<a href="#l20.433"></a><span id="l20.433" class="difflineplus">+  {</span>
<a href="#l20.434"></a><span id="l20.434" class="difflineplus">+    // If we have an account, we also always have a &quot;Local Folders&quot; account,</span>
<a href="#l20.435"></a><span id="l20.435" class="difflineplus">+    let accountCount = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l20.436"></a><span id="l20.436" class="difflineplus">+                                 .getService(Components.interfaces.nsIMsgAccountManager)</span>
<a href="#l20.437"></a><span id="l20.437" class="difflineplus">+                                 .accounts.Count();</span>
<a href="#l20.438"></a><span id="l20.438" class="difflineplus">+    let multipleRealAccounts = accountCount &gt; 2;</span>
<a href="#l20.439"></a><span id="l20.439" class="difflineplus">+</span>
<a href="#l20.440"></a><span id="l20.440" class="difflineplus">+    // clear out specific tab data now, because we might need to return early</span>
<a href="#l20.441"></a><span id="l20.441" class="difflineplus">+    aTabNode.removeAttribute(&quot;SpecialFolder&quot;);</span>
<a href="#l20.442"></a><span id="l20.442" class="difflineplus">+    aTabNode.removeAttribute(&quot;ServerType&quot;);</span>
<a href="#l20.443"></a><span id="l20.443" class="difflineplus">+    aTabNode.removeAttribute(&quot;IsServer&quot;);</span>
<a href="#l20.444"></a><span id="l20.444" class="difflineplus">+    aTabNode.removeAttribute(&quot;IsSecure&quot;);</span>
<a href="#l20.445"></a><span id="l20.445" class="difflineplus">+    aTabNode.removeAttribute(&quot;NewMessages&quot;);</span>
<a href="#l20.446"></a><span id="l20.446" class="difflineplus">+    aTabNode.removeAttribute(&quot;ImapShared&quot;);</span>
<a href="#l20.447"></a><span id="l20.447" class="difflineplus">+    aTabNode.removeAttribute(&quot;BiffState&quot;);</span>
<a href="#l20.448"></a><span id="l20.448" class="difflineplus">+    aTabNode.removeAttribute(&quot;MessageType&quot;);</span>
<a href="#l20.449"></a><span id="l20.449" class="difflineplus">+    aTabNode.removeAttribute(&quot;Offline&quot;);</span>
<a href="#l20.450"></a><span id="l20.450" class="difflineplus">+    aTabNode.removeAttribute(&quot;Attachment&quot;);</span>
<a href="#l20.451"></a><span id="l20.451" class="difflineplus">+    aTabNode.removeAttribute(&quot;IMAPDeleted&quot;);</span>
<a href="#l20.452"></a><span id="l20.452" class="difflineplus">+</span>
<a href="#l20.453"></a><span id="l20.453" class="difflineplus">+    // aTabInfo.msgSelectedFolder may contain the base folder of saved search</span>
<a href="#l20.454"></a><span id="l20.454" class="difflineplus">+    let msgSelectedFolder = null;</span>
<a href="#l20.455"></a><span id="l20.455" class="difflineplus">+    if (aTabInfo.uriToOpen)</span>
<a href="#l20.456"></a><span id="l20.456" class="difflineplus">+    {</span>
<a href="#l20.457"></a><span id="l20.457" class="difflineplus">+      // select folder for the backgound tab without changing the current one</span>
<a href="#l20.458"></a><span id="l20.458" class="difflineplus">+      // (stolen from SelectFolder)</span>
<a href="#l20.459"></a><span id="l20.459" class="difflineplus">+      let folderResource = RDF.GetResource(aTabInfo.uriToOpen);</span>
<a href="#l20.460"></a><span id="l20.460" class="difflineplus">+      if (folderResource instanceof Components.interfaces.nsIMsgFolder)</span>
<a href="#l20.461"></a><span id="l20.461" class="difflineplus">+        msgSelectedFolder = folderResource;</span>
<a href="#l20.462"></a><span id="l20.462" class="difflineplus">+    }</span>
<a href="#l20.463"></a><span id="l20.463" class="difflineplus">+    else</span>
<a href="#l20.464"></a><span id="l20.464" class="difflineplus">+    {</span>
<a href="#l20.465"></a><span id="l20.465" class="difflineplus">+      msgSelectedFolder = (aTabInfo.dbView &amp;&amp; aTabInfo.dbView.viewFolder) ||</span>
<a href="#l20.466"></a><span id="l20.466" class="difflineplus">+                          (aTabInfo.dbView &amp;&amp; aTabInfo.dbView.msgFolder) ||</span>
<a href="#l20.467"></a><span id="l20.467" class="difflineplus">+                          aTabInfo.msgSelectedFolder ||</span>
<a href="#l20.468"></a><span id="l20.468" class="difflineplus">+                          gMsgFolderSelected;</span>
<a href="#l20.469"></a><span id="l20.469" class="difflineplus">+    }</span>
<a href="#l20.470"></a><span id="l20.470" class="difflineplus">+</span>
<a href="#l20.471"></a><span id="l20.471" class="difflineplus">+    // update the message header only if we're the current tab</span>
<a href="#l20.472"></a><span id="l20.472" class="difflineplus">+    if (aTabNode.selected)</span>
<a href="#l20.473"></a><span id="l20.473" class="difflineplus">+    {</span>
<a href="#l20.474"></a><span id="l20.474" class="difflineplus">+      try</span>
<a href="#l20.475"></a><span id="l20.475" class="difflineplus">+      {</span>
<a href="#l20.476"></a><span id="l20.476" class="difflineplus">+        aTabInfo.hdr = aTabInfo.dbView &amp;&amp; aTabInfo.dbView.hdrForFirstSelectedMessage;</span>
<a href="#l20.477"></a><span id="l20.477" class="difflineplus">+      }</span>
<a href="#l20.478"></a><span id="l20.478" class="difflineplus">+      catch (e)</span>
<a href="#l20.479"></a><span id="l20.479" class="difflineplus">+      {</span>
<a href="#l20.480"></a><span id="l20.480" class="difflineplus">+        aTabInfo.hdr = null;</span>
<a href="#l20.481"></a><span id="l20.481" class="difflineplus">+      }</span>
<a href="#l20.482"></a><span id="l20.482" class="difflineplus">+    }</span>
<a href="#l20.483"></a><span id="l20.483" class="difflineplus">+</span>
<a href="#l20.484"></a><span id="l20.484" class="difflineplus">+    // update tab title and icon state</span>
<a href="#l20.485"></a><span id="l20.485" class="difflineplus">+    aTabInfo.title = &quot;&quot;;</span>
<a href="#l20.486"></a><span id="l20.486" class="difflineplus">+    if (IsMessagePaneCollapsed() || !aTabInfo.hdr)</span>
<a href="#l20.487"></a><span id="l20.487" class="difflineplus">+    {</span>
<a href="#l20.488"></a><span id="l20.488" class="difflineplus">+      // Folder Tab</span>
<a href="#l20.489"></a><span id="l20.489" class="difflineplus">+      aTabNode.setAttribute(&quot;type&quot;, &quot;folder&quot;); // override &quot;3pane&quot;</span>
<a href="#l20.490"></a><span id="l20.490" class="difflineplus">+      if (!msgSelectedFolder)</span>
<a href="#l20.491"></a><span id="l20.491" class="difflineplus">+      {</span>
<a href="#l20.492"></a><span id="l20.492" class="difflineplus">+        // nothing to do</span>
<a href="#l20.493"></a><span id="l20.493" class="difflineplus">+        return;</span>
<a href="#l20.494"></a><span id="l20.494" class="difflineplus">+      }</span>
<a href="#l20.495"></a><span id="l20.495" class="difflineplus">+      else</span>
<a href="#l20.496"></a><span id="l20.496" class="difflineplus">+      {</span>
<a href="#l20.497"></a><span id="l20.497" class="difflineplus">+        aTabInfo.title = msgSelectedFolder.prettyName;</span>
<a href="#l20.498"></a><span id="l20.498" class="difflineplus">+        if (!msgSelectedFolder.isServer &amp;&amp; multipleRealAccounts)</span>
<a href="#l20.499"></a><span id="l20.499" class="difflineplus">+          aTabInfo.title += &quot; - &quot; + msgSelectedFolder.server.prettyName;</span>
<a href="#l20.500"></a><span id="l20.500" class="difflineplus">+      }</span>
<a href="#l20.501"></a><span id="l20.501" class="difflineplus">+</span>
<a href="#l20.502"></a><span id="l20.502" class="difflineplus">+      // The user may have changed folders, triggering our onTitleChanged callback.</span>
<a href="#l20.503"></a><span id="l20.503" class="difflineplus">+      // Update the appropriate attributes on the tab.</span>
<a href="#l20.504"></a><span id="l20.504" class="difflineplus">+      aTabNode.setAttribute(&quot;SpecialFolder&quot;, getSpecialFolderString(msgSelectedFolder));</span>
<a href="#l20.505"></a><span id="l20.505" class="difflineplus">+      aTabNode.setAttribute(&quot;ServerType&quot;,    msgSelectedFolder.server.type);</span>
<a href="#l20.506"></a><span id="l20.506" class="difflineplus">+      aTabNode.setAttribute(&quot;IsServer&quot;,      msgSelectedFolder.isServer);</span>
<a href="#l20.507"></a><span id="l20.507" class="difflineplus">+      aTabNode.setAttribute(&quot;IsSecure&quot;,      msgSelectedFolder.server.isSecure);</span>
<a href="#l20.508"></a><span id="l20.508" class="difflineplus">+      aTabNode.setAttribute(&quot;NewMessages&quot;,   msgSelectedFolder.hasNewMessages);</span>
<a href="#l20.509"></a><span id="l20.509" class="difflineplus">+      aTabNode.setAttribute(&quot;ImapShared&quot;,    msgSelectedFolder.imapShared);</span>
<a href="#l20.510"></a><span id="l20.510" class="difflineplus">+</span>
<a href="#l20.511"></a><span id="l20.511" class="difflineplus">+      let biffState = &quot;UnknownMail&quot;;</span>
<a href="#l20.512"></a><span id="l20.512" class="difflineplus">+      switch (msgSelectedFolder.biffState)</span>
<a href="#l20.513"></a><span id="l20.513" class="difflineplus">+      {</span>
<a href="#l20.514"></a><span id="l20.514" class="difflineplus">+        case Components.interfaces.nsIMsgFolder.nsMsgBiffState_NewMail:</span>
<a href="#l20.515"></a><span id="l20.515" class="difflineplus">+          biffState = &quot;NewMail&quot;;</span>
<a href="#l20.516"></a><span id="l20.516" class="difflineplus">+          break;</span>
<a href="#l20.517"></a><span id="l20.517" class="difflineplus">+        case Components.interfaces.nsIMsgFolder.nsMsgBiffState_NoMail:</span>
<a href="#l20.518"></a><span id="l20.518" class="difflineplus">+          biffState = &quot;NoMail&quot;;</span>
<a href="#l20.519"></a><span id="l20.519" class="difflineplus">+          break;</span>
<a href="#l20.520"></a><span id="l20.520" class="difflineplus">+      }</span>
<a href="#l20.521"></a><span id="l20.521" class="difflineplus">+      aTabNode.setAttribute(&quot;BiffState&quot;, biffState);</span>
<a href="#l20.522"></a><span id="l20.522" class="difflineplus">+    }</span>
<a href="#l20.523"></a><span id="l20.523" class="difflineplus">+    else</span>
<a href="#l20.524"></a><span id="l20.524" class="difflineplus">+    {</span>
<a href="#l20.525"></a><span id="l20.525" class="difflineplus">+      // Message Tab</span>
<a href="#l20.526"></a><span id="l20.526" class="difflineplus">+      aTabNode.setAttribute(&quot;type&quot;, &quot;message&quot;); // override &quot;3pane&quot;</span>
<a href="#l20.527"></a><span id="l20.527" class="difflineplus">+      if (aTabInfo.hdr.flags &amp; Components.interfaces.nsMsgMessageFlags.HasRe)</span>
<a href="#l20.528"></a><span id="l20.528" class="difflineplus">+        aTabInfo.title = &quot;Re: &quot;;</span>
<a href="#l20.529"></a><span id="l20.529" class="difflineplus">+      if (aTabInfo.hdr.mime2DecodedSubject)</span>
<a href="#l20.530"></a><span id="l20.530" class="difflineplus">+        aTabInfo.title += aTabInfo.hdr.mime2DecodedSubject;</span>
<a href="#l20.531"></a><span id="l20.531" class="difflineplus">+      aTabInfo.title += &quot; - &quot; + aTabInfo.hdr.folder.prettyName;</span>
<a href="#l20.532"></a><span id="l20.532" class="difflineplus">+      if (multipleRealAccounts)</span>
<a href="#l20.533"></a><span id="l20.533" class="difflineplus">+        aTabInfo.title += &quot; - &quot; + aTabInfo.hdr.folder.server.prettyName;</span>
<a href="#l20.534"></a><span id="l20.534" class="difflineplus">+</span>
<a href="#l20.535"></a><span id="l20.535" class="difflineplus">+      // message specific tab data</span>
<a href="#l20.536"></a><span id="l20.536" class="difflineplus">+      const nsMsgMessageFlags = Components.interfaces.nsMsgMessageFlags;</span>
<a href="#l20.537"></a><span id="l20.537" class="difflineplus">+      let flags = aTabInfo.hdr.flags;</span>
<a href="#l20.538"></a><span id="l20.538" class="difflineplus">+      aTabNode.setAttribute(&quot;MessageType&quot;, msgSelectedFolder.server.type);</span>
<a href="#l20.539"></a><span id="l20.539" class="difflineplus">+      aTabNode.setAttribute(&quot;Offline&quot;,     Boolean(flags &amp; nsMsgMessageFlags.Offline));</span>
<a href="#l20.540"></a><span id="l20.540" class="difflineplus">+      aTabNode.setAttribute(&quot;Attachment&quot;,  Boolean(flags &amp; nsMsgMessageFlags.Attachment));</span>
<a href="#l20.541"></a><span id="l20.541" class="difflineplus">+      aTabNode.setAttribute(&quot;IMAPDeleted&quot;, Boolean(flags &amp; nsMsgMessageFlags.IMAPDeleted));</span>
<a href="#l20.542"></a><span id="l20.542" class="difflineplus">+    }</span>
<a href="#l20.543"></a><span id="l20.543" class="difflineplus">+  },</span>
<a href="#l20.544"></a><span id="l20.544" class="difflineplus">+</span>
<a href="#l20.545"></a><span id="l20.545" class="difflineplus">+  getBrowser: function(aTabInfo)</span>
<a href="#l20.546"></a><span id="l20.546" class="difflineplus">+  {</span>
<a href="#l20.547"></a><span id="l20.547" class="difflineplus">+    // we currently use the messagepane element for all 3pane tab types</span>
<a href="#l20.548"></a><span id="l20.548" class="difflineplus">+    return getMessageBrowser();</span>
<a href="#l20.549"></a><span id="l20.549" class="difflineplus">+  },</span>
<a href="#l20.550"></a><span id="l20.550" class="difflineplus">+</span>
<a href="#l20.551"></a><span id="l20.551" class="difflineplus">+  //</span>
<a href="#l20.552"></a><span id="l20.552" class="difflineplus">+  // nsIController implementation</span>
<a href="#l20.553"></a><span id="l20.553" class="difflineplus">+  //</span>
<a href="#l20.554"></a><span id="l20.554" class="difflineplus">+  // We ignore the aTabInfo parameter sent by tabmail when calling nsIController</span>
<a href="#l20.555"></a><span id="l20.555" class="difflineplus">+  // stuff and just delegate the call to the DefaultController by using it as</span>
<a href="#l20.556"></a><span id="l20.556" class="difflineplus">+  // our proto chain.</span>
<a href="#l20.557"></a><span id="l20.557" class="difflineplus">+  // XXX remove the MessageWindowController stuff once we kill messageWindow.xul</span>
<a href="#l20.558"></a><span id="l20.558" class="difflineplus">+  __proto__: &quot;DefaultController&quot; in window &amp;&amp; window.DefaultController ||</span>
<a href="#l20.559"></a><span id="l20.559" class="difflineplus">+             &quot;MessageWindowController&quot; in window &amp;&amp; window.MessageWindowController</span>
<a href="#l20.560"></a><span id="l20.560" class="difflineplus">+};</span>
<a href="#l20.561"></a><span id="l20.561" class="difflineplus">+</span>
<a href="#l20.562"></a><span id="l20.562" class="difflineplus">+</span>
<a href="#l20.563"></a><span id="l20.563" class="difflineplus">+</span>
<a href="#l20.564"></a><span id="l20.564" class="difflineplus">+//</span>
<a href="#l20.565"></a><span id="l20.565" class="difflineplus">+//  tabmail support methods</span>
<a href="#l20.566"></a><span id="l20.566" class="difflineplus">+//</span>
<a href="#l20.567"></a><span id="l20.567" class="difflineplus">+</span>
<a href="#l20.568"></a><span id="l20.568" class="difflineplus">+function GetTabMail()</span>
<a href="#l20.569"></a><span id="l20.569" class="difflineplus">+{</span>
<a href="#l20.570"></a><span id="l20.570" class="difflineplus">+  return document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l20.571"></a><span id="l20.571" class="difflineplus">+}</span>
<a href="#l20.572"></a><span id="l20.572" class="difflineplus">+</span>
<a href="#l20.573"></a><span id="l20.573" class="difflineplus">+function MsgOpenNewTab(aType, aModeBits)</span>
<a href="#l20.574"></a><span id="l20.574" class="difflineplus">+{</span>
<a href="#l20.575"></a><span id="l20.575" class="difflineplus">+  // duplicate the current tab</span>
<a href="#l20.576"></a><span id="l20.576" class="difflineplus">+  var tabmail = GetTabMail();</span>
<a href="#l20.577"></a><span id="l20.577" class="difflineplus">+  if (tabmail)</span>
<a href="#l20.578"></a><span id="l20.578" class="difflineplus">+    tabmail.openTab(aType, aModeBits);</span>
<a href="#l20.579"></a><span id="l20.579" class="difflineplus">+}</span>
<a href="#l20.580"></a><span id="l20.580" class="difflineplus">+</span>
<a href="#l20.581"></a><span id="l20.581" class="difflineplus">+function MsgOpenNewTabForFolder()</span>
<a href="#l20.582"></a><span id="l20.582" class="difflineplus">+{</span>
<a href="#l20.583"></a><span id="l20.583" class="difflineplus">+  // open current folder in full 3pane tab</span>
<a href="#l20.584"></a><span id="l20.584" class="difflineplus">+  MsgOpenNewTab(&quot;3pane&quot;, kTabModeFolder);</span>
<a href="#l20.585"></a><span id="l20.585" class="difflineplus">+}</span>
<a href="#l20.586"></a><span id="l20.586" class="difflineplus">+</span>
<a href="#l20.587"></a><span id="l20.587" class="difflineplus">+function MsgOpenNewTabForMessage()</span>
<a href="#l20.588"></a><span id="l20.588" class="difflineplus">+{</span>
<a href="#l20.589"></a><span id="l20.589" class="difflineplus">+  // open current message in message tab</span>
<a href="#l20.590"></a><span id="l20.590" class="difflineplus">+  MsgOpenNewTab(&quot;3pane&quot;, kTabModeMessage);</span>
<a href="#l20.591"></a><span id="l20.591" class="difflineplus">+}</span>
<a href="#l20.592"></a><span id="l20.592" class="difflineplus">+</span>
<a href="#l20.593"></a><span id="l20.593" class="difflineplus">+function MsgCloseCurrentTab()</span>
<a href="#l20.594"></a><span id="l20.594" class="difflineplus">+{</span>
<a href="#l20.595"></a><span id="l20.595" class="difflineplus">+  var tabmail = GetTabMail();</span>
<a href="#l20.596"></a><span id="l20.596" class="difflineplus">+  if (tabmail.tabInfo.length &gt; 1)</span>
<a href="#l20.597"></a><span id="l20.597" class="difflineplus">+    tabmail.removeCurrentTab();</span>
<a href="#l20.598"></a><span id="l20.598" class="difflineplus">+  else</span>
<a href="#l20.599"></a><span id="l20.599" class="difflineplus">+    CloseMailWindow();</span>
<a href="#l20.600"></a><span id="l20.600" class="difflineplus">+}</span>
<a href="#l20.601"></a><span id="l20.601" class="difflineplus">+</span>
<a href="#l20.602"></a><span id="l20.602" class="difflineplus">+function AllowOpenTabOnMiddleClick()</span>
<a href="#l20.603"></a><span id="l20.603" class="difflineplus">+{</span>
<a href="#l20.604"></a><span id="l20.604" class="difflineplus">+  return GetPrefService().getBoolPref(&quot;browser.tabs.opentabfor.middleclick&quot;);</span>
<a href="#l20.605"></a><span id="l20.605" class="difflineplus">+}</span>
<a href="#l20.606"></a><span id="l20.606" class="difflineplus">+</span>
<a href="#l20.607"></a><span id="l20.607" class="difflineplus">+function AllowOpenTabOnDoubleClick()</span>
<a href="#l20.608"></a><span id="l20.608" class="difflineplus">+{</span>
<a href="#l20.609"></a><span id="l20.609" class="difflineplus">+  return GetPrefService().getBoolPref(&quot;browser.tabs.opentabfor.doubleclick&quot;);</span>
<a href="#l20.610"></a><span id="l20.610" class="difflineplus">+}</span>
<a href="#l20.611"></a><span id="l20.611" class="difflineplus">+</span>
<a href="#l20.612"></a><span id="l20.612" class="difflineplus">+//</span>
<a href="#l20.613"></a><span id="l20.613" class="difflineplus">+// pane management</span>
<a href="#l20.614"></a><span id="l20.614" class="difflineplus">+// (maybe we should cache these items in a global object?)</span>
<a href="#l20.615"></a><span id="l20.615" class="difflineplus">+//</span>
<a href="#l20.616"></a><span id="l20.616" class="difflineplus">+</span>
<a href="#l20.617"></a><span id="l20.617" class="difflineplus">+function GetFolderPane()</span>
<a href="#l20.618"></a><span id="l20.618" class="difflineplus">+{</span>
<a href="#l20.619"></a><span id="l20.619" class="difflineplus">+  return document.getElementById(&quot;folderPaneBox&quot;);</span>
<a href="#l20.620"></a><span id="l20.620" class="difflineplus">+}</span>
<a href="#l20.621"></a><span id="l20.621" class="difflineplus">+</span>
<a href="#l20.622"></a><span id="l20.622" class="difflineplus">+function GetThreadPane()</span>
<a href="#l20.623"></a><span id="l20.623" class="difflineplus">+{</span>
<a href="#l20.624"></a><span id="l20.624" class="difflineplus">+  return document.getElementById(&quot;threadPaneBox&quot;);</span>
<a href="#l20.625"></a><span id="l20.625" class="difflineplus">+}</span>
<a href="#l20.626"></a><span id="l20.626" class="difflineplus">+</span>
<a href="#l20.627"></a><span id="l20.627" class="difflineplus">+function GetDisplayDeck()</span>
<a href="#l20.628"></a><span id="l20.628" class="difflineplus">+{</span>
<a href="#l20.629"></a><span id="l20.629" class="difflineplus">+  return document.getElementById(&quot;displayDeck&quot;);</span>
<a href="#l20.630"></a><span id="l20.630" class="difflineplus">+}</span>
<a href="#l20.631"></a><span id="l20.631" class="difflineplus">+</span>
<a href="#l20.632"></a><span id="l20.632" class="difflineplus">+function GetMessagePane()</span>
<a href="#l20.633"></a><span id="l20.633" class="difflineplus">+{</span>
<a href="#l20.634"></a><span id="l20.634" class="difflineplus">+  return document.getElementById(&quot;messagepanebox&quot;);</span>
<a href="#l20.635"></a><span id="l20.635" class="difflineplus">+}</span>
<a href="#l20.636"></a><span id="l20.636" class="difflineplus">+</span>
<a href="#l20.637"></a><span id="l20.637" class="difflineplus">+function GetHeaderPane()</span>
<a href="#l20.638"></a><span id="l20.638" class="difflineplus">+{</span>
<a href="#l20.639"></a><span id="l20.639" class="difflineplus">+  return document.getElementById(&quot;msgHeaderView&quot;);</span>
<a href="#l20.640"></a><span id="l20.640" class="difflineplus">+}</span>
<a href="#l20.641"></a><span id="l20.641" class="difflineplus">+</span>
<a href="#l20.642"></a><span id="l20.642" class="difflineplus">+function GetFolderPaneSplitter()</span>
<a href="#l20.643"></a><span id="l20.643" class="difflineplus">+{</span>
<a href="#l20.644"></a><span id="l20.644" class="difflineplus">+  return document.getElementById(&quot;folderpane-splitter&quot;);</span>
<a href="#l20.645"></a><span id="l20.645" class="difflineplus">+}</span>
<a href="#l20.646"></a><span id="l20.646" class="difflineplus">+</span>
<a href="#l20.647"></a><span id="l20.647" class="difflineplus">+function GetThreadAndMessagePaneSplitter()</span>
<a href="#l20.648"></a><span id="l20.648" class="difflineplus">+{</span>
<a href="#l20.649"></a><span id="l20.649" class="difflineplus">+  return document.getElementById(&quot;threadpane-splitter&quot;);</span>
<a href="#l20.650"></a><span id="l20.650" class="difflineplus">+}</span>
<a href="#l20.651"></a><span id="l20.651" class="difflineplus">+</span>
<a href="#l20.652"></a><span id="l20.652" class="difflineplus">+</span>
<a href="#l20.653"></a><span id="l20.653" class="difflineplus">+</span>
<a href="#l20.654"></a><span id="l20.654" class="difflineplus">+//</span>
<a href="#l20.655"></a><span id="l20.655" class="difflineplus">+// pane visibility management</span>
<a href="#l20.656"></a><span id="l20.656" class="difflineplus">+//</span>
<a href="#l20.657"></a><span id="l20.657" class="difflineplus">+// - collapsing the folderpane by clicking its splitter doesn't need</span>
<a href="#l20.658"></a><span id="l20.658" class="difflineplus">+//   additional processing</span>
<a href="#l20.659"></a><span id="l20.659" class="difflineplus">+// - collapsing the messagepane by clicking its splitter needs some special</span>
<a href="#l20.660"></a><span id="l20.660" class="difflineplus">+//   treatment of attachments, gDBView, etc.</span>
<a href="#l20.661"></a><span id="l20.661" class="difflineplus">+// - the threadpane has no splitter assigned to it</span>
<a href="#l20.662"></a><span id="l20.662" class="difflineplus">+// - collapsing the messagepane, threadpane or folderpane by &lt;key&gt; needs to</span>
<a href="#l20.663"></a><span id="l20.663" class="difflineplus">+//   pay attention to the other panes' (and splitters') visibility</span>
<a href="#l20.664"></a><span id="l20.664" class="difflineplus">+</span>
<a href="#l20.665"></a><span id="l20.665" class="difflineplus">+function IsMessagePaneCollapsed()</span>
<a href="#l20.666"></a><span id="l20.666" class="difflineplus">+{</span>
<a href="#l20.667"></a><span id="l20.667" class="difflineplus">+  return GetMessagePane().collapsed;</span>
<a href="#l20.668"></a><span id="l20.668" class="difflineplus">+}</span>
<a href="#l20.669"></a><span id="l20.669" class="difflineplus">+</span>
<a href="#l20.670"></a><span id="l20.670" class="difflineplus">+function IsDisplayDeckCollapsed()</span>
<a href="#l20.671"></a><span id="l20.671" class="difflineplus">+{</span>
<a href="#l20.672"></a><span id="l20.672" class="difflineplus">+  // regard display deck as collapsed in the standalone message window</span>
<a href="#l20.673"></a><span id="l20.673" class="difflineplus">+  var displayDeck = GetDisplayDeck();</span>
<a href="#l20.674"></a><span id="l20.674" class="difflineplus">+  return !displayDeck || displayDeck.collapsed;</span>
<a href="#l20.675"></a><span id="l20.675" class="difflineplus">+}</span>
<a href="#l20.676"></a><span id="l20.676" class="difflineplus">+</span>
<a href="#l20.677"></a><span id="l20.677" class="difflineplus">+function IsFolderPaneCollapsed()</span>
<a href="#l20.678"></a><span id="l20.678" class="difflineplus">+{</span>
<a href="#l20.679"></a><span id="l20.679" class="difflineplus">+  // regard folderpane as collapsed in the standalone message window</span>
<a href="#l20.680"></a><span id="l20.680" class="difflineplus">+  var folderPane = GetFolderPane();</span>
<a href="#l20.681"></a><span id="l20.681" class="difflineplus">+  return !folderPane || folderPane.collapsed;</span>
<a href="#l20.682"></a><span id="l20.682" class="difflineplus">+}</span>
<a href="#l20.683"></a><span id="l20.683" class="difflineplus">+</span>
<a href="#l20.684"></a><span id="l20.684" class="difflineplus">+// Which state is the splitter in? Is it collapsed?</span>
<a href="#l20.685"></a><span id="l20.685" class="difflineplus">+// How wide/high is the associated pane?</span>
<a href="#l20.686"></a><span id="l20.686" class="difflineplus">+function GetSplitterState(aSplitter)</span>
<a href="#l20.687"></a><span id="l20.687" class="difflineplus">+{</span>
<a href="#l20.688"></a><span id="l20.688" class="difflineplus">+  var next = aSplitter.getAttribute(&quot;collapse&quot;) == &quot;after&quot;;</span>
<a href="#l20.689"></a><span id="l20.689" class="difflineplus">+  var pane = next ? aSplitter.nextSibling : aSplitter.previousSibling;</span>
<a href="#l20.690"></a><span id="l20.690" class="difflineplus">+  var vertical = aSplitter.orient == &quot;vertical&quot;;</span>
<a href="#l20.691"></a><span id="l20.691" class="difflineplus">+  var rv =</span>
<a href="#l20.692"></a><span id="l20.692" class="difflineplus">+  {</span>
<a href="#l20.693"></a><span id="l20.693" class="difflineplus">+    state:     aSplitter.getAttribute(&quot;state&quot;),</span>
<a href="#l20.694"></a><span id="l20.694" class="difflineplus">+    collapsed: aSplitter.collapsed,</span>
<a href="#l20.695"></a><span id="l20.695" class="difflineplus">+    // &lt;splitter&gt;s are &lt;hbox&gt;es,</span>
<a href="#l20.696"></a><span id="l20.696" class="difflineplus">+    // thus the &quot;orient&quot; attribute is usually either unset or &quot;vertical&quot;</span>
<a href="#l20.697"></a><span id="l20.697" class="difflineplus">+    size:      vertical ? pane.height : pane.width,</span>
<a href="#l20.698"></a><span id="l20.698" class="difflineplus">+    collapsible: &quot;collapsible&quot; in aSplitter &amp;&amp; aSplitter.collapsible</span>
<a href="#l20.699"></a><span id="l20.699" class="difflineplus">+  };</span>
<a href="#l20.700"></a><span id="l20.700" class="difflineplus">+  return rv;</span>
<a href="#l20.701"></a><span id="l20.701" class="difflineplus">+}</span>
<a href="#l20.702"></a><span id="l20.702" class="difflineplus">+</span>
<a href="#l20.703"></a><span id="l20.703" class="difflineplus">+function SetSplitterState(aSplitter, aState)</span>
<a href="#l20.704"></a><span id="l20.704" class="difflineplus">+{</span>
<a href="#l20.705"></a><span id="l20.705" class="difflineplus">+  // all settings in aState are optional</span>
<a href="#l20.706"></a><span id="l20.706" class="difflineplus">+  if (!aState)</span>
<a href="#l20.707"></a><span id="l20.707" class="difflineplus">+    return;</span>
<a href="#l20.708"></a><span id="l20.708" class="difflineplus">+  if (&quot;state&quot; in aState)</span>
<a href="#l20.709"></a><span id="l20.709" class="difflineplus">+    aSplitter.setAttribute(&quot;state&quot;, aState.state);</span>
<a href="#l20.710"></a><span id="l20.710" class="difflineplus">+  if (&quot;collapsed&quot; in aState)</span>
<a href="#l20.711"></a><span id="l20.711" class="difflineplus">+    aSplitter.collapsed = aState.collapsed;</span>
<a href="#l20.712"></a><span id="l20.712" class="difflineplus">+  if (&quot;size&quot; in aState)</span>
<a href="#l20.713"></a><span id="l20.713" class="difflineplus">+  {</span>
<a href="#l20.714"></a><span id="l20.714" class="difflineplus">+    let next = aSplitter.getAttribute(&quot;collapse&quot;) == &quot;after&quot;;</span>
<a href="#l20.715"></a><span id="l20.715" class="difflineplus">+    let pane = next ? aSplitter.nextSibling : aSplitter.previousSibling;</span>
<a href="#l20.716"></a><span id="l20.716" class="difflineplus">+    let vertical = aSplitter.orient == &quot;vertical&quot;;</span>
<a href="#l20.717"></a><span id="l20.717" class="difflineplus">+    if (vertical)</span>
<a href="#l20.718"></a><span id="l20.718" class="difflineplus">+    {</span>
<a href="#l20.719"></a><span id="l20.719" class="difflineplus">+      // vertical splitter orientation</span>
<a href="#l20.720"></a><span id="l20.720" class="difflineplus">+      pane.height = aState.size;</span>
<a href="#l20.721"></a><span id="l20.721" class="difflineplus">+    }</span>
<a href="#l20.722"></a><span id="l20.722" class="difflineplus">+    else</span>
<a href="#l20.723"></a><span id="l20.723" class="difflineplus">+    {</span>
<a href="#l20.724"></a><span id="l20.724" class="difflineplus">+      // horizontal splitter orientation</span>
<a href="#l20.725"></a><span id="l20.725" class="difflineplus">+      pane.width = aState.size;</span>
<a href="#l20.726"></a><span id="l20.726" class="difflineplus">+    }</span>
<a href="#l20.727"></a><span id="l20.727" class="difflineplus">+  }</span>
<a href="#l20.728"></a><span id="l20.728" class="difflineplus">+  if (&quot;collapsible&quot; in aState)</span>
<a href="#l20.729"></a><span id="l20.729" class="difflineplus">+    aSplitter.collapsible = aState.collapsible;</span>
<a href="#l20.730"></a><span id="l20.730" class="difflineplus">+}</span>
<a href="#l20.731"></a><span id="l20.731" class="difflineplus">+</span>
<a href="#l20.732"></a><span id="l20.732" class="difflineplus">+// If we hit one of the pane splitter &lt;key&gt;s or choose the respective menuitem,</span>
<a href="#l20.733"></a><span id="l20.733" class="difflineplus">+// we show/hide both the pane *and* the splitter, just like we do for the</span>
<a href="#l20.734"></a><span id="l20.734" class="difflineplus">+// browser sidebar. Clicking a splitter's grippy, though, will hide the pane</span>
<a href="#l20.735"></a><span id="l20.735" class="difflineplus">+// but not the splitter.</span>
<a href="#l20.736"></a><span id="l20.736" class="difflineplus">+function MsgToggleSplitter(aSplitter)</span>
<a href="#l20.737"></a><span id="l20.737" class="difflineplus">+{</span>
<a href="#l20.738"></a><span id="l20.738" class="difflineplus">+  var state = aSplitter.getAttribute(&quot;state&quot;);</span>
<a href="#l20.739"></a><span id="l20.739" class="difflineplus">+  if (state == &quot;collapsed&quot;)</span>
<a href="#l20.740"></a><span id="l20.740" class="difflineplus">+  {</span>
<a href="#l20.741"></a><span id="l20.741" class="difflineplus">+    // removing the attribute would hurt persistency</span>
<a href="#l20.742"></a><span id="l20.742" class="difflineplus">+    aSplitter.setAttribute(&quot;state&quot;, &quot;open&quot;);</span>
<a href="#l20.743"></a><span id="l20.743" class="difflineplus">+    aSplitter.collapsed = false; // always show splitter when open</span>
<a href="#l20.744"></a><span id="l20.744" class="difflineplus">+  }</span>
<a href="#l20.745"></a><span id="l20.745" class="difflineplus">+  else</span>
<a href="#l20.746"></a><span id="l20.746" class="difflineplus">+  {</span>
<a href="#l20.747"></a><span id="l20.747" class="difflineplus">+    aSplitter.setAttribute(&quot;state&quot;, &quot;collapsed&quot;);</span>
<a href="#l20.748"></a><span id="l20.748" class="difflineplus">+    aSplitter.collapsed = true; // hide splitter</span>
<a href="#l20.749"></a><span id="l20.749" class="difflineplus">+  }</span>
<a href="#l20.750"></a><span id="l20.750" class="difflineplus">+}</span>
<a href="#l20.751"></a><span id="l20.751" class="difflineplus">+</span>
<a href="#l20.752"></a><span id="l20.752" class="difflineplus">+function MsgCollapseSplitter(aSplitter, aCollapse)</span>
<a href="#l20.753"></a><span id="l20.753" class="difflineplus">+{</span>
<a href="#l20.754"></a><span id="l20.754" class="difflineplus">+  if (!(&quot;collapsible&quot; in aSplitter))</span>
<a href="#l20.755"></a><span id="l20.755" class="difflineplus">+    aSplitter.collapsible = true;</span>
<a href="#l20.756"></a><span id="l20.756" class="difflineplus">+  aSplitter.collapsed = aCollapse &amp;&amp; aSplitter.collapsible;</span>
<a href="#l20.757"></a><span id="l20.757" class="difflineplus">+}</span>
<a href="#l20.758"></a><span id="l20.758" class="difflineplus">+</span>
<a href="#l20.759"></a><span id="l20.759" class="difflineplus">+// helper function for UpdateLayoutVisibility</span>
<a href="#l20.760"></a><span id="l20.760" class="difflineplus">+function UpdateFolderPaneFlex(aTuneLayout)</span>
<a href="#l20.761"></a><span id="l20.761" class="difflineplus">+{</span>
<a href="#l20.762"></a><span id="l20.762" class="difflineplus">+  var folderBox = GetFolderPane();</span>
<a href="#l20.763"></a><span id="l20.763" class="difflineplus">+  var messagesBox = document.getElementById(&quot;messagesBox&quot;);</span>
<a href="#l20.764"></a><span id="l20.764" class="difflineplus">+  if (aTuneLayout)</span>
<a href="#l20.765"></a><span id="l20.765" class="difflineplus">+  {</span>
<a href="#l20.766"></a><span id="l20.766" class="difflineplus">+    // tune folderpane layout</span>
<a href="#l20.767"></a><span id="l20.767" class="difflineplus">+    folderBox.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l20.768"></a><span id="l20.768" class="difflineplus">+    messagesBox.removeAttribute(&quot;flex&quot;);</span>
<a href="#l20.769"></a><span id="l20.769" class="difflineplus">+  }</span>
<a href="#l20.770"></a><span id="l20.770" class="difflineplus">+  else</span>
<a href="#l20.771"></a><span id="l20.771" class="difflineplus">+  {</span>
<a href="#l20.772"></a><span id="l20.772" class="difflineplus">+    // restore old layout</span>
<a href="#l20.773"></a><span id="l20.773" class="difflineplus">+    folderBox.removeAttribute(&quot;flex&quot;);</span>
<a href="#l20.774"></a><span id="l20.774" class="difflineplus">+    messagesBox.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l20.775"></a><span id="l20.775" class="difflineplus">+  }</span>
<a href="#l20.776"></a><span id="l20.776" class="difflineplus">+}</span>
<a href="#l20.777"></a><span id="l20.777" class="difflineplus">+</span>
<a href="#l20.778"></a><span id="l20.778" class="difflineplus">+// we need to finetune the pane and splitter layout in certain circumstances</span>
<a href="#l20.779"></a><span id="l20.779" class="difflineplus">+function UpdateLayoutVisibility()</span>
<a href="#l20.780"></a><span id="l20.780" class="difflineplus">+{</span>
<a href="#l20.781"></a><span id="l20.781" class="difflineplus">+  var modeBits = gMailNewsTabsType.getCurrentModeBits();</span>
<a href="#l20.782"></a><span id="l20.782" class="difflineplus">+  var folderPaneVisible  = modeBits &amp; kTabShowFolderPane;</span>
<a href="#l20.783"></a><span id="l20.783" class="difflineplus">+  var messagePaneVisible = modeBits &amp; kTabShowMessagePane;</span>
<a href="#l20.784"></a><span id="l20.784" class="difflineplus">+  var threadPaneVisible  = modeBits &amp; kTabShowThreadPane;</span>
<a href="#l20.785"></a><span id="l20.785" class="difflineplus">+  var displayDeckVisible = modeBits &amp; kTabMaskDisplayDeck;</span>
<a href="#l20.786"></a><span id="l20.786" class="difflineplus">+  var onlyFolderPane     = modeBits == kTabShowFolderPane;</span>
<a href="#l20.787"></a><span id="l20.787" class="difflineplus">+  var onlyMessagePane    = modeBits == kTabShowMessagePane;</span>
<a href="#l20.788"></a><span id="l20.788" class="difflineplus">+  var onlyDisplayDeck    = modeBits == kTabShowThreadPane ||</span>
<a href="#l20.789"></a><span id="l20.789" class="difflineplus">+                           modeBits == kTabShowAcctCentral;</span>
<a href="#l20.790"></a><span id="l20.790" class="difflineplus">+  var onlyOnePane = onlyFolderPane || onlyMessagePane || onlyDisplayDeck;</span>
<a href="#l20.791"></a><span id="l20.791" class="difflineplus">+  var showFolderSplitter  = false;</span>
<a href="#l20.792"></a><span id="l20.792" class="difflineplus">+  var showMessageSplitter = false;</span>
<a href="#l20.793"></a><span id="l20.793" class="difflineplus">+  var layout = pref.getIntPref(&quot;mail.pane_config.dynamic&quot;);</span>
<a href="#l20.794"></a><span id="l20.794" class="difflineplus">+  switch (layout)</span>
<a href="#l20.795"></a><span id="l20.795" class="difflineplus">+  {</span>
<a href="#l20.796"></a><span id="l20.796" class="difflineplus">+    case kClassicMailLayout:</span>
<a href="#l20.797"></a><span id="l20.797" class="difflineplus">+      // if only the folderpane is visible it has to flex,</span>
<a href="#l20.798"></a><span id="l20.798" class="difflineplus">+      // while the messagesbox must not</span>
<a href="#l20.799"></a><span id="l20.799" class="difflineplus">+      UpdateFolderPaneFlex(onlyFolderPane);</span>
<a href="#l20.800"></a><span id="l20.800" class="difflineplus">+      if (!onlyOnePane)</span>
<a href="#l20.801"></a><span id="l20.801" class="difflineplus">+      {</span>
<a href="#l20.802"></a><span id="l20.802" class="difflineplus">+        showFolderSplitter  = folderPaneVisible;</span>
<a href="#l20.803"></a><span id="l20.803" class="difflineplus">+        showMessageSplitter = threadPaneVisible &amp;&amp; messagePaneVisible;</span>
<a href="#l20.804"></a><span id="l20.804" class="difflineplus">+      }</span>
<a href="#l20.805"></a><span id="l20.805" class="difflineplus">+      break;</span>
<a href="#l20.806"></a><span id="l20.806" class="difflineplus">+</span>
<a href="#l20.807"></a><span id="l20.807" class="difflineplus">+    case kWideMailLayout:</span>
<a href="#l20.808"></a><span id="l20.808" class="difflineplus">+      // if only the messagepane is visible, collapse the rest</span>
<a href="#l20.809"></a><span id="l20.809" class="difflineplus">+      let messengerBox = document.getElementById(&quot;messengerBox&quot;);</span>
<a href="#l20.810"></a><span id="l20.810" class="difflineplus">+      messengerBox.collapsed = onlyMessagePane;</span>
<a href="#l20.811"></a><span id="l20.811" class="difflineplus">+      // a hidden displaydeck must not flex, while the folderpane has to</span>
<a href="#l20.812"></a><span id="l20.812" class="difflineplus">+      if (!onlyMessagePane)</span>
<a href="#l20.813"></a><span id="l20.813" class="difflineplus">+        UpdateFolderPaneFlex(!displayDeckVisible);</span>
<a href="#l20.814"></a><span id="l20.814" class="difflineplus">+      if (!onlyOnePane)</span>
<a href="#l20.815"></a><span id="l20.815" class="difflineplus">+      {</span>
<a href="#l20.816"></a><span id="l20.816" class="difflineplus">+        showFolderSplitter  = folderPaneVisible &amp;&amp; displayDeckVisible;</span>
<a href="#l20.817"></a><span id="l20.817" class="difflineplus">+        showMessageSplitter = messagePaneVisible;</span>
<a href="#l20.818"></a><span id="l20.818" class="difflineplus">+      }</span>
<a href="#l20.819"></a><span id="l20.819" class="difflineplus">+      break;</span>
<a href="#l20.820"></a><span id="l20.820" class="difflineplus">+</span>
<a href="#l20.821"></a><span id="l20.821" class="difflineplus">+    case kVerticalMailLayout:</span>
<a href="#l20.822"></a><span id="l20.822" class="difflineplus">+      // if the threadpane is hidden, we need to hide its outer box as well</span>
<a href="#l20.823"></a><span id="l20.823" class="difflineplus">+      let messagesBox = document.getElementById(&quot;messagesBox&quot;);</span>
<a href="#l20.824"></a><span id="l20.824" class="difflineplus">+      messagesBox.collapsed = !displayDeckVisible;</span>
<a href="#l20.825"></a><span id="l20.825" class="difflineplus">+      // if only the folderpane is visible, it needs to flex</span>
<a href="#l20.826"></a><span id="l20.826" class="difflineplus">+      UpdateFolderPaneFlex(onlyFolderPane);</span>
<a href="#l20.827"></a><span id="l20.827" class="difflineplus">+      if (!onlyOnePane)</span>
<a href="#l20.828"></a><span id="l20.828" class="difflineplus">+      {</span>
<a href="#l20.829"></a><span id="l20.829" class="difflineplus">+        showFolderSplitter  = folderPaneVisible;</span>
<a href="#l20.830"></a><span id="l20.830" class="difflineplus">+        showMessageSplitter = messagePaneVisible;</span>
<a href="#l20.831"></a><span id="l20.831" class="difflineplus">+      }</span>
<a href="#l20.832"></a><span id="l20.832" class="difflineplus">+      break;</span>
<a href="#l20.833"></a><span id="l20.833" class="difflineplus">+  }</span>
<a href="#l20.834"></a><span id="l20.834" class="difflineplus">+</span>
<a href="#l20.835"></a><span id="l20.835" class="difflineplus">+  // set splitter visibility</span>
<a href="#l20.836"></a><span id="l20.836" class="difflineplus">+  // if the pane was hidden by clicking the splitter grippy,</span>
<a href="#l20.837"></a><span id="l20.837" class="difflineplus">+  // the splitter must not hide</span>
<a href="#l20.838"></a><span id="l20.838" class="difflineplus">+  MsgCollapseSplitter(GetFolderPaneSplitter(),           !showFolderSplitter);</span>
<a href="#l20.839"></a><span id="l20.839" class="difflineplus">+  MsgCollapseSplitter(GetThreadAndMessagePaneSplitter(), !showMessageSplitter);</span>
<a href="#l20.840"></a><span id="l20.840" class="difflineplus">+</span>
<a href="#l20.841"></a><span id="l20.841" class="difflineplus">+  // disable location bar if only message pane is visible</span>
<a href="#l20.842"></a><span id="l20.842" class="difflineplus">+  document.getElementById(&quot;locationFolders&quot;).disabled = onlyMessagePane;</span>
<a href="#l20.843"></a><span id="l20.843" class="difflineplus">+  // disable mailviews and search if threadpane is invisble</span>
<a href="#l20.844"></a><span id="l20.844" class="difflineplus">+  var viewPicker = document.getElementById(&quot;viewPicker&quot;);</span>
<a href="#l20.845"></a><span id="l20.845" class="difflineplus">+  viewPicker.disabled = !threadPaneVisible;</span>
<a href="#l20.846"></a><span id="l20.846" class="difflineplus">+  viewPicker.previousSibling.disabled = !threadPaneVisible;</span>
<a href="#l20.847"></a><span id="l20.847" class="difflineplus">+  GetSearchInput().disabled = !threadPaneVisible;</span>
<a href="#l20.848"></a><span id="l20.848" class="difflineplus">+}</span>
<a href="#l20.849"></a><span id="l20.849" class="difflineplus">+</span>
<a href="#l20.850"></a><span id="l20.850" class="difflineplus">+function ChangeMessagePaneVisibility()</span>
<a href="#l20.851"></a><span id="l20.851" class="difflineplus">+{</span>
<a href="#l20.852"></a><span id="l20.852" class="difflineplus">+  var hidden = IsMessagePaneCollapsed();</span>
<a href="#l20.853"></a><span id="l20.853" class="difflineplus">+  // We also have to disable the Message/Attachments menuitem.</span>
<a href="#l20.854"></a><span id="l20.854" class="difflineplus">+  // It will be enabled when loading a message with attachments</span>
<a href="#l20.855"></a><span id="l20.855" class="difflineplus">+  // (see messageHeaderSink.handleAttachment).</span>
<a href="#l20.856"></a><span id="l20.856" class="difflineplus">+  if (hidden)</span>
<a href="#l20.857"></a><span id="l20.857" class="difflineplus">+  {</span>
<a href="#l20.858"></a><span id="l20.858" class="difflineplus">+    let node = document.getElementById(&quot;msgAttachmentMenu&quot;);</span>
<a href="#l20.859"></a><span id="l20.859" class="difflineplus">+    if (node)</span>
<a href="#l20.860"></a><span id="l20.860" class="difflineplus">+      node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l20.861"></a><span id="l20.861" class="difflineplus">+  }</span>
<a href="#l20.862"></a><span id="l20.862" class="difflineplus">+</span>
<a href="#l20.863"></a><span id="l20.863" class="difflineplus">+  if (gDBView)</span>
<a href="#l20.864"></a><span id="l20.864" class="difflineplus">+  {</span>
<a href="#l20.865"></a><span id="l20.865" class="difflineplus">+    // clear the subject, collapsing won't automatically do this</span>
<a href="#l20.866"></a><span id="l20.866" class="difflineplus">+    setTitleFromFolder(GetThreadPaneFolder(), null);</span>
<a href="#l20.867"></a><span id="l20.867" class="difflineplus">+    // the collapsed state is the state after we released the mouse</span>
<a href="#l20.868"></a><span id="l20.868" class="difflineplus">+    // so we take it as it is</span>
<a href="#l20.869"></a><span id="l20.869" class="difflineplus">+    gDBView.suppressMsgDisplay = hidden;</span>
<a href="#l20.870"></a><span id="l20.870" class="difflineplus">+    // set the subject, uncollapsing won't automatically do this</span>
<a href="#l20.871"></a><span id="l20.871" class="difflineplus">+    gDBView.loadMessageByUrl(&quot;about:blank&quot;);</span>
<a href="#l20.872"></a><span id="l20.872" class="difflineplus">+    gDBView.selectionChanged();</span>
<a href="#l20.873"></a><span id="l20.873" class="difflineplus">+  }</span>
<a href="#l20.874"></a><span id="l20.874" class="difflineplus">+  var event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l20.875"></a><span id="l20.875" class="difflineplus">+  if (hidden)</span>
<a href="#l20.876"></a><span id="l20.876" class="difflineplus">+    event.initEvent(&quot;messagepane-hide&quot;, false, true);</span>
<a href="#l20.877"></a><span id="l20.877" class="difflineplus">+  else</span>
<a href="#l20.878"></a><span id="l20.878" class="difflineplus">+    event.initEvent(&quot;messagepane-unhide&quot;, false, true);</span>
<a href="#l20.879"></a><span id="l20.879" class="difflineplus">+  document.getElementById(&quot;messengerWindow&quot;).dispatchEvent(event);</span>
<a href="#l20.880"></a><span id="l20.880" class="difflineplus">+}</span>
<a href="#l20.881"></a><span id="l20.881" class="difflineplus">+</span>
<a href="#l20.882"></a><span id="l20.882" class="difflineplus">+function MsgToggleMessagePane(aToggleManually)</span>
<a href="#l20.883"></a><span id="l20.883" class="difflineplus">+{</span>
<a href="#l20.884"></a><span id="l20.884" class="difflineplus">+  // don't hide all three panes at once</span>
<a href="#l20.885"></a><span id="l20.885" class="difflineplus">+  if (IsDisplayDeckCollapsed() &amp;&amp; IsFolderPaneCollapsed())</span>
<a href="#l20.886"></a><span id="l20.886" class="difflineplus">+    return;</span>
<a href="#l20.887"></a><span id="l20.887" class="difflineplus">+  // toggle the splitter manually if it wasn't clicked and remember that</span>
<a href="#l20.888"></a><span id="l20.888" class="difflineplus">+  var splitter = GetThreadAndMessagePaneSplitter();</span>
<a href="#l20.889"></a><span id="l20.889" class="difflineplus">+  if (aToggleManually)</span>
<a href="#l20.890"></a><span id="l20.890" class="difflineplus">+    MsgToggleSplitter(splitter);</span>
<a href="#l20.891"></a><span id="l20.891" class="difflineplus">+  splitter.collapsible = aToggleManually;</span>
<a href="#l20.892"></a><span id="l20.892" class="difflineplus">+  ChangeMessagePaneVisibility();</span>
<a href="#l20.893"></a><span id="l20.893" class="difflineplus">+  UpdateLayoutVisibility();</span>
<a href="#l20.894"></a><span id="l20.894" class="difflineplus">+}</span>
<a href="#l20.895"></a><span id="l20.895" class="difflineplus">+</span>
<a href="#l20.896"></a><span id="l20.896" class="difflineplus">+function MsgToggleFolderPane(aToggleManually)</span>
<a href="#l20.897"></a><span id="l20.897" class="difflineplus">+{</span>
<a href="#l20.898"></a><span id="l20.898" class="difflineplus">+  // don't hide all three panes at once</span>
<a href="#l20.899"></a><span id="l20.899" class="difflineplus">+  if (IsDisplayDeckCollapsed() &amp;&amp; IsMessagePaneCollapsed())</span>
<a href="#l20.900"></a><span id="l20.900" class="difflineplus">+    return;</span>
<a href="#l20.901"></a><span id="l20.901" class="difflineplus">+  // toggle the splitter manually if it wasn't clicked and remember that</span>
<a href="#l20.902"></a><span id="l20.902" class="difflineplus">+  var splitter = GetFolderPaneSplitter();</span>
<a href="#l20.903"></a><span id="l20.903" class="difflineplus">+  if (aToggleManually)</span>
<a href="#l20.904"></a><span id="l20.904" class="difflineplus">+    MsgToggleSplitter(splitter);</span>
<a href="#l20.905"></a><span id="l20.905" class="difflineplus">+  splitter.collapsible = aToggleManually;</span>
<a href="#l20.906"></a><span id="l20.906" class="difflineplus">+  UpdateLayoutVisibility();</span>
<a href="#l20.907"></a><span id="l20.907" class="difflineplus">+}</span>
<a href="#l20.908"></a><span id="l20.908" class="difflineplus">+</span>
<a href="#l20.909"></a><span id="l20.909" class="difflineplus">+function MsgToggleThreadPane()</span>
<a href="#l20.910"></a><span id="l20.910" class="difflineplus">+{</span>
<a href="#l20.911"></a><span id="l20.911" class="difflineplus">+  // don't hide all three panes at once</span>
<a href="#l20.912"></a><span id="l20.912" class="difflineplus">+  if (IsFolderPaneCollapsed() &amp;&amp; IsMessagePaneCollapsed())</span>
<a href="#l20.913"></a><span id="l20.913" class="difflineplus">+    return;</span>
<a href="#l20.914"></a><span id="l20.914" class="difflineplus">+  var threadPane = GetDisplayDeck();</span>
<a href="#l20.915"></a><span id="l20.915" class="difflineplus">+  threadPane.collapsed = !threadPane.collapsed;</span>
<a href="#l20.916"></a><span id="l20.916" class="difflineplus">+  // we only get here by hitting a key, so always hide border splitters</span>
<a href="#l20.917"></a><span id="l20.917" class="difflineplus">+  UpdateLayoutVisibility();</span>
<a href="#l20.918"></a><span id="l20.918" class="difflineplus">+}</span>
<a href="#l20.919"></a><span id="l20.919" class="difflineplus">+</span>
<a href="#l20.920"></a><span id="l20.920" class="difflineplus">+// When the ThreadPane is hidden via the displayDeck, we should collapse the</span>
<a href="#l20.921"></a><span id="l20.921" class="difflineplus">+// elements that are only meaningful to the thread pane. When AccountCentral is</span>
<a href="#l20.922"></a><span id="l20.922" class="difflineplus">+// shown via the displayDeck, we need to switch the displayDeck to show the</span>
<a href="#l20.923"></a><span id="l20.923" class="difflineplus">+// accountCentralBox and load the iframe in the AccountCentral box with the</span>
<a href="#l20.924"></a><span id="l20.924" class="difflineplus">+// corresponding page.</span>
<a href="#l20.925"></a><span id="l20.925" class="difflineplus">+function ShowAccountCentral()</span>
<a href="#l20.926"></a><span id="l20.926" class="difflineplus">+{</span>
<a href="#l20.927"></a><span id="l20.927" class="difflineplus">+  try</span>
<a href="#l20.928"></a><span id="l20.928" class="difflineplus">+  {</span>
<a href="#l20.929"></a><span id="l20.929" class="difflineplus">+    GetDisplayDeck().selectedPanel = accountCentralBox;</span>
<a href="#l20.930"></a><span id="l20.930" class="difflineplus">+    let acctCentralPage = pref.getComplexValue(&quot;mailnews.account_central_page.url&quot;,</span>
<a href="#l20.931"></a><span id="l20.931" class="difflineplus">+                                               Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l20.932"></a><span id="l20.932" class="difflineplus">+    window.frames[&quot;accountCentralPane&quot;].location.href = acctCentralPage;</span>
<a href="#l20.933"></a><span id="l20.933" class="difflineplus">+  }</span>
<a href="#l20.934"></a><span id="l20.934" class="difflineplus">+  catch (ex)</span>
<a href="#l20.935"></a><span id="l20.935" class="difflineplus">+  {</span>
<a href="#l20.936"></a><span id="l20.936" class="difflineplus">+    dump(&quot;Error loading AccountCentral page -&gt; &quot; + ex + &quot;\n&quot;);</span>
<a href="#l20.937"></a><span id="l20.937" class="difflineplus">+    return;</span>
<a href="#l20.938"></a><span id="l20.938" class="difflineplus">+  }</span>
<a href="#l20.939"></a><span id="l20.939" class="difflineplus">+}</span>
<a href="#l20.940"></a><span id="l20.940" class="difflineplus">+</span>
<a href="#l20.941"></a><span id="l20.941" class="difflineplus">+function ShowingAccountCentral()</span>
<a href="#l20.942"></a><span id="l20.942" class="difflineplus">+{</span>
<a href="#l20.943"></a><span id="l20.943" class="difflineplus">+  if (!IsFolderPaneCollapsed())</span>
<a href="#l20.944"></a><span id="l20.944" class="difflineplus">+    GetFolderTree().focus();</span>
<a href="#l20.945"></a><span id="l20.945" class="difflineplus">+  gAccountCentralLoaded = true;</span>
<a href="#l20.946"></a><span id="l20.946" class="difflineplus">+}</span>
<a href="#l20.947"></a><span id="l20.947" class="difflineplus">+</span>
<a href="#l20.948"></a><span id="l20.948" class="difflineplus">+function HidingAccountCentral()</span>
<a href="#l20.949"></a><span id="l20.949" class="difflineplus">+{</span>
<a href="#l20.950"></a><span id="l20.950" class="difflineplus">+  gAccountCentralLoaded = false;</span>
<a href="#l20.951"></a><span id="l20.951" class="difflineplus">+}</span>
<a href="#l20.952"></a><span id="l20.952" class="difflineplus">+</span>
<a href="#l20.953"></a><span id="l20.953" class="difflineplus">+function ShowThreadPane()</span>
<a href="#l20.954"></a><span id="l20.954" class="difflineplus">+{</span>
<a href="#l20.955"></a><span id="l20.955" class="difflineplus">+  GetDisplayDeck().selectedPanel = GetThreadPane();</span>
<a href="#l20.956"></a><span id="l20.956" class="difflineplus">+}</span>
<a href="#l20.957"></a><span id="l20.957" class="difflineplus">+</span>
<a href="#l20.958"></a><span id="l20.958" class="difflineplus">+function ShowingThreadPane()</span>
<a href="#l20.959"></a><span id="l20.959" class="difflineplus">+{</span>
<a href="#l20.960"></a><span id="l20.960" class="difflineplus">+  gSearchBox.collapsed = false;</span>
<a href="#l20.961"></a><span id="l20.961" class="difflineplus">+  var threadPaneSplitter = GetThreadAndMessagePaneSplitter();</span>
<a href="#l20.962"></a><span id="l20.962" class="difflineplus">+  threadPaneSplitter.collapsed = false;</span>
<a href="#l20.963"></a><span id="l20.963" class="difflineplus">+  if (!threadPaneSplitter.hidden &amp;&amp; threadPaneSplitter.getAttribute(&quot;state&quot;) != &quot;collapsed&quot;)</span>
<a href="#l20.964"></a><span id="l20.964" class="difflineplus">+  {</span>
<a href="#l20.965"></a><span id="l20.965" class="difflineplus">+    GetMessagePane().collapsed = false;</span>
<a href="#l20.966"></a><span id="l20.966" class="difflineplus">+    // XXX We need to force the tree to refresh its new height</span>
<a href="#l20.967"></a><span id="l20.967" class="difflineplus">+    // so that it will correctly scroll to the newest message</span>
<a href="#l20.968"></a><span id="l20.968" class="difflineplus">+    GetThreadTree().boxObject.height;</span>
<a href="#l20.969"></a><span id="l20.969" class="difflineplus">+  }</span>
<a href="#l20.970"></a><span id="l20.970" class="difflineplus">+  document.getElementById(&quot;key_toggleThreadPane&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l20.971"></a><span id="l20.971" class="difflineplus">+  document.getElementById(&quot;key_toggleMessagePane&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l20.972"></a><span id="l20.972" class="difflineplus">+}</span>
<a href="#l20.973"></a><span id="l20.973" class="difflineplus">+</span>
<a href="#l20.974"></a><span id="l20.974" class="difflineplus">+function HidingThreadPane()</span>
<a href="#l20.975"></a><span id="l20.975" class="difflineplus">+{</span>
<a href="#l20.976"></a><span id="l20.976" class="difflineplus">+  ClearThreadPane();</span>
<a href="#l20.977"></a><span id="l20.977" class="difflineplus">+  GetUnreadCountElement().hidden = true;</span>
<a href="#l20.978"></a><span id="l20.978" class="difflineplus">+  GetTotalCountElement().hidden = true;</span>
<a href="#l20.979"></a><span id="l20.979" class="difflineplus">+  GetMessagePane().collapsed = true;</span>
<a href="#l20.980"></a><span id="l20.980" class="difflineplus">+  GetThreadAndMessagePaneSplitter().collapsed = true;</span>
<a href="#l20.981"></a><span id="l20.981" class="difflineplus">+  gSearchBox.collapsed = true;</span>
<a href="#l20.982"></a><span id="l20.982" class="difflineplus">+  document.getElementById(&quot;key_toggleThreadPane&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l20.983"></a><span id="l20.983" class="difflineplus">+  document.getElementById(&quot;key_toggleMessagePane&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l20.984"></a><span id="l20.984" class="difflineplus">+}</span>
<a href="#l20.985"></a><span id="l20.985" class="difflineplus">+</span>
<a href="#l20.986"></a><span id="l20.986" class="difflineplus">+var gCurrentDisplayDeckId = &quot;&quot;;</span>
<a href="#l20.987"></a><span id="l20.987" class="difflineplus">+function ObserveDisplayDeckChange(aEvent)</span>
<a href="#l20.988"></a><span id="l20.988" class="difflineplus">+{</span>
<a href="#l20.989"></a><span id="l20.989" class="difflineplus">+  var selectedPanel = GetDisplayDeck().selectedPanel;</span>
<a href="#l20.990"></a><span id="l20.990" class="difflineplus">+  var nowSelected = selectedPanel ? selectedPanel.id : &quot;&quot;;</span>
<a href="#l20.991"></a><span id="l20.991" class="difflineplus">+  // onselect fires for every mouse click inside the deck, so ObserveDisplayDeckChange</span>
<a href="#l20.992"></a><span id="l20.992" class="difflineplus">+  // is getting called every time we click on a message in the thread pane.</span>
<a href="#l20.993"></a><span id="l20.993" class="difflineplus">+  // Only show/hide elements if the selected deck is actually changing.</span>
<a href="#l20.994"></a><span id="l20.994" class="difflineplus">+  if (nowSelected != gCurrentDisplayDeckId)</span>
<a href="#l20.995"></a><span id="l20.995" class="difflineplus">+  {</span>
<a href="#l20.996"></a><span id="l20.996" class="difflineplus">+    if (nowSelected == &quot;threadPaneBox&quot;)</span>
<a href="#l20.997"></a><span id="l20.997" class="difflineplus">+      ShowingThreadPane();</span>
<a href="#l20.998"></a><span id="l20.998" class="difflineplus">+    else</span>
<a href="#l20.999"></a><span id="l20.999" class="difflineplus">+      HidingThreadPane();</span>
<a href="#l20.1000"></a><span id="l20.1000" class="difflineplus">+</span>
<a href="#l20.1001"></a><span id="l20.1001" class="difflineplus">+    if (nowSelected == &quot;accountCentralBox&quot;)</span>
<a href="#l20.1002"></a><span id="l20.1002" class="difflineplus">+    {</span>
<a href="#l20.1003"></a><span id="l20.1003" class="difflineplus">+      ShowingAccountCentral();</span>
<a href="#l20.1004"></a><span id="l20.1004" class="difflineplus">+    }</span>
<a href="#l20.1005"></a><span id="l20.1005" class="difflineplus">+    else</span>
<a href="#l20.1006"></a><span id="l20.1006" class="difflineplus">+    {</span>
<a href="#l20.1007"></a><span id="l20.1007" class="difflineplus">+      HidingAccountCentral();</span>
<a href="#l20.1008"></a><span id="l20.1008" class="difflineplus">+    }</span>
<a href="#l20.1009"></a><span id="l20.1009" class="difflineplus">+    gCurrentDisplayDeckId = nowSelected;</span>
<a href="#l20.1010"></a><span id="l20.1010" class="difflineplus">+  }</span>
<a href="#l20.1011"></a><span id="l20.1011" class="difflineplus">+}</span>
<a href="#l20.1012"></a><span id="l20.1012" class="difflineplus">+</span>
<a href="#l20.1013"></a><span id="l20.1013" class="difflineplus">+function InvalidateTabDBs()</span>
<a href="#l20.1014"></a><span id="l20.1014" class="difflineplus">+{</span>
<a href="#l20.1015"></a><span id="l20.1015" class="difflineplus">+  // enforce reloading the tab's dbView</span>
<a href="#l20.1016"></a><span id="l20.1016" class="difflineplus">+  var tabInfos = GetTabMail().tabInfo;</span>
<a href="#l20.1017"></a><span id="l20.1017" class="difflineplus">+  for (let i = 0; i &lt; tabInfos.length; ++i)</span>
<a href="#l20.1018"></a><span id="l20.1018" class="difflineplus">+  {</span>
<a href="#l20.1019"></a><span id="l20.1019" class="difflineplus">+    let tabInfo = tabInfos[i];</span>
<a href="#l20.1020"></a><span id="l20.1020" class="difflineplus">+    // only reroot 3pane tabs</span>
<a href="#l20.1021"></a><span id="l20.1021" class="difflineplus">+    if (tabInfo.mode.type == &quot;3pane&quot;)</span>
<a href="#l20.1022"></a><span id="l20.1022" class="difflineplus">+    {</span>
<a href="#l20.1023"></a><span id="l20.1023" class="difflineplus">+      // don't change URI if already set -</span>
<a href="#l20.1024"></a><span id="l20.1024" class="difflineplus">+      // we might try to read from an invalid msgSelectedFolder</span>
<a href="#l20.1025"></a><span id="l20.1025" class="difflineplus">+      if (!(&quot;uriToOpen&quot; in tabInfo))</span>
<a href="#l20.1026"></a><span id="l20.1026" class="difflineplus">+        tabInfo.uriToOpen = tabInfo.msgSelectedFolder.URI;</span>
<a href="#l20.1027"></a><span id="l20.1027" class="difflineplus">+    }</span>
<a href="#l20.1028"></a><span id="l20.1028" class="difflineplus">+  }</span>
<a href="#l20.1029"></a><span id="l20.1029" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/mailnews/tabmail.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/mailnews/tabmail.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,62 +1,61 @@</span>
<a href="#l21.4"></a><span id="l21.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">-#</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-#</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-# License.</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-#</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">-# The Original Code is tab email</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-#</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">-#   David Bienvenu &lt;bienvenu@nventure.com&gt;.</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-#</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-#  Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-#  Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-#</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-#</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+   -</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+   -</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+   - License.</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+   -</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+   - The Original Code is tab email</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+   -</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+   -   David Bienvenu &lt;bienvenu@nventure.com&gt;.</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+   -</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+   - Contributor(s):</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+   -  Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+   -  Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+   -  Karsten Dsterloh &lt;mnromyr@tprac.de&gt;</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+   -</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+   - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+   -</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81"> &lt;!DOCTYPE bindings [</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineminus">-&lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineminus">-%messengerDTD;</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineminus">- %tabMailDTD;</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">- &lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">- %globalDTD;</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+  &lt;!ENTITY % messengerDTD SYSTEM &quot;chrome://messenger/locale/messenger.dtd&quot; &gt;</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+  %messengerDTD;</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+  &lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+  %globalDTD;</span>
<a href="#l21.92"></a><span id="l21.92"> ]&gt;</span>
<a href="#l21.93"></a><span id="l21.93"> </span>
<a href="#l21.94"></a><span id="l21.94"> &lt;bindings id=&quot;tabmailBindings&quot;</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l21.101"></a><span id="l21.101"> </span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-  &lt;!-- Thunderbird's tab UI mechanism.</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineplus">+  &lt;!-- SeaMonkey's clone of Thunderbird's tab UI mechanism.</span>
<a href="#l21.104"></a><span id="l21.104">     -</span>
<a href="#l21.105"></a><span id="l21.105">     - We expect to be instantiated with the following children:</span>
<a href="#l21.106"></a><span id="l21.106">     - * One &quot;tabpanels&quot; child element whose id must be placed in the</span>
<a href="#l21.107"></a><span id="l21.107">     -   &quot;panelcontainer&quot; attribute on the element we are being bound to. We do</span>
<a href="#l21.108"></a><span id="l21.108">     -   this because it is important to allow overlays to contribute panels.</span>
<a href="#l21.109"></a><span id="l21.109">     -   When we attempted to have the immediate children of the bound element</span>
<a href="#l21.110"></a><span id="l21.110">     -   be propagated through use of the &quot;children&quot; tag, we found that children</span>
<a href="#l21.111"></a><span id="l21.111">     -   contributed by overlays did not propagate.</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineat">@@ -76,53 +75,53 @@</span>
<a href="#l21.113"></a><span id="l21.113">     - * openTab(aTabModeName, arguments...): Open a tab of the given &quot;mode&quot;,</span>
<a href="#l21.114"></a><span id="l21.114">     -   passing the provided arguments.  The tab type author should tell you</span>
<a href="#l21.115"></a><span id="l21.115">     -   the modes they implement and the required/optional arguments.</span>
<a href="#l21.116"></a><span id="l21.116">     - * setTabTitle([aOptionalTabInfo]): Tells us that the title of the current</span>
<a href="#l21.117"></a><span id="l21.117">     -   tab (if no argument is provided) or provided tab needs to be updated.</span>
<a href="#l21.118"></a><span id="l21.118">     -   This will result in a call to the tab mode's logic to update the title.</span>
<a href="#l21.119"></a><span id="l21.119">     -   In the event this is not for the current tab, the caller is responsible</span>
<a href="#l21.120"></a><span id="l21.120">     -   for ensuring that the underlying tab mode is capable of providing a tab</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-    -   title when it is in the background.  (The is currently not the case for</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineminus">-    -   &quot;folder&quot; and &quot;mail&quot; modes because of their implementation.)</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineplus">+    -   title when it is in the background.</span>
<a href="#l21.124"></a><span id="l21.124">     - * removeCurrentTab(): Close the current tab.</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineminus">-    - * removeTabByNode(aTabElement): Close the tab whose tabmail-tab bound</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineplus">+    - * removeTab(aTabElement): Close the tab whose tabmail-tab bound</span>
<a href="#l21.127"></a><span id="l21.127">     -   element is passed in.</span>
<a href="#l21.128"></a><span id="l21.128">     - Changing the currently displayed tab is accomplished by changing</span>
<a href="#l21.129"></a><span id="l21.129">     -  tabmail.tabContainer's selectedIndex or selectedItem property.</span>
<a href="#l21.130"></a><span id="l21.130">     -</span>
<a href="#l21.131"></a><span id="l21.131">     - Tab contributing code should define a tab type object and register it</span>
<a href="#l21.132"></a><span id="l21.132">     -  with us by calling registerTabType.  Each tab type can provide multiple</span>
<a href="#l21.133"></a><span id="l21.133">     -  tab modes.  The rationale behind this organization is that Thunderbird</span>
<a href="#l21.134"></a><span id="l21.134">     -  historically/currently uses a single 3-pane view to display both</span>
<a href="#l21.135"></a><span id="l21.135">     -  three-pane folder browsing and single message browsing across multiple</span>
<a href="#l21.136"></a><span id="l21.136">     -  tabs.  Each tab type has the ability to use a single tab panel for all</span>
<a href="#l21.137"></a><span id="l21.137">     -  of its display needs.  So Thunderbird's &quot;mail&quot; tab type covers both the</span>
<a href="#l21.138"></a><span id="l21.138">     -  &quot;folder&quot; (3-pane folder-based browsing)  and &quot;message&quot; (just a single</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineminus">-    -  message) tab modes.  Likewise, calendar/lightning currently displays both</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineminus">-    -  its calendar and tasks in the same panel.  A tab type can also create a</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineminus">-    -  new tabpanel for each tab as it is created.  In that case, the tab type </span>
<a href="#l21.142"></a><span id="l21.142" class="difflineminus">-    -  should probably only have a single mode unless there are a number of</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineminus">-    -  similar modes that can gain from code sharing.</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineplus">+    -  message) tab modes, while SeaMonkey integrates both flavours into just</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineplus">+    -  one &quot;3pane&quot; mode.  Likewise, calendar/lightning currently displays</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineplus">+    -  both its calendar and tasks in the same panel.  A tab type can also</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineplus">+    -  create a new tabpanel for each tab as it is created.  In that case, the</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineplus">+    -  tab type should probably only have a single mode unless there are a</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineplus">+    -  number of similar modes that can gain from code sharing.</span>
<a href="#l21.150"></a><span id="l21.150">     - The tab type definition should include the following attributes:</span>
<a href="#l21.151"></a><span id="l21.151">     - * name: The name of the tab-type, mainly to aid in debugging.</span>
<a href="#l21.152"></a><span id="l21.152">     - * panelId or perTabPanel: If using a single tab panel, the id of the</span>
<a href="#l21.153"></a><span id="l21.153">     -     panel must be provided in panelId.  If using one tab panel per tab,</span>
<a href="#l21.154"></a><span id="l21.154">     -     perTabPanel should be the XUL element name that should be created for</span>
<a href="#l21.155"></a><span id="l21.155">     -     each tab.  If a reason arises, in the future we might support</span>
<a href="#l21.156"></a><span id="l21.156">     -     this being a helper function to create and return the element.</span>
<a href="#l21.157"></a><span id="l21.157">     - * modes: An object whose attributes are mode names (which are</span>
<a href="#l21.158"></a><span id="l21.158">     -     automatically propagated to a 'name' attribute for debugging) and</span>
<a href="#l21.159"></a><span id="l21.159">     -     values are objects with the following attributes...</span>
<a href="#l21.160"></a><span id="l21.160">     - * any of the openTab/closeTab/saveTabState/showTab/onTitleChanged</span>
<a href="#l21.161"></a><span id="l21.161">     -     functions as described on the mode definitions.  These will only be</span>
<a href="#l21.162"></a><span id="l21.162">     -     called if the mode does not provide the functions.  Note that because</span>
<a href="#l21.163"></a><span id="l21.163">     -     the 'this' variable passed to the functions will always reference the</span>
<a href="#l21.164"></a><span id="l21.164">     -     tab type definition (rather than the mode definition), the mode</span>
<a href="#l21.165"></a><span id="l21.165" class="difflineminus">-    -     functions can defer to the tab type functions by calling </span>
<a href="#l21.166"></a><span id="l21.166" class="difflineplus">+    -     functions can defer to the tab type functions by calling</span>
<a href="#l21.167"></a><span id="l21.167">     -     this.functionName().  (This should prove convenient.)</span>
<a href="#l21.168"></a><span id="l21.168">     - Mode definition attributes:</span>
<a href="#l21.169"></a><span id="l21.169">     - * type: The &quot;type&quot; attribute to set on the displayed tab for CSS purposes.</span>
<a href="#l21.170"></a><span id="l21.170">     -     Generally, this would be the same as the mode name, but you can do as</span>
<a href="#l21.171"></a><span id="l21.171">     -     you please.</span>
<a href="#l21.172"></a><span id="l21.172">     - * isDefault: This should only be present and should be true for the tab</span>
<a href="#l21.173"></a><span id="l21.173">     -     mode that is the tab displayed automatically on startup.</span>
<a href="#l21.174"></a><span id="l21.174">     - * maxTabs: The maximum number of this mode that can be opened at a time.</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineat">@@ -130,1292 +129,1454 @@</span>
<a href="#l21.176"></a><span id="l21.176">     -     mode will simply result in the first existing tab of this mode being</span>
<a href="#l21.177"></a><span id="l21.177">     -     displayed.</span>
<a href="#l21.178"></a><span id="l21.178">     - * shouldSwitchTo(arguments...): Optional function. Called when</span>
<a href="#l21.179"></a><span id="l21.179">     -     openTab is called on the top-level tabmail binding. It is used to</span>
<a href="#l21.180"></a><span id="l21.180">     -     decide if the openTab function should switch to an existing tab or</span>
<a href="#l21.181"></a><span id="l21.181">     -     actually open a new tab.</span>
<a href="#l21.182"></a><span id="l21.182">     -     If the openTab function should switch to an existing tab, return the</span>
<a href="#l21.183"></a><span id="l21.183">     -     index of that tab; otherwise return -1.</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineminus">-    - * openTab(aTab, arguments...): Called when a tab of the given mode is</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineminus">-    -     in the process of being opened.  aTab will have its &quot;mode&quot; attribute</span>
<a href="#l21.186"></a><span id="l21.186" class="difflineminus">-    -     set to the mode definition of the tab mode being opened.  You should</span>
<a href="#l21.187"></a><span id="l21.187" class="difflineminus">-    -     set the &quot;title&quot; attribute on it, and may set any other attributes</span>
<a href="#l21.188"></a><span id="l21.188" class="difflineminus">-    -     you wish for your own use in subsequent functions.  Note that 'this'</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineminus">-    -     points to the tab type definition, not the mode definition as you</span>
<a href="#l21.190"></a><span id="l21.190" class="difflineminus">-    -     might expect.  This allows you to place common logic code on the</span>
<a href="#l21.191"></a><span id="l21.191" class="difflineminus">-    -     tab type for use by multiple modes and to defer to it.  Any arguments</span>
<a href="#l21.192"></a><span id="l21.192" class="difflineminus">-    -     provided to the caller of tabmail.openTab will be passed to your</span>
<a href="#l21.193"></a><span id="l21.193" class="difflineminus">-    -     function as well.</span>
<a href="#l21.194"></a><span id="l21.194" class="difflineminus">-    - * closeTab(aTab): Called when aTab is being closed.  The tab need not be</span>
<a href="#l21.195"></a><span id="l21.195" class="difflineminus">-    -     currently displayed.  You are responsible for properly cleaning up</span>
<a href="#l21.196"></a><span id="l21.196" class="difflineminus">-    -     any state you preserved in aTab.</span>
<a href="#l21.197"></a><span id="l21.197" class="difflineminus">-    - * saveTabState(aTab): Called when aTab is being switched away from so that</span>
<a href="#l21.198"></a><span id="l21.198" class="difflineminus">-    -     you can preserve its state on aTab.  This is primarily for single</span>
<a href="#l21.199"></a><span id="l21.199" class="difflineminus">-    -     tab panel implementations; you may not have much state to save if your</span>
<a href="#l21.200"></a><span id="l21.200" class="difflineminus">-    -     tab has its own tab panel.</span>
<a href="#l21.201"></a><span id="l21.201" class="difflineminus">-    - * showTab(aTab): Called when aTab is being displayed and you should</span>
<a href="#l21.202"></a><span id="l21.202" class="difflineminus">-    -     restore its state (if required).</span>
<a href="#l21.203"></a><span id="l21.203" class="difflineminus">-    - * onTitleChanged(aTab): Called when someone calls tabmail.setTabTitle() to</span>
<a href="#l21.204"></a><span id="l21.204" class="difflineminus">-    -     hint that the tab's title needs to be updated.  This function should</span>
<a href="#l21.205"></a><span id="l21.205" class="difflineminus">-    -     update aTab.title if it can.</span>
<a href="#l21.206"></a><span id="l21.206" class="difflineminus">-    - Mode definition functions to do with menu/toolbar commands:</span>
<a href="#l21.207"></a><span id="l21.207" class="difflineminus">-    - * supportsCommand(aTab, aCommand): Called when a menu or toolbar needs to</span>
<a href="#l21.208"></a><span id="l21.208" class="difflineminus">-    -     be updated. Return true if you support that command in</span>
<a href="#l21.209"></a><span id="l21.209" class="difflineplus">+    - * openTab(aTabInfo, arguments...): Called when a tab of the given mode is</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineplus">+    -     in the process of being opened.  aTabInfo will have its &quot;mode&quot;</span>
<a href="#l21.211"></a><span id="l21.211" class="difflineplus">+    -     attribute set to the mode definition of the tab mode being opened.</span>
<a href="#l21.212"></a><span id="l21.212" class="difflineplus">+    -     You should set the &quot;title&quot; attribute on it, and may set any other</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineplus">+    -     attributes you wish for your own use in subsequent functions.  Note</span>
<a href="#l21.214"></a><span id="l21.214" class="difflineplus">+    -     that 'this' points to the tab type definition, not the mode definition</span>
<a href="#l21.215"></a><span id="l21.215" class="difflineplus">+    -     as you might expect.  This allows you to place common logic code on</span>
<a href="#l21.216"></a><span id="l21.216" class="difflineplus">+    -     the tab type for use by multiple modes and to defer to it.  Any</span>
<a href="#l21.217"></a><span id="l21.217" class="difflineplus">+    -     arguments provided to the caller of tabmail.openTab will be passed to</span>
<a href="#l21.218"></a><span id="l21.218" class="difflineplus">+    -     your function as well.</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineplus">+    - * canCloseTab(aTabInfo): Optional function.</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineplus">+    -     Return true (false) if the tab is (not) allowed to close.</span>
<a href="#l21.221"></a><span id="l21.221" class="difflineplus">+    -     A tab's default permission is stored in aTabInfo.canClose.</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineplus">+    - * closeTab(aTabInfo): Called when aTabInfo is being closed.  The tab need</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineplus">+    -     not be currently displayed.  You are responsible for properly cleaning</span>
<a href="#l21.224"></a><span id="l21.224" class="difflineplus">+    -     up any state you preserved in aTabInfo.</span>
<a href="#l21.225"></a><span id="l21.225" class="difflineplus">+    - * saveTabState(aTabInfo): Called when aTabInfo is being switched away from</span>
<a href="#l21.226"></a><span id="l21.226" class="difflineplus">+    -     so that you can preserve its state on aTabInfo.  This is primarily for</span>
<a href="#l21.227"></a><span id="l21.227" class="difflineplus">+    -     single tab panel implementations; you may not have much state to save</span>
<a href="#l21.228"></a><span id="l21.228" class="difflineplus">+    -     if your tab has its own tab panel.</span>
<a href="#l21.229"></a><span id="l21.229" class="difflineplus">+    - * showTab(aTabInfo): Called when aTabInfo is being displayed and you</span>
<a href="#l21.230"></a><span id="l21.230" class="difflineplus">+    -     should restore its state (if required).</span>
<a href="#l21.231"></a><span id="l21.231" class="difflineplus">+    - * onTitleChanged(aTabInfo): Called when someone calls</span>
<a href="#l21.232"></a><span id="l21.232" class="difflineplus">+    -     tabmail.setTabTitle() to hint that the tab's title needs to be</span>
<a href="#l21.233"></a><span id="l21.233" class="difflineplus">+    -     updated.  This function should update aTabInfo.title if it can.</span>
<a href="#l21.234"></a><span id="l21.234" class="difflineplus">+    - * getBrowser(aTabInfo): This function should return the browser element</span>
<a href="#l21.235"></a><span id="l21.235" class="difflineplus">+    -     for your tab if there is one (return null or don't define this</span>
<a href="#l21.236"></a><span id="l21.236" class="difflineplus">+    -     function otherwise). It is used for some toolkit functions that</span>
<a href="#l21.237"></a><span id="l21.237" class="difflineplus">+    -     require a global &quot;getBrowser&quot; function, e.g. ZoomManager.</span>
<a href="#l21.238"></a><span id="l21.238" class="difflineplus">+    -</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineplus">+    - Mode definition functions for menu/toolbar commands (see nsIController):</span>
<a href="#l21.240"></a><span id="l21.240" class="difflineplus">+    - * supportsCommand(aCommand, aTabInfo): Called when a menu or toolbar needs</span>
<a href="#l21.241"></a><span id="l21.241" class="difflineplus">+    -     to be updated. Return true if you support that command in</span>
<a href="#l21.242"></a><span id="l21.242">     -     isCommandEnabled and doCommand, return false otherwise.</span>
<a href="#l21.243"></a><span id="l21.243" class="difflineminus">-    - * isCommandEnabled(aTab, aCommand): Called when a menu or toolbar needs</span>
<a href="#l21.244"></a><span id="l21.244" class="difflineminus">-    -     to be updated. Return true if the command can be executed at the</span>
<a href="#l21.245"></a><span id="l21.245" class="difflineplus">+    - * isCommandEnabled(aCommand, aTabInfo): Called when a menu or toolbar</span>
<a href="#l21.246"></a><span id="l21.246" class="difflineplus">+    -     needs to be updated. Return true if the command can be executed at the</span>
<a href="#l21.247"></a><span id="l21.247">     -     current time, false otherwise.</span>
<a href="#l21.248"></a><span id="l21.248" class="difflineminus">-    - * doCommand(aTab, aCommand): Called when a menu or toolbar command is to</span>
<a href="#l21.249"></a><span id="l21.249" class="difflineminus">-    -     be executed. Perform the action appropriate to the command.</span>
<a href="#l21.250"></a><span id="l21.250" class="difflineminus">-    - * onEvent(aTab, aEvent): This can be used to handle different events on</span>
<a href="#l21.251"></a><span id="l21.251" class="difflineminus">-    -     the window.</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineminus">-    - * getBrowser(aTab): This function should return the browser element for</span>
<a href="#l21.253"></a><span id="l21.253" class="difflineminus">-    -     your tab if there is one (return null or don't define this function</span>
<a href="#l21.254"></a><span id="l21.254" class="difflineminus">-    -     otherwise). It is used for some toolkit functions that require a</span>
<a href="#l21.255"></a><span id="l21.255" class="difflineminus">-    -     global &quot;getBrowser&quot; function, e.g. ZoomManager.</span>
<a href="#l21.256"></a><span id="l21.256" class="difflineplus">+    - * doCommand(aCommand, aTabInfo): Called when a menu or toolbar command is</span>
<a href="#l21.257"></a><span id="l21.257" class="difflineplus">+    -     to be executed. Perform the action appropriate to the command.</span>
<a href="#l21.258"></a><span id="l21.258" class="difflineplus">+    - * onEvent(aEvent, aTabInfo): This can be used to handle different events</span>
<a href="#l21.259"></a><span id="l21.259" class="difflineplus">+    -     on the window.</span>
<a href="#l21.260"></a><span id="l21.260">     -</span>
<a href="#l21.261"></a><span id="l21.261">     - Tab monitoring code is expected to be used for widgets on the screen</span>
<a href="#l21.262"></a><span id="l21.262">     -  outside of the tab box that need to update themselves as the active tab</span>
<a href="#l21.263"></a><span id="l21.263">     -  changes.  This is primarily intended to be used for the ThunderBar; if</span>
<a href="#l21.264"></a><span id="l21.264">     -  you are not the ThunderBar and this sounds appealing to you, please</span>
<a href="#l21.265"></a><span id="l21.265">     -  solicit discussion on your needs on the mozilla.dev.apps.thunderbird</span>
<a href="#l21.266"></a><span id="l21.266">     -  newsgroup.</span>
<a href="#l21.267"></a><span id="l21.267">     - Tab monitoring code (un)registers itself via (un)registerTabMonitor.</span>
<a href="#l21.268"></a><span id="l21.268">     -  The following functions should be provided on the monitor object:</span>
<a href="#l21.269"></a><span id="l21.269" class="difflineminus">-    - * onTabTitleChanged(aTab): Called when the tab's title changes.</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineminus">-    - * onTabSwitched(aTab, aOldTab): Called when a new tab is made active.  If</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineminus">-    -     this is the first tab ever, aOldTab will be null, otherwise aOldTab</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineminus">-    -     will be the previously active tab.</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineplus">+    - * onTabTitleChanged(aTabInfo): Called when the tab's title changes.</span>
<a href="#l21.274"></a><span id="l21.274" class="difflineplus">+    - * onTabSwitched(aTabInfo, aOldTabInfo): Called when a new tab is made</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineplus">+    -     active.  If this is the first tab ever, aOldTabInfo will be null,</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineplus">+    -     otherwise aOldTabInfo will be the previously active tab.</span>
<a href="#l21.277"></a><span id="l21.277">     --&gt;</span>
<a href="#l21.278"></a><span id="l21.278" class="difflineminus">-  &lt;binding id=&quot;tabmail&quot;&gt;</span>
<a href="#l21.279"></a><span id="l21.279" class="difflineplus">+  &lt;binding id=&quot;tabmail&quot;</span>
<a href="#l21.280"></a><span id="l21.280" class="difflineplus">+           extends=&quot;chrome://navigator/content/tabbrowser.xml#tabbrowser&quot;&gt;</span>
<a href="#l21.281"></a><span id="l21.281">     &lt;resources&gt;</span>
<a href="#l21.282"></a><span id="l21.282" class="difflineminus">-      &lt;stylesheet src=&quot;chrome://messenger/skin/tabmail.css&quot;/&gt;</span>
<a href="#l21.283"></a><span id="l21.283" class="difflineplus">+      &lt;stylesheet src=&quot;chrome://navigator/skin/tabbrowser.css&quot;/&gt;</span>
<a href="#l21.284"></a><span id="l21.284">     &lt;/resources&gt;</span>
<a href="#l21.285"></a><span id="l21.285">     &lt;content&gt;</span>
<a href="#l21.286"></a><span id="l21.286" class="difflineminus">-      &lt;xul:tabbox anonid=&quot;tabbox&quot; flex=&quot;1&quot; eventnode=&quot;document&quot; xbl:inherits=&quot;handleCtrlPageUpDown&quot;</span>
<a href="#l21.287"></a><span id="l21.287" class="difflineminus">-                  onselect=&quot;if (!('updateCurrentTab' in this.parentNode) || event.target.localName != 'tabs')</span>
<a href="#l21.288"></a><span id="l21.288" class="difflineminus">-                            return; this.parentNode.updateCurrentTab();&quot;&gt;</span>
<a href="#l21.289"></a><span id="l21.289" class="difflineplus">+      &lt;xul:tabbox anonid=&quot;tabbox&quot;</span>
<a href="#l21.290"></a><span id="l21.290" class="difflineplus">+                  flex=&quot;1&quot;</span>
<a href="#l21.291"></a><span id="l21.291" class="difflineplus">+                  eventnode=&quot;document&quot;</span>
<a href="#l21.292"></a><span id="l21.292" class="difflineplus">+                  xbl:inherits=&quot;handleCtrlPageUpDown&quot;</span>
<a href="#l21.293"></a><span id="l21.293" class="difflineplus">+                  onselect=&quot;if (event.target.localName == 'tabs' &amp;amp;&amp;amp;</span>
<a href="#l21.294"></a><span id="l21.294" class="difflineplus">+                                'updateCurrentTab' in this.parentNode)</span>
<a href="#l21.295"></a><span id="l21.295" class="difflineplus">+                              this.parentNode.updateCurrentTab();&quot;&gt;</span>
<a href="#l21.296"></a><span id="l21.296">         &lt;xul:hbox class=&quot;tab-drop-indicator-bar&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l21.297"></a><span id="l21.297">           &lt;xul:hbox class=&quot;tab-drop-indicator&quot; mousethrough=&quot;always&quot;/&gt;</span>
<a href="#l21.298"></a><span id="l21.298">         &lt;/xul:hbox&gt;</span>
<a href="#l21.299"></a><span id="l21.299" class="difflineminus">-        &lt;xul:hbox class=&quot;tabmail-strip&quot; collapsed=&quot;false&quot; tooltip=&quot;_child&quot; context=&quot;_child&quot;</span>
<a href="#l21.300"></a><span id="l21.300" class="difflineplus">+        &lt;xul:hbox class=&quot;tabbrowser-strip tabmail-strip&quot;</span>
<a href="#l21.301"></a><span id="l21.301" class="difflineplus">+                  tooltip=&quot;_child&quot;</span>
<a href="#l21.302"></a><span id="l21.302" class="difflineplus">+                  context=&quot;_child&quot;</span>
<a href="#l21.303"></a><span id="l21.303">                   anonid=&quot;strip&quot;</span>
<a href="#l21.304"></a><span id="l21.304">                   ondraggesture=&quot;nsDragAndDrop.startDrag(event, this.parentNode.parentNode); event.stopPropagation();&quot;</span>
<a href="#l21.305"></a><span id="l21.305">                   ondragover=&quot;nsDragAndDrop.dragOver(event, this.parentNode.parentNode); event.stopPropagation();&quot;</span>
<a href="#l21.306"></a><span id="l21.306">                   ondragdrop=&quot;nsDragAndDrop.drop(event, this.parentNode.parentNode); event.stopPropagation();&quot;</span>
<a href="#l21.307"></a><span id="l21.307">                   ondragexit=&quot;nsDragAndDrop.dragExit(event, this.parentNode.parentNode); event.stopPropagation();&quot;&gt;</span>
<a href="#l21.308"></a><span id="l21.308" class="difflineminus">-          &lt;xul:tooltip onpopupshowing=&quot;return CreateToolbarTooltip(document, event);&quot;/&gt;</span>
<a href="#l21.309"></a><span id="l21.309" class="difflineplus">+          &lt;xul:tooltip onpopupshowing=&quot;var tabmail = this.parentNode.parentNode.parentNode;</span>
<a href="#l21.310"></a><span id="l21.310" class="difflineplus">+                                       return tabmail.FillTabmailTooltip(document, event);&quot;/&gt;</span>
<a href="#l21.311"></a><span id="l21.311">           &lt;xul:menupopup anonid=&quot;tabContextMenu&quot;</span>
<a href="#l21.312"></a><span id="l21.312" class="difflineminus">-                onpopupshowing=&quot;</span>
<a href="#l21.313"></a><span id="l21.313" class="difflineminus">-                  var tabmail = this.parentNode.parentNode.parentNode;</span>
<a href="#l21.314"></a><span id="l21.314" class="difflineminus">-                  return tabmail.onTabContextMenuShowing(document.popupNode);&quot;&gt;</span>
<a href="#l21.315"></a><span id="l21.315" class="difflineminus">-            &lt;xul:menuitem label=&quot;&amp;closeTabCmd.label;&quot; accesskey=&quot;&amp;closeTabCmd.accesskey;&quot;</span>
<a href="#l21.316"></a><span id="l21.316" class="difflineplus">+                         onpopupshowing=&quot;var tabmail = this.parentNode.parentNode.parentNode;</span>
<a href="#l21.317"></a><span id="l21.317" class="difflineplus">+                                         tabmail.mContextTab = document.popupNode;&quot;&gt;</span>
<a href="#l21.318"></a><span id="l21.318" class="difflineplus">+            &lt;xul:menuitem label=&quot;&amp;closeTabCmd.label;&quot;</span>
<a href="#l21.319"></a><span id="l21.319" class="difflineplus">+                          accesskey=&quot;&amp;closeTabCmd.accesskey;&quot;</span>
<a href="#l21.320"></a><span id="l21.320">                           oncommand=&quot;var tabmail = this.parentNode.parentNode.parentNode.parentNode;</span>
<a href="#l21.321"></a><span id="l21.321" class="difflineminus">-                                     tabmail.removeTabByNode(document.popupNode);&quot;/&gt;</span>
<a href="#l21.322"></a><span id="l21.322" class="difflineplus">+                                     tabmail.removeTab(tabmail.mContextTab);&quot;/&gt;</span>
<a href="#l21.323"></a><span id="l21.323">           &lt;/xul:menupopup&gt;</span>
<a href="#l21.324"></a><span id="l21.324" class="difflineminus">-          &lt;xul:tabs class=&quot;tabmail-tabs&quot; flex=&quot;1&quot;</span>
<a href="#l21.325"></a><span id="l21.325" class="difflineplus">+          &lt;xul:tabs class=&quot;tabbrowser-tabs tabmail-tabs&quot;</span>
<a href="#l21.326"></a><span id="l21.326" class="difflineplus">+                    flex=&quot;1&quot;</span>
<a href="#l21.327"></a><span id="l21.327">                     anonid=&quot;tabcontainer&quot;</span>
<a href="#l21.328"></a><span id="l21.328">                     setfocus=&quot;false&quot;</span>
<a href="#l21.329"></a><span id="l21.329">                     onclick=&quot;this.parentNode.parentNode.parentNode.onTabClick(event);&quot;&gt;</span>
<a href="#l21.330"></a><span id="l21.330" class="difflineminus">-            &lt;xul:tab selected=&quot;true&quot; validate=&quot;never&quot; type=&quot;folder&quot;</span>
<a href="#l21.331"></a><span id="l21.331" class="difflineminus">-                     maxwidth=&quot;250&quot; width=&quot;0&quot; minwidth=&quot;100&quot; flex=&quot;100&quot;</span>
<a href="#l21.332"></a><span id="l21.332" class="difflineminus">-                     class=&quot;tabmail-tab&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l21.333"></a><span id="l21.333" class="difflineplus">+            &lt;xul:tab selected=&quot;true&quot;</span>
<a href="#l21.334"></a><span id="l21.334" class="difflineplus">+                     validate=&quot;never&quot;</span>
<a href="#l21.335"></a><span id="l21.335" class="difflineplus">+                     type=&quot;3pane&quot;</span>
<a href="#l21.336"></a><span id="l21.336" class="difflineplus">+                     maxwidth=&quot;250&quot;</span>
<a href="#l21.337"></a><span id="l21.337" class="difflineplus">+                     width=&quot;0&quot;</span>
<a href="#l21.338"></a><span id="l21.338" class="difflineplus">+                     minwidth=&quot;100&quot;</span>
<a href="#l21.339"></a><span id="l21.339" class="difflineplus">+                     flex=&quot;100&quot;</span>
<a href="#l21.340"></a><span id="l21.340" class="difflineplus">+                     class=&quot;tabbrowser-tab tabmail-tab&quot;</span>
<a href="#l21.341"></a><span id="l21.341" class="difflineplus">+                     crop=&quot;end&quot;/&gt;</span>
<a href="#l21.342"></a><span id="l21.342">             &lt;children/&gt;</span>
<a href="#l21.343"></a><span id="l21.343">           &lt;/xul:tabs&gt;</span>
<a href="#l21.344"></a><span id="l21.344">         &lt;/xul:hbox&gt;</span>
<a href="#l21.345"></a><span id="l21.345">         &lt;!-- Remember, user of this binding, you need to provide tabpanels!  --&gt;</span>
<a href="#l21.346"></a><span id="l21.346">         &lt;children includes=&quot;tabpanels&quot;/&gt;</span>
<a href="#l21.347"></a><span id="l21.347">       &lt;/xul:tabbox&gt;</span>
<a href="#l21.348"></a><span id="l21.348">     &lt;/content&gt;</span>
<a href="#l21.349"></a><span id="l21.349"> </span>
<a href="#l21.350"></a><span id="l21.350" class="difflineminus">-    &lt;implementation implements=&quot;nsIController&quot;&gt;</span>
<a href="#l21.351"></a><span id="l21.351" class="difflineplus">+    &lt;implementation implements=&quot;nsIController, nsIObserver&quot;&gt;</span>
<a href="#l21.352"></a><span id="l21.352">       &lt;constructor&gt;</span>
<a href="#l21.353"></a><span id="l21.353" class="difflineminus">-        window.controllers.insertControllerAt(0, this);</span>
<a href="#l21.354"></a><span id="l21.354" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.355"></a><span id="l21.355" class="difflineplus">+          window.controllers.insertControllerAt(0, this);</span>
<a href="#l21.356"></a><span id="l21.356" class="difflineplus">+          const kAutoHide = &quot;browser.tabs.autoHide&quot;;</span>
<a href="#l21.357"></a><span id="l21.357" class="difflineplus">+          this.mAutoHide = this.mPrefs.getBoolPref(kAutoHide);</span>
<a href="#l21.358"></a><span id="l21.358" class="difflineplus">+          this.mPrefs.addObserver(kAutoHide, this, false);</span>
<a href="#l21.359"></a><span id="l21.359" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.360"></a><span id="l21.360">       &lt;/constructor&gt;</span>
<a href="#l21.361"></a><span id="l21.361" class="difflineplus">+</span>
<a href="#l21.362"></a><span id="l21.362">       &lt;destructor&gt;</span>
<a href="#l21.363"></a><span id="l21.363" class="difflineminus">-        window.controllers.removeController(this);</span>
<a href="#l21.364"></a><span id="l21.364" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.365"></a><span id="l21.365" class="difflineplus">+          this.mPrefs.removeObserver(&quot;browser.tabs.autoHide&quot;, this);</span>
<a href="#l21.366"></a><span id="l21.366" class="difflineplus">+          window.controllers.removeController(this);</span>
<a href="#l21.367"></a><span id="l21.367" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.368"></a><span id="l21.368">       &lt;/destructor&gt;</span>
<a href="#l21.369"></a><span id="l21.369" class="difflineplus">+</span>
<a href="#l21.370"></a><span id="l21.370" class="difflineplus">+      &lt;field name=&quot;mPrefs&quot;&gt;</span>
<a href="#l21.371"></a><span id="l21.371" class="difflineplus">+        Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.372"></a><span id="l21.372" class="difflineplus">+                  .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l21.373"></a><span id="l21.373" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l21.374"></a><span id="l21.374" class="difflineplus">+</span>
<a href="#l21.375"></a><span id="l21.375">       &lt;field name=&quot;currentTabInfo&quot;&gt;</span>
<a href="#l21.376"></a><span id="l21.376">         null</span>
<a href="#l21.377"></a><span id="l21.377">       &lt;/field&gt;</span>
<a href="#l21.378"></a><span id="l21.378" class="difflineplus">+</span>
<a href="#l21.379"></a><span id="l21.379">       &lt;field name=&quot;tabTypes&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.380"></a><span id="l21.380">         new Object()</span>
<a href="#l21.381"></a><span id="l21.381">       &lt;/field&gt;</span>
<a href="#l21.382"></a><span id="l21.382" class="difflineplus">+</span>
<a href="#l21.383"></a><span id="l21.383">       &lt;field name=&quot;tabModes&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.384"></a><span id="l21.384">         new Object()</span>
<a href="#l21.385"></a><span id="l21.385">       &lt;/field&gt;</span>
<a href="#l21.386"></a><span id="l21.386" class="difflineplus">+</span>
<a href="#l21.387"></a><span id="l21.387">       &lt;field name=&quot;defaultTabMode&quot;&gt;</span>
<a href="#l21.388"></a><span id="l21.388">         null</span>
<a href="#l21.389"></a><span id="l21.389">       &lt;/field&gt;</span>
<a href="#l21.390"></a><span id="l21.390" class="difflineplus">+</span>
<a href="#l21.391"></a><span id="l21.391">       &lt;field name=&quot;tabInfo&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.392"></a><span id="l21.392">         new Array()</span>
<a href="#l21.393"></a><span id="l21.393">       &lt;/field&gt;</span>
<a href="#l21.394"></a><span id="l21.394" class="difflineplus">+</span>
<a href="#l21.395"></a><span id="l21.395">       &lt;field name=&quot;tabStrip&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.396"></a><span id="l21.396">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;strip&quot;);</span>
<a href="#l21.397"></a><span id="l21.397">       &lt;/field&gt;</span>
<a href="#l21.398"></a><span id="l21.398" class="difflineplus">+</span>
<a href="#l21.399"></a><span id="l21.399">       &lt;field name=&quot;tabContainer&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.400"></a><span id="l21.400">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;tabcontainer&quot;);</span>
<a href="#l21.401"></a><span id="l21.401">       &lt;/field&gt;</span>
<a href="#l21.402"></a><span id="l21.402" class="difflineplus">+</span>
<a href="#l21.403"></a><span id="l21.403">       &lt;field name=&quot;panelContainer&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.404"></a><span id="l21.404">         document.getElementById(this.getAttribute(&quot;panelcontainer&quot;));</span>
<a href="#l21.405"></a><span id="l21.405">       &lt;/field&gt;</span>
<a href="#l21.406"></a><span id="l21.406" class="difflineplus">+</span>
<a href="#l21.407"></a><span id="l21.407" class="difflineplus">+      &lt;field name=&quot;mContextTab&quot;&gt;</span>
<a href="#l21.408"></a><span id="l21.408" class="difflineplus">+        null</span>
<a href="#l21.409"></a><span id="l21.409" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l21.410"></a><span id="l21.410" class="difflineplus">+</span>
<a href="#l21.411"></a><span id="l21.411" class="difflineplus">+      &lt;!-- _mAutoHide/mAutoHide reflect the current autoHide pref value --&gt;</span>
<a href="#l21.412"></a><span id="l21.412" class="difflineplus">+      &lt;field name=&quot;_mAutoHide&quot;&gt;false&lt;/field&gt;</span>
<a href="#l21.413"></a><span id="l21.413" class="difflineplus">+      &lt;property name=&quot;mAutoHide&quot; onget=&quot;return this._mAutoHide;&quot;&gt;</span>
<a href="#l21.414"></a><span id="l21.414" class="difflineplus">+        &lt;setter&gt;</span>
<a href="#l21.415"></a><span id="l21.415" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.416"></a><span id="l21.416" class="difflineplus">+            if (val != this._mAutoHide)</span>
<a href="#l21.417"></a><span id="l21.417" class="difflineplus">+            {</span>
<a href="#l21.418"></a><span id="l21.418" class="difflineplus">+              if (this.tabContainer.childNodes.length == 1)</span>
<a href="#l21.419"></a><span id="l21.419" class="difflineplus">+                this.mStripVisible = !val;</span>
<a href="#l21.420"></a><span id="l21.420" class="difflineplus">+              this._mAutoHide = val;</span>
<a href="#l21.421"></a><span id="l21.421" class="difflineplus">+            }</span>
<a href="#l21.422"></a><span id="l21.422" class="difflineplus">+            return val;</span>
<a href="#l21.423"></a><span id="l21.423" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.424"></a><span id="l21.424" class="difflineplus">+        &lt;/setter&gt;</span>
<a href="#l21.425"></a><span id="l21.425" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l21.426"></a><span id="l21.426" class="difflineplus">+</span>
<a href="#l21.427"></a><span id="l21.427" class="difflineplus">+      &lt;!-- mStripVisible reflects the actual XUL autoHide state --&gt;</span>
<a href="#l21.428"></a><span id="l21.428" class="difflineplus">+      &lt;property name=&quot;mStripVisible&quot;</span>
<a href="#l21.429"></a><span id="l21.429" class="difflineplus">+                onget=&quot;return !this.tabStrip.collapsed;&quot;</span>
<a href="#l21.430"></a><span id="l21.430" class="difflineplus">+                onset=&quot;return this.tabStrip.collapsed = !val;&quot;/&gt;</span>
<a href="#l21.431"></a><span id="l21.431" class="difflineplus">+</span>
<a href="#l21.432"></a><span id="l21.432" class="difflineplus">+      &lt;method name=&quot;registerTabType&quot;&gt;</span>
<a href="#l21.433"></a><span id="l21.433" class="difflineplus">+        &lt;parameter name=&quot;aTabType&quot;/&gt;</span>
<a href="#l21.434"></a><span id="l21.434" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.435"></a><span id="l21.435" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.436"></a><span id="l21.436" class="difflineplus">+            if (aTabType.name in this.tabTypes)</span>
<a href="#l21.437"></a><span id="l21.437" class="difflineplus">+              return;</span>
<a href="#l21.438"></a><span id="l21.438" class="difflineplus">+            this.tabTypes[aTabType.name] = aTabType;</span>
<a href="#l21.439"></a><span id="l21.439" class="difflineplus">+            for (let [modeName, modeDetails] in Iterator(aTabType.modes))</span>
<a href="#l21.440"></a><span id="l21.440" class="difflineplus">+            {</span>
<a href="#l21.441"></a><span id="l21.441" class="difflineplus">+              modeDetails.name = modeName;</span>
<a href="#l21.442"></a><span id="l21.442" class="difflineplus">+              modeDetails.tabType = aTabType;</span>
<a href="#l21.443"></a><span id="l21.443" class="difflineplus">+              modeDetails.tabs = [];</span>
<a href="#l21.444"></a><span id="l21.444" class="difflineplus">+              this.tabModes[modeName] = modeDetails;</span>
<a href="#l21.445"></a><span id="l21.445" class="difflineplus">+              if (modeDetails.isDefault)</span>
<a href="#l21.446"></a><span id="l21.446" class="difflineplus">+                this.defaultTabMode = modeDetails;</span>
<a href="#l21.447"></a><span id="l21.447" class="difflineplus">+            }</span>
<a href="#l21.448"></a><span id="l21.448" class="difflineplus">+            aTabType.panel = document.getElementById(aTabType.panelId);</span>
<a href="#l21.449"></a><span id="l21.449" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.450"></a><span id="l21.450" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.451"></a><span id="l21.451" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.452"></a><span id="l21.452" class="difflineplus">+</span>
<a href="#l21.453"></a><span id="l21.453">       &lt;field name=&quot;tabMonitors&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.454"></a><span id="l21.454">         new Array()</span>
<a href="#l21.455"></a><span id="l21.455">       &lt;/field&gt;</span>
<a href="#l21.456"></a><span id="l21.456" class="difflineminus">-      &lt;method name=&quot;registerTabType&quot;&gt;</span>
<a href="#l21.457"></a><span id="l21.457" class="difflineminus">-        &lt;parameter name=&quot;aTabType&quot;/&gt;</span>
<a href="#l21.458"></a><span id="l21.458" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.459"></a><span id="l21.459" class="difflineminus">-          if (aTabType.name in this.tabTypes)</span>
<a href="#l21.460"></a><span id="l21.460" class="difflineminus">-            return;</span>
<a href="#l21.461"></a><span id="l21.461" class="difflineminus">-        </span>
<a href="#l21.462"></a><span id="l21.462" class="difflineminus">-          this.tabTypes[aTabType.name] = aTabType;</span>
<a href="#l21.463"></a><span id="l21.463" class="difflineminus">-          for (let [modeName, modeDetails] in Iterator(aTabType.modes)) {</span>
<a href="#l21.464"></a><span id="l21.464" class="difflineminus">-            modeDetails.name = modeName;</span>
<a href="#l21.465"></a><span id="l21.465" class="difflineminus">-            modeDetails.tabType = aTabType;</span>
<a href="#l21.466"></a><span id="l21.466" class="difflineminus">-            modeDetails.tabs = [];</span>
<a href="#l21.467"></a><span id="l21.467" class="difflineminus">-            this.tabModes[modeName] = modeDetails;</span>
<a href="#l21.468"></a><span id="l21.468" class="difflineminus">-            if (modeDetails.isDefault)</span>
<a href="#l21.469"></a><span id="l21.469" class="difflineminus">-              this.defaultTabMode = modeDetails;</span>
<a href="#l21.470"></a><span id="l21.470" class="difflineminus">-          }</span>
<a href="#l21.471"></a><span id="l21.471" class="difflineminus">-          </span>
<a href="#l21.472"></a><span id="l21.472" class="difflineminus">-          aTabType.panel = document.getElementById(aTabType.panelId);</span>
<a href="#l21.473"></a><span id="l21.473" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.474"></a><span id="l21.474" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.475"></a><span id="l21.475" class="difflineplus">+</span>
<a href="#l21.476"></a><span id="l21.476">       &lt;method name=&quot;registerTabMonitor&quot;&gt;</span>
<a href="#l21.477"></a><span id="l21.477">         &lt;parameter name=&quot;aTabMonitor&quot;/&gt;</span>
<a href="#l21.478"></a><span id="l21.478" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.479"></a><span id="l21.479" class="difflineminus">-          if (this.tabMonitors.indexOf(aTabMonitor) == -1)</span>
<a href="#l21.480"></a><span id="l21.480" class="difflineminus">-            this.tabMonitors.push(aTabMonitor);</span>
<a href="#l21.481"></a><span id="l21.481" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.482"></a><span id="l21.482" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.483"></a><span id="l21.483" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.484"></a><span id="l21.484" class="difflineplus">+            if (this.tabMonitors.indexOf(aTabMonitor) == -1)</span>
<a href="#l21.485"></a><span id="l21.485" class="difflineplus">+              this.tabMonitors.push(aTabMonitor);</span>
<a href="#l21.486"></a><span id="l21.486" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.487"></a><span id="l21.487" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.488"></a><span id="l21.488">       &lt;/method&gt;</span>
<a href="#l21.489"></a><span id="l21.489" class="difflineplus">+</span>
<a href="#l21.490"></a><span id="l21.490">       &lt;method name=&quot;unregisterTabMonitor&quot;&gt;</span>
<a href="#l21.491"></a><span id="l21.491">         &lt;parameter name=&quot;aTabMonitor&quot;/&gt;</span>
<a href="#l21.492"></a><span id="l21.492" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.493"></a><span id="l21.493" class="difflineminus">-          if (this.tabMonitors.indexOf(aTabMonitor) &gt;= 0)</span>
<a href="#l21.494"></a><span id="l21.494" class="difflineminus">-            this.tabMonitors.splice(this.tabMonitors.indexOf(aTabMonitor), 1);</span>
<a href="#l21.495"></a><span id="l21.495" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.496"></a><span id="l21.496" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.497"></a><span id="l21.497" class="difflineminus">-      &lt;method name=&quot;openFirstTab&quot;&gt;</span>
<a href="#l21.498"></a><span id="l21.498" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.499"></a><span id="l21.499" class="difflineminus">-          // From the moment of creation, our XBL binding already has a visible</span>
<a href="#l21.500"></a><span id="l21.500" class="difflineminus">-          //  tab.  We need to create a tab information structure for this tab.</span>
<a href="#l21.501"></a><span id="l21.501" class="difflineminus">-          //  In the process we also generate a synthetic tab title changed</span>
<a href="#l21.502"></a><span id="l21.502" class="difflineminus">-          //  event to ensure we have an accurate title.  We assume the tab</span>
<a href="#l21.503"></a><span id="l21.503" class="difflineminus">-          //  contents will set themselves up correctly.</span>
<a href="#l21.504"></a><span id="l21.504" class="difflineminus">-          if (this.tabInfo.length == 0) {</span>
<a href="#l21.505"></a><span id="l21.505" class="difflineminus">-            let firstTab = {mode: this.defaultTabMode, canClose: false};</span>
<a href="#l21.506"></a><span id="l21.506" class="difflineminus">-            firstTab.mode.tabs.push(firstTab);</span>
<a href="#l21.507"></a><span id="l21.507" class="difflineminus">-           </span>
<a href="#l21.508"></a><span id="l21.508" class="difflineminus">-            this.tabInfo[0] = this.currentTabInfo = firstTab;</span>
<a href="#l21.509"></a><span id="l21.509" class="difflineminus">-            this.setTabTitle(firstTab);</span>
<a href="#l21.510"></a><span id="l21.510" class="difflineminus">-</span>
<a href="#l21.511"></a><span id="l21.511" class="difflineminus">-            if (this.tabMonitors.length) {</span>
<a href="#l21.512"></a><span id="l21.512" class="difflineminus">-              for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.513"></a><span id="l21.513" class="difflineminus">-                tabMonitor.onTabSwitched(tab, null);</span>
<a href="#l21.514"></a><span id="l21.514" class="difflineminus">-            }</span>
<a href="#l21.515"></a><span id="l21.515" class="difflineminus">-          }</span>
<a href="#l21.516"></a><span id="l21.516" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.517"></a><span id="l21.517" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.518"></a><span id="l21.518" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.519"></a><span id="l21.519" class="difflineplus">+            if (this.tabMonitors.indexOf(aTabMonitor) &gt;= 0)</span>
<a href="#l21.520"></a><span id="l21.520" class="difflineplus">+              this.tabMonitors.splice(this.tabMonitors.indexOf(aTabMonitor), 1);</span>
<a href="#l21.521"></a><span id="l21.521" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.522"></a><span id="l21.522" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.523"></a><span id="l21.523">       &lt;/method&gt;</span>
<a href="#l21.524"></a><span id="l21.524" class="difflineminus">-      &lt;method name=&quot;openTab&quot;&gt;</span>
<a href="#l21.525"></a><span id="l21.525" class="difflineminus">-        &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l21.526"></a><span id="l21.526" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l21.527"></a><span id="l21.527" class="difflineminus">-            &lt;![CDATA[</span>
<a href="#l21.528"></a><span id="l21.528" class="difflineminus">-          let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l21.529"></a><span id="l21.529" class="difflineminus">-          // if we are already at our limit for this mode, show an existing one</span>
<a href="#l21.530"></a><span id="l21.530" class="difflineminus">-          if (tabMode.tabs.length == tabMode.maxTabs) {</span>
<a href="#l21.531"></a><span id="l21.531" class="difflineminus">-            let desiredTab = tabMode.tabs[0];</span>
<a href="#l21.532"></a><span id="l21.532" class="difflineminus">-            this.tabContainer.selectedIndex = this.tabInfo.indexOf(desiredTab);</span>
<a href="#l21.533"></a><span id="l21.533" class="difflineminus">-            return;</span>
<a href="#l21.534"></a><span id="l21.534" class="difflineminus">-          }</span>
<a href="#l21.535"></a><span id="l21.535" class="difflineminus">-</span>
<a href="#l21.536"></a><span id="l21.536" class="difflineminus">-          // If the mode wants us to, we should switch to an existing tab</span>
<a href="#l21.537"></a><span id="l21.537" class="difflineminus">-          // rather than open a new one.</span>
<a href="#l21.538"></a><span id="l21.538" class="difflineminus">-          let shouldSwitchToFunc = tabMode.shouldSwitchTo ||</span>
<a href="#l21.539"></a><span id="l21.539" class="difflineminus">-                                   tabMode.tabType.shouldSwitchTo;</span>
<a href="#l21.540"></a><span id="l21.540" class="difflineminus">-</span>
<a href="#l21.541"></a><span id="l21.541" class="difflineminus">-          if (shouldSwitchToFunc) {</span>
<a href="#l21.542"></a><span id="l21.542" class="difflineminus">-            let args = Array.prototype.slice.call(arguments, 1);</span>
<a href="#l21.543"></a><span id="l21.543" class="difflineminus">-            let tabIndex = shouldSwitchToFunc.apply(tabMode.tabType, args);</span>
<a href="#l21.544"></a><span id="l21.544" class="difflineminus">-            if (tabIndex &gt;= 0) {</span>
<a href="#l21.545"></a><span id="l21.545" class="difflineminus">-              this.selectTabByIndex(null, tabIndex);</span>
<a href="#l21.546"></a><span id="l21.546" class="difflineminus">-              return;</span>
<a href="#l21.547"></a><span id="l21.547" class="difflineminus">-            }</span>
<a href="#l21.548"></a><span id="l21.548" class="difflineminus">-          }</span>
<a href="#l21.549"></a><span id="l21.549" class="difflineminus">-</span>
<a href="#l21.550"></a><span id="l21.550" class="difflineminus">-          // we need to save the state before it gets corrupted</span>
<a href="#l21.551"></a><span id="l21.551" class="difflineminus">-          this.saveCurrentTabState();</span>
<a href="#l21.552"></a><span id="l21.552" class="difflineminus">-</span>
<a href="#l21.553"></a><span id="l21.553" class="difflineminus">-          let tab = {mode: tabMode, canClose: true};</span>
<a href="#l21.554"></a><span id="l21.554" class="difflineminus">-          tabMode.tabs.push(tab);</span>
<a href="#l21.555"></a><span id="l21.555" class="difflineminus">-</span>
<a href="#l21.556"></a><span id="l21.556" class="difflineminus">-          var t = document.createElementNS(</span>
<a href="#l21.557"></a><span id="l21.557" class="difflineminus">-            &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l21.558"></a><span id="l21.558" class="difflineminus">-            &quot;tab&quot;);</span>
<a href="#l21.559"></a><span id="l21.559" class="difflineminus">-          t.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l21.560"></a><span id="l21.560" class="difflineminus">-          t.maxWidth = this.tabContainer.mTabMaxWidth;</span>
<a href="#l21.561"></a><span id="l21.561" class="difflineminus">-          t.minWidth = this.tabContainer.mTabMinWidth;</span>
<a href="#l21.562"></a><span id="l21.562" class="difflineminus">-          t.width = 0;</span>
<a href="#l21.563"></a><span id="l21.563" class="difflineminus">-          t.setAttribute(&quot;flex&quot;, &quot;100&quot;);</span>
<a href="#l21.564"></a><span id="l21.564" class="difflineminus">-          t.setAttribute(&quot;validate&quot;, &quot;never&quot;);</span>
<a href="#l21.565"></a><span id="l21.565" class="difflineminus">-          t.className = &quot;tabmail-tab&quot;;</span>
<a href="#l21.566"></a><span id="l21.566" class="difflineminus">-          this.tabContainer.appendChild(t);</span>
<a href="#l21.567"></a><span id="l21.567" class="difflineminus">-          this.tabContainer.appendChild(t);</span>
<a href="#l21.568"></a><span id="l21.568" class="difflineminus">-          if (this.tabContainer.collapsed) {</span>
<a href="#l21.569"></a><span id="l21.569" class="difflineminus">-            this.tabContainer.collapsed = false;</span>
<a href="#l21.570"></a><span id="l21.570" class="difflineminus">-            this.tabContainer.adjustTabstrip();</span>
<a href="#l21.571"></a><span id="l21.571" class="difflineminus">-          }</span>
<a href="#l21.572"></a><span id="l21.572" class="difflineminus">-</span>
<a href="#l21.573"></a><span id="l21.573" class="difflineminus">-          let oldTab = this.currentTabInfo;</span>
<a href="#l21.574"></a><span id="l21.574"> </span>
<a href="#l21.575"></a><span id="l21.575" class="difflineminus">-          // the order of the following statements is important</span>
<a href="#l21.576"></a><span id="l21.576" class="difflineminus">-          this.currentTabInfo = tab;</span>
<a href="#l21.577"></a><span id="l21.577" class="difflineminus">-          this.tabInfo[this.tabContainer.childNodes.length - 1] = tab;</span>
<a href="#l21.578"></a><span id="l21.578" class="difflineminus">-          // this has a side effect of calling updateCurrentTab, but our</span>
<a href="#l21.579"></a><span id="l21.579" class="difflineminus">-          //  setting currentTabInfo above will cause it to take no action.</span>
<a href="#l21.580"></a><span id="l21.580" class="difflineminus">-          this.tabContainer.selectedIndex =</span>
<a href="#l21.581"></a><span id="l21.581" class="difflineminus">-            this.tabContainer.childNodes.length - 1;</span>
<a href="#l21.582"></a><span id="l21.582" class="difflineminus">-</span>
<a href="#l21.583"></a><span id="l21.583" class="difflineminus">-          // make sure we are on the right panel</span>
<a href="#l21.584"></a><span id="l21.584" class="difflineminus">-          if (tab.mode.tabType.perTabPanel) {</span>
<a href="#l21.585"></a><span id="l21.585" class="difflineminus">-            // should we create the element for them, or will they do it?</span>
<a href="#l21.586"></a><span id="l21.586" class="difflineminus">-            if (typeof(tab.mode.tabType.perTabPanel) == &quot;string&quot;) {</span>
<a href="#l21.587"></a><span id="l21.587" class="difflineminus">-              tab.panel = document.createElementNS(</span>
<a href="#l21.588"></a><span id="l21.588" class="difflineminus">-                &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l21.589"></a><span id="l21.589" class="difflineminus">-                tab.mode.tabType.perTabPanel);</span>
<a href="#l21.590"></a><span id="l21.590" class="difflineminus">-            }</span>
<a href="#l21.591"></a><span id="l21.591" class="difflineminus">-            else {</span>
<a href="#l21.592"></a><span id="l21.592" class="difflineminus">-              tab.panel = tab.mode.tabType.perTabPanel(tab);</span>
<a href="#l21.593"></a><span id="l21.593" class="difflineminus">-            }</span>
<a href="#l21.594"></a><span id="l21.594" class="difflineminus">-            this.panelContainer.appendChild(tab.panel);</span>
<a href="#l21.595"></a><span id="l21.595" class="difflineminus">-            this.panelContainer.selectedPanel = tab.panel;</span>
<a href="#l21.596"></a><span id="l21.596" class="difflineminus">-          }</span>
<a href="#l21.597"></a><span id="l21.597" class="difflineminus">-          else</span>
<a href="#l21.598"></a><span id="l21.598" class="difflineminus">-            this.panelContainer.selectedPanel = tab.mode.tabType.panel;</span>
<a href="#l21.599"></a><span id="l21.599" class="difflineminus">-            </span>
<a href="#l21.600"></a><span id="l21.600" class="difflineminus">-          let tabOpenFunc = tab.mode.openTab || tab.mode.tabType.openTab;</span>
<a href="#l21.601"></a><span id="l21.601" class="difflineminus">-          let args = [tab].concat(Array.prototype.slice.call(arguments, 1));</span>
<a href="#l21.602"></a><span id="l21.602" class="difflineminus">-          tabOpenFunc.apply(tab.mode.tabType, args);</span>
<a href="#l21.603"></a><span id="l21.603" class="difflineminus">-          </span>
<a href="#l21.604"></a><span id="l21.604" class="difflineminus">-          if (this.tabMonitors.length) {</span>
<a href="#l21.605"></a><span id="l21.605" class="difflineminus">-            for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.606"></a><span id="l21.606" class="difflineminus">-              tabMonitor.onTabSwitched(tab, oldTab);</span>
<a href="#l21.607"></a><span id="l21.607" class="difflineminus">-          }</span>
<a href="#l21.608"></a><span id="l21.608" class="difflineminus">-          </span>
<a href="#l21.609"></a><span id="l21.609" class="difflineminus">-          t.setAttribute(&quot;label&quot;, tab.title);</span>
<a href="#l21.610"></a><span id="l21.610" class="difflineminus">-          </span>
<a href="#l21.611"></a><span id="l21.611" class="difflineminus">-          let docTitle = tab.title;</span>
<a href="#l21.612"></a><span id="l21.612" class="difflineminus">-#ifndef XP_MACOSX</span>
<a href="#l21.613"></a><span id="l21.613" class="difflineminus">-          docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l21.614"></a><span id="l21.614" class="difflineminus">-#endif</span>
<a href="#l21.615"></a><span id="l21.615" class="difflineminus">-          document.title = docTitle;</span>
<a href="#l21.616"></a><span id="l21.616" class="difflineminus">-          </span>
<a href="#l21.617"></a><span id="l21.617" class="difflineminus">-          // for styling purposes, apply the type to the tab...</span>
<a href="#l21.618"></a><span id="l21.618" class="difflineminus">-          t.setAttribute('type', tab.mode.type);</span>
<a href="#l21.619"></a><span id="l21.619" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.620"></a><span id="l21.620" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.621"></a><span id="l21.621" class="difflineminus">-      &lt;method name=&quot;selectTabByMode&quot;&gt;</span>
<a href="#l21.622"></a><span id="l21.622" class="difflineminus">-        &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l21.623"></a><span id="l21.623" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.624"></a><span id="l21.624" class="difflineminus">-          let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l21.625"></a><span id="l21.625" class="difflineminus">-          if (tabMode.tabs.length) {</span>
<a href="#l21.626"></a><span id="l21.626" class="difflineminus">-            let desiredTab = tabMode.tabs[0];</span>
<a href="#l21.627"></a><span id="l21.627" class="difflineminus">-            this.tabContainer.selectedIndex = this.tabInfo.indexOf(desiredTab);</span>
<a href="#l21.628"></a><span id="l21.628" class="difflineminus">-          }</span>
<a href="#l21.629"></a><span id="l21.629" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.630"></a><span id="l21.630" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.631"></a><span id="l21.631" class="difflineminus">-      &lt;method name=&quot;selectTabByIndex&quot;&gt;</span>
<a href="#l21.632"></a><span id="l21.632" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.633"></a><span id="l21.633" class="difflineminus">-        &lt;parameter name=&quot;aIndex&quot;/&gt;</span>
<a href="#l21.634"></a><span id="l21.634" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.635"></a><span id="l21.635" class="difflineminus">-          // count backwards for aIndex &lt; 0</span>
<a href="#l21.636"></a><span id="l21.636" class="difflineminus">-          if (aIndex &lt; 0)</span>
<a href="#l21.637"></a><span id="l21.637" class="difflineminus">-            aIndex += this.tabInfo.length;</span>
<a href="#l21.638"></a><span id="l21.638" class="difflineminus">-</span>
<a href="#l21.639"></a><span id="l21.639" class="difflineminus">-          if (aIndex &gt;= 0 &amp;&amp;</span>
<a href="#l21.640"></a><span id="l21.640" class="difflineminus">-              aIndex &lt; this.tabInfo.length &amp;&amp;</span>
<a href="#l21.641"></a><span id="l21.641" class="difflineminus">-              aIndex != this.tabContainer.selectedIndex) {</span>
<a href="#l21.642"></a><span id="l21.642" class="difflineminus">-            this.tabContainer.selectedIndex = aIndex;</span>
<a href="#l21.643"></a><span id="l21.643" class="difflineminus">-          }</span>
<a href="#l21.644"></a><span id="l21.644" class="difflineminus">-</span>
<a href="#l21.645"></a><span id="l21.645" class="difflineminus">-          if (aEvent) {</span>
<a href="#l21.646"></a><span id="l21.646" class="difflineminus">-            aEvent.preventDefault();</span>
<a href="#l21.647"></a><span id="l21.647" class="difflineminus">-            aEvent.stopPropagation();</span>
<a href="#l21.648"></a><span id="l21.648" class="difflineminus">-          }</span>
<a href="#l21.649"></a><span id="l21.649" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.650"></a><span id="l21.650" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.651"></a><span id="l21.651" class="difflineminus">-      &lt;method name=&quot;closeTabs&quot;&gt;</span>
<a href="#l21.652"></a><span id="l21.652" class="difflineplus">+      &lt;method name=&quot;openFirstTab&quot;&gt;</span>
<a href="#l21.653"></a><span id="l21.653">         &lt;body&gt;</span>
<a href="#l21.654"></a><span id="l21.654">           &lt;![CDATA[</span>
<a href="#l21.655"></a><span id="l21.655" class="difflineminus">-            for (var i = 0; i &lt; this.tabInfo.length; i++) {</span>
<a href="#l21.656"></a><span id="l21.656" class="difflineminus">-              let tab = this.tabInfo[i];</span>
<a href="#l21.657"></a><span id="l21.657" class="difflineminus">-              </span>
<a href="#l21.658"></a><span id="l21.658" class="difflineminus">-              let tabCloseFunc = tab.mode.closeTab || tab.mode.tabType.closeTab;</span>
<a href="#l21.659"></a><span id="l21.659" class="difflineminus">-              tabCloseFunc.call(tab.mode.tabType, tab);</span>
<a href="#l21.660"></a><span id="l21.660" class="difflineplus">+            // From the moment of creation, our XBL binding already has a</span>
<a href="#l21.661"></a><span id="l21.661" class="difflineplus">+            // visible tab. We need to create a tab information structure for</span>
<a href="#l21.662"></a><span id="l21.662" class="difflineplus">+            // this tab. In the process we also generate a synthetic &quot;tab title</span>
<a href="#l21.663"></a><span id="l21.663" class="difflineplus">+            // changed&quot; event to ensure we have an accurate title.</span>
<a href="#l21.664"></a><span id="l21.664" class="difflineplus">+            // Note: for mail tabs, the title gets only set later when the</span>
<a href="#l21.665"></a><span id="l21.665" class="difflineplus">+            // folder or message is loaded, as we don't have a gDBView yet!</span>
<a href="#l21.666"></a><span id="l21.666" class="difflineplus">+            // We assume the tab contents will set themselves up correctly.</span>
<a href="#l21.667"></a><span id="l21.667" class="difflineplus">+            if (!this.tabInfo.length)</span>
<a href="#l21.668"></a><span id="l21.668" class="difflineplus">+            {</span>
<a href="#l21.669"></a><span id="l21.669" class="difflineplus">+              let firstTabInfo = {mode: this.defaultTabMode, canClose: true};</span>
<a href="#l21.670"></a><span id="l21.670" class="difflineplus">+              let firstTabNode = this.tabContainer.firstChild;</span>
<a href="#l21.671"></a><span id="l21.671" class="difflineplus">+              firstTabInfo.mode.tabs.push(firstTabInfo);</span>
<a href="#l21.672"></a><span id="l21.672" class="difflineplus">+              this.tabInfo[0] = this.currentTabInfo = firstTabInfo;</span>
<a href="#l21.673"></a><span id="l21.673" class="difflineplus">+              this.setTabTitle(firstTabInfo);</span>
<a href="#l21.674"></a><span id="l21.674" class="difflineplus">+              if (this.tabMonitors.length)</span>
<a href="#l21.675"></a><span id="l21.675" class="difflineplus">+              {</span>
<a href="#l21.676"></a><span id="l21.676" class="difflineplus">+                for (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.677"></a><span id="l21.677" class="difflineplus">+                  tabMonitor.onTabSwitched(firstTabInfo, null);</span>
<a href="#l21.678"></a><span id="l21.678" class="difflineplus">+              }</span>
<a href="#l21.679"></a><span id="l21.679">             }</span>
<a href="#l21.680"></a><span id="l21.680">           ]]&gt;</span>
<a href="#l21.681"></a><span id="l21.681">         &lt;/body&gt;</span>
<a href="#l21.682"></a><span id="l21.682">       &lt;/method&gt;</span>
<a href="#l21.683"></a><span id="l21.683" class="difflineminus">-      &lt;method name=&quot;removeTabByNode&quot;&gt;</span>
<a href="#l21.684"></a><span id="l21.684" class="difflineminus">-        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l21.685"></a><span id="l21.685" class="difflineplus">+</span>
<a href="#l21.686"></a><span id="l21.686" class="difflineplus">+      &lt;method name=&quot;openTab&quot;&gt;</span>
<a href="#l21.687"></a><span id="l21.687" class="difflineplus">+        &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l21.688"></a><span id="l21.688" class="difflineplus">+        &lt;!-- parameter name=&quot;aMoreParameters...&quot;/--&gt;</span>
<a href="#l21.689"></a><span id="l21.689">         &lt;body&gt;</span>
<a href="#l21.690"></a><span id="l21.690">           &lt;![CDATA[</span>
<a href="#l21.691"></a><span id="l21.691" class="difflineminus">-            // Find and locate the tab in our list.</span>
<a href="#l21.692"></a><span id="l21.692" class="difflineminus">-            let iTab, numTabs = this.tabContainer.childNodes.length;</span>
<a href="#l21.693"></a><span id="l21.693" class="difflineminus">-            for (iTab = 0; iTab &lt; numTabs; iTab++)</span>
<a href="#l21.694"></a><span id="l21.694" class="difflineminus">-              if (this.tabContainer.childNodes[iTab] == aTabNode)</span>
<a href="#l21.695"></a><span id="l21.695" class="difflineminus">-                break;</span>
<a href="#l21.696"></a><span id="l21.696" class="difflineminus">-            let tab = this.tabInfo[iTab];</span>
<a href="#l21.697"></a><span id="l21.697" class="difflineplus">+            if (!aTabModeName)</span>
<a href="#l21.698"></a><span id="l21.698" class="difflineplus">+              aTabModeName = this.currentTabInfo.mode.type;</span>
<a href="#l21.699"></a><span id="l21.699"> </span>
<a href="#l21.700"></a><span id="l21.700" class="difflineminus">-            if (!tab.canClose)</span>
<a href="#l21.701"></a><span id="l21.701" class="difflineplus">+            let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l21.702"></a><span id="l21.702" class="difflineplus">+            // if we are already at our limit for this mode, show an existing one</span>
<a href="#l21.703"></a><span id="l21.703" class="difflineplus">+            if (tabMode.tabs.length == tabMode.maxTabs)</span>
<a href="#l21.704"></a><span id="l21.704" class="difflineplus">+            {</span>
<a href="#l21.705"></a><span id="l21.705" class="difflineplus">+              // show the first tab of this mode</span>
<a href="#l21.706"></a><span id="l21.706" class="difflineplus">+              this.tabContainer.selectedIndex = this.tabInfo.indexOf(tabMode.tabs[0]);</span>
<a href="#l21.707"></a><span id="l21.707">               return;</span>
<a href="#l21.708"></a><span id="l21.708" class="difflineminus">-            </span>
<a href="#l21.709"></a><span id="l21.709" class="difflineminus">-            let closeFunc = tab.mode.closeTab || tab.mode.tabType.closeTab;</span>
<a href="#l21.710"></a><span id="l21.710" class="difflineminus">-            closeFunc.call(tab.mode.tabType, tab);</span>
<a href="#l21.711"></a><span id="l21.711" class="difflineminus">-             </span>
<a href="#l21.712"></a><span id="l21.712" class="difflineminus">-            this.tabInfo.splice(iTab, 1);</span>
<a href="#l21.713"></a><span id="l21.713" class="difflineminus">-            tab.mode.tabs.splice(tab.mode.tabs.indexOf(tab), 1);</span>
<a href="#l21.714"></a><span id="l21.714" class="difflineminus">-            this.tabContainer.removeChild(aTabNode);</span>
<a href="#l21.715"></a><span id="l21.715" class="difflineminus">-            if (this.tabContainer.selectedIndex == -1)</span>
<a href="#l21.716"></a><span id="l21.716" class="difflineminus">-              this.tabContainer.selectedIndex = (iTab == --numTabs) ?</span>
<a href="#l21.717"></a><span id="l21.717" class="difflineminus">-                iTab - 1 : iTab;</span>
<a href="#l21.718"></a><span id="l21.718" class="difflineminus">-            if (this.currentTabInfo == tab)</span>
<a href="#l21.719"></a><span id="l21.719" class="difflineminus">-              this.updateCurrentTab();</span>
<a href="#l21.720"></a><span id="l21.720" class="difflineminus">-              </span>
<a href="#l21.721"></a><span id="l21.721" class="difflineminus">-            if (tab.panel) {</span>
<a href="#l21.722"></a><span id="l21.722" class="difflineminus">-              this.panelContainer.removeChild(tab.panel);</span>
<a href="#l21.723"></a><span id="l21.723" class="difflineminus">-              delete tab.panel;</span>
<a href="#l21.724"></a><span id="l21.724" class="difflineplus">+            }</span>
<a href="#l21.725"></a><span id="l21.725" class="difflineplus">+</span>
<a href="#l21.726"></a><span id="l21.726" class="difflineplus">+            // If the mode wants us to, we should switch to an existing tab</span>
<a href="#l21.727"></a><span id="l21.727" class="difflineplus">+            // rather than open a new one.</span>
<a href="#l21.728"></a><span id="l21.728" class="difflineplus">+            let shouldSwitchToFunc = tabMode.shouldSwitchTo ||</span>
<a href="#l21.729"></a><span id="l21.729" class="difflineplus">+                                     tabMode.tabType.shouldSwitchTo;</span>
<a href="#l21.730"></a><span id="l21.730" class="difflineplus">+</span>
<a href="#l21.731"></a><span id="l21.731" class="difflineplus">+            if (shouldSwitchToFunc)</span>
<a href="#l21.732"></a><span id="l21.732" class="difflineplus">+            {</span>
<a href="#l21.733"></a><span id="l21.733" class="difflineplus">+              let args = Array.prototype.slice.call(arguments, 1);</span>
<a href="#l21.734"></a><span id="l21.734" class="difflineplus">+              let tabIndex = shouldSwitchToFunc.apply(tabMode.tabType, args);</span>
<a href="#l21.735"></a><span id="l21.735" class="difflineplus">+              if (tabIndex &gt;= 0)</span>
<a href="#l21.736"></a><span id="l21.736" class="difflineplus">+              {</span>
<a href="#l21.737"></a><span id="l21.737" class="difflineplus">+                this.selectTabByIndex(tabIndex);</span>
<a href="#l21.738"></a><span id="l21.738" class="difflineplus">+                return;</span>
<a href="#l21.739"></a><span id="l21.739" class="difflineplus">+              }</span>
<a href="#l21.740"></a><span id="l21.740">             }</span>
<a href="#l21.741"></a><span id="l21.741" class="difflineminus">-            if (numTabs == 1 &amp;&amp; this.tabContainer.mAutoHide)</span>
<a href="#l21.742"></a><span id="l21.742" class="difflineminus">-              this.tabContainer.collapsed = true;</span>
<a href="#l21.743"></a><span id="l21.743" class="difflineminus">-          ]]&gt;</span>
<a href="#l21.744"></a><span id="l21.744" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l21.745"></a><span id="l21.745" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.746"></a><span id="l21.746" class="difflineminus">-      &lt;!-- getBrowserForSelectedTab is required as some toolkit functions</span>
<a href="#l21.747"></a><span id="l21.747" class="difflineminus">-           require a getBrowser() function. --&gt;</span>
<a href="#l21.748"></a><span id="l21.748" class="difflineminus">-      &lt;method name=&quot;getBrowserForSelectedTab&quot;&gt;</span>
<a href="#l21.749"></a><span id="l21.749" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.750"></a><span id="l21.750" class="difflineminus">-          if (!this.currentTabInfo)</span>
<a href="#l21.751"></a><span id="l21.751" class="difflineminus">-            this.currentTabInfo = this.tabInfo[0];</span>
<a href="#l21.752"></a><span id="l21.752" class="difflineplus">+</span>
<a href="#l21.753"></a><span id="l21.753" class="difflineplus">+            // we need to save the state before it gets corrupted</span>
<a href="#l21.754"></a><span id="l21.754" class="difflineplus">+            this.saveCurrentTabState();</span>
<a href="#l21.755"></a><span id="l21.755" class="difflineplus">+</span>
<a href="#l21.756"></a><span id="l21.756" class="difflineplus">+            let tabInfo = {mode: tabMode, canClose: true};</span>
<a href="#l21.757"></a><span id="l21.757" class="difflineplus">+            tabMode.tabs.push(tabInfo);</span>
<a href="#l21.758"></a><span id="l21.758"> </span>
<a href="#l21.759"></a><span id="l21.759" class="difflineminus">-          let tab = this.currentTabInfo;</span>
<a href="#l21.760"></a><span id="l21.760" class="difflineplus">+            let t = document.createElementNS(</span>
<a href="#l21.761"></a><span id="l21.761" class="difflineplus">+              &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l21.762"></a><span id="l21.762" class="difflineplus">+              &quot;tab&quot;);</span>
<a href="#l21.763"></a><span id="l21.763" class="difflineplus">+            t.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l21.764"></a><span id="l21.764" class="difflineplus">+            t.maxWidth = this.tabContainer.mTabMaxWidth;</span>
<a href="#l21.765"></a><span id="l21.765" class="difflineplus">+            t.minWidth = this.tabContainer.mTabMinWidth;</span>
<a href="#l21.766"></a><span id="l21.766" class="difflineplus">+            t.width = 0;</span>
<a href="#l21.767"></a><span id="l21.767" class="difflineplus">+            t.setAttribute(&quot;flex&quot;, &quot;100&quot;);</span>
<a href="#l21.768"></a><span id="l21.768" class="difflineplus">+            t.setAttribute(&quot;validate&quot;, &quot;never&quot;);</span>
<a href="#l21.769"></a><span id="l21.769" class="difflineplus">+            t.className = &quot;tabbrowser-tab tabmail-tab&quot;;</span>
<a href="#l21.770"></a><span id="l21.770" class="difflineplus">+            // for styling purposes, apply the type to the tab</span>
<a href="#l21.771"></a><span id="l21.771" class="difflineplus">+            // (this attribute may be overwritten by mode functions)</span>
<a href="#l21.772"></a><span id="l21.772" class="difflineplus">+            t.setAttribute(&quot;type&quot;, tabInfo.mode.type);</span>
<a href="#l21.773"></a><span id="l21.773" class="difflineplus">+            this.tabContainer.appendChild(t);</span>
<a href="#l21.774"></a><span id="l21.774" class="difflineplus">+            if (!this.mStripVisible)</span>
<a href="#l21.775"></a><span id="l21.775" class="difflineplus">+            {</span>
<a href="#l21.776"></a><span id="l21.776" class="difflineplus">+              this.mStripVisible = true;</span>
<a href="#l21.777"></a><span id="l21.777" class="difflineplus">+              this.tabContainer.adjustTabstrip();</span>
<a href="#l21.778"></a><span id="l21.778" class="difflineplus">+            }</span>
<a href="#l21.779"></a><span id="l21.779" class="difflineplus">+</span>
<a href="#l21.780"></a><span id="l21.780" class="difflineplus">+            // Open new tabs in the background?</span>
<a href="#l21.781"></a><span id="l21.781" class="difflineplus">+            let switchToNewTab = !this.mPrefs.getBoolPref(&quot;browser.tabs.loadInBackground&quot;);</span>
<a href="#l21.782"></a><span id="l21.782" class="difflineplus">+            tabInfo.switchToNewTab = switchToNewTab;</span>
<a href="#l21.783"></a><span id="l21.783"> </span>
<a href="#l21.784"></a><span id="l21.784" class="difflineminus">-          let browserFunc = tab.mode.getBrowser || tab.mode.tabType.getBrowser;</span>
<a href="#l21.785"></a><span id="l21.785" class="difflineminus">-          if (browserFunc)</span>
<a href="#l21.786"></a><span id="l21.786" class="difflineminus">-            return browserFunc.call(tab.mode.tabType, tab);</span>
<a href="#l21.787"></a><span id="l21.787" class="difflineplus">+            // the order of the following statements is important</span>
<a href="#l21.788"></a><span id="l21.788" class="difflineplus">+            let oldTabInfo = this.currentTabInfo;</span>
<a href="#l21.789"></a><span id="l21.789" class="difflineplus">+            this.tabInfo[this.tabContainer.childNodes.length - 1] = tabInfo;</span>
<a href="#l21.790"></a><span id="l21.790"> </span>
<a href="#l21.791"></a><span id="l21.791" class="difflineminus">-          return null;</span>
<a href="#l21.792"></a><span id="l21.792" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.793"></a><span id="l21.793" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.794"></a><span id="l21.794" class="difflineminus">-      &lt;method name=&quot;removeCurrentTab&quot;&gt;</span>
<a href="#l21.795"></a><span id="l21.795" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.796"></a><span id="l21.796" class="difflineminus">-          this.removeTabByNode(</span>
<a href="#l21.797"></a><span id="l21.797" class="difflineminus">-            this.tabContainer.childNodes[this.tabContainer.selectedIndex]);</span>
<a href="#l21.798"></a><span id="l21.798" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.799"></a><span id="l21.799" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.800"></a><span id="l21.800" class="difflineminus">-      &lt;!--  UpdateCurrentTab - called in response to changing the current tab --&gt;</span>
<a href="#l21.801"></a><span id="l21.801" class="difflineminus">-      &lt;method name=&quot;updateCurrentTab&quot;&gt;</span>
<a href="#l21.802"></a><span id="l21.802" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l21.803"></a><span id="l21.803" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l21.804"></a><span id="l21.804" class="difflineminus">-            if (this.currentTabInfo != this.tabInfo[this.tabContainer.selectedIndex])</span>
<a href="#l21.805"></a><span id="l21.805" class="difflineplus">+            if (switchToNewTab)</span>
<a href="#l21.806"></a><span id="l21.806" class="difflineplus">+            {</span>
<a href="#l21.807"></a><span id="l21.807" class="difflineplus">+              this.currentTabInfo = tabInfo;</span>
<a href="#l21.808"></a><span id="l21.808" class="difflineplus">+              // this has a side effect of calling updateCurrentTab, but our</span>
<a href="#l21.809"></a><span id="l21.809" class="difflineplus">+              // setting currentTabInfo above will cause it to take no action.</span>
<a href="#l21.810"></a><span id="l21.810" class="difflineplus">+              this.tabContainer.selectedIndex = this.tabContainer.childNodes.length - 1;</span>
<a href="#l21.811"></a><span id="l21.811" class="difflineplus">+            }</span>
<a href="#l21.812"></a><span id="l21.812" class="difflineplus">+            // make sure we are on the right panel</span>
<a href="#l21.813"></a><span id="l21.813" class="difflineplus">+            let selectedPanel;</span>
<a href="#l21.814"></a><span id="l21.814" class="difflineplus">+            if (tabInfo.mode.tabType.perTabPanel)</span>
<a href="#l21.815"></a><span id="l21.815" class="difflineplus">+            {</span>
<a href="#l21.816"></a><span id="l21.816" class="difflineplus">+              // should we create the element for them, or will they do it?</span>
<a href="#l21.817"></a><span id="l21.817" class="difflineplus">+              if (typeof(tabInfo.mode.tabType.perTabPanel) == &quot;string&quot;)</span>
<a href="#l21.818"></a><span id="l21.818" class="difflineplus">+              {</span>
<a href="#l21.819"></a><span id="l21.819" class="difflineplus">+                tabInfo.panel = document.createElementNS(</span>
<a href="#l21.820"></a><span id="l21.820" class="difflineplus">+                  &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l21.821"></a><span id="l21.821" class="difflineplus">+                  tabInfo.mode.tabType.perTabPanel);</span>
<a href="#l21.822"></a><span id="l21.822" class="difflineplus">+              }</span>
<a href="#l21.823"></a><span id="l21.823" class="difflineplus">+              else</span>
<a href="#l21.824"></a><span id="l21.824" class="difflineplus">+              {</span>
<a href="#l21.825"></a><span id="l21.825" class="difflineplus">+                tabInfo.panel = tabInfo.mode.tabType.perTabPanel(tabInfo);</span>
<a href="#l21.826"></a><span id="l21.826" class="difflineplus">+              }</span>
<a href="#l21.827"></a><span id="l21.827" class="difflineplus">+              this.panelContainer.appendChild(tabInfo.panel);</span>
<a href="#l21.828"></a><span id="l21.828" class="difflineplus">+              selectedPanel = tabInfo.panel;</span>
<a href="#l21.829"></a><span id="l21.829" class="difflineplus">+            }</span>
<a href="#l21.830"></a><span id="l21.830" class="difflineplus">+            else</span>
<a href="#l21.831"></a><span id="l21.831">             {</span>
<a href="#l21.832"></a><span id="l21.832" class="difflineminus">-              if (this.currentTabInfo)</span>
<a href="#l21.833"></a><span id="l21.833" class="difflineminus">-                this.saveCurrentTabState();</span>
<a href="#l21.834"></a><span id="l21.834" class="difflineminus">-              </span>
<a href="#l21.835"></a><span id="l21.835" class="difflineminus">-              let oldTab = this.currentTabInfo;</span>
<a href="#l21.836"></a><span id="l21.836" class="difflineminus">-              let tab = this.currentTabInfo =</span>
<a href="#l21.837"></a><span id="l21.837" class="difflineminus">-                this.tabInfo[this.tabContainer.selectedIndex];</span>
<a href="#l21.838"></a><span id="l21.838" class="difflineplus">+              selectedPanel = tabInfo.mode.tabType.panel;</span>
<a href="#l21.839"></a><span id="l21.839" class="difflineplus">+            }</span>
<a href="#l21.840"></a><span id="l21.840" class="difflineplus">+            if (switchToNewTab)</span>
<a href="#l21.841"></a><span id="l21.841" class="difflineplus">+              this.panelContainer.selectedPanel = selectedPanel;</span>
<a href="#l21.842"></a><span id="l21.842"> </span>
<a href="#l21.843"></a><span id="l21.843" class="difflineminus">-              this.panelContainer.selectedPanel = tab.panel ||</span>
<a href="#l21.844"></a><span id="l21.844" class="difflineminus">-                                                  tab.mode.tabType.panel;</span>
<a href="#l21.845"></a><span id="l21.845" class="difflineplus">+            let tabOpenFunc = tabInfo.mode.openTab ||</span>
<a href="#l21.846"></a><span id="l21.846" class="difflineplus">+                              tabInfo.mode.tabType.openTab;</span>
<a href="#l21.847"></a><span id="l21.847" class="difflineplus">+            let args = [tabInfo].concat(Array.prototype.slice.call(arguments, 1));</span>
<a href="#l21.848"></a><span id="l21.848" class="difflineplus">+            if (tabOpenFunc)</span>
<a href="#l21.849"></a><span id="l21.849" class="difflineplus">+              tabOpenFunc.apply(tabInfo.mode.tabType, args);</span>
<a href="#l21.850"></a><span id="l21.850"> </span>
<a href="#l21.851"></a><span id="l21.851" class="difflineminus">-              let showTabFunc = tab.mode.showTab || tab.mode.tabType.showTab;</span>
<a href="#l21.852"></a><span id="l21.852" class="difflineminus">-              showTabFunc.call(tab.mode.tabType, tab);</span>
<a href="#l21.853"></a><span id="l21.853" class="difflineplus">+            if (!switchToNewTab)</span>
<a href="#l21.854"></a><span id="l21.854" class="difflineplus">+            {</span>
<a href="#l21.855"></a><span id="l21.855" class="difflineplus">+              // if the new tab isn't made current,</span>
<a href="#l21.856"></a><span id="l21.856" class="difflineplus">+              // its title won't change automatically</span>
<a href="#l21.857"></a><span id="l21.857" class="difflineplus">+              this.setTabTitle(tabInfo);</span>
<a href="#l21.858"></a><span id="l21.858" class="difflineplus">+            }</span>
<a href="#l21.859"></a><span id="l21.859"> </span>
<a href="#l21.860"></a><span id="l21.860" class="difflineminus">-              if (this.tabMonitors.length) {</span>
<a href="#l21.861"></a><span id="l21.861" class="difflineminus">-                for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.862"></a><span id="l21.862" class="difflineminus">-                  tabMonitor.onTabSwitched(tab, oldTab);</span>
<a href="#l21.863"></a><span id="l21.863" class="difflineminus">-              }</span>
<a href="#l21.864"></a><span id="l21.864" class="difflineplus">+            if (this.tabMonitors.length)</span>
<a href="#l21.865"></a><span id="l21.865" class="difflineplus">+            {</span>
<a href="#l21.866"></a><span id="l21.866" class="difflineplus">+              if (switchToNewTab)</span>
<a href="#l21.867"></a><span id="l21.867" class="difflineplus">+                for (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.868"></a><span id="l21.868" class="difflineplus">+                  tabMonitor.onTabSwitched(tabInfo, oldTabInfo);</span>
<a href="#l21.869"></a><span id="l21.869" class="difflineplus">+            }</span>
<a href="#l21.870"></a><span id="l21.870"> </span>
<a href="#l21.871"></a><span id="l21.871" class="difflineminus">-</span>
<a href="#l21.872"></a><span id="l21.872" class="difflineminus">-              let docTitle = tab.title;</span>
<a href="#l21.873"></a><span id="l21.873" class="difflineminus">-#ifndef XP_MACOSX</span>
<a href="#l21.874"></a><span id="l21.874" class="difflineminus">-              docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l21.875"></a><span id="l21.875" class="difflineminus">-#endif</span>
<a href="#l21.876"></a><span id="l21.876" class="difflineplus">+            t.setAttribute(&quot;label&quot;, tabInfo.title);</span>
<a href="#l21.877"></a><span id="l21.877" class="difflineplus">+            if (switchToNewTab)</span>
<a href="#l21.878"></a><span id="l21.878" class="difflineplus">+            {</span>
<a href="#l21.879"></a><span id="l21.879" class="difflineplus">+              let docTitle = tabInfo.title;</span>
<a href="#l21.880"></a><span id="l21.880" class="difflineplus">+              if (!/Mac/.test(navigator.platform))</span>
<a href="#l21.881"></a><span id="l21.881" class="difflineplus">+                docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l21.882"></a><span id="l21.882">               document.title = docTitle;</span>
<a href="#l21.883"></a><span id="l21.883"> </span>
<a href="#l21.884"></a><span id="l21.884">               // Update the toolbar status - we don't need to do menus as they</span>
<a href="#l21.885"></a><span id="l21.885">               // do themselves when we open them.</span>
<a href="#l21.886"></a><span id="l21.886">               UpdateMailToolbar(&quot;tabmail&quot;);</span>
<a href="#l21.887"></a><span id="l21.887">             }</span>
<a href="#l21.888"></a><span id="l21.888">           ]]&gt;</span>
<a href="#l21.889"></a><span id="l21.889">         &lt;/body&gt;</span>
<a href="#l21.890"></a><span id="l21.890">       &lt;/method&gt;</span>
<a href="#l21.891"></a><span id="l21.891" class="difflineplus">+</span>
<a href="#l21.892"></a><span id="l21.892" class="difflineplus">+      &lt;method name=&quot;selectTabByMode&quot;&gt;</span>
<a href="#l21.893"></a><span id="l21.893" class="difflineplus">+        &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l21.894"></a><span id="l21.894" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.895"></a><span id="l21.895" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.896"></a><span id="l21.896" class="difflineplus">+            let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l21.897"></a><span id="l21.897" class="difflineplus">+            if (tabMode.tabs.length)</span>
<a href="#l21.898"></a><span id="l21.898" class="difflineplus">+            {</span>
<a href="#l21.899"></a><span id="l21.899" class="difflineplus">+              let desiredTab = tabMode.tabs[0];</span>
<a href="#l21.900"></a><span id="l21.900" class="difflineplus">+              this.tabContainer.selectedIndex = this.tabInfo.indexOf(desiredTab);</span>
<a href="#l21.901"></a><span id="l21.901" class="difflineplus">+            }</span>
<a href="#l21.902"></a><span id="l21.902" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.903"></a><span id="l21.903" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.904"></a><span id="l21.904" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.905"></a><span id="l21.905" class="difflineplus">+</span>
<a href="#l21.906"></a><span id="l21.906" class="difflineplus">+      &lt;method name=&quot;selectTabByIndex&quot;&gt;</span>
<a href="#l21.907"></a><span id="l21.907" class="difflineplus">+        &lt;parameter name=&quot;aIndex&quot;/&gt;</span>
<a href="#l21.908"></a><span id="l21.908" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.909"></a><span id="l21.909" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.910"></a><span id="l21.910" class="difflineplus">+            // count backwards for aIndex &lt; 0</span>
<a href="#l21.911"></a><span id="l21.911" class="difflineplus">+            if (aIndex &lt; 0)</span>
<a href="#l21.912"></a><span id="l21.912" class="difflineplus">+              aIndex += this.tabInfo.length;</span>
<a href="#l21.913"></a><span id="l21.913" class="difflineplus">+            if (aIndex &gt;= 0 &amp;&amp;</span>
<a href="#l21.914"></a><span id="l21.914" class="difflineplus">+                aIndex &lt; this.tabInfo.length &amp;&amp;</span>
<a href="#l21.915"></a><span id="l21.915" class="difflineplus">+                aIndex != this.tabContainer.selectedIndex)</span>
<a href="#l21.916"></a><span id="l21.916" class="difflineplus">+            {</span>
<a href="#l21.917"></a><span id="l21.917" class="difflineplus">+              this.tabContainer.selectedIndex = aIndex;</span>
<a href="#l21.918"></a><span id="l21.918" class="difflineplus">+            }</span>
<a href="#l21.919"></a><span id="l21.919" class="difflineplus">+</span>
<a href="#l21.920"></a><span id="l21.920" class="difflineplus">+            if (aEvent)</span>
<a href="#l21.921"></a><span id="l21.921" class="difflineplus">+            {</span>
<a href="#l21.922"></a><span id="l21.922" class="difflineplus">+              aEvent.preventDefault();</span>
<a href="#l21.923"></a><span id="l21.923" class="difflineplus">+              aEvent.stopPropagation();</span>
<a href="#l21.924"></a><span id="l21.924" class="difflineplus">+            }</span>
<a href="#l21.925"></a><span id="l21.925" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.926"></a><span id="l21.926" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.927"></a><span id="l21.927" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.928"></a><span id="l21.928" class="difflineplus">+</span>
<a href="#l21.929"></a><span id="l21.929" class="difflineplus">+      &lt;method name=&quot;closeTabs&quot;&gt;</span>
<a href="#l21.930"></a><span id="l21.930" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.931"></a><span id="l21.931" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.932"></a><span id="l21.932" class="difflineplus">+            for (let i = 0; i &lt; this.tabInfo.length; i++)</span>
<a href="#l21.933"></a><span id="l21.933" class="difflineplus">+            {</span>
<a href="#l21.934"></a><span id="l21.934" class="difflineplus">+              let tabInfo = this.tabInfo[i];</span>
<a href="#l21.935"></a><span id="l21.935" class="difflineplus">+              let tabCloseFunc = tabInfo.mode.closeTab ||</span>
<a href="#l21.936"></a><span id="l21.936" class="difflineplus">+                                 tabInfo.mode.tabType.closeTab;</span>
<a href="#l21.937"></a><span id="l21.937" class="difflineplus">+              if (tabCloseFunc)</span>
<a href="#l21.938"></a><span id="l21.938" class="difflineplus">+                tabCloseFunc.call(tabInfo.mode.tabType, tabInfo);</span>
<a href="#l21.939"></a><span id="l21.939" class="difflineplus">+            }</span>
<a href="#l21.940"></a><span id="l21.940" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.941"></a><span id="l21.941" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.942"></a><span id="l21.942" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.943"></a><span id="l21.943" class="difflineplus">+</span>
<a href="#l21.944"></a><span id="l21.944" class="difflineplus">+      &lt;method name=&quot;removeTab&quot;&gt;</span>
<a href="#l21.945"></a><span id="l21.945" class="difflineplus">+        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l21.946"></a><span id="l21.946" class="difflineplus">+        &lt;!-- parameter name=&quot;aMoreParameters...&quot;/--&gt;</span>
<a href="#l21.947"></a><span id="l21.947" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.948"></a><span id="l21.948" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.949"></a><span id="l21.949" class="difflineplus">+            // Find and locate the tab in our list.</span>
<a href="#l21.950"></a><span id="l21.950" class="difflineplus">+            let iTab, numTabs = this.tabContainer.childNodes.length;</span>
<a href="#l21.951"></a><span id="l21.951" class="difflineplus">+            for (iTab = 0; iTab &lt; numTabs; iTab++)</span>
<a href="#l21.952"></a><span id="l21.952" class="difflineplus">+              if (this.tabContainer.childNodes[iTab] == aTabNode)</span>
<a href="#l21.953"></a><span id="l21.953" class="difflineplus">+                break;</span>
<a href="#l21.954"></a><span id="l21.954" class="difflineplus">+            let tabInfo = this.tabInfo[iTab];</span>
<a href="#l21.955"></a><span id="l21.955" class="difflineplus">+</span>
<a href="#l21.956"></a><span id="l21.956" class="difflineplus">+            // ask the tab type implementation if we're allowed to close the tab</span>
<a href="#l21.957"></a><span id="l21.957" class="difflineplus">+            let canClose = tabInfo.canClose;</span>
<a href="#l21.958"></a><span id="l21.958" class="difflineplus">+            let canCloseFunc = tabInfo.mode.canCloseTab ||</span>
<a href="#l21.959"></a><span id="l21.959" class="difflineplus">+                               tabInfo.mode.tabType.canCloseTab;</span>
<a href="#l21.960"></a><span id="l21.960" class="difflineplus">+            if (canCloseFunc)</span>
<a href="#l21.961"></a><span id="l21.961" class="difflineplus">+              canClose = canCloseFunc.call(tabInfo.mode.tabType, tabInfo);</span>
<a href="#l21.962"></a><span id="l21.962" class="difflineplus">+            if (!canClose)</span>
<a href="#l21.963"></a><span id="l21.963" class="difflineplus">+              return;</span>
<a href="#l21.964"></a><span id="l21.964" class="difflineplus">+</span>
<a href="#l21.965"></a><span id="l21.965" class="difflineplus">+            let closeFunc = tabInfo.mode.closeTab ||</span>
<a href="#l21.966"></a><span id="l21.966" class="difflineplus">+                            tabInfo.mode.tabType.closeTab;</span>
<a href="#l21.967"></a><span id="l21.967" class="difflineplus">+            if (closeFunc)</span>
<a href="#l21.968"></a><span id="l21.968" class="difflineplus">+              closeFunc.call(tabInfo.mode.tabType, tabInfo);</span>
<a href="#l21.969"></a><span id="l21.969" class="difflineplus">+</span>
<a href="#l21.970"></a><span id="l21.970" class="difflineplus">+            this.tabInfo.splice(iTab, 1);</span>
<a href="#l21.971"></a><span id="l21.971" class="difflineplus">+            tabInfo.mode.tabs.splice(tabInfo.mode.tabs.indexOf(tabInfo), 1);</span>
<a href="#l21.972"></a><span id="l21.972" class="difflineplus">+            this.tabContainer.removeChild(aTabNode);</span>
<a href="#l21.973"></a><span id="l21.973" class="difflineplus">+            if (this.tabContainer.selectedIndex == -1)</span>
<a href="#l21.974"></a><span id="l21.974" class="difflineplus">+              this.tabContainer.selectedIndex = (iTab == --numTabs) ? iTab - 1 : iTab;</span>
<a href="#l21.975"></a><span id="l21.975" class="difflineplus">+            if (this.currentTabInfo == tabInfo)</span>
<a href="#l21.976"></a><span id="l21.976" class="difflineplus">+              this.updateCurrentTab();</span>
<a href="#l21.977"></a><span id="l21.977" class="difflineplus">+</span>
<a href="#l21.978"></a><span id="l21.978" class="difflineplus">+            if (tabInfo.panel)</span>
<a href="#l21.979"></a><span id="l21.979" class="difflineplus">+            {</span>
<a href="#l21.980"></a><span id="l21.980" class="difflineplus">+              this.panelContainer.removeChild(tabInfo.panel);</span>
<a href="#l21.981"></a><span id="l21.981" class="difflineplus">+              delete tabInfo.panel;</span>
<a href="#l21.982"></a><span id="l21.982" class="difflineplus">+            }</span>
<a href="#l21.983"></a><span id="l21.983" class="difflineplus">+            if (numTabs == 1 &amp;&amp; this.mAutoHide)</span>
<a href="#l21.984"></a><span id="l21.984" class="difflineplus">+              this.mStripVisible = false;</span>
<a href="#l21.985"></a><span id="l21.985" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.986"></a><span id="l21.986" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.987"></a><span id="l21.987" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.988"></a><span id="l21.988" class="difflineplus">+</span>
<a href="#l21.989"></a><span id="l21.989" class="difflineplus">+      &lt;method name=&quot;removeCurrentTab&quot;&gt;</span>
<a href="#l21.990"></a><span id="l21.990" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.991"></a><span id="l21.991" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.992"></a><span id="l21.992" class="difflineplus">+            this.removeTab(this.tabContainer.selectedItem);</span>
<a href="#l21.993"></a><span id="l21.993" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.994"></a><span id="l21.994" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.995"></a><span id="l21.995" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.996"></a><span id="l21.996" class="difflineplus">+</span>
<a href="#l21.997"></a><span id="l21.997" class="difflineplus">+      &lt;!--  UpdateCurrentTab - called in response to changing the current tab --&gt;</span>
<a href="#l21.998"></a><span id="l21.998" class="difflineplus">+      &lt;method name=&quot;updateCurrentTab&quot;&gt;</span>
<a href="#l21.999"></a><span id="l21.999" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1000"></a><span id="l21.1000" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1001"></a><span id="l21.1001" class="difflineplus">+            if (this.currentTabInfo != this.tabInfo[this.tabContainer.selectedIndex])</span>
<a href="#l21.1002"></a><span id="l21.1002" class="difflineplus">+            {</span>
<a href="#l21.1003"></a><span id="l21.1003" class="difflineplus">+              if (this.currentTabInfo)</span>
<a href="#l21.1004"></a><span id="l21.1004" class="difflineplus">+                this.saveCurrentTabState();</span>
<a href="#l21.1005"></a><span id="l21.1005" class="difflineplus">+              let oldTabInfo = this.currentTabInfo;</span>
<a href="#l21.1006"></a><span id="l21.1006" class="difflineplus">+              let tabInfo = this.currentTabInfo = this.tabInfo[this.tabContainer.selectedIndex];</span>
<a href="#l21.1007"></a><span id="l21.1007" class="difflineplus">+              this.panelContainer.selectedPanel = tabInfo.panel ||</span>
<a href="#l21.1008"></a><span id="l21.1008" class="difflineplus">+                                                  tabInfo.mode.tabType.panel;</span>
<a href="#l21.1009"></a><span id="l21.1009" class="difflineplus">+              let showTabFunc = tabInfo.mode.showTab ||</span>
<a href="#l21.1010"></a><span id="l21.1010" class="difflineplus">+                                tabInfo.mode.tabType.showTab;</span>
<a href="#l21.1011"></a><span id="l21.1011" class="difflineplus">+              if (showTabFunc)</span>
<a href="#l21.1012"></a><span id="l21.1012" class="difflineplus">+                showTabFunc.call(tabInfo.mode.tabType, tabInfo);</span>
<a href="#l21.1013"></a><span id="l21.1013" class="difflineplus">+              if (this.tabMonitors.length)</span>
<a href="#l21.1014"></a><span id="l21.1014" class="difflineplus">+              {</span>
<a href="#l21.1015"></a><span id="l21.1015" class="difflineplus">+                for (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.1016"></a><span id="l21.1016" class="difflineplus">+                  tabMonitor.onTabSwitched(tabInfo, oldTabInfo);</span>
<a href="#l21.1017"></a><span id="l21.1017" class="difflineplus">+              }</span>
<a href="#l21.1018"></a><span id="l21.1018" class="difflineplus">+</span>
<a href="#l21.1019"></a><span id="l21.1019" class="difflineplus">+              let docTitle = tabInfo.title;</span>
<a href="#l21.1020"></a><span id="l21.1020" class="difflineplus">+              if (!/Mac/.test(navigator.platform))</span>
<a href="#l21.1021"></a><span id="l21.1021" class="difflineplus">+                docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l21.1022"></a><span id="l21.1022" class="difflineplus">+              document.title = docTitle;</span>
<a href="#l21.1023"></a><span id="l21.1023" class="difflineplus">+</span>
<a href="#l21.1024"></a><span id="l21.1024" class="difflineplus">+              // Update the toolbar status - we don't need to do menus as they</span>
<a href="#l21.1025"></a><span id="l21.1025" class="difflineplus">+              // do themselves when we open them.</span>
<a href="#l21.1026"></a><span id="l21.1026" class="difflineplus">+              UpdateMailToolbar(&quot;tabmail&quot;);</span>
<a href="#l21.1027"></a><span id="l21.1027" class="difflineplus">+            }</span>
<a href="#l21.1028"></a><span id="l21.1028" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1029"></a><span id="l21.1029" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1030"></a><span id="l21.1030" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.1031"></a><span id="l21.1031" class="difflineplus">+</span>
<a href="#l21.1032"></a><span id="l21.1032" class="difflineplus">+      &lt;method name=&quot;saveTabState&quot;&gt;</span>
<a href="#l21.1033"></a><span id="l21.1033" class="difflineplus">+        &lt;parameter name=&quot;aTabInfo&quot;/&gt;</span>
<a href="#l21.1034"></a><span id="l21.1034" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1035"></a><span id="l21.1035" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1036"></a><span id="l21.1036" class="difflineplus">+            if (!aTabInfo)</span>
<a href="#l21.1037"></a><span id="l21.1037" class="difflineplus">+              return;</span>
<a href="#l21.1038"></a><span id="l21.1038" class="difflineplus">+            let saveTabFunc = aTabInfo.mode.saveTabState ||</span>
<a href="#l21.1039"></a><span id="l21.1039" class="difflineplus">+                              aTabInfo.mode.tabType.saveTabState;</span>
<a href="#l21.1040"></a><span id="l21.1040" class="difflineplus">+            if (saveTabFunc)</span>
<a href="#l21.1041"></a><span id="l21.1041" class="difflineplus">+              saveTabFunc.call(aTabInfo.mode.tabType, aTabInfo);</span>
<a href="#l21.1042"></a><span id="l21.1042" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1043"></a><span id="l21.1043" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1044"></a><span id="l21.1044" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.1045"></a><span id="l21.1045" class="difflineplus">+</span>
<a href="#l21.1046"></a><span id="l21.1046">       &lt;method name=&quot;saveCurrentTabState&quot;&gt;</span>
<a href="#l21.1047"></a><span id="l21.1047">         &lt;body&gt;</span>
<a href="#l21.1048"></a><span id="l21.1048">           &lt;![CDATA[</span>
<a href="#l21.1049"></a><span id="l21.1049">             if (!this.currentTabInfo)</span>
<a href="#l21.1050"></a><span id="l21.1050">               this.currentTabInfo = this.tabInfo[0];</span>
<a href="#l21.1051"></a><span id="l21.1051" class="difflineminus">-            let tab = this.currentTabInfo;</span>
<a href="#l21.1052"></a><span id="l21.1052" class="difflineminus">-            </span>
<a href="#l21.1053"></a><span id="l21.1053">             // save the old tab state before we change the current tab</span>
<a href="#l21.1054"></a><span id="l21.1054" class="difflineminus">-            let saveTabFunc = tab.mode.saveTabState ||</span>
<a href="#l21.1055"></a><span id="l21.1055" class="difflineminus">-                              tab.mode.tabType.saveTabState;</span>
<a href="#l21.1056"></a><span id="l21.1056" class="difflineminus">-            saveTabFunc.call(tab.mode.tabType, tab);</span>
<a href="#l21.1057"></a><span id="l21.1057" class="difflineplus">+            this.saveTabState(this.currentTabInfo);</span>
<a href="#l21.1058"></a><span id="l21.1058">           ]]&gt;</span>
<a href="#l21.1059"></a><span id="l21.1059">         &lt;/body&gt;</span>
<a href="#l21.1060"></a><span id="l21.1060">       &lt;/method&gt;</span>
<a href="#l21.1061"></a><span id="l21.1061" class="difflineplus">+</span>
<a href="#l21.1062"></a><span id="l21.1062">       &lt;method name=&quot;onTabClick&quot;&gt;</span>
<a href="#l21.1063"></a><span id="l21.1063">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l21.1064"></a><span id="l21.1064">         &lt;body&gt;</span>
<a href="#l21.1065"></a><span id="l21.1065">           &lt;![CDATA[</span>
<a href="#l21.1066"></a><span id="l21.1066">             // a middle mouse button click on a tab is a short cut for closing a tab</span>
<a href="#l21.1067"></a><span id="l21.1067" class="difflineminus">-            if (event.button != 1 || event.target.localName != 'tab')</span>
<a href="#l21.1068"></a><span id="l21.1068" class="difflineplus">+            if (event.button != 1 || event.target.localName != &quot;tab&quot;)</span>
<a href="#l21.1069"></a><span id="l21.1069">               return;</span>
<a href="#l21.1070"></a><span id="l21.1070" class="difflineminus">-            this.removeTabByNode(event.target);</span>
<a href="#l21.1071"></a><span id="l21.1071" class="difflineplus">+            this.removeTab(event.target);</span>
<a href="#l21.1072"></a><span id="l21.1072">             event.stopPropagation();</span>
<a href="#l21.1073"></a><span id="l21.1073">           ]]&gt;</span>
<a href="#l21.1074"></a><span id="l21.1074">         &lt;/body&gt;</span>
<a href="#l21.1075"></a><span id="l21.1075">       &lt;/method&gt;</span>
<a href="#l21.1076"></a><span id="l21.1076" class="difflineplus">+</span>
<a href="#l21.1077"></a><span id="l21.1077">       &lt;method name=&quot;setTabTitle&quot;&gt;</span>
<a href="#l21.1078"></a><span id="l21.1078" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l21.1079"></a><span id="l21.1079" class="difflineplus">+        &lt;parameter name=&quot;aTabInfo&quot;/&gt;</span>
<a href="#l21.1080"></a><span id="l21.1080">         &lt;body&gt;</span>
<a href="#l21.1081"></a><span id="l21.1081">           &lt;![CDATA[</span>
<a href="#l21.1082"></a><span id="l21.1082">             // First find the tab and its index.</span>
<a href="#l21.1083"></a><span id="l21.1083" class="difflineminus">-            let tab;</span>
<a href="#l21.1084"></a><span id="l21.1084" class="difflineplus">+            let tabInfo;</span>
<a href="#l21.1085"></a><span id="l21.1085">             let index;</span>
<a href="#l21.1086"></a><span id="l21.1086" class="difflineminus">-            if (aTab) {</span>
<a href="#l21.1087"></a><span id="l21.1087" class="difflineminus">-              tab = aTab;</span>
<a href="#l21.1088"></a><span id="l21.1088" class="difflineminus">-              for (index = 0; index &lt; this.tabInfo.length; ++index) {</span>
<a href="#l21.1089"></a><span id="l21.1089" class="difflineminus">-                if (tab == this.tabInfo[index])</span>
<a href="#l21.1090"></a><span id="l21.1090" class="difflineplus">+            if (aTabInfo)</span>
<a href="#l21.1091"></a><span id="l21.1091" class="difflineplus">+            {</span>
<a href="#l21.1092"></a><span id="l21.1092" class="difflineplus">+              tabInfo = aTabInfo;</span>
<a href="#l21.1093"></a><span id="l21.1093" class="difflineplus">+              for (index = 0; index &lt; this.tabInfo.length; ++index)</span>
<a href="#l21.1094"></a><span id="l21.1094" class="difflineplus">+              {</span>
<a href="#l21.1095"></a><span id="l21.1095" class="difflineplus">+                if (tabInfo == this.tabInfo[index])</span>
<a href="#l21.1096"></a><span id="l21.1096">                   break;</span>
<a href="#l21.1097"></a><span id="l21.1097">               }</span>
<a href="#l21.1098"></a><span id="l21.1098">             }</span>
<a href="#l21.1099"></a><span id="l21.1099" class="difflineminus">-            else {</span>
<a href="#l21.1100"></a><span id="l21.1100" class="difflineplus">+            else</span>
<a href="#l21.1101"></a><span id="l21.1101" class="difflineplus">+            {</span>
<a href="#l21.1102"></a><span id="l21.1102">               index = this.tabContainer.selectedIndex;</span>
<a href="#l21.1103"></a><span id="l21.1103" class="difflineminus">-              tab = this.tabInfo[index];</span>
<a href="#l21.1104"></a><span id="l21.1104" class="difflineplus">+              tabInfo = this.tabInfo[index];</span>
<a href="#l21.1105"></a><span id="l21.1105">             }</span>
<a href="#l21.1106"></a><span id="l21.1106"> </span>
<a href="#l21.1107"></a><span id="l21.1107" class="difflineminus">-            // on startup, we may not have a tab...</span>
<a href="#l21.1108"></a><span id="l21.1108" class="difflineminus">-            if (tab)</span>
<a href="#l21.1109"></a><span id="l21.1109" class="difflineplus">+            if (tabInfo)</span>
<a href="#l21.1110"></a><span id="l21.1110">             {</span>
<a href="#l21.1111"></a><span id="l21.1111" class="difflineminus">-              let tabNode =</span>
<a href="#l21.1112"></a><span id="l21.1112" class="difflineminus">-                this.tabContainer.childNodes[index];</span>
<a href="#l21.1113"></a><span id="l21.1113" class="difflineminus">-</span>
<a href="#l21.1114"></a><span id="l21.1114" class="difflineminus">-              let titleChangeFunc = tab.mode.onTitleChanged ||</span>
<a href="#l21.1115"></a><span id="l21.1115" class="difflineminus">-                                    tab.mode.tabType.onTitleChanged;</span>
<a href="#l21.1116"></a><span id="l21.1116" class="difflineplus">+              let tabNode = this.tabContainer.childNodes[index];</span>
<a href="#l21.1117"></a><span id="l21.1117" class="difflineplus">+              let titleChangeFunc = tabInfo.mode.onTitleChanged ||</span>
<a href="#l21.1118"></a><span id="l21.1118" class="difflineplus">+                                    tabInfo.mode.tabType.onTitleChanged;</span>
<a href="#l21.1119"></a><span id="l21.1119">               if (titleChangeFunc)</span>
<a href="#l21.1120"></a><span id="l21.1120" class="difflineminus">-                titleChangeFunc.call(tab.mode.tabType, tab, tabNode);</span>
<a href="#l21.1121"></a><span id="l21.1121" class="difflineminus">-</span>
<a href="#l21.1122"></a><span id="l21.1122" class="difflineminus">-              if (this.tabMonitors.length) {</span>
<a href="#l21.1123"></a><span id="l21.1123" class="difflineminus">-                for each (let [index, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.1124"></a><span id="l21.1124" class="difflineminus">-                  tabMonitor.onTabTitleChanged(tab);</span>
<a href="#l21.1125"></a><span id="l21.1125" class="difflineplus">+                titleChangeFunc.call(tabInfo.mode.tabType, tabInfo, tabNode);</span>
<a href="#l21.1126"></a><span id="l21.1126" class="difflineplus">+              if (this.tabMonitors.length)</span>
<a href="#l21.1127"></a><span id="l21.1127" class="difflineplus">+              {</span>
<a href="#l21.1128"></a><span id="l21.1128" class="difflineplus">+                for (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l21.1129"></a><span id="l21.1129" class="difflineplus">+                  tabMonitor.onTabTitleChanged(tabInfo);</span>
<a href="#l21.1130"></a><span id="l21.1130">               }</span>
<a href="#l21.1131"></a><span id="l21.1131" class="difflineminus">-</span>
<a href="#l21.1132"></a><span id="l21.1132" class="difflineminus">-              tabNode.setAttribute(&quot;label&quot;, tab.title);</span>
<a href="#l21.1133"></a><span id="l21.1133" class="difflineplus">+              tabNode.setAttribute(&quot;label&quot;, tabInfo.title);</span>
<a href="#l21.1134"></a><span id="l21.1134"> </span>
<a href="#l21.1135"></a><span id="l21.1135">               // Update the window title if we're the displayed tab.</span>
<a href="#l21.1136"></a><span id="l21.1136" class="difflineminus">-              if (index == this.tabContainer.selectedIndex) {</span>
<a href="#l21.1137"></a><span id="l21.1137" class="difflineminus">-                let docTitle = tab.title;</span>
<a href="#l21.1138"></a><span id="l21.1138" class="difflineminus">-#ifndef XP_MACOSX</span>
<a href="#l21.1139"></a><span id="l21.1139" class="difflineminus">-                docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l21.1140"></a><span id="l21.1140" class="difflineminus">-#endif</span>
<a href="#l21.1141"></a><span id="l21.1141" class="difflineplus">+              if (index == this.tabContainer.selectedIndex)</span>
<a href="#l21.1142"></a><span id="l21.1142" class="difflineplus">+              {</span>
<a href="#l21.1143"></a><span id="l21.1143" class="difflineplus">+                let docTitle = tabInfo.title;</span>
<a href="#l21.1144"></a><span id="l21.1144" class="difflineplus">+                if (!/Mac/.test(navigator.platform))</span>
<a href="#l21.1145"></a><span id="l21.1145" class="difflineplus">+                  docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l21.1146"></a><span id="l21.1146">                 document.title = docTitle;</span>
<a href="#l21.1147"></a><span id="l21.1147" class="difflineplus">+</span>
<a href="#l21.1148"></a><span id="l21.1148" class="difflineplus">+                // Update the toolbar status - we don't need to do menus as they</span>
<a href="#l21.1149"></a><span id="l21.1149" class="difflineplus">+                // do themselves when we open them.</span>
<a href="#l21.1150"></a><span id="l21.1150" class="difflineplus">+                UpdateMailToolbar(&quot;tabmail&quot;);</span>
<a href="#l21.1151"></a><span id="l21.1151">               }</span>
<a href="#l21.1152"></a><span id="l21.1152">             }</span>
<a href="#l21.1153"></a><span id="l21.1153">           ]]&gt;</span>
<a href="#l21.1154"></a><span id="l21.1154">         &lt;/body&gt;</span>
<a href="#l21.1155"></a><span id="l21.1155">       &lt;/method&gt;</span>
<a href="#l21.1156"></a><span id="l21.1156" class="difflineminus">-      &lt;method name=&quot;onTabContextMenuShowing&quot;&gt;</span>
<a href="#l21.1157"></a><span id="l21.1157" class="difflineminus">-        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l21.1158"></a><span id="l21.1158" class="difflineplus">+</span>
<a href="#l21.1159"></a><span id="l21.1159" class="difflineplus">+      &lt;method name=&quot;FillTabmailTooltip&quot;&gt;</span>
<a href="#l21.1160"></a><span id="l21.1160" class="difflineplus">+        &lt;parameter name=&quot;aDocument&quot;/&gt;</span>
<a href="#l21.1161"></a><span id="l21.1161" class="difflineplus">+        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.1162"></a><span id="l21.1162">         &lt;body&gt;</span>
<a href="#l21.1163"></a><span id="l21.1163">           &lt;![CDATA[</span>
<a href="#l21.1164"></a><span id="l21.1164" class="difflineminus">-            // To determine whether the 'Close Tab' context menu should be</span>
<a href="#l21.1165"></a><span id="l21.1165" class="difflineminus">-            // visible according to the tab node that was being clicked on.</span>
<a href="#l21.1166"></a><span id="l21.1166" class="difflineminus">-            // If the tab node is not closable, the context menu should not</span>
<a href="#l21.1167"></a><span id="l21.1167" class="difflineminus">-            // be shown.</span>
<a href="#l21.1168"></a><span id="l21.1168" class="difflineminus">-            if (aTabNode.localName != &quot;tab&quot;)</span>
<a href="#l21.1169"></a><span id="l21.1169" class="difflineminus">-              return false;</span>
<a href="#l21.1170"></a><span id="l21.1170" class="difflineminus">-</span>
<a href="#l21.1171"></a><span id="l21.1171" class="difflineminus">-            for (let iTab = 0; iTab &lt; this.tabContainer.childNodes.length; iTab++) {</span>
<a href="#l21.1172"></a><span id="l21.1172" class="difflineminus">-              if (this.tabContainer.childNodes[iTab] == aTabNode)</span>
<a href="#l21.1173"></a><span id="l21.1173" class="difflineminus">-                return this.tabInfo[iTab].canClose;</span>
<a href="#l21.1174"></a><span id="l21.1174" class="difflineplus">+            aEvent.stopPropagation();</span>
<a href="#l21.1175"></a><span id="l21.1175" class="difflineplus">+            let tn = aDocument.tooltipNode;</span>
<a href="#l21.1176"></a><span id="l21.1176" class="difflineplus">+            if (tn.localName != &quot;tab&quot;)</span>
<a href="#l21.1177"></a><span id="l21.1177" class="difflineplus">+              return false; // Not a tab, so cancel the tooltip.</span>
<a href="#l21.1178"></a><span id="l21.1178" class="difflineplus">+            if (tn.hasAttribute(&quot;label&quot;))</span>
<a href="#l21.1179"></a><span id="l21.1179" class="difflineplus">+            {</span>
<a href="#l21.1180"></a><span id="l21.1180" class="difflineplus">+              aEvent.target.setAttribute(&quot;label&quot;, tn.getAttribute(&quot;label&quot;));</span>
<a href="#l21.1181"></a><span id="l21.1181" class="difflineplus">+              return true;</span>
<a href="#l21.1182"></a><span id="l21.1182">             }</span>
<a href="#l21.1183"></a><span id="l21.1183">             return false;</span>
<a href="#l21.1184"></a><span id="l21.1184">           ]]&gt;</span>
<a href="#l21.1185"></a><span id="l21.1185">         &lt;/body&gt;</span>
<a href="#l21.1186"></a><span id="l21.1186">       &lt;/method&gt;</span>
<a href="#l21.1187"></a><span id="l21.1187" class="difflineplus">+</span>
<a href="#l21.1188"></a><span id="l21.1188" class="difflineplus">+      &lt;!-- getBrowserForSelectedTab is required as some toolkit functions</span>
<a href="#l21.1189"></a><span id="l21.1189" class="difflineplus">+           require a getBrowser() function. --&gt;</span>
<a href="#l21.1190"></a><span id="l21.1190" class="difflineplus">+      &lt;method name=&quot;getBrowserForSelectedTab&quot;&gt;</span>
<a href="#l21.1191"></a><span id="l21.1191" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1192"></a><span id="l21.1192" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1193"></a><span id="l21.1193" class="difflineplus">+            if (!this.currentTabInfo)</span>
<a href="#l21.1194"></a><span id="l21.1194" class="difflineplus">+              this.currentTabInfo = this.tabInfo[0];</span>
<a href="#l21.1195"></a><span id="l21.1195" class="difflineplus">+            let tabInfo = this.currentTabInfo;</span>
<a href="#l21.1196"></a><span id="l21.1196" class="difflineplus">+            let browserFunc = tabInfo.mode.getBrowser ||</span>
<a href="#l21.1197"></a><span id="l21.1197" class="difflineplus">+                              tabInfo.mode.tabType.getBrowser;</span>
<a href="#l21.1198"></a><span id="l21.1198" class="difflineplus">+            if (!browserFunc)</span>
<a href="#l21.1199"></a><span id="l21.1199" class="difflineplus">+              return null;</span>
<a href="#l21.1200"></a><span id="l21.1200" class="difflineplus">+            return browserFunc.call(tabInfo.mode.tabType, tabInfo);</span>
<a href="#l21.1201"></a><span id="l21.1201" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1202"></a><span id="l21.1202" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1203"></a><span id="l21.1203" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.1204"></a><span id="l21.1204" class="difflineplus">+</span>
<a href="#l21.1205"></a><span id="l21.1205" class="difflineplus">+      &lt;!-- nsIObserver implementation --&gt;</span>
<a href="#l21.1206"></a><span id="l21.1206" class="difflineplus">+</span>
<a href="#l21.1207"></a><span id="l21.1207" class="difflineplus">+      &lt;method name=&quot;observe&quot;&gt;</span>
<a href="#l21.1208"></a><span id="l21.1208" class="difflineplus">+        &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l21.1209"></a><span id="l21.1209" class="difflineplus">+        &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l21.1210"></a><span id="l21.1210" class="difflineplus">+        &lt;parameter name=&quot;aData&quot;/&gt;</span>
<a href="#l21.1211"></a><span id="l21.1211" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1212"></a><span id="l21.1212" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1213"></a><span id="l21.1213" class="difflineplus">+            const kAutoHide = &quot;browser.tabs.autoHide&quot;;</span>
<a href="#l21.1214"></a><span id="l21.1214" class="difflineplus">+            if (aTopic == &quot;nsPref:changed&quot; &amp;&amp; aData == kAutoHide)</span>
<a href="#l21.1215"></a><span id="l21.1215" class="difflineplus">+              this.mAutoHide = this.mPrefs.getBoolPref(kAutoHide);</span>
<a href="#l21.1216"></a><span id="l21.1216" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1217"></a><span id="l21.1217" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1218"></a><span id="l21.1218" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.1219"></a><span id="l21.1219" class="difflineplus">+</span>
<a href="#l21.1220"></a><span id="l21.1220" class="difflineplus">+      &lt;!-- nsIController implementation --&gt;</span>
<a href="#l21.1221"></a><span id="l21.1221" class="difflineplus">+</span>
<a href="#l21.1222"></a><span id="l21.1222">       &lt;method name=&quot;supportsCommand&quot;&gt;</span>
<a href="#l21.1223"></a><span id="l21.1223">         &lt;parameter name=&quot;aCommand&quot;/&gt;</span>
<a href="#l21.1224"></a><span id="l21.1224">         &lt;body&gt;</span>
<a href="#l21.1225"></a><span id="l21.1225" class="difflineminus">-           &lt;![CDATA[</span>
<a href="#l21.1226"></a><span id="l21.1226" class="difflineminus">-             let tab = this.currentTabInfo;</span>
<a href="#l21.1227"></a><span id="l21.1227" class="difflineminus">-</span>
<a href="#l21.1228"></a><span id="l21.1228" class="difflineminus">-             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l21.1229"></a><span id="l21.1229" class="difflineminus">-             // loaded yet.</span>
<a href="#l21.1230"></a><span id="l21.1230" class="difflineminus">-             if (!tab)</span>
<a href="#l21.1231"></a><span id="l21.1231" class="difflineminus">-               return false;</span>
<a href="#l21.1232"></a><span id="l21.1232" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1233"></a><span id="l21.1233" class="difflineplus">+            // return early on startup when we haven't got a tab loaded yet</span>
<a href="#l21.1234"></a><span id="l21.1234" class="difflineplus">+            let tabInfo = this.currentTabInfo;</span>
<a href="#l21.1235"></a><span id="l21.1235" class="difflineplus">+            if (!tabInfo)</span>
<a href="#l21.1236"></a><span id="l21.1236" class="difflineplus">+              return false;</span>
<a href="#l21.1237"></a><span id="l21.1237"> </span>
<a href="#l21.1238"></a><span id="l21.1238" class="difflineminus">-             let supportsCommandFunc = tab.mode.supportsCommand ||</span>
<a href="#l21.1239"></a><span id="l21.1239" class="difflineminus">-                                       tab.mode.tabType.supportsCommand;</span>
<a href="#l21.1240"></a><span id="l21.1240" class="difflineminus">-             if (supportsCommandFunc)</span>
<a href="#l21.1241"></a><span id="l21.1241" class="difflineminus">-               return supportsCommandFunc.call(tab.mode.tabType, tab, aCommand);</span>
<a href="#l21.1242"></a><span id="l21.1242" class="difflineminus">-</span>
<a href="#l21.1243"></a><span id="l21.1243" class="difflineminus">-             return false;</span>
<a href="#l21.1244"></a><span id="l21.1244" class="difflineminus">-           ]]&gt;</span>
<a href="#l21.1245"></a><span id="l21.1245" class="difflineplus">+            let supportsCommandFunc = tabInfo.mode.supportsCommand ||</span>
<a href="#l21.1246"></a><span id="l21.1246" class="difflineplus">+                                      tabInfo.mode.tabType.supportsCommand;</span>
<a href="#l21.1247"></a><span id="l21.1247" class="difflineplus">+            if (!supportsCommandFunc)</span>
<a href="#l21.1248"></a><span id="l21.1248" class="difflineplus">+              return false;</span>
<a href="#l21.1249"></a><span id="l21.1249" class="difflineplus">+            return supportsCommandFunc.call(tabInfo.mode.tabType,</span>
<a href="#l21.1250"></a><span id="l21.1250" class="difflineplus">+                                            aCommand,</span>
<a href="#l21.1251"></a><span id="l21.1251" class="difflineplus">+                                            tabInfo);</span>
<a href="#l21.1252"></a><span id="l21.1252" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1253"></a><span id="l21.1253">         &lt;/body&gt;</span>
<a href="#l21.1254"></a><span id="l21.1254">       &lt;/method&gt;</span>
<a href="#l21.1255"></a><span id="l21.1255" class="difflineplus">+</span>
<a href="#l21.1256"></a><span id="l21.1256">       &lt;method name=&quot;isCommandEnabled&quot;&gt;</span>
<a href="#l21.1257"></a><span id="l21.1257">         &lt;parameter name=&quot;aCommand&quot;/&gt;</span>
<a href="#l21.1258"></a><span id="l21.1258">         &lt;body&gt;</span>
<a href="#l21.1259"></a><span id="l21.1259" class="difflineminus">-           &lt;![CDATA[</span>
<a href="#l21.1260"></a><span id="l21.1260" class="difflineminus">-             let tab = this.currentTabInfo;</span>
<a href="#l21.1261"></a><span id="l21.1261" class="difflineminus">-</span>
<a href="#l21.1262"></a><span id="l21.1262" class="difflineminus">-             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l21.1263"></a><span id="l21.1263" class="difflineminus">-             // loaded yet.</span>
<a href="#l21.1264"></a><span id="l21.1264" class="difflineminus">-             if (!tab)</span>
<a href="#l21.1265"></a><span id="l21.1265" class="difflineminus">-               return false;</span>
<a href="#l21.1266"></a><span id="l21.1266" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1267"></a><span id="l21.1267" class="difflineplus">+            // return early on startup when we haven't got a tab loaded yet</span>
<a href="#l21.1268"></a><span id="l21.1268" class="difflineplus">+            let tabInfo = this.currentTabInfo;</span>
<a href="#l21.1269"></a><span id="l21.1269" class="difflineplus">+            if (!tabInfo)</span>
<a href="#l21.1270"></a><span id="l21.1270" class="difflineplus">+              return false;</span>
<a href="#l21.1271"></a><span id="l21.1271"> </span>
<a href="#l21.1272"></a><span id="l21.1272" class="difflineminus">-             let isCommandEnabledFunc = tab.mode.isCommandEnabled ||</span>
<a href="#l21.1273"></a><span id="l21.1273" class="difflineminus">-                                        tab.mode.tabType.isCommandEnabled;</span>
<a href="#l21.1274"></a><span id="l21.1274" class="difflineminus">-             if (isCommandEnabledFunc)</span>
<a href="#l21.1275"></a><span id="l21.1275" class="difflineminus">-               return isCommandEnabledFunc.call(tab.mode.tabType, tab, aCommand);</span>
<a href="#l21.1276"></a><span id="l21.1276" class="difflineminus">-</span>
<a href="#l21.1277"></a><span id="l21.1277" class="difflineminus">-             return false;</span>
<a href="#l21.1278"></a><span id="l21.1278" class="difflineminus">-           ]]&gt;</span>
<a href="#l21.1279"></a><span id="l21.1279" class="difflineplus">+            let isCommandEnabledFunc = tabInfo.mode.isCommandEnabled ||</span>
<a href="#l21.1280"></a><span id="l21.1280" class="difflineplus">+                                       tabInfo.mode.tabType.isCommandEnabled;</span>
<a href="#l21.1281"></a><span id="l21.1281" class="difflineplus">+            if (!isCommandEnabledFunc)</span>
<a href="#l21.1282"></a><span id="l21.1282" class="difflineplus">+              return false;</span>
<a href="#l21.1283"></a><span id="l21.1283" class="difflineplus">+            return isCommandEnabledFunc.call(tabInfo.mode.tabType,</span>
<a href="#l21.1284"></a><span id="l21.1284" class="difflineplus">+                                             aCommand,</span>
<a href="#l21.1285"></a><span id="l21.1285" class="difflineplus">+                                             tabInfo);</span>
<a href="#l21.1286"></a><span id="l21.1286" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1287"></a><span id="l21.1287">         &lt;/body&gt;</span>
<a href="#l21.1288"></a><span id="l21.1288">       &lt;/method&gt;</span>
<a href="#l21.1289"></a><span id="l21.1289" class="difflineplus">+</span>
<a href="#l21.1290"></a><span id="l21.1290">       &lt;method name=&quot;doCommand&quot;&gt;</span>
<a href="#l21.1291"></a><span id="l21.1291">         &lt;parameter name=&quot;aCommand&quot;/&gt;</span>
<a href="#l21.1292"></a><span id="l21.1292">         &lt;body&gt;</span>
<a href="#l21.1293"></a><span id="l21.1293" class="difflineminus">-           &lt;![CDATA[</span>
<a href="#l21.1294"></a><span id="l21.1294" class="difflineminus">-             let tab = this.currentTabInfo;</span>
<a href="#l21.1295"></a><span id="l21.1295" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1296"></a><span id="l21.1296" class="difflineplus">+            // return early on startup when we haven't got a tab loaded yet</span>
<a href="#l21.1297"></a><span id="l21.1297" class="difflineplus">+            let tabInfo = this.currentTabInfo;</span>
<a href="#l21.1298"></a><span id="l21.1298" class="difflineplus">+            if (!tabInfo)</span>
<a href="#l21.1299"></a><span id="l21.1299" class="difflineplus">+              return;</span>
<a href="#l21.1300"></a><span id="l21.1300"> </span>
<a href="#l21.1301"></a><span id="l21.1301" class="difflineminus">-             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l21.1302"></a><span id="l21.1302" class="difflineminus">-             // loaded yet.</span>
<a href="#l21.1303"></a><span id="l21.1303" class="difflineminus">-             if (!tab)</span>
<a href="#l21.1304"></a><span id="l21.1304" class="difflineminus">-               return;</span>
<a href="#l21.1305"></a><span id="l21.1305" class="difflineminus">-</span>
<a href="#l21.1306"></a><span id="l21.1306" class="difflineminus">-             let doCommandFunc = tab.mode.doCommand ||</span>
<a href="#l21.1307"></a><span id="l21.1307" class="difflineminus">-                                 tab.mode.tabType.doCommand;</span>
<a href="#l21.1308"></a><span id="l21.1308" class="difflineminus">-             if (doCommandFunc)</span>
<a href="#l21.1309"></a><span id="l21.1309" class="difflineminus">-               doCommandFunc.call(tab.mode.tabType, tab, aCommand);</span>
<a href="#l21.1310"></a><span id="l21.1310" class="difflineplus">+            let doCommandFunc = tabInfo.mode.doCommand ||</span>
<a href="#l21.1311"></a><span id="l21.1311" class="difflineplus">+                                tabInfo.mode.tabType.doCommand;</span>
<a href="#l21.1312"></a><span id="l21.1312" class="difflineplus">+            if (!doCommandFunc)</span>
<a href="#l21.1313"></a><span id="l21.1313" class="difflineplus">+              return;</span>
<a href="#l21.1314"></a><span id="l21.1314" class="difflineplus">+            doCommandFunc.call(tabInfo.mode.tabType,</span>
<a href="#l21.1315"></a><span id="l21.1315" class="difflineplus">+                               aCommand,</span>
<a href="#l21.1316"></a><span id="l21.1316" class="difflineplus">+                               tabInfo);</span>
<a href="#l21.1317"></a><span id="l21.1317">            ]]&gt;</span>
<a href="#l21.1318"></a><span id="l21.1318">         &lt;/body&gt;</span>
<a href="#l21.1319"></a><span id="l21.1319">       &lt;/method&gt;</span>
<a href="#l21.1320"></a><span id="l21.1320" class="difflineplus">+</span>
<a href="#l21.1321"></a><span id="l21.1321">       &lt;method name=&quot;onEvent&quot;&gt;</span>
<a href="#l21.1322"></a><span id="l21.1322">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.1323"></a><span id="l21.1323">         &lt;body&gt;</span>
<a href="#l21.1324"></a><span id="l21.1324" class="difflineminus">-           &lt;![CDATA[</span>
<a href="#l21.1325"></a><span id="l21.1325" class="difflineminus">-             let tab = this.currentTabInfo;</span>
<a href="#l21.1326"></a><span id="l21.1326" class="difflineminus">-</span>
<a href="#l21.1327"></a><span id="l21.1327" class="difflineminus">-             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l21.1328"></a><span id="l21.1328" class="difflineminus">-             // loaded yet.</span>
<a href="#l21.1329"></a><span id="l21.1329" class="difflineminus">-             if (!tab)</span>
<a href="#l21.1330"></a><span id="l21.1330" class="difflineminus">-               return;</span>
<a href="#l21.1331"></a><span id="l21.1331" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1332"></a><span id="l21.1332" class="difflineplus">+            // return early on startup when we haven't got a tab loaded yet</span>
<a href="#l21.1333"></a><span id="l21.1333" class="difflineplus">+            let tabInfo = this.currentTabInfo;</span>
<a href="#l21.1334"></a><span id="l21.1334" class="difflineplus">+            if (!ttabInfo)</span>
<a href="#l21.1335"></a><span id="l21.1335" class="difflineplus">+              return;</span>
<a href="#l21.1336"></a><span id="l21.1336"> </span>
<a href="#l21.1337"></a><span id="l21.1337" class="difflineminus">-             let onEventFunc = tab.mode.onEvent ||</span>
<a href="#l21.1338"></a><span id="l21.1338" class="difflineminus">-                               tab.mode.tabType.onEvent;</span>
<a href="#l21.1339"></a><span id="l21.1339" class="difflineminus">-             if (onEventFunc)</span>
<a href="#l21.1340"></a><span id="l21.1340" class="difflineminus">-               return onEventFunc.call(tab.mode.tabType, tab, aEvent);</span>
<a href="#l21.1341"></a><span id="l21.1341" class="difflineminus">-</span>
<a href="#l21.1342"></a><span id="l21.1342" class="difflineminus">-             return false;</span>
<a href="#l21.1343"></a><span id="l21.1343" class="difflineminus">-           ]]&gt;</span>
<a href="#l21.1344"></a><span id="l21.1344" class="difflineplus">+            let onEventFunc = tabInfo.mode.onEvent ||</span>
<a href="#l21.1345"></a><span id="l21.1345" class="difflineplus">+                              tabInfo.mode.tabType.onEvent;</span>
<a href="#l21.1346"></a><span id="l21.1346" class="difflineplus">+            if (!onEventFunc)</span>
<a href="#l21.1347"></a><span id="l21.1347" class="difflineplus">+              return;</span>
<a href="#l21.1348"></a><span id="l21.1348" class="difflineplus">+            return onEventFunc.call(tabInfo.mode.tabType,</span>
<a href="#l21.1349"></a><span id="l21.1349" class="difflineplus">+                                    aCommand,</span>
<a href="#l21.1350"></a><span id="l21.1350" class="difflineplus">+                                    tabInfo);</span>
<a href="#l21.1351"></a><span id="l21.1351" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1352"></a><span id="l21.1352">         &lt;/body&gt;</span>
<a href="#l21.1353"></a><span id="l21.1353">       &lt;/method&gt;</span>
<a href="#l21.1354"></a><span id="l21.1354">     &lt;/implementation&gt;</span>
<a href="#l21.1355"></a><span id="l21.1355">   &lt;/binding&gt;</span>
<a href="#l21.1356"></a><span id="l21.1356" class="difflineminus">-  </span>
<a href="#l21.1357"></a><span id="l21.1357" class="difflineminus">- &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l21.1358"></a><span id="l21.1358" class="difflineplus">+</span>
<a href="#l21.1359"></a><span id="l21.1359" class="difflineplus">+  &lt;binding id=&quot;tabmail-tab&quot;</span>
<a href="#l21.1360"></a><span id="l21.1360" class="difflineplus">+           display=&quot;xul:box&quot;</span>
<a href="#l21.1361"></a><span id="l21.1361">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tab&quot;&gt;</span>
<a href="#l21.1362"></a><span id="l21.1362">     &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l21.1363"></a><span id="l21.1363" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l21.1364"></a><span id="l21.1364" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-middle box-inherit&quot; xbl:inherits=&quot;align,dir,pack,orient,selected&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l21.1365"></a><span id="l21.1365" class="difflineplus">+             closetabtext=&quot;&amp;tabmailClose.label;&quot;&gt;</span>
<a href="#l21.1366"></a><span id="l21.1366" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-middle box-inherit&quot;</span>
<a href="#l21.1367"></a><span id="l21.1367" class="difflineplus">+                xbl:inherits=&quot;align,dir,pack,orient,selected&quot;</span>
<a href="#l21.1368"></a><span id="l21.1368" class="difflineplus">+                flex=&quot;1&quot;&gt;</span>
<a href="#l21.1369"></a><span id="l21.1369">         &lt;xul:image class=&quot;tab-icon&quot; xbl:inherits=&quot;validate,src=image&quot;/&gt;</span>
<a href="#l21.1370"></a><span id="l21.1370" class="difflineminus">-        &lt;xul:label class=&quot;tab-text&quot; xbl:inherits=&quot;value=label,accesskey,crop,disabled&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l21.1371"></a><span id="l21.1371" class="difflineplus">+        &lt;xul:label class=&quot;tab-text&quot;</span>
<a href="#l21.1372"></a><span id="l21.1372" class="difflineplus">+                   xbl:inherits=&quot;value=label,accesskey,crop,disabled&quot;</span>
<a href="#l21.1373"></a><span id="l21.1373" class="difflineplus">+                   flex=&quot;1&quot;/&gt;</span>
<a href="#l21.1374"></a><span id="l21.1374">       &lt;/xul:hbox&gt;</span>
<a href="#l21.1375"></a><span id="l21.1375" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; tabindex=&quot;-1&quot; class=&quot;tab-close-button&quot;/&gt;</span>
<a href="#l21.1376"></a><span id="l21.1376" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;close-button&quot;</span>
<a href="#l21.1377"></a><span id="l21.1377" class="difflineplus">+                         tooltiptext=&quot;&amp;tabmailClose.tooltip;&quot;</span>
<a href="#l21.1378"></a><span id="l21.1378" class="difflineplus">+                         tabindex=&quot;-1&quot;</span>
<a href="#l21.1379"></a><span id="l21.1379" class="difflineplus">+                         class=&quot;tabs-closebutton tab-close-button&quot;/&gt;</span>
<a href="#l21.1380"></a><span id="l21.1380">     &lt;/content&gt;</span>
<a href="#l21.1381"></a><span id="l21.1381"> </span>
<a href="#l21.1382"></a><span id="l21.1382">     &lt;implementation&gt;</span>
<a href="#l21.1383"></a><span id="l21.1383" class="difflineminus">-      &lt;field name=&quot;mOverCloseButton&quot;&gt;false&lt;/field&gt;</span>
<a href="#l21.1384"></a><span id="l21.1384">       &lt;field name=&quot;mCorrespondingMenuitem&quot;&gt;null&lt;/field&gt;</span>
<a href="#l21.1385"></a><span id="l21.1385">     &lt;/implementation&gt;</span>
<a href="#l21.1386"></a><span id="l21.1386" class="difflineminus">-</span>
<a href="#l21.1387"></a><span id="l21.1387" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l21.1388"></a><span id="l21.1388" class="difflineminus">-      &lt;handler event=&quot;mouseover&quot;&gt;</span>
<a href="#l21.1389"></a><span id="l21.1389" class="difflineminus">-        var anonid = event.originalTarget.getAttribute(&quot;anonid&quot;);</span>
<a href="#l21.1390"></a><span id="l21.1390" class="difflineminus">-        if (anonid == &quot;close-button&quot;)</span>
<a href="#l21.1391"></a><span id="l21.1391" class="difflineminus">-          this.mOverCloseButton = true;</span>
<a href="#l21.1392"></a><span id="l21.1392" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l21.1393"></a><span id="l21.1393" class="difflineminus">-      &lt;handler event=&quot;mouseout&quot;&gt;</span>
<a href="#l21.1394"></a><span id="l21.1394" class="difflineminus">-        var anonid = event.originalTarget.getAttribute(&quot;anonid&quot;);</span>
<a href="#l21.1395"></a><span id="l21.1395" class="difflineminus">-        if (anonid == &quot;close-button&quot;)</span>
<a href="#l21.1396"></a><span id="l21.1396" class="difflineminus">-          this.mOverCloseButton = false;</span>
<a href="#l21.1397"></a><span id="l21.1397" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l21.1398"></a><span id="l21.1398" class="difflineminus">-      &lt;handler event=&quot;mousedown&quot; button=&quot;0&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l21.1399"></a><span id="l21.1399" class="difflineminus">-      &lt;![CDATA[</span>
<a href="#l21.1400"></a><span id="l21.1400" class="difflineminus">-        if (this.mOverCloseButton)</span>
<a href="#l21.1401"></a><span id="l21.1401" class="difflineminus">-          event.stopPropagation();</span>
<a href="#l21.1402"></a><span id="l21.1402" class="difflineminus">-      ]]&gt;</span>
<a href="#l21.1403"></a><span id="l21.1403" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l21.1404"></a><span id="l21.1404" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l21.1405"></a><span id="l21.1405">   &lt;/binding&gt;</span>
<a href="#l21.1406"></a><span id="l21.1406"> </span>
<a href="#l21.1407"></a><span id="l21.1407" class="difflineminus">-  &lt;binding id=&quot;tabmail-arrowscrollbox&quot; extends=&quot;chrome://global/content/bindings/scrollbox.xml#arrowscrollbox-clicktoscroll&quot;&gt;</span>
<a href="#l21.1408"></a><span id="l21.1408" class="difflineplus">+  &lt;binding id=&quot;tabmail-arrowscrollbox&quot;</span>
<a href="#l21.1409"></a><span id="l21.1409" class="difflineplus">+           extends=&quot;chrome://global/content/bindings/scrollbox.xml#arrowscrollbox-clicktoscroll&quot;&gt;</span>
<a href="#l21.1410"></a><span id="l21.1410">     &lt;content&gt;</span>
<a href="#l21.1411"></a><span id="l21.1411" class="difflineminus">-      &lt;xul:toolbarbutton class=&quot;scrollbutton-up&quot; collapsed=&quot;true&quot;</span>
<a href="#l21.1412"></a><span id="l21.1412" class="difflineplus">+      &lt;xul:toolbarbutton class=&quot;scrollbutton-up&quot;</span>
<a href="#l21.1413"></a><span id="l21.1413" class="difflineplus">+                         collapsed=&quot;true&quot;</span>
<a href="#l21.1414"></a><span id="l21.1414">                          xbl:inherits=&quot;orient&quot;</span>
<a href="#l21.1415"></a><span id="l21.1415">                          anonid=&quot;scrollbutton-up&quot;</span>
<a href="#l21.1416"></a><span id="l21.1416">                          onmousedown=&quot;_startScroll(-1);&quot;</span>
<a href="#l21.1417"></a><span id="l21.1417">                          onmouseup=&quot;_stopScroll();&quot;</span>
<a href="#l21.1418"></a><span id="l21.1418">                          onmouseout=&quot;_stopScroll();&quot;</span>
<a href="#l21.1419"></a><span id="l21.1419">                          chromedir=&quot;&amp;locale.dir;&quot;/&gt;</span>
<a href="#l21.1420"></a><span id="l21.1420" class="difflineminus">-      &lt;xul:scrollbox xbl:inherits=&quot;orient,align,pack,dir&quot; flex=&quot;1&quot; anonid=&quot;scrollbox&quot;&gt;</span>
<a href="#l21.1421"></a><span id="l21.1421" class="difflineplus">+      &lt;xul:scrollbox xbl:inherits=&quot;orient,align,pack,dir&quot;</span>
<a href="#l21.1422"></a><span id="l21.1422" class="difflineplus">+                     flex=&quot;1&quot;</span>
<a href="#l21.1423"></a><span id="l21.1423" class="difflineplus">+                     anonid=&quot;scrollbox&quot;&gt;</span>
<a href="#l21.1424"></a><span id="l21.1424">         &lt;children/&gt;</span>
<a href="#l21.1425"></a><span id="l21.1425">       &lt;/xul:scrollbox&gt;</span>
<a href="#l21.1426"></a><span id="l21.1426">       &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; class=&quot;scrollbutton-down-stack&quot;&gt;</span>
<a href="#l21.1427"></a><span id="l21.1427" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;scrollbutton-down-box&quot; </span>
<a href="#l21.1428"></a><span id="l21.1428" class="difflineminus">-                           collapsed=&quot;true&quot; anonid=&quot;down-box&quot;/&gt;</span>
<a href="#l21.1429"></a><span id="l21.1429" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;scrollbutton-down-box-animate&quot; </span>
<a href="#l21.1430"></a><span id="l21.1430" class="difflineminus">-                           collapsed=&quot;true&quot; anonid=&quot;down-box-animate&quot;/&gt;</span>
<a href="#l21.1431"></a><span id="l21.1431" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;scrollbutton-down&quot; collapsed=&quot;true&quot;</span>
<a href="#l21.1432"></a><span id="l21.1432" class="difflineplus">+        &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l21.1433"></a><span id="l21.1433" class="difflineplus">+                  class=&quot;scrollbutton-down-box&quot;</span>
<a href="#l21.1434"></a><span id="l21.1434" class="difflineplus">+                  collapsed=&quot;true&quot;</span>
<a href="#l21.1435"></a><span id="l21.1435" class="difflineplus">+                  anonid=&quot;down-box&quot;/&gt;</span>
<a href="#l21.1436"></a><span id="l21.1436" class="difflineplus">+        &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l21.1437"></a><span id="l21.1437" class="difflineplus">+                  class=&quot;scrollbutton-down-box-animate&quot;</span>
<a href="#l21.1438"></a><span id="l21.1438" class="difflineplus">+                  collapsed=&quot;true&quot;</span>
<a href="#l21.1439"></a><span id="l21.1439" class="difflineplus">+                  anonid=&quot;down-box-animate&quot;/&gt;</span>
<a href="#l21.1440"></a><span id="l21.1440" class="difflineplus">+        &lt;xul:toolbarbutton class=&quot;scrollbutton-down&quot;</span>
<a href="#l21.1441"></a><span id="l21.1441" class="difflineplus">+                           collapsed=&quot;true&quot;</span>
<a href="#l21.1442"></a><span id="l21.1442">                            xbl:inherits=&quot;orient&quot;</span>
<a href="#l21.1443"></a><span id="l21.1443">                            anonid=&quot;scrollbutton-down&quot;</span>
<a href="#l21.1444"></a><span id="l21.1444">                            onmousedown=&quot;_startScroll(1);&quot;</span>
<a href="#l21.1445"></a><span id="l21.1445">                            onmouseup=&quot;_stopScroll();&quot;</span>
<a href="#l21.1446"></a><span id="l21.1446">                            onmouseout=&quot;_stopScroll();&quot;</span>
<a href="#l21.1447"></a><span id="l21.1447">                            chromedir=&quot;&amp;locale.dir;&quot;/&gt;</span>
<a href="#l21.1448"></a><span id="l21.1448">       &lt;/xul:stack&gt;</span>
<a href="#l21.1449"></a><span id="l21.1449">     &lt;/content&gt;</span>
<a href="#l21.1450"></a><span id="l21.1450" class="difflineplus">+</span>
<a href="#l21.1451"></a><span id="l21.1451">     &lt;implementation&gt;</span>
<a href="#l21.1452"></a><span id="l21.1452">       &lt;field name=&quot;_scrollButtonDownBox&quot;&gt;</span>
<a href="#l21.1453"></a><span id="l21.1453">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;down-box&quot;);</span>
<a href="#l21.1454"></a><span id="l21.1454">       &lt;/field&gt;</span>
<a href="#l21.1455"></a><span id="l21.1455">       &lt;field name=&quot;_scrollButtonDownBoxAnimate&quot;&gt;</span>
<a href="#l21.1456"></a><span id="l21.1456">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;down-box-animate&quot;);</span>
<a href="#l21.1457"></a><span id="l21.1457">       &lt;/field&gt;</span>
<a href="#l21.1458"></a><span id="l21.1458">     &lt;/implementation&gt;</span>
<a href="#l21.1459"></a><span id="l21.1459" class="difflineplus">+</span>
<a href="#l21.1460"></a><span id="l21.1460">     &lt;handlers&gt;</span>
<a href="#l21.1461"></a><span id="l21.1461" class="difflineminus">-      &lt;handler event=&quot;underflow&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.1462"></a><span id="l21.1462" class="difflineminus">-        // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l21.1463"></a><span id="l21.1463" class="difflineminus">-        if (event.target != this)</span>
<a href="#l21.1464"></a><span id="l21.1464" class="difflineminus">-          return;</span>
<a href="#l21.1465"></a><span id="l21.1465" class="difflineminus">-</span>
<a href="#l21.1466"></a><span id="l21.1466" class="difflineminus">-        // Ignore vertical events.</span>
<a href="#l21.1467"></a><span id="l21.1467" class="difflineminus">-        if (event.detail == 0) {</span>
<a href="#l21.1468"></a><span id="l21.1468" class="difflineminus">-          return;</span>
<a href="#l21.1469"></a><span id="l21.1469" class="difflineminus">-        }</span>
<a href="#l21.1470"></a><span id="l21.1470" class="difflineminus">-</span>
<a href="#l21.1471"></a><span id="l21.1471" class="difflineminus">-        this._scrollButtonDownBox.collapsed = true;</span>
<a href="#l21.1472"></a><span id="l21.1472" class="difflineminus">-        this._scrollButtonDownBoxAnimate.collapsed = true;</span>
<a href="#l21.1473"></a><span id="l21.1473" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.1474"></a><span id="l21.1474" class="difflineminus">-</span>
<a href="#l21.1475"></a><span id="l21.1475" class="difflineminus">-      &lt;handler event=&quot;overflow&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.1476"></a><span id="l21.1476" class="difflineminus">-        // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l21.1477"></a><span id="l21.1477" class="difflineminus">-        if (event.target != this)</span>
<a href="#l21.1478"></a><span id="l21.1478" class="difflineminus">-          return;</span>
<a href="#l21.1479"></a><span id="l21.1479" class="difflineplus">+      &lt;handler event=&quot;underflow&quot; phase=&quot;target&quot;&gt;</span>
<a href="#l21.1480"></a><span id="l21.1480" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.1481"></a><span id="l21.1481" class="difflineplus">+          // Ignore vertical events.</span>
<a href="#l21.1482"></a><span id="l21.1482" class="difflineplus">+          if (event.detail == 0)</span>
<a href="#l21.1483"></a><span id="l21.1483" class="difflineplus">+            return;</span>
<a href="#l21.1484"></a><span id="l21.1484" class="difflineplus">+          this._scrollButtonDownBox.collapsed = true;</span>
<a href="#l21.1485"></a><span id="l21.1485" class="difflineplus">+          this._scrollButtonDownBoxAnimate.collapsed = true;</span>
<a href="#l21.1486"></a><span id="l21.1486" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.1487"></a><span id="l21.1487" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.1488"></a><span id="l21.1488"> </span>
<a href="#l21.1489"></a><span id="l21.1489" class="difflineminus">-        // Ignore vertical events.</span>
<a href="#l21.1490"></a><span id="l21.1490" class="difflineminus">-        if (event.detail == 0) {</span>
<a href="#l21.1491"></a><span id="l21.1491" class="difflineminus">-          return;</span>
<a href="#l21.1492"></a><span id="l21.1492" class="difflineminus">-        }</span>
<a href="#l21.1493"></a><span id="l21.1493" class="difflineminus">-</span>
<a href="#l21.1494"></a><span id="l21.1494" class="difflineminus">-        this._scrollButtonDownBox.collapsed = false;</span>
<a href="#l21.1495"></a><span id="l21.1495" class="difflineminus">-        this._scrollButtonDownBoxAnimate.collapsed = false;</span>
<a href="#l21.1496"></a><span id="l21.1496" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.1497"></a><span id="l21.1497" class="difflineplus">+      &lt;handler event=&quot;overflow&quot; phase=&quot;target&quot;&gt;</span>
<a href="#l21.1498"></a><span id="l21.1498" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.1499"></a><span id="l21.1499" class="difflineplus">+          // Ignore vertical events.</span>
<a href="#l21.1500"></a><span id="l21.1500" class="difflineplus">+          if (event.detail == 0)</span>
<a href="#l21.1501"></a><span id="l21.1501" class="difflineplus">+            return;</span>
<a href="#l21.1502"></a><span id="l21.1502" class="difflineplus">+          this._scrollButtonDownBox.collapsed = false;</span>
<a href="#l21.1503"></a><span id="l21.1503" class="difflineplus">+          this._scrollButtonDownBoxAnimate.collapsed = false;</span>
<a href="#l21.1504"></a><span id="l21.1504" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.1505"></a><span id="l21.1505" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.1506"></a><span id="l21.1506"> </span>
<a href="#l21.1507"></a><span id="l21.1507" class="difflineminus">-      &lt;handler event=&quot;UpdatedScrollButtonsDisabledState&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.1508"></a><span id="l21.1508" class="difflineminus">-        // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l21.1509"></a><span id="l21.1509" class="difflineminus">-        if (event.target != this)</span>
<a href="#l21.1510"></a><span id="l21.1510" class="difflineminus">-          return;</span>
<a href="#l21.1511"></a><span id="l21.1511" class="difflineplus">+      &lt;handler event=&quot;UpdatedScrollButtonsDisabledState&quot;&gt;</span>
<a href="#l21.1512"></a><span id="l21.1512" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.1513"></a><span id="l21.1513" class="difflineplus">+          // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l21.1514"></a><span id="l21.1514" class="difflineplus">+          if (event.target != this)</span>
<a href="#l21.1515"></a><span id="l21.1515" class="difflineplus">+            return;</span>
<a href="#l21.1516"></a><span id="l21.1516"> </span>
<a href="#l21.1517"></a><span id="l21.1517" class="difflineminus">-        // fix for bug #352353</span>
<a href="#l21.1518"></a><span id="l21.1518" class="difflineminus">-        // unlike the scrollup button on the tab strip (which is a </span>
<a href="#l21.1519"></a><span id="l21.1519" class="difflineminus">-        // simple toolbarbutton) the scrolldown button is </span>
<a href="#l21.1520"></a><span id="l21.1520" class="difflineminus">-        // a more complicated stack of boxes and a toolbarbutton</span>
<a href="#l21.1521"></a><span id="l21.1521" class="difflineminus">-        // so that we can animate when a tab is opened offscreen.</span>
<a href="#l21.1522"></a><span id="l21.1522" class="difflineminus">-        // in order to style the box with the actual background image</span>
<a href="#l21.1523"></a><span id="l21.1523" class="difflineminus">-        // we need to manually set the disable state to match the</span>
<a href="#l21.1524"></a><span id="l21.1524" class="difflineminus">-        // disable state of the toolbarbutton.</span>
<a href="#l21.1525"></a><span id="l21.1525" class="difflineminus">-        this._scrollButtonDownBox</span>
<a href="#l21.1526"></a><span id="l21.1526" class="difflineminus">-            .setAttribute(&quot;disabled&quot;, this._scrollButtonDown.disabled);</span>
<a href="#l21.1527"></a><span id="l21.1527" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.1528"></a><span id="l21.1528" class="difflineminus">-</span>
<a href="#l21.1529"></a><span id="l21.1529" class="difflineplus">+          // fix for bug #352353</span>
<a href="#l21.1530"></a><span id="l21.1530" class="difflineplus">+          // unlike the scrollup button on the tab strip (which is a</span>
<a href="#l21.1531"></a><span id="l21.1531" class="difflineplus">+          // simple toolbarbutton) the scrolldown button is</span>
<a href="#l21.1532"></a><span id="l21.1532" class="difflineplus">+          // a more complicated stack of boxes and a toolbarbutton</span>
<a href="#l21.1533"></a><span id="l21.1533" class="difflineplus">+          // so that we can animate when a tab is opened offscreen.</span>
<a href="#l21.1534"></a><span id="l21.1534" class="difflineplus">+          // in order to style the box with the actual background image</span>
<a href="#l21.1535"></a><span id="l21.1535" class="difflineplus">+          // we need to manually set the disable state to match the</span>
<a href="#l21.1536"></a><span id="l21.1536" class="difflineplus">+          // disable state of the toolbarbutton.</span>
<a href="#l21.1537"></a><span id="l21.1537" class="difflineplus">+          this._scrollButtonDownBox</span>
<a href="#l21.1538"></a><span id="l21.1538" class="difflineplus">+              .setAttribute(&quot;disabled&quot;, this._scrollButtonDown.disabled);</span>
<a href="#l21.1539"></a><span id="l21.1539" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.1540"></a><span id="l21.1540" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.1541"></a><span id="l21.1541">     &lt;/handlers&gt;</span>
<a href="#l21.1542"></a><span id="l21.1542">   &lt;/binding&gt;</span>
<a href="#l21.1543"></a><span id="l21.1543"> </span>
<a href="#l21.1544"></a><span id="l21.1544">   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l21.1545"></a><span id="l21.1545">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tabs&quot;&gt;</span>
<a href="#l21.1546"></a><span id="l21.1546">     &lt;content&gt;</span>
<a href="#l21.1547"></a><span id="l21.1547" class="difflineminus">-      &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; class=&quot;tabmail-arrowscrollbox&quot; flex=&quot;1&quot;</span>
<a href="#l21.1548"></a><span id="l21.1548" class="difflineminus">-                          xbl:inherits=&quot;smoothscroll&quot; orient=&quot;horizontal&quot; style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l21.1549"></a><span id="l21.1549" class="difflineminus">-        &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l21.1550"></a><span id="l21.1550" class="difflineminus">-      &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l21.1551"></a><span id="l21.1551" class="difflineminus">-      &lt;children/&gt;</span>
<a href="#l21.1552"></a><span id="l21.1552" class="difflineminus">-      &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; class=&quot;tabs-alltabs-stack&quot;&gt;</span>
<a href="#l21.1553"></a><span id="l21.1553" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l21.1554"></a><span id="l21.1554" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l21.1555"></a><span id="l21.1555" class="difflineminus">-                  anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l21.1556"></a><span id="l21.1556" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l21.1557"></a><span id="l21.1557" class="difflineminus">-                           anonid=&quot;alltabs-button&quot;</span>
<a href="#l21.1558"></a><span id="l21.1558" class="difflineminus">-                           tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l21.1559"></a><span id="l21.1559" class="difflineminus">-          &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l21.1560"></a><span id="l21.1560" class="difflineminus">-                         anonid=&quot;alltabs-popup&quot; </span>
<a href="#l21.1561"></a><span id="l21.1561" class="difflineminus">-                         position=&quot;after_end&quot;/&gt;</span>
<a href="#l21.1562"></a><span id="l21.1562" class="difflineminus">-        &lt;/xul:toolbarbutton&gt;</span>
<a href="#l21.1563"></a><span id="l21.1563" class="difflineplus">+      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l21.1564"></a><span id="l21.1564" class="difflineplus">+        &lt;xul:vbox&gt;</span>
<a href="#l21.1565"></a><span id="l21.1565" class="difflineplus">+          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l21.1566"></a><span id="l21.1566" class="difflineplus">+          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l21.1567"></a><span id="l21.1567" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l21.1568"></a><span id="l21.1568" class="difflineplus">+        &lt;xul:stack&gt;</span>
<a href="#l21.1569"></a><span id="l21.1569" class="difflineplus">+          &lt;xul:spacer class=&quot;tabs-left tabs-right&quot;/&gt;</span>
<a href="#l21.1570"></a><span id="l21.1570" class="difflineplus">+          &lt;xul:hbox&gt;</span>
<a href="#l21.1571"></a><span id="l21.1571" class="difflineplus">+            &lt;xul:hbox class=&quot;tabs-newbutton-box&quot;</span>
<a href="#l21.1572"></a><span id="l21.1572" class="difflineplus">+                      align=&quot;center&quot;</span>
<a href="#l21.1573"></a><span id="l21.1573" class="difflineplus">+                      pack=&quot;start&quot;</span>
<a href="#l21.1574"></a><span id="l21.1574" class="difflineplus">+                      anonid=&quot;tabstrip-newbutton&quot;&gt;</span>
<a href="#l21.1575"></a><span id="l21.1575" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;new-button tabs-newbutton&quot;</span>
<a href="#l21.1576"></a><span id="l21.1576" class="difflineplus">+                                 tooltiptext=&quot;&amp;tabmailNewButton.tooltip;&quot;/&gt;</span>
<a href="#l21.1577"></a><span id="l21.1577" class="difflineplus">+            &lt;/xul:hbox&gt;</span>
<a href="#l21.1578"></a><span id="l21.1578" class="difflineplus">+            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l21.1579"></a><span id="l21.1579" class="difflineplus">+                                class=&quot;tabbrowser-arrowscrollbox tabmail-arrowscrollbox&quot;</span>
<a href="#l21.1580"></a><span id="l21.1580" class="difflineplus">+                                flex=&quot;1&quot;</span>
<a href="#l21.1581"></a><span id="l21.1581" class="difflineplus">+                                xbl:inherits=&quot;smoothscroll&quot;</span>
<a href="#l21.1582"></a><span id="l21.1582" class="difflineplus">+                                orient=&quot;horizontal&quot;</span>
<a href="#l21.1583"></a><span id="l21.1583" class="difflineplus">+                                style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l21.1584"></a><span id="l21.1584" class="difflineplus">+              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l21.1585"></a><span id="l21.1585" class="difflineplus">+            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l21.1586"></a><span id="l21.1586" class="difflineplus">+            &lt;children/&gt;</span>
<a href="#l21.1587"></a><span id="l21.1587" class="difflineplus">+            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot;</span>
<a href="#l21.1588"></a><span id="l21.1588" class="difflineplus">+                      align=&quot;center&quot;</span>
<a href="#l21.1589"></a><span id="l21.1589" class="difflineplus">+                      pack=&quot;end&quot;</span>
<a href="#l21.1590"></a><span id="l21.1590" class="difflineplus">+                      anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l21.1591"></a><span id="l21.1591" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;</span>
<a href="#l21.1592"></a><span id="l21.1592" class="difflineplus">+                                 tooltiptext=&quot;&amp;tabmailCloseButton.tooltip;&quot;/&gt;</span>
<a href="#l21.1593"></a><span id="l21.1593" class="difflineplus">+            &lt;/xul:hbox&gt;</span>
<a href="#l21.1594"></a><span id="l21.1594" class="difflineplus">+            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; class=&quot;tabs-alltabs-stack&quot;&gt;</span>
<a href="#l21.1595"></a><span id="l21.1595" class="difflineplus">+              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l21.1596"></a><span id="l21.1596" class="difflineplus">+              &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l21.1597"></a><span id="l21.1597" class="difflineplus">+                        class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l21.1598"></a><span id="l21.1598" class="difflineplus">+                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l21.1599"></a><span id="l21.1599" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot;</span>
<a href="#l21.1600"></a><span id="l21.1600" class="difflineplus">+                                 type=&quot;menu&quot;</span>
<a href="#l21.1601"></a><span id="l21.1601" class="difflineplus">+                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l21.1602"></a><span id="l21.1602" class="difflineplus">+                                 tooltipstring=&quot;&amp;tabmailAllTabs.tooltip;&quot;&gt;</span>
<a href="#l21.1603"></a><span id="l21.1603" class="difflineplus">+                &lt;xul:menupopup class=&quot;menulist-menupopup tabs-alltabs-popup&quot;</span>
<a href="#l21.1604"></a><span id="l21.1604" class="difflineplus">+                               anonid=&quot;alltabs-popup&quot;</span>
<a href="#l21.1605"></a><span id="l21.1605" class="difflineplus">+                               position=&quot;after_end&quot;/&gt;</span>
<a href="#l21.1606"></a><span id="l21.1606" class="difflineplus">+              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l21.1607"></a><span id="l21.1607" class="difflineplus">+            &lt;/xul:stack&gt;</span>
<a href="#l21.1608"></a><span id="l21.1608" class="difflineplus">+          &lt;/xul:hbox&gt;</span>
<a href="#l21.1609"></a><span id="l21.1609" class="difflineplus">+        &lt;/xul:stack&gt;</span>
<a href="#l21.1610"></a><span id="l21.1610">       &lt;/xul:stack&gt;</span>
<a href="#l21.1611"></a><span id="l21.1611" class="difflineminus">-      &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l21.1612"></a><span id="l21.1612" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l21.1613"></a><span id="l21.1613" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l21.1614"></a><span id="l21.1614">     &lt;/content&gt;</span>
<a href="#l21.1615"></a><span id="l21.1615" class="difflineminus">-    &lt;implementation implements=&quot;nsITimerCallback, nsIDOMEventListener&quot;&gt;</span>
<a href="#l21.1616"></a><span id="l21.1616" class="difflineplus">+</span>
<a href="#l21.1617"></a><span id="l21.1617" class="difflineplus">+    &lt;implementation implements=&quot;nsITimerCallback, nsIDOMEventListener, nsIObserver&quot;&gt;</span>
<a href="#l21.1618"></a><span id="l21.1618">       &lt;constructor&gt;</span>
<a href="#l21.1619"></a><span id="l21.1619">         &lt;![CDATA[</span>
<a href="#l21.1620"></a><span id="l21.1620" class="difflineminus">-          var pb2 =</span>
<a href="#l21.1621"></a><span id="l21.1621" class="difflineminus">-              Components.classes['@mozilla.org/preferences-service;1'].</span>
<a href="#l21.1622"></a><span id="l21.1622" class="difflineminus">-              getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l21.1623"></a><span id="l21.1623" class="difflineminus">-</span>
<a href="#l21.1624"></a><span id="l21.1624" class="difflineminus">-          try {</span>
<a href="#l21.1625"></a><span id="l21.1625" class="difflineminus">-            this.mTabMinWidth = pb2.getIntPref(&quot;mail.tabs.tabMinWidth&quot;);</span>
<a href="#l21.1626"></a><span id="l21.1626" class="difflineminus">-          } catch (e) {</span>
<a href="#l21.1627"></a><span id="l21.1627" class="difflineminus">-          }</span>
<a href="#l21.1628"></a><span id="l21.1628" class="difflineminus">-          try {</span>
<a href="#l21.1629"></a><span id="l21.1629" class="difflineminus">-            this.mTabMaxWidth = pb2.getIntPref(&quot;mail.tabs.tabMaxWidth&quot;);</span>
<a href="#l21.1630"></a><span id="l21.1630" class="difflineminus">-          } catch (e) {</span>
<a href="#l21.1631"></a><span id="l21.1631" class="difflineminus">-          }</span>
<a href="#l21.1632"></a><span id="l21.1632" class="difflineminus">-          try {</span>
<a href="#l21.1633"></a><span id="l21.1633" class="difflineminus">-            this.mTabClipWidth = pb2.getIntPref(&quot;mail.tabs.tabClipWidth&quot;);</span>
<a href="#l21.1634"></a><span id="l21.1634" class="difflineminus">-          } catch (e) {</span>
<a href="#l21.1635"></a><span id="l21.1635" class="difflineminus">-          }</span>
<a href="#l21.1636"></a><span id="l21.1636" class="difflineminus">-          try {</span>
<a href="#l21.1637"></a><span id="l21.1637" class="difflineminus">-            this.mCloseButtons = pb2.getIntPref(&quot;mail.tabs.closeButtons&quot;);</span>
<a href="#l21.1638"></a><span id="l21.1638" class="difflineminus">-          } catch (e) {</span>
<a href="#l21.1639"></a><span id="l21.1639" class="difflineminus">-          }</span>
<a href="#l21.1640"></a><span id="l21.1640" class="difflineminus">-          try {</span>
<a href="#l21.1641"></a><span id="l21.1641" class="difflineminus">-            this.mAutoHide = pb2.getBoolPref(&quot;mail.tabs.autoHide&quot;);</span>
<a href="#l21.1642"></a><span id="l21.1642" class="difflineminus">-          } catch (e) {</span>
<a href="#l21.1643"></a><span id="l21.1643" class="difflineminus">-          }</span>
<a href="#l21.1644"></a><span id="l21.1644" class="difflineminus">-</span>
<a href="#l21.1645"></a><span id="l21.1645" class="difflineminus">-          if (this.mAutoHide)</span>
<a href="#l21.1646"></a><span id="l21.1646" class="difflineminus">-            this.collapsed = true;</span>
<a href="#l21.1647"></a><span id="l21.1647" class="difflineminus">-</span>
<a href="#l21.1648"></a><span id="l21.1648" class="difflineplus">+          this.mTabMinWidth  = this.mPrefs.getIntPref (&quot;browser.tabs.tabMinWidth&quot;);</span>
<a href="#l21.1649"></a><span id="l21.1649" class="difflineplus">+          this.mTabMaxWidth  = this.mPrefs.getIntPref (&quot;browser.tabs.tabMaxWidth&quot;);</span>
<a href="#l21.1650"></a><span id="l21.1650" class="difflineplus">+          this.mTabClipWidth = this.mPrefs.getIntPref (&quot;browser.tabs.tabClipWidth&quot;);</span>
<a href="#l21.1651"></a><span id="l21.1651" class="difflineplus">+          this.mCloseButtons = this.mPrefs.getIntPref (&quot;browser.tabs.closeButtons&quot;);</span>
<a href="#l21.1652"></a><span id="l21.1652">           this.firstChild.minWidth = this.mTabMinWidth;</span>
<a href="#l21.1653"></a><span id="l21.1653">           this.firstChild.maxWidth = this.mTabMaxWidth;</span>
<a href="#l21.1654"></a><span id="l21.1654">           this.adjustTabstrip();</span>
<a href="#l21.1655"></a><span id="l21.1655" class="difflineminus">-</span>
<a href="#l21.1656"></a><span id="l21.1656" class="difflineminus">-          pb2.addObserver(&quot;mail.tabs.&quot;, this._prefObserver, false);</span>
<a href="#l21.1657"></a><span id="l21.1657" class="difflineminus">-</span>
<a href="#l21.1658"></a><span id="l21.1658" class="difflineplus">+          this.mPrefs.addObserver(&quot;browser.tabs.&quot;, this, false);</span>
<a href="#l21.1659"></a><span id="l21.1659">           window.addEventListener(&quot;resize&quot;, this, false);</span>
<a href="#l21.1660"></a><span id="l21.1660"> </span>
<a href="#l21.1661"></a><span id="l21.1661">           // Listen to overflow/underflow events on the tabstrip,</span>
<a href="#l21.1662"></a><span id="l21.1662">           // we cannot put these as xbl handlers on the entire binding because</span>
<a href="#l21.1663"></a><span id="l21.1663">           // they would also get called for the all-tabs popup scrollbox.</span>
<a href="#l21.1664"></a><span id="l21.1664" class="difflineminus">-          // Also, we can't rely on event.target becuase these are all</span>
<a href="#l21.1665"></a><span id="l21.1665" class="difflineplus">+          // Also, we can't rely on event.target because these are all</span>
<a href="#l21.1666"></a><span id="l21.1666">           // anonymous nodes.</span>
<a href="#l21.1667"></a><span id="l21.1667" class="difflineminus">-          this.mTabstrip.addEventListener(&quot;overflow&quot;, this, false);</span>
<a href="#l21.1668"></a><span id="l21.1668" class="difflineplus">+          this.mTabstrip.addEventListener(&quot;overflow&quot;,  this, false);</span>
<a href="#l21.1669"></a><span id="l21.1669">           this.mTabstrip.addEventListener(&quot;underflow&quot;, this, false);</span>
<a href="#l21.1670"></a><span id="l21.1670">         ]]&gt;</span>
<a href="#l21.1671"></a><span id="l21.1671">       &lt;/constructor&gt;</span>
<a href="#l21.1672"></a><span id="l21.1672"> </span>
<a href="#l21.1673"></a><span id="l21.1673">       &lt;destructor&gt;</span>
<a href="#l21.1674"></a><span id="l21.1674">         &lt;![CDATA[</span>
<a href="#l21.1675"></a><span id="l21.1675" class="difflineminus">-          var pb2 =</span>
<a href="#l21.1676"></a><span id="l21.1676" class="difflineminus">-              Components.classes['@mozilla.org/preferences-service;1'].</span>
<a href="#l21.1677"></a><span id="l21.1677" class="difflineminus">-              getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l21.1678"></a><span id="l21.1678" class="difflineminus">-          pb2.removeObserver(&quot;mail.tabs.&quot;, this._prefObserver);</span>
<a href="#l21.1679"></a><span id="l21.1679" class="difflineplus">+          this.mPrefs.removeObserver(&quot;browser.tabs.&quot;, this);</span>
<a href="#l21.1680"></a><span id="l21.1680"> </span>
<a href="#l21.1681"></a><span id="l21.1681">           // Release timer to avoid reference cycles.</span>
<a href="#l21.1682"></a><span id="l21.1682" class="difflineminus">-          if (this._animateTimer) {</span>
<a href="#l21.1683"></a><span id="l21.1683" class="difflineplus">+          if (this._animateTimer)</span>
<a href="#l21.1684"></a><span id="l21.1684" class="difflineplus">+          {</span>
<a href="#l21.1685"></a><span id="l21.1685">             this._animateTimer.cancel();</span>
<a href="#l21.1686"></a><span id="l21.1686">             this._animateTimer = null;</span>
<a href="#l21.1687"></a><span id="l21.1687">           }</span>
<a href="#l21.1688"></a><span id="l21.1688" class="difflineminus">-</span>
<a href="#l21.1689"></a><span id="l21.1689">           this.mTabstrip.removeEventListener(&quot;overflow&quot;, this, false);</span>
<a href="#l21.1690"></a><span id="l21.1690">           this.mTabstrip.removeEventListener(&quot;underflow&quot;, this, false);</span>
<a href="#l21.1691"></a><span id="l21.1691">         ]]&gt;</span>
<a href="#l21.1692"></a><span id="l21.1692">       &lt;/destructor&gt;</span>
<a href="#l21.1693"></a><span id="l21.1693"> </span>
<a href="#l21.1694"></a><span id="l21.1694" class="difflineplus">+      &lt;field name=&quot;mPrefs&quot;&gt;</span>
<a href="#l21.1695"></a><span id="l21.1695" class="difflineplus">+        Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l21.1696"></a><span id="l21.1696" class="difflineplus">+                  .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l21.1697"></a><span id="l21.1697" class="difflineplus">+      &lt;/field&gt;</span>
<a href="#l21.1698"></a><span id="l21.1698" class="difflineplus">+</span>
<a href="#l21.1699"></a><span id="l21.1699">       &lt;field name=&quot;mTabstripWidth&quot;&gt;0&lt;/field&gt;</span>
<a href="#l21.1700"></a><span id="l21.1700"> </span>
<a href="#l21.1701"></a><span id="l21.1701">       &lt;field name=&quot;mTabstrip&quot;&gt;</span>
<a href="#l21.1702"></a><span id="l21.1702">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;arrowscrollbox&quot;);</span>
<a href="#l21.1703"></a><span id="l21.1703">       &lt;/field&gt;</span>
<a href="#l21.1704"></a><span id="l21.1704"> </span>
<a href="#l21.1705"></a><span id="l21.1705">       &lt;field name=&quot;mTabstripClosebutton&quot;&gt;</span>
<a href="#l21.1706"></a><span id="l21.1706">         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;tabstrip-closebutton&quot;);</span>
<a href="#l21.1707"></a><span id="l21.1707">       &lt;/field&gt;</span>
<a href="#l21.1708"></a><span id="l21.1708"> </span>
<a href="#l21.1709"></a><span id="l21.1709" class="difflineminus">-      &lt;field name=&quot;_prefObserver&quot;&gt;({</span>
<a href="#l21.1710"></a><span id="l21.1710" class="difflineminus">-        tabbox: this,</span>
<a href="#l21.1711"></a><span id="l21.1711" class="difflineminus">-  </span>
<a href="#l21.1712"></a><span id="l21.1712" class="difflineminus">-        observe: function(subject, topic, data)</span>
<a href="#l21.1713"></a><span id="l21.1713" class="difflineminus">-        {</span>
<a href="#l21.1714"></a><span id="l21.1714" class="difflineminus">-          if (topic == &quot;nsPref:changed&quot;) {</span>
<a href="#l21.1715"></a><span id="l21.1715" class="difflineminus">-            subject.QueryInterface(Components.interfaces.nsIPrefBranch);</span>
<a href="#l21.1716"></a><span id="l21.1716" class="difflineminus">-            switch (data) {</span>
<a href="#l21.1717"></a><span id="l21.1717" class="difflineminus">-            case &quot;mail.tabs.closeButtons&quot;:</span>
<a href="#l21.1718"></a><span id="l21.1718" class="difflineminus">-              this.tabbox.mCloseButtons = subject.getIntPref(&quot;mail.tabs.closeButtons&quot;);</span>
<a href="#l21.1719"></a><span id="l21.1719" class="difflineminus">-              this.tabbox.adjustTabstrip();</span>
<a href="#l21.1720"></a><span id="l21.1720" class="difflineminus">-              break;</span>
<a href="#l21.1721"></a><span id="l21.1721" class="difflineminus">-            case &quot;mail.tabs.autoHide&quot;:</span>
<a href="#l21.1722"></a><span id="l21.1722" class="difflineminus">-              this.tabbox.mAutoHide = subject.getBoolPref(&quot;mail.tabs.autoHide&quot;);</span>
<a href="#l21.1723"></a><span id="l21.1723" class="difflineminus">-              break;</span>
<a href="#l21.1724"></a><span id="l21.1724" class="difflineminus">-            }</span>
<a href="#l21.1725"></a><span id="l21.1725" class="difflineminus">-          }</span>
<a href="#l21.1726"></a><span id="l21.1726" class="difflineminus">-        },</span>
<a href="#l21.1727"></a><span id="l21.1727" class="difflineminus">-  </span>
<a href="#l21.1728"></a><span id="l21.1728" class="difflineminus">-        QueryInterface: function(aIID)</span>
<a href="#l21.1729"></a><span id="l21.1729" class="difflineminus">-        {</span>
<a href="#l21.1730"></a><span id="l21.1730" class="difflineminus">-          if (aIID.equals(Components.interfaces.nsIObserver) ||</span>
<a href="#l21.1731"></a><span id="l21.1731" class="difflineminus">-              aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l21.1732"></a><span id="l21.1732" class="difflineminus">-            return this;</span>
<a href="#l21.1733"></a><span id="l21.1733" class="difflineminus">-          throw Components.results.NS_NOINTERFACE;</span>
<a href="#l21.1734"></a><span id="l21.1734" class="difflineminus">-        }</span>
<a href="#l21.1735"></a><span id="l21.1735" class="difflineminus">-        });</span>
<a href="#l21.1736"></a><span id="l21.1736" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l21.1737"></a><span id="l21.1737">       &lt;field name=&quot;mTabMinWidth&quot;&gt;100&lt;/field&gt;</span>
<a href="#l21.1738"></a><span id="l21.1738">       &lt;field name=&quot;mTabMaxWidth&quot;&gt;250&lt;/field&gt;</span>
<a href="#l21.1739"></a><span id="l21.1739">       &lt;field name=&quot;mTabClipWidth&quot;&gt;140&lt;/field&gt;</span>
<a href="#l21.1740"></a><span id="l21.1740" class="difflineminus">-      &lt;field name=&quot;mCloseButtons&quot;&gt;1&lt;/field&gt;</span>
<a href="#l21.1741"></a><span id="l21.1741" class="difflineminus">-</span>
<a href="#l21.1742"></a><span id="l21.1742" class="difflineminus">-      &lt;field name=&quot;_mAutoHide&quot;&gt;false&lt;/field&gt;</span>
<a href="#l21.1743"></a><span id="l21.1743" class="difflineminus">-      &lt;property name=&quot;mAutoHide&quot; onget=&quot;return this._mAutoHide;&quot;&gt;</span>
<a href="#l21.1744"></a><span id="l21.1744" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l21.1745"></a><span id="l21.1745" class="difflineminus">-          if (val != this._mAutoHide) {</span>
<a href="#l21.1746"></a><span id="l21.1746" class="difflineminus">-            if (this.childNodes.length == 1)</span>
<a href="#l21.1747"></a><span id="l21.1747" class="difflineminus">-              this.collapsed = val;</span>
<a href="#l21.1748"></a><span id="l21.1748" class="difflineminus">-            this._mAutoHide = val;</span>
<a href="#l21.1749"></a><span id="l21.1749" class="difflineminus">-          }</span>
<a href="#l21.1750"></a><span id="l21.1750" class="difflineminus">-          return val;</span>
<a href="#l21.1751"></a><span id="l21.1751" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l21.1752"></a><span id="l21.1752" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l21.1753"></a><span id="l21.1753" class="difflineminus">-</span>
<a href="#l21.1754"></a><span id="l21.1754" class="difflineplus">+      &lt;field name=&quot;mCloseButtons&quot;&gt;3&lt;/field&gt;</span>
<a href="#l21.1755"></a><span id="l21.1755">       &lt;method name=&quot;adjustTabstrip&quot;&gt;</span>
<a href="#l21.1756"></a><span id="l21.1756" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.1757"></a><span id="l21.1757" class="difflineminus">-          // modes for tabstrip</span>
<a href="#l21.1758"></a><span id="l21.1758" class="difflineminus">-          // 0 - activetab  = close button on active tab only</span>
<a href="#l21.1759"></a><span id="l21.1759" class="difflineminus">-          // 1 - alltabs    = close buttons on all tabs</span>
<a href="#l21.1760"></a><span id="l21.1760" class="difflineminus">-          // 2 - noclose    = no close buttons at all</span>
<a href="#l21.1761"></a><span id="l21.1761" class="difflineminus">-          // 3 - closeatend = close button at the end of the tabstrip</span>
<a href="#l21.1762"></a><span id="l21.1762" class="difflineminus">-          switch (this.mCloseButtons) {</span>
<a href="#l21.1763"></a><span id="l21.1763" class="difflineminus">-          case 0:</span>
<a href="#l21.1764"></a><span id="l21.1764" class="difflineminus">-            this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l21.1765"></a><span id="l21.1765" class="difflineminus">-            break;</span>
<a href="#l21.1766"></a><span id="l21.1766" class="difflineminus">-          case 1:</span>
<a href="#l21.1767"></a><span id="l21.1767" class="difflineminus">-            var width = this.firstChild.boxObject.width;</span>
<a href="#l21.1768"></a><span id="l21.1768" class="difflineminus">-            // 0 width is an invalid value and indicates</span>
<a href="#l21.1769"></a><span id="l21.1769" class="difflineminus">-            // an item without display, so ignore.</span>
<a href="#l21.1770"></a><span id="l21.1770" class="difflineminus">-            if (width &gt; this.mTabClipWidth || width == 0)</span>
<a href="#l21.1771"></a><span id="l21.1771" class="difflineminus">-              this.setAttribute(&quot;closebuttons&quot;, &quot;alltabs&quot;);</span>
<a href="#l21.1772"></a><span id="l21.1772" class="difflineminus">-            else</span>
<a href="#l21.1773"></a><span id="l21.1773" class="difflineminus">-              this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l21.1774"></a><span id="l21.1774" class="difflineminus">-            break;</span>
<a href="#l21.1775"></a><span id="l21.1775" class="difflineminus">-          case 2:</span>
<a href="#l21.1776"></a><span id="l21.1776" class="difflineminus">-          case 3:</span>
<a href="#l21.1777"></a><span id="l21.1777" class="difflineminus">-            this.setAttribute(&quot;closebuttons&quot;, &quot;noclose&quot;);</span>
<a href="#l21.1778"></a><span id="l21.1778" class="difflineminus">-            break;</span>
<a href="#l21.1779"></a><span id="l21.1779" class="difflineminus">-          }</span>
<a href="#l21.1780"></a><span id="l21.1780" class="difflineminus">-          this.mTabstripClosebutton.collapsed = this.mCloseButtons != 3;</span>
<a href="#l21.1781"></a><span id="l21.1781" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.1782"></a><span id="l21.1782" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1783"></a><span id="l21.1783" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1784"></a><span id="l21.1784" class="difflineplus">+            // modes for tabstrip</span>
<a href="#l21.1785"></a><span id="l21.1785" class="difflineplus">+            // 0 - activetab  = close button on active tab only</span>
<a href="#l21.1786"></a><span id="l21.1786" class="difflineplus">+            // 1 - alltabs    = close buttons on all tabs</span>
<a href="#l21.1787"></a><span id="l21.1787" class="difflineplus">+            // 2 - noclose    = no close buttons at all</span>
<a href="#l21.1788"></a><span id="l21.1788" class="difflineplus">+            // 3 - closeatend = close button at the end of the tabstrip</span>
<a href="#l21.1789"></a><span id="l21.1789" class="difflineplus">+            switch (this.mCloseButtons)</span>
<a href="#l21.1790"></a><span id="l21.1790" class="difflineplus">+            {</span>
<a href="#l21.1791"></a><span id="l21.1791" class="difflineplus">+              case 0:</span>
<a href="#l21.1792"></a><span id="l21.1792" class="difflineplus">+                this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l21.1793"></a><span id="l21.1793" class="difflineplus">+                break;</span>
<a href="#l21.1794"></a><span id="l21.1794" class="difflineplus">+              case 1:</span>
<a href="#l21.1795"></a><span id="l21.1795" class="difflineplus">+                let width = this.firstChild.boxObject.width;</span>
<a href="#l21.1796"></a><span id="l21.1796" class="difflineplus">+                // 0 width is an invalid value and indicates</span>
<a href="#l21.1797"></a><span id="l21.1797" class="difflineplus">+                // an item without display, so ignore.</span>
<a href="#l21.1798"></a><span id="l21.1798" class="difflineplus">+                if (width &gt; this.mTabClipWidth || width == 0)</span>
<a href="#l21.1799"></a><span id="l21.1799" class="difflineplus">+                  this.setAttribute(&quot;closebuttons&quot;, &quot;alltabs&quot;);</span>
<a href="#l21.1800"></a><span id="l21.1800" class="difflineplus">+                else</span>
<a href="#l21.1801"></a><span id="l21.1801" class="difflineplus">+                  this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l21.1802"></a><span id="l21.1802" class="difflineplus">+                break;</span>
<a href="#l21.1803"></a><span id="l21.1803" class="difflineplus">+              case 2:</span>
<a href="#l21.1804"></a><span id="l21.1804" class="difflineplus">+                this.setAttribute(&quot;closebuttons&quot;, &quot;noclose&quot;);</span>
<a href="#l21.1805"></a><span id="l21.1805" class="difflineplus">+                break;</span>
<a href="#l21.1806"></a><span id="l21.1806" class="difflineplus">+              case 3:</span>
<a href="#l21.1807"></a><span id="l21.1807" class="difflineplus">+                this.setAttribute(&quot;closebuttons&quot;, &quot;closeatend&quot;);</span>
<a href="#l21.1808"></a><span id="l21.1808" class="difflineplus">+                break;</span>
<a href="#l21.1809"></a><span id="l21.1809" class="difflineplus">+            }</span>
<a href="#l21.1810"></a><span id="l21.1810" class="difflineplus">+            this.mTabstripClosebutton.collapsed = this.mCloseButtons != 3;</span>
<a href="#l21.1811"></a><span id="l21.1811" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1812"></a><span id="l21.1812" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1813"></a><span id="l21.1813">       &lt;/method&gt;</span>
<a href="#l21.1814"></a><span id="l21.1814" class="difflineminus">-        </span>
<a href="#l21.1815"></a><span id="l21.1815" class="difflineminus">-      &lt;field name=&quot;_mPrefs&quot;&gt;null&lt;/field&gt;</span>
<a href="#l21.1816"></a><span id="l21.1816" class="difflineminus">-      &lt;property name=&quot;mPrefs&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l21.1817"></a><span id="l21.1817" class="difflineminus">-        &lt;getter&gt;</span>
<a href="#l21.1818"></a><span id="l21.1818" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l21.1819"></a><span id="l21.1819" class="difflineminus">-          if (!this._mPrefs) {</span>
<a href="#l21.1820"></a><span id="l21.1820" class="difflineminus">-            this._mPrefs =</span>
<a href="#l21.1821"></a><span id="l21.1821" class="difflineminus">-              Components.classes['@mozilla.org/preferences-service;1'].</span>
<a href="#l21.1822"></a><span id="l21.1822" class="difflineminus">-              getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l21.1823"></a><span id="l21.1823" class="difflineminus">-          }</span>
<a href="#l21.1824"></a><span id="l21.1824" class="difflineminus">-          return this._mPrefs;</span>
<a href="#l21.1825"></a><span id="l21.1825" class="difflineminus">-        ]]&gt;</span>
<a href="#l21.1826"></a><span id="l21.1826" class="difflineminus">-        &lt;/getter&gt;</span>
<a href="#l21.1827"></a><span id="l21.1827" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l21.1828"></a><span id="l21.1828" class="difflineminus">-        </span>
<a href="#l21.1829"></a><span id="l21.1829" class="difflineplus">+</span>
<a href="#l21.1830"></a><span id="l21.1830">       &lt;method name=&quot;_handleTabSelect&quot;&gt;</span>
<a href="#l21.1831"></a><span id="l21.1831" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.1832"></a><span id="l21.1832" class="difflineminus">-          this.mTabstrip.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l21.1833"></a><span id="l21.1833" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.1834"></a><span id="l21.1834" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1835"></a><span id="l21.1835" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1836"></a><span id="l21.1836" class="difflineplus">+            this.mTabstrip.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l21.1837"></a><span id="l21.1837" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1838"></a><span id="l21.1838" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1839"></a><span id="l21.1839">       &lt;/method&gt;</span>
<a href="#l21.1840"></a><span id="l21.1840"> </span>
<a href="#l21.1841"></a><span id="l21.1841">       &lt;method name=&quot;handleEvent&quot;&gt;</span>
<a href="#l21.1842"></a><span id="l21.1842">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.1843"></a><span id="l21.1843" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.1844"></a><span id="l21.1844" class="difflineminus">-          switch (aEvent.type) {</span>
<a href="#l21.1845"></a><span id="l21.1845" class="difflineminus">-            case &quot;overflow&quot;:</span>
<a href="#l21.1846"></a><span id="l21.1846" class="difflineminus">-              this.setAttribute(&quot;overflow&quot;, &quot;true&quot;);</span>
<a href="#l21.1847"></a><span id="l21.1847" class="difflineminus">-              this.mTabstrip.scrollBoxObject</span>
<a href="#l21.1848"></a><span id="l21.1848" class="difflineminus">-                            .ensureElementIsVisible(this.selectedItem);</span>
<a href="#l21.1849"></a><span id="l21.1849" class="difflineminus">-              break;</span>
<a href="#l21.1850"></a><span id="l21.1850" class="difflineminus">-            case &quot;underflow&quot;:</span>
<a href="#l21.1851"></a><span id="l21.1851" class="difflineminus">-              this.removeAttribute(&quot;overflow&quot;);</span>
<a href="#l21.1852"></a><span id="l21.1852" class="difflineminus">-              break;</span>
<a href="#l21.1853"></a><span id="l21.1853" class="difflineminus">-            case &quot;resize&quot;:</span>
<a href="#l21.1854"></a><span id="l21.1854" class="difflineminus">-              var width = this.mTabstrip.boxObject.width;</span>
<a href="#l21.1855"></a><span id="l21.1855" class="difflineminus">-              if (width != this.mTabstripWidth) {</span>
<a href="#l21.1856"></a><span id="l21.1856" class="difflineminus">-                this.adjustTabstrip();</span>
<a href="#l21.1857"></a><span id="l21.1857" class="difflineminus">-                // XXX without this line the tab bar won't budge</span>
<a href="#l21.1858"></a><span id="l21.1858" class="difflineminus">-                this.mTabstrip.scrollByPixels(1);</span>
<a href="#l21.1859"></a><span id="l21.1859" class="difflineminus">-                this._handleTabSelect();</span>
<a href="#l21.1860"></a><span id="l21.1860" class="difflineminus">-                this.mTabstripWidth = width;</span>
<a href="#l21.1861"></a><span id="l21.1861" class="difflineminus">-              }</span>
<a href="#l21.1862"></a><span id="l21.1862" class="difflineminus">-              break;</span>
<a href="#l21.1863"></a><span id="l21.1863" class="difflineminus">-          }</span>
<a href="#l21.1864"></a><span id="l21.1864" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.1865"></a><span id="l21.1865" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1866"></a><span id="l21.1866" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1867"></a><span id="l21.1867" class="difflineplus">+            switch (aEvent.type)</span>
<a href="#l21.1868"></a><span id="l21.1868" class="difflineplus">+            {</span>
<a href="#l21.1869"></a><span id="l21.1869" class="difflineplus">+              case &quot;overflow&quot;:</span>
<a href="#l21.1870"></a><span id="l21.1870" class="difflineplus">+                this.setAttribute(&quot;overflow&quot;, &quot;true&quot;);</span>
<a href="#l21.1871"></a><span id="l21.1871" class="difflineplus">+                this.mTabstrip.scrollBoxObject</span>
<a href="#l21.1872"></a><span id="l21.1872" class="difflineplus">+                              .ensureElementIsVisible(this.selectedItem);</span>
<a href="#l21.1873"></a><span id="l21.1873" class="difflineplus">+                break;</span>
<a href="#l21.1874"></a><span id="l21.1874" class="difflineplus">+              case &quot;underflow&quot;:</span>
<a href="#l21.1875"></a><span id="l21.1875" class="difflineplus">+                this.removeAttribute(&quot;overflow&quot;);</span>
<a href="#l21.1876"></a><span id="l21.1876" class="difflineplus">+                break;</span>
<a href="#l21.1877"></a><span id="l21.1877" class="difflineplus">+              case &quot;resize&quot;:</span>
<a href="#l21.1878"></a><span id="l21.1878" class="difflineplus">+                let width = this.mTabstrip.boxObject.width;</span>
<a href="#l21.1879"></a><span id="l21.1879" class="difflineplus">+                if (width != this.mTabstripWidth)</span>
<a href="#l21.1880"></a><span id="l21.1880" class="difflineplus">+                {</span>
<a href="#l21.1881"></a><span id="l21.1881" class="difflineplus">+                  this.adjustTabstrip();</span>
<a href="#l21.1882"></a><span id="l21.1882" class="difflineplus">+                  // XXX without this line the tab bar won't budge</span>
<a href="#l21.1883"></a><span id="l21.1883" class="difflineplus">+                  this.mTabstrip.scrollByPixels(1);</span>
<a href="#l21.1884"></a><span id="l21.1884" class="difflineplus">+                  this._handleTabSelect();</span>
<a href="#l21.1885"></a><span id="l21.1885" class="difflineplus">+                  this.mTabstripWidth = width;</span>
<a href="#l21.1886"></a><span id="l21.1886" class="difflineplus">+                }</span>
<a href="#l21.1887"></a><span id="l21.1887" class="difflineplus">+                break;</span>
<a href="#l21.1888"></a><span id="l21.1888" class="difflineplus">+            }</span>
<a href="#l21.1889"></a><span id="l21.1889" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1890"></a><span id="l21.1890" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1891"></a><span id="l21.1891">       &lt;/method&gt;</span>
<a href="#l21.1892"></a><span id="l21.1892"> </span>
<a href="#l21.1893"></a><span id="l21.1893">       &lt;field name=&quot;mAllTabsPopup&quot;&gt;</span>
<a href="#l21.1894"></a><span id="l21.1894" class="difflineminus">-        document.getAnonymousElementByAttribute(this, </span>
<a href="#l21.1895"></a><span id="l21.1895" class="difflineminus">-                                                &quot;anonid&quot;, &quot;alltabs-popup&quot;);</span>
<a href="#l21.1896"></a><span id="l21.1896" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alltabs-popup&quot;);</span>
<a href="#l21.1897"></a><span id="l21.1897">       &lt;/field&gt;</span>
<a href="#l21.1898"></a><span id="l21.1898"> </span>
<a href="#l21.1899"></a><span id="l21.1899">       &lt;field name=&quot;mAllTabsBoxAnimate&quot;&gt;</span>
<a href="#l21.1900"></a><span id="l21.1900" class="difflineminus">-        document.getAnonymousElementByAttribute(this, </span>
<a href="#l21.1901"></a><span id="l21.1901" class="difflineminus">-                                                &quot;anonid&quot;,</span>
<a href="#l21.1902"></a><span id="l21.1902" class="difflineminus">-                                                &quot;alltabs-box-animate&quot;);</span>
<a href="#l21.1903"></a><span id="l21.1903" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alltabs-box-animate&quot;);</span>
<a href="#l21.1904"></a><span id="l21.1904">       &lt;/field&gt;</span>
<a href="#l21.1905"></a><span id="l21.1905"> </span>
<a href="#l21.1906"></a><span id="l21.1906">       &lt;field name=&quot;mDownBoxAnimate&quot;&gt;</span>
<a href="#l21.1907"></a><span id="l21.1907">         this.mTabstrip._scrollButtonDownBoxAnimate;</span>
<a href="#l21.1908"></a><span id="l21.1908">       &lt;/field&gt;</span>
<a href="#l21.1909"></a><span id="l21.1909"> </span>
<a href="#l21.1910"></a><span id="l21.1910">       &lt;field name=&quot;mAllTabsButton&quot;&gt;</span>
<a href="#l21.1911"></a><span id="l21.1911" class="difflineminus">-        document.getAnonymousElementByAttribute(this, </span>
<a href="#l21.1912"></a><span id="l21.1912" class="difflineminus">-                                                &quot;anonid&quot;, &quot;alltabs-button&quot;);</span>
<a href="#l21.1913"></a><span id="l21.1913" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alltabs-button&quot;);</span>
<a href="#l21.1914"></a><span id="l21.1914">       &lt;/field&gt;</span>
<a href="#l21.1915"></a><span id="l21.1915"> </span>
<a href="#l21.1916"></a><span id="l21.1916">       &lt;field name=&quot;_animateTimer&quot;&gt;null&lt;/field&gt;</span>
<a href="#l21.1917"></a><span id="l21.1917">       &lt;field name=&quot;_animateStep&quot;&gt;-1&lt;/field&gt;</span>
<a href="#l21.1918"></a><span id="l21.1918">       &lt;field name=&quot;_animateDelay&quot;&gt;25&lt;/field&gt;</span>
<a href="#l21.1919"></a><span id="l21.1919">       &lt;field name=&quot;_animatePercents&quot;&gt;</span>
<a href="#l21.1920"></a><span id="l21.1920">        [1.00, 0.85, 0.80, 0.75, 0.71, 0.68, 0.65, 0.62, 0.59, 0.57,</span>
<a href="#l21.1921"></a><span id="l21.1921">         0.54, 0.52, 0.50, 0.47, 0.45, 0.44, 0.42, 0.40, 0.38, 0.37,</span>
<a href="#l21.1922"></a><span id="l21.1922">         0.35, 0.34, 0.32, 0.31, 0.30, 0.29, 0.28, 0.27, 0.26, 0.25,</span>
<a href="#l21.1923"></a><span id="l21.1923">         0.24, 0.23, 0.23, 0.22, 0.22, 0.21, 0.21, 0.21, 0.20, 0.20,</span>
<a href="#l21.1924"></a><span id="l21.1924">         0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.19, 0.19, 0.19, 0.18,</span>
<a href="#l21.1925"></a><span id="l21.1925">         0.18, 0.17, 0.17, 0.16, 0.15, 0.14, 0.13, 0.11, 0.09, 0.06]</span>
<a href="#l21.1926"></a><span id="l21.1926">       &lt;/field&gt;</span>
<a href="#l21.1927"></a><span id="l21.1927"> </span>
<a href="#l21.1928"></a><span id="l21.1928">       &lt;method name=&quot;_stopAnimation&quot;&gt;</span>
<a href="#l21.1929"></a><span id="l21.1929" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.1930"></a><span id="l21.1930" class="difflineminus">-          if (this._animateStep != -1) {</span>
<a href="#l21.1931"></a><span id="l21.1931" class="difflineminus">-            if (this._animateTimer)</span>
<a href="#l21.1932"></a><span id="l21.1932" class="difflineminus">-              this._animateTimer.cancel();</span>
<a href="#l21.1933"></a><span id="l21.1933" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1934"></a><span id="l21.1934" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1935"></a><span id="l21.1935" class="difflineplus">+            if (this._animateStep != -1)</span>
<a href="#l21.1936"></a><span id="l21.1936" class="difflineplus">+            {</span>
<a href="#l21.1937"></a><span id="l21.1937" class="difflineplus">+              if (this._animateTimer)</span>
<a href="#l21.1938"></a><span id="l21.1938" class="difflineplus">+                this._animateTimer.cancel();</span>
<a href="#l21.1939"></a><span id="l21.1939"> </span>
<a href="#l21.1940"></a><span id="l21.1940" class="difflineminus">-            this._animateStep = -1;</span>
<a href="#l21.1941"></a><span id="l21.1941" class="difflineminus">-            this.mAllTabsBoxAnimate.style.opacity = 0.0;</span>
<a href="#l21.1942"></a><span id="l21.1942" class="difflineminus">-            this.mDownBoxAnimate.style.opacity = 0.0;</span>
<a href="#l21.1943"></a><span id="l21.1943" class="difflineminus">-          }</span>
<a href="#l21.1944"></a><span id="l21.1944" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.1945"></a><span id="l21.1945" class="difflineplus">+              this._animateStep = -1;</span>
<a href="#l21.1946"></a><span id="l21.1946" class="difflineplus">+              this.mAllTabsBoxAnimate.style.opacity = 0.0;</span>
<a href="#l21.1947"></a><span id="l21.1947" class="difflineplus">+              this.mDownBoxAnimate.style.opacity = 0.0;</span>
<a href="#l21.1948"></a><span id="l21.1948" class="difflineplus">+            }</span>
<a href="#l21.1949"></a><span id="l21.1949" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.1950"></a><span id="l21.1950" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.1951"></a><span id="l21.1951">       &lt;/method&gt;</span>
<a href="#l21.1952"></a><span id="l21.1952" class="difflineminus">-      </span>
<a href="#l21.1953"></a><span id="l21.1953" class="difflineminus">-      &lt;method name=&quot;_notifyBackgroundTab&quot;&gt;</span>
<a href="#l21.1954"></a><span id="l21.1954" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l21.1955"></a><span id="l21.1955" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.1956"></a><span id="l21.1956" class="difflineminus">-          var tsbo = this.mTabstrip.scrollBoxObject;</span>
<a href="#l21.1957"></a><span id="l21.1957" class="difflineminus">-          var tsboStart = tsbo.screenX;</span>
<a href="#l21.1958"></a><span id="l21.1958" class="difflineminus">-          var tsboEnd = tsboStart + tsbo.width;</span>
<a href="#l21.1959"></a><span id="l21.1959"> </span>
<a href="#l21.1960"></a><span id="l21.1960" class="difflineminus">-          var ctbo = aTab.boxObject;</span>
<a href="#l21.1961"></a><span id="l21.1961" class="difflineminus">-          var ctboStart = ctbo.screenX;</span>
<a href="#l21.1962"></a><span id="l21.1962" class="difflineminus">-          var ctboEnd = ctboStart + ctbo.width;</span>
<a href="#l21.1963"></a><span id="l21.1963" class="difflineplus">+      &lt;method name=&quot;_notifyBackgroundTab&quot;&gt;</span>
<a href="#l21.1964"></a><span id="l21.1964" class="difflineplus">+        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l21.1965"></a><span id="l21.1965" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.1966"></a><span id="l21.1966" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.1967"></a><span id="l21.1967" class="difflineplus">+            let tsbo = this.mTabstrip.scrollBoxObject;</span>
<a href="#l21.1968"></a><span id="l21.1968" class="difflineplus">+            let tsboStart = tsbo.screenX;</span>
<a href="#l21.1969"></a><span id="l21.1969" class="difflineplus">+            let tsboEnd = tsboStart + tsbo.width;</span>
<a href="#l21.1970"></a><span id="l21.1970" class="difflineplus">+            let ctbo = aTabNode.boxObject;</span>
<a href="#l21.1971"></a><span id="l21.1971" class="difflineplus">+            let ctboStart = ctbo.screenX;</span>
<a href="#l21.1972"></a><span id="l21.1972" class="difflineplus">+            let ctboEnd = ctboStart + ctbo.width;</span>
<a href="#l21.1973"></a><span id="l21.1973"> </span>
<a href="#l21.1974"></a><span id="l21.1974" class="difflineminus">-          // only start the flash timer if the new tab (which was loaded in</span>
<a href="#l21.1975"></a><span id="l21.1975" class="difflineminus">-          // the background) is not completely visible</span>
<a href="#l21.1976"></a><span id="l21.1976" class="difflineminus">-          if (tsboStart &gt; ctboStart || ctboEnd &gt; tsboEnd) {</span>
<a href="#l21.1977"></a><span id="l21.1977" class="difflineminus">-            this._animateStep = 0;</span>
<a href="#l21.1978"></a><span id="l21.1978" class="difflineplus">+            // only start the flash timer if the new tab (which was loaded in</span>
<a href="#l21.1979"></a><span id="l21.1979" class="difflineplus">+            // the background) is not completely visible</span>
<a href="#l21.1980"></a><span id="l21.1980" class="difflineplus">+            if (tsboStart &gt; ctboStart || ctboEnd &gt; tsboEnd)</span>
<a href="#l21.1981"></a><span id="l21.1981" class="difflineplus">+            {</span>
<a href="#l21.1982"></a><span id="l21.1982" class="difflineplus">+              this._animateStep = 0;</span>
<a href="#l21.1983"></a><span id="l21.1983"> </span>
<a href="#l21.1984"></a><span id="l21.1984" class="difflineminus">-            if (!this._animateTimer) </span>
<a href="#l21.1985"></a><span id="l21.1985" class="difflineminus">-              this._animateTimer =</span>
<a href="#l21.1986"></a><span id="l21.1986" class="difflineminus">-                Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l21.1987"></a><span id="l21.1987" class="difflineminus">-                          .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l21.1988"></a><span id="l21.1988" class="difflineminus">-            else</span>
<a href="#l21.1989"></a><span id="l21.1989" class="difflineminus">-               this._animateTimer.cancel();</span>
<a href="#l21.1990"></a><span id="l21.1990" class="difflineplus">+              if (!this._animateTimer)</span>
<a href="#l21.1991"></a><span id="l21.1991" class="difflineplus">+</span>
<a href="#l21.1992"></a><span id="l21.1992" class="difflineplus">+                this._animateTimer =</span>
<a href="#l21.1993"></a><span id="l21.1993" class="difflineplus">+                  Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l21.1994"></a><span id="l21.1994" class="difflineplus">+                            .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l21.1995"></a><span id="l21.1995" class="difflineplus">+              else</span>
<a href="#l21.1996"></a><span id="l21.1996" class="difflineplus">+                 this._animateTimer.cancel();</span>
<a href="#l21.1997"></a><span id="l21.1997"> </span>
<a href="#l21.1998"></a><span id="l21.1998" class="difflineminus">-            this._animateTimer.initWithCallback(this,</span>
<a href="#l21.1999"></a><span id="l21.1999" class="difflineminus">-                         this._animateDelay,</span>
<a href="#l21.2000"></a><span id="l21.2000" class="difflineminus">-                         Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);</span>
<a href="#l21.2001"></a><span id="l21.2001" class="difflineminus">-          }</span>
<a href="#l21.2002"></a><span id="l21.2002" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2003"></a><span id="l21.2003" class="difflineplus">+              this._animateTimer.initWithCallback(this,</span>
<a href="#l21.2004"></a><span id="l21.2004" class="difflineplus">+                           this._animateDelay,</span>
<a href="#l21.2005"></a><span id="l21.2005" class="difflineplus">+                           Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);</span>
<a href="#l21.2006"></a><span id="l21.2006" class="difflineplus">+            }</span>
<a href="#l21.2007"></a><span id="l21.2007" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2008"></a><span id="l21.2008" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2009"></a><span id="l21.2009">       &lt;/method&gt;</span>
<a href="#l21.2010"></a><span id="l21.2010" class="difflineminus">-      </span>
<a href="#l21.2011"></a><span id="l21.2011" class="difflineplus">+</span>
<a href="#l21.2012"></a><span id="l21.2012">       &lt;method name=&quot;notify&quot;&gt;</span>
<a href="#l21.2013"></a><span id="l21.2013">         &lt;parameter name=&quot;aTimer&quot;/&gt;</span>
<a href="#l21.2014"></a><span id="l21.2014" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2015"></a><span id="l21.2015" class="difflineminus">-          if (!document)</span>
<a href="#l21.2016"></a><span id="l21.2016" class="difflineminus">-            aTimer.cancel();</span>
<a href="#l21.2017"></a><span id="l21.2017" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.2018"></a><span id="l21.2018" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.2019"></a><span id="l21.2019" class="difflineplus">+            if (!document)</span>
<a href="#l21.2020"></a><span id="l21.2020" class="difflineplus">+              aTimer.cancel();</span>
<a href="#l21.2021"></a><span id="l21.2021" class="difflineplus">+</span>
<a href="#l21.2022"></a><span id="l21.2022" class="difflineplus">+            let percent = this._animatePercents[this._animateStep];</span>
<a href="#l21.2023"></a><span id="l21.2023" class="difflineplus">+            this.mAllTabsBoxAnimate.style.opacity = percent;</span>
<a href="#l21.2024"></a><span id="l21.2024" class="difflineplus">+            this.mDownBoxAnimate.style.opacity = percent;</span>
<a href="#l21.2025"></a><span id="l21.2025" class="difflineplus">+</span>
<a href="#l21.2026"></a><span id="l21.2026" class="difflineplus">+            if (this._animateStep &lt; (this._animatePercents.length - 1))</span>
<a href="#l21.2027"></a><span id="l21.2027" class="difflineplus">+              this._animateStep++;</span>
<a href="#l21.2028"></a><span id="l21.2028" class="difflineplus">+            else</span>
<a href="#l21.2029"></a><span id="l21.2029" class="difflineplus">+              this._stopAnimation();</span>
<a href="#l21.2030"></a><span id="l21.2030" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2031"></a><span id="l21.2031" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2032"></a><span id="l21.2032" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.2033"></a><span id="l21.2033"> </span>
<a href="#l21.2034"></a><span id="l21.2034" class="difflineminus">-          var percent = this._animatePercents[this._animateStep];</span>
<a href="#l21.2035"></a><span id="l21.2035" class="difflineminus">-          this.mAllTabsBoxAnimate.style.opacity = percent;</span>
<a href="#l21.2036"></a><span id="l21.2036" class="difflineminus">-          this.mDownBoxAnimate.style.opacity = percent;</span>
<a href="#l21.2037"></a><span id="l21.2037" class="difflineplus">+      &lt;!-- nsIObserver implementation --&gt;</span>
<a href="#l21.2038"></a><span id="l21.2038"> </span>
<a href="#l21.2039"></a><span id="l21.2039" class="difflineminus">-          if (this._animateStep &lt; (this._animatePercents.length - 1))</span>
<a href="#l21.2040"></a><span id="l21.2040" class="difflineminus">-            this._animateStep++;</span>
<a href="#l21.2041"></a><span id="l21.2041" class="difflineminus">-          else</span>
<a href="#l21.2042"></a><span id="l21.2042" class="difflineminus">-            this._stopAnimation();</span>
<a href="#l21.2043"></a><span id="l21.2043" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2044"></a><span id="l21.2044" class="difflineplus">+      &lt;method name=&quot;observe&quot;&gt;</span>
<a href="#l21.2045"></a><span id="l21.2045" class="difflineplus">+        &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l21.2046"></a><span id="l21.2046" class="difflineplus">+        &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l21.2047"></a><span id="l21.2047" class="difflineplus">+        &lt;parameter name=&quot;aData&quot;/&gt;</span>
<a href="#l21.2048"></a><span id="l21.2048" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.2049"></a><span id="l21.2049" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.2050"></a><span id="l21.2050" class="difflineplus">+            const kCloseButtons = &quot;browser.tabs.closeButtons&quot;;</span>
<a href="#l21.2051"></a><span id="l21.2051" class="difflineplus">+            if (aTopic == &quot;nsPref:changed&quot; &amp;&amp; aData == kCloseButtons)</span>
<a href="#l21.2052"></a><span id="l21.2052" class="difflineplus">+            {</span>
<a href="#l21.2053"></a><span id="l21.2053" class="difflineplus">+              this.mCloseButtons = this.mPrefs.getIntPref(kCloseButtons);</span>
<a href="#l21.2054"></a><span id="l21.2054" class="difflineplus">+              this.adjustTabstrip();</span>
<a href="#l21.2055"></a><span id="l21.2055" class="difflineplus">+            }</span>
<a href="#l21.2056"></a><span id="l21.2056" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2057"></a><span id="l21.2057" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2058"></a><span id="l21.2058">       &lt;/method&gt;</span>
<a href="#l21.2059"></a><span id="l21.2059">     &lt;/implementation&gt;</span>
<a href="#l21.2060"></a><span id="l21.2060" class="difflineplus">+</span>
<a href="#l21.2061"></a><span id="l21.2061">     &lt;handlers&gt;</span>
<a href="#l21.2062"></a><span id="l21.2062">       &lt;handler event=&quot;TabSelect&quot; action=&quot;this._handleTabSelect();&quot;/&gt;</span>
<a href="#l21.2063"></a><span id="l21.2063" class="difflineminus">-      &lt;handler event=&quot;mouseover&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.2064"></a><span id="l21.2064" class="difflineminus">-        if (event.originalTarget == this.mAllTabsButton) {</span>
<a href="#l21.2065"></a><span id="l21.2065" class="difflineminus">-          this.mAllTabsButton</span>
<a href="#l21.2066"></a><span id="l21.2066" class="difflineminus">-              .setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l21.2067"></a><span id="l21.2067" class="difflineminus">-                            this.mAllTabsButton.getAttribute(&quot;tooltipstring&quot;));</span>
<a href="#l21.2068"></a><span id="l21.2068" class="difflineminus">-        }</span>
<a href="#l21.2069"></a><span id="l21.2069" class="difflineminus">-        else</span>
<a href="#l21.2070"></a><span id="l21.2070" class="difflineminus">-          this.mAllTabsButton.removeAttribute(&quot;tooltiptext&quot;);</span>
<a href="#l21.2071"></a><span id="l21.2071" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.2072"></a><span id="l21.2072" class="difflineplus">+</span>
<a href="#l21.2073"></a><span id="l21.2073" class="difflineplus">+      &lt;handler event=&quot;mouseover&quot;&gt;</span>
<a href="#l21.2074"></a><span id="l21.2074" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2075"></a><span id="l21.2075" class="difflineplus">+          if (event.originalTarget == this.mAllTabsButton)</span>
<a href="#l21.2076"></a><span id="l21.2076" class="difflineplus">+          {</span>
<a href="#l21.2077"></a><span id="l21.2077" class="difflineplus">+            this.mAllTabsButton</span>
<a href="#l21.2078"></a><span id="l21.2078" class="difflineplus">+                .setAttribute(&quot;tooltiptext&quot;,</span>
<a href="#l21.2079"></a><span id="l21.2079" class="difflineplus">+                              this.mAllTabsButton.getAttribute(&quot;tooltipstring&quot;));</span>
<a href="#l21.2080"></a><span id="l21.2080" class="difflineplus">+          }</span>
<a href="#l21.2081"></a><span id="l21.2081" class="difflineplus">+          else</span>
<a href="#l21.2082"></a><span id="l21.2082" class="difflineplus">+          {</span>
<a href="#l21.2083"></a><span id="l21.2083" class="difflineplus">+            this.mAllTabsButton.removeAttribute(&quot;tooltiptext&quot;);</span>
<a href="#l21.2084"></a><span id="l21.2084" class="difflineplus">+          }</span>
<a href="#l21.2085"></a><span id="l21.2085" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2086"></a><span id="l21.2086" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2087"></a><span id="l21.2087">     &lt;/handlers&gt;</span>
<a href="#l21.2088"></a><span id="l21.2088">   &lt;/binding&gt;</span>
<a href="#l21.2089"></a><span id="l21.2089" class="difflineminus">-  </span>
<a href="#l21.2090"></a><span id="l21.2090" class="difflineplus">+</span>
<a href="#l21.2091"></a><span id="l21.2091">   &lt;!-- alltabs-popup binding</span>
<a href="#l21.2092"></a><span id="l21.2092">        This binding relies on the structure of the tabbrowser binding.</span>
<a href="#l21.2093"></a><span id="l21.2093">        Therefore it should only be used as a child of the tabs element.</span>
<a href="#l21.2094"></a><span id="l21.2094">        This binding is exposed as a pseudo-public-API so themes can customize</span>
<a href="#l21.2095"></a><span id="l21.2095">        the tabbar appearance without having to be scriptable</span>
<a href="#l21.2096"></a><span id="l21.2096">        (see globalBindings.xml in Pinstripe for example).</span>
<a href="#l21.2097"></a><span id="l21.2097">   --&gt;</span>
<a href="#l21.2098"></a><span id="l21.2098">   &lt;binding id=&quot;tabmail-alltabs-popup&quot;</span>
<a href="#l21.2099"></a><span id="l21.2099">            extends=&quot;chrome://global/content/bindings/popup.xml#popup&quot;&gt;</span>
<a href="#l21.2100"></a><span id="l21.2100">     &lt;implementation implements=&quot;nsIDOMEventListener&quot;&gt;</span>
<a href="#l21.2101"></a><span id="l21.2101" class="difflineminus">-      &lt;field name=&quot;_xulWindow&quot;&gt;</span>
<a href="#l21.2102"></a><span id="l21.2102" class="difflineminus">-        null</span>
<a href="#l21.2103"></a><span id="l21.2103" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l21.2104"></a><span id="l21.2104" class="difflineminus">-</span>
<a href="#l21.2105"></a><span id="l21.2105" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l21.2106"></a><span id="l21.2106" class="difflineminus">-        // We cannot cache the XULBrowserWindow object itself since it might</span>
<a href="#l21.2107"></a><span id="l21.2107" class="difflineminus">-        // be set after this binding is constructed.</span>
<a href="#l21.2108"></a><span id="l21.2108" class="difflineminus">-        try {</span>
<a href="#l21.2109"></a><span id="l21.2109" class="difflineminus">-          this._xulWindow = </span>
<a href="#l21.2110"></a><span id="l21.2110" class="difflineminus">-            window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l21.2111"></a><span id="l21.2111" class="difflineminus">-                  .getInterface(Components.interfaces.nsIWebNavigation)</span>
<a href="#l21.2112"></a><span id="l21.2112" class="difflineminus">-                  .QueryInterface(Components.interfaces.nsIDocShellTreeItem)</span>
<a href="#l21.2113"></a><span id="l21.2113" class="difflineminus">-                  .treeOwner</span>
<a href="#l21.2114"></a><span id="l21.2114" class="difflineminus">-                  .QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l21.2115"></a><span id="l21.2115" class="difflineminus">-                  .getInterface(Components.interfaces.nsIXULWindow);</span>
<a href="#l21.2116"></a><span id="l21.2116" class="difflineminus">-        }</span>
<a href="#l21.2117"></a><span id="l21.2117" class="difflineminus">-        catch(ex) { }</span>
<a href="#l21.2118"></a><span id="l21.2118" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l21.2119"></a><span id="l21.2119" class="difflineminus">-</span>
<a href="#l21.2120"></a><span id="l21.2120" class="difflineminus">-      &lt;method name=&quot;_menuItemOnCommand&quot;&gt;</span>
<a href="#l21.2121"></a><span id="l21.2121" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.2122"></a><span id="l21.2122" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2123"></a><span id="l21.2123" class="difflineminus">-          var tabcontainer = document.getBindingParent(this);</span>
<a href="#l21.2124"></a><span id="l21.2124" class="difflineminus">-          tabcontainer.selectedItem = aEvent.target.tab;</span>
<a href="#l21.2125"></a><span id="l21.2125" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2126"></a><span id="l21.2126" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.2127"></a><span id="l21.2127" class="difflineminus">-</span>
<a href="#l21.2128"></a><span id="l21.2128" class="difflineminus">-      &lt;method name=&quot;_tabOnAttrModified&quot;&gt;</span>
<a href="#l21.2129"></a><span id="l21.2129" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.2130"></a><span id="l21.2130" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2131"></a><span id="l21.2131" class="difflineminus">-          var menuItem = aEvent.target.mCorrespondingMenuitem;</span>
<a href="#l21.2132"></a><span id="l21.2132" class="difflineminus">-          if (menuItem) {</span>
<a href="#l21.2133"></a><span id="l21.2133" class="difflineminus">-            var attrName = aEvent.attrName;</span>
<a href="#l21.2134"></a><span id="l21.2134" class="difflineminus">-            switch (attrName) {</span>
<a href="#l21.2135"></a><span id="l21.2135" class="difflineminus">-              case &quot;label&quot;:</span>
<a href="#l21.2136"></a><span id="l21.2136" class="difflineminus">-              case &quot;crop&quot;:</span>
<a href="#l21.2137"></a><span id="l21.2137" class="difflineminus">-              case &quot;busy&quot;:</span>
<a href="#l21.2138"></a><span id="l21.2138" class="difflineminus">-              case &quot;image&quot;:</span>
<a href="#l21.2139"></a><span id="l21.2139" class="difflineminus">-              case &quot;selected&quot;:</span>
<a href="#l21.2140"></a><span id="l21.2140" class="difflineminus">-                if (aEvent.attrChange == aEvent.REMOVAL)</span>
<a href="#l21.2141"></a><span id="l21.2141" class="difflineminus">-                  menuItem.removeAttribute(attrName);</span>
<a href="#l21.2142"></a><span id="l21.2142" class="difflineminus">-                else</span>
<a href="#l21.2143"></a><span id="l21.2143" class="difflineminus">-                  menuItem.setAttribute(attrName, aEvent.newValue);</span>
<a href="#l21.2144"></a><span id="l21.2144" class="difflineminus">-            }</span>
<a href="#l21.2145"></a><span id="l21.2145" class="difflineminus">-          }</span>
<a href="#l21.2146"></a><span id="l21.2146" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2147"></a><span id="l21.2147" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l21.2148"></a><span id="l21.2148" class="difflineminus">-</span>
<a href="#l21.2149"></a><span id="l21.2149">       &lt;method name=&quot;_tabOnTabClose&quot;&gt;</span>
<a href="#l21.2150"></a><span id="l21.2150">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.2151"></a><span id="l21.2151" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2152"></a><span id="l21.2152" class="difflineminus">-          var menuItem = aEvent.target.mCorrespondingMenuitem;</span>
<a href="#l21.2153"></a><span id="l21.2153" class="difflineminus">-          if (menuItem)</span>
<a href="#l21.2154"></a><span id="l21.2154" class="difflineminus">-            this.removeChild(menuItem);</span>
<a href="#l21.2155"></a><span id="l21.2155" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2156"></a><span id="l21.2156" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.2157"></a><span id="l21.2157" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.2158"></a><span id="l21.2158" class="difflineplus">+            let menuItem = aEvent.target.mCorrespondingMenuitem;</span>
<a href="#l21.2159"></a><span id="l21.2159" class="difflineplus">+            if (menuItem)</span>
<a href="#l21.2160"></a><span id="l21.2160" class="difflineplus">+              this.removeChild(menuItem);</span>
<a href="#l21.2161"></a><span id="l21.2161" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2162"></a><span id="l21.2162" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2163"></a><span id="l21.2163">       &lt;/method&gt;</span>
<a href="#l21.2164"></a><span id="l21.2164"> </span>
<a href="#l21.2165"></a><span id="l21.2165">       &lt;method name=&quot;handleEvent&quot;&gt;</span>
<a href="#l21.2166"></a><span id="l21.2166">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.2167"></a><span id="l21.2167" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2168"></a><span id="l21.2168" class="difflineminus">-          if (!aEvent.isTrusted)</span>
<a href="#l21.2169"></a><span id="l21.2169" class="difflineminus">-            return;</span>
<a href="#l21.2170"></a><span id="l21.2170" class="difflineminus">-</span>
<a href="#l21.2171"></a><span id="l21.2171" class="difflineminus">-          switch (aEvent.type) {</span>
<a href="#l21.2172"></a><span id="l21.2172" class="difflineminus">-            case &quot;command&quot;:</span>
<a href="#l21.2173"></a><span id="l21.2173" class="difflineminus">-              this._menuItemOnCommand(aEvent);</span>
<a href="#l21.2174"></a><span id="l21.2174" class="difflineminus">-              break;</span>
<a href="#l21.2175"></a><span id="l21.2175" class="difflineminus">-            case &quot;DOMAttrModified&quot;:</span>
<a href="#l21.2176"></a><span id="l21.2176" class="difflineminus">-              this._tabOnAttrModified(aEvent);</span>
<a href="#l21.2177"></a><span id="l21.2177" class="difflineminus">-              break;</span>
<a href="#l21.2178"></a><span id="l21.2178" class="difflineminus">-            case &quot;TabClose&quot;:</span>
<a href="#l21.2179"></a><span id="l21.2179" class="difflineminus">-              this._tabOnTabClose(aEvent);</span>
<a href="#l21.2180"></a><span id="l21.2180" class="difflineminus">-              break;</span>
<a href="#l21.2181"></a><span id="l21.2181" class="difflineminus">-            case &quot;TabOpen&quot;:</span>
<a href="#l21.2182"></a><span id="l21.2182" class="difflineminus">-              this._createTabMenuItem(aEvent.originalTarget);</span>
<a href="#l21.2183"></a><span id="l21.2183" class="difflineminus">-              break;</span>
<a href="#l21.2184"></a><span id="l21.2184" class="difflineminus">-            case &quot;scroll&quot;:</span>
<a href="#l21.2185"></a><span id="l21.2185" class="difflineminus">-              this._updateTabsVisibilityStatus();</span>
<a href="#l21.2186"></a><span id="l21.2186" class="difflineminus">-              break;</span>
<a href="#l21.2187"></a><span id="l21.2187" class="difflineminus">-          }</span>
<a href="#l21.2188"></a><span id="l21.2188" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2189"></a><span id="l21.2189" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.2190"></a><span id="l21.2190" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.2191"></a><span id="l21.2191" class="difflineplus">+            switch (aEvent.type)</span>
<a href="#l21.2192"></a><span id="l21.2192" class="difflineplus">+            {</span>
<a href="#l21.2193"></a><span id="l21.2193" class="difflineplus">+              case &quot;TabClose&quot;:</span>
<a href="#l21.2194"></a><span id="l21.2194" class="difflineplus">+                this._tabOnTabClose(aEvent);</span>
<a href="#l21.2195"></a><span id="l21.2195" class="difflineplus">+                break;</span>
<a href="#l21.2196"></a><span id="l21.2196" class="difflineplus">+              case &quot;TabOpen&quot;:</span>
<a href="#l21.2197"></a><span id="l21.2197" class="difflineplus">+                this._createTabMenuItem(aEvent.originalTarget);</span>
<a href="#l21.2198"></a><span id="l21.2198" class="difflineplus">+                break;</span>
<a href="#l21.2199"></a><span id="l21.2199" class="difflineplus">+              case &quot;scroll&quot;:</span>
<a href="#l21.2200"></a><span id="l21.2200" class="difflineplus">+                this._updateTabsVisibilityStatus();</span>
<a href="#l21.2201"></a><span id="l21.2201" class="difflineplus">+                break;</span>
<a href="#l21.2202"></a><span id="l21.2202" class="difflineplus">+            }</span>
<a href="#l21.2203"></a><span id="l21.2203" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2204"></a><span id="l21.2204" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2205"></a><span id="l21.2205">       &lt;/method&gt;</span>
<a href="#l21.2206"></a><span id="l21.2206"> </span>
<a href="#l21.2207"></a><span id="l21.2207">       &lt;method name=&quot;_updateTabsVisibilityStatus&quot;&gt;</span>
<a href="#l21.2208"></a><span id="l21.2208" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2209"></a><span id="l21.2209" class="difflineminus">-          var tabContainer = document.getBindingParent(this);</span>
<a href="#l21.2210"></a><span id="l21.2210" class="difflineminus">-          // We don't want menu item decoration unless there is overflow.</span>
<a href="#l21.2211"></a><span id="l21.2211" class="difflineminus">-          if (tabContainer.getAttribute(&quot;overflow&quot;) != &quot;true&quot;)</span>
<a href="#l21.2212"></a><span id="l21.2212" class="difflineminus">-            return;</span>
<a href="#l21.2213"></a><span id="l21.2213" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.2214"></a><span id="l21.2214" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.2215"></a><span id="l21.2215" class="difflineplus">+            let tabContainer = document.getBindingParent(this);</span>
<a href="#l21.2216"></a><span id="l21.2216" class="difflineplus">+            // We don't want menu item decoration unless there is overflow.</span>
<a href="#l21.2217"></a><span id="l21.2217" class="difflineplus">+            if (tabContainer.getAttribute(&quot;overflow&quot;) != &quot;true&quot;)</span>
<a href="#l21.2218"></a><span id="l21.2218" class="difflineplus">+              return;</span>
<a href="#l21.2219"></a><span id="l21.2219"> </span>
<a href="#l21.2220"></a><span id="l21.2220" class="difflineminus">-          var tabstripBO = tabContainer.mTabstrip.scrollBoxObject;</span>
<a href="#l21.2221"></a><span id="l21.2221" class="difflineminus">-          for (var i = 0; i &lt; this.childNodes.length; i++) {</span>
<a href="#l21.2222"></a><span id="l21.2222" class="difflineminus">-            var curTabBO = this.childNodes[i].tab.boxObject;</span>
<a href="#l21.2223"></a><span id="l21.2223" class="difflineminus">-            if (curTabBO.screenX &gt;= tabstripBO.screenX &amp;&amp;</span>
<a href="#l21.2224"></a><span id="l21.2224" class="difflineminus">-                curTabBO.screenX + curTabBO.width &lt;= tabstripBO.screenX + tabstripBO.width)</span>
<a href="#l21.2225"></a><span id="l21.2225" class="difflineminus">-              this.childNodes[i].setAttribute(&quot;tabIsVisible&quot;, &quot;true&quot;); </span>
<a href="#l21.2226"></a><span id="l21.2226" class="difflineminus">-            else</span>
<a href="#l21.2227"></a><span id="l21.2227" class="difflineminus">-              this.childNodes[i].removeAttribute(&quot;tabIsVisible&quot;);</span>
<a href="#l21.2228"></a><span id="l21.2228" class="difflineminus">-          }</span>
<a href="#l21.2229"></a><span id="l21.2229" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2230"></a><span id="l21.2230" class="difflineplus">+            let tabstripBO = tabContainer.mTabstrip.scrollBoxObject;</span>
<a href="#l21.2231"></a><span id="l21.2231" class="difflineplus">+            for (let i = 0; i &lt; this.childNodes.length; i++)</span>
<a href="#l21.2232"></a><span id="l21.2232" class="difflineplus">+            {</span>
<a href="#l21.2233"></a><span id="l21.2233" class="difflineplus">+              let curTabBO = this.childNodes[i].tab.boxObject;</span>
<a href="#l21.2234"></a><span id="l21.2234" class="difflineplus">+              if (curTabBO.screenX &gt;= tabstripBO.screenX &amp;&amp;</span>
<a href="#l21.2235"></a><span id="l21.2235" class="difflineplus">+                  curTabBO.screenX + curTabBO.width &lt;= tabstripBO.screenX + tabstripBO.width)</span>
<a href="#l21.2236"></a><span id="l21.2236" class="difflineplus">+                this.childNodes[i].setAttribute(&quot;tabIsVisible&quot;, &quot;true&quot;);</span>
<a href="#l21.2237"></a><span id="l21.2237" class="difflineplus">+              else</span>
<a href="#l21.2238"></a><span id="l21.2238" class="difflineplus">+                this.childNodes[i].removeAttribute(&quot;tabIsVisible&quot;);</span>
<a href="#l21.2239"></a><span id="l21.2239" class="difflineplus">+            }</span>
<a href="#l21.2240"></a><span id="l21.2240" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2241"></a><span id="l21.2241" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2242"></a><span id="l21.2242">       &lt;/method&gt;</span>
<a href="#l21.2243"></a><span id="l21.2243"> </span>
<a href="#l21.2244"></a><span id="l21.2244">       &lt;method name=&quot;_createTabMenuItem&quot;&gt;</span>
<a href="#l21.2245"></a><span id="l21.2245" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l21.2246"></a><span id="l21.2246" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.2247"></a><span id="l21.2247" class="difflineminus">-          var menuItem = document.createElementNS(</span>
<a href="#l21.2248"></a><span id="l21.2248" class="difflineminus">-            &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;, </span>
<a href="#l21.2249"></a><span id="l21.2249" class="difflineminus">-            &quot;menuitem&quot;);</span>
<a href="#l21.2250"></a><span id="l21.2250" class="difflineplus">+        &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l21.2251"></a><span id="l21.2251" class="difflineplus">+        &lt;body&gt;</span>
<a href="#l21.2252"></a><span id="l21.2252" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l21.2253"></a><span id="l21.2253" class="difflineplus">+            let menuItem = document.createElementNS(</span>
<a href="#l21.2254"></a><span id="l21.2254" class="difflineplus">+              &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l21.2255"></a><span id="l21.2255" class="difflineplus">+              &quot;menuitem&quot;);</span>
<a href="#l21.2256"></a><span id="l21.2256" class="difflineplus">+            menuItem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic alltabs-item&quot;);</span>
<a href="#l21.2257"></a><span id="l21.2257" class="difflineplus">+            menuItem.setAttribute(&quot;label&quot;, aTabNode.label);</span>
<a href="#l21.2258"></a><span id="l21.2258" class="difflineplus">+            menuItem.setAttribute(&quot;crop&quot;,  aTabNode.getAttribute(&quot;crop&quot;));</span>
<a href="#l21.2259"></a><span id="l21.2259" class="difflineplus">+            menuItem.setAttribute(&quot;image&quot;, aTabNode.getAttribute(&quot;image&quot;));</span>
<a href="#l21.2260"></a><span id="l21.2260"> </span>
<a href="#l21.2261"></a><span id="l21.2261" class="difflineminus">-          menuItem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic alltabs-item&quot;);</span>
<a href="#l21.2262"></a><span id="l21.2262" class="difflineminus">-</span>
<a href="#l21.2263"></a><span id="l21.2263" class="difflineminus">-          menuItem.setAttribute(&quot;label&quot;, aTab.label);</span>
<a href="#l21.2264"></a><span id="l21.2264" class="difflineminus">-          menuItem.setAttribute(&quot;crop&quot;, aTab.getAttribute(&quot;crop&quot;));</span>
<a href="#l21.2265"></a><span id="l21.2265" class="difflineminus">-          menuItem.setAttribute(&quot;image&quot;, aTab.getAttribute(&quot;image&quot;));</span>
<a href="#l21.2266"></a><span id="l21.2266" class="difflineplus">+            if (aTabNode.hasAttribute(&quot;busy&quot;))</span>
<a href="#l21.2267"></a><span id="l21.2267" class="difflineplus">+              menuItem.setAttribute(&quot;busy&quot;, aTabNode.getAttribute(&quot;busy&quot;));</span>
<a href="#l21.2268"></a><span id="l21.2268" class="difflineplus">+            if (aTabNode.selected)</span>
<a href="#l21.2269"></a><span id="l21.2269" class="difflineplus">+              menuItem.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l21.2270"></a><span id="l21.2270"> </span>
<a href="#l21.2271"></a><span id="l21.2271" class="difflineminus">-          if (aTab.hasAttribute(&quot;busy&quot;))</span>
<a href="#l21.2272"></a><span id="l21.2272" class="difflineminus">-            menuItem.setAttribute(&quot;busy&quot;, aTab.getAttribute(&quot;busy&quot;));</span>
<a href="#l21.2273"></a><span id="l21.2273" class="difflineminus">-          if (aTab.selected)</span>
<a href="#l21.2274"></a><span id="l21.2274" class="difflineminus">-            menuItem.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l21.2275"></a><span id="l21.2275" class="difflineminus">-</span>
<a href="#l21.2276"></a><span id="l21.2276" class="difflineminus">-          // Keep some attributes of the menuitem in sync with its</span>
<a href="#l21.2277"></a><span id="l21.2277" class="difflineminus">-          // corresponding tab (e.g. the tab label)</span>
<a href="#l21.2278"></a><span id="l21.2278" class="difflineminus">-          aTab.mCorrespondingMenuitem = menuItem;</span>
<a href="#l21.2279"></a><span id="l21.2279" class="difflineminus">-          aTab.addEventListener(&quot;DOMAttrModified&quot;, this, false);</span>
<a href="#l21.2280"></a><span id="l21.2280" class="difflineminus">-          aTab.addEventListener(&quot;TabClose&quot;, this, false);</span>
<a href="#l21.2281"></a><span id="l21.2281" class="difflineminus">-          menuItem.tab = aTab;</span>
<a href="#l21.2282"></a><span id="l21.2282" class="difflineminus">-          menuItem.addEventListener(&quot;command&quot;, this, false);</span>
<a href="#l21.2283"></a><span id="l21.2283" class="difflineminus">-</span>
<a href="#l21.2284"></a><span id="l21.2284" class="difflineminus">-          this.appendChild(menuItem);</span>
<a href="#l21.2285"></a><span id="l21.2285" class="difflineminus">-          return menuItem;</span>
<a href="#l21.2286"></a><span id="l21.2286" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.2287"></a><span id="l21.2287" class="difflineplus">+            // Keep some attributes of the menuitem in sync with its</span>
<a href="#l21.2288"></a><span id="l21.2288" class="difflineplus">+            // corresponding tab (e.g. the tab label)</span>
<a href="#l21.2289"></a><span id="l21.2289" class="difflineplus">+            aTabNode.mCorrespondingMenuitem = menuItem;</span>
<a href="#l21.2290"></a><span id="l21.2290" class="difflineplus">+            document.addBroadcastListenerFor(aTabNode, menuItem, &quot;label&quot;);</span>
<a href="#l21.2291"></a><span id="l21.2291" class="difflineplus">+            document.addBroadcastListenerFor(aTabNode, menuItem, &quot;crop&quot;);</span>
<a href="#l21.2292"></a><span id="l21.2292" class="difflineplus">+            document.addBroadcastListenerFor(aTabNode, menuItem, &quot;image&quot;);</span>
<a href="#l21.2293"></a><span id="l21.2293" class="difflineplus">+            document.addBroadcastListenerFor(aTabNode, menuItem, &quot;busy&quot;);</span>
<a href="#l21.2294"></a><span id="l21.2294" class="difflineplus">+            document.addBroadcastListenerFor(aTabNode, menuItem, &quot;selected&quot;);</span>
<a href="#l21.2295"></a><span id="l21.2295" class="difflineplus">+            aTabNode.addEventListener(&quot;TabClose&quot;, this, false);</span>
<a href="#l21.2296"></a><span id="l21.2296" class="difflineplus">+            menuItem.tab = aTabNode;</span>
<a href="#l21.2297"></a><span id="l21.2297" class="difflineplus">+            menuItem.addEventListener(&quot;command&quot;, this, false);</span>
<a href="#l21.2298"></a><span id="l21.2298" class="difflineplus">+            this.appendChild(menuItem);</span>
<a href="#l21.2299"></a><span id="l21.2299" class="difflineplus">+            return menuItem;</span>
<a href="#l21.2300"></a><span id="l21.2300" class="difflineplus">+          ]]&gt;</span>
<a href="#l21.2301"></a><span id="l21.2301" class="difflineplus">+        &lt;/body&gt;</span>
<a href="#l21.2302"></a><span id="l21.2302">       &lt;/method&gt;</span>
<a href="#l21.2303"></a><span id="l21.2303">     &lt;/implementation&gt;</span>
<a href="#l21.2304"></a><span id="l21.2304"> </span>
<a href="#l21.2305"></a><span id="l21.2305">     &lt;handlers&gt;</span>
<a href="#l21.2306"></a><span id="l21.2306">       &lt;handler event=&quot;popupshowing&quot;&gt;</span>
<a href="#l21.2307"></a><span id="l21.2307" class="difflineminus">-      &lt;![CDATA[</span>
<a href="#l21.2308"></a><span id="l21.2308" class="difflineminus">-        // set up the menu popup</span>
<a href="#l21.2309"></a><span id="l21.2309" class="difflineminus">-        var tabcontainer = document.getBindingParent(this);</span>
<a href="#l21.2310"></a><span id="l21.2310" class="difflineminus">-        var tabs = tabcontainer.childNodes;</span>
<a href="#l21.2311"></a><span id="l21.2311" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2312"></a><span id="l21.2312" class="difflineplus">+          // set up the menu popup</span>
<a href="#l21.2313"></a><span id="l21.2313" class="difflineplus">+          let tabcontainer = document.getBindingParent(this);</span>
<a href="#l21.2314"></a><span id="l21.2314" class="difflineplus">+          let tabs = tabcontainer.childNodes;</span>
<a href="#l21.2315"></a><span id="l21.2315"> </span>
<a href="#l21.2316"></a><span id="l21.2316" class="difflineminus">-        // Listen for changes in the tab bar.</span>
<a href="#l21.2317"></a><span id="l21.2317" class="difflineminus">-        var tabbrowser = document.getBindingParent(tabcontainer);</span>
<a href="#l21.2318"></a><span id="l21.2318" class="difflineminus">-        tabbrowser.addEventListener(&quot;TabOpen&quot;, this, false);</span>
<a href="#l21.2319"></a><span id="l21.2319" class="difflineminus">-        tabcontainer.mTabstrip.addEventListener(&quot;scroll&quot;, this, false);</span>
<a href="#l21.2320"></a><span id="l21.2320" class="difflineplus">+          // Listen for changes in the tab bar.</span>
<a href="#l21.2321"></a><span id="l21.2321" class="difflineplus">+          let tabbrowser = document.getBindingParent(tabcontainer);</span>
<a href="#l21.2322"></a><span id="l21.2322" class="difflineplus">+          tabbrowser.addEventListener(&quot;TabOpen&quot;, this, false);</span>
<a href="#l21.2323"></a><span id="l21.2323" class="difflineplus">+          tabcontainer.mTabstrip.addEventListener(&quot;scroll&quot;, this, false);</span>
<a href="#l21.2324"></a><span id="l21.2324"> </span>
<a href="#l21.2325"></a><span id="l21.2325" class="difflineminus">-        // if an animation is in progress and the user</span>
<a href="#l21.2326"></a><span id="l21.2326" class="difflineminus">-        // clicks on the &quot;all tabs&quot; button, stop the animation</span>
<a href="#l21.2327"></a><span id="l21.2327" class="difflineminus">-        tabcontainer._stopAnimation();</span>
<a href="#l21.2328"></a><span id="l21.2328" class="difflineplus">+          // if an animation is in progress and the user</span>
<a href="#l21.2329"></a><span id="l21.2329" class="difflineplus">+          // clicks on the &quot;all tabs&quot; button, stop the animation</span>
<a href="#l21.2330"></a><span id="l21.2330" class="difflineplus">+          tabcontainer._stopAnimation();</span>
<a href="#l21.2331"></a><span id="l21.2331"> </span>
<a href="#l21.2332"></a><span id="l21.2332" class="difflineminus">-        for (var i = 0; i &lt; tabs.length; i++) {</span>
<a href="#l21.2333"></a><span id="l21.2333" class="difflineminus">-          this._createTabMenuItem(tabs[i]);</span>
<a href="#l21.2334"></a><span id="l21.2334" class="difflineminus">-        }</span>
<a href="#l21.2335"></a><span id="l21.2335" class="difflineminus">-        this._updateTabsVisibilityStatus();</span>
<a href="#l21.2336"></a><span id="l21.2336" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.2337"></a><span id="l21.2337" class="difflineplus">+          for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l21.2338"></a><span id="l21.2338" class="difflineplus">+            this._createTabMenuItem(tabs[i]);</span>
<a href="#l21.2339"></a><span id="l21.2339" class="difflineplus">+          this._updateTabsVisibilityStatus();</span>
<a href="#l21.2340"></a><span id="l21.2340" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2341"></a><span id="l21.2341" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2342"></a><span id="l21.2342"> </span>
<a href="#l21.2343"></a><span id="l21.2343">       &lt;handler event=&quot;popuphiding&quot;&gt;</span>
<a href="#l21.2344"></a><span id="l21.2344" class="difflineminus">-      &lt;![CDATA[</span>
<a href="#l21.2345"></a><span id="l21.2345" class="difflineminus">-        // clear out the menu popup and remove the listeners</span>
<a href="#l21.2346"></a><span id="l21.2346" class="difflineminus">-        while (this.hasChildNodes()) {</span>
<a href="#l21.2347"></a><span id="l21.2347" class="difflineminus">-          var menuItem = this.lastChild;</span>
<a href="#l21.2348"></a><span id="l21.2348" class="difflineminus">-          menuItem.removeEventListener(&quot;command&quot;, this, false);</span>
<a href="#l21.2349"></a><span id="l21.2349" class="difflineminus">-          menuItem.tab.removeEventListener(&quot;DOMAttrModified&quot;, this, false);</span>
<a href="#l21.2350"></a><span id="l21.2350" class="difflineminus">-          menuItem.tab.removeEventListener(&quot;TabClose&quot;, this, false);</span>
<a href="#l21.2351"></a><span id="l21.2351" class="difflineminus">-          menuItem.tab.mCorrespondingMenuitem = null;</span>
<a href="#l21.2352"></a><span id="l21.2352" class="difflineminus">-          this.removeChild(menuItem);</span>
<a href="#l21.2353"></a><span id="l21.2353" class="difflineminus">-        }</span>
<a href="#l21.2354"></a><span id="l21.2354" class="difflineminus">-        var tabcontainer = document.getBindingParent(this);</span>
<a href="#l21.2355"></a><span id="l21.2355" class="difflineminus">-        tabcontainer.mTabstrip.removeEventListener(&quot;scroll&quot;, this, false);</span>
<a href="#l21.2356"></a><span id="l21.2356" class="difflineminus">-        document.getBindingParent(tabcontainer).removeEventListener(&quot;TabOpen&quot;, this, false);</span>
<a href="#l21.2357"></a><span id="l21.2357" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.2358"></a><span id="l21.2358" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2359"></a><span id="l21.2359" class="difflineplus">+          // clear out the menu popup and remove the listeners</span>
<a href="#l21.2360"></a><span id="l21.2360" class="difflineplus">+          while (this.hasChildNodes())</span>
<a href="#l21.2361"></a><span id="l21.2361" class="difflineplus">+          {</span>
<a href="#l21.2362"></a><span id="l21.2362" class="difflineplus">+            let menuItem = this.lastChild;</span>
<a href="#l21.2363"></a><span id="l21.2363" class="difflineplus">+            document.removeBroadcastListenerFor(menuItem.tab, menuItem, &quot;label&quot;);</span>
<a href="#l21.2364"></a><span id="l21.2364" class="difflineplus">+            document.removeBroadcastListenerFor(menuItem.tab, menuItem, &quot;crop&quot;);</span>
<a href="#l21.2365"></a><span id="l21.2365" class="difflineplus">+            document.removeBroadcastListenerFor(menuItem.tab, menuItem, &quot;image&quot;);</span>
<a href="#l21.2366"></a><span id="l21.2366" class="difflineplus">+            document.removeBroadcastListenerFor(menuItem.tab, menuItem, &quot;busy&quot;);</span>
<a href="#l21.2367"></a><span id="l21.2367" class="difflineplus">+            document.removeBroadcastListenerFor(menuItem.tab, menuItem, &quot;selected&quot;);</span>
<a href="#l21.2368"></a><span id="l21.2368" class="difflineplus">+            menuItem.removeEventListener(&quot;command&quot;, this, false);</span>
<a href="#l21.2369"></a><span id="l21.2369" class="difflineplus">+            menuItem.tab.removeEventListener(&quot;TabClose&quot;, this, false);</span>
<a href="#l21.2370"></a><span id="l21.2370" class="difflineplus">+            menuItem.tab.mCorrespondingMenuitem = null;</span>
<a href="#l21.2371"></a><span id="l21.2371" class="difflineplus">+            this.removeChild(menuItem);</span>
<a href="#l21.2372"></a><span id="l21.2372" class="difflineplus">+          }</span>
<a href="#l21.2373"></a><span id="l21.2373" class="difflineplus">+          let tabcontainer = document.getBindingParent(this);</span>
<a href="#l21.2374"></a><span id="l21.2374" class="difflineplus">+          tabcontainer.mTabstrip.removeEventListener(&quot;scroll&quot;, this, false);</span>
<a href="#l21.2375"></a><span id="l21.2375" class="difflineplus">+          document.getBindingParent(tabcontainer).removeEventListener(&quot;TabOpen&quot;, this, false);</span>
<a href="#l21.2376"></a><span id="l21.2376" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2377"></a><span id="l21.2377" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2378"></a><span id="l21.2378" class="difflineplus">+</span>
<a href="#l21.2379"></a><span id="l21.2379" class="difflineplus">+      &lt;handler event=&quot;command&quot;&gt;</span>
<a href="#l21.2380"></a><span id="l21.2380" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2381"></a><span id="l21.2381" class="difflineplus">+          let tabcontainer = document.getBindingParent(this);</span>
<a href="#l21.2382"></a><span id="l21.2382" class="difflineplus">+          tabcontainer.selectedItem = event.target.tab;</span>
<a href="#l21.2383"></a><span id="l21.2383" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2384"></a><span id="l21.2384" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2385"></a><span id="l21.2385">     &lt;/handlers&gt;</span>
<a href="#l21.2386"></a><span id="l21.2386">   &lt;/binding&gt;</span>
<a href="#l21.2387"></a><span id="l21.2387" class="difflineminus">-  &lt;!-- close-tab-button binding</span>
<a href="#l21.2388"></a><span id="l21.2388" class="difflineminus">-       This binding relies on the structure of the tabbrowser binding.</span>
<a href="#l21.2389"></a><span id="l21.2389" class="difflineminus">-       Therefore it should only be used as a child of the tab or the tabs</span>
<a href="#l21.2390"></a><span id="l21.2390" class="difflineplus">+</span>
<a href="#l21.2391"></a><span id="l21.2391" class="difflineplus">+  &lt;!-- new-tab-button/close-tab-button binding</span>
<a href="#l21.2392"></a><span id="l21.2392" class="difflineplus">+       These bindings rely on the structure of the tabbrowser binding.</span>
<a href="#l21.2393"></a><span id="l21.2393" class="difflineplus">+       Therefore they should only be used as a child of the tab or the tabs</span>
<a href="#l21.2394"></a><span id="l21.2394">        element (in both cases, when they are anonymous nodes of &lt;tabbrowser&gt;).</span>
<a href="#l21.2395"></a><span id="l21.2395" class="difflineminus">-       This binding is exposed as a pseudo-public-API so themes can customize</span>
<a href="#l21.2396"></a><span id="l21.2396" class="difflineplus">+       These bindings are exposed as pseudo-public-APIs, so themes can customize</span>
<a href="#l21.2397"></a><span id="l21.2397">        the tabbar appearance without having to be scriptable</span>
<a href="#l21.2398"></a><span id="l21.2398">        (see globalBindings.xml in Pinstripe for example).</span>
<a href="#l21.2399"></a><span id="l21.2399">   --&gt;</span>
<a href="#l21.2400"></a><span id="l21.2400" class="difflineplus">+  &lt;binding id=&quot;tabmail-new-tab-button&quot;</span>
<a href="#l21.2401"></a><span id="l21.2401" class="difflineplus">+           extends=&quot;chrome://global/content/bindings/toolbarbutton.xml#toolbarbutton-image&quot;&gt;</span>
<a href="#l21.2402"></a><span id="l21.2402" class="difflineplus">+    &lt;handlers&gt;</span>
<a href="#l21.2403"></a><span id="l21.2403" class="difflineplus">+      &lt;handler event=&quot;command&quot;&gt;</span>
<a href="#l21.2404"></a><span id="l21.2404" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2405"></a><span id="l21.2405" class="difflineplus">+          let bindingParent = document.getBindingParent(this);</span>
<a href="#l21.2406"></a><span id="l21.2406" class="difflineplus">+          if (bindingParent)</span>
<a href="#l21.2407"></a><span id="l21.2407" class="difflineplus">+          {</span>
<a href="#l21.2408"></a><span id="l21.2408" class="difflineplus">+            let tabmail = document.getBindingParent(bindingParent);</span>
<a href="#l21.2409"></a><span id="l21.2409" class="difflineplus">+            if (bindingParent.localName == &quot;tabs&quot;)</span>
<a href="#l21.2410"></a><span id="l21.2410" class="difflineplus">+            {</span>
<a href="#l21.2411"></a><span id="l21.2411" class="difflineplus">+              // new-tab-button only appears in the tabstrip</span>
<a href="#l21.2412"></a><span id="l21.2412" class="difflineplus">+              // duplicate the current tab</span>
<a href="#l21.2413"></a><span id="l21.2413" class="difflineplus">+              tabmail.openTab();</span>
<a href="#l21.2414"></a><span id="l21.2414" class="difflineplus">+            }</span>
<a href="#l21.2415"></a><span id="l21.2415" class="difflineplus">+          }</span>
<a href="#l21.2416"></a><span id="l21.2416" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2417"></a><span id="l21.2417" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2418"></a><span id="l21.2418" class="difflineplus">+      &lt;handler event=&quot;dblclick&quot; button=&quot;0&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l21.2419"></a><span id="l21.2419" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2420"></a><span id="l21.2420" class="difflineplus">+          event.stopPropagation();</span>
<a href="#l21.2421"></a><span id="l21.2421" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2422"></a><span id="l21.2422" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2423"></a><span id="l21.2423" class="difflineplus">+    &lt;/handlers&gt;</span>
<a href="#l21.2424"></a><span id="l21.2424" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l21.2425"></a><span id="l21.2425" class="difflineplus">+</span>
<a href="#l21.2426"></a><span id="l21.2426">   &lt;binding id=&quot;tabmail-close-tab-button&quot;</span>
<a href="#l21.2427"></a><span id="l21.2427">            extends=&quot;chrome://global/content/bindings/toolbarbutton.xml#toolbarbutton-image&quot;&gt;</span>
<a href="#l21.2428"></a><span id="l21.2428">     &lt;handlers&gt;</span>
<a href="#l21.2429"></a><span id="l21.2429" class="difflineminus">-      &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l21.2430"></a><span id="l21.2430" class="difflineminus">-        var bindingParent = document.getBindingParent(this);</span>
<a href="#l21.2431"></a><span id="l21.2431" class="difflineminus">-        if (bindingParent) {</span>
<a href="#l21.2432"></a><span id="l21.2432" class="difflineminus">-          var tabbedBrowser = document.getBindingParent(bindingParent);</span>
<a href="#l21.2433"></a><span id="l21.2433" class="difflineminus">-          if (bindingParent.localName == &quot;tab&quot;) {</span>
<a href="#l21.2434"></a><span id="l21.2434" class="difflineminus">-            /* The only sequence in which a second click event (i.e. dblclik)</span>
<a href="#l21.2435"></a><span id="l21.2435" class="difflineminus">-             * can be dispatched on an in-tab close button is when it is shown</span>
<a href="#l21.2436"></a><span id="l21.2436" class="difflineminus">-             * after the first click (i.e. the first click event was dispatched</span>
<a href="#l21.2437"></a><span id="l21.2437" class="difflineminus">-             * on the tab). This happens when we show the close button only on</span>
<a href="#l21.2438"></a><span id="l21.2438" class="difflineminus">-             * the active tab. (bug 352021)</span>
<a href="#l21.2439"></a><span id="l21.2439" class="difflineminus">-             * The only sequence in which a third click event can be dispatched</span>
<a href="#l21.2440"></a><span id="l21.2440" class="difflineminus">-             * on an in-tab close button is when the tab was opened with a</span>
<a href="#l21.2441"></a><span id="l21.2441" class="difflineminus">-             * double click on the tabbar. (bug 378344)</span>
<a href="#l21.2442"></a><span id="l21.2442" class="difflineminus">-             * In both cases, it is most likely that the close button area has</span>
<a href="#l21.2443"></a><span id="l21.2443" class="difflineminus">-             * been accidentally clicked, therefore we do not close the tab.</span>
<a href="#l21.2444"></a><span id="l21.2444" class="difflineminus">-             */</span>
<a href="#l21.2445"></a><span id="l21.2445" class="difflineminus">-            if (event.detail &gt; 1)</span>
<a href="#l21.2446"></a><span id="l21.2446" class="difflineminus">-              return;</span>
<a href="#l21.2447"></a><span id="l21.2447" class="difflineplus">+      &lt;handler event=&quot;command&quot;&gt;</span>
<a href="#l21.2448"></a><span id="l21.2448" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2449"></a><span id="l21.2449" class="difflineplus">+          let bindingParent = document.getBindingParent(this);</span>
<a href="#l21.2450"></a><span id="l21.2450" class="difflineplus">+          if (bindingParent)</span>
<a href="#l21.2451"></a><span id="l21.2451" class="difflineplus">+          {</span>
<a href="#l21.2452"></a><span id="l21.2452" class="difflineplus">+            let tabmail = document.getBindingParent(bindingParent);</span>
<a href="#l21.2453"></a><span id="l21.2453" class="difflineplus">+            if (bindingParent.localName == &quot;tab&quot;)</span>
<a href="#l21.2454"></a><span id="l21.2454" class="difflineplus">+            {</span>
<a href="#l21.2455"></a><span id="l21.2455" class="difflineplus">+              /* The only sequence in which a second click event (i.e. dblclik)</span>
<a href="#l21.2456"></a><span id="l21.2456" class="difflineplus">+               * can be dispatched on an in-tab close button is when it is shown</span>
<a href="#l21.2457"></a><span id="l21.2457" class="difflineplus">+               * after the first click (i.e. the first click event was dispatched</span>
<a href="#l21.2458"></a><span id="l21.2458" class="difflineplus">+               * on the tab). This happens when we show the close button only on</span>
<a href="#l21.2459"></a><span id="l21.2459" class="difflineplus">+               * the active tab. (bug 352021)</span>
<a href="#l21.2460"></a><span id="l21.2460" class="difflineplus">+               * The only sequence in which a third click event can be dispatched</span>
<a href="#l21.2461"></a><span id="l21.2461" class="difflineplus">+               * on an in-tab close button is when the tab was opened with a</span>
<a href="#l21.2462"></a><span id="l21.2462" class="difflineplus">+               * double click on the tabbar. (bug 378344)</span>
<a href="#l21.2463"></a><span id="l21.2463" class="difflineplus">+               * In both cases, it is most likely that the close button area has</span>
<a href="#l21.2464"></a><span id="l21.2464" class="difflineplus">+               * been accidentally clicked, therefore we do not close the tab.</span>
<a href="#l21.2465"></a><span id="l21.2465" class="difflineplus">+               */</span>
<a href="#l21.2466"></a><span id="l21.2466" class="difflineplus">+              if (event.detail &gt; 1)</span>
<a href="#l21.2467"></a><span id="l21.2467" class="difflineplus">+                return;</span>
<a href="#l21.2468"></a><span id="l21.2468"> </span>
<a href="#l21.2469"></a><span id="l21.2469" class="difflineminus">-            tabbedBrowser.removeTabByNode(bindingParent);</span>
<a href="#l21.2470"></a><span id="l21.2470" class="difflineminus">-            tabbedBrowser._blockDblClick = true;</span>
<a href="#l21.2471"></a><span id="l21.2471" class="difflineplus">+              tabmail.removeTab(bindingParent);</span>
<a href="#l21.2472"></a><span id="l21.2472" class="difflineplus">+              tabmail._blockDblClick = true;</span>
<a href="#l21.2473"></a><span id="l21.2473"> </span>
<a href="#l21.2474"></a><span id="l21.2474" class="difflineminus">-            /* XXXmano hack (see bug 343628):</span>
<a href="#l21.2475"></a><span id="l21.2475" class="difflineminus">-             * Since we're removing the event target, if the user</span>
<a href="#l21.2476"></a><span id="l21.2476" class="difflineminus">-             * double-clicks this button, the dblclick event will be dispatched</span>
<a href="#l21.2477"></a><span id="l21.2477" class="difflineminus">-             * with the tabbar as its event target (and explicit/originalTarget),</span>
<a href="#l21.2478"></a><span id="l21.2478" class="difflineminus">-             * which treats that as a mouse gesture for opening a new tab.</span>
<a href="#l21.2479"></a><span id="l21.2479" class="difflineminus">-             * In this context, we're manually blocking the dblclick event</span>
<a href="#l21.2480"></a><span id="l21.2480" class="difflineminus">-             * (see onTabBarDblClick).</span>
<a href="#l21.2481"></a><span id="l21.2481" class="difflineminus">-             */</span>
<a href="#l21.2482"></a><span id="l21.2482" class="difflineminus">-            var clickedOnce = false;</span>
<a href="#l21.2483"></a><span id="l21.2483" class="difflineminus">-            function enableDblClick(event) {</span>
<a href="#l21.2484"></a><span id="l21.2484" class="difflineminus">-              if (event.detail == 1 &amp;&amp; !clickedOnce) {</span>
<a href="#l21.2485"></a><span id="l21.2485" class="difflineminus">-                clickedOnce = true;</span>
<a href="#l21.2486"></a><span id="l21.2486" class="difflineminus">-                return;</span>
<a href="#l21.2487"></a><span id="l21.2487" class="difflineplus">+              /* XXXmano hack (see bug 343628):</span>
<a href="#l21.2488"></a><span id="l21.2488" class="difflineplus">+               * Since we're removing the event target, if the user</span>
<a href="#l21.2489"></a><span id="l21.2489" class="difflineplus">+               * double-clicks this button, the dblclick event will be dispatched</span>
<a href="#l21.2490"></a><span id="l21.2490" class="difflineplus">+               * with the tabbar as its event target (and explicit/originalTarget),</span>
<a href="#l21.2491"></a><span id="l21.2491" class="difflineplus">+               * which treats that as a mouse gesture for opening a new tab.</span>
<a href="#l21.2492"></a><span id="l21.2492" class="difflineplus">+               * In this context, we're manually blocking the dblclick event</span>
<a href="#l21.2493"></a><span id="l21.2493" class="difflineplus">+               * (see onTabBarDblClick).</span>
<a href="#l21.2494"></a><span id="l21.2494" class="difflineplus">+               */</span>
<a href="#l21.2495"></a><span id="l21.2495" class="difflineplus">+              let clickedOnce = false;</span>
<a href="#l21.2496"></a><span id="l21.2496" class="difflineplus">+              function enableDblClick(event)</span>
<a href="#l21.2497"></a><span id="l21.2497" class="difflineplus">+              {</span>
<a href="#l21.2498"></a><span id="l21.2498" class="difflineplus">+                if (event.detail == 1 &amp;&amp; !clickedOnce)</span>
<a href="#l21.2499"></a><span id="l21.2499" class="difflineplus">+                {</span>
<a href="#l21.2500"></a><span id="l21.2500" class="difflineplus">+                  clickedOnce = true;</span>
<a href="#l21.2501"></a><span id="l21.2501" class="difflineplus">+                  return;</span>
<a href="#l21.2502"></a><span id="l21.2502" class="difflineplus">+                }</span>
<a href="#l21.2503"></a><span id="l21.2503" class="difflineplus">+                setTimeout(function()</span>
<a href="#l21.2504"></a><span id="l21.2504" class="difflineplus">+                {</span>
<a href="#l21.2505"></a><span id="l21.2505" class="difflineplus">+                  tabmail._blockDblClick = false;</span>
<a href="#l21.2506"></a><span id="l21.2506" class="difflineplus">+                }, 0);</span>
<a href="#l21.2507"></a><span id="l21.2507" class="difflineplus">+                tabmail.removeEventListener(&quot;click&quot;, enableDblClick, false);</span>
<a href="#l21.2508"></a><span id="l21.2508">               }</span>
<a href="#l21.2509"></a><span id="l21.2509" class="difflineminus">-              setTimeout(function() {</span>
<a href="#l21.2510"></a><span id="l21.2510" class="difflineminus">-                tabbedBrowser._blockDblClick = false;</span>
<a href="#l21.2511"></a><span id="l21.2511" class="difflineminus">-              }, 0);</span>
<a href="#l21.2512"></a><span id="l21.2512" class="difflineminus">-              tabbedBrowser.removeEventListener(&quot;click&quot;, enableDblClick, false);</span>
<a href="#l21.2513"></a><span id="l21.2513" class="difflineplus">+              tabmail.addEventListener(&quot;click&quot;, enableDblClick, false);</span>
<a href="#l21.2514"></a><span id="l21.2514">             }</span>
<a href="#l21.2515"></a><span id="l21.2515" class="difflineminus">-            tabbedBrowser.addEventListener(&quot;click&quot;, enableDblClick, false);</span>
<a href="#l21.2516"></a><span id="l21.2516" class="difflineplus">+            else</span>
<a href="#l21.2517"></a><span id="l21.2517" class="difflineplus">+            {</span>
<a href="#l21.2518"></a><span id="l21.2518" class="difflineplus">+              // &quot;tabs&quot;</span>
<a href="#l21.2519"></a><span id="l21.2519" class="difflineplus">+              tabmail.removeCurrentTab();</span>
<a href="#l21.2520"></a><span id="l21.2520" class="difflineplus">+            }</span>
<a href="#l21.2521"></a><span id="l21.2521">           }</span>
<a href="#l21.2522"></a><span id="l21.2522" class="difflineminus">-          else // &quot;tabs&quot;</span>
<a href="#l21.2523"></a><span id="l21.2523" class="difflineminus">-            tabbedBrowser.removeCurrentTab();</span>
<a href="#l21.2524"></a><span id="l21.2524" class="difflineminus">-        }</span>
<a href="#l21.2525"></a><span id="l21.2525" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l21.2526"></a><span id="l21.2526" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2527"></a><span id="l21.2527" class="difflineplus">+      &lt;/handler&gt;</span>
<a href="#l21.2528"></a><span id="l21.2528">       &lt;handler event=&quot;dblclick&quot; button=&quot;0&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l21.2529"></a><span id="l21.2529" class="difflineminus">-        // for the one-close-button case</span>
<a href="#l21.2530"></a><span id="l21.2530" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l21.2531"></a><span id="l21.2531" class="difflineplus">+        &lt;![CDATA[</span>
<a href="#l21.2532"></a><span id="l21.2532" class="difflineplus">+          // for the one-close-button case</span>
<a href="#l21.2533"></a><span id="l21.2533" class="difflineplus">+          event.stopPropagation();</span>
<a href="#l21.2534"></a><span id="l21.2534" class="difflineplus">+        ]]&gt;</span>
<a href="#l21.2535"></a><span id="l21.2535">       &lt;/handler&gt;</span>
<a href="#l21.2536"></a><span id="l21.2536">     &lt;/handlers&gt;</span>
<a href="#l21.2537"></a><span id="l21.2537">   &lt;/binding&gt;</span>
<a href="#l21.2538"></a><span id="l21.2538"> </span>
<a href="#l21.2539"></a><span id="l21.2539"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/mailnews/threadPane.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/mailnews/threadPane.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.8"></a><span id="l22.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l22.9"></a><span id="l22.9">  *</span>
<a href="#l22.10"></a><span id="l22.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l22.11"></a><span id="l22.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l22.12"></a><span id="l22.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l22.13"></a><span id="l22.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l22.14"></a><span id="l22.14">  *</span>
<a href="#l22.15"></a><span id="l22.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineat">@@ -16,16 +16,17 @@</span>
<a href="#l22.17"></a><span id="l22.17">  * March 31, 1998.</span>
<a href="#l22.18"></a><span id="l22.18">  *</span>
<a href="#l22.19"></a><span id="l22.19">  * The Initial Developer of the Original Code is</span>
<a href="#l22.20"></a><span id="l22.20">  * Netscape Communications Corporation.</span>
<a href="#l22.21"></a><span id="l22.21">  * Portions created by the Initial Developer are Copyright (C) 1998-1999</span>
<a href="#l22.22"></a><span id="l22.22">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l22.23"></a><span id="l22.23">  *</span>
<a href="#l22.24"></a><span id="l22.24">  * Contributor(s):</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+ *   Karsten Dsterloh &lt;mnyromyr@tprac.de&gt;</span>
<a href="#l22.26"></a><span id="l22.26">  *</span>
<a href="#l22.27"></a><span id="l22.27">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l22.28"></a><span id="l22.28">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l22.29"></a><span id="l22.29">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l22.30"></a><span id="l22.30">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l22.31"></a><span id="l22.31">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l22.32"></a><span id="l22.32">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l22.33"></a><span id="l22.33">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineat">@@ -36,63 +37,74 @@</span>
<a href="#l22.35"></a><span id="l22.35">  *</span>
<a href="#l22.36"></a><span id="l22.36">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.37"></a><span id="l22.37"> </span>
<a href="#l22.38"></a><span id="l22.38"> var gLastMessageUriToLoad = null;</span>
<a href="#l22.39"></a><span id="l22.39"> var gThreadPaneCommandUpdater = null;</span>
<a href="#l22.40"></a><span id="l22.40"> </span>
<a href="#l22.41"></a><span id="l22.41"> function ThreadPaneOnClick(event)</span>
<a href="#l22.42"></a><span id="l22.42"> {</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-    // we only care about button 0 (left click) events</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-    if (event.button != 0) return;</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+  // we may want to open the message in a new tab on middle click</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+  if (event.button == kMouseButtonMiddle)</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+  {</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+    if (AllowOpenTabOnMiddleClick())</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+    {</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineplus">+      // we don't allow new tabs in the search dialog</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+      if (&quot;RestoreSelectionWithoutContentLoad&quot; in window)</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+      {</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+        MsgOpenNewTabForMessage();</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+        RestoreSelectionWithoutContentLoad(GetThreadTree());</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineplus">+      }</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineplus">+      return;</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+    }</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+  }</span>
<a href="#l22.59"></a><span id="l22.59"> </span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-    // we are already handling marking as read and flagging</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-    // in nsMsgDBView.cpp</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-    // so all we need to worry about here is double clicks</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineminus">-    // and column header.</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineminus">-    //</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineminus">-    // we get in here for clicks on the &quot;treecol&quot; (headers)</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-    // and the &quot;scrollbarbutton&quot; (scrollbar buttons)</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-    // we don't want those events to cause a &quot;double click&quot;</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineminus">-</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-    var t = event.originalTarget;</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-    if (t.localName == &quot;treecol&quot;) {</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-       HandleColumnClick(t.id);</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineminus">-    }</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineminus">-    else if (t.localName == &quot;treechildren&quot;) {</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-      var row = new Object;</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-      var col = new Object;</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineminus">-      var childElt = new Object;</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+  // otherwise, we only care about left click events</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+  if (event.button != kMouseButtonLeft)</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+    return;</span>
<a href="#l22.81"></a><span id="l22.81"> </span>
<a href="#l22.82"></a><span id="l22.82" class="difflineminus">-      var tree = GetThreadTree();</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineminus">-      // figure out what cell the click was in</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineminus">-      tree.treeBoxObject.getCellAt(event.clientX, event.clientY, row, col, childElt);</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineminus">-      if (row.value == -1)</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineminus">-       return;</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineplus">+  // We are already handling marking as read and flagging in nsMsgDBView.cpp,</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineplus">+  // so all we need to worry about here is double clicks and column header.</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+  // We also get in here for clicks on the &quot;treecol&quot; (headers) and the</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+  // &quot;scrollbarbutton&quot; (scrollbar buttons), but we don't want those events to</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineplus">+  // cause a &quot;double click&quot;.</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineplus">+  var t = event.originalTarget;</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineplus">+  if (t.localName == &quot;treecol&quot;)</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineplus">+  {</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineplus">+    HandleColumnClick(t.id);</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineplus">+  }</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineplus">+  else if (t.localName == &quot;treechildren&quot;)</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineplus">+  {</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineplus">+    let row = {}, col = {}, childElt = {};</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+    let tree = GetThreadTree();</span>
<a href="#l22.101"></a><span id="l22.101" class="difflineplus">+    // figure out what cell the click was in</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineplus">+    tree.treeBoxObject.getCellAt(event.clientX, event.clientY, row, col, childElt);</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineplus">+    if (row.value == -1)</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineplus">+      return;</span>
<a href="#l22.105"></a><span id="l22.105"> </span>
<a href="#l22.106"></a><span id="l22.106" class="difflineminus">-      // if the cell is in a &quot;cycler&quot; column</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineminus">-      // or if the user double clicked on the twisty,</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineminus">-      // don't open the message in a new window</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineminus">-      if (event.detail == 2 &amp;&amp; !col.value.cycler &amp;&amp; (childElt.value != &quot;twisty&quot;)) {</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineminus">-        ThreadPaneDoubleClick();</span>
<a href="#l22.111"></a><span id="l22.111" class="difflineminus">-        // double clicking should not toggle the open / close state of the </span>
<a href="#l22.112"></a><span id="l22.112" class="difflineminus">-        // thread.  this will happen if we don't prevent the event from</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineminus">-        // bubbling to the default handler in tree.xml</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineminus">-      }</span>
<a href="#l22.116"></a><span id="l22.116" class="difflineminus">-      else if (col.value.id == &quot;junkStatusCol&quot;) {</span>
<a href="#l22.117"></a><span id="l22.117" class="difflineminus">-        MsgJunkMailInfo(true);</span>
<a href="#l22.118"></a><span id="l22.118" class="difflineminus">-      }</span>
<a href="#l22.119"></a><span id="l22.119" class="difflineminus">-      else if (col.value.id == &quot;threadCol&quot; &amp;&amp; !event.shiftKey &amp;&amp;</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineminus">-          (event.ctrlKey || event.metaKey)) {</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineminus">-        gDBView.ExpandAndSelectThreadByIndex(row.value, true);</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineminus">-      }</span>
<a href="#l22.124"></a><span id="l22.124" class="difflineplus">+    // If the cell is in a &quot;cycler&quot; column or if the user double clicked on the</span>
<a href="#l22.125"></a><span id="l22.125" class="difflineplus">+    // twisty, don't open the message in a new window.</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineplus">+    if (event.detail == 2 &amp;&amp; !col.value.cycler &amp;&amp; (childElt.value != &quot;twisty&quot;))</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineplus">+    {</span>
<a href="#l22.128"></a><span id="l22.128" class="difflineplus">+      ThreadPaneDoubleClick();</span>
<a href="#l22.129"></a><span id="l22.129" class="difflineplus">+      // Double clicking should not toggle the open/close state of the thread.</span>
<a href="#l22.130"></a><span id="l22.130" class="difflineplus">+      // This will happen if we don't prevent the event from bubbling to the</span>
<a href="#l22.131"></a><span id="l22.131" class="difflineplus">+      // default handler in tree.xml.</span>
<a href="#l22.132"></a><span id="l22.132" class="difflineplus">+      event.stopPropagation();</span>
<a href="#l22.133"></a><span id="l22.133">     }</span>
<a href="#l22.134"></a><span id="l22.134" class="difflineplus">+    else if (col.value.id == &quot;junkStatusCol&quot;)</span>
<a href="#l22.135"></a><span id="l22.135" class="difflineplus">+    {</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineplus">+      MsgJunkMailInfo(true);</span>
<a href="#l22.137"></a><span id="l22.137" class="difflineplus">+    }</span>
<a href="#l22.138"></a><span id="l22.138" class="difflineplus">+    else if (col.value.id == &quot;threadCol&quot; &amp;&amp; !event.shiftKey &amp;&amp; (event.ctrlKey || event.metaKey))</span>
<a href="#l22.139"></a><span id="l22.139" class="difflineplus">+    {</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineplus">+      gDBView.ExpandAndSelectThreadByIndex(row.value, true);</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineplus">+      event.stopPropagation();</span>
<a href="#l22.142"></a><span id="l22.142" class="difflineplus">+    }</span>
<a href="#l22.143"></a><span id="l22.143" class="difflineplus">+  }</span>
<a href="#l22.144"></a><span id="l22.144"> }</span>
<a href="#l22.145"></a><span id="l22.145"> </span>
<a href="#l22.146"></a><span id="l22.146"> function nsMsgDBViewCommandUpdater()</span>
<a href="#l22.147"></a><span id="l22.147"> {}</span>
<a href="#l22.148"></a><span id="l22.148"> </span>
<a href="#l22.149"></a><span id="l22.149"> nsMsgDBViewCommandUpdater.prototype = </span>
<a href="#l22.150"></a><span id="l22.150"> {</span>
<a href="#l22.151"></a><span id="l22.151">   updateCommandStatus : function()</span>
<a href="#l22.152"></a><span id="l22.152" class="difflineat">@@ -197,28 +209,36 @@ function HandleColumnClick(columnID)</span>
<a href="#l22.153"></a><span id="l22.153">       MsgSortThreadPane(sortType);</span>
<a href="#l22.154"></a><span id="l22.154">     }</span>
<a href="#l22.155"></a><span id="l22.155">   }</span>
<a href="#l22.156"></a><span id="l22.156"> }</span>
<a href="#l22.157"></a><span id="l22.157"> </span>
<a href="#l22.158"></a><span id="l22.158"> function ThreadPaneDoubleClick()</span>
<a href="#l22.159"></a><span id="l22.159"> {</span>
<a href="#l22.160"></a><span id="l22.160">   const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l22.161"></a><span id="l22.161" class="difflineminus">-  if (IsSpecialFolderSelected(nsMsgFolderFlags.Drafts, true)) {</span>
<a href="#l22.162"></a><span id="l22.162" class="difflineplus">+  if (IsSpecialFolderSelected(nsMsgFolderFlags.Drafts, true))</span>
<a href="#l22.163"></a><span id="l22.163" class="difflineplus">+  {</span>
<a href="#l22.164"></a><span id="l22.164">     MsgComposeDraftMessage();</span>
<a href="#l22.165"></a><span id="l22.165">   }</span>
<a href="#l22.166"></a><span id="l22.166" class="difflineminus">-  else if(IsSpecialFolderSelected(nsMsgFolderFlags.Templates, true)) {</span>
<a href="#l22.167"></a><span id="l22.167" class="difflineplus">+  else if(IsSpecialFolderSelected(nsMsgFolderFlags.Templates, true))</span>
<a href="#l22.168"></a><span id="l22.168" class="difflineplus">+  {</span>
<a href="#l22.169"></a><span id="l22.169">     var loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l22.170"></a><span id="l22.170">     var messageArray = GetSelectedMessages();</span>
<a href="#l22.171"></a><span id="l22.171" class="difflineminus">-</span>
<a href="#l22.172"></a><span id="l22.172">     ComposeMessage(Components.interfaces.nsIMsgCompType.Template,</span>
<a href="#l22.173"></a><span id="l22.173">                    Components.interfaces.nsIMsgCompFormat.Default,</span>
<a href="#l22.174"></a><span id="l22.174">                    loadedFolder, messageArray);</span>
<a href="#l22.175"></a><span id="l22.175">   }</span>
<a href="#l22.176"></a><span id="l22.176" class="difflineminus">-  else {</span>
<a href="#l22.177"></a><span id="l22.177" class="difflineplus">+  else if (AllowOpenTabOnDoubleClick())</span>
<a href="#l22.178"></a><span id="l22.178" class="difflineplus">+  {</span>
<a href="#l22.179"></a><span id="l22.179" class="difflineplus">+    // open the message in a new tab on double click</span>
<a href="#l22.180"></a><span id="l22.180" class="difflineplus">+    MsgOpenNewTabForMessage();</span>
<a href="#l22.181"></a><span id="l22.181" class="difflineplus">+    RestoreSelectionWithoutContentLoad(GetThreadTree());</span>
<a href="#l22.182"></a><span id="l22.182" class="difflineplus">+  }</span>
<a href="#l22.183"></a><span id="l22.183" class="difflineplus">+  else</span>
<a href="#l22.184"></a><span id="l22.184" class="difflineplus">+  {</span>
<a href="#l22.185"></a><span id="l22.185">     MsgOpenSelectedMessages();</span>
<a href="#l22.186"></a><span id="l22.186">   }</span>
<a href="#l22.187"></a><span id="l22.187"> }</span>
<a href="#l22.188"></a><span id="l22.188"> </span>
<a href="#l22.189"></a><span id="l22.189"> function ThreadPaneKeyPress(event)</span>
<a href="#l22.190"></a><span id="l22.190"> {</span>
<a href="#l22.191"></a><span id="l22.191">   if (event.keyCode == KeyEvent.DOM_VK_RETURN)</span>
<a href="#l22.192"></a><span id="l22.192">     ThreadPaneDoubleClick();</span>
<a href="#l22.193"></a><span id="l22.193" class="difflineat">@@ -412,17 +432,17 @@ function UpdateSortIndicators(sortType, </span>
<a href="#l22.194"></a><span id="l22.194">     else {</span>
<a href="#l22.195"></a><span id="l22.195">       sortedColumn.setAttribute(&quot;sortDirection&quot;,&quot;descending&quot;);</span>
<a href="#l22.196"></a><span id="l22.196">     }</span>
<a href="#l22.197"></a><span id="l22.197">   }</span>
<a href="#l22.198"></a><span id="l22.198"> }</span>
<a href="#l22.199"></a><span id="l22.199"> </span>
<a href="#l22.200"></a><span id="l22.200"> function IsSpecialFolderSelected(flags, checkAncestors)</span>
<a href="#l22.201"></a><span id="l22.201"> {</span>
<a href="#l22.202"></a><span id="l22.202" class="difflineminus">-  let folder = GetThreadPaneFolder();</span>
<a href="#l22.203"></a><span id="l22.203" class="difflineplus">+  var folder = GetThreadPaneFolder();</span>
<a href="#l22.204"></a><span id="l22.204">   return folder &amp;&amp; folder.isSpecialFolder(flags, checkAncestors);</span>
<a href="#l22.205"></a><span id="l22.205"> }</span>
<a href="#l22.206"></a><span id="l22.206"> </span>
<a href="#l22.207"></a><span id="l22.207"> function GetThreadTree()</span>
<a href="#l22.208"></a><span id="l22.208"> {</span>
<a href="#l22.209"></a><span id="l22.209">   return document.getElementById(&quot;threadTree&quot;)</span>
<a href="#l22.210"></a><span id="l22.210"> }</span>
<a href="#l22.211"></a><span id="l22.211"> </span>
<a href="#l22.212"></a><span id="l22.212" class="difflineat">@@ -467,17 +487,17 @@ function ThreadPaneOnLoad()</span>
<a href="#l22.213"></a><span id="l22.213">   tree.addEventListener(&quot;click&quot;,ThreadPaneOnClick,true);</span>
<a href="#l22.214"></a><span id="l22.214"> </span>
<a href="#l22.215"></a><span id="l22.215">   // The mousedown event listener below should only be added in the thread</span>
<a href="#l22.216"></a><span id="l22.216">   // pane of the mailnews 3pane window, not in the advanced search window.</span>
<a href="#l22.217"></a><span id="l22.217">   if(tree.parentNode.id == &quot;searchResultListBox&quot;)</span>
<a href="#l22.218"></a><span id="l22.218">     return;</span>
<a href="#l22.219"></a><span id="l22.219"> </span>
<a href="#l22.220"></a><span id="l22.220">   tree.addEventListener(&quot;mousedown&quot;,TreeOnMouseDown,true);</span>
<a href="#l22.221"></a><span id="l22.221" class="difflineminus">-  let delay = pref.getIntPref(&quot;mailnews.threadpane_select_delay&quot;);</span>
<a href="#l22.222"></a><span id="l22.222" class="difflineplus">+  var delay = pref.getIntPref(&quot;mailnews.threadpane_select_delay&quot;);</span>
<a href="#l22.223"></a><span id="l22.223">   document.getElementById(&quot;threadTree&quot;)._selectDelay = delay;</span>
<a href="#l22.224"></a><span id="l22.224"> }</span>
<a href="#l22.225"></a><span id="l22.225"> </span>
<a href="#l22.226"></a><span id="l22.226"> function ThreadPaneSelectionChanged()</span>
<a href="#l22.227"></a><span id="l22.227"> {</span>
<a href="#l22.228"></a><span id="l22.228">   UpdateStatusMessageCounts(gMsgFolderSelected);</span>
<a href="#l22.229"></a><span id="l22.229">   if (!gRightMouseButtonDown)</span>
<a href="#l22.230"></a><span id="l22.230">     GetThreadTree().view.selectionChanged();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/mailnews/widgetglue.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/mailnews/widgetglue.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineminus">- * ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineplus">+/* -*- Mode: javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l23.8"></a><span id="l23.8">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l23.9"></a><span id="l23.9">  *</span>
<a href="#l23.10"></a><span id="l23.10">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l23.11"></a><span id="l23.11">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l23.12"></a><span id="l23.12">  * the License. You may obtain a copy of the License at</span>
<a href="#l23.13"></a><span id="l23.13">  * http://www.mozilla.org/MPL/</span>
<a href="#l23.14"></a><span id="l23.14">  *</span>
<a href="#l23.15"></a><span id="l23.15">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineat">@@ -255,32 +255,16 @@ function RebuildSummaryFile(msgFolder)</span>
<a href="#l23.17"></a><span id="l23.17"> }</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19"> function FolderProperties(name, oldName, uri)</span>
<a href="#l23.20"></a><span id="l23.20"> {</span>
<a href="#l23.21"></a><span id="l23.21">   if (name != oldName)</span>
<a href="#l23.22"></a><span id="l23.22">     RenameFolder(name, uri);</span>
<a href="#l23.23"></a><span id="l23.23"> }</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-function MsgToggleMessagePane()</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">-{</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-  MsgToggleSplitter(&quot;threadpane-splitter&quot;);</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">-  OnClickThreadAndMessagePaneSplitter();</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-}</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-function MsgToggleSplitter(id)</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-{</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-    var splitter = document.getElementById(id);</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-    var state = splitter.getAttribute(&quot;state&quot;);</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-    if (state == &quot;collapsed&quot;)</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-        splitter.setAttribute(&quot;state&quot;, null);</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-    else</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">-        splitter.setAttribute(&quot;state&quot;, &quot;collapsed&quot;)</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-}</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">-</span>
<a href="#l23.41"></a><span id="l23.41"> function MsgSetFolderCharset() </span>
<a href="#l23.42"></a><span id="l23.42"> {</span>
<a href="#l23.43"></a><span id="l23.43">   MsgFolderProperties() </span>
<a href="#l23.44"></a><span id="l23.44"> }</span>
<a href="#l23.45"></a><span id="l23.45"> </span>
<a href="#l23.46"></a><span id="l23.46"> // Given a URI we would like to return corresponding message folder here.</span>
<a href="#l23.47"></a><span id="l23.47"> // An additonal input param which specifies whether or not to check folder </span>
<a href="#l23.48"></a><span id="l23.48"> // attributes (like if there exists a parent or is it a server) is also passed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/themes/classic/mac/messenger/mailWindow1.css</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/themes/classic/mac/messenger/mailWindow1.css</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -80,26 +80,26 @@</span>
<a href="#l24.4"></a><span id="l24.4">   background-color: #CDCDCD;</span>
<a href="#l24.5"></a><span id="l24.5">   background-image: url(&quot;chrome://communicator/skin/toolbar-gradient34.png&quot;);</span>
<a href="#l24.6"></a><span id="l24.6">   background-repeat: repeat-x;</span>
<a href="#l24.7"></a><span id="l24.7">   border-bottom: 1px solid #9F9F9F;</span>
<a href="#l24.8"></a><span id="l24.8"> }</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10"> /* Leopard-styled &quot;zero-width&quot; vertical splitter */</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-#gray_vertical_splitter {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+#folderpane_splitter {</span>
<a href="#l24.14"></a><span id="l24.14">   border: solid #B3B3B3;</span>
<a href="#l24.15"></a><span id="l24.15">   border-width: 0 1px 0 0;</span>
<a href="#l24.16"></a><span id="l24.16">   min-width: 1px;</span>
<a href="#l24.17"></a><span id="l24.17">   background-image: none;</span>
<a href="#l24.18"></a><span id="l24.18"> }</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20"> /* Make sure users find the splitter when it's collapsed... */</span>
<a href="#l24.21"></a><span id="l24.21"> </span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-#gray_vertical_splitter[state=&quot;collapsed&quot;] {</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+#folderpane_splitter[state=&quot;collapsed&quot;] {</span>
<a href="#l24.24"></a><span id="l24.24">   min-width: 5px;</span>
<a href="#l24.25"></a><span id="l24.25">   background-color: #D6DDE5;</span>
<a href="#l24.26"></a><span id="l24.26">   cursor: e-resize;</span>
<a href="#l24.27"></a><span id="l24.27"> }</span>
<a href="#l24.28"></a><span id="l24.28"> </span>
<a href="#l24.29"></a><span id="l24.29"> /* Thick horisontal splitter */</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31"> #threadpane-splitter {</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineat">@@ -168,8 +168,24 @@</span>
<a href="#l24.33"></a><span id="l24.33"> #messagepane {</span>
<a href="#l24.34"></a><span id="l24.34">   border: 1px solid transparent;</span>
<a href="#l24.35"></a><span id="l24.35">   border-right: none;</span>
<a href="#l24.36"></a><span id="l24.36"> }</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38"> #messagepanebox[focusring=&quot;true&quot;] &gt; #messagepane {</span>
<a href="#l24.39"></a><span id="l24.39">   border-color: -moz-mac-focusring;</span>
<a href="#l24.40"></a><span id="l24.40"> }</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+.tab-close-button {</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+  margin: 0;</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+}</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+.tabmail-strip {</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+  border-bottom: 1px solid #A1A1A1;</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+  padding-bottom: 3px;</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+  background-color: #E8E8E8;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+}</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+/* ..... tabmail ..... */</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+.tab-close-button {</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+  margin: 0;</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/themes/classic/mac/navigator/tabbrowser.css</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/themes/classic/mac/navigator/tabbrowser.css</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -59,17 +59,22 @@ tabpanels {</span>
<a href="#l25.4"></a><span id="l25.4"> .tabbrowser-tab:not(:first-child) {</span>
<a href="#l25.5"></a><span id="l25.5">   -moz-margin-start: -3px;</span>
<a href="#l25.6"></a><span id="l25.6"> }</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> .tab-middle {</span>
<a href="#l25.9"></a><span id="l25.9">   padding: 4px 7px;</span>
<a href="#l25.10"></a><span id="l25.10"> }</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-.tabbrowser-tab:hover &gt; .tab-middle {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+.tab-middle[selected=&quot;true&quot;] {</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+  padding: 1px 7px 4px;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+  background-color: #E8E8E8;</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+}</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+.tabbrowser-tab:hover &gt; .tab-middle:not([selected=&quot;true&quot;]) {</span>
<a href="#l25.19"></a><span id="l25.19">   background-color: rgba(0, 0, 0, 0.1);</span>
<a href="#l25.20"></a><span id="l25.20"> }</span>
<a href="#l25.21"></a><span id="l25.21"> </span>
<a href="#l25.22"></a><span id="l25.22"> .tabbrowser-tab[busy] {</span>
<a href="#l25.23"></a><span id="l25.23">   list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;);</span>
<a href="#l25.24"></a><span id="l25.24"> }</span>
<a href="#l25.25"></a><span id="l25.25"> </span>
<a href="#l25.26"></a><span id="l25.26"> .tabbrowser-tab[selected=&quot;true&quot;] {</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineat">@@ -83,21 +88,16 @@ tabpanels {</span>
<a href="#l25.28"></a><span id="l25.28"> }</span>
<a href="#l25.29"></a><span id="l25.29"> </span>
<a href="#l25.30"></a><span id="l25.30"> .tabbrowser-tab:focus {</span>
<a href="#l25.31"></a><span id="l25.31">   outline: 2px solid -moz-mac-focusring;</span>
<a href="#l25.32"></a><span id="l25.32">   outline-offset: -2px;</span>
<a href="#l25.33"></a><span id="l25.33">   -moz-outline-radius: 5px;</span>
<a href="#l25.34"></a><span id="l25.34"> }</span>
<a href="#l25.35"></a><span id="l25.35"> </span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-.tab-middle[selected=&quot;true&quot;] {</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-  padding: 1px 7px 4px;</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-  -moz-appearance: dialog;</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-}</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-</span>
<a href="#l25.41"></a><span id="l25.41"> .tabbrowser-tab[beforeselected=&quot;true&quot;]:not([chromedir=&quot;rtl&quot;]) {</span>
<a href="#l25.42"></a><span id="l25.42">   -moz-border-right-colors: transparent transparent;</span>
<a href="#l25.43"></a><span id="l25.43"> }</span>
<a href="#l25.44"></a><span id="l25.44"> </span>
<a href="#l25.45"></a><span id="l25.45"> .tabbrowser-tab[beforeselected=&quot;true&quot;][chromedir=&quot;rtl&quot;] {</span>
<a href="#l25.46"></a><span id="l25.46">   -moz-border-left-colors: transparent transparent;</span>
<a href="#l25.47"></a><span id="l25.47"> }</span>
<a href="#l25.48"></a><span id="l25.48"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/themes/classic/messenger/folderPane.css</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/themes/classic/messenger/folderPane.css</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -44,144 +44,174 @@</span>
<a href="#l26.4"></a><span id="l26.4">   ======================================================================= */</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> /* ::::: mail folder ::::: */</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10"> treechildren::-moz-tree-image(folderNameCol) {</span>
<a href="#l26.11"></a><span id="l26.11">   -moz-margin-end: 2px;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+}</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;],</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol) {</span>
<a href="#l26.16"></a><span id="l26.16">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-closed.png&quot;);</span>
<a href="#l26.17"></a><span id="l26.17"> }</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l26.20"></a><span id="l26.20"> treechildren::-moz-tree-image(folderNameCol, newMessages-true) {</span>
<a href="#l26.21"></a><span id="l26.21">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new.png&quot;);</span>
<a href="#l26.22"></a><span id="l26.22"> }</span>
<a href="#l26.23"></a><span id="l26.23"> </span>
<a href="#l26.24"></a><span id="l26.24"> /* ..... News and Feeds ..... */</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;],</span>
<a href="#l26.28"></a><span id="l26.28"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp),</span>
<a href="#l26.29"></a><span id="l26.29"> treechildren::-moz-tree-image(folderNameCol, serverType-rss) {</span>
<a href="#l26.30"></a><span id="l26.30">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-newsgroup.png&quot;);</span>
<a href="#l26.31"></a><span id="l26.31"> }</span>
<a href="#l26.32"></a><span id="l26.32"> </span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l26.35"></a><span id="l26.35"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp, newMessages-true),</span>
<a href="#l26.36"></a><span id="l26.36"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, newMessages-true) {</span>
<a href="#l26.37"></a><span id="l26.37">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-newsgroup-new.png&quot;);</span>
<a href="#l26.38"></a><span id="l26.38"> }</span>
<a href="#l26.39"></a><span id="l26.39"> </span>
<a href="#l26.40"></a><span id="l26.40"> /* ..... Inbox ..... */</span>
<a href="#l26.41"></a><span id="l26.41"> </span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;],</span>
<a href="#l26.43"></a><span id="l26.43"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox) {</span>
<a href="#l26.44"></a><span id="l26.44">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-inbox.png&quot;);</span>
<a href="#l26.45"></a><span id="l26.45"> }</span>
<a href="#l26.46"></a><span id="l26.46"> </span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l26.48"></a><span id="l26.48"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l26.49"></a><span id="l26.49">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-inbox-new.png&quot;);</span>
<a href="#l26.50"></a><span id="l26.50"> }</span>
<a href="#l26.51"></a><span id="l26.51"> </span>
<a href="#l26.52"></a><span id="l26.52"> /* ..... Sent ..... */</span>
<a href="#l26.53"></a><span id="l26.53"> </span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Sent&quot;],</span>
<a href="#l26.55"></a><span id="l26.55"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Sent) {</span>
<a href="#l26.56"></a><span id="l26.56">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-sent.png&quot;);</span>
<a href="#l26.57"></a><span id="l26.57"> }</span>
<a href="#l26.58"></a><span id="l26.58"> </span>
<a href="#l26.59"></a><span id="l26.59"> /* ..... Unsent ..... */</span>
<a href="#l26.60"></a><span id="l26.60"> </span>
<a href="#l26.61"></a><span id="l26.61" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Unsent Messages&quot;],</span>
<a href="#l26.62"></a><span id="l26.62"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Unsent Messages) {</span>
<a href="#l26.63"></a><span id="l26.63">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-outbox.png&quot;);</span>
<a href="#l26.64"></a><span id="l26.64"> }</span>
<a href="#l26.65"></a><span id="l26.65"> </span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Outbox&quot;],</span>
<a href="#l26.67"></a><span id="l26.67"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Outbox) {</span>
<a href="#l26.68"></a><span id="l26.68">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-outbox.png&quot;);</span>
<a href="#l26.69"></a><span id="l26.69"> }</span>
<a href="#l26.70"></a><span id="l26.70"> </span>
<a href="#l26.71"></a><span id="l26.71"> /* ..... Drafts ..... */</span>
<a href="#l26.72"></a><span id="l26.72"> </span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Drafts&quot;],</span>
<a href="#l26.74"></a><span id="l26.74"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Drafts) {</span>
<a href="#l26.75"></a><span id="l26.75">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-draft.png&quot;);</span>
<a href="#l26.76"></a><span id="l26.76"> }</span>
<a href="#l26.77"></a><span id="l26.77"> </span>
<a href="#l26.78"></a><span id="l26.78"> /* ..... Templates ..... */</span>
<a href="#l26.79"></a><span id="l26.79"> </span>
<a href="#l26.80"></a><span id="l26.80" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Templates&quot;],</span>
<a href="#l26.81"></a><span id="l26.81"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Templates) {</span>
<a href="#l26.82"></a><span id="l26.82">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-template.png&quot;);</span>
<a href="#l26.83"></a><span id="l26.83"> }</span>
<a href="#l26.84"></a><span id="l26.84"> </span>
<a href="#l26.85"></a><span id="l26.85"> /* ..... Junk ..... */</span>
<a href="#l26.86"></a><span id="l26.86"> </span>
<a href="#l26.87"></a><span id="l26.87" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Junk&quot;],</span>
<a href="#l26.88"></a><span id="l26.88"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Junk) {</span>
<a href="#l26.89"></a><span id="l26.89">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-junk.png&quot;);</span>
<a href="#l26.90"></a><span id="l26.90"> }</span>
<a href="#l26.91"></a><span id="l26.91"> </span>
<a href="#l26.92"></a><span id="l26.92"> /* ..... Trash ..... */</span>
<a href="#l26.93"></a><span id="l26.93"> </span>
<a href="#l26.94"></a><span id="l26.94" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;],</span>
<a href="#l26.95"></a><span id="l26.95"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Trash) {</span>
<a href="#l26.96"></a><span id="l26.96">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-trash.png&quot;);</span>
<a href="#l26.97"></a><span id="l26.97"> }</span>
<a href="#l26.98"></a><span id="l26.98"> </span>
<a href="#l26.99"></a><span id="l26.99"> /* ..... Saved Searches ..... */</span>
<a href="#l26.100"></a><span id="l26.100"> </span>
<a href="#l26.101"></a><span id="l26.101" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;],</span>
<a href="#l26.102"></a><span id="l26.102"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Virtual) {</span>
<a href="#l26.103"></a><span id="l26.103">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-search.png&quot;);</span>
<a href="#l26.104"></a><span id="l26.104"> }</span>
<a href="#l26.105"></a><span id="l26.105"> </span>
<a href="#l26.106"></a><span id="l26.106" class="difflineminus">-treechildren::-moz-tree-cell-text(folderNameCol, newMessages-true),</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineminus">-treechildren::-moz-tree-cell-text(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l26.109"></a><span id="l26.109" class="difflineplus">+treechildren::-moz-tree-cell-text(folderNameCol, newMessages-true) {</span>
<a href="#l26.110"></a><span id="l26.110">   font-weight: bold;</span>
<a href="#l26.111"></a><span id="l26.111"> }</span>
<a href="#l26.112"></a><span id="l26.112"> </span>
<a href="#l26.113"></a><span id="l26.113" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ImapShared=&quot;true&quot;],</span>
<a href="#l26.114"></a><span id="l26.114"> treechildren::-moz-tree-image(folderNameCol, imapShared-true) {</span>
<a href="#l26.115"></a><span id="l26.115">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-share.png&quot;);</span>
<a href="#l26.116"></a><span id="l26.116"> }</span>
<a href="#l26.117"></a><span id="l26.117"> </span>
<a href="#l26.118"></a><span id="l26.118"> /* ..... Server Folders ..... */</span>
<a href="#l26.119"></a><span id="l26.119"> </span>
<a href="#l26.120"></a><span id="l26.120" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;],</span>
<a href="#l26.121"></a><span id="l26.121"> treechildren::-moz-tree-image(folderNameCol, isServer-true) {</span>
<a href="#l26.122"></a><span id="l26.122">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-mail.png&quot;);</span>
<a href="#l26.123"></a><span id="l26.123"> }</span>
<a href="#l26.124"></a><span id="l26.124"> </span>
<a href="#l26.125"></a><span id="l26.125" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][BiffState=&quot;NewMail&quot;][IsServer=&quot;true&quot;],</span>
<a href="#l26.126"></a><span id="l26.126"> treechildren::-moz-tree-image(folderNameCol, biffState-NewMail, isServer-true) {</span>
<a href="#l26.127"></a><span id="l26.127">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-mail-new.png&quot;);</span>
<a href="#l26.128"></a><span id="l26.128"> }</span>
<a href="#l26.129"></a><span id="l26.129"> </span>
<a href="#l26.130"></a><span id="l26.130" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;pop3&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l26.131"></a><span id="l26.131"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-pop3, isSecure-true) {</span>
<a href="#l26.132"></a><span id="l26.132">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-remote-lock.png&quot;);</span>
<a href="#l26.133"></a><span id="l26.133"> }</span>
<a href="#l26.134"></a><span id="l26.134"> </span>
<a href="#l26.135"></a><span id="l26.135" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l26.136"></a><span id="l26.136"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-imap, isSecure-true) {</span>
<a href="#l26.137"></a><span id="l26.137">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-remote-lock.png&quot;);</span>
<a href="#l26.138"></a><span id="l26.138"> }</span>
<a href="#l26.139"></a><span id="l26.139"> </span>
<a href="#l26.140"></a><span id="l26.140" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][BiffState=&quot;NewMail&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l26.141"></a><span id="l26.141"> treechildren::-moz-tree-image(folderNameCol, biffState-NewMail, isServer-true, isSecure-true) {</span>
<a href="#l26.142"></a><span id="l26.142">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-remote-lock-new.png&quot;);</span>
<a href="#l26.143"></a><span id="l26.143"> }</span>
<a href="#l26.144"></a><span id="l26.144"> </span>
<a href="#l26.145"></a><span id="l26.145" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;none&quot;],</span>
<a href="#l26.146"></a><span id="l26.146"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-none) {</span>
<a href="#l26.147"></a><span id="l26.147">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-local.png&quot;);</span>
<a href="#l26.148"></a><span id="l26.148"> }</span>
<a href="#l26.149"></a><span id="l26.149"> </span>
<a href="#l26.150"></a><span id="l26.150" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l26.151"></a><span id="l26.151"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-nntp) {</span>
<a href="#l26.152"></a><span id="l26.152">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-news.png&quot;);</span>
<a href="#l26.153"></a><span id="l26.153"> }</span>
<a href="#l26.154"></a><span id="l26.154"> </span>
<a href="#l26.155"></a><span id="l26.155" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l26.156"></a><span id="l26.156"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-nntp, isSecure-true) {</span>
<a href="#l26.157"></a><span id="l26.157">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-news-lock.png&quot;);</span>
<a href="#l26.158"></a><span id="l26.158"> }</span>
<a href="#l26.159"></a><span id="l26.159"> </span>
<a href="#l26.160"></a><span id="l26.160" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;rss&quot;],</span>
<a href="#l26.161"></a><span id="l26.161"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-rss) {</span>
<a href="#l26.162"></a><span id="l26.162">   list-style-image: url(&quot;chrome://communicator/skin/icons/feedIcon16.png&quot;);</span>
<a href="#l26.163"></a><span id="l26.163"> }</span>
<a href="#l26.164"></a><span id="l26.164"> </span>
<a href="#l26.165"></a><span id="l26.165"> /* ::::: All Servers ::::: */</span>
<a href="#l26.166"></a><span id="l26.166"> </span>
<a href="#l26.167"></a><span id="l26.167"> treechildren::-moz-tree-cell-text(closed, subfoldersHaveUnreadMessages-true) {</span>
<a href="#l26.168"></a><span id="l26.168">   font-weight: bold;</span>
<a href="#l26.169"></a><span id="l26.169"> }</span>
<a href="#l26.170"></a><span id="l26.170"> </span>
<a href="#l26.171"></a><span id="l26.171" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;],</span>
<a href="#l26.172"></a><span id="l26.172"> treechildren::-moz-tree-cell-text(folderNameCol, isServer-true),</span>
<a href="#l26.173"></a><span id="l26.173"> treechildren::-moz-tree-cell-text(hasUnreadMessages-true) {</span>
<a href="#l26.174"></a><span id="l26.174">   font-weight: bold;</span>
<a href="#l26.175"></a><span id="l26.175"> }</span>
<a href="#l26.176"></a><span id="l26.176"> </span>
<a href="#l26.177"></a><span id="l26.177"> treechildren::-moz-tree-cell-text(folderNameCol, noSelect-true) {</span>
<a href="#l26.178"></a><span id="l26.178">   color: gray;</span>
<a href="#l26.179"></a><span id="l26.179">   font-style: italic;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/suite/themes/classic/messenger/mailWindow1.css</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/suite/themes/classic/messenger/mailWindow1.css</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -54,17 +54,17 @@</span>
<a href="#l27.4"></a><span id="l27.4">   min-height: 10px;</span>
<a href="#l27.5"></a><span id="l27.5">   height: 0px;</span>
<a href="#l27.6"></a><span id="l27.6"> }</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> /* ::::: border adjustments for focus ring and joined splitters ::::: */</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10"> /* ..... splitter adjustments ..... */</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-#gray_vertical_splitter {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+#folderpane-splitter {</span>
<a href="#l27.14"></a><span id="l27.14">   border-right: none;</span>
<a href="#l27.15"></a><span id="l27.15">   border-bottom: none;</span>
<a href="#l27.16"></a><span id="l27.16">   border-left: none;</span>
<a href="#l27.17"></a><span id="l27.17">   min-width: 5px;</span>
<a href="#l27.18"></a><span id="l27.18"> }</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20"> #threadpane-splitter {</span>
<a href="#l27.21"></a><span id="l27.21">   border: none;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -131,9 +131,18 @@</span>
<a href="#l27.23"></a><span id="l27.23">   border: 1px solid -moz-Field;</span>
<a href="#l27.24"></a><span id="l27.24">   border-right: none;</span>
<a href="#l27.25"></a><span id="l27.25"> }</span>
<a href="#l27.26"></a><span id="l27.26"> </span>
<a href="#l27.27"></a><span id="l27.27"> #messagepanebox[focusring=&quot;true&quot;] &gt; #messagepane {</span>
<a href="#l27.28"></a><span id="l27.28">   border-color: #000000;</span>
<a href="#l27.29"></a><span id="l27.29"> }</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+/* ..... tabmail ..... */</span>
<a href="#l27.32"></a><span id="l27.32"> </span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+tabpanels {</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+  /* don't draw tabpanel borders; see also tabbrowser.css */</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineplus">+}</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+.tab-close-button {</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineplus">+  margin: 0;</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/themes/classic/messenger/threadPane.css</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/themes/classic/messenger/threadPane.css</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -185,60 +185,87 @@ treechildren::-moz-tree-image(junkStatus</span>
<a href="#l28.4"></a><span id="l28.4"> }</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6"> treechildren::-moz-tree-image(junkStatusCol, notjunk) {</span>
<a href="#l28.7"></a><span id="l28.7">   list-style-image: url(&quot;chrome://messenger/skin/icons/dot.png&quot;);</span>
<a href="#l28.8"></a><span id="l28.8">   -moz-padding-start: 0px;</span>
<a href="#l28.9"></a><span id="l28.9">   -moz-padding-end: 4px;</span>
<a href="#l28.10"></a><span id="l28.10"> }</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-/* ..... subject column ..... */</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+/* ..... subject column and tab icons ..... */</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;] .tab-icon {</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+  margin-top: -4px;</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineplus">+}</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;],</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+treechildren::-moz-tree-image(subjectCol) {</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail.png&quot;);</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+}</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24"> treechildren::-moz-tree-image(subjectCol) {</span>
<a href="#l28.25"></a><span id="l28.25">   -moz-margin-end: 2px;</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail.png&quot;);</span>
<a href="#l28.27"></a><span id="l28.27"> }</span>
<a href="#l28.28"></a><span id="l28.28"> </span>
<a href="#l28.29"></a><span id="l28.29"> treechildren::-moz-tree-image(subjectCol, new) {</span>
<a href="#l28.30"></a><span id="l28.30">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-new.png&quot;);</span>
<a href="#l28.31"></a><span id="l28.31"> }</span>
<a href="#l28.32"></a><span id="l28.32"> </span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][Attachment=&quot;true&quot;],</span>
<a href="#l28.34"></a><span id="l28.34"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, attach) {</span>
<a href="#l28.35"></a><span id="l28.35">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-attach.png&quot;);</span>
<a href="#l28.36"></a><span id="l28.36"> }</span>
<a href="#l28.37"></a><span id="l28.37"> </span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][IMAPDeleted=&quot;true&quot;],</span>
<a href="#l28.39"></a><span id="l28.39"> treechildren::-moz-tree-image(subjectCol, imapdeleted) {</span>
<a href="#l28.40"></a><span id="l28.40">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-imapdelete.png&quot;);</span>
<a href="#l28.41"></a><span id="l28.41"> }</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.44"></a><span id="l28.44"> treechildren::-moz-tree-image(subjectCol, offline) {</span>
<a href="#l28.45"></a><span id="l28.45">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-offl.png&quot;);</span>
<a href="#l28.46"></a><span id="l28.46"> }</span>
<a href="#l28.47"></a><span id="l28.47"> </span>
<a href="#l28.48"></a><span id="l28.48"> treechildren::-moz-tree-image(subjectCol, new, offline) {</span>
<a href="#l28.49"></a><span id="l28.49">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-new-offl.png&quot;);</span>
<a href="#l28.50"></a><span id="l28.50"> }</span>
<a href="#l28.51"></a><span id="l28.51"> </span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][Attachment=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.53"></a><span id="l28.53"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, attach, offline) {</span>
<a href="#l28.54"></a><span id="l28.54">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-attach-offl.png&quot;);</span>
<a href="#l28.55"></a><span id="l28.55"> }</span>
<a href="#l28.56"></a><span id="l28.56"> </span>
<a href="#l28.57"></a><span id="l28.57" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][IMAPDeleted=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.58"></a><span id="l28.58"> treechildren::-moz-tree-image(subjectCol, imapdeleted, offline) {</span>
<a href="#l28.59"></a><span id="l28.59">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-delete-offl.png&quot;);</span>
<a href="#l28.60"></a><span id="l28.60"> }</span>
<a href="#l28.61"></a><span id="l28.61"> </span>
<a href="#l28.62"></a><span id="l28.62" class="difflineplus">+/* the news icons are only 14px high, unfortunately */</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;] .tab-icon,</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;] .tab-icon {</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+  height: 14px;</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+}</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineplus">+</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;],</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;],</span>
<a href="#l28.70"></a><span id="l28.70"> treechildren::-moz-tree-image(subjectCol, rss),</span>
<a href="#l28.71"></a><span id="l28.71"> treechildren::-moz-tree-image(subjectCol, news) {</span>
<a href="#l28.72"></a><span id="l28.72">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news.png&quot;);</span>
<a href="#l28.73"></a><span id="l28.73"> }</span>
<a href="#l28.74"></a><span id="l28.74"> </span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;][Attachment=&quot;true&quot;],</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;][Attachment=&quot;true&quot;],</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineplus">+tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, rss, attach),</span>
<a href="#l28.78"></a><span id="l28.78"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, news, attach) {</span>
<a href="#l28.79"></a><span id="l28.79">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-attach.png&quot;);</span>
<a href="#l28.80"></a><span id="l28.80"> }</span>
<a href="#l28.81"></a><span id="l28.81"> </span>
<a href="#l28.82"></a><span id="l28.82" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;][Attachment=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;][Attachment=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineplus">+tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, rss, attach, offline),</span>
<a href="#l28.85"></a><span id="l28.85"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, news, attach, offline) {</span>
<a href="#l28.86"></a><span id="l28.86">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-attach-offl.png&quot;);</span>
<a href="#l28.87"></a><span id="l28.87"> }</span>
<a href="#l28.88"></a><span id="l28.88"> </span>
<a href="#l28.89"></a><span id="l28.89"> treechildren::-moz-tree-image(subjectCol, rss, new),</span>
<a href="#l28.90"></a><span id="l28.90"> treechildren::-moz-tree-image(subjectCol, news, new) {</span>
<a href="#l28.91"></a><span id="l28.91">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-new.png&quot;);</span>
<a href="#l28.92"></a><span id="l28.92"> }</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineat">@@ -250,16 +277,19 @@ tree[noattachcol=&quot;true&quot;] &gt; treechildren:</span>
<a href="#l28.94"></a><span id="l28.94"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, news, new, attach, offline) {</span>
<a href="#l28.95"></a><span id="l28.95">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-new-attach-off.png&quot;);</span>
<a href="#l28.96"></a><span id="l28.96"> }</span>
<a href="#l28.97"></a><span id="l28.97"> </span>
<a href="#l28.98"></a><span id="l28.98"> treechildren::-moz-tree-image(subjectCol, news, new, offline) {</span>
<a href="#l28.99"></a><span id="l28.99">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-new-offl.png&quot;);</span>
<a href="#l28.100"></a><span id="l28.100"> }</span>
<a href="#l28.101"></a><span id="l28.101"> </span>
<a href="#l28.102"></a><span id="l28.102" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;][Offline=&quot;true&quot;],</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineplus">+treechildren::-moz-tree-image(subjectCol, rss, offline),</span>
<a href="#l28.105"></a><span id="l28.105"> treechildren::-moz-tree-image(subjectCol, news, offline) {</span>
<a href="#l28.106"></a><span id="l28.106">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-offl.png&quot;);</span>
<a href="#l28.107"></a><span id="l28.107"> }</span>
<a href="#l28.108"></a><span id="l28.108"> </span>
<a href="#l28.109"></a><span id="l28.109"> /* ..... new thread icons for watch and ignore ..... */</span>
<a href="#l28.110"></a><span id="l28.110"> </span>
<a href="#l28.111"></a><span id="l28.111"> treechildren::-moz-tree-image(news, threadCol, watch) {</span>
<a href="#l28.112"></a><span id="l28.112">   list-style-image: url(&quot;chrome://messenger/skin/icons/thread-closed-eye.png&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/themes/modern/messenger/folderPane.css</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/themes/modern/messenger/folderPane.css</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -42,141 +42,171 @@</span>
<a href="#l29.4"></a><span id="l29.4">   ======================================================================= */</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6"> @namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8"> /* ::::: mail folder ::::: */</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10"> treechildren::-moz-tree-image(folderNameCol) {</span>
<a href="#l29.11"></a><span id="l29.11">   -moz-margin-end: 2px;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+}</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;],</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+treechildren::-moz-tree-image(folderNameCol) {</span>
<a href="#l29.16"></a><span id="l29.16">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-closed.gif&quot;);</span>
<a href="#l29.17"></a><span id="l29.17"> }</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19"> treechildren::-moz-tree-image(folderNameCol, newMessages-true) {</span>
<a href="#l29.20"></a><span id="l29.20">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new.gif&quot;);</span>
<a href="#l29.21"></a><span id="l29.21"> }</span>
<a href="#l29.22"></a><span id="l29.22"> </span>
<a href="#l29.23"></a><span id="l29.23"> /* ..... News and Feeds ..... */</span>
<a href="#l29.24"></a><span id="l29.24"> </span>
<a href="#l29.25"></a><span id="l29.25" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;],</span>
<a href="#l29.27"></a><span id="l29.27"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp),</span>
<a href="#l29.28"></a><span id="l29.28"> treechildren::-moz-tree-image(folderNameCol, serverType-rss) {</span>
<a href="#l29.29"></a><span id="l29.29">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-newsgroup.gif&quot;);</span>
<a href="#l29.30"></a><span id="l29.30"> }</span>
<a href="#l29.31"></a><span id="l29.31"> </span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l29.34"></a><span id="l29.34"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp, newMessages-true),</span>
<a href="#l29.35"></a><span id="l29.35"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, newMessages-true) {</span>
<a href="#l29.36"></a><span id="l29.36">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-newsgroup-new.gif&quot;);</span>
<a href="#l29.37"></a><span id="l29.37"> }</span>
<a href="#l29.38"></a><span id="l29.38"> </span>
<a href="#l29.39"></a><span id="l29.39"> /* ..... Inbox ..... */</span>
<a href="#l29.40"></a><span id="l29.40"> </span>
<a href="#l29.41"></a><span id="l29.41" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;],</span>
<a href="#l29.42"></a><span id="l29.42"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox) {</span>
<a href="#l29.43"></a><span id="l29.43">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-inbox.gif&quot;);</span>
<a href="#l29.44"></a><span id="l29.44"> }</span>
<a href="#l29.45"></a><span id="l29.45"> </span>
<a href="#l29.46"></a><span id="l29.46" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;][NewMessages=&quot;true&quot;],</span>
<a href="#l29.47"></a><span id="l29.47"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l29.48"></a><span id="l29.48">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-inbox-new.gif&quot;);</span>
<a href="#l29.49"></a><span id="l29.49"> }</span>
<a href="#l29.50"></a><span id="l29.50"> </span>
<a href="#l29.51"></a><span id="l29.51"> /* ..... Sent ..... */</span>
<a href="#l29.52"></a><span id="l29.52"> </span>
<a href="#l29.53"></a><span id="l29.53" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Sent&quot;],</span>
<a href="#l29.54"></a><span id="l29.54"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Sent) {</span>
<a href="#l29.55"></a><span id="l29.55">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-sent.gif&quot;);</span>
<a href="#l29.56"></a><span id="l29.56"> }</span>
<a href="#l29.57"></a><span id="l29.57"> </span>
<a href="#l29.58"></a><span id="l29.58"> /* ..... Drafts ..... */</span>
<a href="#l29.59"></a><span id="l29.59"> </span>
<a href="#l29.60"></a><span id="l29.60" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Drafts&quot;],</span>
<a href="#l29.61"></a><span id="l29.61"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Drafts) {</span>
<a href="#l29.62"></a><span id="l29.62">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-draft.gif&quot;);</span>
<a href="#l29.63"></a><span id="l29.63"> }</span>
<a href="#l29.64"></a><span id="l29.64"> </span>
<a href="#l29.65"></a><span id="l29.65"> /* ..... Templates ..... */</span>
<a href="#l29.66"></a><span id="l29.66"> </span>
<a href="#l29.67"></a><span id="l29.67" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Templates&quot;],</span>
<a href="#l29.68"></a><span id="l29.68"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Templates) {</span>
<a href="#l29.69"></a><span id="l29.69">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-template.gif&quot;);</span>
<a href="#l29.70"></a><span id="l29.70"> }</span>
<a href="#l29.71"></a><span id="l29.71"> </span>
<a href="#l29.72"></a><span id="l29.72"> /* ..... Unsent Messages ..... */</span>
<a href="#l29.73"></a><span id="l29.73"> </span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Unsent Messages&quot;],</span>
<a href="#l29.75"></a><span id="l29.75"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Unsent Messages) {</span>
<a href="#l29.76"></a><span id="l29.76">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-outbox.gif&quot;);</span>
<a href="#l29.77"></a><span id="l29.77"> }</span>
<a href="#l29.78"></a><span id="l29.78"> </span>
<a href="#l29.79"></a><span id="l29.79" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Outbox&quot;],</span>
<a href="#l29.80"></a><span id="l29.80"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Outbox) {</span>
<a href="#l29.81"></a><span id="l29.81">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-outbox.gif&quot;);</span>
<a href="#l29.82"></a><span id="l29.82"> }</span>
<a href="#l29.83"></a><span id="l29.83"> </span>
<a href="#l29.84"></a><span id="l29.84"> /* ..... Junk ..... */</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineplus">+</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Junk&quot;],</span>
<a href="#l29.87"></a><span id="l29.87"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Junk) {</span>
<a href="#l29.88"></a><span id="l29.88">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-junk.gif&quot;);</span>
<a href="#l29.89"></a><span id="l29.89"> }</span>
<a href="#l29.90"></a><span id="l29.90"> </span>
<a href="#l29.91"></a><span id="l29.91"> /* ..... Trash ..... */</span>
<a href="#l29.92"></a><span id="l29.92"> </span>
<a href="#l29.93"></a><span id="l29.93" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;],</span>
<a href="#l29.94"></a><span id="l29.94"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Trash) {</span>
<a href="#l29.95"></a><span id="l29.95">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-trash.gif&quot;);</span>
<a href="#l29.96"></a><span id="l29.96"> }</span>
<a href="#l29.97"></a><span id="l29.97"> </span>
<a href="#l29.98"></a><span id="l29.98"> /* ..... Saved Searches ..... */</span>
<a href="#l29.99"></a><span id="l29.99"> </span>
<a href="#l29.100"></a><span id="l29.100" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;],</span>
<a href="#l29.101"></a><span id="l29.101"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Virtual) {</span>
<a href="#l29.102"></a><span id="l29.102">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-search.gif&quot;);</span>
<a href="#l29.103"></a><span id="l29.103"> }</span>
<a href="#l29.104"></a><span id="l29.104"> </span>
<a href="#l29.105"></a><span id="l29.105"> /* ...... Shared ..... */</span>
<a href="#l29.106"></a><span id="l29.106"> </span>
<a href="#l29.107"></a><span id="l29.107" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ImapShared=&quot;true&quot;],</span>
<a href="#l29.108"></a><span id="l29.108"> treechildren::-moz-tree-image(folderNameCol, imapShared-true) {</span>
<a href="#l29.109"></a><span id="l29.109">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-share.gif&quot;);</span>
<a href="#l29.110"></a><span id="l29.110"> }</span>
<a href="#l29.111"></a><span id="l29.111"> </span>
<a href="#l29.112"></a><span id="l29.112"> /* ..... Server Folders ..... */</span>
<a href="#l29.113"></a><span id="l29.113"> </span>
<a href="#l29.114"></a><span id="l29.114" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;],</span>
<a href="#l29.115"></a><span id="l29.115"> treechildren::-moz-tree-image(folderNameCol, isServer-true) {</span>
<a href="#l29.116"></a><span id="l29.116">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-mail.gif&quot;);</span>
<a href="#l29.117"></a><span id="l29.117"> }</span>
<a href="#l29.118"></a><span id="l29.118"> </span>
<a href="#l29.119"></a><span id="l29.119" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][BiffState=&quot;NewMail&quot;][IsServer=&quot;true&quot;],</span>
<a href="#l29.120"></a><span id="l29.120"> treechildren::-moz-tree-image(folderNameCol, biffState-NewMail, isServer-true) {</span>
<a href="#l29.121"></a><span id="l29.121">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-mail-new.gif&quot;);</span>
<a href="#l29.122"></a><span id="l29.122"> }</span>
<a href="#l29.123"></a><span id="l29.123"> </span>
<a href="#l29.124"></a><span id="l29.124" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;pop3&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l29.125"></a><span id="l29.125"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-pop3, isSecure-true) {</span>
<a href="#l29.126"></a><span id="l29.126">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-remote-lock.gif&quot;);</span>
<a href="#l29.127"></a><span id="l29.127"> }</span>
<a href="#l29.128"></a><span id="l29.128"> </span>
<a href="#l29.129"></a><span id="l29.129" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l29.130"></a><span id="l29.130"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-imap, isSecure-true) {</span>
<a href="#l29.131"></a><span id="l29.131">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-remote-lock.gif&quot;);</span>
<a href="#l29.132"></a><span id="l29.132"> }</span>
<a href="#l29.133"></a><span id="l29.133"> </span>
<a href="#l29.134"></a><span id="l29.134" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][BiffState=&quot;NewMail&quot;][IsServer=&quot;true&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l29.135"></a><span id="l29.135"> treechildren::-moz-tree-image(folderNameCol, biffState-NewMail, isServer-true, isSecure-true) {</span>
<a href="#l29.136"></a><span id="l29.136">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-remote-lock-new.gif&quot;);</span>
<a href="#l29.137"></a><span id="l29.137"> }</span>
<a href="#l29.138"></a><span id="l29.138"> </span>
<a href="#l29.139"></a><span id="l29.139" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;none&quot;],</span>
<a href="#l29.140"></a><span id="l29.140"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-none) {</span>
<a href="#l29.141"></a><span id="l29.141">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-local.gif&quot;);</span>
<a href="#l29.142"></a><span id="l29.142"> }</span>
<a href="#l29.143"></a><span id="l29.143"> </span>
<a href="#l29.144"></a><span id="l29.144" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;],</span>
<a href="#l29.145"></a><span id="l29.145"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-nntp) {</span>
<a href="#l29.146"></a><span id="l29.146">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-news.gif&quot;);</span>
<a href="#l29.147"></a><span id="l29.147"> }</span>
<a href="#l29.148"></a><span id="l29.148"> </span>
<a href="#l29.149"></a><span id="l29.149" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;][IsSecure=&quot;true&quot;],</span>
<a href="#l29.150"></a><span id="l29.150"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-nntp, isSecure-true) {</span>
<a href="#l29.151"></a><span id="l29.151">   list-style-image: url(&quot;chrome://messenger/skin/icons/server-news-lock.gif&quot;);</span>
<a href="#l29.152"></a><span id="l29.152"> }</span>
<a href="#l29.153"></a><span id="l29.153"> </span>
<a href="#l29.154"></a><span id="l29.154" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;rss&quot;],</span>
<a href="#l29.155"></a><span id="l29.155"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-rss) {</span>
<a href="#l29.156"></a><span id="l29.156">   list-style-image: url(&quot;chrome://communicator/skin/icons/feedIcon16.png&quot;);</span>
<a href="#l29.157"></a><span id="l29.157"> }</span>
<a href="#l29.158"></a><span id="l29.158"> </span>
<a href="#l29.159"></a><span id="l29.159"> /* ::::: All Servers ::::: */</span>
<a href="#l29.160"></a><span id="l29.160"> </span>
<a href="#l29.161"></a><span id="l29.161"> treechildren::-moz-tree-cell-text(closed, subfoldersHaveUnreadMessages-true)</span>
<a href="#l29.162"></a><span id="l29.162"> {</span>
<a href="#l29.163"></a><span id="l29.163">   font-weight: bold;</span>
<a href="#l29.164"></a><span id="l29.164"> }</span>
<a href="#l29.165"></a><span id="l29.165"> </span>
<a href="#l29.166"></a><span id="l29.166" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;],</span>
<a href="#l29.167"></a><span id="l29.167"> treechildren::-moz-tree-cell-text(folderNameCol, isServer-true),</span>
<a href="#l29.168"></a><span id="l29.168"> treechildren::-moz-tree-cell-text(hasUnreadMessages-true) {</span>
<a href="#l29.169"></a><span id="l29.169">   font-weight: bold;</span>
<a href="#l29.170"></a><span id="l29.170"> }</span>
<a href="#l29.171"></a><span id="l29.171"> </span>
<a href="#l29.172"></a><span id="l29.172"> treechildren::-moz-tree-cell-text(folderNameCol, noSelect-true) {</span>
<a href="#l29.173"></a><span id="l29.173">   color: gray;</span>
<a href="#l29.174"></a><span id="l29.174">   font-style: italic;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/themes/modern/messenger/mailWindow1.css</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/themes/modern/messenger/mailWindow1.css</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -52,17 +52,17 @@</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5"> #messagepanebox {</span>
<a href="#l30.6"></a><span id="l30.6">   min-height: 10px;</span>
<a href="#l30.7"></a><span id="l30.7">   height: 0px;</span>
<a href="#l30.8"></a><span id="l30.8"> }</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10"> /* ::::: border adjustments for focus ring and joined splitters ::::: */</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-#gray_vertical_splitter {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+#folderpane-splitter {</span>
<a href="#l30.14"></a><span id="l30.14">   border-right: none;</span>
<a href="#l30.15"></a><span id="l30.15">   border-bottom: none;</span>
<a href="#l30.16"></a><span id="l30.16">   border-left: none;</span>
<a href="#l30.17"></a><span id="l30.17">   min-width: 5px;</span>
<a href="#l30.18"></a><span id="l30.18"> }</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20"> #threadpane-splitter {</span>
<a href="#l30.21"></a><span id="l30.21">   border: none;</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -147,8 +147,14 @@</span>
<a href="#l30.23"></a><span id="l30.23"> #messagepane {</span>
<a href="#l30.24"></a><span id="l30.24">   border: 1px solid #FFFFFF;</span>
<a href="#l30.25"></a><span id="l30.25">   border-right: none;</span>
<a href="#l30.26"></a><span id="l30.26"> }</span>
<a href="#l30.27"></a><span id="l30.27"> </span>
<a href="#l30.28"></a><span id="l30.28"> #messagepanebox[focusring=&quot;true&quot;] &gt; #messagepane {</span>
<a href="#l30.29"></a><span id="l30.29">   border-color: #000000;</span>
<a href="#l30.30"></a><span id="l30.30"> }</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+/* ..... tabmail ..... */</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+.tab-close-button {</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/close.gif&quot;);</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/themes/modern/messenger/threadPane.css</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/themes/modern/messenger/threadPane.css</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -219,58 +219,81 @@ treechildren::-moz-tree-image(junkStatus</span>
<a href="#l31.4"></a><span id="l31.4"> treechildren::-moz-tree-image(junkStatusCol, notjunk) {</span>
<a href="#l31.5"></a><span id="l31.5">   list-style-image: url(&quot;chrome://messenger/skin/icons/readcol-read.gif&quot;);</span>
<a href="#l31.6"></a><span id="l31.6">   -moz-padding-start: 0px;</span>
<a href="#l31.7"></a><span id="l31.7">   -moz-padding-end: 4px;</span>
<a href="#l31.8"></a><span id="l31.8"> }</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10"> /* ..... subject column ..... */</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;],</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+treechildren::-moz-tree-image(subjectCol) {</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail.gif&quot;);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+}</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+</span>
<a href="#l31.17"></a><span id="l31.17"> treechildren::-moz-tree-image(subjectCol) {</span>
<a href="#l31.18"></a><span id="l31.18">   -moz-margin-end: 2px;</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineminus">-  list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail.gif&quot;);</span>
<a href="#l31.20"></a><span id="l31.20"> }</span>
<a href="#l31.21"></a><span id="l31.21"> </span>
<a href="#l31.22"></a><span id="l31.22"> treechildren::-moz-tree-image(subjectCol, new) {</span>
<a href="#l31.23"></a><span id="l31.23">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-new.gif&quot;);</span>
<a href="#l31.24"></a><span id="l31.24"> }</span>
<a href="#l31.25"></a><span id="l31.25"> </span>
<a href="#l31.26"></a><span id="l31.26" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][Attachment=&quot;true&quot;],</span>
<a href="#l31.27"></a><span id="l31.27"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, attach) {</span>
<a href="#l31.28"></a><span id="l31.28">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-attach.gif&quot;);</span>
<a href="#l31.29"></a><span id="l31.29"> }</span>
<a href="#l31.30"></a><span id="l31.30"> </span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][IMAPDeleted=&quot;true&quot;],</span>
<a href="#l31.32"></a><span id="l31.32"> treechildren::-moz-tree-image(subjectCol, imapdeleted) {</span>
<a href="#l31.33"></a><span id="l31.33">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-imapdelete.gif&quot;);</span>
<a href="#l31.34"></a><span id="l31.34"> }</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.37"></a><span id="l31.37"> treechildren::-moz-tree-image(subjectCol, offline) {</span>
<a href="#l31.38"></a><span id="l31.38">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-offl.gif&quot;);</span>
<a href="#l31.39"></a><span id="l31.39"> }</span>
<a href="#l31.40"></a><span id="l31.40"> </span>
<a href="#l31.41"></a><span id="l31.41"> treechildren::-moz-tree-image(subjectCol, new, offline) {</span>
<a href="#l31.42"></a><span id="l31.42">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-new-offl.gif&quot;);</span>
<a href="#l31.43"></a><span id="l31.43"> }</span>
<a href="#l31.44"></a><span id="l31.44"> </span>
<a href="#l31.45"></a><span id="l31.45" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][Attachment=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.46"></a><span id="l31.46"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, attach, offline) {</span>
<a href="#l31.47"></a><span id="l31.47">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-attach-offl.gif&quot;);</span>
<a href="#l31.48"></a><span id="l31.48"> }</span>
<a href="#l31.49"></a><span id="l31.49"> </span>
<a href="#l31.50"></a><span id="l31.50" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][IMAPDeleted=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.51"></a><span id="l31.51"> treechildren::-moz-tree-image(subjectCol, imapdeleted, offline) {</span>
<a href="#l31.52"></a><span id="l31.52">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-mail-delete-offl.gif&quot;);</span>
<a href="#l31.53"></a><span id="l31.53"> }</span>
<a href="#l31.54"></a><span id="l31.54"> </span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+/* the news icons are only 14px high, unfortunately */</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;] .tab-icon,</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;] .tab-icon {</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineplus">+  height: 14px;</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineplus">+}</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;],</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;],</span>
<a href="#l31.63"></a><span id="l31.63"> treechildren::-moz-tree-image(subjectCol, rss),</span>
<a href="#l31.64"></a><span id="l31.64"> treechildren::-moz-tree-image(subjectCol, news) {</span>
<a href="#l31.65"></a><span id="l31.65">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news.gif&quot;);</span>
<a href="#l31.66"></a><span id="l31.66"> }</span>
<a href="#l31.67"></a><span id="l31.67"> </span>
<a href="#l31.68"></a><span id="l31.68" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;][Attachment=&quot;true&quot;],</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;][Attachment=&quot;true&quot;],</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineplus">+tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, rss, attach),</span>
<a href="#l31.71"></a><span id="l31.71"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, news, attach) {</span>
<a href="#l31.72"></a><span id="l31.72">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-attach.gif&quot;);</span>
<a href="#l31.73"></a><span id="l31.73"> }</span>
<a href="#l31.74"></a><span id="l31.74"> </span>
<a href="#l31.75"></a><span id="l31.75" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;][Attachment=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;][Attachment=&quot;true&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.77"></a><span id="l31.77" class="difflineplus">+tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, rss, attach, offline),</span>
<a href="#l31.78"></a><span id="l31.78"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, news, attach, offline) {</span>
<a href="#l31.79"></a><span id="l31.79">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-attach-offl.gif&quot;);</span>
<a href="#l31.80"></a><span id="l31.80"> }</span>
<a href="#l31.81"></a><span id="l31.81"> </span>
<a href="#l31.82"></a><span id="l31.82"> treechildren::-moz-tree-image(subjectCol, rss, new),</span>
<a href="#l31.83"></a><span id="l31.83"> treechildren::-moz-tree-image(subjectCol, news, new) {</span>
<a href="#l31.84"></a><span id="l31.84">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-new.gif&quot;);</span>
<a href="#l31.85"></a><span id="l31.85"> }</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineat">@@ -282,16 +305,19 @@ tree[noattachcol=&quot;true&quot;] &gt; treechildren:</span>
<a href="#l31.87"></a><span id="l31.87"> tree[noattachcol=&quot;true&quot;] &gt; treechildren::-moz-tree-image(subjectCol, news, new, attach, offline) {</span>
<a href="#l31.88"></a><span id="l31.88">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-new-attach-off.gif&quot;);</span>
<a href="#l31.89"></a><span id="l31.89"> }</span>
<a href="#l31.90"></a><span id="l31.90"> </span>
<a href="#l31.91"></a><span id="l31.91"> treechildren::-moz-tree-image(subjectCol, news, new, offline) {</span>
<a href="#l31.92"></a><span id="l31.92">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-new-offl.gif&quot;);</span>
<a href="#l31.93"></a><span id="l31.93"> }</span>
<a href="#l31.94"></a><span id="l31.94"> </span>
<a href="#l31.95"></a><span id="l31.95" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;rss&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.96"></a><span id="l31.96" class="difflineplus">+.tabmail-tab[type=&quot;message&quot;][MessageType=&quot;nntp&quot;][Offline=&quot;true&quot;],</span>
<a href="#l31.97"></a><span id="l31.97" class="difflineplus">+treechildren::-moz-tree-image(subjectCol, rss, offline),</span>
<a href="#l31.98"></a><span id="l31.98"> treechildren::-moz-tree-image(subjectCol, news, offline) {</span>
<a href="#l31.99"></a><span id="l31.99">   list-style-image: url(&quot;chrome://messenger/skin/icons/message-news-offl.gif&quot;);</span>
<a href="#l31.100"></a><span id="l31.100"> }</span>
<a href="#l31.101"></a><span id="l31.101"> </span>
<a href="#l31.102"></a><span id="l31.102"> #sizeCol,</span>
<a href="#l31.103"></a><span id="l31.103"> #unreadCol,</span>
<a href="#l31.104"></a><span id="l31.104"> #totalCol {</span>
<a href="#l31.105"></a><span id="l31.105">   text-align: right;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

