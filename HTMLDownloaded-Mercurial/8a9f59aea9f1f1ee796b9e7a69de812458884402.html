<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4772:8a9f59aea9f1f1ee796b9e7a69de812458884402</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 8a9f59aea9f1f1ee796b9e7a69de812458884402" />
<meta property="og:url" content="/comm-central/rev/8a9f59aea9f1f1ee796b9e7a69de812458884402" />
<meta property="og:description" content="Backed out changeset 82285c09d260 / Bug 499995 due to test failures." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 8a9f59aea9f1f1ee796b9e7a69de812458884402 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/8a9f59aea9f1f1ee796b9e7a69de812458884402">shortlog</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/8a9f59aea9f1f1ee796b9e7a69de812458884402">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402">files</a> |
changeset |
<a href="/comm-central/raw-rev/8a9f59aea9f1f1ee796b9e7a69de812458884402">raw</a>  | <a href="/comm-central/archive/8a9f59aea9f1f1ee796b9e7a69de812458884402.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Backed out changeset 82285c09d260 / <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=499995">Bug 499995</a> due to test failures.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 27 Jan 2010 06:42:46 -0800</td></tr>

<tr>
 <td>changeset 4772</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/8a9f59aea9f1f1ee796b9e7a69de812458884402">8a9f59aea9f1f1ee796b9e7a69de812458884402</a></td>
</tr>



<tr>
<td>parent 4771</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/82285c09d26034304d97dd570d274ee920c365d1">82285c09d26034304d97dd570d274ee920c365d1</a>
</td>
</tr>

<tr>
<td>child 4773</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/bf4b1864fb53e9cb5e9beb5d64a27716e713d9af">bf4b1864fb53e9cb5e9beb5d64a27716e713d9af</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=8a9f59aea9f1f1ee796b9e7a69de812458884402">3733</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 27 Jan 2010 14:42:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8a9f59aea9f1 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8a9f59aea9f1f1ee796b9e7a69de812458884402">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8a9f59aea9f1f1ee796b9e7a69de812458884402&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8a9f59aea9f1f1ee796b9e7a69de812458884402&newProject=comm-central&newRevision=8a9f59aea9f1f1ee796b9e7a69de812458884402&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8a9f59aea9f1f1ee796b9e7a69de812458884402&newProject=comm-central&newRevision=8a9f59aea9f1f1ee796b9e7a69de812458884402&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8a9f59aea9f1f1ee796b9e7a69de812458884402&newProject=comm-central&newRevision=8a9f59aea9f1f1ee796b9e7a69de812458884402&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=499995">499995</a></td></tr>

<tr><td>backs out</td><td><a style="font-family: monospace" href="/comm-central/rev/82285c09d26034304d97dd570d274ee920c365d1">82285c09d26034304d97dd570d274ee920c365d1</a></td></tr>


</table></div>

<div class="page_body description">Backed out changeset 82285c09d260 / <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=499995">Bug 499995</a> due to test failures.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/public/nsIMsgThread.idl">mailnews/base/public/nsIMsgThread.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/public/nsIMsgThread.idl">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/public/nsIMsgThread.idl">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/public/nsIMsgThread.idl">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/public/nsIMsgThread.idl">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/public/nsIMsgThread.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgGroupThread.cpp">mailnews/base/src/nsMsgGroupThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgGroupThread.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgGroupThread.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgGroupThread.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgGroupThread.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgGroupThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgMailSession.h">mailnews/base/src/nsMsgMailSession.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgMailSession.h">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgMailSession.h">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgMailSession.h">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgMailSession.h">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgMailSession.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgQuickSearchDBView.cpp">mailnews/base/src/nsMsgQuickSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgQuickSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgQuickSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgQuickSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgQuickSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgQuickSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.cpp">mailnews/base/src/nsMsgXFViewThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.h">mailnews/base/src/nsMsgXFViewThread.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.h">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.h">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.h">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.h">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/src/nsMsgXFViewThread.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/util/nsImapMoveCoalescer.cpp">mailnews/base/util/nsImapMoveCoalescer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/util/nsImapMoveCoalescer.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/util/nsImapMoveCoalescer.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/util/nsImapMoveCoalescer.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/util/nsImapMoveCoalescer.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/base/util/nsImapMoveCoalescer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgThread.cpp">mailnews/db/msgdb/src/nsMsgThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgThread.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgThread.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgThread.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgThread.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/db/msgdb/src/nsMsgThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/mime/src/mimemrel.h">mailnews/mime/src/mimemrel.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/mime/src/mimemrel.h">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/mime/src/mimemrel.h">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/mime/src/mimemrel.h">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/mime/src/mimemrel.h">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/mime/src/mimemrel.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/8a9f59aea9f1f1ee796b9e7a69de812458884402/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgThread.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgThread.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -38,30 +38,30 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsISimpleEnumerator.idl&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;MailNewsTypes2.idl&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> interface nsIMsgDBHdr;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> interface nsIDBChangeAnnouncer;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-[scriptable, uuid(45f11afe-4ac4-428b-b2ed-4c7038e6d7d6)]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+[scriptable, uuid(1a32967f-0b80-4b20-a046-716d0f3e69bf)]</span>
<a href="#l1.14"></a><span id="l1.14"> interface nsIMsgThread : nsISupports {</span>
<a href="#l1.15"></a><span id="l1.15">   attribute nsMsgKey threadKey;</span>
<a href="#l1.16"></a><span id="l1.16">   attribute unsigned long flags;</span>
<a href="#l1.17"></a><span id="l1.17">   attribute ACString subject;</span>
<a href="#l1.18"></a><span id="l1.18">   attribute unsigned long newestMsgDate;</span>
<a href="#l1.19"></a><span id="l1.19">   readonly attribute unsigned long numChildren;</span>
<a href="#l1.20"></a><span id="l1.20">   readonly attribute unsigned long numUnreadChildren;</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">   void addChild(in nsIMsgDBHdr child, in nsIMsgDBHdr inReplyTo, in boolean threadInThread, in nsIDBChangeAnnouncer announcer);</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-  nsIMsgDBHdr getChildAt(in unsigned long index);</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-  nsMsgKey getChildKeyAt(in unsigned long index);</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+  nsIMsgDBHdr getChildAt(in long index);</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+  nsMsgKey getChildKeyAt(in long index);</span>
<a href="#l1.27"></a><span id="l1.27">   nsIMsgDBHdr getChild(in nsMsgKey msgKey);</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-  nsIMsgDBHdr getChildHdrAt(in unsigned long index);</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+  nsIMsgDBHdr getChildHdrAt(in long index);</span>
<a href="#l1.30"></a><span id="l1.30">   nsIMsgDBHdr getRootHdr(out long index);</span>
<a href="#l1.31"></a><span id="l1.31">   void removeChildAt(in long index);</span>
<a href="#l1.32"></a><span id="l1.32">   void removeChildHdr(in nsIMsgDBHdr child, in nsIDBChangeAnnouncer announcer);</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34">   void markChildRead(in boolean bRead);</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36">   nsIMsgDBHdr getFirstUnreadChild();</span>
<a href="#l1.37"></a><span id="l1.37"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -2618,16 +2618,17 @@ nsresult nsMsgDBView::GetHeadersFromSele</span>
<a href="#l2.4"></a><span id="l2.4">     if (viewIndexFlags &amp; MSG_VIEW_FLAG_DUMMY)</span>
<a href="#l2.5"></a><span id="l2.5">     {</span>
<a href="#l2.6"></a><span id="l2.6">       // if collapsed dummy header selected, list its children</span>
<a href="#l2.7"></a><span id="l2.7">       if (includeCollapsedMsgs &amp;&amp; viewIndexFlags &amp; nsMsgMessageFlags::Elided &amp;&amp;</span>
<a href="#l2.8"></a><span id="l2.8">           m_viewFlags &amp; nsMsgViewFlagsType::kThreadedDisplay)</span>
<a href="#l2.9"></a><span id="l2.9">         rv = ListCollapsedChildren(viewIndex, messageArray);</span>
<a href="#l2.10"></a><span id="l2.10">       continue;</span>
<a href="#l2.11"></a><span id="l2.11">     }</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+    nsMsgKey key = m_keys[viewIndex];</span>
<a href="#l2.13"></a><span id="l2.13">     nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l2.14"></a><span id="l2.14">     rv = GetMsgHdrForViewIndex(viewIndex, getter_AddRefs(msgHdr));</span>
<a href="#l2.15"></a><span id="l2.15">     if (NS_SUCCEEDED(rv) &amp;&amp; msgHdr)</span>
<a href="#l2.16"></a><span id="l2.16">     {</span>
<a href="#l2.17"></a><span id="l2.17">       rv = messageArray-&gt;AppendElement(msgHdr, PR_FALSE);</span>
<a href="#l2.18"></a><span id="l2.18">       if (NS_SUCCEEDED(rv) &amp;&amp; includeCollapsedMsgs &amp;&amp; </span>
<a href="#l2.19"></a><span id="l2.19">           viewIndexFlags &amp; nsMsgMessageFlags::Elided &amp;&amp;</span>
<a href="#l2.20"></a><span id="l2.20">           viewIndexFlags &amp; MSG_VIEW_FLAG_HASCHILDREN &amp;&amp;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -2758,21 +2759,22 @@ nsMsgDBView::ApplyCommandToIndices(nsMsg</span>
<a href="#l2.22"></a><span id="l2.22">     // Turn the selection into an array of msg hdrs. This may include messages</span>
<a href="#l2.23"></a><span id="l2.23">     // in collapsed threads</span>
<a href="#l2.24"></a><span id="l2.24">     PRUint32 length;</span>
<a href="#l2.25"></a><span id="l2.25">     nsCOMPtr&lt;nsIMutableArray&gt; messages(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l2.26"></a><span id="l2.26">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.27"></a><span id="l2.27">     rv = GetHeadersFromSelection(indices, numIndices, messages);</span>
<a href="#l2.28"></a><span id="l2.28">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.29"></a><span id="l2.29">     messages-&gt;GetLength(&amp;length);</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+    PRUint32 numMsgsSelected = length;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">     if (thisIsImapFolder)</span>
<a href="#l2.33"></a><span id="l2.33">       imapUids.SetLength(length);</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-    for (PRUint32 i = 0; i &lt; length; i++)</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+    for (PRInt32 i = 0; i &lt; length; i++)</span>
<a href="#l2.37"></a><span id="l2.37">     {</span>
<a href="#l2.38"></a><span id="l2.38">       nsMsgKey msgKey;</span>
<a href="#l2.39"></a><span id="l2.39">       nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(messages, i);</span>
<a href="#l2.40"></a><span id="l2.40">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l2.41"></a><span id="l2.41">       if (thisIsImapFolder)</span>
<a href="#l2.42"></a><span id="l2.42">         imapUids[i] = msgKey;</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">       switch (command)</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineat">@@ -2833,16 +2835,17 @@ nsMsgDBView::ApplyCommandToIndices(nsMsg</span>
<a href="#l2.46"></a><span id="l2.46">   }</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48">   folder-&gt;EnableNotifications(nsIMsgFolder::allMessageCountNotifications, PR_TRUE, PR_TRUE /*dbBatching*/);</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50">   if (thisIsImapFolder)</span>
<a href="#l2.51"></a><span id="l2.51">   {</span>
<a href="#l2.52"></a><span id="l2.52">     imapMessageFlagsType flags = kNoImapMsgFlag;</span>
<a href="#l2.53"></a><span id="l2.53">     PRBool addFlags = PR_FALSE;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+    PRBool isRead = PR_FALSE;</span>
<a href="#l2.55"></a><span id="l2.55">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(mMsgWindowWeak));</span>
<a href="#l2.56"></a><span id="l2.56">     switch (command)</span>
<a href="#l2.57"></a><span id="l2.57">     {</span>
<a href="#l2.58"></a><span id="l2.58">     case nsMsgViewCommandType::markThreadRead:</span>
<a href="#l2.59"></a><span id="l2.59">     case nsMsgViewCommandType::markMessagesRead:</span>
<a href="#l2.60"></a><span id="l2.60">       flags |= kImapMsgSeenFlag;</span>
<a href="#l2.61"></a><span id="l2.61">       addFlags = PR_TRUE;</span>
<a href="#l2.62"></a><span id="l2.62">       break;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineat">@@ -3312,17 +3315,17 @@ nsMsgDBView::PerformActionsOnJunkMsgs(PR</span>
<a href="#l2.64"></a><span id="l2.64">       rv = srcFolder-&gt;DeleteMessages(mJunkHdrs, msgWindow, PR_FALSE, PR_FALSE,</span>
<a href="#l2.65"></a><span id="l2.65">                                      nsnull, PR_TRUE);</span>
<a href="#l2.66"></a><span id="l2.66">     }</span>
<a href="#l2.67"></a><span id="l2.67">     else if (mDeleteModel == nsMsgImapDeleteModels::IMAPDelete)</span>
<a href="#l2.68"></a><span id="l2.68">     {</span>
<a href="#l2.69"></a><span id="l2.69">       nsCOMPtr&lt;nsIMsgImapMailFolder&gt; imapFolder(do_QueryInterface(srcFolder));</span>
<a href="#l2.70"></a><span id="l2.70">       nsTArray&lt;nsMsgKey&gt; imapUids;</span>
<a href="#l2.71"></a><span id="l2.71">       imapUids.SetLength(numJunkHdrs);</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-      for (PRUint32 i = 0; i &lt; numJunkHdrs; i++)</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+      for (int32 i = 0; i &lt; numJunkHdrs; i++)</span>
<a href="#l2.74"></a><span id="l2.74">       {</span>
<a href="#l2.75"></a><span id="l2.75">         nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(mJunkHdrs, i);</span>
<a href="#l2.76"></a><span id="l2.76">         msgHdr-&gt;GetMessageKey(&amp;imapUids[i]);</span>
<a href="#l2.77"></a><span id="l2.77">       }</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">       imapFolder-&gt;StoreImapFlags(kImapMsgDeletedFlag, PR_FALSE, imapUids.Elements(),</span>
<a href="#l2.80"></a><span id="l2.80">                                  imapUids.Length(), nsnull);</span>
<a href="#l2.81"></a><span id="l2.81">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgGroupThread.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -227,41 +227,41 @@ nsMsgViewIndex nsMsgGroupThread::AddChil</span>
<a href="#l3.4"></a><span id="l3.4"> }</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> nsresult nsMsgGroupThread::ReparentNonReferenceChildrenOf(nsIMsgDBHdr *topLevelHdr, nsMsgKey newParentKey,</span>
<a href="#l3.7"></a><span id="l3.7">                                                             nsIDBChangeAnnouncer *announcer)</span>
<a href="#l3.8"></a><span id="l3.8"> {</span>
<a href="#l3.9"></a><span id="l3.9">   return NS_OK;</span>
<a href="#l3.10"></a><span id="l3.10"> }</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-NS_IMETHODIMP nsMsgGroupThread::GetChildKeyAt(PRUint32 aIndex, nsMsgKey *aResult)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+NS_IMETHODIMP nsMsgGroupThread::GetChildKeyAt(PRInt32 aIndex, nsMsgKey *aResult)</span>
<a href="#l3.14"></a><span id="l3.14"> {</span>
<a href="#l3.15"></a><span id="l3.15">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l3.16"></a><span id="l3.16">   if (aIndex &gt;= m_keys.Length())</span>
<a href="#l3.17"></a><span id="l3.17">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l3.18"></a><span id="l3.18">   *aResult = m_keys[aIndex];</span>
<a href="#l3.19"></a><span id="l3.19">   return NS_OK;</span>
<a href="#l3.20"></a><span id="l3.20"> }</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-NS_IMETHODIMP nsMsgGroupThread::GetChildAt(PRUint32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+NS_IMETHODIMP nsMsgGroupThread::GetChildAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l3.24"></a><span id="l3.24"> {</span>
<a href="#l3.25"></a><span id="l3.25">   if (aIndex &gt;= m_keys.Length())</span>
<a href="#l3.26"></a><span id="l3.26">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l3.27"></a><span id="l3.27">   return m_db-&gt;GetMsgHdrForKey(m_keys[aIndex], aResult);</span>
<a href="#l3.28"></a><span id="l3.28"> }</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31"> NS_IMETHODIMP nsMsgGroupThread::GetChild(nsMsgKey msgKey, nsIMsgDBHdr **aResult)</span>
<a href="#l3.32"></a><span id="l3.32"> {</span>
<a href="#l3.33"></a><span id="l3.33">   PRUint32 childIndex = m_keys.IndexOf(msgKey);</span>
<a href="#l3.34"></a><span id="l3.34">   return (childIndex != kNotFound) ? GetChildAt(childIndex, aResult) : NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l3.35"></a><span id="l3.35"> }</span>
<a href="#l3.36"></a><span id="l3.36"> </span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-NS_IMETHODIMP nsMsgGroupThread::GetChildHdrAt(PRUint32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+NS_IMETHODIMP nsMsgGroupThread::GetChildHdrAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l3.40"></a><span id="l3.40"> {</span>
<a href="#l3.41"></a><span id="l3.41">   return GetChildAt(aIndex, aResult);</span>
<a href="#l3.42"></a><span id="l3.42"> }</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45"> NS_IMETHODIMP nsMsgGroupThread::RemoveChildAt(PRInt32 aIndex)</span>
<a href="#l3.46"></a><span id="l3.46"> {</span>
<a href="#l3.47"></a><span id="l3.47">   m_keys.RemoveElementAt(aIndex);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineat">@@ -868,17 +868,17 @@ nsMsgViewIndex nsMsgXFGroupThread::FindM</span>
<a href="#l3.49"></a><span id="l3.49"> {</span>
<a href="#l3.50"></a><span id="l3.50">   nsMsgKey msgKey;</span>
<a href="#l3.51"></a><span id="l3.51">   hdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l3.52"></a><span id="l3.52">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l3.53"></a><span id="l3.53">   hdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l3.54"></a><span id="l3.54">   PRUint32 index = 0;</span>
<a href="#l3.55"></a><span id="l3.55">   while (PR_TRUE) {</span>
<a href="#l3.56"></a><span id="l3.56">     index = m_keys.IndexOf(msgKey, index);</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-    if (index == m_keys.NoIndex || m_folders[index] == folder)</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+    if (index == -1 || m_folders[index] == folder)</span>
<a href="#l3.59"></a><span id="l3.59">       break;</span>
<a href="#l3.60"></a><span id="l3.60">     index++;</span>
<a href="#l3.61"></a><span id="l3.61">   }</span>
<a href="#l3.62"></a><span id="l3.62">   return (nsMsgViewIndex)index;</span>
<a href="#l3.63"></a><span id="l3.63"> }</span>
<a href="#l3.64"></a><span id="l3.64"> </span>
<a href="#l3.65"></a><span id="l3.65"> nsMsgViewIndex nsMsgXFGroupThread::AddMsgHdrInDateOrder(nsIMsgDBHdr *child, nsMsgDBView *view)</span>
<a href="#l3.66"></a><span id="l3.66"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -122,16 +122,16 @@ public:</span>
<a href="#l4.4"></a><span id="l4.4">     </span>
<a href="#l4.5"></a><span id="l4.5"> protected:</span>
<a href="#l4.6"></a><span id="l4.6">   nsresult ProcessNextTask();</span>
<a href="#l4.7"></a><span id="l4.7">   void AttemptShutdown();</span>
<a href="#l4.8"></a><span id="l4.8">   </span>
<a href="#l4.9"></a><span id="l4.9"> private:</span>
<a href="#l4.10"></a><span id="l4.10">   nsCOMArray&lt;nsIMsgShutdownTask&gt; mShutdownTasks;</span>
<a href="#l4.11"></a><span id="l4.11">   nsCOMPtr&lt;nsIMsgProgress&gt;       mMsgProgress;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  PRInt32                        mTaskIndex;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  PRUint32                       mTaskIndex;</span>
<a href="#l4.14"></a><span id="l4.14">   PRUint32                       mQuitMode;</span>
<a href="#l4.15"></a><span id="l4.15">   PRPackedBool mProcessedShutdown;</span>
<a href="#l4.16"></a><span id="l4.16">   PRPackedBool mQuitForced;</span>
<a href="#l4.17"></a><span id="l4.17">   PRPackedBool mReadyToQuit;</span>
<a href="#l4.18"></a><span id="l4.18"> };</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> #endif /* nsMsgMailSession_h__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgQuickSearchDBView.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -142,17 +142,17 @@ NS_IMETHODIMP nsMsgQuickSearchDBView::Ge</span>
<a href="#l5.4"></a><span id="l5.4">     return NS_OK;</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> nsresult nsMsgQuickSearchDBView::AddHdr(nsIMsgDBHdr *msgHdr, nsMsgViewIndex *resultIndex)</span>
<a href="#l5.8"></a><span id="l5.8"> {</span>
<a href="#l5.9"></a><span id="l5.9">   nsMsgKey msgKey;</span>
<a href="#l5.10"></a><span id="l5.10">   msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l5.11"></a><span id="l5.11">   // protect against duplication.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  if (m_origKeys.BinaryIndexOf(msgKey) == m_origKeys.NoIndex)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  if (m_origKeys.BinaryIndexOf(msgKey)== -1)</span>
<a href="#l5.14"></a><span id="l5.14">   {</span>
<a href="#l5.15"></a><span id="l5.15">     nsMsgViewIndex insertIndex = GetInsertIndexHelper(msgHdr, m_origKeys, nsnull,</span>
<a href="#l5.16"></a><span id="l5.16">                     nsMsgViewSortOrder::ascending, nsMsgViewSortType::byId);</span>
<a href="#l5.17"></a><span id="l5.17">     m_origKeys.InsertElementAt(insertIndex, msgKey);</span>
<a href="#l5.18"></a><span id="l5.18">   }</span>
<a href="#l5.19"></a><span id="l5.19">   if (m_viewFlags &amp; (nsMsgViewFlagsType::kGroupBySort|</span>
<a href="#l5.20"></a><span id="l5.20">                      nsMsgViewFlagsType::kThreadedDisplay))</span>
<a href="#l5.21"></a><span id="l5.21">   {</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -433,17 +433,17 @@ nsresult nsMsgQuickSearchDBView::GetFirs</span>
<a href="#l5.23"></a><span id="l5.23">     rv = threadHdr-&gt;GetChildHdrAt(childIndex, getter_AddRefs(child));</span>
<a href="#l5.24"></a><span id="l5.24">     if (NS_SUCCEEDED(rv) &amp;&amp; child)</span>
<a href="#l5.25"></a><span id="l5.25">     {</span>
<a href="#l5.26"></a><span id="l5.26">       nsMsgKey msgKey;</span>
<a href="#l5.27"></a><span id="l5.27">       child-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">       // this works because we've already sorted m_keys by id.</span>
<a href="#l5.30"></a><span id="l5.30">       nsMsgViewIndex keyIndex = m_origKeys.BinaryIndexOf(msgKey);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      if (keyIndex != m_origKeys.NoIndex)</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      if (keyIndex != kNotFound)</span>
<a href="#l5.33"></a><span id="l5.33">       {</span>
<a href="#l5.34"></a><span id="l5.34">         // this is the root, so it's the best we're going to do.</span>
<a href="#l5.35"></a><span id="l5.35">         if (msgKey == threadRootKey)</span>
<a href="#l5.36"></a><span id="l5.36">         {</span>
<a href="#l5.37"></a><span id="l5.37">           retHdr = child;</span>
<a href="#l5.38"></a><span id="l5.38">           break;</span>
<a href="#l5.39"></a><span id="l5.39">         }</span>
<a href="#l5.40"></a><span id="l5.40">         PRUint8 level = 0;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -497,17 +497,17 @@ nsresult nsMsgQuickSearchDBView::SortThr</span>
<a href="#l5.42"></a><span id="l5.42">     GetMsgHdrForViewIndex(i, getter_AddRefs(msgHdr));</span>
<a href="#l5.43"></a><span id="l5.43">     m_db-&gt;GetThreadContainingMsgHdr(msgHdr, getter_AddRefs(threadHdr));</span>
<a href="#l5.44"></a><span id="l5.44">     if (threadHdr)</span>
<a href="#l5.45"></a><span id="l5.45">     {</span>
<a href="#l5.46"></a><span id="l5.46">       nsMsgKey rootKey;</span>
<a href="#l5.47"></a><span id="l5.47">       threadHdr-&gt;GetChildKeyAt(0, &amp;rootKey);</span>
<a href="#l5.48"></a><span id="l5.48">       nsMsgViewIndex threadRootIndex = threadRootIds.BinaryIndexOf(rootKey);</span>
<a href="#l5.49"></a><span id="l5.49">       // if we already have that id in top level threads, ignore this msg.</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-      if (threadRootIndex != threadRootIds.NoIndex)</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+      if (threadRootIndex != kNotFound)</span>
<a href="#l5.52"></a><span id="l5.52">         continue;</span>
<a href="#l5.53"></a><span id="l5.53">       // it would be nice if GetInsertIndexHelper always found the hdr, but it doesn't.</span>
<a href="#l5.54"></a><span id="l5.54">       threadHdr-&gt;GetChildHdrAt(0, getter_AddRefs(rootHdr));</span>
<a href="#l5.55"></a><span id="l5.55">       threadRootIndex = GetInsertIndexHelper(rootHdr, threadRootIds, nsnull,</span>
<a href="#l5.56"></a><span id="l5.56">                                              nsMsgViewSortOrder::ascending,</span>
<a href="#l5.57"></a><span id="l5.57">                                              nsMsgViewSortType::byId);</span>
<a href="#l5.58"></a><span id="l5.58">       threadRootIds.InsertElementAt(threadRootIndex, rootKey);</span>
<a href="#l5.59"></a><span id="l5.59">     }</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineat">@@ -579,17 +579,17 @@ nsMsgQuickSearchDBView::ListCollapsedChi</span>
<a href="#l5.61"></a><span id="l5.61">     threadHdr-&gt;GetChildHdrAt(i, getter_AddRefs(msgHdr));</span>
<a href="#l5.62"></a><span id="l5.62">     if (msgHdr)</span>
<a href="#l5.63"></a><span id="l5.63">     {</span>
<a href="#l5.64"></a><span id="l5.64">       nsMsgKey msgKey;</span>
<a href="#l5.65"></a><span id="l5.65">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l5.66"></a><span id="l5.66">       if (msgKey != rootKey || (GroupViewUsesDummyRow() &amp;&amp; rootKeySkipped))</span>
<a href="#l5.67"></a><span id="l5.67">       {</span>
<a href="#l5.68"></a><span id="l5.68">         // if this hdr is in the original view, add it to new view.</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-        if (m_origKeys.BinaryIndexOf(msgKey) != m_origKeys.NoIndex)</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+        if (m_origKeys.BinaryIndexOf(msgKey) != kNotFound)</span>
<a href="#l5.71"></a><span id="l5.71">           messageArray-&gt;AppendElement(msgHdr, PR_FALSE);</span>
<a href="#l5.72"></a><span id="l5.72">       }</span>
<a href="#l5.73"></a><span id="l5.73">       else</span>
<a href="#l5.74"></a><span id="l5.74">       {</span>
<a href="#l5.75"></a><span id="l5.75">         rootKeySkipped = PR_TRUE;</span>
<a href="#l5.76"></a><span id="l5.76">       }</span>
<a href="#l5.77"></a><span id="l5.77">     }</span>
<a href="#l5.78"></a><span id="l5.78">   }</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineat">@@ -624,17 +624,17 @@ nsresult nsMsgQuickSearchDBView::ListIds</span>
<a href="#l5.80"></a><span id="l5.80">     if (msgHdr != nsnull)</span>
<a href="#l5.81"></a><span id="l5.81">     {</span>
<a href="#l5.82"></a><span id="l5.82">       nsMsgKey msgKey;</span>
<a href="#l5.83"></a><span id="l5.83">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l5.84"></a><span id="l5.84">       if (msgKey != rootKey || (GroupViewUsesDummyRow() &amp;&amp; rootKeySkipped))</span>
<a href="#l5.85"></a><span id="l5.85">       {</span>
<a href="#l5.86"></a><span id="l5.86">         nsMsgViewIndex threadRootIndex = m_origKeys.BinaryIndexOf(msgKey);</span>
<a href="#l5.87"></a><span id="l5.87">         // if this hdr is in the original view, add it to new view.</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-        if (threadRootIndex != m_origKeys.NoIndex)</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+        if (threadRootIndex != kNotFound)</span>
<a href="#l5.90"></a><span id="l5.90">         {</span>
<a href="#l5.91"></a><span id="l5.91">           PRUint32 childFlags;</span>
<a href="#l5.92"></a><span id="l5.92">           msgHdr-&gt;GetFlags(&amp;childFlags);</span>
<a href="#l5.93"></a><span id="l5.93">           InsertMsgHdrAt(viewIndex, msgHdr, msgKey, childFlags, </span>
<a href="#l5.94"></a><span id="l5.94">                         FindLevelInThread(msgHdr, startOfThreadViewIndex, viewIndex));</span>
<a href="#l5.95"></a><span id="l5.95">           if (! (rootFlags &amp; MSG_VIEW_FLAG_HASCHILDREN))</span>
<a href="#l5.96"></a><span id="l5.96">             m_flags[startOfThreadViewIndex] = rootFlags | MSG_VIEW_FLAG_HASCHILDREN;</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98" class="difflineat">@@ -767,17 +767,17 @@ nsresult nsMsgQuickSearchDBView::Expansi</span>
<a href="#l5.99"></a><span id="l5.99">     threadHdr-&gt;GetChildHdrAt(i, getter_AddRefs(msgHdr));</span>
<a href="#l5.100"></a><span id="l5.100">     if (msgHdr)</span>
<a href="#l5.101"></a><span id="l5.101">     {</span>
<a href="#l5.102"></a><span id="l5.102">       nsMsgKey msgKey;</span>
<a href="#l5.103"></a><span id="l5.103">       msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l5.104"></a><span id="l5.104">       if (msgKey != rootKey || (GroupViewUsesDummyRow() &amp;&amp; rootKeySkipped))</span>
<a href="#l5.105"></a><span id="l5.105">       {</span>
<a href="#l5.106"></a><span id="l5.106">         // if this hdr is in the original view, add it to new view.</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-        if (m_origKeys.BinaryIndexOf(msgKey) != m_origKeys.NoIndex)</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+        if (m_origKeys.BinaryIndexOf(msgKey) != kNotFound)</span>
<a href="#l5.109"></a><span id="l5.109">           (*expansionDelta)++;</span>
<a href="#l5.110"></a><span id="l5.110">       }</span>
<a href="#l5.111"></a><span id="l5.111">       else</span>
<a href="#l5.112"></a><span id="l5.112">       {</span>
<a href="#l5.113"></a><span id="l5.113">         rootKeySkipped = PR_TRUE;</span>
<a href="#l5.114"></a><span id="l5.114">       }</span>
<a href="#l5.115"></a><span id="l5.115">     }</span>
<a href="#l5.116"></a><span id="l5.116">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1061,16 +1061,17 @@ nsMsgSearchDBView::GetMessageId(nsACStri</span>
<a href="#l6.4"></a><span id="l6.4"> }</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> NS_IMETHODIMP</span>
<a href="#l6.7"></a><span id="l6.7"> nsMsgSearchDBView::OnStopCopy(nsresult aStatus)</span>
<a href="#l6.8"></a><span id="l6.8"> {</span>
<a href="#l6.9"></a><span id="l6.9">   if (NS_SUCCEEDED(aStatus))</span>
<a href="#l6.10"></a><span id="l6.10">   {</span>
<a href="#l6.11"></a><span id="l6.11">     mCurIndex++;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+    PRUint32 numFolders = 0;</span>
<a href="#l6.13"></a><span id="l6.13">     if (mCurIndex &lt; (PRUint32) m_uniqueFoldersSelected.Count())</span>
<a href="#l6.14"></a><span id="l6.14">     {</span>
<a href="#l6.15"></a><span id="l6.15">       nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(mMsgWindowWeak));</span>
<a href="#l6.16"></a><span id="l6.16">       ProcessRequestsInOneFolder(msgWindow);</span>
<a href="#l6.17"></a><span id="l6.17">     }</span>
<a href="#l6.18"></a><span id="l6.18">   }</span>
<a href="#l6.19"></a><span id="l6.19">   return NS_OK;</span>
<a href="#l6.20"></a><span id="l6.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -195,17 +195,17 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l7.4"></a><span id="l7.4">     parent-&gt;GetFolder(getter_AddRefs(parentFolder));</span>
<a href="#l7.5"></a><span id="l7.5">     // iterate over our parents' children until we find one we're older than,</span>
<a href="#l7.6"></a><span id="l7.6">     // and insert ourselves before it, or as the last child. In other words,</span>
<a href="#l7.7"></a><span id="l7.7">     // insert, sorted by date.</span>
<a href="#l7.8"></a><span id="l7.8">     PRUint32 msgDate, childDate;</span>
<a href="#l7.9"></a><span id="l7.9">     newHdr-&gt;GetDateInSeconds(&amp;msgDate);</span>
<a href="#l7.10"></a><span id="l7.10">     nsCOMPtr&lt;nsIMsgDBHdr&gt; child;</span>
<a href="#l7.11"></a><span id="l7.11">     nsMsgViewIndex i;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    PRUint32 insertIndex = m_keys.Length();</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    PRInt32 insertIndex = m_keys.Length();</span>
<a href="#l7.14"></a><span id="l7.14">     for (i = parentIndex; </span>
<a href="#l7.15"></a><span id="l7.15">          i &lt; m_keys.Length() &amp;&amp; (i == parentIndex ||  m_levels[i] &gt; parentLevel); i++)</span>
<a href="#l7.16"></a><span id="l7.16">     {</span>
<a href="#l7.17"></a><span id="l7.17">       if (m_levels[i] == parentLevel + 1) // possible sibling</span>
<a href="#l7.18"></a><span id="l7.18">       {</span>
<a href="#l7.19"></a><span id="l7.19">         GetChildHdrAt(i, getter_AddRefs(child));</span>
<a href="#l7.20"></a><span id="l7.20">         if (child)</span>
<a href="#l7.21"></a><span id="l7.21">         {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -288,27 +288,27 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l7.23"></a><span id="l7.23"> //      topLevelHdr-&gt;GetDate(&amp;topLevelHdrDate);</span>
<a href="#l7.24"></a><span id="l7.24"> //      if (LL_CMP(newHdrDate, &lt;, topLevelHdrDate))</span>
<a href="#l7.25"></a><span id="l7.25">       </span>
<a href="#l7.26"></a><span id="l7.26"> //    }</span>
<a href="#l7.27"></a><span id="l7.27"> //  }</span>
<a href="#l7.28"></a><span id="l7.28">   return NS_OK;</span>
<a href="#l7.29"></a><span id="l7.29"> }</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-NS_IMETHODIMP nsMsgXFViewThread::GetChildAt(PRUint32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+NS_IMETHODIMP nsMsgXFViewThread::GetChildAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l7.33"></a><span id="l7.33"> {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-  if (aIndex &gt;= m_keys.Length())</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+  if (aIndex &gt;= (PRInt32) m_keys.Length())</span>
<a href="#l7.36"></a><span id="l7.36">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l7.37"></a><span id="l7.37">   nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l7.38"></a><span id="l7.38">   nsresult rv = m_folders[aIndex]-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l7.39"></a><span id="l7.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.40"></a><span id="l7.40">   return db-&gt;GetMsgHdrForKey(m_keys[aIndex], aResult);</span>
<a href="#l7.41"></a><span id="l7.41"> }</span>
<a href="#l7.42"></a><span id="l7.42"> </span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-NS_IMETHODIMP nsMsgXFViewThread::GetChildHdrAt(PRUint32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+NS_IMETHODIMP nsMsgXFViewThread::GetChildHdrAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l7.45"></a><span id="l7.45"> {</span>
<a href="#l7.46"></a><span id="l7.46">   return GetChildAt(aIndex, aResult);</span>
<a href="#l7.47"></a><span id="l7.47"> }</span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49"> NS_IMETHODIMP nsMsgXFViewThread::RemoveChildAt(PRInt32 aIndex)</span>
<a href="#l7.50"></a><span id="l7.50"> {</span>
<a href="#l7.51"></a><span id="l7.51">   m_keys.RemoveElementAt(aIndex);</span>
<a href="#l7.52"></a><span id="l7.52">   m_levels.RemoveElementAt(aIndex);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineat">@@ -359,30 +359,30 @@ NS_IMETHODIMP nsMsgXFViewThread::RemoveC</span>
<a href="#l7.54"></a><span id="l7.54"> NS_IMETHODIMP nsMsgXFViewThread::GetRootHdr(PRInt32 *aResultIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l7.55"></a><span id="l7.55"> {</span>
<a href="#l7.56"></a><span id="l7.56">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l7.57"></a><span id="l7.57">   if (aResultIndex)</span>
<a href="#l7.58"></a><span id="l7.58">     *aResultIndex = 0;</span>
<a href="#l7.59"></a><span id="l7.59">   return GetChildHdrAt(0, aResult);</span>
<a href="#l7.60"></a><span id="l7.60"> }</span>
<a href="#l7.61"></a><span id="l7.61"> </span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-NS_IMETHODIMP nsMsgXFViewThread::GetChildKeyAt(PRUint32 aIndex, nsMsgKey *aResult)</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+NS_IMETHODIMP nsMsgXFViewThread::GetChildKeyAt(PRInt32 aIndex, nsMsgKey *aResult)</span>
<a href="#l7.64"></a><span id="l7.64"> {</span>
<a href="#l7.65"></a><span id="l7.65">   NS_ASSERTION(PR_FALSE, &quot;shouldn't call this&quot;);</span>
<a href="#l7.66"></a><span id="l7.66">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l7.67"></a><span id="l7.67"> }</span>
<a href="#l7.68"></a><span id="l7.68"> </span>
<a href="#l7.69"></a><span id="l7.69"> NS_IMETHODIMP nsMsgXFViewThread::GetChild(nsMsgKey msgKey, nsIMsgDBHdr **aResult)</span>
<a href="#l7.70"></a><span id="l7.70"> {</span>
<a href="#l7.71"></a><span id="l7.71">   NS_ASSERTION(PR_FALSE, &quot;shouldn't call this&quot;);</span>
<a href="#l7.72"></a><span id="l7.72">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l7.73"></a><span id="l7.73"> }</span>
<a href="#l7.74"></a><span id="l7.74"> </span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-PRInt32 nsMsgXFViewThread::HdrIndex(nsIMsgDBHdr *hdr)</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+PRUint32 nsMsgXFViewThread::HdrIndex(nsIMsgDBHdr *hdr)</span>
<a href="#l7.78"></a><span id="l7.78"> {</span>
<a href="#l7.79"></a><span id="l7.79">   nsMsgKey msgKey;</span>
<a href="#l7.80"></a><span id="l7.80">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l7.81"></a><span id="l7.81">   hdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l7.82"></a><span id="l7.82">   hdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l7.83"></a><span id="l7.83">   for (PRUint32 i = 0; i &lt; m_keys.Length(); i++)</span>
<a href="#l7.84"></a><span id="l7.84">   {</span>
<a href="#l7.85"></a><span id="l7.85">     if (m_keys[i] == msgKey &amp;&amp; m_folders[i] == folder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -62,17 +62,17 @@ public:</span>
<a href="#l8.4"></a><span id="l8.4">   PRBool    IsHdrParentOf(nsIMsgDBHdr *possibleParent,</span>
<a href="#l8.5"></a><span id="l8.5">                           nsIMsgDBHdr *possibleChild);</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">   void      ChangeUnreadChildCount(PRInt32 delta);</span>
<a href="#l8.8"></a><span id="l8.8">   void      ChangeChildCount(PRInt32 delta);</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">   nsresult  AddHdr(nsIMsgDBHdr *newHdr, PRBool reparentChildren, </span>
<a href="#l8.11"></a><span id="l8.11">                    PRUint32 &amp;whereInserted, nsIMsgDBHdr **outParent);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  PRInt32   HdrIndex(nsIMsgDBHdr *hdr);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  PRUint32  HdrIndex(nsIMsgDBHdr *hdr);</span>
<a href="#l8.14"></a><span id="l8.14">   PRUint32  ChildLevelAt(PRUint32 msgIndex) {return m_levels[msgIndex];}</span>
<a href="#l8.15"></a><span id="l8.15">   PRUint32  MsgCount() {return m_numChildren;};</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17"> protected:</span>
<a href="#l8.18"></a><span id="l8.18">   nsMsgSearchDBView *m_view;</span>
<a href="#l8.19"></a><span id="l8.19">   PRUint32        m_numUnreadChildren;	</span>
<a href="#l8.20"></a><span id="l8.20">   PRUint32        m_numChildren;</span>
<a href="#l8.21"></a><span id="l8.21">   PRUint32        m_flags;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/util/nsImapMoveCoalescer.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/util/nsImapMoveCoalescer.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -74,17 +74,17 @@ nsresult nsImapMoveCoalescer::AddMove(ns</span>
<a href="#l9.4"></a><span id="l9.4">   else</span>
<a href="#l9.5"></a><span id="l9.5">   {</span>
<a href="#l9.6"></a><span id="l9.6">     m_destFolders.AppendObject(folder);</span>
<a href="#l9.7"></a><span id="l9.7">     keysToAdd = m_sourceKeyArrays.AppendElement();</span>
<a href="#l9.8"></a><span id="l9.8">     if (!keysToAdd)</span>
<a href="#l9.9"></a><span id="l9.9">       return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l9.10"></a><span id="l9.10">   }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  if (keysToAdd-&gt;IndexOf(key) == keysToAdd-&gt;NoIndex)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  if (keysToAdd-&gt;IndexOf(key) == -1)</span>
<a href="#l9.14"></a><span id="l9.14">     keysToAdd-&gt;AppendElement(key);</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">   return NS_OK;</span>
<a href="#l9.17"></a><span id="l9.17"> }</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> nsresult nsImapMoveCoalescer::PlaybackMoves(PRBool doNewMailNotification /* = PR_FALSE */)</span>
<a href="#l9.20"></a><span id="l9.20"> {</span>
<a href="#l9.21"></a><span id="l9.21">   PRInt32 numFolders = m_destFolders.Count();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1304,22 +1304,19 @@ nsresult nsMsgComposeAndSend::BeginCrypt</span>
<a href="#l10.4"></a><span id="l10.4">     }</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   }</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">   return rv;</span>
<a href="#l10.9"></a><span id="l10.9"> }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> nsresult</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-mime_write_message_body(nsIMsgSend *state, const char *buf, PRInt32 aSize)</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+mime_write_message_body(nsIMsgSend *state, const char *buf, PRInt32 size)</span>
<a href="#l10.14"></a><span id="l10.14"> {</span>
<a href="#l10.15"></a><span id="l10.15">   NS_ENSURE_ARG_POINTER(state);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-  if (aSize &lt; 0)</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-    return NS_ERROR_INVALID_ARG;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-  PRUint32 size = (PRUint32) aSize;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">   nsCOMPtr&lt;nsIOutputStream&gt; output;</span>
<a href="#l10.21"></a><span id="l10.21">   nsCOMPtr&lt;nsIMsgComposeSecure&gt; crypto_closure;</span>
<a href="#l10.22"></a><span id="l10.22"> </span>
<a href="#l10.23"></a><span id="l10.23">   state-&gt;GetOutputStream(getter_AddRefs(output));</span>
<a href="#l10.24"></a><span id="l10.24">   if (!output)</span>
<a href="#l10.25"></a><span id="l10.25">     return NS_MSG_ERROR_WRITING_FILE;</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27" class="difflineat">@@ -1327,19 +1324,23 @@ mime_write_message_body(nsIMsgSend *stat</span>
<a href="#l10.28"></a><span id="l10.28">   if (crypto_closure)</span>
<a href="#l10.29"></a><span id="l10.29">   {</span>
<a href="#l10.30"></a><span id="l10.30">     return crypto_closure-&gt;MimeCryptoWriteBlock (buf, size);</span>
<a href="#l10.31"></a><span id="l10.31">   }</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33">   PRUint32 n;</span>
<a href="#l10.34"></a><span id="l10.34">   nsresult rv = output-&gt;Write(buf, size, &amp;n);</span>
<a href="#l10.35"></a><span id="l10.35">   if (NS_FAILED(rv) || n != size)</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+  {</span>
<a href="#l10.37"></a><span id="l10.37">     return NS_MSG_ERROR_WRITING_FILE;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-  return NS_OK;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+  }</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+  else</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+  {</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+    return NS_OK;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+  }</span>
<a href="#l10.45"></a><span id="l10.45"> }</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47"> nsresult</span>
<a href="#l10.48"></a><span id="l10.48"> mime_encoder_output_fn(const char *buf, PRInt32 size, void *closure)</span>
<a href="#l10.49"></a><span id="l10.49"> {</span>
<a href="#l10.50"></a><span id="l10.50">   nsMsgComposeAndSend *state = (nsMsgComposeAndSend *) closure;</span>
<a href="#l10.51"></a><span id="l10.51">   return mime_write_message_body (state, (char *) buf, size);</span>
<a href="#l10.52"></a><span id="l10.52"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1768,17 +1768,17 @@ nsresult nsMsgDatabase::AdjustExpungedBy</span>
<a href="#l11.4"></a><span id="l11.4"> NS_IMETHODIMP nsMsgDatabase::DeleteHeader(nsIMsgDBHdr *msg, nsIDBChangeListener *instigator, PRBool commit, PRBool notify)</span>
<a href="#l11.5"></a><span id="l11.5"> {</span>
<a href="#l11.6"></a><span id="l11.6">   nsMsgHdr* msgHdr = static_cast&lt;nsMsgHdr*&gt;(msg);  // closed system, so this is ok</span>
<a href="#l11.7"></a><span id="l11.7">   nsMsgKey key;</span>
<a href="#l11.8"></a><span id="l11.8">   (void)msg-&gt;GetMessageKey(&amp;key);</span>
<a href="#l11.9"></a><span id="l11.9">   // only need to do this for mail - will this speed up news expiration?</span>
<a href="#l11.10"></a><span id="l11.10">   SetHdrFlag(msg, PR_TRUE, nsMsgMessageFlags::Expunged);  // tell mailbox (mail)</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  PRBool hdrWasNew = m_newSet.BinaryIndexOf(key) != m_newSet.NoIndex;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  PRBool hdrWasNew = m_newSet.BinaryIndexOf(key) != -1;</span>
<a href="#l11.14"></a><span id="l11.14">   m_newSet.RemoveElement(key);</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16">   if (m_dbFolderInfo != NULL)</span>
<a href="#l11.17"></a><span id="l11.17">   {</span>
<a href="#l11.18"></a><span id="l11.18">     PRBool isRead;</span>
<a href="#l11.19"></a><span id="l11.19">     m_dbFolderInfo-&gt;ChangeNumMessages(-1);</span>
<a href="#l11.20"></a><span id="l11.20">     IsRead(key, &amp;isRead);</span>
<a href="#l11.21"></a><span id="l11.21">     if (!isRead)</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -1882,19 +1882,17 @@ nsresult nsMsgDatabase::IsRead(nsMsgKey </span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24"> PRUint32  nsMsgDatabase::GetStatusFlags(nsIMsgDBHdr *msgHdr, PRUint32 origFlags)</span>
<a href="#l11.25"></a><span id="l11.25"> {</span>
<a href="#l11.26"></a><span id="l11.26">   PRUint32  statusFlags = origFlags;</span>
<a href="#l11.27"></a><span id="l11.27">   PRBool  isRead = PR_TRUE;</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">   nsMsgKey key;</span>
<a href="#l11.30"></a><span id="l11.30">   (void)msgHdr-&gt;GetMessageKey(&amp;key);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  if (!m_newSet.IsEmpty() &amp;&amp;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-      m_newSet[m_newSet.Length() - 1] == key ||</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-      m_newSet.BinaryIndexOf(key) != m_newSet.NoIndex)</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  if (!m_newSet.IsEmpty() &amp;&amp; m_newSet[m_newSet.Length() - 1] == key || m_newSet.BinaryIndexOf(key) != -1)</span>
<a href="#l11.35"></a><span id="l11.35">     statusFlags |= nsMsgMessageFlags::New;</span>
<a href="#l11.36"></a><span id="l11.36">   if (IsHeaderRead(msgHdr, &amp;isRead) == NS_OK &amp;&amp; isRead)</span>
<a href="#l11.37"></a><span id="l11.37">     statusFlags |= nsMsgMessageFlags::Read;</span>
<a href="#l11.38"></a><span id="l11.38">   return statusFlags;</span>
<a href="#l11.39"></a><span id="l11.39"> }</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41"> nsresult nsMsgDatabase::IsHeaderRead(nsIMsgDBHdr *msgHdr, PRBool *pRead)</span>
<a href="#l11.42"></a><span id="l11.42"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgThread.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgThread.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -449,35 +449,35 @@ nsresult nsMsgThread::ReparentNonReferen</span>
<a href="#l12.4"></a><span id="l12.4">         if (announcer)</span>
<a href="#l12.5"></a><span id="l12.5">           announcer-&gt;NotifyParentChangedAll(curHdrKey, oldThreadParent, newParentKey, nsnull);</span>
<a href="#l12.6"></a><span id="l12.6">       }</span>
<a href="#l12.7"></a><span id="l12.7">     }</span>
<a href="#l12.8"></a><span id="l12.8">   }</span>
<a href="#l12.9"></a><span id="l12.9">   return NS_OK;</span>
<a href="#l12.10"></a><span id="l12.10"> }</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-NS_IMETHODIMP nsMsgThread::GetChildKeyAt(PRUint32 aIndex, nsMsgKey *aResult)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+NS_IMETHODIMP nsMsgThread::GetChildKeyAt(PRInt32 aIndex, nsMsgKey *aResult)</span>
<a href="#l12.14"></a><span id="l12.14"> {</span>
<a href="#l12.15"></a><span id="l12.15">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l12.16"></a><span id="l12.16">   nsresult rv;</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-  if (aIndex &gt;= m_numChildren)</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+  if (aIndex &gt;= (PRInt32) m_numChildren)</span>
<a href="#l12.20"></a><span id="l12.20">   {</span>
<a href="#l12.21"></a><span id="l12.21">     *aResult = nsMsgKey_None;</span>
<a href="#l12.22"></a><span id="l12.22">     return NS_ERROR_ILLEGAL_VALUE;</span>
<a href="#l12.23"></a><span id="l12.23">   }</span>
<a href="#l12.24"></a><span id="l12.24">   mdbOid oid;</span>
<a href="#l12.25"></a><span id="l12.25">   rv = m_mdbTable-&gt;PosToOid( m_mdbDB-&gt;GetEnv(), aIndex, &amp;oid);</span>
<a href="#l12.26"></a><span id="l12.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   *aResult = oid.mOid_Id;</span>
<a href="#l12.29"></a><span id="l12.29">   return NS_OK;</span>
<a href="#l12.30"></a><span id="l12.30"> }</span>
<a href="#l12.31"></a><span id="l12.31"> </span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-NS_IMETHODIMP nsMsgThread::GetChildAt(PRUint32 aIndex, nsIMsgDBHdr **result)</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+NS_IMETHODIMP nsMsgThread::GetChildAt(PRInt32 aIndex, nsIMsgDBHdr **result)</span>
<a href="#l12.34"></a><span id="l12.34"> {</span>
<a href="#l12.35"></a><span id="l12.35">   nsresult rv;</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37">   mdbOid oid;</span>
<a href="#l12.38"></a><span id="l12.38">   rv = m_mdbTable-&gt;PosToOid( m_mdbDB-&gt;GetEnv(), aIndex, &amp;oid);</span>
<a href="#l12.39"></a><span id="l12.39">   NS_ENSURE_SUCCESS(rv, NS_MSG_MESSAGE_NOT_FOUND);</span>
<a href="#l12.40"></a><span id="l12.40">   nsIMdbRow *hdrRow = nsnull;</span>
<a href="#l12.41"></a><span id="l12.41">   //do I have to release hdrRow?</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineat">@@ -509,29 +509,29 @@ NS_IMETHODIMP nsMsgThread::GetChild(nsMs</span>
<a href="#l12.43"></a><span id="l12.43">     NS_ENSURE_TRUE(NS_SUCCEEDED(rv) &amp;&amp; hdrRow, NS_ERROR_FAILURE);</span>
<a href="#l12.44"></a><span id="l12.44">     rv = m_mdbDB-&gt;CreateMsgHdr(hdrRow,  msgKey, result);</span>
<a href="#l12.45"></a><span id="l12.45">   }</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47">   return rv;</span>
<a href="#l12.48"></a><span id="l12.48"> }</span>
<a href="#l12.49"></a><span id="l12.49"> </span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-NS_IMETHODIMP nsMsgThread::GetChildHdrAt(PRUint32 aIndex, nsIMsgDBHdr **result)</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+NS_IMETHODIMP nsMsgThread::GetChildHdrAt(PRInt32 aIndex, nsIMsgDBHdr **result)</span>
<a href="#l12.53"></a><span id="l12.53"> {</span>
<a href="#l12.54"></a><span id="l12.54">   nsresult rv;</span>
<a href="#l12.55"></a><span id="l12.55"> </span>
<a href="#l12.56"></a><span id="l12.56">   nsIMdbRow* resultRow;</span>
<a href="#l12.57"></a><span id="l12.57">   mdb_pos pos = aIndex - 1;</span>
<a href="#l12.58"></a><span id="l12.58"> </span>
<a href="#l12.59"></a><span id="l12.59">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l12.60"></a><span id="l12.60"> </span>
<a href="#l12.61"></a><span id="l12.61">   *result = nsnull;</span>
<a href="#l12.62"></a><span id="l12.62">   // mork doesn't seem to handle this correctly, so deal with going off</span>
<a href="#l12.63"></a><span id="l12.63">   // the end here.</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-  if (aIndex &gt; m_numChildren)</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+  if (aIndex &gt; (PRInt32) m_numChildren)</span>
<a href="#l12.66"></a><span id="l12.66">     return NS_OK;</span>
<a href="#l12.67"></a><span id="l12.67"> </span>
<a href="#l12.68"></a><span id="l12.68">   nsIMdbTableRowCursor *rowCursor;</span>
<a href="#l12.69"></a><span id="l12.69">   rv = m_mdbTable-&gt;GetTableRowCursor(m_mdbDB-&gt;GetEnv(), pos, &amp;rowCursor);</span>
<a href="#l12.70"></a><span id="l12.70">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.71"></a><span id="l12.71"> </span>
<a href="#l12.72"></a><span id="l12.72">   rv = rowCursor-&gt;NextRow(m_mdbDB-&gt;GetEnv(), &amp;resultRow, &amp;pos);</span>
<a href="#l12.73"></a><span id="l12.73">   NS_RELEASE(rowCursor);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -2668,17 +2668,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateIm</span>
<a href="#l13.4"></a><span id="l13.4">       dbFolderInfo-&gt;GetImapUidValidity(&amp;imapUIDValidity);</span>
<a href="#l13.5"></a><span id="l13.5">       PRUint64 mailboxHighestModSeq;</span>
<a href="#l13.6"></a><span id="l13.6">       aSpec-&gt;GetHighestModSeq(&amp;mailboxHighestModSeq);</span>
<a href="#l13.7"></a><span id="l13.7">       char intStrBuf[40];</span>
<a href="#l13.8"></a><span id="l13.8">       PR_snprintf(intStrBuf, sizeof(intStrBuf), &quot;%llu&quot;,  mailboxHighestModSeq);</span>
<a href="#l13.9"></a><span id="l13.9">       dbFolderInfo-&gt;SetCharProperty(kModSeqPropertyName, nsDependentCString(intStrBuf));</span>
<a href="#l13.10"></a><span id="l13.10">     }</span>
<a href="#l13.11"></a><span id="l13.11">     mDatabase-&gt;ListAllKeys(existingKeys);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    PRUint32 keyCount = existingKeys.Length();</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    PRInt32 keyCount = existingKeys.Length();</span>
<a href="#l13.14"></a><span id="l13.14">     mDatabase-&gt;ListAllOfflineDeletes(&amp;existingKeys);</span>
<a href="#l13.15"></a><span id="l13.15">     if (keyCount &lt; existingKeys.Length())</span>
<a href="#l13.16"></a><span id="l13.16">       existingKeys.Sort();</span>
<a href="#l13.17"></a><span id="l13.17">   }</span>
<a href="#l13.18"></a><span id="l13.18">   PRInt32 folderValidity;</span>
<a href="#l13.19"></a><span id="l13.19">   aSpec-&gt;GetFolder_UIDVALIDITY(&amp;folderValidity);</span>
<a href="#l13.20"></a><span id="l13.20">   nsCOMPtr &lt;nsIImapFlagAndUidState&gt; flagState;</span>
<a href="#l13.21"></a><span id="l13.21">   aSpec-&gt;GetFlagState(getter_AddRefs(flagState));</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -2728,16 +2728,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateIm</span>
<a href="#l13.23"></a><span id="l13.23"> </span>
<a href="#l13.24"></a><span id="l13.24">     nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l13.25"></a><span id="l13.25">     GetSummaryFileLocation(pathFile, getter_AddRefs(summaryFile));</span>
<a href="#l13.26"></a><span id="l13.26">     // Remove summary file.</span>
<a href="#l13.27"></a><span id="l13.27">     summaryFile-&gt;Remove(PR_FALSE);</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">     // Create a new summary file, update the folder message counts, and</span>
<a href="#l13.30"></a><span id="l13.30">     // Close the summary file db.</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+    PRBool created;</span>
<a href="#l13.32"></a><span id="l13.32">     rv = msgDBService-&gt;CreateNewDB(this, getter_AddRefs(mDatabase));</span>
<a href="#l13.33"></a><span id="l13.33"> </span>
<a href="#l13.34"></a><span id="l13.34">     if (NS_FAILED(rv) &amp;&amp; mDatabase)</span>
<a href="#l13.35"></a><span id="l13.35">     {</span>
<a href="#l13.36"></a><span id="l13.36">       mDatabase-&gt;ForceClosed();</span>
<a href="#l13.37"></a><span id="l13.37">       mDatabase = nsnull;</span>
<a href="#l13.38"></a><span id="l13.38">     }</span>
<a href="#l13.39"></a><span id="l13.39">     else if (NS_SUCCEEDED(rv) &amp;&amp; mDatabase)</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineat">@@ -4097,17 +4098,17 @@ void nsImapMailFolder::FindKeysToDelete(</span>
<a href="#l13.41"></a><span id="l13.41"> </span>
<a href="#l13.42"></a><span id="l13.42">   // if we're doing a partialUIDFetch, just delete the keys from the db</span>
<a href="#l13.43"></a><span id="l13.43">   // that have the deleted flag set (if not using imap delete model)</span>
<a href="#l13.44"></a><span id="l13.44">   // and return.</span>
<a href="#l13.45"></a><span id="l13.45">   if (partialUIDFetch)</span>
<a href="#l13.46"></a><span id="l13.46">   {</span>
<a href="#l13.47"></a><span id="l13.47">     if (!showDeletedMessages)</span>
<a href="#l13.48"></a><span id="l13.48">     {</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-      for (PRInt32 i = 0; i &lt; numMessageInFlagState; i++)</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+      for (PRUint32 i = 0; i &lt; numMessageInFlagState; i++)</span>
<a href="#l13.51"></a><span id="l13.51">       {</span>
<a href="#l13.52"></a><span id="l13.52">         flagState-&gt;GetUidOfMessage(i, &amp;uidOfMessage);</span>
<a href="#l13.53"></a><span id="l13.53">         // flag state will be zero filled up to first real uid, so ignore those.</span>
<a href="#l13.54"></a><span id="l13.54">         if (uidOfMessage)</span>
<a href="#l13.55"></a><span id="l13.55">         {</span>
<a href="#l13.56"></a><span id="l13.56">           flagState-&gt;GetMessageFlags(i, &amp;flags);</span>
<a href="#l13.57"></a><span id="l13.57">           if (flags &amp; kImapMsgDeletedFlag)</span>
<a href="#l13.58"></a><span id="l13.58">             keysToDelete.AppendElement(uidOfMessage);</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineat">@@ -7384,17 +7385,17 @@ nsImapFolderCopyState::StartNextCopy()</span>
<a href="#l13.60"></a><span id="l13.60">   return imapService-&gt;EnsureFolderExists(NS_GetCurrentThread(),</span>
<a href="#l13.61"></a><span id="l13.61">                                        m_curDestParent,</span>
<a href="#l13.62"></a><span id="l13.62">                                        folderName,</span>
<a href="#l13.63"></a><span id="l13.63">                                        this, nsnull);</span>
<a href="#l13.64"></a><span id="l13.64"> }</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66"> nsresult nsImapFolderCopyState::AdvanceToNextFolder(nsresult aStatus)</span>
<a href="#l13.67"></a><span id="l13.67"> {</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+  nsresult rv;</span>
<a href="#l13.70"></a><span id="l13.70">   m_childIndex++;</span>
<a href="#l13.71"></a><span id="l13.71">   PRUint32 childCount = 0;</span>
<a href="#l13.72"></a><span id="l13.72">   if (m_srcChildFolders)</span>
<a href="#l13.73"></a><span id="l13.73">     m_srcChildFolders-&gt;Count(&amp;childCount);</span>
<a href="#l13.74"></a><span id="l13.74">   if (m_childIndex &gt;= childCount)</span>
<a href="#l13.75"></a><span id="l13.75">   {</span>
<a href="#l13.76"></a><span id="l13.76">     if (m_newDestFolder)</span>
<a href="#l13.77"></a><span id="l13.77">       m_newDestFolder-&gt;OnCopyCompleted(m_origSrcFolder, aStatus);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -2428,17 +2428,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Copy</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">   rv = aIStream-&gt;Read(mCopyState-&gt;m_dataBuffer + mCopyState-&gt;m_leftOver + 1, aLength, &amp;readCount);</span>
<a href="#l14.6"></a><span id="l14.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.7"></a><span id="l14.7">   mCopyState-&gt;m_leftOver += readCount;</span>
<a href="#l14.8"></a><span id="l14.8">   mCopyState-&gt;m_dataBuffer[mCopyState-&gt;m_leftOver + 1] ='\0';</span>
<a href="#l14.9"></a><span id="l14.9">   char *start = mCopyState-&gt;m_dataBuffer + 1;</span>
<a href="#l14.10"></a><span id="l14.10">   char *endBuffer = mCopyState-&gt;m_dataBuffer + mCopyState-&gt;m_leftOver + 1;</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  PRUint32 lineLength;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  PRInt32 lineLength;</span>
<a href="#l14.14"></a><span id="l14.14">   PRUint32 bytesWritten;</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">   while (1)</span>
<a href="#l14.17"></a><span id="l14.17">   {</span>
<a href="#l14.18"></a><span id="l14.18">     char *end = PL_strnpbrk(start, &quot;\r\n&quot;, endBuffer - start);</span>
<a href="#l14.19"></a><span id="l14.19">     if (!end)</span>
<a href="#l14.20"></a><span id="l14.20">     {</span>
<a href="#l14.21"></a><span id="l14.21">       mCopyState-&gt;m_leftOver -= (start - mCopyState-&gt;m_dataBuffer - 1);</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -4040,17 +4040,17 @@ nsresult nsMsgLocalMailFolder::ChangeKey</span>
<a href="#l14.23"></a><span id="l14.23">             if (StringBeginsWith(keywordHeaders, NS_LITERAL_CSTRING(HEADER_X_MOZILLA_KEYWORDS)))</span>
<a href="#l14.24"></a><span id="l14.24">               inKeywordHeader = PR_TRUE;</span>
<a href="#l14.25"></a><span id="l14.25">             else if (inKeywordHeader &amp;&amp; (keywordHeaders.CharAt(0) == ' ' || keywordHeaders.CharAt(0) == '\t'))</span>
<a href="#l14.26"></a><span id="l14.26">               ; // continuation header line</span>
<a href="#l14.27"></a><span id="l14.27">             else if (inKeywordHeader)</span>
<a href="#l14.28"></a><span id="l14.28">               break;</span>
<a href="#l14.29"></a><span id="l14.29">             else</span>
<a href="#l14.30"></a><span id="l14.30">               continue;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-            PRUint32 keywordHdrLength = keywordHeaders.Length();</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+            PRInt32 keywordHdrLength = keywordHeaders.Length();</span>
<a href="#l14.33"></a><span id="l14.33">             PRInt32 startOffset, keywordLength;</span>
<a href="#l14.34"></a><span id="l14.34">             // check if we have the keyword</span>
<a href="#l14.35"></a><span id="l14.35">             if (MsgFindKeyword(keywordArray[j], keywordHeaders, &amp;startOffset, &amp;keywordLength))</span>
<a href="#l14.36"></a><span id="l14.36">             {</span>
<a href="#l14.37"></a><span id="l14.37">               foundKeyword = PR_TRUE;</span>
<a href="#l14.38"></a><span id="l14.38">               if (!add) // if we're removing, remove it, and break;</span>
<a href="#l14.39"></a><span id="l14.39">               {</span>
<a href="#l14.40"></a><span id="l14.40">                 keywordHeaders.Cut(startOffset, keywordLength);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.h</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -59,18 +59,18 @@ extern &quot;C&quot; MimeMultipartRelatedClass mim</span>
<a href="#l15.4"></a><span id="l15.4"> struct MimeMultipartRelated {</span>
<a href="#l15.5"></a><span id="l15.5">   MimeMultipart multipart;  /* superclass variables */</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">   char* base_url;        /* Base URL (if any) for the whole</span>
<a href="#l15.8"></a><span id="l15.8">                    multipart/related. */</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   char* head_buffer;      /* Buffer used to remember the text/html 'head'</span>
<a href="#l15.11"></a><span id="l15.11">                    part. */</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  PRUint32 head_buffer_fp;    /* Active length. */</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  PRUint32 head_buffer_size;    /* How big it is. */</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  PRInt32 head_buffer_fp;    /* Active length. */</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  PRInt32 head_buffer_size;    /* How big it is. */</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17">   nsCOMPtr &lt;nsILocalFile&gt;          file_buffer;    /* The nsILocalFile of a temp file used when we</span>
<a href="#l15.18"></a><span id="l15.18">                                                run out of room in the head_buffer. */</span>
<a href="#l15.19"></a><span id="l15.19">   nsCOMPtr &lt;nsIInputStream&gt;   input_file_stream;    /* A stream to it. */</span>
<a href="#l15.20"></a><span id="l15.20">   nsCOMPtr &lt;nsIOutputStream&gt;  output_file_stream;  /* A stream to it. */</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">   MimeHeaders* buffered_hdrs;  /* The headers of the 'head' part. */</span>
<a href="#l15.23"></a><span id="l15.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1108,17 +1108,17 @@ nsNNTPNewsgroupList::AddHeader(const cha</span>
<a href="#l16.4"></a><span id="l16.4">   else if (PL_strcmp(header, &quot;bytes&quot;) == 0)</span>
<a href="#l16.5"></a><span id="l16.5">   {</span>
<a href="#l16.6"></a><span id="l16.6">     rv = m_newMsgHdr-&gt;SetMessageSize(atol(value));</span>
<a href="#l16.7"></a><span id="l16.7">   }</span>
<a href="#l16.8"></a><span id="l16.8">   else if (PL_strcmp(header, &quot;lines&quot;) == 0)</span>
<a href="#l16.9"></a><span id="l16.9">   {</span>
<a href="#l16.10"></a><span id="l16.10">     rv = m_newMsgHdr-&gt;SetLineCount(atol(value));</span>
<a href="#l16.11"></a><span id="l16.11">   }</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  else if (m_filterHeaders.IndexOf(nsDependentCString(header)) != m_filterHeaders.NoIndex)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  else if (m_filterHeaders.IndexOf(nsDependentCString(header)) != -1)</span>
<a href="#l16.14"></a><span id="l16.14">   {</span>
<a href="#l16.15"></a><span id="l16.15">     rv = m_newMsgHdr-&gt;SetStringProperty(header, value);</span>
<a href="#l16.16"></a><span id="l16.16">   }</span>
<a href="#l16.17"></a><span id="l16.17">   return rv;</span>
<a href="#l16.18"></a><span id="l16.18"> }</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> nsresult</span>
<a href="#l16.21"></a><span id="l16.21"> nsNNTPNewsgroupList::CallFilters()</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

