<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29875:d31e5b627413057dd99c2ccd901a3a8b6261272d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d31e5b627413057dd99c2ccd901a3a8b6261272d" />
<meta property="og:url" content="/comm-central/rev/d31e5b627413057dd99c2ccd901a3a8b6261272d" />
<meta property="og:description" content="Bug 1645307 - Port bug 1603712 to Thunderbird (remove intl.charset.detector.ng.enabled). r=pmorris CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d31e5b627413057dd99c2ccd901a3a8b6261272d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d31e5b627413057dd99c2ccd901a3a8b6261272d">shortlog</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d31e5b627413057dd99c2ccd901a3a8b6261272d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d">files</a> |
changeset |
<a href="/comm-central/raw-rev/d31e5b627413057dd99c2ccd901a3a8b6261272d">raw</a>  | <a href="/comm-central/archive/d31e5b627413057dd99c2ccd901a3a8b6261272d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1645307">Bug 1645307</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1603712">bug 1603712</a> to Thunderbird (remove intl.charset.detector.ng.enabled). r=pmorris CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 16 Jun 2020 14:58:03 +0300</td></tr>

<tr>
 <td>changeset 29875</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d31e5b627413057dd99c2ccd901a3a8b6261272d">d31e5b627413057dd99c2ccd901a3a8b6261272d</a></td>
</tr>



<tr>
<td>parent 29874</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/98363486b335b1100a546f53bc7f852107f03d7e">98363486b335b1100a546f53bc7f852107f03d7e</a>
</td>
</tr>

<tr>
<td>child 29876</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8a91a2d9db06032490bfa76dab4272540dea1881">8a91a2d9db06032490bfa76dab4272540dea1881</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d31e5b627413057dd99c2ccd901a3a8b6261272d">17575</a></td></tr>
<tr><td>push user</td><td>paul@paulwmorris.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 16 Jun 2020 19:55:35 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d31e5b627413 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d31e5b627413057dd99c2ccd901a3a8b6261272d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d31e5b627413057dd99c2ccd901a3a8b6261272d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d31e5b627413057dd99c2ccd901a3a8b6261272d&newProject=comm-central&newRevision=d31e5b627413057dd99c2ccd901a3a8b6261272d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d31e5b627413057dd99c2ccd901a3a8b6261272d&newProject=comm-central&newRevision=d31e5b627413057dd99c2ccd901a3a8b6261272d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d31e5b627413057dd99c2ccd901a3a8b6261272d&newProject=comm-central&newRevision=d31e5b627413057dd99c2ccd901a3a8b6261272d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmorris%29&revcount=50">pmorris</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1645307">1645307</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1603712">1603712</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1645307">Bug 1645307</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1603712">bug 1603712</a> to Thunderbird (remove intl.charset.detector.ng.enabled). r=pmorris CLOSED TREE

Port of https://hg.mozilla.org/mozilla-central/rev/e53396cf1039</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/hiddenWindowMac.xhtml">mail/base/content/hiddenWindowMac.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/hiddenWindowMac.xhtml">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/hiddenWindowMac.xhtml">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/hiddenWindowMac.xhtml">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/hiddenWindowMac.xhtml">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/hiddenWindowMac.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messageWindow.xhtml">mail/base/content/messageWindow.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messageWindow.xhtml">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messageWindow.xhtml">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messageWindow.xhtml">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messageWindow.xhtml">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messageWindow.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messenger.xhtml">mail/base/content/messenger.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messenger.xhtml">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messenger.xhtml">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messenger.xhtml">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messenger.xhtml">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/content/messenger.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/modules/MailMigrator.jsm">mail/base/modules/MailMigrator.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/modules/MailMigrator.jsm">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/modules/MailMigrator.jsm">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/modules/MailMigrator.jsm">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/modules/MailMigrator.jsm">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/base/modules/MailMigrator.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/compose/content/messengercompose.xhtml">mail/components/compose/content/messengercompose.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/compose/content/messengercompose.xhtml">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/compose/content/messengercompose.xhtml">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/compose/content/messengercompose.xhtml">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/compose/content/messengercompose.xhtml">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/compose/content/messengercompose.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/CustomizableWidgets.jsm">mail/components/customizableui/CustomizableWidgets.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/CustomizableWidgets.jsm">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/CustomizableWidgets.jsm">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/CustomizableWidgets.jsm">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/CustomizableWidgets.jsm">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/CustomizableWidgets.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.inc.xhtml">mail/components/customizableui/content/panelUI.inc.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.inc.xhtml">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.inc.xhtml">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.inc.xhtml">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.inc.xhtml">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.inc.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.js">mail/components/customizableui/content/panelUI.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.js">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.js">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.js">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.js">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mail/components/customizableui/content/panelUI.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.h">mailnews/base/util/nsMsgI18N.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.h">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.h">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.h">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.h">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/base/util/nsMsgI18N.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/becky/src/nsBeckyUtils.cpp">mailnews/import/becky/src/nsBeckyUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/becky/src/nsBeckyUtils.cpp">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/becky/src/nsBeckyUtils.cpp">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/becky/src/nsBeckyUtils.cpp">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/becky/src/nsBeckyUtils.cpp">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/becky/src/nsBeckyUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/outlook/src/MapiMessage.cpp">mailnews/import/outlook/src/MapiMessage.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/outlook/src/MapiMessage.cpp">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/outlook/src/MapiMessage.cpp">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/outlook/src/MapiMessage.cpp">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/outlook/src/MapiMessage.cpp">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/outlook/src/MapiMessage.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/test/unit/test_shiftjis_csv.js">mailnews/import/test/unit/test_shiftjis_csv.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/test/unit/test_shiftjis_csv.js">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/test/unit/test_shiftjis_csv.js">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/test/unit/test_shiftjis_csv.js">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/test/unit/test_shiftjis_csv.js">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/test/unit/test_shiftjis_csv.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/text/src/nsTextAddress.cpp">mailnews/import/text/src/nsTextAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/text/src/nsTextAddress.cpp">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/text/src/nsTextAddress.cpp">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/text/src/nsTextAddress.cpp">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/text/src/nsTextAddress.cpp">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/import/text/src/nsTextAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/mime/src/mimetext.cpp">mailnews/mime/src/mimetext.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/mime/src/mimetext.cpp">file</a> |
<a href="/comm-central/annotate/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/mime/src/mimetext.cpp">annotate</a> |
<a href="/comm-central/diff/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/mime/src/mimetext.cpp">diff</a> |
<a href="/comm-central/comparison/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/mime/src/mimetext.cpp">comparison</a> |
<a href="/comm-central/log/d31e5b627413057dd99c2ccd901a3a8b6261272d/mailnews/mime/src/mimetext.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/hiddenWindowMac.xhtml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/hiddenWindowMac.xhtml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -39,17 +39,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #ifdef XP_MACOSX</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;script src=&quot;chrome://global/content/macWindowMenu.js&quot;/&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> #endif</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;stringbundle id=&quot;bundle_search&quot; src=&quot;chrome://messenger/locale/search.properties&quot;/&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> &lt;stringbundle id=&quot;bundle_offlinePrompts&quot; src=&quot;chrome://messenger/locale/offline.properties&quot;/&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-&lt;stringbundle id=&quot;charsetBundle&quot; src=&quot;chrome://communicator/content/labelsencodings.properties&quot;/&gt;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> &lt;!-- keys are appended from the overlay --&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;keyset id=&quot;mailKeys&quot;&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> #include mainKeySet.inc.xhtml</span>
<a href="#l1.17"></a><span id="l1.17">   &lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l1.18"></a><span id="l1.18">     &lt;key id=&quot;key_newMessage&quot; key=&quot;&amp;newMessageCmd.key;&quot; command=&quot;cmd_newMessage&quot;</span>
<a href="#l1.19"></a><span id="l1.19">          modifiers=&quot;accel,shift&quot;/&gt;</span>
<a href="#l1.20"></a><span id="l1.20">     &lt;key id=&quot;key_newMessage2&quot; key=&quot;&amp;newMessageCmd2.key;&quot; command=&quot;cmd_newMessage&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -949,11 +949,10 @@ nsFlavorDataProvider.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">         );</span>
<a href="#l2.5"></a><span id="l2.5">         aData.value = destFilePath.QueryInterface(Ci.nsISupports);</span>
<a href="#l2.6"></a><span id="l2.6">       }</span>
<a href="#l2.7"></a><span id="l2.7">     }</span>
<a href="#l2.8"></a><span id="l2.8">   },</span>
<a href="#l2.9"></a><span id="l2.9"> };</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> function UpdateCharsetMenu(aCharset, aNode) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  var bundle = document.getElementById(&quot;charsetBundle&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  CharsetMenu.update(aNode, bundle.getString(aCharset.toLowerCase()));</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  CharsetMenu.update(aNode, aCharset);</span>
<a href="#l2.15"></a><span id="l2.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/messageWindow.xhtml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/messageWindow.xhtml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -77,17 +77,16 @@</span>
<a href="#l3.4"></a><span id="l3.4">         macanimationtype=&quot;document&quot;</span>
<a href="#l3.5"></a><span id="l3.5">         lightweightthemes=&quot;true&quot;</span>
<a href="#l3.6"></a><span id="l3.6">         fullscreenbutton=&quot;true&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l3.10"></a><span id="l3.10">   &lt;stringbundle id=&quot;bundle_offlinePrompts&quot; src=&quot;chrome://messenger/locale/offline.properties&quot;/&gt;</span>
<a href="#l3.11"></a><span id="l3.11">   &lt;stringbundle id=&quot;bundle_editContact&quot; src=&quot;chrome://messenger/locale/editContactOverlay.properties&quot;/&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  &lt;stringbundle id=&quot;charsetBundle&quot; src=&quot;chrome://communicator/content/labelsencodings.properties&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13">   &lt;stringbundle id=&quot;bundle_read_smime&quot; src=&quot;chrome://messenger-smime/locale/msgReadSMIMEOverlay.properties&quot;/&gt;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   &lt;linkset&gt;</span>
<a href="#l3.16"></a><span id="l3.16">     &lt;html:link rel=&quot;localization&quot; href=&quot;toolkit/main-window/findbar.ftl&quot;/&gt;</span>
<a href="#l3.17"></a><span id="l3.17">     &lt;html:link rel=&quot;localization&quot; href=&quot;toolkit/global/textActions.ftl&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">     &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/menubar.ftl&quot;/&gt;</span>
<a href="#l3.19"></a><span id="l3.19">     &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/openpgp/bond.ftl&quot;/&gt;</span>
<a href="#l3.20"></a><span id="l3.20">   &lt;/linkset&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/messenger.xhtml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/messenger.xhtml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -78,17 +78,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;stringbundle id=&quot;bundle_search&quot; src=&quot;chrome://messenger/locale/search.properties&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;stringbundle id=&quot;chatBundle&quot; src=&quot;chrome://messenger/locale/chat.properties&quot;/&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> &lt;stringbundle id=&quot;bundle_dateformat&quot; src=&quot;chrome://chat/locale/dateFormat.properties&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> &lt;stringbundle id=&quot;bundle_places&quot; src=&quot;chrome://places/locale/places.properties&quot;/&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> &lt;stringbundle id=&quot;bundle_editContact&quot; src=&quot;chrome://messenger/locale/editContactOverlay.properties&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> &lt;stringbundle id=&quot;bundle_offlinePrompts&quot; src=&quot;chrome://messenger/locale/offline.properties&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-&lt;stringbundle id=&quot;charsetBundle&quot; src=&quot;chrome://communicator/content/labelsencodings.properties&quot;/&gt;</span>
<a href="#l4.13"></a><span id="l4.13"> &lt;stringbundle id=&quot;bundle_read_smime&quot; src=&quot;chrome://messenger-smime/locale/msgReadSMIMEOverlay.properties&quot;/&gt;</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> &lt;linkset&gt;</span>
<a href="#l4.16"></a><span id="l4.16">   &lt;html:link rel=&quot;localization&quot; href=&quot;branding/brand.ftl&quot;/&gt;</span>
<a href="#l4.17"></a><span id="l4.17">   &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/messenger.ftl&quot;/&gt;</span>
<a href="#l4.18"></a><span id="l4.18">   &lt;html:link rel=&quot;localization&quot; href=&quot;toolkit/main-window/findbar.ftl&quot;/&gt;</span>
<a href="#l4.19"></a><span id="l4.19">   &lt;html:link rel=&quot;localization&quot; href=&quot;toolkit/global/textActions.ftl&quot;/&gt;</span>
<a href="#l4.20"></a><span id="l4.20">   &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/menubar.ftl&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -127,17 +127,16 @@ messenger.jar:</span>
<a href="#l5.4"></a><span id="l5.4"> # L10n resources and overrides.</span>
<a href="#l5.5"></a><span id="l5.5"> % override chrome://mozapps/locale/downloads/settingsChange.dtd chrome://messenger/locale/downloads/settingsChange.dtd</span>
<a href="#l5.6"></a><span id="l5.6"> % override chrome://mozapps/locale/profile/profileDowngrade.dtd chrome://messenger/locale/profileDowngrade.dtd</span>
<a href="#l5.7"></a><span id="l5.7"> % override chrome://global/locale/netError.dtd chrome://messenger/locale/netError.dtd</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> comm.jar:</span>
<a href="#l5.10"></a><span id="l5.10"> % content communicator %content/communicator/</span>
<a href="#l5.11"></a><span id="l5.11">    content/communicator/contentAreaClick.js         (content/contentAreaClick.js)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-   content/communicator/labelsencodings.properties  (/@mozreltopsrcdir@/dom/encoding/labelsencodings.properties)</span>
<a href="#l5.13"></a><span id="l5.13">    content/communicator/utilityOverlay.js           (content/utilityOverlay.js)</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> browser.jar:</span>
<a href="#l5.16"></a><span id="l5.16"> # Needed for built_in_addons.json</span>
<a href="#l5.17"></a><span id="l5.17"> % content browser %content/</span>
<a href="#l5.18"></a><span id="l5.18"> # These files are referenced from various toolkit files.</span>
<a href="#l5.19"></a><span id="l5.19"> % skin browser classic/1.0 %skin/</span>
<a href="#l5.20"></a><span id="l5.20">     skin/illustrations/error-malformed-url.svg         (../../../browser/themes/shared/illustrations/error-malformed-url.svg)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/modules/MailMigrator.jsm</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/modules/MailMigrator.jsm</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -194,39 +194,16 @@ var MailMigrator = {</span>
<a href="#l6.4"></a><span id="l6.4">         if (</span>
<a href="#l6.5"></a><span id="l6.5">           Services.prefs.prefHasUserValue(kOldColorPref) &amp;&amp;</span>
<a href="#l6.6"></a><span id="l6.6">           !Services.prefs.getBoolPref(kOldColorPref)</span>
<a href="#l6.7"></a><span id="l6.7">         ) {</span>
<a href="#l6.8"></a><span id="l6.8">           Services.prefs.setIntPref(&quot;browser.display.document_color_use&quot;, 2);</span>
<a href="#l6.9"></a><span id="l6.9">         }</span>
<a href="#l6.10"></a><span id="l6.10">       }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      // Limit the charset detector pref to values (now) available from the UI.</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-      if (currentUIVersion &lt; 9) {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-        let detector = null;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-        try {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-          detector = Services.prefs.getComplexValue(</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-            &quot;intl.charset.detector&quot;,</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-            Ci.nsIPrefLocalizedString</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-          ).data;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-        } catch (ex) {}</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-        if (</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-          !(</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-            detector == &quot;&quot; ||</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-            detector == &quot;ja_parallel_state_machine&quot; ||</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-            detector == &quot;ruprob&quot; ||</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-            detector == &quot;ukprob&quot;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-          )</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-        ) {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-          // If the encoding detector pref value is not reachable from the UI,</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-          // reset to default (varies by localization).</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-          Services.prefs.clearUserPref(&quot;intl.charset.detector&quot;);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-        }</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-      }</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-</span>
<a href="#l6.35"></a><span id="l6.35">       // This one is needed also in all new profiles.</span>
<a href="#l6.36"></a><span id="l6.36">       // Add an expanded entry for All Address Books.</span>
<a href="#l6.37"></a><span id="l6.37">       if (currentUIVersion &lt; 10 || newProfile) {</span>
<a href="#l6.38"></a><span id="l6.38">         const DIR_TREE_FILE = &quot;directoryTree.json&quot;;</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">         // If the file exists, read its contents, prepend the &quot;All ABs&quot; URI</span>
<a href="#l6.41"></a><span id="l6.41">         // and save it, else, just write the &quot;All ABs&quot; URI to the file.</span>
<a href="#l6.42"></a><span id="l6.42">         let data = IOUtils.loadFileToString(DIR_TREE_FILE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xhtml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xhtml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -51,17 +51,16 @@</span>
<a href="#l7.4"></a><span id="l7.4">         macanimationtype=&quot;document&quot;</span>
<a href="#l7.5"></a><span id="l7.5">         chromemargin=&quot;0,-1,-1,-1&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> #endif</span>
<a href="#l7.7"></a><span id="l7.7">         fullscreenbutton=&quot;true&quot;&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">   &lt;stringbundle id=&quot;bundle_composeMsgs&quot; src=&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;/&gt;</span>
<a href="#l7.10"></a><span id="l7.10">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l7.11"></a><span id="l7.11">   &lt;stringbundle id=&quot;brandBundle&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  &lt;stringbundle id=&quot;charsetBundle&quot; src=&quot;chrome://communicator/content/labelsencodings.properties&quot;/&gt;</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14"> &lt;linkset&gt;</span>
<a href="#l7.15"></a><span id="l7.15">   &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/messengercompose/messengercompose.ftl&quot;/&gt;</span>
<a href="#l7.16"></a><span id="l7.16">   &lt;html:link rel=&quot;localization&quot; href=&quot;toolkit/main-window/findbar.ftl&quot;/&gt;</span>
<a href="#l7.17"></a><span id="l7.17">   &lt;html:link rel=&quot;localization&quot; href=&quot;toolkit/global/textActions.ftl&quot;/&gt;</span>
<a href="#l7.18"></a><span id="l7.18">   &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/menubar.ftl&quot;/&gt;</span>
<a href="#l7.19"></a><span id="l7.19">   &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/openpgp/enigmail.ftl&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20"> &lt;/linkset&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/customizableui/CustomizableWidgets.jsm</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/customizableui/CustomizableWidgets.jsm</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -20,21 +20,16 @@ const { AppConstants } = ChromeUtils.imp</span>
<a href="#l8.4"></a><span id="l8.4"> XPCOMUtils.defineLazyModuleGetters(this, {</span>
<a href="#l8.5"></a><span id="l8.5">   RecentlyClosedTabsAndWindowsMenuUtils:</span>
<a href="#l8.6"></a><span id="l8.6">     &quot;resource:///modules/sessionstore/RecentlyClosedTabsAndWindowsMenuUtils.jsm&quot;,</span>
<a href="#l8.7"></a><span id="l8.7">   ShortcutUtils: &quot;resource://gre/modules/ShortcutUtils.jsm&quot;,</span>
<a href="#l8.8"></a><span id="l8.8">   CharsetMenu: &quot;resource://gre/modules/CharsetMenu.jsm&quot;,</span>
<a href="#l8.9"></a><span id="l8.9">   PrivateBrowsingUtils: &quot;resource://gre/modules/PrivateBrowsingUtils.jsm&quot;,</span>
<a href="#l8.10"></a><span id="l8.10"> });</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-XPCOMUtils.defineLazyGetter(this, &quot;CharsetBundle&quot;, function() {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  const kCharsetBundle = &quot;chrome://global/locale/charsetMenu.properties&quot;;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-  return Services.strings.createBundle(kCharsetBundle);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-});</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-</span>
<a href="#l8.17"></a><span id="l8.17"> const kPrefCustomizationDebug = &quot;browser.uiCustomization.debug&quot;;</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> XPCOMUtils.defineLazyGetter(this, &quot;log&quot;, () =&gt; {</span>
<a href="#l8.20"></a><span id="l8.20">   let scope = {};</span>
<a href="#l8.21"></a><span id="l8.21">   ChromeUtils.import(&quot;resource://gre/modules/Console.jsm&quot;, scope);</span>
<a href="#l8.22"></a><span id="l8.22">   let debug = Services.prefs.getBoolPref(kPrefCustomizationDebug, false);</span>
<a href="#l8.23"></a><span id="l8.23">   let consoleOptions = {</span>
<a href="#l8.24"></a><span id="l8.24">     maxLogLevel: debug ? &quot;all&quot; : &quot;log&quot;,</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineat">@@ -431,30 +426,16 @@ const CustomizableWidgets = [</span>
<a href="#l8.26"></a><span id="l8.26">       );</span>
<a href="#l8.27"></a><span id="l8.27">       let elements = [</span>
<a href="#l8.28"></a><span id="l8.28">         ...pinnedContainer.children,</span>
<a href="#l8.29"></a><span id="l8.29">         ...charsetContainer.children,</span>
<a href="#l8.30"></a><span id="l8.30">       ];</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32">       this._updateElements(elements, currentCharset);</span>
<a href="#l8.33"></a><span id="l8.33">     },</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-    updateCurrentDetector(aDocument) {</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-      let detectorContainer = aDocument.getElementById(</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-        &quot;PanelUI-characterEncodingView-autodetect&quot;</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-      );</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-      let currentDetector;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-      try {</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-        currentDetector = Services.prefs.getComplexValue(</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-          &quot;intl.charset.detector&quot;,</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-          Ci.nsIPrefLocalizedString</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-        ).data;</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-      } catch (e) {}</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-      this._updateElements(detectorContainer.children, currentDetector);</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    },</span>
<a href="#l8.48"></a><span id="l8.48">     _updateElements(aElements, aCurrentItem) {</span>
<a href="#l8.49"></a><span id="l8.49">       if (!aElements.length) {</span>
<a href="#l8.50"></a><span id="l8.50">         return;</span>
<a href="#l8.51"></a><span id="l8.51">       }</span>
<a href="#l8.52"></a><span id="l8.52">       let disabled = this.maybeDisableMenu(aElements[0].ownerDocument);</span>
<a href="#l8.53"></a><span id="l8.53">       for (let elem of aElements) {</span>
<a href="#l8.54"></a><span id="l8.54">         if (disabled) {</span>
<a href="#l8.55"></a><span id="l8.55">           elem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineat">@@ -469,64 +450,44 @@ const CustomizableWidgets = [</span>
<a href="#l8.57"></a><span id="l8.57">       }</span>
<a href="#l8.58"></a><span id="l8.58">     },</span>
<a href="#l8.59"></a><span id="l8.59">     onViewShowing(aEvent) {</span>
<a href="#l8.60"></a><span id="l8.60">       if (!this._inited) {</span>
<a href="#l8.61"></a><span id="l8.61">         this.onInit();</span>
<a href="#l8.62"></a><span id="l8.62">       }</span>
<a href="#l8.63"></a><span id="l8.63">       let document = aEvent.target.ownerDocument;</span>
<a href="#l8.64"></a><span id="l8.64"> </span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-      let autoDetectLabelId = &quot;PanelUI-characterEncodingView-autodetect-label&quot;;</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-      let autoDetectLabel = document.getElementById(autoDetectLabelId);</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-      if (!autoDetectLabel.hasAttribute(&quot;value&quot;)) {</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-        let label = CharsetBundle.GetStringFromName(&quot;charsetMenuAutodet&quot;);</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-        autoDetectLabel.setAttribute(&quot;value&quot;, label);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+      if (</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+        !document.getElementById(&quot;PanelUI-characterEncodingView-pinned&quot;)</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+          .firstChild</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+      ) {</span>
<a href="#l8.74"></a><span id="l8.74">         this.populateList(</span>
<a href="#l8.75"></a><span id="l8.75">           document,</span>
<a href="#l8.76"></a><span id="l8.76">           &quot;PanelUI-characterEncodingView-pinned&quot;,</span>
<a href="#l8.77"></a><span id="l8.77">           &quot;pinnedCharsets&quot;</span>
<a href="#l8.78"></a><span id="l8.78">         );</span>
<a href="#l8.79"></a><span id="l8.79">         this.populateList(</span>
<a href="#l8.80"></a><span id="l8.80">           document,</span>
<a href="#l8.81"></a><span id="l8.81">           &quot;PanelUI-characterEncodingView-charsets&quot;,</span>
<a href="#l8.82"></a><span id="l8.82">           &quot;otherCharsets&quot;</span>
<a href="#l8.83"></a><span id="l8.83">         );</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-        this.populateList(</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-          document,</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-          &quot;PanelUI-characterEncodingView-autodetect&quot;,</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-          &quot;detectors&quot;</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-        );</span>
<a href="#l8.89"></a><span id="l8.89">       }</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-      this.updateCurrentDetector(document);</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+</span>
<a href="#l8.92"></a><span id="l8.92">       this.updateCurrentCharset(document);</span>
<a href="#l8.93"></a><span id="l8.93">     },</span>
<a href="#l8.94"></a><span id="l8.94">     onCommand(aEvent) {</span>
<a href="#l8.95"></a><span id="l8.95">       let node = aEvent.target;</span>
<a href="#l8.96"></a><span id="l8.96">       if (!node.hasAttribute || !node.section) {</span>
<a href="#l8.97"></a><span id="l8.97">         return;</span>
<a href="#l8.98"></a><span id="l8.98">       }</span>
<a href="#l8.99"></a><span id="l8.99"> </span>
<a href="#l8.100"></a><span id="l8.100">       let window = node.ownerGlobal;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-      let section = node.section;</span>
<a href="#l8.102"></a><span id="l8.102">       let value = node.value;</span>
<a href="#l8.103"></a><span id="l8.103"> </span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-      // The behavior as implemented here is directly based off of the</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-      // `MultiplexHandler()` method in browser.js.</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-      if (section != &quot;detectors&quot;) {</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-        window.BrowserSetForcedCharacterSet(value);</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-      } else {</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-        // Set the detector pref.</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-        try {</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-          Services.prefs.setStringPref(&quot;intl.charset.detector&quot;, value);</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-        } catch (e) {</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-          Cu.reportError(&quot;Failed to set the intl.charset.detector preference.&quot;);</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-        }</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-        // Prepare a browser page reload with a changed charset.</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-        window.BrowserCharsetReload();</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-      }</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+      window.BrowserSetForcedCharacterSet(value);</span>
<a href="#l8.119"></a><span id="l8.119">     },</span>
<a href="#l8.120"></a><span id="l8.120">     onCreated(aNode) {</span>
<a href="#l8.121"></a><span id="l8.121">       let document = aNode.ownerDocument;</span>
<a href="#l8.122"></a><span id="l8.122"> </span>
<a href="#l8.123"></a><span id="l8.123">       let updateButton = () =&gt; {</span>
<a href="#l8.124"></a><span id="l8.124">         if (this.maybeDisableMenu(document)) {</span>
<a href="#l8.125"></a><span id="l8.125">           aNode.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l8.126"></a><span id="l8.126">         } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/customizableui/content/panelUI.inc.xhtml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/customizableui/content/panelUI.inc.xhtml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1137,32 +1137,23 @@</span>
<a href="#l9.4"></a><span id="l9.4">                        label=&quot;&amp;fullZoomToggleCmd.label;&quot;</span>
<a href="#l9.5"></a><span id="l9.5">                        type=&quot;checkbox&quot;</span>
<a href="#l9.6"></a><span id="l9.6">                        command=&quot;cmd_fullZoomToggle&quot;</span>
<a href="#l9.7"></a><span id="l9.7">                        checked=&quot;false&quot;/&gt;</span>
<a href="#l9.8"></a><span id="l9.8">       &lt;/vbox&gt;</span>
<a href="#l9.9"></a><span id="l9.9">     &lt;/panelview&gt;</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11">     &lt;!-- View / Text Encoding --&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    &lt;!-- Populated when shown via event listener. --&gt;</span>
<a href="#l9.13"></a><span id="l9.13">     &lt;panelview id=&quot;appMenu-viewTextEncodingView&quot;</span>
<a href="#l9.14"></a><span id="l9.14">                title=&quot;&amp;charsetMenu2.label;&quot;</span>
<a href="#l9.15"></a><span id="l9.15">                class=&quot;PanelUI-subView&quot;</span>
<a href="#l9.16"></a><span id="l9.16">                oncommand=&quot;MailSetCharacterSet(event)&quot;&gt;</span>
<a href="#l9.17"></a><span id="l9.17">       &lt;vbox class=&quot;panel-subview-body&quot;/&gt;</span>
<a href="#l9.18"></a><span id="l9.18">     &lt;/panelview&gt;</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-    &lt;!-- View / Text Encoding / Auto-Detect --&gt;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-    &lt;!-- Populated when shown via event listener. --&gt;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-    &lt;panelview id=&quot;appMenu-viewTextEncodingDetectorsView&quot;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-               class=&quot;PanelUI-subView&quot;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-               oncommand=&quot;PanelUI.setTextEncodingDetector(event)&quot;&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-      &lt;vbox class=&quot;panel-subview-body&quot;/&gt;</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-    &lt;/panelview&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-</span>
<a href="#l9.28"></a><span id="l9.28">     &lt;!-- Go --&gt;</span>
<a href="#l9.29"></a><span id="l9.29">     &lt;panelview id=&quot;appMenu-goView&quot;</span>
<a href="#l9.30"></a><span id="l9.30">                title=&quot;&amp;goMenu.label;&quot;</span>
<a href="#l9.31"></a><span id="l9.31">                class=&quot;PanelUI-subView&quot;&gt;</span>
<a href="#l9.32"></a><span id="l9.32">       &lt;vbox id=&quot;appMenu-goViewItems&quot;</span>
<a href="#l9.33"></a><span id="l9.33">             class=&quot;panel-subview-body&quot;&gt;</span>
<a href="#l9.34"></a><span id="l9.34">         &lt;toolbarbutton id=&quot;appmenu_goNextMenu&quot;</span>
<a href="#l9.35"></a><span id="l9.35">                        class=&quot;subviewbutton subviewbutton-nav&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/customizableui/content/panelUI.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/customizableui/content/panelUI.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -489,19 +489,16 @@ const PanelUI = {</span>
<a href="#l10.4"></a><span id="l10.4">         InitAppmenuViewBodyMenu();</span>
<a href="#l10.5"></a><span id="l10.5">         break;</span>
<a href="#l10.6"></a><span id="l10.6">       case &quot;appMenu-viewZoomView&quot;:</span>
<a href="#l10.7"></a><span id="l10.7">         UpdateFullZoomMenu();</span>
<a href="#l10.8"></a><span id="l10.8">         break;</span>
<a href="#l10.9"></a><span id="l10.9">       case &quot;appMenu-viewTextEncodingView&quot;:</span>
<a href="#l10.10"></a><span id="l10.10">         this._onTextEncodingViewShow(event);</span>
<a href="#l10.11"></a><span id="l10.11">         break;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-      case &quot;appMenu-viewTextEncodingDetectorsView&quot;:</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-        this._onTextEncodingDetectorsViewShow(event);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-        break;</span>
<a href="#l10.15"></a><span id="l10.15">       // Go</span>
<a href="#l10.16"></a><span id="l10.16">       case &quot;appMenu-goRecentlyClosedTabsView&quot;:</span>
<a href="#l10.17"></a><span id="l10.17">         PanelUI._refreshDynamicView(event, InitRecentlyClosedTabsPopup);</span>
<a href="#l10.18"></a><span id="l10.18">         break;</span>
<a href="#l10.19"></a><span id="l10.19">       // Message</span>
<a href="#l10.20"></a><span id="l10.20">       case &quot;appMenu-messageView&quot;:</span>
<a href="#l10.21"></a><span id="l10.21">         InitAppMessageMenu();</span>
<a href="#l10.22"></a><span id="l10.22">         break;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineat">@@ -972,48 +969,22 @@ const PanelUI = {</span>
<a href="#l10.24"></a><span id="l10.24">    * Similar to the CharsetMenu.build function.</span>
<a href="#l10.25"></a><span id="l10.25">    *</span>
<a href="#l10.26"></a><span id="l10.26">    * @param {ViewShowingEvent} event  ViewShowing event.</span>
<a href="#l10.27"></a><span id="l10.27">    */</span>
<a href="#l10.28"></a><span id="l10.28">   _onTextEncodingViewShow(event) {</span>
<a href="#l10.29"></a><span id="l10.29">     const panelView = event.target;</span>
<a href="#l10.30"></a><span id="l10.30">     const doc = panelView.ownerDocument;</span>
<a href="#l10.31"></a><span id="l10.31">     const parent = panelView.querySelector(&quot;.panel-subview-body&quot;);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-    const showDetectors = panelView.getAttribute(&quot;detectors&quot;) != &quot;false&quot;;</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">     // Clear the view before recreating it.</span>
<a href="#l10.35"></a><span id="l10.35">     while (parent.firstElementChild) {</span>
<a href="#l10.36"></a><span id="l10.36">       parent.firstElementChild.remove();</span>
<a href="#l10.37"></a><span id="l10.37">     }</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    if (showDetectors) {</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-      // Add toolbarbutton for detectors subview.</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-      const node = doc.createXULElement(&quot;toolbarbutton&quot;);</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-      node.setAttribute(&quot;class&quot;, &quot;subviewbutton subviewbutton-nav&quot;);</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-      node.setAttribute(&quot;closemenu&quot;, &quot;none&quot;);</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-      node.setAttribute(</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-        &quot;label&quot;,</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-        gBundle.GetStringFromName(&quot;charsetMenuAutodet&quot;)</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-      );</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-      node.setAttribute(</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-        &quot;accesskey&quot;,</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-        gBundle.GetStringFromName(&quot;charsetMenuAutodet.key&quot;)</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-      );</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-      node.setAttribute(</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-        &quot;oncommand&quot;,</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-        &quot;PanelUI.showSubView('appMenu-viewTextEncodingDetectorsView', this)&quot;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-      );</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-      parent.appendChild(node);</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-      parent.appendChild(doc.createXULElement(&quot;toolbarseparator&quot;));</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-    }</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-</span>
<a href="#l10.64"></a><span id="l10.64">     // Add a toolbarbutton for each character encoding.</span>
<a href="#l10.65"></a><span id="l10.65">     const pinnedInfoCache = CharsetMenu.getCharsetInfo(</span>
<a href="#l10.66"></a><span id="l10.66">       PanelUI.kPinnedEncodings,</span>
<a href="#l10.67"></a><span id="l10.67">       false</span>
<a href="#l10.68"></a><span id="l10.68">     );</span>
<a href="#l10.69"></a><span id="l10.69"> </span>
<a href="#l10.70"></a><span id="l10.70">     const charsetInfoCache = CharsetMenu.getCharsetInfo(PanelUI.kEncodings);</span>
<a href="#l10.71"></a><span id="l10.71"> </span>
<a href="#l10.72"></a><span id="l10.72" class="difflineat">@@ -1025,72 +996,16 @@ const PanelUI = {</span>
<a href="#l10.73"></a><span id="l10.73"> </span>
<a href="#l10.74"></a><span id="l10.74">     charsetInfoCache.forEach(charsetInfo =&gt;</span>
<a href="#l10.75"></a><span id="l10.75">       parent.appendChild(PanelUI._createTextEncodingNode(doc, charsetInfo))</span>
<a href="#l10.76"></a><span id="l10.76">     );</span>
<a href="#l10.77"></a><span id="l10.77"> </span>
<a href="#l10.78"></a><span id="l10.78">     UpdateCharsetMenu(msgWindow.mailCharacterSet, parent);</span>
<a href="#l10.79"></a><span id="l10.79">   },</span>
<a href="#l10.80"></a><span id="l10.80"> </span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-  /**</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-   * Event listener for showing the View/Text_Encoding/Auto-Detect view.</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-   * Similar to the CharsetMenu.build function.</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-   *</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-   * @param {ViewShowingEvent} event  ViewShowing event.</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-   */</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-  _onTextEncodingDetectorsViewShow(event) {</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-    const panelView = event.target;</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-    const parent = panelView.querySelector(&quot;.panel-subview-body&quot;);</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-    const doc = parent.ownerDocument;</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-    // Clear the view before recreating it.</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-    while (parent.firstElementChild) {</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-      parent.firstElementChild.remove();</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-    }</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-    // Populate the view with toolbarbuttons.</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-    panelView.setAttribute(</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-      &quot;title&quot;,</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-      gBundle.GetStringFromName(&quot;charsetMenuAutodet&quot;)</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-    );</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-    const detectorInfoCache = CharsetMenu.getDetectorInfo();</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-    detectorInfoCache.forEach(detectorInfo =&gt;</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-      parent.appendChild(PanelUI._createTextEncodingNode(doc, detectorInfo))</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-    );</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-    parent.appendChild(doc.createXULElement(&quot;toolbarseparator&quot;));</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-    // Make the current selection checked. (Like UpdateDetectorMenu function.)</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-    const detector = Services.prefs.getComplexValue(</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineminus">-      &quot;intl.charset.detector&quot;,</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineminus">-      Ci.nsIPrefLocalizedString</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineminus">-    );</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-    const item = parent.getElementsByAttribute(&quot;detector&quot;, detector).item(0);</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-    if (item) {</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-      item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-    }</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-  },</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineminus">-  /**</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineminus">-   * Set the text encoding detector preference. Used for the</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-   * View / Text Encoding / Auto-Detect view.</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineminus">-   *</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineminus">-   * @param {Event} event  The 'oncommand' event.</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-   */</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-  setTextEncodingDetector(event) {</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-    Services.prefs.setStringPref(</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-      &quot;intl.charset.detector&quot;,</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineminus">-      event.target.getAttribute(&quot;detector&quot;)</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-    );</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-  },</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-</span>
<a href="#l10.137"></a><span id="l10.137">   _updateQuitTooltip() {</span>
<a href="#l10.138"></a><span id="l10.138">     if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l10.139"></a><span id="l10.139">       return;</span>
<a href="#l10.140"></a><span id="l10.140">     }</span>
<a href="#l10.141"></a><span id="l10.141"> </span>
<a href="#l10.142"></a><span id="l10.142">     let tooltipId =</span>
<a href="#l10.143"></a><span id="l10.143">       AppConstants.platform == &quot;macosx&quot;</span>
<a href="#l10.144"></a><span id="l10.144">         ? &quot;quit-button.tooltiptext.mac&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.5"></a><span id="l11.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nsICharsetConverterManager.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-#include &quot;mozilla/dom/FallbackEncoding.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;mozilla/Utf8.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> </span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsISupports.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l11.16"></a><span id="l11.16"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineat">@@ -147,32 +146,16 @@ nsresult CopyMUTF7toUTF16(const nsACStri</span>
<a href="#l11.20"></a><span id="l11.20">   converter.ConvertNoBuff(aSrc.BeginReading(), &amp;inLen, aDest.BeginWriting(),</span>
<a href="#l11.21"></a><span id="l11.21">                           &amp;outLen);</span>
<a href="#l11.22"></a><span id="l11.22">   MOZ_ASSERT(inLen == (int32_t)aSrc.Length(),</span>
<a href="#l11.23"></a><span id="l11.23">              &quot;UTF-7 should not produce a longer output&quot;);</span>
<a href="#l11.24"></a><span id="l11.24">   aDest.SetLength(outLen);</span>
<a href="#l11.25"></a><span id="l11.25">   return NS_OK;</span>
<a href="#l11.26"></a><span id="l11.26"> }</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-// Charset used by the file system.</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">-const nsACString&amp; nsMsgI18NFileSystemCharset() {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-  /* Get a charset used for the file. */</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  static nsAutoCString fileSystemCharset;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-  if (fileSystemCharset.IsEmpty())</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-    mozilla::dom::FallbackEncoding::FromLocale()-&gt;Name(fileSystemCharset);</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-  return fileSystemCharset;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-}</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-// Charset used by the text file.</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">-void nsMsgI18NTextFileCharset(nsACString&amp; aCharset) {</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-  mozilla::dom::FallbackEncoding::FromLocale()-&gt;Name(aCharset);</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-}</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-</span>
<a href="#l11.44"></a><span id="l11.44"> // MIME encoder, output string should be freed by PR_FREE</span>
<a href="#l11.45"></a><span id="l11.45"> // XXX : fix callers later to avoid allocation and copy</span>
<a href="#l11.46"></a><span id="l11.46"> char* nsMsgI18NEncodeMimePartIIStr(const char* header, bool structured,</span>
<a href="#l11.47"></a><span id="l11.47">                                    const char* charset, int32_t fieldnamelen,</span>
<a href="#l11.48"></a><span id="l11.48">                                    bool usemime) {</span>
<a href="#l11.49"></a><span id="l11.49">   // No MIME, convert to the outgoing mail charset.</span>
<a href="#l11.50"></a><span id="l11.50">   if (!usemime) {</span>
<a href="#l11.51"></a><span id="l11.51">     nsAutoCString convertedStr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -47,41 +47,22 @@ NS_MSG_BASE bool nsMsgI18Nmultibyte_char</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> /**</span>
<a href="#l12.6"></a><span id="l12.6">  * Check the input (unicode) string is in a range of the given charset after the</span>
<a href="#l12.7"></a><span id="l12.7">  * conversion. Note, do not use this for large string (e.g. message body) since</span>
<a href="#l12.8"></a><span id="l12.8">  * this actually applies the conversion to the buffer.</span>
<a href="#l12.9"></a><span id="l12.9">  *</span>
<a href="#l12.10"></a><span id="l12.10">  * @param charset  [IN] Charset to be converted.</span>
<a href="#l12.11"></a><span id="l12.11">  * @param inString [IN] Input unicode string to be examined.</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">- * @param fallbackCharset [OUT] null if fallback charset is not needed.</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">- *                      Otherwise, a fallback charset name may be set if that</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">- *                      was used for the conversion.</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">- *                      Caller is responsible for freeing the memory.</span>
<a href="#l12.16"></a><span id="l12.16">  * @return         True if the string can be converted within the charset range.</span>
<a href="#l12.17"></a><span id="l12.17">  *                 False if one or more characters cannot be converted to the</span>
<a href="#l12.18"></a><span id="l12.18">  *                 target charset.</span>
<a href="#l12.19"></a><span id="l12.19">  */</span>
<a href="#l12.20"></a><span id="l12.20"> NS_MSG_BASE bool nsMsgI18Ncheck_data_in_charset_range(const char* charset,</span>
<a href="#l12.21"></a><span id="l12.21">                                                       const char16_t* inString);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-/**</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">- * Return charset name of file system (OS dependent).</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">- *</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">- * @return            File system charset name.</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">- */</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-NS_MSG_BASE const nsACString&amp; nsMsgI18NFileSystemCharset(void);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-/**</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">- * Return charset name of text file (OS dependent).</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">- *</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">- * @param aCharset    [OUT] Text file charset name.</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">- */</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-NS_MSG_BASE void nsMsgI18NTextFileCharset(nsACString&amp; aCharset);</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-</span>
<a href="#l12.37"></a><span id="l12.37"> /**</span>
<a href="#l12.38"></a><span id="l12.38">  * Convert from unicode to target charset.</span>
<a href="#l12.39"></a><span id="l12.39">  *</span>
<a href="#l12.40"></a><span id="l12.40">  * @param charset     [IN] Charset name.</span>
<a href="#l12.41"></a><span id="l12.41">  * @param inString    [IN] Unicode string to convert.</span>
<a href="#l12.42"></a><span id="l12.42">  * @param outString   [OUT] Converted output string.</span>
<a href="#l12.43"></a><span id="l12.43">  * @param aReportUencNoMapping [IN] Set encoder to report (instead of using</span>
<a href="#l12.44"></a><span id="l12.44">  *                                  replacement char on errors). Set to true</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -3863,19 +3863,20 @@ nsresult nsMsgCompose::LoadDataFromFile(</span>
<a href="#l13.4"></a><span id="l13.4">     if (aAllowUTF8 &amp;&amp; mozilla::IsUtf8(nsDependentCString(readBuf))) {</span>
<a href="#l13.5"></a><span id="l13.5">       sigEncoding.AssignLiteral(&quot;UTF-8&quot;);</span>
<a href="#l13.6"></a><span id="l13.6">     } else if (sigEncoding.IsEmpty() &amp;&amp; aAllowUTF16 &amp;&amp; readSize % 2 == 0 &amp;&amp;</span>
<a href="#l13.7"></a><span id="l13.7">                readSize &gt;= 2 &amp;&amp;</span>
<a href="#l13.8"></a><span id="l13.8">                ((readBuf[0] == char(0xFE) &amp;&amp; readBuf[1] == char(0xFF)) ||</span>
<a href="#l13.9"></a><span id="l13.9">                 (readBuf[0] == char(0xFF) &amp;&amp; readBuf[1] == char(0xFE)))) {</span>
<a href="#l13.10"></a><span id="l13.10">       sigEncoding.AssignLiteral(&quot;UTF-16&quot;);</span>
<a href="#l13.11"></a><span id="l13.11">     } else {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      // default to platform encoding for plain text files w/o meta charset</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+      // Autodetect encoding for plain text files w/o meta charset</span>
<a href="#l13.14"></a><span id="l13.14">       nsAutoCString textFileCharset;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-      nsMsgI18NTextFileCharset(textFileCharset);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+      rv = MsgDetectCharsetFromFile(file, textFileCharset);</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.18"></a><span id="l13.18">       sigEncoding.Assign(textFileCharset);</span>
<a href="#l13.19"></a><span id="l13.19">     }</span>
<a href="#l13.20"></a><span id="l13.20">   }</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22">   nsAutoCString readStr(readBuf, (int32_t)fileSize);</span>
<a href="#l13.23"></a><span id="l13.23">   PR_FREEIF(readBuf);</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">   // XXX: ^^^ could really use nsContentUtils::SlurpFileToString instead!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckyUtils.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckyUtils.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -249,26 +249,30 @@ nsresult nsBeckyUtils::ConvertToUTF8File</span>
<a href="#l14.4"></a><span id="l14.4">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.5"></a><span id="l14.5">   rv = convertedFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 0600);</span>
<a href="#l14.6"></a><span id="l14.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8">   nsCOMPtr&lt;nsIInputStream&gt; source;</span>
<a href="#l14.9"></a><span id="l14.9">   rv = NS_NewLocalFileInputStream(getter_AddRefs(source), aSourceFile);</span>
<a href="#l14.10"></a><span id="l14.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+  nsAutoCString sourceCharset;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  rv = MsgDetectCharsetFromFile(aSourceFile, sourceCharset);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+</span>
<a href="#l14.16"></a><span id="l14.16">   nsCOMPtr&lt;nsIOutputStream&gt; destination;</span>
<a href="#l14.17"></a><span id="l14.17">   rv = NS_NewLocalFileOutputStream(getter_AddRefs(destination), convertedFile);</span>
<a href="#l14.18"></a><span id="l14.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   const uint32_t kBlock = 8192;</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22">   nsCOMPtr&lt;nsIConverterInputStream&gt; convertedInput =</span>
<a href="#l14.23"></a><span id="l14.23">       do_CreateInstance(&quot;@mozilla.org/intl/converter-input-stream;1&quot;);</span>
<a href="#l14.24"></a><span id="l14.24">   convertedInput-&gt;Init(source,</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-                       PromiseFlatCString(nsMsgI18NFileSystemCharset()).get(),</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+                       sourceCharset.get(),</span>
<a href="#l14.27"></a><span id="l14.27">                        kBlock, 0x0000);</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29">   nsCOMPtr&lt;nsIConverterOutputStream&gt; convertedOutput =</span>
<a href="#l14.30"></a><span id="l14.30">       do_CreateInstance(&quot;@mozilla.org/intl/converter-output-stream;1&quot;);</span>
<a href="#l14.31"></a><span id="l14.31">   convertedOutput-&gt;Init(destination, &quot;UTF-8&quot;);</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">   char16_t *line = (char16_t *)moz_xmalloc(kBlock);</span>
<a href="#l14.34"></a><span id="l14.34">   uint32_t readBytes = kBlock;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -708,23 +708,16 @@ bool CMapiMessage::FetchBody(void) {</span>
<a href="#l15.4"></a><span id="l15.4">   // Get from Outlook (seems like it keeps the MIME part header encoding info)</span>
<a href="#l15.5"></a><span id="l15.5">   if (!bFoundCharset &amp;&amp; codepage) {</span>
<a href="#l15.6"></a><span id="l15.6">     const char* charset = CpToCharset(codepage);</span>
<a href="#l15.7"></a><span id="l15.7">     if (charset) {</span>
<a href="#l15.8"></a><span id="l15.8">       bFoundCharset = CheckBodyInCharsetRange(charset);</span>
<a href="#l15.9"></a><span id="l15.9">       if (bFoundCharset) m_mimeCharset.Assign(charset);</span>
<a href="#l15.10"></a><span id="l15.10">     }</span>
<a href="#l15.11"></a><span id="l15.11">   }</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  if (!bFoundCharset) {  // Use system default</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    const nsCString charset(nsMsgI18NFileSystemCharset());</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-    if (!charset.IsEmpty()) {</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-      bFoundCharset = CheckBodyInCharsetRange(charset.get());</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-      if (bFoundCharset) m_mimeCharset = charset;</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    }</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-  }</span>
<a href="#l15.19"></a><span id="l15.19">   if (!bFoundCharset)  // Everything else failed, let's use the lossless</span>
<a href="#l15.20"></a><span id="l15.20">                        // utf-8...</span>
<a href="#l15.21"></a><span id="l15.21">     m_mimeCharset.AssignLiteral(&quot;utf-8&quot;);</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23">   MAPI_DUMP_STRING(m_body.get());</span>
<a href="#l15.24"></a><span id="l15.24">   MAPI_TRACE0(&quot;\r\n&quot;);</span>
<a href="#l15.25"></a><span id="l15.25"> </span>
<a href="#l15.26"></a><span id="l15.26">   return true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/import/test/unit/test_shiftjis_csv.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_shiftjis_csv.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,21 +1,13 @@</span>
<a href="#l16.4"></a><span id="l16.4"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l16.5"></a><span id="l16.5">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> );</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> function run_test() {</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineminus">-  Services.prefs.setCharPref(</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">-    &quot;intl.charset.detector&quot;,</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">-    &quot;ja_parallel_state_machine&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  );</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  registerCleanupFunction(function() {</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-    Services.prefs.clearUserPref(&quot;intl.charset.detector&quot;);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  });</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-</span>
<a href="#l16.17"></a><span id="l16.17">   // Due to the import code using nsIAbManager off the main thread, we need</span>
<a href="#l16.18"></a><span id="l16.18">   // to ensure that it is initialized before we start the main test.</span>
<a href="#l16.19"></a><span id="l16.19">   MailServices.ab;</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">   let file = do_get_file(&quot;resources/shiftjis_addressbook.csv&quot;);</span>
<a href="#l16.22"></a><span id="l16.22">   let helper = new AbImportHelper(</span>
<a href="#l16.23"></a><span id="l16.23">     file,</span>
<a href="#l16.24"></a><span id="l16.24">     &quot;csv&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -31,19 +31,17 @@ nsTextAddress::nsTextAddress() {</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5"> nsTextAddress::~nsTextAddress() {}</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7"> nsresult nsTextAddress::GetUnicharLineStreamForFile(</span>
<a href="#l17.8"></a><span id="l17.8">     nsIFile *aFile, nsIInputStream *aInputStream,</span>
<a href="#l17.9"></a><span id="l17.9">     nsIUnicharLineInputStream **aStream) {</span>
<a href="#l17.10"></a><span id="l17.10">   nsAutoCString charset;</span>
<a href="#l17.11"></a><span id="l17.11">   nsresult rv = MsgDetectCharsetFromFile(aFile, charset);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  if (NS_FAILED(rv)) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    charset = nsMsgI18NFileSystemCharset();</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-  }</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">   nsCOMPtr&lt;nsIConverterInputStream&gt; converterStream =</span>
<a href="#l17.18"></a><span id="l17.18">       do_CreateInstance(&quot;@mozilla.org/intl/converter-input-stream;1&quot;, &amp;rv);</span>
<a href="#l17.19"></a><span id="l17.19">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l17.20"></a><span id="l17.20">     rv = converterStream-&gt;Init(</span>
<a href="#l17.21"></a><span id="l17.21">         aInputStream, charset.get(), 8192,</span>
<a href="#l17.22"></a><span id="l17.22">         nsIConverterInputStream::DEFAULT_REPLACEMENT_CHARACTER);</span>
<a href="#l17.23"></a><span id="l17.23">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/mime/src/mimetext.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/mime/src/mimetext.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -103,26 +103,16 @@ static int MimeInlineText_initializeChar</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">       if (!text-&gt;charset) {</span>
<a href="#l18.6"></a><span id="l18.6">         nsresult res;</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">         text-&gt;charsetOverridable = true;</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">         nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(</span>
<a href="#l18.11"></a><span id="l18.11">             do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;res));</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-        if (NS_SUCCEEDED(res)) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-          nsCOMPtr&lt;nsIPrefLocalizedString&gt; str;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-          if (NS_SUCCEEDED(prefBranch-&gt;GetComplexValue(</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-                  &quot;intl.charset.detector&quot;, NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-                  getter_AddRefs(str)))) {</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-            // Only if we can get autodetector name correctly, do we set this to</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">-            // true.</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-            text-&gt;inputAutodetect = true;</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-          }</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-        }</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">         if (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;default_charset)</span>
<a href="#l18.24"></a><span id="l18.24">           text-&gt;charset = strdup(obj-&gt;options-&gt;default_charset);</span>
<a href="#l18.25"></a><span id="l18.25">         else {</span>
<a href="#l18.26"></a><span id="l18.26">           if (NS_SUCCEEDED(res)) {</span>
<a href="#l18.27"></a><span id="l18.27">             nsString value;</span>
<a href="#l18.28"></a><span id="l18.28">             NS_GetLocalizedUnicharPreferenceWithDefault(</span>
<a href="#l18.29"></a><span id="l18.29">                 prefBranch, &quot;mailnews.view_default_charset&quot;, EmptyString(),</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

