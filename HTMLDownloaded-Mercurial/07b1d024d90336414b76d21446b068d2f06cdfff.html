<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4596:07b1d024d90336414b76d21446b068d2f06cdfff</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 07b1d024d90336414b76d21446b068d2f06cdfff" />
<meta property="og:url" content="/comm-central/rev/07b1d024d90336414b76d21446b068d2f06cdfff" />
<meta property="og:description" content="Bug 525819 - Make do_timeout take a callback function, not a string to eval.  This fixes all callers in the comm-central repository, so it can be changed in mozilla-central.  r=jwalden" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 07b1d024d90336414b76d21446b068d2f06cdfff 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/07b1d024d90336414b76d21446b068d2f06cdfff">shortlog</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/07b1d024d90336414b76d21446b068d2f06cdfff">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff">files</a> |
changeset |
<a href="/comm-central/raw-rev/07b1d024d90336414b76d21446b068d2f06cdfff">raw</a>  | <a href="/comm-central/archive/07b1d024d90336414b76d21446b068d2f06cdfff.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=525819">Bug 525819</a> - Make do_timeout take a callback function, not a string to eval.  This fixes all callers in the comm-central repository, so it can be changed in mozilla-central.  r=jwalden
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#104;&#110;&#32;&#68;&#97;&#110;&#105;&#101;&#108;&#115;&#32;&#60;&#106;&#111;&#104;&#110;&#115;&#100;&#97;&#110;&#105;&#101;&#108;&#115;&#64;&#121;&#97;&#104;&#111;&#111;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 18 Dec 2009 14:08:58 -0500</td></tr>

<tr>
 <td>changeset 4596</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/07b1d024d90336414b76d21446b068d2f06cdfff">07b1d024d90336414b76d21446b068d2f06cdfff</a></td>
</tr>



<tr>
<td>parent 4595</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2ab0fbab5907f40af9a9569c072f2d810ef09362">2ab0fbab5907f40af9a9569c072f2d810ef09362</a>
</td>
</tr>

<tr>
<td>child 4597</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/51bf9b169816e6009426a6f346446667bede413b">51bf9b169816e6009426a6f346446667bede413b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=07b1d024d90336414b76d21446b068d2f06cdfff">3592</a></td></tr>
<tr><td>push user</td><td>jwalden@mit.edu</td></tr>
<tr><td>push date</td><td class="date age">Mon, 28 Dec 2009 17:38:50 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@07b1d024d903 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=07b1d024d90336414b76d21446b068d2f06cdfff">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=07b1d024d90336414b76d21446b068d2f06cdfff&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=07b1d024d90336414b76d21446b068d2f06cdfff&newProject=comm-central&newRevision=07b1d024d90336414b76d21446b068d2f06cdfff&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=07b1d024d90336414b76d21446b068d2f06cdfff&newProject=comm-central&newRevision=07b1d024d90336414b76d21446b068d2f06cdfff&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=07b1d024d90336414b76d21446b068d2f06cdfff&newProject=comm-central&newRevision=07b1d024d90336414b76d21446b068d2f06cdfff&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jwalden%29&revcount=50">jwalden</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=525819">525819</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=525819">Bug 525819</a> - Make do_timeout take a callback function, not a string to eval.  This fixes all callers in the comm-central repository, so it can be changed in mozilla-central.  r=jwalden</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_bug471682.js">mailnews/base/test/unit/test_bug471682.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_bug471682.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_bug471682.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_bug471682.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_bug471682.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_bug471682.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_copyThenMoveManual.js">mailnews/base/test/unit/test_copyThenMoveManual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_copyThenMoveManual.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_copyThenMoveManual.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_copyThenMoveManual.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_copyThenMoveManual.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_copyThenMoveManual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_emptyTrash.js">mailnews/base/test/unit/test_emptyTrash.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_emptyTrash.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_emptyTrash.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_emptyTrash.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_emptyTrash.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_emptyTrash.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_folderCompact.js">mailnews/base/test/unit/test_folderCompact.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_folderCompact.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_folderCompact.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_folderCompact.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_folderCompact.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_folderCompact.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_junkWhitelisting.js">mailnews/base/test/unit/test_junkWhitelisting.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_junkWhitelisting.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_junkWhitelisting.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_junkWhitelisting.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_junkWhitelisting.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_junkWhitelisting.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_postPluginFilters.js">mailnews/base/test/unit/test_postPluginFilters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_postPluginFilters.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_postPluginFilters.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_postPluginFilters.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_postPluginFilters.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/base/test/unit/test_postPluginFilters.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_attachment.js">mailnews/compose/test/unit/test_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_attachment.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_attachment.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_attachment.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_attachment.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_bug474774.js">mailnews/compose/test/unit/test_bug474774.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_bug474774.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_bug474774.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_bug474774.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_bug474774.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_bug474774.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendBackground.js">mailnews/compose/test/unit/test_sendBackground.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendBackground.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendBackground.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendBackground.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendBackground.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendBackground.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageFile.js">mailnews/compose/test/unit/test_sendMessageFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageFile.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageFile.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageFile.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageFile.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageFile.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageLater.js">mailnews/compose/test/unit/test_sendMessageLater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageLater.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageLater.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageLater.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageLater.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/compose/test/unit/test_sendMessageLater.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_autosync_date_constraints.js">mailnews/imap/test/unit/test_autosync_date_constraints.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_autosync_date_constraints.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_autosync_date_constraints.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_autosync_date_constraints.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_autosync_date_constraints.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_autosync_date_constraints.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bccProperty.js">mailnews/imap/test/unit/test_bccProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bccProperty.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bccProperty.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bccProperty.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bccProperty.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bccProperty.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bug460636.js">mailnews/imap/test/unit/test_bug460636.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bug460636.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bug460636.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bug460636.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bug460636.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_bug460636.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_compactOfflineStore.js">mailnews/imap/test/unit/test_compactOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_compactOfflineStore.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_compactOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_compactOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_compactOfflineStore.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_compactOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_copyThenMove.js">mailnews/imap/test/unit/test_copyThenMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_copyThenMove.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_copyThenMove.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_copyThenMove.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_copyThenMove.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_copyThenMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_downloadOffline.js">mailnews/imap/test/unit/test_downloadOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_downloadOffline.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_downloadOffline.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_downloadOffline.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_downloadOffline.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_downloadOffline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFilterActions.js">mailnews/imap/test/unit/test_imapFilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFilterActions.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFilterActions.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFilterActions.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFilterActions.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFolderCopy.js">mailnews/imap/test/unit/test_imapFolderCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFolderCopy.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFolderCopy.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFolderCopy.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFolderCopy.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapFolderCopy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapPasswordFailure.js">mailnews/imap/test/unit/test_imapPasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapPasswordFailure.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapPasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapPasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapPasswordFailure.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapPasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">mailnews/imap/test/unit/test_imapStoreMsgOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapStoreMsgOffline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapUndo.js">mailnews/imap/test/unit/test_imapUndo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapUndo.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapUndo.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapUndo.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapUndo.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_imapUndo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_localToImapFilter.js">mailnews/imap/test/unit/test_localToImapFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_localToImapFilter.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_localToImapFilter.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_localToImapFilter.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_localToImapFilter.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_localToImapFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_mailboxes.js">mailnews/imap/test/unit/test_mailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_mailboxes.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_mailboxes.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_mailboxes.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_mailboxes.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_mailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/import/test/unit/resources/import_helper.js">mailnews/import/test/unit/resources/import_helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/import/test/unit/resources/import_helper.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/import/test/unit/resources/import_helper.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/import/test/unit/resources/import_helper.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/import/test/unit/resources/import_helper.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/import/test/unit/resources/import_helper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_bug457168.js">mailnews/local/test/unit/test_bug457168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_bug457168.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_bug457168.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_bug457168.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_bug457168.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_bug457168.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3GetNewMail.js">mailnews/local/test/unit/test_pop3GetNewMail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3GetNewMail.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3GetNewMail.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3GetNewMail.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3GetNewMail.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3GetNewMail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password.js">mailnews/local/test/unit/test_pop3Password.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password2.js">mailnews/local/test/unit/test_pop3Password2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password2.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password2.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password2.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password2.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Password2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Pump.js">mailnews/local/test/unit/test_pop3Pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Pump.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Pump.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Pump.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Pump.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/local/test/unit/test_pop3Pump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/news/test/unit/test_getNewsMessage.js">mailnews/news/test/unit/test_getNewsMessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/news/test/unit/test_getNewsMessage.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/news/test/unit/test_getNewsMessage.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/news/test/unit/test_getNewsMessage.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/news/test/unit/test_getNewsMessage.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/news/test/unit/test_getNewsMessage.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/POP3pump.js">mailnews/test/resources/POP3pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/POP3pump.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/POP3pump.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/POP3pump.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/POP3pump.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/POP3pump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/asyncTestUtils.js">mailnews/test/resources/asyncTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/asyncTestUtils.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/asyncTestUtils.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/asyncTestUtils.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/asyncTestUtils.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/asyncTestUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/msgFolderListenerSetup.js">mailnews/test/resources/msgFolderListenerSetup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/msgFolderListenerSetup.js">file</a> |
<a href="/comm-central/annotate/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/msgFolderListenerSetup.js">annotate</a> |
<a href="/comm-central/diff/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/msgFolderListenerSetup.js">diff</a> |
<a href="/comm-central/comparison/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/msgFolderListenerSetup.js">comparison</a> |
<a href="/comm-central/log/07b1d024d90336414b76d21446b068d2f06cdfff/mailnews/test/resources/msgFolderListenerSetup.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug471682.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug471682.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -86,17 +86,17 @@ var step2 =</span>
<a href="#l1.4"></a><span id="l1.4"> var step3 = </span>
<a href="#l1.5"></a><span id="l1.5"> {</span>
<a href="#l1.6"></a><span id="l1.6">   OnStartCopy: function() {},</span>
<a href="#l1.7"></a><span id="l1.7">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l1.8"></a><span id="l1.8">   SetMessageKey: function(aKey) {},</span>
<a href="#l1.9"></a><span id="l1.9">   SetMessageId: function(aMessageId) {},</span>
<a href="#l1.10"></a><span id="l1.10">   OnStopCopy: function(aStatus)</span>
<a href="#l1.11"></a><span id="l1.11">   {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    do_timeout(2000, &quot;step4();&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    do_timeout(2000, step4);</span>
<a href="#l1.14"></a><span id="l1.14">   }</span>
<a href="#l1.15"></a><span id="l1.15"> }</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> // step 4: start a second copy</span>
<a href="#l1.18"></a><span id="l1.18"> function step4()</span>
<a href="#l1.19"></a><span id="l1.19"> {</span>
<a href="#l1.20"></a><span id="l1.20">   var messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l1.21"></a><span id="l1.21">   messages.appendElement(gHdr, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -35,17 +35,17 @@ const gTestArray =</span>
<a href="#l2.4"></a><span id="l2.4">     gFilter.filterType = Ci.nsMsgFilterType.Manual;</span>
<a href="#l2.5"></a><span id="l2.5">     gFilterList.insertFilterAt(0, gFilter);</span>
<a href="#l2.6"></a><span id="l2.6">     ++gCurTestNum;</span>
<a href="#l2.7"></a><span id="l2.7">     doTest();</span>
<a href="#l2.8"></a><span id="l2.8">   },</span>
<a href="#l2.9"></a><span id="l2.9">   // just get a message into the local folder</span>
<a href="#l2.10"></a><span id="l2.10">   function getLocalMessages1() {</span>
<a href="#l2.11"></a><span id="l2.11">     gPOP3Pump.files = gFiles;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    gPOP3Pump.onDone = &quot;doTest();&quot;;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    gPOP3Pump.onDone = doTest;</span>
<a href="#l2.14"></a><span id="l2.14">     ++gCurTestNum;</span>
<a href="#l2.15"></a><span id="l2.15">     gPOP3Pump.run();</span>
<a href="#l2.16"></a><span id="l2.16">   },</span>
<a href="#l2.17"></a><span id="l2.17">   // test applying filters to a message header</span>
<a href="#l2.18"></a><span id="l2.18">   function applyFilters() {</span>
<a href="#l2.19"></a><span id="l2.19">     let messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l2.20"></a><span id="l2.20">                      .createInstance(Ci.nsIMutableArray);</span>
<a href="#l2.21"></a><span id="l2.21">     messages.appendElement(gLocalInboxFolder.firstNewMessage, false);</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -61,17 +61,17 @@ const gTestArray =</span>
<a href="#l2.23"></a><span id="l2.23">     // operation was a move</span>
<a href="#l2.24"></a><span id="l2.24">     do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l2.25"></a><span id="l2.25">     ++gCurTestNum;</span>
<a href="#l2.26"></a><span id="l2.26">     doTest();</span>
<a href="#l2.27"></a><span id="l2.27">   },</span>
<a href="#l2.28"></a><span id="l2.28">   // just get a message into the local folder</span>
<a href="#l2.29"></a><span id="l2.29">   function getLocalMessages2() {</span>
<a href="#l2.30"></a><span id="l2.30">     gPOP3Pump.files = gFiles;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-    gPOP3Pump.onDone = &quot;doTest();&quot;;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    gPOP3Pump.onDone = doTest;</span>
<a href="#l2.33"></a><span id="l2.33">     ++gCurTestNum;</span>
<a href="#l2.34"></a><span id="l2.34">     gPOP3Pump.run();</span>
<a href="#l2.35"></a><span id="l2.35">   },</span>
<a href="#l2.36"></a><span id="l2.36">   // use the alternate call into the filter service</span>
<a href="#l2.37"></a><span id="l2.37">   function applyFiltersToFolders() {</span>
<a href="#l2.38"></a><span id="l2.38">     let folders = Cc[&quot;@mozilla.org/supports-array;1&quot;]</span>
<a href="#l2.39"></a><span id="l2.39">                     .createInstance(Ci.nsISupportsArray);</span>
<a href="#l2.40"></a><span id="l2.40">     folders.AppendElement(gLocalInboxFolder);</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -134,28 +134,28 @@ function doTest()</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43">     try {</span>
<a href="#l2.44"></a><span id="l2.44">       testFn();</span>
<a href="#l2.45"></a><span id="l2.45">     } catch(ex) {</span>
<a href="#l2.46"></a><span id="l2.46">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l2.47"></a><span id="l2.47">     }</span>
<a href="#l2.48"></a><span id="l2.48">   }</span>
<a href="#l2.49"></a><span id="l2.49">   else</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l2.52"></a><span id="l2.52"> }</span>
<a href="#l2.53"></a><span id="l2.53"> </span>
<a href="#l2.54"></a><span id="l2.54"> // nsIFolderListener implementation</span>
<a href="#l2.55"></a><span id="l2.55"> var FolderListener = {</span>
<a href="#l2.56"></a><span id="l2.56">   OnItemAdded: function OnItemAdded(aParentItem, aItem) {</span>
<a href="#l2.57"></a><span id="l2.57">     this._showEvent(aParentItem, &quot;OnItemAdded&quot;);</span>
<a href="#l2.58"></a><span id="l2.58">   },</span>
<a href="#l2.59"></a><span id="l2.59">   OnItemRemoved: function OnItemRemoved(aParentItem, aItem) {</span>
<a href="#l2.60"></a><span id="l2.60">     this._showEvent(aParentItem, &quot;OnItemRemoved&quot;);</span>
<a href="#l2.61"></a><span id="l2.61">     // continue test, as all tests remove a message during the move</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-    do_timeout(0, &quot;doTest();&quot;);</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+    do_timeout(0, doTest);</span>
<a href="#l2.64"></a><span id="l2.64">   },</span>
<a href="#l2.65"></a><span id="l2.65">   OnItemEvent: function OnItemEvent(aEventFolder, aEvent) {</span>
<a href="#l2.66"></a><span id="l2.66">     this._showEvent(aEventFolder, aEvent.toString())</span>
<a href="#l2.67"></a><span id="l2.67">   },</span>
<a href="#l2.68"></a><span id="l2.68">   _showEvent: function showEvent(aFolder, aEventString) {</span>
<a href="#l2.69"></a><span id="l2.69">         dump(&quot;received folder event &quot; + aEventString +</span>
<a href="#l2.70"></a><span id="l2.70">          &quot; folder &quot; + aFolder.name +</span>
<a href="#l2.71"></a><span id="l2.71">          &quot;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/test/unit/test_emptyTrash.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_emptyTrash.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -43,32 +43,32 @@ var copyListener =</span>
<a href="#l3.4"></a><span id="l3.4">   OnStopCopy: function(aStatus)</span>
<a href="#l3.5"></a><span id="l3.5">   {</span>
<a href="#l3.6"></a><span id="l3.6">     // Check: message successfully copied.</span>
<a href="#l3.7"></a><span id="l3.7">     do_check_eq(aStatus, 0);</span>
<a href="#l3.8"></a><span id="l3.8">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l3.9"></a><span id="l3.9">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l3.10"></a><span id="l3.10">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l3.11"></a><span id="l3.11">     // to return</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l3.14"></a><span id="l3.14">   }</span>
<a href="#l3.15"></a><span id="l3.15"> };</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> var urlListener =</span>
<a href="#l3.18"></a><span id="l3.18"> {</span>
<a href="#l3.19"></a><span id="l3.19">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l3.20"></a><span id="l3.20">   },</span>
<a href="#l3.21"></a><span id="l3.21">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l3.22"></a><span id="l3.22">     // Check: message successfully copied.</span>
<a href="#l3.23"></a><span id="l3.23">     do_check_eq(aExitCode, 0);</span>
<a href="#l3.24"></a><span id="l3.24">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l3.25"></a><span id="l3.25">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l3.26"></a><span id="l3.26">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l3.27"></a><span id="l3.27">     // to return</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l3.30"></a><span id="l3.30">   }</span>
<a href="#l3.31"></a><span id="l3.31"> };</span>
<a href="#l3.32"></a><span id="l3.32"> </span>
<a href="#l3.33"></a><span id="l3.33"> function copyFileMessage(file, destFolder, isDraftOrTemplate)</span>
<a href="#l3.34"></a><span id="l3.34"> {</span>
<a href="#l3.35"></a><span id="l3.35">   gCopyService.CopyFileMessage(file, destFolder, null, isDraftOrTemplate, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l3.36"></a><span id="l3.36"> }</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38" class="difflineat">@@ -153,18 +153,22 @@ function run_test()</span>
<a href="#l3.39"></a><span id="l3.39"> function doTest(test)</span>
<a href="#l3.40"></a><span id="l3.40"> {</span>
<a href="#l3.41"></a><span id="l3.41">   if (test &lt;= gTestArray.length)</span>
<a href="#l3.42"></a><span id="l3.42">   {</span>
<a href="#l3.43"></a><span id="l3.43">     gCurTestNum = test;</span>
<a href="#l3.44"></a><span id="l3.44">     </span>
<a href="#l3.45"></a><span id="l3.45">     var testFn = gTestArray[test-1];</span>
<a href="#l3.46"></a><span id="l3.46">     // Set a limit of three seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+        if (gCurTestNum == test)</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+        }</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+      );</span>
<a href="#l3.55"></a><span id="l3.55">     try {</span>
<a href="#l3.56"></a><span id="l3.56">     testFn();</span>
<a href="#l3.57"></a><span id="l3.57">     } catch(ex) {dump(ex);}</span>
<a href="#l3.58"></a><span id="l3.58">   }</span>
<a href="#l3.59"></a><span id="l3.59">   else</span>
<a href="#l3.60"></a><span id="l3.60">   {</span>
<a href="#l3.61"></a><span id="l3.61">     gMsgHdrs = null;</span>
<a href="#l3.62"></a><span id="l3.62">     do_test_finished(); // for the one in run_test()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -46,32 +46,32 @@ var copyListener =</span>
<a href="#l4.4"></a><span id="l4.4">   OnStopCopy: function(aStatus)</span>
<a href="#l4.5"></a><span id="l4.5">   {</span>
<a href="#l4.6"></a><span id="l4.6">     // Check: message successfully copied.</span>
<a href="#l4.7"></a><span id="l4.7">     do_check_eq(aStatus, 0);</span>
<a href="#l4.8"></a><span id="l4.8">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l4.9"></a><span id="l4.9">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l4.10"></a><span id="l4.10">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l4.11"></a><span id="l4.11">     // to return</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l4.14"></a><span id="l4.14">   }</span>
<a href="#l4.15"></a><span id="l4.15"> };</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> var urlListener =</span>
<a href="#l4.18"></a><span id="l4.18"> {</span>
<a href="#l4.19"></a><span id="l4.19">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l4.20"></a><span id="l4.20">   },</span>
<a href="#l4.21"></a><span id="l4.21">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l4.22"></a><span id="l4.22">     // Check: message successfully copied.</span>
<a href="#l4.23"></a><span id="l4.23">     do_check_eq(aExitCode, 0);</span>
<a href="#l4.24"></a><span id="l4.24">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l4.25"></a><span id="l4.25">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l4.26"></a><span id="l4.26">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l4.27"></a><span id="l4.27">     // to return</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l4.30"></a><span id="l4.30">   }</span>
<a href="#l4.31"></a><span id="l4.31"> };</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33"> function copyFileMessage(file, destFolder, isDraftOrTemplate)</span>
<a href="#l4.34"></a><span id="l4.34"> {</span>
<a href="#l4.35"></a><span id="l4.35">   gCopyService.CopyFileMessage(file, destFolder, null, isDraftOrTemplate, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l4.36"></a><span id="l4.36"> }</span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38" class="difflineat">@@ -186,19 +186,24 @@ function run_test()</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40"> function doTest(test)</span>
<a href="#l4.41"></a><span id="l4.41"> {</span>
<a href="#l4.42"></a><span id="l4.42">   if (test &lt;= gTestArray.length)</span>
<a href="#l4.43"></a><span id="l4.43">   {</span>
<a href="#l4.44"></a><span id="l4.44">     gCurTestNum = test;</span>
<a href="#l4.45"></a><span id="l4.45">     </span>
<a href="#l4.46"></a><span id="l4.46">     var testFn = gTestArray[test-1];</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-    // Set a limit of three seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    // Set a limit of 10 seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+        if (gCurTestNum == test)</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+        }</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+      );</span>
<a href="#l4.58"></a><span id="l4.58">     try {</span>
<a href="#l4.59"></a><span id="l4.59">     testFn();</span>
<a href="#l4.60"></a><span id="l4.60">     } catch(ex) {dump(ex);}</span>
<a href="#l4.61"></a><span id="l4.61">   }</span>
<a href="#l4.62"></a><span id="l4.62">   else</span>
<a href="#l4.63"></a><span id="l4.63">   {</span>
<a href="#l4.64"></a><span id="l4.64">     do_test_finished(); // for the one in run_test()</span>
<a href="#l4.65"></a><span id="l4.65">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -79,17 +79,17 @@ function run_test()</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   // Copy the file to the profile directory for a PAB (this is the personal address book)</span>
<a href="#l5.6"></a><span id="l5.6">   testAB.copyTo(gProfileDir, kPABData.fileName);</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">   do_test_pending();</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">   // kick off copying</span>
<a href="#l5.11"></a><span id="l5.11">   gPOP3Pump.files = Files;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  gPOP3Pump.onDone = &quot;continueTest();&quot;;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  gPOP3Pump.onDone = continueTest;</span>
<a href="#l5.14"></a><span id="l5.14">   gPOP3Pump.run();</span>
<a href="#l5.15"></a><span id="l5.15"> }</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> function continueTest()</span>
<a href="#l5.18"></a><span id="l5.18"> {</span>
<a href="#l5.19"></a><span id="l5.19">   // get the message headers</span>
<a href="#l5.20"></a><span id="l5.20">   let headerEnum = gLocalInboxFolder.messages;</span>
<a href="#l5.21"></a><span id="l5.21">   while (headerEnum.hasMoreElements())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -297,19 +297,23 @@ function run_test()</span>
<a href="#l6.4"></a><span id="l6.4">   doTest(1);</span>
<a href="#l6.5"></a><span id="l6.5"> }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> function doTest(test)</span>
<a href="#l6.8"></a><span id="l6.8"> {</span>
<a href="#l6.9"></a><span id="l6.9">   if (test &lt;= gTestArray.length)</span>
<a href="#l6.10"></a><span id="l6.10">   {</span>
<a href="#l6.11"></a><span id="l6.11">     var testFn = gTestArray[test-1];</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    // Set a limit of three seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-    do_timeout(10000, &quot;if (gTest == &quot;+test+&quot;) \</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    // Set a limit of 10 seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+        if (gTest == test)</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+        }</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+      );</span>
<a href="#l6.22"></a><span id="l6.22">     dump(&quot;=== Test: &quot; + testFn.name + &quot;\n&quot;);</span>
<a href="#l6.23"></a><span id="l6.23">     testFn();</span>
<a href="#l6.24"></a><span id="l6.24">   }</span>
<a href="#l6.25"></a><span id="l6.25">   else</span>
<a href="#l6.26"></a><span id="l6.26">   {</span>
<a href="#l6.27"></a><span id="l6.27">     gHdrsReceived = null;</span>
<a href="#l6.28"></a><span id="l6.28">     gMsgHdrs = null;</span>
<a href="#l6.29"></a><span id="l6.29">     gMFNService.removeListener(gMFListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -280,17 +280,17 @@ function startCommand()</span>
<a href="#l7.4"></a><span id="l7.4">         classifyListener); // [optional] in nsIMsgTraitClassificationListener aTraitListener</span>
<a href="#l7.5"></a><span id="l7.5">         // null,      // [optional] in nsIMsgWindow aMsgWindow</span>
<a href="#l7.6"></a><span id="l7.6">         // null,      // [optional] in nsIJunkMailClassificationListener aJunkListener</span>
<a href="#l7.7"></a><span id="l7.7">       break;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9">     case kClass:</span>
<a href="#l7.10"></a><span id="l7.10">       // classify message</span>
<a href="#l7.11"></a><span id="l7.11">       gPOP3Pump.files = [gTest.fileName];</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      gPOP3Pump.onDone = &quot;do_timeout(100, startCommand());&quot;;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      gPOP3Pump.onDone = function(){do_timeout(100, startCommand());};</span>
<a href="#l7.14"></a><span id="l7.14">       gPOP3Pump.run();</span>
<a href="#l7.15"></a><span id="l7.15">       break;</span>
<a href="#l7.16"></a><span id="l7.16">   }</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> function getSpec(aFileName)</span>
<a href="#l7.20"></a><span id="l7.20"> {</span>
<a href="#l7.21"></a><span id="l7.21">   var file = do_get_file(&quot;../../mailnews/data/&quot; + aFileName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_attachment.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_attachment.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -68,17 +68,17 @@ const expectedCTList1 = [</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> var gSmtpServer;</span>
<a href="#l8.6"></a><span id="l8.6"> var gDraftFolder;</span>
<a href="#l8.7"></a><span id="l8.7"> var gCurTestNum = 0;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> var progressListener = {</span>
<a href="#l8.10"></a><span id="l8.10">   onStateChange: function(aWebProgress, aRequest, aStateFlags, aStatus) {</span>
<a href="#l8.11"></a><span id="l8.11">     if (aStateFlags &amp; Ci.nsIWebProgressListener.STATE_STOP){</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      do_timeout(0, &quot;doTest(++gCurTestNum);&quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+      do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l8.14"></a><span id="l8.14">     }</span>
<a href="#l8.15"></a><span id="l8.15">   },</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">   onProgressChange: function(aWebProgress, aRequest, aCurSelfProgress, aMaxSelfProgress, aCurTotalProgress, aMaxTotalProgress) {},</span>
<a href="#l8.18"></a><span id="l8.18">   onLocationChange: function(aWebProgress, aRequest, aLocation) {},</span>
<a href="#l8.19"></a><span id="l8.19">   onStatusChange: function(aWebProgress, aRequest, aStatus, aMessage) {},</span>
<a href="#l8.20"></a><span id="l8.20">   onSecurityChange: function(aWebProgress, aRequest, state) {},</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -159,17 +159,17 @@ function checkAttachment(expectedCD, exp</span>
<a href="#l8.23"></a><span id="l8.23">   pos = 0;</span>
<a href="#l8.24"></a><span id="l8.24">   do {</span>
<a href="#l8.25"></a><span id="l8.25">     pos = contentType.indexOf(&quot;\n&quot;, pos);</span>
<a href="#l8.26"></a><span id="l8.26">     do_check_neq(pos, -1);</span>
<a href="#l8.27"></a><span id="l8.27">     pos++;</span>
<a href="#l8.28"></a><span id="l8.28">   } while (contentType.substr(pos, 1) == &quot; &quot;);</span>
<a href="#l8.29"></a><span id="l8.29">   contentType = contentType.substr(0, pos);</span>
<a href="#l8.30"></a><span id="l8.30">   do_check_eq(contentType, expectedCT);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  do_timeout(0, &quot;doTest(++gCurTestNum);&quot;);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l8.33"></a><span id="l8.33"> }</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35"> const gTestArray =</span>
<a href="#l8.36"></a><span id="l8.36"> [</span>
<a href="#l8.37"></a><span id="l8.37">   function createMessage1() { createMessage(0, input0); },</span>
<a href="#l8.38"></a><span id="l8.38">   function checkAttachment1() { checkAttachment(expectedCD0, expectedCTList0[0]); },</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40">   function createMessage2() { createMessage(1, input0); },</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -203,18 +203,22 @@ function doTest(test)</span>
<a href="#l8.42"></a><span id="l8.42"> {</span>
<a href="#l8.43"></a><span id="l8.43">   dump(&quot;doTest &quot; + test + &quot;\n&quot;);</span>
<a href="#l8.44"></a><span id="l8.44">   if (test &lt;= gTestArray.length) {</span>
<a href="#l8.45"></a><span id="l8.45">     gCurTestNum = test;</span>
<a href="#l8.46"></a><span id="l8.46">  </span>
<a href="#l8.47"></a><span id="l8.47">     var testFn = gTestArray[test-1];</span>
<a href="#l8.48"></a><span id="l8.48"> </span>
<a href="#l8.49"></a><span id="l8.49">     // Set a limit in case the notifications haven't arrived (i.e. a problem)</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;)               \</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-               do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+    do_timeout(10000, function() {</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+        if(gCurTestNum == test)</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+	  do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name +</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+        }</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+      );</span>
<a href="#l8.58"></a><span id="l8.58">     try {</span>
<a href="#l8.59"></a><span id="l8.59">       testFn();</span>
<a href="#l8.60"></a><span id="l8.60">     } catch(ex) {</span>
<a href="#l8.61"></a><span id="l8.61">       dump(ex);</span>
<a href="#l8.62"></a><span id="l8.62">       do_throw(ex);</span>
<a href="#l8.63"></a><span id="l8.63">     }</span>
<a href="#l8.64"></a><span id="l8.64">   }</span>
<a href="#l8.65"></a><span id="l8.65">   else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_bug474774.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_bug474774.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -141,17 +141,19 @@ function sendMessageLater()</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">     msgSendLater.addListener(messageListener);</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">     // Send the unsent message</span>
<a href="#l9.8"></a><span id="l9.8">     msgSendLater.sendUnsentMessages(identity);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">     server.performTest();</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    do_timeout(10000, &quot;if (!finished) do_throw('Notifications of message send/copy not received');&quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    do_timeout(10000, function()</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+        {if (!finished) do_throw('Notifications of message send/copy not received');}</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+      );</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">     do_test_pending();</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19">   } catch (e) {</span>
<a href="#l9.20"></a><span id="l9.20">     do_throw(e);</span>
<a href="#l9.21"></a><span id="l9.21">   } finally {</span>
<a href="#l9.22"></a><span id="l9.22">     server.stop();</span>
<a href="#l9.23"></a><span id="l9.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendBackground.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendBackground.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -157,17 +157,19 @@ function run_test() {</span>
<a href="#l10.4"></a><span id="l10.4">     // mailnews.sendInBackground set, nsMsgSendLater should just send it for</span>
<a href="#l10.5"></a><span id="l10.5">     // us.</span>
<a href="#l10.6"></a><span id="l10.6">     msgSend.sendMessageFile(identity, &quot;&quot;, compFields, testFile1,</span>
<a href="#l10.7"></a><span id="l10.7">                             false, false, Ci.nsIMsgSend.nsMsgDeliverBackground,</span>
<a href="#l10.8"></a><span id="l10.8">                             null, null, null, null);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">     server.performTest();</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    do_timeout(10000, &quot;if (!finished) do_throw('Notifications of message send/copy not received');&quot;);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    do_timeout(10000, function()</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+        {if (!finished) do_throw('Notifications of message send/copy not received');}</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+      );</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17">     do_test_pending();</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">   } catch (e) {</span>
<a href="#l10.20"></a><span id="l10.20">     do_throw(e);</span>
<a href="#l10.21"></a><span id="l10.21">   } finally {</span>
<a href="#l10.22"></a><span id="l10.22">     server.stop();</span>
<a href="#l10.23"></a><span id="l10.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageFile.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageFile.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -158,17 +158,19 @@ function run_test() {</span>
<a href="#l11.4"></a><span id="l11.4">     var messageListener = new msl();</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">     msgSend.sendMessageFile(identity, &quot;&quot;, compFields, testFile,</span>
<a href="#l11.7"></a><span id="l11.7">                             false, false, Ci.nsIMsgSend.nsMsgDeliverNow,</span>
<a href="#l11.8"></a><span id="l11.8">                             null, messageListener, null, null);</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">     server.performTest();</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    do_timeout(10000, &quot;if (!finished) do_throw('Notifications of message send/copy not received');&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    do_timeout(10000, function()</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+        {if (!finished) do_throw('Notifications of message send/copy not received');}</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+      );</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">     do_test_pending();</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">   } catch (e) {</span>
<a href="#l11.20"></a><span id="l11.20">     do_throw(e);</span>
<a href="#l11.21"></a><span id="l11.21">   } finally {</span>
<a href="#l11.22"></a><span id="l11.22">     server.stop();</span>
<a href="#l11.23"></a><span id="l11.23">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -149,17 +149,19 @@ function sendMessageLater()</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">     msgSendLater.addListener(messageListener);</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7">     // Send the unsent message</span>
<a href="#l12.8"></a><span id="l12.8">     msgSendLater.sendUnsentMessages(identity);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">     server.performTest();</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    do_timeout(10000, &quot;if (!finished) do_throw('Notifications of message send/copy not received');&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    do_timeout(10000, function()</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+        {if (!finished) do_throw('Notifications of message send/copy not received');}</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+      );</span>
<a href="#l12.16"></a><span id="l12.16">   } catch (e) {</span>
<a href="#l12.17"></a><span id="l12.17">     do_throw(e);</span>
<a href="#l12.18"></a><span id="l12.18">   } finally {</span>
<a href="#l12.19"></a><span id="l12.19">     server.stop();</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">     var thread = gThreadManager.currentThread;</span>
<a href="#l12.22"></a><span id="l12.22">     while (thread.hasPendingEvents())</span>
<a href="#l12.23"></a><span id="l12.23">       thread.processNextEvent(true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -37,11 +37,11 @@ function run_test() {</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> var messageHeaderGetterListener = {</span>
<a href="#l13.6"></a><span id="l13.6">   OnStartCopy: function() {},</span>
<a href="#l13.7"></a><span id="l13.7">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l13.8"></a><span id="l13.8">   GetMessageId: function (aMessageId) {},</span>
<a href="#l13.9"></a><span id="l13.9">   SetMessageKey: function(aKey) {</span>
<a href="#l13.10"></a><span id="l13.10">   },</span>
<a href="#l13.11"></a><span id="l13.11">   OnStopCopy: function(aStatus) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    do_timeout(0, &quot;test_enumerator_cleanup();&quot;);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    do_timeout(0, test_enumerator_cleanup);</span>
<a href="#l13.14"></a><span id="l13.14">   }</span>
<a href="#l13.15"></a><span id="l13.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/test_junkAsTraits.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -525,12 +525,12 @@ function startCommand()</span>
<a href="#l14.4"></a><span id="l14.4">       nsIMsgCorpus.corpusCounts(kJunkTrait, msgCount);</span>
<a href="#l14.5"></a><span id="l14.5">       let junkCount = msgCount.value;</span>
<a href="#l14.6"></a><span id="l14.6">       nsIMsgCorpus.corpusCounts(kGoodTrait, msgCount);</span>
<a href="#l14.7"></a><span id="l14.7">       let goodCount = msgCount.value;</span>
<a href="#l14.8"></a><span id="l14.8">       print(&quot;tokenCount, junkCount, goodCount is &quot; + tokenCount, junkCount, goodCount);</span>
<a href="#l14.9"></a><span id="l14.9">       do_check_eq(tokenCount, gTest.tokenCount);</span>
<a href="#l14.10"></a><span id="l14.10">       do_check_eq(junkCount, gTest.junkCount);</span>
<a href="#l14.11"></a><span id="l14.11">       do_check_eq(goodCount, gTest.goodCount);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      do_timeout(0, &quot;startCommand();&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      do_timeout(0, startCommand);</span>
<a href="#l14.14"></a><span id="l14.14">       break;</span>
<a href="#l14.15"></a><span id="l14.15">   }</span>
<a href="#l14.16"></a><span id="l14.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -133,18 +133,22 @@ function doTest(test)</span>
<a href="#l15.4"></a><span id="l15.4"> {</span>
<a href="#l15.5"></a><span id="l15.5">   if (test &lt;= gTestArray.length)</span>
<a href="#l15.6"></a><span id="l15.6">   {</span>
<a href="#l15.7"></a><span id="l15.7">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l15.8"></a><span id="l15.8">     gCurTestNum = test;</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">     var testFn = gTestArray[test-1];</span>
<a href="#l15.11"></a><span id="l15.11">     // Set a limit of three seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        if (gCurTestNum == test)</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+        }</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+      );</span>
<a href="#l15.20"></a><span id="l15.20">     try {</span>
<a href="#l15.21"></a><span id="l15.21">     testFn();</span>
<a href="#l15.22"></a><span id="l15.22">     } catch(ex) {dump(ex);}</span>
<a href="#l15.23"></a><span id="l15.23">   }</span>
<a href="#l15.24"></a><span id="l15.24">   else</span>
<a href="#l15.25"></a><span id="l15.25">   {</span>
<a href="#l15.26"></a><span id="l15.26">     // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l15.27"></a><span id="l15.27">     // server</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineat">@@ -175,11 +179,11 @@ var UrlListener =</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l15.31"></a><span id="l15.31">     // Check: message successfully copied.</span>
<a href="#l15.32"></a><span id="l15.32">     do_check_eq(aExitCode, 0);</span>
<a href="#l15.33"></a><span id="l15.33">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l15.34"></a><span id="l15.34">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l15.35"></a><span id="l15.35">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l15.36"></a><span id="l15.36">     // to return</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum)});</span>
<a href="#l15.39"></a><span id="l15.39">   }</span>
<a href="#l15.40"></a><span id="l15.40"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -46,17 +46,20 @@ function run_test()</span>
<a href="#l16.4"></a><span id="l16.4">    */</span>
<a href="#l16.5"></a><span id="l16.5">   let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l16.6"></a><span id="l16.6">                      .getService(Ci.nsIIOService)</span>
<a href="#l16.7"></a><span id="l16.7">                      .newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">   inbox.addMessage(new imapMessage(msgfileuri.spec, inbox.uidnext++, []));</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">   do_test_pending();</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  do_timeout(10000, &quot;do_throw('downloadAllForOffline did not complete within 10 seconds. ABORTING.');&quot;);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  do_timeout(10000, function(){</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+      do_throw('downloadAllForOffline did not complete within 10 seconds. ABORTING.');</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+      }</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+    );</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">   // Get the IMAP inbox...</span>
<a href="#l16.19"></a><span id="l16.19">   let rootFolder = gIMAPIncomingServer.rootFolder;</span>
<a href="#l16.20"></a><span id="l16.20">   gIMAPInbox = rootFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l16.21"></a><span id="l16.21"> </span>
<a href="#l16.22"></a><span id="l16.22">   // ...and download for offline use.</span>
<a href="#l16.23"></a><span id="l16.23">   gIMAPInbox.downloadAllForOffline(UrlListener, null);</span>
<a href="#l16.24"></a><span id="l16.24"> }</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineat">@@ -69,17 +72,17 @@ var UrlListener =</span>
<a href="#l16.26"></a><span id="l16.26">     // Check for ok status.</span>
<a href="#l16.27"></a><span id="l16.27">     do_check_eq(rc, 0);</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">     if (!gDownloadedOnce) {</span>
<a href="#l16.30"></a><span id="l16.30">       gDownloadedOnce = true;</span>
<a href="#l16.31"></a><span id="l16.31">       gIMAPInbox.downloadAllForOffline(UrlListener, null);</span>
<a href="#l16.32"></a><span id="l16.32">       return;</span>
<a href="#l16.33"></a><span id="l16.33">     }</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l16.36"></a><span id="l16.36">   }</span>
<a href="#l16.37"></a><span id="l16.37"> };</span>
<a href="#l16.38"></a><span id="l16.38"> </span>
<a href="#l16.39"></a><span id="l16.39"> function endTest()</span>
<a href="#l16.40"></a><span id="l16.40"> {</span>
<a href="#l16.41"></a><span id="l16.41">   // locate the new message by enumerating through the database</span>
<a href="#l16.42"></a><span id="l16.42">   let enumerator = gIMAPInbox.msgDatabase.EnumerateMessages();</span>
<a href="#l16.43"></a><span id="l16.43">   while(enumerator.hasMoreElements())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bug460636.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -49,17 +49,21 @@ function run_test()</span>
<a href="#l17.4"></a><span id="l17.4">    * otherwise it's kept in IMapMD.</span>
<a href="#l17.5"></a><span id="l17.5">    */</span>
<a href="#l17.6"></a><span id="l17.6">   gSavedMsgFile = Cc[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l17.7"></a><span id="l17.7">                   .getService(Ci.nsIProperties)</span>
<a href="#l17.8"></a><span id="l17.8">                   .get(&quot;IMapMD&quot;, Ci.nsILocalFile);</span>
<a href="#l17.9"></a><span id="l17.9">   gSavedMsgFile.append(gFileName + &quot;.eml&quot;);</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   do_test_pending();</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  do_timeout(10000, &quot;do_throw('SaveMessageToDisk did not complete within 10 seconds (incorrect messageURI?). ABORTING.');&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  do_timeout(10000, function(){</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+      do_throw('SaveMessageToDisk did not complete within 10 seconds' +</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+        '(incorrect messageURI?). ABORTING.');</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+      }</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+    );</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19">   /*</span>
<a href="#l17.20"></a><span id="l17.20">    * From nsIMsgMessageService.idl:</span>
<a href="#l17.21"></a><span id="l17.21">    * void SaveMessageToDisk(in string aMessageURI, in nsIFile aFile,</span>
<a href="#l17.22"></a><span id="l17.22">    *                        in boolean aGenerateDummyEnvelope,</span>
<a href="#l17.23"></a><span id="l17.23">    *                        in nsIUrlListener aUrlListener, out nsIURI aURL,</span>
<a href="#l17.24"></a><span id="l17.24">    *                        in boolean canonicalLineEnding,</span>
<a href="#l17.25"></a><span id="l17.25">    *                        in nsIMsgWindow aMsgWindow);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineat">@@ -94,11 +98,11 @@ var UrlListener =</span>
<a href="#l17.27"></a><span id="l17.27">   OnStartRunningUrl: function(url) { },</span>
<a href="#l17.28"></a><span id="l17.28">   OnStopRunningUrl: function(url, rc)</span>
<a href="#l17.29"></a><span id="l17.29">   {</span>
<a href="#l17.30"></a><span id="l17.30">     do_check_eq(loadFileToString(gMsgFile), loadFileToString(gSavedMsgFile));</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32">     // The file doesn't get closed straight away, but does after a little bit.</span>
<a href="#l17.33"></a><span id="l17.33">     // So wait, and then remove it. We need to test this to ensure we don't</span>
<a href="#l17.34"></a><span id="l17.34">     // indefinitely lock the file.</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l17.37"></a><span id="l17.37">   }</span>
<a href="#l17.38"></a><span id="l17.38"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -180,19 +180,23 @@ function run_test()</span>
<a href="#l18.4"></a><span id="l18.4"> function doTest(test)</span>
<a href="#l18.5"></a><span id="l18.5"> {</span>
<a href="#l18.6"></a><span id="l18.6">   if (test &lt;= gTestArray.length)</span>
<a href="#l18.7"></a><span id="l18.7">   {</span>
<a href="#l18.8"></a><span id="l18.8">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l18.9"></a><span id="l18.9">     gCurTestNum = test;</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">     var testFn = gTestArray[test-1];</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    // Set a limit of three seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+    // Set a limit of 10 seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+        if (gCurTestNum == test) </span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+        }</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+      );</span>
<a href="#l18.22"></a><span id="l18.22">     try {</span>
<a href="#l18.23"></a><span id="l18.23">     testFn();</span>
<a href="#l18.24"></a><span id="l18.24">     } catch(ex) {do_throw(ex);}</span>
<a href="#l18.25"></a><span id="l18.25">   }</span>
<a href="#l18.26"></a><span id="l18.26">   else</span>
<a href="#l18.27"></a><span id="l18.27">   {</span>
<a href="#l18.28"></a><span id="l18.28">     // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l18.29"></a><span id="l18.29">     // server</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineat">@@ -232,26 +236,26 @@ var CopyListener =</span>
<a href="#l18.31"></a><span id="l18.31">   OnStopCopy: function(aStatus)</span>
<a href="#l18.32"></a><span id="l18.32">   {</span>
<a href="#l18.33"></a><span id="l18.33">     // Check: message successfully copied.</span>
<a href="#l18.34"></a><span id="l18.34">     do_check_eq(aStatus, 0);</span>
<a href="#l18.35"></a><span id="l18.35">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l18.36"></a><span id="l18.36">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l18.37"></a><span id="l18.37">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l18.38"></a><span id="l18.38">     // to return</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum)});</span>
<a href="#l18.41"></a><span id="l18.41">   }</span>
<a href="#l18.42"></a><span id="l18.42"> };</span>
<a href="#l18.43"></a><span id="l18.43"> </span>
<a href="#l18.44"></a><span id="l18.44"> var UrlListener = </span>
<a href="#l18.45"></a><span id="l18.45"> {</span>
<a href="#l18.46"></a><span id="l18.46">   OnStartRunningUrl: function(url) { },</span>
<a href="#l18.47"></a><span id="l18.47"> </span>
<a href="#l18.48"></a><span id="l18.48">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l18.49"></a><span id="l18.49">     // Check: message successfully copied.</span>
<a href="#l18.50"></a><span id="l18.50">     do_check_eq(aExitCode, 0);</span>
<a href="#l18.51"></a><span id="l18.51">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l18.52"></a><span id="l18.52">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l18.53"></a><span id="l18.53">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l18.54"></a><span id="l18.54">     // to return</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum)});</span>
<a href="#l18.57"></a><span id="l18.57">   }</span>
<a href="#l18.58"></a><span id="l18.58"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -162,28 +162,32 @@ function doTest(test)</span>
<a href="#l19.4"></a><span id="l19.4"> {</span>
<a href="#l19.5"></a><span id="l19.5">   if (test &lt;= gTestArray.length)</span>
<a href="#l19.6"></a><span id="l19.6">   {</span>
<a href="#l19.7"></a><span id="l19.7">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l19.8"></a><span id="l19.8">     gCurTestNum = test;</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">     var testFn = gTestArray[test - 1];</span>
<a href="#l19.11"></a><span id="l19.11">     // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+        if (gCurTestNum == test)</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+        }</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+      );</span>
<a href="#l19.20"></a><span id="l19.20">     try {</span>
<a href="#l19.21"></a><span id="l19.21">     testFn();</span>
<a href="#l19.22"></a><span id="l19.22">     } catch(ex) {</span>
<a href="#l19.23"></a><span id="l19.23">       gServer.stop();</span>
<a href="#l19.24"></a><span id="l19.24">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l19.25"></a><span id="l19.25">     }</span>
<a href="#l19.26"></a><span id="l19.26">   }</span>
<a href="#l19.27"></a><span id="l19.27">   else</span>
<a href="#l19.28"></a><span id="l19.28">   {</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l19.31"></a><span id="l19.31">   }</span>
<a href="#l19.32"></a><span id="l19.32"> }</span>
<a href="#l19.33"></a><span id="l19.33"> </span>
<a href="#l19.34"></a><span id="l19.34"> // nsIMsgCopyServiceListener implementation - runs next test when copy</span>
<a href="#l19.35"></a><span id="l19.35"> // is completed.</span>
<a href="#l19.36"></a><span id="l19.36"> var CopyListener = </span>
<a href="#l19.37"></a><span id="l19.37"> {</span>
<a href="#l19.38"></a><span id="l19.38">   OnStartCopy: function() {},</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineat">@@ -197,29 +201,29 @@ var CopyListener =</span>
<a href="#l19.40"></a><span id="l19.40">   {</span>
<a href="#l19.41"></a><span id="l19.41">     dump(&quot;in OnStopCopy &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l19.42"></a><span id="l19.42">     // Check: message successfully copied.</span>
<a href="#l19.43"></a><span id="l19.43">     do_check_eq(aStatus, 0);</span>
<a href="#l19.44"></a><span id="l19.44">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l19.45"></a><span id="l19.45">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l19.46"></a><span id="l19.46">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l19.47"></a><span id="l19.47">     // to return</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l19.50"></a><span id="l19.50">   }</span>
<a href="#l19.51"></a><span id="l19.51"> };</span>
<a href="#l19.52"></a><span id="l19.52"> </span>
<a href="#l19.53"></a><span id="l19.53"> // nsIURLListener implementation - runs next test</span>
<a href="#l19.54"></a><span id="l19.54"> var URLListener =</span>
<a href="#l19.55"></a><span id="l19.55"> {</span>
<a href="#l19.56"></a><span id="l19.56">   OnStartRunningUrl: function(aURL) {},</span>
<a href="#l19.57"></a><span id="l19.57">   OnStopRunningUrl: function(aURL, aStatus)</span>
<a href="#l19.58"></a><span id="l19.58">   {</span>
<a href="#l19.59"></a><span id="l19.59">     dump(&quot;in OnStopRunningURL &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l19.60"></a><span id="l19.60">     do_check_eq(aStatus, 0);</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum);&quot;);</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l19.63"></a><span id="l19.63">   }</span>
<a href="#l19.64"></a><span id="l19.64"> }</span>
<a href="#l19.65"></a><span id="l19.65"> </span>
<a href="#l19.66"></a><span id="l19.66"> function endTest()</span>
<a href="#l19.67"></a><span id="l19.67"> {</span>
<a href="#l19.68"></a><span id="l19.68">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l19.69"></a><span id="l19.69">   // server</span>
<a href="#l19.70"></a><span id="l19.70">   gMessages.clear();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_downloadOffline.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_downloadOffline.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -43,17 +43,20 @@ function run_test()</span>
<a href="#l20.4"></a><span id="l20.4">    */</span>
<a href="#l20.5"></a><span id="l20.5">   let msgfileuri = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l20.6"></a><span id="l20.6">                      .getService(Ci.nsIIOService)</span>
<a href="#l20.7"></a><span id="l20.7">                      .newFileURI(gMsgFile).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">   inbox.addMessage(new imapMessage(msgfileuri.spec, inbox.uidnext++, []));</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   do_test_pending();</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  do_timeout(10000, &quot;do_throw('downloadAllForOffline did not complete within 10 seconds. ABORTING.');&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  do_timeout(10000, function(){</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+        do_throw('downloadAllForOffline did not complete within 10 seconds. ABORTING.');</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+      }</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+    );</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18">   // Get the IMAP inbox...</span>
<a href="#l20.19"></a><span id="l20.19">   let rootFolder = gIMAPIncomingServer.rootFolder;</span>
<a href="#l20.20"></a><span id="l20.20">   gIMAPInbox = rootFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22">   // ...and download for offline use.</span>
<a href="#l20.23"></a><span id="l20.23">   gIMAPInbox.downloadAllForOffline(UrlListener, null);</span>
<a href="#l20.24"></a><span id="l20.24"> }</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineat">@@ -66,17 +69,17 @@ var UrlListener =</span>
<a href="#l20.26"></a><span id="l20.26">     // Check for ok status.</span>
<a href="#l20.27"></a><span id="l20.27">     do_check_eq(rc, 0);</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">     if (!gDownloadedOnce) {</span>
<a href="#l20.30"></a><span id="l20.30">       gDownloadedOnce = true;</span>
<a href="#l20.31"></a><span id="l20.31">       gIMAPInbox.downloadAllForOffline(UrlListener, null);</span>
<a href="#l20.32"></a><span id="l20.32">       return;</span>
<a href="#l20.33"></a><span id="l20.33">     }</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l20.36"></a><span id="l20.36">   }</span>
<a href="#l20.37"></a><span id="l20.37"> };</span>
<a href="#l20.38"></a><span id="l20.38"> </span>
<a href="#l20.39"></a><span id="l20.39"> function endTest()</span>
<a href="#l20.40"></a><span id="l20.40"> {</span>
<a href="#l20.41"></a><span id="l20.41">   gIMAPIncomingServer.closeCachedConnections();</span>
<a href="#l20.42"></a><span id="l20.42">   gServer.stop();</span>
<a href="#l20.43"></a><span id="l20.43"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -419,17 +419,17 @@ function testContinue(source)</span>
<a href="#l21.4"></a><span id="l21.4">         gAction.type == Ci.nsMsgFilterAction.MoveToFolder)</span>
<a href="#l21.5"></a><span id="l21.5">     {</span>
<a href="#l21.6"></a><span id="l21.6">       // Moves give 2 events, just use the second.</span>
<a href="#l21.7"></a><span id="l21.7">       gMoveCallbackCount++;</span>
<a href="#l21.8"></a><span id="l21.8">       if (gMoveCallbackCount != 2)</span>
<a href="#l21.9"></a><span id="l21.9">         return;</span>
<a href="#l21.10"></a><span id="l21.10">     }</span>
<a href="#l21.11"></a><span id="l21.11">     gCurTestNum++;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    do_timeout(200, &quot;doTest();&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+    do_timeout(200, doTest);</span>
<a href="#l21.14"></a><span id="l21.14">   }</span>
<a href="#l21.15"></a><span id="l21.15"> }</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17"> // basic preparation done for each test</span>
<a href="#l21.18"></a><span id="l21.18"> function setupTest(aFilter, aAction)</span>
<a href="#l21.19"></a><span id="l21.19"> {</span>
<a href="#l21.20"></a><span id="l21.20">   if (aAction &amp;&amp;</span>
<a href="#l21.21"></a><span id="l21.21">       ((aAction.type == Ci.nsMsgFilterAction.CopyToFolder) ||</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineat">@@ -479,27 +479,32 @@ function doTest()</span>
<a href="#l21.23"></a><span id="l21.23"> </span>
<a href="#l21.24"></a><span id="l21.24">   var test = gCurTestNum;</span>
<a href="#l21.25"></a><span id="l21.25">   if (test &lt;= gTestArray.length)</span>
<a href="#l21.26"></a><span id="l21.26">   {</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">     var testFn = gTestArray[test-1];</span>
<a href="#l21.29"></a><span id="l21.29">     dump(&quot;Doing test &quot; + test + &quot; &quot; + testFn.name + &quot;\n&quot;);</span>
<a href="#l21.30"></a><span id="l21.30">     // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+    do_timeout(10000, function()</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+        {</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+          if (gCurTestNum == test)</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+            do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name +</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+              &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+        }</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+      );</span>
<a href="#l21.40"></a><span id="l21.40">     try {</span>
<a href="#l21.41"></a><span id="l21.41">     testFn();</span>
<a href="#l21.42"></a><span id="l21.42">     } catch(ex) {</span>
<a href="#l21.43"></a><span id="l21.43">       gServer.stop();</span>
<a href="#l21.44"></a><span id="l21.44">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l21.45"></a><span id="l21.45">     }</span>
<a href="#l21.46"></a><span id="l21.46">   }</span>
<a href="#l21.47"></a><span id="l21.47">   else</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l21.50"></a><span id="l21.50"> }</span>
<a href="#l21.51"></a><span id="l21.51"> </span>
<a href="#l21.52"></a><span id="l21.52"> // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l21.53"></a><span id="l21.53"> // server</span>
<a href="#l21.54"></a><span id="l21.54"> function endTest()</span>
<a href="#l21.55"></a><span id="l21.55"> {</span>
<a href="#l21.56"></a><span id="l21.56">   dump(&quot; Exiting mail tests\n&quot;);</span>
<a href="#l21.57"></a><span id="l21.57">   if (gInboxListener)</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineat">@@ -718,17 +723,17 @@ function db()</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60"> // This function may be used in the test array to show</span>
<a href="#l21.61"></a><span id="l21.61"> // more detailed results after a particular test.</span>
<a href="#l21.62"></a><span id="l21.62"> function showResults() {</span>
<a href="#l21.63"></a><span id="l21.63">   listMessages(gIMAPInbox);</span>
<a href="#l21.64"></a><span id="l21.64">   if (gInboxListener)</span>
<a href="#l21.65"></a><span id="l21.65">     printListener(gInboxListener);</span>
<a href="#l21.66"></a><span id="l21.66">   gCurTestNum++;</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-  do_timeout(100, &quot;doTest();&quot;);</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+  do_timeout(100, doTest);</span>
<a href="#l21.69"></a><span id="l21.69"> }</span>
<a href="#l21.70"></a><span id="l21.70"> </span>
<a href="#l21.71"></a><span id="l21.71"> // static variables used in testCounts</span>
<a href="#l21.72"></a><span id="l21.72"> var gPreviousUnread = 0;</span>
<a href="#l21.73"></a><span id="l21.73"> var gPreviousDbNew = 0;</span>
<a href="#l21.74"></a><span id="l21.74"> </span>
<a href="#l21.75"></a><span id="l21.75"> // Test various counts.</span>
<a href="#l21.76"></a><span id="l21.76"> //</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -151,29 +151,34 @@ function run_test()</span>
<a href="#l22.4"></a><span id="l22.4"> function doTest(test)</span>
<a href="#l22.5"></a><span id="l22.5"> {</span>
<a href="#l22.6"></a><span id="l22.6">   if (test &lt;= gTestArray.length)</span>
<a href="#l22.7"></a><span id="l22.7">   {</span>
<a href="#l22.8"></a><span id="l22.8">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l22.9"></a><span id="l22.9">     gCurTestNum = test;</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">     var testFn = gTestArray[test-1];</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    // Set a limit of three seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+    // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+    do_timeout(10000, function()</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+        {</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+        if (gCurTestNum == test)</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+        }</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+      );</span>
<a href="#l22.23"></a><span id="l22.23">     try {</span>
<a href="#l22.24"></a><span id="l22.24">     testFn();</span>
<a href="#l22.25"></a><span id="l22.25">     } catch(ex) {</span>
<a href="#l22.26"></a><span id="l22.26">       gServer.stop();</span>
<a href="#l22.27"></a><span id="l22.27">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l22.28"></a><span id="l22.28">     }</span>
<a href="#l22.29"></a><span id="l22.29">   }</span>
<a href="#l22.30"></a><span id="l22.30">   else</span>
<a href="#l22.31"></a><span id="l22.31">   {</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l22.34"></a><span id="l22.34">   }</span>
<a href="#l22.35"></a><span id="l22.35"> }</span>
<a href="#l22.36"></a><span id="l22.36"> </span>
<a href="#l22.37"></a><span id="l22.37"> // nsIMsgCopyServiceListener implementation - runs next test when copy</span>
<a href="#l22.38"></a><span id="l22.38"> // is completed.</span>
<a href="#l22.39"></a><span id="l22.39"> var CopyListener = </span>
<a href="#l22.40"></a><span id="l22.40"> {</span>
<a href="#l22.41"></a><span id="l22.41">   OnStartCopy: function() {},</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineat">@@ -186,17 +191,17 @@ var CopyListener =</span>
<a href="#l22.43"></a><span id="l22.43">   {</span>
<a href="#l22.44"></a><span id="l22.44">     dump(&quot;in OnStopCopy &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l22.45"></a><span id="l22.45">     // Check: message successfully copied.</span>
<a href="#l22.46"></a><span id="l22.46">     do_check_eq(aStatus, 0);</span>
<a href="#l22.47"></a><span id="l22.47">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l22.48"></a><span id="l22.48">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l22.49"></a><span id="l22.49">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l22.50"></a><span id="l22.50">     // to return</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l22.53"></a><span id="l22.53">   }</span>
<a href="#l22.54"></a><span id="l22.54"> };</span>
<a href="#l22.55"></a><span id="l22.55"> </span>
<a href="#l22.56"></a><span id="l22.56"> function endTest()</span>
<a href="#l22.57"></a><span id="l22.57"> {</span>
<a href="#l22.58"></a><span id="l22.58">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l22.59"></a><span id="l22.59">   // server</span>
<a href="#l22.60"></a><span id="l22.60">   gRootFolder = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapPasswordFailure.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapPasswordFailure.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -151,17 +151,17 @@ function run_test() {</span>
<a href="#l23.4"></a><span id="l23.4">   // Now check the new one has been saved.</span>
<a href="#l23.5"></a><span id="l23.5">   logins = loginMgr.findLogins(count, &quot;imap://localhost&quot;, null,</span>
<a href="#l23.6"></a><span id="l23.6">                                &quot;imap://localhost&quot;);</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8">   do_check_eq(count.value, 1);</span>
<a href="#l23.9"></a><span id="l23.9">   do_check_eq(logins[0].username, kUserName);</span>
<a href="#l23.10"></a><span id="l23.10">   do_check_eq(logins[0].password, kValidPassword);</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  do_timeout(500, &quot;endTest()&quot;);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  do_timeout(500, endTest);</span>
<a href="#l23.14"></a><span id="l23.14"> }</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16"> function endTest() {</span>
<a href="#l23.17"></a><span id="l23.17">   incomingServer.closeCachedConnections();</span>
<a href="#l23.18"></a><span id="l23.18">   server.stop();</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20">   var thread = gThreadManager.currentThread;</span>
<a href="#l23.21"></a><span id="l23.21">   while (thread.hasPendingEvents())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStoreMsgOffline.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -202,53 +202,57 @@ const gTestArray =</span>
<a href="#l24.4"></a><span id="l24.4">                                             URLListener,</span>
<a href="#l24.5"></a><span id="l24.5">                                             null,</span>
<a href="#l24.6"></a><span id="l24.6">                                             url);</span>
<a href="#l24.7"></a><span id="l24.7">   },</span>
<a href="#l24.8"></a><span id="l24.8">   function verify3rdMsg() {</span>
<a href="#l24.9"></a><span id="l24.9">     let msg3 = gIMAPInbox.msgDatabase.getMsgHdrForMessageID(gMsgId3);</span>
<a href="#l24.10"></a><span id="l24.10">     // can't turn this on because our fake server doesn't support body structure.</span>
<a href="#l24.11"></a><span id="l24.11"> //    do_check_eq(msg3.flags &amp; nsMsgMessageFlags.Offline, 0);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum)});</span>
<a href="#l24.14"></a><span id="l24.14">   }</span>
<a href="#l24.15"></a><span id="l24.15"> ]</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17"> function doTest(test)</span>
<a href="#l24.18"></a><span id="l24.18"> {</span>
<a href="#l24.19"></a><span id="l24.19">   if (test &lt;= gTestArray.length)</span>
<a href="#l24.20"></a><span id="l24.20">   {</span>
<a href="#l24.21"></a><span id="l24.21">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l24.22"></a><span id="l24.22">     gCurTestNum = test;</span>
<a href="#l24.23"></a><span id="l24.23"> </span>
<a href="#l24.24"></a><span id="l24.24">     var testFn = gTestArray[test - 1];</span>
<a href="#l24.25"></a><span id="l24.25">     // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+          if (gCurTestNum == test)</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+        }</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+      );</span>
<a href="#l24.34"></a><span id="l24.34">     try {</span>
<a href="#l24.35"></a><span id="l24.35">     testFn();</span>
<a href="#l24.36"></a><span id="l24.36">     } catch(ex) {</span>
<a href="#l24.37"></a><span id="l24.37">       gServer.stop();</span>
<a href="#l24.38"></a><span id="l24.38">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l24.39"></a><span id="l24.39">     }</span>
<a href="#l24.40"></a><span id="l24.40">   }</span>
<a href="#l24.41"></a><span id="l24.41">   else</span>
<a href="#l24.42"></a><span id="l24.42">   {</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l24.45"></a><span id="l24.45">   }</span>
<a href="#l24.46"></a><span id="l24.46"> }</span>
<a href="#l24.47"></a><span id="l24.47"> </span>
<a href="#l24.48"></a><span id="l24.48"> // nsIURLListener implementation - runs next test</span>
<a href="#l24.49"></a><span id="l24.49"> var URLListener =</span>
<a href="#l24.50"></a><span id="l24.50"> {</span>
<a href="#l24.51"></a><span id="l24.51">   OnStartRunningUrl: function(aURL) {},</span>
<a href="#l24.52"></a><span id="l24.52">   OnStopRunningUrl: function(aURL, aStatus)</span>
<a href="#l24.53"></a><span id="l24.53">   {</span>
<a href="#l24.54"></a><span id="l24.54">     dump(&quot;in OnStopRunningURL &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l24.55"></a><span id="l24.55">     do_check_eq(aStatus, 0);</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum);&quot;);</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l24.58"></a><span id="l24.58">   }</span>
<a href="#l24.59"></a><span id="l24.59"> }</span>
<a href="#l24.60"></a><span id="l24.60"> </span>
<a href="#l24.61"></a><span id="l24.61"> function endTest()</span>
<a href="#l24.62"></a><span id="l24.62"> {</span>
<a href="#l24.63"></a><span id="l24.63">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l24.64"></a><span id="l24.64">   // server</span>
<a href="#l24.65"></a><span id="l24.65"> //  gMessages.clear();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -67,17 +67,17 @@ const gTestArray =</span>
<a href="#l25.4"></a><span id="l25.4">     gIMAPInbox.updateFolderWithListener(null, URLListener);</span>
<a href="#l25.5"></a><span id="l25.5">   },</span>
<a href="#l25.6"></a><span id="l25.6">   function deleteMessage() {</span>
<a href="#l25.7"></a><span id="l25.7">     let msgToDelete = gIMAPInbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l25.8"></a><span id="l25.8">     gMessages.appendElement(msgToDelete, false);</span>
<a href="#l25.9"></a><span id="l25.9">     // This delete happens offline, so we need to wait for playback before</span>
<a href="#l25.10"></a><span id="l25.10">     // doing the expunge. Playback happens 500 ms after the operation starts.</span>
<a href="#l25.11"></a><span id="l25.11">     gIMAPInbox.deleteMessages(gMessages, gMsgWindow, false, true, null, true);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    do_timeout(1500, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+    do_timeout(1500, function(){doTest(++gCurTestNum);});</span>
<a href="#l25.14"></a><span id="l25.14">   },</span>
<a href="#l25.15"></a><span id="l25.15">   function expunge() {</span>
<a href="#l25.16"></a><span id="l25.16">     gIMAPInbox.expunge(URLListener, gMsgWindow);</span>
<a href="#l25.17"></a><span id="l25.17">   },</span>
<a href="#l25.18"></a><span id="l25.18">   function undoDelete() {</span>
<a href="#l25.19"></a><span id="l25.19">     gMsgWindow.transactionManager.undoTransaction();</span>
<a href="#l25.20"></a><span id="l25.20">     // after undo, we select the trash and then the inbox, so that we sync</span>
<a href="#l25.21"></a><span id="l25.21">     // up with the server, and clear out the effects of having done the </span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -171,28 +171,32 @@ function doTest(test)</span>
<a href="#l25.23"></a><span id="l25.23"> {</span>
<a href="#l25.24"></a><span id="l25.24">   if (test &lt;= gTestArray.length)</span>
<a href="#l25.25"></a><span id="l25.25">   {</span>
<a href="#l25.26"></a><span id="l25.26">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l25.27"></a><span id="l25.27">     gCurTestNum = test;</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29">     var testFn = gTestArray[test - 1];</span>
<a href="#l25.30"></a><span id="l25.30">     // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+        if (gCurTestNum == test)</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+        }</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+      );</span>
<a href="#l25.39"></a><span id="l25.39">     try {</span>
<a href="#l25.40"></a><span id="l25.40">     testFn();</span>
<a href="#l25.41"></a><span id="l25.41">     } catch(ex) {</span>
<a href="#l25.42"></a><span id="l25.42">       gServer.stop();</span>
<a href="#l25.43"></a><span id="l25.43">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l25.44"></a><span id="l25.44">     }</span>
<a href="#l25.45"></a><span id="l25.45">   }</span>
<a href="#l25.46"></a><span id="l25.46">   else</span>
<a href="#l25.47"></a><span id="l25.47">   {</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l25.50"></a><span id="l25.50">   }</span>
<a href="#l25.51"></a><span id="l25.51"> }</span>
<a href="#l25.52"></a><span id="l25.52"> </span>
<a href="#l25.53"></a><span id="l25.53"> // nsIMsgCopyServiceListener implementation - runs next test when copy</span>
<a href="#l25.54"></a><span id="l25.54"> // is completed.</span>
<a href="#l25.55"></a><span id="l25.55"> var CopyListener =</span>
<a href="#l25.56"></a><span id="l25.56"> {</span>
<a href="#l25.57"></a><span id="l25.57">   OnStartCopy: function() {},</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineat">@@ -206,30 +210,30 @@ var CopyListener =</span>
<a href="#l25.59"></a><span id="l25.59">   {</span>
<a href="#l25.60"></a><span id="l25.60">     dump(&quot;in OnStopCopy &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l25.61"></a><span id="l25.61">     // Check: message successfully copied.</span>
<a href="#l25.62"></a><span id="l25.62">     do_check_eq(aStatus, 0);</span>
<a href="#l25.63"></a><span id="l25.63">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l25.64"></a><span id="l25.64">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l25.65"></a><span id="l25.65">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l25.66"></a><span id="l25.66">     // to return</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum)&quot;);</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l25.69"></a><span id="l25.69">   }</span>
<a href="#l25.70"></a><span id="l25.70"> };</span>
<a href="#l25.71"></a><span id="l25.71"> </span>
<a href="#l25.72"></a><span id="l25.72"> </span>
<a href="#l25.73"></a><span id="l25.73"> // nsIURLListener implementation - runs next test</span>
<a href="#l25.74"></a><span id="l25.74"> var URLListener =</span>
<a href="#l25.75"></a><span id="l25.75"> {</span>
<a href="#l25.76"></a><span id="l25.76">   OnStartRunningUrl: function(aURL) {},</span>
<a href="#l25.77"></a><span id="l25.77">   OnStopRunningUrl: function(aURL, aStatus)</span>
<a href="#l25.78"></a><span id="l25.78">   {</span>
<a href="#l25.79"></a><span id="l25.79">     dump(&quot;in OnStopRunningURL &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l25.80"></a><span id="l25.80">     do_check_eq(aStatus, 0);</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineminus">-    do_timeout(0, &quot;doTest(++gCurTestNum);&quot;);</span>
<a href="#l25.82"></a><span id="l25.82" class="difflineplus">+    do_timeout(0, function(){doTest(++gCurTestNum);});</span>
<a href="#l25.83"></a><span id="l25.83">   }</span>
<a href="#l25.84"></a><span id="l25.84"> }</span>
<a href="#l25.85"></a><span id="l25.85"> </span>
<a href="#l25.86"></a><span id="l25.86"> function endTest()</span>
<a href="#l25.87"></a><span id="l25.87"> {</span>
<a href="#l25.88"></a><span id="l25.88">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l25.89"></a><span id="l25.89">   // server</span>
<a href="#l25.90"></a><span id="l25.90">   gMessages.clear();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -172,27 +172,31 @@ function doTest()</span>
<a href="#l26.4"></a><span id="l26.4"> {</span>
<a href="#l26.5"></a><span id="l26.5">   var test = gCurTestNum;</span>
<a href="#l26.6"></a><span id="l26.6">   if (test &lt;= gTestArray.length)</span>
<a href="#l26.7"></a><span id="l26.7">   {</span>
<a href="#l26.8"></a><span id="l26.8">     dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10">     var testFn = gTestArray[test-1];</span>
<a href="#l26.11"></a><span id="l26.11">     // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    do_timeout(10000, &quot;if (gCurTestNum == &quot;+test+&quot;) \</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+          if (gCurTestNum == test)</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+            do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+              &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+        }</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+      );</span>
<a href="#l26.20"></a><span id="l26.20">     try {</span>
<a href="#l26.21"></a><span id="l26.21">     testFn();</span>
<a href="#l26.22"></a><span id="l26.22">     } catch(ex) {</span>
<a href="#l26.23"></a><span id="l26.23">       gServer.stop();</span>
<a href="#l26.24"></a><span id="l26.24">       do_throw ('TEST FAILED ' + ex);</span>
<a href="#l26.25"></a><span id="l26.25">     }</span>
<a href="#l26.26"></a><span id="l26.26">   }</span>
<a href="#l26.27"></a><span id="l26.27">   else</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l26.30"></a><span id="l26.30"> }</span>
<a href="#l26.31"></a><span id="l26.31"> </span>
<a href="#l26.32"></a><span id="l26.32"> // nsIMsgCopyServiceListener implementation - runs next test when copy</span>
<a href="#l26.33"></a><span id="l26.33"> // is completed.</span>
<a href="#l26.34"></a><span id="l26.34"> var CopyListener =</span>
<a href="#l26.35"></a><span id="l26.35"> {</span>
<a href="#l26.36"></a><span id="l26.36">   OnStartCopy: function OnStartCopy() {},</span>
<a href="#l26.37"></a><span id="l26.37">   OnProgress: function OnProgress(aProgress, aProgressMax) {},</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineat">@@ -206,30 +210,30 @@ var CopyListener =</span>
<a href="#l26.39"></a><span id="l26.39">     dump(&quot;in OnStopCopy &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l26.40"></a><span id="l26.40">     // Check: message successfully copied.</span>
<a href="#l26.41"></a><span id="l26.41">     do_check_eq(aStatus, 0);</span>
<a href="#l26.42"></a><span id="l26.42">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l26.43"></a><span id="l26.43">     // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l26.44"></a><span id="l26.44">     // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l26.45"></a><span id="l26.45">     // to return</span>
<a href="#l26.46"></a><span id="l26.46">     ++gCurTestNum;</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineminus">-    do_timeout(0, &quot;doTest()&quot;);</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineplus">+    do_timeout(0, doTest);</span>
<a href="#l26.49"></a><span id="l26.49">   }</span>
<a href="#l26.50"></a><span id="l26.50"> };</span>
<a href="#l26.51"></a><span id="l26.51"> </span>
<a href="#l26.52"></a><span id="l26.52"> // nsIURLListener implementation - runs next test</span>
<a href="#l26.53"></a><span id="l26.53"> var URLListener =</span>
<a href="#l26.54"></a><span id="l26.54"> {</span>
<a href="#l26.55"></a><span id="l26.55">   OnStartRunningUrl: function OnStartRunningUrl(aURL) {},</span>
<a href="#l26.56"></a><span id="l26.56">   OnStopRunningUrl: function OnStopRunningUrl(aURL, aStatus)</span>
<a href="#l26.57"></a><span id="l26.57">   {</span>
<a href="#l26.58"></a><span id="l26.58">     dump(&quot;in OnStopRunningURL &quot; + gCurTestNum + &quot;\n&quot;);</span>
<a href="#l26.59"></a><span id="l26.59">     do_check_eq(aStatus, 0);</span>
<a href="#l26.60"></a><span id="l26.60">     gCurTestNum++;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-    do_timeout(0, &quot;doTest();&quot;);</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+    do_timeout(0, doTest);</span>
<a href="#l26.63"></a><span id="l26.63">   }</span>
<a href="#l26.64"></a><span id="l26.64"> }</span>
<a href="#l26.65"></a><span id="l26.65"> </span>
<a href="#l26.66"></a><span id="l26.66"> function endTest()</span>
<a href="#l26.67"></a><span id="l26.67"> {</span>
<a href="#l26.68"></a><span id="l26.68">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l26.69"></a><span id="l26.69">   // server</span>
<a href="#l26.70"></a><span id="l26.70">   dump(&quot; Exiting mail tests\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_mailboxes.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_mailboxes.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -23,17 +23,17 @@ function run_test() {</span>
<a href="#l27.4"></a><span id="l27.4">   do_check_false(rootFolder.containsChildNamed(&quot;Unsubscribed box&quot;));</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">   // TODO: RFC 2342 says we should stick Trash in the personal namespace, but</span>
<a href="#l27.7"></a><span id="l27.7">   // we put it in the empty namespace. So we can't test namespace support in</span>
<a href="#l27.8"></a><span id="l27.8">   // this regard because we'd fail...</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">   do_test_pending();</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  do_timeout(1000, endTest);</span>
<a href="#l27.14"></a><span id="l27.14"> }</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> function endTest()</span>
<a href="#l27.17"></a><span id="l27.17"> {</span>
<a href="#l27.18"></a><span id="l27.18">   // Clean up the server in preparation</span>
<a href="#l27.19"></a><span id="l27.19">   gServer.resetTest();</span>
<a href="#l27.20"></a><span id="l27.20">   gLocalServer.closeCachedConnections();</span>
<a href="#l27.21"></a><span id="l27.21">   gServer.performTest();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -82,17 +82,17 @@ function doUpdateFolder(test)</span>
<a href="#l28.4"></a><span id="l28.4">   if (gTest &gt; test)</span>
<a href="#l28.5"></a><span id="l28.5">     return;</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7">   gFolderBeingUpdated.updateFolder(null);</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">   if (gCurrStatus == kStatus.everythingDone)</span>
<a href="#l28.10"></a><span id="l28.10">     resetStatusAndProceed();</span>
<a href="#l28.11"></a><span id="l28.11">   else</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-    do_timeout(1000, &quot;doUpdateFolder(&quot; + test + &quot;)&quot;);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+    do_timeout(1000, function(){doUpdateFolder(test);});</span>
<a href="#l28.14"></a><span id="l28.14"> }</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> // Adds some messages directly to a mailbox (eg new mail)</span>
<a href="#l28.17"></a><span id="l28.17"> function addMessagesToServer(messages, mailbox, localFolder)</span>
<a href="#l28.18"></a><span id="l28.18"> {</span>
<a href="#l28.19"></a><span id="l28.19">   let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l28.20"></a><span id="l28.20">                     .getService(Ci.nsIIOService);</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -253,31 +253,35 @@ function run_test()</span>
<a href="#l28.23"></a><span id="l28.23"> function doTest(test)</span>
<a href="#l28.24"></a><span id="l28.24"> {</span>
<a href="#l28.25"></a><span id="l28.25">   dump(&quot;Doing test &quot; + test + &quot;\n&quot;);</span>
<a href="#l28.26"></a><span id="l28.26">   if (test &lt;= gTestArray.length)</span>
<a href="#l28.27"></a><span id="l28.27">   {</span>
<a href="#l28.28"></a><span id="l28.28">     let testFn = gTestArray[test-1];</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30">     // Set a limit of ten seconds; if the notifications haven't arrived by then there's a problem.</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-    do_timeout(10000, &quot;if (gTest == &quot;+test+&quot;) \</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-      do_throw('Notifications not received in 10000 ms for operation &quot;+testFn.name+&quot;, current status is '+gCurrStatus);&quot;);</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+    do_timeout(10000, function(){</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+        if (gTest == test)</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+          do_throw(&quot;Notifications not received in 10000 ms for operation &quot; + testFn.name + </span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+            &quot;, current status is &quot; + gCurrStatus);</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+        }</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+      );</span>
<a href="#l28.39"></a><span id="l28.39">     testFn();</span>
<a href="#l28.40"></a><span id="l28.40">   }</span>
<a href="#l28.41"></a><span id="l28.41">   else</span>
<a href="#l28.42"></a><span id="l28.42">   {</span>
<a href="#l28.43"></a><span id="l28.43">     gMFNService.removeListener(gMFListener);</span>
<a href="#l28.44"></a><span id="l28.44">     // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l28.45"></a><span id="l28.45">     // server</span>
<a href="#l28.46"></a><span id="l28.46">     gRootFolder = null;</span>
<a href="#l28.47"></a><span id="l28.47">     gIMAPInbox = null;</span>
<a href="#l28.48"></a><span id="l28.48">     gIMAPFolder2 = null;</span>
<a href="#l28.49"></a><span id="l28.49">     gIMAPFolder3 = null;</span>
<a href="#l28.50"></a><span id="l28.50">     gIMAPTrashFolder = null;</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineminus">-    do_timeout(1000, &quot;endTest();&quot;);</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+    do_timeout(1000, endTest);</span>
<a href="#l28.53"></a><span id="l28.53">   }</span>
<a href="#l28.54"></a><span id="l28.54"> }</span>
<a href="#l28.55"></a><span id="l28.55"> </span>
<a href="#l28.56"></a><span id="l28.56"> function endTest()</span>
<a href="#l28.57"></a><span id="l28.57"> {</span>
<a href="#l28.58"></a><span id="l28.58">   gServer.resetTest();</span>
<a href="#l28.59"></a><span id="l28.59">   gIMAPIncomingServer.closeCachedConnections();</span>
<a href="#l28.60"></a><span id="l28.60">   gServer.performTest();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -142,17 +142,17 @@ AbImportHelper.prototype =</span>
<a href="#l29.4"></a><span id="l29.4">   {</span>
<a href="#l29.5"></a><span id="l29.5">     do_check_true(this.mAbInterface &amp;&amp; </span>
<a href="#l29.6"></a><span id="l29.6">                   this.mAbInterface instanceof Ci.nsIImportGeneric);</span>
<a href="#l29.7"></a><span id="l29.7">     do_check_true(this.mAbInterface.ContinueImport());</span>
<a href="#l29.8"></a><span id="l29.8">     // if the import isn't done, check again in 200 milliseconds.</span>
<a href="#l29.9"></a><span id="l29.9">     if (this.mAbInterface.GetProgress() != 100) {</span>
<a href="#l29.10"></a><span id="l29.10">       // use the helper object to check the progress of the import after 200 ms</span>
<a href="#l29.11"></a><span id="l29.11">       gAbImportHelper = this;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-      do_timeout(200, &quot;gAbImportHelper.checkProgress();&quot;);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+      do_timeout(200, function(){gAbImportHelper.checkProgress();});</span>
<a href="#l29.14"></a><span id="l29.14">     }</span>
<a href="#l29.15"></a><span id="l29.15">     // if it is done, check the results or finish the test.</span>
<a href="#l29.16"></a><span id="l29.16">     else</span>
<a href="#l29.17"></a><span id="l29.17">     {</span>
<a href="#l29.18"></a><span id="l29.18">       if (this.mAbName)</span>
<a href="#l29.19"></a><span id="l29.19">         this.checkResults(this.mAbName);</span>
<a href="#l29.20"></a><span id="l29.20">       else</span>
<a href="#l29.21"></a><span id="l29.21">         do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -43,17 +43,17 @@ var urlListener =</span>
<a href="#l30.4"></a><span id="l30.4">       var thread = gThreadManager.currentThread;</span>
<a href="#l30.5"></a><span id="l30.5">       while (thread.hasPendingEvents())</span>
<a href="#l30.6"></a><span id="l30.6">         thread.processNextEvent(true);</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">       do_throw(e);</span>
<a href="#l30.9"></a><span id="l30.9">     }</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">     // Let OnStopRunningUrl return cleanly before doing anything else.</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    do_timeout(0, &quot;checkBusy();&quot;);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+    do_timeout(0, checkBusy);</span>
<a href="#l30.14"></a><span id="l30.14">   }</span>
<a href="#l30.15"></a><span id="l30.15"> };</span>
<a href="#l30.16"></a><span id="l30.16"> </span>
<a href="#l30.17"></a><span id="l30.17"> function checkBusy() {</span>
<a href="#l30.18"></a><span id="l30.18">   if (tests.length == 0) {</span>
<a href="#l30.19"></a><span id="l30.19">     incomingServer.closeCachedConnections();</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21">     // No more tests, let everything finish</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -66,17 +66,17 @@ function checkBusy() {</span>
<a href="#l30.23"></a><span id="l30.23">     do_test_finished();</span>
<a href="#l30.24"></a><span id="l30.24">     return;</span>
<a href="#l30.25"></a><span id="l30.25">   }</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27">   // If the server hasn't quite finished, just delay a little longer.</span>
<a href="#l30.28"></a><span id="l30.28">   if (incomingServer.serverBusy ||</span>
<a href="#l30.29"></a><span id="l30.29">       (incomingServer instanceof Ci.nsIPop3IncomingServer &amp;&amp;</span>
<a href="#l30.30"></a><span id="l30.30">        incomingServer.runningProtocol)) {</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-    do_timeout(20, &quot;checkBusy();&quot;);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+    do_timeout(20, checkBusy);</span>
<a href="#l30.33"></a><span id="l30.33">     return;</span>
<a href="#l30.34"></a><span id="l30.34">   }</span>
<a href="#l30.35"></a><span id="l30.35"> </span>
<a href="#l30.36"></a><span id="l30.36">   testNext();</span>
<a href="#l30.37"></a><span id="l30.37"> }</span>
<a href="#l30.38"></a><span id="l30.38"> </span>
<a href="#l30.39"></a><span id="l30.39"> function testNext() {</span>
<a href="#l30.40"></a><span id="l30.40">   thisTest = tests.shift();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -48,17 +48,17 @@ var urlListener =</span>
<a href="#l31.4"></a><span id="l31.4">       var thread = gThreadManager.currentThread;</span>
<a href="#l31.5"></a><span id="l31.5">       while (thread.hasPendingEvents())</span>
<a href="#l31.6"></a><span id="l31.6">         thread.processNextEvent(true);</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8">       do_throw(e);</span>
<a href="#l31.9"></a><span id="l31.9">     }</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11">     // Let OnStopRunningUrl return cleanly before doing anything else.</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    do_timeout(0, &quot;checkBusy();&quot;);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+    do_timeout(0, checkBusy);</span>
<a href="#l31.14"></a><span id="l31.14">   }</span>
<a href="#l31.15"></a><span id="l31.15"> };</span>
<a href="#l31.16"></a><span id="l31.16"> </span>
<a href="#l31.17"></a><span id="l31.17"> function checkBusy() {</span>
<a href="#l31.18"></a><span id="l31.18">   if (tests.length == 0) {</span>
<a href="#l31.19"></a><span id="l31.19">     incomingServer.closeCachedConnections();</span>
<a href="#l31.20"></a><span id="l31.20"> </span>
<a href="#l31.21"></a><span id="l31.21">     // No more tests, let everything finish</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -71,17 +71,17 @@ function checkBusy() {</span>
<a href="#l31.23"></a><span id="l31.23">     do_test_finished();</span>
<a href="#l31.24"></a><span id="l31.24">     return;</span>
<a href="#l31.25"></a><span id="l31.25">   }</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">   // If the server hasn't quite finished, just delay a little longer.</span>
<a href="#l31.28"></a><span id="l31.28">   if (incomingServer.serverBusy ||</span>
<a href="#l31.29"></a><span id="l31.29">       (incomingServer instanceof Ci.nsIPop3IncomingServer &amp;&amp;</span>
<a href="#l31.30"></a><span id="l31.30">        incomingServer.runningProtocol)) {</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-    do_timeout(20, &quot;checkBusy();&quot;);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+    do_timeout(20, checkBusy);</span>
<a href="#l31.33"></a><span id="l31.33">     return;</span>
<a href="#l31.34"></a><span id="l31.34">   }</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36">   testNext();</span>
<a href="#l31.37"></a><span id="l31.37"> }</span>
<a href="#l31.38"></a><span id="l31.38"> </span>
<a href="#l31.39"></a><span id="l31.39"> function testNext() {</span>
<a href="#l31.40"></a><span id="l31.40">   thisTest = tests.shift();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -42,17 +42,17 @@ var urlListener =</span>
<a href="#l32.4"></a><span id="l32.4">       var thread = gThreadManager.currentThread;</span>
<a href="#l32.5"></a><span id="l32.5">       while (thread.hasPendingEvents())</span>
<a href="#l32.6"></a><span id="l32.6">         thread.processNextEvent(true);</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8">       do_throw(e);</span>
<a href="#l32.9"></a><span id="l32.9">     }</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11">     // Let OnStopRunningUrl return cleanly before doing anything else.</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    do_timeout(0, &quot;checkBusy();&quot;);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    do_timeout(0, checkBusy);</span>
<a href="#l32.14"></a><span id="l32.14">   }</span>
<a href="#l32.15"></a><span id="l32.15"> };</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17"> function checkBusy() {</span>
<a href="#l32.18"></a><span id="l32.18">   if (tests.length == 0) {</span>
<a href="#l32.19"></a><span id="l32.19">     incomingServer.closeCachedConnections();</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21">     // No more tests, let everything finish</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -65,17 +65,17 @@ function checkBusy() {</span>
<a href="#l32.23"></a><span id="l32.23">     do_test_finished();</span>
<a href="#l32.24"></a><span id="l32.24">     return;</span>
<a href="#l32.25"></a><span id="l32.25">   }</span>
<a href="#l32.26"></a><span id="l32.26"> </span>
<a href="#l32.27"></a><span id="l32.27">   // If the server hasn't quite finished, just delay a little longer.</span>
<a href="#l32.28"></a><span id="l32.28">   if (incomingServer.serverBusy ||</span>
<a href="#l32.29"></a><span id="l32.29">       (incomingServer instanceof Ci.nsIPop3IncomingServer &amp;&amp;</span>
<a href="#l32.30"></a><span id="l32.30">        incomingServer.runningProtocol)) {</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-    do_timeout(20, &quot;checkBusy();&quot;);</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+    do_timeout(20, checkBusy);</span>
<a href="#l32.33"></a><span id="l32.33">     return;</span>
<a href="#l32.34"></a><span id="l32.34">   }</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36">   testNext();</span>
<a href="#l32.37"></a><span id="l32.37"> }</span>
<a href="#l32.38"></a><span id="l32.38"> </span>
<a href="#l32.39"></a><span id="l32.39"> function testNext() {</span>
<a href="#l32.40"></a><span id="l32.40">   thisTest = tests.shift();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -44,17 +44,17 @@ var urlListener =</span>
<a href="#l33.4"></a><span id="l33.4">       var thread = gThreadManager.currentThread;</span>
<a href="#l33.5"></a><span id="l33.5">       while (thread.hasPendingEvents())</span>
<a href="#l33.6"></a><span id="l33.6">         thread.processNextEvent(true);</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8">       do_throw(e);</span>
<a href="#l33.9"></a><span id="l33.9">     }</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">     // Let OnStopRunningUrl return cleanly before doing anything else.</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    do_timeout(0, &quot;checkBusy();&quot;);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    do_timeout(0, checkBusy);</span>
<a href="#l33.14"></a><span id="l33.14">   }</span>
<a href="#l33.15"></a><span id="l33.15"> };</span>
<a href="#l33.16"></a><span id="l33.16"> </span>
<a href="#l33.17"></a><span id="l33.17"> function checkBusy() {</span>
<a href="#l33.18"></a><span id="l33.18">   if (tests.length == 0) {</span>
<a href="#l33.19"></a><span id="l33.19">     incomingServer.closeCachedConnections();</span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21">     // No more tests, let everything finish</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -67,17 +67,17 @@ function checkBusy() {</span>
<a href="#l33.23"></a><span id="l33.23">     do_test_finished();</span>
<a href="#l33.24"></a><span id="l33.24">     return;</span>
<a href="#l33.25"></a><span id="l33.25">   }</span>
<a href="#l33.26"></a><span id="l33.26"> </span>
<a href="#l33.27"></a><span id="l33.27">   // If the server hasn't quite finished, just delay a little longer.</span>
<a href="#l33.28"></a><span id="l33.28">   if (incomingServer.serverBusy ||</span>
<a href="#l33.29"></a><span id="l33.29">       (incomingServer instanceof Ci.nsIPop3IncomingServer &amp;&amp;</span>
<a href="#l33.30"></a><span id="l33.30">        incomingServer.runningProtocol)) {</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-    do_timeout(20, &quot;checkBusy();&quot;);</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+    do_timeout(20, checkBusy);</span>
<a href="#l33.33"></a><span id="l33.33">     return;</span>
<a href="#l33.34"></a><span id="l33.34">   }</span>
<a href="#l33.35"></a><span id="l33.35"> </span>
<a href="#l33.36"></a><span id="l33.36">   testNext();</span>
<a href="#l33.37"></a><span id="l33.37"> }</span>
<a href="#l33.38"></a><span id="l33.38"> </span>
<a href="#l33.39"></a><span id="l33.39"> function testNext() {</span>
<a href="#l33.40"></a><span id="l33.40">   thisTest = tests.shift();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -11,17 +11,17 @@ function run_test()</span>
<a href="#l34.4"></a><span id="l34.4"> {</span>
<a href="#l34.5"></a><span id="l34.5">   // demonstration of access to the local inbox folder</span>
<a href="#l34.6"></a><span id="l34.6">   dump(&quot;local inbox folder &quot; + gLocalInboxFolder.URI + &quot; is loaded\n&quot;);</span>
<a href="#l34.7"></a><span id="l34.7">   // demonstration of access to the fake server</span>
<a href="#l34.8"></a><span id="l34.8">   dump(&quot;Server &quot; + gPOP3Pump.fakeServer.prettyName + &quot; is loaded\n&quot;);</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">   gPOP3Pump.files = [&quot;../../mailnews/data/bugmail1&quot;,</span>
<a href="#l34.11"></a><span id="l34.11">                       &quot;../../mailnews/data/draft1&quot;];</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  gPOP3Pump.onDone = &quot;continueTest();&quot;;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  gPOP3Pump.onDone = continueTest;</span>
<a href="#l34.14"></a><span id="l34.14">   do_test_pending();</span>
<a href="#l34.15"></a><span id="l34.15">   gPOP3Pump.run();</span>
<a href="#l34.16"></a><span id="l34.16"> }</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18"> function continueTest()</span>
<a href="#l34.19"></a><span id="l34.19"> {</span>
<a href="#l34.20"></a><span id="l34.20">   // get message headers for the inbox folder</span>
<a href="#l34.21"></a><span id="l34.21">   let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/news/test/unit/test_getNewsMessage.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_getNewsMessage.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -33,17 +33,17 @@ var streamListener =</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5">     // Reduce any \r\n to just \n so we can do a good comparison on any</span>
<a href="#l35.6"></a><span id="l35.6">     // platform.</span>
<a href="#l35.7"></a><span id="l35.7">     var reduced = this._data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l35.8"></a><span id="l35.8">     do_check_eq(reduced, kSimpleNewsArticle);</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">     // We must finish closing connections and tidying up after a timeout</span>
<a href="#l35.11"></a><span id="l35.11">     // so that the thread has time to unwrap itself.</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    do_timeout(0, &quot;doTestFinished();&quot;);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    do_timeout(0, doTestFinished);</span>
<a href="#l35.14"></a><span id="l35.14">   },</span>
<a href="#l35.15"></a><span id="l35.15"> </span>
<a href="#l35.16"></a><span id="l35.16">   // nsIStreamListener</span>
<a href="#l35.17"></a><span id="l35.17">   onDataAvailable: function(aRequest, aContext, aInputStream, aOffset, aCount) {</span>
<a href="#l35.18"></a><span id="l35.18">     let scriptStream = Cc[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l35.19"></a><span id="l35.19">                          .createInstance(Ci.nsIScriptableInputStream);</span>
<a href="#l35.20"></a><span id="l35.20"> </span>
<a href="#l35.21"></a><span id="l35.21">     scriptStream.init(aInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/test/resources/POP3pump.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/test/resources/POP3pump.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -57,17 +57,17 @@ POP3Pump.prototype._urlListener =</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5">       var thread = gThreadManager.currentThread;</span>
<a href="#l36.6"></a><span id="l36.6">       while (thread.hasPendingEvents())</span>
<a href="#l36.7"></a><span id="l36.7">         thread.processNextEvent(true);</span>
<a href="#l36.8"></a><span id="l36.8">       do_throw(e);</span>
<a href="#l36.9"></a><span id="l36.9">     }</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">     // Let OnStopRunningUrl return cleanly before doing anything else.</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    do_timeout(0, &quot;gPOP3Pump._checkBusy();&quot;);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+    do_timeout(0, _checkPumpBusy);</span>
<a href="#l36.14"></a><span id="l36.14">   }</span>
<a href="#l36.15"></a><span id="l36.15"> };</span>
<a href="#l36.16"></a><span id="l36.16"> </span>
<a href="#l36.17"></a><span id="l36.17"> // Setup the daemon and server</span>
<a href="#l36.18"></a><span id="l36.18"> // If the debugOption is set, then it will be applied to the server.</span>
<a href="#l36.19"></a><span id="l36.19"> POP3Pump.prototype._setupServerDaemon = function _setupServerDaemon(aDebugOption)</span>
<a href="#l36.20"></a><span id="l36.20"> {</span>
<a href="#l36.21"></a><span id="l36.21">   this._daemon = new pop3Daemon();</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -102,39 +102,39 @@ POP3Pump.prototype._checkBusy = function</span>
<a href="#l36.23"></a><span id="l36.23"> {</span>
<a href="#l36.24"></a><span id="l36.24">   if (this._tests.length == 0 &amp;&amp; !this._finalCleanup)</span>
<a href="#l36.25"></a><span id="l36.25">   {</span>
<a href="#l36.26"></a><span id="l36.26">     this._incomingServer.closeCachedConnections();</span>
<a href="#l36.27"></a><span id="l36.27"> </span>
<a href="#l36.28"></a><span id="l36.28">     // No more tests, let everything finish</span>
<a href="#l36.29"></a><span id="l36.29">     this._server.stop();</span>
<a href="#l36.30"></a><span id="l36.30">     this._finalCleanup = true;</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-    do_timeout(20, &quot;gPOP3Pump._checkBusy();&quot;);</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+    do_timeout(20, _checkPumpBusy);</span>
<a href="#l36.33"></a><span id="l36.33">     return;</span>
<a href="#l36.34"></a><span id="l36.34">   }</span>
<a href="#l36.35"></a><span id="l36.35"> </span>
<a href="#l36.36"></a><span id="l36.36">   if (this._finalCleanup)</span>
<a href="#l36.37"></a><span id="l36.37">   {</span>
<a href="#l36.38"></a><span id="l36.38">     if (gThreadManager.currentThread.hasPendingEvents())</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-      do_timeout(20, &quot;gPOP3Pump._checkBusy();&quot;);</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineplus">+      do_timeout(20, _checkPumpBusy);</span>
<a href="#l36.41"></a><span id="l36.41">     else</span>
<a href="#l36.42"></a><span id="l36.42">     {</span>
<a href="#l36.43"></a><span id="l36.43">       // exit this module</span>
<a href="#l36.44"></a><span id="l36.44">       do_test_finished();</span>
<a href="#l36.45"></a><span id="l36.45">       do_timeout(0, this.onDone);</span>
<a href="#l36.46"></a><span id="l36.46">     }</span>
<a href="#l36.47"></a><span id="l36.47">     return;</span>
<a href="#l36.48"></a><span id="l36.48">   }</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50">   // If the server hasn't quite finished, just delay a little longer.</span>
<a href="#l36.51"></a><span id="l36.51">   if (this._incomingServer.serverBusy ||</span>
<a href="#l36.52"></a><span id="l36.52">       (this._incomingServer instanceof Ci.nsIPop3IncomingServer &amp;&amp;</span>
<a href="#l36.53"></a><span id="l36.53">        this._incomingServer.runningProtocol))</span>
<a href="#l36.54"></a><span id="l36.54">   {</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineminus">-    do_timeout(20, &quot;gPOP3Pump._checkBusy();&quot;);</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineplus">+    do_timeout(20, _checkPumpBusy);</span>
<a href="#l36.57"></a><span id="l36.57">     return;</span>
<a href="#l36.58"></a><span id="l36.58">   }</span>
<a href="#l36.59"></a><span id="l36.59"> </span>
<a href="#l36.60"></a><span id="l36.60">   this._testNext();</span>
<a href="#l36.61"></a><span id="l36.61"> };</span>
<a href="#l36.62"></a><span id="l36.62"> </span>
<a href="#l36.63"></a><span id="l36.63"> POP3Pump.prototype._testNext = function _testNext()</span>
<a href="#l36.64"></a><span id="l36.64"> {</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineat">@@ -209,8 +209,10 @@ POP3Pump.prototype.run = function run()</span>
<a href="#l36.66"></a><span id="l36.66"> </span>
<a href="#l36.67"></a><span id="l36.67">   this._pop3Service = Cc[&quot;@mozilla.org/messenger/popservice;1&quot;]</span>
<a href="#l36.68"></a><span id="l36.68">                         .getService(Ci.nsIPop3Service);</span>
<a href="#l36.69"></a><span id="l36.69">   this._testNext();</span>
<a href="#l36.70"></a><span id="l36.70"> };</span>
<a href="#l36.71"></a><span id="l36.71"> </span>
<a href="#l36.72"></a><span id="l36.72"> gPOP3Pump = new POP3Pump();</span>
<a href="#l36.73"></a><span id="l36.73"> gPOP3Pump._incomingServer = gPOP3Pump._createPop3ServerAndLocalFolders();</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineplus">+</span>
<a href="#l36.75"></a><span id="l36.75" class="difflineplus">+function _checkPumpBusy() { gPOP3Pump._checkBusy(); }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/test/resources/asyncTestUtils.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/test/resources/asyncTestUtils.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -227,17 +227,17 @@ function parameterizeTest(aTestFunc, aPa</span>
<a href="#l37.4"></a><span id="l37.4"> }</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6"> DEFAULT_LONGEST_TEST_RUN_CONCEIVABLE_SECS = 600;</span>
<a href="#l37.7"></a><span id="l37.7"> function async_run_tests(aTests, aLongestTestRunTimeConceivableInSecs) {</span>
<a href="#l37.8"></a><span id="l37.8">   if (aLongestTestRunTimeConceivableInSecs == null)</span>
<a href="#l37.9"></a><span id="l37.9">     aLongestTestRunTimeConceivableInSecs =</span>
<a href="#l37.10"></a><span id="l37.10">         DEFAULT_LONGEST_TEST_RUN_CONCEIVABLE_SECS;</span>
<a href="#l37.11"></a><span id="l37.11">   do_timeout(aLongestTestRunTimeConceivableInSecs * 1000,</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-      &quot;_async_test_runner_timeout();&quot;);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+      _async_test_runner_timeout);</span>
<a href="#l37.14"></a><span id="l37.14"> </span>
<a href="#l37.15"></a><span id="l37.15">   do_test_pending();</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17">   async_run({func: _async_test_runner, args: [aTests]});</span>
<a href="#l37.18"></a><span id="l37.18"> }</span>
<a href="#l37.19"></a><span id="l37.19"> </span>
<a href="#l37.20"></a><span id="l37.20"> function _async_test_runner(aTests) {</span>
<a href="#l37.21"></a><span id="l37.21">   for each (let [, test] in Iterator(aTests)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/test/resources/msgFolderListenerSetup.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/test/resources/msgFolderListenerSetup.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -209,17 +209,17 @@ var copyListener =</span>
<a href="#l38.4"></a><span id="l38.4"> function resetStatusAndProceed()</span>
<a href="#l38.5"></a><span id="l38.5"> {</span>
<a href="#l38.6"></a><span id="l38.6">   gHdrsReceived.length = 0;</span>
<a href="#l38.7"></a><span id="l38.7">   gCurrStatus = 0;</span>
<a href="#l38.8"></a><span id="l38.8">   // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l38.9"></a><span id="l38.9">   // This can happen with a bunch of synchronous functions grouped together, and</span>
<a href="#l38.10"></a><span id="l38.10">   // can even cause tests to fail because they're still waiting for the listener</span>
<a href="#l38.11"></a><span id="l38.11">   // to return</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  do_timeout(0, &quot;doTest(++gTest)&quot;);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  do_timeout(0, function(){doTest(++gTest);});</span>
<a href="#l38.14"></a><span id="l38.14"> }</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16"> // Checks whether the array returned from a function has exactly these elements.</span>
<a href="#l38.17"></a><span id="l38.17"> function hasExactlyElements(array, elements)</span>
<a href="#l38.18"></a><span id="l38.18"> {</span>
<a href="#l38.19"></a><span id="l38.19">   // If an nsIArray (it could also be a single header or a folder)</span>
<a href="#l38.20"></a><span id="l38.20">   if (elements instanceof nsIArray)</span>
<a href="#l38.21"></a><span id="l38.21">   {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

