<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 14489:a1765b4e2e9170c2e4b17903739f5304fdd69375</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a1765b4e2e9170c2e4b17903739f5304fdd69375" />
<meta property="og:url" content="/comm-central/rev/a1765b4e2e9170c2e4b17903739f5304fdd69375" />
<meta property="og:description" content="Bug 953475 - Command-W Does Not Close Buddy List Window." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a1765b4e2e9170c2e4b17903739f5304fdd69375 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a1765b4e2e9170c2e4b17903739f5304fdd69375">shortlog</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a1765b4e2e9170c2e4b17903739f5304fdd69375">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375">files</a> |
changeset |
<a href="/comm-central/raw-rev/a1765b4e2e9170c2e4b17903739f5304fdd69375">raw</a>  | <a href="/comm-central/archive/a1765b4e2e9170c2e4b17903739f5304fdd69375.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=953475">Bug 953475</a> - Command-W Does Not Close Buddy List Window.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#232;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#105;&#110;&#115;&#116;&#97;&#110;&#116;&#98;&#105;&#114;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 17 Mar 2011 17:42:56 +0100</td></tr>

<tr>
 <td>changeset 14489</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a1765b4e2e9170c2e4b17903739f5304fdd69375">a1765b4e2e9170c2e4b17903739f5304fdd69375</a></td>
</tr>



<tr>
<td>parent 14488</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b1ba8f8385de5ef0b7734bcf5f58d1a39b221b8d">b1ba8f8385de5ef0b7734bcf5f58d1a39b221b8d</a>
</td>
</tr>

<tr>
<td>child 14490</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b1334d8d641a8c757f3877a3e8d501951c447058">b1334d8d641a8c757f3877a3e8d501951c447058</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a1765b4e2e9170c2e4b17903739f5304fdd69375">9778</a></td></tr>
<tr><td>push user</td><td>florian@queze.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 Jan 2014 18:25:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f81a23bfefcd [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f81a23bfefcd0f6ec6215fbde12f8af2bc7749f1&newProject=comm-central&newRevision=279a7aa9624ffb41326b021ff7d8bc68b9b89551&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=953475">953475</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=953475">Bug 953475</a> - Command-W Does Not Close Buddy List Window.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/app/profile/all-instantbird.js">im/app/profile/all-instantbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/app/profile/all-instantbird.js">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/app/profile/all-instantbird.js">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/app/profile/all-instantbird.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/app/profile/all-instantbird.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/app/profile/all-instantbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/Makefile.in">im/components/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/Makefile.in">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/Makefile.in">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/Makefile.in">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/Makefile.in">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.js">im/components/autoLoginHandler.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.manifest">im/components/autoLoginHandler.manifest</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.manifest">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.manifest">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/autoLoginHandler.manifest">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.js">im/components/ibCommandLineHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.js">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.js">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.manifest">im/components/ibCommandLineHandler.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.manifest">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.manifest">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.manifest">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.manifest">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/ibCommandLineHandler.manifest">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/logger.js">im/components/logger.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/logger.js">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/logger.js">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/logger.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/logger.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/components/logger.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.js">im/content/blist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.js">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.js">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.xul">im/content/blist.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.xul">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.xul">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.xul">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.xul">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/blist.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/contact.xml">im/content/contact.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/contact.xml">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/contact.xml">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/contact.xml">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/contact.xml">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/contact.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/core.js">im/content/core.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/core.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/core.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/core.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/debug/debug.js">im/content/debug/debug.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/debug/debug.js">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/debug/debug.js">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/debug/debug.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/debug/debug.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/debug/debug.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/hiddenWindow.xul">im/content/hiddenWindow.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/hiddenWindow.xul">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/hiddenWindow.xul">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/hiddenWindow.xul">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/hiddenWindow.xul">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/hiddenWindow.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/jar.mn">im/content/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/jar.mn">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/jar.mn">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/jar.mn">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/jar.mn">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus-mac.xul">im/content/menus-mac.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus-mac.xul">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus-mac.xul">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus-mac.xul">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus-mac.xul">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus-mac.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus.js">im/content/menus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus.js">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus.js">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus.js">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus.js">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/content/menus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/installer/package-manifest.in">im/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/locales/en-US/chrome/instantbird/instantbird.dtd">im/locales/en-US/chrome/instantbird/instantbird.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/locales/en-US/chrome/instantbird/instantbird.dtd">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/locales/en-US/chrome/instantbird/instantbird.dtd">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/locales/en-US/chrome/instantbird/instantbird.dtd">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/locales/en-US/chrome/instantbird/instantbird.dtd">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/locales/en-US/chrome/instantbird/instantbird.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/Makefile.in">im/modules/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/Makefile.in">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/Makefile.in">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/Makefile.in">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/Makefile.in">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/ibCore.jsm">im/modules/ibCore.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/ibCore.jsm">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/ibCore.jsm">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/ibCore.jsm">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/ibCore.jsm">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/ibCore.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/imWindows.jsm">im/modules/imWindows.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/imWindows.jsm">file</a> |
<a href="/comm-central/annotate/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/imWindows.jsm">annotate</a> |
<a href="/comm-central/diff/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/imWindows.jsm">diff</a> |
<a href="/comm-central/comparison/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/imWindows.jsm">comparison</a> |
<a href="/comm-central/log/a1765b4e2e9170c2e4b17903739f5304fdd69375/im/modules/imWindows.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/app/profile/all-instantbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/app/profile/all-instantbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,10 +1,13 @@</span>
<a href="#l1.4"></a><span id="l1.4"> pref(&quot;toolkit.defaultChromeURI&quot;, &quot;chrome://instantbird/content/blist.xul&quot;);</span>
<a href="#l1.5"></a><span id="l1.5"> pref(&quot;toolkit.singletonWindowType&quot;, &quot;Messenger:blist&quot;);</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineplus">+pref(&quot;browser.hiddenWindowChromeURL&quot;, &quot;chrome://instantbird/content/hiddenWindow.xul&quot;);</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+#endif</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> #expand pref(&quot;general.useragent.extra.instantbird&quot;, &quot;Instantbird/__APP_VERSION__&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12"> #ifdef XP_UNIX</span>
<a href="#l1.13"></a><span id="l1.13"> #ifndef XP_MACOSX</span>
<a href="#l1.14"></a><span id="l1.14"> #define UNIX_BUT_NOT_MAC</span>
<a href="#l1.15"></a><span id="l1.15"> #endif</span>
<a href="#l1.16"></a><span id="l1.16"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/components/Makefile.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/components/Makefile.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -41,20 +41,23 @@ VPATH		= @srcdir@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> MODULE		= instantbird</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> XPIDLSRCS	= ibILogger.idl</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> EXTRA_COMPONENTS = \</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+	ibCommandLineHandler.manifest \</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+	logger.manifest \</span>
<a href="#l2.14"></a><span id="l2.14"> 	smileProtocolHandler.js smileProtocolHandler.manifest \</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-	autoLoginHandler.js autoLoginHandler.manifest \</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-	logger.manifest \</span>
<a href="#l2.17"></a><span id="l2.17"> 	$(NULL)</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19" class="difflineminus">-EXTRA_PP_COMPONENTS = logger.js</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+EXTRA_PP_COMPONENTS = \</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+	ibCommandLineHandler.js \</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+	logger.js \</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+	$(NULL)</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> ifeq (,$(filter mac cocoa,$(MOZ_WIDGET_TOOLKIT)))</span>
<a href="#l2.26"></a><span id="l2.26"> EXTRA_COMPONENTS += profileMigrator.js profileMigrator.manifest</span>
<a href="#l2.27"></a><span id="l2.27"> endif</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29"> include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">rename from im/components/autoLoginHandler.js</span>
<a href="#l3.2"></a><span id="l3.2">rename to im/components/ibCommandLineHandler.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineminus">--- a/im/components/autoLoginHandler.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineplus">+++ b/im/components/ibCommandLineHandler.js</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineat">@@ -31,44 +31,69 @@</span>
<a href="#l3.6"></a><span id="l3.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.7"></a><span id="l3.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.8"></a><span id="l3.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.9"></a><span id="l3.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.10"></a><span id="l3.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.11"></a><span id="l3.11">  *</span>
<a href="#l3.12"></a><span id="l3.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-const Cc = Components.classes;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-const Ci = Components.interfaces;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+const {classes: Cc, interfaces: Ci, utils: Cu} = Components;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+Cu.import(&quot;resource:///modules/ibCore.jsm&quot;);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-function autoLoginHandler() { }</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+function ibCommandLineHandler() { }</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-autoLoginHandler.prototype = {</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+ibCommandLineHandler.prototype = {</span>
<a href="#l3.26"></a><span id="l3.26">   handle: function clh_handle(cmdLine) {</span>
<a href="#l3.27"></a><span id="l3.27">     if (cmdLine.handleFlag(&quot;preferences&quot;, false)) {</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-      var features = &quot;chrome,titlebar,toolbar,centerscreen,dialog=no&quot;;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-      var url = &quot;chrome://instantbird/content/preferences/preferences.xul&quot;;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-      Components.classes[&quot;@mozilla.org/embedcomp/window-watcher;1&quot;]</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-                .getService(Components.interfaces.nsIWindowWatcher)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-                .openWindow(null, url, &quot;_blank&quot;, features, null);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+      Core.showPreferences();</span>
<a href="#l3.34"></a><span id="l3.34">       cmdLine.preventDefault = true;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+      return;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+    }</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+    if (cmdLine.handleFlag(&quot;n&quot;, false)) {</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+      Components.classes[&quot;@instantbird.org/purple/core;1&quot;]</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+                .getService(Ci.purpleICoreService)</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+                .autoLoginStatus = Ci.purpleICoreService.AUTOLOGIN_USER_DISABLED;</span>
<a href="#l3.42"></a><span id="l3.42">     }</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-    if (!cmdLine.handleFlag(&quot;n&quot;, false))</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-      return;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-    Components.classes[&quot;@instantbird.org/purple/core;1&quot;]</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-              .getService(Ci.purpleICoreService)</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-              .autoLoginStatus = Ci.purpleICoreService.AUTOLOGIN_USER_DISABLED;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+    // Initialize the core only at the first real startup,</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+    // not when clicking the dock.</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+    if (cmdLine.state == cmdLine.STATE_INITIAL_LAUNCH) {</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+      // If the core failed to init, don't show the buddy list</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+      if (!Core.init())</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+        cmdLine.preventDefault = true;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+      else {</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+        // If we have no reason to show the account manager and the</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+        // buddy list is not shown because of the -silent flag, we</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+        // should avoid an early exit.</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+        // The code in nsAppStartup::Run won't start the event loop if</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+        // we don't have at least one window or one call to</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+        // enterLastWindowClosingSurvivalArea.</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+        let as = Components.classes[&quot;@mozilla.org/toolkit/app-startup;1&quot;]</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+                           .getService(Ci.nsIAppStartup);</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+        as.enterLastWindowClosingSurvivalArea();</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+        // We can exitLastWindowClosingSurvivalArea as soon as the</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+        // load of our application provided hiddenWindow has begun.</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+        let tm = Components.classes[&quot;@mozilla.org/thread-manager;1&quot;]</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+                           .getService(Components.interfaces.nsIThreadManager);</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+        tm.mainThread.dispatch(function() {</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+          as.exitLastWindowClosingSurvivalArea();</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+        }, tm.DISPATCH_NORMAL);</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+      }</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+#endif</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+    }</span>
<a href="#l3.77"></a><span id="l3.77">   },</span>
<a href="#l3.78"></a><span id="l3.78"> </span>
<a href="#l3.79"></a><span id="l3.79">   // 3 tabs here because there is a misalignment with only 2</span>
<a href="#l3.80"></a><span id="l3.80">   helpInfo: &quot;  -n                 Disables auto-login.\n&quot; +</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-            &quot;  -preferences       Open only the preferences window.&quot;,</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+            &quot;  -preferences       Open only the preferences window.\n&quot; +</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+            &quot;  -silent            Do not open the contacts list.\n&quot;,</span>
<a href="#l3.84"></a><span id="l3.84"> </span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-  classDescription: &quot;AutoLogin Handler&quot;,</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-  classID: Components.ID(&quot;{9e5d5160-d61d-4d57-ae0d-81bee4380269}&quot;),</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-  contractID: &quot;@instantbird.org/autologin-handler;1&quot;,</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+  classDescription: &quot;Instantbird Command Line Handler&quot;,</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+  classID: Components.ID(&quot;{cd6763b7-df9a-4b64-9d06-2b77c755d9c1}&quot;),</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+  contractID: &quot;@instantbird.org/command-line-handler;1&quot;,</span>
<a href="#l3.91"></a><span id="l3.91">   QueryInterface: XPCOMUtils.generateQI([Ci.nsICommandLineHandler])</span>
<a href="#l3.92"></a><span id="l3.92"> };</span>
<a href="#l3.93"></a><span id="l3.93"> </span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-const NSGetFactory = XPCOMUtils.generateNSGetFactory([autoLoginHandler]);</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+const NSGetFactory = XPCOMUtils.generateNSGetFactory([ibCommandLineHandler]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">rename from im/components/autoLoginHandler.manifest</span>
<a href="#l4.2"></a><span id="l4.2">rename to im/components/ibCommandLineHandler.manifest</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineminus">--- a/im/components/autoLoginHandler.manifest</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineplus">+++ b/im/components/ibCommandLineHandler.manifest</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineat">@@ -1,3 +1,3 @@</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-component {9e5d5160-d61d-4d57-ae0d-81bee4380269} autoLoginHandler.js</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">-contract @instantbird.org/autologin-handler;1 {9e5d5160-d61d-4d57-ae0d-81bee4380269}</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">-category command-line-handler b-n @instantbird.org/autologin-handler;1</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+component {cd6763b7-df9a-4b64-9d06-2b77c755d9c1} ibCommandLineHandler.js</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+contract @instantbird.org/command-line-handler;1 {cd6763b7-df9a-4b64-9d06-2b77c755d9c1}</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+category command-line-handler b-n @instantbird.org/command-line-handler;1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/components/logger.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/components/logger.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -128,17 +128,17 @@ ConversationLog.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">            &quot; on &quot; + account.name +</span>
<a href="#l5.5"></a><span id="l5.5">            &quot; (&quot; + account.protocol.normalizedName + &quot;)@LINE_BREAK@&quot;;</span>
<a href="#l5.6"></a><span id="l5.6">   },</span>
<a href="#l5.7"></a><span id="l5.7">   _serialize: function cl_serialize(aString) {</span>
<a href="#l5.8"></a><span id="l5.8">     // TODO cleanup once bug 102699 is fixed</span>
<a href="#l5.9"></a><span id="l5.9">     let doc = Cc[&quot;@mozilla.org/appshell/appShellService;1&quot;]</span>
<a href="#l5.10"></a><span id="l5.10">                .getService(Ci.nsIAppShellService)</span>
<a href="#l5.11"></a><span id="l5.11">                .hiddenDOMWindow.document;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    let div = doc.createElement(&quot;div&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    let div = doc.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;div&quot;);</span>
<a href="#l5.14"></a><span id="l5.14">     div.innerHTML = aString.replace(/\r?\n/g, &quot;&lt;br/&gt;&quot;);</span>
<a href="#l5.15"></a><span id="l5.15">     const type = &quot;text/plain&quot;;</span>
<a href="#l5.16"></a><span id="l5.16">     let encoder =</span>
<a href="#l5.17"></a><span id="l5.17">       Components.classes[&quot;@mozilla.org/layout/documentEncoder;1?type=&quot; + type]</span>
<a href="#l5.18"></a><span id="l5.18">                 .createInstance(Components.interfaces.nsIDocumentEncoder);</span>
<a href="#l5.19"></a><span id="l5.19">     encoder.init(doc, type, 0);</span>
<a href="#l5.20"></a><span id="l5.20">     encoder.setContainerNode(div);</span>
<a href="#l5.21"></a><span id="l5.21">     encoder.setNodeFixup({fixupNode: function(aNode, aSerializeKids) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/content/blist.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/content/blist.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -35,17 +35,16 @@</span>
<a href="#l6.4"></a><span id="l6.4">  *</span>
<a href="#l6.5"></a><span id="l6.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> Components.utils.import(&quot;resource:///modules/imStatusUtils.jsm&quot;);</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> const events = [&quot;contact-availability-changed&quot;,</span>
<a href="#l6.10"></a><span id="l6.10">                 &quot;contact-added&quot;,</span>
<a href="#l6.11"></a><span id="l6.11">                 &quot;contact-moved&quot;,</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                &quot;account-disconnected&quot;,</span>
<a href="#l6.13"></a><span id="l6.13">                 &quot;status-changed&quot;,</span>
<a href="#l6.14"></a><span id="l6.14">                 &quot;purple-quit&quot;];</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16"> const showOfflineBuddiesPref = &quot;messenger.buddies.showOffline&quot;;</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> var gBuddyListContextMenu = null;</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> function buddyListContextMenu(aXulMenu) {</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -230,24 +229,16 @@ var buddyList = {</span>
<a href="#l6.22"></a><span id="l6.22">             blistBox.removeChild(elt);</span>
<a href="#l6.23"></a><span id="l6.23">         }</span>
<a href="#l6.24"></a><span id="l6.24">       });</span>
<a href="#l6.25"></a><span id="l6.25">       return;</span>
<a href="#l6.26"></a><span id="l6.26">     }</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">     if (aTopic == &quot;status-changed&quot;) {</span>
<a href="#l6.29"></a><span id="l6.29">       this.displayCurrentStatus();</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-      this.showAccountManagerIfNeeded(false);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-      return;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    }</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-    if (aTopic == &quot;account-disconnected&quot;) {</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-      let account = aSubject.QueryInterface(Ci.purpleIAccount);</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-      if (account.reconnectAttempt &lt;= 1)</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-        this.showAccountManagerIfNeeded(false);</span>
<a href="#l6.38"></a><span id="l6.38">       return;</span>
<a href="#l6.39"></a><span id="l6.39">     }</span>
<a href="#l6.40"></a><span id="l6.40"> </span>
<a href="#l6.41"></a><span id="l6.41">     // aSubject is an imIContact</span>
<a href="#l6.42"></a><span id="l6.42">     if (aSubject.online || this._showOffline) {</span>
<a href="#l6.43"></a><span id="l6.43">       aSubject.getTags().forEach(function (aTag) {</span>
<a href="#l6.44"></a><span id="l6.44">         if (!document.getElementById(&quot;group&quot; + aTag.id)) {</span>
<a href="#l6.45"></a><span id="l6.45">           let groupElt = document.createElement(&quot;group&quot;);</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineat">@@ -399,97 +390,27 @@ var buddyList = {</span>
<a href="#l6.47"></a><span id="l6.47">     if (elt.hasAttribute(&quot;usingDefault&quot;))</span>
<a href="#l6.48"></a><span id="l6.48">       elt.setAttribute(&quot;value&quot;, elt.getAttribute(&quot;usingDefault&quot;));</span>
<a href="#l6.49"></a><span id="l6.49">     TextboxSpellChecker.unregisterTextbox(elt);</span>
<a href="#l6.50"></a><span id="l6.50">     elt.removeAttribute(&quot;editing&quot;);</span>
<a href="#l6.51"></a><span id="l6.51">     elt.removeEventListener(&quot;keypress&quot;, this.statusMessageKeyPress, false);</span>
<a href="#l6.52"></a><span id="l6.52">     elt.removeEventListener(&quot;blur&quot;, this.statusMessageBlur, false);</span>
<a href="#l6.53"></a><span id="l6.53">   },</span>
<a href="#l6.54"></a><span id="l6.54"> </span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-  getAccounts: function bl_getAccounts() getIter(Services.core.getAccounts()),</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-  /* This function pops up the account manager is no account is</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-   * connected or connecting.</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-   * When called during startup (aIsStarting == true), it will also</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-   * look for crashed accounts.</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-   */</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-  showAccountManagerIfNeeded: function bl_showAccountManagerIfNeeded(aIsStarting) {</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-    // If the current status is offline, we don't need the account manager</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-    let isOffline =</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-      Services.core.currentStatusType == Ci.imIStatusInfo.STATUS_OFFLINE;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-    if (isOffline &amp;&amp; !aIsStarting)</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-      return;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-    let hasActiveAccount = false;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-    let hasCrashedAccount = false;</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-    for (let acc in this.getAccounts()) {</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-      if (acc.connected || acc.connecting)</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-        hasActiveAccount = true;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-      // We only check for crashed accounts on startup.</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-      if (aIsStarting &amp;&amp; acc.autoLogin &amp;&amp;</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-          acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-        hasCrashedAccount = true;</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-    }</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-    /* We only display the account manager on startup if an account has crashed</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-       or if all accounts are disconnected</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-       In case of connection failure after an automatic reconnection attempt,</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-       we don't want to popup the account manager */</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-    if ((!hasActiveAccount &amp;&amp; !isOffline) || (aIsStarting &amp;&amp; hasCrashedAccount))</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-      menus.accounts();</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-  },</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-</span>
<a href="#l6.89"></a><span id="l6.89">   load: function bl_load() {</span>
<a href="#l6.90"></a><span id="l6.90">     var blistWindows = Services.wm.getEnumerator(&quot;Messenger:blist&quot;);</span>
<a href="#l6.91"></a><span id="l6.91">     while (blistWindows.hasMoreElements()) {</span>
<a href="#l6.92"></a><span id="l6.92">       var win = blistWindows.getNext();</span>
<a href="#l6.93"></a><span id="l6.93">       if (win != window) {</span>
<a href="#l6.94"></a><span id="l6.94">         win.QueryInterface(Ci.nsIDOMWindowInternal).focus();</span>
<a href="#l6.95"></a><span id="l6.95">         window.close();</span>
<a href="#l6.96"></a><span id="l6.96">         return;</span>
<a href="#l6.97"></a><span id="l6.97">       }</span>
<a href="#l6.98"></a><span id="l6.98">     }</span>
<a href="#l6.99"></a><span id="l6.99"> </span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-    try {</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-      // Set the Vendor for breakpad only</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-      if (&quot;nsICrashReporter&quot; in Ci) {</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-        Components.classes[&quot;@mozilla.org/xre/app-info;1&quot;]</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-                  .getService(Ci.nsICrashReporter)</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-                  .annotateCrashReport(&quot;Vendor&quot;, &quot;Instantbird&quot;);</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-      }</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-    } catch(e) {</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-      // This can fail if breakpad isn't enabled,</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-      // don't worry too much about this exception.</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-    }</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-    if (!initPurpleCore()) {</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-      window.close();</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-      return;</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-    }</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-    let status = {</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-      back: &quot;AVAILABLE&quot;,</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">-      away: &quot;AWAY&quot;,</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineminus">-      busy: &quot;UNAVAILABLE&quot;,</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-      dnd: &quot;UNAVAILABLE&quot;,</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-      offline: &quot;OFFLINE&quot;</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-    };</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineminus">-    for (let cmd in status) {</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-      let statusValue = Ci.imIStatusInfo[&quot;STATUS_&quot; + status[cmd]];</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-      Services.cmd.registerCommand({</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-        name: cmd,</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-        priority: Ci.imICommand.PRIORITY_HIGH,</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-        run: function(aMsg) {</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-          Services.core.setStatus(statusValue, aMsg);</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-          return true;</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-        }</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-      });</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-    }</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-</span>
<a href="#l6.136"></a><span id="l6.136">     // TODO remove this once we cleanup the way the menus are inserted</span>
<a href="#l6.137"></a><span id="l6.137">     let menubar = document.getElementById(&quot;blistMenubar&quot;);</span>
<a href="#l6.138"></a><span id="l6.138">     let statusArea = document.getElementById(&quot;statusArea&quot;);</span>
<a href="#l6.139"></a><span id="l6.139">     statusArea.parentNode.insertBefore(menubar, statusArea);</span>
<a href="#l6.140"></a><span id="l6.140"> </span>
<a href="#l6.141"></a><span id="l6.141">     buddyList.displayCurrentStatus();</span>
<a href="#l6.142"></a><span id="l6.142"> </span>
<a href="#l6.143"></a><span id="l6.143">     let prefBranch = Services.prefs;</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineat">@@ -508,34 +429,23 @@ var buddyList = {</span>
<a href="#l6.145"></a><span id="l6.145">       if (!groupElt.build(aTag))</span>
<a href="#l6.146"></a><span id="l6.146">         blistBox.removeChild(groupElt);</span>
<a href="#l6.147"></a><span id="l6.147">     });</span>
<a href="#l6.148"></a><span id="l6.148">     blistBox.focus();</span>
<a href="#l6.149"></a><span id="l6.149"> </span>
<a href="#l6.150"></a><span id="l6.150">     prefBranch.addObserver(showOfflineBuddiesPref, buddyList, false);</span>
<a href="#l6.151"></a><span id="l6.151">     addObservers(buddyList, events);</span>
<a href="#l6.152"></a><span id="l6.152"> </span>
<a href="#l6.153"></a><span id="l6.153" class="difflineminus">-    Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineminus">-    Conversations.init();</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-    buddyList.showAccountManagerIfNeeded(true);</span>
<a href="#l6.157"></a><span id="l6.157">     this.addEventListener(&quot;unload&quot;, buddyList.unload, false);</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-    this.addEventListener(&quot;close&quot;, buddyList.close, false);</span>
<a href="#l6.159"></a><span id="l6.159">   },</span>
<a href="#l6.160"></a><span id="l6.160">   unload: function bl_unload() {</span>
<a href="#l6.161"></a><span id="l6.161">     removeObservers(buddyList, events);</span>
<a href="#l6.162"></a><span id="l6.162">     Services.prefs.removeObserver(showOfflineBuddiesPref, buddyList);</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-    uninitPurpleCore();</span>
<a href="#l6.164"></a><span id="l6.164">    },</span>
<a href="#l6.165"></a><span id="l6.165"> </span>
<a href="#l6.166"></a><span id="l6.166" class="difflineminus">-  close: function bl_close(event) {</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-    event.preventDefault();</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-    goQuitApplication();</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineminus">-  },</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineminus">-</span>
<a href="#l6.171"></a><span id="l6.171">   // Handle key pressing</span>
<a href="#l6.172"></a><span id="l6.172">   keyPress: function bl_keyPress(aEvent) {</span>
<a href="#l6.173"></a><span id="l6.173">     var item = document.getElementById(&quot;buddylistbox&quot;).selectedItem;</span>
<a href="#l6.174"></a><span id="l6.174">     if (!item || !item.parentNode) // empty list or item no longer in the list</span>
<a href="#l6.175"></a><span id="l6.175">       return;</span>
<a href="#l6.176"></a><span id="l6.176">     item.keyPress(aEvent);</span>
<a href="#l6.177"></a><span id="l6.177">   }</span>
<a href="#l6.178"></a><span id="l6.178"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/im/content/blist.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/im/content/blist.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -51,24 +51,36 @@</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> &lt;window</span>
<a href="#l7.6"></a><span id="l7.6">   id     = &quot;blistWindow&quot;</span>
<a href="#l7.7"></a><span id="l7.7">   windowtype=&quot;Messenger:blist&quot;</span>
<a href="#l7.8"></a><span id="l7.8">   title  = &quot;&amp;blist.title;&quot;</span>
<a href="#l7.9"></a><span id="l7.9">   width  = &quot;200&quot;</span>
<a href="#l7.10"></a><span id="l7.10">   height = &quot;600&quot;</span>
<a href="#l7.11"></a><span id="l7.11">   persist= &quot;width height screenX screenY&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+#ifndef XP_MACOSX</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  onclose= &quot;event.preventDefault(); goQuitApplication();&quot;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+#endif</span>
<a href="#l7.15"></a><span id="l7.15">   xmlns  = &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l7.16"></a><span id="l7.16">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/utilities.js&quot;/&gt;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/core.js&quot;/&gt;</span>
<a href="#l7.18"></a><span id="l7.18">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/blist.js&quot;/&gt;</span>
<a href="#l7.19"></a><span id="l7.19">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://instantbird/content/sound.js&quot;/&gt;</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21"> #include menus.xul.inc</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  &lt;commandset id=&quot;blistCommands&quot;&gt;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    &lt;command id=&quot;cmd_close&quot; oncommand=&quot;window.close();&quot;/&gt;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+  &lt;/commandset&gt;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+  &lt;keyset id=&quot;blistKeys&quot;&gt;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+    &lt;key id=&quot;key_close&quot; key=&quot;w&quot; modifiers=&quot;accel&quot; command=&quot;cmd_close&quot;/&gt;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+#endif</span>
<a href="#l7.33"></a><span id="l7.33">   &lt;popupset id=&quot;mainPopupSet&quot;&gt;</span>
<a href="#l7.34"></a><span id="l7.34">     &lt;tooltip id=&quot;buddyTooltip&quot; type=&quot;buddy&quot;</span>
<a href="#l7.35"></a><span id="l7.35">              onpopupshowing=&quot;if ('_droptarget' in window) return false;&quot;/&gt;</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">     &lt;menupopup id=&quot;buddyListContextMenu&quot;</span>
<a href="#l7.38"></a><span id="l7.38">                onpopupshowing=&quot;if (event.target != this) return true; gBuddyListContextMenu = new buddyListContextMenu(this); return gBuddyListContextMenu.shouldDisplay;&quot;</span>
<a href="#l7.39"></a><span id="l7.39">                onpopuphiding=&quot;if (event.target == this) { gBuddyListContextMenu = null; }&quot;&gt;</span>
<a href="#l7.40"></a><span id="l7.40">       &lt;menuitem id=&quot;context-openconversation&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/content/contact.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/content/contact.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -307,16 +307,18 @@</span>
<a href="#l8.4"></a><span id="l8.4">          return this.contact.canSendMessage;</span>
<a href="#l8.5"></a><span id="l8.5">        ]]&gt;</span>
<a href="#l8.6"></a><span id="l8.6">       &lt;/body&gt;</span>
<a href="#l8.7"></a><span id="l8.7">      &lt;/method&gt;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">      &lt;method name=&quot;openConversation&quot;&gt;</span>
<a href="#l8.10"></a><span id="l8.10">       &lt;body&gt;</span>
<a href="#l8.11"></a><span id="l8.11">        &lt;![CDATA[</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+         if (!(&quot;Conversations&quot; in window))</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+           Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l8.14"></a><span id="l8.14">          Conversations.focusConversation(this.contact.createConversation());</span>
<a href="#l8.15"></a><span id="l8.15">        ]]&gt;</span>
<a href="#l8.16"></a><span id="l8.16">       &lt;/body&gt;</span>
<a href="#l8.17"></a><span id="l8.17">      &lt;/method&gt;</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">      &lt;method name=&quot;keyPress&quot;&gt;</span>
<a href="#l8.20"></a><span id="l8.20">       &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l8.21"></a><span id="l8.21">       &lt;body&gt;this._keyPress(aEvent);&lt;/body&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/im/content/debug/debug.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/im/content/debug/debug.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -20,18 +20,18 @@ var debug = {</span>
<a href="#l9.4"></a><span id="l9.4">     start_venkman();</span>
<a href="#l9.5"></a><span id="l9.5">   },</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">   inspector: function debug_inspector() {</span>
<a href="#l9.8"></a><span id="l9.8">     inspectDOMDocument(document);</span>
<a href="#l9.9"></a><span id="l9.9">   },</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11">   garbageCollect: function debug_garbageCollect() {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    window.QueryInterface(Ci.nsIInterfaceRequestor)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-          .getInterface(Ci.nsIDOMWindowUtils)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+    window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+          .getInterface(Components.interfaces.nsIDOMWindowUtils)</span>
<a href="#l9.16"></a><span id="l9.16">           .garbageCollect();</span>
<a href="#l9.17"></a><span id="l9.17">   },</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19">   forceOnline: function debug_forceOnline() {</span>
<a href="#l9.20"></a><span id="l9.20">     var ios = Services.io;</span>
<a href="#l9.21"></a><span id="l9.21">     ios.manageOfflineStatus = false;</span>
<a href="#l9.22"></a><span id="l9.22">     ios.offline = false;</span>
<a href="#l9.23"></a><span id="l9.23">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/im/content/hiddenWindow.xul</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,67 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+# -*- Mode: HTML -*-</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+#</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+#</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+# the License. You may obtain a copy of the License at</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+# http://www.mozilla.org/MPL/</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+#</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+# for the specific language governing rights and limitations under the</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+# License.</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+#</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+# The Original Code is Mozilla Communicator client code, released</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+# March 31, 1998.</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+#</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+# The Initial Developer of the Original Code is</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+# Netscape Communications Corporation.</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+# Portions created by the Initial Developer are Copyright (C) 1998-2000</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+# the Initial Developer. All Rights Reserved.</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+#</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+# Contributor(s):</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+#   David Hyatt &lt;hyatt@mozilla.org&gt; (Original Author)</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+#   Asaf Romano &lt;mozilla.mano@sent.com&gt;</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+#   Florian Queze &lt;florian@instantbird.org&gt;</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+#</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+# the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+#</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+# ***** END LICENSE BLOCK *****</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://instantbird/content/menus.xul&quot;?&gt;</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+&lt;window id=&quot;main-window&quot;</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+        xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+#include menus.xul.inc</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+&lt;script type=&quot;application/javascript&quot;&gt;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+  addEventListener(&quot;load&quot;, function() {</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    // disable the minimize and zoom menu items.</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+    [&quot;minimizeWindow&quot;, &quot;zoomWindow&quot;].forEach(function(aId) {</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+      document.getElementById(aId).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+    });</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+    // also hide the window-list separator</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+    document.getElementById(&quot;sep-window-list&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+  }, false);</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+&lt;/script&gt;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+&lt;/window&gt;</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/im/content/jar.mn</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/im/content/jar.mn</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -12,19 +12,18 @@ instantbird.jar:</span>
<a href="#l11.4"></a><span id="l11.4"> 	instantbird/account.xul</span>
<a href="#l11.5"></a><span id="l11.5"> 	instantbird/addbuddy.js</span>
<a href="#l11.6"></a><span id="l11.6"> 	instantbird/addbuddy.xul</span>
<a href="#l11.7"></a><span id="l11.7"> 	instantbird/blist.css</span>
<a href="#l11.8"></a><span id="l11.8"> 	instantbird/blist.js</span>
<a href="#l11.9"></a><span id="l11.9"> *	instantbird/blist.xul</span>
<a href="#l11.10"></a><span id="l11.10"> 	instantbird/buddy.xml</span>
<a href="#l11.11"></a><span id="l11.11"> 	instantbird/buddytooltip.xml</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        instantbird/browserRequest.js</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-        instantbird/browserRequest.xul</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-	instantbird/core.js</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+	instantbird/browserRequest.js</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+	instantbird/browserRequest.xul</span>
<a href="#l11.17"></a><span id="l11.17"> 	instantbird/topicNotification.xml</span>
<a href="#l11.18"></a><span id="l11.18"> 	instantbird/contact.xml</span>
<a href="#l11.19"></a><span id="l11.19"> *	instantbird/conversation.xml</span>
<a href="#l11.20"></a><span id="l11.20"> 	instantbird/convbrowser.xml</span>
<a href="#l11.21"></a><span id="l11.21"> 	instantbird/conv.html</span>
<a href="#l11.22"></a><span id="l11.22"> *	instantbird/credits.xhtml</span>
<a href="#l11.23"></a><span id="l11.23"> *	instantbird/engineManager.js</span>
<a href="#l11.24"></a><span id="l11.24"> *	instantbird/engineManager.xul</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineat">@@ -45,16 +44,17 @@ instantbird.jar:</span>
<a href="#l11.26"></a><span id="l11.26"> 	instantbird/sound.js</span>
<a href="#l11.27"></a><span id="l11.27"> *	instantbird/tabbrowser.xml</span>
<a href="#l11.28"></a><span id="l11.28"> 	instantbird/tabbrowser.css</span>
<a href="#l11.29"></a><span id="l11.29"> 	instantbird/utilities.js</span>
<a href="#l11.30"></a><span id="l11.30"> *	instantbird/viewlog.xul</span>
<a href="#l11.31"></a><span id="l11.31"> 	instantbird/viewlog.js</span>
<a href="#l11.32"></a><span id="l11.32"> 	instantbird/viewlog.css</span>
<a href="#l11.33"></a><span id="l11.33"> #ifdef XP_MACOSX</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+*	instantbird/hiddenWindow.xul</span>
<a href="#l11.35"></a><span id="l11.35"> 	instantbird/menus-mac.xul</span>
<a href="#l11.36"></a><span id="l11.36"> 	instantbird/macgestures.js</span>
<a href="#l11.37"></a><span id="l11.37"> #elifdef XP_WIN</span>
<a href="#l11.38"></a><span id="l11.38"> 	instantbird/menus-win.xul</span>
<a href="#l11.39"></a><span id="l11.39"> #else</span>
<a href="#l11.40"></a><span id="l11.40"> 	instantbird/menus-unix.xul</span>
<a href="#l11.41"></a><span id="l11.41"> #endif</span>
<a href="#l11.42"></a><span id="l11.42"> *	instantbird/preferences/advanced.xul            (preferences/advanced.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/im/content/menus-mac.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/im/content/menus-mac.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -40,16 +40,29 @@</span>
<a href="#l12.4"></a><span id="l12.4">   &lt;!ENTITY % instantbirdDTD SYSTEM &quot;chrome://instantbird/locale/instantbird.dtd&quot;&gt;</span>
<a href="#l12.5"></a><span id="l12.5">   %instantbirdDTD;</span>
<a href="#l12.6"></a><span id="l12.6">   &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot;&gt;</span>
<a href="#l12.7"></a><span id="l12.7">   %brandDTD;</span>
<a href="#l12.8"></a><span id="l12.8"> ]&gt;</span>
<a href="#l12.9"></a><span id="l12.9"> &lt;overlay id=&quot;menusOverlayMac&quot;</span>
<a href="#l12.10"></a><span id="l12.10">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  &lt;commandset id=&quot;maincommandset&quot;&gt;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    &lt;command id=&quot;cmd_contacts&quot;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+             oncommand=&quot;if (window.location.href == 'chrome://instantbird/content/blist.xul')</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+                          window.close();</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+                        else</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+                          Core.showContacts();&quot;/&gt;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+  &lt;/commandset&gt;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+  &lt;keyset id=&quot;mainkeyset&quot;&gt;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+    &lt;key id=&quot;contactskey&quot; command=&quot;cmd_contacts&quot;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+         key=&quot;&amp;contacts.commandkey;&quot; modifiers=&quot;accel,shift&quot;/&gt;</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+</span>
<a href="#l12.25"></a><span id="l12.25">   &lt;!-- adds the onpopupshowing attributes --&gt;</span>
<a href="#l12.26"></a><span id="l12.26">   &lt;menupopup id=&quot;setStatusMenupopup&quot;</span>
<a href="#l12.27"></a><span id="l12.27">              onpopupshowing=&quot;menus.onStatusPopupShowing();&quot;/&gt;</span>
<a href="#l12.28"></a><span id="l12.28">   &lt;menupopup id=&quot;toolsMenuPopup&quot;</span>
<a href="#l12.29"></a><span id="l12.29">              onpopupshowing=&quot;menus.displayUpdateStatus();&quot;/&gt;</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">   &lt;menuitem id=&quot;menu_FileQuitItem&quot;</span>
<a href="#l12.32"></a><span id="l12.32">             label=&quot;&amp;quitApplicationCmdMac.label;&quot;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineat">@@ -61,16 +74,19 @@</span>
<a href="#l12.34"></a><span id="l12.34">   &lt;menupopup id=&quot;helpMenuPopup&quot; onpopupshowing=&quot;&quot;/&gt;</span>
<a href="#l12.35"></a><span id="l12.35">   &lt;menuitem id=&quot;updatesMenuItem&quot; removeelement=&quot;true&quot;/&gt;</span>
<a href="#l12.36"></a><span id="l12.36">   &lt;menuseparator id=&quot;updatesSep&quot; removeelement=&quot;true&quot;/&gt;</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38">   &lt;!-- bottom of the tools menu --&gt;</span>
<a href="#l12.39"></a><span id="l12.39">   &lt;menuseparator id=&quot;prefSep&quot; removeelement=&quot;true&quot;/&gt;</span>
<a href="#l12.40"></a><span id="l12.40">   &lt;menuitem id=&quot;menu_preferences&quot; removeelement=&quot;true&quot;/&gt;</span>
<a href="#l12.41"></a><span id="l12.41">   &lt;menupopup id=&quot;toolsMenuPopup&quot;&gt;</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+    &lt;menuitem id=&quot;contactsMenuItem&quot; insertbefore=&quot;addonsMenuItem&quot;</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+              label=&quot;&amp;contacts.label;&quot; accesskey=&quot;&amp;contacts.accesskey;&quot;</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+              command=&quot;cmd_contacts&quot; key=&quot;contactskey&quot;/&gt;</span>
<a href="#l12.45"></a><span id="l12.45">     &lt;menuseparator id=&quot;updatesSep&quot;/&gt;</span>
<a href="#l12.46"></a><span id="l12.46">     &lt;menuitem id=&quot;updatesMenuItem&quot;</span>
<a href="#l12.47"></a><span id="l12.47">               label=&quot;&amp;checkForUpdates;&quot;</span>
<a href="#l12.48"></a><span id="l12.48">               oncommand=&quot;menus.updates()&quot;/&gt;</span>
<a href="#l12.49"></a><span id="l12.49">   &lt;/menupopup&gt;</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51">   &lt;menu id=&quot;helpMenu&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l12.52"></a><span id="l12.52"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/im/content/menus.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/im/content/menus.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -41,71 +41,55 @@ const blistWindow = &quot;chrome://instantbir</span>
<a href="#l13.4"></a><span id="l13.4"> const addBuddyWindow = &quot;chrome://instantbird/content/addbuddy.xul&quot;;</span>
<a href="#l13.5"></a><span id="l13.5"> const joinChatWindow = &quot;chrome://instantbird/content/joinchat.xul&quot;;</span>
<a href="#l13.6"></a><span id="l13.6"> const aboutWindow = &quot;chrome://instantbird/content/aboutDialog.xul&quot;;</span>
<a href="#l13.7"></a><span id="l13.7"> const errorConsoleWindow = &quot;chrome://global/content/console.xul&quot;;</span>
<a href="#l13.8"></a><span id="l13.8"> const preferencesWindow = &quot;chrome://instantbird/content/preferences/preferences.xul&quot;;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> if (!(&quot;Services&quot; in window))</span>
<a href="#l13.11"></a><span id="l13.11">   Components.utils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+if (!(&quot;Core&quot; in window))</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  Components.utils.import(&quot;resource:///modules/ibCore.jsm&quot;);</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15"> var menus = {</span>
<a href="#l13.16"></a><span id="l13.16">   focus: function menu_focus(aWindowType) {</span>
<a href="#l13.17"></a><span id="l13.17">     var win = Services.wm.getMostRecentWindow(aWindowType);</span>
<a href="#l13.18"></a><span id="l13.18">     if (win)</span>
<a href="#l13.19"></a><span id="l13.19">       win.focus();</span>
<a href="#l13.20"></a><span id="l13.20">     return win;</span>
<a href="#l13.21"></a><span id="l13.21">   },</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">   about: function menu_about() {</span>
<a href="#l13.24"></a><span id="l13.24">     if (!this.focus(&quot;Messenger:About&quot;))</span>
<a href="#l13.25"></a><span id="l13.25">       window.open(aboutWindow, &quot;About&quot;,</span>
<a href="#l13.26"></a><span id="l13.26">                   &quot;chrome,resizable=no,minimizable=no,centerscreen&quot;);</span>
<a href="#l13.27"></a><span id="l13.27">   },</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29">   accounts: function menu_accounts() {</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-    if (!this.focus(&quot;Messenger:Accounts&quot;))</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-      window.open(accountManagerWindow, &quot;Accounts&quot;,</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-                  &quot;chrome,resizable&quot;);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+    Core.showAccounts();</span>
<a href="#l13.34"></a><span id="l13.34">   },</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36">   preferences: function menu_preferences() {</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-    if (!this.focus(&quot;Messenger:Preferences&quot;))</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-      window.open(preferencesWindow, &quot;Preferences&quot;,</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-                  &quot;chrome,titlebar,toolbar,centerscreen,dialog=no&quot;);</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+    Core.showPreferences();</span>
<a href="#l13.41"></a><span id="l13.41">   },</span>
<a href="#l13.42"></a><span id="l13.42"> </span>
<a href="#l13.43"></a><span id="l13.43">   addons: function menu_addons() {</span>
<a href="#l13.44"></a><span id="l13.44">     if (!this.focus(&quot;Extension:Manager&quot;))</span>
<a href="#l13.45"></a><span id="l13.45">       window.open(addonManagerWindow, &quot;Addons&quot;,</span>
<a href="#l13.46"></a><span id="l13.46">                   &quot;chrome,menubar,extra-chrome,toolbar,dialog=no,resizable&quot;);</span>
<a href="#l13.47"></a><span id="l13.47">   },</span>
<a href="#l13.48"></a><span id="l13.48"> </span>
<a href="#l13.49"></a><span id="l13.49">   errors: function debug_errors() {</span>
<a href="#l13.50"></a><span id="l13.50">     if (!menus.focus(&quot;global:console&quot;))</span>
<a href="#l13.51"></a><span id="l13.51">       window.open(errorConsoleWindow, &quot;Errors&quot;,</span>
<a href="#l13.52"></a><span id="l13.52">                   &quot;chrome,extrachrome,menubar,resizable,scrollbars,status,toolbar&quot;);</span>
<a href="#l13.53"></a><span id="l13.53">   },</span>
<a href="#l13.54"></a><span id="l13.54"> </span>
<a href="#l13.55"></a><span id="l13.55">   updates: function menu_updates() {</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-    // copied from checkForUpdates in mozilla/browser/base/content/utilityOverlay.js</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-    var um =</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-      Components.classes[&quot;@mozilla.org/updates/update-manager;1&quot;]</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-                .getService(Components.interfaces.nsIUpdateManager);</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-    var prompter =</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-      Components.classes[&quot;@mozilla.org/updates/update-prompt;1&quot;]</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-                .createInstance(Components.interfaces.nsIUpdatePrompt);</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-    // If there's an update ready to be applied, show the &quot;Update Downloaded&quot;</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-    // UI instead and let the user know they have to restart the browser for</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-    // the changes to be applied.</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    if (um.activeUpdate &amp;&amp; um.activeUpdate.state == &quot;pending&quot;)</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-      prompter.showUpdateDownloaded(um.activeUpdate);</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-    else</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-      prompter.checkForUpdates();</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+    Core.showUpdates();</span>
<a href="#l13.72"></a><span id="l13.72">   },</span>
<a href="#l13.73"></a><span id="l13.73"> </span>
<a href="#l13.74"></a><span id="l13.74">   displayUpdateStatus: function menu_displayUpdateStatus() {</span>
<a href="#l13.75"></a><span id="l13.75">     // copied from buildHelpMenu in mozilla/browser/base/content/utilityOverlay.js</span>
<a href="#l13.76"></a><span id="l13.76">     var updates =</span>
<a href="#l13.77"></a><span id="l13.77">       Components.classes[&quot;@mozilla.org/updates/update-service;1&quot;]</span>
<a href="#l13.78"></a><span id="l13.78">                 .getService(Components.interfaces.nsIApplicationUpdateService);</span>
<a href="#l13.79"></a><span id="l13.79">     var um =</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineat">@@ -154,27 +138,28 @@ var menus = {</span>
<a href="#l13.81"></a><span id="l13.81">     checkForUpdates.accessKey =</span>
<a href="#l13.82"></a><span id="l13.82">       strings.GetStringFromName(&quot;updatesItem_&quot; + key + &quot;.accesskey&quot;);</span>
<a href="#l13.83"></a><span id="l13.83">     if (um.activeUpdate &amp;&amp; updates.isDownloading)</span>
<a href="#l13.84"></a><span id="l13.84">       checkForUpdates.setAttribute(&quot;loading&quot;, &quot;true&quot;);</span>
<a href="#l13.85"></a><span id="l13.85">     else</span>
<a href="#l13.86"></a><span id="l13.86">       checkForUpdates.removeAttribute(&quot;loading&quot;);</span>
<a href="#l13.87"></a><span id="l13.87">   },</span>
<a href="#l13.88"></a><span id="l13.88"> </span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-  getAccounts: function bl_getAccounts() {</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-    return getIter(Services.core.getAccounts());</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-  },</span>
<a href="#l13.92"></a><span id="l13.92">   updateFileMenuitems: function menu_updateFileMenuitems() {</span>
<a href="#l13.93"></a><span id="l13.93">     let hasConnectedAccount = false;</span>
<a href="#l13.94"></a><span id="l13.94">     let canJoinChat = false;</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineminus">-    for (let acc in this.getAccounts()) {</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+    let enumerator = Services.core.getAccounts();</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+    while (enumerator.hasMoreElements()) {</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+      let acc = enumerator.getNext();</span>
<a href="#l13.99"></a><span id="l13.99">       if (acc.connected) {</span>
<a href="#l13.100"></a><span id="l13.100">         hasConnectedAccount = true;</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-        if (acc.canJoinChat)</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+        if (acc.canJoinChat) {</span>
<a href="#l13.103"></a><span id="l13.103">           canJoinChat = true;</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+          break;</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+        }</span>
<a href="#l13.106"></a><span id="l13.106">       }</span>
<a href="#l13.107"></a><span id="l13.107">     }</span>
<a href="#l13.108"></a><span id="l13.108"> </span>
<a href="#l13.109"></a><span id="l13.109">     document.getElementById(&quot;addBuddyMenuItem&quot;).disabled = !hasConnectedAccount;</span>
<a href="#l13.110"></a><span id="l13.110">     document.getElementById(&quot;joinChatMenuItem&quot;).disabled = !canJoinChat;</span>
<a href="#l13.111"></a><span id="l13.111">   },</span>
<a href="#l13.112"></a><span id="l13.112"> </span>
<a href="#l13.113"></a><span id="l13.113">   addBuddy: function menu_addBuddy() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/im/installer/package-manifest.in</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/im/installer/package-manifest.in</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -406,18 +406,18 @@</span>
<a href="#l14.4"></a><span id="l14.4"> @BINPATH@/components/imCommands.manifest</span>
<a href="#l14.5"></a><span id="l14.5"> @BINPATH@/components/imContacts.js</span>
<a href="#l14.6"></a><span id="l14.6"> @BINPATH@/components/imContacts.manifest</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> #ifndef XP_MACOSX</span>
<a href="#l14.9"></a><span id="l14.9"> @BINPATH@/components/profileMigrator.js</span>
<a href="#l14.10"></a><span id="l14.10"> @BINPATH@/components/profileMigrator.manifest</span>
<a href="#l14.11"></a><span id="l14.11"> #endif</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-@BINPATH@/components/autoLoginHandler.js</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-@BINPATH@/components/autoLoginHandler.manifest</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+@BINPATH@/components/ibCommandLineHandler.js</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+@BINPATH@/components/ibCommandLineHandler.manifest</span>
<a href="#l14.16"></a><span id="l14.16"> @BINPATH@/components/facebookOverrideProtocol.js</span>
<a href="#l14.17"></a><span id="l14.17"> @BINPATH@/components/gtalkOverrideProtocol.js</span>
<a href="#l14.18"></a><span id="l14.18"> @BINPATH@/components/overrideProtocols.manifest</span>
<a href="#l14.19"></a><span id="l14.19"> @BINPATH@/components/twitter.js</span>
<a href="#l14.20"></a><span id="l14.20"> @BINPATH@/components/twitter.manifest</span>
<a href="#l14.21"></a><span id="l14.21"> @BINPATH@/components/smileProtocolHandler.js</span>
<a href="#l14.22"></a><span id="l14.22"> @BINPATH@/components/smileProtocolHandler.manifest</span>
<a href="#l14.23"></a><span id="l14.23"> @BINPATH@/components/logger.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/im/locales/en-US/chrome/instantbird/instantbird.dtd</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/im/locales/en-US/chrome/instantbird/instantbird.dtd</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -22,16 +22,19 @@</span>
<a href="#l15.4"></a><span id="l15.4"> &lt;!ENTITY available          &quot;Available&quot;&gt;</span>
<a href="#l15.5"></a><span id="l15.5"> &lt;!ENTITY unavailable        &quot;Unavailable&quot;&gt;</span>
<a href="#l15.6"></a><span id="l15.6"> &lt;!ENTITY offline            &quot;Offline&quot;&gt;</span>
<a href="#l15.7"></a><span id="l15.7"> &lt;!ENTITY tools.menu         &quot;Tools&quot;&gt;</span>
<a href="#l15.8"></a><span id="l15.8"> &lt;!ENTITY tools.accesskey    &quot;T&quot;&gt;</span>
<a href="#l15.9"></a><span id="l15.9"> &lt;!ENTITY accountManager     &quot;Accounts&quot;&gt;</span>
<a href="#l15.10"></a><span id="l15.10"> &lt;!ENTITY account.commandkey &quot;a&quot;&gt;</span>
<a href="#l15.11"></a><span id="l15.11"> &lt;!ENTITY account.accesskey  &quot;A&quot;&gt;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+&lt;!ENTITY contacts.label     &quot;Contacts&quot;&gt;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+&lt;!ENTITY contacts.commandkey &quot;c&quot;&gt;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+&lt;!ENTITY contacts.accesskey &quot;C&quot;&gt;</span>
<a href="#l15.15"></a><span id="l15.15"> &lt;!ENTITY addonManager       &quot;Add-ons&quot;&gt;</span>
<a href="#l15.16"></a><span id="l15.16"> &lt;!ENTITY checkForUpdates    &quot;Check for Updates&quot;&gt;</span>
<a href="#l15.17"></a><span id="l15.17"> &lt;!ENTITY help.menu          &quot;Help&quot;&gt;</span>
<a href="#l15.18"></a><span id="l15.18"> &lt;!ENTITY help.accesskey     &quot;H&quot;&gt;</span>
<a href="#l15.19"></a><span id="l15.19"> &lt;!-- LOCALIZATION NOTE (helpWin.menu):</span>
<a href="#l15.20"></a><span id="l15.20">     Some localizations of Windows (e.g. French, German) use &quot;?&quot; for the help</span>
<a href="#l15.21"></a><span id="l15.21">     button in the menubar. --&gt;</span>
<a href="#l15.22"></a><span id="l15.22"> &lt;!ENTITY helpWin.menu       &quot;Help&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/im/modules/Makefile.in</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/im/modules/Makefile.in</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -37,16 +37,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> DEPTH		= ../..</span>
<a href="#l16.5"></a><span id="l16.5"> topsrcdir	= @top_srcdir@</span>
<a href="#l16.6"></a><span id="l16.6"> srcdir		= @srcdir@</span>
<a href="#l16.7"></a><span id="l16.7"> VPATH		= @srcdir@</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> EXTRA_JS_MODULES = \</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+	ibCore.jsm \</span>
<a href="#l16.13"></a><span id="l16.13"> 	imContentSink.jsm \</span>
<a href="#l16.14"></a><span id="l16.14"> 	imServices.jsm \</span>
<a href="#l16.15"></a><span id="l16.15"> 	imSmileys.jsm \</span>
<a href="#l16.16"></a><span id="l16.16"> 	imStatusUtils.jsm \</span>
<a href="#l16.17"></a><span id="l16.17"> 	$(NULL)</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> EXTRA_PP_JS_MODULES = \</span>
<a href="#l16.20"></a><span id="l16.20"> 	imThemes.jsm \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">rename from im/content/core.js</span>
<a href="#l17.2"></a><span id="l17.2">rename to im/modules/ibCore.jsm</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineminus">--- a/im/content/core.js</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineplus">+++ b/im/modules/ibCore.jsm</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineat">@@ -31,91 +31,289 @@</span>
<a href="#l17.6"></a><span id="l17.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.7"></a><span id="l17.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.8"></a><span id="l17.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.9"></a><span id="l17.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.10"></a><span id="l17.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.11"></a><span id="l17.11">  *</span>
<a href="#l17.12"></a><span id="l17.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.13"></a><span id="l17.13"> </span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-function initPurpleCore()</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-{</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-  if (!Ci.purpleICoreService) {</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-    promptError(&quot;startupFailure.purplexpcomFileError&quot;);</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-    return false;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-  }</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+const EXPORTED_SYMBOLS = [&quot;Core&quot;];</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+const {classes: Cc, interfaces: Ci, utils: Cu} = Components;</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+Cu.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+Cu.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-  if (!Components.classes[&quot;@instantbird.org/purple/core;1&quot;]) {</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-    promptError(&quot;startupFailure.xpcomRegistrationError&quot;);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-    return false;</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-  }</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+var Core = {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  _events: [</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+    &quot;account-connected&quot;,</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+    &quot;account-disconnected&quot;,</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+    &quot;browser-request&quot;,</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+    &quot;quit-application-requested&quot;</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+  ],</span>
<a href="#l17.37"></a><span id="l17.37"> </span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-  try {</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    var pcs = Services.core;</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-    pcs.init();</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-  }</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-  catch (e) {</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-    promptError(&quot;startupFailure.purplexpcomInitError&quot;, e);</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-    return false;</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-  }</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+  init: function() {</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+    try {</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+      // Set the Vendor for breakpad only</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+      if (&quot;nsICrashReporter&quot; in Ci) {</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+        Components.classes[&quot;@mozilla.org/xre/app-info;1&quot;]</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+                  .getService(Ci.nsICrashReporter)</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+                  .annotateCrashReport(&quot;Vendor&quot;, &quot;Instantbird&quot;);</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+      }</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+    } catch(e) {</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+      // This can fail if breakpad isn't enabled,</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+      // don't worry too much about this exception.</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+    }</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+    if (!Ci.purpleICoreService) {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+      this._promptError(&quot;startupFailure.purplexpcomFileError&quot;);</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+      return false;</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+    }</span>
<a href="#l17.63"></a><span id="l17.63"> </span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-  if (!pcs.version) {</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-    promptError(&quot;startupFailure.libpurpleError&quot;);</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-    return false;</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-  }</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+    if (!Components.classes[&quot;@instantbird.org/purple/core;1&quot;]) {</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+      this._promptError(&quot;startupFailure.xpcomRegistrationError&quot;);</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+      return false;</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+    }</span>
<a href="#l17.72"></a><span id="l17.72"> </span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-  if (!pcs.getProtocols().hasMoreElements()) {</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-    promptError(&quot;startupFailure.noProtocolLoaded&quot;);</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-    uninitPurpleCore();</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-    return false;</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-  }</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+    try {</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+      var pcs = Services.core;</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+      pcs.init();</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+    }</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+    catch (e) {</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+      this._promptError(&quot;startupFailure.purplexpcomInitError&quot;, e);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+      return false;</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+    }</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+    if (!pcs.version) {</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+      this._promptError(&quot;startupFailure.libpurpleError&quot;);</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+      return false;</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+    }</span>
<a href="#l17.91"></a><span id="l17.91"> </span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-  return true;</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-}</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+    if (!pcs.getProtocols().hasMoreElements()) {</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+      this._promptError(&quot;startupFailure.noProtocolLoaded&quot;);</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+      this.uninitPurpleCore();</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+      return false;</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+    }</span>
<a href="#l17.99"></a><span id="l17.99"> </span>
<a href="#l17.100"></a><span id="l17.100" class="difflineminus">-function uninitPurpleCore()</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-{</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineminus">-  try {</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-    Services.core.quit();</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  }</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-  catch (e) {</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-    Services.prompt.alert(null, &quot;Shutdown Error&quot;,</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-                          &quot;An error occurred while shutting down purplexpcom: &quot; + e);</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineminus">-  }</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-}</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+    let status = {</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+      back: &quot;AVAILABLE&quot;,</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+      away: &quot;AWAY&quot;,</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineplus">+      busy: &quot;UNAVAILABLE&quot;,</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineplus">+      dnd: &quot;UNAVAILABLE&quot;,</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineplus">+      offline: &quot;OFFLINE&quot;</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineplus">+    };</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineplus">+    for (let cmd in status) {</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+      let statusValue = Ci.imIStatusInfo[&quot;STATUS_&quot; + status[cmd]];</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+      Services.cmd.registerCommand({</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+        name: cmd,</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+        priority: Ci.imICommand.PRIORITY_HIGH,</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+        run: function(aMsg) {</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+          Services.core.setStatus(statusValue, aMsg);</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+          return true;</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+        }</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+      });</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+    }</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+    Conversations.init();</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+    this._events.forEach(function (aTopic) {</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+      Services.obs.addObserver(Core, aTopic, false);</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineplus">+    });</span>
<a href="#l17.134"></a><span id="l17.134"> </span>
<a href="#l17.135"></a><span id="l17.135" class="difflineminus">-function promptError(aKeyString, aMessage) {</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineminus">-  var bundle =</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineminus">-    Services.strings.createBundle(&quot;chrome://instantbird/locale/core.properties&quot;);</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineplus">+    this._showAccountManagerIfNeeded(true);</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineplus">+    return true;</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+  },</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineplus">+  showWindow: function(aWindowType, aUrl, aName, aFeatures) {</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineplus">+    var win = Services.wm.getMostRecentWindow(aWindowType);</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+    if (win)</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+      win.focus();</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineplus">+    else</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+      win = Services.ww.openWindow(null, aUrl, aName, aFeatures, null);</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+    return win;</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+  },</span>
<a href="#l17.150"></a><span id="l17.150"> </span>
<a href="#l17.151"></a><span id="l17.151" class="difflineminus">-  var title = bundle.GetStringFromName(&quot;startupFailure.title&quot;);</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-  var message =</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineminus">-    bundle.GetStringFromName(&quot;startupFailure.apologize&quot;) + &quot;\n\n&quot; +</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineminus">-    (aMessage ? bundle.formatStringFromName(aKeyString, [aMessage], 1)</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineminus">-              : bundle.GetStringFromName(aKeyString)) + &quot;\n\n&quot; +</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineminus">-    bundle.GetStringFromName(&quot;startupFailure.update&quot;);</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineminus">-  const nsIPromptService = Components.interfaces.nsIPromptService;</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-  const flags =</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineminus">-    nsIPromptService.BUTTON_POS_1 * nsIPromptService.BUTTON_TITLE_IS_STRING +</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineminus">-    nsIPromptService.BUTTON_POS_0 * nsIPromptService.BUTTON_TITLE_IS_STRING;</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineminus">-</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineminus">-  var prompts = Services.prompt;</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineminus">-  if (!prompts.confirmEx(null, title, message, flags,</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineminus">-                         bundle.GetStringFromName(&quot;startupFailure.buttonUpdate&quot;),</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineminus">-                         bundle.GetStringFromName(&quot;startupFailure.buttonClose&quot;),</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineminus">-                         null, null, {})) {</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineplus">+  showAccounts: function() {</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+    this.showWindow(&quot;Messenger:Accounts&quot;,</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+                    &quot;chrome://instantbird/content/accounts.xul&quot;, &quot;Accounts&quot;,</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+                    &quot;chrome,resizable&quot;);</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+  },</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+  showContacts: function() {</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+    this.showWindow(&quot;Messenger:blist&quot;,</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+                    &quot;chrome://instantbird/content/blist.xul&quot;, &quot;Contacts&quot;,</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineplus">+                    &quot;chrome,dialog=no,all&quot;);</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineplus">+  },</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineplus">+  showPreferences: function() {</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+    this.showWindow(&quot;Messenger:Preferences&quot;,</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+                    &quot;chrome://instantbird/content/preferences/preferences.xul&quot;,</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+                    &quot;Preferences&quot;,</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+                    &quot;chrome,titlebar,toolbar,centerscreen,dialog=no&quot;);</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+  },</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+  showUpdates: function() {</span>
<a href="#l17.184"></a><span id="l17.184">     // copied from checkForUpdates in mozilla/browser/base/content/utilityOverlay.js</span>
<a href="#l17.185"></a><span id="l17.185">     var um =</span>
<a href="#l17.186"></a><span id="l17.186">       Components.classes[&quot;@mozilla.org/updates/update-manager;1&quot;]</span>
<a href="#l17.187"></a><span id="l17.187">                 .getService(Components.interfaces.nsIUpdateManager);</span>
<a href="#l17.188"></a><span id="l17.188">     var prompter =</span>
<a href="#l17.189"></a><span id="l17.189">       Components.classes[&quot;@mozilla.org/updates/update-prompt;1&quot;]</span>
<a href="#l17.190"></a><span id="l17.190">                 .createInstance(Components.interfaces.nsIUpdatePrompt);</span>
<a href="#l17.191"></a><span id="l17.191"> </span>
<a href="#l17.192"></a><span id="l17.192">     // If there's an update ready to be applied, show the &quot;Update Downloaded&quot;</span>
<a href="#l17.193"></a><span id="l17.193">     // UI instead and let the user know they have to restart the browser for</span>
<a href="#l17.194"></a><span id="l17.194">     // the changes to be applied.</span>
<a href="#l17.195"></a><span id="l17.195">     if (um.activeUpdate &amp;&amp; um.activeUpdate.state == &quot;pending&quot;)</span>
<a href="#l17.196"></a><span id="l17.196">       prompter.showUpdateDownloaded(um.activeUpdate);</span>
<a href="#l17.197"></a><span id="l17.197">     else</span>
<a href="#l17.198"></a><span id="l17.198">       prompter.checkForUpdates();</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+  },</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+  getIter: function(aEnumerator) {</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+    while (aEnumerator.hasMoreElements())</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineplus">+      yield aEnumerator.getNext();</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+  },</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+  getAccounts: function() this.getIter(Services.core.getAccounts()),</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineplus">+</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineplus">+  /* This function pops up the account manager if no account is</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+   * connected or connecting.</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+   * When called during startup (aIsStarting == true), it will also</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+   * look for crashed accounts.</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+   */</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+  _showAccountManagerIfNeeded: function (aIsStarting) {</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+    // If the current status is offline, we don't need the account manager</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+    let isOffline =</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineplus">+      Services.core.currentStatusType == Ci.imIStatusInfo.STATUS_OFFLINE;</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineplus">+    if (isOffline &amp;&amp; !aIsStarting)</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineplus">+      return;</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineplus">+</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+    let hasActiveAccount = false;</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+    let hasCrashedAccount = false;</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineplus">+    for (let acc in this.getAccounts()) {</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineplus">+      if (acc.connected || acc.connecting)</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+        hasActiveAccount = true;</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineplus">+      // We only check for crashed accounts on startup.</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+      if (aIsStarting &amp;&amp; acc.autoLogin &amp;&amp;</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineplus">+          acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineplus">+        hasCrashedAccount = true;</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineplus">+    }</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineplus">+</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineplus">+    /* We only display the account manager on startup if an account has crashed</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+       or if all accounts are disconnected</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineplus">+       In case of connection failure after an automatic reconnection attempt,</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineplus">+       we don't want to popup the account manager */</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineplus">+    if ((!hasActiveAccount &amp;&amp; !isOffline) || (aIsStarting &amp;&amp; hasCrashedAccount))</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineplus">+      this.showAccounts();</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineplus">+  },</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineplus">+</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+  observe: function(aSubject, aTopic, aMsg) {</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineplus">+    if (aTopic == &quot;account-connected&quot;) {</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+      let account = aSubject.QueryInterface(Components.interfaces.purpleIAccount);</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineplus">+      if (!account.canJoinChat)</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineplus">+        return;</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineplus">+</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineplus">+      let pref = &quot;messenger.account.&quot; + account.id + &quot;.autoJoin&quot;;</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineplus">+      if (Services.prefs.prefHasUserValue(pref)) {</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineplus">+        let autojoin = Services.prefs.getCharPref(pref);</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineplus">+        if (autojoin) {</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineplus">+          autojoin = autojoin.split(&quot;,&quot;);</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineplus">+          for (let i = 0; i &lt; autojoin.length; ++i) {</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineplus">+            let values = account.getChatRoomDefaultFieldValues(autojoin[i]);</span>
<a href="#l17.252"></a><span id="l17.252" class="difflineplus">+            account.joinChat(values);</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineplus">+          }</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineplus">+        }</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineplus">+      }</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineplus">+      return;</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineplus">+    }</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+    if (aTopic == &quot;account-disconnected&quot;) {</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+      let account = aSubject.QueryInterface(Ci.purpleIAccount);</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+      if (account.reconnectAttempt &lt;= 1)</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+        this._showAccountManagerIfNeeded(false);</span>
<a href="#l17.263"></a><span id="l17.263" class="difflineplus">+      return;</span>
<a href="#l17.264"></a><span id="l17.264" class="difflineplus">+    }</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineplus">+</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+    if (aTopic == &quot;browser-request&quot;) {</span>
<a href="#l17.267"></a><span id="l17.267" class="difflineplus">+      Services.ww.openWindow(null,</span>
<a href="#l17.268"></a><span id="l17.268" class="difflineplus">+                             &quot;chrome://instantbird/content/browserRequest.xul&quot;,</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineplus">+                             null, &quot;chrome&quot;, aSubject);</span>
<a href="#l17.270"></a><span id="l17.270" class="difflineplus">+      return;</span>
<a href="#l17.271"></a><span id="l17.271" class="difflineplus">+    }</span>
<a href="#l17.272"></a><span id="l17.272" class="difflineplus">+</span>
<a href="#l17.273"></a><span id="l17.273" class="difflineplus">+    if (aTopic == &quot;quit-application-requested&quot;) {</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineplus">+      this._onQuitRequest(aSubject, aMsg);</span>
<a href="#l17.275"></a><span id="l17.275" class="difflineplus">+      return;</span>
<a href="#l17.276"></a><span id="l17.276" class="difflineplus">+    }</span>
<a href="#l17.277"></a><span id="l17.277" class="difflineplus">+  },</span>
<a href="#l17.278"></a><span id="l17.278" class="difflineplus">+</span>
<a href="#l17.279"></a><span id="l17.279" class="difflineplus">+  uninit: function() {</span>
<a href="#l17.280"></a><span id="l17.280" class="difflineplus">+    try {</span>
<a href="#l17.281"></a><span id="l17.281" class="difflineplus">+      Services.core.quit();</span>
<a href="#l17.282"></a><span id="l17.282" class="difflineplus">+    }</span>
<a href="#l17.283"></a><span id="l17.283" class="difflineplus">+    catch (e) {</span>
<a href="#l17.284"></a><span id="l17.284" class="difflineplus">+      Services.prompt.alert(null, &quot;Shutdown Error&quot;,</span>
<a href="#l17.285"></a><span id="l17.285" class="difflineplus">+                            &quot;An error occurred while shutting down purplexpcom: &quot; + e);</span>
<a href="#l17.286"></a><span id="l17.286" class="difflineplus">+    }</span>
<a href="#l17.287"></a><span id="l17.287" class="difflineplus">+  },</span>
<a href="#l17.288"></a><span id="l17.288" class="difflineplus">+</span>
<a href="#l17.289"></a><span id="l17.289" class="difflineplus">+  _onQuitRequest: function (aCancelQuit, aQuitType) {</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineplus">+    // The request has already been canceled somewhere else</span>
<a href="#l17.291"></a><span id="l17.291" class="difflineplus">+    if ((aCancelQuit instanceof Components.interfaces.nsISupportsPRBool)</span>
<a href="#l17.292"></a><span id="l17.292" class="difflineplus">+         &amp;&amp; aCancelQuit.data)</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineplus">+      return;</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineplus">+</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineplus">+    if (!Services.prefs.getBoolPref(&quot;messenger.warnOnQuit&quot;))</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineplus">+      return;</span>
<a href="#l17.297"></a><span id="l17.297" class="difflineplus">+</span>
<a href="#l17.298"></a><span id="l17.298" class="difflineplus">+    let unreadConvsCount = Conversations.unreadConvsCount;</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineplus">+    if (unreadConvsCount == 0)</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineplus">+      return;</span>
<a href="#l17.301"></a><span id="l17.301" class="difflineplus">+</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+    let bundle =</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineplus">+      Services.strings.createBundle(&quot;chrome://instantbird/locale/quitDialog.properties&quot;);</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineplus">+    let promptTitle    = bundle.GetStringFromName(&quot;dialogTitle&quot;);</span>
<a href="#l17.305"></a><span id="l17.305" class="difflineplus">+    let promptMessage  = bundle.GetStringFromName(&quot;message&quot;);</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineplus">+    let promptCheckbox = bundle.GetStringFromName(&quot;checkbox&quot;);</span>
<a href="#l17.307"></a><span id="l17.307" class="difflineplus">+    let action         = aQuitType == &quot;restart&quot; ? &quot;restart&quot; : &quot;quit&quot;;</span>
<a href="#l17.308"></a><span id="l17.308" class="difflineplus">+    let button         = bundle.GetStringFromName(action + &quot;Button&quot;);</span>
<a href="#l17.309"></a><span id="l17.309" class="difflineplus">+</span>
<a href="#l17.310"></a><span id="l17.310" class="difflineplus">+    Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l17.311"></a><span id="l17.311" class="difflineplus">+    promptMessage = PluralForm.get(unreadConvsCount, promptMessage)</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineplus">+                              .replace(&quot;#1&quot;, unreadConvsCount);</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+</span>
<a href="#l17.314"></a><span id="l17.314" class="difflineplus">+    let prompts = Services.prompt;</span>
<a href="#l17.315"></a><span id="l17.315" class="difflineplus">+    let flags = prompts.BUTTON_TITLE_IS_STRING * prompts.BUTTON_POS_0 +</span>
<a href="#l17.316"></a><span id="l17.316" class="difflineplus">+                prompts.BUTTON_TITLE_CANCEL * prompts.BUTTON_POS_1 +</span>
<a href="#l17.317"></a><span id="l17.317" class="difflineplus">+                prompts.BUTTON_POS_1_DEFAULT;</span>
<a href="#l17.318"></a><span id="l17.318" class="difflineplus">+    let checkbox = {value: false};</span>
<a href="#l17.319"></a><span id="l17.319" class="difflineplus">+    let convWindow = Services.wm.getMostRecentWindow(&quot;Messenger:convs&quot;);</span>
<a href="#l17.320"></a><span id="l17.320" class="difflineplus">+    if (prompts.confirmEx(convWindow, promptTitle, promptMessage, flags,</span>
<a href="#l17.321"></a><span id="l17.321" class="difflineplus">+                          button, null, null, promptCheckbox, checkbox)) {</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineplus">+      aCancelQuit.data = true;</span>
<a href="#l17.323"></a><span id="l17.323" class="difflineplus">+      return;</span>
<a href="#l17.324"></a><span id="l17.324" class="difflineplus">+    }</span>
<a href="#l17.325"></a><span id="l17.325" class="difflineplus">+</span>
<a href="#l17.326"></a><span id="l17.326" class="difflineplus">+    if (checkbox.value)</span>
<a href="#l17.327"></a><span id="l17.327" class="difflineplus">+      Services.prefs.setBoolPref(&quot;messenger.warnOnQuit&quot;, false);</span>
<a href="#l17.328"></a><span id="l17.328" class="difflineplus">+  },</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineplus">+</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineplus">+  _promptError: function(aKeyString, aMessage) {</span>
<a href="#l17.331"></a><span id="l17.331" class="difflineplus">+    var bundle =</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineplus">+      Services.strings.createBundle(&quot;chrome://instantbird/locale/core.properties&quot;);</span>
<a href="#l17.333"></a><span id="l17.333" class="difflineplus">+</span>
<a href="#l17.334"></a><span id="l17.334" class="difflineplus">+    var title = bundle.GetStringFromName(&quot;startupFailure.title&quot;);</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineplus">+    var message =</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineplus">+      bundle.GetStringFromName(&quot;startupFailure.apologize&quot;) + &quot;\n\n&quot; +</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineplus">+      (aMessage ? bundle.formatStringFromName(aKeyString, [aMessage], 1)</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineplus">+                : bundle.GetStringFromName(aKeyString)) + &quot;\n\n&quot; +</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineplus">+      bundle.GetStringFromName(&quot;startupFailure.update&quot;);</span>
<a href="#l17.340"></a><span id="l17.340" class="difflineplus">+    const nsIPromptService = Components.interfaces.nsIPromptService;</span>
<a href="#l17.341"></a><span id="l17.341" class="difflineplus">+    const flags =</span>
<a href="#l17.342"></a><span id="l17.342" class="difflineplus">+      nsIPromptService.BUTTON_POS_1 * nsIPromptService.BUTTON_TITLE_IS_STRING +</span>
<a href="#l17.343"></a><span id="l17.343" class="difflineplus">+      nsIPromptService.BUTTON_POS_0 * nsIPromptService.BUTTON_TITLE_IS_STRING;</span>
<a href="#l17.344"></a><span id="l17.344" class="difflineplus">+</span>
<a href="#l17.345"></a><span id="l17.345" class="difflineplus">+    var prompts = Services.prompt;</span>
<a href="#l17.346"></a><span id="l17.346" class="difflineplus">+    if (!prompts.confirmEx(null, title, message, flags,</span>
<a href="#l17.347"></a><span id="l17.347" class="difflineplus">+                           bundle.GetStringFromName(&quot;startupFailure.buttonUpdate&quot;),</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineplus">+                           bundle.GetStringFromName(&quot;startupFailure.buttonClose&quot;),</span>
<a href="#l17.349"></a><span id="l17.349" class="difflineplus">+                           null, null, {}))</span>
<a href="#l17.350"></a><span id="l17.350" class="difflineplus">+      this.showUpdates();</span>
<a href="#l17.351"></a><span id="l17.351">   }</span>
<a href="#l17.352"></a><span id="l17.352" class="difflineminus">-}</span>
<a href="#l17.353"></a><span id="l17.353" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/im/modules/imWindows.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/im/modules/imWindows.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -31,17 +31,16 @@</span>
<a href="#l18.4"></a><span id="l18.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.5"></a><span id="l18.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.6"></a><span id="l18.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.7"></a><span id="l18.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.8"></a><span id="l18.8">  *</span>
<a href="#l18.9"></a><span id="l18.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11"> const CONVERSATION_WINDOW_URI = &quot;chrome://instantbird/content/instantbird.xul&quot;;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-const BROWSER_REQUEST_WINDOW_URI = &quot;chrome://instantbird/content/browserRequest.xul&quot;;</span>
<a href="#l18.13"></a><span id="l18.13"> var EXPORTED_SYMBOLS = [&quot;Conversations&quot;];</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15"> Components.utils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17"> var Conversations = {</span>
<a href="#l18.18"></a><span id="l18.18"> #ifdef XP_MACOSX</span>
<a href="#l18.19"></a><span id="l18.19">   _badgeTimeout: null,</span>
<a href="#l18.20"></a><span id="l18.20">   _showDockBadgePrefName: &quot;messenger.options.showUnreadCountInDock&quot;,</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -145,59 +144,22 @@ var Conversations = {</span>
<a href="#l18.22"></a><span id="l18.22">       let conv = this._purpleConv[id];</span>
<a href="#l18.23"></a><span id="l18.23">       let doc = conv.ownerDocument;</span>
<a href="#l18.24"></a><span id="l18.24">       doc.getElementById(&quot;conversations&quot;).selectedTab = conv.tab;</span>
<a href="#l18.25"></a><span id="l18.25">       conv.focus();</span>
<a href="#l18.26"></a><span id="l18.26">       doc.defaultView.focus();</span>
<a href="#l18.27"></a><span id="l18.27">     }</span>
<a href="#l18.28"></a><span id="l18.28">   },</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-  _onQuitRequest: function (aCancelQuit, aQuitType) {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    // The request has already been canceled somewhere else</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-    if ((aCancelQuit instanceof Components.interfaces.nsISupportsPRBool)</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-         &amp;&amp; aCancelQuit.data)</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-      return;</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">-</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-    if (!Services.prefs.getBoolPref(&quot;messenger.warnOnQuit&quot;))</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-      return;</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-    let unreadConvsCount = this._conversations.filter(function(conv) {</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+  get unreadConvsCount() {</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+    return this._conversations.filter(function(conv) {</span>
<a href="#l18.42"></a><span id="l18.42">       let tab = conv.tab;</span>
<a href="#l18.43"></a><span id="l18.43">       return tab.hasAttribute(&quot;unread&quot;) &amp;&amp;</span>
<a href="#l18.44"></a><span id="l18.44">              (!tab.hasAttribute(&quot;chat&quot;) || tab.hasAttribute(&quot;attention&quot;));</span>
<a href="#l18.45"></a><span id="l18.45">     }).length;</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-    if (unreadConvsCount == 0)</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-      return;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-    let bundle =</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-      Services.strings.createBundle(&quot;chrome://instantbird/locale/quitDialog.properties&quot;);</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-    let promptTitle    = bundle.GetStringFromName(&quot;dialogTitle&quot;);</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-    let promptMessage  = bundle.GetStringFromName(&quot;message&quot;);</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-    let promptCheckbox = bundle.GetStringFromName(&quot;checkbox&quot;);</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-    let action         = aQuitType == &quot;restart&quot; ? &quot;restart&quot; : &quot;quit&quot;;</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-    let button         = bundle.GetStringFromName(action + &quot;Button&quot;);</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineminus">-    Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-    promptMessage = PluralForm.get(unreadConvsCount, promptMessage)</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-                              .replace(&quot;#1&quot;, unreadConvsCount);</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-    let prompts = Services.prompt;</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-    let flags = prompts.BUTTON_TITLE_IS_STRING * prompts.BUTTON_POS_0 +</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-                prompts.BUTTON_TITLE_CANCEL * prompts.BUTTON_POS_1 +</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-                prompts.BUTTON_POS_1_DEFAULT;</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-    let checkbox = {value: false};</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-    if (prompts.confirmEx(this._windows[0], promptTitle, promptMessage, flags,</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineminus">-                          button, null, null, promptCheckbox, checkbox)) {</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-      aCancelQuit.data = true;</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-      return;</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-    }</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-    if (checkbox.value)</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-      Services.prefs.setBoolPref(&quot;messenger.warnOnQuit&quot;, false);</span>
<a href="#l18.75"></a><span id="l18.75">   },</span>
<a href="#l18.76"></a><span id="l18.76"> </span>
<a href="#l18.77"></a><span id="l18.77">   onWindowFocus: function (aWindow) {</span>
<a href="#l18.78"></a><span id="l18.78">     let position = this._windows.indexOf(aWindow);</span>
<a href="#l18.79"></a><span id="l18.79">     if (position != -1) {</span>
<a href="#l18.80"></a><span id="l18.80">       this._windows.splice(position, 1);</span>
<a href="#l18.81"></a><span id="l18.81">       this._windows.unshift(aWindow);</span>
<a href="#l18.82"></a><span id="l18.82">     }</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineat">@@ -261,35 +223,27 @@ var Conversations = {</span>
<a href="#l18.84"></a><span id="l18.84">     Components.classes[&quot;@mozilla.org/alerts-service;1&quot;]</span>
<a href="#l18.85"></a><span id="l18.85">               .getService(Components.interfaces.nsIAlertsService)</span>
<a href="#l18.86"></a><span id="l18.86">               .showAlertNotification(icon, aMessage.alias || aMessage.who,</span>
<a href="#l18.87"></a><span id="l18.87">                                      messageText, true, &quot;&quot;, observer);</span>
<a href="#l18.88"></a><span id="l18.88">   },</span>
<a href="#l18.89"></a><span id="l18.89"> </span>
<a href="#l18.90"></a><span id="l18.90">   init: function() {</span>
<a href="#l18.91"></a><span id="l18.91">     let os = Services.obs;</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineminus">-    [&quot;browser-request&quot;,</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineminus">-     &quot;new-text&quot;,</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineplus">+    [&quot;new-text&quot;,</span>
<a href="#l18.95"></a><span id="l18.95">      &quot;new-conversation&quot;,</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-     &quot;account-connected&quot;,</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-     &quot;purple-quit&quot;,</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-     &quot;quit-application-requested&quot;].forEach(function (aTopic) {</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineplus">+     &quot;purple-quit&quot;].forEach(function (aTopic) {</span>
<a href="#l18.100"></a><span id="l18.100">       os.addObserver(Conversations, aTopic, false);</span>
<a href="#l18.101"></a><span id="l18.101">     });</span>
<a href="#l18.102"></a><span id="l18.102"> #ifdef XP_MACOSX</span>
<a href="#l18.103"></a><span id="l18.103">     Services.prefs.addObserver(this._showDockBadgePrefName, this, false);</span>
<a href="#l18.104"></a><span id="l18.104"> #endif</span>
<a href="#l18.105"></a><span id="l18.105">   },</span>
<a href="#l18.106"></a><span id="l18.106"> </span>
<a href="#l18.107"></a><span id="l18.107">   observe: function(aSubject, aTopic, aMsg) {</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-    if (aTopic == &quot;quit-application-requested&quot;) {</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-      this._onQuitRequest(aSubject, aMsg);</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-      return;</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineminus">-    }</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineminus">-</span>
<a href="#l18.113"></a><span id="l18.113">     if (aTopic == &quot;purple-quit&quot;) {</span>
<a href="#l18.114"></a><span id="l18.114">       for (let id in this._purpleConv)</span>
<a href="#l18.115"></a><span id="l18.115">         this._purpleConv[id].unInit();</span>
<a href="#l18.116"></a><span id="l18.116"> #ifdef XP_MACOSX</span>
<a href="#l18.117"></a><span id="l18.117">       Services.prefs.removeObserver(Conversations._showDockBadgePrefName,</span>
<a href="#l18.118"></a><span id="l18.118">                                     Conversations);</span>
<a href="#l18.119"></a><span id="l18.119"> #endif</span>
<a href="#l18.120"></a><span id="l18.120">     }</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineat">@@ -301,41 +255,16 @@ var Conversations = {</span>
<a href="#l18.122"></a><span id="l18.122">           this._showUnreadCount();</span>
<a href="#l18.123"></a><span id="l18.123">         else</span>
<a href="#l18.124"></a><span id="l18.124">           this._hideUnreadCountDockBadge();</span>
<a href="#l18.125"></a><span id="l18.125">       }</span>
<a href="#l18.126"></a><span id="l18.126">       return;</span>
<a href="#l18.127"></a><span id="l18.127">     }</span>
<a href="#l18.128"></a><span id="l18.128"> #endif</span>
<a href="#l18.129"></a><span id="l18.129"> </span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-    if (aTopic == &quot;account-connected&quot;) {</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineminus">-      let account = aSubject.QueryInterface(Components.interfaces.purpleIAccount);</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-      if (!account.canJoinChat)</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineminus">-        return;</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineminus">-      let pref = &quot;messenger.account.&quot; + account.id + &quot;.autoJoin&quot;;</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-      if (Services.prefs.prefHasUserValue(pref)) {</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-        let autojoin = Services.prefs.getCharPref(pref);</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineminus">-        if (autojoin) {</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineminus">-          autojoin = autojoin.split(&quot;,&quot;);</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-          for (let i = 0; i &lt; autojoin.length; ++i) {</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineminus">-            let values = account.getChatRoomDefaultFieldValues(autojoin[i]);</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineminus">-            account.joinChat(values);</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineminus">-          }</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineminus">-        }</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineminus">-      }</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-      return;</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineminus">-    }</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineminus">-    if (aTopic == &quot;browser-request&quot;) {</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineminus">-      Services.ww.openWindow(null, BROWSER_REQUEST_WINDOW_URI, null,</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineminus">-                             &quot;chrome&quot;, aSubject);</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineminus">-      return;</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineminus">-    }</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineminus">-</span>
<a href="#l18.155"></a><span id="l18.155">     if (aTopic != &quot;new-text&quot; &amp;&amp; aTopic != &quot;new-conversation&quot;)</span>
<a href="#l18.156"></a><span id="l18.156">       return;</span>
<a href="#l18.157"></a><span id="l18.157"> </span>
<a href="#l18.158"></a><span id="l18.158">     let conv = aTopic == &quot;new-conversation&quot; ? aSubject : aSubject.conversation;</span>
<a href="#l18.159"></a><span id="l18.159">     if (!(conv.id in this._purpleConv)) {</span>
<a href="#l18.160"></a><span id="l18.160">       // The conversation is not displayed anywhere yet.</span>
<a href="#l18.161"></a><span id="l18.161">       // First, check if an existing conversation window can accept it.</span>
<a href="#l18.162"></a><span id="l18.162">       for each (let win in this._windows)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

