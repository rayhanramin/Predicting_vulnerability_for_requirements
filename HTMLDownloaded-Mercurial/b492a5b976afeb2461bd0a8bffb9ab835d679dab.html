<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26831:b492a5b976afeb2461bd0a8bffb9ab835d679dab</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b492a5b976afeb2461bd0a8bffb9ab835d679dab" />
<meta property="og:url" content="/comm-central/rev/b492a5b976afeb2461bd0a8bffb9ab835d679dab" />
<meta property="og:description" content="Bug 1542715 - [de-xbl] convert folder-menupopup binding to custom element &lt;menupopup is='folder-menupopup'&gt;. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b492a5b976afeb2461bd0a8bffb9ab835d679dab 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b492a5b976afeb2461bd0a8bffb9ab835d679dab">shortlog</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b492a5b976afeb2461bd0a8bffb9ab835d679dab">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab">files</a> |
changeset |
<a href="/comm-central/raw-rev/b492a5b976afeb2461bd0a8bffb9ab835d679dab">raw</a>  | <a href="/comm-central/archive/b492a5b976afeb2461bd0a8bffb9ab835d679dab.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1542715">Bug 1542715</a> - [de-xbl] convert folder-menupopup binding to custom element &lt;menupopup is='folder-menupopup'&gt;. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#104;&#117;&#115;&#104;&#105;&#108;&#32;&#77;&#105;&#115;&#116;&#114;&#121;&#32;&#60;&#107;&#104;&#117;&#115;&#104;&#105;&#108;&#51;&#50;&#52;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 06 Jun 2019 02:04:00 +0200</td></tr>

<tr>
 <td>changeset 26831</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b492a5b976afeb2461bd0a8bffb9ab835d679dab">b492a5b976afeb2461bd0a8bffb9ab835d679dab</a></td>
</tr>



<tr>
<td>parent 26830</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0f025fb08630db2c60540b8a82fb0fbc9cc17964">0f025fb08630db2c60540b8a82fb0fbc9cc17964</a>
</td>
</tr>

<tr>
<td>child 26832</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2600d6fff1bf31331265cb78a3ce576b8ab9257e">2600d6fff1bf31331265cb78a3ce576b8ab9257e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b492a5b976afeb2461bd0a8bffb9ab835d679dab">16017</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 06 Jun 2019 18:52:40 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2600d6fff1bf [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2600d6fff1bf31331265cb78a3ce576b8ab9257e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2600d6fff1bf31331265cb78a3ce576b8ab9257e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2600d6fff1bf31331265cb78a3ce576b8ab9257e&newProject=comm-central&newRevision=72ff6b1ef248bc2cd44edcc3afbfc060e2cb1778&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2600d6fff1bf31331265cb78a3ce576b8ab9257e&newProject=comm-central&newRevision=72ff6b1ef248bc2cd44edcc3afbfc060e2cb1778&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2600d6fff1bf31331265cb78a3ce576b8ab9257e&newProject=comm-central&newRevision=72ff6b1ef248bc2cd44edcc3afbfc060e2cb1778&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1542715">1542715</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1542715">Bug 1542715</a> - [de-xbl] convert folder-menupopup binding to custom element &lt;menupopup is='folder-menupopup'&gt;. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/FilterListDialog.xul">mail/base/content/FilterListDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/FilterListDialog.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/FilterListDialog.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/FilterListDialog.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/FilterListDialog.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/FilterListDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/SearchDialog.xul">mail/base/content/SearchDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/SearchDialog.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/SearchDialog.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/SearchDialog.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/SearchDialog.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/SearchDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/customElements.js">mail/base/content/customElements.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/customElements.js">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/customElements.js">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/customElements.js">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/customElements.js">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/customElements.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mailWidgets.js">mail/base/content/mailWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mailWidgets.js">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mailWidgets.js">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mailWidgets.js">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mailWidgets.js">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mailWidgets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainMailToolbox.inc.xul">mail/base/content/mainMailToolbox.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainMailToolbox.inc.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainMailToolbox.inc.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainMailToolbox.inc.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainMailToolbox.inc.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainMailToolbox.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainNavigationToolbox.inc.xul">mail/base/content/mainNavigationToolbox.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainNavigationToolbox.inc.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainNavigationToolbox.inc.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainNavigationToolbox.inc.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainNavigationToolbox.inc.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainNavigationToolbox.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainPopupSet.inc.xul">mail/base/content/mainPopupSet.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainPopupSet.inc.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainPopupSet.inc.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainPopupSet.inc.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainPopupSet.inc.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/mainPopupSet.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/messenger.css">mail/base/content/messenger.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/messenger.css">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/messenger.css">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/messenger.css">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/messenger.css">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/base/content/messenger.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/components/compose/content/messengercompose.xul">mail/components/compose/content/messengercompose.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/components/compose/content/messengercompose.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/components/compose/content/messengercompose.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/components/compose/content/messengercompose.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/components/compose/content/messengercompose.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/components/compose/content/messengercompose.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/test/mozmill/folder-widget/test-message-filters.js">mail/test/mozmill/folder-widget/test-message-filters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/test/mozmill/folder-widget/test-message-filters.js">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/test/mozmill/folder-widget/test-message-filters.js">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/test/mozmill/folder-widget/test-message-filters.js">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/test/mozmill/folder-widget/test-message-filters.js">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/test/mozmill/folder-widget/test-message-filters.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/themes/windows/mail/messenger.css">mail/themes/windows/mail/messenger.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/themes/windows/mail/messenger.css">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/themes/windows/mail/messenger.css">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/themes/windows/mail/messenger.css">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/themes/windows/mail/messenger.css">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mail/themes/windows/mail/messenger.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folder-menupopup.js">mailnews/base/content/folder-menupopup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folder-menupopup.js">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folder-menupopup.js">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folder-menupopup.js">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folder-menupopup.js">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folder-menupopup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folderWidgets.xml">mailnews/base/content/folderWidgets.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folderWidgets.xml">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folderWidgets.xml">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/folderWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/newFolderDialog.xul">mailnews/base/content/newFolderDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/newFolderDialog.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/newFolderDialog.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/newFolderDialog.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/newFolderDialog.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/newFolderDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/subscribe.xul">mailnews/base/content/subscribe.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/subscribe.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/subscribe.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/subscribe.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/subscribe.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/subscribe.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/virtualFolderProperties.xul">mailnews/base/content/virtualFolderProperties.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/virtualFolderProperties.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/virtualFolderProperties.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/virtualFolderProperties.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/virtualFolderProperties.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/content/virtualFolderProperties.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-copies.inc.xul">mailnews/base/prefs/content/am-copies.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-copies.inc.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-copies.inc.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-copies.inc.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-copies.inc.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-copies.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-junk.xul">mailnews/base/prefs/content/am-junk.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-junk.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-junk.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-junk.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-junk.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-junk.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server-advanced.xul">mailnews/base/prefs/content/am-server-advanced.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server-advanced.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server-advanced.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server-advanced.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server-advanced.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server-advanced.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server.xul">mailnews/base/prefs/content/am-server.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/prefs/content/am-server.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/search/content/searchWidgets.js">mailnews/base/search/content/searchWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/search/content/searchWidgets.js">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/search/content/searchWidgets.js">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/search/content/searchWidgets.js">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/search/content/searchWidgets.js">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/base/search/content/searchWidgets.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/extensions/newsblog/content/feed-subscriptions.xul">mailnews/extensions/newsblog/content/feed-subscriptions.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/extensions/newsblog/content/feed-subscriptions.xul">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/extensions/newsblog/content/feed-subscriptions.xul">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/extensions/newsblog/content/feed-subscriptions.xul">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/extensions/newsblog/content/feed-subscriptions.xul">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/extensions/newsblog/content/feed-subscriptions.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/jar.mn">mailnews/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/jar.mn">file</a> |
<a href="/comm-central/annotate/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/jar.mn">annotate</a> |
<a href="/comm-central/diff/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/jar.mn">diff</a> |
<a href="/comm-central/comparison/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/jar.mn">comparison</a> |
<a href="/comm-central/log/b492a5b976afeb2461bd0a8bffb9ab835d679dab/mailnews/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/FilterListDialog.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/FilterListDialog.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -38,17 +38,18 @@</span>
<a href="#l1.4"></a><span id="l1.4">   &lt;/keyset&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   &lt;hbox id=&quot;filterHeader&quot; align=&quot;center&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7">     &lt;label value=&quot;&amp;filtersForPrefix.label;&quot;</span>
<a href="#l1.8"></a><span id="l1.8">            accesskey=&quot;&amp;filtersForPrefix.accesskey;&quot; control=&quot;serverMenu&quot;/&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">     &lt;menulist id=&quot;serverMenu&quot;</span>
<a href="#l1.11"></a><span id="l1.11">               class=&quot;folderMenuItem&quot;&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      &lt;menupopup id=&quot;serverMenuPopup&quot; type=&quot;folder&quot; mode=&quot;filters&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;serverMenuPopup&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+                 mode=&quot;filters&quot;</span>
<a href="#l1.15"></a><span id="l1.15">                  class=&quot;menulist-menupopup&quot;</span>
<a href="#l1.16"></a><span id="l1.16">                  expandFolders=&quot;nntp&quot;</span>
<a href="#l1.17"></a><span id="l1.17">                  showFileHereLabel=&quot;true&quot;</span>
<a href="#l1.18"></a><span id="l1.18">                  showAccountsFileHere=&quot;true&quot;</span>
<a href="#l1.19"></a><span id="l1.19">                  oncommand=&quot;setFilterFolder(event.target._folder);&quot;/&gt;</span>
<a href="#l1.20"></a><span id="l1.20">     &lt;/menulist&gt;</span>
<a href="#l1.21"></a><span id="l1.21">     &lt;textbox is=&quot;search-textbox&quot; id=&quot;searchBox&quot;</span>
<a href="#l1.22"></a><span id="l1.22">              class=&quot;searchBox&quot;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -80,19 +81,18 @@</span>
<a href="#l1.24"></a><span id="l1.24">           &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l1.25"></a><span id="l1.25">           &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l1.26"></a><span id="l1.26">             &lt;label id=&quot;folderPickerPrefix&quot; value=&quot;&amp;folderPickerPrefix.label;&quot;</span>
<a href="#l1.27"></a><span id="l1.27">                    accesskey=&quot;&amp;folderPickerPrefix.accesskey;&quot;</span>
<a href="#l1.28"></a><span id="l1.28">                    disabled=&quot;true&quot; control=&quot;runFiltersFolder&quot;/&gt;</span>
<a href="#l1.29"></a><span id="l1.29">             &lt;menulist id=&quot;runFiltersFolder&quot; disabled=&quot;true&quot; flex=&quot;1&quot;</span>
<a href="#l1.30"></a><span id="l1.30">                       class=&quot;folderMenuItem&quot;</span>
<a href="#l1.31"></a><span id="l1.31">                       displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-              &lt;menupopup id=&quot;runFiltersPopup&quot;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;runFiltersPopup&quot;</span>
<a href="#l1.34"></a><span id="l1.34">                          class=&quot;menulist-menupopup&quot;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-                         type=&quot;folder&quot;</span>
<a href="#l1.36"></a><span id="l1.36">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l1.37"></a><span id="l1.37">                          showAccountsFileHere=&quot;false&quot;</span>
<a href="#l1.38"></a><span id="l1.38">                          oncommand=&quot;setRunFolder(event.target._folder);&quot;/&gt;</span>
<a href="#l1.39"></a><span id="l1.39">             &lt;/menulist&gt;</span>
<a href="#l1.40"></a><span id="l1.40">           &lt;button id=&quot;runFiltersButton&quot;</span>
<a href="#l1.41"></a><span id="l1.41">                   label=&quot;&amp;runFilters.label;&quot;</span>
<a href="#l1.42"></a><span id="l1.42">                   accesskey=&quot;&amp;runFilters.accesskey;&quot;</span>
<a href="#l1.43"></a><span id="l1.43">                   runlabel=&quot;&amp;runFilters.label;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/SearchDialog.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -81,19 +81,18 @@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     &lt;vbox id=&quot;searchTerms&quot; flex=&quot;3&quot; persist=&quot;height&quot;&gt;</span>
<a href="#l2.6"></a><span id="l2.6">       &lt;vbox&gt;</span>
<a href="#l2.7"></a><span id="l2.7">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.8"></a><span id="l2.8">           &lt;label value=&quot;&amp;searchHeading.label;&quot; accesskey=&quot;&amp;searchHeading.accesskey;&quot;</span>
<a href="#l2.9"></a><span id="l2.9">                  control=&quot;searchableFolders&quot;/&gt;</span>
<a href="#l2.10"></a><span id="l2.10">           &lt;menulist id=&quot;searchableFolders&quot; flex=&quot;2&quot; class=&quot;folderMenuItem&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                     displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-            &lt;menupopup class=&quot;menulist-menupopup&quot;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                       type=&quot;folder&quot; mode=&quot;search&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                       showAccountsFileHere=&quot;true&quot; showFileHereLabel=&quot;true&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+            &lt;menupopup is=&quot;folder-menupopup&quot; class=&quot;menulist-menupopup&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+                       mode=&quot;search&quot; showAccountsFileHere=&quot;true&quot; showFileHereLabel=&quot;true&quot;</span>
<a href="#l2.17"></a><span id="l2.17">                        oncommand=&quot;updateSearchFolderPicker(event.target._folder);&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18">           &lt;/menulist&gt;</span>
<a href="#l2.19"></a><span id="l2.19">           &lt;spacer flex=&quot;10&quot;/&gt;</span>
<a href="#l2.20"></a><span id="l2.20">           &lt;button id=&quot;search-button&quot; oncommand=&quot;onSearchButton(event);&quot; default=&quot;true&quot;/&gt;</span>
<a href="#l2.21"></a><span id="l2.21">         &lt;/hbox&gt;</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.24"></a><span id="l2.24">           &lt;checkbox id=&quot;checkSearchSubFolders&quot;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -190,17 +189,17 @@</span>
<a href="#l2.26"></a><span id="l2.26">           &lt;treechildren ondragstart=&quot;ThreadPaneOnDragStart(event);&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27">         &lt;/tree&gt;</span>
<a href="#l2.28"></a><span id="l2.28">       &lt;/vbox&gt;</span>
<a href="#l2.29"></a><span id="l2.29">       &lt;hbox align=&quot;start&quot;&gt;</span>
<a href="#l2.30"></a><span id="l2.30">         &lt;button label=&quot;&amp;openButton.label;&quot; id=&quot;openButton&quot; command=&quot;cmd_open&quot; accesskey=&quot;&amp;openButton.accesskey;&quot;/&gt;</span>
<a href="#l2.31"></a><span id="l2.31">         &lt;button id=&quot;fileMessageButton&quot; type=&quot;menu&quot; label=&quot;&amp;moveButton.label;&quot;</span>
<a href="#l2.32"></a><span id="l2.32">                 accesskey=&quot;&amp;moveButton.accesskey;&quot;</span>
<a href="#l2.33"></a><span id="l2.33">                 command=&quot;file_message_button&quot;&gt;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-          &lt;menupopup type=&quot;folder&quot; showFileHereLabel=&quot;true&quot; mode=&quot;filing&quot;/&gt;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+          &lt;menupopup is=&quot;folder-menupopup&quot; showFileHereLabel=&quot;true&quot; mode=&quot;filing&quot;/&gt;</span>
<a href="#l2.36"></a><span id="l2.36">         &lt;/button&gt;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">       &lt;button label=&quot;&amp;deleteButton.label;&quot; id=&quot;deleteButton&quot; command=&quot;button_delete&quot; accesskey=&quot;&amp;deleteButton.accesskey;&quot;/&gt;</span>
<a href="#l2.39"></a><span id="l2.39">       &lt;button label=&quot;&amp;openInFolder.label;&quot; id=&quot;openInFolderButton&quot; command=&quot;open_in_folder_button&quot; accesskey=&quot;&amp;openInFolder.accesskey;&quot; /&gt;</span>
<a href="#l2.40"></a><span id="l2.40">       &lt;button label=&quot;&amp;saveAsVFButton.label;&quot; id=&quot;saveAsVFButton&quot; command=&quot;saveas_vf_button&quot; accesskey=&quot;&amp;saveAsVFButton.accesskey;&quot; /&gt;</span>
<a href="#l2.41"></a><span id="l2.41">       &lt;spacer flex=&quot;1&quot; /&gt;</span>
<a href="#l2.42"></a><span id="l2.42">     &lt;/hbox&gt;</span>
<a href="#l2.43"></a><span id="l2.43">   &lt;/vbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/customElements.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/customElements.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -13,15 +13,16 @@ const isDummyDocument = document.documen</span>
<a href="#l3.4"></a><span id="l3.4"> if (!isDummyDocument) {</span>
<a href="#l3.5"></a><span id="l3.5">   for (let script of [</span>
<a href="#l3.6"></a><span id="l3.6">     &quot;chrome://chat/content/conversation-browser.js&quot;,</span>
<a href="#l3.7"></a><span id="l3.7">     &quot;chrome://messenger/content/mailWidgets.js&quot;,</span>
<a href="#l3.8"></a><span id="l3.8">     &quot;chrome://messenger/content/generalBindings.js&quot;,</span>
<a href="#l3.9"></a><span id="l3.9">     &quot;chrome://messenger/content/statuspanel.js&quot;,</span>
<a href="#l3.10"></a><span id="l3.10">     &quot;chrome://messenger/content/foldersummary.js&quot;,</span>
<a href="#l3.11"></a><span id="l3.11">     &quot;chrome://messenger/content/addressbook/menulist-addrbooks.js&quot;,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    &quot;chrome://messenger/content/folder-menupopup.js&quot;,</span>
<a href="#l3.13"></a><span id="l3.13">     &quot;chrome://messenger/content/toolbarbutton-menu-button.js&quot;,</span>
<a href="#l3.14"></a><span id="l3.14">     &quot;chrome://messenger/content/toolbarbutton-appmenu.js&quot;,</span>
<a href="#l3.15"></a><span id="l3.15">   ]) {</span>
<a href="#l3.16"></a><span id="l3.16">     Services.scriptloader.loadSubScript(script, window);</span>
<a href="#l3.17"></a><span id="l3.17">   }</span>
<a href="#l3.18"></a><span id="l3.18"> }</span>
<a href="#l3.19"></a><span id="l3.19"> })();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailWidgets.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -479,20 +479,20 @@ class MozThreadPaneTreeColpicker extends</span>
<a href="#l4.4"></a><span id="l4.4">     }</span>
<a href="#l4.5"></a><span id="l4.5">     let popup = this.querySelector(`menupopup[anonid=&quot;popup&quot;]`);</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7">     // We'll add an &quot;Apply columns to...&quot; menu</span>
<a href="#l4.8"></a><span id="l4.8">     popup.appendChild(MozXULElement.parseXULToFragment(`</span>
<a href="#l4.9"></a><span id="l4.9">       &lt;menu class=&quot;applyTo-menu&quot; label=&quot;&amp;columnPicker.applyTo.label;&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;menupopup&gt;</span>
<a href="#l4.11"></a><span id="l4.11">           &lt;menu class=&quot;applyToFolder-menu&quot; label=&quot;&amp;columnPicker.applyToFolder.label;&quot;&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-            &lt;menupopup class=&quot;applyToFolder&quot; type=&quot;folder&quot; showFileHereLabel=&quot;true&quot; position=&quot;start_before&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+            &lt;menupopup is=&quot;folder-menupopup&quot; class=&quot;applyToFolder&quot; showFileHereLabel=&quot;true&quot; position=&quot;start_before&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l4.14"></a><span id="l4.14">           &lt;/menu&gt;</span>
<a href="#l4.15"></a><span id="l4.15">           &lt;menu class=&quot;applyToFolderAndChildren-menu&quot; label=&quot;&amp;columnPicker.applyToFolderAndChildren.label;&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-            &lt;menupopup class=&quot;applyToFolderAndChildren&quot; type=&quot;folder&quot; showFileHereLabel=&quot;true&quot; showAccountsFileHere=&quot;true&quot; position=&quot;start_before&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+            &lt;menupopup is=&quot;folder-menupopup&quot; class=&quot;applyToFolderAndChildren&quot; showFileHereLabel=&quot;true&quot; showAccountsFileHere=&quot;true&quot; position=&quot;start_before&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l4.18"></a><span id="l4.18">           &lt;/menu&gt;</span>
<a href="#l4.19"></a><span id="l4.19">         &lt;/menupopup&gt;</span>
<a href="#l4.20"></a><span id="l4.20">       &lt;/menu&gt;</span>
<a href="#l4.21"></a><span id="l4.21">     `, [&quot;chrome://messenger/locale/messenger.dtd&quot;]));</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">     let confirmApply = (destFolder, useChildren) =&gt; {</span>
<a href="#l4.24"></a><span id="l4.24">       // Confirm the action with the user.</span>
<a href="#l4.25"></a><span id="l4.25">       let bundle = document.getElementById(&quot;bundle_messenger&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mainMailToolbox.inc.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mainMailToolbox.inc.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -16,20 +16,19 @@</span>
<a href="#l5.4"></a><span id="l5.4">   &lt;toolbarpalette id=&quot;MailToolbarPalette&quot;&gt;</span>
<a href="#l5.5"></a><span id="l5.5">     &lt;toolbarbutton is=&quot;toolbarbutton-menu-button&quot; id=&quot;button-getmsg&quot;</span>
<a href="#l5.6"></a><span id="l5.6">                    type=&quot;menu-button&quot;</span>
<a href="#l5.7"></a><span id="l5.7">                    class=&quot;toolbarbutton-1&quot;</span>
<a href="#l5.8"></a><span id="l5.8">                    label=&quot;&amp;getMsgButton1.label;&quot;</span>
<a href="#l5.9"></a><span id="l5.9">                    tooltiptext=&quot;&amp;getMsgButton.tooltip;&quot;</span>
<a href="#l5.10"></a><span id="l5.10">                    oncommand=&quot;MsgGetMessagesForAccount();&quot;</span>
<a href="#l5.11"></a><span id="l5.11">                    observes=&quot;button_getNewMessages&quot;&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      &lt;menupopup id=&quot;button-getMsgPopup&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;button-getMsgPopup&quot;</span>
<a href="#l5.14"></a><span id="l5.14">                  onpopupshowing=&quot;getMsgToolbarMenu_init();&quot;</span>
<a href="#l5.15"></a><span id="l5.15">                  oncommand=&quot;MsgGetMessagesForAccount(event.target._folder); event.stopPropagation();&quot;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-                 type=&quot;folder&quot;</span>
<a href="#l5.17"></a><span id="l5.17">                  expandFolders=&quot;false&quot;</span>
<a href="#l5.18"></a><span id="l5.18">                  mode=&quot;getMail&quot;&gt;</span>
<a href="#l5.19"></a><span id="l5.19">         &lt;menuitem id=&quot;button-getAllNewMsg&quot;</span>
<a href="#l5.20"></a><span id="l5.20">                   label=&quot;&amp;getAllNewMsgCmd.label;&quot;</span>
<a href="#l5.21"></a><span id="l5.21">                   accesskey=&quot;&amp;getAllNewMsgCmd.accesskey;&quot;</span>
<a href="#l5.22"></a><span id="l5.22">                   command=&quot;cmd_getMsgsForAuthAccounts&quot;/&gt;</span>
<a href="#l5.23"></a><span id="l5.23">         &lt;menuseparator id=&quot;button-getAllNewMsgSeparator&quot;/&gt;</span>
<a href="#l5.24"></a><span id="l5.24">       &lt;/menupopup&gt;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineat">@@ -77,18 +76,17 @@</span>
<a href="#l5.26"></a><span id="l5.26">     &lt;/toolbarbutton&gt;</span>
<a href="#l5.27"></a><span id="l5.27">     &lt;toolbarbutton id=&quot;button-file&quot;</span>
<a href="#l5.28"></a><span id="l5.28">                    type=&quot;menu&quot;</span>
<a href="#l5.29"></a><span id="l5.29">                    class=&quot;toolbarbutton-1&quot;</span>
<a href="#l5.30"></a><span id="l5.30">                    label=&quot;&amp;fileButton.label;&quot;</span>
<a href="#l5.31"></a><span id="l5.31">                    tooltiptext=&quot;&amp;fileButton.tooltip;&quot;</span>
<a href="#l5.32"></a><span id="l5.32">                    observes=&quot;button_file&quot;</span>
<a href="#l5.33"></a><span id="l5.33">                    oncommand=&quot;MsgMoveMessage(event.target._folder)&quot;&gt;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-      &lt;menupopup id=&quot;button-filePopup&quot;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-                 type=&quot;folder&quot;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+      &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;button-filePopup&quot;</span>
<a href="#l5.37"></a><span id="l5.37">                  mode=&quot;filing&quot;</span>
<a href="#l5.38"></a><span id="l5.38">                  showRecent=&quot;true&quot;</span>
<a href="#l5.39"></a><span id="l5.39">                  showFileHereLabel=&quot;true&quot;</span>
<a href="#l5.40"></a><span id="l5.40">                  recentLabel=&quot;&amp;moveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l5.41"></a><span id="l5.41">                  recentAccessKey=&quot;&amp;moveCopyMsgRecentMenu.accesskey;&quot;/&gt;</span>
<a href="#l5.42"></a><span id="l5.42">     &lt;/toolbarbutton&gt;</span>
<a href="#l5.43"></a><span id="l5.43">     &lt;toolbarbutton id=&quot;button-archive&quot;</span>
<a href="#l5.44"></a><span id="l5.44">                    class=&quot;toolbarbutton-1&quot;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineat">@@ -364,19 +362,18 @@</span>
<a href="#l5.46"></a><span id="l5.46">                  align=&quot;center&quot;</span>
<a href="#l5.47"></a><span id="l5.47">                  class=&quot;chromeclass-toolbar-additional&quot;&gt;</span>
<a href="#l5.48"></a><span id="l5.48">       &lt;menulist id=&quot;locationFolders&quot;</span>
<a href="#l5.49"></a><span id="l5.49">                 class=&quot;folderMenuItem&quot;</span>
<a href="#l5.50"></a><span id="l5.50">                 label=&quot;&amp;folderLocationToolbarItem.title;&quot;</span>
<a href="#l5.51"></a><span id="l5.51">                 context=&quot;folderPaneContext&quot;</span>
<a href="#l5.52"></a><span id="l5.52">                 maxwidth=&quot;300&quot;</span>
<a href="#l5.53"></a><span id="l5.53">                 crop=&quot;center&quot;&gt;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-        &lt;menupopup id=&quot;folderLocationPopup&quot;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+        &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;folderLocationPopup&quot;</span>
<a href="#l5.56"></a><span id="l5.56">                    class=&quot;menulist-menupopup&quot;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-                   type=&quot;folder&quot;</span>
<a href="#l5.58"></a><span id="l5.58">                    flex=&quot;1&quot;</span>
<a href="#l5.59"></a><span id="l5.59">                    mode=&quot;notDeferred&quot;</span>
<a href="#l5.60"></a><span id="l5.60">                    showFileHereLabel=&quot;true&quot;</span>
<a href="#l5.61"></a><span id="l5.61">                    oncommand=&quot;gFolderTreeView.selectFolder(event.target._folder, true);&quot;/&gt;</span>
<a href="#l5.62"></a><span id="l5.62">       &lt;/menulist&gt;</span>
<a href="#l5.63"></a><span id="l5.63">     &lt;/toolbaritem&gt;</span>
<a href="#l5.64"></a><span id="l5.64">     &lt;toolbaritem id=&quot;mailviews-container&quot;</span>
<a href="#l5.65"></a><span id="l5.65">                  title=&quot;&amp;mailViewsToolbarItem.title;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/mainNavigationToolbox.inc.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/mainNavigationToolbox.inc.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -108,17 +108,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">                accesskey=&quot;&amp;saveAsTemplateCmd.accesskey;&quot;</span>
<a href="#l6.5"></a><span id="l6.5">                command=&quot;cmd_saveAsTemplate&quot;/&gt;</span>
<a href="#l6.6"></a><span id="l6.6">             &lt;/menupopup&gt;</span>
<a href="#l6.7"></a><span id="l6.7">           &lt;/menu&gt;</span>
<a href="#l6.8"></a><span id="l6.8">           &lt;menuseparator id=&quot;fileMenuAfterSaveSeparator&quot;/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">           &lt;menu label=&quot;&amp;getNewMsgForCmd.label;&quot; accesskey=&quot;&amp;getNewMsgForCmd.accesskey;&quot;</span>
<a href="#l6.10"></a><span id="l6.10">                 id=&quot;menu_getAllNewMsg&quot;</span>
<a href="#l6.11"></a><span id="l6.11">                 oncommand=&quot;MsgGetMessagesForAccount();&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-            &lt;menupopup type=&quot;folder&quot; mode=&quot;getMail&quot; id=&quot;menu_getAllNewMsgPopup&quot;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+            &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;menu_getAllNewMsgPopup&quot;</span>
<a href="#l6.14"></a><span id="l6.14">                        expandFolders=&quot;false&quot;</span>
<a href="#l6.15"></a><span id="l6.15">                        oncommand=&quot;MsgGetMessagesForAccount(event.target._folder); event.stopPropagation();&quot;&gt;</span>
<a href="#l6.16"></a><span id="l6.16">               &lt;menuitem id=&quot;menu_getnewmsgs_all_accounts&quot;</span>
<a href="#l6.17"></a><span id="l6.17">                         label=&quot;&amp;getAllNewMsgCmdPopupMenu.label;&quot;</span>
<a href="#l6.18"></a><span id="l6.18">                         accesskey=&quot;&amp;getAllNewMsgCmdPopupMenu.accesskey;&quot;</span>
<a href="#l6.19"></a><span id="l6.19">                         key=&quot;key_getAllNewMessages&quot;</span>
<a href="#l6.20"></a><span id="l6.20">                         command=&quot;cmd_getMsgsForAuthAccounts&quot;/&gt;</span>
<a href="#l6.21"></a><span id="l6.21">               &lt;menuitem id=&quot;menu_getnewmsgs_current_account&quot;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -647,18 +647,17 @@</span>
<a href="#l6.23"></a><span id="l6.23">                     accesskey=&quot;&amp;goChatCmd.accesskey;&quot;</span>
<a href="#l6.24"></a><span id="l6.24">                     command=&quot;cmd_chat&quot;</span>
<a href="#l6.25"></a><span id="l6.25">                     key=&quot;key_goChat&quot;/&gt;</span>
<a href="#l6.26"></a><span id="l6.26">           &lt;menuseparator id=&quot;goChatSeparator&quot;/&gt;</span>
<a href="#l6.27"></a><span id="l6.27">           &lt;menu id=&quot;goFolderMenu&quot;</span>
<a href="#l6.28"></a><span id="l6.28">                 label=&quot;&amp;folderMenu.label;&quot;</span>
<a href="#l6.29"></a><span id="l6.29">                 accesskey=&quot;&amp;folderMenu.accesskey;&quot;</span>
<a href="#l6.30"></a><span id="l6.30">                 command=&quot;cmd_goFolder&quot;&gt;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-            &lt;menupopup id=&quot;menu_GoFolderPopup&quot;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-                       type=&quot;folder&quot;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+            &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;menu_GoFolderPopup&quot;</span>
<a href="#l6.34"></a><span id="l6.34">                        showFileHereLabel=&quot;true&quot;</span>
<a href="#l6.35"></a><span id="l6.35">                        showRecent=&quot;true&quot;</span>
<a href="#l6.36"></a><span id="l6.36">                        recentLabel=&quot;&amp;contextMoveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l6.37"></a><span id="l6.37">                        recentAccessKey=&quot;&amp;contextMoveCopyMsgRecentMenu.accesskey;&quot;</span>
<a href="#l6.38"></a><span id="l6.38">                        showFavorites=&quot;true&quot;</span>
<a href="#l6.39"></a><span id="l6.39">                        favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l6.40"></a><span id="l6.40">                        favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span>
<a href="#l6.41"></a><span id="l6.41">           &lt;/menu&gt;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineat">@@ -869,30 +868,32 @@</span>
<a href="#l6.43"></a><span id="l6.43">                       command=&quot;cmd_archive&quot;/&gt;</span>
<a href="#l6.44"></a><span id="l6.44">             &lt;menuitem id=&quot;menu_cancel&quot; command=&quot;cmd_cancel&quot;</span>
<a href="#l6.45"></a><span id="l6.45">                       label=&quot;&amp;cancelNewsMsgCmd.label;&quot;</span>
<a href="#l6.46"></a><span id="l6.46">                       accesskey=&quot;&amp;cancelNewsMsgCmd.accesskey;&quot;/&gt;</span>
<a href="#l6.47"></a><span id="l6.47">             &lt;menu id=&quot;moveMenu&quot;</span>
<a href="#l6.48"></a><span id="l6.48">                   label=&quot;&amp;moveMsgToMenu.label;&quot;</span>
<a href="#l6.49"></a><span id="l6.49">                   accesskey=&quot;&amp;moveMsgToMenu.accesskey;&quot;</span>
<a href="#l6.50"></a><span id="l6.50">                   oncommand=&quot;MsgMoveMessage(event.target._folder)&quot;&gt;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-              &lt;menupopup type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l6.54"></a><span id="l6.54">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l6.55"></a><span id="l6.55">                          showRecent=&quot;true&quot;</span>
<a href="#l6.56"></a><span id="l6.56">                          recentLabel=&quot;&amp;moveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l6.57"></a><span id="l6.57">                          recentAccessKey=&quot;&amp;moveCopyMsgRecentMenu.accesskey;&quot;</span>
<a href="#l6.58"></a><span id="l6.58">                          showFavorites=&quot;true&quot;</span>
<a href="#l6.59"></a><span id="l6.59">                          favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l6.60"></a><span id="l6.60">                          favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span>
<a href="#l6.61"></a><span id="l6.61">             &lt;/menu&gt;</span>
<a href="#l6.62"></a><span id="l6.62">             &lt;menu id=&quot;copyMenu&quot;</span>
<a href="#l6.63"></a><span id="l6.63">                   label=&quot;&amp;copyMsgToMenu.label;&quot;</span>
<a href="#l6.64"></a><span id="l6.64">                   accesskey=&quot;&amp;copyMsgToMenu.accesskey;&quot;</span>
<a href="#l6.65"></a><span id="l6.65">                   oncommand=&quot;MsgCopyMessage(event.target._folder)&quot;&gt;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-              &lt;menupopup type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l6.69"></a><span id="l6.69">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l6.70"></a><span id="l6.70">                          showRecent=&quot;true&quot;</span>
<a href="#l6.71"></a><span id="l6.71">                          recentLabel=&quot;&amp;moveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l6.72"></a><span id="l6.72">                          recentAccessKey=&quot;&amp;moveCopyMsgRecentMenu.accesskey;&quot;</span>
<a href="#l6.73"></a><span id="l6.73">                          showFavorites=&quot;true&quot;</span>
<a href="#l6.74"></a><span id="l6.74">                          favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l6.75"></a><span id="l6.75">                          favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span>
<a href="#l6.76"></a><span id="l6.76">             &lt;/menu&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/mainPopupSet.inc.xul</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/mainPopupSet.inc.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -374,19 +374,18 @@</span>
<a href="#l7.4"></a><span id="l7.4">             &lt;menuitem id=&quot;appmenu_close&quot;</span>
<a href="#l7.5"></a><span id="l7.5">                       label=&quot;&amp;closeCmd.label;&quot;</span>
<a href="#l7.6"></a><span id="l7.6">                       key=&quot;key_close&quot;</span>
<a href="#l7.7"></a><span id="l7.7">                       command=&quot;cmd_close&quot;/&gt;</span>
<a href="#l7.8"></a><span id="l7.8">             &lt;menuseparator id=&quot;appmenu_fileMenuAfterCloseSeparator&quot;/&gt;</span>
<a href="#l7.9"></a><span id="l7.9">             &lt;menu id=&quot;appmenu_getNewMsgFor&quot;</span>
<a href="#l7.10"></a><span id="l7.10">                   label=&quot;&amp;getNewMsgForCmd.label;&quot;</span>
<a href="#l7.11"></a><span id="l7.11">                   oncommand=&quot;MsgGetMessagesForAccount();&quot;&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-              &lt;menupopup type=&quot;folder&quot;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;appmenu_getAllNewMsgPopup&quot;</span>
<a href="#l7.14"></a><span id="l7.14">                          mode=&quot;getMail&quot;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-                         id=&quot;appmenu_getAllNewMsgPopup&quot;</span>
<a href="#l7.16"></a><span id="l7.16">                          expandFolders=&quot;false&quot;</span>
<a href="#l7.17"></a><span id="l7.17">                          oncommand=&quot;MsgGetMessagesForAccount(event.target._folder); event.stopPropagation();&quot;&gt;</span>
<a href="#l7.18"></a><span id="l7.18">                 &lt;menuitem id=&quot;appmenu_getnewmsgs_all_accounts&quot;</span>
<a href="#l7.19"></a><span id="l7.19">                           label=&quot;&amp;getAllNewMsgCmdPopupMenu.label;&quot;</span>
<a href="#l7.20"></a><span id="l7.20">                           key=&quot;key_getAllNewMessages&quot;</span>
<a href="#l7.21"></a><span id="l7.21">                           command=&quot;cmd_getMsgsForAuthAccounts&quot;/&gt;</span>
<a href="#l7.22"></a><span id="l7.22">                 &lt;menuitem id=&quot;appmenu_getnewmsgs_current_account&quot;</span>
<a href="#l7.23"></a><span id="l7.23">                           label=&quot;&amp;getNewMsgCurrentAccountCmdPopupMenu.label;&quot;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -823,18 +822,17 @@</span>
<a href="#l7.25"></a><span id="l7.25">             &lt;menuitem id=&quot;appmenu_goChat&quot;</span>
<a href="#l7.26"></a><span id="l7.26">                       label=&quot;&amp;goChatCmd.label;&quot;</span>
<a href="#l7.27"></a><span id="l7.27">                       key=&quot;key_goChat&quot;</span>
<a href="#l7.28"></a><span id="l7.28">                       command=&quot;cmd_chat&quot;/&gt;</span>
<a href="#l7.29"></a><span id="l7.29">             &lt;menuseparator id=&quot;appmenu_goChatSeparator&quot;/&gt;</span>
<a href="#l7.30"></a><span id="l7.30">             &lt;menu id=&quot;appmenu_goFolderMenu&quot;</span>
<a href="#l7.31"></a><span id="l7.31">                   label=&quot;&amp;folderMenu.label;&quot;</span>
<a href="#l7.32"></a><span id="l7.32">                   command=&quot;cmd_goFolder&quot;&gt;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-              &lt;menupopup id=&quot;appmenu_GoFolderPopup&quot;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-                         type=&quot;folder&quot;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;appmenu_GoFolderPopup&quot;</span>
<a href="#l7.36"></a><span id="l7.36">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l7.37"></a><span id="l7.37">                          showRecent=&quot;true&quot;</span>
<a href="#l7.38"></a><span id="l7.38">                          recentLabel=&quot;&amp;contextMoveCopyMsgRecentMenu.label;&quot;/&gt;</span>
<a href="#l7.39"></a><span id="l7.39">             &lt;/menu&gt;</span>
<a href="#l7.40"></a><span id="l7.40">             &lt;menuseparator id=&quot;appmenu_goFolderSeparator&quot;/&gt;</span>
<a href="#l7.41"></a><span id="l7.41">             &lt;menu id=&quot;appmenu_goRecentlyClosedTabs&quot;</span>
<a href="#l7.42"></a><span id="l7.42">                   label=&quot;&amp;goRecentlyClosedTabs.label;&quot;</span>
<a href="#l7.43"></a><span id="l7.43">                   observes=&quot;cmd_undoCloseTab&quot;&gt;</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineat">@@ -1004,29 +1002,29 @@</span>
<a href="#l7.45"></a><span id="l7.45">                       key=&quot;key_archive&quot;</span>
<a href="#l7.46"></a><span id="l7.46">                       command=&quot;cmd_archive&quot;/&gt;</span>
<a href="#l7.47"></a><span id="l7.47">             &lt;menuitem id=&quot;appmenu_cancel&quot;</span>
<a href="#l7.48"></a><span id="l7.48">                       command=&quot;cmd_cancel&quot;</span>
<a href="#l7.49"></a><span id="l7.49">                       label=&quot;&amp;cancelNewsMsgCmd.label;&quot;/&gt;</span>
<a href="#l7.50"></a><span id="l7.50">             &lt;menu id=&quot;appmenu_moveMenu&quot;</span>
<a href="#l7.51"></a><span id="l7.51">                   label=&quot;&amp;moveMsgToMenu.label;&quot;</span>
<a href="#l7.52"></a><span id="l7.52">                   oncommand=&quot;MsgMoveMessage(event.target._folder)&quot;&gt;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-              &lt;menupopup type=&quot;folder&quot;</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot;</span>
<a href="#l7.55"></a><span id="l7.55">                          mode=&quot;filing&quot;</span>
<a href="#l7.56"></a><span id="l7.56">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l7.57"></a><span id="l7.57">                          showRecent=&quot;true&quot;</span>
<a href="#l7.58"></a><span id="l7.58">                          recentLabel=&quot;&amp;moveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l7.59"></a><span id="l7.59">                          showFavorites=&quot;true&quot;</span>
<a href="#l7.60"></a><span id="l7.60">                          favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l7.61"></a><span id="l7.61">                          favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span>
<a href="#l7.62"></a><span id="l7.62">             &lt;/menu&gt;</span>
<a href="#l7.63"></a><span id="l7.63">             &lt;menu id=&quot;appmenu_copyMenu&quot;</span>
<a href="#l7.64"></a><span id="l7.64">                   label=&quot;&amp;copyMsgToMenu.label;&quot;</span>
<a href="#l7.65"></a><span id="l7.65">                   oncommand=&quot;MsgCopyMessage(event.target._folder)&quot;&gt;</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-              &lt;menupopup type=&quot;folder&quot;</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot;</span>
<a href="#l7.68"></a><span id="l7.68">                          mode=&quot;filing&quot;</span>
<a href="#l7.69"></a><span id="l7.69">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l7.70"></a><span id="l7.70">                          showRecent=&quot;true&quot;</span>
<a href="#l7.71"></a><span id="l7.71">                          recentLabel=&quot;&amp;moveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l7.72"></a><span id="l7.72">                          showFavorites=&quot;true&quot;</span>
<a href="#l7.73"></a><span id="l7.73">                          favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l7.74"></a><span id="l7.74">                          favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span>
<a href="#l7.75"></a><span id="l7.75">             &lt;/menu&gt;</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineat">@@ -1482,33 +1480,31 @@</span>
<a href="#l7.77"></a><span id="l7.77">     &lt;menuitem id=&quot;mailContext-archive&quot;</span>
<a href="#l7.78"></a><span id="l7.78">               label=&quot;&amp;contextArchive.label;&quot;</span>
<a href="#l7.79"></a><span id="l7.79">               accesskey=&quot;&amp;contextArchive.accesskey;&quot;</span>
<a href="#l7.80"></a><span id="l7.80">               oncommand=&quot;MsgArchiveSelectedMessages(event);&quot;/&gt;</span>
<a href="#l7.81"></a><span id="l7.81">     &lt;menu id=&quot;mailContext-moveMenu&quot;</span>
<a href="#l7.82"></a><span id="l7.82">           label=&quot;&amp;contextMoveMsgMenu.label;&quot;</span>
<a href="#l7.83"></a><span id="l7.83">           accesskey=&quot;&amp;contextMoveMsgMenu.accesskey;&quot;</span>
<a href="#l7.84"></a><span id="l7.84">           oncommand=&quot;MsgMoveMessage(event.target._folder)&quot;&gt;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-      &lt;menupopup id=&quot;mailContext-fileHereMenu&quot;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-                 type=&quot;folder&quot;</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+      &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;mailContext-fileHereMenu&quot;</span>
<a href="#l7.88"></a><span id="l7.88">                  mode=&quot;filing&quot;</span>
<a href="#l7.89"></a><span id="l7.89">                  showFileHereLabel=&quot;true&quot;</span>
<a href="#l7.90"></a><span id="l7.90">                  showRecent=&quot;true&quot;</span>
<a href="#l7.91"></a><span id="l7.91">                  recentLabel=&quot;&amp;contextMoveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l7.92"></a><span id="l7.92">                  recentAccessKey=&quot;&amp;contextMoveCopyMsgRecentMenu.accesskey;&quot;</span>
<a href="#l7.93"></a><span id="l7.93">                  showFavorites=&quot;true&quot;</span>
<a href="#l7.94"></a><span id="l7.94">                  favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l7.95"></a><span id="l7.95">                  favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span>
<a href="#l7.96"></a><span id="l7.96">     &lt;/menu&gt;</span>
<a href="#l7.97"></a><span id="l7.97">     &lt;menu id=&quot;mailContext-copyMenu&quot;</span>
<a href="#l7.98"></a><span id="l7.98">           label=&quot;&amp;contextCopyMsgMenu.label;&quot;</span>
<a href="#l7.99"></a><span id="l7.99">           accesskey=&quot;&amp;contextCopyMsgMenu.accesskey;&quot;</span>
<a href="#l7.100"></a><span id="l7.100">           oncommand=&quot;MsgCopyMessage(event.target._folder)&quot;&gt;</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-      &lt;menupopup id=&quot;mailContext-copyHereMenu&quot;</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-                 type=&quot;folder&quot;</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+      &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;mailContext-copyHereMenu&quot;</span>
<a href="#l7.104"></a><span id="l7.104">                  mode=&quot;filing&quot;</span>
<a href="#l7.105"></a><span id="l7.105">                  showFileHereLabel=&quot;true&quot;</span>
<a href="#l7.106"></a><span id="l7.106">                  showRecent=&quot;true&quot;</span>
<a href="#l7.107"></a><span id="l7.107">                  recentLabel=&quot;&amp;contextMoveCopyMsgRecentMenu.label;&quot;</span>
<a href="#l7.108"></a><span id="l7.108">                  recentAccessKey=&quot;&amp;contextMoveCopyMsgRecentMenu.accesskey;&quot;</span>
<a href="#l7.109"></a><span id="l7.109">                  showFavorites=&quot;true&quot;</span>
<a href="#l7.110"></a><span id="l7.110">                  favoritesLabel=&quot;&amp;contextMoveCopyMsgFavoritesMenu.label;&quot;</span>
<a href="#l7.111"></a><span id="l7.111">                  favoritesAccessKey=&quot;&amp;contextMoveCopyMsgFavoritesMenu.accesskey;&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/messenger.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/messenger.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -67,20 +67,16 @@ searchterm {</span>
<a href="#l8.4"></a><span id="l8.4"> .remote-gloda-search-container {</span>
<a href="#l8.5"></a><span id="l8.5">   min-width: 10em;</span>
<a href="#l8.6"></a><span id="l8.6"> }</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> tabmail {</span>
<a href="#l8.9"></a><span id="l8.9">   -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-menupopup[type=&quot;folder&quot;] {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/content/folderWidgets.xml#folder-menupopup&quot;);</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-}</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-</span>
<a href="#l8.16"></a><span id="l8.16"> .chromeclass-toolbar {</span>
<a href="#l8.17"></a><span id="l8.17">   overflow-x: hidden;</span>
<a href="#l8.18"></a><span id="l8.18"> }</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20"> /* Lightweight themes support */</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22"> :root:-moz-lwtheme {</span>
<a href="#l8.23"></a><span id="l8.23">   --toolbar-color: var(--lwt-text-color, inherit);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/compose/content/messengercompose.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/compose/content/messengercompose.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1687,18 +1687,18 @@</span>
<a href="#l9.4"></a><span id="l9.4">               &lt;menuitem type=&quot;radio&quot; name=&quot;priority&quot; label=&quot;&amp;normalPriorityCmd.label;&quot; accesskey=&quot;&amp;normalPriorityCmd.accesskey;&quot; value=&quot;Normal&quot; id=&quot;priority_normal&quot; checked=&quot;true&quot;/&gt;</span>
<a href="#l9.5"></a><span id="l9.5">               &lt;menuitem type=&quot;radio&quot; name=&quot;priority&quot; label=&quot;&amp;lowPriorityCmd.label;&quot; accesskey=&quot;&amp;lowPriorityCmd.accesskey;&quot; value=&quot;Low&quot; id=&quot;priority_low&quot;/&gt;</span>
<a href="#l9.6"></a><span id="l9.6">               &lt;menuitem type=&quot;radio&quot; name=&quot;priority&quot; label=&quot;&amp;lowestPriorityCmd.label;&quot; accesskey=&quot;&amp;lowestPriorityCmd.accesskey;&quot; value=&quot;Lowest&quot;  id=&quot;priority_lowest&quot;/&gt;</span>
<a href="#l9.7"></a><span id="l9.7">             &lt;/menupopup&gt;</span>
<a href="#l9.8"></a><span id="l9.8">           &lt;/menu&gt;</span>
<a href="#l9.9"></a><span id="l9.9">           &lt;menu id=&quot;fccMenu&quot; label=&quot;&amp;fileCarbonCopyCmd.label;&quot;</span>
<a href="#l9.10"></a><span id="l9.10">                 accesskey=&quot;&amp;fileCarbonCopyCmd.accesskey;&quot;</span>
<a href="#l9.11"></a><span id="l9.11">                 oncommand=&quot;MessageFcc(event.target._folder)&quot;&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-            &lt;menupopup id=&quot;fccMenuPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot; showFileHereLabel=&quot;true&quot;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                       fileHereLabel=&quot;&amp;fileHereMenu.label;&quot;/&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+            &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;fccMenuPopup&quot; mode=&quot;filing&quot;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+                       showFileHereLabel=&quot;true&quot; fileHereLabel=&quot;&amp;fileHereMenu.label;&quot;/&gt;</span>
<a href="#l9.16"></a><span id="l9.16">           &lt;/menu&gt;</span>
<a href="#l9.17"></a><span id="l9.17">           &lt;menuseparator/&gt;</span>
<a href="#l9.18"></a><span id="l9.18">           &lt;menuitem type=&quot;checkbox&quot; command=&quot;cmd_customizeFromAddress&quot;</span>
<a href="#l9.19"></a><span id="l9.19">                     accesskey=&quot;&amp;customizeFromAddress.accesskey;&quot;/&gt;</span>
<a href="#l9.20"></a><span id="l9.20">           &lt;menuseparator id=&quot;smimeOptionsSeparator&quot;/&gt;</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22">           &lt;menuitem id=&quot;menu_securityEncryptRequire1&quot;</span>
<a href="#l9.23"></a><span id="l9.23">                     type=&quot;checkbox&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/folder-widget/test-message-filters.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/folder-widget/test-message-filters.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -69,17 +69,17 @@ function test_message_filter_shows_newsg</span>
<a href="#l10.4"></a><span id="l10.4">   // filterc.select(popup, 2);</span>
<a href="#l10.5"></a><span id="l10.5">   // let nntpPopup = new elib.Elem(nntp.node.menupopup);</span>
<a href="#l10.6"></a><span id="l10.6">   // filterc.click(nntpPopup);</span>
<a href="#l10.7"></a><span id="l10.7">   // filterc.mouseover(nntpPopup);</span>
<a href="#l10.8"></a><span id="l10.8">   // filterc.select(nntpPopup, 2);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">   // This one initializes the menuitems, but it's kinda hacky.</span>
<a href="#l10.11"></a><span id="l10.11">   nntp.node.menupopup._ensureInitialized();</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  assert_equals(nntp.node.itemCount, 5,</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  assert_equals(nntp.node.itemCount, 3,</span>
<a href="#l10.14"></a><span id="l10.14">                 &quot;Incorrect number of children for the NNTP server&quot;);</span>
<a href="#l10.15"></a><span id="l10.15">   close_window(filterc);</span>
<a href="#l10.16"></a><span id="l10.16"> }</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> /*</span>
<a href="#l10.19"></a><span id="l10.19">  * Test that customizing the toolbar doesn't lead to doubled accounts in</span>
<a href="#l10.20"></a><span id="l10.20">  * the Get Mail menu.  (bug 520457)</span>
<a href="#l10.21"></a><span id="l10.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/themes/windows/mail/messenger.css</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/themes/windows/mail/messenger.css</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -520,29 +520,29 @@ treechildren::-moz-tree-indentation {</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> :root[lwt-tree-brighttext] #threadTree treechildren::-moz-tree-row(untagged, selected),</span>
<a href="#l11.6"></a><span id="l11.6"> :root[lwt-tree-brighttext]:-moz-window-inactive #threadTree treechildren::-moz-tree-row(selected),</span>
<a href="#l11.7"></a><span id="l11.7"> :root[lwt-tree-brighttext] tree:not(#threadTree) treechildren::-moz-tree-row(selected) {</span>
<a href="#l11.8"></a><span id="l11.8">   border-color: var(--sidebar-highlight-background-color, rgba(249,249,250,.1));</span>
<a href="#l11.9"></a><span id="l11.9">   background: var(--sidebar-highlight-background-color, rgba(249,249,250,.1));</span>
<a href="#l11.10"></a><span id="l11.10"> }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-/* Give menupopup[type=&quot;folder&quot;] a menu look */</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-menupopup[type=&quot;folder&quot;] {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+/* Give menupopup[is=&quot;folder-menupopup&quot;] a menu look */</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+menupopup[is=&quot;folder-menupopup&quot;] {</span>
<a href="#l11.16"></a><span id="l11.16">   -moz-appearance: menupopup;</span>
<a href="#l11.17"></a><span id="l11.17"> }</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-menupopup[type=&quot;folder&quot;] menu[_moz-menuactive=&quot;true&quot;],</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-menupopup[type=&quot;folder&quot;] menuitem[_moz-menuactive=&quot;true&quot;] {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+menupopup[is=&quot;folder-menupopup&quot;] menu[_moz-menuactive=&quot;true&quot;],</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+menupopup[is=&quot;folder-menupopup&quot;] menuitem[_moz-menuactive=&quot;true&quot;] {</span>
<a href="#l11.23"></a><span id="l11.23">   color: -moz-MenuHoverText;</span>
<a href="#l11.24"></a><span id="l11.24">   background-color: -moz-MenuHover;</span>
<a href="#l11.25"></a><span id="l11.25"> }</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-menupopup[type=&quot;folder&quot;] &gt; menu,</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-menupopup[type=&quot;folder&quot;] &gt; menuitem {</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+menupopup[is=&quot;folder-menupopup&quot;] &gt; menu,</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+menupopup[is=&quot;folder-menupopup&quot;] &gt; menuitem {</span>
<a href="#l11.31"></a><span id="l11.31">   -moz-appearance: menuitem !important;</span>
<a href="#l11.32"></a><span id="l11.32">   padding-right: 0;</span>
<a href="#l11.33"></a><span id="l11.33">   padding-left: 0;</span>
<a href="#l11.34"></a><span id="l11.34"> }</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36"> menulist.folderMenuItem &gt; .menulist-label-box &gt; .menulist-label {</span>
<a href="#l11.37"></a><span id="l11.37">   margin-inline-start: 2px !important;</span>
<a href="#l11.38"></a><span id="l11.38"> }</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineat">@@ -745,17 +745,17 @@ toolbar[mode=&quot;icons&quot;] .toolbarbutton-1:n</span>
<a href="#l11.40"></a><span id="l11.40"> }</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42"> .findbar-button[checked=true]:not(:active):hover,</span>
<a href="#l11.43"></a><span id="l11.43"> .toolbarbutton-1[checked=true]:not(:active):hover {</span>
<a href="#l11.44"></a><span id="l11.44">   background-color: var(--toolbarbutton-checkedhover-backgroundcolor);</span>
<a href="#l11.45"></a><span id="l11.45">   transition: background-color .4s;</span>
<a href="#l11.46"></a><span id="l11.46"> }</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-menulist &gt; menupopup:not([type=&quot;folder&quot;]) &gt; menuseparator {</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+menulist &gt; menupopup:not([is=&quot;folder-menupopup&quot;]) &gt; menuseparator {</span>
<a href="#l11.50"></a><span id="l11.50">   -moz-appearance: none;</span>
<a href="#l11.51"></a><span id="l11.51">   margin-top: 3px;</span>
<a href="#l11.52"></a><span id="l11.52">   margin-bottom: 3px;</span>
<a href="#l11.53"></a><span id="l11.53">   padding-top: 0;</span>
<a href="#l11.54"></a><span id="l11.54">   padding-bottom: 0;</span>
<a href="#l11.55"></a><span id="l11.55">   border-top-color: #d7d7d7;</span>
<a href="#l11.56"></a><span id="l11.56"> }</span>
<a href="#l11.57"></a><span id="l11.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">rename from mailnews/base/content/folderWidgets.xml</span>
<a href="#l12.2"></a><span id="l12.2">rename to mailnews/base/content/folder-menupopup.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/mailnews/base/content/folderWidgets.xml</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/mailnews/base/content/folder-menupopup.js</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -1,890 +1,914 @@</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">-&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">-   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">---&gt;</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-&lt;bindings id=&quot;mailFolderBindings&quot;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+/* globals MozElements */</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24" class="difflineminus">-  &lt;binding id=&quot;folder-menupopup&quot;</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineminus">-           extends=&quot;chrome://global/content/bindings/popup.xml#popup&quot;&gt;</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/FeedUtils.jsm&quot;, this);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;, this);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;, this);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;, this);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;, this);</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-        ChromeUtils.import(&quot;resource:///modules/StringBundle.js&quot;, this);</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-        this._stringBundle = new this</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-            .StringBundle(&quot;chrome://messenger/locale/folderWidgets.properties&quot;);</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+// This is loaded into all XUL windows. Wrap in a block to prevent</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+// leaking to window scope.</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+{</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  const { FeedUtils } = ChromeUtils.import(&quot;resource:///modules/FeedUtils.jsm&quot;);</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+  const { allAccountsSorted, folderNameCompare, getSpecialFolderString, getMostRecentFolders } =</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+    ChromeUtils.import(&quot;resource:///modules/folderUtils.jsm&quot;);</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+  const { fixIterator, toArray } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+  const { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+  const { MailUtils } = ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+  const { StringBundle } = ChromeUtils.import(&quot;resource:///modules/StringBundle.js&quot;);</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-        // Get the displayformat if set.</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-        if (this.parentNode &amp;&amp; this.parentNode.localName == &quot;menulist&quot;)</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-          this._displayformat = this.parentNode.getAttribute(&quot;displayformat&quot;);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+  /**</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+   * The MozFolderMenupopup widget is used as a menupopup for selecting</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+   * a folder from the list of all the folders from every account. It is also</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+   * used for selecting the account from the list of all the accounts. The each</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+   * menuitem gets displayed with the folder or account name and icon.</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+   *</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+   * @extends {MozElements.MozMenuPopup}</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+   */</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+  class MozFolderMenupopup extends MozElements.MozMenuPopup {</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+    constructor() {</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+      super();</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+      // In order to improve performance, we're not going to build any of the</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+      // menu until we're shown.</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+      // note: _ensureInitialized can be called repeatedly without issue, so</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+      //       don't worry about it here.</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+      this.addEventListener(&quot;popupshowing&quot;, (event) =&gt; {</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+        this._ensureInitialized();</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+      }, true);</span>
<a href="#l12.69"></a><span id="l12.69"> </span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-        // Find out if we are in a wrapper (customize toolbars mode is active).</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineminus">-        let inWrapper = false;</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-        let node = this;</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-        while (node instanceof XULElement) {</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-          if (node.id.startsWith(&quot;wrapper-&quot;)) {</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-            inWrapper = true;</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineminus">-            break;</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineminus">-          }</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-          node = node.parentNode;</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineminus">-        }</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+      window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineplus">+        this._removeListener();</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+      }, { once: true });</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+      // If non-null, the subFolders of this nsIMsgFolder will be used to</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+      // populate this menu.  If this is null, the menu will be populated</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineplus">+      // using the root-folders for all accounts.</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+      this._parentFolder = null;</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+      this._stringBundle = null;</span>
<a href="#l12.90"></a><span id="l12.90"> </span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-        if (!inWrapper) {</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-          if (this.hasAttribute(&quot;original-width&quot;)) {</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-            // If we were in a wrapper before and have a width stored, restore it now.</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-            if (this.getAttribute(&quot;original-width&quot;) == &quot;none&quot;)</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-              this.removeAttribute(&quot;width&quot;);</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-            else</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-              this.setAttribute(&quot;width&quot;, this.getAttribute(&quot;original-width&quot;));</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineminus">-</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-            this.removeAttribute(&quot;original-width&quot;);</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+      // Various filtering modes can be used with this menu-binding. To use</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineplus">+      // one of them, append the mode=&quot;foo&quot; attribute to the element. When</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineplus">+      // building the menu, we will then use this._filters[mode] as a filter</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineplus">+      // function to eliminate folders that should not be shown.</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+      // note: extensions should feel free to plug in here.</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+      this._filters = {</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineplus">+        // Returns true if messages can be filed in the folder.</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineplus">+        filing(folder) {</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+          if (!folder.server.canFileMessagesOnServer) {</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+            return false;</span>
<a href="#l12.110"></a><span id="l12.110">           }</span>
<a href="#l12.111"></a><span id="l12.111"> </span>
<a href="#l12.112"></a><span id="l12.112" class="difflineminus">-          // If we are a child of a menulist, and we aren't in a wrapper, we</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineminus">-          // need to build our content right away, otherwise the menulist</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-          // won't have proper sizing.</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-          if (this.parentNode &amp;&amp; this.parentNode.localName == &quot;menulist&quot;)</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-            this._ensureInitialized();</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineminus">-        } else {</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineminus">-          // But if we're in a wrapper, remove our children, because we're</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineminus">-          // getting re-created when the toolbar customization closes.</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-          this._teardown();</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineminus">-</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineminus">-          // Store our current width and set a safe small width when we show</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineminus">-          // in a wrapper.</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-          if (!this.hasAttribute(&quot;original-width&quot;)) {</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineminus">-            this.setAttribute(&quot;original-width&quot;, this.hasAttribute(&quot;width&quot;) ?</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineminus">-                                                this.getAttribute(&quot;width&quot;) : &quot;none&quot;);</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineminus">-            this.setAttribute(&quot;width&quot;, &quot;100&quot;);</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-          }</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineminus">-        }</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-        // Clean up when being destroyed.</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-        this._removeListener();</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-        this._teardown();</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineminus">-      &lt;!--</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-         - Make sure we remove our listener when the window is being destroyed</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineminus">-         - or the widget teared down.</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-        --&gt;</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineminus">-      &lt;method name=&quot;_removeListener&quot;&gt;</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-          if (!this._initialized)</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineminus">-            return;</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineminus">-</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-          this.MailServices.mailSession.RemoveFolderListener(this._listener);</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineminus">-</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineminus">-      &lt;field name=&quot;_stringBundle&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineminus">-</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineminus">-      &lt;!--</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineminus">-         - If non-null, the subFolders of this nsIMsgFolder will be used to</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineminus">-         - populate this menu.  If this is null, the menu will be populated</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineminus">-         - using the root-folders for all accounts</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineminus">-        --&gt;</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-      &lt;field name=&quot;_parentFolder&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-      &lt;property name=&quot;parentFolder&quot;</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-                onget=&quot;return this._parentFolder;&quot;</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-                onset=&quot;return this._parentFolder = val;&quot;/&gt;</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineminus">-      &lt;!--</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineminus">-         - Various filtering modes can be used with this menu-binding.  To use</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-         - one of them, append the mode=&quot;foo&quot; attribute to the element.  When</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-         - building the menu, we will then use this._filters[mode] as a filter</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-         - function to eliminate folders that should not be shown.</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineminus">-         -</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineminus">-         - Note that extensions should feel free to plug in here!</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineminus">-        --&gt;</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineminus">-      &lt;field name=&quot;_filters&quot;&gt;&lt;![CDATA[({</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineminus">-        // Returns true if messages can be filed in the folder</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineminus">-        filing(aFolder) {</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineminus">-          if (!aFolder.server.canFileMessagesOnServer)</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineminus">-            return false;</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineminus">-          return (aFolder.canFileMessages || aFolder.hasSubFolders);</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineplus">+          return (folder.canFileMessages || folder.hasSubFolders);</span>
<a href="#l12.177"></a><span id="l12.177">         },</span>
<a href="#l12.178"></a><span id="l12.178"> </span>
<a href="#l12.179"></a><span id="l12.179">         // Returns true if we can get mail for this folder. (usually this just</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineminus">-        // means the &quot;root&quot; fake folder)</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineminus">-        getMail(aFolder) {</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineminus">-          if (aFolder.isServer &amp;&amp; aFolder.server.type != &quot;none&quot;)</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineplus">+        // means the &quot;root&quot; fake folder).</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+        getMail(folder) {</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+          if (folder.isServer &amp;&amp; folder.server.type != &quot;none&quot;) {</span>
<a href="#l12.186"></a><span id="l12.186">             return true;</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineminus">-          if (aFolder.server.type == &quot;nntp&quot; || aFolder.server.type == &quot;rss&quot;)</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineplus">+          }</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineplus">+          if (folder.server.type == &quot;nntp&quot; || folder.server.type == &quot;rss&quot;) {</span>
<a href="#l12.190"></a><span id="l12.190">             return true;</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineplus">+          }</span>
<a href="#l12.192"></a><span id="l12.192">           return false;</span>
<a href="#l12.193"></a><span id="l12.193">         },</span>
<a href="#l12.194"></a><span id="l12.194"> </span>
<a href="#l12.195"></a><span id="l12.195" class="difflineminus">-        // Returns true if we can add filters to this folder/account</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineminus">-        filters(aFolder) {</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-          // We can always filter news</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-          if (aFolder.server.type == &quot;nntp&quot;)</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineplus">+        // Returns true if we can add filters to this folder/account.</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineplus">+        filters(folder) {</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineplus">+          // We can always filter news.</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+          if (folder.server.type == &quot;nntp&quot;) {</span>
<a href="#l12.203"></a><span id="l12.203">             return true;</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+          }</span>
<a href="#l12.205"></a><span id="l12.205"> </span>
<a href="#l12.206"></a><span id="l12.206" class="difflineminus">-          return aFolder.server.canHaveFilters;</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+          return folder.server.canHaveFilters;</span>
<a href="#l12.208"></a><span id="l12.208">         },</span>
<a href="#l12.209"></a><span id="l12.209"> </span>
<a href="#l12.210"></a><span id="l12.210" class="difflineminus">-        subscribe(aFolder) {</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-          return aFolder.canSubscribe;</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineplus">+        subscribe(folder) {</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineplus">+          return folder.canSubscribe;</span>
<a href="#l12.214"></a><span id="l12.214">         },</span>
<a href="#l12.215"></a><span id="l12.215"> </span>
<a href="#l12.216"></a><span id="l12.216" class="difflineminus">-        newFolder(aFolder) {</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineminus">-          return aFolder.canCreateSubfolders &amp;&amp;</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineminus">-                 aFolder.server.canCreateFoldersOnServer;</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+        newFolder(folder) {</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineplus">+          return folder.canCreateSubfolders &amp;&amp;</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineplus">+            folder.server.canCreateFoldersOnServer;</span>
<a href="#l12.222"></a><span id="l12.222">         },</span>
<a href="#l12.223"></a><span id="l12.223"> </span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-        deferred(aFolder) {</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-          return aFolder.server.canCreateFoldersOnServer &amp;&amp;</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-                 !aFolder.supportsOffline;</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineplus">+        deferred(folder) {</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineplus">+          return folder.server.canCreateFoldersOnServer &amp;&amp;</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineplus">+            !folder.supportsOffline;</span>
<a href="#l12.230"></a><span id="l12.230">         },</span>
<a href="#l12.231"></a><span id="l12.231"> </span>
<a href="#l12.232"></a><span id="l12.232" class="difflineminus">-        // Folders that are not in a deferred account</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineminus">-        notDeferred(aFolder) {</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineminus">-          let server = aFolder.server;</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineplus">+        // Folders that are not in a deferred account.</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+        notDeferred(folder) {</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineplus">+          let server = folder.server;</span>
<a href="#l12.238"></a><span id="l12.238">           return !(server instanceof Ci.nsIPop3IncomingServer &amp;&amp;</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineminus">-                   server.deferredToAccount);</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineplus">+            server.deferredToAccount);</span>
<a href="#l12.241"></a><span id="l12.241">         },</span>
<a href="#l12.242"></a><span id="l12.242"> </span>
<a href="#l12.243"></a><span id="l12.243">         // Folders that can be searched.</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineminus">-        search(aFolder) {</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-          if (!aFolder.server.canSearchMessages ||</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineminus">-              aFolder.getFlag(Ci.nsMsgFolderFlags.Virtual))</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineplus">+        search(folder) {</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineplus">+          if (!folder.server.canSearchMessages ||</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineplus">+            folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l12.250"></a><span id="l12.250">             return false;</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineplus">+          }</span>
<a href="#l12.252"></a><span id="l12.252">           return true;</span>
<a href="#l12.253"></a><span id="l12.253">         },</span>
<a href="#l12.254"></a><span id="l12.254"> </span>
<a href="#l12.255"></a><span id="l12.255">         // Folders that can subscribe feeds.</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineminus">-        feeds(aFolder) {</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineminus">-          if (aFolder.server.type != &quot;rss&quot; ||</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineminus">-              aFolder.getFlag(Ci.nsMsgFolderFlags.Trash) ||</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineminus">-              aFolder.getFlag(Ci.nsMsgFolderFlags.Virtual))</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+        feeds(folder) {</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+          if (folder.server.type != &quot;rss&quot; ||</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+            folder.getFlag(Ci.nsMsgFolderFlags.Trash) ||</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineplus">+            folder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l12.264"></a><span id="l12.264">             return false;</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+          }</span>
<a href="#l12.266"></a><span id="l12.266">           return true;</span>
<a href="#l12.267"></a><span id="l12.267">         },</span>
<a href="#l12.268"></a><span id="l12.268"> </span>
<a href="#l12.269"></a><span id="l12.269" class="difflineminus">-        junk(aFolder) {</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineplus">+        junk(folder) {</span>
<a href="#l12.271"></a><span id="l12.271">           // Don't show servers (nntp &amp; any others) which do not allow search or filing</span>
<a href="#l12.272"></a><span id="l12.272">           // I don't really understand why canSearchMessages is needed, but it was included in</span>
<a href="#l12.273"></a><span id="l12.273">           // earlier code, so I include it as well.</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineminus">-          if (!aFolder.server.canFileMessagesOnServer || !aFolder.server.canSearchMessages)</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineplus">+          if (!folder.server.canFileMessagesOnServer || !folder.server.canSearchMessages) {</span>
<a href="#l12.276"></a><span id="l12.276">             return false;</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-          // show parents that might have usable subfolders, or usable folders</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-          return aFolder.hasSubFolders || aFolder.canFileMessages;</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineplus">+          }</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineplus">+          // Show parents that might have usable subfolders, or usable folders.</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineplus">+          return folder.hasSubFolders || folder.canFileMessages;</span>
<a href="#l12.282"></a><span id="l12.282">         },</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineminus">-      })]]&gt;&lt;/field&gt;</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineplus">+      };</span>
<a href="#l12.285"></a><span id="l12.285"> </span>
<a href="#l12.286"></a><span id="l12.286" class="difflineminus">-      &lt;!--</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineminus">-         - The maximum number of entries in the &quot;Recent&quot; menu</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineminus">-        --&gt;</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineminus">-      &lt;field name=&quot;_MAXRECENT&quot;&gt;15&lt;/field&gt;</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineplus">+      // The maximum number of entries in the &quot;Recent&quot; menu.</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineplus">+      this._MAXRECENT = 15;</span>
<a href="#l12.292"></a><span id="l12.292"> </span>
<a href="#l12.293"></a><span id="l12.293" class="difflineminus">-      &lt;!--</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineminus">-         - Is this list containing only servers (accounts) and no real folders?</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineminus">-        --&gt;</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineminus">-      &lt;field name=&quot;_serversOnly&quot;&gt;true&lt;/field&gt;</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineplus">+      // Is this list containing only servers (accounts) and no real folders?</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineplus">+      this._serversOnly = true;</span>
<a href="#l12.299"></a><span id="l12.299"> </span>
<a href="#l12.300"></a><span id="l12.300" class="difflineminus">-      &lt;!--</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineminus">-         - Our listener to let us know when folders change/appear/disappear so</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineminus">-         - we can know to rebuild ourselves.</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineminus">-        --&gt;</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineminus">-      &lt;field name=&quot;_listener&quot;&gt;</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineminus">-          &lt;![CDATA[({</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineplus">+      /**</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineplus">+       * Our listener to let us know when folders change/appear/disappear so</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineplus">+       * we can know to rebuild ourselves.</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineplus">+       *</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineplus">+       * @implements {nsIFolderListener}</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+       */</span>
<a href="#l12.312"></a><span id="l12.312" class="difflineplus">+      this._listener = {</span>
<a href="#l12.313"></a><span id="l12.313">         _menu: this,</span>
<a href="#l12.314"></a><span id="l12.314">         _clearMenu(menu) {</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineminus">-          // xxx I'm not quite sure why this isn't always a function (bug 514445)</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineminus">-          if (menu._teardown)</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineplus">+          // I'm not quite sure why this isn't always a function (bug 514445).</span>
<a href="#l12.318"></a><span id="l12.318" class="difflineplus">+          if (menu._teardown) {</span>
<a href="#l12.319"></a><span id="l12.319">             menu._teardown();</span>
<a href="#l12.320"></a><span id="l12.320" class="difflineplus">+          }</span>
<a href="#l12.321"></a><span id="l12.321">         },</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineminus">-        OnItemAdded(aRDFParentItem, aItem) {</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineminus">-          if (!(aItem instanceof Ci.nsIMsgFolder))</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineminus">-            return;</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineminus">-          if (this._filterFunction &amp;&amp; !this._filterFunction(aItem)) {</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineplus">+        OnItemAdded(RDFParentItem, item) {</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineplus">+          if (!(item instanceof Ci.nsIMsgFolder)) {</span>
<a href="#l12.328"></a><span id="l12.328">             return;</span>
<a href="#l12.329"></a><span id="l12.329">           }</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineminus">-          // xxx we can optimize this later</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineminus">-          this._clearMenu(this._menu);</span>
<a href="#l12.332"></a><span id="l12.332" class="difflineminus">-        },</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineminus">-</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineminus">-        OnItemRemoved(aRDFParentItem, aItem) {</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineminus">-          if (!(aItem instanceof Ci.nsIMsgFolder))</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineminus">-            return;</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineminus">-          if (this._filterFunction &amp;&amp; !this._filterFunction(aItem)) {</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineplus">+          if (this._filterFunction &amp;&amp; !this._filterFunction(item)) {</span>
<a href="#l12.339"></a><span id="l12.339">             return;</span>
<a href="#l12.340"></a><span id="l12.340">           }</span>
<a href="#l12.341"></a><span id="l12.341">           // xxx we can optimize this later</span>
<a href="#l12.342"></a><span id="l12.342">           this._clearMenu(this._menu);</span>
<a href="#l12.343"></a><span id="l12.343">         },</span>
<a href="#l12.344"></a><span id="l12.344"> </span>
<a href="#l12.345"></a><span id="l12.345" class="difflineplus">+        OnItemRemoved(RDFParentItem, item) {</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineplus">+          if (!(item instanceof Ci.nsIMsgFolder)) {</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineplus">+            return;</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineplus">+          }</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineplus">+          if (this._filterFunction &amp;&amp; !this._filterFunction(item)) {</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineplus">+            return;</span>
<a href="#l12.351"></a><span id="l12.351" class="difflineplus">+          }</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineplus">+          // xxx we can optimize this later.</span>
<a href="#l12.353"></a><span id="l12.353" class="difflineplus">+          this._clearMenu(this._menu);</span>
<a href="#l12.354"></a><span id="l12.354" class="difflineplus">+        },</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineplus">+</span>
<a href="#l12.356"></a><span id="l12.356">         // xxx I stole this listener list from nsMsgFolderDatasource.cpp, but</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineminus">-        //     someone should really document what events are fired when, so that</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineminus">-        //     we make sure we're updating at the right times.</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineminus">-        OnItemPropertyChanged(aItem, aProperty, aOld, aNew) {},</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineminus">-        OnItemIntPropertyChanged(aItem, aProperty, aOld, aNew) {</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineminus">-          if (aItem instanceof Ci.nsIMsgFolder) {</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineminus">-            if (aProperty == &quot;FolderFlag&quot;) {</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineplus">+        // someone should really document what events are fired when, so that</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineplus">+        // we make sure we're updating at the right times.</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineplus">+        OnItemPropertyChanged(item, property, old, newItem) { },</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineplus">+        OnItemIntPropertyChanged(item, property, old, aNew) {</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineplus">+          if (item instanceof Ci.nsIMsgFolder) {</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineplus">+            if (property == &quot;FolderFlag&quot;) {</span>
<a href="#l12.369"></a><span id="l12.369">               if (this._menu.getAttribute(&quot;showFavorites&quot;) != &quot;true&quot; ||</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineminus">-                  !this._menu._initializedSpecials.has(&quot;favorites&quot;))</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineplus">+                !this._menu._initializedSpecials.has(&quot;favorites&quot;)) {</span>
<a href="#l12.372"></a><span id="l12.372">                 return;</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineplus">+              }</span>
<a href="#l12.374"></a><span id="l12.374"> </span>
<a href="#l12.375"></a><span id="l12.375" class="difflineminus">-              if ((aOld &amp; Ci.nsMsgFolderFlags.Favorite) !=</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineminus">-                 (aNew &amp; Ci.nsMsgFolderFlags.Favorite))</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineminus">-               setTimeout(this._clearMenu, 0, this._menu);</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineplus">+              if ((old &amp; Ci.nsMsgFolderFlags.Favorite) !=</span>
<a href="#l12.379"></a><span id="l12.379" class="difflineplus">+                (aNew &amp; Ci.nsMsgFolderFlags.Favorite)) {</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineplus">+                setTimeout(this._clearMenu, 0, this._menu);</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineplus">+              }</span>
<a href="#l12.382"></a><span id="l12.382">             }</span>
<a href="#l12.383"></a><span id="l12.383">           }</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineminus">-          var child = this._getChildForItem(aItem);</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineminus">-          if (child)</span>
<a href="#l12.386"></a><span id="l12.386" class="difflineplus">+          let child = this._getChildForItem(item);</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineplus">+          if (child) {</span>
<a href="#l12.388"></a><span id="l12.388">             this._menu._setCssSelectors(child._folder, child);</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineplus">+          }</span>
<a href="#l12.390"></a><span id="l12.390">         },</span>
<a href="#l12.391"></a><span id="l12.391" class="difflineminus">-        OnItemBoolPropertyChanged(aItem, aProperty, aOld, aNew) {</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineminus">-          var child = this._getChildForItem(aItem);</span>
<a href="#l12.393"></a><span id="l12.393" class="difflineminus">-          if (child)</span>
<a href="#l12.394"></a><span id="l12.394" class="difflineplus">+        OnItemBoolPropertyChanged(item, property, old, newItem) {</span>
<a href="#l12.395"></a><span id="l12.395" class="difflineplus">+          let child = this._getChildForItem(item);</span>
<a href="#l12.396"></a><span id="l12.396" class="difflineplus">+          if (child) {</span>
<a href="#l12.397"></a><span id="l12.397">             this._menu._setCssSelectors(child._folder, child);</span>
<a href="#l12.398"></a><span id="l12.398" class="difflineplus">+          }</span>
<a href="#l12.399"></a><span id="l12.399">         },</span>
<a href="#l12.400"></a><span id="l12.400" class="difflineminus">-        OnItemUnicharPropertyChanged(aItem, aProperty, aOld, aNew) {</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineminus">-          var child = this._getChildForItem(aItem);</span>
<a href="#l12.402"></a><span id="l12.402" class="difflineminus">-          if (child)</span>
<a href="#l12.403"></a><span id="l12.403" class="difflineplus">+        OnItemUnicharPropertyChanged(item, property, old, newItem) {</span>
<a href="#l12.404"></a><span id="l12.404" class="difflineplus">+          let child = this._getChildForItem(item);</span>
<a href="#l12.405"></a><span id="l12.405" class="difflineplus">+          if (child) {</span>
<a href="#l12.406"></a><span id="l12.406">             this._menu._setCssSelectors(child._folder, child);</span>
<a href="#l12.407"></a><span id="l12.407" class="difflineplus">+          }</span>
<a href="#l12.408"></a><span id="l12.408">         },</span>
<a href="#l12.409"></a><span id="l12.409" class="difflineminus">-        OnItemPropertyFlagChanged(aItem, aProperty, aOld, aNew) {},</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineminus">-        OnItemEvent(aFolder, aEvent) {</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineminus">-          if (aEvent == &quot;MRMTimeChanged&quot;) {</span>
<a href="#l12.412"></a><span id="l12.412" class="difflineplus">+        OnItemPropertyFlagChanged(item, property, old, newItem) { },</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineplus">+        OnItemEvent(folder, event) {</span>
<a href="#l12.414"></a><span id="l12.414" class="difflineplus">+          if (event == &quot;MRMTimeChanged&quot;) {</span>
<a href="#l12.415"></a><span id="l12.415">             if (this._menu.getAttribute(&quot;showRecent&quot;) != &quot;true&quot; ||</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineminus">-                !this._menu._initializedSpecials.has(&quot;recent&quot;) ||</span>
<a href="#l12.417"></a><span id="l12.417" class="difflineminus">-                !this._menu.firstChild || !this._menu.firstChild.firstChild)</span>
<a href="#l12.418"></a><span id="l12.418" class="difflineplus">+              !this._menu._initializedSpecials.has(&quot;recent&quot;) ||</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineplus">+              !this._menu.firstChild || !this._menu.firstChild.firstChild) {</span>
<a href="#l12.420"></a><span id="l12.420">               return;</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineminus">-            // if this folder is already in the recent menu, return.</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineminus">-            if (this._getChildForItem(aFolder,</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineminus">-                                      this._menu.firstChild.firstChild))</span>
<a href="#l12.424"></a><span id="l12.424" class="difflineplus">+            }</span>
<a href="#l12.425"></a><span id="l12.425" class="difflineplus">+            // If this folder is already in the recent menu, return.</span>
<a href="#l12.426"></a><span id="l12.426" class="difflineplus">+            if (this._getChildForItem(folder,</span>
<a href="#l12.427"></a><span id="l12.427" class="difflineplus">+              this._menu.firstChild.firstChild)) {</span>
<a href="#l12.428"></a><span id="l12.428">               return;</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineminus">-          } else if (aEvent == &quot;RenameCompleted&quot;) {</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineplus">+            }</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineplus">+          } else if (event == &quot;RenameCompleted&quot;) {</span>
<a href="#l12.432"></a><span id="l12.432">             // Special casing folder renames here, since they require more work</span>
<a href="#l12.433"></a><span id="l12.433">             // since sort-order may have changed.</span>
<a href="#l12.434"></a><span id="l12.434" class="difflineminus">-            if (!this._getChildForItem(aFolder))</span>
<a href="#l12.435"></a><span id="l12.435" class="difflineplus">+            if (!this._getChildForItem(folder)) {</span>
<a href="#l12.436"></a><span id="l12.436">               return;</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineplus">+            }</span>
<a href="#l12.438"></a><span id="l12.438">           } else {</span>
<a href="#l12.439"></a><span id="l12.439">             return;</span>
<a href="#l12.440"></a><span id="l12.440">           }</span>
<a href="#l12.441"></a><span id="l12.441" class="difflineminus">-          // folder renamed, or new recent folder, so rebuild.</span>
<a href="#l12.442"></a><span id="l12.442" class="difflineplus">+          // Folder renamed, or new recent folder, so rebuild.</span>
<a href="#l12.443"></a><span id="l12.443">           setTimeout(this._clearMenu, 0, this._menu);</span>
<a href="#l12.444"></a><span id="l12.444">         },</span>
<a href="#l12.445"></a><span id="l12.445"> </span>
<a href="#l12.446"></a><span id="l12.446">         /**</span>
<a href="#l12.447"></a><span id="l12.447">          * Helper function to check and see whether we have a menuitem for this</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineminus">-         * particular nsIMsgFolder</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineplus">+         * particular nsIMsgFolder.</span>
<a href="#l12.450"></a><span id="l12.450">          *</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineminus">-         * @param aItem  the nsIMsgFolder to check</span>
<a href="#l12.452"></a><span id="l12.452" class="difflineminus">-         * @param aMenu  (optional) menu to look in, defaults to this._menu.</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineminus">-         * @returns      null if no child for that folder exists, otherwise the</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineminus">-         *               menuitem for that child</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineplus">+         * @param {nsIMsgFolder} item - the folder to check</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineplus">+         * @param {Menu}              - (optional) menu to look in, defaults to this._menu.</span>
<a href="#l12.457"></a><span id="l12.457" class="difflineplus">+         * @returns {Menuitem|null}   - if no child for that folder exists, otherwise the</span>
<a href="#l12.458"></a><span id="l12.458" class="difflineplus">+         *                              menuitem for that child.</span>
<a href="#l12.459"></a><span id="l12.459">          */</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineminus">-        _getChildForItem(aItem, aMenu) {</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineminus">-          aMenu = aMenu || this._menu;</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineminus">-          if (!aMenu || !aMenu.hasChildNodes())</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineplus">+        _getChildForItem(item, menu) {</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineplus">+          let _menu = menu || this._menu;</span>
<a href="#l12.465"></a><span id="l12.465" class="difflineplus">+          if (!_menu || !_menu.hasChildNodes()) {</span>
<a href="#l12.466"></a><span id="l12.466" class="difflineplus">+            return null;</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineplus">+          }</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineplus">+          if (!(item instanceof Ci.nsIMsgFolder)) {</span>
<a href="#l12.469"></a><span id="l12.469">             return null;</span>
<a href="#l12.470"></a><span id="l12.470" class="difflineplus">+          }</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineplus">+          for (let i = 0; i &lt; _menu.childNodes.length; i++) {</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineplus">+            let folder = _menu.childNodes[i]._folder;</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineplus">+            if (folder &amp;&amp; folder.URI == item.URI) {</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineplus">+              return _menu.childNodes[i];</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineplus">+            }</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineplus">+          }</span>
<a href="#l12.477"></a><span id="l12.477" class="difflineplus">+          return null;</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineplus">+        },</span>
<a href="#l12.479"></a><span id="l12.479" class="difflineplus">+      };</span>
<a href="#l12.480"></a><span id="l12.480"> </span>
<a href="#l12.481"></a><span id="l12.481" class="difflineminus">-           if (!(aItem instanceof Ci.nsIMsgFolder))</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineminus">-             return null;</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineminus">-           for (let i = 0; i &lt; aMenu.childNodes.length; i++) {</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineminus">-             let folder = aMenu.childNodes[i]._folder;</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineminus">-             if (folder &amp;&amp; folder.URI == aItem.URI)</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineminus">-               return aMenu.childNodes[i];</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineminus">-           }</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineminus">-           return null;</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineminus">-        },</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineminus">-      })]]&gt;&lt;/field&gt;</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineplus">+      // True if we have already built our menu-items and are now just</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineplus">+      // listening for changes.</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineplus">+      this._initialized = false;</span>
<a href="#l12.494"></a><span id="l12.494"> </span>
<a href="#l12.495"></a><span id="l12.495" class="difflineminus">-       &lt;!--</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineminus">-         - True if we have already built our menu-items and are now just</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineminus">-         - listening for changes.</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineminus">-         --&gt;</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineminus">-      &lt;field name=&quot;_initialized&quot;&gt;false&lt;/field&gt;</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineplus">+      // A Set listing which of our special menus are already built.</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineplus">+      // E.g. &quot;recent&quot;, &quot;favorites&quot;.</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineplus">+      this._initializedSpecials = new Set();</span>
<a href="#l12.503"></a><span id="l12.503"> </span>
<a href="#l12.504"></a><span id="l12.504" class="difflineminus">-      &lt;!--</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineminus">-         - A Set listing which of our special menus are already built.</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineminus">-         - E.g. &quot;recent&quot;, &quot;favorites&quot;.</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineminus">-        --&gt;</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineminus">-      &lt;field name=&quot;_initializedSpecials&quot;&gt;new Set()&lt;/field&gt;</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineplus">+      this._displayformat = null;</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineplus">+    }</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineplus">+</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineplus">+    connectedCallback() {</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineplus">+      if (this.delayConnectedCallback()) {</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineplus">+        return;</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineplus">+      }</span>
<a href="#l12.516"></a><span id="l12.516"> </span>
<a href="#l12.517"></a><span id="l12.517" class="difflineminus">-      &lt;!--</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineminus">-         - Call this if you are unsure whether the menu-items have been built,</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineminus">-         - but know that they need to be built now if they haven't.</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineminus">-        --&gt;</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineminus">-      &lt;method name=&quot;_ensureInitialized&quot;&gt;</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineminus">-          if (this._initialized)</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineminus">-            return;</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineplus">+      this.setAttribute(&quot;is&quot;, &quot;folder-menupopup&quot;);</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineplus">+</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineplus">+      this._stringBundle = new StringBundle(&quot;chrome://messenger/locale/folderWidgets.properties&quot;);</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineplus">+</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineplus">+      // Get the displayformat if set.</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineplus">+      if (this.parentNode &amp;&amp; this.parentNode.localName == &quot;menulist&quot;) {</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineplus">+        this._displayformat = this.parentNode.getAttribute(&quot;displayformat&quot;);</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineplus">+      }</span>
<a href="#l12.533"></a><span id="l12.533"> </span>
<a href="#l12.534"></a><span id="l12.534" class="difflineminus">-          let folders;</span>
<a href="#l12.535"></a><span id="l12.535" class="difflineminus">-</span>
<a href="#l12.536"></a><span id="l12.536" class="difflineminus">-          // Figure out which folders to build.  If we don't have a parent, then</span>
<a href="#l12.537"></a><span id="l12.537" class="difflineminus">-          // we assume we should build the top-level accounts. (Actually we</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineminus">-          // build the fake root folders for those accounts.)</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineminus">-          if (!this._parentFolder) {</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineminus">-            let accounts = this.allAccountsSorted(true);</span>
<a href="#l12.541"></a><span id="l12.541" class="difflineplus">+      // Find out if we are in a wrapper (customize toolbars mode is active).</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineplus">+      let inWrapper = false;</span>
<a href="#l12.543"></a><span id="l12.543" class="difflineplus">+      let node = this;</span>
<a href="#l12.544"></a><span id="l12.544" class="difflineplus">+      while (node instanceof XULElement) {</span>
<a href="#l12.545"></a><span id="l12.545" class="difflineplus">+        if (node.id.startsWith(&quot;wrapper-&quot;)) {</span>
<a href="#l12.546"></a><span id="l12.546" class="difflineplus">+          inWrapper = true;</span>
<a href="#l12.547"></a><span id="l12.547" class="difflineplus">+          break;</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineplus">+        }</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineplus">+        node = node.parentNode;</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineplus">+      }</span>
<a href="#l12.551"></a><span id="l12.551"> </span>
<a href="#l12.552"></a><span id="l12.552" class="difflineminus">-            // Now generate our folder-list.  Note that we'll special case this</span>
<a href="#l12.553"></a><span id="l12.553" class="difflineminus">-            // situation below, to avoid destroying the sort order we just made</span>
<a href="#l12.554"></a><span id="l12.554" class="difflineminus">-            folders = accounts.map(acct =&gt; acct.incomingServer.rootFolder);</span>
<a href="#l12.555"></a><span id="l12.555" class="difflineplus">+      if (!inWrapper) {</span>
<a href="#l12.556"></a><span id="l12.556" class="difflineplus">+        if (this.hasAttribute(&quot;original-width&quot;)) {</span>
<a href="#l12.557"></a><span id="l12.557" class="difflineplus">+           // If we were in a wrapper before and have a width stored, restore it now.</span>
<a href="#l12.558"></a><span id="l12.558" class="difflineplus">+          if (this.getAttribute(&quot;original-width&quot;) == &quot;none&quot;) {</span>
<a href="#l12.559"></a><span id="l12.559" class="difflineplus">+            this.removeAttribute(&quot;width&quot;);</span>
<a href="#l12.560"></a><span id="l12.560">           } else {</span>
<a href="#l12.561"></a><span id="l12.561" class="difflineminus">-            // If we do have a parent folder, then we just build based on those</span>
<a href="#l12.562"></a><span id="l12.562" class="difflineminus">-            // subFolders for that parent.</span>
<a href="#l12.563"></a><span id="l12.563" class="difflineminus">-            folders = this.toArray(this.fixIterator(this._parentFolder.subFolders,</span>
<a href="#l12.564"></a><span id="l12.564" class="difflineminus">-                                                    Ci.nsIMsgFolder));</span>
<a href="#l12.565"></a><span id="l12.565" class="difflineplus">+            this.setAttribute(&quot;width&quot;, this.getAttribute(&quot;original-width&quot;));</span>
<a href="#l12.566"></a><span id="l12.566">           }</span>
<a href="#l12.567"></a><span id="l12.567"> </span>
<a href="#l12.568"></a><span id="l12.568" class="difflineminus">-          this._build(folders);</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineplus">+          this.removeAttribute(&quot;original-width&quot;);</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineplus">+        }</span>
<a href="#l12.571"></a><span id="l12.571"> </span>
<a href="#l12.572"></a><span id="l12.572" class="difflineminus">-          // Lastly, we add a listener to get notified of changes in the folder</span>
<a href="#l12.573"></a><span id="l12.573" class="difflineminus">-          // structure.</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineminus">-          this.MailServices.mailSession.AddFolderListener(this._listener,</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineminus">-                                                          Ci.nsIFolderListener.all);</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineminus">-</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineminus">-          this._initialized = true;</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineplus">+        // If we are a child of a menulist, and we aren't in a wrapper, we</span>
<a href="#l12.581"></a><span id="l12.581" class="difflineplus">+        // need to build our content right away, otherwise the menulist</span>
<a href="#l12.582"></a><span id="l12.582" class="difflineplus">+        // won't have proper sizing.</span>
<a href="#l12.583"></a><span id="l12.583" class="difflineplus">+        if (this.parentNode &amp;&amp; this.parentNode.localName == &quot;menulist&quot;) {</span>
<a href="#l12.584"></a><span id="l12.584" class="difflineplus">+          this._ensureInitialized();</span>
<a href="#l12.585"></a><span id="l12.585" class="difflineplus">+        }</span>
<a href="#l12.586"></a><span id="l12.586" class="difflineplus">+      } else {</span>
<a href="#l12.587"></a><span id="l12.587" class="difflineplus">+        // But if we're in a wrapper, remove our children, because we're</span>
<a href="#l12.588"></a><span id="l12.588" class="difflineplus">+        // getting re-created when the toolbar customization closes.</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineplus">+        this._teardown();</span>
<a href="#l12.590"></a><span id="l12.590"> </span>
<a href="#l12.591"></a><span id="l12.591" class="difflineminus">-      &lt;!--</span>
<a href="#l12.592"></a><span id="l12.592" class="difflineminus">-         - Actually constructs the menu-items based on the folders given.</span>
<a href="#l12.593"></a><span id="l12.593" class="difflineminus">-         -</span>
<a href="#l12.594"></a><span id="l12.594" class="difflineminus">-         - @param aFolders  An array of nsIMsgFolders to use for building.</span>
<a href="#l12.595"></a><span id="l12.595" class="difflineminus">-        --&gt;</span>
<a href="#l12.596"></a><span id="l12.596" class="difflineminus">-      &lt;method name=&quot;_build&quot;&gt;</span>
<a href="#l12.597"></a><span id="l12.597" class="difflineminus">-        &lt;parameter name=&quot;aFolders&quot;/&gt;</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineminus">-          let folders;</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineminus">-          let excludeServers = [];</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineminus">-          let disableServers = [];</span>
<a href="#l12.602"></a><span id="l12.602" class="difflineplus">+        // Store our current width and set a safe small width when we show</span>
<a href="#l12.603"></a><span id="l12.603" class="difflineplus">+        // in a wrapper.</span>
<a href="#l12.604"></a><span id="l12.604" class="difflineplus">+        if (!this.hasAttribute(&quot;original-width&quot;)) {</span>
<a href="#l12.605"></a><span id="l12.605" class="difflineplus">+          this.setAttribute(&quot;original-width&quot;, this.hasAttribute(&quot;width&quot;) ?</span>
<a href="#l12.606"></a><span id="l12.606" class="difflineplus">+            this.getAttribute(&quot;width&quot;) : &quot;none&quot;);</span>
<a href="#l12.607"></a><span id="l12.607" class="difflineplus">+          this.setAttribute(&quot;width&quot;, &quot;100&quot;);</span>
<a href="#l12.608"></a><span id="l12.608" class="difflineplus">+        }</span>
<a href="#l12.609"></a><span id="l12.609" class="difflineplus">+      }</span>
<a href="#l12.610"></a><span id="l12.610" class="difflineplus">+    }</span>
<a href="#l12.611"></a><span id="l12.611"> </span>
<a href="#l12.612"></a><span id="l12.612" class="difflineminus">-          // excludeServers attribute is a comma separated list of server keys.</span>
<a href="#l12.613"></a><span id="l12.613" class="difflineminus">-          if (this.hasAttribute(&quot;excludeServers&quot;))</span>
<a href="#l12.614"></a><span id="l12.614" class="difflineminus">-            excludeServers = this.getAttribute(&quot;excludeServers&quot;).split(&quot;,&quot;);</span>
<a href="#l12.615"></a><span id="l12.615" class="difflineplus">+    set parentFolder(val) {</span>
<a href="#l12.616"></a><span id="l12.616" class="difflineplus">+      return this._parentFolder = val;</span>
<a href="#l12.617"></a><span id="l12.617" class="difflineplus">+    }</span>
<a href="#l12.618"></a><span id="l12.618" class="difflineplus">+</span>
<a href="#l12.619"></a><span id="l12.619" class="difflineplus">+    get parentFolder() {</span>
<a href="#l12.620"></a><span id="l12.620" class="difflineplus">+      return this._parentFolder;</span>
<a href="#l12.621"></a><span id="l12.621" class="difflineplus">+    }</span>
<a href="#l12.622"></a><span id="l12.622"> </span>
<a href="#l12.623"></a><span id="l12.623" class="difflineminus">-          // disableServers attribute is a comma separated list of server keys.</span>
<a href="#l12.624"></a><span id="l12.624" class="difflineminus">-          if (this.hasAttribute(&quot;disableServers&quot;))</span>
<a href="#l12.625"></a><span id="l12.625" class="difflineminus">-            disableServers = this.getAttribute(&quot;disableServers&quot;).split(&quot;,&quot;);</span>
<a href="#l12.626"></a><span id="l12.626" class="difflineplus">+    /**</span>
<a href="#l12.627"></a><span id="l12.627" class="difflineplus">+     * Make sure we remove our listener when the window is being destroyed</span>
<a href="#l12.628"></a><span id="l12.628" class="difflineplus">+     * or the widget teared down.</span>
<a href="#l12.629"></a><span id="l12.629" class="difflineplus">+     */</span>
<a href="#l12.630"></a><span id="l12.630" class="difflineplus">+    _removeListener() {</span>
<a href="#l12.631"></a><span id="l12.631" class="difflineplus">+      if (!this._initialized) {</span>
<a href="#l12.632"></a><span id="l12.632" class="difflineplus">+        return;</span>
<a href="#l12.633"></a><span id="l12.633" class="difflineplus">+      }</span>
<a href="#l12.634"></a><span id="l12.634" class="difflineplus">+      MailServices.mailSession.RemoveFolderListener(this._listener);</span>
<a href="#l12.635"></a><span id="l12.635" class="difflineplus">+    }</span>
<a href="#l12.636"></a><span id="l12.636"> </span>
<a href="#l12.637"></a><span id="l12.637" class="difflineminus">-          // Extensions and other consumers can add to these modes too, see the</span>
<a href="#l12.638"></a><span id="l12.638" class="difflineminus">-          // above note on the _filters field.</span>
<a href="#l12.639"></a><span id="l12.639" class="difflineminus">-          var mode = this.getAttribute(&quot;mode&quot;);</span>
<a href="#l12.640"></a><span id="l12.640" class="difflineminus">-          if (mode &amp;&amp; mode != &quot;&quot;) {</span>
<a href="#l12.641"></a><span id="l12.641" class="difflineminus">-            var filterFunction = this._filters[mode];</span>
<a href="#l12.642"></a><span id="l12.642" class="difflineminus">-            folders = aFolders.filter(filterFunction);</span>
<a href="#l12.643"></a><span id="l12.643" class="difflineminus">-            this._listener._filterFunction = filterFunction;</span>
<a href="#l12.644"></a><span id="l12.644" class="difflineminus">-          } else {</span>
<a href="#l12.645"></a><span id="l12.645" class="difflineminus">-            folders = aFolders;</span>
<a href="#l12.646"></a><span id="l12.646" class="difflineminus">-            this._listener._filterFunction = function(folder) { return true; };</span>
<a href="#l12.647"></a><span id="l12.647" class="difflineminus">-          }</span>
<a href="#l12.648"></a><span id="l12.648" class="difflineplus">+    /**</span>
<a href="#l12.649"></a><span id="l12.649" class="difflineplus">+     * Call this if you are unsure whether the menu-items have been built,</span>
<a href="#l12.650"></a><span id="l12.650" class="difflineplus">+     * but know that they need to be built now if they haven't.</span>
<a href="#l12.651"></a><span id="l12.651" class="difflineplus">+     */</span>
<a href="#l12.652"></a><span id="l12.652" class="difflineplus">+    _ensureInitialized() {</span>
<a href="#l12.653"></a><span id="l12.653" class="difflineplus">+      if (this._initialized) {</span>
<a href="#l12.654"></a><span id="l12.654" class="difflineplus">+        return;</span>
<a href="#l12.655"></a><span id="l12.655" class="difflineplus">+      }</span>
<a href="#l12.656"></a><span id="l12.656"> </span>
<a href="#l12.657"></a><span id="l12.657" class="difflineminus">-          if (excludeServers.length &gt; 0) {</span>
<a href="#l12.658"></a><span id="l12.658" class="difflineminus">-            folders = folders.filter(function(aFolder) {</span>
<a href="#l12.659"></a><span id="l12.659" class="difflineminus">-              return !excludeServers.includes(aFolder.server.key);</span>
<a href="#l12.660"></a><span id="l12.660" class="difflineminus">-            });</span>
<a href="#l12.661"></a><span id="l12.661" class="difflineminus">-          }</span>
<a href="#l12.662"></a><span id="l12.662" class="difflineplus">+      let folders;</span>
<a href="#l12.663"></a><span id="l12.663" class="difflineplus">+      // Figure out which folders to build. If we don't have a parent, then</span>
<a href="#l12.664"></a><span id="l12.664" class="difflineplus">+      // we assume we should build the top-level accounts. (Actually we</span>
<a href="#l12.665"></a><span id="l12.665" class="difflineplus">+      // build the fake root folders for those accounts.)</span>
<a href="#l12.666"></a><span id="l12.666" class="difflineplus">+      if (!this._parentFolder) {</span>
<a href="#l12.667"></a><span id="l12.667" class="difflineplus">+        let accounts = allAccountsSorted(true);</span>
<a href="#l12.668"></a><span id="l12.668"> </span>
<a href="#l12.669"></a><span id="l12.669" class="difflineminus">-          /* This code block will do the following: Add a menu item that refers</span>
<a href="#l12.670"></a><span id="l12.670" class="difflineminus">-             back to the parent folder when there is a showFileHereLabel</span>
<a href="#l12.671"></a><span id="l12.671" class="difflineminus">-             attribute or no mode attribute. However the code won't add such a</span>
<a href="#l12.672"></a><span id="l12.672" class="difflineminus">-             menu item if one of the following conditions is met:</span>
<a href="#l12.673"></a><span id="l12.673" class="difflineminus">-             (*) There is no parent folder</span>
<a href="#l12.674"></a><span id="l12.674" class="difflineminus">-             (*) Folder is server and showAccountsFileHere is explicitly false</span>
<a href="#l12.675"></a><span id="l12.675" class="difflineminus">-             (*) Current folder has a mode, the parent folder can be selected,</span>
<a href="#l12.676"></a><span id="l12.676" class="difflineminus">-                 no messages can be filed into the parent folder (e.g. when the</span>
<a href="#l12.677"></a><span id="l12.677" class="difflineminus">-                 parent folder is a news group or news server) and the folder</span>
<a href="#l12.678"></a><span id="l12.678" class="difflineminus">-                 mode is not equal to newFolder</span>
<a href="#l12.679"></a><span id="l12.679" class="difflineplus">+        // Now generate our folder-list. Note that we'll special case this</span>
<a href="#l12.680"></a><span id="l12.680" class="difflineplus">+        // situation below, to avoid destroying the sort order we just made.</span>
<a href="#l12.681"></a><span id="l12.681" class="difflineplus">+        folders = accounts.map(acct =&gt; acct.incomingServer.rootFolder);</span>
<a href="#l12.682"></a><span id="l12.682" class="difflineplus">+      } else {</span>
<a href="#l12.683"></a><span id="l12.683" class="difflineplus">+        // If we do have a parent folder, then we just build based on those</span>
<a href="#l12.684"></a><span id="l12.684" class="difflineplus">+        // subFolders for that parent.</span>
<a href="#l12.685"></a><span id="l12.685" class="difflineplus">+        folders = toArray(fixIterator(this._parentFolder.subFolders,</span>
<a href="#l12.686"></a><span id="l12.686" class="difflineplus">+          Ci.nsIMsgFolder));</span>
<a href="#l12.687"></a><span id="l12.687" class="difflineplus">+      }</span>
<a href="#l12.688"></a><span id="l12.688" class="difflineplus">+</span>
<a href="#l12.689"></a><span id="l12.689" class="difflineplus">+      this._build(folders);</span>
<a href="#l12.690"></a><span id="l12.690" class="difflineplus">+      // Lastly, we add a listener to get notified of changes in the folder</span>
<a href="#l12.691"></a><span id="l12.691" class="difflineplus">+      // structure.</span>
<a href="#l12.692"></a><span id="l12.692" class="difflineplus">+      MailServices.mailSession.AddFolderListener(this._listener,</span>
<a href="#l12.693"></a><span id="l12.693" class="difflineplus">+        Ci.nsIFolderListener.all);</span>
<a href="#l12.694"></a><span id="l12.694"> </span>
<a href="#l12.695"></a><span id="l12.695" class="difflineminus">-             The menu item will have the value of the fileHereLabel attribute as</span>
<a href="#l12.696"></a><span id="l12.696" class="difflineminus">-             label or if the attribute does not exist the name of the parent</span>
<a href="#l12.697"></a><span id="l12.697" class="difflineminus">-             folder instead.</span>
<a href="#l12.698"></a><span id="l12.698" class="difflineminus">-          */</span>
<a href="#l12.699"></a><span id="l12.699" class="difflineminus">-          let parent = this._parentFolder;</span>
<a href="#l12.700"></a><span id="l12.700" class="difflineminus">-          if (parent &amp;&amp; (this.getAttribute(&quot;showFileHereLabel&quot;) == &quot;true&quot; || !mode)) {</span>
<a href="#l12.701"></a><span id="l12.701" class="difflineminus">-            let showAccountsFileHere = this.getAttribute(&quot;showAccountsFileHere&quot;);</span>
<a href="#l12.702"></a><span id="l12.702" class="difflineminus">-            if ((!parent.isServer || showAccountsFileHere != &quot;false&quot;) &amp;&amp;</span>
<a href="#l12.703"></a><span id="l12.703" class="difflineminus">-                (!mode || mode == &quot;newFolder&quot; || parent.noSelect ||</span>
<a href="#l12.704"></a><span id="l12.704" class="difflineminus">-                 parent.canFileMessages || showAccountsFileHere == &quot;true&quot;)) {</span>
<a href="#l12.705"></a><span id="l12.705" class="difflineminus">-              var menuitem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.706"></a><span id="l12.706" class="difflineminus">-              menuitem._folder = this._parentFolder;</span>
<a href="#l12.707"></a><span id="l12.707" class="difflineminus">-              menuitem.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.708"></a><span id="l12.708" class="difflineminus">-              if (this.hasAttribute(&quot;fileHereLabel&quot;)) {</span>
<a href="#l12.709"></a><span id="l12.709" class="difflineminus">-                menuitem.setAttribute(&quot;label&quot;, this.getAttribute(&quot;fileHereLabel&quot;));</span>
<a href="#l12.710"></a><span id="l12.710" class="difflineminus">-                menuitem.setAttribute(&quot;accesskey&quot;, this.getAttribute(&quot;fileHereAccessKey&quot;));</span>
<a href="#l12.711"></a><span id="l12.711" class="difflineminus">-              } else {</span>
<a href="#l12.712"></a><span id="l12.712" class="difflineminus">-                menuitem.setAttribute(&quot;label&quot;, this._parentFolder.prettyName);</span>
<a href="#l12.713"></a><span id="l12.713" class="difflineminus">-                menuitem.setAttribute(&quot;class&quot;, &quot;folderMenuItem menuitem-iconic&quot;);</span>
<a href="#l12.714"></a><span id="l12.714" class="difflineminus">-                this._setCssSelectors(this._parentFolder, menuitem);</span>
<a href="#l12.715"></a><span id="l12.715" class="difflineminus">-              }</span>
<a href="#l12.716"></a><span id="l12.716" class="difflineminus">-              // Eww. have to support some legacy code here...</span>
<a href="#l12.717"></a><span id="l12.717" class="difflineminus">-              menuitem.setAttribute(&quot;id&quot;, this._parentFolder.URI);</span>
<a href="#l12.718"></a><span id="l12.718" class="difflineminus">-              this.appendChild(menuitem);</span>
<a href="#l12.719"></a><span id="l12.719" class="difflineplus">+      this._initialized = true;</span>
<a href="#l12.720"></a><span id="l12.720" class="difflineplus">+    }</span>
<a href="#l12.721"></a><span id="l12.721"> </span>
<a href="#l12.722"></a><span id="l12.722" class="difflineminus">-              if (this._parentFolder.noSelect)</span>
<a href="#l12.723"></a><span id="l12.723" class="difflineminus">-                menuitem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.724"></a><span id="l12.724" class="difflineplus">+    /**</span>
<a href="#l12.725"></a><span id="l12.725" class="difflineplus">+     * Actually constructs the menu-items based on the folders given.</span>
<a href="#l12.726"></a><span id="l12.726" class="difflineplus">+     *</span>
<a href="#l12.727"></a><span id="l12.727" class="difflineplus">+     * @param [nsIMsgFolder] inputFolders - An array of nsIMsgFolders to use for building.</span>
<a href="#l12.728"></a><span id="l12.728" class="difflineplus">+     */</span>
<a href="#l12.729"></a><span id="l12.729" class="difflineplus">+    // eslint-disable-next-line complexity</span>
<a href="#l12.730"></a><span id="l12.730" class="difflineplus">+    _build(inputFolders) {</span>
<a href="#l12.731"></a><span id="l12.731" class="difflineplus">+      let folders;</span>
<a href="#l12.732"></a><span id="l12.732" class="difflineplus">+      let excludeServers = [];</span>
<a href="#l12.733"></a><span id="l12.733" class="difflineplus">+      let disableServers = [];</span>
<a href="#l12.734"></a><span id="l12.734"> </span>
<a href="#l12.735"></a><span id="l12.735" class="difflineminus">-              let sep = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.736"></a><span id="l12.736" class="difflineminus">-              sep.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.737"></a><span id="l12.737" class="difflineminus">-              this.appendChild(sep);</span>
<a href="#l12.738"></a><span id="l12.738" class="difflineminus">-            }</span>
<a href="#l12.739"></a><span id="l12.739" class="difflineminus">-          }</span>
<a href="#l12.740"></a><span id="l12.740" class="difflineplus">+      // excludeServers attribute is a comma separated list of server keys.</span>
<a href="#l12.741"></a><span id="l12.741" class="difflineplus">+      if (this.hasAttribute(&quot;excludeServers&quot;)) {</span>
<a href="#l12.742"></a><span id="l12.742" class="difflineplus">+        excludeServers = this.getAttribute(&quot;excludeServers&quot;).split(&quot;,&quot;);</span>
<a href="#l12.743"></a><span id="l12.743" class="difflineplus">+      }</span>
<a href="#l12.744"></a><span id="l12.744" class="difflineplus">+</span>
<a href="#l12.745"></a><span id="l12.745" class="difflineplus">+      // disableServers attribute is a comma separated list of server keys.</span>
<a href="#l12.746"></a><span id="l12.746" class="difflineplus">+      if (this.hasAttribute(&quot;disableServers&quot;)) {</span>
<a href="#l12.747"></a><span id="l12.747" class="difflineplus">+        disableServers = this.getAttribute(&quot;disableServers&quot;).split(&quot;,&quot;);</span>
<a href="#l12.748"></a><span id="l12.748" class="difflineplus">+      }</span>
<a href="#l12.749"></a><span id="l12.749"> </span>
<a href="#l12.750"></a><span id="l12.750" class="difflineminus">-          let globalInboxFolder = null;</span>
<a href="#l12.751"></a><span id="l12.751" class="difflineminus">-          // See if this is the toplevel menu (usually with accounts).</span>
<a href="#l12.752"></a><span id="l12.752" class="difflineminus">-          if (!this._parentFolder) {</span>
<a href="#l12.753"></a><span id="l12.753" class="difflineminus">-            let addSeparator = false;</span>
<a href="#l12.754"></a><span id="l12.754" class="difflineminus">-            // Some menus want a &quot;Recent&quot; option, but that should only be on our</span>
<a href="#l12.755"></a><span id="l12.755" class="difflineminus">-            // top-level menu.</span>
<a href="#l12.756"></a><span id="l12.756" class="difflineminus">-            if (this.getAttribute(&quot;showRecent&quot;) == &quot;true&quot;) {</span>
<a href="#l12.757"></a><span id="l12.757" class="difflineminus">-              this._buildSpecialMenu(&quot;recent&quot;);</span>
<a href="#l12.758"></a><span id="l12.758" class="difflineminus">-              addSeparator = true;</span>
<a href="#l12.759"></a><span id="l12.759" class="difflineminus">-            }</span>
<a href="#l12.760"></a><span id="l12.760" class="difflineminus">-            if (this.getAttribute(&quot;showFavorites&quot;) == &quot;true&quot;) {</span>
<a href="#l12.761"></a><span id="l12.761" class="difflineminus">-              this._buildSpecialMenu(&quot;favorites&quot;);</span>
<a href="#l12.762"></a><span id="l12.762" class="difflineminus">-              addSeparator = true;</span>
<a href="#l12.763"></a><span id="l12.763" class="difflineminus">-            }</span>
<a href="#l12.764"></a><span id="l12.764" class="difflineminus">-            if (addSeparator) {</span>
<a href="#l12.765"></a><span id="l12.765" class="difflineminus">-              // If we added Recent and/or Favorites, separate them from the rest of the items.</span>
<a href="#l12.766"></a><span id="l12.766" class="difflineminus">-              let sep = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.767"></a><span id="l12.767" class="difflineminus">-              sep.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.768"></a><span id="l12.768" class="difflineminus">-              this.appendChild(sep);</span>
<a href="#l12.769"></a><span id="l12.769" class="difflineminus">-            }</span>
<a href="#l12.770"></a><span id="l12.770" class="difflineminus">-            // If we are showing the accounts for deferring, move Local Folders to the top.</span>
<a href="#l12.771"></a><span id="l12.771" class="difflineminus">-            if (mode == &quot;deferred&quot;) {</span>
<a href="#l12.772"></a><span id="l12.772" class="difflineminus">-              globalInboxFolder = this.MailServices.accounts.localFoldersServer</span>
<a href="#l12.773"></a><span id="l12.773" class="difflineminus">-                                                            .rootFolder;</span>
<a href="#l12.774"></a><span id="l12.774" class="difflineminus">-              let localFoldersIndex = folders.indexOf(globalInboxFolder);</span>
<a href="#l12.775"></a><span id="l12.775" class="difflineminus">-              if (localFoldersIndex != -1) {</span>
<a href="#l12.776"></a><span id="l12.776" class="difflineminus">-                folders.splice(localFoldersIndex, 1);</span>
<a href="#l12.777"></a><span id="l12.777" class="difflineminus">-                folders.unshift(globalInboxFolder);</span>
<a href="#l12.778"></a><span id="l12.778" class="difflineminus">-              }</span>
<a href="#l12.779"></a><span id="l12.779" class="difflineminus">-            }</span>
<a href="#l12.780"></a><span id="l12.780" class="difflineminus">-            // If we're the root of the folder hierarchy, then we actually don't</span>
<a href="#l12.781"></a><span id="l12.781" class="difflineminus">-            // want to sort the folders, but rather the accounts to which the</span>
<a href="#l12.782"></a><span id="l12.782" class="difflineminus">-            // folders belong.  Since that sorting was already done, we don't need</span>
<a href="#l12.783"></a><span id="l12.783" class="difflineminus">-            // to do anything for that case here.</span>
<a href="#l12.784"></a><span id="l12.784" class="difflineplus">+      // Extensions and other consumers can add to these modes too, see the</span>
<a href="#l12.785"></a><span id="l12.785" class="difflineplus">+      // above note on the _filters field.</span>
<a href="#l12.786"></a><span id="l12.786" class="difflineplus">+      let mode = this.getAttribute(&quot;mode&quot;);</span>
<a href="#l12.787"></a><span id="l12.787" class="difflineplus">+      if (mode &amp;&amp; mode != &quot;&quot;) {</span>
<a href="#l12.788"></a><span id="l12.788" class="difflineplus">+        let filterFunction = this._filters[mode];</span>
<a href="#l12.789"></a><span id="l12.789" class="difflineplus">+        folders = inputFolders.filter(filterFunction);</span>
<a href="#l12.790"></a><span id="l12.790" class="difflineplus">+        this._listener._filterFunction = filterFunction;</span>
<a href="#l12.791"></a><span id="l12.791" class="difflineplus">+      } else {</span>
<a href="#l12.792"></a><span id="l12.792" class="difflineplus">+        folders = inputFolders;</span>
<a href="#l12.793"></a><span id="l12.793" class="difflineplus">+        this._listener._filterFunction = function(folder) {</span>
<a href="#l12.794"></a><span id="l12.794" class="difflineplus">+          return true;</span>
<a href="#l12.795"></a><span id="l12.795" class="difflineplus">+        };</span>
<a href="#l12.796"></a><span id="l12.796" class="difflineplus">+      }</span>
<a href="#l12.797"></a><span id="l12.797" class="difflineplus">+      if (excludeServers.length &gt; 0) {</span>
<a href="#l12.798"></a><span id="l12.798" class="difflineplus">+        folders = folders.filter(function(aFolder) {</span>
<a href="#l12.799"></a><span id="l12.799" class="difflineplus">+          return !excludeServers.includes(aFolder.server.key);</span>
<a href="#l12.800"></a><span id="l12.800" class="difflineplus">+        });</span>
<a href="#l12.801"></a><span id="l12.801" class="difflineplus">+      }</span>
<a href="#l12.802"></a><span id="l12.802" class="difflineplus">+      // This code block will do the following: Add a menu item that refers</span>
<a href="#l12.803"></a><span id="l12.803" class="difflineplus">+      // back to the parent folder when there is a showFileHereLabel</span>
<a href="#l12.804"></a><span id="l12.804" class="difflineplus">+      // attribute or no mode attribute. However the code won't add such a</span>
<a href="#l12.805"></a><span id="l12.805" class="difflineplus">+      // menu item if one of the following conditions is met:</span>
<a href="#l12.806"></a><span id="l12.806" class="difflineplus">+      // (-) There is no parent folder.</span>
<a href="#l12.807"></a><span id="l12.807" class="difflineplus">+      // (-) Folder is server and showAccountsFileHere is explicitly false.</span>
<a href="#l12.808"></a><span id="l12.808" class="difflineplus">+      // (-) Current folder has a mode, the parent folder can be selected,</span>
<a href="#l12.809"></a><span id="l12.809" class="difflineplus">+      //     no messages can be filed into the parent folder (e.g. when the</span>
<a href="#l12.810"></a><span id="l12.810" class="difflineplus">+      //     parent folder is a news group or news server) and the folder</span>
<a href="#l12.811"></a><span id="l12.811" class="difflineplus">+      //     mode is not equal to newFolder.</span>
<a href="#l12.812"></a><span id="l12.812" class="difflineplus">+      //  The menu item will have the value of the fileHereLabel attribute as</span>
<a href="#l12.813"></a><span id="l12.813" class="difflineplus">+      //  label or if the attribute does not exist the name of the parent</span>
<a href="#l12.814"></a><span id="l12.814" class="difflineplus">+      //  folder instead.</span>
<a href="#l12.815"></a><span id="l12.815" class="difflineplus">+      let parent = this._parentFolder;</span>
<a href="#l12.816"></a><span id="l12.816" class="difflineplus">+      if (parent &amp;&amp; (this.getAttribute(&quot;showFileHereLabel&quot;) == &quot;true&quot; || !mode)) {</span>
<a href="#l12.817"></a><span id="l12.817" class="difflineplus">+        let showAccountsFileHere = this.getAttribute(&quot;showAccountsFileHere&quot;);</span>
<a href="#l12.818"></a><span id="l12.818" class="difflineplus">+        if ((!parent.isServer || showAccountsFileHere != &quot;false&quot;) &amp;&amp;</span>
<a href="#l12.819"></a><span id="l12.819" class="difflineplus">+          (!mode || mode == &quot;newFolder&quot; || parent.noSelect ||</span>
<a href="#l12.820"></a><span id="l12.820" class="difflineplus">+            parent.canFileMessages || showAccountsFileHere == &quot;true&quot;)) {</span>
<a href="#l12.821"></a><span id="l12.821" class="difflineplus">+          let menuitem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.822"></a><span id="l12.822" class="difflineplus">+          menuitem._folder = this._parentFolder;</span>
<a href="#l12.823"></a><span id="l12.823" class="difflineplus">+          menuitem.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.824"></a><span id="l12.824" class="difflineplus">+          if (this.hasAttribute(&quot;fileHereLabel&quot;)) {</span>
<a href="#l12.825"></a><span id="l12.825" class="difflineplus">+            menuitem.setAttribute(&quot;label&quot;, this.getAttribute(&quot;fileHereLabel&quot;));</span>
<a href="#l12.826"></a><span id="l12.826" class="difflineplus">+            menuitem.setAttribute(&quot;accesskey&quot;, this.getAttribute(&quot;fileHereAccessKey&quot;));</span>
<a href="#l12.827"></a><span id="l12.827">           } else {</span>
<a href="#l12.828"></a><span id="l12.828" class="difflineminus">-            // Sorts the list of folders. We give first priority to the sortKey</span>
<a href="#l12.829"></a><span id="l12.829" class="difflineminus">-            // property if it is available, otherwise a case-insensitive</span>
<a href="#l12.830"></a><span id="l12.830" class="difflineminus">-            // comparison of names.</span>
<a href="#l12.831"></a><span id="l12.831" class="difflineminus">-            folders = folders.sort((a, b) =&gt; a.compareSortKeys(b));</span>
<a href="#l12.832"></a><span id="l12.832" class="difflineplus">+            menuitem.setAttribute(&quot;label&quot;, this._parentFolder.prettyName);</span>
<a href="#l12.833"></a><span id="l12.833" class="difflineplus">+            menuitem.setAttribute(&quot;class&quot;, &quot;folderMenuItem menuitem-iconic&quot;);</span>
<a href="#l12.834"></a><span id="l12.834" class="difflineplus">+            this._setCssSelectors(this._parentFolder, menuitem);</span>
<a href="#l12.835"></a><span id="l12.835" class="difflineplus">+          }</span>
<a href="#l12.836"></a><span id="l12.836" class="difflineplus">+          // Eww. have to support some legacy code here.</span>
<a href="#l12.837"></a><span id="l12.837" class="difflineplus">+          menuitem.setAttribute(&quot;id&quot;, this._parentFolder.URI);</span>
<a href="#l12.838"></a><span id="l12.838" class="difflineplus">+          this.appendChild(menuitem);</span>
<a href="#l12.839"></a><span id="l12.839" class="difflineplus">+</span>
<a href="#l12.840"></a><span id="l12.840" class="difflineplus">+          if (this._parentFolder.noSelect) {</span>
<a href="#l12.841"></a><span id="l12.841" class="difflineplus">+            menuitem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.842"></a><span id="l12.842">           }</span>
<a href="#l12.843"></a><span id="l12.843"> </span>
<a href="#l12.844"></a><span id="l12.844" class="difflineminus">-          /* In some cases, the user wants to have a list of subfolders for only</span>
<a href="#l12.845"></a><span id="l12.845" class="difflineminus">-           * some account types (or maybe all of them). So we use this to</span>
<a href="#l12.846"></a><span id="l12.846" class="difflineminus">-           * determine what the user wanted.</span>
<a href="#l12.847"></a><span id="l12.847" class="difflineminus">-           */</span>
<a href="#l12.848"></a><span id="l12.848" class="difflineminus">-           var shouldExpand;</span>
<a href="#l12.849"></a><span id="l12.849" class="difflineminus">-           var labels = null;</span>
<a href="#l12.850"></a><span id="l12.850" class="difflineminus">-           if (this.getAttribute(&quot;expandFolders&quot;) == &quot;true&quot; ||</span>
<a href="#l12.851"></a><span id="l12.851" class="difflineminus">-               !this.hasAttribute(&quot;expandFolders&quot;)) {</span>
<a href="#l12.852"></a><span id="l12.852" class="difflineminus">-             shouldExpand = () =&gt; true;</span>
<a href="#l12.853"></a><span id="l12.853" class="difflineminus">-           } else if (this.getAttribute(&quot;expandFolders&quot;) == &quot;false&quot;) {</span>
<a href="#l12.854"></a><span id="l12.854" class="difflineminus">-             shouldExpand = () =&gt; false;</span>
<a href="#l12.855"></a><span id="l12.855" class="difflineminus">-           } else {</span>
<a href="#l12.856"></a><span id="l12.856" class="difflineminus">-             /* We want a subfolder list for only some servers. We also may need</span>
<a href="#l12.857"></a><span id="l12.857" class="difflineminus">-              * to create headers to select the servers. If so, then headlabels</span>
<a href="#l12.858"></a><span id="l12.858" class="difflineminus">-              * is a comma-delimited list of labels corresponding to the server</span>
<a href="#l12.859"></a><span id="l12.859" class="difflineminus">-              * types specified in expandFolders.</span>
<a href="#l12.860"></a><span id="l12.860" class="difflineminus">-              */</span>
<a href="#l12.861"></a><span id="l12.861" class="difflineminus">-             var types = this.getAttribute(&quot;expandFolders&quot;).split(/ *, */);</span>
<a href="#l12.862"></a><span id="l12.862" class="difflineminus">-             // Set the labels. labels[type] = label</span>
<a href="#l12.863"></a><span id="l12.863" class="difflineminus">-             if (this.hasAttribute(&quot;headlabels&quot;)) {</span>
<a href="#l12.864"></a><span id="l12.864" class="difflineminus">-               var labelNames = this.getAttribute(&quot;headlabels&quot;).split(/ *, */);</span>
<a href="#l12.865"></a><span id="l12.865" class="difflineminus">-               labels = {};</span>
<a href="#l12.866"></a><span id="l12.866" class="difflineminus">-               // If the length isn't equal, don't give them any of the labels,</span>
<a href="#l12.867"></a><span id="l12.867" class="difflineminus">-               // since any combination will probably be wrong.</span>
<a href="#l12.868"></a><span id="l12.868" class="difflineminus">-               if (labelNames.length == types.length) {</span>
<a href="#l12.869"></a><span id="l12.869" class="difflineminus">-                 for (var index in types)</span>
<a href="#l12.870"></a><span id="l12.870" class="difflineminus">-                   labels[types[index]] = labelNames[index];</span>
<a href="#l12.871"></a><span id="l12.871" class="difflineminus">-               }</span>
<a href="#l12.872"></a><span id="l12.872" class="difflineminus">-             }</span>
<a href="#l12.873"></a><span id="l12.873" class="difflineminus">-             shouldExpand = (e) =&gt; types.includes(e);</span>
<a href="#l12.874"></a><span id="l12.874" class="difflineminus">-           }</span>
<a href="#l12.875"></a><span id="l12.875" class="difflineplus">+          let sep = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.876"></a><span id="l12.876" class="difflineplus">+          sep.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.877"></a><span id="l12.877" class="difflineplus">+          this.appendChild(sep);</span>
<a href="#l12.878"></a><span id="l12.878" class="difflineplus">+        }</span>
<a href="#l12.879"></a><span id="l12.879" class="difflineplus">+      }</span>
<a href="#l12.880"></a><span id="l12.880"> </span>
<a href="#l12.881"></a><span id="l12.881" class="difflineminus">-          // We need to call this, or hasSubFolders will always return false.</span>
<a href="#l12.882"></a><span id="l12.882" class="difflineminus">-          // Remove this workaround when Bug 502900 is fixed.</span>
<a href="#l12.883"></a><span id="l12.883" class="difflineminus">-          this.MailUtils.discoverFolders();</span>
<a href="#l12.884"></a><span id="l12.884" class="difflineminus">-          this._serversOnly = true;</span>
<a href="#l12.885"></a><span id="l12.885" class="difflineminus">-</span>
<a href="#l12.886"></a><span id="l12.886" class="difflineminus">-          for (let folder of folders) {</span>
<a href="#l12.887"></a><span id="l12.887" class="difflineminus">-            let node;</span>
<a href="#l12.888"></a><span id="l12.888" class="difflineminus">-            if (!folder.isServer)</span>
<a href="#l12.889"></a><span id="l12.889" class="difflineminus">-              this._serversOnly = false;</span>
<a href="#l12.890"></a><span id="l12.890" class="difflineplus">+      let globalInboxFolder = null;</span>
<a href="#l12.891"></a><span id="l12.891" class="difflineplus">+      // See if this is the toplevel menu (usually with accounts).</span>
<a href="#l12.892"></a><span id="l12.892" class="difflineplus">+      if (!this._parentFolder) {</span>
<a href="#l12.893"></a><span id="l12.893" class="difflineplus">+        let addSeparator = false;</span>
<a href="#l12.894"></a><span id="l12.894"> </span>
<a href="#l12.895"></a><span id="l12.895" class="difflineminus">-            // If we're going to add subFolders, we need to make menus, not</span>
<a href="#l12.896"></a><span id="l12.896" class="difflineminus">-            // menuitems.</span>
<a href="#l12.897"></a><span id="l12.897" class="difflineminus">-            if (!folder.hasSubFolders || !shouldExpand(folder.server.type)) {</span>
<a href="#l12.898"></a><span id="l12.898" class="difflineminus">-              node = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.899"></a><span id="l12.899" class="difflineminus">-              // Grumble, grumble, legacy code support</span>
<a href="#l12.900"></a><span id="l12.900" class="difflineminus">-              node.setAttribute(&quot;id&quot;, folder.URI);</span>
<a href="#l12.901"></a><span id="l12.901" class="difflineminus">-              node.setAttribute(&quot;class&quot;, &quot;folderMenuItem menuitem-iconic&quot;);</span>
<a href="#l12.902"></a><span id="l12.902" class="difflineminus">-              node.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.903"></a><span id="l12.903" class="difflineminus">-              this.appendChild(node);</span>
<a href="#l12.904"></a><span id="l12.904" class="difflineminus">-            } else {</span>
<a href="#l12.905"></a><span id="l12.905" class="difflineminus">-              this._serversOnly = false;</span>
<a href="#l12.906"></a><span id="l12.906" class="difflineminus">-              // xxx this is slightly problematic in that we haven't confirmed</span>
<a href="#l12.907"></a><span id="l12.907" class="difflineminus">-              //     whether any of the subfolders will pass the filter</span>
<a href="#l12.908"></a><span id="l12.908" class="difflineminus">-              node = document.createXULElement(&quot;menu&quot;);</span>
<a href="#l12.909"></a><span id="l12.909" class="difflineminus">-              node.setAttribute(&quot;class&quot;, &quot;folderMenuItem menu-iconic&quot;);</span>
<a href="#l12.910"></a><span id="l12.910" class="difflineminus">-              node.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.911"></a><span id="l12.911" class="difflineminus">-              this.appendChild(node);</span>
<a href="#l12.912"></a><span id="l12.912" class="difflineminus">-</span>
<a href="#l12.913"></a><span id="l12.913" class="difflineminus">-              // Create the submenu</span>
<a href="#l12.914"></a><span id="l12.914" class="difflineminus">-              // (We must use cloneNode here because on OS X the native menu</span>
<a href="#l12.915"></a><span id="l12.915" class="difflineminus">-              // functionality and very sad limitations of XBL1 cause the bindings</span>
<a href="#l12.916"></a><span id="l12.916" class="difflineminus">-              // to never get created for popup if we create a new element.  We</span>
<a href="#l12.917"></a><span id="l12.917" class="difflineminus">-              // perform a shallow clone to avoid picking up any of our children.)</span>
<a href="#l12.918"></a><span id="l12.918" class="difflineminus">-              var popup = this.cloneNode(false);</span>
<a href="#l12.919"></a><span id="l12.919" class="difflineminus">-              popup._parentFolder = folder;</span>
<a href="#l12.920"></a><span id="l12.920" class="difflineminus">-              popup.setAttribute(&quot;class&quot;, this.getAttribute(&quot;class&quot;));</span>
<a href="#l12.921"></a><span id="l12.921" class="difflineminus">-              popup.setAttribute(&quot;type&quot;, this.getAttribute(&quot;type&quot;));</span>
<a href="#l12.922"></a><span id="l12.922" class="difflineminus">-              if (this.hasAttribute(&quot;fileHereLabel&quot;))</span>
<a href="#l12.923"></a><span id="l12.923" class="difflineminus">-                popup.setAttribute(&quot;fileHereLabel&quot;,</span>
<a href="#l12.924"></a><span id="l12.924" class="difflineminus">-                                   this.getAttribute(&quot;fileHereLabel&quot;));</span>
<a href="#l12.925"></a><span id="l12.925" class="difflineminus">-              popup.setAttribute(&quot;showFileHereLabel&quot;,</span>
<a href="#l12.926"></a><span id="l12.926" class="difflineminus">-                                 this.getAttribute(&quot;showFileHereLabel&quot;));</span>
<a href="#l12.927"></a><span id="l12.927" class="difflineminus">-              popup.setAttribute(&quot;oncommand&quot;,</span>
<a href="#l12.928"></a><span id="l12.928" class="difflineminus">-                                 this.getAttribute(&quot;oncommand&quot;));</span>
<a href="#l12.929"></a><span id="l12.929" class="difflineminus">-              popup.setAttribute(&quot;mode&quot;,</span>
<a href="#l12.930"></a><span id="l12.930" class="difflineminus">-                                 this.getAttribute(&quot;mode&quot;));</span>
<a href="#l12.931"></a><span id="l12.931" class="difflineminus">-              if (this.hasAttribute(&quot;disableServers&quot;))</span>
<a href="#l12.932"></a><span id="l12.932" class="difflineminus">-                popup.setAttribute(&quot;disableServers&quot;,</span>
<a href="#l12.933"></a><span id="l12.933" class="difflineminus">-                                   this.getAttribute(&quot;disableServers&quot;));</span>
<a href="#l12.934"></a><span id="l12.934" class="difflineminus">-              if (this.hasAttribute(&quot;position&quot;))</span>
<a href="#l12.935"></a><span id="l12.935" class="difflineminus">-                popup.setAttribute(&quot;position&quot;,</span>
<a href="#l12.936"></a><span id="l12.936" class="difflineminus">-                                   this.getAttribute(&quot;position&quot;));</span>
<a href="#l12.937"></a><span id="l12.937" class="difflineminus">-</span>
<a href="#l12.938"></a><span id="l12.938" class="difflineminus">-              // If there are labels, add the labels now</span>
<a href="#l12.939"></a><span id="l12.939" class="difflineminus">-              if (labels) {</span>
<a href="#l12.940"></a><span id="l12.940" class="difflineminus">-                var serverNode = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.941"></a><span id="l12.941" class="difflineminus">-                serverNode.setAttribute(&quot;label&quot;, labels[folder.server.type]);</span>
<a href="#l12.942"></a><span id="l12.942" class="difflineminus">-                serverNode._folder = folder;</span>
<a href="#l12.943"></a><span id="l12.943" class="difflineminus">-                serverNode.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.944"></a><span id="l12.944" class="difflineminus">-                popup.appendChild(serverNode);</span>
<a href="#l12.945"></a><span id="l12.945" class="difflineminus">-                let sep = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.946"></a><span id="l12.946" class="difflineminus">-                sep.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.947"></a><span id="l12.947" class="difflineminus">-                popup.appendChild(sep);</span>
<a href="#l12.948"></a><span id="l12.948" class="difflineminus">-              }</span>
<a href="#l12.949"></a><span id="l12.949" class="difflineplus">+        // Some menus want a &quot;Recent&quot; option, but that should only be on our</span>
<a href="#l12.950"></a><span id="l12.950" class="difflineplus">+        // top-level menu.</span>
<a href="#l12.951"></a><span id="l12.951" class="difflineplus">+        if (this.getAttribute(&quot;showRecent&quot;) == &quot;true&quot;) {</span>
<a href="#l12.952"></a><span id="l12.952" class="difflineplus">+          this._buildSpecialMenu(&quot;recent&quot;);</span>
<a href="#l12.953"></a><span id="l12.953" class="difflineplus">+          addSeparator = true;</span>
<a href="#l12.954"></a><span id="l12.954" class="difflineplus">+        }</span>
<a href="#l12.955"></a><span id="l12.955" class="difflineplus">+        if (this.getAttribute(&quot;showFavorites&quot;) == &quot;true&quot;) {</span>
<a href="#l12.956"></a><span id="l12.956" class="difflineplus">+          this._buildSpecialMenu(&quot;favorites&quot;);</span>
<a href="#l12.957"></a><span id="l12.957" class="difflineplus">+          addSeparator = true;</span>
<a href="#l12.958"></a><span id="l12.958" class="difflineplus">+        }</span>
<a href="#l12.959"></a><span id="l12.959" class="difflineplus">+        if (addSeparator) {</span>
<a href="#l12.960"></a><span id="l12.960" class="difflineplus">+          // If we added Recent and/or Favorites, separate them from the rest of the items.</span>
<a href="#l12.961"></a><span id="l12.961" class="difflineplus">+          let sep = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.962"></a><span id="l12.962" class="difflineplus">+          sep.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.963"></a><span id="l12.963" class="difflineplus">+          this.appendChild(sep);</span>
<a href="#l12.964"></a><span id="l12.964" class="difflineplus">+        }</span>
<a href="#l12.965"></a><span id="l12.965" class="difflineplus">+        // If we are showing the accounts for deferring, move Local Folders to the top.</span>
<a href="#l12.966"></a><span id="l12.966" class="difflineplus">+        if (mode == &quot;deferred&quot;) {</span>
<a href="#l12.967"></a><span id="l12.967" class="difflineplus">+          globalInboxFolder = MailServices.accounts.localFoldersServer</span>
<a href="#l12.968"></a><span id="l12.968" class="difflineplus">+            .rootFolder;</span>
<a href="#l12.969"></a><span id="l12.969" class="difflineplus">+          let localFoldersIndex = folders.indexOf(globalInboxFolder);</span>
<a href="#l12.970"></a><span id="l12.970" class="difflineplus">+          if (localFoldersIndex != -1) {</span>
<a href="#l12.971"></a><span id="l12.971" class="difflineplus">+            folders.splice(localFoldersIndex, 1);</span>
<a href="#l12.972"></a><span id="l12.972" class="difflineplus">+            folders.unshift(globalInboxFolder);</span>
<a href="#l12.973"></a><span id="l12.973" class="difflineplus">+          }</span>
<a href="#l12.974"></a><span id="l12.974" class="difflineplus">+        }</span>
<a href="#l12.975"></a><span id="l12.975" class="difflineplus">+        // If we're the root of the folder hierarchy, then we actually don't</span>
<a href="#l12.976"></a><span id="l12.976" class="difflineplus">+        // want to sort the folders, but rather the accounts to which the</span>
<a href="#l12.977"></a><span id="l12.977" class="difflineplus">+        // folders belong. Since that sorting was already done, we don't need</span>
<a href="#l12.978"></a><span id="l12.978" class="difflineplus">+        // to do anything for that case here.</span>
<a href="#l12.979"></a><span id="l12.979" class="difflineplus">+      } else {</span>
<a href="#l12.980"></a><span id="l12.980" class="difflineplus">+        // Sorts the list of folders. We give first priority to the sortKey</span>
<a href="#l12.981"></a><span id="l12.981" class="difflineplus">+        // property if it is available, otherwise a case-insensitive</span>
<a href="#l12.982"></a><span id="l12.982" class="difflineplus">+        // comparison of names.</span>
<a href="#l12.983"></a><span id="l12.983" class="difflineplus">+        folders = folders.sort((a, b) =&gt; a.compareSortKeys(b));</span>
<a href="#l12.984"></a><span id="l12.984" class="difflineplus">+      }</span>
<a href="#l12.985"></a><span id="l12.985"> </span>
<a href="#l12.986"></a><span id="l12.986" class="difflineminus">-              popup.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.987"></a><span id="l12.987" class="difflineminus">-              node.appendChild(popup);</span>
<a href="#l12.988"></a><span id="l12.988" class="difflineplus">+      // In some cases, the user wants to have a list of subfolders for only</span>
<a href="#l12.989"></a><span id="l12.989" class="difflineplus">+      // some account types (or maybe all of them). So we use this to</span>
<a href="#l12.990"></a><span id="l12.990" class="difflineplus">+      // determine what the user wanted.</span>
<a href="#l12.991"></a><span id="l12.991" class="difflineplus">+      let shouldExpand;</span>
<a href="#l12.992"></a><span id="l12.992" class="difflineplus">+      let labels = null;</span>
<a href="#l12.993"></a><span id="l12.993" class="difflineplus">+      if (this.getAttribute(&quot;expandFolders&quot;) == &quot;true&quot; ||</span>
<a href="#l12.994"></a><span id="l12.994" class="difflineplus">+        !this.hasAttribute(&quot;expandFolders&quot;)) {</span>
<a href="#l12.995"></a><span id="l12.995" class="difflineplus">+        shouldExpand = () =&gt; true;</span>
<a href="#l12.996"></a><span id="l12.996" class="difflineplus">+      } else if (this.getAttribute(&quot;expandFolders&quot;) == &quot;false&quot;) {</span>
<a href="#l12.997"></a><span id="l12.997" class="difflineplus">+        shouldExpand = () =&gt; false;</span>
<a href="#l12.998"></a><span id="l12.998" class="difflineplus">+      } else {</span>
<a href="#l12.999"></a><span id="l12.999" class="difflineplus">+        // We want a subfolder list for only some servers. We also may need</span>
<a href="#l12.1000"></a><span id="l12.1000" class="difflineplus">+        // to create headers to select the servers. If so, then headlabels</span>
<a href="#l12.1001"></a><span id="l12.1001" class="difflineplus">+        // is a comma-delimited list of labels corresponding to the server</span>
<a href="#l12.1002"></a><span id="l12.1002" class="difflineplus">+        // types specified in expandFolders.</span>
<a href="#l12.1003"></a><span id="l12.1003" class="difflineplus">+        let types = this.getAttribute(&quot;expandFolders&quot;).split(/ *, */);</span>
<a href="#l12.1004"></a><span id="l12.1004" class="difflineplus">+        // Set the labels. labels[type] = label</span>
<a href="#l12.1005"></a><span id="l12.1005" class="difflineplus">+        if (this.hasAttribute(&quot;headlabels&quot;)) {</span>
<a href="#l12.1006"></a><span id="l12.1006" class="difflineplus">+          let labelNames = this.getAttribute(&quot;headlabels&quot;).split(/ *, */);</span>
<a href="#l12.1007"></a><span id="l12.1007" class="difflineplus">+          labels = {};</span>
<a href="#l12.1008"></a><span id="l12.1008" class="difflineplus">+          // If the length isn't equal, don't give them any of the labels,</span>
<a href="#l12.1009"></a><span id="l12.1009" class="difflineplus">+          // since any combination will probably be wrong.</span>
<a href="#l12.1010"></a><span id="l12.1010" class="difflineplus">+          if (labelNames.length == types.length) {</span>
<a href="#l12.1011"></a><span id="l12.1011" class="difflineplus">+            for (let index in types) {</span>
<a href="#l12.1012"></a><span id="l12.1012" class="difflineplus">+              labels[types[index]] = labelNames[index];</span>
<a href="#l12.1013"></a><span id="l12.1013">             }</span>
<a href="#l12.1014"></a><span id="l12.1014" class="difflineminus">-</span>
<a href="#l12.1015"></a><span id="l12.1015" class="difflineminus">-            if (disableServers.includes(folder.server.key))</span>
<a href="#l12.1016"></a><span id="l12.1016" class="difflineminus">-              node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.1017"></a><span id="l12.1017" class="difflineminus">-</span>
<a href="#l12.1018"></a><span id="l12.1018" class="difflineminus">-            node._folder = folder;</span>
<a href="#l12.1019"></a><span id="l12.1019" class="difflineminus">-            let label = &quot;&quot;;</span>
<a href="#l12.1020"></a><span id="l12.1020" class="difflineminus">-            if (mode == &quot;deferred&quot; &amp;&amp; folder.isServer &amp;&amp;</span>
<a href="#l12.1021"></a><span id="l12.1021" class="difflineminus">-                folder.server.rootFolder == globalInboxFolder) {</span>
<a href="#l12.1022"></a><span id="l12.1022" class="difflineminus">-              label = this._stringBundle.get(&quot;globalInbox&quot;, [folder.prettyName]);</span>
<a href="#l12.1023"></a><span id="l12.1023" class="difflineminus">-            } else {</span>
<a href="#l12.1024"></a><span id="l12.1024" class="difflineminus">-              label = folder.prettyName;</span>
<a href="#l12.1025"></a><span id="l12.1025" class="difflineminus">-            }</span>
<a href="#l12.1026"></a><span id="l12.1026" class="difflineminus">-            node.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1027"></a><span id="l12.1027" class="difflineminus">-            this._setCssSelectors(folder, node);</span>
<a href="#l12.1028"></a><span id="l12.1028">           }</span>
<a href="#l12.1029"></a><span id="l12.1029" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1030"></a><span id="l12.1030" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1031"></a><span id="l12.1031" class="difflineplus">+        }</span>
<a href="#l12.1032"></a><span id="l12.1032" class="difflineplus">+        shouldExpand = (e) =&gt; types.includes(e);</span>
<a href="#l12.1033"></a><span id="l12.1033" class="difflineplus">+      }</span>
<a href="#l12.1034"></a><span id="l12.1034"> </span>
<a href="#l12.1035"></a><span id="l12.1035" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1036"></a><span id="l12.1036" class="difflineminus">-         - This only builds the menu item in the top-level menulist.</span>
<a href="#l12.1037"></a><span id="l12.1037" class="difflineminus">-         - The real submenu will be created once the popup is really shown,</span>
<a href="#l12.1038"></a><span id="l12.1038" class="difflineminus">-         - via the _buildSpecialSubmenu method.</span>
<a href="#l12.1039"></a><span id="l12.1039" class="difflineminus">-         --&gt;</span>
<a href="#l12.1040"></a><span id="l12.1040" class="difflineminus">-      &lt;method name=&quot;_buildSpecialMenu&quot;&gt;</span>
<a href="#l12.1041"></a><span id="l12.1041" class="difflineminus">-        &lt;parameter name=&quot;type&quot;/&gt;</span>
<a href="#l12.1042"></a><span id="l12.1042" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1043"></a><span id="l12.1043" class="difflineminus">-          // Now create the Recent folder and its children</span>
<a href="#l12.1044"></a><span id="l12.1044" class="difflineminus">-          let menu = document.createXULElement(&quot;menu&quot;);</span>
<a href="#l12.1045"></a><span id="l12.1045" class="difflineminus">-          if (type == &quot;recent&quot;) {</span>
<a href="#l12.1046"></a><span id="l12.1046" class="difflineminus">-            menu.setAttribute(&quot;label&quot;, this.getAttribute(&quot;recentLabel&quot;));</span>
<a href="#l12.1047"></a><span id="l12.1047" class="difflineminus">-            menu.setAttribute(&quot;accesskey&quot;, this.getAttribute(&quot;recentAccessKey&quot;));</span>
<a href="#l12.1048"></a><span id="l12.1048" class="difflineminus">-          } else {</span>
<a href="#l12.1049"></a><span id="l12.1049" class="difflineminus">-            menu.setAttribute(&quot;label&quot;, this.getAttribute(&quot;favoritesLabel&quot;));</span>
<a href="#l12.1050"></a><span id="l12.1050" class="difflineminus">-            menu.setAttribute(&quot;accesskey&quot;, this.getAttribute(&quot;favoritesAccessKey&quot;));</span>
<a href="#l12.1051"></a><span id="l12.1051" class="difflineminus">-          }</span>
<a href="#l12.1052"></a><span id="l12.1052" class="difflineminus">-          menu.setAttribute(&quot;special&quot;, type);</span>
<a href="#l12.1053"></a><span id="l12.1053" class="difflineminus">-          menu.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1054"></a><span id="l12.1054" class="difflineminus">-</span>
<a href="#l12.1055"></a><span id="l12.1055" class="difflineminus">-          let popup = document.createXULElement(&quot;menupopup&quot;);</span>
<a href="#l12.1056"></a><span id="l12.1056" class="difflineminus">-          popup.setAttribute(&quot;class&quot;, this.getAttribute(&quot;class&quot;));</span>
<a href="#l12.1057"></a><span id="l12.1057" class="difflineminus">-          popup.addEventListener(&quot;popupshowing&quot;,</span>
<a href="#l12.1058"></a><span id="l12.1058" class="difflineminus">-                                 () =&gt; this._buildSpecialSubmenu(menu),</span>
<a href="#l12.1059"></a><span id="l12.1059" class="difflineminus">-                                 { once: true });</span>
<a href="#l12.1060"></a><span id="l12.1060" class="difflineplus">+      // We need to call this, or hasSubFolders will always return false.</span>
<a href="#l12.1061"></a><span id="l12.1061" class="difflineplus">+      // Remove this workaround when Bug 502900 is fixed.</span>
<a href="#l12.1062"></a><span id="l12.1062" class="difflineplus">+      MailUtils.discoverFolders();</span>
<a href="#l12.1063"></a><span id="l12.1063" class="difflineplus">+      this._serversOnly = true;</span>
<a href="#l12.1064"></a><span id="l12.1064"> </span>
<a href="#l12.1065"></a><span id="l12.1065" class="difflineminus">-          menu.appendChild(popup);</span>
<a href="#l12.1066"></a><span id="l12.1066" class="difflineminus">-          this.appendChild(menu);</span>
<a href="#l12.1067"></a><span id="l12.1067" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1068"></a><span id="l12.1068" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1069"></a><span id="l12.1069" class="difflineminus">-</span>
<a href="#l12.1070"></a><span id="l12.1070" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1071"></a><span id="l12.1071" class="difflineminus">-         - Builds a submenu with all of the recently used folders in it, to</span>
<a href="#l12.1072"></a><span id="l12.1072" class="difflineminus">-         - allow for easy access.</span>
<a href="#l12.1073"></a><span id="l12.1073" class="difflineminus">-        --&gt;</span>
<a href="#l12.1074"></a><span id="l12.1074" class="difflineminus">-      &lt;method name=&quot;_buildSpecialSubmenu&quot;&gt;</span>
<a href="#l12.1075"></a><span id="l12.1075" class="difflineminus">-        &lt;parameter name=&quot;menu&quot;/&gt;</span>
<a href="#l12.1076"></a><span id="l12.1076" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1077"></a><span id="l12.1077" class="difflineminus">-          let specialType = menu.getAttribute(&quot;special&quot;);</span>
<a href="#l12.1078"></a><span id="l12.1078" class="difflineminus">-          if (this._initializedSpecials.has(specialType))</span>
<a href="#l12.1079"></a><span id="l12.1079" class="difflineminus">-            return;</span>
<a href="#l12.1080"></a><span id="l12.1080" class="difflineminus">-</span>
<a href="#l12.1081"></a><span id="l12.1081" class="difflineminus">-          // Iterate through all folders in all accounts matching the current filter.</span>
<a href="#l12.1082"></a><span id="l12.1082" class="difflineminus">-          let specialFolders = this.toArray(</span>
<a href="#l12.1083"></a><span id="l12.1083" class="difflineminus">-            this.fixIterator(this.MailServices.accounts.allFolders, Ci.nsIMsgFolder));</span>
<a href="#l12.1084"></a><span id="l12.1084" class="difflineminus">-          if (this._listener._filterFunction)</span>
<a href="#l12.1085"></a><span id="l12.1085" class="difflineminus">-            specialFolders = specialFolders.filter(this._listener._filterFunction);</span>
<a href="#l12.1086"></a><span id="l12.1086" class="difflineplus">+      for (let folder of folders) {</span>
<a href="#l12.1087"></a><span id="l12.1087" class="difflineplus">+        let node;</span>
<a href="#l12.1088"></a><span id="l12.1088" class="difflineplus">+        if (!folder.isServer) {</span>
<a href="#l12.1089"></a><span id="l12.1089" class="difflineplus">+          this._serversOnly = false;</span>
<a href="#l12.1090"></a><span id="l12.1090" class="difflineplus">+        }</span>
<a href="#l12.1091"></a><span id="l12.1091"> </span>
<a href="#l12.1092"></a><span id="l12.1092" class="difflineminus">-          switch (specialType) {</span>
<a href="#l12.1093"></a><span id="l12.1093" class="difflineminus">-            case &quot;recent&quot;:</span>
<a href="#l12.1094"></a><span id="l12.1094" class="difflineminus">-              // Find 15 (_MAXRECENT) of most recently modified ones.</span>
<a href="#l12.1095"></a><span id="l12.1095" class="difflineminus">-              specialFolders = this.getMostRecentFolders(specialFolders,</span>
<a href="#l12.1096"></a><span id="l12.1096" class="difflineminus">-                                                         this._MAXRECENT,</span>
<a href="#l12.1097"></a><span id="l12.1097" class="difflineminus">-                                                         &quot;MRMTime&quot;);</span>
<a href="#l12.1098"></a><span id="l12.1098" class="difflineminus">-              break;</span>
<a href="#l12.1099"></a><span id="l12.1099" class="difflineminus">-            case &quot;favorites&quot;:</span>
<a href="#l12.1100"></a><span id="l12.1100" class="difflineminus">-              specialFolders = specialFolders.filter(folder =&gt; folder.getFlag(Ci.nsMsgFolderFlags.Favorite));</span>
<a href="#l12.1101"></a><span id="l12.1101" class="difflineminus">-              break;</span>
<a href="#l12.1102"></a><span id="l12.1102" class="difflineminus">-          }</span>
<a href="#l12.1103"></a><span id="l12.1103" class="difflineplus">+        // If we're going to add subFolders, we need to make menus, not</span>
<a href="#l12.1104"></a><span id="l12.1104" class="difflineplus">+        // menuitems.</span>
<a href="#l12.1105"></a><span id="l12.1105" class="difflineplus">+        if (!folder.hasSubFolders || !shouldExpand(folder.server.type)) {</span>
<a href="#l12.1106"></a><span id="l12.1106" class="difflineplus">+          node = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1107"></a><span id="l12.1107" class="difflineplus">+          // Grumble, grumble, legacy code support</span>
<a href="#l12.1108"></a><span id="l12.1108" class="difflineplus">+          node.setAttribute(&quot;id&quot;, folder.URI);</span>
<a href="#l12.1109"></a><span id="l12.1109" class="difflineplus">+          node.setAttribute(&quot;class&quot;, &quot;folderMenuItem menuitem-iconic&quot;);</span>
<a href="#l12.1110"></a><span id="l12.1110" class="difflineplus">+          node.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1111"></a><span id="l12.1111" class="difflineplus">+          this.appendChild(node);</span>
<a href="#l12.1112"></a><span id="l12.1112" class="difflineplus">+        } else {</span>
<a href="#l12.1113"></a><span id="l12.1113" class="difflineplus">+          this._serversOnly = false;</span>
<a href="#l12.1114"></a><span id="l12.1114" class="difflineplus">+          // xxx this is slightly problematic in that we haven't confirmed</span>
<a href="#l12.1115"></a><span id="l12.1115" class="difflineplus">+          //     whether any of the subfolders will pass the filter.</span>
<a href="#l12.1116"></a><span id="l12.1116" class="difflineplus">+          node = document.createXULElement(&quot;menu&quot;);</span>
<a href="#l12.1117"></a><span id="l12.1117" class="difflineplus">+          node.setAttribute(&quot;class&quot;, &quot;folderMenuItem menu-iconic&quot;);</span>
<a href="#l12.1118"></a><span id="l12.1118" class="difflineplus">+          node.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1119"></a><span id="l12.1119" class="difflineplus">+          this.appendChild(node);</span>
<a href="#l12.1120"></a><span id="l12.1120"> </span>
<a href="#l12.1121"></a><span id="l12.1121" class="difflineminus">-          // Cache the pretty names so that they do not need to be fetched</span>
<a href="#l12.1122"></a><span id="l12.1122" class="difflineminus">-          // _MAXRECENT^2 times later.</span>
<a href="#l12.1123"></a><span id="l12.1123" class="difflineminus">-          let specialFoldersMap = specialFolders.map(function(f) {</span>
<a href="#l12.1124"></a><span id="l12.1124" class="difflineminus">-            return {</span>
<a href="#l12.1125"></a><span id="l12.1125" class="difflineminus">-              folder: f,</span>
<a href="#l12.1126"></a><span id="l12.1126" class="difflineminus">-              name: f.prettyName,</span>
<a href="#l12.1127"></a><span id="l12.1127" class="difflineminus">-            };</span>
<a href="#l12.1128"></a><span id="l12.1128" class="difflineminus">-          });</span>
<a href="#l12.1129"></a><span id="l12.1129" class="difflineminus">-</span>
<a href="#l12.1130"></a><span id="l12.1130" class="difflineminus">-          // Because we're scanning across multiple accounts, we can end up with</span>
<a href="#l12.1131"></a><span id="l12.1131" class="difflineminus">-          // several folders with the same name. Find those dupes.</span>
<a href="#l12.1132"></a><span id="l12.1132" class="difflineminus">-          let dupeNames = new Set();</span>
<a href="#l12.1133"></a><span id="l12.1133" class="difflineminus">-          for (let i = 0; i &lt; specialFoldersMap.length; i++) {</span>
<a href="#l12.1134"></a><span id="l12.1134" class="difflineminus">-            for (let j = i + 1; j &lt; specialFoldersMap.length; j++) {</span>
<a href="#l12.1135"></a><span id="l12.1135" class="difflineminus">-              if (specialFoldersMap[i].name == specialFoldersMap[j].name)</span>
<a href="#l12.1136"></a><span id="l12.1136" class="difflineminus">-                dupeNames.add(specialFoldersMap[i].name);</span>
<a href="#l12.1137"></a><span id="l12.1137" class="difflineminus">-            }</span>
<a href="#l12.1138"></a><span id="l12.1138" class="difflineplus">+          // Create the submenu.</span>
<a href="#l12.1139"></a><span id="l12.1139" class="difflineplus">+          let popup = document.createXULElement(&quot;menupopup&quot;, { &quot;is&quot;: &quot;folder-menupopup&quot; });</span>
<a href="#l12.1140"></a><span id="l12.1140" class="difflineplus">+          popup._parentFolder = folder;</span>
<a href="#l12.1141"></a><span id="l12.1141" class="difflineplus">+          popup.setAttribute(&quot;class&quot;, this.getAttribute(&quot;class&quot;));</span>
<a href="#l12.1142"></a><span id="l12.1142" class="difflineplus">+          popup.setAttribute(&quot;type&quot;, this.getAttribute(&quot;type&quot;));</span>
<a href="#l12.1143"></a><span id="l12.1143" class="difflineplus">+          if (this.hasAttribute(&quot;fileHereLabel&quot;)) {</span>
<a href="#l12.1144"></a><span id="l12.1144" class="difflineplus">+            popup.setAttribute(&quot;fileHereLabel&quot;,</span>
<a href="#l12.1145"></a><span id="l12.1145" class="difflineplus">+              this.getAttribute(&quot;fileHereLabel&quot;));</span>
<a href="#l12.1146"></a><span id="l12.1146" class="difflineplus">+          }</span>
<a href="#l12.1147"></a><span id="l12.1147" class="difflineplus">+          popup.setAttribute(&quot;showFileHereLabel&quot;,</span>
<a href="#l12.1148"></a><span id="l12.1148" class="difflineplus">+            this.getAttribute(&quot;showFileHereLabel&quot;));</span>
<a href="#l12.1149"></a><span id="l12.1149" class="difflineplus">+          popup.setAttribute(&quot;oncommand&quot;,</span>
<a href="#l12.1150"></a><span id="l12.1150" class="difflineplus">+            this.getAttribute(&quot;oncommand&quot;));</span>
<a href="#l12.1151"></a><span id="l12.1151" class="difflineplus">+          popup.setAttribute(&quot;mode&quot;,</span>
<a href="#l12.1152"></a><span id="l12.1152" class="difflineplus">+            this.getAttribute(&quot;mode&quot;));</span>
<a href="#l12.1153"></a><span id="l12.1153" class="difflineplus">+          if (this.hasAttribute(&quot;disableServers&quot;)) {</span>
<a href="#l12.1154"></a><span id="l12.1154" class="difflineplus">+            popup.setAttribute(&quot;disableServers&quot;,</span>
<a href="#l12.1155"></a><span id="l12.1155" class="difflineplus">+              this.getAttribute(&quot;disableServers&quot;));</span>
<a href="#l12.1156"></a><span id="l12.1156" class="difflineplus">+          }</span>
<a href="#l12.1157"></a><span id="l12.1157" class="difflineplus">+          if (this.hasAttribute(&quot;position&quot;)) {</span>
<a href="#l12.1158"></a><span id="l12.1158" class="difflineplus">+            popup.setAttribute(&quot;position&quot;,</span>
<a href="#l12.1159"></a><span id="l12.1159" class="difflineplus">+              this.getAttribute(&quot;position&quot;));</span>
<a href="#l12.1160"></a><span id="l12.1160">           }</span>
<a href="#l12.1161"></a><span id="l12.1161"> </span>
<a href="#l12.1162"></a><span id="l12.1162" class="difflineminus">-          for (let folderItem of specialFoldersMap) {</span>
<a href="#l12.1163"></a><span id="l12.1163" class="difflineminus">-            // If this folder name appears multiple times in the recent list,</span>
<a href="#l12.1164"></a><span id="l12.1164" class="difflineminus">-            // append the server name to disambiguate.</span>
<a href="#l12.1165"></a><span id="l12.1165" class="difflineminus">-            // TODO:</span>
<a href="#l12.1166"></a><span id="l12.1166" class="difflineminus">-            // - maybe this could use verboseFolderFormat from messenger.properties</span>
<a href="#l12.1167"></a><span id="l12.1167" class="difflineminus">-            //   instead of hardcoded &quot; - &quot;.</span>
<a href="#l12.1168"></a><span id="l12.1168" class="difflineminus">-            // - disambiguate folders with same name in same account</span>
<a href="#l12.1169"></a><span id="l12.1169" class="difflineminus">-            //   (in different subtrees).</span>
<a href="#l12.1170"></a><span id="l12.1170" class="difflineminus">-            let label = folderItem.name;</span>
<a href="#l12.1171"></a><span id="l12.1171" class="difflineminus">-            if (dupeNames.has(label))</span>
<a href="#l12.1172"></a><span id="l12.1172" class="difflineminus">-              label += &quot; - &quot; + folderItem.folder.server.prettyName;</span>
<a href="#l12.1173"></a><span id="l12.1173" class="difflineplus">+          // If there are labels, add the labels now.</span>
<a href="#l12.1174"></a><span id="l12.1174" class="difflineplus">+          if (labels) {</span>
<a href="#l12.1175"></a><span id="l12.1175" class="difflineplus">+            let serverNode = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1176"></a><span id="l12.1176" class="difflineplus">+            serverNode.setAttribute(&quot;label&quot;, labels[folder.server.type]);</span>
<a href="#l12.1177"></a><span id="l12.1177" class="difflineplus">+            serverNode._folder = folder;</span>
<a href="#l12.1178"></a><span id="l12.1178" class="difflineplus">+            serverNode.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1179"></a><span id="l12.1179" class="difflineplus">+            popup.appendChild(serverNode);</span>
<a href="#l12.1180"></a><span id="l12.1180" class="difflineplus">+            let sep = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.1181"></a><span id="l12.1181" class="difflineplus">+            sep.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1182"></a><span id="l12.1182" class="difflineplus">+            popup.appendChild(sep);</span>
<a href="#l12.1183"></a><span id="l12.1183" class="difflineplus">+          }</span>
<a href="#l12.1184"></a><span id="l12.1184" class="difflineplus">+          popup.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1185"></a><span id="l12.1185" class="difflineplus">+          node.appendChild(popup);</span>
<a href="#l12.1186"></a><span id="l12.1186" class="difflineplus">+        }</span>
<a href="#l12.1187"></a><span id="l12.1187"> </span>
<a href="#l12.1188"></a><span id="l12.1188" class="difflineminus">-            folderItem.label = label;</span>
<a href="#l12.1189"></a><span id="l12.1189" class="difflineminus">-          }</span>
<a href="#l12.1190"></a><span id="l12.1190" class="difflineplus">+        if (disableServers.includes(folder.server.key)) {</span>
<a href="#l12.1191"></a><span id="l12.1191" class="difflineplus">+          node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.1192"></a><span id="l12.1192" class="difflineplus">+        }</span>
<a href="#l12.1193"></a><span id="l12.1193"> </span>
<a href="#l12.1194"></a><span id="l12.1194" class="difflineminus">-          // Make sure the entries are sorted alphabetically.</span>
<a href="#l12.1195"></a><span id="l12.1195" class="difflineminus">-          specialFoldersMap.sort((a, b) =&gt; this.folderNameCompare(a.label, b.label));</span>
<a href="#l12.1196"></a><span id="l12.1196" class="difflineplus">+        node._folder = folder;</span>
<a href="#l12.1197"></a><span id="l12.1197" class="difflineplus">+        let label = &quot;&quot;;</span>
<a href="#l12.1198"></a><span id="l12.1198" class="difflineplus">+        if (mode == &quot;deferred&quot; &amp;&amp; folder.isServer &amp;&amp;</span>
<a href="#l12.1199"></a><span id="l12.1199" class="difflineplus">+          folder.server.rootFolder == globalInboxFolder) {</span>
<a href="#l12.1200"></a><span id="l12.1200" class="difflineplus">+          label = this._stringBundle.get(&quot;globalInbox&quot;, [folder.prettyName]);</span>
<a href="#l12.1201"></a><span id="l12.1201" class="difflineplus">+        } else {</span>
<a href="#l12.1202"></a><span id="l12.1202" class="difflineplus">+          label = folder.prettyName;</span>
<a href="#l12.1203"></a><span id="l12.1203" class="difflineplus">+        }</span>
<a href="#l12.1204"></a><span id="l12.1204" class="difflineplus">+        node.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1205"></a><span id="l12.1205" class="difflineplus">+        this._setCssSelectors(folder, node);</span>
<a href="#l12.1206"></a><span id="l12.1206" class="difflineplus">+      }</span>
<a href="#l12.1207"></a><span id="l12.1207" class="difflineplus">+    }</span>
<a href="#l12.1208"></a><span id="l12.1208"> </span>
<a href="#l12.1209"></a><span id="l12.1209" class="difflineminus">-          // Create entries for each of the recent folders.</span>
<a href="#l12.1210"></a><span id="l12.1210" class="difflineminus">-          for (let folderItem of specialFoldersMap) {</span>
<a href="#l12.1211"></a><span id="l12.1211" class="difflineminus">-            let node = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1212"></a><span id="l12.1212" class="difflineminus">-</span>
<a href="#l12.1213"></a><span id="l12.1213" class="difflineminus">-            node.setAttribute(&quot;label&quot;, folderItem.label);</span>
<a href="#l12.1214"></a><span id="l12.1214" class="difflineminus">-            node._folder = folderItem.folder;</span>
<a href="#l12.1215"></a><span id="l12.1215" class="difflineplus">+    /**</span>
<a href="#l12.1216"></a><span id="l12.1216" class="difflineplus">+     * This only builds the menu item in the top-level menulist.</span>
<a href="#l12.1217"></a><span id="l12.1217" class="difflineplus">+     * The real submenu will be created once the popup is really shown,</span>
<a href="#l12.1218"></a><span id="l12.1218" class="difflineplus">+     * via the _buildSpecialSubmenu method.</span>
<a href="#l12.1219"></a><span id="l12.1219" class="difflineplus">+     *</span>
<a href="#l12.1220"></a><span id="l12.1220" class="difflineplus">+     * @param {string} type - the type of the special menu to build.</span>
<a href="#l12.1221"></a><span id="l12.1221" class="difflineplus">+     */</span>
<a href="#l12.1222"></a><span id="l12.1222" class="difflineplus">+    _buildSpecialMenu(type) {</span>
<a href="#l12.1223"></a><span id="l12.1223" class="difflineplus">+       // Now create the Recent folder and its children.</span>
<a href="#l12.1224"></a><span id="l12.1224" class="difflineplus">+      let menu = document.createXULElement(&quot;menu&quot;);</span>
<a href="#l12.1225"></a><span id="l12.1225" class="difflineplus">+      if (type == &quot;recent&quot;) {</span>
<a href="#l12.1226"></a><span id="l12.1226" class="difflineplus">+        menu.setAttribute(&quot;label&quot;, this.getAttribute(&quot;recentLabel&quot;));</span>
<a href="#l12.1227"></a><span id="l12.1227" class="difflineplus">+        menu.setAttribute(&quot;accesskey&quot;, this.getAttribute(&quot;recentAccessKey&quot;));</span>
<a href="#l12.1228"></a><span id="l12.1228" class="difflineplus">+      } else {</span>
<a href="#l12.1229"></a><span id="l12.1229" class="difflineplus">+        menu.setAttribute(&quot;label&quot;, this.getAttribute(&quot;favoritesLabel&quot;));</span>
<a href="#l12.1230"></a><span id="l12.1230" class="difflineplus">+        menu.setAttribute(&quot;accesskey&quot;, this.getAttribute(&quot;favoritesAccessKey&quot;));</span>
<a href="#l12.1231"></a><span id="l12.1231" class="difflineplus">+      }</span>
<a href="#l12.1232"></a><span id="l12.1232" class="difflineplus">+      menu.setAttribute(&quot;special&quot;, type);</span>
<a href="#l12.1233"></a><span id="l12.1233" class="difflineplus">+      menu.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1234"></a><span id="l12.1234"> </span>
<a href="#l12.1235"></a><span id="l12.1235" class="difflineminus">-            node.setAttribute(&quot;class&quot;, &quot;folderMenuItem menuitem-iconic&quot;);</span>
<a href="#l12.1236"></a><span id="l12.1236" class="difflineminus">-            this._setCssSelectors(folderItem.folder, node);</span>
<a href="#l12.1237"></a><span id="l12.1237" class="difflineminus">-            node.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1238"></a><span id="l12.1238" class="difflineminus">-            menu.menupopup.appendChild(node);</span>
<a href="#l12.1239"></a><span id="l12.1239" class="difflineminus">-          }</span>
<a href="#l12.1240"></a><span id="l12.1240" class="difflineplus">+      let popup = document.createXULElement(&quot;menupopup&quot;);</span>
<a href="#l12.1241"></a><span id="l12.1241" class="difflineplus">+      popup.setAttribute(&quot;class&quot;, this.getAttribute(&quot;class&quot;));</span>
<a href="#l12.1242"></a><span id="l12.1242" class="difflineplus">+      popup.addEventListener(&quot;popupshowing&quot;, (event) =&gt; {</span>
<a href="#l12.1243"></a><span id="l12.1243" class="difflineplus">+        this._buildSpecialSubmenu(menu);</span>
<a href="#l12.1244"></a><span id="l12.1244" class="difflineplus">+      }, { once: true });</span>
<a href="#l12.1245"></a><span id="l12.1245" class="difflineplus">+</span>
<a href="#l12.1246"></a><span id="l12.1246" class="difflineplus">+      menu.appendChild(popup);</span>
<a href="#l12.1247"></a><span id="l12.1247" class="difflineplus">+      this.appendChild(menu);</span>
<a href="#l12.1248"></a><span id="l12.1248" class="difflineplus">+    }</span>
<a href="#l12.1249"></a><span id="l12.1249"> </span>
<a href="#l12.1250"></a><span id="l12.1250" class="difflineminus">-          if (specialFoldersMap.length == 0)</span>
<a href="#l12.1251"></a><span id="l12.1251" class="difflineminus">-            menu.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.1252"></a><span id="l12.1252" class="difflineminus">-</span>
<a href="#l12.1253"></a><span id="l12.1253" class="difflineminus">-          this._initializedSpecials.add(specialType);</span>
<a href="#l12.1254"></a><span id="l12.1254" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1255"></a><span id="l12.1255" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1256"></a><span id="l12.1256" class="difflineplus">+    /**</span>
<a href="#l12.1257"></a><span id="l12.1257" class="difflineplus">+     * Builds a submenu with all of the recently used folders in it, to</span>
<a href="#l12.1258"></a><span id="l12.1258" class="difflineplus">+     * allow for easy access.</span>
<a href="#l12.1259"></a><span id="l12.1259" class="difflineplus">+     *</span>
<a href="#l12.1260"></a><span id="l12.1260" class="difflineplus">+     * @param {Menu} menu - the menu for which one wants to build the special sub menu.</span>
<a href="#l12.1261"></a><span id="l12.1261" class="difflineplus">+     */</span>
<a href="#l12.1262"></a><span id="l12.1262" class="difflineplus">+    _buildSpecialSubmenu(menu) {</span>
<a href="#l12.1263"></a><span id="l12.1263" class="difflineplus">+      let specialType = menu.getAttribute(&quot;special&quot;);</span>
<a href="#l12.1264"></a><span id="l12.1264" class="difflineplus">+      if (this._initializedSpecials.has(specialType)) {</span>
<a href="#l12.1265"></a><span id="l12.1265" class="difflineplus">+        return;</span>
<a href="#l12.1266"></a><span id="l12.1266" class="difflineplus">+      }</span>
<a href="#l12.1267"></a><span id="l12.1267"> </span>
<a href="#l12.1268"></a><span id="l12.1268" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1269"></a><span id="l12.1269" class="difflineminus">-         - This function adds attributes on menu/menuitems to make it easier for</span>
<a href="#l12.1270"></a><span id="l12.1270" class="difflineminus">-         - css to style them.</span>
<a href="#l12.1271"></a><span id="l12.1271" class="difflineminus">-         -</span>
<a href="#l12.1272"></a><span id="l12.1272" class="difflineminus">-         - @param aFolder    the folder that corresponds to the menu/menuitem</span>
<a href="#l12.1273"></a><span id="l12.1273" class="difflineminus">-         - @param aMenuNode  the actual DOM node to set attributes on</span>
<a href="#l12.1274"></a><span id="l12.1274" class="difflineminus">-        --&gt;</span>
<a href="#l12.1275"></a><span id="l12.1275" class="difflineminus">-      &lt;method name=&quot;_setCssSelectors&quot;&gt;</span>
<a href="#l12.1276"></a><span id="l12.1276" class="difflineminus">-        &lt;parameter name=&quot;aFolder&quot;/&gt;</span>
<a href="#l12.1277"></a><span id="l12.1277" class="difflineminus">-        &lt;parameter name=&quot;aMenuNode&quot;/&gt;</span>
<a href="#l12.1278"></a><span id="l12.1278" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1279"></a><span id="l12.1279" class="difflineplus">+      // Iterate through all folders in all accounts matching the current filter.</span>
<a href="#l12.1280"></a><span id="l12.1280" class="difflineplus">+      let specialFolders = toArray(</span>
<a href="#l12.1281"></a><span id="l12.1281" class="difflineplus">+        fixIterator(MailServices.accounts.allFolders, Ci.nsIMsgFolder));</span>
<a href="#l12.1282"></a><span id="l12.1282" class="difflineplus">+      if (this._listener._filterFunction) {</span>
<a href="#l12.1283"></a><span id="l12.1283" class="difflineplus">+        specialFolders = specialFolders.filter(this._listener._filterFunction);</span>
<a href="#l12.1284"></a><span id="l12.1284" class="difflineplus">+      }</span>
<a href="#l12.1285"></a><span id="l12.1285" class="difflineplus">+</span>
<a href="#l12.1286"></a><span id="l12.1286" class="difflineplus">+      switch (specialType) {</span>
<a href="#l12.1287"></a><span id="l12.1287" class="difflineplus">+        case &quot;recent&quot;:</span>
<a href="#l12.1288"></a><span id="l12.1288" class="difflineplus">+          // Find 15 (_MAXRECENT) of most recently modified ones.</span>
<a href="#l12.1289"></a><span id="l12.1289" class="difflineplus">+          specialFolders = getMostRecentFolders(specialFolders,</span>
<a href="#l12.1290"></a><span id="l12.1290" class="difflineplus">+            this._MAXRECENT,</span>
<a href="#l12.1291"></a><span id="l12.1291" class="difflineplus">+            &quot;MRMTime&quot;);</span>
<a href="#l12.1292"></a><span id="l12.1292" class="difflineplus">+          break;</span>
<a href="#l12.1293"></a><span id="l12.1293" class="difflineplus">+        case &quot;favorites&quot;:</span>
<a href="#l12.1294"></a><span id="l12.1294" class="difflineplus">+          specialFolders = specialFolders.filter(folder =&gt; folder.getFlag(Ci.nsMsgFolderFlags.Favorite));</span>
<a href="#l12.1295"></a><span id="l12.1295" class="difflineplus">+          break;</span>
<a href="#l12.1296"></a><span id="l12.1296" class="difflineplus">+      }</span>
<a href="#l12.1297"></a><span id="l12.1297"> </span>
<a href="#l12.1298"></a><span id="l12.1298" class="difflineminus">-          // First set the SpecialFolder attribute</span>
<a href="#l12.1299"></a><span id="l12.1299" class="difflineminus">-          aMenuNode.setAttribute(&quot;SpecialFolder&quot;, this.getSpecialFolderString(aFolder));</span>
<a href="#l12.1300"></a><span id="l12.1300" class="difflineplus">+      // Cache the pretty names so that they do not need to be fetched</span>
<a href="#l12.1301"></a><span id="l12.1301" class="difflineplus">+      // _MAXRECENT^2 times later.</span>
<a href="#l12.1302"></a><span id="l12.1302" class="difflineplus">+      let specialFoldersMap = specialFolders.map(function(f) {</span>
<a href="#l12.1303"></a><span id="l12.1303" class="difflineplus">+        return {</span>
<a href="#l12.1304"></a><span id="l12.1304" class="difflineplus">+          folder: f,</span>
<a href="#l12.1305"></a><span id="l12.1305" class="difflineplus">+          name: f.prettyName,</span>
<a href="#l12.1306"></a><span id="l12.1306" class="difflineplus">+        };</span>
<a href="#l12.1307"></a><span id="l12.1307" class="difflineplus">+      });</span>
<a href="#l12.1308"></a><span id="l12.1308"> </span>
<a href="#l12.1309"></a><span id="l12.1309" class="difflineminus">-          // Now set the biffState</span>
<a href="#l12.1310"></a><span id="l12.1310" class="difflineminus">-          let biffStates = [&quot;NewMail&quot;, &quot;NoMail&quot;, &quot;UnknownMail&quot;];</span>
<a href="#l12.1311"></a><span id="l12.1311" class="difflineminus">-          for (let state of biffStates) {</span>
<a href="#l12.1312"></a><span id="l12.1312" class="difflineminus">-            if (aFolder.biffState ==</span>
<a href="#l12.1313"></a><span id="l12.1313" class="difflineminus">-                Ci.nsIMsgFolder[&quot;nsMsgBiffState_&quot; + state]) {</span>
<a href="#l12.1314"></a><span id="l12.1314" class="difflineminus">-              aMenuNode.setAttribute(&quot;BiffState&quot;, state);</span>
<a href="#l12.1315"></a><span id="l12.1315" class="difflineminus">-              break;</span>
<a href="#l12.1316"></a><span id="l12.1316" class="difflineminus">-            }</span>
<a href="#l12.1317"></a><span id="l12.1317" class="difflineplus">+      // Because we're scanning across multiple accounts, we can end up with</span>
<a href="#l12.1318"></a><span id="l12.1318" class="difflineplus">+      // several folders with the same name. Find those dupes.</span>
<a href="#l12.1319"></a><span id="l12.1319" class="difflineplus">+      let dupeNames = new Set();</span>
<a href="#l12.1320"></a><span id="l12.1320" class="difflineplus">+      for (let i = 0; i &lt; specialFoldersMap.length; i++) {</span>
<a href="#l12.1321"></a><span id="l12.1321" class="difflineplus">+        for (let j = i + 1; j &lt; specialFoldersMap.length; j++) {</span>
<a href="#l12.1322"></a><span id="l12.1322" class="difflineplus">+          if (specialFoldersMap[i].name == specialFoldersMap[j].name) {</span>
<a href="#l12.1323"></a><span id="l12.1323" class="difflineplus">+            dupeNames.add(specialFoldersMap[i].name);</span>
<a href="#l12.1324"></a><span id="l12.1324">           }</span>
<a href="#l12.1325"></a><span id="l12.1325" class="difflineplus">+        }</span>
<a href="#l12.1326"></a><span id="l12.1326" class="difflineplus">+      }</span>
<a href="#l12.1327"></a><span id="l12.1327"> </span>
<a href="#l12.1328"></a><span id="l12.1328" class="difflineminus">-          aMenuNode.setAttribute(&quot;IsServer&quot;, aFolder.isServer);</span>
<a href="#l12.1329"></a><span id="l12.1329" class="difflineminus">-          aMenuNode.setAttribute(&quot;IsSecure&quot;, aFolder.server.isSecure);</span>
<a href="#l12.1330"></a><span id="l12.1330" class="difflineminus">-          aMenuNode.setAttribute(&quot;ServerType&quot;, aFolder.server.type);</span>
<a href="#l12.1331"></a><span id="l12.1331" class="difflineminus">-          aMenuNode.setAttribute(&quot;IsFeedFolder&quot;, !!this.FeedUtils.getFeedUrlsInFolder(aFolder));</span>
<a href="#l12.1332"></a><span id="l12.1332" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1333"></a><span id="l12.1333" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1334"></a><span id="l12.1334" class="difflineplus">+      for (let folderItem of specialFoldersMap) {</span>
<a href="#l12.1335"></a><span id="l12.1335" class="difflineplus">+        // If this folder name appears multiple times in the recent list,</span>
<a href="#l12.1336"></a><span id="l12.1336" class="difflineplus">+        // append the server name to disambiguate.</span>
<a href="#l12.1337"></a><span id="l12.1337" class="difflineplus">+        // TODO:</span>
<a href="#l12.1338"></a><span id="l12.1338" class="difflineplus">+        //  - maybe this could use verboseFolderFormat from messenger.properties</span>
<a href="#l12.1339"></a><span id="l12.1339" class="difflineplus">+        //  instead of hardcoded &quot; - &quot;.</span>
<a href="#l12.1340"></a><span id="l12.1340" class="difflineplus">+        //  - disambiguate folders with same name in same account</span>
<a href="#l12.1341"></a><span id="l12.1341" class="difflineplus">+        //  (in different subtrees).</span>
<a href="#l12.1342"></a><span id="l12.1342" class="difflineplus">+        let label = folderItem.name;</span>
<a href="#l12.1343"></a><span id="l12.1343" class="difflineplus">+        if (dupeNames.has(label)) {</span>
<a href="#l12.1344"></a><span id="l12.1344" class="difflineplus">+          label += &quot; - &quot; + folderItem.folder.server.prettyName;</span>
<a href="#l12.1345"></a><span id="l12.1345" class="difflineplus">+        }</span>
<a href="#l12.1346"></a><span id="l12.1346" class="difflineplus">+</span>
<a href="#l12.1347"></a><span id="l12.1347" class="difflineplus">+        folderItem.label = label;</span>
<a href="#l12.1348"></a><span id="l12.1348" class="difflineplus">+      }</span>
<a href="#l12.1349"></a><span id="l12.1349" class="difflineplus">+</span>
<a href="#l12.1350"></a><span id="l12.1350" class="difflineplus">+      // Make sure the entries are sorted alphabetically.</span>
<a href="#l12.1351"></a><span id="l12.1351" class="difflineplus">+      specialFoldersMap.sort((a, b) =&gt; folderNameCompare(a.label, b.label));</span>
<a href="#l12.1352"></a><span id="l12.1352"> </span>
<a href="#l12.1353"></a><span id="l12.1353" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1354"></a><span id="l12.1354" class="difflineminus">-         - This function returns a formatted display name for a menulist</span>
<a href="#l12.1355"></a><span id="l12.1355" class="difflineminus">-         - selected folder.  The desired format is set as the 'displayformat'</span>
<a href="#l12.1356"></a><span id="l12.1356" class="difflineminus">-         - attribute of the folderpicker's &lt;menulist&gt;, one of:</span>
<a href="#l12.1357"></a><span id="l12.1357" class="difflineminus">-         - 'name' (default) - Folder</span>
<a href="#l12.1358"></a><span id="l12.1358" class="difflineminus">-         - 'verbose'        - Folder on Account</span>
<a href="#l12.1359"></a><span id="l12.1359" class="difflineminus">-         - 'path'           - Account/Folder/Subfolder</span>
<a href="#l12.1360"></a><span id="l12.1360" class="difflineminus">-         -</span>
<a href="#l12.1361"></a><span id="l12.1361" class="difflineminus">-         - @param aFolder    the folder that corresponds to the menu/menuitem</span>
<a href="#l12.1362"></a><span id="l12.1362" class="difflineminus">-         - @return string    display name</span>
<a href="#l12.1363"></a><span id="l12.1363" class="difflineminus">-        --&gt;</span>
<a href="#l12.1364"></a><span id="l12.1364" class="difflineminus">-      &lt;field name=&quot;_displayformat&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.1365"></a><span id="l12.1365" class="difflineminus">-      &lt;method name=&quot;getDisplayName&quot;&gt;</span>
<a href="#l12.1366"></a><span id="l12.1366" class="difflineminus">-        &lt;parameter name=&quot;aFolder&quot;/&gt;</span>
<a href="#l12.1367"></a><span id="l12.1367" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1368"></a><span id="l12.1368" class="difflineminus">-          if (aFolder.isServer)</span>
<a href="#l12.1369"></a><span id="l12.1369" class="difflineminus">-            return aFolder.prettyName;</span>
<a href="#l12.1370"></a><span id="l12.1370" class="difflineplus">+      // Create entries for each of the recent folders.</span>
<a href="#l12.1371"></a><span id="l12.1371" class="difflineplus">+      for (let folderItem of specialFoldersMap) {</span>
<a href="#l12.1372"></a><span id="l12.1372" class="difflineplus">+        let node = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1373"></a><span id="l12.1373" class="difflineplus">+</span>
<a href="#l12.1374"></a><span id="l12.1374" class="difflineplus">+        node.setAttribute(&quot;label&quot;, folderItem.label);</span>
<a href="#l12.1375"></a><span id="l12.1375" class="difflineplus">+        node._folder = folderItem.folder;</span>
<a href="#l12.1376"></a><span id="l12.1376"> </span>
<a href="#l12.1377"></a><span id="l12.1377" class="difflineminus">-          if (this._displayformat == &quot;verbose&quot;)</span>
<a href="#l12.1378"></a><span id="l12.1378" class="difflineminus">-            return this._stringBundle.getFormattedString(&quot;verboseFolderFormat&quot;,</span>
<a href="#l12.1379"></a><span id="l12.1379" class="difflineminus">-                     [aFolder.prettyName, aFolder.server.prettyName]);</span>
<a href="#l12.1380"></a><span id="l12.1380" class="difflineplus">+        node.setAttribute(&quot;class&quot;, &quot;folderMenuItem menuitem-iconic&quot;);</span>
<a href="#l12.1381"></a><span id="l12.1381" class="difflineplus">+        this._setCssSelectors(folderItem.folder, node);</span>
<a href="#l12.1382"></a><span id="l12.1382" class="difflineplus">+        node.setAttribute(&quot;generated&quot;, &quot;true&quot;);</span>
<a href="#l12.1383"></a><span id="l12.1383" class="difflineplus">+        menu.menupopup.appendChild(node);</span>
<a href="#l12.1384"></a><span id="l12.1384" class="difflineplus">+      }</span>
<a href="#l12.1385"></a><span id="l12.1385"> </span>
<a href="#l12.1386"></a><span id="l12.1386" class="difflineminus">-          if (this._displayformat == &quot;path&quot;)</span>
<a href="#l12.1387"></a><span id="l12.1387" class="difflineminus">-            return this.FeedUtils.getFolderPrettyPath(aFolder) || aFolder.name;</span>
<a href="#l12.1388"></a><span id="l12.1388" class="difflineplus">+      if (specialFoldersMap.length == 0) {</span>
<a href="#l12.1389"></a><span id="l12.1389" class="difflineplus">+        menu.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l12.1390"></a><span id="l12.1390" class="difflineplus">+      }</span>
<a href="#l12.1391"></a><span id="l12.1391"> </span>
<a href="#l12.1392"></a><span id="l12.1392" class="difflineminus">-          return aFolder.name;</span>
<a href="#l12.1393"></a><span id="l12.1393" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1394"></a><span id="l12.1394" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1395"></a><span id="l12.1395" class="difflineplus">+      this._initializedSpecials.add(specialType);</span>
<a href="#l12.1396"></a><span id="l12.1396" class="difflineplus">+    }</span>
<a href="#l12.1397"></a><span id="l12.1397"> </span>
<a href="#l12.1398"></a><span id="l12.1398" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1399"></a><span id="l12.1399" class="difflineminus">-         - Makes a given folder selected.</span>
<a href="#l12.1400"></a><span id="l12.1400" class="difflineminus">-         -</span>
<a href="#l12.1401"></a><span id="l12.1401" class="difflineminus">-         - @param aFolder  the folder to select (if none, then Choose Folder)</span>
<a href="#l12.1402"></a><span id="l12.1402" class="difflineminus">-         - @note  If aFolder is not in this popup, but is instead a descendant of</span>
<a href="#l12.1403"></a><span id="l12.1403" class="difflineminus">-         -        a member of the popup, that ancestor will be selected.</span>
<a href="#l12.1404"></a><span id="l12.1404" class="difflineminus">-         - @return  true if any usable folder was found, otherwise false.</span>
<a href="#l12.1405"></a><span id="l12.1405" class="difflineminus">-        --&gt;</span>
<a href="#l12.1406"></a><span id="l12.1406" class="difflineminus">-      &lt;method name=&quot;selectFolder&quot;&gt;</span>
<a href="#l12.1407"></a><span id="l12.1407" class="difflineminus">-        &lt;parameter name=&quot;aFolder&quot;/&gt;</span>
<a href="#l12.1408"></a><span id="l12.1408" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1409"></a><span id="l12.1409" class="difflineminus">-          // Set the label of the menulist element as if aFolder had been selected.</span>
<a href="#l12.1410"></a><span id="l12.1410" class="difflineminus">-          function setupParent(aFolder, aMenulist, aNoFolders) {</span>
<a href="#l12.1411"></a><span id="l12.1411" class="difflineminus">-            let menupopup = aMenulist.menupopup;</span>
<a href="#l12.1412"></a><span id="l12.1412" class="difflineminus">-            if (aFolder) {</span>
<a href="#l12.1413"></a><span id="l12.1413" class="difflineminus">-              aMenulist.setAttribute(&quot;label&quot;, menupopup.getDisplayName(aFolder));</span>
<a href="#l12.1414"></a><span id="l12.1414" class="difflineminus">-            } else if (aNoFolders) {</span>
<a href="#l12.1415"></a><span id="l12.1415" class="difflineminus">-              aMenulist.setAttribute(&quot;label&quot;, menupopup._stringBundle.getString(&quot;noFolders&quot;));</span>
<a href="#l12.1416"></a><span id="l12.1416" class="difflineminus">-            } else if (menupopup._serversOnly) {</span>
<a href="#l12.1417"></a><span id="l12.1417" class="difflineminus">-              aMenulist.setAttribute(&quot;label&quot;, menupopup._stringBundle.getString(&quot;chooseAccount&quot;));</span>
<a href="#l12.1418"></a><span id="l12.1418" class="difflineminus">-            } else {</span>
<a href="#l12.1419"></a><span id="l12.1419" class="difflineminus">-              aMenulist.setAttribute(&quot;label&quot;, menupopup._stringBundle.getString(&quot;chooseFolder&quot;));</span>
<a href="#l12.1420"></a><span id="l12.1420" class="difflineminus">-            }</span>
<a href="#l12.1421"></a><span id="l12.1421" class="difflineminus">-            aMenulist.setAttribute(&quot;value&quot;,</span>
<a href="#l12.1422"></a><span id="l12.1422" class="difflineminus">-              aFolder ? aFolder.URI : &quot;&quot;);</span>
<a href="#l12.1423"></a><span id="l12.1423" class="difflineminus">-            aMenulist.setAttribute(&quot;IsServer&quot;,</span>
<a href="#l12.1424"></a><span id="l12.1424" class="difflineminus">-              aFolder ? aFolder.isServer : false);</span>
<a href="#l12.1425"></a><span id="l12.1425" class="difflineminus">-            aMenulist.setAttribute(&quot;IsSecure&quot;,</span>
<a href="#l12.1426"></a><span id="l12.1426" class="difflineminus">-              aFolder ? aFolder.server.isSecure : false);</span>
<a href="#l12.1427"></a><span id="l12.1427" class="difflineminus">-            aMenulist.setAttribute(&quot;ServerType&quot;,</span>
<a href="#l12.1428"></a><span id="l12.1428" class="difflineminus">-              aFolder ? aFolder.server.type : &quot;none&quot;);</span>
<a href="#l12.1429"></a><span id="l12.1429" class="difflineminus">-            aMenulist.setAttribute(&quot;SpecialFolder&quot;,</span>
<a href="#l12.1430"></a><span id="l12.1430" class="difflineminus">-              aFolder ? menupopup.getSpecialFolderString(aFolder) : &quot;none&quot;);</span>
<a href="#l12.1431"></a><span id="l12.1431" class="difflineminus">-            aMenulist.setAttribute(&quot;IsFeedFolder&quot;, Boolean(</span>
<a href="#l12.1432"></a><span id="l12.1432" class="difflineminus">-              aFolder &amp;&amp; menupopup.FeedUtils.getFeedUrlsInFolder(aFolder)));</span>
<a href="#l12.1433"></a><span id="l12.1433" class="difflineminus">-          }</span>
<a href="#l12.1434"></a><span id="l12.1434" class="difflineplus">+    /**</span>
<a href="#l12.1435"></a><span id="l12.1435" class="difflineplus">+     * This function adds attributes on menu/menuitems to make it easier for</span>
<a href="#l12.1436"></a><span id="l12.1436" class="difflineplus">+     * css to style them.</span>
<a href="#l12.1437"></a><span id="l12.1437" class="difflineplus">+     *</span>
<a href="#l12.1438"></a><span id="l12.1438" class="difflineplus">+     * @param {nsIMsgFolder} folder - the folder that corresponds to the menu/menuitem</span>
<a href="#l12.1439"></a><span id="l12.1439" class="difflineplus">+     * @param {Menu} menuNode       - the actual DOM node to set attributes on</span>
<a href="#l12.1440"></a><span id="l12.1440" class="difflineplus">+     */</span>
<a href="#l12.1441"></a><span id="l12.1441" class="difflineplus">+    _setCssSelectors(folder, menuNode) {</span>
<a href="#l12.1442"></a><span id="l12.1442" class="difflineplus">+      // First set the SpecialFolder attribute.</span>
<a href="#l12.1443"></a><span id="l12.1443" class="difflineplus">+      menuNode.setAttribute(&quot;SpecialFolder&quot;, getSpecialFolderString(folder));</span>
<a href="#l12.1444"></a><span id="l12.1444" class="difflineplus">+</span>
<a href="#l12.1445"></a><span id="l12.1445" class="difflineplus">+      // Now set the biffState.</span>
<a href="#l12.1446"></a><span id="l12.1446" class="difflineplus">+      let biffStates = [&quot;NewMail&quot;, &quot;NoMail&quot;, &quot;UnknownMail&quot;];</span>
<a href="#l12.1447"></a><span id="l12.1447" class="difflineplus">+      for (let state of biffStates) {</span>
<a href="#l12.1448"></a><span id="l12.1448" class="difflineplus">+        if (folder.biffState ==</span>
<a href="#l12.1449"></a><span id="l12.1449" class="difflineplus">+          Ci.nsIMsgFolder[&quot;nsMsgBiffState_&quot; + state]) {</span>
<a href="#l12.1450"></a><span id="l12.1450" class="difflineplus">+          menuNode.setAttribute(&quot;BiffState&quot;, state);</span>
<a href="#l12.1451"></a><span id="l12.1451" class="difflineplus">+          break;</span>
<a href="#l12.1452"></a><span id="l12.1452" class="difflineplus">+        }</span>
<a href="#l12.1453"></a><span id="l12.1453" class="difflineplus">+      }</span>
<a href="#l12.1454"></a><span id="l12.1454" class="difflineplus">+</span>
<a href="#l12.1455"></a><span id="l12.1455" class="difflineplus">+      menuNode.setAttribute(&quot;IsServer&quot;, folder.isServer);</span>
<a href="#l12.1456"></a><span id="l12.1456" class="difflineplus">+      menuNode.setAttribute(&quot;IsSecure&quot;, folder.server.isSecure);</span>
<a href="#l12.1457"></a><span id="l12.1457" class="difflineplus">+      menuNode.setAttribute(&quot;ServerType&quot;, folder.server.type);</span>
<a href="#l12.1458"></a><span id="l12.1458" class="difflineplus">+      menuNode.setAttribute(&quot;IsFeedFolder&quot;, !!FeedUtils.getFeedUrlsInFolder(folder));</span>
<a href="#l12.1459"></a><span id="l12.1459" class="difflineplus">+    }</span>
<a href="#l12.1460"></a><span id="l12.1460"> </span>
<a href="#l12.1461"></a><span id="l12.1461" class="difflineminus">-          let folder;</span>
<a href="#l12.1462"></a><span id="l12.1462" class="difflineminus">-          if (aFolder) {</span>
<a href="#l12.1463"></a><span id="l12.1463" class="difflineminus">-            for (let child of this.childNodes) {</span>
<a href="#l12.1464"></a><span id="l12.1464" class="difflineminus">-              if (child &amp;&amp; child._folder &amp;&amp; !child.disabled &amp;&amp;</span>
<a href="#l12.1465"></a><span id="l12.1465" class="difflineminus">-                  (child._folder.URI == aFolder.URI ||</span>
<a href="#l12.1466"></a><span id="l12.1466" class="difflineminus">-                   (child.tagName == &quot;menu&quot; &amp;&amp;</span>
<a href="#l12.1467"></a><span id="l12.1467" class="difflineminus">-                    child._folder.isAncestorOf(aFolder)))) {</span>
<a href="#l12.1468"></a><span id="l12.1468" class="difflineminus">-                if (child._folder.URI == aFolder.URI)</span>
<a href="#l12.1469"></a><span id="l12.1469" class="difflineminus">-                  this.parentNode.selectedItem = child;</span>
<a href="#l12.1470"></a><span id="l12.1470" class="difflineminus">-                folder = aFolder;</span>
<a href="#l12.1471"></a><span id="l12.1471" class="difflineminus">-                break;</span>
<a href="#l12.1472"></a><span id="l12.1472" class="difflineminus">-              }</span>
<a href="#l12.1473"></a><span id="l12.1473" class="difflineminus">-            }</span>
<a href="#l12.1474"></a><span id="l12.1474" class="difflineminus">-          }</span>
<a href="#l12.1475"></a><span id="l12.1475" class="difflineplus">+    /**</span>
<a href="#l12.1476"></a><span id="l12.1476" class="difflineplus">+     * This function returns a formatted display name for a menulist</span>
<a href="#l12.1477"></a><span id="l12.1477" class="difflineplus">+     * selected folder. The desired format is set as the 'displayformat'</span>
<a href="#l12.1478"></a><span id="l12.1478" class="difflineplus">+     * attribute of the folderpicker's &lt;menulist&gt;, one of:</span>
<a href="#l12.1479"></a><span id="l12.1479" class="difflineplus">+     * 'name' (default) - Folder</span>
<a href="#l12.1480"></a><span id="l12.1480" class="difflineplus">+     * 'verbose'        - Folder on Account</span>
<a href="#l12.1481"></a><span id="l12.1481" class="difflineplus">+     * 'path'           - Account/Folder/Subfolder</span>
<a href="#l12.1482"></a><span id="l12.1482" class="difflineplus">+     *</span>
<a href="#l12.1483"></a><span id="l12.1483" class="difflineplus">+     * @param {nsIMsgFolder} folder - the folder that corresponds to the menu/menuitem</span>
<a href="#l12.1484"></a><span id="l12.1484" class="difflineplus">+     * @return {string}             - display name</span>
<a href="#l12.1485"></a><span id="l12.1485" class="difflineplus">+     */</span>
<a href="#l12.1486"></a><span id="l12.1486" class="difflineplus">+    getDisplayName(folder) {</span>
<a href="#l12.1487"></a><span id="l12.1487" class="difflineplus">+      if (folder.isServer) {</span>
<a href="#l12.1488"></a><span id="l12.1488" class="difflineplus">+        return folder.prettyName;</span>
<a href="#l12.1489"></a><span id="l12.1489" class="difflineplus">+      }</span>
<a href="#l12.1490"></a><span id="l12.1490" class="difflineplus">+</span>
<a href="#l12.1491"></a><span id="l12.1491" class="difflineplus">+      if (this._displayformat == &quot;verbose&quot;) {</span>
<a href="#l12.1492"></a><span id="l12.1492" class="difflineplus">+        return this._stringBundle.getFormattedString(&quot;verboseFolderFormat&quot;,</span>
<a href="#l12.1493"></a><span id="l12.1493" class="difflineplus">+          [folder.prettyName, folder.server.prettyName]);</span>
<a href="#l12.1494"></a><span id="l12.1494" class="difflineplus">+      }</span>
<a href="#l12.1495"></a><span id="l12.1495" class="difflineplus">+</span>
<a href="#l12.1496"></a><span id="l12.1496" class="difflineplus">+      if (this._displayformat == &quot;path&quot;) {</span>
<a href="#l12.1497"></a><span id="l12.1497" class="difflineplus">+        return FeedUtils.getFolderPrettyPath(folder) || folder.name;</span>
<a href="#l12.1498"></a><span id="l12.1498" class="difflineplus">+      }</span>
<a href="#l12.1499"></a><span id="l12.1499" class="difflineplus">+</span>
<a href="#l12.1500"></a><span id="l12.1500" class="difflineplus">+      return folder.name;</span>
<a href="#l12.1501"></a><span id="l12.1501" class="difflineplus">+    }</span>
<a href="#l12.1502"></a><span id="l12.1502"> </span>
<a href="#l12.1503"></a><span id="l12.1503" class="difflineminus">-          // If the caller specified a folder to select and it was not</span>
<a href="#l12.1504"></a><span id="l12.1504" class="difflineminus">-          // found, or if the caller didn't pass a folder (meaning a logical</span>
<a href="#l12.1505"></a><span id="l12.1505" class="difflineminus">-          // and valid folder wasn't determined), don't blow up but reset</span>
<a href="#l12.1506"></a><span id="l12.1506" class="difflineminus">-          // attributes and set a nice Choose Folder label so the user may</span>
<a href="#l12.1507"></a><span id="l12.1507" class="difflineminus">-          // select a valid folder per the filter for this picker. If there are</span>
<a href="#l12.1508"></a><span id="l12.1508" class="difflineminus">-          // no children, then no folder passed the filter; disable the menulist</span>
<a href="#l12.1509"></a><span id="l12.1509" class="difflineminus">-          // as there's nothing to choose from.</span>
<a href="#l12.1510"></a><span id="l12.1510" class="difflineminus">-          let noFolders;</span>
<a href="#l12.1511"></a><span id="l12.1511" class="difflineminus">-          if (!this.childElementCount) {</span>
<a href="#l12.1512"></a><span id="l12.1512" class="difflineminus">-            this.parentNode.setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l12.1513"></a><span id="l12.1513" class="difflineminus">-            noFolders = true;</span>
<a href="#l12.1514"></a><span id="l12.1514" class="difflineminus">-          } else {</span>
<a href="#l12.1515"></a><span id="l12.1515" class="difflineminus">-            this.parentNode.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l12.1516"></a><span id="l12.1516" class="difflineminus">-            noFolders = false;</span>
<a href="#l12.1517"></a><span id="l12.1517" class="difflineplus">+    /**</span>
<a href="#l12.1518"></a><span id="l12.1518" class="difflineplus">+     * Makes a given folder selected.</span>
<a href="#l12.1519"></a><span id="l12.1519" class="difflineplus">+     *</span>
<a href="#l12.1520"></a><span id="l12.1520" class="difflineplus">+     * @param {nsIMsgFolder} inputFolder - the folder to select (if none, then Choose Folder)</span>
<a href="#l12.1521"></a><span id="l12.1521" class="difflineplus">+     * @return {boolean}                 - true if any usable folder was found, otherwise false.</span>
<a href="#l12.1522"></a><span id="l12.1522" class="difflineplus">+     * @note  If inputFolder is not in this popup, but is instead a descendant of</span>
<a href="#l12.1523"></a><span id="l12.1523" class="difflineplus">+     *        a member of the popup, that ancestor will be selected.</span>
<a href="#l12.1524"></a><span id="l12.1524" class="difflineplus">+     */</span>
<a href="#l12.1525"></a><span id="l12.1525" class="difflineplus">+    selectFolder(inputFolder) {</span>
<a href="#l12.1526"></a><span id="l12.1526" class="difflineplus">+      // Set the label of the menulist element as if folder had been selected.</span>
<a href="#l12.1527"></a><span id="l12.1527" class="difflineplus">+      function setupParent(folder, menulist, noFolders) {</span>
<a href="#l12.1528"></a><span id="l12.1528" class="difflineplus">+        let menupopup = menulist.menupopup;</span>
<a href="#l12.1529"></a><span id="l12.1529" class="difflineplus">+        if (folder) {</span>
<a href="#l12.1530"></a><span id="l12.1530" class="difflineplus">+          menulist.setAttribute(&quot;label&quot;, menupopup.getDisplayName(folder));</span>
<a href="#l12.1531"></a><span id="l12.1531" class="difflineplus">+        } else if (noFolders) {</span>
<a href="#l12.1532"></a><span id="l12.1532" class="difflineplus">+          menulist.setAttribute(&quot;label&quot;, menupopup._stringBundle.getString(&quot;noFolders&quot;));</span>
<a href="#l12.1533"></a><span id="l12.1533" class="difflineplus">+        } else if (menupopup._serversOnly) {</span>
<a href="#l12.1534"></a><span id="l12.1534" class="difflineplus">+          menulist.setAttribute(&quot;label&quot;, menupopup._stringBundle.getString(&quot;chooseAccount&quot;));</span>
<a href="#l12.1535"></a><span id="l12.1535" class="difflineplus">+        } else {</span>
<a href="#l12.1536"></a><span id="l12.1536" class="difflineplus">+          menulist.setAttribute(&quot;label&quot;, menupopup._stringBundle.getString(&quot;chooseFolder&quot;));</span>
<a href="#l12.1537"></a><span id="l12.1537" class="difflineplus">+        }</span>
<a href="#l12.1538"></a><span id="l12.1538" class="difflineplus">+        menulist.setAttribute(&quot;value&quot;,</span>
<a href="#l12.1539"></a><span id="l12.1539" class="difflineplus">+          folder ? folder.URI : &quot;&quot;);</span>
<a href="#l12.1540"></a><span id="l12.1540" class="difflineplus">+        menulist.setAttribute(&quot;IsServer&quot;,</span>
<a href="#l12.1541"></a><span id="l12.1541" class="difflineplus">+          folder ? folder.isServer : false);</span>
<a href="#l12.1542"></a><span id="l12.1542" class="difflineplus">+        menulist.setAttribute(&quot;IsSecure&quot;,</span>
<a href="#l12.1543"></a><span id="l12.1543" class="difflineplus">+          folder ? folder.server.isSecure : false);</span>
<a href="#l12.1544"></a><span id="l12.1544" class="difflineplus">+        menulist.setAttribute(&quot;ServerType&quot;,</span>
<a href="#l12.1545"></a><span id="l12.1545" class="difflineplus">+          folder ? folder.server.type : &quot;none&quot;);</span>
<a href="#l12.1546"></a><span id="l12.1546" class="difflineplus">+        menulist.setAttribute(&quot;SpecialFolder&quot;,</span>
<a href="#l12.1547"></a><span id="l12.1547" class="difflineplus">+          folder ? getSpecialFolderString(folder) : &quot;none&quot;);</span>
<a href="#l12.1548"></a><span id="l12.1548" class="difflineplus">+        menulist.setAttribute(&quot;IsFeedFolder&quot;, Boolean(</span>
<a href="#l12.1549"></a><span id="l12.1549" class="difflineplus">+          folder &amp;&amp; FeedUtils.getFeedUrlsInFolder(folder)));</span>
<a href="#l12.1550"></a><span id="l12.1550" class="difflineplus">+      }</span>
<a href="#l12.1551"></a><span id="l12.1551" class="difflineplus">+</span>
<a href="#l12.1552"></a><span id="l12.1552" class="difflineplus">+      let folder;</span>
<a href="#l12.1553"></a><span id="l12.1553" class="difflineplus">+      if (inputFolder) {</span>
<a href="#l12.1554"></a><span id="l12.1554" class="difflineplus">+        for (let child of this.childNodes) {</span>
<a href="#l12.1555"></a><span id="l12.1555" class="difflineplus">+          if (child &amp;&amp; child._folder &amp;&amp; !child.disabled &amp;&amp;</span>
<a href="#l12.1556"></a><span id="l12.1556" class="difflineplus">+            (child._folder.URI == inputFolder.URI ||</span>
<a href="#l12.1557"></a><span id="l12.1557" class="difflineplus">+              (child.tagName == &quot;menu&quot; &amp;&amp;</span>
<a href="#l12.1558"></a><span id="l12.1558" class="difflineplus">+                child._folder.isAncestorOf(inputFolder)))) {</span>
<a href="#l12.1559"></a><span id="l12.1559" class="difflineplus">+            if (child._folder.URI == inputFolder.URI) {</span>
<a href="#l12.1560"></a><span id="l12.1560" class="difflineplus">+              this.parentNode.selectedItem = child;</span>
<a href="#l12.1561"></a><span id="l12.1561" class="difflineplus">+            }</span>
<a href="#l12.1562"></a><span id="l12.1562" class="difflineplus">+            folder = inputFolder;</span>
<a href="#l12.1563"></a><span id="l12.1563" class="difflineplus">+            break;</span>
<a href="#l12.1564"></a><span id="l12.1564">           }</span>
<a href="#l12.1565"></a><span id="l12.1565" class="difflineminus">-</span>
<a href="#l12.1566"></a><span id="l12.1566" class="difflineminus">-          setupParent(folder, this.parentNode, noFolders);</span>
<a href="#l12.1567"></a><span id="l12.1567" class="difflineminus">-          return !!folder;</span>
<a href="#l12.1568"></a><span id="l12.1568" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1569"></a><span id="l12.1569" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1570"></a><span id="l12.1570" class="difflineminus">-</span>
<a href="#l12.1571"></a><span id="l12.1571" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1572"></a><span id="l12.1572" class="difflineminus">-         - Removes all menu-items for this popup, resets all fields, and</span>
<a href="#l12.1573"></a><span id="l12.1573" class="difflineminus">-         - removes the listener.  This function is invoked when a change</span>
<a href="#l12.1574"></a><span id="l12.1574" class="difflineminus">-         - that affects this menu is detected by our listener.</span>
<a href="#l12.1575"></a><span id="l12.1575" class="difflineminus">-        --&gt;</span>
<a href="#l12.1576"></a><span id="l12.1576" class="difflineminus">-      &lt;method name=&quot;_teardown&quot;&gt;</span>
<a href="#l12.1577"></a><span id="l12.1577" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1578"></a><span id="l12.1578" class="difflineminus">-          if (!this._initialized)</span>
<a href="#l12.1579"></a><span id="l12.1579" class="difflineminus">-            return;</span>
<a href="#l12.1580"></a><span id="l12.1580" class="difflineplus">+        }</span>
<a href="#l12.1581"></a><span id="l12.1581" class="difflineplus">+      }</span>
<a href="#l12.1582"></a><span id="l12.1582"> </span>
<a href="#l12.1583"></a><span id="l12.1583" class="difflineminus">-          for (let i = this.childNodes.length - 1; i &gt;= 0; i--) {</span>
<a href="#l12.1584"></a><span id="l12.1584" class="difflineminus">-            let child = this.childNodes[i];</span>
<a href="#l12.1585"></a><span id="l12.1585" class="difflineminus">-            if (child.getAttribute(&quot;generated&quot;) != &quot;true&quot;)</span>
<a href="#l12.1586"></a><span id="l12.1586" class="difflineminus">-              continue;</span>
<a href="#l12.1587"></a><span id="l12.1587" class="difflineminus">-            if (&quot;_teardown&quot; in child)</span>
<a href="#l12.1588"></a><span id="l12.1588" class="difflineminus">-              child._teardown();</span>
<a href="#l12.1589"></a><span id="l12.1589" class="difflineminus">-            child.remove();</span>
<a href="#l12.1590"></a><span id="l12.1590" class="difflineminus">-          }</span>
<a href="#l12.1591"></a><span id="l12.1591" class="difflineplus">+      // If the caller specified a folder to select and it was not</span>
<a href="#l12.1592"></a><span id="l12.1592" class="difflineplus">+      // found, or if the caller didn't pass a folder (meaning a logical</span>
<a href="#l12.1593"></a><span id="l12.1593" class="difflineplus">+      // and valid folder wasn't determined), don't blow up but reset</span>
<a href="#l12.1594"></a><span id="l12.1594" class="difflineplus">+      // attributes and set a nice Choose Folder label so the user may</span>
<a href="#l12.1595"></a><span id="l12.1595" class="difflineplus">+      // select a valid folder per the filter for this picker. If there are</span>
<a href="#l12.1596"></a><span id="l12.1596" class="difflineplus">+      // no children, then no folder passed the filter; disable the menulist</span>
<a href="#l12.1597"></a><span id="l12.1597" class="difflineplus">+      // as there's nothing to choose from.</span>
<a href="#l12.1598"></a><span id="l12.1598" class="difflineplus">+      let noFolders;</span>
<a href="#l12.1599"></a><span id="l12.1599" class="difflineplus">+      if (!this.childElementCount) {</span>
<a href="#l12.1600"></a><span id="l12.1600" class="difflineplus">+        this.parentNode.setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l12.1601"></a><span id="l12.1601" class="difflineplus">+        noFolders = true;</span>
<a href="#l12.1602"></a><span id="l12.1602" class="difflineplus">+      } else {</span>
<a href="#l12.1603"></a><span id="l12.1603" class="difflineplus">+        this.parentNode.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l12.1604"></a><span id="l12.1604" class="difflineplus">+        noFolders = false;</span>
<a href="#l12.1605"></a><span id="l12.1605" class="difflineplus">+      }</span>
<a href="#l12.1606"></a><span id="l12.1606"> </span>
<a href="#l12.1607"></a><span id="l12.1607" class="difflineminus">-          this._removeListener();</span>
<a href="#l12.1608"></a><span id="l12.1608" class="difflineplus">+      setupParent(folder, this.parentNode, noFolders);</span>
<a href="#l12.1609"></a><span id="l12.1609" class="difflineplus">+      return !!folder;</span>
<a href="#l12.1610"></a><span id="l12.1610" class="difflineplus">+    }</span>
<a href="#l12.1611"></a><span id="l12.1611"> </span>
<a href="#l12.1612"></a><span id="l12.1612" class="difflineminus">-          this._initialized = false;</span>
<a href="#l12.1613"></a><span id="l12.1613" class="difflineminus">-          this._initializedSpecials.clear();</span>
<a href="#l12.1614"></a><span id="l12.1614" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1615"></a><span id="l12.1615" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l12.1616"></a><span id="l12.1616" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l12.1617"></a><span id="l12.1617" class="difflineplus">+    /**</span>
<a href="#l12.1618"></a><span id="l12.1618" class="difflineplus">+     * Removes all menu-items for this popup, resets all fields, and</span>
<a href="#l12.1619"></a><span id="l12.1619" class="difflineplus">+     * removes the listener. This function is invoked when a change</span>
<a href="#l12.1620"></a><span id="l12.1620" class="difflineplus">+     * that affects this menu is detected by our listener.</span>
<a href="#l12.1621"></a><span id="l12.1621" class="difflineplus">+     */</span>
<a href="#l12.1622"></a><span id="l12.1622" class="difflineplus">+    _teardown() {</span>
<a href="#l12.1623"></a><span id="l12.1623" class="difflineplus">+      if (!this._initialized) {</span>
<a href="#l12.1624"></a><span id="l12.1624" class="difflineplus">+        return;</span>
<a href="#l12.1625"></a><span id="l12.1625" class="difflineplus">+      }</span>
<a href="#l12.1626"></a><span id="l12.1626"> </span>
<a href="#l12.1627"></a><span id="l12.1627" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l12.1628"></a><span id="l12.1628" class="difflineminus">-      &lt;!--</span>
<a href="#l12.1629"></a><span id="l12.1629" class="difflineminus">-         - In order to improve performance, we're not going to build any of the</span>
<a href="#l12.1630"></a><span id="l12.1630" class="difflineminus">-         - menu until we're shown (unless we're the child of a menulist, see</span>
<a href="#l12.1631"></a><span id="l12.1631" class="difflineminus">-         - note in the constructor).</span>
<a href="#l12.1632"></a><span id="l12.1632" class="difflineminus">-         -</span>
<a href="#l12.1633"></a><span id="l12.1633" class="difflineminus">-         - @note _ensureInitialized can be called repeatedly without issue, so</span>
<a href="#l12.1634"></a><span id="l12.1634" class="difflineminus">-         -       don't worry about it here.</span>
<a href="#l12.1635"></a><span id="l12.1635" class="difflineminus">-        --&gt;</span>
<a href="#l12.1636"></a><span id="l12.1636" class="difflineminus">-      &lt;handler event=&quot;popupshowing&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l12.1637"></a><span id="l12.1637" class="difflineminus">-        this._ensureInitialized();</span>
<a href="#l12.1638"></a><span id="l12.1638" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l12.1639"></a><span id="l12.1639" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l12.1640"></a><span id="l12.1640" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l12.1641"></a><span id="l12.1641" class="difflineminus">-&lt;/bindings&gt;</span>
<a href="#l12.1642"></a><span id="l12.1642" class="difflineplus">+      for (let i = this.childNodes.length - 1; i &gt;= 0; i--) {</span>
<a href="#l12.1643"></a><span id="l12.1643" class="difflineplus">+        let child = this.childNodes[i];</span>
<a href="#l12.1644"></a><span id="l12.1644" class="difflineplus">+        if (child.getAttribute(&quot;generated&quot;) != &quot;true&quot;) {</span>
<a href="#l12.1645"></a><span id="l12.1645" class="difflineplus">+          continue;</span>
<a href="#l12.1646"></a><span id="l12.1646" class="difflineplus">+        }</span>
<a href="#l12.1647"></a><span id="l12.1647" class="difflineplus">+        if (&quot;_teardown&quot; in child) {</span>
<a href="#l12.1648"></a><span id="l12.1648" class="difflineplus">+          child._teardown();</span>
<a href="#l12.1649"></a><span id="l12.1649" class="difflineplus">+        }</span>
<a href="#l12.1650"></a><span id="l12.1650" class="difflineplus">+        child.remove();</span>
<a href="#l12.1651"></a><span id="l12.1651" class="difflineplus">+      }</span>
<a href="#l12.1652"></a><span id="l12.1652" class="difflineplus">+</span>
<a href="#l12.1653"></a><span id="l12.1653" class="difflineplus">+      this._removeListener();</span>
<a href="#l12.1654"></a><span id="l12.1654" class="difflineplus">+</span>
<a href="#l12.1655"></a><span id="l12.1655" class="difflineplus">+      this._initialized = false;</span>
<a href="#l12.1656"></a><span id="l12.1656" class="difflineplus">+      this._initializedSpecials.clear();</span>
<a href="#l12.1657"></a><span id="l12.1657" class="difflineplus">+    }</span>
<a href="#l12.1658"></a><span id="l12.1658" class="difflineplus">+    disconnectedCallback() {</span>
<a href="#l12.1659"></a><span id="l12.1659" class="difflineplus">+      // Clean up when being destroyed.</span>
<a href="#l12.1660"></a><span id="l12.1660" class="difflineplus">+      this._removeListener();</span>
<a href="#l12.1661"></a><span id="l12.1661" class="difflineplus">+      this._teardown();</span>
<a href="#l12.1662"></a><span id="l12.1662" class="difflineplus">+    }</span>
<a href="#l12.1663"></a><span id="l12.1663" class="difflineplus">+  }</span>
<a href="#l12.1664"></a><span id="l12.1664" class="difflineplus">+</span>
<a href="#l12.1665"></a><span id="l12.1665" class="difflineplus">+  customElements.define(&quot;folder-menupopup&quot;, MozFolderMenupopup, { extends: &quot;menupopup&quot; });</span>
<a href="#l12.1666"></a><span id="l12.1666" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/content/newFolderDialog.xul</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/content/newFolderDialog.xul</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -15,27 +15,29 @@</span>
<a href="#l13.4"></a><span id="l13.4"> &lt;dialog xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l13.5"></a><span id="l13.5">         title=&quot;&amp;newFolderDialog.title;&quot;</span>
<a href="#l13.6"></a><span id="l13.6">         onload=&quot;onLoad();&quot;</span>
<a href="#l13.7"></a><span id="l13.7">         buttonlabelaccept=&quot;&amp;accept.label;&quot;</span>
<a href="#l13.8"></a><span id="l13.8">         buttonaccesskeyaccept=&quot;&amp;accept.accesskey;&quot;&gt;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">   &lt;stringbundleset id=&quot;stringbundleset&quot;/&gt;</span>
<a href="#l13.11"></a><span id="l13.11">   &lt;script src=&quot;chrome://messenger/content/newFolderDialog.js&quot;/&gt;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l13.13"></a><span id="l13.13"> </span>
<a href="#l13.14"></a><span id="l13.14">     &lt;label value=&quot;&amp;name.label;&quot; accesskey=&quot;&amp;name.accesskey;&quot; control=&quot;name&quot;/&gt;</span>
<a href="#l13.15"></a><span id="l13.15">     &lt;textbox id=&quot;name&quot; oninput=&quot;doEnabling();&quot;/&gt;</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">     &lt;separator/&gt;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">     &lt;label value=&quot;&amp;description.label;&quot; accesskey=&quot;&amp;description.accesskey;&quot; control=&quot;msgNewFolderPicker&quot;/&gt;</span>
<a href="#l13.20"></a><span id="l13.20"> </span>
<a href="#l13.21"></a><span id="l13.21">     &lt;menulist id=&quot;msgNewFolderPicker&quot; class=&quot;folderMenuItem&quot;</span>
<a href="#l13.22"></a><span id="l13.22">                  displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-      &lt;menupopup id=&quot;MsgNewFolderPopup&quot; type=&quot;folder&quot; showFileHereLabel=&quot;true&quot;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+      &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;MsgNewFolderPopup&quot;</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+                 showFileHereLabel=&quot;true&quot;</span>
<a href="#l13.26"></a><span id="l13.26">                  class=&quot;menulist-menupopup&quot;</span>
<a href="#l13.27"></a><span id="l13.27">                  mode=&quot;newFolder&quot;</span>
<a href="#l13.28"></a><span id="l13.28">                  oncommand=&quot;onFolderSelect(event)&quot;/&gt;</span>
<a href="#l13.29"></a><span id="l13.29">     &lt;/menulist&gt;</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31">     &lt;vbox id=&quot;newFolderTypeBox&quot;&gt;</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33">       &lt;separator class=&quot;thin&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/content/subscribe.xul</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/content/subscribe.xul</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -20,16 +20,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">         windowtype=&quot;mailnews:subscribe&quot;&gt;</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">   &lt;stringbundle id=&quot;bundle_subscribe&quot; src=&quot;chrome://messenger/locale/subscribe.properties&quot;/&gt;</span>
<a href="#l14.7"></a><span id="l14.7">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">   &lt;script src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l14.10"></a><span id="l14.10">   &lt;script src=&quot;chrome://messenger/content/mailWindow.js&quot;/&gt;</span>
<a href="#l14.11"></a><span id="l14.11">   &lt;script src=&quot;chrome://messenger/content/subscribe.js&quot;/&gt;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14">   &lt;vbox flex=&quot;1&quot; style=&quot;width: 40em; height: 25em;&quot;&gt;</span>
<a href="#l14.15"></a><span id="l14.15">     &lt;hbox&gt;</span>
<a href="#l14.16"></a><span id="l14.16">       &lt;vbox&gt;</span>
<a href="#l14.17"></a><span id="l14.17">         &lt;hbox pack=&quot;end&quot; align=&quot;center&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l14.18"></a><span id="l14.18">           &lt;label value=&quot;&amp;server.label;&quot;</span>
<a href="#l14.19"></a><span id="l14.19">                  accesskey=&quot;&amp;server.accesskey;&quot;</span>
<a href="#l14.20"></a><span id="l14.20">                  control=&quot;serverMenu&quot;/&gt;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -38,17 +39,17 @@</span>
<a href="#l14.22"></a><span id="l14.22">           &lt;label value=&quot;&amp;namefield.label;&quot;</span>
<a href="#l14.23"></a><span id="l14.23">                  accesskey=&quot;&amp;namefield.accesskey;&quot;</span>
<a href="#l14.24"></a><span id="l14.24">                  id=&quot;namefieldlabel&quot;</span>
<a href="#l14.25"></a><span id="l14.25">                  control=&quot;namefield&quot;/&gt;</span>
<a href="#l14.26"></a><span id="l14.26">         &lt;/hbox&gt;</span>
<a href="#l14.27"></a><span id="l14.27">       &lt;/vbox&gt;</span>
<a href="#l14.28"></a><span id="l14.28">       &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l14.29"></a><span id="l14.29">         &lt;menulist id=&quot;serverMenu&quot; flex=&quot;1&quot; class=&quot;folderMenuItem&quot;&gt;</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-          &lt;menupopup type=&quot;folder&quot;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+          &lt;menupopup is=&quot;folder-menupopup&quot;</span>
<a href="#l14.32"></a><span id="l14.32">                      mode=&quot;subscribe&quot;</span>
<a href="#l14.33"></a><span id="l14.33">                      expandFolders=&quot;false&quot;</span>
<a href="#l14.34"></a><span id="l14.34">                      oncommand=&quot;onServerClick(event.target._folder);&quot;/&gt;</span>
<a href="#l14.35"></a><span id="l14.35">         &lt;/menulist&gt;</span>
<a href="#l14.36"></a><span id="l14.36">         &lt;textbox is=&quot;search-textbox&quot; id=&quot;namefield&quot;</span>
<a href="#l14.37"></a><span id="l14.37">                  flex=&quot;1&quot;</span>
<a href="#l14.38"></a><span id="l14.38">                  timeout=&quot;300&quot;</span>
<a href="#l14.39"></a><span id="l14.39">                  aria-controls=&quot;subscribeTree&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/content/virtualFolderProperties.xul</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/content/virtualFolderProperties.xul</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -55,19 +55,18 @@</span>
<a href="#l15.4"></a><span id="l15.4">         &lt;label value=&quot;&amp;folderSelectionCaption.label;&quot;/&gt;</span>
<a href="#l15.5"></a><span id="l15.5">       &lt;/hbox&gt;</span>
<a href="#l15.6"></a><span id="l15.6">     &lt;/vbox&gt;</span>
<a href="#l15.7"></a><span id="l15.7">     &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l15.8"></a><span id="l15.8">       &lt;textbox id=&quot;name&quot; hidden=&quot;true&quot; oninput=&quot;doEnabling();&quot;/&gt;</span>
<a href="#l15.9"></a><span id="l15.9">       &lt;textbox id=&quot;existingName&quot; readonly=&quot;true&quot; hidden=&quot;true&quot; tabindex=&quot;0&quot;/&gt;</span>
<a href="#l15.10"></a><span id="l15.10">       &lt;menulist id=&quot;msgNewFolderPicker&quot; class=&quot;folderMenuItem&quot; align=&quot;center&quot;</span>
<a href="#l15.11"></a><span id="l15.11">                 displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        &lt;menupopup id=&quot;msgNewFolderPopup&quot; class=&quot;menulist-menupopup&quot;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                   type=&quot;folder&quot; mode=&quot;newFolder&quot;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                   showFileHereLabel=&quot;true&quot; oncommand=&quot;onFolderPick(event);&quot;/&gt;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgNewFolderPopup&quot; class=&quot;menulist-menupopup&quot;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+                   mode=&quot;newFolder&quot; showFileHereLabel=&quot;true&quot; oncommand=&quot;onFolderPick(event);&quot;/&gt;</span>
<a href="#l15.17"></a><span id="l15.17">       &lt;/menulist&gt;</span>
<a href="#l15.18"></a><span id="l15.18">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l15.19"></a><span id="l15.19">         &lt;label id=&quot;chosenFoldersCount&quot;/&gt;</span>
<a href="#l15.20"></a><span id="l15.20">         &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l15.21"></a><span id="l15.21">         &lt;button id=&quot;folderListPicker&quot; label=&quot;&amp;chooseFoldersButton.label;&quot;</span>
<a href="#l15.22"></a><span id="l15.22">                 accesskey=&quot;&amp;chooseFoldersButton.accesskey;&quot;</span>
<a href="#l15.23"></a><span id="l15.23">                 oncommand=&quot;chooseFoldersToSearch();&quot;/&gt;</span>
<a href="#l15.24"></a><span id="l15.24">       &lt;/hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-copies.inc.xul</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-copies.inc.xul</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l16.4"></a><span id="l16.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.5"></a><span id="l16.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.6"></a><span id="l16.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">   &lt;vbox flex=&quot;1&quot; id=&quot;copiesAndFolders&quot;&gt;</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+    &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l16.10"></a><span id="l16.10">     &lt;stringbundleset id=&quot;stringbundleset&quot;&gt;</span>
<a href="#l16.11"></a><span id="l16.11">     &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l16.12"></a><span id="l16.12">     &lt;/stringbundleset&gt;</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14">     &lt;label id=&quot;identity.fccFolder&quot; hidden=&quot;true&quot; wsm_persist=&quot;true&quot;</span>
<a href="#l16.15"></a><span id="l16.15">            pref=&quot;true&quot; preftype=&quot;string&quot; prefattribute=&quot;value&quot;</span>
<a href="#l16.16"></a><span id="l16.16">            prefstring=&quot;mail.identity.%identitykey%.fcc_folder&quot;/&gt;</span>
<a href="#l16.17"></a><span id="l16.17">     &lt;label id=&quot;identity.draftFolder&quot; hidden=&quot;true&quot; wsm_persist=&quot;true&quot;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineat">@@ -59,25 +60,27 @@</span>
<a href="#l16.19"></a><span id="l16.19">                      accesskey=&quot;&amp;sentInOtherFolder.accesskey;&quot;</span>
<a href="#l16.20"></a><span id="l16.20">                      oncommand=&quot;setPickersState('msgFccFolderPicker', 'msgFccAccountPicker', event)&quot;/&gt;</span>
<a href="#l16.21"></a><span id="l16.21">             &lt;/hbox&gt;</span>
<a href="#l16.22"></a><span id="l16.22">           &lt;/vbox&gt;</span>
<a href="#l16.23"></a><span id="l16.23">           &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l16.24"></a><span id="l16.24">              &lt;menulist id=&quot;msgFccAccountPicker&quot;</span>
<a href="#l16.25"></a><span id="l16.25">                        class=&quot;folderMenuItem depends-on-do-fcc&quot;</span>
<a href="#l16.26"></a><span id="l16.26">                        aria-labelledby=&quot;fcc_selectAccount&quot;&gt;</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-                &lt;menupopup id=&quot;msgFccAccountPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+                &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgFccAccountPopup&quot;</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+                           mode=&quot;filing&quot;</span>
<a href="#l16.30"></a><span id="l16.30">                            expandFolders=&quot;false&quot;</span>
<a href="#l16.31"></a><span id="l16.31">                            oncommand=&quot;noteSelectionChange('fcc', 'Account', event)&quot;/&gt;</span>
<a href="#l16.32"></a><span id="l16.32">               &lt;/menulist&gt;</span>
<a href="#l16.33"></a><span id="l16.33">               &lt;menulist id=&quot;msgFccFolderPicker&quot;</span>
<a href="#l16.34"></a><span id="l16.34">                         class=&quot;folderMenuItem depends-on-do-fcc&quot;</span>
<a href="#l16.35"></a><span id="l16.35">                         aria-labelledby=&quot;fcc_selectFolder&quot;</span>
<a href="#l16.36"></a><span id="l16.36">                         displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-                &lt;menupopup id=&quot;msgFccFolderPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+                &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgFccFolderPopup&quot;</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+                           mode=&quot;filing&quot;</span>
<a href="#l16.40"></a><span id="l16.40">                            class=&quot;menulist-menupopup&quot;</span>
<a href="#l16.41"></a><span id="l16.41">                            showFileHereLabel=&quot;true&quot;</span>
<a href="#l16.42"></a><span id="l16.42">                            oncommand=&quot;noteSelectionChange('fcc', 'Folder', event)&quot;/&gt;</span>
<a href="#l16.43"></a><span id="l16.43">               &lt;/menulist&gt;</span>
<a href="#l16.44"></a><span id="l16.44">           &lt;/vbox&gt;</span>
<a href="#l16.45"></a><span id="l16.45">         &lt;/hbox&gt;</span>
<a href="#l16.46"></a><span id="l16.46">       &lt;/radiogroup&gt;</span>
<a href="#l16.47"></a><span id="l16.47"> </span>
<a href="#l16.48"></a><span id="l16.48" class="difflineat">@@ -158,25 +161,27 @@</span>
<a href="#l16.49"></a><span id="l16.49">                      accesskey=&quot;&amp;archiveInOtherFolder.accesskey;&quot;</span>
<a href="#l16.50"></a><span id="l16.50">                      oncommand=&quot;setPickersState('msgArchivesFolderPicker', 'msgArchivesAccountPicker', event)&quot;/&gt;</span>
<a href="#l16.51"></a><span id="l16.51">             &lt;/hbox&gt;</span>
<a href="#l16.52"></a><span id="l16.52">           &lt;/vbox&gt;</span>
<a href="#l16.53"></a><span id="l16.53">           &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l16.54"></a><span id="l16.54">             &lt;menulist id=&quot;msgArchivesAccountPicker&quot;</span>
<a href="#l16.55"></a><span id="l16.55">                       class=&quot;folderMenuItem depends-on-archive&quot;</span>
<a href="#l16.56"></a><span id="l16.56">                       aria-labelledby=&quot;archive_selectAccount&quot;&gt;</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-              &lt;menupopup id=&quot;msgArchivesAccountPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgArchivesAccountPopup&quot;</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l16.60"></a><span id="l16.60">                          expandFolders=&quot;false&quot;</span>
<a href="#l16.61"></a><span id="l16.61">                          oncommand=&quot;noteSelectionChange('archive', 'Account', event)&quot;/&gt;</span>
<a href="#l16.62"></a><span id="l16.62">             &lt;/menulist&gt;</span>
<a href="#l16.63"></a><span id="l16.63">             &lt;menulist id=&quot;msgArchivesFolderPicker&quot;</span>
<a href="#l16.64"></a><span id="l16.64">                       class=&quot;folderMenuItem depends-on-archive&quot;</span>
<a href="#l16.65"></a><span id="l16.65">                       aria-labelledby=&quot;archive_selectFolder&quot;</span>
<a href="#l16.66"></a><span id="l16.66">                       displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineminus">-              &lt;menupopup id=&quot;msgArchivesFolderPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgArchivesFolderPopup&quot;</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l16.70"></a><span id="l16.70">                          class=&quot;menulist-menupopup&quot;</span>
<a href="#l16.71"></a><span id="l16.71">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l16.72"></a><span id="l16.72">                          oncommand=&quot;noteSelectionChange('archive', 'Folder', event)&quot;/&gt;</span>
<a href="#l16.73"></a><span id="l16.73">             &lt;/menulist&gt;</span>
<a href="#l16.74"></a><span id="l16.74">           &lt;/vbox&gt;</span>
<a href="#l16.75"></a><span id="l16.75">         &lt;/hbox&gt;</span>
<a href="#l16.76"></a><span id="l16.76">       &lt;/radiogroup&gt;</span>
<a href="#l16.77"></a><span id="l16.77">     &lt;/groupbox&gt;</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineat">@@ -203,25 +208,27 @@</span>
<a href="#l16.79"></a><span id="l16.79">                      value=&quot;1&quot; label=&quot;&amp;draftInOtherFolder.label;&quot;</span>
<a href="#l16.80"></a><span id="l16.80">                      accesskey=&quot;&amp;draftInOtherFolder.accesskey;&quot;/&gt;</span>
<a href="#l16.81"></a><span id="l16.81">             &lt;/hbox&gt;</span>
<a href="#l16.82"></a><span id="l16.82">           &lt;/vbox&gt;</span>
<a href="#l16.83"></a><span id="l16.83">           &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l16.84"></a><span id="l16.84">             &lt;menulist id=&quot;msgDraftsAccountPicker&quot;</span>
<a href="#l16.85"></a><span id="l16.85">                       class=&quot;folderMenuItem&quot;</span>
<a href="#l16.86"></a><span id="l16.86">                       aria-labelledby=&quot;draft_selectAccount&quot;&gt;</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-              &lt;menupopup id=&quot;msgDraftAccountPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgDraftAccountPopup&quot;</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l16.90"></a><span id="l16.90">                          expandFolders=&quot;false&quot;</span>
<a href="#l16.91"></a><span id="l16.91">                          oncommand=&quot;noteSelectionChange('draft', 'Account', event)&quot;/&gt;</span>
<a href="#l16.92"></a><span id="l16.92">             &lt;/menulist&gt;</span>
<a href="#l16.93"></a><span id="l16.93">             &lt;menulist id=&quot;msgDraftsFolderPicker&quot;</span>
<a href="#l16.94"></a><span id="l16.94">                       class=&quot;folderMenuItem&quot;</span>
<a href="#l16.95"></a><span id="l16.95">                       aria-labelledby=&quot;draft_selectFolder&quot;</span>
<a href="#l16.96"></a><span id="l16.96">                       displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineminus">-              &lt;menupopup id=&quot;msgDraftFolderPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgDraftFolderPopup&quot;</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l16.100"></a><span id="l16.100">                          class=&quot;menulist-menupopup&quot;</span>
<a href="#l16.101"></a><span id="l16.101">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l16.102"></a><span id="l16.102">                          oncommand=&quot;noteSelectionChange('draft', 'Folder', event)&quot;/&gt;</span>
<a href="#l16.103"></a><span id="l16.103">             &lt;/menulist&gt;</span>
<a href="#l16.104"></a><span id="l16.104">           &lt;/vbox&gt;</span>
<a href="#l16.105"></a><span id="l16.105">         &lt;/hbox&gt;</span>
<a href="#l16.106"></a><span id="l16.106">       &lt;/radiogroup&gt;</span>
<a href="#l16.107"></a><span id="l16.107"> </span>
<a href="#l16.108"></a><span id="l16.108" class="difflineat">@@ -244,25 +251,27 @@</span>
<a href="#l16.109"></a><span id="l16.109">                      value=&quot;1&quot; label=&quot;&amp;templateInOtherFolder.label;&quot;</span>
<a href="#l16.110"></a><span id="l16.110">                      accesskey=&quot;&amp;templateInOtherFolder.accesskey;&quot;/&gt;</span>
<a href="#l16.111"></a><span id="l16.111">             &lt;/hbox&gt;</span>
<a href="#l16.112"></a><span id="l16.112">           &lt;/vbox&gt;</span>
<a href="#l16.113"></a><span id="l16.113">           &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l16.114"></a><span id="l16.114">             &lt;menulist id=&quot;msgStationeryAccountPicker&quot;</span>
<a href="#l16.115"></a><span id="l16.115">                         class=&quot;folderMenuItem&quot;</span>
<a href="#l16.116"></a><span id="l16.116">                         aria-labelledby=&quot;tmpl_selectAccount&quot;&gt;</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineminus">-              &lt;menupopup id=&quot;msgFccAccountPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgFccAccountPopup&quot;</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l16.120"></a><span id="l16.120">                          expandFolders=&quot;false&quot;</span>
<a href="#l16.121"></a><span id="l16.121">                          oncommand=&quot;noteSelectionChange('tmpl', 'Account', event)&quot;/&gt;</span>
<a href="#l16.122"></a><span id="l16.122">             &lt;/menulist&gt;</span>
<a href="#l16.123"></a><span id="l16.123">             &lt;menulist id=&quot;msgStationeryFolderPicker&quot;</span>
<a href="#l16.124"></a><span id="l16.124">                         class=&quot;folderMenuItem&quot;</span>
<a href="#l16.125"></a><span id="l16.125">                         aria-labelledby=&quot;tmpl_selectFolder&quot;</span>
<a href="#l16.126"></a><span id="l16.126">                         displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineminus">-              &lt;menupopup id=&quot;msgTemplFolderPopup&quot; type=&quot;folder&quot; mode=&quot;filing&quot;</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgTemplFolderPopup&quot;</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+                         mode=&quot;filing&quot;</span>
<a href="#l16.130"></a><span id="l16.130">                          class=&quot;menulist-menupopup&quot;</span>
<a href="#l16.131"></a><span id="l16.131">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l16.132"></a><span id="l16.132">                          oncommand=&quot;noteSelectionChange('tmpl', 'Folder', event)&quot;/&gt;</span>
<a href="#l16.133"></a><span id="l16.133">             &lt;/menulist&gt;</span>
<a href="#l16.134"></a><span id="l16.134">           &lt;/vbox&gt;</span>
<a href="#l16.135"></a><span id="l16.135">         &lt;/hbox&gt;</span>
<a href="#l16.136"></a><span id="l16.136">       &lt;/radiogroup&gt;</span>
<a href="#l16.137"></a><span id="l16.137">       &lt;hbox align=&quot;center&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-junk.xul</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-junk.xul</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -19,16 +19,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> &lt;page xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l17.5"></a><span id="l17.5">       title=&quot;&amp;junkSettings.label;&quot;</span>
<a href="#l17.6"></a><span id="l17.6">       onload=&quot;parent.onPanelLoaded('am-junk.xul');&quot;&gt;</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">   &lt;vbox flex=&quot;1&quot; style=&quot;overflow: auto;&quot;&gt;</span>
<a href="#l17.9"></a><span id="l17.9">     &lt;script src=&quot;chrome://messenger/content/am-junk.js&quot;/&gt;</span>
<a href="#l17.10"></a><span id="l17.10">     &lt;script src=&quot;chrome://messenger/content/am-prefs.js&quot;/&gt;</span>
<a href="#l17.11"></a><span id="l17.11">     &lt;script src=&quot;chrome://messenger/content/amUtils.js&quot;/&gt;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+    &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l17.13"></a><span id="l17.13">     &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">     &lt;hbox class=&quot;dialogheader&quot;&gt;</span>
<a href="#l17.16"></a><span id="l17.16">       &lt;label class=&quot;dialogheader-title&quot; value=&quot;&amp;junkSettings.label;&quot;/&gt;</span>
<a href="#l17.17"></a><span id="l17.17">     &lt;/hbox&gt;</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19">     &lt;groupbox&gt;</span>
<a href="#l17.20"></a><span id="l17.20">       &lt;label class=&quot;header&quot;&gt;&amp;junkClassification.label;&lt;/label&gt;</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineat">@@ -162,29 +163,27 @@</span>
<a href="#l17.22"></a><span id="l17.22">                      label=&quot;&amp;otherFolder.label;&quot;</span>
<a href="#l17.23"></a><span id="l17.23">                      accesskey=&quot;&amp;otherFolder.accesskey;&quot;/&gt;</span>
<a href="#l17.24"></a><span id="l17.24">             &lt;/hbox&gt;</span>
<a href="#l17.25"></a><span id="l17.25">           &lt;/vbox&gt;</span>
<a href="#l17.26"></a><span id="l17.26">           &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l17.27"></a><span id="l17.27">             &lt;menulist id=&quot;actionTargetAccount&quot;</span>
<a href="#l17.28"></a><span id="l17.28">                       class=&quot;folderMenuItem&quot;</span>
<a href="#l17.29"></a><span id="l17.29">                       aria-labelledby=&quot;moveTargetMode0&quot;&gt;</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-              &lt;menupopup id=&quot;actionAccountPopup&quot;</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-                         type=&quot;folder&quot;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;actionAccountPopup&quot;</span>
<a href="#l17.33"></a><span id="l17.33">                          class=&quot;menulist-menupopup&quot;</span>
<a href="#l17.34"></a><span id="l17.34">                          expandFolders=&quot;false&quot;</span>
<a href="#l17.35"></a><span id="l17.35">                          mode=&quot;filing&quot;</span>
<a href="#l17.36"></a><span id="l17.36">                          oncommand=&quot;onActionTargetChange(event, 'server.spamActionTargetAccount');&quot;/&gt;</span>
<a href="#l17.37"></a><span id="l17.37">             &lt;/menulist&gt;</span>
<a href="#l17.38"></a><span id="l17.38">             &lt;menulist id=&quot;actionTargetFolder&quot;</span>
<a href="#l17.39"></a><span id="l17.39">                       class=&quot;folderMenuItem&quot;</span>
<a href="#l17.40"></a><span id="l17.40">                       aria-labelledby=&quot;moveTargetMode1&quot;</span>
<a href="#l17.41"></a><span id="l17.41">                       displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-              &lt;menupopup id=&quot;actionFolderPopup&quot;</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-                         type=&quot;folder&quot;</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+              &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;actionFolderPopup&quot;</span>
<a href="#l17.45"></a><span id="l17.45">                          mode=&quot;junk&quot;</span>
<a href="#l17.46"></a><span id="l17.46">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l17.47"></a><span id="l17.47">                          oncommand=&quot;onActionTargetChange(event, 'server.spamActionTargetFolder');&quot;/&gt;</span>
<a href="#l17.48"></a><span id="l17.48">             &lt;/menulist&gt;</span>
<a href="#l17.49"></a><span id="l17.49">           &lt;/vbox&gt;</span>
<a href="#l17.50"></a><span id="l17.50">         &lt;/hbox&gt;</span>
<a href="#l17.51"></a><span id="l17.51">       &lt;/radiogroup&gt;</span>
<a href="#l17.52"></a><span id="l17.52"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -12,16 +12,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> &lt;dialog</span>
<a href="#l18.6"></a><span id="l18.6">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l18.7"></a><span id="l18.7">         title=&quot;&amp;serverAdvanced.label;&quot;</span>
<a href="#l18.8"></a><span id="l18.8">         buttons=&quot;accept,cancel&quot;</span>
<a href="#l18.9"></a><span id="l18.9">         onload=&quot;onLoad();&quot;&gt;</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">   &lt;script src=&quot;chrome://messenger/content/am-server-advanced.js&quot;/&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l18.13"></a><span id="l18.13">   &lt;stringbundle id=&quot;bundle_prefs&quot;</span>
<a href="#l18.14"></a><span id="l18.14">                 src=&quot;chrome://messenger/locale/prefs.properties&quot;/&gt;</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">     &lt;label id=&quot;serverPrettyName&quot;/&gt;</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20">     &lt;!-- IMAP Panel --&gt;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineat">@@ -105,18 +106,17 @@</span>
<a href="#l18.22"></a><span id="l18.22">               &lt;radio id=&quot;deferToOtherAccount&quot;</span>
<a href="#l18.23"></a><span id="l18.23">                      value=&quot;otherAccount&quot;</span>
<a href="#l18.24"></a><span id="l18.24">                      label=&quot;&amp;deferToServer.label;&quot;</span>
<a href="#l18.25"></a><span id="l18.25">                      accesskey=&quot;&amp;deferToServer.accesskey;&quot;&gt;</span>
<a href="#l18.26"></a><span id="l18.26">               &lt;/radio&gt;</span>
<a href="#l18.27"></a><span id="l18.27">               &lt;menulist id=&quot;deferredServerFolderPicker&quot;</span>
<a href="#l18.28"></a><span id="l18.28">                         class=&quot;folderMenuItem&quot;</span>
<a href="#l18.29"></a><span id="l18.29">                         aria-labelledby=&quot;deferToServer&quot;&gt;</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-                &lt;menupopup id=&quot;deferredServerPopup&quot;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-                           type=&quot;folder&quot;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+                &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;deferredServerPopup&quot;</span>
<a href="#l18.33"></a><span id="l18.33">                            expandFolders=&quot;false&quot;</span>
<a href="#l18.34"></a><span id="l18.34">                            mode=&quot;deferred&quot;</span>
<a href="#l18.35"></a><span id="l18.35">                            oncommand=&quot;this.selectFolder(event.target._folder);&quot;/&gt;</span>
<a href="#l18.36"></a><span id="l18.36">               &lt;/menulist&gt;</span>
<a href="#l18.37"></a><span id="l18.37">               &lt;/hbox&gt;</span>
<a href="#l18.38"></a><span id="l18.38">               &lt;checkbox amsa_persist=&quot;true&quot; id=&quot;deferGetNewMail&quot;</span>
<a href="#l18.39"></a><span id="l18.39">                         label=&quot;&amp;deferGetNewMail.label;&quot; class=&quot;indent&quot;</span>
<a href="#l18.40"></a><span id="l18.40">                         accesskey=&quot;&amp;deferGetNewMail.accesskey;&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -18,16 +18,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">       title=&quot;&amp;serverSettings.label;&quot;</span>
<a href="#l19.5"></a><span id="l19.5">       onload=&quot;parent.onPanelLoaded('am-server.xul');&quot;&gt;</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">   &lt;vbox flex=&quot;1&quot; style=&quot;overflow: auto;&quot;&gt;</span>
<a href="#l19.8"></a><span id="l19.8">     &lt;script src=&quot;chrome://messenger/content/am-server.js&quot;/&gt;</span>
<a href="#l19.9"></a><span id="l19.9">     &lt;script src=&quot;chrome://messenger/content/am-prefs.js&quot;/&gt;</span>
<a href="#l19.10"></a><span id="l19.10">     &lt;script src=&quot;chrome://messenger/content/amUtils.js&quot;/&gt;</span>
<a href="#l19.11"></a><span id="l19.11">     &lt;script src=&quot;chrome://messenger/content/menulist-charsetpicker.js&quot;/&gt;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+    &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l19.13"></a><span id="l19.13">     &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15">     &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;server.type&quot;/&gt;</span>
<a href="#l19.16"></a><span id="l19.16">     &lt;label hidden=&quot;true&quot;</span>
<a href="#l19.17"></a><span id="l19.17">            wsm_persist=&quot;true&quot;</span>
<a href="#l19.18"></a><span id="l19.18">            preftype=&quot;string&quot;</span>
<a href="#l19.19"></a><span id="l19.19">            prefattribute=&quot;value&quot;</span>
<a href="#l19.20"></a><span id="l19.20">            prefstring=&quot;mail.server.%serverkey%.storeContractID&quot;</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineat">@@ -275,18 +276,17 @@</span>
<a href="#l19.22"></a><span id="l19.22">               &lt;/hbox&gt;</span>
<a href="#l19.23"></a><span id="l19.23">             &lt;/vbox&gt;</span>
<a href="#l19.24"></a><span id="l19.24">             &lt;vbox&gt;</span>
<a href="#l19.25"></a><span id="l19.25">               &lt;menulist id=&quot;msgTrashFolderPicker&quot;</span>
<a href="#l19.26"></a><span id="l19.26">                         class=&quot;folderMenuItem&quot;</span>
<a href="#l19.27"></a><span id="l19.27">                         maxwidth=&quot;300&quot; crop=&quot;center&quot;</span>
<a href="#l19.28"></a><span id="l19.28">                         aria-labelledby=&quot;modelMoveToTrash&quot;</span>
<a href="#l19.29"></a><span id="l19.29">                         displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-                &lt;menupopup id=&quot;msgTrashFolderPopup&quot;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-                           type=&quot;folder&quot;</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+                &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;msgTrashFolderPopup&quot;</span>
<a href="#l19.33"></a><span id="l19.33">                            mode=&quot;filing&quot;</span>
<a href="#l19.34"></a><span id="l19.34">                            showFileHereLabel=&quot;true&quot;</span>
<a href="#l19.35"></a><span id="l19.35">                            oncommand=&quot;folderPickerChange(event);&quot;/&gt;</span>
<a href="#l19.36"></a><span id="l19.36">               &lt;/menulist&gt;</span>
<a href="#l19.37"></a><span id="l19.37">             &lt;/vbox&gt;</span>
<a href="#l19.38"></a><span id="l19.38">           &lt;/hbox&gt;</span>
<a href="#l19.39"></a><span id="l19.39">         &lt;/radiogroup&gt;</span>
<a href="#l19.40"></a><span id="l19.40">       &lt;/hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -113,17 +113,17 @@ class MozRuleactiontargetForwardto exten</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> class MozRuleactiontargetFolder extends MozXULElement {</span>
<a href="#l20.6"></a><span id="l20.6">   connectedCallback() {</span>
<a href="#l20.7"></a><span id="l20.7">     this.appendChild(MozXULElement.parseXULToFragment(`</span>
<a href="#l20.8"></a><span id="l20.8">       &lt;menulist class=&quot;ruleactionitem</span>
<a href="#l20.9"></a><span id="l20.9">                 folderMenuItem&quot;</span>
<a href="#l20.10"></a><span id="l20.10">                 flex=&quot;1&quot;</span>
<a href="#l20.11"></a><span id="l20.11">                 displayformat=&quot;verbose&quot;&gt;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        &lt;menupopup type=&quot;folder&quot;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+        &lt;menupopup is=&quot;folder-menupopup&quot;</span>
<a href="#l20.14"></a><span id="l20.14">                    mode=&quot;filing&quot;</span>
<a href="#l20.15"></a><span id="l20.15">                    class=&quot;menulist-menupopup&quot;</span>
<a href="#l20.16"></a><span id="l20.16">                    showRecent=&quot;true&quot;</span>
<a href="#l20.17"></a><span id="l20.17">                    recentLabel=&quot;&amp;recentFolders.label;&quot;</span>
<a href="#l20.18"></a><span id="l20.18">                    showFileHereLabel=&quot;true&quot;&gt;</span>
<a href="#l20.19"></a><span id="l20.19">         &lt;/menupopup&gt;</span>
<a href="#l20.20"></a><span id="l20.20">       &lt;/menulist&gt;</span>
<a href="#l20.21"></a><span id="l20.21">       `, [</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.xul</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -26,16 +26,17 @@</span>
<a href="#l21.4"></a><span id="l21.4">         persist=&quot;width height screenX screenY sizemode&quot;</span>
<a href="#l21.5"></a><span id="l21.5">         onload=&quot;FeedSubscriptions.onLoad();&quot;</span>
<a href="#l21.6"></a><span id="l21.6">         onclose=&quot;return FeedSubscriptions.onClose();&quot;</span>
<a href="#l21.7"></a><span id="l21.7">         onkeypress=&quot;FeedSubscriptions.onKeyPress(event);&quot;</span>
<a href="#l21.8"></a><span id="l21.8">         onmousedown=&quot;FeedSubscriptions.onMouseDown(event);&quot;&gt;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10">   &lt;script src=&quot;chrome://messenger/content/specialTabs.js&quot;/&gt;</span>
<a href="#l21.11"></a><span id="l21.11">   &lt;script src=&quot;chrome://messenger-newsblog/content/feed-subscriptions.js&quot;/&gt;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/folder-menupopup.js&quot;/&gt;</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14">   &lt;linkset&gt;</span>
<a href="#l21.15"></a><span id="l21.15">     &lt;html:link rel=&quot;localization&quot; href=&quot;security/certificates/certManager.ftl&quot;/&gt;</span>
<a href="#l21.16"></a><span id="l21.16">   &lt;/linkset&gt;</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18">   &lt;keyset id=&quot;extensionsKeys&quot;&gt;</span>
<a href="#l21.19"></a><span id="l21.19">     &lt;key id=&quot;key_close&quot;</span>
<a href="#l21.20"></a><span id="l21.20">          key=&quot;&amp;cmd.close.commandKey;&quot;</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -119,19 +120,18 @@</span>
<a href="#l21.22"></a><span id="l21.22">                        onclick=&quot;FeedSubscriptions.checkValidation(event);&quot;/&gt;</span>
<a href="#l21.23"></a><span id="l21.23">               &lt;/hbox&gt;</span>
<a href="#l21.24"></a><span id="l21.24">             &lt;/hbox&gt;</span>
<a href="#l21.25"></a><span id="l21.25">             &lt;hbox&gt;</span>
<a href="#l21.26"></a><span id="l21.26">               &lt;menulist id=&quot;selectFolder&quot;</span>
<a href="#l21.27"></a><span id="l21.27">                         flex=&quot;1&quot;</span>
<a href="#l21.28"></a><span id="l21.28">                         class=&quot;folderMenuItem&quot;</span>
<a href="#l21.29"></a><span id="l21.29">                         hidden=&quot;true&quot;&gt;</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-                &lt;menupopup id=&quot;selectFolderPopup&quot;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+                &lt;menupopup is=&quot;folder-menupopup&quot; id=&quot;selectFolderPopup&quot;</span>
<a href="#l21.32"></a><span id="l21.32">                            class=&quot;menulist-menupopup&quot;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-                           type=&quot;folder&quot;</span>
<a href="#l21.34"></a><span id="l21.34">                            mode=&quot;feeds&quot;</span>
<a href="#l21.35"></a><span id="l21.35">                            showFileHereLabel=&quot;true&quot;</span>
<a href="#l21.36"></a><span id="l21.36">                            showAccountsFileHere=&quot;true&quot;</span>
<a href="#l21.37"></a><span id="l21.37">                            oncommand=&quot;FeedSubscriptions.setNewFolder(event);&quot;/&gt;</span>
<a href="#l21.38"></a><span id="l21.38">               &lt;/menulist&gt;</span>
<a href="#l21.39"></a><span id="l21.39">               &lt;textbox id=&quot;selectFolderValue&quot;</span>
<a href="#l21.40"></a><span id="l21.40">                        flex=&quot;1&quot;</span>
<a href="#l21.41"></a><span id="l21.41">                        readonly=&quot;true&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/jar.mn</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/jar.mn</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -64,17 +64,17 @@ messenger.jar:</span>
<a href="#l22.4"></a><span id="l22.4">     content/messenger/removeAccount.js                                         (base/prefs/content/removeAccount.js)</span>
<a href="#l22.5"></a><span id="l22.5">     content/messenger/msgSelectOfflineFolders.xul                              (base/content/msgSelectOfflineFolders.xul)</span>
<a href="#l22.6"></a><span id="l22.6">     content/messenger/msgSelectOfflineFolders.js                               (base/content/msgSelectOfflineFolders.js)</span>
<a href="#l22.7"></a><span id="l22.7">     content/messenger/msgSynchronize.xul                                       (base/content/msgSynchronize.xul)</span>
<a href="#l22.8"></a><span id="l22.8">     content/messenger/msgSynchronize.js                                        (base/content/msgSynchronize.js)</span>
<a href="#l22.9"></a><span id="l22.9">     content/messenger/folderProps.xul                                          (base/content/folderProps.xul)</span>
<a href="#l22.10"></a><span id="l22.10">     content/messenger/menulist-charsetpicker.js                                (base/content/menulist-charsetpicker.js)</span>
<a href="#l22.11"></a><span id="l22.11">     content/messenger/folderProps.js                                           (base/content/folderProps.js)</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    content/messenger/folderWidgets.xml                                        (base/content/folderWidgets.xml)</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    content/messenger/folder-menupopup.js                                      (base/content/folder-menupopup.js)</span>
<a href="#l22.14"></a><span id="l22.14">     content/messenger/newFolderDialog.xul                                      (base/content/newFolderDialog.xul)</span>
<a href="#l22.15"></a><span id="l22.15">     content/messenger/newFolderDialog.js                                       (base/content/newFolderDialog.js)</span>
<a href="#l22.16"></a><span id="l22.16"> *   content/messenger/msgAccountCentral.xul                                    (base/content/msgAccountCentral.xul)</span>
<a href="#l22.17"></a><span id="l22.17">     content/messenger/msgAccountCentral.js                                     (base/content/msgAccountCentral.js)</span>
<a href="#l22.18"></a><span id="l22.18">     content/messenger/msgFolderPickerOverlay.js                                (base/content/msgFolderPickerOverlay.js)</span>
<a href="#l22.19"></a><span id="l22.19">     content/messenger/renameFolderDialog.xul                                   (base/content/renameFolderDialog.xul)</span>
<a href="#l22.20"></a><span id="l22.20">     content/messenger/renameFolderDialog.js                                    (base/content/renameFolderDialog.js)</span>
<a href="#l22.21"></a><span id="l22.21">     content/messenger/retention.js                                             (base/content/retention.js)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

