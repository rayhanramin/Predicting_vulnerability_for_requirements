<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8885:227e3ebe67b3170789b7183fe1c1958bfa312f3b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 227e3ebe67b3170789b7183fe1c1958bfa312f3b" />
<meta property="og:url" content="/comm-central/rev/227e3ebe67b3170789b7183fe1c1958bfa312f3b" />
<meta property="og:description" content="Bug 657394 Partly move mailnews/import to frozen linkage r=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 227e3ebe67b3170789b7183fe1c1958bfa312f3b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/227e3ebe67b3170789b7183fe1c1958bfa312f3b">shortlog</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/227e3ebe67b3170789b7183fe1c1958bfa312f3b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b">files</a> |
changeset |
<a href="/comm-central/raw-rev/227e3ebe67b3170789b7183fe1c1958bfa312f3b">raw</a>  | <a href="/comm-central/archive/227e3ebe67b3170789b7183fe1c1958bfa312f3b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=657394">Bug 657394</a> Partly move mailnews/import to frozen linkage r=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#101;&#105;&#108;&#32;&#82;&#97;&#115;&#104;&#98;&#114;&#111;&#111;&#107;&#32;&#60;&#110;&#101;&#105;&#108;&#64;&#112;&#97;&#114;&#107;&#119;&#97;&#121;&#99;&#99;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 23 Nov 2011 20:26:40 +0000</td></tr>

<tr>
 <td>changeset 8885</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/227e3ebe67b3170789b7183fe1c1958bfa312f3b">227e3ebe67b3170789b7183fe1c1958bfa312f3b</a></td>
</tr>



<tr>
<td>parent 8884</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3296869cb2c5a1679a6b7d9ce7146d50b0417cd8">3296869cb2c5a1679a6b7d9ce7146d50b0417cd8</a>
</td>
</tr>

<tr>
<td>child 8886</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9696f60a3def0036ba014a4c4d1c01ef860e126d">9696f60a3def0036ba014a4c4d1c01ef860e126d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=227e3ebe67b3170789b7183fe1c1958bfa312f3b">6814</a></td></tr>
<tr><td>push user</td><td>neil@parkwaycc.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Wed, 23 Nov 2011 20:26:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@227e3ebe67b3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=227e3ebe67b3170789b7183fe1c1958bfa312f3b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&newProject=comm-central&newRevision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&newProject=comm-central&newRevision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&newProject=comm-central&newRevision=227e3ebe67b3170789b7183fe1c1958bfa312f3b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=657394">657394</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=657394">Bug 657394</a> Partly move mailnews/import to frozen linkage r=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/build/Makefile.in">mailnews/import/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xMail.cpp">mailnews/import/comm4x/src/nsComm4xMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xMail.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xMail.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xMail.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xMail.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xProfile.cpp">mailnews/import/comm4x/src/nsComm4xProfile.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xProfile.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xProfile.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xProfile.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xProfile.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/comm4x/src/nsComm4xProfile.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.cpp">mailnews/import/eudora/src/nsEudoraAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.h">mailnews/import/eudora/src/nsEudoraAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraAddress.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.cpp">mailnews/import/eudora/src/nsEudoraCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.h">mailnews/import/eudora/src/nsEudoraCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraCompose.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.cpp">mailnews/import/eudora/src/nsEudoraEditor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.h">mailnews/import/eudora/src/nsEudoraEditor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraEditor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraFilters.cpp">mailnews/import/eudora/src/nsEudoraFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraFilters.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraFilters.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraFilters.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraFilters.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraImport.cpp">mailnews/import/eudora/src/nsEudoraImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraImport.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraImport.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraImport.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraImport.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.h">mailnews/import/eudora/src/nsEudoraMac.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMac.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">mailnews/import/eudora/src/nsEudoraMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.h">mailnews/import/eudora/src/nsEudoraMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraSettings.cpp">mailnews/import/eudora/src/nsEudoraSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraSettings.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraSettings.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraSettings.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraSettings.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">mailnews/import/eudora/src/nsEudoraStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.h">mailnews/import/eudora/src/nsEudoraStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.cpp">mailnews/import/eudora/src/nsEudoraWin32.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.h">mailnews/import/eudora/src/nsEudoraWin32.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/eudora/src/nsEudoraWin32.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/WabObject.h">mailnews/import/oexpress/WabObject.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/WabObject.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/WabObject.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/WabObject.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/WabObject.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/WabObject.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOE5File.h">mailnews/import/oexpress/nsOE5File.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOE5File.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOE5File.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOE5File.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOE5File.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOE5File.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEAddressIterator.cpp">mailnews/import/oexpress/nsOEAddressIterator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEAddressIterator.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEAddressIterator.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEAddressIterator.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEAddressIterator.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEAddressIterator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEImport.cpp">mailnews/import/oexpress/nsOEImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEImport.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEImport.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEImport.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEImport.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEScanBoxes.cpp">mailnews/import/oexpress/nsOEScanBoxes.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEScanBoxes.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEScanBoxes.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEScanBoxes.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEScanBoxes.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/oexpress/nsOEScanBoxes.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiApi.cpp">mailnews/import/outlook/src/MapiApi.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiApi.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiApi.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiApi.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiApi.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiApi.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.cpp">mailnews/import/outlook/src/MapiMessage.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.h">mailnews/import/outlook/src/MapiMessage.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/MapiMessage.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookCompose.cpp">mailnews/import/outlook/src/nsOutlookCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookCompose.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookCompose.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookCompose.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookCompose.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.cpp">mailnews/import/outlook/src/nsOutlookEditor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.h">mailnews/import/outlook/src/nsOutlookEditor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.h">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.h">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.h">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.h">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookEditor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookMail.cpp">mailnews/import/outlook/src/nsOutlookMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookMail.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookMail.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookMail.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookMail.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/outlook/src/nsOutlookMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextAddress.cpp">mailnews/import/text/src/nsTextAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextAddress.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextAddress.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextAddress.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextAddress.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextImport.cpp">mailnews/import/text/src/nsTextImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextImport.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextImport.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextImport.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextImport.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/text/src/nsTextImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/vcard/src/nsVCardImport.cpp">mailnews/import/vcard/src/nsVCardImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/vcard/src/nsVCardImport.cpp">file</a> |
<a href="/comm-central/annotate/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/vcard/src/nsVCardImport.cpp">annotate</a> |
<a href="/comm-central/diff/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/vcard/src/nsVCardImport.cpp">diff</a> |
<a href="/comm-central/comparison/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/vcard/src/nsVCardImport.cpp">comparison</a> |
<a href="/comm-central/log/227e3ebe67b3170789b7183fe1c1958bfa312f3b/mailnews/import/vcard/src/nsVCardImport.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -608,18 +608,20 @@ NS_IMETHODIMP nsAppleMailImportMail::Imp</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> void nsAppleMailImportMail::ReportStatus(PRInt32 aErrorNum, nsString &amp;aName, nsAString &amp;aStream)</span>
<a href="#l1.6"></a><span id="l1.6"> {</span>
<a href="#l1.7"></a><span id="l1.7">   // get (and format, if needed) the error string from the bundle  </span>
<a href="#l1.8"></a><span id="l1.8">   nsAutoString outString;</span>
<a href="#l1.9"></a><span id="l1.9">   const PRUnichar *fmt = { aName.get() };</span>
<a href="#l1.10"></a><span id="l1.10">   nsresult rv = mBundle-&gt;FormatStringFromID(aErrorNum, &amp;fmt, 1, getter_Copies(outString));</span>
<a href="#l1.11"></a><span id="l1.11">   // write it out the stream</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    aStream.Append(outString + NS_LITERAL_STRING(&quot;\n&quot;));</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    aStream.Append(outString);</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+    aStream.Append(PRUnichar('\n'));</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+  }</span>
<a href="#l1.18"></a><span id="l1.18"> }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> void nsAppleMailImportMail::SetLogs(const nsAString &amp;aSuccess, const nsAString &amp;aError, PRUnichar **aOutSuccess, PRUnichar **aOutError)</span>
<a href="#l1.21"></a><span id="l1.21"> {</span>
<a href="#l1.22"></a><span id="l1.22">   if (aOutError &amp;&amp; !*aOutError)</span>
<a href="#l1.23"></a><span id="l1.23">     *aOutError = ToNewUnicode(aError);</span>
<a href="#l1.24"></a><span id="l1.24">   if (aOutSuccess &amp;&amp; !*aOutSuccess)</span>
<a href="#l1.25"></a><span id="l1.25">     *aOutSuccess = ToNewUnicode(aSuccess);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/import/build/Makefile.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/import/build/Makefile.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -39,19 +39,21 @@ DEPTH		= ../../..</span>
<a href="#l2.4"></a><span id="l2.4"> topsrcdir	= @top_srcdir@</span>
<a href="#l2.5"></a><span id="l2.5"> srcdir		= @srcdir@</span>
<a href="#l2.6"></a><span id="l2.6"> VPATH		= @srcdir@</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> MODULE = import</span>
<a href="#l2.11"></a><span id="l2.11"> LIBRARY_NAME = import</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+IS_COMPONENT	= 1</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+ifdef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+FORCE_SHARED_LIB=1</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+else</span>
<a href="#l2.16"></a><span id="l2.16"> EXPORT_LIBRARY = 1</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-IS_COMPONENT	= 1</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l2.19"></a><span id="l2.19"> MOZILLA_INTERNAL_API = 1</span>
<a href="#l2.20"></a><span id="l2.20"> LIBXUL_LIBRARY = 1</span>
<a href="#l2.21"></a><span id="l2.21"> endif</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> MODULE_NAME	= nsImportServiceModule</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> CPPSRCS		=  nsImportModule.cpp</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27" class="difflineat">@@ -106,21 +108,24 @@ ifdef MOZILLA_INTERNAL_API</span>
<a href="#l2.28"></a><span id="l2.28"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l2.29"></a><span id="l2.29"> 	$(LIBS_DIR) \</span>
<a href="#l2.30"></a><span id="l2.30"> 	$(EXTRA_DSO_LIBS) \</span>
<a href="#l2.31"></a><span id="l2.31"> 	$(MOZ_UNICHARUTIL_LIBS) \</span>
<a href="#l2.32"></a><span id="l2.32"> 	$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l2.33"></a><span id="l2.33"> 	$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l2.34"></a><span id="l2.34"> 	$(NULL)</span>
<a href="#l2.35"></a><span id="l2.35"> else</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-EXTRA_DSO_LDOPTS = \</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+EXTRA_DSO_LDOPTS += \</span>
<a href="#l2.38"></a><span id="l2.38"> 	$(LIBS_DIR) \</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-	$(EXTRA_DSO_LIBS) \</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+	$(ZLIB_LIBS) \</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+	$(MOZ_ZLIB_LIBS) \</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+	$(MOZ_JS_LIBS) \</span>
<a href="#l2.43"></a><span id="l2.43"> 	$(XPCOM_GLUE_LDOPTS) \</span>
<a href="#l2.44"></a><span id="l2.44"> 	$(call EXPAND_LIBNAME_PATH,unicharutil_external_s,$(LIBXUL_DIST)/lib) \</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+	$(MOZDEPTH)/rdf/util/src/$(LIB_PREFIX)rdfutil_external_s.$(LIB_SUFFIX) \</span>
<a href="#l2.46"></a><span id="l2.46"> 	$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l2.47"></a><span id="l2.47"> 	$(NSPR_LIBS) \</span>
<a href="#l2.48"></a><span id="l2.48"> 	$(NULL)</span>
<a href="#l2.49"></a><span id="l2.49"> endif</span>
<a href="#l2.50"></a><span id="l2.50"> </span>
<a href="#l2.51"></a><span id="l2.51"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l2.52"></a><span id="l2.52"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l2.53"></a><span id="l2.53"> 	-framework Cocoa  \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMail.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/import/comm4x/src/nsComm4xMail.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -44,16 +44,18 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsComm4xMailStringBundle.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsComm4xMailImport.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;Comm4xMailDebugLog.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;prmem.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> #define  kCopyBufferSize    8192</span>
<a href="#l3.16"></a><span id="l3.16"> #define  kMailReadBufferSize  16384</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> static bool</span>
<a href="#l3.20"></a><span id="l3.20"> nsShouldIgnoreFile(nsString&amp; name)</span>
<a href="#l3.21"></a><span id="l3.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xProfile.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/import/comm4x/src/nsComm4xProfile.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -36,16 +36,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsComm4xProfile.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsIFileStreams.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> #include &quot;NSReg.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> #ifdef XP_UNIX</span>
<a href="#l4.17"></a><span id="l4.17"> #include &lt;limits.h&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> #endif</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20"> #if defined(XP_MACOSX)</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -123,17 +124,17 @@ nsComm4xProfile::GetProfileList(PRUint32</span>
<a href="#l4.22"></a><span id="l4.22">     while (!NR_RegEnumSubkeys(reg, ROOTKEY_USERS, &amp;enumstate,</span>
<a href="#l4.23"></a><span id="l4.23">                               profileName, MAXREGNAMELEN, REGENUM_CHILDREN))</span>
<a href="#l4.24"></a><span id="l4.24">         numProfileEntries++;</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">     // reset our enumerator</span>
<a href="#l4.27"></a><span id="l4.27">     enumstate = 0;</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">     PRUnichar **outArray, **next;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-    next = outArray = (PRUnichar **)nsMemory::Alloc(numProfileEntries * sizeof(PRUnichar *));</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+    next = outArray = (PRUnichar **)NS_Alloc(numProfileEntries * sizeof(PRUnichar *));</span>
<a href="#l4.32"></a><span id="l4.32">     if (!outArray)</span>
<a href="#l4.33"></a><span id="l4.33">         return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">     while (!NR_RegEnumSubkeys(reg, ROOTKEY_USERS, &amp;enumstate,</span>
<a href="#l4.36"></a><span id="l4.36">                               profileName, MAXREGNAMELEN, REGENUM_CHILDREN)) {</span>
<a href="#l4.37"></a><span id="l4.37">         *next = ToNewUnicode(NS_ConvertUTF8toUTF16(profileName));</span>
<a href="#l4.38"></a><span id="l4.38">         next++;</span>
<a href="#l4.39"></a><span id="l4.39">         localLength++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -40,19 +40,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsEudoraAddress.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;mdb.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsEudoraImport.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-#include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+#include &quot;nsEudoraCompose.h&quot;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l5.17"></a><span id="l5.17"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l5.18"></a><span id="l5.18"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l5.19"></a><span id="l5.19"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l5.20"></a><span id="l5.20"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l5.21"></a><span id="l5.21"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l5.22"></a><span id="l5.22"> #include &quot;EudoraDebugLog.h&quot;</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24"> #define  kWhitespace  &quot; \t\b\r\n&quot;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineat">@@ -554,18 +553,18 @@ bool CAliasData::Process( const char *pL</span>
<a href="#l5.26"></a><span id="l5.26">   if (tCnt == -1) {</span>
<a href="#l5.27"></a><span id="l5.27">     if (!str.IsEmpty()) {</span>
<a href="#l5.28"></a><span id="l5.28">       m_email = str;</span>
<a href="#l5.29"></a><span id="l5.29">       return( PR_TRUE);</span>
<a href="#l5.30"></a><span id="l5.30">     }</span>
<a href="#l5.31"></a><span id="l5.31">     return( PR_FALSE);</span>
<a href="#l5.32"></a><span id="l5.32">   }</span>
<a href="#l5.33"></a><span id="l5.33"> </span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-  str.Right( m_email, str.Length() - tCnt - 1);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-  str.Left( m_realName, tCnt);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  m_email = Substring(str, tCnt + 1);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+  m_realName = StringHead(str, tCnt);</span>
<a href="#l5.38"></a><span id="l5.38">   m_realName.Trim( kWhitespace);</span>
<a href="#l5.39"></a><span id="l5.39">   m_email.Trim( kWhitespace);</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41">   return( !m_email.IsEmpty());</span>
<a href="#l5.42"></a><span id="l5.42"> }</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44"> #ifdef IMPORT_DEBUG</span>
<a href="#l5.45"></a><span id="l5.45"> void DumpAliasArray( nsVoidArray&amp; a)</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineat">@@ -738,63 +737,55 @@ void nsEudoraAddress::ExtractNoteField( </span>
<a href="#l5.47"></a><span id="l5.47"> */</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49">   PRInt32 idx = note.Find( field);</span>
<a href="#l5.50"></a><span id="l5.50">   if (idx != -1) {</span>
<a href="#l5.51"></a><span id="l5.51">     idx += field.Length();</span>
<a href="#l5.52"></a><span id="l5.52">     PRInt32 endIdx = note.FindChar( '&gt;', idx);</span>
<a href="#l5.53"></a><span id="l5.53">     if (endIdx == -1)</span>
<a href="#l5.54"></a><span id="l5.54">       endIdx = note.Length() - 1;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-    note.Mid( value, idx, endIdx - idx);</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+    value = Substring(note, idx, endIdx - idx);</span>
<a href="#l5.57"></a><span id="l5.57">     idx -= field.Length();</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-    nsCString tempL;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-    if (idx)</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-      note.Left( tempL, idx);</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    nsCString tempR;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-    note.Right( tempR, note.Length() - endIdx - 1);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-    note = tempL;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-    note.Append( tempR);</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+    note.Cut(idx, endIdx + 1);</span>
<a href="#l5.66"></a><span id="l5.66">   }</span>
<a href="#l5.67"></a><span id="l5.67"> }</span>
<a href="#l5.68"></a><span id="l5.68"> </span>
<a href="#l5.69"></a><span id="l5.69"> void nsEudoraAddress::FormatExtraDataInNoteField(PRInt32 labelStringID, nsCString&amp; extraData, nsString&amp; noteUTF16)</span>
<a href="#l5.70"></a><span id="l5.70"> {</span>
<a href="#l5.71"></a><span id="l5.71">   nsAutoString    label;</span>
<a href="#l5.72"></a><span id="l5.72">   nsEudoraStringBundle::GetStringByID(labelStringID, label);</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74">   noteUTF16.Append(label);</span>
<a href="#l5.75"></a><span id="l5.75">   noteUTF16.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l5.76"></a><span id="l5.76">   noteUTF16.Append( NS_ConvertASCIItoUTF16(extraData) );</span>
<a href="#l5.77"></a><span id="l5.77">   noteUTF16.AppendLiteral(&quot;\n\n&quot;);</span>
<a href="#l5.78"></a><span id="l5.78"> }</span>
<a href="#l5.79"></a><span id="l5.79"> </span>
<a href="#l5.80"></a><span id="l5.80"> void nsEudoraAddress::SanitizeValue( nsCString&amp; val)</span>
<a href="#l5.81"></a><span id="l5.81"> {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-  val.ReplaceSubstring( &quot;\n&quot;, &quot;, &quot;);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-  val.ReplaceChar( 13, ',');</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-  val.ReplaceChar( 10, ',');</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+  MsgReplaceSubstring(val, &quot;\n&quot;, &quot;, &quot;);</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+  MsgReplaceChar(val, '\r', ',');</span>
<a href="#l5.87"></a><span id="l5.87"> }</span>
<a href="#l5.88"></a><span id="l5.88"> </span>
<a href="#l5.89"></a><span id="l5.89"> void nsEudoraAddress::SplitString( nsCString&amp; val1, nsCString&amp; val2)</span>
<a href="#l5.90"></a><span id="l5.90"> {</span>
<a href="#l5.91"></a><span id="l5.91">   nsCString  temp;</span>
<a href="#l5.92"></a><span id="l5.92"> </span>
<a href="#l5.93"></a><span id="l5.93">   // Find the last line if there is more than one!</span>
<a href="#l5.94"></a><span id="l5.94">   PRInt32 idx = val1.RFind( &quot;\x0D\x0A&quot;);</span>
<a href="#l5.95"></a><span id="l5.95">   PRInt32  cnt = 2;</span>
<a href="#l5.96"></a><span id="l5.96">   if (idx == -1) {</span>
<a href="#l5.97"></a><span id="l5.97">     cnt = 1;</span>
<a href="#l5.98"></a><span id="l5.98">     idx = val1.RFindChar( 13);</span>
<a href="#l5.99"></a><span id="l5.99">   }</span>
<a href="#l5.100"></a><span id="l5.100">   if (idx == -1)</span>
<a href="#l5.101"></a><span id="l5.101">     idx= val1.RFindChar( 10);</span>
<a href="#l5.102"></a><span id="l5.102">   if (idx != -1) {</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-    val1.Right( val2, val1.Length() - idx - cnt);</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-    val1.Left( temp, idx);</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-    val1 = temp;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineplus">+    val2 = Substring(val1, idx + cnt);</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+    val1.SetLength(idx);</span>
<a href="#l5.108"></a><span id="l5.108">     SanitizeValue( val1);</span>
<a href="#l5.109"></a><span id="l5.109">   }</span>
<a href="#l5.110"></a><span id="l5.110"> }</span>
<a href="#l5.111"></a><span id="l5.111"> </span>
<a href="#l5.112"></a><span id="l5.112"> void nsEudoraAddress::AddSingleCard( CAliasEntry *pEntry, nsVoidArray &amp;emailList, nsIAddrDatabase *pDb)</span>
<a href="#l5.113"></a><span id="l5.113"> {</span>
<a href="#l5.114"></a><span id="l5.114">   // We always have a nickname and everything else is optional.</span>
<a href="#l5.115"></a><span id="l5.115">   // Map both home and work related fields to our address card. Eudora</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineat">@@ -852,52 +843,51 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.117"></a><span id="l5.117">     // in the notes field?</span>
<a href="#l5.118"></a><span id="l5.118">     if ( !additionalEmail.IsEmpty() || !otherPhone.IsEmpty() || !otherWeb.IsEmpty() )</span>
<a href="#l5.119"></a><span id="l5.119">     {</span>
<a href="#l5.120"></a><span id="l5.120">       nsCString     otherNotes(note);</span>
<a href="#l5.121"></a><span id="l5.121"> </span>
<a href="#l5.122"></a><span id="l5.122">       if ( !additionalEmail.IsEmpty() )</span>
<a href="#l5.123"></a><span id="l5.123">       {</span>
<a href="#l5.124"></a><span id="l5.124">         // Reconstitute line breaks for additional email</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-        additionalEmail.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineplus">+        MsgReplaceSubstring(additionalEmail, &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.127"></a><span id="l5.127"> </span>
<a href="#l5.128"></a><span id="l5.128">         // Try to figure out if there are multiple email addresses in additionalEmail</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-        PRInt32     idx = additionalEmail.FindCharInSet(&quot;\t\r\n,; &quot;);</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+        PRInt32     idx = MsgFindCharInSet(additionalEmail, &quot;\t\r\n,; &quot;);</span>
<a href="#l5.131"></a><span id="l5.131"> </span>
<a href="#l5.132"></a><span id="l5.132">         if (idx != -1)</span>
<a href="#l5.133"></a><span id="l5.133">         {</span>
<a href="#l5.134"></a><span id="l5.134">           // We found a character that indicates that there's more than one email address here.</span>
<a href="#l5.135"></a><span id="l5.135">           // Separate out the addresses after the first one.</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-          additionalEmail.Right(stillMoreEmail, additionalEmail.Length() - idx - 1);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+          stillMoreEmail = Substring(additionalEmail, idx + 1);</span>
<a href="#l5.138"></a><span id="l5.138">           stillMoreEmail.Trim(kWhitespace);</span>
<a href="#l5.139"></a><span id="l5.139"> </span>
<a href="#l5.140"></a><span id="l5.140">           // Separate out the first address.</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-          nsCString   tempStashEmail(additionalEmail);</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-          tempStashEmail.Left(additionalEmail, idx);</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+          additionalEmail.SetLength(idx);</span>
<a href="#l5.144"></a><span id="l5.144">         }</span>
<a href="#l5.145"></a><span id="l5.145"> </span>
<a href="#l5.146"></a><span id="l5.146">         // If there were more than one additional email addresses store all the extra</span>
<a href="#l5.147"></a><span id="l5.147">         // ones in the notes field, labeled nicely.</span>
<a href="#l5.148"></a><span id="l5.148">         if ( !stillMoreEmail.IsEmpty() )</span>
<a href="#l5.149"></a><span id="l5.149">           FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHEREMAIL, stillMoreEmail, noteUTF16);</span>
<a href="#l5.150"></a><span id="l5.150">       }</span>
<a href="#l5.151"></a><span id="l5.151"> </span>
<a href="#l5.152"></a><span id="l5.152">       if ( !otherPhone.IsEmpty() )</span>
<a href="#l5.153"></a><span id="l5.153">       {</span>
<a href="#l5.154"></a><span id="l5.154">         // Reconstitute line breaks for other phone numbers</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-        otherPhone.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+        MsgReplaceSubstring(otherPhone, &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.157"></a><span id="l5.157"> </span>
<a href="#l5.158"></a><span id="l5.158">         // Store other phone numbers in the notes field, labeled nicely</span>
<a href="#l5.159"></a><span id="l5.159">         FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERPHONE, otherPhone, noteUTF16);</span>
<a href="#l5.160"></a><span id="l5.160">       }</span>
<a href="#l5.161"></a><span id="l5.161"> </span>
<a href="#l5.162"></a><span id="l5.162">       if ( !otherWeb.IsEmpty() )</span>
<a href="#l5.163"></a><span id="l5.163">       {</span>
<a href="#l5.164"></a><span id="l5.164">         // Reconstitute line breaks for other web sites</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-        otherWeb.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+        MsgReplaceSubstring(otherWeb, &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.167"></a><span id="l5.167"> </span>
<a href="#l5.168"></a><span id="l5.168">         // Store other web sites in the notes field, labeled nicely</span>
<a href="#l5.169"></a><span id="l5.169">         FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERWEB, otherWeb, noteUTF16);</span>
<a href="#l5.170"></a><span id="l5.170">       }</span>
<a href="#l5.171"></a><span id="l5.171"> </span>
<a href="#l5.172"></a><span id="l5.172">       noteUTF16.Append( NS_ConvertASCIItoUTF16(note) );</span>
<a href="#l5.173"></a><span id="l5.173">     }</span>
<a href="#l5.174"></a><span id="l5.174">   }</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineat">@@ -906,37 +896,37 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.176"></a><span id="l5.176"> </span>
<a href="#l5.177"></a><span id="l5.177">   if (pData &amp;&amp; !pData-&gt;m_realName.IsEmpty())</span>
<a href="#l5.178"></a><span id="l5.178">     displayName = pData-&gt;m_realName;</span>
<a href="#l5.179"></a><span id="l5.179">   else if (!name.IsEmpty())</span>
<a href="#l5.180"></a><span id="l5.180">     displayName = name;</span>
<a href="#l5.181"></a><span id="l5.181">   else</span>
<a href="#l5.182"></a><span id="l5.182">     displayName = pEntry-&gt;m_name;</span>
<a href="#l5.183"></a><span id="l5.183"> </span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-  address.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+  MsgReplaceSubstring(address, &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.186"></a><span id="l5.186">   SplitString( address, address2);</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-  note.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-  fax.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-  secondaryFax.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-  phone.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-  name.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-  city.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-  state.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-  zip.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineminus">-  country.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+  MsgReplaceSubstring(note, &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineplus">+  MsgReplaceSubstring(fax, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineplus">+  MsgReplaceSubstring(secondaryFax, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineplus">+  MsgReplaceSubstring(phone, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+  MsgReplaceSubstring(name, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineplus">+  MsgReplaceSubstring(city, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineplus">+  MsgReplaceSubstring(state, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineplus">+  MsgReplaceSubstring(zip, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+  MsgReplaceSubstring(country, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.205"></a><span id="l5.205"> </span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-  addressWK.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+  MsgReplaceSubstring(addressWK, &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.208"></a><span id="l5.208">   SplitString( addressWK, address2WK);</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineminus">-  phoneWK.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineminus">-  cityWK.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineminus">-  stateWK.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineminus">-  zipWK.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineminus">-  countryWK.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineminus">-  title.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineminus">-  company.ReplaceSubstring( &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+  MsgReplaceSubstring(phoneWK, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+  MsgReplaceSubstring(cityWK, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+  MsgReplaceSubstring(stateWK, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+  MsgReplaceSubstring(zipWK, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+  MsgReplaceSubstring(countryWK, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+  MsgReplaceSubstring(title, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+  MsgReplaceSubstring(company, &quot;\x03&quot;, &quot; &quot;);</span>
<a href="#l5.223"></a><span id="l5.223"> </span>
<a href="#l5.224"></a><span id="l5.224">   if (newRow)</span>
<a href="#l5.225"></a><span id="l5.225">   {</span>
<a href="#l5.226"></a><span id="l5.226">     nsAutoString uniStr;</span>
<a href="#l5.227"></a><span id="l5.227"> </span>
<a href="#l5.228"></a><span id="l5.228">     // Home related fields.</span>
<a href="#l5.229"></a><span id="l5.229">     ADD_FIELD_TO_DB_ROW(pDb, AddDisplayName, newRow, displayName, uniStr);</span>
<a href="#l5.230"></a><span id="l5.230">     ADD_FIELD_TO_DB_ROW(pDb, AddNickName, newRow, pEntry-&gt;m_name, uniStr);</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineat">@@ -960,17 +950,17 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.232"></a><span id="l5.232">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkPhone, newRow, phoneWK, uniStr);</span>
<a href="#l5.233"></a><span id="l5.233">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkAddress, newRow, addressWK, uniStr);</span>
<a href="#l5.234"></a><span id="l5.234">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkAddress2, newRow, address2WK, uniStr);</span>
<a href="#l5.235"></a><span id="l5.235">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkCity, newRow, cityWK, uniStr);</span>
<a href="#l5.236"></a><span id="l5.236">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkZipCode, newRow, zipWK, uniStr);</span>
<a href="#l5.237"></a><span id="l5.237">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkState, newRow, stateWK, uniStr);</span>
<a href="#l5.238"></a><span id="l5.238">     ADD_FIELD_TO_DB_ROW(pDb, AddWorkCountry, newRow, countryWK, uniStr);</span>
<a href="#l5.239"></a><span id="l5.239"> </span>
<a href="#l5.240"></a><span id="l5.240" class="difflineminus">-    if ( (primaryLocation.IsEmpty() || primaryLocation.LowerCaseEqualsASCII(&quot;home&quot;)) &amp;&amp;</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineplus">+    if ( (primaryLocation.IsEmpty() || primaryLocation.LowerCaseEqualsLiteral(&quot;home&quot;)) &amp;&amp;</span>
<a href="#l5.242"></a><span id="l5.242">          !mobile.IsEmpty() )</span>
<a href="#l5.243"></a><span id="l5.243">     {</span>
<a href="#l5.244"></a><span id="l5.244">       // Primary location field is either specified to be &quot;home&quot; or is not</span>
<a href="#l5.245"></a><span id="l5.245">       // specified and there is a home mobile number, so use that as the mobile number.</span>
<a href="#l5.246"></a><span id="l5.246">       ADD_FIELD_TO_DB_ROW(pDb, AddCellularNumber, newRow, mobile, uniStr);</span>
<a href="#l5.247"></a><span id="l5.247"> </span>
<a href="#l5.248"></a><span id="l5.248">       isSecondaryMobileWorkNumber = PR_TRUE;</span>
<a href="#l5.249"></a><span id="l5.249">     }</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineat">@@ -980,17 +970,17 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.251"></a><span id="l5.251">       // home mobile number, so use work mobile number.</span>
<a href="#l5.252"></a><span id="l5.252">       ADD_FIELD_TO_DB_ROW(pDb, AddCellularNumber, newRow, secondaryMobile, uniStr);</span>
<a href="#l5.253"></a><span id="l5.253"> </span>
<a href="#l5.254"></a><span id="l5.254">       // Home mobile number (if any) is the secondary mobile number</span>
<a href="#l5.255"></a><span id="l5.255">       secondaryMobile = mobile;</span>
<a href="#l5.256"></a><span id="l5.256">       isSecondaryMobileWorkNumber = PR_FALSE;</span>
<a href="#l5.257"></a><span id="l5.257">     }</span>
<a href="#l5.258"></a><span id="l5.258"> </span>
<a href="#l5.259"></a><span id="l5.259" class="difflineminus">-    if ( (primaryLocation.IsEmpty() || primaryLocation.LowerCaseEqualsASCII(&quot;home&quot;)) &amp;&amp;</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+    if ( (primaryLocation.IsEmpty() || primaryLocation.LowerCaseEqualsLiteral(&quot;home&quot;)) &amp;&amp;</span>
<a href="#l5.261"></a><span id="l5.261">          !fax.IsEmpty() )</span>
<a href="#l5.262"></a><span id="l5.262">     {</span>
<a href="#l5.263"></a><span id="l5.263">       // Primary location field is either specified to be &quot;home&quot; or is not</span>
<a href="#l5.264"></a><span id="l5.264">       // specified and there is a home fax number, so use that as the fax number.</span>
<a href="#l5.265"></a><span id="l5.265">       ADD_FIELD_TO_DB_ROW(pDb, AddFaxNumber, newRow, fax, uniStr);</span>
<a href="#l5.266"></a><span id="l5.266"> </span>
<a href="#l5.267"></a><span id="l5.267">       isSecondaryFaxWorkNumber = PR_TRUE;</span>
<a href="#l5.268"></a><span id="l5.268">     }</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineat">@@ -1130,17 +1120,18 @@ nsresult nsEudoraAddress::AddSingleList(</span>
<a href="#l5.270"></a><span id="l5.270">   rv = pDb-&gt;AddListNickName(newRow, pEntry-&gt;m_name.get());</span>
<a href="#l5.271"></a><span id="l5.271">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.272"></a><span id="l5.272"> </span>
<a href="#l5.273"></a><span id="l5.273">   // Now add the members.</span>
<a href="#l5.274"></a><span id="l5.274">   PRInt32 max = emailList.Count();</span>
<a href="#l5.275"></a><span id="l5.275">   for (PRInt32 i = 0; i &lt; max; i++)</span>
<a href="#l5.276"></a><span id="l5.276">   {</span>
<a href="#l5.277"></a><span id="l5.277">     CAliasData *pData = (CAliasData *)emailList.ElementAt(i);</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineminus">-    nsCAutoString ldifValue(NS_LITERAL_CSTRING(&quot;mail=&quot;) + nsDependentCString(pData-&gt;m_email.get()));</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineplus">+    nsCAutoString ldifValue(&quot;mail&quot;);</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineplus">+    ldifValue.Append(pData-&gt;m_email);</span>
<a href="#l5.281"></a><span id="l5.281">     rv = pDb-&gt;AddLdifListMember(newRow, ldifValue.get());</span>
<a href="#l5.282"></a><span id="l5.282">   }</span>
<a href="#l5.283"></a><span id="l5.283"> </span>
<a href="#l5.284"></a><span id="l5.284">   rv = pDb-&gt;AddCardRowToDB(newRow);</span>
<a href="#l5.285"></a><span id="l5.285">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.286"></a><span id="l5.286"> </span>
<a href="#l5.287"></a><span id="l5.287">   rv = pDb-&gt;AddListDirNode(newRow);</span>
<a href="#l5.288"></a><span id="l5.288">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -35,17 +35,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.5"></a><span id="l6.5">  *</span>
<a href="#l6.6"></a><span id="l6.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> #ifndef nsEudoraAddress_h__</span>
<a href="#l6.9"></a><span id="l6.9"> #define nsEudoraAddress_h__</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> #include &quot;nscore.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l6.14"></a><span id="l6.14"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l6.15"></a><span id="l6.15"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l6.16"></a><span id="l6.16"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l6.17"></a><span id="l6.17"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l6.18"></a><span id="l6.18"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21"> class nsIAddrDatabase;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -34,18 +34,18 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.5"></a><span id="l7.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.6"></a><span id="l7.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.7"></a><span id="l7.7">  *</span>
<a href="#l7.8"></a><span id="l7.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nscore.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> #include &quot;prthread.h&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l7.16"></a><span id="l7.16"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l7.17"></a><span id="l7.17"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l7.18"></a><span id="l7.18"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l7.19"></a><span id="l7.19"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l7.20"></a><span id="l7.20"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l7.21"></a><span id="l7.21"> #include &quot;nsIURI.h&quot;</span>
<a href="#l7.22"></a><span id="l7.22"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l7.23"></a><span id="l7.23"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -62,17 +62,16 @@</span>
<a href="#l7.25"></a><span id="l7.25"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27"> #include &quot;nsEudoraCompose.h&quot;</span>
<a href="#l7.28"></a><span id="l7.28"> #include &quot;nsEudoraEditor.h&quot;</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30"> #include &quot;EudoraDebugLog.h&quot;</span>
<a href="#l7.31"></a><span id="l7.31"> </span>
<a href="#l7.32"></a><span id="l7.32"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l7.34"></a><span id="l7.34"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l7.35"></a><span id="l7.35"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l7.36"></a><span id="l7.36"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38"> static NS_DEFINE_CID( kMsgSendCID, NS_MSGSEND_CID);</span>
<a href="#l7.39"></a><span id="l7.39"> static NS_DEFINE_CID( kMsgCompFieldsCID, NS_MSGCOMPFIELDS_CID);</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41"> // We need to do some calculations to set these numbers to something reasonable!</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineat">@@ -457,60 +456,52 @@ void nsEudoraCompose::GetHeaderValue( co</span>
<a href="#l7.43"></a><span id="l7.43">   }</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">   val.Trim( kWhitespace);</span>
<a href="#l7.46"></a><span id="l7.46"> }</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49"> void nsEudoraCompose::ExtractCharset( nsString&amp; str)</span>
<a href="#l7.50"></a><span id="l7.50"> {</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-  nsString tStr;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-  PRInt32 idx = str.Find( &quot;charset=&quot;, PR_TRUE);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+  PRInt32 idx = MsgFind(str, &quot;charset=&quot;, PR_TRUE, 0);</span>
<a href="#l7.54"></a><span id="l7.54">   if (idx != -1) {</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-    idx += 8;</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-    str.Right( tStr, str.Length() - idx);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-    idx = tStr.FindChar( ';');</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+    str.Cut(0, idx + 8);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+    idx = str.FindChar( ';');</span>
<a href="#l7.60"></a><span id="l7.60">     if (idx != -1)</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-      tStr.Left( str, idx);</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-    else</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-      str = tStr;</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+      str.SetLength(idx);</span>
<a href="#l7.65"></a><span id="l7.65">     str.Trim( kWhitespace);</span>
<a href="#l7.66"></a><span id="l7.66">     if ((str.CharAt( 0) == '&quot;') &amp;&amp; (str.Length() &gt; 2)) {</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-      str.Mid( tStr, 1, str.Length() - 2);</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-      str = tStr;</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+      str.SetLength(str.Length() - 1);</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+      str.Cut(0, 1);</span>
<a href="#l7.71"></a><span id="l7.71">       str.Trim( kWhitespace);</span>
<a href="#l7.72"></a><span id="l7.72">     }</span>
<a href="#l7.73"></a><span id="l7.73">   }</span>
<a href="#l7.74"></a><span id="l7.74">   else</span>
<a href="#l7.75"></a><span id="l7.75">     str.Truncate();</span>
<a href="#l7.76"></a><span id="l7.76"> }</span>
<a href="#l7.77"></a><span id="l7.77"> </span>
<a href="#l7.78"></a><span id="l7.78"> void nsEudoraCompose::ExtractType( nsString&amp; str)</span>
<a href="#l7.79"></a><span id="l7.79"> {</span>
<a href="#l7.80"></a><span id="l7.80">   nsString tStr;</span>
<a href="#l7.81"></a><span id="l7.81">   PRInt32 idx = str.FindChar( ';');</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-  if (idx != -1) {</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-    str.Left( tStr, idx);</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-    str = tStr;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-  }</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+  if (idx != -1)</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+    str.SetLength(idx);</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+</span>
<a href="#l7.89"></a><span id="l7.89">   str.Trim( kWhitespace);</span>
<a href="#l7.90"></a><span id="l7.90"> </span>
<a href="#l7.91"></a><span id="l7.91">   if ((str.CharAt( 0) == '&quot;') &amp;&amp; (str.Length() &gt; 2)) {</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-    str.Mid( tStr, 1, str.Length() - 2);</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-    str = tStr;</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+    str.SetLength(str.Length() - 1);</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+    str.Cut(0, 1);</span>
<a href="#l7.96"></a><span id="l7.96">     str.Trim( kWhitespace);</span>
<a href="#l7.97"></a><span id="l7.97">   }</span>
<a href="#l7.98"></a><span id="l7.98"> </span>
<a href="#l7.99"></a><span id="l7.99">   // if multipart then ignore it since no outlook message body is ever</span>
<a href="#l7.100"></a><span id="l7.100">   // valid multipart!</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-  if (str.Length() &gt; 10) {</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-    str.Left( tStr, 10);</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-    if (tStr.LowerCaseEqualsLiteral(&quot;multipart/&quot;))</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-      str.Truncate();</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineminus">-  }</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineplus">+  if (StringBeginsWith(str, NS_LITERAL_STRING(&quot;multipart/&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+    str.Truncate();</span>
<a href="#l7.108"></a><span id="l7.108"> }</span>
<a href="#l7.109"></a><span id="l7.109"> </span>
<a href="#l7.110"></a><span id="l7.110"> nsresult nsEudoraCompose::GetLocalAttachments(nsIArray **aArray)</span>
<a href="#l7.111"></a><span id="l7.111"> {</span>
<a href="#l7.112"></a><span id="l7.112">   /*</span>
<a href="#l7.113"></a><span id="l7.113">   nsIURI      *url = nsnull;</span>
<a href="#l7.114"></a><span id="l7.114">   */</span>
<a href="#l7.115"></a><span id="l7.115">   nsresult rv;</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineat">@@ -586,17 +577,17 @@ nsresult nsEudoraCompose::SendTheMessage</span>
<a href="#l7.117"></a><span id="l7.117">   // Use platform charset as default if the msg doesn't specify one</span>
<a href="#l7.118"></a><span id="l7.118">   // (ie, no 'charset' param in the Content-Type: header). As the last</span>
<a href="#l7.119"></a><span id="l7.119">   // resort we'll use the mail default charset.</span>
<a href="#l7.120"></a><span id="l7.120">   // (ie, no 'charset' param in the Content-Type: header) or if the</span>
<a href="#l7.121"></a><span id="l7.121">   // charset parameter fails a length sanity check.</span>
<a href="#l7.122"></a><span id="l7.122">   // As the last resort we'll use the mail default charset.</span>
<a href="#l7.123"></a><span id="l7.123">   if ( headerVal.IsEmpty() || (headerVal.Length() &gt; kContentTypeLengthSanityCheck) )</span>
<a href="#l7.124"></a><span id="l7.124">   {</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineminus">-    CopyASCIItoUTF16(nsMsgI18NFileSystemCharset(), headerVal);</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+    headerVal.AssignASCII(nsMsgI18NFileSystemCharset());</span>
<a href="#l7.127"></a><span id="l7.127">     if (headerVal.IsEmpty())</span>
<a href="#l7.128"></a><span id="l7.128">     { // last resort</span>
<a href="#l7.129"></a><span id="l7.129">       if (m_defCharset.IsEmpty())</span>
<a href="#l7.130"></a><span id="l7.130">       {</span>
<a href="#l7.131"></a><span id="l7.131">         nsString defaultCharset;</span>
<a href="#l7.132"></a><span id="l7.132">         NS_GetLocalizedUnicharPreferenceWithDefault(nsnull, &quot;mailnews.view_default_charset&quot;,</span>
<a href="#l7.133"></a><span id="l7.133">                                                     NS_LITERAL_STRING(&quot;ISO-8859-1&quot;), defaultCharset);</span>
<a href="#l7.134"></a><span id="l7.134">         m_defCharset = defaultCharset;</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineat">@@ -614,17 +605,17 @@ nsresult nsEudoraCompose::SendTheMessage</span>
<a href="#l7.136"></a><span id="l7.136">     m_pMsgFields-&gt;SetMessageId( NS_LossyConvertUTF16toASCII(headerVal).get() );</span>
<a href="#l7.137"></a><span id="l7.137">   GetHeaderValue( m_pHeaders, m_headerLen, &quot;Reply-To:&quot;, headerVal);</span>
<a href="#l7.138"></a><span id="l7.138">   if (!headerVal.IsEmpty())</span>
<a href="#l7.139"></a><span id="l7.139">     m_pMsgFields-&gt;SetReplyTo( headerVal);</span>
<a href="#l7.140"></a><span id="l7.140"> </span>
<a href="#l7.141"></a><span id="l7.141">   // what about all of the other headers?!?!?!?!?!?!</span>
<a href="#l7.142"></a><span id="l7.142">   char *pMimeType;</span>
<a href="#l7.143"></a><span id="l7.143">   if (!bodyType.IsEmpty())</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineminus">-    pMimeType = ToNewCString(bodyType);</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineplus">+    pMimeType = ToNewCString(NS_LossyConvertUTF16toASCII(bodyType));</span>
<a href="#l7.146"></a><span id="l7.146">   else</span>
<a href="#l7.147"></a><span id="l7.147">     pMimeType = ToNewCString(m_bodyType);</span>
<a href="#l7.148"></a><span id="l7.148"> </span>
<a href="#l7.149"></a><span id="l7.149">   // IMPORT_LOG0( &quot;Outlook compose calling CreateAndSendMessage\n&quot;);</span>
<a href="#l7.150"></a><span id="l7.150">   nsCOMPtr&lt;nsIArray&gt; pAttach;</span>
<a href="#l7.151"></a><span id="l7.151">   GetLocalAttachments(getter_AddRefs(pAttach));</span>
<a href="#l7.152"></a><span id="l7.152"> </span>
<a href="#l7.153"></a><span id="l7.153">   /*</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -36,23 +36,30 @@</span>
<a href="#l8.4"></a><span id="l8.4">  *</span>
<a href="#l8.5"></a><span id="l8.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> #ifndef nsEudoraCompose_h__</span>
<a href="#l8.8"></a><span id="l8.8"> #define nsEudoraCompose_h__</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nscore.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15"> #include &quot;nsIFile.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l8.18"></a><span id="l8.18"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l8.21"></a><span id="l8.21"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+#else</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+#define NS_CopyNativeToUnicode(source, dest) \</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+        nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(), source, dest)</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+#endif</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29"> class nsIMsgSend;</span>
<a href="#l8.30"></a><span id="l8.30"> class nsIMsgCompFields;</span>
<a href="#l8.31"></a><span id="l8.31"> class nsIMsgIdentity;</span>
<a href="#l8.32"></a><span id="l8.32"> class nsIMsgSendListener;</span>
<a href="#l8.33"></a><span id="l8.33"> class nsIIOService;</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35"> #include &quot;nsIMsgSend.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraEditor.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraEditor.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -36,17 +36,18 @@</span>
<a href="#l9.4"></a><span id="l9.4"> *</span>
<a href="#l9.5"></a><span id="l9.5"> * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> #include &quot;nsEudoraEditor.h&quot;</span>
<a href="#l9.9"></a><span id="l9.9"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17"> NS_IMPL_ISUPPORTS2(nsEudoraEditor, nsIEditor, nsIEditorMailSupport)</span>
<a href="#l9.18"></a><span id="l9.18"> NS_IMPL_ISUPPORTS4(nsEudoraHTMLImageElement, nsIDOMNode, nsIDOMElement, nsIDOMHTMLElement, nsIDOMHTMLImageElement)</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21"> static char *     sEudoraEmbeddedContentLines[] = {</span>
<a href="#l9.22"></a><span id="l9.22">   &quot;Embedded Content: &quot;,</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineat">@@ -736,22 +737,20 @@ NS_IMETHODIMP nsEudoraEditor::GetEmbedde</span>
<a href="#l9.24"></a><span id="l9.24">     {</span>
<a href="#l9.25"></a><span id="l9.25">       // Found this translation of &quot;Embedded Content&quot; - remember that so that we don't</span>
<a href="#l9.26"></a><span id="l9.26">       // bother looking for any other translations.</span>
<a href="#l9.27"></a><span id="l9.27">       foundEmbeddedContentLines = PR_TRUE;</span>
<a href="#l9.28"></a><span id="l9.28"> </span>
<a href="#l9.29"></a><span id="l9.29">       // Extract the file name from the embedded content line</span>
<a href="#l9.30"></a><span id="l9.30">       PRInt32   startFileName = startEmbeddedContentLine + lenEmbeddedContentTag;</span>
<a href="#l9.31"></a><span id="l9.31">       PRInt32   endFileName = m_body.Find(&quot;:&quot;, PR_FALSE, startFileName);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-      nsString  fileName;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-      m_body.Mid(fileName, startFileName, endFileName - startFileName);</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">       // Create the file spec for the embedded image</span>
<a href="#l9.36"></a><span id="l9.36">       embeddedFolderSpec-&gt;Clone(getter_AddRefs(embeddedImageSpec));</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-      embeddedImageSpec-&gt;Append(fileName);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+      embeddedImageSpec-&gt;Append(Substring(m_body, startFileName, endFileName - startFileName));</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">       // Verify that the embedded image spec exists and is a file</span>
<a href="#l9.41"></a><span id="l9.41">       bool      isFile = false;</span>
<a href="#l9.42"></a><span id="l9.42">       bool      exists = false;</span>
<a href="#l9.43"></a><span id="l9.43">       if ( NS_FAILED(embeddedImageSpec-&gt;Exists( &amp;exists)) || NS_FAILED(embeddedImageSpec-&gt;IsFile(&amp;isFile)) )</span>
<a href="#l9.44"></a><span id="l9.44">         continue;</span>
<a href="#l9.45"></a><span id="l9.45">       if (!exists || !isFile)</span>
<a href="#l9.46"></a><span id="l9.46">         continue;</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineat">@@ -762,23 +761,23 @@ NS_IMETHODIMP nsEudoraEditor::GetEmbedde</span>
<a href="#l9.48"></a><span id="l9.48">       if (startCIDHash != kNotFound)</span>
<a href="#l9.49"></a><span id="l9.49">       {</span>
<a href="#l9.50"></a><span id="l9.50">         startCIDHash++;</span>
<a href="#l9.51"></a><span id="l9.51">         PRInt32   endCIDHash = m_body.Find(&quot;,&quot;, PR_FALSE, startCIDHash);</span>
<a href="#l9.52"></a><span id="l9.52"> </span>
<a href="#l9.53"></a><span id="l9.53">         if (endCIDHash != kNotFound)</span>
<a href="#l9.54"></a><span id="l9.54">         {</span>
<a href="#l9.55"></a><span id="l9.55">           nsString    cidHash;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-          m_body.Mid(cidHash, startCIDHash, endCIDHash - startCIDHash);</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+          cidHash.Assign(Substring(m_body, startCIDHash, endCIDHash - startCIDHash));</span>
<a href="#l9.58"></a><span id="l9.58"> </span>
<a href="#l9.59"></a><span id="l9.59">           if ( !cidHash.IsEmpty() )</span>
<a href="#l9.60"></a><span id="l9.60">           {</span>
<a href="#l9.61"></a><span id="l9.61">             // Convert CID hash string to numeric value</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-            PRInt32   aErrorCode;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-            cidHashValue = cidHash.ToInteger(&amp;aErrorCode, kRadix16);</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+            nsresult aErrorCode;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+            cidHashValue = cidHash.ToInteger(&amp;aErrorCode, 16);</span>
<a href="#l9.66"></a><span id="l9.66">           }</span>
<a href="#l9.67"></a><span id="l9.67">         }</span>
<a href="#l9.68"></a><span id="l9.68">       }</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70">       // Get the URL for the embedded image</span>
<a href="#l9.71"></a><span id="l9.71">       nsCString     embeddedImageURL;</span>
<a href="#l9.72"></a><span id="l9.72">       rv = NS_GetURLSpecFromFile(embeddedImageSpec, embeddedImageURL);</span>
<a href="#l9.73"></a><span id="l9.73">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineat">@@ -852,26 +851,26 @@ bool nsEudoraEditor::UpdateEmbeddedImage</span>
<a href="#l9.75"></a><span id="l9.75">     // Get the quote char and verify that it's valid</span>
<a href="#l9.76"></a><span id="l9.76">     char    quoteChar = static_cast &lt;char&gt; (m_body.CharAt(startSrcValue));</span>
<a href="#l9.77"></a><span id="l9.77">     if ( (quoteChar != '&quot;') &amp;&amp; (quoteChar != '\'') )</span>
<a href="#l9.78"></a><span id="l9.78">       continue;</span>
<a href="#l9.79"></a><span id="l9.79"> </span>
<a href="#l9.80"></a><span id="l9.80">     // Move past the quote</span>
<a href="#l9.81"></a><span id="l9.81">     ++startSrcValue;</span>
<a href="#l9.82"></a><span id="l9.82"> </span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-    PRInt32   endSrcValue = m_body.Find(nsCString(quoteChar), PR_FALSE, startSrcValue);</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+    PRInt32   endSrcValue = m_body.FindChar(quoteChar, startSrcValue);</span>
<a href="#l9.85"></a><span id="l9.85">     PRInt32   srcLength = endSrcValue - startSrcValue;</span>
<a href="#l9.86"></a><span id="l9.86"> </span>
<a href="#l9.87"></a><span id="l9.87">     nsString  srcValue;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-    m_body.Mid(srcValue, startSrcValue, srcLength);</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+    srcValue.Assign(Substring(m_body, startSrcValue, srcLength));</span>
<a href="#l9.90"></a><span id="l9.90"> </span>
<a href="#l9.91"></a><span id="l9.91">     if (aCIDHash != 0)</span>
<a href="#l9.92"></a><span id="l9.92">     {</span>
<a href="#l9.93"></a><span id="l9.93">       // Verify source value starts with &quot;cid:&quot;</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-      if ( !srcValue.EqualsIgnoreCase(&quot;cid:&quot;, 4) )</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+      if (!StringBeginsWith(srcValue, NS_LITERAL_STRING(&quot;cid:&quot;), nsCaseInsensitiveStringComparator()))</span>
<a href="#l9.96"></a><span id="l9.96">         continue;</span>
<a href="#l9.97"></a><span id="l9.97"> </span>
<a href="#l9.98"></a><span id="l9.98">       // Remove &quot;cid:&quot; from the start</span>
<a href="#l9.99"></a><span id="l9.99">       srcValue.Cut(0, 4);</span>
<a href="#l9.100"></a><span id="l9.100"> </span>
<a href="#l9.101"></a><span id="l9.101">       PRUint32  hashValue = EudoraHashString( NS_LossyConvertUTF16toASCII(srcValue).get() );</span>
<a href="#l9.102"></a><span id="l9.102">       foundMatch = (hashValue == aCIDHash);</span>
<a href="#l9.103"></a><span id="l9.103">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraEditor.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraEditor.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -36,17 +36,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> *</span>
<a href="#l10.5"></a><span id="l10.5"> * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nscore.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsIEditor.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIEditorMailSupport.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsIFile.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> class nsEudoraEditor : public nsIEditor, public nsIEditorMailSupport</span>
<a href="#l10.18"></a><span id="l10.18"> {</span>
<a href="#l10.19"></a><span id="l10.19">   public:</span>
<a href="#l10.20"></a><span id="l10.20">     NS_DECL_ISUPPORTS</span>
<a href="#l10.21"></a><span id="l10.21">     NS_DECL_NSIEDITOR</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -41,16 +41,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> */</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> #include &quot;nscore.h&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l11.9"></a><span id="l11.9"> #include &quot;nspr.h&quot;</span>
<a href="#l11.10"></a><span id="l11.10"> #include &quot;plstr.h&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l11.16"></a><span id="l11.16"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> #include &quot;nsEudoraFilters.h&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -259,17 +260,21 @@ bool nsEudoraFilters::RealImport()</span>
<a href="#l11.22"></a><span id="l11.22">       {</span>
<a href="#l11.23"></a><span id="l11.23">         const char* pMailboxPath = strchr(pLine, ' ') + 1;</span>
<a href="#l11.24"></a><span id="l11.24">         bool isTransfer = (*pLine == 't');</span>
<a href="#l11.25"></a><span id="l11.25">         rv = AddMailboxAction(pMailboxPath, isTransfer);</span>
<a href="#l11.26"></a><span id="l11.26">         if (rv == NS_ERROR_INVALID_ARG)</span>
<a href="#l11.27"></a><span id="l11.27">         {</span>
<a href="#l11.28"></a><span id="l11.28">           nsAutoString unicodeMailboxPath;</span>
<a href="#l11.29"></a><span id="l11.29">           NS_CopyNativeToUnicode(nsCString(pMailboxPath), unicodeMailboxPath);</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-          m_errorLog += NS_LITERAL_STRING(&quot;- &quot;) + name + NS_LITERAL_STRING(&quot;: &quot;) + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_MAILBOX_MISSING, unicodeMailboxPath.get()) + NS_LITERAL_STRING(&quot;\n&quot;) ;</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+          m_errorLog += NS_LITERAL_STRING(&quot;- &quot;);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+          m_errorLog += name;</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+          m_errorLog += NS_LITERAL_STRING(&quot;: &quot;);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+          m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_MAILBOX_MISSING, unicodeMailboxPath.get());</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+          m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.36"></a><span id="l11.36">           rv = NS_OK;</span>
<a href="#l11.37"></a><span id="l11.37">         }</span>
<a href="#l11.38"></a><span id="l11.38">       }</span>
<a href="#l11.39"></a><span id="l11.39">       // Doing strncmp() here because Win Eudora puts a space after &quot;stop&quot; but Mac Eudora doesn't</span>
<a href="#l11.40"></a><span id="l11.40">       else if (!strncmp(pLine, &quot;stop&quot;, 4))</span>
<a href="#l11.41"></a><span id="l11.41">         m_hasStop = PR_TRUE;</span>
<a href="#l11.42"></a><span id="l11.42">       else if (!strncmp(pLine, &quot;forward &quot;, 8))</span>
<a href="#l11.43"></a><span id="l11.43">         rv = AddStringAction(nsMsgFilterAction::Forward, pLine + 8);</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineat">@@ -319,22 +324,32 @@ bool nsEudoraFilters::RealImport()</span>
<a href="#l11.45"></a><span id="l11.45"> #endif</span>
<a href="#l11.46"></a><span id="l11.46">         rv = AddAction(bDelete? (nsMsgRuleActionType)nsMsgFilterAction::DeleteFromPop3Server : (nsMsgRuleActionType)nsMsgFilterAction::LeaveOnPop3Server);</span>
<a href="#l11.47"></a><span id="l11.47">         if (NS_SUCCEEDED(rv) &amp;&amp; bFetch)</span>
<a href="#l11.48"></a><span id="l11.48">           rv = AddAction(nsMsgFilterAction::FetchBodyFromPop3Server);</span>
<a href="#l11.49"></a><span id="l11.49">       }</span>
<a href="#l11.50"></a><span id="l11.50">       else if (strcmp(pLine, &quot;manual&quot;) == 0)</span>
<a href="#l11.51"></a><span id="l11.51">         ;// Just ignore manual as TB handles manual in a different way</span>
<a href="#l11.52"></a><span id="l11.52">       else if (strcmp(pLine, &quot;outgoing&quot;) == 0)</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-        m_errorLog += NS_LITERAL_STRING(&quot;- &quot;) + name + NS_LITERAL_STRING(&quot;: &quot;) + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_OUTGOING) + NS_LITERAL_STRING(&quot;\n&quot;) ;</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+      {</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;- &quot;);</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+        m_errorLog += name;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;: &quot;);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+        m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_OUTGOING);</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+      }</span>
<a href="#l11.61"></a><span id="l11.61">       else</span>
<a href="#l11.62"></a><span id="l11.62">       {</span>
<a href="#l11.63"></a><span id="l11.63">         nsAutoString unicodeLine;</span>
<a href="#l11.64"></a><span id="l11.64">         NS_CopyNativeToUnicode(nsCString(pLine), unicodeLine);</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-        m_errorLog += NS_LITERAL_STRING(&quot;- &quot;) + name + NS_LITERAL_STRING(&quot;: &quot;) + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_ACTION, unicodeLine.get()) + NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;- &quot;);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+        m_errorLog += name;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;: &quot;);</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+        m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_ACTION, unicodeLine.get());</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.71"></a><span id="l11.71">       }</span>
<a href="#l11.72"></a><span id="l11.72">     }</span>
<a href="#l11.73"></a><span id="l11.73">   }</span>
<a href="#l11.74"></a><span id="l11.74"> </span>
<a href="#l11.75"></a><span id="l11.75">   // Process the last filter</span>
<a href="#l11.76"></a><span id="l11.76">   if (!more &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l11.77"></a><span id="l11.77">     rv = FinalizeFilter();</span>
<a href="#l11.78"></a><span id="l11.78"> </span>
<a href="#l11.79"></a><span id="l11.79" class="difflineat">@@ -685,27 +700,37 @@ nsresult nsEudoraFilters::AddTerm(const </span>
<a href="#l11.80"></a><span id="l11.80">   nsCAutoString          arbitraryHeader;</span>
<a href="#l11.81"></a><span id="l11.81">   nsAutoString           unicodeHeader, unicodeVerb, unicodeValue;</span>
<a href="#l11.82"></a><span id="l11.82">   nsAutoString           filterTitle;</span>
<a href="#l11.83"></a><span id="l11.83"> </span>
<a href="#l11.84"></a><span id="l11.84">   NS_CopyNativeToUnicode(nsCString(pHeader), unicodeHeader);</span>
<a href="#l11.85"></a><span id="l11.85">   NS_CopyNativeToUnicode(nsCString(pVerb), unicodeVerb);</span>
<a href="#l11.86"></a><span id="l11.86">   NS_CopyNativeToUnicode(nsCString(pValue), unicodeValue);</span>
<a href="#l11.87"></a><span id="l11.87"> </span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-  filterTitle = NS_LITERAL_STRING(&quot;- &quot;) + unicodeHeader + NS_LITERAL_STRING(&quot; &quot;) + unicodeVerb + NS_LITERAL_STRING(&quot; &quot;) + unicodeValue + NS_LITERAL_STRING(&quot;: &quot;);</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+  filterTitle = NS_LITERAL_STRING(&quot;- &quot;);</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+  filterTitle += unicodeHeader;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+  filterTitle += NS_LITERAL_STRING(&quot; &quot;);</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+  filterTitle += unicodeVerb;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+  filterTitle += NS_LITERAL_STRING(&quot; &quot;);</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+  filterTitle += unicodeValue;</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+  filterTitle += NS_LITERAL_STRING(&quot;: &quot;);</span>
<a href="#l11.96"></a><span id="l11.96"> </span>
<a href="#l11.97"></a><span id="l11.97">   if (op &lt; 0)</span>
<a href="#l11.98"></a><span id="l11.98">   {</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-    m_errorLog += filterTitle + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_VERB, pVerb) + NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+    m_errorLog += filterTitle;</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+    m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_VERB, pVerb);</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+    m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.103"></a><span id="l11.103">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l11.104"></a><span id="l11.104">   }</span>
<a href="#l11.105"></a><span id="l11.105"> </span>
<a href="#l11.106"></a><span id="l11.106">   if (!pHeader || !*pHeader)</span>
<a href="#l11.107"></a><span id="l11.107">   {</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineminus">-    m_errorLog += filterTitle + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_EMPTY_HEADER) + NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+    m_errorLog += filterTitle;</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+    m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_EMPTY_HEADER);</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+    m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.112"></a><span id="l11.112">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l11.113"></a><span id="l11.113">   }</span>
<a href="#l11.114"></a><span id="l11.114"> </span>
<a href="#l11.115"></a><span id="l11.115">   if (negateVerb)</span>
<a href="#l11.116"></a><span id="l11.116">   {</span>
<a href="#l11.117"></a><span id="l11.117">     switch (op)</span>
<a href="#l11.118"></a><span id="l11.118">     {</span>
<a href="#l11.119"></a><span id="l11.119">       case nsMsgSearchOp::Contains:</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineat">@@ -714,27 +739,31 @@ nsresult nsEudoraFilters::AddTerm(const </span>
<a href="#l11.121"></a><span id="l11.121">         op++;</span>
<a href="#l11.122"></a><span id="l11.122">         break;</span>
<a href="#l11.123"></a><span id="l11.123">       case nsMsgSearchOp::DoesntContain:</span>
<a href="#l11.124"></a><span id="l11.124">       case nsMsgSearchOp::Isnt:</span>
<a href="#l11.125"></a><span id="l11.125">       case nsMsgSearchOp::IsntInAB:</span>
<a href="#l11.126"></a><span id="l11.126">         op--;</span>
<a href="#l11.127"></a><span id="l11.127">         break;</span>
<a href="#l11.128"></a><span id="l11.128">       default:</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-        m_errorLog += filterTitle + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_NEGATE_VERB, unicodeVerb.get()) + NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+        m_errorLog += filterTitle;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+        m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_NEGATE_VERB, unicodeVerb.get());</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+        m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.133"></a><span id="l11.133">         return NS_ERROR_INVALID_ARG;</span>
<a href="#l11.134"></a><span id="l11.134">     }</span>
<a href="#l11.135"></a><span id="l11.135">   }</span>
<a href="#l11.136"></a><span id="l11.136"> </span>
<a href="#l11.137"></a><span id="l11.137">   if (attrib &lt; 0)</span>
<a href="#l11.138"></a><span id="l11.138">   {</span>
<a href="#l11.139"></a><span id="l11.139">     // Can't handle other Eudora meta-headers (Any Header, Personality, Junk Score)</span>
<a href="#l11.140"></a><span id="l11.140">     if (*pHeader == *LDAQ)</span>
<a href="#l11.141"></a><span id="l11.141">     {</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineminus">-      m_errorLog += filterTitle + nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_META_HEADER, unicodeHeader.get()) + NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+      m_errorLog += filterTitle;</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+      m_errorLog += nsEudoraStringBundle::FormatString(EUDORAIMPORT_FILTERS_WARN_META_HEADER, unicodeHeader.get());</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+      m_errorLog += NS_LITERAL_STRING(&quot;\n&quot;);</span>
<a href="#l11.146"></a><span id="l11.146">       return NS_ERROR_INVALID_ARG;</span>
<a href="#l11.147"></a><span id="l11.147">     }</span>
<a href="#l11.148"></a><span id="l11.148"> </span>
<a href="#l11.149"></a><span id="l11.149">     // Arbitrary headers for filters don't like the colon at the end</span>
<a href="#l11.150"></a><span id="l11.150">     arbitraryHeader = pHeader;</span>
<a href="#l11.151"></a><span id="l11.151">     PRInt32 index = arbitraryHeader.FindChar(':');</span>
<a href="#l11.152"></a><span id="l11.152">     if (index &gt;= 0)</span>
<a href="#l11.153"></a><span id="l11.153">       arbitraryHeader.SetLength(index);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -45,20 +45,21 @@</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> */</span>
<a href="#l12.6"></a><span id="l12.6"> #ifdef MOZ_LOGGING</span>
<a href="#l12.7"></a><span id="l12.7"> // sorry, this has to be before the pre-compiled header</span>
<a href="#l12.8"></a><span id="l12.8"> #define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l12.9"></a><span id="l12.9"> #endif</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;nscore.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l12.17"></a><span id="l12.17"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-#include &quot;nsIComponentManager.h&quot;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l12.20"></a><span id="l12.20"> #include &quot;nsEudoraImport.h&quot;</span>
<a href="#l12.21"></a><span id="l12.21"> #include &quot;nsIMemory.h&quot;</span>
<a href="#l12.22"></a><span id="l12.22"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l12.23"></a><span id="l12.23"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l12.24"></a><span id="l12.24"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l12.25"></a><span id="l12.25"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l12.26"></a><span id="l12.26"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l12.27"></a><span id="l12.27"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineat">@@ -70,17 +71,16 @@</span>
<a href="#l12.29"></a><span id="l12.29"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l12.30"></a><span id="l12.30"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l12.31"></a><span id="l12.31"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l12.32"></a><span id="l12.32"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l12.33"></a><span id="l12.33"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l12.34"></a><span id="l12.34"> #include &quot;nsEudoraCompose.h&quot;</span>
<a href="#l12.35"></a><span id="l12.35"> #include &quot;nsEudoraSettings.h&quot;</span>
<a href="#l12.36"></a><span id="l12.36"> #include &quot;nsEudoraFilters.h&quot;</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l12.38"></a><span id="l12.38"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l12.39"></a><span id="l12.39"> #include &quot;nsIMsgTagService.h&quot;</span>
<a href="#l12.40"></a><span id="l12.40"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43"> #if defined(XP_WIN) || defined(XP_OS2)</span>
<a href="#l12.44"></a><span id="l12.44"> #include &quot;nsEudoraWin32.h&quot;</span>
<a href="#l12.45"></a><span id="l12.45"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -52,17 +52,16 @@</span>
<a href="#l13.4"></a><span id="l13.4"> #include &quot;nsEudoraMac.h&quot;</span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsEudoraImport.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;EudoraDebugLog.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsILocalFileMac.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> static NS_DEFINE_IID(kISupportsIID,      NS_ISUPPORTS_IID);</span>
<a href="#l13.20"></a><span id="l13.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -36,17 +36,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.5"></a><span id="l14.5">  *</span>
<a href="#l14.6"></a><span id="l14.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> #ifndef nsEudoraMac_h__</span>
<a href="#l14.9"></a><span id="l14.9"> #define nsEudoraMac_h__</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;nscore.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l14.14"></a><span id="l14.14"> #include &quot;nsIFile.h&quot;</span>
<a href="#l14.15"></a><span id="l14.15"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l14.16"></a><span id="l14.16"> #include &quot;nsEudoraMailbox.h&quot;</span>
<a href="#l14.17"></a><span id="l14.17"> #include &quot;nsEudoraAddress.h&quot;</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> #include &lt;CoreServices/CoreServices.h&gt;</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21"> class nsIImportService;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -34,17 +34,16 @@</span>
<a href="#l15.4"></a><span id="l15.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.5"></a><span id="l15.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.6"></a><span id="l15.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.7"></a><span id="l15.7">  *</span>
<a href="#l15.8"></a><span id="l15.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10"> #include &quot;msgCore.h&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13"> #include &quot;nsEudoraMailbox.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsEudoraCompose.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nspr.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsMailHeaders.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #include &quot;nsMsgLocalFolderHdrs.h&quot;</span>
<a href="#l15.20"></a><span id="l15.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -35,17 +35,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.5"></a><span id="l16.5">  *</span>
<a href="#l16.6"></a><span id="l16.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> #ifndef nsEudoraMailbox_h__</span>
<a href="#l16.9"></a><span id="l16.9"> #define nsEudoraMailbox_h__</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;nscore.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l16.14"></a><span id="l16.14"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l16.15"></a><span id="l16.15"> #include &quot;nsIFile.h&quot;</span>
<a href="#l16.16"></a><span id="l16.16"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l16.17"></a><span id="l16.17"> #include &quot;nsEudoraCompose.h&quot;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> class nsIOutputStream;</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21"> /////////////////////////////////////////////////////////////////////////////////////</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraSettings.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraSettings.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -40,17 +40,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> /*</span>
<a href="#l17.5"></a><span id="l17.5">   Eudora settings</span>
<a href="#l17.6"></a><span id="l17.6"> */</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l17.9"></a><span id="l17.9"> #include &quot;nscore.h&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #include &quot;nsEudoraSettings.h&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l17.14"></a><span id="l17.14"> #include &quot;EudoraDebugLog.h&quot;</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16"> #if defined(XP_WIN) || defined(XP_OS2)</span>
<a href="#l17.17"></a><span id="l17.17"> #include &quot;nsEudoraWin32.h&quot;</span>
<a href="#l17.18"></a><span id="l17.18"> #endif</span>
<a href="#l17.19"></a><span id="l17.19"> #ifdef XP_MACOSX</span>
<a href="#l17.20"></a><span id="l17.20"> #include &quot;nsEudoraMac.h&quot;</span>
<a href="#l17.21"></a><span id="l17.21"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -35,20 +35,19 @@</span>
<a href="#l18.4"></a><span id="l18.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.5"></a><span id="l18.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.6"></a><span id="l18.6">  *</span>
<a href="#l18.7"></a><span id="l18.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;prprf.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;prmem.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #include &quot;nsIURI.h&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> #define EUDORA_MSGS_URL       &quot;chrome://messenger/locale/eudoraImportMsgs.properties&quot;</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22"> nsIStringBundle *  nsEudoraStringBundle::m_pBundle = nsnull;</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24"> nsIStringBundle *nsEudoraStringBundle::GetStringBundle( void)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.h</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -34,17 +34,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.5"></a><span id="l19.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.6"></a><span id="l19.6">  *</span>
<a href="#l19.7"></a><span id="l19.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> #ifndef nsEudoraStringBundle_H__</span>
<a href="#l19.10"></a><span id="l19.10"> #define nsEudoraStringBundle_H__</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15"> class nsIStringBundle;</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17"> class nsEudoraStringBundle {</span>
<a href="#l19.18"></a><span id="l19.18"> public:</span>
<a href="#l19.19"></a><span id="l19.19">   static PRUnichar       *  GetStringByID(PRInt32 stringID);</span>
<a href="#l19.20"></a><span id="l19.20">   static void               GetStringByID(PRInt32 stringID, nsString&amp; result);</span>
<a href="#l19.21"></a><span id="l19.21">   static nsString           FormatString(PRInt32 stringID, ...);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -34,25 +34,24 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.5"></a><span id="l20.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.6"></a><span id="l20.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.7"></a><span id="l20.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.8"></a><span id="l20.8">  *</span>
<a href="#l20.9"></a><span id="l20.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l20.16"></a><span id="l20.16"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l20.17"></a><span id="l20.17"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l20.18"></a><span id="l20.18"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l20.19"></a><span id="l20.19"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l20.20"></a><span id="l20.20"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l20.22"></a><span id="l20.22"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l20.23"></a><span id="l20.23"> #include &quot;nsISmtpServer.h&quot;</span>
<a href="#l20.24"></a><span id="l20.24"> #include &quot;nsEudoraWin32.h&quot;</span>
<a href="#l20.25"></a><span id="l20.25"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l20.26"></a><span id="l20.26"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l20.27"></a><span id="l20.27"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l20.28"></a><span id="l20.28"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l20.29"></a><span id="l20.29"> #include &quot;nsEudoraImport.h&quot;</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineat">@@ -117,30 +116,27 @@ bool nsEudoraWin32::FindEudoraLocation( </span>
<a href="#l20.31"></a><span id="l20.31">   {</span>
<a href="#l20.32"></a><span id="l20.32">     // get the value of &quot;Current&quot;</span>
<a href="#l20.33"></a><span id="l20.33">     BYTE *pBytes = GetValueBytes( sKey, &quot;Current&quot;);</span>
<a href="#l20.34"></a><span id="l20.34">     if (pBytes)</span>
<a href="#l20.35"></a><span id="l20.35">     {</span>
<a href="#l20.36"></a><span id="l20.36">       nsCString str((const char *)pBytes);</span>
<a href="#l20.37"></a><span id="l20.37">       delete [] pBytes;</span>
<a href="#l20.38"></a><span id="l20.38"> </span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-      str.CompressWhitespace();</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+      MsgCompressWhitespace(str);</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42">       // Command line is Eudora mailfolder eudora.ini</span>
<a href="#l20.43"></a><span id="l20.43">       if (findIni)</span>
<a href="#l20.44"></a><span id="l20.44">       {</span>
<a href="#l20.45"></a><span id="l20.45">         // find the string coming after the last space</span>
<a href="#l20.46"></a><span id="l20.46">         PRInt32 index = str.RFind(&quot; &quot;);</span>
<a href="#l20.47"></a><span id="l20.47">         if (index != -1)</span>
<a href="#l20.48"></a><span id="l20.48">         {</span>
<a href="#l20.49"></a><span id="l20.49">           index++; // skip the space</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-          nsCString  path;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-          str.Mid( path, index, str.Length() - index);</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-          eudoraPath-&gt;InitWithNativePath(path);</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+          eudoraPath-&gt;InitWithNativePath(Substring(str, index));</span>
<a href="#l20.55"></a><span id="l20.55">           eudoraPath-&gt;IsFile( &amp;exists);</span>
<a href="#l20.56"></a><span id="l20.56">           if (exists)</span>
<a href="#l20.57"></a><span id="l20.57">             result = exists;</span>
<a href="#l20.58"></a><span id="l20.58">           else // it may just be the mailbox location....guess that there will be a eudora.ini file there</span>
<a href="#l20.59"></a><span id="l20.59">           {</span>
<a href="#l20.60"></a><span id="l20.60">             eudoraPath-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;eudora.ini&quot;));</span>
<a href="#l20.61"></a><span id="l20.61">             eudoraPath-&gt;IsFile( &amp;exists);</span>
<a href="#l20.62"></a><span id="l20.62">             result = exists;</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineat">@@ -165,20 +161,17 @@ bool nsEudoraWin32::FindEudoraLocation( </span>
<a href="#l20.64"></a><span id="l20.64">           while (str.CharAt( idx) == ' ') idx++;</span>
<a href="#l20.65"></a><span id="l20.65">           int endIdx = -1;</span>
<a href="#l20.66"></a><span id="l20.66">           if (str.CharAt( idx) == '&quot;')</span>
<a href="#l20.67"></a><span id="l20.67">             endIdx = str.FindChar( '&quot;', idx);</span>
<a href="#l20.68"></a><span id="l20.68">           else</span>
<a href="#l20.69"></a><span id="l20.69">             endIdx = str.FindChar( ' ', idx);</span>
<a href="#l20.70"></a><span id="l20.70">           if (endIdx != -1)</span>
<a href="#l20.71"></a><span id="l20.71">           {</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-            nsCString  path;</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-            str.Mid( path, idx, endIdx - idx);</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-            eudoraPath-&gt;InitWithNativePath(path);</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+            eudoraPath-&gt;InitWithNativePath(Substring(str, idx, endIdx - idx));</span>
<a href="#l20.77"></a><span id="l20.77"> </span>
<a href="#l20.78"></a><span id="l20.78">             if (NS_SUCCEEDED( eudoraPath-&gt;IsDirectory( &amp;exists)))</span>
<a href="#l20.79"></a><span id="l20.79">               result = exists;</span>
<a href="#l20.80"></a><span id="l20.80">           }</span>
<a href="#l20.81"></a><span id="l20.81">         }</span>
<a href="#l20.82"></a><span id="l20.82">       }</span>
<a href="#l20.83"></a><span id="l20.83">     } // if pBytes</span>
<a href="#l20.84"></a><span id="l20.84">     ::RegCloseKey( sKey);</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineat">@@ -293,18 +286,18 @@ nsresult nsEudoraWin32::IterateMailDir( </span>
<a href="#l20.86"></a><span id="l20.86"> </span>
<a href="#l20.87"></a><span id="l20.87">     if (NS_SUCCEEDED( rv))</span>
<a href="#l20.88"></a><span id="l20.88">     {</span>
<a href="#l20.89"></a><span id="l20.89">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l20.90"></a><span id="l20.90">       if (NS_SUCCEEDED( rv) &amp;&amp; !fName.IsEmpty())</span>
<a href="#l20.91"></a><span id="l20.91">       {</span>
<a href="#l20.92"></a><span id="l20.92">         if (fName.Length() &gt; 4)</span>
<a href="#l20.93"></a><span id="l20.93">         {</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-          fName.Right( ext, 4);</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-          fName.Left( name, fName.Length() - 4);</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineplus">+          ext = StringTail(fName, 4);</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineplus">+          name = StringHead(fName, fName.Length() - 4);</span>
<a href="#l20.98"></a><span id="l20.98">         }</span>
<a href="#l20.99"></a><span id="l20.99">         else</span>
<a href="#l20.100"></a><span id="l20.100">         {</span>
<a href="#l20.101"></a><span id="l20.101">           ext.Truncate();</span>
<a href="#l20.102"></a><span id="l20.102">           name = fName;</span>
<a href="#l20.103"></a><span id="l20.103">         }</span>
<a href="#l20.104"></a><span id="l20.104">         ToLowerCase(ext);</span>
<a href="#l20.105"></a><span id="l20.105">         if (ext.EqualsLiteral(&quot;.fol&quot;))</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineat">@@ -554,17 +547,17 @@ nsresult nsEudoraWin32::FindTOCFile( nsI</span>
<a href="#l20.107"></a><span id="l20.107">   if (NS_FAILED( rv))</span>
<a href="#l20.108"></a><span id="l20.108">     return( rv);</span>
<a href="#l20.109"></a><span id="l20.109">   rv = pMailFile-&gt;GetParent( ppTOCFile);</span>
<a href="#l20.110"></a><span id="l20.110">   if (NS_FAILED( rv))</span>
<a href="#l20.111"></a><span id="l20.111">     return( rv);</span>
<a href="#l20.112"></a><span id="l20.112"> </span>
<a href="#l20.113"></a><span id="l20.113">   nsCString  name;</span>
<a href="#l20.114"></a><span id="l20.114">   if ((leaf.Length() &gt; 4) &amp;&amp; (leaf.CharAt( leaf.Length() - 4) == '.'))</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineminus">-    leaf.Left( name, leaf.Length() - 4);</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineplus">+    name = StringHead(leaf, leaf.Length() - 4);</span>
<a href="#l20.117"></a><span id="l20.117">   else</span>
<a href="#l20.118"></a><span id="l20.118">     name = leaf;</span>
<a href="#l20.119"></a><span id="l20.119">   name.Append( &quot;.toc&quot;);</span>
<a href="#l20.120"></a><span id="l20.120">   rv = (*ppTOCFile)-&gt;AppendNative(name);</span>
<a href="#l20.121"></a><span id="l20.121">   if (NS_FAILED( rv))</span>
<a href="#l20.122"></a><span id="l20.122">     return( rv);</span>
<a href="#l20.123"></a><span id="l20.123"> </span>
<a href="#l20.124"></a><span id="l20.124">   bool    exists = false;</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineat">@@ -789,37 +782,31 @@ void nsEudoraWin32::GetServerAndUserName</span>
<a href="#l20.126"></a><span id="l20.126">   else</span>
<a href="#l20.127"></a><span id="l20.127">   {</span>
<a href="#l20.128"></a><span id="l20.128">     valSize = ::GetPrivateProfileString( pSection, &quot;POPAccount&quot;, &quot;&quot;, pBuff, kIniValueSize, pIni);</span>
<a href="#l20.129"></a><span id="l20.129">     if (valSize)</span>
<a href="#l20.130"></a><span id="l20.130">     {</span>
<a href="#l20.131"></a><span id="l20.131">       serverName = pBuff;</span>
<a href="#l20.132"></a><span id="l20.132">       idx = serverName.FindChar( '@');</span>
<a href="#l20.133"></a><span id="l20.133">       if (idx != -1)</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineminus">-      {</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineminus">-        serverName.Right( tStr, serverName.Length() - idx - 1);</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineminus">-        serverName = tStr;</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineminus">-      }</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineplus">+        serverName = Substring(serverName, idx + 1);</span>
<a href="#l20.139"></a><span id="l20.139">     }</span>
<a href="#l20.140"></a><span id="l20.140">   }</span>
<a href="#l20.141"></a><span id="l20.141">   valSize = ::GetPrivateProfileString( pSection, &quot;LoginName&quot;, &quot;&quot;, pBuff, kIniValueSize, pIni);</span>
<a href="#l20.142"></a><span id="l20.142">   if (valSize)</span>
<a href="#l20.143"></a><span id="l20.143">     userName = pBuff;</span>
<a href="#l20.144"></a><span id="l20.144">   else</span>
<a href="#l20.145"></a><span id="l20.145">   {</span>
<a href="#l20.146"></a><span id="l20.146">     valSize = ::GetPrivateProfileString( pSection, &quot;POPAccount&quot;, &quot;&quot;, pBuff, kIniValueSize, pIni);</span>
<a href="#l20.147"></a><span id="l20.147">     if (valSize)</span>
<a href="#l20.148"></a><span id="l20.148">     {</span>
<a href="#l20.149"></a><span id="l20.149">       userName = pBuff;</span>
<a href="#l20.150"></a><span id="l20.150">       idx = userName.FindChar( '@');</span>
<a href="#l20.151"></a><span id="l20.151">       if (idx != -1)</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineminus">-      {</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineminus">-        userName.Left( tStr, idx);</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineminus">-        userName = tStr;</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-      }</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+        userName.SetLength(idx);</span>
<a href="#l20.157"></a><span id="l20.157">     }</span>
<a href="#l20.158"></a><span id="l20.158">   }</span>
<a href="#l20.159"></a><span id="l20.159"> }</span>
<a href="#l20.160"></a><span id="l20.160"> </span>
<a href="#l20.161"></a><span id="l20.161"> void nsEudoraWin32::GetAccountName( const char *pSection, nsString&amp; str)</span>
<a href="#l20.162"></a><span id="l20.162"> {</span>
<a href="#l20.163"></a><span id="l20.163">   str.Truncate();</span>
<a href="#l20.164"></a><span id="l20.164"> </span>
<a href="#l20.165"></a><span id="l20.165" class="difflineat">@@ -827,27 +814,19 @@ void nsEudoraWin32::GetAccountName( cons</span>
<a href="#l20.166"></a><span id="l20.166"> </span>
<a href="#l20.167"></a><span id="l20.167">   if (s.LowerCaseEqualsLiteral(&quot;settings&quot;))</span>
<a href="#l20.168"></a><span id="l20.168">   {</span>
<a href="#l20.169"></a><span id="l20.169">     str.AssignLiteral(&quot;Eudora &quot;);</span>
<a href="#l20.170"></a><span id="l20.170">     str.Append(NS_ConvertASCIItoUTF16(pSection));</span>
<a href="#l20.171"></a><span id="l20.171">   }</span>
<a href="#l20.172"></a><span id="l20.172">   else</span>
<a href="#l20.173"></a><span id="l20.173">   {</span>
<a href="#l20.174"></a><span id="l20.174" class="difflineminus">-    nsCString tStr;</span>
<a href="#l20.175"></a><span id="l20.175" class="difflineminus">-    CopyASCIItoUTF16(pSection, str);</span>
<a href="#l20.176"></a><span id="l20.176" class="difflineminus">-    if (s.Length() &gt; 8)</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineminus">-    {</span>
<a href="#l20.178"></a><span id="l20.178" class="difflineminus">-      s.Left( tStr, 8);</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineminus">-      if (tStr.LowerCaseEqualsLiteral(&quot;persona-&quot;))</span>
<a href="#l20.180"></a><span id="l20.180" class="difflineminus">-      {</span>
<a href="#l20.181"></a><span id="l20.181" class="difflineminus">-        s.Right( tStr, s.Length() - 8);</span>
<a href="#l20.182"></a><span id="l20.182" class="difflineminus">-        CopyASCIItoUTF16(tStr, str);</span>
<a href="#l20.183"></a><span id="l20.183" class="difflineminus">-      }</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineminus">-    }</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineplus">+    str.AssignASCII(pSection);</span>
<a href="#l20.186"></a><span id="l20.186" class="difflineplus">+    if (StringBeginsWith(s, NS_LITERAL_CSTRING(&quot;persona-&quot;), nsCaseInsensitiveCStringComparator()))</span>
<a href="#l20.187"></a><span id="l20.187" class="difflineplus">+      CopyASCIItoUTF16(Substring(s, 8), str);</span>
<a href="#l20.188"></a><span id="l20.188">   }</span>
<a href="#l20.189"></a><span id="l20.189"> }</span>
<a href="#l20.190"></a><span id="l20.190"> </span>
<a href="#l20.191"></a><span id="l20.191"> </span>
<a href="#l20.192"></a><span id="l20.192"> bool nsEudoraWin32::BuildPOPAccount( nsIMsgAccountManager *accMgr, const char *pSection, const char *pIni, nsIMsgAccount **ppAccount)</span>
<a href="#l20.193"></a><span id="l20.193"> {</span>
<a href="#l20.194"></a><span id="l20.194">   if (ppAccount)</span>
<a href="#l20.195"></a><span id="l20.195">     *ppAccount = nsnull;</span>
<a href="#l20.196"></a><span id="l20.196" class="difflineat">@@ -1108,25 +1087,25 @@ nsresult nsEudoraWin32::GetAttachmentInf</span>
<a href="#l20.197"></a><span id="l20.197">     if (name.IsEmpty())</span>
<a href="#l20.198"></a><span id="l20.198">       return( NS_ERROR_FAILURE);</span>
<a href="#l20.199"></a><span id="l20.199">     if (name.Length() &gt; 4)</span>
<a href="#l20.200"></a><span id="l20.200">     {</span>
<a href="#l20.201"></a><span id="l20.201">       nsCString ext;</span>
<a href="#l20.202"></a><span id="l20.202">       PRInt32 idx = name.RFindChar( '.');</span>
<a href="#l20.203"></a><span id="l20.203">       if (idx != -1)</span>
<a href="#l20.204"></a><span id="l20.204">       {</span>
<a href="#l20.205"></a><span id="l20.205" class="difflineminus">-        name.Right( ext, name.Length() - idx);</span>
<a href="#l20.206"></a><span id="l20.206" class="difflineminus">-        GetMimeTypeFromExtension( ext, mimeType);</span>
<a href="#l20.207"></a><span id="l20.207" class="difflineplus">+        ext = Substring(name, idx);</span>
<a href="#l20.208"></a><span id="l20.208" class="difflineplus">+        GetMimeTypeFromExtension(ext, mimeType);</span>
<a href="#l20.209"></a><span id="l20.209">       }</span>
<a href="#l20.210"></a><span id="l20.210">     }</span>
<a href="#l20.211"></a><span id="l20.211">     if (mimeType.IsEmpty())</span>
<a href="#l20.212"></a><span id="l20.212">       mimeType = &quot;application/octet-stream&quot;;</span>
<a href="#l20.213"></a><span id="l20.213"> </span>
<a href="#l20.214"></a><span id="l20.214">     nsAutoString description;</span>
<a href="#l20.215"></a><span id="l20.215" class="difflineminus">-    rv = nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(), name, description);</span>
<a href="#l20.216"></a><span id="l20.216" class="difflineplus">+    rv = NS_CopyNativeToUnicode(name, description);</span>
<a href="#l20.217"></a><span id="l20.217">  </span>
<a href="#l20.218"></a><span id="l20.218">     if (NS_SUCCEEDED(rv))</span>
<a href="#l20.219"></a><span id="l20.219">       aAttachmentName = NS_ConvertUTF16toUTF8(description);</span>
<a href="#l20.220"></a><span id="l20.220">     else</span>
<a href="#l20.221"></a><span id="l20.221">       aAttachmentName = name;</span>
<a href="#l20.222"></a><span id="l20.222"> </span>
<a href="#l20.223"></a><span id="l20.223">     return( NS_OK);</span>
<a href="#l20.224"></a><span id="l20.224">   }</span>
<a href="#l20.225"></a><span id="l20.225" class="difflineat">@@ -1163,18 +1142,18 @@ bool nsEudoraWin32::FindMimeIniFile( nsI</span>
<a href="#l20.226"></a><span id="l20.226"> </span>
<a href="#l20.227"></a><span id="l20.227">     if (NS_SUCCEEDED( rv))</span>
<a href="#l20.228"></a><span id="l20.228">     {</span>
<a href="#l20.229"></a><span id="l20.229">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l20.230"></a><span id="l20.230">       if (NS_SUCCEEDED( rv) &amp;&amp; !fName.IsEmpty())</span>
<a href="#l20.231"></a><span id="l20.231">       {</span>
<a href="#l20.232"></a><span id="l20.232">         if (fName.Length() &gt; 4)</span>
<a href="#l20.233"></a><span id="l20.233">         {</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineminus">-          fName.Right( ext, 4);</span>
<a href="#l20.235"></a><span id="l20.235" class="difflineminus">-          fName.Left( name, fName.Length() - 4);</span>
<a href="#l20.236"></a><span id="l20.236" class="difflineplus">+          ext = StringTail(fName, 4);</span>
<a href="#l20.237"></a><span id="l20.237" class="difflineplus">+          name = StringHead(fName, fName.Length() - 4);</span>
<a href="#l20.238"></a><span id="l20.238">         }</span>
<a href="#l20.239"></a><span id="l20.239">         else</span>
<a href="#l20.240"></a><span id="l20.240">         {</span>
<a href="#l20.241"></a><span id="l20.241">           ext.Truncate();</span>
<a href="#l20.242"></a><span id="l20.242">           name = fName;</span>
<a href="#l20.243"></a><span id="l20.243">         }</span>
<a href="#l20.244"></a><span id="l20.244">         ToLowerCase(ext);</span>
<a href="#l20.245"></a><span id="l20.245">         if (ext.EqualsLiteral(&quot;.ini&quot;))</span>
<a href="#l20.246"></a><span id="l20.246" class="difflineat">@@ -1468,35 +1447,34 @@ nsresult nsEudoraWin32::FindAddressBooks</span>
<a href="#l20.247"></a><span id="l20.247">   }</span>
<a href="#l20.248"></a><span id="l20.248">   nsCString  dirs(pBuffer);</span>
<a href="#l20.249"></a><span id="l20.249">   delete [] pBuffer;</span>
<a href="#l20.250"></a><span id="l20.250">   dirs.Trim( kWhitespace);</span>
<a href="#l20.251"></a><span id="l20.251">   PRInt32  idx = 0;</span>
<a href="#l20.252"></a><span id="l20.252">   nsCString  currentDir;</span>
<a href="#l20.253"></a><span id="l20.253">   while ((idx = dirs.FindChar( ';')) != -1)</span>
<a href="#l20.254"></a><span id="l20.254">   {</span>
<a href="#l20.255"></a><span id="l20.255" class="difflineminus">-    dirs.Left( currentDir, idx);</span>
<a href="#l20.256"></a><span id="l20.256" class="difflineplus">+    currentDir = StringHead(dirs, idx);</span>
<a href="#l20.257"></a><span id="l20.257">     currentDir.Trim( kWhitespace);</span>
<a href="#l20.258"></a><span id="l20.258">     if (!currentDir.IsEmpty())</span>
<a href="#l20.259"></a><span id="l20.259">     {</span>
<a href="#l20.260"></a><span id="l20.260">       rv = file-&gt;InitWithNativePath(currentDir);</span>
<a href="#l20.261"></a><span id="l20.261">       exists = PR_FALSE;</span>
<a href="#l20.262"></a><span id="l20.262">       isDir = PR_FALSE;</span>
<a href="#l20.263"></a><span id="l20.263">       if (NS_SUCCEEDED( rv))</span>
<a href="#l20.264"></a><span id="l20.264">         rv = file-&gt;Exists( &amp;exists);</span>
<a href="#l20.265"></a><span id="l20.265">       if (NS_SUCCEEDED( rv) &amp;&amp; exists)</span>
<a href="#l20.266"></a><span id="l20.266">         rv = file-&gt;IsDirectory( &amp;isDir);</span>
<a href="#l20.267"></a><span id="l20.267">       if (exists &amp;&amp; isDir)</span>
<a href="#l20.268"></a><span id="l20.268">       {</span>
<a href="#l20.269"></a><span id="l20.269">         if (NS_FAILED( rv = ScanAddressDir(file, *ppArray, impSvc)))</span>
<a href="#l20.270"></a><span id="l20.270">           return( rv);</span>
<a href="#l20.271"></a><span id="l20.271">       }</span>
<a href="#l20.272"></a><span id="l20.272">     }</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineminus">-    dirs.Right( currentDir, dirs.Length() - idx - 1);</span>
<a href="#l20.274"></a><span id="l20.274" class="difflineminus">-    dirs = currentDir;</span>
<a href="#l20.275"></a><span id="l20.275" class="difflineplus">+    dirs = Substring(dirs, idx + 1);</span>
<a href="#l20.276"></a><span id="l20.276">     dirs.Trim( kWhitespace);</span>
<a href="#l20.277"></a><span id="l20.277">   }</span>
<a href="#l20.278"></a><span id="l20.278">   if (!dirs.IsEmpty())</span>
<a href="#l20.279"></a><span id="l20.279">   {</span>
<a href="#l20.280"></a><span id="l20.280">     rv = file-&gt;InitWithNativePath(dirs);</span>
<a href="#l20.281"></a><span id="l20.281">     exists = PR_FALSE;</span>
<a href="#l20.282"></a><span id="l20.282">     isDir = PR_FALSE;</span>
<a href="#l20.283"></a><span id="l20.283">     if (NS_SUCCEEDED( rv))</span>
<a href="#l20.284"></a><span id="l20.284" class="difflineat">@@ -1542,18 +1520,18 @@ nsresult nsEudoraWin32::ScanAddressDir( </span>
<a href="#l20.285"></a><span id="l20.285"> </span>
<a href="#l20.286"></a><span id="l20.286">     if (NS_SUCCEEDED( rv))</span>
<a href="#l20.287"></a><span id="l20.287">     {</span>
<a href="#l20.288"></a><span id="l20.288">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l20.289"></a><span id="l20.289">       if (NS_SUCCEEDED( rv) &amp;&amp; !fName.IsEmpty())</span>
<a href="#l20.290"></a><span id="l20.290">       {</span>
<a href="#l20.291"></a><span id="l20.291">         if (fName.Length() &gt; 4)</span>
<a href="#l20.292"></a><span id="l20.292">         {</span>
<a href="#l20.293"></a><span id="l20.293" class="difflineminus">-          fName.Right( ext, 4);</span>
<a href="#l20.294"></a><span id="l20.294" class="difflineminus">-          fName.Left( name, fName.Length() - 4);</span>
<a href="#l20.295"></a><span id="l20.295" class="difflineplus">+          ext = StringTail(fName, 4);</span>
<a href="#l20.296"></a><span id="l20.296" class="difflineplus">+          name = StringHead(fName, fName.Length() - 4);</span>
<a href="#l20.297"></a><span id="l20.297">         }</span>
<a href="#l20.298"></a><span id="l20.298">         else</span>
<a href="#l20.299"></a><span id="l20.299">         {</span>
<a href="#l20.300"></a><span id="l20.300">           ext.Truncate();</span>
<a href="#l20.301"></a><span id="l20.301">           name = fName;</span>
<a href="#l20.302"></a><span id="l20.302">         }</span>
<a href="#l20.303"></a><span id="l20.303">         ToLowerCase(ext);</span>
<a href="#l20.304"></a><span id="l20.304">         if (ext.EqualsLiteral(&quot;.txt&quot;))</span>
<a href="#l20.305"></a><span id="l20.305" class="difflineat">@@ -1587,22 +1565,19 @@ nsresult nsEudoraWin32::FoundAddressBook</span>
<a href="#l20.306"></a><span id="l20.306">   else {</span>
<a href="#l20.307"></a><span id="l20.307">     nsAutoString leaf;</span>
<a href="#l20.308"></a><span id="l20.308">     rv = file-&gt;GetLeafName(leaf);</span>
<a href="#l20.309"></a><span id="l20.309">     if (NS_FAILED( rv))</span>
<a href="#l20.310"></a><span id="l20.310">       return( rv);</span>
<a href="#l20.311"></a><span id="l20.311">     if (leaf.IsEmpty())</span>
<a href="#l20.312"></a><span id="l20.312">       return( NS_ERROR_FAILURE);</span>
<a href="#l20.313"></a><span id="l20.313">     nsString  tStr;</span>
<a href="#l20.314"></a><span id="l20.314" class="difflineminus">-    leaf.Right( tStr, 4);</span>
<a href="#l20.315"></a><span id="l20.315" class="difflineplus">+    tStr = StringTail(leaf, 4);</span>
<a href="#l20.316"></a><span id="l20.316">     if (tStr.LowerCaseEqualsLiteral(&quot;.txt&quot;)  || tStr.LowerCaseEqualsLiteral(&quot;.nnt&quot;))</span>
<a href="#l20.317"></a><span id="l20.317" class="difflineminus">-    {</span>
<a href="#l20.318"></a><span id="l20.318" class="difflineminus">-      leaf.Left( tStr, leaf.Length() - 4);</span>
<a href="#l20.319"></a><span id="l20.319" class="difflineminus">-      leaf = tStr;</span>
<a href="#l20.320"></a><span id="l20.320" class="difflineminus">-    }</span>
<a href="#l20.321"></a><span id="l20.321" class="difflineplus">+      leaf.SetLength(leaf.Length() - 4);</span>
<a href="#l20.322"></a><span id="l20.322">   }</span>
<a href="#l20.323"></a><span id="l20.323"> </span>
<a href="#l20.324"></a><span id="l20.324">   nsCOMPtr&lt;nsILocalFile&gt; fileLoc = do_QueryInterface(file, &amp;rv);</span>
<a href="#l20.325"></a><span id="l20.325">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.326"></a><span id="l20.326"> </span>
<a href="#l20.327"></a><span id="l20.327">   rv = impSvc-&gt;CreateNewABDescriptor( getter_AddRefs( desc));</span>
<a href="#l20.328"></a><span id="l20.328">   if (NS_SUCCEEDED( rv))</span>
<a href="#l20.329"></a><span id="l20.329">   {</span>
<a href="#l20.330"></a><span id="l20.330" class="difflineat">@@ -1631,46 +1606,41 @@ void nsEudoraWin32::ConvertPath( nsCStri</span>
<a href="#l20.331"></a><span id="l20.331">   nsCString  path;</span>
<a href="#l20.332"></a><span id="l20.332">   PRInt32    idx = 0;</span>
<a href="#l20.333"></a><span id="l20.333">   PRInt32    start = 0;</span>
<a href="#l20.334"></a><span id="l20.334">   nsCString  search;</span>
<a href="#l20.335"></a><span id="l20.335"> </span>
<a href="#l20.336"></a><span id="l20.336">   idx = str.FindChar( '\\', idx);</span>
<a href="#l20.337"></a><span id="l20.337">   if ((idx == 2) &amp;&amp; (str.CharAt( 1) == ':'))</span>
<a href="#l20.338"></a><span id="l20.338">   {</span>
<a href="#l20.339"></a><span id="l20.339" class="difflineminus">-    str.Left( path, 3);</span>
<a href="#l20.340"></a><span id="l20.340" class="difflineplus">+    path = StringHead(str, 3);</span>
<a href="#l20.341"></a><span id="l20.341">     idx++;</span>
<a href="#l20.342"></a><span id="l20.342">     idx = str.FindChar( '\\', idx);</span>
<a href="#l20.343"></a><span id="l20.343">     start = 3;</span>
<a href="#l20.344"></a><span id="l20.344">     if ((idx == -1) &amp;&amp; (str.Length() &gt; 3))</span>
<a href="#l20.345"></a><span id="l20.345" class="difflineminus">-    {</span>
<a href="#l20.346"></a><span id="l20.346" class="difflineminus">-      str.Right( temp, str.Length() - start);</span>
<a href="#l20.347"></a><span id="l20.347" class="difflineminus">-      path.Append( temp);</span>
<a href="#l20.348"></a><span id="l20.348" class="difflineminus">-    }</span>
<a href="#l20.349"></a><span id="l20.349" class="difflineplus">+      path.Append(Substring(str, start));</span>
<a href="#l20.350"></a><span id="l20.350">   }</span>
<a href="#l20.351"></a><span id="l20.351"> </span>
<a href="#l20.352"></a><span id="l20.352">   WIN32_FIND_DATA findFileData;</span>
<a href="#l20.353"></a><span id="l20.353">   while (idx != -1)</span>
<a href="#l20.354"></a><span id="l20.354">   {</span>
<a href="#l20.355"></a><span id="l20.355" class="difflineminus">-    str.Mid( temp, start, idx - start);</span>
<a href="#l20.356"></a><span id="l20.356">     search = path;</span>
<a href="#l20.357"></a><span id="l20.357" class="difflineminus">-    search.Append( temp);</span>
<a href="#l20.358"></a><span id="l20.358" class="difflineplus">+    search.Append(Substring(str, start, idx - start));</span>
<a href="#l20.359"></a><span id="l20.359">     HANDLE h = FindFirstFile( search.get(), &amp;findFileData);</span>
<a href="#l20.360"></a><span id="l20.360">     if (h == INVALID_HANDLE_VALUE)</span>
<a href="#l20.361"></a><span id="l20.361">       return;</span>
<a href="#l20.362"></a><span id="l20.362">     path.Append( findFileData.cFileName);</span>
<a href="#l20.363"></a><span id="l20.363">     idx++;</span>
<a href="#l20.364"></a><span id="l20.364">     start = idx;</span>
<a href="#l20.365"></a><span id="l20.365">     idx = str.FindChar( '\\', idx);</span>
<a href="#l20.366"></a><span id="l20.366">     FindClose( h);</span>
<a href="#l20.367"></a><span id="l20.367">     if (idx != -1)</span>
<a href="#l20.368"></a><span id="l20.368">       path.Append( '\\');</span>
<a href="#l20.369"></a><span id="l20.369">     else</span>
<a href="#l20.370"></a><span id="l20.370">     {</span>
<a href="#l20.371"></a><span id="l20.371" class="difflineminus">-      str.Right( temp, str.Length() - start);</span>
<a href="#l20.372"></a><span id="l20.372">       path.Append( '\\');</span>
<a href="#l20.373"></a><span id="l20.373" class="difflineminus">-      path.Append( temp);</span>
<a href="#l20.374"></a><span id="l20.374" class="difflineplus">+      path.Append(Substring(str, start));</span>
<a href="#l20.375"></a><span id="l20.375">     }</span>
<a href="#l20.376"></a><span id="l20.376">   }</span>
<a href="#l20.377"></a><span id="l20.377"> </span>
<a href="#l20.378"></a><span id="l20.378">   str = path;</span>
<a href="#l20.379"></a><span id="l20.379"> }</span>
<a href="#l20.380"></a><span id="l20.380"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -36,17 +36,17 @@</span>
<a href="#l21.4"></a><span id="l21.4">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.5"></a><span id="l21.5">  *</span>
<a href="#l21.6"></a><span id="l21.6">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> #ifndef nsEudoraWin32_h__</span>
<a href="#l21.9"></a><span id="l21.9"> #define nsEudoraWin32_h__</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> #include &quot;nscore.h&quot;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l21.14"></a><span id="l21.14"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l21.15"></a><span id="l21.15"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l21.16"></a><span id="l21.16"> #include &quot;nsEudoraMailbox.h&quot;</span>
<a href="#l21.17"></a><span id="l21.17"> #include &quot;nsEudoraAddress.h&quot;</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19"> #include &lt;windows.h&gt;</span>
<a href="#l21.20"></a><span id="l21.20"> </span>
<a href="#l21.21"></a><span id="l21.21"> class nsIImportService;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/import/oexpress/WabObject.h</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/import/oexpress/WabObject.h</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -35,17 +35,17 @@</span>
<a href="#l22.4"></a><span id="l22.4">  *</span>
<a href="#l22.5"></a><span id="l22.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> #ifndef WabObject_h___</span>
<a href="#l22.8"></a><span id="l22.8"> #define WabObject_h___</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nscore.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;prtypes.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l22.14"></a><span id="l22.14"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16"> #include &lt;windows.h&gt;</span>
<a href="#l22.17"></a><span id="l22.17"> #include &lt;wab.h&gt;</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20"> class CWabIterator {</span>
<a href="#l22.21"></a><span id="l22.21"> public:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOE5File.h</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOE5File.h</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -33,17 +33,17 @@</span>
<a href="#l23.4"></a><span id="l23.4">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l23.5"></a><span id="l23.5">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l23.6"></a><span id="l23.6">  *</span>
<a href="#l23.7"></a><span id="l23.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9"> #ifndef nsOE5File_h___</span>
<a href="#l23.10"></a><span id="l23.10"> #define nsOE5File_h___</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l23.14"></a><span id="l23.14"> #include &quot;nsIFile.h&quot;</span>
<a href="#l23.15"></a><span id="l23.15"> #include &lt;windows.h&gt;</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17"> class nsIInputStream;</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19"> class nsOE5File</span>
<a href="#l23.20"></a><span id="l23.20"> {</span>
<a href="#l23.21"></a><span id="l23.21"> public:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEAddressIterator.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEAddressIterator.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -39,19 +39,19 @@</span>
<a href="#l24.4"></a><span id="l24.4"> /*</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">   A sample of XPConnect. This file contains an implementation of</span>
<a href="#l24.7"></a><span id="l24.7">   nsISample.</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> */</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nscore.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-#include &quot;nsIComponentManager.h&quot;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l24.18"></a><span id="l24.18"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l24.19"></a><span id="l24.19"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l24.20"></a><span id="l24.20"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l24.21"></a><span id="l24.21"> #include &quot;nsABBaseCID.h&quot;</span>
<a href="#l24.22"></a><span id="l24.22"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l24.23"></a><span id="l24.23"> #include &quot;prprf.h&quot;</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25"> #include &quot;nsOEAddressIterator.h&quot;</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineat">@@ -252,39 +252,34 @@ nsresult nsOEAddressIterator::EnumList( </span>
<a href="#l24.27"></a><span id="l24.27">   } while (SUCCEEDED(hr) &amp;&amp; cNumRows &amp;&amp; lpRowAB);</span>
<a href="#l24.28"></a><span id="l24.28"> </span>
<a href="#l24.29"></a><span id="l24.29">   m_database-&gt;SetListAddressTotal(listRow, numListElems);</span>
<a href="#l24.30"></a><span id="l24.30">   return rv;</span>
<a href="#l24.31"></a><span id="l24.31"> }</span>
<a href="#l24.32"></a><span id="l24.32"> </span>
<a href="#l24.33"></a><span id="l24.33"> void nsOEAddressIterator::SanitizeValue( nsString&amp; val)</span>
<a href="#l24.34"></a><span id="l24.34"> {</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-  val.ReplaceSubstring(NS_LITERAL_STRING(&quot;\x0D\x0A&quot;).get(),</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-                         NS_LITERAL_STRING(&quot;, &quot;).get());</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  val.ReplaceChar( 13, ',');</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-  val.ReplaceChar( 10, ',');</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+  MsgReplaceSubstring(val, NS_LITERAL_STRING(&quot;\r\n&quot;), NS_LITERAL_STRING(&quot;, &quot;));</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+  MsgReplaceChar(val, &quot;\r\n&quot;, ',');</span>
<a href="#l24.41"></a><span id="l24.41"> }</span>
<a href="#l24.42"></a><span id="l24.42"> </span>
<a href="#l24.43"></a><span id="l24.43"> void nsOEAddressIterator::SplitString( nsString&amp; val1, nsString&amp; val2)</span>
<a href="#l24.44"></a><span id="l24.44"> {</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-  nsString  temp;</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-  </span>
<a href="#l24.47"></a><span id="l24.47">   // Find the last line if there is more than one!</span>
<a href="#l24.48"></a><span id="l24.48">   PRInt32 idx = val1.RFind( &quot;\x0D\x0A&quot;);</span>
<a href="#l24.49"></a><span id="l24.49">   PRInt32  cnt = 2;</span>
<a href="#l24.50"></a><span id="l24.50">   if (idx == -1) {</span>
<a href="#l24.51"></a><span id="l24.51">     cnt = 1;</span>
<a href="#l24.52"></a><span id="l24.52">     idx = val1.RFindChar( 13);</span>
<a href="#l24.53"></a><span id="l24.53">   }</span>
<a href="#l24.54"></a><span id="l24.54">   if (idx == -1)</span>
<a href="#l24.55"></a><span id="l24.55">     idx= val1.RFindChar( 10);</span>
<a href="#l24.56"></a><span id="l24.56">   if (idx != -1) {</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-    val1.Right( val2, val1.Length() - idx - cnt);</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineminus">-    val1.Left( temp, idx);</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineminus">-    val1 = temp;</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+    val2 = Substring(val1, idx + cnt);</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+    val1.SetLength(idx);</span>
<a href="#l24.62"></a><span id="l24.62">     SanitizeValue( val1);</span>
<a href="#l24.63"></a><span id="l24.63">   }</span>
<a href="#l24.64"></a><span id="l24.64"> }</span>
<a href="#l24.65"></a><span id="l24.65"> </span>
<a href="#l24.66"></a><span id="l24.66"> void nsOEAddressIterator::SetBirthDay(nsIMdbRow *newRow, PRTime&amp; birthDay)</span>
<a href="#l24.67"></a><span id="l24.67"> {</span>
<a href="#l24.68"></a><span id="l24.68">   PRExplodedTime exploded;</span>
<a href="#l24.69"></a><span id="l24.69">   PR_ExplodeTime(birthDay, PR_LocalTimeParameters, &amp;exploded);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -43,19 +43,19 @@</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5"> */</span>
<a href="#l25.6"></a><span id="l25.6"> #ifdef MOZ_LOGGING</span>
<a href="#l25.7"></a><span id="l25.7"> // sorry, this has to be before the pre-compiled header</span>
<a href="#l25.8"></a><span id="l25.8"> #define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l25.9"></a><span id="l25.9"> #endif</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11"> #include &quot;nscore.h&quot;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-#include &quot;nsReadableUtils.h&quot;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l25.18"></a><span id="l25.18"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l25.19"></a><span id="l25.19"> #include &quot;nsOEImport.h&quot;</span>
<a href="#l25.20"></a><span id="l25.20"> #include &quot;nsIMemory.h&quot;</span>
<a href="#l25.21"></a><span id="l25.21"> #include &quot;nsOEScanBoxes.h&quot;</span>
<a href="#l25.22"></a><span id="l25.22"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l25.23"></a><span id="l25.23"> #include &quot;nsIImportMail.h&quot;</span>
<a href="#l25.24"></a><span id="l25.24"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l25.25"></a><span id="l25.25"> #include &quot;nsIImportGeneric.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -44,17 +44,23 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #include &quot;nsOERegUtil.h&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> #include &quot;nsOE5File.h&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l26.7"></a><span id="l26.7"> #include &quot;OEDebugLog.h&quot;</span>
<a href="#l26.8"></a><span id="l26.8"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;plstr.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l26.13"></a><span id="l26.13"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+#else</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+#define NS_CopyNativeToUnicode(source, dest) \</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+        nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(), source, dest)</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+#endif</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20"> /*</span>
<a href="#l26.21"></a><span id="l26.21">   .nch file format???</span>
<a href="#l26.22"></a><span id="l26.22"> </span>
<a href="#l26.23"></a><span id="l26.23">   offset 20 - long = offset to first record</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25"> */</span>
<a href="#l26.26"></a><span id="l26.26"> </span>
<a href="#l26.27"></a><span id="l26.27" class="difflineat">@@ -243,18 +249,16 @@ bool nsOEScanBoxes::FindMailBoxes( nsIFi</span>
<a href="#l26.28"></a><span id="l26.28">   // Now for each record</span>
<a href="#l26.29"></a><span id="l26.29">   bool        done = false;</span>
<a href="#l26.30"></a><span id="l26.30">   PRUint32    equal;</span>
<a href="#l26.31"></a><span id="l26.31">   PRUint32    size;</span>
<a href="#l26.32"></a><span id="l26.32">   PRUint32    previous;</span>
<a href="#l26.33"></a><span id="l26.33">   PRUint32    next;</span>
<a href="#l26.34"></a><span id="l26.34">   MailboxEntry *  pEntry;</span>
<a href="#l26.35"></a><span id="l26.35">   bool        failed;</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-  nsCString    ext;</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-  nsCString    mbxExt( &quot;.mbx&quot;);</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">   while (!done) {</span>
<a href="#l26.40"></a><span id="l26.40"> </span>
<a href="#l26.41"></a><span id="l26.41">     if (!ReadLong( descInputStream, equal, curRec)) return( PR_FALSE);</span>
<a href="#l26.42"></a><span id="l26.42">     if (curRec != equal) {</span>
<a href="#l26.43"></a><span id="l26.43">       IMPORT_LOG1( &quot;Record start invalid: %ld\n&quot;, curRec);</span>
<a href="#l26.44"></a><span id="l26.44">       break;</span>
<a href="#l26.45"></a><span id="l26.45">     }</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineat">@@ -278,18 +282,17 @@ bool nsOEScanBoxes::FindMailBoxes( nsIFi</span>
<a href="#l26.47"></a><span id="l26.47">     #ifdef _TRACE_MAILBOX_ENTRIES</span>
<a href="#l26.48"></a><span id="l26.48">     IMPORT_LOG0( &quot;------------\n&quot;);</span>
<a href="#l26.49"></a><span id="l26.49">     IMPORT_LOG2( &quot;    Offset: %lx, index: %ld\n&quot;, curRec, pEntry-&gt;index);</span>
<a href="#l26.50"></a><span id="l26.50">     IMPORT_LOG2( &quot;      previous: %lx, next: %lx\n&quot;, previous, next);</span>
<a href="#l26.51"></a><span id="l26.51">     IMPORT_LOG2( &quot;      Name: %S, File: %s\n&quot;, (PRUnichar *) pEntry-&gt;mailName, (const char *) pEntry-&gt;fileName);</span>
<a href="#l26.52"></a><span id="l26.52">     IMPORT_LOG3( &quot;      Parent: %ld, Child: %ld, Sibling: %ld\n&quot;, pEntry-&gt;parent, pEntry-&gt;child, pEntry-&gt;sibling);</span>
<a href="#l26.53"></a><span id="l26.53">     #endif</span>
<a href="#l26.54"></a><span id="l26.54"> </span>
<a href="#l26.55"></a><span id="l26.55" class="difflineminus">-    pEntry-&gt;fileName.Right( ext, 4);</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineminus">-    if (!ext.Equals(mbxExt))</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+    if (!StringEndsWith(pEntry-&gt;fileName, NS_LITERAL_CSTRING(&quot;.mbx&quot;)))</span>
<a href="#l26.58"></a><span id="l26.58">       pEntry-&gt;fileName.Append( &quot;.mbx&quot;);</span>
<a href="#l26.59"></a><span id="l26.59"> </span>
<a href="#l26.60"></a><span id="l26.60">     m_entryArray.AppendElement( pEntry);</span>
<a href="#l26.61"></a><span id="l26.61"> </span>
<a href="#l26.62"></a><span id="l26.62">     curRec = next;</span>
<a href="#l26.63"></a><span id="l26.63">     if (!next)</span>
<a href="#l26.64"></a><span id="l26.64">       done = PR_TRUE;</span>
<a href="#l26.65"></a><span id="l26.65">   }</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineat">@@ -870,17 +873,17 @@ bool nsOEScanBoxes::ReadString( nsIInput</span>
<a href="#l26.67"></a><span id="l26.67">   PRUint32 cntRead;</span>
<a href="#l26.68"></a><span id="l26.68">   char buffer[kOutlookExpressStringLength];</span>
<a href="#l26.69"></a><span id="l26.69">   char * pReadTo = buffer;</span>
<a href="#l26.70"></a><span id="l26.70">   rv = stream-&gt;Read( pReadTo, kOutlookExpressStringLength, &amp;cntRead);</span>
<a href="#l26.71"></a><span id="l26.71"> </span>
<a href="#l26.72"></a><span id="l26.72">   if (NS_FAILED( rv) || (cntRead != kOutlookExpressStringLength))</span>
<a href="#l26.73"></a><span id="l26.73">     return( PR_FALSE);</span>
<a href="#l26.74"></a><span id="l26.74">   buffer[kOutlookExpressStringLength - 1] = 0;</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineminus">-  CopyASCIItoUTF16(buffer, str);</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+  str.AssignASCII(buffer);</span>
<a href="#l26.77"></a><span id="l26.77">   return( PR_TRUE);</span>
<a href="#l26.78"></a><span id="l26.78"> }</span>
<a href="#l26.79"></a><span id="l26.79"> </span>
<a href="#l26.80"></a><span id="l26.80"> bool nsOEScanBoxes::ReadString( nsIInputStream * stream, nsCString&amp; str, PRUint32 offset)</span>
<a href="#l26.81"></a><span id="l26.81"> {</span>
<a href="#l26.82"></a><span id="l26.82">   nsresult  rv;</span>
<a href="#l26.83"></a><span id="l26.83">         nsCOMPtr &lt;nsISeekableStream&gt; seekStream = do_QueryInterface(stream, &amp;rv);</span>
<a href="#l26.84"></a><span id="l26.84">         NS_ENSURE_SUCCESS(rv, PR_FALSE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiApi.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -189,17 +189,17 @@ BOOL CMapiApi::GetRTFPropertyDecodedAsUT</span>
<a href="#l27.4"></a><span id="l27.4">         nativeBodyType = MAPI_NATIVE_BODY_TYPE_HTML;</span>
<a href="#l27.5"></a><span id="l27.5">       else if (decoder.mode() == CRTFMailDecoder::mText)</span>
<a href="#l27.6"></a><span id="l27.6">         nativeBodyType = MAPI_NATIVE_BODY_TYPE_PLAINTEXT;</span>
<a href="#l27.7"></a><span id="l27.7">       else</span>
<a href="#l27.8"></a><span id="l27.8">         nativeBodyType = MAPI_NATIVE_BODY_TYPE_RTF;</span>
<a href="#l27.9"></a><span id="l27.9">       val.Assign(decoder.text(), decoder.textSize());</span>
<a href="#l27.10"></a><span id="l27.10">     }</span>
<a href="#l27.11"></a><span id="l27.11">     else { // WrapCompressedRTFStreamEx available and original type is not rtf</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-      CopyUTF8toUTF16(streamData.c_str(), val);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+      CopyUTF8toUTF16(nsDependentCString(streamData.c_str()), val);</span>
<a href="#l27.14"></a><span id="l27.14">     }</span>
<a href="#l27.15"></a><span id="l27.15">     return TRUE;</span>
<a href="#l27.16"></a><span id="l27.16">   }</span>
<a href="#l27.17"></a><span id="l27.17">   return FALSE;</span>
<a href="#l27.18"></a><span id="l27.18"> }</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20"> void CMapiApi::MAPIUninitialize(void)</span>
<a href="#l27.21"></a><span id="l27.21"> {</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -1268,17 +1268,17 @@ BOOL CMapiApi::GetLargeProperty( LPMAPIP</span>
<a href="#l27.23"></a><span id="l27.23"> }</span>
<a href="#l27.24"></a><span id="l27.24"> </span>
<a href="#l27.25"></a><span id="l27.25"> BOOL CMapiApi::GetLargeStringProperty( LPMAPIPROP pProp, ULONG tag, nsCString&amp; val)</span>
<a href="#l27.26"></a><span id="l27.26"> {</span>
<a href="#l27.27"></a><span id="l27.27">   void* result;</span>
<a href="#l27.28"></a><span id="l27.28">   if (!GetLargeProperty(pProp, tag, &amp;result))</span>
<a href="#l27.29"></a><span id="l27.29">     return FALSE;</span>
<a href="#l27.30"></a><span id="l27.30">   if (PROP_TYPE(tag) == PT_UNICODE) // unicode string</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-    LossyCopyUTF16toASCII(static_cast&lt;wchar_t*&gt;(result), val);</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+    LossyCopyUTF16toASCII(nsDependentString(static_cast&lt;wchar_t*&gt;(result)), val);</span>
<a href="#l27.33"></a><span id="l27.33">   else // either PT_STRING8 or some other binary - use as is</span>
<a href="#l27.34"></a><span id="l27.34">     val.Assign(static_cast&lt;char*&gt;(result));</span>
<a href="#l27.35"></a><span id="l27.35">   delete[] result;</span>
<a href="#l27.36"></a><span id="l27.36">   return TRUE;</span>
<a href="#l27.37"></a><span id="l27.37"> }</span>
<a href="#l27.38"></a><span id="l27.38"> </span>
<a href="#l27.39"></a><span id="l27.39"> BOOL CMapiApi::GetLargeStringProperty(LPMAPIPROP pProp, ULONG tag, nsString&amp; val)</span>
<a href="#l27.40"></a><span id="l27.40"> {</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineat">@@ -1320,17 +1320,17 @@ BOOL CMapiApi::GetEntryIdFromProp(LPSPro</span>
<a href="#l27.42"></a><span id="l27.42"> }</span>
<a href="#l27.43"></a><span id="l27.43"> </span>
<a href="#l27.44"></a><span id="l27.44"> BOOL CMapiApi::GetStringFromProp( LPSPropValue pVal, nsCString&amp; val, BOOL delVal)</span>
<a href="#l27.45"></a><span id="l27.45"> {</span>
<a href="#l27.46"></a><span id="l27.46">   BOOL bResult = TRUE;</span>
<a href="#l27.47"></a><span id="l27.47">   if ( pVal &amp;&amp; (PROP_TYPE( pVal-&gt;ulPropTag) == PT_STRING8))</span>
<a href="#l27.48"></a><span id="l27.48">     val = pVal-&gt;Value.lpszA;</span>
<a href="#l27.49"></a><span id="l27.49">   else if ( pVal &amp;&amp; (PROP_TYPE( pVal-&gt;ulPropTag) == PT_UNICODE))</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-    LossyCopyUTF16toASCII((PRUnichar *) pVal-&gt;Value.lpszW, val);</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+    LossyCopyUTF16toASCII(nsDependentString(pVal-&gt;Value.lpszW), val);</span>
<a href="#l27.52"></a><span id="l27.52">   else if (pVal &amp;&amp; (PROP_TYPE( pVal-&gt;ulPropTag) == PT_NULL))</span>
<a href="#l27.53"></a><span id="l27.53">     val.Truncate();</span>
<a href="#l27.54"></a><span id="l27.54">   else if (pVal &amp;&amp; (PROP_TYPE( pVal-&gt;ulPropTag) == PT_ERROR)) {</span>
<a href="#l27.55"></a><span id="l27.55">     val.Truncate();</span>
<a href="#l27.56"></a><span id="l27.56">     bResult = FALSE;</span>
<a href="#l27.57"></a><span id="l27.57">   }</span>
<a href="#l27.58"></a><span id="l27.58">   else {</span>
<a href="#l27.59"></a><span id="l27.59">     if (pVal) {</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineat">@@ -1517,54 +1517,31 @@ void CMapiApi::GetPropTagName( ULONG tag</span>
<a href="#l27.61"></a><span id="l27.61">     case PT_MV_UNICODE: s += &quot;PT_MV_UNICODE&quot;; break;</span>
<a href="#l27.62"></a><span id="l27.62">     case PT_MV_CLSID: s += &quot;PT_MV_CLSID&quot;; break;</span>
<a href="#l27.63"></a><span id="l27.63">     case PT_MV_I8: s += &quot;PT_MV_I8&quot;; break;</span>
<a href="#l27.64"></a><span id="l27.64">     default:</span>
<a href="#l27.65"></a><span id="l27.65">       s += &quot;Unknown&quot;;</span>
<a href="#l27.66"></a><span id="l27.66">   }</span>
<a href="#l27.67"></a><span id="l27.67"> }</span>
<a href="#l27.68"></a><span id="l27.68"> </span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-void ReplaceEolChars( nsCString&amp; s)</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineminus">-{</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineminus">-  int        idx;</span>
<a href="#l27.72"></a><span id="l27.72" class="difflineminus">-  nsCString    t;</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineminus">-  nsCString    rt;</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineminus">-</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-  while ((idx = s.Find( &quot;\x0D&quot;)) != -1) {</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-    s.Left( t, idx);</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineminus">-    t += &quot;\\n&quot;;</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-    s.Right( rt, s.Length() - idx - 1);</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-    t += rt;</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-    s = t;</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineminus">-  }</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineminus">-  while ((idx = s.Find( &quot;\x0A&quot;)) != -1) {</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineminus">-    s.Left( t, idx);</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineminus">-    t += &quot;\\r&quot;;</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineminus">-    s.Right( rt, s.Length() - idx - 1);</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineminus">-    t += rt;</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineminus">-    s = t;</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineminus">-  }</span>
<a href="#l27.89"></a><span id="l27.89" class="difflineminus">-}</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineminus">-</span>
<a href="#l27.91"></a><span id="l27.91"> void CMapiApi::ListPropertyValue( LPSPropValue pVal, nsCString&amp; s)</span>
<a href="#l27.92"></a><span id="l27.92"> {</span>
<a href="#l27.93"></a><span id="l27.93">   nsCString    strVal;</span>
<a href="#l27.94"></a><span id="l27.94">   char      nBuff[64];</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineminus">-  nsCString    t;</span>
<a href="#l27.96"></a><span id="l27.96"> </span>
<a href="#l27.97"></a><span id="l27.97">   s += &quot;value: &quot;;</span>
<a href="#l27.98"></a><span id="l27.98">   switch (PROP_TYPE( pVal-&gt;ulPropTag)) {</span>
<a href="#l27.99"></a><span id="l27.99">     case PT_STRING8:</span>
<a href="#l27.100"></a><span id="l27.100">       GetStringFromProp( pVal, strVal, FALSE);</span>
<a href="#l27.101"></a><span id="l27.101">       if (strVal.Length() &gt; 60) {</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineminus">-        strVal.Left( t, 60);</span>
<a href="#l27.103"></a><span id="l27.103" class="difflineminus">-        strVal = t;</span>
<a href="#l27.104"></a><span id="l27.104" class="difflineplus">+        strVal.SetLength(60);</span>
<a href="#l27.105"></a><span id="l27.105">         strVal += &quot;...&quot;;</span>
<a href="#l27.106"></a><span id="l27.106">       }</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineminus">-      ReplaceEolChars( strVal);</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineplus">+      MsgReplaceSubstring(strVal, &quot;\r&quot;, &quot;\\r&quot;);</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+      MsgReplaceSubstring(strVal, &quot;\n&quot;, &quot;\\n&quot;);</span>
<a href="#l27.110"></a><span id="l27.110">       s += strVal;</span>
<a href="#l27.111"></a><span id="l27.111">     break;</span>
<a href="#l27.112"></a><span id="l27.112">     case PT_LONG:</span>
<a href="#l27.113"></a><span id="l27.113">       s.AppendInt( (PRInt32) pVal-&gt;Value.l);</span>
<a href="#l27.114"></a><span id="l27.114">       s += &quot;, 0x&quot;;</span>
<a href="#l27.115"></a><span id="l27.115">       s.AppendInt( (PRInt32) pVal-&gt;Value.l, 16);</span>
<a href="#l27.116"></a><span id="l27.116">       s += nBuff;</span>
<a href="#l27.117"></a><span id="l27.117">     break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -281,17 +281,17 @@ bool CMapiMessage::FetchHeaders( void)</span>
<a href="#l28.4"></a><span id="l28.4">       m_headers.Assign(headers.get());</span>
<a href="#l28.5"></a><span id="l28.5">     }</span>
<a href="#l28.6"></a><span id="l28.6">     else if ((PROP_TYPE(pVal-&gt;ulPropTag) == PT_STRING8) &amp;&amp;</span>
<a href="#l28.7"></a><span id="l28.7">              (pVal-&gt;Value.lpszA) &amp;&amp; (*(pVal-&gt;Value.lpszA)))</span>
<a href="#l28.8"></a><span id="l28.8">       m_headers.Assign(pVal-&gt;Value.lpszA);</span>
<a href="#l28.9"></a><span id="l28.9">     else if ((PROP_TYPE(pVal-&gt;ulPropTag) == PT_UNICODE) &amp;&amp;</span>
<a href="#l28.10"></a><span id="l28.10">              (pVal-&gt;Value.lpszW) &amp;&amp; (*(pVal-&gt;Value.lpszW))) {</span>
<a href="#l28.11"></a><span id="l28.11">       nsCString headers;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-      LossyCopyUTF16toASCII(pVal-&gt;Value.lpszW, headers);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+      LossyCopyUTF16toASCII(nsDependentString(pVal-&gt;Value.lpszW), headers);</span>
<a href="#l28.14"></a><span id="l28.14">       m_headers.Assign(headers.get());</span>
<a href="#l28.15"></a><span id="l28.15">     }</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17">     CMapiApi::MAPIFreeBuffer(pVal);</span>
<a href="#l28.18"></a><span id="l28.18">   }</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">   EnsureDate();</span>
<a href="#l28.21"></a><span id="l28.21">   if (!EnsureHeader(CMapiMessageHeaders::hdrFrom, PR_SENDER_NAME_W))</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -301,25 +301,16 @@ bool CMapiMessage::FetchHeaders( void)</span>
<a href="#l28.23"></a><span id="l28.23">   EnsureHeader(CMapiMessageHeaders::hdrCc, PR_DISPLAY_CC_W);</span>
<a href="#l28.24"></a><span id="l28.24">   EnsureHeader(CMapiMessageHeaders::hdrBcc, PR_DISPLAY_BCC_W);</span>
<a href="#l28.25"></a><span id="l28.25"> </span>
<a href="#l28.26"></a><span id="l28.26">   ProcessContentType();</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28">   return( !m_headers.IsEmpty());</span>
<a href="#l28.29"></a><span id="l28.29"> }</span>
<a href="#l28.30"></a><span id="l28.30"> </span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-bool CMapiMessage::IsMultipart( void) const</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-{</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-  nsCString left;</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-  m_mimeContentType.Left( left, 10);</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">-  if (left.LowerCaseEqualsLiteral(&quot;multipart/&quot;))</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-    return true;</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineminus">-  return false;</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineminus">-}</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-</span>
<a href="#l28.40"></a><span id="l28.40"> // Mime-Version: 1.0</span>
<a href="#l28.41"></a><span id="l28.41"> // Content-Type: text/plain; charset=&quot;US-ASCII&quot;</span>
<a href="#l28.42"></a><span id="l28.42"> // Content-Type: multipart/mixed; boundary=&quot;=====================_874475278==_&quot;</span>
<a href="#l28.43"></a><span id="l28.43"> </span>
<a href="#l28.44"></a><span id="l28.44"> void CMapiMessage::ProcessContentType()</span>
<a href="#l28.45"></a><span id="l28.45"> {</span>
<a href="#l28.46"></a><span id="l28.46">   m_mimeContentType.Truncate();</span>
<a href="#l28.47"></a><span id="l28.47">   m_mimeBoundary.Truncate();</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineat">@@ -727,17 +718,17 @@ bool CMapiMessage::FetchBody( void)</span>
<a href="#l28.49"></a><span id="l28.49">     // We'll use this as a hack to really use the plain text part.</span>
<a href="#l28.50"></a><span id="l28.50">     //</span>
<a href="#l28.51"></a><span id="l28.51">     // Sadly there are cases where this string is returned despite the fact</span>
<a href="#l28.52"></a><span id="l28.52">     // that the message is indeed HTML.</span>
<a href="#l28.53"></a><span id="l28.53">     //</span>
<a href="#l28.54"></a><span id="l28.54">     // To detect the &quot;true&quot; plain text messages, we look for our string</span>
<a href="#l28.55"></a><span id="l28.55">     // immediately following the &lt;BODY&gt; tag.</span>
<a href="#l28.56"></a><span id="l28.56">     if (!m_body.IsEmpty() &amp;&amp;</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-        m_body.Find(L&quot;&lt;BODY&gt;\r\n&lt;!-- Converted from text/plain format --&gt;&quot;) ==</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineplus">+        m_body.Find(&quot;&lt;BODY&gt;\r\n&lt;!-- Converted from text/plain format --&gt;&quot;) ==</span>
<a href="#l28.59"></a><span id="l28.59">         kNotFound) {</span>
<a href="#l28.60"></a><span id="l28.60">       m_bodyIsHtml = true;</span>
<a href="#l28.61"></a><span id="l28.61">     }</span>
<a href="#l28.62"></a><span id="l28.62">     else {</span>
<a href="#l28.63"></a><span id="l28.63">       pVal = CMapiApi::GetMapiProperty(m_lpMsg, PR_BODY_W);</span>
<a href="#l28.64"></a><span id="l28.64">       if (pVal) {</span>
<a href="#l28.65"></a><span id="l28.65">         if (CMapiApi::IsLargeProperty(pVal))</span>
<a href="#l28.66"></a><span id="l28.66">           CMapiApi::GetLargeStringProperty(m_lpMsg, PR_BODY_W, m_body);</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineat">@@ -1072,17 +1063,17 @@ bool CMapiMessage::AddAttachment(DWORD a</span>
<a href="#l28.68"></a><span id="l28.68">       pVal = CMapiApi::GetMapiProperty(lpAttach, PR_ATTACH_EXTENSION_W);</span>
<a href="#l28.69"></a><span id="l28.69">       CMapiApi::GetStringFromProp(pVal, fext);</span>
<a href="#l28.70"></a><span id="l28.70">       MAPI_TRACE2(&quot;\t\t\t--- File name: %s, extension: %s\r\n&quot;,</span>
<a href="#l28.71"></a><span id="l28.71">         fname.get(), fext.get());</span>
<a href="#l28.72"></a><span id="l28.72"> </span>
<a href="#l28.73"></a><span id="l28.73">       if (fext.IsEmpty()) {</span>
<a href="#l28.74"></a><span id="l28.74">         int idx = fname.RFindChar(L'.');</span>
<a href="#l28.75"></a><span id="l28.75">         if (idx != -1)</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-          fname.Right(fext, fname.Length() - idx);</span>
<a href="#l28.77"></a><span id="l28.77" class="difflineplus">+          fext = Substring(fname, idx);</span>
<a href="#l28.78"></a><span id="l28.78">       }</span>
<a href="#l28.79"></a><span id="l28.79">       else if (fname.RFindChar(L'.') == -1) {</span>
<a href="#l28.80"></a><span id="l28.80">         fname += L&quot;.&quot;;</span>
<a href="#l28.81"></a><span id="l28.81">         fname += fext;</span>
<a href="#l28.82"></a><span id="l28.82">       }</span>
<a href="#l28.83"></a><span id="l28.83">       if (fname.IsEmpty()) {</span>
<a href="#l28.84"></a><span id="l28.84">         // If no description use &quot;Attachment i&quot; format.</span>
<a href="#l28.85"></a><span id="l28.85">         fname = L&quot;Attachment &quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiMessage.h</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiMessage.h</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -212,17 +212,16 @@ public:</span>
<a href="#l29.4"></a><span id="l29.4">   inline const char *GetBodyCharset( void) const { return( m_mimeCharset.get());}</span>
<a href="#l29.5"></a><span id="l29.5">   inline bool IsRead() const { return m_msgFlags &amp; MSGFLAG_READ; }</span>
<a href="#l29.6"></a><span id="l29.6">   inline bool IsReplied() const {</span>
<a href="#l29.7"></a><span id="l29.7">     return (m_msgLastVerb == EXCHIVERB_REPLYTOSENDER) ||</span>
<a href="#l29.8"></a><span id="l29.8">            (m_msgLastVerb == EXCHIVERB_REPLYTOALL); }</span>
<a href="#l29.9"></a><span id="l29.9">   inline bool IsForvarded() const {</span>
<a href="#l29.10"></a><span id="l29.10">     return m_msgLastVerb == EXCHIVERB_FORWARD; }</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  bool    IsMultipart( void) const;</span>
<a href="#l29.13"></a><span id="l29.13">   bool    HasContentHeader( void) const {</span>
<a href="#l29.14"></a><span id="l29.14">     return( !m_mimeContentType.IsEmpty());}</span>
<a href="#l29.15"></a><span id="l29.15">   bool    HasMimeVersion( void) const {</span>
<a href="#l29.16"></a><span id="l29.16">     return m_headers.Value(CMapiMessageHeaders::hdrMimeVersion); }</span>
<a href="#l29.17"></a><span id="l29.17">   const char *GetMimeContent( void) const { return( m_mimeContentType.get());}</span>
<a href="#l29.18"></a><span id="l29.18">   PRInt32     GetMimeContentLen( void) const { return( m_mimeContentType.Length());}</span>
<a href="#l29.19"></a><span id="l29.19">   const char *GetMimeBoundary( void) const { return( m_mimeBoundary.get());}</span>
<a href="#l29.20"></a><span id="l29.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -43,17 +43,16 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l30.5"></a><span id="l30.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;nsIFile.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l30.8"></a><span id="l30.8"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsIIOService.h&quot;</span>
<a href="#l30.10"></a><span id="l30.10"> #include &quot;nsIURI.h&quot;</span>
<a href="#l30.11"></a><span id="l30.11"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-#include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l30.13"></a><span id="l30.13"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l30.14"></a><span id="l30.14"> </span>
<a href="#l30.15"></a><span id="l30.15"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l30.16"></a><span id="l30.16"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l30.17"></a><span id="l30.17"> #include &quot;nsIArray.h&quot;</span>
<a href="#l30.18"></a><span id="l30.18"> #include &quot;nsIMsgCompose.h&quot;</span>
<a href="#l30.19"></a><span id="l30.19"> #include &quot;nsIMsgCompFields.h&quot;</span>
<a href="#l30.20"></a><span id="l30.20"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -429,24 +428,24 @@ nsresult nsOutlookCompose::ComposeTheMes</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23">   return rv;</span>
<a href="#l30.24"></a><span id="l30.24"> }</span>
<a href="#l30.25"></a><span id="l30.25"> </span>
<a href="#l30.26"></a><span id="l30.26"> nsOutlookCompose::ReplaceCidInLine::ReplaceCidInLine(nsCString&amp; line)</span>
<a href="#l30.27"></a><span id="l30.27">   : m_line(line)</span>
<a href="#l30.28"></a><span id="l30.28"> {</span>
<a href="#l30.29"></a><span id="l30.29">   // If the line begins with Content-ID: string, process it! Otherwise, no need to waste time</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-  m_finishedReplacing = (line.Compare(&quot;Content-ID:&quot;, PR_TRUE, 11) != 0);</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+  m_finishedReplacing = StringBeginsWith(line, NS_LITERAL_CSTRING(&quot;Content-ID:&quot;), nsCaseInsensitiveCStringComparator());</span>
<a href="#l30.32"></a><span id="l30.32"> }</span>
<a href="#l30.33"></a><span id="l30.33"> </span>
<a href="#l30.34"></a><span id="l30.34"> void nsOutlookCompose::ReplaceCidInLine::operator () (const CidReplacePair* pair)</span>
<a href="#l30.35"></a><span id="l30.35"> {</span>
<a href="#l30.36"></a><span id="l30.36">   if (m_finishedReplacing)</span>
<a href="#l30.37"></a><span id="l30.37">     return; // Only one cid per line possible!</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-  PRInt32 pos = m_line.Find(pair-&gt;cidNew, PR_FALSE, 12);</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+  PRInt32 pos = MsgFind(m_line, pair-&gt;cidNew, false, 12);</span>
<a href="#l30.40"></a><span id="l30.40">   if (pos != kNotFound) {</span>
<a href="#l30.41"></a><span id="l30.41">     m_finishedReplacing = true; // Stop further search</span>
<a href="#l30.42"></a><span id="l30.42">     m_line.Replace(pos, pair-&gt;cidNew.Length(), pair-&gt;cidOrig);</span>
<a href="#l30.43"></a><span id="l30.43">   }</span>
<a href="#l30.44"></a><span id="l30.44"> }</span>
<a href="#l30.45"></a><span id="l30.45"> </span>
<a href="#l30.46"></a><span id="l30.46"> nsresult nsOutlookCompose::CopyComposedMessage(nsIFile *pSrc,</span>
<a href="#l30.47"></a><span id="l30.47">                                                nsIOutputStream *pDst,</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineat">@@ -634,17 +633,19 @@ void nsOutlookCompose::UpdateHeaders(CMa</span>
<a href="#l30.49"></a><span id="l30.49"> // applies to html &amp;#XXXX; (where XXXX is unicode codepoint).</span>
<a href="#l30.50"></a><span id="l30.50"> // See also Bug 503690, where the same issue in Eudora import is reported.</span>
<a href="#l30.51"></a><span id="l30.51"> // By the way, the root of the Bug 359303 lies in the same place - the nsMsgComposeAndSend::GetBodyFromEditor()</span>
<a href="#l30.52"></a><span id="l30.52"> // changes the 0xA0 codes to 0x20 when it converts the body to plain text.</span>
<a href="#l30.53"></a><span id="l30.53"> // We scan the body here to find all the &amp; and convert them to the safe character sequense to revert later.</span>
<a href="#l30.54"></a><span id="l30.54"> </span>
<a href="#l30.55"></a><span id="l30.55"> void nsOutlookCompose::HackBody(const wchar_t* orig, size_t origLen, nsString&amp; hack)</span>
<a href="#l30.56"></a><span id="l30.56"> {</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l30.58"></a><span id="l30.58">   hack.SetCapacity(static_cast&lt;size_t&gt;(origLen*1.4));</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+#endif</span>
<a href="#l30.60"></a><span id="l30.60">   hack.Assign(hackBeginW);</span>
<a href="#l30.61"></a><span id="l30.61">   hack.Append(m_hackedPostfix);</span>
<a href="#l30.62"></a><span id="l30.62"> </span>
<a href="#l30.63"></a><span id="l30.63">   while (*orig) {</span>
<a href="#l30.64"></a><span id="l30.64">     if (*orig == L'&amp;') {</span>
<a href="#l30.65"></a><span id="l30.65">       hack.Append(hackAmpersandW);</span>
<a href="#l30.66"></a><span id="l30.66">       hack.Append(m_hackedPostfix);</span>
<a href="#l30.67"></a><span id="l30.67">     } else if ((*orig == L'\x0D') &amp;&amp; (*(orig+1) == L'\x0A')) {</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineat">@@ -669,60 +670,36 @@ void nsOutlookCompose::UnhackBody(nsCStr</span>
<a href="#l30.69"></a><span id="l30.69">   hackedString.Append(hackedPostfixA);</span>
<a href="#l30.70"></a><span id="l30.70">   PRInt32 begin = txt.Find(hackedString);</span>
<a href="#l30.71"></a><span id="l30.71">   if (begin == kNotFound)</span>
<a href="#l30.72"></a><span id="l30.72">     return;</span>
<a href="#l30.73"></a><span id="l30.73">   txt.Cut(begin, hackedString.Length());</span>
<a href="#l30.74"></a><span id="l30.74"> </span>
<a href="#l30.75"></a><span id="l30.75">   hackedString.Assign(hackEndA);</span>
<a href="#l30.76"></a><span id="l30.76">   hackedString.Append(hackedPostfixA);</span>
<a href="#l30.77"></a><span id="l30.77" class="difflineminus">-  PRInt32 end = txt.Find(hackedString, PR_FALSE, begin);</span>
<a href="#l30.78"></a><span id="l30.78" class="difflineplus">+  PRInt32 end = MsgFind(txt, hackedString, PR_FALSE, begin);</span>
<a href="#l30.79"></a><span id="l30.79">   if (end == kNotFound)</span>
<a href="#l30.80"></a><span id="l30.80">     return; // ?</span>
<a href="#l30.81"></a><span id="l30.81">   txt.Cut(end, hackedString.Length());</span>
<a href="#l30.82"></a><span id="l30.82"> </span>
<a href="#l30.83"></a><span id="l30.83" class="difflineplus">+  nsCString range;</span>
<a href="#l30.84"></a><span id="l30.84" class="difflineplus">+  range.Assign(Substring(txt, begin, end - begin));</span>
<a href="#l30.85"></a><span id="l30.85">   // 1. Remove all CRLFs from the selected range</span>
<a href="#l30.86"></a><span id="l30.86" class="difflineminus">-  PRInt32 i = begin;</span>
<a href="#l30.87"></a><span id="l30.87" class="difflineminus">-  while (i &lt; end) {</span>
<a href="#l30.88"></a><span id="l30.88" class="difflineminus">-    PRInt32 r = txt.Find(MSG_LINEBREAK, PR_FALSE, i, end-i);</span>
<a href="#l30.89"></a><span id="l30.89" class="difflineminus">-    if (r == kNotFound)</span>
<a href="#l30.90"></a><span id="l30.90" class="difflineminus">-      break;</span>
<a href="#l30.91"></a><span id="l30.91" class="difflineminus">-</span>
<a href="#l30.92"></a><span id="l30.92" class="difflineminus">-    txt.Cut(r, 2);</span>
<a href="#l30.93"></a><span id="l30.93" class="difflineminus">-    end -= 2;</span>
<a href="#l30.94"></a><span id="l30.94" class="difflineminus">-    i = r;</span>
<a href="#l30.95"></a><span id="l30.95" class="difflineminus">-  }</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineminus">-</span>
<a href="#l30.97"></a><span id="l30.97" class="difflineplus">+  MsgReplaceSubstring(range, MSG_LINEBREAK, &quot;&quot;);</span>
<a href="#l30.98"></a><span id="l30.98">   // 2. Restore the original CRLFs</span>
<a href="#l30.99"></a><span id="l30.99">   hackedString.Assign(hackCRLFA);</span>
<a href="#l30.100"></a><span id="l30.100">   hackedString.Append(hackedPostfixA);</span>
<a href="#l30.101"></a><span id="l30.101" class="difflineminus">-  i = begin;</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineminus">-  while (i &lt; end) {</span>
<a href="#l30.103"></a><span id="l30.103" class="difflineminus">-    PRInt32 r = txt.Find(hackedString, PR_FALSE, i, end-i);</span>
<a href="#l30.104"></a><span id="l30.104" class="difflineminus">-    if (r == kNotFound)</span>
<a href="#l30.105"></a><span id="l30.105" class="difflineminus">-      break;</span>
<a href="#l30.106"></a><span id="l30.106" class="difflineminus">-</span>
<a href="#l30.107"></a><span id="l30.107" class="difflineminus">-    txt.Replace(r, hackedString.Length(), MSG_LINEBREAK, 2);</span>
<a href="#l30.108"></a><span id="l30.108" class="difflineminus">-    end -= hackedString.Length()-2;</span>
<a href="#l30.109"></a><span id="l30.109" class="difflineminus">-    i = r+2;</span>
<a href="#l30.110"></a><span id="l30.110" class="difflineminus">-  }</span>
<a href="#l30.111"></a><span id="l30.111" class="difflineplus">+  MsgReplaceSubstring(range, hackedString.get(), MSG_LINEBREAK);</span>
<a href="#l30.112"></a><span id="l30.112"> </span>
<a href="#l30.113"></a><span id="l30.113">   // 3. Restore the original ampersands</span>
<a href="#l30.114"></a><span id="l30.114">   hackedString.Assign(hackAmpersandA);</span>
<a href="#l30.115"></a><span id="l30.115">   hackedString.Append(hackedPostfixA);</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineminus">-  i = begin;</span>
<a href="#l30.117"></a><span id="l30.117" class="difflineminus">-  while (i &lt; end) {</span>
<a href="#l30.118"></a><span id="l30.118" class="difflineminus">-    PRInt32 r = txt.Find(hackedString, PR_FALSE, i, end-i);</span>
<a href="#l30.119"></a><span id="l30.119" class="difflineminus">-    if (r == kNotFound)</span>
<a href="#l30.120"></a><span id="l30.120" class="difflineminus">-      break;</span>
<a href="#l30.121"></a><span id="l30.121" class="difflineplus">+  MsgReplaceSubstring(range, hackedString.get(), &quot;&amp;&quot;);</span>
<a href="#l30.122"></a><span id="l30.122"> </span>
<a href="#l30.123"></a><span id="l30.123" class="difflineminus">-    txt.Replace(r, hackedString.Length(), '&amp;');</span>
<a href="#l30.124"></a><span id="l30.124" class="difflineminus">-    end -= hackedString.Length()-1;</span>
<a href="#l30.125"></a><span id="l30.125" class="difflineminus">-    i = r+1;</span>
<a href="#l30.126"></a><span id="l30.126" class="difflineminus">-  }</span>
<a href="#l30.127"></a><span id="l30.127" class="difflineplus">+  txt.Replace(begin, end - begin, range);</span>
<a href="#l30.128"></a><span id="l30.128"> }</span>
<a href="#l30.129"></a><span id="l30.129"> </span>
<a href="#l30.130"></a><span id="l30.130"> bool nsOutlookCompose::GenerateHackSequence(const wchar_t* body, size_t origLen)</span>
<a href="#l30.131"></a><span id="l30.131"> {</span>
<a href="#l30.132"></a><span id="l30.132">   nsDependentString nsBody(body, origLen);</span>
<a href="#l30.133"></a><span id="l30.133">   const wchar_t* hack_base = L&quot;hacked&quot;;</span>
<a href="#l30.134"></a><span id="l30.134">   int i = 0;</span>
<a href="#l30.135"></a><span id="l30.135">   do {</span>
<a href="#l30.136"></a><span id="l30.136" class="difflineat">@@ -822,19 +799,21 @@ private:</span>
<a href="#l30.137"></a><span id="l30.137">   int m_matchPos;</span>
<a href="#l30.138"></a><span id="l30.138"> };</span>
<a href="#l30.139"></a><span id="l30.139"> </span>
<a href="#l30.140"></a><span id="l30.140"> template &lt;class _OutFn&gt;</span>
<a href="#l30.141"></a><span id="l30.141"> nsresult CCompositionFile::ToDest(_OutFn dest, const char* term, int termSize)</span>
<a href="#l30.142"></a><span id="l30.142"> {</span>
<a href="#l30.143"></a><span id="l30.143">   CTermGuard guard(term, termSize);</span>
<a href="#l30.144"></a><span id="l30.144"> </span>
<a href="#l30.145"></a><span id="l30.145" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l30.146"></a><span id="l30.146">   // We already know the required string size, so reduce future reallocations</span>
<a href="#l30.147"></a><span id="l30.147">   if (!guard.IsChecking() &amp;&amp; !m_convertCRs) </span>
<a href="#l30.148"></a><span id="l30.148">     dest.SetCapacity(m_fileSize - m_fileReadPos);</span>
<a href="#l30.149"></a><span id="l30.149" class="difflineplus">+#endif</span>
<a href="#l30.150"></a><span id="l30.150"> </span>
<a href="#l30.151"></a><span id="l30.151">   bool wasCR = false;</span>
<a href="#l30.152"></a><span id="l30.152">   char c = 0;</span>
<a href="#l30.153"></a><span id="l30.153">   nsresult rv;</span>
<a href="#l30.154"></a><span id="l30.154">   while (NS_SUCCEEDED(rv = EnsureHasDataInBuffer())) {</span>
<a href="#l30.155"></a><span id="l30.155">     if (!guard.IsChecking() &amp;&amp; !m_convertCRs) { // Use efficient algorithm</span>
<a href="#l30.156"></a><span id="l30.156">       dest.Append(m_fifoBufferReadPos, m_fifoBufferWrittenPos-m_fifoBufferReadPos);</span>
<a href="#l30.157"></a><span id="l30.157">     }</span>
<a href="#l30.158"></a><span id="l30.158" class="difflineat">@@ -876,27 +855,31 @@ nsresult CCompositionFile::ToDest(_OutFn</span>
<a href="#l30.159"></a><span id="l30.159"> </span>
<a href="#l30.160"></a><span id="l30.160">   m_lastChar = c;</span>
<a href="#l30.161"></a><span id="l30.161">   return NS_OK;</span>
<a href="#l30.162"></a><span id="l30.162"> }</span>
<a href="#l30.163"></a><span id="l30.163"> </span>
<a href="#l30.164"></a><span id="l30.164"> class dest_nsCString {</span>
<a href="#l30.165"></a><span id="l30.165"> public:</span>
<a href="#l30.166"></a><span id="l30.166">   dest_nsCString(nsCString&amp; str) : m_str(str) { m_str.Truncate(); }</span>
<a href="#l30.167"></a><span id="l30.167" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l30.168"></a><span id="l30.168">   void SetCapacity(PRInt32 sz) { m_str.SetCapacity(sz); }</span>
<a href="#l30.169"></a><span id="l30.169" class="difflineplus">+#endif</span>
<a href="#l30.170"></a><span id="l30.170">   nsresult Append(const char* buf, PRUint32 count) {</span>
<a href="#l30.171"></a><span id="l30.171">     m_str.Append(buf, count); return NS_OK; }</span>
<a href="#l30.172"></a><span id="l30.172"> private:</span>
<a href="#l30.173"></a><span id="l30.173">   nsCString&amp; m_str;</span>
<a href="#l30.174"></a><span id="l30.174"> };</span>
<a href="#l30.175"></a><span id="l30.175"> </span>
<a href="#l30.176"></a><span id="l30.176"> class dest_Stream {</span>
<a href="#l30.177"></a><span id="l30.177"> public:</span>
<a href="#l30.178"></a><span id="l30.178">   dest_Stream(nsIOutputStream *dest) : m_stream(dest) {}</span>
<a href="#l30.179"></a><span id="l30.179" class="difflineplus">+#ifdef MOZILLA_INTERNAL_API</span>
<a href="#l30.180"></a><span id="l30.180">   void SetCapacity(PRInt32) { /*do nothing*/ }</span>
<a href="#l30.181"></a><span id="l30.181" class="difflineplus">+#endif</span>
<a href="#l30.182"></a><span id="l30.182">   // const_cast here is due to the poor design of the EscapeFromSpaceLine()</span>
<a href="#l30.183"></a><span id="l30.183">   // that requires a non-constant pointer while doesn't modify its data</span>
<a href="#l30.184"></a><span id="l30.184">   nsresult Append(const char* buf, PRUint32 count) {</span>
<a href="#l30.185"></a><span id="l30.185">     return EscapeFromSpaceLine(m_stream, const_cast&lt;char*&gt;(buf), buf+count); }</span>
<a href="#l30.186"></a><span id="l30.186"> private:</span>
<a href="#l30.187"></a><span id="l30.187">   nsIOutputStream *m_stream;</span>
<a href="#l30.188"></a><span id="l30.188"> };</span>
<a href="#l30.189"></a><span id="l30.189"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookEditor.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookEditor.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -33,20 +33,20 @@</span>
<a href="#l31.4"></a><span id="l31.4"> * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.5"></a><span id="l31.5"> * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.6"></a><span id="l31.6"> * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.7"></a><span id="l31.7"> *</span>
<a href="#l31.8"></a><span id="l31.8"> * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11"> #include &quot;nsOutlookEditor.h&quot;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l31.14"></a><span id="l31.14"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l31.15"></a><span id="l31.15"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l31.18"></a><span id="l31.18"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l31.19"></a><span id="l31.19"> </span>
<a href="#l31.20"></a><span id="l31.20"> NS_IMPL_ISUPPORTS2(nsOutlookEditor, nsIEditor, nsIEditorMailSupport)</span>
<a href="#l31.21"></a><span id="l31.21"> NS_IMPL_THREADSAFE_ISUPPORTS5(nsOutlookHTMLImageElement,</span>
<a href="#l31.22"></a><span id="l31.22">                               nsOutlookHTMLImageElement,</span>
<a href="#l31.23"></a><span id="l31.23">                               nsIDOMHTMLImageElement,</span>
<a href="#l31.24"></a><span id="l31.24">                               nsIDOMHTMLElement,</span>
<a href="#l31.25"></a><span id="l31.25">                               nsIDOMElement,</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineat">@@ -632,18 +632,18 @@ nsresult nsOutlookEditor::GetCids(PRUint</span>
<a href="#l31.27"></a><span id="l31.27">   if (!m_EmbeddedObjectList)</span>
<a href="#l31.28"></a><span id="l31.28">     return NS_ERROR_FAILURE;</span>
<a href="#l31.29"></a><span id="l31.29">   nsCOMPtr&lt;nsOutlookHTMLImageElement&gt; node;</span>
<a href="#l31.30"></a><span id="l31.30">   nsresult rv = m_EmbeddedObjectList-&gt;QueryElementAt(</span>
<a href="#l31.31"></a><span id="l31.31">     embedIndex, NS_GET_IID(nsOutlookHTMLImageElement), getter_AddRefs(node));</span>
<a href="#l31.32"></a><span id="l31.32">   if (node) {</span>
<a href="#l31.33"></a><span id="l31.33">     if (!node-&gt;NewCid())</span>
<a href="#l31.34"></a><span id="l31.34">       return NS_ERROR_FAILURE; // no need to replace anything!</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineminus">-    LossyCopyUTF16toASCII(node-&gt;OrigCid(), origCid);</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">-    LossyCopyUTF16toASCII(node-&gt;NewCid(), newCid);</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+    LossyCopyUTF16toASCII(nsDependentString(node-&gt;OrigCid()), origCid);</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+    LossyCopyUTF16toASCII(nsDependentString(node-&gt;NewCid()), newCid);</span>
<a href="#l31.39"></a><span id="l31.39">   }</span>
<a href="#l31.40"></a><span id="l31.40">   return rv;</span>
<a href="#l31.41"></a><span id="l31.41"> }</span>
<a href="#l31.42"></a><span id="l31.42"> </span>
<a href="#l31.43"></a><span id="l31.43"> /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l31.44"></a><span id="l31.44"> </span>
<a href="#l31.45"></a><span id="l31.45"> nsOutlookHTMLImageElement::nsOutlookHTMLImageElement</span>
<a href="#l31.46"></a><span id="l31.46">   (nsOutlookEditor *pEditor, nsIURI *uri, const wchar_t *cid, const wchar_t *name)</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineat">@@ -1327,17 +1327,17 @@ NS_IMETHODIMP nsOutlookHTMLImageElement:</span>
<a href="#l31.48"></a><span id="l31.48"> NS_IMETHODIMP nsOutlookHTMLImageElement::SetSrc(const nsAString &amp; aSrc)</span>
<a href="#l31.49"></a><span id="l31.49"> {</span>
<a href="#l31.50"></a><span id="l31.50">   // nsEudoraHTMLImageElement calls UpdateEmbeddedImageReference(m_cid, aSrc)</span>
<a href="#l31.51"></a><span id="l31.51">   // on the editor here, but our editor doen't implement it.</span>
<a href="#l31.52"></a><span id="l31.52"> </span>
<a href="#l31.53"></a><span id="l31.53">   // The nsMsgNend::ProcessMultipartRelated seems to call SetSrc twice.</span>
<a href="#l31.54"></a><span id="l31.54">   // I'm not sure if I need to do it second time.</span>
<a href="#l31.55"></a><span id="l31.55">   if (m_cid_new.IsEmpty()) </span>
<a href="#l31.56"></a><span id="l31.56" class="difflineminus">-    m_cid_new.Assign(aSrc.Data()+4, aSrc.Length()-4); // strip the &quot;cid:&quot;</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineplus">+    m_cid_new.Assign(Substring(aSrc, 4)); // strip the &quot;cid:&quot;</span>
<a href="#l31.58"></a><span id="l31.58"> </span>
<a href="#l31.59"></a><span id="l31.59">   return NS_OK;</span>
<a href="#l31.60"></a><span id="l31.60"> }</span>
<a href="#l31.61"></a><span id="l31.61"> </span>
<a href="#l31.62"></a><span id="l31.62"> // attribute DOMString useMap</span>
<a href="#l31.63"></a><span id="l31.63"> NS_IMETHODIMP nsOutlookHTMLImageElement::GetUseMap(nsAString &amp; aUseMap)</span>
<a href="#l31.64"></a><span id="l31.64"> {</span>
<a href="#l31.65"></a><span id="l31.65">   return NS_ERROR_NOT_IMPLEMENTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookEditor.h</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookEditor.h</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -36,17 +36,17 @@</span>
<a href="#l32.4"></a><span id="l32.4"> *</span>
<a href="#l32.5"></a><span id="l32.5"> * ***** END LICENSE BLOCK ***** */</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7"> #include &quot;nscore.h&quot;</span>
<a href="#l32.8"></a><span id="l32.8"> #include &quot;nsIEditor.h&quot;</span>
<a href="#l32.9"></a><span id="l32.9"> #include &quot;nsIEditorMailSupport.h&quot;</span>
<a href="#l32.10"></a><span id="l32.10"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l32.11"></a><span id="l32.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+#include &quot;nsStringGlue.h&quot;</span>
<a href="#l32.14"></a><span id="l32.14"> #include &quot;nsIFile.h&quot;</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16"> class nsOutlookEditor : public nsIEditor, public nsIEditorMailSupport</span>
<a href="#l32.17"></a><span id="l32.17"> {</span>
<a href="#l32.18"></a><span id="l32.18">   public:</span>
<a href="#l32.19"></a><span id="l32.19">     NS_DECL_ISUPPORTS</span>
<a href="#l32.20"></a><span id="l32.20">     NS_DECL_NSIEDITOR</span>
<a href="#l32.21"></a><span id="l32.21">     NS_DECL_NSIEDITORMAILSUPPORT</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookMail.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -50,17 +50,16 @@</span>
<a href="#l33.4"></a><span id="l33.4"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l33.5"></a><span id="l33.5"> #include &quot;nsOutlookStringBundle.h&quot;</span>
<a href="#l33.6"></a><span id="l33.6"> #include &quot;nsABBaseCID.h&quot;</span>
<a href="#l33.7"></a><span id="l33.7"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l33.8"></a><span id="l33.8"> #include &quot;mdb.h&quot;</span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;OutlookDebugLog.h&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> #include &quot;nsOutlookMail.h&quot;</span>
<a href="#l33.11"></a><span id="l33.11"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l33.13"></a><span id="l33.13"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l33.14"></a><span id="l33.14"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l33.15"></a><span id="l33.15"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l33.16"></a><span id="l33.16"> </span>
<a href="#l33.17"></a><span id="l33.17"> static NS_DEFINE_IID(kISupportsIID,      NS_ISUPPORTS_IID);</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19"> /* ------------ Address book stuff ----------------- */</span>
<a href="#l33.20"></a><span id="l33.20"> typedef struct {</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineat">@@ -618,17 +617,17 @@ nsresult nsOutlookMail::CreateList( cons</span>
<a href="#l33.22"></a><span id="l33.22">   // Make sure we have db to work with.</span>
<a href="#l33.23"></a><span id="l33.23">   if (!pDb)</span>
<a href="#l33.24"></a><span id="l33.24">     return rv;</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26">   nsCOMPtr &lt;nsIMdbRow&gt; newListRow;</span>
<a href="#l33.27"></a><span id="l33.27">   rv = pDb-&gt;GetNewListRow(getter_AddRefs(newListRow));</span>
<a href="#l33.28"></a><span id="l33.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.29"></a><span id="l33.29">   nsCAutoString column;</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">-  LossyCopyUTF16toASCII(pName, column );</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+  LossyCopyUTF16toASCII(nsDependentString(pName), column);</span>
<a href="#l33.32"></a><span id="l33.32">   rv = pDb-&gt;AddListName(newListRow, column.get());</span>
<a href="#l33.33"></a><span id="l33.33">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l33.34"></a><span id="l33.34"> </span>
<a href="#l33.35"></a><span id="l33.35">   HRESULT             hr;</span>
<a href="#l33.36"></a><span id="l33.36">   LPSPropValue value = NULL;</span>
<a href="#l33.37"></a><span id="l33.37">   ULONG valueCount = 0;</span>
<a href="#l33.38"></a><span id="l33.38"> </span>
<a href="#l33.39"></a><span id="l33.39">   LPSPropTagArray properties = NULL;</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineat">@@ -716,39 +715,34 @@ nsresult nsOutlookMail::CreateList( cons</span>
<a href="#l33.41"></a><span id="l33.41"> </span>
<a href="#l33.42"></a><span id="l33.42">   rv = pDb-&gt;SetListAddressTotal(newListRow, total);</span>
<a href="#l33.43"></a><span id="l33.43">   rv = pDb-&gt;AddListDirNode(newListRow);</span>
<a href="#l33.44"></a><span id="l33.44">   return rv;</span>
<a href="#l33.45"></a><span id="l33.45"> }</span>
<a href="#l33.46"></a><span id="l33.46"> </span>
<a href="#l33.47"></a><span id="l33.47"> void nsOutlookMail::SanitizeValue( nsString&amp; val)</span>
<a href="#l33.48"></a><span id="l33.48"> {</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineminus">-  val.ReplaceSubstring(NS_LITERAL_STRING(&quot;\x0D\x0A&quot;).get(),</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineminus">-                         NS_LITERAL_STRING(&quot;, &quot;).get());</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineminus">-  val.ReplaceChar( 13, ',');</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineminus">-  val.ReplaceChar( 10, ',');</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+  MsgReplaceSubstring(val, NS_LITERAL_STRING(&quot;\r\n&quot;), NS_LITERAL_STRING(&quot;, &quot;));</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+  MsgReplaceChar(val, &quot;\r\n&quot;, ',');</span>
<a href="#l33.55"></a><span id="l33.55"> }</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57"> void nsOutlookMail::SplitString( nsString&amp; val1, nsString&amp; val2)</span>
<a href="#l33.58"></a><span id="l33.58"> {</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineminus">-  nsString  temp;</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineminus">-</span>
<a href="#l33.61"></a><span id="l33.61">   // Find the last line if there is more than one!</span>
<a href="#l33.62"></a><span id="l33.62">   PRInt32 idx = val1.RFind( &quot;\x0D\x0A&quot;);</span>
<a href="#l33.63"></a><span id="l33.63">   PRInt32  cnt = 2;</span>
<a href="#l33.64"></a><span id="l33.64">   if (idx == -1) {</span>
<a href="#l33.65"></a><span id="l33.65">     cnt = 1;</span>
<a href="#l33.66"></a><span id="l33.66">     idx = val1.RFindChar( 13);</span>
<a href="#l33.67"></a><span id="l33.67">   }</span>
<a href="#l33.68"></a><span id="l33.68">   if (idx == -1)</span>
<a href="#l33.69"></a><span id="l33.69">     idx= val1.RFindChar( 10);</span>
<a href="#l33.70"></a><span id="l33.70">   if (idx != -1) {</span>
<a href="#l33.71"></a><span id="l33.71" class="difflineminus">-    val1.Right( val2, val1.Length() - idx - cnt);</span>
<a href="#l33.72"></a><span id="l33.72" class="difflineminus">-    val1.Left( temp, idx);</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineminus">-    val1 = temp;</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+    val2 = Substring(val1, idx + cnt);</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+    val1.SetLength(idx);</span>
<a href="#l33.76"></a><span id="l33.76">     SanitizeValue( val1);</span>
<a href="#l33.77"></a><span id="l33.77">   }</span>
<a href="#l33.78"></a><span id="l33.78"> }</span>
<a href="#l33.79"></a><span id="l33.79"> </span>
<a href="#l33.80"></a><span id="l33.80"> bool nsOutlookMail::BuildCard( const PRUnichar *pName, nsIAddrDatabase *pDb, nsIMdbRow *newRow, LPMAPIPROP pUser, nsIImportFieldMap *pFieldMap)</span>
<a href="#l33.81"></a><span id="l33.81"> {</span>
<a href="#l33.82"></a><span id="l33.82"> </span>
<a href="#l33.83"></a><span id="l33.83">   nsString    lastName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextAddress.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -44,16 +44,22 @@</span>
<a href="#l34.4"></a><span id="l34.4"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l34.5"></a><span id="l34.5"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l34.6"></a><span id="l34.6"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8"> #include &quot;TextDebugLog.h&quot;</span>
<a href="#l34.9"></a><span id="l34.9"> #include &quot;plstr.h&quot;</span>
<a href="#l34.10"></a><span id="l34.10"> #include &quot;msgCore.h&quot;</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+#ifndef MOZILLA_INTERNAL_API</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+#define NS_CopyNativeToUnicode(source, dest) \</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+        nsMsgI18NConvertToUnicode(nsMsgI18NFileSystemCharset(), source, dest)</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+#endif</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+</span>
<a href="#l34.18"></a><span id="l34.18"> #define kWhitespace    &quot; \t\b\r\n&quot;</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20"> // If we get a line longer than 32K it's just toooooo bad!</span>
<a href="#l34.21"></a><span id="l34.21"> #define kTextAddressBufferSz    (64 * 1024)</span>
<a href="#l34.22"></a><span id="l34.22"> </span>
<a href="#l34.23"></a><span id="l34.23"> nsTextAddress::nsTextAddress()</span>
<a href="#l34.24"></a><span id="l34.24"> {</span>
<a href="#l34.25"></a><span id="l34.25">     m_database = nsnull;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -67,17 +67,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l35.5"></a><span id="l35.5"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l35.6"></a><span id="l35.6"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l35.7"></a><span id="l35.7"> #include &quot;nsTextAddress.h&quot;</span>
<a href="#l35.8"></a><span id="l35.8"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l35.9"></a><span id="l35.9"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l35.10"></a><span id="l35.10"> #include &quot;TextDebugLog.h&quot;</span>
<a href="#l35.11"></a><span id="l35.11"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15"> #define TEXT_MSGS_URL &quot;chrome://messenger/locale/textImportMsgs.properties&quot;</span>
<a href="#l35.16"></a><span id="l35.16"> #define TEXTIMPORT_NAME                  2000</span>
<a href="#l35.17"></a><span id="l35.17"> #define TEXTIMPORT_DESCRIPTION           2001</span>
<a href="#l35.18"></a><span id="l35.18"> #define TEXTIMPORT_ADDRESS_NAME          2002</span>
<a href="#l35.19"></a><span id="l35.19"> #define TEXTIMPORT_ADDRESS_SUCCESS       2003</span>
<a href="#l35.20"></a><span id="l35.20"> #define TEXTIMPORT_ADDRESS_BADPARAM      2004</span>
<a href="#l35.21"></a><span id="l35.21"> #define TEXTIMPORT_ADDRESS_BADSOURCEFILE 2005</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -48,17 +48,18 @@</span>
<a href="#l36.4"></a><span id="l36.4"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l36.5"></a><span id="l36.5"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l36.6"></a><span id="l36.6"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l36.7"></a><span id="l36.7"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l36.8"></a><span id="l36.8"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l36.9"></a><span id="l36.9"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l36.10"></a><span id="l36.10"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l36.11"></a><span id="l36.11"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l36.15"></a><span id="l36.15"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l36.16"></a><span id="l36.16"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l36.17"></a><span id="l36.17"> #include &quot;nsVCardAddress.h&quot;</span>
<a href="#l36.18"></a><span id="l36.18"> #include &quot;nsVCardImport.h&quot;</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20"> PRLogModuleInfo *VCARDLOGMODULE = nsnull;</span>
<a href="#l36.21"></a><span id="l36.21"> static NS_DEFINE_IID(kISupportsIID, NS_ISUPPORTS_IID);</span>
<a href="#l36.22"></a><span id="l36.22"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

