<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 11678:2e4f6c68fce46bd766be7b2dc2b63898138f8b65</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2e4f6c68fce46bd766be7b2dc2b63898138f8b65" />
<meta property="og:url" content="/comm-central/rev/2e4f6c68fce46bd766be7b2dc2b63898138f8b65" />
<meta property="og:description" content="Bug 817390 - Make click_account_tree_row() in test-account-manager-helpers.js check sanity of its arguments. r=mconley" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2e4f6c68fce46bd766be7b2dc2b63898138f8b65 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2e4f6c68fce46bd766be7b2dc2b63898138f8b65">shortlog</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2e4f6c68fce46bd766be7b2dc2b63898138f8b65">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65">files</a> |
changeset |
<a href="/comm-central/raw-rev/2e4f6c68fce46bd766be7b2dc2b63898138f8b65">raw</a>  | <a href="/comm-central/archive/2e4f6c68fce46bd766be7b2dc2b63898138f8b65.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=817390">Bug 817390</a> - Make click_account_tree_row() in test-account-manager-helpers.js check sanity of its arguments. r=mconley
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 10 Dec 2012 08:13:58 -0500</td></tr>

<tr>
 <td>changeset 11678</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2e4f6c68fce46bd766be7b2dc2b63898138f8b65">2e4f6c68fce46bd766be7b2dc2b63898138f8b65</a></td>
</tr>



<tr>
<td>parent 11677</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/566d44a1231ae01ffa6849aab7baa5f0c4cb8c7d">566d44a1231ae01ffa6849aab7baa5f0c4cb8c7d</a>
</td>
</tr>

<tr>
<td>child 11679</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/bb60be2d8d3f1891880c28756c2f389b1024c89f">bb60be2d8d3f1891880c28756c2f389b1024c89f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2e4f6c68fce46bd766be7b2dc2b63898138f8b65">8704</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 10 Dec 2012 13:15:13 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@bb60be2d8d3f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bb60be2d8d3f1891880c28756c2f389b1024c89f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bb60be2d8d3f1891880c28756c2f389b1024c89f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb60be2d8d3f1891880c28756c2f389b1024c89f&newProject=comm-central&newRevision=5f82efe1e4b1fd2190c1e6c92e71b6ac89acf5dc&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb60be2d8d3f1891880c28756c2f389b1024c89f&newProject=comm-central&newRevision=5f82efe1e4b1fd2190c1e6c92e71b6ac89acf5dc&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bb60be2d8d3f1891880c28756c2f389b1024c89f&newProject=comm-central&newRevision=5f82efe1e4b1fd2190c1e6c92e71b6ac89acf5dc&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mconley%29&revcount=50">mconley</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=817390">817390</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=817390">Bug 817390</a> - Make click_account_tree_row() in test-account-manager-helpers.js check sanity of its arguments. r=mconley</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-ab-whitelist.js">mail/test/mozmill/account/test-ab-whitelist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-ab-whitelist.js">file</a> |
<a href="/comm-central/annotate/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-ab-whitelist.js">annotate</a> |
<a href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-ab-whitelist.js">diff</a> |
<a href="/comm-central/comparison/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-ab-whitelist.js">comparison</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-ab-whitelist.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-actions.js">mail/test/mozmill/account/test-account-actions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-actions.js">file</a> |
<a href="/comm-central/annotate/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-actions.js">annotate</a> |
<a href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-actions.js">diff</a> |
<a href="/comm-central/comparison/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-actions.js">comparison</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-actions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-port-setting.js">mail/test/mozmill/account/test-account-port-setting.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-port-setting.js">file</a> |
<a href="/comm-central/annotate/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-port-setting.js">annotate</a> |
<a href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-port-setting.js">diff</a> |
<a href="/comm-central/comparison/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-port-setting.js">comparison</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-port-setting.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-settings-infrastructure.js">mail/test/mozmill/account/test-account-settings-infrastructure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-settings-infrastructure.js">file</a> |
<a href="/comm-central/annotate/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-settings-infrastructure.js">annotate</a> |
<a href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-settings-infrastructure.js">diff</a> |
<a href="/comm-central/comparison/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-settings-infrastructure.js">comparison</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-account-settings-infrastructure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-archive-options.js">mail/test/mozmill/account/test-archive-options.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-archive-options.js">file</a> |
<a href="/comm-central/annotate/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-archive-options.js">annotate</a> |
<a href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-archive-options.js">diff</a> |
<a href="/comm-central/comparison/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-archive-options.js">comparison</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/account/test-archive-options.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">mail/test/mozmill/shared-modules/test-account-manager-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">file</a> |
<a href="/comm-central/annotate/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">annotate</a> |
<a href="/comm-central/diff/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">diff</a> |
<a href="/comm-central/comparison/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">comparison</a> |
<a href="/comm-central/log/2e4f6c68fce46bd766be7b2dc2b63898138f8b65/mail/test/mozmill/shared-modules/test-account-manager-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/test/mozmill/account/test-ab-whitelist.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-ab-whitelist.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -45,17 +45,16 @@ function teardownModule(module) {</span>
<a href="#l1.4"></a><span id="l1.4"> /* First, test that when we initially load the account manager, that</span>
<a href="#l1.5"></a><span id="l1.5">  * we're not whitelisting any address books.  Then, we'll check all</span>
<a href="#l1.6"></a><span id="l1.6">  * address books and save.</span>
<a href="#l1.7"></a><span id="l1.7">  */</span>
<a href="#l1.8"></a><span id="l1.8"> function subtest_check_whitelist_init_and_save(amc) {</span>
<a href="#l1.9"></a><span id="l1.9">   // Ok, the advanced settings window is open.  Let's choose</span>
<a href="#l1.10"></a><span id="l1.10">   // the junkmail settings.</span>
<a href="#l1.11"></a><span id="l1.11">   let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l1.13"></a><span id="l1.13">   click_account_tree_row(amc, accountRow);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">   let doc = amc.window.document.getElementById(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17">   // At this point, we shouldn't have anything checked, but we should have</span>
<a href="#l1.18"></a><span id="l1.18">   // the two default address books (Personal and Collected) displayed</span>
<a href="#l1.19"></a><span id="l1.19">   let list = doc.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">   assert_equals(2, list.getRowCount(),</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -72,17 +71,16 @@ function subtest_check_whitelist_init_an</span>
<a href="#l1.22"></a><span id="l1.22"> }</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> /* Next, we'll make sure that the address books we checked in</span>
<a href="#l1.25"></a><span id="l1.25">  * subtest_check_whitelist_init_and_save were properly saved.</span>
<a href="#l1.26"></a><span id="l1.26">  * Then, we'll clear the address books and save.</span>
<a href="#l1.27"></a><span id="l1.27">  */</span>
<a href="#l1.28"></a><span id="l1.28"> function subtest_check_whitelist_load_and_clear(amc) {</span>
<a href="#l1.29"></a><span id="l1.29">   let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l1.31"></a><span id="l1.31">   click_account_tree_row(amc, accountRow);</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">   let doc = amc.window.document.getElementById(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l1.34"></a><span id="l1.34">   let list = doc.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l1.35"></a><span id="l1.35">   let whiteListURIs = Services.prefs.getCharPref(gKeyString).split(&quot; &quot;);</span>
<a href="#l1.36"></a><span id="l1.36"> </span>
<a href="#l1.37"></a><span id="l1.37">   for (let i = 0; i &lt; list.getRowCount(); i++) {</span>
<a href="#l1.38"></a><span id="l1.38">     let abNode = list.getItemAtIndex(i);</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineat">@@ -99,17 +97,16 @@ function subtest_check_whitelist_load_an</span>
<a href="#l1.40"></a><span id="l1.40">   amc.window.document.getElementById(&quot;accountManager&quot;).acceptDialog();</span>
<a href="#l1.41"></a><span id="l1.41"> }</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43"> /* Finally, we'll make sure that the address books we cleared</span>
<a href="#l1.44"></a><span id="l1.44">  * were actually cleared.</span>
<a href="#l1.45"></a><span id="l1.45">  */</span>
<a href="#l1.46"></a><span id="l1.46"> function subtest_check_whitelist_load_cleared(amc) {</span>
<a href="#l1.47"></a><span id="l1.47">   let accountRow = get_account_tree_row(gAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l1.49"></a><span id="l1.49">   click_account_tree_row(amc, accountRow);</span>
<a href="#l1.50"></a><span id="l1.50"> </span>
<a href="#l1.51"></a><span id="l1.51">   let doc = amc.window.document.getElementById(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l1.52"></a><span id="l1.52">   let list = doc.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l1.53"></a><span id="l1.53">   let whiteListURIs = &quot;&quot;;</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55">   try {</span>
<a href="#l1.56"></a><span id="l1.56">     whiteListURIs = Services.prefs.getCharPref(gKeyString);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-actions.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-actions.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -65,17 +65,16 @@ function teardownModule(module) {</span>
<a href="#l2.4"></a><span id="l2.4">  * @param aIsRemoveEnabled        true if the menuitem should be enabled, false otherwise</span>
<a href="#l2.5"></a><span id="l2.5">  * @param aIsAddAccountEnabled    true if the menuitems (Add Mail Account+Add Other Account)</span>
<a href="#l2.6"></a><span id="l2.6">  *                                should be enabled, false otherwise</span>
<a href="#l2.7"></a><span id="l2.7">  */</span>
<a href="#l2.8"></a><span id="l2.8"> function subtest_check_account_actions(amc, aAccountKey, aIsSetAsDefaultEnabled,</span>
<a href="#l2.9"></a><span id="l2.9">                                        aIsRemoveEnabled, aIsAddAccountEnabled)</span>
<a href="#l2.10"></a><span id="l2.10"> {</span>
<a href="#l2.11"></a><span id="l2.11">   let accountRow = get_account_tree_row(aAccountKey, null, amc);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l2.13"></a><span id="l2.13">   click_account_tree_row(amc, accountRow);</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">   // click the Actions Button to bring up the popup with menuitems to test</span>
<a href="#l2.16"></a><span id="l2.16">   amc.click(amc.eid(&quot;accountActionsButton&quot;), 5, 5);</span>
<a href="#l2.17"></a><span id="l2.17">   wait_for_popup_to_open(amc.e(&quot;accountActionsDropdown&quot;));</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   let actionAddMailAccount = amc.e(&quot;accountActionsAddMailAccount&quot;);</span>
<a href="#l2.20"></a><span id="l2.20">   assert_not_equals(actionAddMailAccount, undefined);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-port-setting.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-port-setting.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -28,17 +28,16 @@ var gTestNumber;</span>
<a href="#l3.4"></a><span id="l3.4"> function subtest_check_set_port_number(amc, aDontSet) {</span>
<a href="#l3.5"></a><span id="l3.5">   // This test expects the following POP account to exist by default</span>
<a href="#l3.6"></a><span id="l3.6">   // with port number 110 and no security.</span>
<a href="#l3.7"></a><span id="l3.7">   let server = MailServices.accounts</span>
<a href="#l3.8"></a><span id="l3.8">                            .FindServer(&quot;tinderbox&quot;, &quot;tinderbox&quot;, &quot;pop3&quot;);</span>
<a href="#l3.9"></a><span id="l3.9">   let account = MailServices.accounts.FindAccountForServer(server);</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   let accountRow = get_account_tree_row(account.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l3.13"></a><span id="l3.13">   click_account_tree_row(amc, accountRow);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15">   let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">   let portElem = iframe.contentDocument.getElementById(&quot;server.port&quot;);</span>
<a href="#l3.17"></a><span id="l3.17">   portElem.focus();</span>
<a href="#l3.18"></a><span id="l3.18">   portElem.selectionStart = portElem.selectionEnd = portElem.value.length;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   if (portElem.value != PORT_NUMBERS_TO_TEST[gTestNumber - 1])</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-settings-infrastructure.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-settings-infrastructure.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -68,35 +68,37 @@ function test_account_dot_IDs() {</span>
<a href="#l4.4"></a><span id="l4.4">  * of the element contains multiple dots (not used in standard TB yet</span>
<a href="#l4.5"></a><span id="l4.5">  * but extensions may want it).</span>
<a href="#l4.6"></a><span id="l4.6">  *</span>
<a href="#l4.7"></a><span id="l4.7">  * @param amc  the account options controller</span>
<a href="#l4.8"></a><span id="l4.8">  */</span>
<a href="#l4.9"></a><span id="l4.9"> function subtest_check_account_dot_IDs(amc)</span>
<a href="#l4.10"></a><span id="l4.10"> {</span>
<a href="#l4.11"></a><span id="l4.11">   let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l4.13"></a><span id="l4.13">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l4.17"></a><span id="l4.17">   // Check whether a standard element with &quot;server.loginAtStartUp&quot; stores its</span>
<a href="#l4.18"></a><span id="l4.18">   // value properly.</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-  let loginCheck = iframe.contentDocument.getElementById(&quot;server.loginAtStartUp&quot;);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+  let loginCheck = iframe.getElementById(&quot;server.loginAtStartUp&quot;);</span>
<a href="#l4.21"></a><span id="l4.21">   assert_false(loginCheck.checked);</span>
<a href="#l4.22"></a><span id="l4.22">   amc.check(new elib.Elem(loginCheck), true);</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">   accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l4.26"></a><span id="l4.26">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l4.29"></a><span id="l4.29">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  // Re-assign iframe.contentDocument because it was lost when changing panes</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  // (uses loadURI to load a new document).</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+</span>
<a href="#l4.35"></a><span id="l4.35">   // Check by element properties.</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-  let loginCheck = iframe.contentDocument.getElementById(&quot;server.loginAtStartUp&quot;);</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+  let loginCheck = iframe.getElementById(&quot;server.loginAtStartUp&quot;);</span>
<a href="#l4.38"></a><span id="l4.38">   assert_true(loginCheck.checked);</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">   // Check for correct value in the accountValues array, that will be saved into prefs.</span>
<a href="#l4.41"></a><span id="l4.41">   let rawCheckValue = amc.window.getAccountValue(gPopAccount,</span>
<a href="#l4.42"></a><span id="l4.42">                                                  amc.window.getValueArrayFor(gPopAccount),</span>
<a href="#l4.43"></a><span id="l4.43">                                                  &quot;server&quot;, &quot;loginAtStartUp&quot;,</span>
<a href="#l4.44"></a><span id="l4.44">                                                  null, false);</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46" class="difflineat">@@ -147,65 +149,67 @@ function test_account_locked_prefs() {</span>
<a href="#l4.47"></a><span id="l4.47">  * Check that the LDAP server selection elements (radio group) are properly</span>
<a href="#l4.48"></a><span id="l4.48">  * disabled when their attached pref (prefstring attribute) is locked.</span>
<a href="#l4.49"></a><span id="l4.49">  *</span>
<a href="#l4.50"></a><span id="l4.50">  * @param amc  the account options controller</span>
<a href="#l4.51"></a><span id="l4.51">  */</span>
<a href="#l4.52"></a><span id="l4.52"> function subtest_check_locked_prefs_addressing(amc)</span>
<a href="#l4.53"></a><span id="l4.53"> {</span>
<a href="#l4.54"></a><span id="l4.54">   let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-addressing.xul&quot;, amc);</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l4.56"></a><span id="l4.56">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.57"></a><span id="l4.57"> </span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l4.60"></a><span id="l4.60"> </span>
<a href="#l4.61"></a><span id="l4.61">   // By default, 'use global LDAP server preferences' is set, not the</span>
<a href="#l4.62"></a><span id="l4.62">   // 'different LDAP server'.</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-  let useLDAPdirectory = iframe.contentDocument.getElementById(&quot;directories&quot;);</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  let useLDAPdirectory = iframe.getElementById(&quot;directories&quot;);</span>
<a href="#l4.65"></a><span id="l4.65">   assert_false(useLDAPdirectory.selected);</span>
<a href="#l4.66"></a><span id="l4.66"> </span>
<a href="#l4.67"></a><span id="l4.67">   // So the server selector is disabled.</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-  let LDAPdirectory = iframe.contentDocument.getElementById(&quot;identity.directoryServer&quot;);</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+  let LDAPdirectory = iframe.getElementById(&quot;identity.directoryServer&quot;);</span>
<a href="#l4.70"></a><span id="l4.70">   assert_true(LDAPdirectory.disabled);</span>
<a href="#l4.71"></a><span id="l4.71"> </span>
<a href="#l4.72"></a><span id="l4.72">   // And the Edit button too.</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-  let LDAPeditButton = iframe.contentDocument.getElementById(&quot;editButton&quot;);</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+  let LDAPeditButton = iframe.getElementById(&quot;editButton&quot;);</span>
<a href="#l4.75"></a><span id="l4.75">   assert_true(LDAPeditButton.disabled);</span>
<a href="#l4.76"></a><span id="l4.76"> </span>
<a href="#l4.77"></a><span id="l4.77">   // Now toggle the 'different LDAP server' on. The server selector</span>
<a href="#l4.78"></a><span id="l4.78">   // and edit button should enable.</span>
<a href="#l4.79"></a><span id="l4.79">   amc.radio(new elib.Elem(useLDAPdirectory));</span>
<a href="#l4.80"></a><span id="l4.80">   assert_false(LDAPdirectory.disabled);</span>
<a href="#l4.81"></a><span id="l4.81">   assert_false(LDAPeditButton.disabled);</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">   // Lock the pref for the server selector.</span>
<a href="#l4.84"></a><span id="l4.84">   let prefstring = LDAPdirectory.getAttribute(&quot;prefstring&quot;);</span>
<a href="#l4.85"></a><span id="l4.85">   let controlPref = prefstring.replace(&quot;%identitykey%&quot;, gPopAccount.defaultIdentity.key);</span>
<a href="#l4.86"></a><span id="l4.86">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(controlPref, &quot;xxx&quot;);</span>
<a href="#l4.87"></a><span id="l4.87">   Services.prefs.lockPref(controlPref);</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89">   // Refresh the pane by swithing to another one.</span>
<a href="#l4.90"></a><span id="l4.90">   accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l4.92"></a><span id="l4.92">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94">   accountRow = get_account_tree_row(gPopAccount.key, &quot;am-addressing.xul&quot;, amc);</span>
<a href="#l4.95"></a><span id="l4.95">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.96"></a><span id="l4.96"> </span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+  // Re-assign iframe.contentDocument because it was lost when changing panes</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+  // (uses loadURI to load a new document).</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+</span>
<a href="#l4.101"></a><span id="l4.101">   // We are now back and the 'different LDAP server' should still be selected</span>
<a href="#l4.102"></a><span id="l4.102">   // (the setting was saved).</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-  useLDAPdirectory = iframe.contentDocument.getElementById(&quot;directories&quot;);</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+  useLDAPdirectory = iframe.getElementById(&quot;directories&quot;);</span>
<a href="#l4.105"></a><span id="l4.105">   assert_true(useLDAPdirectory.selected);</span>
<a href="#l4.106"></a><span id="l4.106"> </span>
<a href="#l4.107"></a><span id="l4.107">   // But now the server selector should be disabled due to locked pref.</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-  LDAPdirectory = iframe.contentDocument.getElementById(&quot;identity.directoryServer&quot;);</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+  LDAPdirectory = iframe.getElementById(&quot;identity.directoryServer&quot;);</span>
<a href="#l4.110"></a><span id="l4.110">   assert_true(LDAPdirectory.disabled);</span>
<a href="#l4.111"></a><span id="l4.111"> </span>
<a href="#l4.112"></a><span id="l4.112">   // The edit button still enabled (does not depend on the same pref lock)</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-  LDAPeditButton = iframe.contentDocument.getElementById(&quot;editButton&quot;);</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+  LDAPeditButton = iframe.getElementById(&quot;editButton&quot;);</span>
<a href="#l4.115"></a><span id="l4.115">   assert_false(LDAPeditButton.disabled);</span>
<a href="#l4.116"></a><span id="l4.116"> </span>
<a href="#l4.117"></a><span id="l4.117">   // Unlock the pref to clean up.</span>
<a href="#l4.118"></a><span id="l4.118">   Services.prefs.unlockPref(controlPref);</span>
<a href="#l4.119"></a><span id="l4.119">   Services.prefs.getDefaultBranch(&quot;&quot;).deleteBranch(controlPref);</span>
<a href="#l4.120"></a><span id="l4.120"> }</span>
<a href="#l4.121"></a><span id="l4.121"> </span>
<a href="#l4.122"></a><span id="l4.122"> /**</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineat">@@ -213,33 +217,32 @@ function subtest_check_locked_prefs_addr</span>
<a href="#l4.124"></a><span id="l4.124">  * checkboxes + textbox) are properly disabled when their attached pref</span>
<a href="#l4.125"></a><span id="l4.125">  * (prefstring attribute) is locked.</span>
<a href="#l4.126"></a><span id="l4.126">  *</span>
<a href="#l4.127"></a><span id="l4.127">  * @param amc  the account options controller</span>
<a href="#l4.128"></a><span id="l4.128">  */</span>
<a href="#l4.129"></a><span id="l4.129"> function subtest_check_locked_prefs_server(amc)</span>
<a href="#l4.130"></a><span id="l4.130"> {</span>
<a href="#l4.131"></a><span id="l4.131">   let accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l4.133"></a><span id="l4.133">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.134"></a><span id="l4.134"> </span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-  let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+  let iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l4.137"></a><span id="l4.137"> </span>
<a href="#l4.138"></a><span id="l4.138">   // Top level leaveOnServer checkbox, disabled by default.</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-  let leaveOnServer = iframe.contentDocument.getElementById(&quot;pop3.leaveMessagesOnServer&quot;);</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+  let leaveOnServer = iframe.getElementById(&quot;pop3.leaveMessagesOnServer&quot;);</span>
<a href="#l4.141"></a><span id="l4.141">   assert_false(leaveOnServer.disabled);</span>
<a href="#l4.142"></a><span id="l4.142">   assert_false(leaveOnServer.checked);</span>
<a href="#l4.143"></a><span id="l4.143"> </span>
<a href="#l4.144"></a><span id="l4.144">   // Second level deleteByAge checkbox, disabled by default.</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-  let deleteByAge = iframe.contentDocument.getElementById(&quot;pop3.deleteByAgeFromServer&quot;);</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+  let deleteByAge = iframe.getElementById(&quot;pop3.deleteByAgeFromServer&quot;);</span>
<a href="#l4.147"></a><span id="l4.147">   assert_true(deleteByAge.disabled);</span>
<a href="#l4.148"></a><span id="l4.148">   assert_false(deleteByAge.checked);</span>
<a href="#l4.149"></a><span id="l4.149"> </span>
<a href="#l4.150"></a><span id="l4.150">   // Third level daysToLeave textbox, disabled by default.</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-  let daysToLeave = iframe.contentDocument.getElementById(&quot;pop3.numDaysToLeaveOnServer&quot;);</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+  let daysToLeave = iframe.getElementById(&quot;pop3.numDaysToLeaveOnServer&quot;);</span>
<a href="#l4.153"></a><span id="l4.153">   assert_true(daysToLeave.disabled);</span>
<a href="#l4.154"></a><span id="l4.154"> </span>
<a href="#l4.155"></a><span id="l4.155">   // When leaveOnServer is checked, only deleteByAge will get enabled.</span>
<a href="#l4.156"></a><span id="l4.156">   amc.check(new elib.Elem(leaveOnServer), true);</span>
<a href="#l4.157"></a><span id="l4.157">   assert_true(leaveOnServer.checked);</span>
<a href="#l4.158"></a><span id="l4.158">   assert_false(deleteByAge.disabled);</span>
<a href="#l4.159"></a><span id="l4.159">   assert_true(daysToLeave.disabled);</span>
<a href="#l4.160"></a><span id="l4.160"> </span>
<a href="#l4.161"></a><span id="l4.161" class="difflineat">@@ -251,34 +254,37 @@ function subtest_check_locked_prefs_serv</span>
<a href="#l4.162"></a><span id="l4.162">   // Lock the pref deleteByAge checkbox (middle of the element hierarchy).</span>
<a href="#l4.163"></a><span id="l4.163">   let prefstring = deleteByAge.getAttribute(&quot;prefstring&quot;);</span>
<a href="#l4.164"></a><span id="l4.164">   let controlPref = prefstring.replace(&quot;%serverkey%&quot;, gPopAccount.incomingServer.key);</span>
<a href="#l4.165"></a><span id="l4.165">   Services.prefs.getDefaultBranch(&quot;&quot;).setBoolPref(controlPref, true);</span>
<a href="#l4.166"></a><span id="l4.166">   Services.prefs.lockPref(controlPref);</span>
<a href="#l4.167"></a><span id="l4.167"> </span>
<a href="#l4.168"></a><span id="l4.168">   // Refresh the pane by swithing to another one.</span>
<a href="#l4.169"></a><span id="l4.169">   accountRow = get_account_tree_row(gPopAccount.key, &quot;am-junk.xul&quot;, amc);</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l4.171"></a><span id="l4.171">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.172"></a><span id="l4.172"> </span>
<a href="#l4.173"></a><span id="l4.173">   accountRow = get_account_tree_row(gPopAccount.key, &quot;am-server.xul&quot;, amc);</span>
<a href="#l4.174"></a><span id="l4.174">   click_account_tree_row(amc, accountRow);</span>
<a href="#l4.175"></a><span id="l4.175"> </span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+  // Re-assign iframe.contentDocument because it was lost when changing panes</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+  // (uses loadURI to load a new document).</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+  iframe = amc.e(&quot;contentFrame&quot;).contentDocument;</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+</span>
<a href="#l4.180"></a><span id="l4.180">   // Now leaveOnServer was preserved as checked.</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineminus">-  leaveOnServer = iframe.contentDocument.getElementById(&quot;pop3.leaveMessagesOnServer&quot;);</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+  leaveOnServer = iframe.getElementById(&quot;pop3.leaveMessagesOnServer&quot;);</span>
<a href="#l4.183"></a><span id="l4.183">   assert_false(leaveOnServer.disabled);</span>
<a href="#l4.184"></a><span id="l4.184">   assert_true(leaveOnServer.checked);</span>
<a href="#l4.185"></a><span id="l4.185"> </span>
<a href="#l4.186"></a><span id="l4.186">   // Now deleteByAge was preserved as checked but is locked/disabled.</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-  deleteByAge = iframe.contentDocument.getElementById(&quot;pop3.deleteByAgeFromServer&quot;);</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+  deleteByAge = iframe.getElementById(&quot;pop3.deleteByAgeFromServer&quot;);</span>
<a href="#l4.189"></a><span id="l4.189">   assert_true(deleteByAge.disabled);</span>
<a href="#l4.190"></a><span id="l4.190">   assert_true(deleteByAge.checked);</span>
<a href="#l4.191"></a><span id="l4.191"> </span>
<a href="#l4.192"></a><span id="l4.192">   // Because deleteByAge is checked, daysToLeave should be enabled.</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">-  daysToLeave = iframe.contentDocument.getElementById(&quot;pop3.numDaysToLeaveOnServer&quot;);</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+  daysToLeave = iframe.getElementById(&quot;pop3.numDaysToLeaveOnServer&quot;);</span>
<a href="#l4.195"></a><span id="l4.195">   assert_false(daysToLeave.disabled);</span>
<a href="#l4.196"></a><span id="l4.196"> </span>
<a href="#l4.197"></a><span id="l4.197">   // When leaveOnserver is unchecked, both of deleteByAge and daysToLeave</span>
<a href="#l4.198"></a><span id="l4.198">   // should get disabled.</span>
<a href="#l4.199"></a><span id="l4.199">   amc.check(new elib.Elem(leaveOnServer), false);</span>
<a href="#l4.200"></a><span id="l4.200">   assert_false(leaveOnServer.disabled);</span>
<a href="#l4.201"></a><span id="l4.201">   assert_false(leaveOnServer.checked);</span>
<a href="#l4.202"></a><span id="l4.202"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/account/test-archive-options.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-archive-options.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -32,17 +32,16 @@ function setupModule(module) {</span>
<a href="#l5.4"></a><span id="l5.4">  * Check that the archive options button is enabled or disabled appropriately.</span>
<a href="#l5.5"></a><span id="l5.5">  *</span>
<a href="#l5.6"></a><span id="l5.6">  * @param amc          the account options controller</span>
<a href="#l5.7"></a><span id="l5.7">  * @param aAccountKey  key of the account the check</span>
<a href="#l5.8"></a><span id="l5.8">  * @param isEnabled    true if the button should be enabled, false otherwise</span>
<a href="#l5.9"></a><span id="l5.9">  */</span>
<a href="#l5.10"></a><span id="l5.10"> function subtest_check_archive_options_enabled(amc, aAccountKey, isEnabled) {</span>
<a href="#l5.11"></a><span id="l5.11">   let accountRow = get_account_tree_row(aAccountKey, &quot;am-copies.xul&quot;, amc);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  assert_not_equals(accountRow, -1);</span>
<a href="#l5.13"></a><span id="l5.13">   click_account_tree_row(amc, accountRow);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">   let iframe = amc.window.document.getElementById(&quot;contentFrame&quot;);</span>
<a href="#l5.16"></a><span id="l5.16">   let button = iframe.contentDocument.getElementById(&quot;archiveHierarchyButton&quot;);</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">   assert_equals(button.disabled, !isEnabled);</span>
<a href="#l5.19"></a><span id="l5.19"> }</span>
<a href="#l5.20"></a><span id="l5.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-account-manager-helpers.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-account-manager-helpers.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -71,18 +71,22 @@ function open_advanced_settings_from_acc</span>
<a href="#l6.4"></a><span id="l6.4">  *</span>
<a href="#l6.5"></a><span id="l6.5">  * @param controller the Mozmill controller for the account settings dialog</span>
<a href="#l6.6"></a><span id="l6.6">  * @param rowIndex the row to click</span>
<a href="#l6.7"></a><span id="l6.7">  */</span>
<a href="#l6.8"></a><span id="l6.8"> function click_account_tree_row(controller, rowIndex) {</span>
<a href="#l6.9"></a><span id="l6.9">   utils.waitFor(function () controller.window.currentAccount != null,</span>
<a href="#l6.10"></a><span id="l6.10">                 &quot;Timeout waiting for currentAccount to become non-null&quot;);</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  var tree = controller.window.document.getElementById(&quot;accounttree&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  var selection = tree.view.selection;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  let tree = controller.window.document.getElementById(&quot;accounttree&quot;);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+  if (rowIndex &lt; 0 || rowIndex &gt;= tree.view.rowCount)</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+    throw new Error(&quot;Row &quot; + rowIndex + &quot; does not exist in the account tree!&quot;);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+  let selection = tree.view.selection;</span>
<a href="#l6.20"></a><span id="l6.20">   selection.select(rowIndex);</span>
<a href="#l6.21"></a><span id="l6.21">   tree.treeBoxObject.ensureRowIsVisible(rowIndex);</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">   // get cell coordinates</span>
<a href="#l6.24"></a><span id="l6.24">   var x = {}, y = {}, width = {}, height = {};</span>
<a href="#l6.25"></a><span id="l6.25">   var column = tree.columns[0];</span>
<a href="#l6.26"></a><span id="l6.26">   tree.treeBoxObject.getCoordsForCellItem(rowIndex, column, &quot;text&quot;,</span>
<a href="#l6.27"></a><span id="l6.27">                                            x, y, width, height);</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineat">@@ -98,16 +102,21 @@ function click_account_tree_row(controll</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30"> /**</span>
<a href="#l6.31"></a><span id="l6.31">  * Returns the index of the row in account tree corresponding to the wanted</span>
<a href="#l6.32"></a><span id="l6.32">  * account and its settings pane.</span>
<a href="#l6.33"></a><span id="l6.33">  *</span>
<a href="#l6.34"></a><span id="l6.34">  * @param aAccountKey  The key of the account to return.</span>
<a href="#l6.35"></a><span id="l6.35">  *                     If 'null', the SMTP pane is returned.</span>
<a href="#l6.36"></a><span id="l6.36">  * @param aPaneId      The ID of the account settings pane to select.</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+ *</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+ * @return  The row index of the account and pane. If it was not found return -1.</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+ *          Do not throw as callers may intentionally just check if a row exists.</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+ *          Just dump into the log so that a subsequent throw in</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+ *          click_account_tree_row has a useful context.</span>
<a href="#l6.42"></a><span id="l6.42">  */</span>
<a href="#l6.43"></a><span id="l6.43"> function get_account_tree_row(aAccountKey, aPaneId, aController) {</span>
<a href="#l6.44"></a><span id="l6.44">   let rowIndex = 0;</span>
<a href="#l6.45"></a><span id="l6.45">   let accountTreeNode = aController.e(&quot;account-tree-children&quot;);</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47">   for (let i = 0; i &lt; accountTreeNode.childNodes.length; i++) {</span>
<a href="#l6.48"></a><span id="l6.48">     if (&quot;_account&quot; in accountTreeNode.childNodes[i]) {</span>
<a href="#l6.49"></a><span id="l6.49">       let accountHead = accountTreeNode.childNodes[i];</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineat">@@ -118,22 +127,27 @@ function get_account_tree_row(aAccountKe</span>
<a href="#l6.51"></a><span id="l6.51">         if (!aPaneId)</span>
<a href="#l6.52"></a><span id="l6.52">           return rowIndex;</span>
<a href="#l6.53"></a><span id="l6.53"> </span>
<a href="#l6.54"></a><span id="l6.54">         // Otherwise find the pane in the children.</span>
<a href="#l6.55"></a><span id="l6.55">         for (let j = 0; j &lt; accountBlock.length; j++) {</span>
<a href="#l6.56"></a><span id="l6.56">           if (accountBlock[j].getAttribute(&quot;PageTag&quot;) == aPaneId)</span>
<a href="#l6.57"></a><span id="l6.57">             return rowIndex + j + 1;</span>
<a href="#l6.58"></a><span id="l6.58">         }</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+        // The pane was not found.</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+        dump(&quot;The treerow for pane &quot; + aPaneId + &quot; of account &quot; + aAccountKey + &quot; was not found!\n&quot;);</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+        return -1;</span>
<a href="#l6.63"></a><span id="l6.63">       }</span>
<a href="#l6.64"></a><span id="l6.64">       // If this is not the wanted account, skip all of its settings panes.</span>
<a href="#l6.65"></a><span id="l6.65">       rowIndex += accountHead.getElementsByAttribute(&quot;PageTag&quot;, &quot;*&quot;).length;</span>
<a href="#l6.66"></a><span id="l6.66">     } else {</span>
<a href="#l6.67"></a><span id="l6.67">       // A row without _account should be the SMTP server.</span>
<a href="#l6.68"></a><span id="l6.68">       if (aAccountKey == null)</span>
<a href="#l6.69"></a><span id="l6.69">         return rowIndex;</span>
<a href="#l6.70"></a><span id="l6.70">     }</span>
<a href="#l6.71"></a><span id="l6.71">     rowIndex++;</span>
<a href="#l6.72"></a><span id="l6.72">   }</span>
<a href="#l6.73"></a><span id="l6.73"> </span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-  // Account not found</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+  // The account was not found.</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+  dump(&quot;The treerow for account &quot; + aAccountKey + &quot; was not found!\n&quot;);</span>
<a href="#l6.77"></a><span id="l6.77">   return -1;</span>
<a href="#l6.78"></a><span id="l6.78"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

