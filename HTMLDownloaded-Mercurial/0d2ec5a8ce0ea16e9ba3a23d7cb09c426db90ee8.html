<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10404:0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8" />
<meta property="og:url" content="/comm-central/rev/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8" />
<meta property="og:description" content="Bug 131571 - [RFE] when clicking on a mail adress that is already in the adressbook the option should be &quot;edit address book entry&quot;, not &quot;add to address book&quot; r=mnyromyr" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">shortlog</a> |
<a href="/comm-central/log/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">files</a> |
changeset |
<a href="/comm-central/raw-rev/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">raw</a>  | <a href="/comm-central/archive/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=131571">Bug 131571</a> - [RFE] when clicking on a mail adress that is already in the adressbook the option should be &quot;edit address book entry&quot;, not &quot;add to address book&quot; r=mnyromyr
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 09 Jun 2012 23:40:07 +0100</td></tr>

<tr>
 <td>changeset 10404</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8</a></td>
</tr>



<tr>
<td>parent 10403</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f6fb7d268bcad18e384a0f5b6ace17d5b24fdb50">f6fb7d268bcad18e384a0f5b6ace17d5b24fdb50</a>
</td>
</tr>

<tr>
<td>child 10405</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/172686daec1064e15c8860f71231e17ba92e7c48">172686daec1064e15c8860f71231e17ba92e7c48</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8">7871</a></td></tr>
<tr><td>push user</td><td>iann_cvs@blueyonder.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Sat, 09 Jun 2012 22:40:44 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@81cae5edbac8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=81cae5edbac873bd2c220d7ea8c71f8fbc5c4027">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=81cae5edbac873bd2c220d7ea8c71f8fbc5c4027&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81cae5edbac873bd2c220d7ea8c71f8fbc5c4027&newProject=comm-central&newRevision=0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81cae5edbac873bd2c220d7ea8c71f8fbc5c4027&newProject=comm-central&newRevision=0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=81cae5edbac873bd2c220d7ea8c71f8fbc5c4027&newProject=comm-central&newRevision=0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mnyromyr%29&revcount=50">mnyromyr</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=131571">131571</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=131571">Bug 131571</a> - [RFE] when clicking on a mail adress that is already in the adressbook the option should be &quot;edit address book entry&quot;, not &quot;add to address book&quot; r=mnyromyr</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd">suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd">file</a> |
<a href="/comm-central/annotate/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd">annotate</a> |
<a href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd">diff</a> |
<a href="/comm-central/comparison/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd">comparison</a> |
<a href="/comm-central/log/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailContextMenus.js">suite/mailnews/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailWidgets.xml">suite/mailnews/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.js">suite/mailnews/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.xul">suite/mailnews/msgHdrViewOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.xul">file</a> |
<a href="/comm-central/annotate/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.xul">annotate</a> |
<a href="/comm-central/diff/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.xul">diff</a> |
<a href="/comm-central/comparison/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.xul">comparison</a> |
<a href="/comm-central/log/0d2ec5a8ce0ea16e9ba3a23d7cb09c426db90ee8/suite/mailnews/msgHdrViewOverlay.xul">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/msgHdrViewPopup.dtd</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,15 +1,19 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> &lt;!-- Message Header View Popup --&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;!ENTITY AddToAddressBook.label            &quot;Add To Address Book…&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;!ENTITY AddToAddressBook.accesskey        &quot;B&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+&lt;!ENTITY EditContact.label                 &quot;Edit Contact…&quot;&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+&lt;!ENTITY EditContact.accesskey             &quot;E&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+&lt;!ENTITY ViewContact.label                 &quot;View Contact&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+&lt;!ENTITY ViewContact.accesskey             &quot;V&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;!ENTITY SendMailTo.label                  &quot;Compose Mail To…&quot;&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> &lt;!ENTITY SendMailTo.accesskey              &quot;s&quot;&gt;</span>
<a href="#l1.17"></a><span id="l1.17"> &lt;!ENTITY CopyEmailAddress.label            &quot;Copy Email Address&quot;&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;!ENTITY CopyEmailAddress.accesskey        &quot;C&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19"> &lt;!ENTITY CreateFilterFrom.label            &quot;Create Filter From…&quot;&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> &lt;!ENTITY CreateFilterFrom.accesskey        &quot;F&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21"> &lt;!ENTITY openInBrowser.label               &quot;Open in Browser&quot;&gt;</span>
<a href="#l1.22"></a><span id="l1.22"> &lt;!ENTITY openInBrowser.accesskey           &quot;O&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/mailnews/mailContextMenus.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/mailnews/mailContextMenus.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -410,30 +410,41 @@ function ShowSeparator(aSeparatorID)</span>
<a href="#l2.4"></a><span id="l2.4">   // Check to see if there are visible siblings before the next and</span>
<a href="#l2.5"></a><span id="l2.5">   // previous separators.</span>
<a href="#l2.6"></a><span id="l2.6">   var hidden = SiblingHidden(separator.nextSibling, true) ||</span>
<a href="#l2.7"></a><span id="l2.7">                SiblingHidden(separator.previousSibling, false);</span>
<a href="#l2.8"></a><span id="l2.8">   ShowMenuItem(aSeparatorID, !hidden);</span>
<a href="#l2.9"></a><span id="l2.9"> }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> // message pane context menu helper methods</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-function AddNodeToAddressBook(emailAddressNode)</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+function AddContact(aEmailAddressNode)</span>
<a href="#l2.14"></a><span id="l2.14"> {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-  if (emailAddressNode)</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-    AddEmailToAddressBook(emailAddressNode.getAttribute(&quot;emailAddress&quot;),</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                          emailAddressNode.getAttribute(&quot;displayName&quot;));</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  if (aEmailAddressNode)</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    AddEmailToAddressBook(aEmailAddressNode.getAttribute(&quot;emailAddress&quot;),</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+                          aEmailAddressNode.getAttribute(&quot;displayName&quot;));</span>
<a href="#l2.21"></a><span id="l2.21"> }</span>
<a href="#l2.22"></a><span id="l2.22"> </span>
<a href="#l2.23"></a><span id="l2.23"> function AddEmailToAddressBook(primaryEmail, displayName)</span>
<a href="#l2.24"></a><span id="l2.24"> {</span>
<a href="#l2.25"></a><span id="l2.25">     window.openDialog(&quot;chrome://messenger/content/addressbook/abNewCardDialog.xul&quot;,</span>
<a href="#l2.26"></a><span id="l2.26">                       &quot;&quot;, &quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;,</span>
<a href="#l2.27"></a><span id="l2.27">                       {primaryEmail:primaryEmail, displayName:displayName});</span>
<a href="#l2.28"></a><span id="l2.28"> }</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+function EditContact(aEmailAddressNode)</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+{</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  if (aEmailAddressNode.cardDetails.card)</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+  {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    window.openDialog(&quot;chrome://messenger/content/addressbook/abEditCardDialog.xul&quot;,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+                      &quot;&quot;, &quot;chrome,resizable=no,modal,titlebar,centerscreen&quot;,</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+                      { abURI: aEmailAddressNode.cardDetails.book.URI,</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+                        card: aEmailAddressNode.cardDetails.card });</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  }</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+}</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+</span>
<a href="#l2.41"></a><span id="l2.41"> // SendMailToNode takes the email address title button, extracts</span>
<a href="#l2.42"></a><span id="l2.42"> // the email address we stored in there and opens a compose window</span>
<a href="#l2.43"></a><span id="l2.43"> // with that address</span>
<a href="#l2.44"></a><span id="l2.44"> function SendMailToNode(emailAddressNode)</span>
<a href="#l2.45"></a><span id="l2.45"> {</span>
<a href="#l2.46"></a><span id="l2.46">   if (emailAddressNode)</span>
<a href="#l2.47"></a><span id="l2.47">     SendMailTo(emailAddressNode.getAttribute(&quot;fullAddress&quot;));</span>
<a href="#l2.48"></a><span id="l2.48"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/mailnews/mailWidgets.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/mailnews/mailWidgets.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -307,22 +307,22 @@</span>
<a href="#l3.4"></a><span id="l3.4">             // Note: No extra colon and space needed, since it is</span>
<a href="#l3.5"></a><span id="l3.5">             // already provided by this object's label attribute.</span>
<a href="#l3.6"></a><span id="l3.6">             var ariaLabel = this.getAttribute(&quot;label&quot;) +</span>
<a href="#l3.7"></a><span id="l3.7">                             aEmailNode.getAttribute(&quot;label&quot;);</span>
<a href="#l3.8"></a><span id="l3.8">             aEmailNode.setAttribute(&quot;aria-label&quot;, ariaLabel);</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">             try</span>
<a href="#l3.11"></a><span id="l3.11">             {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-              if (&quot;AddExtraAddressProcessing&quot; in top)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                AddExtraAddressProcessing(aAddress.emailAddress, aEmailNode);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+              if (&quot;UpdateEmailNodeDetails&quot; in top)</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+                UpdateEmailNodeDetails(aAddress.emailAddress, aEmailNode);</span>
<a href="#l3.16"></a><span id="l3.16">             }</span>
<a href="#l3.17"></a><span id="l3.17">             catch(ex)</span>
<a href="#l3.18"></a><span id="l3.18">             {</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-              dump(&quot;AddExtraAddressProcessing failed: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+              dump(&quot;UpdateEmailNodeDetails failed: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l3.21"></a><span id="l3.21">             }</span>
<a href="#l3.22"></a><span id="l3.22">           ]]&gt;</span>
<a href="#l3.23"></a><span id="l3.23">         &lt;/body&gt;</span>
<a href="#l3.24"></a><span id="l3.24">       &lt;/method&gt;</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">       &lt;!-- fillCachedAddresses: private method used to fill up any cached pre-existing</span>
<a href="#l3.27"></a><span id="l3.27">            emailAddress fields without creating new email address fields. Returns a remainder</span>
<a href="#l3.28"></a><span id="l3.28">            for the # of addresses which require new addresses being created.</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineat">@@ -384,16 +384,21 @@</span>
<a href="#l3.30"></a><span id="l3.30">               aNumAddressesToShow = numAddresses;</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">             // before we try to create email address nodes, try to leverage any cached nodes...</span>
<a href="#l3.33"></a><span id="l3.33">             var remainder = this.fillCachedAddresses(aAddressesNode, aNumAddressesToShow);</span>
<a href="#l3.34"></a><span id="l3.34">             var index = numAddresses - remainder;</span>
<a href="#l3.35"></a><span id="l3.35">             while (index &lt; numAddresses &amp;&amp; index &lt; aNumAddressesToShow)</span>
<a href="#l3.36"></a><span id="l3.36">             {</span>
<a href="#l3.37"></a><span id="l3.37">               var newAddressNode = document.createElement(&quot;mail-emailaddress&quot;);</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+              // Stash the headerName somewhere that UpdateEmailNodeDetails</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+              // will be able to find it.</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+              newAddressNode.setAttribute(&quot;headerName&quot;, this.headerName);</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+</span>
<a href="#l3.43"></a><span id="l3.43">               if (index)</span>
<a href="#l3.44"></a><span id="l3.44">               {</span>
<a href="#l3.45"></a><span id="l3.45">                 var textNode = document.createElement(&quot;text&quot;);</span>
<a href="#l3.46"></a><span id="l3.46">                 textNode.setAttribute(&quot;value&quot;, &quot;, &quot;);</span>
<a href="#l3.47"></a><span id="l3.47">                 textNode.setAttribute(&quot;class&quot;, &quot;emailSeparator&quot;);</span>
<a href="#l3.48"></a><span id="l3.48">                 aAddressesNode.appendChild(textNode);</span>
<a href="#l3.49"></a><span id="l3.49">               }</span>
<a href="#l3.50"></a><span id="l3.50"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/mailnews/msgHdrViewOverlay.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/mailnews/msgHdrViewOverlay.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -86,16 +86,20 @@ var gExpandedHeaderList = [ {name:&quot;subje</span>
<a href="#l4.4"></a><span id="l4.4">                             {name:&quot;cc&quot;, useToggle:true, outputFunction:OutputEmailAddresses},</span>
<a href="#l4.5"></a><span id="l4.5">                             {name:&quot;bcc&quot;, useToggle:true, outputFunction:OutputEmailAddresses},</span>
<a href="#l4.6"></a><span id="l4.6">                             {name:&quot;newsgroups&quot;, outputFunction:OutputNewsgroups},</span>
<a href="#l4.7"></a><span id="l4.7">                             {name:&quot;references&quot;, outputFunction:OutputMessageIds},</span>
<a href="#l4.8"></a><span id="l4.8">                             {name:&quot;followup-to&quot;, outputFunction:OutputNewsgroups},</span>
<a href="#l4.9"></a><span id="l4.9">                             {name:&quot;content-base&quot;},</span>
<a href="#l4.10"></a><span id="l4.10">                             {name:&quot;tags&quot;} ];</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+// These are all the items that use a mail-multi-emailHeaderField widget and</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+// therefore may require updating if the address book changes.</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+const gEmailAddressHeaderNames = [&quot;from&quot;, &quot;reply-to&quot;, &quot;to&quot;, &quot;cc&quot;, &quot;bcc&quot;];</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+</span>
<a href="#l4.16"></a><span id="l4.16"> // Now, for each view the message pane can generate, we need a global table of headerEntries. These</span>
<a href="#l4.17"></a><span id="l4.17"> // header entry objects are generated dynamically based on the static data in the header lists (see above)</span>
<a href="#l4.18"></a><span id="l4.18"> // and elements we find in the DOM based on properties in the header lists.</span>
<a href="#l4.19"></a><span id="l4.19"> var gCollapsedHeaderView = {};</span>
<a href="#l4.20"></a><span id="l4.20"> var gExpandedHeaderView  = {};</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22"> // currentHeaderData --&gt; this is an array of header name and value pairs for the currently displayed message.</span>
<a href="#l4.23"></a><span id="l4.23"> //                       it's purely a data object and has no view information. View information is contained in the view objects.</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineat">@@ -108,16 +112,20 @@ var currentHeaderData = {};</span>
<a href="#l4.25"></a><span id="l4.25"> // view, it's up to the view layer to extract this attachment data and turn it into something useful.</span>
<a href="#l4.26"></a><span id="l4.26"> // For a given entry in the attachments list, you can ask for the following properties:</span>
<a href="#l4.27"></a><span id="l4.27"> // .contentType --&gt; the content type of the attachment</span>
<a href="#l4.28"></a><span id="l4.28"> // url --&gt; an imap, or mailbox url which can be used to fetch the message</span>
<a href="#l4.29"></a><span id="l4.29"> // uri --&gt; an RDF URI which refers to the message containig the attachment</span>
<a href="#l4.30"></a><span id="l4.30"> // isExternalAttachment --&gt; boolean flag stating whether the attachment is external or not.</span>
<a href="#l4.31"></a><span id="l4.31"> var currentAttachments = new Array();</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+const nsIAbDirectory = Components.interfaces.nsIAbDirectory;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+const nsIAbListener = Components.interfaces.nsIAbListener;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+const nsIAbCard = Components.interfaces.nsIAbCard;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+</span>
<a href="#l4.37"></a><span id="l4.37"> // createHeaderEntry --&gt; our constructor method which creates a header Entry</span>
<a href="#l4.38"></a><span id="l4.38"> // based on an entry in one of the header lists. A header entry is different from a header list.</span>
<a href="#l4.39"></a><span id="l4.39"> // a header list just describes how you want a particular header to be presented. The header entry</span>
<a href="#l4.40"></a><span id="l4.40"> // actually has knowledge about the DOM and the actual DOM elements associated with the header.</span>
<a href="#l4.41"></a><span id="l4.41"> // prefix --&gt; the name of the view (i.e. &quot;collapsed&quot;, &quot;expanded&quot;)</span>
<a href="#l4.42"></a><span id="l4.42"> // headerListInfo --&gt; entry from a header list.</span>
<a href="#l4.43"></a><span id="l4.43"> function createHeaderEntry(prefix, headerListInfo)</span>
<a href="#l4.44"></a><span id="l4.44"> {</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineat">@@ -152,16 +160,22 @@ function createHeaderEntry(prefix, heade</span>
<a href="#l4.46"></a><span id="l4.46"> </span>
<a href="#l4.47"></a><span id="l4.47">   if (this.textNode)</span>
<a href="#l4.48"></a><span id="l4.48">     this.textNode.useShortView = useShortView;</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50">   if (&quot;outputFunction&quot; in headerListInfo)</span>
<a href="#l4.51"></a><span id="l4.51">     this.outputFunction = headerListInfo.outputFunction;</span>
<a href="#l4.52"></a><span id="l4.52">   else</span>
<a href="#l4.53"></a><span id="l4.53">     this.outputFunction = updateHeaderValue;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+  // Stash this so that the &lt;mail-multi-emailheaderfield/&gt; binding can</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+  // later attach it to any &lt;mail-emailaddress&gt; tags it creates for later</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+  // extraction and use by UpdateEmailNodeDetails.</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+  this.enclosingBox.headerName = headerListInfo.name;</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+</span>
<a href="#l4.60"></a><span id="l4.60"> }</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62"> function initializeHeaderViewTables()</span>
<a href="#l4.63"></a><span id="l4.63"> {</span>
<a href="#l4.64"></a><span id="l4.64">   // iterate over each header in our header list arrays and create header entries</span>
<a href="#l4.65"></a><span id="l4.65">   // for each one. These header entries are then stored in the appropriate header table</span>
<a href="#l4.66"></a><span id="l4.66">   for (let index = 0; index &lt; gCollapsedHeaderList.length; index++)</span>
<a href="#l4.67"></a><span id="l4.67">   {</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineat">@@ -220,31 +234,41 @@ function OnLoadMsgHeaderPane()</span>
<a href="#l4.69"></a><span id="l4.69">   gShowReferences = pref.getBoolPref(&quot;mailnews.headers.showReferences&quot;);</span>
<a href="#l4.70"></a><span id="l4.70">   gShowMessageId = pref.getBoolPref(&quot;mailnews.headers.showMessageId&quot;);</span>
<a href="#l4.71"></a><span id="l4.71">   gExtraExpandedHeaders = pref.getCharPref(&quot;mailnews.headers.extraExpandedHeaders&quot;);</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73">   pref.addObserver(&quot;mail.showCondensedAddresses&quot;, MsgHdrViewObserver, false);</span>
<a href="#l4.74"></a><span id="l4.74"> </span>
<a href="#l4.75"></a><span id="l4.75">   initializeHeaderViewTables();</span>
<a href="#l4.76"></a><span id="l4.76"> </span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+  // Add an address book listener so we can update the header view when things</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+  // change.</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+  Components.classes[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+            .getService(Components.interfaces.nsIAbManager)</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+            .addAddressBookListener(AddressBookListener, nsIAbListener.all);</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+</span>
<a href="#l4.83"></a><span id="l4.83">   var toggleHeaderView = GetHeaderPane();</span>
<a href="#l4.84"></a><span id="l4.84">   var initialCollapsedSetting = toggleHeaderView.getAttribute(&quot;state&quot;);</span>
<a href="#l4.85"></a><span id="l4.85">   if (initialCollapsedSetting == &quot;true&quot;)</span>
<a href="#l4.86"></a><span id="l4.86">     gCollapsedHeaderViewMode = true;   </span>
<a href="#l4.87"></a><span id="l4.87"> </span>
<a href="#l4.88"></a><span id="l4.88">   // dispatch an event letting any listeners know that we have loaded the message pane</span>
<a href="#l4.89"></a><span id="l4.89">   var event = document.createEvent('Events');</span>
<a href="#l4.90"></a><span id="l4.90">   event.initEvent('messagepane-loaded', false, true);</span>
<a href="#l4.91"></a><span id="l4.91">   toggleHeaderView.dispatchEvent(event);</span>
<a href="#l4.92"></a><span id="l4.92"> }</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94"> function OnUnloadMsgHeaderPane()</span>
<a href="#l4.95"></a><span id="l4.95"> {</span>
<a href="#l4.96"></a><span id="l4.96">   pref.removeObserver(&quot;mail.showCondensedAddresses&quot;, MsgHdrViewObserver);</span>
<a href="#l4.97"></a><span id="l4.97"> </span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+  Components.classes[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+            .getService(Components.interfaces.nsIAbManager)</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+            .removeAddressBookListener(AddressBookListener);</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+</span>
<a href="#l4.102"></a><span id="l4.102">   // dispatch an event letting any listeners know that we have unloaded the message pane</span>
<a href="#l4.103"></a><span id="l4.103">   var event = document.createEvent('Events');</span>
<a href="#l4.104"></a><span id="l4.104">   event.initEvent('messagepane-unloaded', false, true);</span>
<a href="#l4.105"></a><span id="l4.105">   GetHeaderPane().dispatchEvent(event);</span>
<a href="#l4.106"></a><span id="l4.106"> }</span>
<a href="#l4.107"></a><span id="l4.107"> </span>
<a href="#l4.108"></a><span id="l4.108"> const MsgHdrViewObserver =</span>
<a href="#l4.109"></a><span id="l4.109"> {</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineat">@@ -257,16 +281,63 @@ const MsgHdrViewObserver =</span>
<a href="#l4.111"></a><span id="l4.111">       {</span>
<a href="#l4.112"></a><span id="l4.112">         gShowCondensedEmailAddresses = pref.getBoolPref(&quot;mail.showCondensedAddresses&quot;);</span>
<a href="#l4.113"></a><span id="l4.113">         ReloadMessage();</span>
<a href="#l4.114"></a><span id="l4.114">       }</span>
<a href="#l4.115"></a><span id="l4.115">     }</span>
<a href="#l4.116"></a><span id="l4.116">   }</span>
<a href="#l4.117"></a><span id="l4.117"> };</span>
<a href="#l4.118"></a><span id="l4.118"> </span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+var AddressBookListener =</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+{</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+  onItemAdded: function(aParentDir, aItem) {</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+    OnAddressBookDataChanged(nsIAbListener.itemAdded,</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+                             aParentDir, aItem);</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+  },</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+  onItemRemoved: function(aParentDir, aItem) {</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+    OnAddressBookDataChanged(aItem instanceof nsIAbCard ?</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+                               nsIAbListener.directoryItemRemoved :</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+                               nsIAbListener.directoryRemoved,</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+                             aParentDir, aItem);</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+  },</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+  onItemPropertyChanged: function(aItem, aProperty, aOldValue, aNewValue) {</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+    // We only need updates for card changes, address book and mailing list</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+    // ones don't affect us here.</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+    if (aItem instanceof nsIAbCard)</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+      OnAddressBookDataChanged(nsIAbListener.itemChanged, null, aItem);</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+  }</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+};</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+function OnAddressBookDataChanged(aAction, aParentDir, aItem)</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+{</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+  gEmailAddressHeaderNames.forEach(function (aHeaderName)</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+  {</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+    var headerEntry = null;</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+    // Ensure both collapsed and expanded are updated in case we toggle</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+    // between the two.</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+    if (aHeaderName in gCollapsedHeaderView)</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+    {</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+      headerEntry = gCollapsedHeaderView[aHeaderName];</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+      if (headerEntry)</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+        headerEntry.enclosingBox.updateExtraAddressProcessing(aAction,</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+                                                              aParentDir,</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineplus">+                                                              aItem);</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+    }</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+    if (aHeaderName in gExpandedHeaderView)</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+    {</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineplus">+      headerEntry = gExpandedHeaderView[aHeaderName];</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+      if (headerEntry)</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+        headerEntry.enclosingBox.updateExtraAddressProcessing(aAction,</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+                                                              aParentDir,</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+                                                              aItem);</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+    }</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineplus">+  });</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineplus">+}</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+</span>
<a href="#l4.166"></a><span id="l4.166"> // The messageHeaderSink is the class that gets notified of a message's headers as we display the message</span>
<a href="#l4.167"></a><span id="l4.167"> // through our mime converter.</span>
<a href="#l4.168"></a><span id="l4.168"> </span>
<a href="#l4.169"></a><span id="l4.169"> var messageHeaderSink = {</span>
<a href="#l4.170"></a><span id="l4.170">     QueryInterface: XPCOMUtils.generateQI(</span>
<a href="#l4.171"></a><span id="l4.171">       [Components.interfaces.nsIMsgHeaderSink]),</span>
<a href="#l4.172"></a><span id="l4.172">     onStartHeaders: function()</span>
<a href="#l4.173"></a><span id="l4.173">     {</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineat">@@ -1071,88 +1142,186 @@ function setFromBuddyIcon(email)</span>
<a href="#l4.175"></a><span id="l4.175">     }</span>
<a href="#l4.176"></a><span id="l4.176">   }</span>
<a href="#l4.177"></a><span id="l4.177"> </span>
<a href="#l4.178"></a><span id="l4.178">   fromBuddyIcon.setAttribute(&quot;src&quot;, &quot;&quot;);</span>
<a href="#l4.179"></a><span id="l4.179"> }</span>
<a href="#l4.180"></a><span id="l4.180"> </span>
<a href="#l4.181"></a><span id="l4.181"> function updateEmailAddressNode(emailAddressNode, address)</span>
<a href="#l4.182"></a><span id="l4.182"> {</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineminus">-  emailAddressNode.setAttribute(&quot;label&quot;, address.fullAddress || address.displayName);</span>
<a href="#l4.184"></a><span id="l4.184">   emailAddressNode.setAttribute(&quot;emailAddress&quot;, address.emailAddress);</span>
<a href="#l4.185"></a><span id="l4.185">   emailAddressNode.setAttribute(&quot;fullAddress&quot;, address.fullAddress);</span>
<a href="#l4.186"></a><span id="l4.186">   emailAddressNode.setAttribute(&quot;displayName&quot;, address.displayName);</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineminus">-  emailAddressNode.removeAttribute(&quot;tooltiptext&quot;);</span>
<a href="#l4.188"></a><span id="l4.188"> </span>
<a href="#l4.189"></a><span id="l4.189" class="difflineminus">-  AddExtraAddressProcessing(address.emailAddress, emailAddressNode);</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+  UpdateEmailNodeDetails(address.emailAddress, emailAddressNode);</span>
<a href="#l4.191"></a><span id="l4.191"> }</span>
<a href="#l4.192"></a><span id="l4.192"> </span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">-// If the email address is found in any of the address books,</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineminus">-// then consider this user a 'known' user and use the display name.</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-function AddExtraAddressProcessing(emailAddress, addressNode)</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+function UpdateEmailNodeDetails(aEmailAddress, aDocumentNode, aCardDetails)</span>
<a href="#l4.197"></a><span id="l4.197"> {</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-  if (!gShowCondensedEmailAddresses)</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-    return;</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineplus">+  // If we haven't been given specific details, search for a card.</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineplus">+  var cardDetails = aCardDetails || GetCardForEmail(aEmailAddress);</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineplus">+  aDocumentNode.cardDetails = cardDetails;</span>
<a href="#l4.203"></a><span id="l4.203"> </span>
<a href="#l4.204"></a><span id="l4.204" class="difflineplus">+  var condense = gShowCondensedEmailAddresses;</span>
<a href="#l4.205"></a><span id="l4.205">   // Get the id of the mail-multi-emailHeaderField binding parent.</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-  var parentElementId = addressNode.parentNode.parentNode.parentNode.id;</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+  var parentElementId = aDocumentNode.parentNode.parentNode.parentNode.id;</span>
<a href="#l4.208"></a><span id="l4.208">   // Don't condense the address for the from and reply-to fields.</span>
<a href="#l4.209"></a><span id="l4.209">   // Ids: &quot;collapsedfromValue&quot;, &quot;expandedfromBox&quot;, &quot;expandedreply-toBox&quot;.</span>
<a href="#l4.210"></a><span id="l4.210">   if (/^(collapsedfromValue|expanded(from|reply-to)Box)$/.test(parentElementId))</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-    return;</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+    condense = false;</span>
<a href="#l4.213"></a><span id="l4.213"> </span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-  // TODO: Maybe do domain matches too (i.e. any email from someone in my</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-  // company should use the friendly display name).</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineplus">+  var displayName = &quot;&quot;;</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+  if (condense &amp;&amp; cardDetails.card)</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineplus">+    displayName = cardDetails.card.displayName;</span>
<a href="#l4.219"></a><span id="l4.219"> </span>
<a href="#l4.220"></a><span id="l4.220" class="difflineminus">-  var card = getCardForAddress(emailAddress);</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-  if (!(card &amp;&amp; card.displayName))</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineminus">-    return;</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+  if (displayName)</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+  {</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+    aDocumentNode.setAttribute(&quot;tooltiptext&quot;, aEmailAddress);</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineplus">+  }</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineplus">+  else</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+  {</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+    aDocumentNode.removeAttribute(&quot;tooltiptext&quot;);</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+    displayName = aDocumentNode.getAttribute(&quot;fullAddress&quot;) ||</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+                  aDocumentNode.getAttribute(&quot;displayName&quot;);</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+  }</span>
<a href="#l4.233"></a><span id="l4.233"> </span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-  addressNode.setAttribute(&quot;label&quot;, card.displayName);</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-  addressNode.setAttribute(&quot;tooltiptext&quot;, emailAddress);</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineplus">+  aDocumentNode.setAttribute(&quot;label&quot;, displayName);</span>
<a href="#l4.237"></a><span id="l4.237"> }</span>
<a href="#l4.238"></a><span id="l4.238"> </span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-function fillEmailAddressPopup(emailAddressNode)</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineplus">+function UpdateExtraAddressProcessing(aAddressData, aDocumentNode, aAction,</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineplus">+                                      aParentDir, aItem)</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineplus">+{</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineplus">+  switch (aAction)</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineplus">+  {</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineplus">+    case nsIAbListener.itemChanged:</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineplus">+      if (aAddressData &amp;&amp;</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+          aDocumentNode.cardDetails.card &amp;&amp;</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+          aItem.hasEmailAddress(aAddressData.emailAddress)) {</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineplus">+        aDocumentNode.cardDetails.card = aItem;</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+        UpdateEmailNodeDetails(aAddressData.emailAddress, aDocumentNode,</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineplus">+                               aDocumentNode.cardDetails);</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+      }</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+      break;</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineplus">+    case nsIAbListener.itemAdded:</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+      // Is it a new address book?</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+      if (aItem instanceof nsIAbDirectory)</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineplus">+      {</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineplus">+        // If we don't have a match, search again for updates (e.g. a interface</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+        // to an existing book may just have been added).</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineplus">+        if (!aDocumentNode.cardDetails.card)</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineplus">+          UpdateEmailNodeDetails(aAddressData.emailAddress, aDocumentNode);</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineplus">+      }</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineplus">+      else if (aItem instanceof nsIAbCard)</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineplus">+      {</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineplus">+        // If we don't have a card, does this new one match?</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineplus">+        if (!aDocumentNode.cardDetails.card &amp;&amp;</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineplus">+            aItem.hasEmailAddress(aAddressData.emailAddress))</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineplus">+        {</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineplus">+          // Just in case we have a bogus parent directory.</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineplus">+          if (aParentDir instanceof nsIAbDirectory)</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineplus">+          {</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineplus">+            let cardDetails = { book: aParentDir, card: aItem };</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineplus">+            UpdateEmailNodeDetails(aAddressData.emailAddress, aDocumentNode,</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+                                   cardDetails);</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+          }</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+          else</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineplus">+          {</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineplus">+            UpdateEmailNodeDetails(aAddressData.emailAddress, aDocumentNode);</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+          }</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineplus">+        }</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineplus">+      }</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineplus">+      break;</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineplus">+    case nsIAbListener.directoryItemRemoved:</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+      // Unfortunately we don't necessarily get the same card object back.</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+      if (aAddressData &amp;&amp;</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineplus">+          aDocumentNode.cardDetails.card &amp;&amp;</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineplus">+          aDocumentNode.cardDetails.book == aParentDir &amp;&amp;</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineplus">+          aItem.hasEmailAddress(aAddressData.emailAddress))</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineplus">+      {</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineplus">+        UpdateEmailNodeDetails(aAddressData.emailAddress, aDocumentNode);</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+      }</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+      break;</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineplus">+    case nsIAbListener.directoryRemoved:</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineplus">+      if (aDocumentNode.cardDetails.book == aItem)</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineplus">+        UpdateEmailNodeDetails(aAddressData.emailAddress, aDocumentNode);</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineplus">+      break;</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineplus">+  }</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineplus">+}</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineplus">+</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineplus">+function SetupEmailAddressPopup(aAddressNode)</span>
<a href="#l4.301"></a><span id="l4.301"> {</span>
<a href="#l4.302"></a><span id="l4.302">   document.getElementById(&quot;emailAddressPlaceHolder&quot;)</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-          .setAttribute(&quot;label&quot;, emailAddressNode.getAttribute(&quot;emailAddress&quot;));</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineplus">+          .setAttribute(&quot;label&quot;, aAddressNode.getAttribute(&quot;emailAddress&quot;));</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineplus">+</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineplus">+  var addItem = document.getElementById(&quot;addToAddressBookItem&quot;);</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineplus">+  var editItem = document.getElementById(&quot;editContactItem&quot;);</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineplus">+  var viewItem = document.getElementById(&quot;viewContactItem&quot;);</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineplus">+</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineplus">+  if (aAddressNode.cardDetails.card)</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineplus">+  {</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineplus">+    addItem.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineplus">+    if (!aAddressNode.cardDetails.book.readOnly)</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineplus">+    {</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineplus">+      editItem.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineplus">+      viewItem.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineplus">+    }</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineplus">+    else</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineplus">+    {</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineplus">+      editItem.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineplus">+      viewItem.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineplus">+    }</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineplus">+  }</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineplus">+  else</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineplus">+  {</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineplus">+    addItem.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineplus">+    editItem.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineplus">+    viewItem.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineplus">+  }</span>
<a href="#l4.330"></a><span id="l4.330"> }</span>
<a href="#l4.331"></a><span id="l4.331"> </span>
<a href="#l4.332"></a><span id="l4.332"> /**</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">- * Returns a card matching the given address, or |null|.</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">- * Searches all (searchable) address books, until a (first) card is found.</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineplus">+ * Returns an object with two properties, book and card. If the email address</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineplus">+ * is found in the address books, then book will contain an nsIAbDirectory,</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+ * and card will contain an nsIAbCard. If the email address is not found, both</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineplus">+ * properties will be null.</span>
<a href="#l4.339"></a><span id="l4.339">  *</span>
<a href="#l4.340"></a><span id="l4.340">  * @param emailAddress The email address to find.</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">- * @return A card, or |null|.</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineplus">+ * @return An object with two properties, book and card.</span>
<a href="#l4.343"></a><span id="l4.343">  * @see nsIAbDirectory.cardForEmailAddress()</span>
<a href="#l4.344"></a><span id="l4.344">  */</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-function getCardForAddress(emailAddress)</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineplus">+function GetCardForEmail(aEmailAddress)</span>
<a href="#l4.347"></a><span id="l4.347"> {</span>
<a href="#l4.348"></a><span id="l4.348">   var books = Components.classes[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l4.349"></a><span id="l4.349">                         .getService(Components.interfaces.nsIAbManager)</span>
<a href="#l4.350"></a><span id="l4.350">                         .directories;</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-  while (books.hasMoreElements())</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineplus">+</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineplus">+  var result = { book: null, card: null};</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineplus">+</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineplus">+  while (!result.card &amp;&amp; books.hasMoreElements())</span>
<a href="#l4.356"></a><span id="l4.356">   {</span>
<a href="#l4.357"></a><span id="l4.357">     var ab = books.getNext();</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-    if (ab instanceof Components.interfaces.nsIAbDirectory)</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineplus">+    if (ab instanceof nsIAbDirectory)</span>
<a href="#l4.360"></a><span id="l4.360">     {</span>
<a href="#l4.361"></a><span id="l4.361">       try</span>
<a href="#l4.362"></a><span id="l4.362">       {</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-        var card = ab.cardForEmailAddress(emailAddress);</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineplus">+        var card = ab.cardForEmailAddress(aEmailAddress);</span>
<a href="#l4.365"></a><span id="l4.365">         if (card)</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineminus">-          return card;</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineplus">+        {</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineplus">+          result.book = ab;</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineplus">+          result.card = card;</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineplus">+        }</span>
<a href="#l4.371"></a><span id="l4.371">       }</span>
<a href="#l4.372"></a><span id="l4.372">       catch (ex)</span>
<a href="#l4.373"></a><span id="l4.373">       {</span>
<a href="#l4.374"></a><span id="l4.374">         // Unsearchable address books throw |NS_ERROR_NOT_IMPLEMENTED|.</span>
<a href="#l4.375"></a><span id="l4.375">       }</span>
<a href="#l4.376"></a><span id="l4.376">     }</span>
<a href="#l4.377"></a><span id="l4.377">   }</span>
<a href="#l4.378"></a><span id="l4.378"> </span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-  return null;</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineplus">+  return result;</span>
<a href="#l4.381"></a><span id="l4.381"> }</span>
<a href="#l4.382"></a><span id="l4.382"> </span>
<a href="#l4.383"></a><span id="l4.383"> /**</span>
<a href="#l4.384"></a><span id="l4.384">  * Create a new attachment object which goes into the data attachment array.</span>
<a href="#l4.385"></a><span id="l4.385">  * This method checks whether the passed attachment is empty or not.</span>
<a href="#l4.386"></a><span id="l4.386">  *</span>
<a href="#l4.387"></a><span id="l4.387">  * @param contentType The attachment's mimetype</span>
<a href="#l4.388"></a><span id="l4.388">  * @param url The URL for the attachment</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/mailnews/msgHdrViewOverlay.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/mailnews/msgHdrViewOverlay.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -45,30 +45,44 @@</span>
<a href="#l5.4"></a><span id="l5.4">   &lt;menuitem id=&quot;messageIdContext-copyMessageId&quot;</span>
<a href="#l5.5"></a><span id="l5.5">             label=&quot;&amp;CopyMessageId.label;&quot;</span>
<a href="#l5.6"></a><span id="l5.6">             accesskey=&quot;&amp;CopyMessageId.accesskey;&quot;</span>
<a href="#l5.7"></a><span id="l5.7">             oncommand=&quot;var messageId = GetMessageIdFromNode(document.popupNode, false);</span>
<a href="#l5.8"></a><span id="l5.8">                        CopyString(messageId);&quot;/&gt;</span>
<a href="#l5.9"></a><span id="l5.9"> &lt;/menupopup&gt;</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> &lt;menupopup id=&quot;emailAddressPopup&quot; popupanchor=&quot;bottomleft&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-       onpopupshowing=&quot;fillEmailAddressPopup(document.popupNode);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                       goUpdateCommand('cmd_createFilterFromPopup');&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+           onpopupshowing=&quot;SetupEmailAddressPopup(document.popupNode);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                           goUpdateCommand('cmd_createFilterFromPopup');&quot;&gt;</span>
<a href="#l5.16"></a><span id="l5.16">   &lt;menuitem id=&quot;emailAddressPlaceHolder&quot; label=&quot;&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l5.17"></a><span id="l5.17">   &lt;menuseparator/&gt;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-  &lt;menuitem label=&quot;&amp;SendMailTo.label;&quot;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+  &lt;menuitem id=&quot;sendMailToItem&quot;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+            label=&quot;&amp;SendMailTo.label;&quot;</span>
<a href="#l5.21"></a><span id="l5.21">             accesskey=&quot;&amp;SendMailTo.accesskey;&quot;</span>
<a href="#l5.22"></a><span id="l5.22">             oncommand=&quot;SendMailToNode(document.popupNode)&quot;/&gt;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-  &lt;menuitem label=&quot;&amp;CreateFilterFrom.label;&quot;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+  &lt;menuitem id=&quot;createFilterFromItem&quot;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+            label=&quot;&amp;CreateFilterFrom.label;&quot;</span>
<a href="#l5.26"></a><span id="l5.26">             accesskey=&quot;&amp;CreateFilterFrom.accesskey;&quot;</span>
<a href="#l5.27"></a><span id="l5.27">             command=&quot;cmd_createFilterFromPopup&quot;/&gt;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-  &lt;menuitem label=&quot;&amp;AddToAddressBook.label;&quot;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+  &lt;menuitem id=&quot;addToAddressBookItem&quot;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+            label=&quot;&amp;AddToAddressBook.label;&quot;</span>
<a href="#l5.31"></a><span id="l5.31">             accesskey=&quot;&amp;AddToAddressBook.accesskey;&quot;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-            oncommand=&quot;AddNodeToAddressBook(document.popupNode)&quot;/&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-  &lt;menuitem label=&quot;&amp;CopyEmailAddress.label;&quot;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+            oncommand=&quot;AddContact(document.popupNode);&quot;/&gt;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+  &lt;menuitem id=&quot;editContactItem&quot;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+            label=&quot;&amp;EditContact.label;&quot;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+            accesskey=&quot;&amp;EditContact.accesskey;&quot;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+            hidden=&quot;true&quot;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+            oncommand=&quot;EditContact(document.popupNode);&quot;/&gt;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+  &lt;menuitem id=&quot;viewContactItem&quot;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+            label=&quot;&amp;ViewContact.label;&quot;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+            accesskey=&quot;&amp;ViewContact.accesskey;&quot;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+            hidden=&quot;true&quot;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+            oncommand=&quot;EditContact(document.popupNode);&quot;/&gt;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+  &lt;menuitem id=&quot;copyEmailAddressItem&quot;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+            label=&quot;&amp;CopyEmailAddress.label;&quot;</span>
<a href="#l5.47"></a><span id="l5.47">             accesskey=&quot;&amp;CopyEmailAddress.accesskey;&quot;</span>
<a href="#l5.48"></a><span id="l5.48">             oncommand=&quot;CopyEmailAddress(document.popupNode)&quot;/&gt;</span>
<a href="#l5.49"></a><span id="l5.49"> &lt;/menupopup&gt;</span>
<a href="#l5.50"></a><span id="l5.50"> </span>
<a href="#l5.51"></a><span id="l5.51"> &lt;menupopup id=&quot;attachmentListContext&quot; onpopupshowing=&quot;return onShowAttachmentContextMenu();&quot;&gt;</span>
<a href="#l5.52"></a><span id="l5.52">   &lt;menuitem id=&quot;context-openAttachment&quot; label=&quot;&amp;openAttachmentCmd.label;&quot; accesskey=&quot;&amp;openAttachmentCmd.accesskey;&quot;</span>
<a href="#l5.53"></a><span id="l5.53">      oncommand=&quot;handleAttachmentSelection('openAttachment');&quot;/&gt;</span>
<a href="#l5.54"></a><span id="l5.54">   &lt;menuitem id=&quot;context-viewAttachment&quot; label=&quot;&amp;viewAttachmentCmd.label;&quot; accesskey=&quot;&amp;viewAttachmentCmd.accesskey;&quot;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

