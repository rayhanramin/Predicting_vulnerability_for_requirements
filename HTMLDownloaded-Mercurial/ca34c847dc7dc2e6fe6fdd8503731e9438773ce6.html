<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7191:ca34c847dc7dc2e6fe6fdd8503731e9438773ce6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ca34c847dc7dc2e6fe6fdd8503731e9438773ce6" />
<meta property="og:url" content="/comm-central/rev/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6" />
<meta property="og:description" content="Fix bug 632913 - [Mozmill] General tests update. r=ctalbert" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ca34c847dc7dc2e6fe6fdd8503731e9438773ce6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">shortlog</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">files</a> |
changeset |
<a href="/comm-central/raw-rev/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">raw</a>  | <a href="/comm-central/archive/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=632913">bug 632913</a> - [Mozmill] General tests update. r=ctalbert
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#101;&#114;&#105;&#107;&#101;&#32;&#83;&#101;&#108;&#108;&#32;&#60;&#109;&#101;&#114;&#105;&#107;&#101;&#46;&#115;&#101;&#108;&#108;&#64;&#101;&#101;&#115;&#116;&#105;&#46;&#101;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 21 Feb 2011 08:35:52 +0100</td></tr>

<tr>
 <td>changeset 7191</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">ca34c847dc7dc2e6fe6fdd8503731e9438773ce6</a></td>
</tr>



<tr>
<td>parent 7190</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9cdeeb06ad9a3e221a6cdcfc7e2fa59689d3a413">9cdeeb06ad9a3e221a6cdcfc7e2fa59689d3a413</a>
</td>
</tr>

<tr>
<td>child 7192</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a251493d8c5318d276ca398b77020c8e5f012214">a251493d8c5318d276ca398b77020c8e5f012214</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">5511</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Mon, 21 Feb 2011 07:36:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ca34c847dc7d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ca34c847dc7dc2e6fe6fdd8503731e9438773ce6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ca34c847dc7dc2e6fe6fdd8503731e9438773ce6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ca34c847dc7dc2e6fe6fdd8503731e9438773ce6&newProject=comm-central&newRevision=9cdeeb06ad9a3e221a6cdcfc7e2fa59689d3a413&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ca34c847dc7dc2e6fe6fdd8503731e9438773ce6&newProject=comm-central&newRevision=9cdeeb06ad9a3e221a6cdcfc7e2fa59689d3a413&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ca34c847dc7dc2e6fe6fdd8503731e9438773ce6&newProject=comm-central&newRevision=9cdeeb06ad9a3e221a6cdcfc7e2fa59689d3a413&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28ctalbert%29&revcount=50">ctalbert</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=632913">632913</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=632913">bug 632913</a> - [Mozmill] General tests update. r=ctalbert</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/alarm-defaultvalue.js">calendar/test/mozmill/alarm-defaultvalue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/alarm-defaultvalue.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/alarm-defaultvalue.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/alarm-defaultvalue.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/alarm-defaultvalue.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/alarm-defaultvalue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testCalendarUtils.js">calendar/test/mozmill/shared-modules/testCalendarUtils.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testCalendarUtils.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testCalendarUtils.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testCalendarUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testTimezones.js">calendar/test/mozmill/shared-modules/testTimezones.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testTimezones.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testTimezones.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/testTimezones.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/timezone-utils.js">calendar/test/mozmill/shared-modules/timezone-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/timezone-utils.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/timezone-utils.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/timezone-utils.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/shared-modules/timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testDayView.js">calendar/test/mozmill/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testDayView.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testDayView.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testDayView.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testDayView.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialog.js">calendar/test/mozmill/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialogModificationPrompt.js">calendar/test/mozmill/testEventDialogModificationPrompt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialogModificationPrompt.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialogModificationPrompt.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialogModificationPrompt.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialogModificationPrompt.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testEventDialogModificationPrompt.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testLocalICS.js">calendar/test/mozmill/testLocalICS.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testLocalICS.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testLocalICS.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testLocalICS.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testLocalICS.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testLocalICS.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMonthView.js">calendar/test/mozmill/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMonthView.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMonthView.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMultiweekView.js">calendar/test/mozmill/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testAnnualRecursion.js">calendar/test/mozmill/testRecursion/testAnnualRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testAnnualRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testAnnualRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testAnnualRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testAnnualRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testAnnualRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js">calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testDailyRecursion.js">calendar/test/mozmill/testRecursion/testDailyRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testDailyRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testDailyRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testDailyRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testDailyRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testDailyRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js">calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js">calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js">calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js">calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js">calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js">calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js">calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js">calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js">calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js">calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js">calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTaskView.js">calendar/test/mozmill/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTaskView.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTaskView.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTodayPane.js">calendar/test/mozmill/testTodayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTodayPane.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTodayPane.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTodayPane.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTodayPane.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testTodayPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testUTF8.js">calendar/test/mozmill/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testUTF8.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testUTF8.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testWeekView.js">calendar/test/mozmill/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testWeekView.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testWeekView.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test1.js">calendar/test/mozmill/timezoneTests/test1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test1.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test1.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test1.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test1.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test10.js">calendar/test/mozmill/timezoneTests/test10.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test10.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test10.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test10.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test10.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test10.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test2.js">calendar/test/mozmill/timezoneTests/test2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test2.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test2.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test2.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test2.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test3.js">calendar/test/mozmill/timezoneTests/test3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test3.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test3.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test3.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test3.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test4.js">calendar/test/mozmill/timezoneTests/test4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test4.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test4.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test4.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test4.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test4.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test5.js">calendar/test/mozmill/timezoneTests/test5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test5.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test5.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test5.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test5.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test5.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test6.js">calendar/test/mozmill/timezoneTests/test6.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test6.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test6.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test6.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test6.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test6.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test7.js">calendar/test/mozmill/timezoneTests/test7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test7.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test7.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test7.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test7.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test7.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test8.js">calendar/test/mozmill/timezoneTests/test8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test8.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test8.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test8.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test8.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test9.js">calendar/test/mozmill/timezoneTests/test9.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test9.js">file</a> |
<a href="/comm-central/annotate/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test9.js">annotate</a> |
<a href="/comm-central/diff/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test9.js">diff</a> |
<a href="/comm-central/comparison/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test9.js">comparison</a> |
<a href="/comm-central/log/ca34c847dc7dc2e6fe6fdd8503731e9438773ce6/calendar/test/mozmill/timezoneTests/test9.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/test/mozmill/alarm-defaultvalue.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/test/mozmill/alarm-defaultvalue.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -14,16 +14,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">  * The Original Code is Sun Microsystems code.</span>
<a href="#l1.5"></a><span id="l1.5">  *</span>
<a href="#l1.6"></a><span id="l1.6">  * The Initial Developer of the Original Code is</span>
<a href="#l1.7"></a><span id="l1.7">  *   Philipp Kewisch &lt;mozilla@kewis.ch&gt;</span>
<a href="#l1.8"></a><span id="l1.8">  * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l1.9"></a><span id="l1.9">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l1.10"></a><span id="l1.10">  *</span>
<a href="#l1.11"></a><span id="l1.11">  * Contributor(s):</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+ *   Merike Sell &lt;merikes@gmail.com&gt;</span>
<a href="#l1.13"></a><span id="l1.13">  *</span>
<a href="#l1.14"></a><span id="l1.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l1.15"></a><span id="l1.15">  * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l1.16"></a><span id="l1.16">  * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l1.17"></a><span id="l1.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l1.18"></a><span id="l1.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l1.19"></a><span id="l1.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l1.20"></a><span id="l1.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -34,102 +35,125 @@</span>
<a href="#l1.22"></a><span id="l1.22">  *</span>
<a href="#l1.23"></a><span id="l1.23">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25"> /**</span>
<a href="#l1.26"></a><span id="l1.26">  * @title Test default alarm settings for events and tasks</span>
<a href="#l1.27"></a><span id="l1.27">  * @litmus 2510</span>
<a href="#l1.28"></a><span id="l1.28">  */</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-var mozmill = {}; Components.utils.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-var elementslib = {}; Components.utils.import('resource://mozmill/modules/elementslib.js', elementslib);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+var prefs = require(&quot;./shared-modules/prefs&quot;);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36"> var calendarController;</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38"> function setupModule(module) {</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-  let calWindow = mozmill.utils.getWindows(&quot;mail:3pane&quot;)[0] ||</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-                  mozmill.utils.getWindows(&quot;calendarMainWindow&quot;)[0];</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-  calendarController = new mozmill.controller.MozMillController(calWindow);</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+  calendarController = mozmill.getMail3PaneController();</span>
<a href="#l1.43"></a><span id="l1.43"> }</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45"> function testDefaultAlarms() {</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+  let localeUnitString = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+                                          &quot;reminderCustomUnitDays&quot;);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+  let unitString = PluralForm.get(50, localeUnitString)</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+                             .replace(&quot;#1&quot;, 50);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+  let originStringEvent = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+                                           &quot;reminderCustomOriginBeginBeforeEvent&quot;);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+  let originStringTask = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                                          &quot;reminderCustomOriginBeginBeforeTask&quot;);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+  let expectedEventReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+                                              &quot;reminderCustomTitle&quot;,</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+                                              [unitString, originStringEvent]);</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+  let expectedTaskReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+                                              &quot;reminderCustomTitle&quot;,</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+                                              [unitString, originStringTask]);</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+  </span>
<a href="#l1.61"></a><span id="l1.61">   // Open preferences</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-  calendarController.click(new elementslib.ID(calendarController.window.document, &quot;menu_Edit&quot;));</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-  calendarController.click(new elementslib.ID(calendarController.window.document, &quot;menu_preferences&quot;));</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+  calendarController.mainMenu.click(&quot;#menu_preferences&quot;);</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-  calendarController.waitForEval('utils.getWindows(&quot;Mail:Preferences&quot;).length &gt; 0 ||' +</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-                                 'utils.getWindows(&quot;CalendarPreferences&quot;).length &gt; 0');</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+  calendarController.waitFor(function() {</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+    return mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length &gt; 0});</span>
<a href="#l1.70"></a><span id="l1.70">   </span>
<a href="#l1.71"></a><span id="l1.71">   // Set up prefs controller</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-  let prefWindow = mozmill.utils.getWindows(&quot;Mail:Preferences&quot;)[0] ||</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-                   mozmill.utils.getWindows(&quot;CalendarPreferences&quot;)[0];</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+  let prefWindow = mozmill.utils.getWindows(&quot;Mail:Preferences&quot;)[0];</span>
<a href="#l1.75"></a><span id="l1.75">   let prefsController = new mozmill.controller.MozMillController(prefWindow);</span>
<a href="#l1.76"></a><span id="l1.76"> </span>
<a href="#l1.77"></a><span id="l1.77">   // Open lightning prefs, but only if we are on lightning.</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-  if (!calendarController.window.isSunbird()) {</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-      prefsController.click(new elementslib.Lookup(prefsController.window.document,</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-                              '/id(&quot;MailPreferences&quot;)/anon({&quot;orient&quot;:&quot;vertical&quot;})/' + </span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-                              'anon({&quot;anonid&quot;:&quot;selector&quot;})/{&quot;pane&quot;:&quot;paneLightning&quot;}'));</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-  }</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+  prefsController.click(new elementslib.Lookup(prefsController.window.document,</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+                          '/id(&quot;MailPreferences&quot;)/anon({&quot;orient&quot;:&quot;vertical&quot;})/' + </span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+                          'anon({&quot;anonid&quot;:&quot;selector&quot;})/{&quot;pane&quot;:&quot;paneLightning&quot;}'));</span>
<a href="#l1.86"></a><span id="l1.86"> </span>
<a href="#l1.87"></a><span id="l1.87">   // Click on the alarms tab</span>
<a href="#l1.88"></a><span id="l1.88">   prefsController.click(new elementslib.ID(prefsController.window.document, &quot;calPreferencesTabAlarms&quot;));</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+  </span>
<a href="#l1.91"></a><span id="l1.91">   // Turn on alarms for events and tasks</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarm&quot;));</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+  prefsController.waitThenClick(new elementslib.ID(prefsController.window.document, &quot;eventdefalarm&quot;));</span>
<a href="#l1.94"></a><span id="l1.94">   prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmon&quot;));</span>
<a href="#l1.95"></a><span id="l1.95">   prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarm&quot;));</span>
<a href="#l1.96"></a><span id="l1.96">   prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmon&quot;));</span>
<a href="#l1.97"></a><span id="l1.97">   </span>
<a href="#l1.98"></a><span id="l1.98">   // Sets default alarm length for events to &quot;50&quot;</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmlen&quot;));</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+  prefsController.keypress(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmlen&quot;),</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+                           &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l1.102"></a><span id="l1.102">   prefsController.type(new elementslib.ID(prefsController.window.document, &quot;calendar.alarms.eventalarmlen&quot;),&quot;50&quot;);</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmlen&quot;));</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+  prefsController.keypress(new elementslib.ID(prefsController.window.document, &quot;tododefalarmlen&quot;),</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+                           &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l1.106"></a><span id="l1.106">   prefsController.type(new elementslib.ID(prefsController.window.document, &quot;calendar.alarms.todoalarmlen&quot;),&quot;50&quot;);</span>
<a href="#l1.107"></a><span id="l1.107"> </span>
<a href="#l1.108"></a><span id="l1.108">   // Selects &quot;days&quot; as a unit</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmunit&quot;));</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmunitday&quot;));</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmunit&quot;));</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmunitday&quot;));</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+  prefsController.select(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmunit&quot;),</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+                         null, null, &quot;days&quot;);</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+  prefsController.select(new elementslib.ID(prefsController.window.document, &quot;tododefalarmunit&quot;),</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+                         null, null, &quot;days&quot;);</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+  </span>
<a href="#l1.119"></a><span id="l1.119">   // Close the preferences dialog</span>
<a href="#l1.120"></a><span id="l1.120">   prefsController.window.close();</span>
<a href="#l1.121"></a><span id="l1.121"> </span>
<a href="#l1.122"></a><span id="l1.122">   // Create New Event</span>
<a href="#l1.123"></a><span id="l1.123">   calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-calendar-menuitem&quot;));</span>
<a href="#l1.124"></a><span id="l1.124"> </span>
<a href="#l1.125"></a><span id="l1.125">   // Set up the event dialog controller</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineminus">-  calendarController.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0');</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+  calendarController.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0});</span>
<a href="#l1.128"></a><span id="l1.128">   let eventController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l1.129"></a><span id="l1.129"> </span>
<a href="#l1.130"></a><span id="l1.130">   // Check if the &quot;custom&quot; item was selected</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-  eventController.assertProperty(new elementslib.ID(eventController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-                                 &quot;value&quot;,</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-                                 &quot;custom&quot;);</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-  eventController.assertProperty(new elementslib.XPath(eventController.window.document,</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-                                   '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot;]'),</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineminus">-                                 &quot;value&quot;,</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineminus">-                                 &quot;50 days before the event starts&quot;);</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineplus">+  eventController.assertDOMProperty(new elementslib.ID(eventController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineplus">+                                    &quot;value&quot;,</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineplus">+                                    &quot;custom&quot;);</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineplus">+  eventController.assertDOMProperty(new elementslib.XPath(eventController.window.document,</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineplus">+                                      '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+                                      'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineplus">+                                    &quot;value&quot;,</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+                                    expectedEventReminder);</span>
<a href="#l1.146"></a><span id="l1.146"> </span>
<a href="#l1.147"></a><span id="l1.147">   // Close the event dialog</span>
<a href="#l1.148"></a><span id="l1.148">   eventController.window.close();</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-  calendarController.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0');</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+  calendarController.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l1.151"></a><span id="l1.151"> </span>
<a href="#l1.152"></a><span id="l1.152">   // Create New Task</span>
<a href="#l1.153"></a><span id="l1.153">   calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-task-menuitem&quot;));</span>
<a href="#l1.154"></a><span id="l1.154"> </span>
<a href="#l1.155"></a><span id="l1.155">   // Set up the task dialog controller</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineminus">-  calendarController.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0');</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+  calendarController.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0});</span>
<a href="#l1.158"></a><span id="l1.158">   let taskController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l1.159"></a><span id="l1.159"> </span>
<a href="#l1.160"></a><span id="l1.160">   // Check if the &quot;custom&quot; item was selected</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineminus">-  taskController.assertProperty(new elementslib.ID(taskController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineminus">-                                &quot;value&quot;,</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-                                &quot;custom&quot;);</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineminus">-  taskController.assertProperty(new elementslib.XPath(taskController.window.document,</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-                                  '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot;]'),</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineminus">-                                &quot;value&quot;,</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-                                &quot;50 days before the task starts&quot;);</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineplus">+  taskController.assertDOMProperty(new elementslib.ID(taskController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineplus">+                                   &quot;value&quot;,</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineplus">+                                   &quot;custom&quot;);</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineplus">+  taskController.assertDOMProperty(new elementslib.XPath(taskController.window.document,</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineplus">+                                     '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineplus">+                                      'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineplus">+                                   &quot;value&quot;,</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineplus">+                                   expectedTaskReminder);</span>
<a href="#l1.176"></a><span id="l1.176">   // Close the task dialog</span>
<a href="#l1.177"></a><span id="l1.177">   taskController.window.close();</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineminus">-  calendarController.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0');</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+  calendarController.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l1.180"></a><span id="l1.180"> }</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.alarms.onforevents&quot;);</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.alarms.onfortodos&quot;);</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">rename from calendar/test/mozmill/shared-modules/testCalendarUtils.js</span>
<a href="#l2.2"></a><span id="l2.2">rename to calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/testCalendarUtils.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineat">@@ -29,138 +29,158 @@</span>
<a href="#l2.6"></a><span id="l2.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l2.7"></a><span id="l2.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l2.8"></a><span id="l2.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.9"></a><span id="l2.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.10"></a><span id="l2.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.11"></a><span id="l2.11">  *</span>
<a href="#l2.12"></a><span id="l2.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-const MODULE_NAME = 'CalendarUtils';</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-const RELATIVE_ROOT = '.';</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-const MODULE_REQUIRES = ['ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+var modalDialog = require(&quot;modal-dialog&quot;);</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+var utils = require(&quot;utils&quot;);</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> const sleep = 500;</span>
<a href="#l2.22"></a><span id="l2.22"> const EVENT_BOX = 0; // Use when you need an event box</span>
<a href="#l2.23"></a><span id="l2.23"> const CANVAS_BOX = 1; // Use when you need a calendar canvas box</span>
<a href="#l2.24"></a><span id="l2.24"> const ALLDAY = 2; // Use when you need an allday canvas or event box</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26"> /**</span>
<a href="#l2.27"></a><span id="l2.27">  *  Accept to send notification email with event to attendees</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.29"></a><span id="l2.29">  */</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-function acceptSendingNotificationMail(){</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  let api = collector.getModule('ModalDialogAPI');</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-  let md = new api.modalDialog(</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+function acceptSendingNotificationMail(controller){</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+  md.start(</span>
<a href="#l2.36"></a><span id="l2.36">     function(dialog){</span>
<a href="#l2.37"></a><span id="l2.37">       dialog.waitThenClick(new elementslib.Lookup(dialog.window.document, '/id(&quot;commonDialog&quot;)/'</span>
<a href="#l2.38"></a><span id="l2.38">         + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l2.39"></a><span id="l2.39">     }</span>
<a href="#l2.40"></a><span id="l2.40">   );</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-  md.start();</span>
<a href="#l2.42"></a><span id="l2.42"> }</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44"> /**</span>
<a href="#l2.45"></a><span id="l2.45">  *  Add an attachment with url</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.47"></a><span id="l2.47">  */</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-function handleAddingAttachment(url){</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-  let api = collector.getModule('ModalDialogAPI');</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  let md = new api.modalDialog(</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+function handleAddingAttachment(controller, url){</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+  let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+  md.start(</span>
<a href="#l2.54"></a><span id="l2.54">     function(attachment){</span>
<a href="#l2.55"></a><span id="l2.55">       let input = new elementslib.ID(attachment.window.document, 'loginTextbox');</span>
<a href="#l2.56"></a><span id="l2.56">       attachment.waitForElement(input);</span>
<a href="#l2.57"></a><span id="l2.57">       input.getNode().value = url;</span>
<a href="#l2.58"></a><span id="l2.58">       attachment.click(new elementslib.Lookup(attachment.window.document, '/id(&quot;commonDialog&quot;)/'</span>
<a href="#l2.59"></a><span id="l2.59">         + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l2.60"></a><span id="l2.60">     }</span>
<a href="#l2.61"></a><span id="l2.61">   );</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-  md.start();</span>
<a href="#l2.63"></a><span id="l2.63"> }</span>
<a href="#l2.64"></a><span id="l2.64"> </span>
<a href="#l2.65"></a><span id="l2.65"> /**</span>
<a href="#l2.66"></a><span id="l2.66">  *  Choose to delete just one occurrence of a repeating event</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">- *  @attendees whether there are attendees that can be notified or not</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+ *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l2.70"></a><span id="l2.70">  */</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-function handleOccurrenceDeletion(attendees){</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-  let api = collector.getModule('ModalDialogAPI');</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-  let md = new api.modalDialog(</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+function handleOccurrenceDeletion(controller, attendees){</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+  let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+  md.start(</span>
<a href="#l2.77"></a><span id="l2.77">     function(dialog){</span>
<a href="#l2.78"></a><span id="l2.78">       if(attendees)</span>
<a href="#l2.79"></a><span id="l2.79">         acceptSendingNotificationMail();</span>
<a href="#l2.80"></a><span id="l2.80">       dialog.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-occurrence-button&quot;));</span>
<a href="#l2.81"></a><span id="l2.81">     }</span>
<a href="#l2.82"></a><span id="l2.82">   );</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-  md.start();</span>
<a href="#l2.84"></a><span id="l2.84"> }</span>
<a href="#l2.85"></a><span id="l2.85"> </span>
<a href="#l2.86"></a><span id="l2.86"> /**</span>
<a href="#l2.87"></a><span id="l2.87">  *  Choose to delete all occurrences of a repeating event</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">- *  @attendees whether there are attendees that can be notified or not</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+ *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l2.91"></a><span id="l2.91">  */</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-function handleParentDeletion(attendees){</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-  let api = collector.getModule('ModalDialogAPI');</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-  let md = new api.modalDialog(</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+function handleParentDeletion(controller, attendees){</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+  let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+  md.start(</span>
<a href="#l2.98"></a><span id="l2.98">     function(dialog){</span>
<a href="#l2.99"></a><span id="l2.99">       if(attendees)</span>
<a href="#l2.100"></a><span id="l2.100">         acceptSendingNotificationMail();</span>
<a href="#l2.101"></a><span id="l2.101">       dialog.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-parent-button&quot;));</span>
<a href="#l2.102"></a><span id="l2.102">     }</span>
<a href="#l2.103"></a><span id="l2.103">   );</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-  md.start();</span>
<a href="#l2.105"></a><span id="l2.105"> }</span>
<a href="#l2.106"></a><span id="l2.106"> </span>
<a href="#l2.107"></a><span id="l2.107"> /**</span>
<a href="#l2.108"></a><span id="l2.108">  *  Choose to modify just one occurrence of a repeating event</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">- *  @attendees whether there are attendees that can be notified or not</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+ *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l2.112"></a><span id="l2.112">  */</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-function handleOccurrenceModification(attendees){</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-  handleOccurrenceDeletion(attendees);</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+function handleOccurrenceModification(controller, attendees){</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+  handleOccurrenceDeletion(controller, attendees);</span>
<a href="#l2.117"></a><span id="l2.117"> }</span>
<a href="#l2.118"></a><span id="l2.118"> </span>
<a href="#l2.119"></a><span id="l2.119"> /**</span>
<a href="#l2.120"></a><span id="l2.120">  *  Choose to modify all occurrences of a repeating event</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">- *  @attendees whether there are attendees that can be notified or not</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+ *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l2.124"></a><span id="l2.124">  */</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-function handleParentModification(attendees){</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-  handleParentDeletion(attendees);</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+function handleParentModification(controller, attendees){</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+  handleParentDeletion(controller, attendees);</span>
<a href="#l2.129"></a><span id="l2.129"> }</span>
<a href="#l2.130"></a><span id="l2.130"> </span>
<a href="#l2.131"></a><span id="l2.131"> /**</span>
<a href="#l2.132"></a><span id="l2.132">  *  Switch to a view</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+ *  @param controller - Mozmill window controller</span>
<a href="#l2.134"></a><span id="l2.134">  *  @param view - day, week, multiweek or month</span>
<a href="#l2.135"></a><span id="l2.135">  */</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-function switchToView(view, controller){</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+function switchToView(controller, view){</span>
<a href="#l2.138"></a><span id="l2.138">   switch(view){</span>
<a href="#l2.139"></a><span id="l2.139">     case &quot;week&quot;:</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-      controller.click(new elementslib.ID(controller.window.document,</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+      controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l2.142"></a><span id="l2.142">         &quot;calendar-week-view-button&quot;));</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+      controller.waitFor(function() {</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+        &quot;calendar-week-view-button&quot;));</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+        return button.getNode().selected == true;</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+      });</span>
<a href="#l2.148"></a><span id="l2.148">       break;</span>
<a href="#l2.149"></a><span id="l2.149">     case &quot;multiweek&quot;:</span>
<a href="#l2.150"></a><span id="l2.150">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l2.151"></a><span id="l2.151">         &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+      controller.waitFor(function() {</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineplus">+        &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineplus">+        return button.getNode().selected == true;</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+      });</span>
<a href="#l2.157"></a><span id="l2.157">       break;</span>
<a href="#l2.158"></a><span id="l2.158">     case &quot;month&quot;:</span>
<a href="#l2.159"></a><span id="l2.159">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l2.160"></a><span id="l2.160">         &quot;calendar-month-view-button&quot;));</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+      controller.waitFor(function() {</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineplus">+        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+        &quot;calendar-month-view-button&quot;));</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineplus">+        return button.getNode().selected == true;</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+      });</span>
<a href="#l2.166"></a><span id="l2.166">       break;</span>
<a href="#l2.167"></a><span id="l2.167">     default:</span>
<a href="#l2.168"></a><span id="l2.168">       controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l2.169"></a><span id="l2.169">         &quot;calendar-day-view-button&quot;));</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+      controller.waitFor(function() {</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+        let button = (new elementslib.ID(controller.window.document,</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+        &quot;calendar-day-view-button&quot;));</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+        return button.getNode().selected == true;</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+      });</span>
<a href="#l2.175"></a><span id="l2.175">   }</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineminus">-  controller.sleep(500);</span>
<a href="#l2.177"></a><span id="l2.177"> }</span>
<a href="#l2.178"></a><span id="l2.178"> </span>
<a href="#l2.179"></a><span id="l2.179"> /**</span>
<a href="#l2.180"></a><span id="l2.180">  *  Go to a specific date using minimonth</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+ *  @param controller - main window controller</span>
<a href="#l2.182"></a><span id="l2.182">  *  @param year - four-digit year</span>
<a href="#l2.183"></a><span id="l2.183">  *  @param month - 1-based index of a month</span>
<a href="#l2.184"></a><span id="l2.184">  *  @param day - 1-based index of a day</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineminus">- *  @param controller - main window controller</span>
<a href="#l2.186"></a><span id="l2.186">  */</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineminus">-function goToDate(year, month, day, controller){</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+function goToDate(controller, year, month, day){</span>
<a href="#l2.189"></a><span id="l2.189">   let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l2.190"></a><span id="l2.190">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/'</span>
<a href="#l2.191"></a><span id="l2.191">     + 'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l2.192"></a><span id="l2.192">   let activeYear = (new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l2.193"></a><span id="l2.193">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l2.194"></a><span id="l2.194">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l2.195"></a><span id="l2.195">   let activeMonth = (new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l2.196"></a><span id="l2.196">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineat">@@ -193,46 +213,44 @@ function goToDate(year, month, day, cont</span>
<a href="#l2.198"></a><span id="l2.198">     controller.sleep(500);</span>
<a href="#l2.199"></a><span id="l2.199">   }</span>
<a href="#l2.200"></a><span id="l2.200">   </span>
<a href="#l2.201"></a><span id="l2.201">   if (monthDifference != 0) {</span>
<a href="#l2.202"></a><span id="l2.202">     // pick month</span>
<a href="#l2.203"></a><span id="l2.203">     controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l2.204"></a><span id="l2.204">       + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})/[' + activeMonth</span>
<a href="#l2.205"></a><span id="l2.205">       + ']'));</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-    controller.sleep(500);</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l2.209"></a><span id="l2.209">       + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l2.210"></a><span id="l2.210">       + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;' + (month - 1) + '&quot;}'));</span>
<a href="#l2.211"></a><span id="l2.211">     controller.sleep(500);</span>
<a href="#l2.212"></a><span id="l2.212">   }</span>
<a href="#l2.213"></a><span id="l2.213">   </span>
<a href="#l2.214"></a><span id="l2.214">   let lastDayInFirstRow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.215"></a><span id="l2.215">     miniMonth + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/[6]')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l2.216"></a><span id="l2.216">   let positionOfFirst = 7 - lastDayInFirstRow;</span>
<a href="#l2.217"></a><span id="l2.217">   let dateColumn = (positionOfFirst + day - 1) % 7;</span>
<a href="#l2.218"></a><span id="l2.218">   let dateRow = Math.floor((positionOfFirst + day - 1) / 7);</span>
<a href="#l2.219"></a><span id="l2.219">   </span>
<a href="#l2.220"></a><span id="l2.220">   // pick day</span>
<a href="#l2.221"></a><span id="l2.221">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l2.222"></a><span id="l2.222">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[' + (dateRow + 1) + ']/[' + dateColumn + ']'));</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineminus">-  controller.sleep(1000);</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineminus">-</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineplus">+  controller.sleep(500);</span>
<a href="#l2.226"></a><span id="l2.226"> }</span>
<a href="#l2.227"></a><span id="l2.227"> </span>
<a href="#l2.228"></a><span id="l2.228"> /**</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineplus">+ *  @param controller - main window controller</span>
<a href="#l2.230"></a><span id="l2.230">  *  @param view - day, week, multiweek or month</span>
<a href="#l2.231"></a><span id="l2.231">  *  @param option - bg for creating event, fg for checking</span>
<a href="#l2.232"></a><span id="l2.232">  *  @param row - only used in multiweek and month view, 1-based index of a row</span>
<a href="#l2.233"></a><span id="l2.233">  *  @param column - 1-based index of a column</span>
<a href="#l2.234"></a><span id="l2.234">  *  @param hour - index of hour box</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">- *  @param controller - main window controller</span>
<a href="#l2.236"></a><span id="l2.236">  *  @returns path string</span>
<a href="#l2.237"></a><span id="l2.237">  */</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineminus">-function getEventBoxPath(view, option, row, column, hour, controller){</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineplus">+function getEventBoxPath(controller, view, option, row, column, hour){</span>
<a href="#l2.240"></a><span id="l2.240">   let viewDeck = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l2.241"></a><span id="l2.241">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l2.242"></a><span id="l2.242">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)';</span>
<a href="#l2.243"></a><span id="l2.243">   let dayView = viewDeck + '/id(&quot;day-view&quot;)';</span>
<a href="#l2.244"></a><span id="l2.244">   let weekView = viewDeck + '/id(&quot;week-view&quot;)';</span>
<a href="#l2.245"></a><span id="l2.245">   let multiweekView = viewDeck + '/id(&quot;multiweek-view&quot;)';</span>
<a href="#l2.246"></a><span id="l2.246">   let monthView = viewDeck + '/id(&quot;month-view&quot;)';</span>
<a href="#l2.247"></a><span id="l2.247">   </span>
<a href="#l2.248"></a><span id="l2.248" class="difflineat">@@ -275,57 +293,61 @@ function getEventBoxPath(view, option, r</span>
<a href="#l2.249"></a><span id="l2.249">     if(option == CANVAS_BOX)</span>
<a href="#l2.250"></a><span id="l2.250">       path += '/anon({&quot;anonid&quot;:&quot;day-items&quot;})';</span>
<a href="#l2.251"></a><span id="l2.251">     </span>
<a href="#l2.252"></a><span id="l2.252">     return path;</span>
<a href="#l2.253"></a><span id="l2.253">   }</span>
<a href="#l2.254"></a><span id="l2.254"> }</span>
<a href="#l2.255"></a><span id="l2.255"> </span>
<a href="#l2.256"></a><span id="l2.256"> /**</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineplus">+ * @param controller - Mozmill window controller</span>
<a href="#l2.258"></a><span id="l2.258">  * @param n - how many times next button in view is clicked</span>
<a href="#l2.259"></a><span id="l2.259">  */</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineminus">-function forward(n){</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineplus">+function forward(controller, n){</span>
<a href="#l2.262"></a><span id="l2.262">   for(let i = 0; i &lt; n; i++){</span>
<a href="#l2.263"></a><span id="l2.263">     controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l2.264"></a><span id="l2.264">     controller.sleep(100);</span>
<a href="#l2.265"></a><span id="l2.265">   }</span>
<a href="#l2.266"></a><span id="l2.266"> }</span>
<a href="#l2.267"></a><span id="l2.267"> </span>
<a href="#l2.268"></a><span id="l2.268"> /**</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineplus">+ * @param controller - Mozmill window controller</span>
<a href="#l2.270"></a><span id="l2.270">  * @param n - how many times previous button in view is clicked</span>
<a href="#l2.271"></a><span id="l2.271">  */</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-function back(n){</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineplus">+function back(controller, n){</span>
<a href="#l2.274"></a><span id="l2.274">   for(let i = 0; i &lt; n; i++){</span>
<a href="#l2.275"></a><span id="l2.275">     controller.click(new elementslib.ID(controller.window.document, &quot;previous-view-button&quot;));</span>
<a href="#l2.276"></a><span id="l2.276">     controller.sleep(100);</span>
<a href="#l2.277"></a><span id="l2.277">   }</span>
<a href="#l2.278"></a><span id="l2.278"> }</span>
<a href="#l2.279"></a><span id="l2.279"> </span>
<a href="#l2.280"></a><span id="l2.280"> /**</span>
<a href="#l2.281"></a><span id="l2.281">  * Deletes all calendars with given name</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineplus">+ * @param controller - Mozmill window controller</span>
<a href="#l2.283"></a><span id="l2.283">  * @param name - calendar name</span>
<a href="#l2.284"></a><span id="l2.284">  */</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-function deleteCalendars(name){</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineplus">+function deleteCalendars(controller, name){</span>
<a href="#l2.287"></a><span id="l2.287">   let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l2.288"></a><span id="l2.288">                     .getNode().ownerDocument.defaultView;</span>
<a href="#l2.289"></a><span id="l2.289">   let manager = defaultView.getCalendarManager();</span>
<a href="#l2.290"></a><span id="l2.290">   let cals = manager.getCalendars({});</span>
<a href="#l2.291"></a><span id="l2.291"> </span>
<a href="#l2.292"></a><span id="l2.292">   for (let i = 0; i &lt; cals.length; i++)</span>
<a href="#l2.293"></a><span id="l2.293">     if (cals[i].name == name){</span>
<a href="#l2.294"></a><span id="l2.294">       manager.unregisterCalendar(cals[i]);</span>
<a href="#l2.295"></a><span id="l2.295">       manager.deleteCalendar(cals[i]);</span>
<a href="#l2.296"></a><span id="l2.296">     }</span>
<a href="#l2.297"></a><span id="l2.297"> }</span>
<a href="#l2.298"></a><span id="l2.298"> </span>
<a href="#l2.299"></a><span id="l2.299"> /**</span>
<a href="#l2.300"></a><span id="l2.300">  * Creates local calendar with given name and select it in calendars list</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineplus">+ * @param controller - Mozmill window controller</span>
<a href="#l2.302"></a><span id="l2.302">  * @param name - calendar name</span>
<a href="#l2.303"></a><span id="l2.303">  */</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineminus">-function createCalendar(name){</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineplus">+function createCalendar(controller, name){</span>
<a href="#l2.306"></a><span id="l2.306">   let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l2.307"></a><span id="l2.307">                     .getNode().ownerDocument.defaultView;</span>
<a href="#l2.308"></a><span id="l2.308">   let manager = defaultView.getCalendarManager();</span>
<a href="#l2.309"></a><span id="l2.309"> </span>
<a href="#l2.310"></a><span id="l2.310">   let url = defaultView.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l2.311"></a><span id="l2.311">   let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l2.312"></a><span id="l2.312">   calendar.name = name;</span>
<a href="#l2.313"></a><span id="l2.313">   manager.registerCalendar(calendar);</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineat">@@ -355,16 +377,17 @@ function findEventsInNode(node, eventNod</span>
<a href="#l2.315"></a><span id="l2.315">     for (let i = 0; i &lt; node.children.length; i++) {</span>
<a href="#l2.316"></a><span id="l2.316">       findEventsInNode(node.children[i], eventNodes);</span>
<a href="#l2.317"></a><span id="l2.317">     }</span>
<a href="#l2.318"></a><span id="l2.318">   }</span>
<a href="#l2.319"></a><span id="l2.319"> }</span>
<a href="#l2.320"></a><span id="l2.320"> </span>
<a href="#l2.321"></a><span id="l2.321"> /**</span>
<a href="#l2.322"></a><span id="l2.322">  *  Helper function to enter event/task dialog data</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineplus">+ *  @param controller - event/task controller</span>
<a href="#l2.324"></a><span id="l2.324">  *  @param data - dataset object</span>
<a href="#l2.325"></a><span id="l2.325">  *                  title - event/task title</span>
<a href="#l2.326"></a><span id="l2.326">  *                  location - event/task location</span>
<a href="#l2.327"></a><span id="l2.327">  *                  description - event/task description</span>
<a href="#l2.328"></a><span id="l2.328">  *                  category - category label</span>
<a href="#l2.329"></a><span id="l2.329">  *                  allday - boolean value</span>
<a href="#l2.330"></a><span id="l2.330">  *                  startdate - Date object</span>
<a href="#l2.331"></a><span id="l2.331">  *                  starttime - Date object</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineat">@@ -378,19 +401,18 @@ function findEventsInNode(node, eventNod</span>
<a href="#l2.333"></a><span id="l2.333">  *                  privacy - public/confidential/private</span>
<a href="#l2.334"></a><span id="l2.334">  *                  status - none/tentative/confirmed/canceled for events</span>
<a href="#l2.335"></a><span id="l2.335">  *                           none/needs-action/in-process/completed/cancelled for tasks</span>
<a href="#l2.336"></a><span id="l2.336">  *                  completed - Date object for tasks</span>
<a href="#l2.337"></a><span id="l2.337">  *                  percent - percent complete for tasks</span>
<a href="#l2.338"></a><span id="l2.338">  *                  freebusy - free/busy</span>
<a href="#l2.339"></a><span id="l2.339">  *                  attachment.add - url to add</span>
<a href="#l2.340"></a><span id="l2.340">  *                  attachment.remove - label of url to remove (without http://)</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">- *  @param controller - event/task controller</span>
<a href="#l2.342"></a><span id="l2.342">  */</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-function setData(data, controller) {</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineplus">+function setData(controller, data) {</span>
<a href="#l2.345"></a><span id="l2.345">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l2.346"></a><span id="l2.346">   let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l2.347"></a><span id="l2.347">   let dialog;</span>
<a href="#l2.348"></a><span id="l2.348">   let isEvent = true;</span>
<a href="#l2.349"></a><span id="l2.349">   </span>
<a href="#l2.350"></a><span id="l2.350">   // see if it's an event dialog</span>
<a href="#l2.351"></a><span id="l2.351">   try {</span>
<a href="#l2.352"></a><span id="l2.352">     (new elementslib.Lookup(controller.window.document, eventDialog)).getNode();</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineat">@@ -425,18 +447,17 @@ function setData(data, controller) {</span>
<a href="#l2.354"></a><span id="l2.354">     dialog + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/'</span>
<a href="#l2.355"></a><span id="l2.355">     + 'id(&quot;completed-date-picker&quot;)/' + dateInput);</span>
<a href="#l2.356"></a><span id="l2.356">   let percentCompleteInput = new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l2.357"></a><span id="l2.357">     + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/'</span>
<a href="#l2.358"></a><span id="l2.358">     + 'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/'</span>
<a href="#l2.359"></a><span id="l2.359">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l2.360"></a><span id="l2.360">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l2.361"></a><span id="l2.361">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineminus">-  let utilsapi = collector.getModule('UtilsAPI');</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineminus">-  let mac = utilsapi.appInfo.os.toLowerCase().indexOf(&quot;darwin&quot;) != -1;</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineplus">+  let mac = utils.appInfo.os.toLowerCase().indexOf(&quot;darwin&quot;) != -1;</span>
<a href="#l2.365"></a><span id="l2.365">   // wait for input elements' values to be populated</span>
<a href="#l2.366"></a><span id="l2.366">   controller.sleep(sleep);</span>
<a href="#l2.367"></a><span id="l2.367">   </span>
<a href="#l2.368"></a><span id="l2.368">   // title</span>
<a href="#l2.369"></a><span id="l2.369">   if (data.title != undefined) {</span>
<a href="#l2.370"></a><span id="l2.370">     if (!mac) {</span>
<a href="#l2.371"></a><span id="l2.371">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l2.372"></a><span id="l2.372">         + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineat">@@ -478,18 +499,17 @@ function setData(data, controller) {</span>
<a href="#l2.374"></a><span id="l2.374">   </span>
<a href="#l2.375"></a><span id="l2.375">   // all-day</span>
<a href="#l2.376"></a><span id="l2.376">   if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l2.377"></a><span id="l2.377">     controller.check(new elementslib.ID(controller.window.document, &quot;event-all-day&quot;), data.allday);</span>
<a href="#l2.378"></a><span id="l2.378">   }</span>
<a href="#l2.379"></a><span id="l2.379">   </span>
<a href="#l2.380"></a><span id="l2.380">   // timezone</span>
<a href="#l2.381"></a><span id="l2.381">   if (data.timezone != undefined) {</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineminus">-    let menuitem = new elementslib.Elem(controller.menus[&quot;options-menu&quot;]</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineminus">-                                                        [&quot;options-timezone-menuitem&quot;]);</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineplus">+    let menuitem = new elementslib.ID(controller.window.document, &quot;options-timezone-menuitem&quot;);</span>
<a href="#l2.385"></a><span id="l2.385">     menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l2.386"></a><span id="l2.386">     controller.click(menuitem);</span>
<a href="#l2.387"></a><span id="l2.387">   }</span>
<a href="#l2.388"></a><span id="l2.388">   </span>
<a href="#l2.389"></a><span id="l2.389">   // startdate</span>
<a href="#l2.390"></a><span id="l2.390">   if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == 'Date') {</span>
<a href="#l2.391"></a><span id="l2.391">     let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l2.392"></a><span id="l2.392">       data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l2.393"></a><span id="l2.393" class="difflineat">@@ -570,34 +590,28 @@ function setData(data, controller) {</span>
<a href="#l2.394"></a><span id="l2.394">         + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l2.395"></a><span id="l2.395">         + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l2.396"></a><span id="l2.396">       descField.getNode().value = data.description;</span>
<a href="#l2.397"></a><span id="l2.397">     }</span>
<a href="#l2.398"></a><span id="l2.398">   }</span>
<a href="#l2.399"></a><span id="l2.399">   </span>
<a href="#l2.400"></a><span id="l2.400">   // priority</span>
<a href="#l2.401"></a><span id="l2.401">   if (data.priority != undefined) {</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineminus">-    controller.click(new elementslib.Elem(controller</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineminus">-      .menus[&quot;options-menu&quot;][&quot;options-priority-menu&quot;][&quot;options-priority-&quot; + data.priority</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineminus">-      + &quot;-label&quot;]));</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineplus">+    controller.mainMenu.click(&quot;#options-priority-&quot; + data.priority + &quot;-label&quot;);</span>
<a href="#l2.406"></a><span id="l2.406">   }</span>
<a href="#l2.407"></a><span id="l2.407">   </span>
<a href="#l2.408"></a><span id="l2.408">   // privacy</span>
<a href="#l2.409"></a><span id="l2.409">   if (data.privacy != undefined) {</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineminus">-    controller.click(new elementslib.Elem(controller</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineminus">-      .menus[&quot;options-menu&quot;][&quot;options-privacy-menu&quot;][&quot;options-privacy-&quot; + data.privacy</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineminus">-      + &quot;-menuitem&quot;]));</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineplus">+    controller.mainMenu.click(&quot;#options-privacy-&quot; + data.privacy + &quot;-menuitem&quot;);</span>
<a href="#l2.414"></a><span id="l2.414">   }</span>
<a href="#l2.415"></a><span id="l2.415">   </span>
<a href="#l2.416"></a><span id="l2.416">   // status</span>
<a href="#l2.417"></a><span id="l2.417">   if (data.status != undefined) {</span>
<a href="#l2.418"></a><span id="l2.418">     if (isEvent) {</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineminus">-      controller.click(new elementslib.Elem(controller</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineminus">-        .menus[&quot;options-menu&quot;][&quot;options-status-menu&quot;][&quot;options-status-&quot; + data.status</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineminus">-        + &quot;-menuitem&quot;]));</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineplus">+      controller.mainMenu.click(&quot;#options-status-&quot; + data.status + &quot;-menuitem&quot;);</span>
<a href="#l2.423"></a><span id="l2.423">     } else {</span>
<a href="#l2.424"></a><span id="l2.424">       controller.select(new elementslib.ID(controller.window.document, &quot;todo-status&quot;), undefined,</span>
<a href="#l2.425"></a><span id="l2.425">         undefined, data.status.toUpperCase());</span>
<a href="#l2.426"></a><span id="l2.426">       controller.sleep(sleep);</span>
<a href="#l2.427"></a><span id="l2.427">     }</span>
<a href="#l2.428"></a><span id="l2.428">   }</span>
<a href="#l2.429"></a><span id="l2.429">   </span>
<a href="#l2.430"></a><span id="l2.430">   let currentStatus = (new elementslib.ID(controller.window.document, &quot;todo-status&quot;)).getNode().value;</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineat">@@ -622,30 +636,50 @@ function setData(data, controller) {</span>
<a href="#l2.432"></a><span id="l2.432">   if (data.percent != undefined &amp;&amp; </span>
<a href="#l2.433"></a><span id="l2.433">        (currentStatus == &quot;NEEDS-ACTION&quot; || currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l2.434"></a><span id="l2.434">         currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l2.435"></a><span id="l2.435">     percentCompleteInput.getNode().value = data.percent;</span>
<a href="#l2.436"></a><span id="l2.436">   }</span>
<a href="#l2.437"></a><span id="l2.437">   </span>
<a href="#l2.438"></a><span id="l2.438">   // free/busy</span>
<a href="#l2.439"></a><span id="l2.439">   if (data.freebusy != undefined) {</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineminus">-    controller.click(new elementslib.Elem(controller</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineminus">-      .menus[&quot;options-menu&quot;][&quot;options-freebusy-menu&quot;][&quot;options-freebusy-&quot; + data.freebusy</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineminus">-      + &quot;-menuitem&quot;]));</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineplus">+    controller.mainMenu.click(&quot;#options-freebusy-&quot; + data.freebusy + &quot;-menuitem&quot;);</span>
<a href="#l2.444"></a><span id="l2.444">   }</span>
<a href="#l2.445"></a><span id="l2.445">   </span>
<a href="#l2.446"></a><span id="l2.446">   // attachment</span>
<a href="#l2.447"></a><span id="l2.447">   if (data.attachment != undefined) {</span>
<a href="#l2.448"></a><span id="l2.448">     if (data.attachment.add != undefined) {</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineminus">-      handleAddingAttachment(data.attachment.add);</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineplus">+      handleAddingAttachment(controller, data.attachment.add);</span>
<a href="#l2.451"></a><span id="l2.451">       controller.click(new elementslib.ID(controller.window.document, &quot;button-url&quot;));</span>
<a href="#l2.452"></a><span id="l2.452">     }</span>
<a href="#l2.453"></a><span id="l2.453">     if (data.attachment.delete != undefined) {</span>
<a href="#l2.454"></a><span id="l2.454">       controller.click(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l2.455"></a><span id="l2.455">         + 'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;' +</span>
<a href="#l2.456"></a><span id="l2.456">         data.attachment.delete + '&quot;}'));</span>
<a href="#l2.457"></a><span id="l2.457">       controller.keypress(new elementslib.ID(controller.window.document, &quot;attachment-link&quot;),</span>
<a href="#l2.458"></a><span id="l2.458">         &quot;VK_DELETE&quot;, {});</span>
<a href="#l2.459"></a><span id="l2.459">     }</span>
<a href="#l2.460"></a><span id="l2.460">   }</span>
<a href="#l2.461"></a><span id="l2.461">   </span>
<a href="#l2.462"></a><span id="l2.462">   controller.sleep(sleep);</span>
<a href="#l2.463"></a><span id="l2.463"> }</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineplus">+</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineplus">+// Export of constants</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineplus">+exports.ALLDAY = ALLDAY;</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineplus">+exports.CANVAS_BOX = CANVAS_BOX;</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineplus">+exports.EVENT_BOX = EVENT_BOX;</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineplus">+</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineplus">+// Export of functions</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineplus">+exports.acceptSendingNotificationMail = acceptSendingNotificationMail;</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineplus">+exports.back = back;</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineplus">+exports.createCalendar = createCalendar;</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineplus">+exports.deleteCalendars = deleteCalendars;</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineplus">+exports.findEventsInNode = findEventsInNode;</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineplus">+exports.forward = forward;</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineplus">+exports.getEventBoxPath = getEventBoxPath;</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineplus">+exports.goToDate = goToDate;</span>
<a href="#l2.479"></a><span id="l2.479" class="difflineplus">+exports.handleAddingAttachment = handleAddingAttachment;</span>
<a href="#l2.480"></a><span id="l2.480" class="difflineplus">+exports.handleOccurrenceDeletion = handleOccurrenceDeletion;</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineplus">+exports.handleOccurrenceModification = handleOccurrenceModification;</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineplus">+exports.handleParentDeletion = handleParentDeletion;</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineplus">+exports.handleParentModification = handleParentModification;</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineplus">+exports.setData = setData;</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineplus">+exports.switchToView = switchToView;</span>
<a href="#l2.486"></a><span id="l2.486">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">rename from calendar/test/mozmill/shared-modules/testTimezones.js</span>
<a href="#l3.2"></a><span id="l3.2">rename to calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/testTimezones.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineat">@@ -29,29 +29,27 @@</span>
<a href="#l3.6"></a><span id="l3.6">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.7"></a><span id="l3.7">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.8"></a><span id="l3.8">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.9"></a><span id="l3.9">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.10"></a><span id="l3.10">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.11"></a><span id="l3.11">  *</span>
<a href="#l3.12"></a><span id="l3.12">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.13"></a><span id="l3.13">  </span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-const MODULE_NAME = 'TimezoneUtils';</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-const sleep = 500;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+var calUtils = require(&quot;calendar-utils&quot;);</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+var prefs = require(&quot;prefs&quot;);</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-const RELATIVE_ROOT = '.';</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-const MODULE_REQUIRES = ['CalendarUtils', 'PrefsAPI'];</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+const sleep = 500;</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23"> function switchAppTimezone(timezone) {</span>
<a href="#l3.24"></a><span id="l3.24">   // change directly as Mac has different Lookup &amp; XPath than Windows &amp; Linux, bug 536605</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-  let api = collector.getModule('PrefsAPI');</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-  api.preferences.setPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+  prefs.preferences.setPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l3.28"></a><span id="l3.28"> }</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-function verify(dates, timezones, times, controller) {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+function verify(controller, dates, timezones, times) {</span>
<a href="#l3.32"></a><span id="l3.32">   let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l3.33"></a><span id="l3.33">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l3.34"></a><span id="l3.34">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)';</span>
<a href="#l3.35"></a><span id="l3.35">   let dayStack = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l3.36"></a><span id="l3.36">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l3.37"></a><span id="l3.37">     + '{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l3.38"></a><span id="l3.38">   let timeLine = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/'</span>
<a href="#l3.39"></a><span id="l3.39">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/';</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineat">@@ -59,18 +57,17 @@ function verify(dates, timezones, times,</span>
<a href="#l3.41"></a><span id="l3.41">   </span>
<a href="#l3.42"></a><span id="l3.42">   /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l3.43"></a><span id="l3.43">      xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l3.44"></a><span id="l3.44">      a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l3.45"></a><span id="l3.45">      But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l3.46"></a><span id="l3.46">      on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l3.47"></a><span id="l3.47">   */</span>
<a href="#l3.48"></a><span id="l3.48">   for (let date = 0; date &lt; dates.length; date++) {</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-    let utils = collector.getModule('CalendarUtils');</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-    utils.goToDate(dates[date][0], dates[date][1], dates[date][2], controller);</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+    calUtils.goToDate(controller, dates[date][0], dates[date][1], dates[date][2]);</span>
<a href="#l3.52"></a><span id="l3.52">     </span>
<a href="#l3.53"></a><span id="l3.53">     // find event with timezone tz</span>
<a href="#l3.54"></a><span id="l3.54">     for (let tz = 0; tz &lt; timezones.length; tz++) {</span>
<a href="#l3.55"></a><span id="l3.55">       let found = false;</span>
<a href="#l3.56"></a><span id="l3.56">       </span>
<a href="#l3.57"></a><span id="l3.57">       let correctHour = times[date][tz][0];</span>
<a href="#l3.58"></a><span id="l3.58">       let minutes = times[date][tz][1];</span>
<a href="#l3.59"></a><span id="l3.59">       let day = times[date][tz][2];</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineat">@@ -85,39 +82,43 @@ function verify(dates, timezones, times,</span>
<a href="#l3.61"></a><span id="l3.61">       </span>
<a href="#l3.62"></a><span id="l3.62">       // same day</span>
<a href="#l3.63"></a><span id="l3.63">       if(day == undefined) {</span>
<a href="#l3.64"></a><span id="l3.64">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l3.65"></a><span id="l3.65">       }</span>
<a href="#l3.66"></a><span id="l3.66">       </span>
<a href="#l3.67"></a><span id="l3.67">       // following day</span>
<a href="#l3.68"></a><span id="l3.68">       if(day != undefined &amp;&amp; day == 1) {</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-        utils.forward(1);</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l3.71"></a><span id="l3.71">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l3.72"></a><span id="l3.72">       }</span>
<a href="#l3.73"></a><span id="l3.73">       </span>
<a href="#l3.74"></a><span id="l3.74">       // previous day</span>
<a href="#l3.75"></a><span id="l3.75">       if(day != undefined &amp;&amp; day == -1) {</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-        utils.back(1);</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+        calUtils.back(controller, 1);</span>
<a href="#l3.78"></a><span id="l3.78">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l3.79"></a><span id="l3.79">       }</span>
<a href="#l3.80"></a><span id="l3.80">       </span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-      utils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+      calUtils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l3.83"></a><span id="l3.83">       </span>
<a href="#l3.84"></a><span id="l3.84">       for each (node in eventNodes) {</span>
<a href="#l3.85"></a><span id="l3.85">         if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l3.86"></a><span id="l3.86">                      timezones[tz] == node.mOccurrence.title) {</span>
<a href="#l3.87"></a><span id="l3.87">           found = true;</span>
<a href="#l3.88"></a><span id="l3.88">           break;</span>
<a href="#l3.89"></a><span id="l3.89">         }</span>
<a href="#l3.90"></a><span id="l3.90">       }</span>
<a href="#l3.91"></a><span id="l3.91">       </span>
<a href="#l3.92"></a><span id="l3.92">       if(day != undefined &amp;&amp; day == 1) {</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-        utils.back(1);</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+        calUtils.back(controller, 1);</span>
<a href="#l3.95"></a><span id="l3.95">       }</span>
<a href="#l3.96"></a><span id="l3.96">       </span>
<a href="#l3.97"></a><span id="l3.97">       if(day != undefined &amp;&amp; day == -1) {</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-        utils.forward(1);</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l3.100"></a><span id="l3.100">       }</span>
<a href="#l3.101"></a><span id="l3.101">       controller.assertJS(found == true);</span>
<a href="#l3.102"></a><span id="l3.102">     }</span>
<a href="#l3.103"></a><span id="l3.103">   }</span>
<a href="#l3.104"></a><span id="l3.104"> }</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+// Export of functions</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+exports.switchAppTimezone = switchAppTimezone;</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+exports.verify = verify;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -28,37 +28,36 @@</span>
<a href="#l4.4"></a><span id="l4.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.5"></a><span id="l4.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.6"></a><span id="l4.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.7"></a><span id="l4.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.8"></a><span id="l4.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.9"></a><span id="l4.9">  *</span>
<a href="#l4.10"></a><span id="l4.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI'];</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+var modalDialog = require(&quot;./shared-modules/modal-dialog&quot;);</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> var sleep = 500;</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19"> var setupModule = function(module) {</span>
<a href="#l4.20"></a><span id="l4.20">   controller = mozmill.getMail3PaneController();</span>
<a href="#l4.21"></a><span id="l4.21"> }</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23"> var testSmokeTest = function () {</span>
<a href="#l4.24"></a><span id="l4.24">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l4.25"></a><span id="l4.25">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l4.26"></a><span id="l4.26">   let path = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l4.27"></a><span id="l4.27">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/';</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">   // open calendar view</span>
<a href="#l4.30"></a><span id="l4.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l4.32"></a><span id="l4.32">   </span>
<a href="#l4.33"></a><span id="l4.33">   // check for minimonth</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-  controller.assertNode(new elementslib.ID(controller.window.document, &quot;calMinimonth&quot;));</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+  controller.waitForElement(new elementslib.ID(controller.window.document, &quot;calMinimonth&quot;));</span>
<a href="#l4.36"></a><span id="l4.36">   // every month has a first</span>
<a href="#l4.37"></a><span id="l4.37">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l4.38"></a><span id="l4.38">     + 'id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/'</span>
<a href="#l4.39"></a><span id="l4.39">     + 'id(&quot;calMinimonth&quot;)/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l4.40"></a><span id="l4.40">   </span>
<a href="#l4.41"></a><span id="l4.41">   // check for calendar list</span>
<a href="#l4.42"></a><span id="l4.42">   controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-list-pane&quot;));</span>
<a href="#l4.43"></a><span id="l4.43">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineat">@@ -78,59 +77,56 @@ var testSmokeTest = function () {</span>
<a href="#l4.45"></a><span id="l4.45">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/{&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;' + label + '&quot;}'));</span>
<a href="#l4.46"></a><span id="l4.46">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l4.47"></a><span id="l4.47">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/'</span>
<a href="#l4.48"></a><span id="l4.48">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/'</span>
<a href="#l4.49"></a><span id="l4.49">     + 'anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l4.50"></a><span id="l4.50">     </span>
<a href="#l4.51"></a><span id="l4.51">   // open tasks view</span>
<a href="#l4.52"></a><span id="l4.52">   controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l4.54"></a><span id="l4.54">   // should be possible to filter today's tasks</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-  controller.assertNode(new elementslib.ID(controller.window.document, &quot;opt_today_filter&quot;));</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+  controller.waitForElement(new elementslib.ID(controller.window.document, &quot;opt_today_filter&quot;));</span>
<a href="#l4.57"></a><span id="l4.57">   // check for task add button</span>
<a href="#l4.58"></a><span id="l4.58">   controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-add-task-button&quot;));</span>
<a href="#l4.59"></a><span id="l4.59">   // check for filtered tasks list</span>
<a href="#l4.60"></a><span id="l4.60">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l4.61"></a><span id="l4.61">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/[1]/id(&quot;calendar-task-tree&quot;)/'</span>
<a href="#l4.62"></a><span id="l4.62">     + 'anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}'));</span>
<a href="#l4.63"></a><span id="l4.63">   </span>
<a href="#l4.64"></a><span id="l4.64">   // create test calendar</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(handleDialog);</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-  md.start();</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+  var md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+  md.start(handleDialog);</span>
<a href="#l4.69"></a><span id="l4.69">   let calendarList = new elementslib.Lookup(controller.window.document, path </span>
<a href="#l4.70"></a><span id="l4.70">     + '/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/'</span>
<a href="#l4.71"></a><span id="l4.71">     + 'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})');</span>
<a href="#l4.72"></a><span id="l4.72">   controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height); // bottom left</span>
<a href="#l4.73"></a><span id="l4.73"> }</span>
<a href="#l4.74"></a><span id="l4.74"> </span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-function handleDialog(controller) { </span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+var handleDialog = function(controller) {</span>
<a href="#l4.77"></a><span id="l4.77">   let wizardPath = '/id(&quot;calendar-wizard&quot;)/anon({&quot;anonid&quot;:&quot;Buttons&quot;})/'</span>
<a href="#l4.78"></a><span id="l4.78">     + 'anon({&quot;class&quot;:&quot;wizard-buttons-box-1&quot;})/{&quot;class&quot;:&quot;wizard-buttons-box-2&quot;}/'</span>
<a href="#l4.79"></a><span id="l4.79">     + 'anon({&quot;anonid&quot;:&quot;WizardButtonDeck&quot;})/';</span>
<a href="#l4.80"></a><span id="l4.80">   </span>
<a href="#l4.81"></a><span id="l4.81">   // click next</span>
<a href="#l4.82"></a><span id="l4.82">   controller.waitForElement(new elementslib.Lookup(controller.window.document, wizardPath</span>
<a href="#l4.83"></a><span id="l4.83">     + '[1]/{&quot;dlgtype&quot;:&quot;next&quot;}'));</span>
<a href="#l4.84"></a><span id="l4.84">   controller.click(new elementslib.Lookup(controller.window.document, wizardPath</span>
<a href="#l4.85"></a><span id="l4.85">     + '[1]/{&quot;dlgtype&quot;:&quot;next&quot;}'));</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l4.87"></a><span id="l4.87">   </span>
<a href="#l4.88"></a><span id="l4.88">   // set calendar name</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-  controller.type(new elementslib.Lookup(controller.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+  let calendarNameTextBox = new elementslib.Lookup(controller.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l4.91"></a><span id="l4.91">     + '{&quot;pageid&quot;:&quot;customizePage&quot;}/[1]/id(&quot;customize-rows&quot;)/id(&quot;customize-name-row&quot;)/'</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-    + 'id(&quot;calendar-name&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'), </span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-    &quot;Mozmill&quot;);</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+    + 'id(&quot;calendar-name&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+  controller.waitForElement(calendarNameTextBox);</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+  controller.type(calendarNameTextBox, &quot;Mozmill&quot;);</span>
<a href="#l4.98"></a><span id="l4.98">   </span>
<a href="#l4.99"></a><span id="l4.99">   // click next</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, wizardPath</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, wizardPath</span>
<a href="#l4.102"></a><span id="l4.102">     + '[1]/{&quot;dlgtype&quot;:&quot;next&quot;}'));</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l4.104"></a><span id="l4.104">   </span>
<a href="#l4.105"></a><span id="l4.105">   // click finish</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, wizardPath</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, wizardPath</span>
<a href="#l4.108"></a><span id="l4.108">     + '/[0]/{&quot;dlgtype&quot;:&quot;finish&quot;}'));</span>
<a href="#l4.109"></a><span id="l4.109"> }</span>
<a href="#l4.110"></a><span id="l4.110"> </span>
<a href="#l4.111"></a><span id="l4.111"> var teardownTest = function(module) {</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-  CalendarUtils.deleteCalendars(&quot;Mozmill&quot;);</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+  calUtils.deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l4.114"></a><span id="l4.114"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/test/mozmill/testDayView.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/test/mozmill/testDayView.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -29,28 +29,27 @@</span>
<a href="#l5.4"></a><span id="l5.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.5"></a><span id="l5.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.6"></a><span id="l5.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.7"></a><span id="l5.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.8"></a><span id="l5.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.9"></a><span id="l5.9">  *</span>
<a href="#l5.10"></a><span id="l5.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> var sleep = 500;</span>
<a href="#l5.17"></a><span id="l5.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l5.18"></a><span id="l5.18"> var title1 = &quot;Day View Event&quot;;</span>
<a href="#l5.19"></a><span id="l5.19"> var title2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l5.20"></a><span id="l5.20"> var desc = &quot;Day View Event Description&quot;;</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> var setupModule = function(module) {</span>
<a href="#l5.23"></a><span id="l5.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l5.26"></a><span id="l5.26"> }</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28"> var testDayView = function () {</span>
<a href="#l5.29"></a><span id="l5.29">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l5.30"></a><span id="l5.30">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l5.31"></a><span id="l5.31">   // paths</span>
<a href="#l5.32"></a><span id="l5.32">   let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l5.33"></a><span id="l5.33">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/'</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineat">@@ -68,50 +67,47 @@ var testDayView = function () {</span>
<a href="#l5.35"></a><span id="l5.35">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l5.36"></a><span id="l5.36">   </span>
<a href="#l5.37"></a><span id="l5.37">   // pick year</span>
<a href="#l5.38"></a><span id="l5.38">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.39"></a><span id="l5.39">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l5.40"></a><span id="l5.40">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.41"></a><span id="l5.41">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l5.42"></a><span id="l5.42">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l5.44"></a><span id="l5.44">   </span>
<a href="#l5.45"></a><span id="l5.45">   // pick month</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.48"></a><span id="l5.48">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l5.49"></a><span id="l5.49">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.50"></a><span id="l5.50">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l5.51"></a><span id="l5.51">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l5.53"></a><span id="l5.53">   </span>
<a href="#l5.54"></a><span id="l5.54">   // pick day</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l5.57"></a><span id="l5.57">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l5.59"></a><span id="l5.59">   </span>
<a href="#l5.60"></a><span id="l5.60">   // verify date in view</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-  controller.assertJS(day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+  controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64">   // create event at 8 AM</span>
<a href="#l5.65"></a><span id="l5.65">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.66"></a><span id="l5.66">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l5.67"></a><span id="l5.67">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'));</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l5.72"></a><span id="l5.72">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l5.74"></a><span id="l5.74">   </span>
<a href="#l5.75"></a><span id="l5.75">   // check that the start time is correct</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.78"></a><span id="l5.78">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l5.79"></a><span id="l5.79">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l5.80"></a><span id="l5.80">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-    '8:00');</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineplus">+  event.waitForElement(startTimeInput);</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+  event.assertValue(startTimeInput, '8:00');</span>
<a href="#l5.86"></a><span id="l5.86">   let date = startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l5.87"></a><span id="l5.87">     2009, 1, 1);</span>
<a href="#l5.88"></a><span id="l5.88">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.89"></a><span id="l5.89">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l5.90"></a><span id="l5.90">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l5.91"></a><span id="l5.91">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l5.92"></a><span id="l5.92">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l5.93"></a><span id="l5.93">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineat">@@ -121,65 +117,61 @@ var testDayView = function () {</span>
<a href="#l5.95"></a><span id="l5.95">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.96"></a><span id="l5.96">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l5.97"></a><span id="l5.97">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l5.98"></a><span id="l5.98">     title1);</span>
<a href="#l5.99"></a><span id="l5.99">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.100"></a><span id="l5.100">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l5.101"></a><span id="l5.101">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l5.102"></a><span id="l5.102">     desc);</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-  event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-    + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/'</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-    + '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+  event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l5.109"></a><span id="l5.109">   </span>
<a href="#l5.110"></a><span id="l5.110">   // save</span>
<a href="#l5.111"></a><span id="l5.111">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l5.113"></a><span id="l5.113">   </span>
<a href="#l5.114"></a><span id="l5.114">   // if it was created successfully, it can be opened</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+  let eventBox = new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.117"></a><span id="l5.117">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l5.118"></a><span id="l5.118">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l5.119"></a><span id="l5.119">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[0]/'</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-    + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+    + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}');</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+  controller.waitForElement(eventBox);</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+  controller.doubleClick(eventBox);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l5.126"></a><span id="l5.126">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l5.128"></a><span id="l5.128">   </span>
<a href="#l5.129"></a><span id="l5.129">   // change title and save changes</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineplus">+  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l5.132"></a><span id="l5.132">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-    title2);</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+  event.waitForElement(titleTextBox);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+  event.type(titleTextBox, title2);</span>
<a href="#l5.138"></a><span id="l5.138">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l5.140"></a><span id="l5.140">   </span>
<a href="#l5.141"></a><span id="l5.141">   // check if name was saved</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-  controller.assertProperty(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+  let eventName = new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.144"></a><span id="l5.144">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l5.145"></a><span id="l5.145">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l5.146"></a><span id="l5.146">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/'</span>
<a href="#l5.147"></a><span id="l5.147">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/'</span>
<a href="#l5.148"></a><span id="l5.148">     + 'anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})'),</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-    &quot;textContent&quot;, title2);</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+  controller.waitForElement(eventName);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+  controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l5.154"></a><span id="l5.154">   </span>
<a href="#l5.155"></a><span id="l5.155">   // delete event</span>
<a href="#l5.156"></a><span id="l5.156">   controller.click(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.157"></a><span id="l5.157">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l5.158"></a><span id="l5.158">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l5.159"></a><span id="l5.159">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/'</span>
<a href="#l5.160"></a><span id="l5.160">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l5.161"></a><span id="l5.161">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l5.162"></a><span id="l5.162">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l5.166"></a><span id="l5.166">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l5.167"></a><span id="l5.167">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l5.168"></a><span id="l5.168">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/'</span>
<a href="#l5.169"></a><span id="l5.169">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l5.170"></a><span id="l5.170"> }</span>
<a href="#l5.171"></a><span id="l5.171"> </span>
<a href="#l5.172"></a><span id="l5.172"> var teardownTest = function(module) {</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l5.175"></a><span id="l5.175"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/test/mozmill/testEventDialog.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/test/mozmill/testEventDialog.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -29,30 +29,32 @@</span>
<a href="#l6.4"></a><span id="l6.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.5"></a><span id="l6.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.6"></a><span id="l6.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.7"></a><span id="l6.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.8"></a><span id="l6.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.9"></a><span id="l6.9">  *</span>
<a href="#l6.10"></a><span id="l6.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-var MODULE_REQUIRES = ['ModalDialogAPI', 'UtilsAPI', 'CalendarUtils'];</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+var modalDialog = require(&quot;./shared-modules/modal-dialog&quot;);</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+var utils = require(&quot;./shared-modules/utils&quot;);</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> var sleep = 500;</span>
<a href="#l6.19"></a><span id="l6.19"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l6.20"></a><span id="l6.20"> var title = &quot;Event&quot;;</span>
<a href="#l6.21"></a><span id="l6.21"> var location = &quot;Location&quot;;</span>
<a href="#l6.22"></a><span id="l6.22"> var desc = &quot;Event Decription&quot;;</span>
<a href="#l6.23"></a><span id="l6.23"> var attendee = &quot;foo@bar.com&quot;;</span>
<a href="#l6.24"></a><span id="l6.24"> var url = &quot;http://mozilla.org&quot;;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+var tmp;</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27"> var setupModule = function(module) {</span>
<a href="#l6.28"></a><span id="l6.28">   controller = mozmill.getMail3PaneController();</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l6.31"></a><span id="l6.31"> }</span>
<a href="#l6.32"></a><span id="l6.32"> </span>
<a href="#l6.33"></a><span id="l6.33"> var testEventDialog = function () {</span>
<a href="#l6.34"></a><span id="l6.34">   // paths</span>
<a href="#l6.35"></a><span id="l6.35">   let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l6.36"></a><span id="l6.36">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l6.37"></a><span id="l6.37">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l6.38"></a><span id="l6.38">   let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineat">@@ -70,49 +72,47 @@ var testEventDialog = function () {</span>
<a href="#l6.40"></a><span id="l6.40">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l6.41"></a><span id="l6.41">     </span>
<a href="#l6.42"></a><span id="l6.42">   // pick year</span>
<a href="#l6.43"></a><span id="l6.43">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.44"></a><span id="l6.44">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l6.45"></a><span id="l6.45">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.46"></a><span id="l6.46">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l6.47"></a><span id="l6.47">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l6.49"></a><span id="l6.49">   </span>
<a href="#l6.50"></a><span id="l6.50">   // pick month</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.53"></a><span id="l6.53">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l6.54"></a><span id="l6.54">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.55"></a><span id="l6.55">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l6.56"></a><span id="l6.56">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l6.58"></a><span id="l6.58"> </span>
<a href="#l6.59"></a><span id="l6.59">   // pick day</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l6.62"></a><span id="l6.62">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l6.63"></a><span id="l6.63">   controller.sleep(sleep);</span>
<a href="#l6.64"></a><span id="l6.64">   </span>
<a href="#l6.65"></a><span id="l6.65">   // create new event</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_File.menu_New.ltnNewEvent));</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l6.70"></a><span id="l6.70">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l6.72"></a><span id="l6.72">   </span>
<a href="#l6.73"></a><span id="l6.73">   // check that the start time is correct</span>
<a href="#l6.74"></a><span id="l6.74">   // next full hour except last hour hour of the day</span>
<a href="#l6.75"></a><span id="l6.75">   let hour = new Date().getHours();</span>
<a href="#l6.76"></a><span id="l6.76">   let startHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l6.77"></a><span id="l6.77">   let startTime = startHour + ':00';</span>
<a href="#l6.78"></a><span id="l6.78">   let endTime = ((startHour + 1) % 24) + ':00';</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.81"></a><span id="l6.81">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l6.82"></a><span id="l6.82">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l6.83"></a><span id="l6.83">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-    startTime);</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+  event.waitForElement(startTimeInput);</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+  event.assertValue(startTimeInput, startTime);</span>
<a href="#l6.89"></a><span id="l6.89">   </span>
<a href="#l6.90"></a><span id="l6.90">   // check selected calendar</span>
<a href="#l6.91"></a><span id="l6.91">   event.assertNode(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.92"></a><span id="l6.92">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/'</span>
<a href="#l6.93"></a><span id="l6.93">     + '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'))</span>
<a href="#l6.94"></a><span id="l6.94">   </span>
<a href="#l6.95"></a><span id="l6.95">   // fill in name, location, description</span>
<a href="#l6.96"></a><span id="l6.96">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineat">@@ -123,59 +123,56 @@ var testEventDialog = function () {</span>
<a href="#l6.98"></a><span id="l6.98">     + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l6.99"></a><span id="l6.99">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'), location);</span>
<a href="#l6.100"></a><span id="l6.100">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.101"></a><span id="l6.101">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l6.102"></a><span id="l6.102">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l6.103"></a><span id="l6.103">     desc);</span>
<a href="#l6.104"></a><span id="l6.104">   </span>
<a href="#l6.105"></a><span id="l6.105">   // set category</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-  let categories = UtilsAPI.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+  let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l6.108"></a><span id="l6.108">   let category = categories.split(',')[4]; // pick 4th value in a comma-separated list</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-  event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-    + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/'</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-    + 'id(&quot;item-categories&quot;)/[0]/{&quot;label&quot;:&quot;' + category + '&quot;}'));</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+  event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), null, category);</span>
<a href="#l6.113"></a><span id="l6.113"> </span>
<a href="#l6.114"></a><span id="l6.114">   // repeat daily</span>
<a href="#l6.115"></a><span id="l6.115">   event.click(new elementslib.ID(event.window.document, &quot;repeat-daily-menuitem&quot;));</span>
<a href="#l6.116"></a><span id="l6.116">   </span>
<a href="#l6.117"></a><span id="l6.117">   // add reminder</span>
<a href="#l6.118"></a><span id="l6.118">   event.click(new elementslib.ID(event.window.document, &quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l6.119"></a><span id="l6.119">   </span>
<a href="#l6.120"></a><span id="l6.120">   // add an attendee and verify added</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(handleAttendees);</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-  md.start();</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineplus">+  md.start(handleAttendees);</span>
<a href="#l6.125"></a><span id="l6.125">   event.click(new elementslib.ID(event.window.document, &quot;button-attendees&quot;));</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-  /*event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-    attendee);*/</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineplus">+  event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineplus">+    attendee);</span>
<a href="#l6.130"></a><span id="l6.130">   </span>
<a href="#l6.131"></a><span id="l6.131">   // make it private and verify icon visible</span>
<a href="#l6.132"></a><span id="l6.132">   event.click(new elementslib.ID(event.window.document, &quot;button-privacy&quot;));</span>
<a href="#l6.133"></a><span id="l6.133">   event.click(new elementslib.ID(event.window.document, &quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l6.134"></a><span id="l6.134">   let icon = (new elementslib.ID(event.window.document, &quot;button-privacy-private&quot;));</span>
<a href="#l6.135"></a><span id="l6.135">   event.assertJS(event.window.getComputedStyle(icon.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l6.136"></a><span id="l6.136">   </span>
<a href="#l6.137"></a><span id="l6.137">   // add attachment and verify added</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineminus">-  CalendarUtils.handleAddingAttachment(url);</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineplus">+  calUtils.handleAddingAttachment(event, url);</span>
<a href="#l6.140"></a><span id="l6.140">   event.click(new elementslib.ID(event.window.document, &quot;button-url&quot;));</span>
<a href="#l6.141"></a><span id="l6.141">   event.assertNode(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l6.142"></a><span id="l6.142">     + 'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l6.143"></a><span id="l6.143">   </span>
<a href="#l6.144"></a><span id="l6.144">   // save</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-  CalendarUtils.acceptSendingNotificationMail();</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineplus">+  calUtils.acceptSendingNotificationMail(event);</span>
<a href="#l6.147"></a><span id="l6.147">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l6.149"></a><span id="l6.149">   </span>
<a href="#l6.150"></a><span id="l6.150">   // catch and dismiss alarm</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0', sleep);</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0}, sleep);</span>
<a href="#l6.153"></a><span id="l6.153">   let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l6.154"></a><span id="l6.154">   // dismiss all button, label in .dtd file, bug #504635</span>
<a href="#l6.155"></a><span id="l6.155">   alarm.waitThenClick(new elementslib.Lookup(alarm.window.document, '/id(&quot;calendar-alarm-dialog&quot;)/'</span>
<a href="#l6.156"></a><span id="l6.156">     + 'id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0', sleep);</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0}, sleep);</span>
<a href="#l6.159"></a><span id="l6.159">   </span>
<a href="#l6.160"></a><span id="l6.160">   // verify event and alarm icon visible every day of the month and check tooltip</span>
<a href="#l6.161"></a><span id="l6.161">   // 1st January is Thursday so there's three days to check in the first row</span>
<a href="#l6.162"></a><span id="l6.162">   controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.163"></a><span id="l6.163">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l6.164"></a><span id="l6.164">   checkIcon(eventBox, &quot;0&quot;, &quot;4&quot;);</span>
<a href="#l6.165"></a><span id="l6.165">   checkTooltip(monthView, &quot;0&quot;, &quot;4&quot;, &quot;1&quot;, startTime, endTime);</span>
<a href="#l6.166"></a><span id="l6.166">   </span>
<a href="#l6.167"></a><span id="l6.167" class="difflineat">@@ -197,65 +194,64 @@ var testEventDialog = function () {</span>
<a href="#l6.168"></a><span id="l6.168">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l6.169"></a><span id="l6.169">         checkIcon(eventBox, row, col);</span>
<a href="#l6.170"></a><span id="l6.170">         checkTooltip(monthView, row, col, date, startTime, endTime);</span>
<a href="#l6.171"></a><span id="l6.171">         date++;</span>
<a href="#l6.172"></a><span id="l6.172">     }</span>
<a href="#l6.173"></a><span id="l6.173">   }</span>
<a href="#l6.174"></a><span id="l6.174">   </span>
<a href="#l6.175"></a><span id="l6.175">   // delete and verify deleted 2nd Jan</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-  CalendarUtils.handleOccurrenceDeletion();</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineplus">+  calUtils.handleOccurrenceDeletion(controller);</span>
<a href="#l6.178"></a><span id="l6.178">   controller.click(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.179"></a><span id="l6.179">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l6.180"></a><span id="l6.180">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l6.181"></a><span id="l6.181">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-  controller.sleep;</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineminus">-  </span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.185"></a><span id="l6.185" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.186"></a><span id="l6.186">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l6.187"></a><span id="l6.187">   </span>
<a href="#l6.188"></a><span id="l6.188">   // verify all others still exist</span>
<a href="#l6.189"></a><span id="l6.189">   controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.190"></a><span id="l6.190">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l6.191"></a><span id="l6.191">   controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.192"></a><span id="l6.192">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l6.193"></a><span id="l6.193">     </span>
<a href="#l6.194"></a><span id="l6.194">   for(row = 1; row &lt; 5; row++)</span>
<a href="#l6.195"></a><span id="l6.195">     for(col = 0; col &lt; 7; col++)</span>
<a href="#l6.196"></a><span id="l6.196">         controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.197"></a><span id="l6.197">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l6.198"></a><span id="l6.198">   </span>
<a href="#l6.199"></a><span id="l6.199">   // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-  CalendarUtils.handleParentDeletion();</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+  calUtils.handleParentDeletion(controller);</span>
<a href="#l6.202"></a><span id="l6.202">   controller.click(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.203"></a><span id="l6.203">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l6.204"></a><span id="l6.204">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l6.205"></a><span id="l6.205">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l6.207"></a><span id="l6.207">   </span>
<a href="#l6.208"></a><span id="l6.208">   // verify all deleted</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.210"></a><span id="l6.210" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.211"></a><span id="l6.211">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l6.212"></a><span id="l6.212">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.213"></a><span id="l6.213">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l6.214"></a><span id="l6.214">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.215"></a><span id="l6.215">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l6.216"></a><span id="l6.216">     </span>
<a href="#l6.217"></a><span id="l6.217">   for(row = 1; row &lt; 5; row++)</span>
<a href="#l6.218"></a><span id="l6.218">     for(col = 0; col &lt; 7; col++)</span>
<a href="#l6.219"></a><span id="l6.219">         controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.220"></a><span id="l6.220">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l6.221"></a><span id="l6.221"> }</span>
<a href="#l6.222"></a><span id="l6.222"> </span>
<a href="#l6.223"></a><span id="l6.223"> function handleAttendees(attendees){</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-  attendees.sleep(sleep);</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-  /*let input = new elementslib.Lookup(attendees.window.document, </span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-    '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[5]/[0]/id(&quot;attendees-list&quot;)/anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/'</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-    + '[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/{&quot;class&quot;:&quot;textbox-input-box&quot;}/[0]');</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-  attendees.type(input, attendee);*/</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineplus">+  let input = new elementslib.Lookup(attendees.window.document,</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineplus">+    '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/'</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/'</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineplus">+    + 'anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/'</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineplus">+    + '{&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineplus">+  attendees.waitForElement(input);</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineplus">+  attendees.type(input, attendee);</span>
<a href="#l6.236"></a><span id="l6.236">   attendees.click(new elementslib.Lookup(attendees.window.document, </span>
<a href="#l6.237"></a><span id="l6.237">     '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l6.238"></a><span id="l6.238"> }</span>
<a href="#l6.239"></a><span id="l6.239"> </span>
<a href="#l6.240"></a><span id="l6.240"> function checkIcon(eventBox, row, col){</span>
<a href="#l6.241"></a><span id="l6.241">   let icon = new elementslib.Lookup(controller.window.document, </span>
<a href="#l6.242"></a><span id="l6.242">     (eventBox + '/[3]/{&quot;class&quot;:&quot;alarm-icons-box&quot;}/{&quot;class&quot;:&quot;reminder-icon&quot;}')</span>
<a href="#l6.243"></a><span id="l6.243">     .replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineat">@@ -280,10 +276,10 @@ function checkTooltip(monthView, row, co</span>
<a href="#l6.245"></a><span id="l6.245">   let dateTime = new elementslib.Lookup(controller.window.document,</span>
<a href="#l6.246"></a><span id="l6.246">     '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/'</span>
<a href="#l6.247"></a><span id="l6.247">     + '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]').getNode().textContent + '';</span>
<a href="#l6.248"></a><span id="l6.248">   controller.assertJS(dateTime.indexOf(date) != -1 &amp;&amp; dateTime.indexOf(startTime) != -1</span>
<a href="#l6.249"></a><span id="l6.249">     &amp;&amp; dateTime.indexOf(endTime) != -1);</span>
<a href="#l6.250"></a><span id="l6.250"> }</span>
<a href="#l6.251"></a><span id="l6.251"> </span>
<a href="#l6.252"></a><span id="l6.252"> var teardownTest = function(module) {</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l6.255"></a><span id="l6.255"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/test/mozmill/testEventDialogModificationPrompt.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/test/mozmill/testEventDialogModificationPrompt.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -29,142 +29,157 @@</span>
<a href="#l7.4"></a><span id="l7.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l7.5"></a><span id="l7.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l7.6"></a><span id="l7.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l7.7"></a><span id="l7.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l7.8"></a><span id="l7.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l7.9"></a><span id="l7.9">  *</span>
<a href="#l7.10"></a><span id="l7.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'PrefsAPI'];</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+var modalDialog = require(&quot;./shared-modules/modal-dialog&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+var prefs = require(&quot;./shared-modules/prefs&quot;);</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> const sleep = 500;</span>
<a href="#l7.19"></a><span id="l7.19"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l7.20"></a><span id="l7.20"> var title = &quot;Title&quot;;</span>
<a href="#l7.21"></a><span id="l7.21"> var location = &quot;Location&quot;;</span>
<a href="#l7.22"></a><span id="l7.22"> var description = &quot;Description\ncontinuing&quot;;</span>
<a href="#l7.23"></a><span id="l7.23"> var pass;</span>
<a href="#l7.24"></a><span id="l7.24"> var date1 = new Date(2009, 0, 1,  8, 0);</span>
<a href="#l7.25"></a><span id="l7.25"> var date2 = new Date(2009, 0, 2,  9, 0);</span>
<a href="#l7.26"></a><span id="l7.26"> var date3 = new Date(2009, 0, 3, 10, 0);</span>
<a href="#l7.27"></a><span id="l7.27"> var data = [{title: &quot;title1&quot;, location: &quot;location1&quot;, description: &quot;description1&quot;, allday: false,</span>
<a href="#l7.28"></a><span id="l7.28">              startdate: date1, starttime: date1, enddate: date2, endtime: date2, repeat: &quot;none&quot;,</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-             reminder: 0, priority: &quot;normal&quot;, privacy: &quot;public&quot;, status: &quot;confirmed&quot;, </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+             reminder: 0, priority: &quot;normal&quot;, privacy: &quot;public&quot;, status: &quot;confirmed&quot;,</span>
<a href="#l7.31"></a><span id="l7.31">              freebusy: &quot;busy&quot;, timezone: true, attachment: {add: &quot;http://mozilla.org&quot;}},</span>
<a href="#l7.32"></a><span id="l7.32">             {title: &quot;title2&quot;, location: &quot;location2&quot;, description: &quot;description2&quot;, allday: true,</span>
<a href="#l7.33"></a><span id="l7.33">              startdate: date2, starttime: date2, enddate: date3, endtime: date3, repeat: &quot;daily&quot;,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-             reminder: 1, priority: &quot;high&quot;, privacy: &quot;private&quot;, status: &quot;tentative&quot;, </span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+             reminder: 2, priority: &quot;high&quot;, privacy: &quot;private&quot;, status: &quot;tentative&quot;,</span>
<a href="#l7.36"></a><span id="l7.36">              freebusy: &quot;free&quot;, timezone: true, attachment: {delete: &quot;mozilla.org&quot;}}];</span>
<a href="#l7.37"></a><span id="l7.37"> var newlines = [{title: &quot;title&quot;, description: &quot;  test spaces  &quot;},</span>
<a href="#l7.38"></a><span id="l7.38">                 {title: &quot;title&quot;, description: &quot;\ntest newline\n&quot;},</span>
<a href="#l7.39"></a><span id="l7.39">                 {title: &quot;title&quot;, description: &quot;\rtest \\r\r&quot;},</span>
<a href="#l7.40"></a><span id="l7.40">                 {title: &quot;title&quot;, description: &quot;\r\ntest \\r\\n\r\n&quot;},</span>
<a href="#l7.41"></a><span id="l7.41">                 {title: &quot;title&quot;, description: &quot;\ttest \\t\t&quot;}];</span>
<a href="#l7.42"></a><span id="l7.42"> </span>
<a href="#l7.43"></a><span id="l7.43"> var setupModule = function(module) {</span>
<a href="#l7.44"></a><span id="l7.44">   controller = mozmill.getMail3PaneController();</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l7.47"></a><span id="l7.47">   </span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-  let categories = PrefsAPI.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(',');</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+  let categories = prefs.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(',');</span>
<a href="#l7.50"></a><span id="l7.50">   data[0].category = categories[0];</span>
<a href="#l7.51"></a><span id="l7.51">   data[1].category = categories[1];</span>
<a href="#l7.52"></a><span id="l7.52"> }</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54"> // Test that closing an event dialog with no changes does not prompt for save</span>
<a href="#l7.55"></a><span id="l7.55"> var testEventDialogModificationPrompt = function () {</span>
<a href="#l7.56"></a><span id="l7.56">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l7.62"></a><span id="l7.62">   </span>
<a href="#l7.63"></a><span id="l7.63">   // create new event</span>
<a href="#l7.64"></a><span id="l7.64">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, 8, controller)));</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l7.69"></a><span id="l7.69">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l7.70"></a><span id="l7.70">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.71"></a><span id="l7.71">   </span>
<a href="#l7.72"></a><span id="l7.72">   // enter first set of data</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-  CalendarUtils.setData(data[0], event);</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+  calUtils.setData(event, data[0]);</span>
<a href="#l7.75"></a><span id="l7.75">   </span>
<a href="#l7.76"></a><span id="l7.76">   // save</span>
<a href="#l7.77"></a><span id="l7.77">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+  </span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+  // open, but change nothing</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+  let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+    + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+  controller.waitForElement(eventBox);</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+  controller.doubleClick(eventBox);</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+  event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.89"></a><span id="l7.89">   </span>
<a href="#l7.90"></a><span id="l7.90">   // modal dialog setup</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(handleSavePrompt);</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-  md.start();</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-  // open, but change nothing</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, 8, controller)</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-    + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+  md.start(handleSavePrompt);</span>
<a href="#l7.103"></a><span id="l7.103">   </span>
<a href="#l7.104"></a><span id="l7.104">   // escape the event window, there should be no prompt to save event</span>
<a href="#l7.105"></a><span id="l7.105">   event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l7.106"></a><span id="l7.106">   controller.sleep(sleep);</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineplus">+  md.stop();</span>
<a href="#l7.108"></a><span id="l7.108">   </span>
<a href="#l7.109"></a><span id="l7.109">   // open</span>
<a href="#l7.110"></a><span id="l7.110">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, 8, controller)</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l7.113"></a><span id="l7.113">     + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l7.116"></a><span id="l7.116">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l7.117"></a><span id="l7.117">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.118"></a><span id="l7.118">   </span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+  md = new modalDialog.modalDialog(event.window);</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+  md.start(handleSavePrompt);</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+  </span>
<a href="#l7.122"></a><span id="l7.122">   // change all values</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineminus">-  CalendarUtils.setData(data[1], event);</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+  calUtils.setData(event, data[1]);</span>
<a href="#l7.125"></a><span id="l7.125">   </span>
<a href="#l7.126"></a><span id="l7.126">   // edit all values back to original</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineminus">-  CalendarUtils.setData(data[0], event);</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+  calUtils.setData(event, data[0]);</span>
<a href="#l7.129"></a><span id="l7.129">   </span>
<a href="#l7.130"></a><span id="l7.130">   // escape the event window, there should be no prompt to save event</span>
<a href="#l7.131"></a><span id="l7.131">   event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l7.132"></a><span id="l7.132">   controller.sleep(sleep); </span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+  md.stop();</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+  </span>
<a href="#l7.135"></a><span id="l7.135">   // delete event</span>
<a href="#l7.136"></a><span id="l7.136">   controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, 8, controller)));</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l7.139"></a><span id="l7.139">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l7.140"></a><span id="l7.140">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l7.143"></a><span id="l7.143">   </span>
<a href="#l7.144"></a><span id="l7.144">   for(let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l7.145"></a><span id="l7.145">     // test set i</span>
<a href="#l7.146"></a><span id="l7.146">     controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-      CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, 8, controller)));</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineminus">-    controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+    controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l7.151"></a><span id="l7.151">     event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l7.152"></a><span id="l7.152">       .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineminus">-    CalendarUtils.setData(newlines[i], event);</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+    calUtils.setData(event, newlines[i]);</span>
<a href="#l7.155"></a><span id="l7.155">     event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l7.157"></a><span id="l7.157">     </span>
<a href="#l7.158"></a><span id="l7.158">     // open and close</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineminus">-      CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, 8, controller)</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-      + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineminus">-    controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineplus">+    eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineplus">+      + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineplus">+    controller.waitForElement(eventBox);</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineplus">+    controller.doubleClick(eventBox);</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+    controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l7.169"></a><span id="l7.169">     event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l7.170"></a><span id="l7.170">       .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineplus">+    md = new modalDialog.modalDialog(event.window);</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineplus">+    md.start(handleSavePrompt);</span>
<a href="#l7.173"></a><span id="l7.173">     event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l7.174"></a><span id="l7.174">     controller.sleep(sleep);</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+    md.stop();</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineplus">+    </span>
<a href="#l7.177"></a><span id="l7.177">     // delete it</span>
<a href="#l7.178"></a><span id="l7.178">     controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineminus">-      CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, 8, controller)));</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l7.181"></a><span id="l7.181">     controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l7.182"></a><span id="l7.182">       &quot;VK_DELETE&quot;, {});</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l7.186"></a><span id="l7.186">   }</span>
<a href="#l7.187"></a><span id="l7.187"> }</span>
<a href="#l7.188"></a><span id="l7.188"> </span>
<a href="#l7.189"></a><span id="l7.189"> var teardownTest = function(module) {</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l7.192"></a><span id="l7.192">   if (pass != undefined &amp;&amp; pass == false) {</span>
<a href="#l7.193"></a><span id="l7.193">     controller.assertJS('&quot;Prompt appeared&quot; == &quot;Prompt didn\'t appear.&quot;');</span>
<a href="#l7.194"></a><span id="l7.194">   }</span>
<a href="#l7.195"></a><span id="l7.195"> }</span>
<a href="#l7.196"></a><span id="l7.196"> </span>
<a href="#l7.197"></a><span id="l7.197"> function handleSavePrompt(controller) {</span>
<a href="#l7.198"></a><span id="l7.198">   // unexpected prompt, thus the test has already failed</span>
<a href="#l7.199"></a><span id="l7.199">   // can't trigger a failure though, because the following click wouldn't be executed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -29,21 +29,20 @@</span>
<a href="#l8.4"></a><span id="l8.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.5"></a><span id="l8.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.6"></a><span id="l8.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.7"></a><span id="l8.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.8"></a><span id="l8.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.9"></a><span id="l8.9">  *</span>
<a href="#l8.10"></a><span id="l8.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI'];</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+var modalDialog = require(&quot;./shared-modules/modal-dialog&quot;);</span>
<a href="#l8.16"></a><span id="l8.16"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-</span>
<a href="#l8.19"></a><span id="l8.19"> const sleep = 500;</span>
<a href="#l8.20"></a><span id="l8.20"> var hour = 8;</span>
<a href="#l8.21"></a><span id="l8.21"> var calendar;</span>
<a href="#l8.22"></a><span id="l8.22"> var uri;</span>
<a href="#l8.23"></a><span id="l8.23"> var file;</span>
<a href="#l8.24"></a><span id="l8.24"> var title;</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26"> var setupModule = function(module) {</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineat">@@ -60,52 +59,48 @@ var setupModule = function(module) {</span>
<a href="#l8.28"></a><span id="l8.28">                    .get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l8.29"></a><span id="l8.29">   file.append(calendar + &quot;.ics&quot;);</span>
<a href="#l8.30"></a><span id="l8.30">   let fileURI = cal.getIOService().newFileURI(file);</span>
<a href="#l8.31"></a><span id="l8.31">   uri = fileURI.prePath + fileURI.path;</span>
<a href="#l8.32"></a><span id="l8.32"> }</span>
<a href="#l8.33"></a><span id="l8.33"> </span>
<a href="#l8.34"></a><span id="l8.34"> var testLocalICS = function () {</span>
<a href="#l8.35"></a><span id="l8.35">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.39"></a><span id="l8.39">   </span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(handleNewCalendarWizard);</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-  md.start();</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-  controller.click(new elementslib.Elem(controller</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-    .menus[&quot;menu_File&quot;][&quot;menu_New&quot;][&quot;ltnNewCalendar&quot;]));</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+  let md = new modalDialog.modalDialog(controller.window);</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+  md.start(handleNewCalendarWizard);</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l8.47"></a><span id="l8.47">   controller.sleep(sleep);</span>
<a href="#l8.48"></a><span id="l8.48">   </span>
<a href="#l8.49"></a><span id="l8.49">   // create new event</span>
<a href="#l8.50"></a><span id="l8.50">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour,</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-    controller)));</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l8.56"></a><span id="l8.56">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l8.57"></a><span id="l8.57">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l8.59"></a><span id="l8.59">   </span>
<a href="#l8.60"></a><span id="l8.60">   // title</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+  let titleTextBox = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l8.63"></a><span id="l8.63">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-title-row&quot;)/'</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-    + 'id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-    title);</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    + 'id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+  event.waitForElement(titleTextBox);</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+  event.type(titleTextBox, title);</span>
<a href="#l8.69"></a><span id="l8.69">   </span>
<a href="#l8.70"></a><span id="l8.70">   // set calendar</span>
<a href="#l8.71"></a><span id="l8.71">   event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), undefined,</span>
<a href="#l8.72"></a><span id="l8.72">     calendar);</span>
<a href="#l8.73"></a><span id="l8.73">   </span>
<a href="#l8.74"></a><span id="l8.74">   // save</span>
<a href="#l8.75"></a><span id="l8.75">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l8.77"></a><span id="l8.77">   </span>
<a href="#l8.78"></a><span id="l8.78">   // assert presence in view</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour,</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-    controller) + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar + '&quot;}';</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+    + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar + '&quot;}';</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+  controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l8.85"></a><span id="l8.85">   </span>
<a href="#l8.86"></a><span id="l8.86">   // verify in file</span>
<a href="#l8.87"></a><span id="l8.87">   let contents = &quot;&quot;;</span>
<a href="#l8.88"></a><span id="l8.88">   let fstream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l8.89"></a><span id="l8.89">                           .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l8.90"></a><span id="l8.90">   let cstream = Components.classes[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l8.91"></a><span id="l8.91">                           .createInstance(Components.interfaces.nsIConverterInputStream);</span>
<a href="#l8.92"></a><span id="l8.92">   </span>
<a href="#l8.93"></a><span id="l8.93" class="difflineat">@@ -117,43 +112,45 @@ var testLocalICS = function () {</span>
<a href="#l8.94"></a><span id="l8.94">     contents = str.value;</span>
<a href="#l8.95"></a><span id="l8.95">   }</span>
<a href="#l8.96"></a><span id="l8.96">   </span>
<a href="#l8.97"></a><span id="l8.97">   cstream.close();</span>
<a href="#l8.98"></a><span id="l8.98">   controller.assertJS(contents.indexOf(&quot;SUMMARY:&quot; + title) != -1);</span>
<a href="#l8.99"></a><span id="l8.99"> }</span>
<a href="#l8.100"></a><span id="l8.100"> </span>
<a href="#l8.101"></a><span id="l8.101"> var teardownTest = function(module) {</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l8.104"></a><span id="l8.104"> }</span>
<a href="#l8.105"></a><span id="l8.105"> </span>
<a href="#l8.106"></a><span id="l8.106"> function handleNewCalendarWizard(wizard) {</span>
<a href="#l8.107"></a><span id="l8.107">   let buttonDeck = '/id(&quot;calendar-wizard&quot;)/anon({&quot;anonid&quot;:&quot;Buttons&quot;})/'</span>
<a href="#l8.108"></a><span id="l8.108">     + 'anon({&quot;class&quot;:&quot;wizard-buttons-box-1&quot;})/{&quot;class&quot;:&quot;wizard-buttons-box-2&quot;}/'</span>
<a href="#l8.109"></a><span id="l8.109">     + 'anon({&quot;anonid&quot;:&quot;WizardButtonDeck&quot;})';</span>
<a href="#l8.110"></a><span id="l8.110">   let nextButton = buttonDeck + '/[1]/{&quot;dlgtype&quot;:&quot;next&quot;}';</span>
<a href="#l8.111"></a><span id="l8.111">   let finishButton = buttonDeck + '/[0]/{&quot;dlgtype&quot;:&quot;finish&quot;}';</span>
<a href="#l8.112"></a><span id="l8.112">   </span>
<a href="#l8.113"></a><span id="l8.113">   // choose network calendar</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-  wizard.sleep(sleep);</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-  wizard.click(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-    + '{&quot;pageid&quot;:&quot;initialPage&quot;}/id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}'));</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineplus">+  let remoteOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+    + '{&quot;pageid&quot;:&quot;initialPage&quot;}/id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}');</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineplus">+  wizard.waitForElement(remoteOption);</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+  wizard.radio(remoteOption);</span>
<a href="#l8.121"></a><span id="l8.121">   wizard.click(new elementslib.Lookup(wizard.window.document, nextButton));</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineminus">-  wizard.sleep(sleep);</span>
<a href="#l8.123"></a><span id="l8.123">   </span>
<a href="#l8.124"></a><span id="l8.124">   // choose ical</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-  wizard.click(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-    + '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/{&quot;value&quot;:&quot;ics&quot;}'));</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+  let icalOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+    + '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/id(&quot;calendar-format&quot;)/{&quot;value&quot;:&quot;ics&quot;}');</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineplus">+  wizard.waitForElement(icalOption);</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+  wizard.radio(icalOption);</span>
<a href="#l8.131"></a><span id="l8.131">   // enter location</span>
<a href="#l8.132"></a><span id="l8.132">   wizard.type(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l8.133"></a><span id="l8.133">     + '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/'</span>
<a href="#l8.134"></a><span id="l8.134">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l8.135"></a><span id="l8.135">     uri);</span>
<a href="#l8.136"></a><span id="l8.136">   wizard.click(new elementslib.Lookup(wizard.window.document, nextButton));</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineminus">-  wizard.sleep(sleep);</span>
<a href="#l8.138"></a><span id="l8.138">   </span>
<a href="#l8.139"></a><span id="l8.139">   // name is filled in automatically using filename</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineplus">+  wizard.waitFor(function() {return (new elementslib.Lookup(wizard.window.document, nextButton))</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+                                                    .getNode().disabled == false});</span>
<a href="#l8.142"></a><span id="l8.142">   wizard.click(new elementslib.Lookup(wizard.window.document, nextButton));</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineminus">-  wizard.sleep(sleep);</span>
<a href="#l8.144"></a><span id="l8.144">   </span>
<a href="#l8.145"></a><span id="l8.145">   // finish</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineminus">-  wizard.click(new elementslib.Lookup(wizard.window.document, finishButton));</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+  wizard.waitThenClick(new elementslib.Lookup(wizard.window.document, finishButton));</span>
<a href="#l8.148"></a><span id="l8.148"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/mozmill/testMonthView.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/mozmill/testMonthView.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -30,28 +30,27 @@</span>
<a href="#l9.4"></a><span id="l9.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.5"></a><span id="l9.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.6"></a><span id="l9.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.7"></a><span id="l9.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.8"></a><span id="l9.8">  *</span>
<a href="#l9.9"></a><span id="l9.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16"> var sleep = 500;</span>
<a href="#l9.17"></a><span id="l9.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l9.18"></a><span id="l9.18"> var title1 = &quot;Month View Event&quot;;</span>
<a href="#l9.19"></a><span id="l9.19"> var title2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l9.20"></a><span id="l9.20"> var desc = &quot;Month View Event Description&quot;;</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22"> var setupModule = function(module) {</span>
<a href="#l9.23"></a><span id="l9.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l9.26"></a><span id="l9.26"> }</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> var testMonthView = function () {</span>
<a href="#l9.29"></a><span id="l9.29">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l9.30"></a><span id="l9.30">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l9.31"></a><span id="l9.31">   // paths</span>
<a href="#l9.32"></a><span id="l9.32">   let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l9.33"></a><span id="l9.33">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/'</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineat">@@ -70,57 +69,54 @@ var testMonthView = function () {</span>
<a href="#l9.35"></a><span id="l9.35">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l9.36"></a><span id="l9.36">   </span>
<a href="#l9.37"></a><span id="l9.37">   // pick year</span>
<a href="#l9.38"></a><span id="l9.38">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.39"></a><span id="l9.39">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l9.40"></a><span id="l9.40">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.41"></a><span id="l9.41">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l9.42"></a><span id="l9.42">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l9.44"></a><span id="l9.44">   </span>
<a href="#l9.45"></a><span id="l9.45">   // pick month</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.48"></a><span id="l9.48">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l9.49"></a><span id="l9.49">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.50"></a><span id="l9.50">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l9.51"></a><span id="l9.51">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l9.53"></a><span id="l9.53"> </span>
<a href="#l9.54"></a><span id="l9.54">   // pick day</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l9.57"></a><span id="l9.57">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l9.59"></a><span id="l9.59">   </span>
<a href="#l9.60"></a><span id="l9.60">   // verify date</span>
<a href="#l9.61"></a><span id="l9.61">   let day = new elementslib.Lookup(controller.window.document, monthView</span>
<a href="#l9.62"></a><span id="l9.62">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l9.63"></a><span id="l9.63">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-  controller.assertJS(day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+  controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67">   // create event</span>
<a href="#l9.68"></a><span id="l9.68">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l9.69"></a><span id="l9.69">   let hour = new Date().getHours(); // remember time at click</span>
<a href="#l9.70"></a><span id="l9.70">   controller.doubleClick(new elementslib.Lookup(controller.window.document, monthView</span>
<a href="#l9.71"></a><span id="l9.71">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l9.72"></a><span id="l9.72">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l9.75"></a><span id="l9.75">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l9.77"></a><span id="l9.77">   </span>
<a href="#l9.78"></a><span id="l9.78">   // check that the start time is correct</span>
<a href="#l9.79"></a><span id="l9.79">   // next full hour except last hour hour of the day</span>
<a href="#l9.80"></a><span id="l9.80">   let nextHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l9.81"></a><span id="l9.81">   let startTime = nextHour + ':00'; // next full hour</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l9.84"></a><span id="l9.84">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l9.85"></a><span id="l9.85">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l9.86"></a><span id="l9.86">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-    startTime);</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+  event.waitForElement(startTimeInput);</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+  event.assertValue(startTimeInput, startTime);</span>
<a href="#l9.92"></a><span id="l9.92">   let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l9.93"></a><span id="l9.93">     2009, 1, 1);</span>
<a href="#l9.94"></a><span id="l9.94">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l9.95"></a><span id="l9.95">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l9.96"></a><span id="l9.96">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l9.97"></a><span id="l9.97">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l9.98"></a><span id="l9.98">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l9.99"></a><span id="l9.99">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineat">@@ -137,40 +133,39 @@ var testMonthView = function () {</span>
<a href="#l9.101"></a><span id="l9.101">     desc);</span>
<a href="#l9.102"></a><span id="l9.102">   event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l9.103"></a><span id="l9.103">   event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l9.104"></a><span id="l9.104">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/'</span>
<a href="#l9.105"></a><span id="l9.105">     + '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l9.106"></a><span id="l9.106">   </span>
<a href="#l9.107"></a><span id="l9.107">   // save</span>
<a href="#l9.108"></a><span id="l9.108">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l9.110"></a><span id="l9.110">   </span>
<a href="#l9.111"></a><span id="l9.111">   // if it was created successfully, it can be opened</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+  controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l9.113"></a><span id="l9.113">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l9.116"></a><span id="l9.116">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l9.118"></a><span id="l9.118">   </span>
<a href="#l9.119"></a><span id="l9.119">   // change title and save changes</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l9.122"></a><span id="l9.122">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-    title2);</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+  event.waitForElement(titleTextBox);</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+  event.type(titleTextBox, title2);</span>
<a href="#l9.128"></a><span id="l9.128">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l9.130"></a><span id="l9.130">   </span>
<a href="#l9.131"></a><span id="l9.131">   // check if name was saved</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-  controller.assertValue(new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">-    + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})'),</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-    title2);</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+  let eventName = new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+    + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+  controller.waitForElement(eventName);</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+  controller.assertValue(eventName, title2);</span>
<a href="#l9.139"></a><span id="l9.139">   </span>
<a href="#l9.140"></a><span id="l9.140">   // delete event</span>
<a href="#l9.141"></a><span id="l9.141">   controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l9.142"></a><span id="l9.142">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l9.143"></a><span id="l9.143">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l9.147"></a><span id="l9.147"> }</span>
<a href="#l9.148"></a><span id="l9.148"> </span>
<a href="#l9.149"></a><span id="l9.149"> var teardownTest = function(module) {</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l9.152"></a><span id="l9.152"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/test/mozmill/testMultiweekView.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/test/mozmill/testMultiweekView.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -29,28 +29,27 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.5"></a><span id="l10.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.6"></a><span id="l10.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.7"></a><span id="l10.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.8"></a><span id="l10.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.9"></a><span id="l10.9">  *</span>
<a href="#l10.10"></a><span id="l10.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> var sleep = 500;</span>
<a href="#l10.17"></a><span id="l10.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l10.18"></a><span id="l10.18"> var title1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l10.19"></a><span id="l10.19"> var title2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l10.20"></a><span id="l10.20"> var desc = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22"> var setupModule = function(module) {</span>
<a href="#l10.23"></a><span id="l10.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l10.26"></a><span id="l10.26"> }</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28"> var testMultiWeekView = function () {</span>
<a href="#l10.29"></a><span id="l10.29">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l10.30"></a><span id="l10.30">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l10.31"></a><span id="l10.31">   // paths</span>
<a href="#l10.32"></a><span id="l10.32">   let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l10.33"></a><span id="l10.33">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/'</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineat">@@ -69,57 +68,54 @@ var testMultiWeekView = function () {</span>
<a href="#l10.35"></a><span id="l10.35">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l10.36"></a><span id="l10.36">   </span>
<a href="#l10.37"></a><span id="l10.37">   // pick year</span>
<a href="#l10.38"></a><span id="l10.38">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.39"></a><span id="l10.39">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l10.40"></a><span id="l10.40">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.41"></a><span id="l10.41">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l10.42"></a><span id="l10.42">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l10.44"></a><span id="l10.44">   </span>
<a href="#l10.45"></a><span id="l10.45">   // pick month</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.48"></a><span id="l10.48">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l10.49"></a><span id="l10.49">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.50"></a><span id="l10.50">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l10.51"></a><span id="l10.51">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l10.53"></a><span id="l10.53"> </span>
<a href="#l10.54"></a><span id="l10.54">   // pick day</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l10.57"></a><span id="l10.57">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l10.59"></a><span id="l10.59">   </span>
<a href="#l10.60"></a><span id="l10.60">   // verify date</span>
<a href="#l10.61"></a><span id="l10.61">   let day = new elementslib.Lookup(controller.window.document, multiWeekView</span>
<a href="#l10.62"></a><span id="l10.62">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l10.63"></a><span id="l10.63">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-  controller.assertJS(day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+  controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l10.66"></a><span id="l10.66"> </span>
<a href="#l10.67"></a><span id="l10.67">   // create event</span>
<a href="#l10.68"></a><span id="l10.68">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l10.69"></a><span id="l10.69">   let hour = new Date().getHours(); // remember time at click</span>
<a href="#l10.70"></a><span id="l10.70">   controller.doubleClick(new elementslib.Lookup(controller.window.document, multiWeekView</span>
<a href="#l10.71"></a><span id="l10.71">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l10.72"></a><span id="l10.72">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l10.75"></a><span id="l10.75">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l10.77"></a><span id="l10.77">   </span>
<a href="#l10.78"></a><span id="l10.78">   // check that the start time is correct</span>
<a href="#l10.79"></a><span id="l10.79">   // next full hour except last hour hour of the day</span>
<a href="#l10.80"></a><span id="l10.80">   let nextHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l10.81"></a><span id="l10.81">   let startTime = nextHour + ':00';</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l10.84"></a><span id="l10.84">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l10.85"></a><span id="l10.85">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l10.86"></a><span id="l10.86">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-    startTime); </span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+  event.waitForElement(startTimeInput);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+  event.assertValue(startTimeInput, startTime); </span>
<a href="#l10.92"></a><span id="l10.92">   let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l10.93"></a><span id="l10.93">     2009, 1, 1);</span>
<a href="#l10.94"></a><span id="l10.94">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l10.95"></a><span id="l10.95">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l10.96"></a><span id="l10.96">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l10.97"></a><span id="l10.97">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l10.98"></a><span id="l10.98">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l10.99"></a><span id="l10.99">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineat">@@ -136,40 +132,39 @@ var testMultiWeekView = function () {</span>
<a href="#l10.101"></a><span id="l10.101">     desc);</span>
<a href="#l10.102"></a><span id="l10.102">   event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l10.103"></a><span id="l10.103">   event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l10.104"></a><span id="l10.104">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/'</span>
<a href="#l10.105"></a><span id="l10.105">     + '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l10.106"></a><span id="l10.106">   </span>
<a href="#l10.107"></a><span id="l10.107">   // save</span>
<a href="#l10.108"></a><span id="l10.108">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l10.110"></a><span id="l10.110">   </span>
<a href="#l10.111"></a><span id="l10.111">   // if it was created successfully, it can be opened</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+  controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l10.113"></a><span id="l10.113">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l10.116"></a><span id="l10.116">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l10.118"></a><span id="l10.118">   </span>
<a href="#l10.119"></a><span id="l10.119">   // change title and save changes</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+  let titmeTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l10.122"></a><span id="l10.122">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineminus">-    title2);</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+  event.waitForElement(titmeTextBox);</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+  event.type(titmeTextBox, title2);</span>
<a href="#l10.128"></a><span id="l10.128">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l10.130"></a><span id="l10.130">   </span>
<a href="#l10.131"></a><span id="l10.131">   // check if name was saved</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-  controller.assertValue(new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineminus">-    + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})'),</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-    title2);</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+  let eventName = new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+    + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+  controller.waitForElement(eventName);</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+  controller.assertValue(eventName, title2);</span>
<a href="#l10.139"></a><span id="l10.139">   </span>
<a href="#l10.140"></a><span id="l10.140">   // delete event</span>
<a href="#l10.141"></a><span id="l10.141">   controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l10.142"></a><span id="l10.142">   controller.keypress(new elementslib.ID(controller.window.document, &quot;multiweek-view&quot;),</span>
<a href="#l10.143"></a><span id="l10.143">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l10.147"></a><span id="l10.147"> }</span>
<a href="#l10.148"></a><span id="l10.148"> </span>
<a href="#l10.149"></a><span id="l10.149"> var teardownTest = function(module) {</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l10.152"></a><span id="l10.152"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testAnnualRecursion.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testAnnualRecursion.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -29,89 +29,88 @@</span>
<a href="#l11.4"></a><span id="l11.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.5"></a><span id="l11.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.6"></a><span id="l11.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.7"></a><span id="l11.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.8"></a><span id="l11.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.9"></a><span id="l11.9">  *</span>
<a href="#l11.10"></a><span id="l11.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+</span>
<a href="#l11.14"></a><span id="l11.14"> const sleep = 500;</span>
<a href="#l11.15"></a><span id="l11.15"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l11.16"></a><span id="l11.16"> var startYear = 1950;</span>
<a href="#l11.17"></a><span id="l11.17"> var epoch = 1970;</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-</span>
<a href="#l11.22"></a><span id="l11.22"> var setupModule = function(module) {</span>
<a href="#l11.23"></a><span id="l11.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l11.26"></a><span id="l11.26"> }</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28"> var testAnnualRecursion = function () {</span>
<a href="#l11.29"></a><span id="l11.29">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l11.30"></a><span id="l11.30">   </span>
<a href="#l11.31"></a><span id="l11.31">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l11.32"></a><span id="l11.32">   controller.sleep(sleep);</span>
<a href="#l11.33"></a><span id="l11.33">   </span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-  CalendarUtils.goToDate(startYear, 1, 1, controller);</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+  calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l11.38"></a><span id="l11.38">   </span>
<a href="#l11.39"></a><span id="l11.39">   // create yearly recurring all-day event</span>
<a href="#l11.40"></a><span id="l11.40">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.ALLDAY, undefined, 1, undefined,</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">-    controller)));</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l11.46"></a><span id="l11.46">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l11.47"></a><span id="l11.47">                  .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l11.48"></a><span id="l11.48">   event.sleep(sleep);</span>
<a href="#l11.49"></a><span id="l11.49">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l11.50"></a><span id="l11.50">     &quot;yearly&quot;);</span>
<a href="#l11.51"></a><span id="l11.51">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l11.52"></a><span id="l11.52">   controller.sleep(sleep);</span>
<a href="#l11.53"></a><span id="l11.53">   </span>
<a href="#l11.54"></a><span id="l11.54">   let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l11.55"></a><span id="l11.55">   let box = &quot;&quot;;</span>
<a href="#l11.56"></a><span id="l11.56">   for(let i = 0; i &lt; checkYears.length; i++){</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-    CalendarUtils.goToDate(checkYears[i], 1, 1, controller);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+    calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l11.59"></a><span id="l11.59">     let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l11.60"></a><span id="l11.60">     let column = date.getDay() + 1;</span>
<a href="#l11.61"></a><span id="l11.61">     </span>
<a href="#l11.62"></a><span id="l11.62">     // day view</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-    CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.ALLDAY, undefined, 1, undefined,</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+      + eventPath;</span>
<a href="#l11.69"></a><span id="l11.69">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.70"></a><span id="l11.70">     </span>
<a href="#l11.71"></a><span id="l11.71">     // week view</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-    CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.ALLDAY, undefined, column, undefined,</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined)</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+      + eventPath;</span>
<a href="#l11.78"></a><span id="l11.78">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.79"></a><span id="l11.79">     </span>
<a href="#l11.80"></a><span id="l11.80">     // multiweek view</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-    CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.ALLDAY, 1, column, undefined,</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+      + eventPath;</span>
<a href="#l11.87"></a><span id="l11.87">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.88"></a><span id="l11.88">     </span>
<a href="#l11.89"></a><span id="l11.89">     // month view</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineminus">-    CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.ALLDAY, 1, column, undefined,</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+      + eventPath;</span>
<a href="#l11.96"></a><span id="l11.96">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.97"></a><span id="l11.97">   }</span>
<a href="#l11.98"></a><span id="l11.98">   </span>
<a href="#l11.99"></a><span id="l11.99">   // delete event</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-  CalendarUtils.goToDate(checkYears[0], 1, 1, controller);</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.ALLDAY, undefined, 1, undefined,</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineminus">-    controller) + eventPath;</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+  calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+    + eventPath;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l11.110"></a><span id="l11.110">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.111"></a><span id="l11.111">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l11.112"></a><span id="l11.112">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.114"></a><span id="l11.114"> }</span>
<a href="#l11.115"></a><span id="l11.115"> </span>
<a href="#l11.116"></a><span id="l11.116"> var teardownTest = function(module) {</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l11.119"></a><span id="l11.119"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testBiweeklyRecursion.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -29,112 +29,110 @@</span>
<a href="#l12.4"></a><span id="l12.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l12.5"></a><span id="l12.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l12.6"></a><span id="l12.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l12.7"></a><span id="l12.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l12.8"></a><span id="l12.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l12.9"></a><span id="l12.9">  *</span>
<a href="#l12.10"></a><span id="l12.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l12.11"></a><span id="l12.11">  </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+</span>
<a href="#l12.14"></a><span id="l12.14"> const sleep = 500;</span>
<a href="#l12.15"></a><span id="l12.15"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l12.16"></a><span id="l12.16"> var hour = 8;</span>
<a href="#l12.17"></a><span id="l12.17"> </span>
<a href="#l12.18"></a><span id="l12.18" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-</span>
<a href="#l12.21"></a><span id="l12.21"> var setupModule = function(module) {</span>
<a href="#l12.22"></a><span id="l12.22">   controller = mozmill.getMail3PaneController();</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l12.25"></a><span id="l12.25"> }</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27"> var testBiweeklyRecursion = function () {</span>
<a href="#l12.28"></a><span id="l12.28">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l12.29"></a><span id="l12.29">   </span>
<a href="#l12.30"></a><span id="l12.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-  </span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l12.37"></a><span id="l12.37">   </span>
<a href="#l12.38"></a><span id="l12.38">   // create biweekly event</span>
<a href="#l12.39"></a><span id="l12.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l12.44"></a><span id="l12.44">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l12.46"></a><span id="l12.46">   </span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l12.48"></a><span id="l12.48">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l12.49"></a><span id="l12.49">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l12.52"></a><span id="l12.52">   </span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l12.55"></a><span id="l12.55">     + eventPath;</span>
<a href="#l12.56"></a><span id="l12.56">   </span>
<a href="#l12.57"></a><span id="l12.57">   // check day view</span>
<a href="#l12.58"></a><span id="l12.58">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l12.59"></a><span id="l12.59">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-    CalendarUtils.forward(14);</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+    calUtils.forward(controller, 14);</span>
<a href="#l12.62"></a><span id="l12.62">   }</span>
<a href="#l12.63"></a><span id="l12.63">   </span>
<a href="#l12.64"></a><span id="l12.64">   // check week view</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l12.69"></a><span id="l12.69">   </span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller)</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l12.72"></a><span id="l12.72">     + eventPath;</span>
<a href="#l12.73"></a><span id="l12.73">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l12.74"></a><span id="l12.74">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-    CalendarUtils.forward(2);</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+    calUtils.forward(controller, 2);</span>
<a href="#l12.77"></a><span id="l12.77">   }</span>
<a href="#l12.78"></a><span id="l12.78"> </span>
<a href="#l12.79"></a><span id="l12.79">   // check multiweek view</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l12.84"></a><span id="l12.84">   </span>
<a href="#l12.85"></a><span id="l12.85">   // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l12.86"></a><span id="l12.86">   for(let i = 0; i &lt; 5; i++){</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-      undefined, controller) + eventPath;</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l12.91"></a><span id="l12.91">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-      undefined, controller) + eventPath;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l12.96"></a><span id="l12.96">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-    CalendarUtils.forward(1);</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l12.99"></a><span id="l12.99">   }</span>
<a href="#l12.100"></a><span id="l12.100">   </span>
<a href="#l12.101"></a><span id="l12.101">   // check month view</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l12.106"></a><span id="l12.106"> </span>
<a href="#l12.107"></a><span id="l12.107">   // January</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 5, 7, undefined, controller)</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined)</span>
<a href="#l12.110"></a><span id="l12.110">     + eventPath;</span>
<a href="#l12.111"></a><span id="l12.111">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l12.114"></a><span id="l12.114">   </span>
<a href="#l12.115"></a><span id="l12.115">   // February</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 7, undefined, controller)</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l12.118"></a><span id="l12.118">     + eventPath;</span>
<a href="#l12.119"></a><span id="l12.119">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 4, 7, undefined, controller)</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l12.122"></a><span id="l12.122">     + eventPath;</span>
<a href="#l12.123"></a><span id="l12.123">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l12.126"></a><span id="l12.126">   </span>
<a href="#l12.127"></a><span id="l12.127">   // March</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 7, undefined, controller)</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l12.130"></a><span id="l12.130">     + eventPath;</span>
<a href="#l12.131"></a><span id="l12.131">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 4, 7, undefined, controller)</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l12.134"></a><span id="l12.134">     + eventPath;</span>
<a href="#l12.135"></a><span id="l12.135">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));  </span>
<a href="#l12.136"></a><span id="l12.136"> </span>
<a href="#l12.137"></a><span id="l12.137">   // delete event</span>
<a href="#l12.138"></a><span id="l12.138">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l12.141"></a><span id="l12.141">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l12.142"></a><span id="l12.142">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l12.144"></a><span id="l12.144"> }</span>
<a href="#l12.145"></a><span id="l12.145"> </span>
<a href="#l12.146"></a><span id="l12.146"> var teardownTest = function(module) {</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l12.149"></a><span id="l12.149"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testDailyRecursion.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testDailyRecursion.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -29,216 +29,209 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.5"></a><span id="l13.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.6"></a><span id="l13.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.7"></a><span id="l13.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.8"></a><span id="l13.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.9"></a><span id="l13.9">  *</span>
<a href="#l13.10"></a><span id="l13.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+</span>
<a href="#l13.14"></a><span id="l13.14"> const sleep = 500;</span>
<a href="#l13.15"></a><span id="l13.15"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l13.16"></a><span id="l13.16"> var hour = 8;</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-</span>
<a href="#l13.21"></a><span id="l13.21"> var setupModule = function(module) {</span>
<a href="#l13.22"></a><span id="l13.22">   controller = mozmill.getMail3PaneController();</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l13.25"></a><span id="l13.25"> }</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27"> var testDailyRecursion = function () {</span>
<a href="#l13.28"></a><span id="l13.28">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l13.29"></a><span id="l13.29">   </span>
<a href="#l13.30"></a><span id="l13.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-  </span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.37"></a><span id="l13.37">   </span>
<a href="#l13.38"></a><span id="l13.38">   // create daily event</span>
<a href="#l13.39"></a><span id="l13.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l13.44"></a><span id="l13.44">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l13.45"></a><span id="l13.45">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l13.47"></a><span id="l13.47">   </span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l13.49"></a><span id="l13.49">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l13.50"></a><span id="l13.50">     &quot;daily&quot;);</span>
<a href="#l13.51"></a><span id="l13.51">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l13.52"></a><span id="l13.52">   </span>
<a href="#l13.53"></a><span id="l13.53">   // check day view for 7 days</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, undefined, controller)</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l13.56"></a><span id="l13.56">     + eventPath;</span>
<a href="#l13.57"></a><span id="l13.57">   controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.58"></a><span id="l13.58">   </span>
<a href="#l13.59"></a><span id="l13.59">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l13.60"></a><span id="l13.60">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l13.64"></a><span id="l13.64">   }</span>
<a href="#l13.65"></a><span id="l13.65">   </span>
<a href="#l13.66"></a><span id="l13.66">   // check week view for 2 weeks</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.71"></a><span id="l13.71">   </span>
<a href="#l13.72"></a><span id="l13.72">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, 1, day, hour, controller)</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l13.75"></a><span id="l13.75">       + eventPath;</span>
<a href="#l13.76"></a><span id="l13.76">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.77"></a><span id="l13.77">   }</span>
<a href="#l13.78"></a><span id="l13.78">   </span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l13.82"></a><span id="l13.82">   </span>
<a href="#l13.83"></a><span id="l13.83">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, 2, day, hour, controller)</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l13.86"></a><span id="l13.86">       + eventPath;</span>
<a href="#l13.87"></a><span id="l13.87">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.88"></a><span id="l13.88">   }</span>
<a href="#l13.89"></a><span id="l13.89">   </span>
<a href="#l13.90"></a><span id="l13.90">   // check multiweek view for 4 weeks</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.95"></a><span id="l13.95">   </span>
<a href="#l13.96"></a><span id="l13.96">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, 1, day, hour, controller)</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l13.99"></a><span id="l13.99">       + eventPath;</span>
<a href="#l13.100"></a><span id="l13.100">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.101"></a><span id="l13.101">   }</span>
<a href="#l13.102"></a><span id="l13.102">   </span>
<a href="#l13.103"></a><span id="l13.103">   for(let week = 2; week &lt;= 4; week++){</span>
<a href="#l13.104"></a><span id="l13.104">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineminus">-      let box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, week, day, hour, controller)</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+      let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l13.107"></a><span id="l13.107">         + eventPath;</span>
<a href="#l13.108"></a><span id="l13.108">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.109"></a><span id="l13.109">     }</span>
<a href="#l13.110"></a><span id="l13.110">   }</span>
<a href="#l13.111"></a><span id="l13.111">   </span>
<a href="#l13.112"></a><span id="l13.112">   // check month view for all 5 weeks</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.117"></a><span id="l13.117">   </span>
<a href="#l13.118"></a><span id="l13.118">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 1, day, undefined, controller)</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l13.121"></a><span id="l13.121">       + eventPath;</span>
<a href="#l13.122"></a><span id="l13.122">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.123"></a><span id="l13.123">   }</span>
<a href="#l13.124"></a><span id="l13.124">   </span>
<a href="#l13.125"></a><span id="l13.125">   for(let week = 2; week &lt;= 5; week++){</span>
<a href="#l13.126"></a><span id="l13.126">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-      let box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, week, day, undefined, controller)</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+      let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l13.129"></a><span id="l13.129">         + eventPath;</span>
<a href="#l13.130"></a><span id="l13.130">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.131"></a><span id="l13.131">     }</span>
<a href="#l13.132"></a><span id="l13.132">   }</span>
<a href="#l13.133"></a><span id="l13.133">   </span>
<a href="#l13.134"></a><span id="l13.134">   // delete 3rd January occurrence</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-  let saturday = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 1, 7, undefined, controller)</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+  let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l13.137"></a><span id="l13.137">     + eventPath;</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-  CalendarUtils.handleOccurrenceDeletion(false);</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+  calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l13.140"></a><span id="l13.140">   controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l13.141"></a><span id="l13.141">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l13.142"></a><span id="l13.142">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l13.144"></a><span id="l13.144">   </span>
<a href="#l13.145"></a><span id="l13.145">   // verify in all views</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l13.148"></a><span id="l13.148">   </span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-  saturday = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, 1, 7, undefined, controller)</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+  saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l13.153"></a><span id="l13.153">     + eventPath;</span>
<a href="#l13.154"></a><span id="l13.154">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l13.155"></a><span id="l13.155">     </span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-  saturday = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, undefined, controller)</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineplus">+  saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l13.160"></a><span id="l13.160">     + eventPath;</span>
<a href="#l13.161"></a><span id="l13.161">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l13.162"></a><span id="l13.162">     </span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-  saturday = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, undefined, controller)</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+  saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l13.167"></a><span id="l13.167">     + eventPath;</span>
<a href="#l13.168"></a><span id="l13.168">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l13.169"></a><span id="l13.169">   </span>
<a href="#l13.170"></a><span id="l13.170">   // go to previous day to edit event to occur only on weekdays</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;previous-view-button&quot;));</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+  calUtils.back(controller, 1);</span>
<a href="#l13.174"></a><span id="l13.174">   </span>
<a href="#l13.175"></a><span id="l13.175" class="difflineminus">-  CalendarUtils.handleParentModification(false);</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+  calUtils.handleParentModification(controller, false);</span>
<a href="#l13.177"></a><span id="l13.177">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l13.180"></a><span id="l13.180">       + eventPath));</span>
<a href="#l13.181"></a><span id="l13.181">   </span>
<a href="#l13.182"></a><span id="l13.182" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l13.184"></a><span id="l13.184">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l13.185"></a><span id="l13.185">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l13.187"></a><span id="l13.187">   </span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l13.189"></a><span id="l13.189">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l13.190"></a><span id="l13.190">     &quot;every.weekday&quot;);</span>
<a href="#l13.191"></a><span id="l13.191">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l13.194"></a><span id="l13.194">   </span>
<a href="#l13.195"></a><span id="l13.195">   // check day view for 7 days</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineminus">-  let day = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, undefined, controller)</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+  let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l13.198"></a><span id="l13.198">     + eventPath;</span>
<a href="#l13.199"></a><span id="l13.199">   var dates = [[2009, 1, 3],</span>
<a href="#l13.200"></a><span id="l13.200">                [2009, 1, 4]];</span>
<a href="#l13.201"></a><span id="l13.201">   for(let i = 0; i &lt; dates.length; i++){</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineminus">-    CalendarUtils.goToDate(dates[i][0], dates[i][1], dates[i][2], controller);</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+    calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l13.204"></a><span id="l13.204">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.205"></a><span id="l13.205">   }</span>
<a href="#l13.206"></a><span id="l13.206">   </span>
<a href="#l13.207"></a><span id="l13.207">   // check week view for 2 weeks</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.212"></a><span id="l13.212">   </span>
<a href="#l13.213"></a><span id="l13.213">   for(let i = 0; i &lt;= 1; i++){</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineminus">-    let day = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 1, undefined, controller)</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l13.216"></a><span id="l13.216">       + eventPath;</span>
<a href="#l13.217"></a><span id="l13.217">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineminus">-    day = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, undefined, controller)</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l13.220"></a><span id="l13.220">       + eventPath;</span>
<a href="#l13.221"></a><span id="l13.221">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l13.225"></a><span id="l13.225">   }</span>
<a href="#l13.226"></a><span id="l13.226">   </span>
<a href="#l13.227"></a><span id="l13.227">   // check multiweek view for 4 weeks</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.232"></a><span id="l13.232">   </span>
<a href="#l13.233"></a><span id="l13.233">   for(let i = 1; i &lt;= 4; i++){</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineminus">-    let day = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i, 1, undefined, controller)</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l13.236"></a><span id="l13.236">       + eventPath;</span>
<a href="#l13.237"></a><span id="l13.237">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineminus">-    day = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i, 7, undefined, controller)</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l13.240"></a><span id="l13.240">       + eventPath;</span>
<a href="#l13.241"></a><span id="l13.241">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.242"></a><span id="l13.242">   }</span>
<a href="#l13.243"></a><span id="l13.243">   </span>
<a href="#l13.244"></a><span id="l13.244">   // check month view for all 5 weeks</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l13.249"></a><span id="l13.249">   </span>
<a href="#l13.250"></a><span id="l13.250">   for(let i = 1; i &lt;= 5; i++){</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineminus">-    let day = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, i, 1, undefined, controller)</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l13.253"></a><span id="l13.253">       + eventPath;</span>
<a href="#l13.254"></a><span id="l13.254">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineminus">-    day = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, i, 7, undefined, controller)</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l13.257"></a><span id="l13.257">       + eventPath;</span>
<a href="#l13.258"></a><span id="l13.258">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.259"></a><span id="l13.259">   }</span>
<a href="#l13.260"></a><span id="l13.260">   </span>
<a href="#l13.261"></a><span id="l13.261">   // delete event</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 1, 5, undefined, controller)</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineminus">-      + eventPath));</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineplus">+  let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined)</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineplus">+    + eventPath;</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+  calUtils.handleParentDeletion(false);</span>
<a href="#l13.270"></a><span id="l13.270">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l13.271"></a><span id="l13.271">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l13.273"></a><span id="l13.273"> }</span>
<a href="#l13.274"></a><span id="l13.274"> </span>
<a href="#l13.275"></a><span id="l13.275"> var teardownTest = function(module) {</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l13.278"></a><span id="l13.278"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testLastDayOfMonthRecursion.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -29,54 +29,51 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.5"></a><span id="l14.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.6"></a><span id="l14.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.7"></a><span id="l14.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.8"></a><span id="l14.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.9"></a><span id="l14.9">  *</span>
<a href="#l14.10"></a><span id="l14.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l14.11"></a><span id="l14.11">  </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+</span>
<a href="#l14.15"></a><span id="l14.15"> const sleep = 500;</span>
<a href="#l14.16"></a><span id="l14.16"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l14.17"></a><span id="l14.17"> var hour = 8;</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI'];</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-</span>
<a href="#l14.22"></a><span id="l14.22"> var setupModule = function(module) {</span>
<a href="#l14.23"></a><span id="l14.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l14.26"></a><span id="l14.26"> }</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28"> var testLastDayOfMonthRecursion = function () {</span>
<a href="#l14.29"></a><span id="l14.29">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l14.30"></a><span id="l14.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  </span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-  CalendarUtils.goToDate(2008, 1, 31, controller); // start with a leap year</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+  calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l14.37"></a><span id="l14.37">   </span>
<a href="#l14.38"></a><span id="l14.38">   // create monthly recurring event</span>
<a href="#l14.39"></a><span id="l14.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour,</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-      controller)));</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l14.45"></a><span id="l14.45">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l14.46"></a><span id="l14.46">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l14.48"></a><span id="l14.48">   </span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  md.start();</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l14.54"></a><span id="l14.54">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l14.55"></a><span id="l14.55">     &quot;custom&quot;);</span>
<a href="#l14.56"></a><span id="l14.56">   </span>
<a href="#l14.57"></a><span id="l14.57">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l14.60"></a><span id="l14.60">   </span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-  //                        date     correct row in month view      </span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+  //                        date     correct row in month view</span>
<a href="#l14.63"></a><span id="l14.63">   let checkingData = [[2008,  1, 31, 5],</span>
<a href="#l14.64"></a><span id="l14.64">                       [2008,  2, 29, 5],</span>
<a href="#l14.65"></a><span id="l14.65">                       [2008,  3, 31, 6],</span>
<a href="#l14.66"></a><span id="l14.66">                       [2008,  4, 30, 5],</span>
<a href="#l14.67"></a><span id="l14.67">                       [2008,  5, 31, 5],</span>
<a href="#l14.68"></a><span id="l14.68">                       [2008,  6, 30, 5],</span>
<a href="#l14.69"></a><span id="l14.69">                       [2008,  7, 31, 5],</span>
<a href="#l14.70"></a><span id="l14.70">                       [2008,  8, 31, 6],</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineat">@@ -86,54 +83,55 @@ var testLastDayOfMonthRecursion = functi</span>
<a href="#l14.72"></a><span id="l14.72">                       [2008, 12, 31, 5],</span>
<a href="#l14.73"></a><span id="l14.73">                       [2009,  1, 31, 5],</span>
<a href="#l14.74"></a><span id="l14.74">                       [2009,  2, 28, 4],</span>
<a href="#l14.75"></a><span id="l14.75">                       [2009,  3, 31, 5]];</span>
<a href="#l14.76"></a><span id="l14.76">   let box = &quot;&quot;;</span>
<a href="#l14.77"></a><span id="l14.77">   </span>
<a href="#l14.78"></a><span id="l14.78">   // check all dates</span>
<a href="#l14.79"></a><span id="l14.79">   for(let i = 0; i &lt; checkingData.length; i++){</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-    CalendarUtils.goToDate(checkingData[i][0], checkingData[i][1], checkingData[i][2], controller);</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+    calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l14.82"></a><span id="l14.82">     </span>
<a href="#l14.83"></a><span id="l14.83">     // day view</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-    CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour,</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+      + eventPath;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.92"></a><span id="l14.92">     </span>
<a href="#l14.93"></a><span id="l14.93">     // week view</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-    CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l14.96"></a><span id="l14.96">     let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l14.97"></a><span id="l14.97">     let column = date.getDay() + 1;</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, column, hour,</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour)</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+      + eventPath;</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.104"></a><span id="l14.104">     </span>
<a href="#l14.105"></a><span id="l14.105">     // multiweek view</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-    CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, 1, column, undefined,</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined)</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+      + eventPath;</span>
<a href="#l14.112"></a><span id="l14.112">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.113"></a><span id="l14.113">     </span>
<a href="#l14.114"></a><span id="l14.114">     // month view</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-    CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-      column, undefined, controller) + eventPath;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+      column, undefined) + eventPath;</span>
<a href="#l14.121"></a><span id="l14.121">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.122"></a><span id="l14.122">   }</span>
<a href="#l14.123"></a><span id="l14.123">   </span>
<a href="#l14.124"></a><span id="l14.124">   // delete event</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-  CalendarUtils.goToDate(checkingData[0][0], checkingData[0][1], checkingData[0][2], controller);</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX,</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-    undefined, 1, hour, controller) + eventPath;</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+  calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+    undefined, 1, hour) + eventPath;</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.137"></a><span id="l14.137">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l14.138"></a><span id="l14.138">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.140"></a><span id="l14.140"> }</span>
<a href="#l14.141"></a><span id="l14.141"> </span>
<a href="#l14.142"></a><span id="l14.142"> function setRecurrence(recurrence){</span>
<a href="#l14.143"></a><span id="l14.143">   recurrence.sleep(sleep);</span>
<a href="#l14.144"></a><span id="l14.144">   </span>
<a href="#l14.145"></a><span id="l14.145">   // monthly</span>
<a href="#l14.146"></a><span id="l14.146">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l14.147"></a><span id="l14.147">     undefined, &quot;2&quot;);</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineat">@@ -149,10 +147,10 @@ function setRecurrence(recurrence){</span>
<a href="#l14.149"></a><span id="l14.149">   recurrence.sleep(sleep);</span>
<a href="#l14.150"></a><span id="l14.150">   </span>
<a href="#l14.151"></a><span id="l14.151">   // close dialog</span>
<a href="#l14.152"></a><span id="l14.152">   recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l14.153"></a><span id="l14.153">     '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l14.154"></a><span id="l14.154"> }</span>
<a href="#l14.155"></a><span id="l14.155"> </span>
<a href="#l14.156"></a><span id="l14.156"> var teardownTest = function(module) {</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l14.159"></a><span id="l14.159"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testWeeklyNRecursion.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -29,108 +29,107 @@</span>
<a href="#l15.4"></a><span id="l15.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l15.5"></a><span id="l15.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l15.6"></a><span id="l15.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.7"></a><span id="l15.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.8"></a><span id="l15.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.9"></a><span id="l15.9">  *</span>
<a href="#l15.10"></a><span id="l15.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+</span>
<a href="#l15.16"></a><span id="l15.16"> const sleep = 500;</span>
<a href="#l15.17"></a><span id="l15.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l15.18"></a><span id="l15.18"> var hour = 8;</span>
<a href="#l15.19"></a><span id="l15.19"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-</span>
<a href="#l15.24"></a><span id="l15.24"> var setupModule = function(module) {</span>
<a href="#l15.25"></a><span id="l15.25">   controller = mozmill.getMail3PaneController();</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l15.28"></a><span id="l15.28"> }</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30"> var testWeeklyNRecursion = function () {</span>
<a href="#l15.31"></a><span id="l15.31">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-  </span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l15.38"></a><span id="l15.38">   </span>
<a href="#l15.39"></a><span id="l15.39">   // create weekly recurring event</span>
<a href="#l15.40"></a><span id="l15.40">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l15.45"></a><span id="l15.45">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l15.47"></a><span id="l15.47">   </span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-  md.start();</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l15.53"></a><span id="l15.53">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l15.54"></a><span id="l15.54">   </span>
<a href="#l15.55"></a><span id="l15.55">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+  </span>
<a href="#l15.58"></a><span id="l15.58">   </span>
<a href="#l15.59"></a><span id="l15.59">   // check day view</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l15.62"></a><span id="l15.62">     + eventPath;</span>
<a href="#l15.63"></a><span id="l15.63">   </span>
<a href="#l15.64"></a><span id="l15.64">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l15.65"></a><span id="l15.65">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l15.66"></a><span id="l15.66">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-    CalendarUtils.forward(1);</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l15.69"></a><span id="l15.69">   }</span>
<a href="#l15.70"></a><span id="l15.70">   </span>
<a href="#l15.71"></a><span id="l15.71">   // Saturday</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l15.74"></a><span id="l15.74">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.75"></a><span id="l15.75">   </span>
<a href="#l15.76"></a><span id="l15.76">   // check week view</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.79"></a><span id="l15.79">   </span>
<a href="#l15.80"></a><span id="l15.80">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l15.81"></a><span id="l15.81">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, i, hour, controller)</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour)</span>
<a href="#l15.84"></a><span id="l15.84">       + eventPath;</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.87"></a><span id="l15.87">   }</span>
<a href="#l15.88"></a><span id="l15.88">   </span>
<a href="#l15.89"></a><span id="l15.89">   // Saturday</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller)</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l15.92"></a><span id="l15.92">     + eventPath;</span>
<a href="#l15.93"></a><span id="l15.93">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.94"></a><span id="l15.94">   </span>
<a href="#l15.95"></a><span id="l15.95">   // check multiweek view</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.98"></a><span id="l15.98">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l15.99"></a><span id="l15.99">   </span>
<a href="#l15.100"></a><span id="l15.100">   // check month view</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l15.103"></a><span id="l15.103">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l15.104"></a><span id="l15.104">   </span>
<a href="#l15.105"></a><span id="l15.105">   // delete event</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 2, hour, controller)</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-      + eventPath));</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour)</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+    + eventPath;</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l15.114"></a><span id="l15.114">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l15.115"></a><span id="l15.115">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.117"></a><span id="l15.117"> }</span>
<a href="#l15.118"></a><span id="l15.118"> </span>
<a href="#l15.119"></a><span id="l15.119"> function setRecurrence(recurrence){</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-  </span>
<a href="#l15.122"></a><span id="l15.122">   // weekly</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l15.124"></a><span id="l15.124">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l15.125"></a><span id="l15.125">   recurrence.sleep(sleep);</span>
<a href="#l15.126"></a><span id="l15.126">   </span>
<a href="#l15.127"></a><span id="l15.127" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-  let tue = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-  let thu = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-  let sat = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineplus">+  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineplus">+  let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineplus">+  let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l15.137"></a><span id="l15.137">   </span>
<a href="#l15.138"></a><span id="l15.138">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l15.139"></a><span id="l15.139">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l15.140"></a><span id="l15.140">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l15.141"></a><span id="l15.141">   </span>
<a href="#l15.142"></a><span id="l15.142">   // starting from Monday so it should be checked</span>
<a href="#l15.143"></a><span id="l15.143">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l15.144"></a><span id="l15.144">   // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineat">@@ -139,40 +138,39 @@ function setRecurrence(recurrence){</span>
<a href="#l15.146"></a><span id="l15.146">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l15.147"></a><span id="l15.147">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l15.148"></a><span id="l15.148">   </span>
<a href="#l15.149"></a><span id="l15.149">   // set number of occurrences</span>
<a href="#l15.150"></a><span id="l15.150">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l15.151"></a><span id="l15.151">   let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/'</span>
<a href="#l15.152"></a><span id="l15.152">     + 'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/'</span>
<a href="#l15.153"></a><span id="l15.153">     + 'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineminus">-  // delete previous number</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineplus">+  // replace previous number</span>
<a href="#l15.156"></a><span id="l15.156">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l15.158"></a><span id="l15.158">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l15.159"></a><span id="l15.159">     </span>
<a href="#l15.160"></a><span id="l15.160">   // close dialog</span>
<a href="#l15.161"></a><span id="l15.161">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l15.162"></a><span id="l15.162">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l15.163"></a><span id="l15.163"> }</span>
<a href="#l15.164"></a><span id="l15.164"> </span>
<a href="#l15.165"></a><span id="l15.165"> function checkMultiWeekView(view){</span>
<a href="#l15.166"></a><span id="l15.166">   let week = 1;</span>
<a href="#l15.167"></a><span id="l15.167">   </span>
<a href="#l15.168"></a><span id="l15.168">   // in month view event starts from 2nd row</span>
<a href="#l15.169"></a><span id="l15.169">   if(view == &quot;month&quot;) week++;</span>
<a href="#l15.170"></a><span id="l15.170"> </span>
<a href="#l15.171"></a><span id="l15.171">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l15.172"></a><span id="l15.172">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, i, undefined, controller)</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined)</span>
<a href="#l15.175"></a><span id="l15.175">       + eventPath;</span>
<a href="#l15.176"></a><span id="l15.176">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.177"></a><span id="l15.177">   }</span>
<a href="#l15.178"></a><span id="l15.178">   </span>
<a href="#l15.179"></a><span id="l15.179">   // Saturday</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 7, undefined, controller)</span>
<a href="#l15.181"></a><span id="l15.181" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined)</span>
<a href="#l15.182"></a><span id="l15.182">     + eventPath;</span>
<a href="#l15.183"></a><span id="l15.183">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l15.184"></a><span id="l15.184"> }</span>
<a href="#l15.185"></a><span id="l15.185"> </span>
<a href="#l15.186"></a><span id="l15.186"> var teardownTest = function(module) {</span>
<a href="#l15.187"></a><span id="l15.187" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l15.189"></a><span id="l15.189"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testWeeklyUntilRecursion.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -29,133 +29,132 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.5"></a><span id="l16.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.6"></a><span id="l16.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.7"></a><span id="l16.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.8"></a><span id="l16.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.9"></a><span id="l16.9">  *</span>
<a href="#l16.10"></a><span id="l16.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.11"></a><span id="l16.11">  </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+</span>
<a href="#l16.16"></a><span id="l16.16"> const sleep = 500;</span>
<a href="#l16.17"></a><span id="l16.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l16.18"></a><span id="l16.18"> var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> var hour = 8;</span>
<a href="#l16.21"></a><span id="l16.21"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-</span>
<a href="#l16.26"></a><span id="l16.26"> var setupModule = function(module) {</span>
<a href="#l16.27"></a><span id="l16.27">   controller = mozmill.getMail3PaneController();</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l16.30"></a><span id="l16.30"> }</span>
<a href="#l16.31"></a><span id="l16.31"> </span>
<a href="#l16.32"></a><span id="l16.32"> var testWeeklyUntilRecursion = function () {</span>
<a href="#l16.33"></a><span id="l16.33">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-  </span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller); // Monday</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l16.40"></a><span id="l16.40">   </span>
<a href="#l16.41"></a><span id="l16.41">   // create weekly recurring event</span>
<a href="#l16.42"></a><span id="l16.42">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l16.47"></a><span id="l16.47">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l16.49"></a><span id="l16.49">   </span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-  md.start();</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l16.55"></a><span id="l16.55">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l16.56"></a><span id="l16.56">   </span>
<a href="#l16.57"></a><span id="l16.57">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l16.60"></a><span id="l16.60">   </span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l16.63"></a><span id="l16.63">     + eventPath;</span>
<a href="#l16.64"></a><span id="l16.64">   </span>
<a href="#l16.65"></a><span id="l16.65">   // check day view</span>
<a href="#l16.66"></a><span id="l16.66">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l16.67"></a><span id="l16.67">     // Monday</span>
<a href="#l16.68"></a><span id="l16.68">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-    CalendarUtils.forward(2);</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+    calUtils.forward(controller, 2);</span>
<a href="#l16.71"></a><span id="l16.71">     // Wednesday</span>
<a href="#l16.72"></a><span id="l16.72">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-    CalendarUtils.forward(2);</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+    calUtils.forward(controller, 2);</span>
<a href="#l16.75"></a><span id="l16.75">     // Friday</span>
<a href="#l16.76"></a><span id="l16.76">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-    CalendarUtils.forward(3);</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+    calUtils.forward(controller, 3);</span>
<a href="#l16.79"></a><span id="l16.79">   }</span>
<a href="#l16.80"></a><span id="l16.80">   </span>
<a href="#l16.81"></a><span id="l16.81">   // Monday, last occurrence</span>
<a href="#l16.82"></a><span id="l16.82">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineminus">-  CalendarUtils.forward(2);</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+  calUtils.forward(controller, 2);</span>
<a href="#l16.85"></a><span id="l16.85">   // Wednesday</span>
<a href="#l16.86"></a><span id="l16.86">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-  CalendarUtils.forward(2);</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+  calUtils.forward(controller, 2);</span>
<a href="#l16.89"></a><span id="l16.89">   </span>
<a href="#l16.90"></a><span id="l16.90">   // check week view</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l16.95"></a><span id="l16.95">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l16.96"></a><span id="l16.96">     // Monday</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller)</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l16.99"></a><span id="l16.99">       + eventPath;</span>
<a href="#l16.100"></a><span id="l16.100">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.101"></a><span id="l16.101">     // Wednesday</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller)</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l16.104"></a><span id="l16.104">       + eventPath;</span>
<a href="#l16.105"></a><span id="l16.105">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.106"></a><span id="l16.106">     // Friday</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 6, hour, controller)</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour)</span>
<a href="#l16.109"></a><span id="l16.109">       + eventPath;</span>
<a href="#l16.110"></a><span id="l16.110">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.111"></a><span id="l16.111">     </span>
<a href="#l16.112"></a><span id="l16.112" class="difflineminus">-    CalendarUtils.forward(1);</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l16.114"></a><span id="l16.114">   }</span>
<a href="#l16.115"></a><span id="l16.115">   </span>
<a href="#l16.116"></a><span id="l16.116">   // Monday, last occurrence</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller)</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l16.119"></a><span id="l16.119">     + eventPath;</span>
<a href="#l16.120"></a><span id="l16.120">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.121"></a><span id="l16.121">   // Wednesday</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller)</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l16.124"></a><span id="l16.124">     + eventPath;</span>
<a href="#l16.125"></a><span id="l16.125">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.126"></a><span id="l16.126">   </span>
<a href="#l16.127"></a><span id="l16.127">   // check multiweek view</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l16.132"></a><span id="l16.132">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l16.133"></a><span id="l16.133">   </span>
<a href="#l16.134"></a><span id="l16.134">   // check month view</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l16.139"></a><span id="l16.139">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l16.140"></a><span id="l16.140">   </span>
<a href="#l16.141"></a><span id="l16.141">   // delete event</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 2, undefined, controller)</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineminus">-      + eventPath));</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined)</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineplus">+    + eventPath;</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l16.150"></a><span id="l16.150">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l16.151"></a><span id="l16.151">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.153"></a><span id="l16.153"> }</span>
<a href="#l16.154"></a><span id="l16.154"> </span>
<a href="#l16.155"></a><span id="l16.155"> function setRecurrence(recurrence){</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineminus">-  </span>
<a href="#l16.158"></a><span id="l16.158">   // weekly</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l16.160"></a><span id="l16.160">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l16.161"></a><span id="l16.161">   recurrence.sleep(sleep);</span>
<a href="#l16.162"></a><span id="l16.162">   </span>
<a href="#l16.163"></a><span id="l16.163" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineminus">-  let fri = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l16.169"></a><span id="l16.169">   </span>
<a href="#l16.170"></a><span id="l16.170">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l16.171"></a><span id="l16.171">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l16.172"></a><span id="l16.172">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l16.173"></a><span id="l16.173">   </span>
<a href="#l16.174"></a><span id="l16.174">   // starting from Monday so it should be checked</span>
<a href="#l16.175"></a><span id="l16.175">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l16.176"></a><span id="l16.176">   // check Wednesday and Friday too</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineat">@@ -186,34 +185,34 @@ function setRecurrence(recurrence){</span>
<a href="#l16.178"></a><span id="l16.178"> function checkMultiWeekView(view){</span>
<a href="#l16.179"></a><span id="l16.179">   let startWeek = 1;</span>
<a href="#l16.180"></a><span id="l16.180">   </span>
<a href="#l16.181"></a><span id="l16.181">   // in month view event starts from 2nd row</span>
<a href="#l16.182"></a><span id="l16.182">   if(view == &quot;month&quot;) startWeek++;</span>
<a href="#l16.183"></a><span id="l16.183"> </span>
<a href="#l16.184"></a><span id="l16.184">   for(let week = startWeek; week &lt; startWeek + 3; week++){</span>
<a href="#l16.185"></a><span id="l16.185">     // Monday</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 2, undefined, controller)</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined)</span>
<a href="#l16.188"></a><span id="l16.188">       + eventPath;</span>
<a href="#l16.189"></a><span id="l16.189">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.190"></a><span id="l16.190">     // Wednesday</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 4, undefined, controller)</span>
<a href="#l16.192"></a><span id="l16.192" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined)</span>
<a href="#l16.193"></a><span id="l16.193">       + eventPath;</span>
<a href="#l16.194"></a><span id="l16.194">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.195"></a><span id="l16.195">     // Friday</span>
<a href="#l16.196"></a><span id="l16.196" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 6, undefined, controller)</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined)</span>
<a href="#l16.198"></a><span id="l16.198">       + eventPath;</span>
<a href="#l16.199"></a><span id="l16.199">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.200"></a><span id="l16.200">   }</span>
<a href="#l16.201"></a><span id="l16.201">   </span>
<a href="#l16.202"></a><span id="l16.202">   // Monday, last occurrence</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 3, 2, </span>
<a href="#l16.204"></a><span id="l16.204" class="difflineminus">-    undefined, controller) + eventPath;</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineplus">+    undefined) + eventPath;</span>
<a href="#l16.207"></a><span id="l16.207">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.208"></a><span id="l16.208">   // Wednesday</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l16.210"></a><span id="l16.210" class="difflineminus">-    undefined, controller) + eventPath;</span>
<a href="#l16.211"></a><span id="l16.211" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineplus">+    undefined) + eventPath;</span>
<a href="#l16.213"></a><span id="l16.213">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.214"></a><span id="l16.214"> }</span>
<a href="#l16.215"></a><span id="l16.215"> </span>
<a href="#l16.216"></a><span id="l16.216"> var teardownTest = function(module) {</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l16.219"></a><span id="l16.219"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursion/testWeeklyWithExceptionRecursion.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -29,57 +29,56 @@</span>
<a href="#l17.4"></a><span id="l17.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.5"></a><span id="l17.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.6"></a><span id="l17.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.7"></a><span id="l17.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.8"></a><span id="l17.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.9"></a><span id="l17.9">  *</span>
<a href="#l17.10"></a><span id="l17.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+</span>
<a href="#l17.16"></a><span id="l17.16"> const sleep = 500;</span>
<a href="#l17.17"></a><span id="l17.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l17.18"></a><span id="l17.18"> var hour = 8;</span>
<a href="#l17.19"></a><span id="l17.19"> var startDate = new Date(2009, 0, 6);</span>
<a href="#l17.20"></a><span id="l17.20"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-</span>
<a href="#l17.25"></a><span id="l17.25"> var setupModule = function(module) {</span>
<a href="#l17.26"></a><span id="l17.26">   controller = mozmill.getMail3PaneController();</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l17.29"></a><span id="l17.29"> }</span>
<a href="#l17.30"></a><span id="l17.30"> </span>
<a href="#l17.31"></a><span id="l17.31"> var testWeeklyWithExceptionRecursion = function () {</span>
<a href="#l17.32"></a><span id="l17.32">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-  </span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.39"></a><span id="l17.39">   </span>
<a href="#l17.40"></a><span id="l17.40">   // create weekly recurring event</span>
<a href="#l17.41"></a><span id="l17.41">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l17.46"></a><span id="l17.46">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l17.48"></a><span id="l17.48">   </span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-  md.start();</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l17.54"></a><span id="l17.54">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l17.55"></a><span id="l17.55">   </span>
<a href="#l17.56"></a><span id="l17.56">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l17.59"></a><span id="l17.59">   </span>
<a href="#l17.60"></a><span id="l17.60">   // move 5th January occurrence to 6th January</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-  CalendarUtils.handleOccurrenceModification(false);</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+  calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l17.63"></a><span id="l17.63">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l17.66"></a><span id="l17.66">       + eventPath));</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l17.69"></a><span id="l17.69">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l17.70"></a><span id="l17.70">   event.sleep(sleep);</span>
<a href="#l17.71"></a><span id="l17.71">   </span>
<a href="#l17.72"></a><span id="l17.72">   let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l17.73"></a><span id="l17.73">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/'</span>
<a href="#l17.74"></a><span id="l17.74">     + 'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/'</span>
<a href="#l17.75"></a><span id="l17.75">     + 'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l17.76"></a><span id="l17.76">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineat">@@ -96,159 +95,159 @@ var testWeeklyWithExceptionRecursion = f</span>
<a href="#l17.78"></a><span id="l17.78">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l17.79"></a><span id="l17.79">   let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l17.80"></a><span id="l17.80">                                              startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l17.81"></a><span id="l17.81">   event.type(startDateInput, startDateString);</span>
<a href="#l17.82"></a><span id="l17.82">   // applies startdate change</span>
<a href="#l17.83"></a><span id="l17.83">   event.click(endDateInput);</span>
<a href="#l17.84"></a><span id="l17.84"> </span>
<a href="#l17.85"></a><span id="l17.85">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l17.88"></a><span id="l17.88">   </span>
<a href="#l17.89"></a><span id="l17.89">   // change recurrence rule</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 7, controller);</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineminus">-  CalendarUtils.handleParentModification(false);</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+  calUtils.handleParentModification(controller, false);</span>
<a href="#l17.94"></a><span id="l17.94">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l17.97"></a><span id="l17.97">       + eventPath));</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l17.100"></a><span id="l17.100">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l17.102"></a><span id="l17.102">   </span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(changeRecurrence);</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  md.start();</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+  md.start(changeRecurrence);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l17.108"></a><span id="l17.108">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l17.109"></a><span id="l17.109">   </span>
<a href="#l17.110"></a><span id="l17.110">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l17.113"></a><span id="l17.113">   </span>
<a href="#l17.114"></a><span id="l17.114">   // check two weeks</span>
<a href="#l17.115"></a><span id="l17.115">   // day view</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-  let path = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+  let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l17.120"></a><span id="l17.120">     + eventPath;</span>
<a href="#l17.121"></a><span id="l17.121">   </span>
<a href="#l17.122"></a><span id="l17.122" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.124"></a><span id="l17.124">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.125"></a><span id="l17.125">   </span>
<a href="#l17.126"></a><span id="l17.126" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.128"></a><span id="l17.128">   let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l17.129"></a><span id="l17.129">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l17.130"></a><span id="l17.130">     + 'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l17.131"></a><span id="l17.131">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l17.132"></a><span id="l17.132">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l17.133"></a><span id="l17.133">   // assert exactly two</span>
<a href="#l17.134"></a><span id="l17.134">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.135"></a><span id="l17.135">     tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l17.136"></a><span id="l17.136">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.137"></a><span id="l17.137">     tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l17.138"></a><span id="l17.138">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.139"></a><span id="l17.139">     tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l17.140"></a><span id="l17.140">   </span>
<a href="#l17.141"></a><span id="l17.141" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.143"></a><span id="l17.143">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.146"></a><span id="l17.146">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.149"></a><span id="l17.149">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.152"></a><span id="l17.152">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.155"></a><span id="l17.155">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.156"></a><span id="l17.156">   </span>
<a href="#l17.157"></a><span id="l17.157">   // next week</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.160"></a><span id="l17.160">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.163"></a><span id="l17.163">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.166"></a><span id="l17.166">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.169"></a><span id="l17.169">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.172"></a><span id="l17.172">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.175"></a><span id="l17.175">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.176"></a><span id="l17.176">   </span>
<a href="#l17.177"></a><span id="l17.177">   // week view</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.182"></a><span id="l17.182">   </span>
<a href="#l17.183"></a><span id="l17.183" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller)</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l17.185"></a><span id="l17.185">     + eventPath;</span>
<a href="#l17.186"></a><span id="l17.186">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.187"></a><span id="l17.187">   </span>
<a href="#l17.188"></a><span id="l17.188">   tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l17.189"></a><span id="l17.189">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l17.190"></a><span id="l17.190">     + 'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l17.191"></a><span id="l17.191">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l17.192"></a><span id="l17.192">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l17.193"></a><span id="l17.193">   // assert exactly two</span>
<a href="#l17.194"></a><span id="l17.194">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.195"></a><span id="l17.195">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l17.196"></a><span id="l17.196">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.197"></a><span id="l17.197">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l17.198"></a><span id="l17.198">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.199"></a><span id="l17.199">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l17.200"></a><span id="l17.200">   </span>
<a href="#l17.201"></a><span id="l17.201" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller);</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l17.203"></a><span id="l17.203">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 5, hour, controller);</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l17.206"></a><span id="l17.206">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 6, hour, controller);</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l17.209"></a><span id="l17.209">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller);</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l17.212"></a><span id="l17.212">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.213"></a><span id="l17.213">   </span>
<a href="#l17.214"></a><span id="l17.214" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller);</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l17.218"></a><span id="l17.218">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller);</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l17.221"></a><span id="l17.221">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 3, hour, controller);</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l17.224"></a><span id="l17.224">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller);</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l17.227"></a><span id="l17.227">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 5, hour, controller);</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l17.230"></a><span id="l17.230">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 6, hour, controller);</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l17.233"></a><span id="l17.233">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller);</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l17.236"></a><span id="l17.236">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.237"></a><span id="l17.237">   </span>
<a href="#l17.238"></a><span id="l17.238">   // multiweek view</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.243"></a><span id="l17.243">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l17.244"></a><span id="l17.244">   </span>
<a href="#l17.245"></a><span id="l17.245">   // month view</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l17.248"></a><span id="l17.248">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l17.249"></a><span id="l17.249">   </span>
<a href="#l17.250"></a><span id="l17.250">   // delete event</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l17.252"></a><span id="l17.252" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 12, controller);</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineminus">-      + eventPath));</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+    + eventPath;</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+  calUtils.handleParentDeletion(false);</span>
<a href="#l17.263"></a><span id="l17.263">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l17.264"></a><span id="l17.264">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l17.266"></a><span id="l17.266"> }</span>
<a href="#l17.267"></a><span id="l17.267"> </span>
<a href="#l17.268"></a><span id="l17.268"> function setRecurrence(recurrence){</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l17.270"></a><span id="l17.270" class="difflineminus">-  </span>
<a href="#l17.271"></a><span id="l17.271">   // weekly</span>
<a href="#l17.272"></a><span id="l17.272" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l17.273"></a><span id="l17.273">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l17.274"></a><span id="l17.274">   recurrence.sleep(sleep);</span>
<a href="#l17.275"></a><span id="l17.275">   </span>
<a href="#l17.276"></a><span id="l17.276" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l17.277"></a><span id="l17.277" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l17.278"></a><span id="l17.278" class="difflineminus">-  let fri = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l17.279"></a><span id="l17.279" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l17.280"></a><span id="l17.280" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l17.281"></a><span id="l17.281" class="difflineplus">+  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l17.282"></a><span id="l17.282">   </span>
<a href="#l17.283"></a><span id="l17.283">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l17.284"></a><span id="l17.284">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l17.285"></a><span id="l17.285">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l17.286"></a><span id="l17.286">   </span>
<a href="#l17.287"></a><span id="l17.287">   // starting from Monday so it should be checked</span>
<a href="#l17.288"></a><span id="l17.288">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l17.289"></a><span id="l17.289">   // check Wednesday and Friday too</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineat">@@ -256,26 +255,25 @@ function setRecurrence(recurrence){</span>
<a href="#l17.291"></a><span id="l17.291">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l17.292"></a><span id="l17.292">     </span>
<a href="#l17.293"></a><span id="l17.293">   // close dialog</span>
<a href="#l17.294"></a><span id="l17.294">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l17.295"></a><span id="l17.295">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l17.296"></a><span id="l17.296"> }</span>
<a href="#l17.297"></a><span id="l17.297"> </span>
<a href="#l17.298"></a><span id="l17.298"> function changeRecurrence(recurrence){</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineminus">-  </span>
<a href="#l17.301"></a><span id="l17.301">   // weekly</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l17.303"></a><span id="l17.303">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l17.304"></a><span id="l17.304">   recurrence.sleep(sleep);</span>
<a href="#l17.305"></a><span id="l17.305">   </span>
<a href="#l17.306"></a><span id="l17.306" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l17.307"></a><span id="l17.307" class="difflineminus">-  let tue = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l17.308"></a><span id="l17.308" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l17.309"></a><span id="l17.309" class="difflineminus">-  let fri = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l17.310"></a><span id="l17.310" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l17.311"></a><span id="l17.311" class="difflineplus">+  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l17.314"></a><span id="l17.314">   </span>
<a href="#l17.315"></a><span id="l17.315">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l17.316"></a><span id="l17.316">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l17.317"></a><span id="l17.317">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l17.318"></a><span id="l17.318">   </span>
<a href="#l17.319"></a><span id="l17.319">   // check old rule</span>
<a href="#l17.320"></a><span id="l17.320">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l17.321"></a><span id="l17.321">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineat">@@ -287,45 +285,45 @@ function changeRecurrence(recurrence){</span>
<a href="#l17.323"></a><span id="l17.323">   // close dialog</span>
<a href="#l17.324"></a><span id="l17.324">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l17.325"></a><span id="l17.325">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l17.326"></a><span id="l17.326"> }</span>
<a href="#l17.327"></a><span id="l17.327"> </span>
<a href="#l17.328"></a><span id="l17.328"> function checkMultiWeekView(view){</span>
<a href="#l17.329"></a><span id="l17.329">   let startWeek = view == &quot;multiweek&quot; ? 1 : 2</span>
<a href="#l17.330"></a><span id="l17.330"> </span>
<a href="#l17.331"></a><span id="l17.331" class="difflineminus">-  let path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 2, hour, controller);</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineplus">+  let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l17.333"></a><span id="l17.333">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.334"></a><span id="l17.334">   // assert exactly two</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 3, hour, controller);</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l17.337"></a><span id="l17.337">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + '/[0]'));</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 3, hour, controller);</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l17.340"></a><span id="l17.340">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + '/[1]'));</span>
<a href="#l17.341"></a><span id="l17.341" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 3, hour, controller);</span>
<a href="#l17.342"></a><span id="l17.342" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l17.343"></a><span id="l17.343">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + '/[2]'));</span>
<a href="#l17.344"></a><span id="l17.344" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 4, hour, controller);</span>
<a href="#l17.345"></a><span id="l17.345" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l17.346"></a><span id="l17.346">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.347"></a><span id="l17.347" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 5, hour, controller);</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l17.349"></a><span id="l17.349">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.350"></a><span id="l17.350" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 6, hour, controller);</span>
<a href="#l17.351"></a><span id="l17.351" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l17.352"></a><span id="l17.352">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.353"></a><span id="l17.353" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 7, hour, controller);</span>
<a href="#l17.354"></a><span id="l17.354" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l17.355"></a><span id="l17.355">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.356"></a><span id="l17.356">   </span>
<a href="#l17.357"></a><span id="l17.357" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 1, hour, controller);</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l17.359"></a><span id="l17.359">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.360"></a><span id="l17.360" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 2, hour, controller);</span>
<a href="#l17.361"></a><span id="l17.361" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l17.362"></a><span id="l17.362">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 3, hour, controller);</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l17.365"></a><span id="l17.365">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.366"></a><span id="l17.366" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 4, hour, controller);</span>
<a href="#l17.367"></a><span id="l17.367" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l17.368"></a><span id="l17.368">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.369"></a><span id="l17.369" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 5, hour, controller);</span>
<a href="#l17.370"></a><span id="l17.370" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l17.371"></a><span id="l17.371">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.372"></a><span id="l17.372" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 6, hour, controller);</span>
<a href="#l17.373"></a><span id="l17.373" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l17.374"></a><span id="l17.374">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.375"></a><span id="l17.375" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 7, hour, controller);</span>
<a href="#l17.376"></a><span id="l17.376" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l17.377"></a><span id="l17.377">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l17.378"></a><span id="l17.378"> }</span>
<a href="#l17.379"></a><span id="l17.379"> </span>
<a href="#l17.380"></a><span id="l17.380"> var teardownTest = function(module) {</span>
<a href="#l17.381"></a><span id="l17.381" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l17.382"></a><span id="l17.382" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l17.383"></a><span id="l17.383"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testAnnualRecursion.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -29,94 +29,98 @@</span>
<a href="#l18.4"></a><span id="l18.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.5"></a><span id="l18.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.6"></a><span id="l18.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.7"></a><span id="l18.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.8"></a><span id="l18.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.9"></a><span id="l18.9">  *</span>
<a href="#l18.10"></a><span id="l18.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+</span>
<a href="#l18.14"></a><span id="l18.14"> const sleep = 500;</span>
<a href="#l18.15"></a><span id="l18.15"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l18.16"></a><span id="l18.16"> var startYear = 1950;</span>
<a href="#l18.17"></a><span id="l18.17"> var epoch = 1970;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-</span>
<a href="#l18.22"></a><span id="l18.22"> var setupModule = function(module) {</span>
<a href="#l18.23"></a><span id="l18.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l18.26"></a><span id="l18.26"> }</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28"> var testAnnualRecursion = function () {</span>
<a href="#l18.29"></a><span id="l18.29">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l18.30"></a><span id="l18.30">   </span>
<a href="#l18.31"></a><span id="l18.31">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+  calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l18.35"></a><span id="l18.35">   </span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l18.37"></a><span id="l18.37">   // rotate view</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-  CalendarUtils.goToDate(startYear, 1, 1, controller);</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l18.44"></a><span id="l18.44">   </span>
<a href="#l18.45"></a><span id="l18.45">   // create yearly recurring all-day event</span>
<a href="#l18.46"></a><span id="l18.46">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.ALLDAY, undefined, 1, undefined,</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-    controller)));</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l18.52"></a><span id="l18.52">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l18.53"></a><span id="l18.53">                  .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l18.54"></a><span id="l18.54">   event.sleep(sleep);</span>
<a href="#l18.55"></a><span id="l18.55">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l18.56"></a><span id="l18.56">     &quot;yearly&quot;);</span>
<a href="#l18.57"></a><span id="l18.57">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l18.58"></a><span id="l18.58">   controller.sleep(sleep);</span>
<a href="#l18.59"></a><span id="l18.59">   </span>
<a href="#l18.60"></a><span id="l18.60">   let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l18.61"></a><span id="l18.61">   let box = &quot;&quot;;</span>
<a href="#l18.62"></a><span id="l18.62">   for(let i = 0; i &lt; checkYears.length; i++){</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-    CalendarUtils.goToDate(checkYears[i], 1, 1, controller);</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineplus">+    calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l18.65"></a><span id="l18.65">     let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l18.66"></a><span id="l18.66">     let column = date.getDay() + 1;</span>
<a href="#l18.67"></a><span id="l18.67">     </span>
<a href="#l18.68"></a><span id="l18.68">     // day view</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-    CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.ALLDAY, undefined, 1, undefined,</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineplus">+      + eventPath;</span>
<a href="#l18.75"></a><span id="l18.75">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.76"></a><span id="l18.76">     </span>
<a href="#l18.77"></a><span id="l18.77">     // week view</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineminus">-    CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.ALLDAY, undefined, column, undefined,</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined)</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineplus">+      + eventPath;</span>
<a href="#l18.84"></a><span id="l18.84">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.85"></a><span id="l18.85">     </span>
<a href="#l18.86"></a><span id="l18.86">     // multiweek view</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineminus">-    CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.ALLDAY, 1, column, undefined,</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineplus">+      + eventPath;</span>
<a href="#l18.93"></a><span id="l18.93">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.94"></a><span id="l18.94">     </span>
<a href="#l18.95"></a><span id="l18.95">     // month view</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-    CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.ALLDAY, 1, column, undefined,</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineplus">+      + eventPath;</span>
<a href="#l18.102"></a><span id="l18.102">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.103"></a><span id="l18.103">   }</span>
<a href="#l18.104"></a><span id="l18.104">   </span>
<a href="#l18.105"></a><span id="l18.105">   // delete event</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineminus">-  CalendarUtils.goToDate(checkYears[0], 1, 1, controller);</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.ALLDAY, undefined, 1, undefined,</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-    controller) + eventPath;</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineplus">+  calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineplus">+    + eventPath;</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineplus">+  calUtils.handleParentDeletion(false);</span>
<a href="#l18.116"></a><span id="l18.116">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.117"></a><span id="l18.117">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l18.118"></a><span id="l18.118">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.120"></a><span id="l18.120">   </span>
<a href="#l18.121"></a><span id="l18.121">   // reset view</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l18.127"></a><span id="l18.127"> }</span>
<a href="#l18.128"></a><span id="l18.128"> </span>
<a href="#l18.129"></a><span id="l18.129"> var teardownTest = function(module) {</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l18.132"></a><span id="l18.132"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testBiweeklyRecursion.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -29,118 +29,123 @@</span>
<a href="#l19.4"></a><span id="l19.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.5"></a><span id="l19.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.6"></a><span id="l19.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.7"></a><span id="l19.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.8"></a><span id="l19.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.9"></a><span id="l19.9">  *</span>
<a href="#l19.10"></a><span id="l19.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.11"></a><span id="l19.11">  </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+</span>
<a href="#l19.14"></a><span id="l19.14"> const sleep = 500;</span>
<a href="#l19.15"></a><span id="l19.15"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l19.16"></a><span id="l19.16"> var hour = 8;</span>
<a href="#l19.17"></a><span id="l19.17"> </span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-</span>
<a href="#l19.21"></a><span id="l19.21"> var setupModule = function(module) {</span>
<a href="#l19.22"></a><span id="l19.22">   controller = mozmill.getMail3PaneController();</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l19.25"></a><span id="l19.25"> }</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27"> var testBiweeklyRecursion = function () {</span>
<a href="#l19.28"></a><span id="l19.28">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l19.29"></a><span id="l19.29">   </span>
<a href="#l19.30"></a><span id="l19.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l19.34"></a><span id="l19.34">   </span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l19.36"></a><span id="l19.36">   // rotate view</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l19.43"></a><span id="l19.43">   </span>
<a href="#l19.44"></a><span id="l19.44">   // create biweekly event</span>
<a href="#l19.45"></a><span id="l19.45">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l19.50"></a><span id="l19.50">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l19.52"></a><span id="l19.52">   </span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l19.54"></a><span id="l19.54">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l19.55"></a><span id="l19.55">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l19.58"></a><span id="l19.58">   </span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l19.61"></a><span id="l19.61">     + eventPath;</span>
<a href="#l19.62"></a><span id="l19.62">   </span>
<a href="#l19.63"></a><span id="l19.63">   // check day view</span>
<a href="#l19.64"></a><span id="l19.64">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l19.65"></a><span id="l19.65">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-    CalendarUtils.forward(14);</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+    calUtils.forward(controller, 14);</span>
<a href="#l19.68"></a><span id="l19.68">   }</span>
<a href="#l19.69"></a><span id="l19.69">   </span>
<a href="#l19.70"></a><span id="l19.70">   // check week view</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l19.75"></a><span id="l19.75">   </span>
<a href="#l19.76"></a><span id="l19.76" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller)</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l19.78"></a><span id="l19.78">     + eventPath;</span>
<a href="#l19.79"></a><span id="l19.79">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l19.80"></a><span id="l19.80">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineminus">-    CalendarUtils.forward(2);</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineplus">+    calUtils.forward(2);</span>
<a href="#l19.83"></a><span id="l19.83">   }</span>
<a href="#l19.84"></a><span id="l19.84"> </span>
<a href="#l19.85"></a><span id="l19.85">   // check multiweek view</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l19.90"></a><span id="l19.90">   </span>
<a href="#l19.91"></a><span id="l19.91">   // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l19.92"></a><span id="l19.92">   for(let i = 0; i &lt; 5; i++){</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineminus">-      undefined, controller) + eventPath;</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l19.97"></a><span id="l19.97">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineminus">-      undefined, controller) + eventPath;</span>
<a href="#l19.100"></a><span id="l19.100" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l19.101"></a><span id="l19.101" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l19.102"></a><span id="l19.102">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineminus">-    CalendarUtils.forward(1);</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l19.105"></a><span id="l19.105">   }</span>
<a href="#l19.106"></a><span id="l19.106">   </span>
<a href="#l19.107"></a><span id="l19.107">   // check month view</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 31, controller);</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l19.112"></a><span id="l19.112"> </span>
<a href="#l19.113"></a><span id="l19.113">   // January</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 5, 7, undefined, controller)</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined)</span>
<a href="#l19.116"></a><span id="l19.116">     + eventPath;</span>
<a href="#l19.117"></a><span id="l19.117">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l19.120"></a><span id="l19.120">   </span>
<a href="#l19.121"></a><span id="l19.121">   // February</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 7, undefined, controller)</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l19.124"></a><span id="l19.124">     + eventPath;</span>
<a href="#l19.125"></a><span id="l19.125">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 4, 7, undefined, controller)</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l19.128"></a><span id="l19.128">     + eventPath;</span>
<a href="#l19.129"></a><span id="l19.129">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l19.132"></a><span id="l19.132">   </span>
<a href="#l19.133"></a><span id="l19.133">   // March</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 7, undefined, controller)</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l19.136"></a><span id="l19.136">     + eventPath;</span>
<a href="#l19.137"></a><span id="l19.137">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 4, 7, undefined, controller)</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l19.140"></a><span id="l19.140">     + eventPath;</span>
<a href="#l19.141"></a><span id="l19.141">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));  </span>
<a href="#l19.142"></a><span id="l19.142"> </span>
<a href="#l19.143"></a><span id="l19.143">   // delete event</span>
<a href="#l19.144"></a><span id="l19.144">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l19.146"></a><span id="l19.146" class="difflineplus">+  calUtils.handleParentDeletion(false);</span>
<a href="#l19.147"></a><span id="l19.147">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l19.148"></a><span id="l19.148">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l19.150"></a><span id="l19.150">   </span>
<a href="#l19.151"></a><span id="l19.151">   // reset view</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l19.153"></a><span id="l19.153" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l19.154"></a><span id="l19.154" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l19.159"></a><span id="l19.159"> }</span>
<a href="#l19.160"></a><span id="l19.160"> </span>
<a href="#l19.161"></a><span id="l19.161"> var teardownTest = function(module) {</span>
<a href="#l19.162"></a><span id="l19.162" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l19.164"></a><span id="l19.164"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testDailyRecursion.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -29,222 +29,222 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l20.5"></a><span id="l20.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.6"></a><span id="l20.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.7"></a><span id="l20.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.8"></a><span id="l20.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.9"></a><span id="l20.9">  *</span>
<a href="#l20.10"></a><span id="l20.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+</span>
<a href="#l20.14"></a><span id="l20.14"> const sleep = 500;</span>
<a href="#l20.15"></a><span id="l20.15"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l20.16"></a><span id="l20.16"> var hour = 8;</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-</span>
<a href="#l20.21"></a><span id="l20.21"> var setupModule = function(module) {</span>
<a href="#l20.22"></a><span id="l20.22">   controller = mozmill.getMail3PaneController();</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l20.25"></a><span id="l20.25"> }</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27"> var testDailyRecursion = function () {</span>
<a href="#l20.28"></a><span id="l20.28">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l20.29"></a><span id="l20.29">   </span>
<a href="#l20.30"></a><span id="l20.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.34"></a><span id="l20.34">   </span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l20.36"></a><span id="l20.36">   // rotate view</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l20.43"></a><span id="l20.43">   </span>
<a href="#l20.44"></a><span id="l20.44">   // create daily event</span>
<a href="#l20.45"></a><span id="l20.45">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l20.50"></a><span id="l20.50">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l20.51"></a><span id="l20.51">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l20.53"></a><span id="l20.53">   </span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l20.55"></a><span id="l20.55">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l20.56"></a><span id="l20.56">     &quot;daily&quot;);</span>
<a href="#l20.57"></a><span id="l20.57">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l20.58"></a><span id="l20.58">   </span>
<a href="#l20.59"></a><span id="l20.59">   // check day view for 7 days</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, undefined, controller)</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l20.62"></a><span id="l20.62">     + eventPath;</span>
<a href="#l20.63"></a><span id="l20.63">   controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.64"></a><span id="l20.64">   </span>
<a href="#l20.65"></a><span id="l20.65">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l20.66"></a><span id="l20.66">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l20.70"></a><span id="l20.70">   }</span>
<a href="#l20.71"></a><span id="l20.71">   </span>
<a href="#l20.72"></a><span id="l20.72">   // check week view for 2 weeks</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.77"></a><span id="l20.77">   </span>
<a href="#l20.78"></a><span id="l20.78">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, 1, day, hour, controller)</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l20.81"></a><span id="l20.81">       + eventPath;</span>
<a href="#l20.82"></a><span id="l20.82">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.83"></a><span id="l20.83">   }</span>
<a href="#l20.84"></a><span id="l20.84">   </span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l20.88"></a><span id="l20.88">   </span>
<a href="#l20.89"></a><span id="l20.89">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, 2, day, hour, controller)</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l20.92"></a><span id="l20.92">       + eventPath;</span>
<a href="#l20.93"></a><span id="l20.93">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.94"></a><span id="l20.94">   }</span>
<a href="#l20.95"></a><span id="l20.95">   </span>
<a href="#l20.96"></a><span id="l20.96">   // check multiweek view for 4 weeks</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.101"></a><span id="l20.101">   </span>
<a href="#l20.102"></a><span id="l20.102">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, 1, day, hour, controller)</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l20.105"></a><span id="l20.105">       + eventPath;</span>
<a href="#l20.106"></a><span id="l20.106">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.107"></a><span id="l20.107">   }</span>
<a href="#l20.108"></a><span id="l20.108">   </span>
<a href="#l20.109"></a><span id="l20.109">   for(let week = 2; week &lt;= 4; week++){</span>
<a href="#l20.110"></a><span id="l20.110">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineminus">-      let box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, week, day, hour, controller)</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineplus">+      let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l20.113"></a><span id="l20.113">         + eventPath;</span>
<a href="#l20.114"></a><span id="l20.114">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.115"></a><span id="l20.115">     }</span>
<a href="#l20.116"></a><span id="l20.116">   }</span>
<a href="#l20.117"></a><span id="l20.117">   </span>
<a href="#l20.118"></a><span id="l20.118">   // check month view for all 5 weeks</span>
<a href="#l20.119"></a><span id="l20.119" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l20.120"></a><span id="l20.120" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.123"></a><span id="l20.123">   </span>
<a href="#l20.124"></a><span id="l20.124">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 1, day, undefined, controller)</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l20.127"></a><span id="l20.127">       + eventPath;</span>
<a href="#l20.128"></a><span id="l20.128">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.129"></a><span id="l20.129">   }</span>
<a href="#l20.130"></a><span id="l20.130">   </span>
<a href="#l20.131"></a><span id="l20.131">   for(let week = 2; week &lt;= 5; week++){</span>
<a href="#l20.132"></a><span id="l20.132">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l20.133"></a><span id="l20.133" class="difflineminus">-      let box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, week, day, undefined, controller)</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineplus">+      let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l20.135"></a><span id="l20.135">         + eventPath;</span>
<a href="#l20.136"></a><span id="l20.136">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l20.137"></a><span id="l20.137">     }</span>
<a href="#l20.138"></a><span id="l20.138">   }</span>
<a href="#l20.139"></a><span id="l20.139">   </span>
<a href="#l20.140"></a><span id="l20.140">   // delete 3rd January occurrence</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineminus">-  let saturday = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 1, 7, undefined, controller)</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineplus">+  let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l20.143"></a><span id="l20.143">     + eventPath;</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineminus">-  CalendarUtils.handleOccurrenceDeletion(false);</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineplus">+  calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l20.146"></a><span id="l20.146">   controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l20.147"></a><span id="l20.147">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l20.148"></a><span id="l20.148">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l20.150"></a><span id="l20.150">   </span>
<a href="#l20.151"></a><span id="l20.151">   // verify in all views</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l20.154"></a><span id="l20.154">   </span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineminus">-  saturday = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, 1, 7, undefined, controller)</span>
<a href="#l20.157"></a><span id="l20.157" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l20.158"></a><span id="l20.158" class="difflineplus">+  saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l20.159"></a><span id="l20.159">     + eventPath;</span>
<a href="#l20.160"></a><span id="l20.160">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l20.161"></a><span id="l20.161">     </span>
<a href="#l20.162"></a><span id="l20.162" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineminus">-  saturday = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, undefined, controller)</span>
<a href="#l20.164"></a><span id="l20.164" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l20.165"></a><span id="l20.165" class="difflineplus">+  saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l20.166"></a><span id="l20.166">     + eventPath;</span>
<a href="#l20.167"></a><span id="l20.167">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l20.168"></a><span id="l20.168">     </span>
<a href="#l20.169"></a><span id="l20.169" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l20.170"></a><span id="l20.170" class="difflineminus">-  saturday = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, undefined, controller)</span>
<a href="#l20.171"></a><span id="l20.171" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l20.172"></a><span id="l20.172" class="difflineplus">+  saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l20.173"></a><span id="l20.173">     + eventPath;</span>
<a href="#l20.174"></a><span id="l20.174">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l20.175"></a><span id="l20.175">   </span>
<a href="#l20.176"></a><span id="l20.176">   // go to previous day to edit event to occur only on weekdays</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;previous-view-button&quot;));</span>
<a href="#l20.178"></a><span id="l20.178" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineplus">+  calUtils.back(controller, 1);</span>
<a href="#l20.180"></a><span id="l20.180">   </span>
<a href="#l20.181"></a><span id="l20.181" class="difflineminus">-  CalendarUtils.handleParentModification(false);</span>
<a href="#l20.182"></a><span id="l20.182" class="difflineplus">+  calUtils.handleParentModification(false);</span>
<a href="#l20.183"></a><span id="l20.183">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l20.186"></a><span id="l20.186">       + eventPath));</span>
<a href="#l20.187"></a><span id="l20.187">   </span>
<a href="#l20.188"></a><span id="l20.188" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l20.189"></a><span id="l20.189" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l20.190"></a><span id="l20.190">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l20.191"></a><span id="l20.191">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l20.192"></a><span id="l20.192" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l20.193"></a><span id="l20.193">   </span>
<a href="#l20.194"></a><span id="l20.194" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l20.195"></a><span id="l20.195">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l20.196"></a><span id="l20.196">     &quot;every.weekday&quot;);</span>
<a href="#l20.197"></a><span id="l20.197">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l20.198"></a><span id="l20.198" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l20.199"></a><span id="l20.199" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l20.200"></a><span id="l20.200">   </span>
<a href="#l20.201"></a><span id="l20.201">   // check day view for 7 days</span>
<a href="#l20.202"></a><span id="l20.202" class="difflineminus">-  let day = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, undefined, controller)</span>
<a href="#l20.203"></a><span id="l20.203" class="difflineplus">+  let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l20.204"></a><span id="l20.204">     + eventPath;</span>
<a href="#l20.205"></a><span id="l20.205">   var dates = [[2009, 1, 3],</span>
<a href="#l20.206"></a><span id="l20.206">                [2009, 1, 4]];</span>
<a href="#l20.207"></a><span id="l20.207">   for(let i = 0; i &lt; dates.length; i++){</span>
<a href="#l20.208"></a><span id="l20.208" class="difflineminus">-    CalendarUtils.goToDate(dates[i][0], dates[i][1], dates[i][2], controller);</span>
<a href="#l20.209"></a><span id="l20.209" class="difflineplus">+    calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l20.210"></a><span id="l20.210">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.211"></a><span id="l20.211">   }</span>
<a href="#l20.212"></a><span id="l20.212">   </span>
<a href="#l20.213"></a><span id="l20.213">   // check week view for 2 weeks</span>
<a href="#l20.214"></a><span id="l20.214" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l20.215"></a><span id="l20.215" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.216"></a><span id="l20.216" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l20.217"></a><span id="l20.217" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.218"></a><span id="l20.218">   </span>
<a href="#l20.219"></a><span id="l20.219">   for(let i = 0; i &lt;= 1; i++){</span>
<a href="#l20.220"></a><span id="l20.220" class="difflineminus">-    let day = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 1, undefined, controller)</span>
<a href="#l20.221"></a><span id="l20.221" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l20.222"></a><span id="l20.222">       + eventPath;</span>
<a href="#l20.223"></a><span id="l20.223">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.224"></a><span id="l20.224" class="difflineminus">-    day = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, undefined, controller)</span>
<a href="#l20.225"></a><span id="l20.225" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l20.226"></a><span id="l20.226">       + eventPath;</span>
<a href="#l20.227"></a><span id="l20.227">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.228"></a><span id="l20.228" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l20.229"></a><span id="l20.229" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l20.230"></a><span id="l20.230" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l20.231"></a><span id="l20.231">   }</span>
<a href="#l20.232"></a><span id="l20.232">   </span>
<a href="#l20.233"></a><span id="l20.233">   // check multiweek view for 4 weeks</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l20.235"></a><span id="l20.235" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.236"></a><span id="l20.236" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l20.237"></a><span id="l20.237" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.238"></a><span id="l20.238">   </span>
<a href="#l20.239"></a><span id="l20.239">   for(let i = 1; i &lt;= 4; i++){</span>
<a href="#l20.240"></a><span id="l20.240" class="difflineminus">-    let day = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i, 1, undefined, controller)</span>
<a href="#l20.241"></a><span id="l20.241" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l20.242"></a><span id="l20.242">       + eventPath;</span>
<a href="#l20.243"></a><span id="l20.243">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.244"></a><span id="l20.244" class="difflineminus">-    day = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, i, 7, undefined, controller)</span>
<a href="#l20.245"></a><span id="l20.245" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l20.246"></a><span id="l20.246">       + eventPath;</span>
<a href="#l20.247"></a><span id="l20.247">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.248"></a><span id="l20.248">   }</span>
<a href="#l20.249"></a><span id="l20.249">   </span>
<a href="#l20.250"></a><span id="l20.250">   // check month view for all 5 weeks</span>
<a href="#l20.251"></a><span id="l20.251" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l20.252"></a><span id="l20.252" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l20.253"></a><span id="l20.253" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l20.254"></a><span id="l20.254" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l20.255"></a><span id="l20.255">   </span>
<a href="#l20.256"></a><span id="l20.256">   for(let i = 1; i &lt;= 5; i++){</span>
<a href="#l20.257"></a><span id="l20.257" class="difflineminus">-    let day = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, i, 1, undefined, controller)</span>
<a href="#l20.258"></a><span id="l20.258" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l20.259"></a><span id="l20.259">       + eventPath;</span>
<a href="#l20.260"></a><span id="l20.260">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.261"></a><span id="l20.261" class="difflineminus">-    day = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, i, 7, undefined, controller)</span>
<a href="#l20.262"></a><span id="l20.262" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l20.263"></a><span id="l20.263">       + eventPath;</span>
<a href="#l20.264"></a><span id="l20.264">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.265"></a><span id="l20.265">   }</span>
<a href="#l20.266"></a><span id="l20.266">   </span>
<a href="#l20.267"></a><span id="l20.267">   // delete event</span>
<a href="#l20.268"></a><span id="l20.268" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l20.269"></a><span id="l20.269" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 1, 5, undefined, controller)</span>
<a href="#l20.270"></a><span id="l20.270" class="difflineminus">-      + eventPath));</span>
<a href="#l20.271"></a><span id="l20.271" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l20.272"></a><span id="l20.272" class="difflineplus">+  let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined)</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineplus">+    + eventPath</span>
<a href="#l20.274"></a><span id="l20.274" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.275"></a><span id="l20.275" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l20.276"></a><span id="l20.276">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l20.277"></a><span id="l20.277">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l20.278"></a><span id="l20.278" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l20.279"></a><span id="l20.279">   </span>
<a href="#l20.280"></a><span id="l20.280">   // reset view</span>
<a href="#l20.281"></a><span id="l20.281" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l20.282"></a><span id="l20.282" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l20.283"></a><span id="l20.283" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l20.284"></a><span id="l20.284" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l20.285"></a><span id="l20.285" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l20.286"></a><span id="l20.286" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l20.287"></a><span id="l20.287" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l20.288"></a><span id="l20.288"> }</span>
<a href="#l20.289"></a><span id="l20.289"> </span>
<a href="#l20.290"></a><span id="l20.290"> var teardownTest = function(module) {</span>
<a href="#l20.291"></a><span id="l20.291" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l20.292"></a><span id="l20.292" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l20.293"></a><span id="l20.293"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testLastDayOfMonthRecursion.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -29,56 +29,57 @@</span>
<a href="#l21.4"></a><span id="l21.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.5"></a><span id="l21.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.6"></a><span id="l21.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.7"></a><span id="l21.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.8"></a><span id="l21.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.9"></a><span id="l21.9">  *</span>
<a href="#l21.10"></a><span id="l21.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.11"></a><span id="l21.11">  </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+</span>
<a href="#l21.15"></a><span id="l21.15"> const sleep = 500;</span>
<a href="#l21.16"></a><span id="l21.16"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l21.17"></a><span id="l21.17"> var hour = 8;</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI'];</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">-</span>
<a href="#l21.22"></a><span id="l21.22"> var setupModule = function(module) {</span>
<a href="#l21.23"></a><span id="l21.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l21.26"></a><span id="l21.26"> }</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28"> var testLastDayOfMonthRecursion = function () {</span>
<a href="#l21.29"></a><span id="l21.29">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l21.30"></a><span id="l21.30">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+  calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l21.34"></a><span id="l21.34">   </span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l21.36"></a><span id="l21.36">   // rotate view</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-  CalendarUtils.goToDate(2008, 1, 31, controller); // start with a leap year</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l21.43"></a><span id="l21.43">   </span>
<a href="#l21.44"></a><span id="l21.44">   // create monthly recurring event</span>
<a href="#l21.45"></a><span id="l21.45">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour,</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-      controller)));</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l21.51"></a><span id="l21.51">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l21.52"></a><span id="l21.52">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l21.54"></a><span id="l21.54">   </span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-  md.start();</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l21.60"></a><span id="l21.60">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l21.61"></a><span id="l21.61">     &quot;custom&quot;);</span>
<a href="#l21.62"></a><span id="l21.62">   </span>
<a href="#l21.63"></a><span id="l21.63">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l21.66"></a><span id="l21.66">   </span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-  //                        date     correct row in month view      </span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+  //                        date     correct row in month view</span>
<a href="#l21.69"></a><span id="l21.69">   let checkingData = [[2008,  1, 31, 5],</span>
<a href="#l21.70"></a><span id="l21.70">                       [2008,  2, 29, 5],</span>
<a href="#l21.71"></a><span id="l21.71">                       [2008,  3, 31, 6],</span>
<a href="#l21.72"></a><span id="l21.72">                       [2008,  4, 30, 5],</span>
<a href="#l21.73"></a><span id="l21.73">                       [2008,  5, 31, 5],</span>
<a href="#l21.74"></a><span id="l21.74">                       [2008,  6, 30, 5],</span>
<a href="#l21.75"></a><span id="l21.75">                       [2008,  7, 31, 5],</span>
<a href="#l21.76"></a><span id="l21.76">                       [2008,  8, 31, 6],</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineat">@@ -88,57 +89,61 @@ var testLastDayOfMonthRecursion = functi</span>
<a href="#l21.78"></a><span id="l21.78">                       [2008, 12, 31, 5],</span>
<a href="#l21.79"></a><span id="l21.79">                       [2009,  1, 31, 5],</span>
<a href="#l21.80"></a><span id="l21.80">                       [2009,  2, 28, 4],</span>
<a href="#l21.81"></a><span id="l21.81">                       [2009,  3, 31, 5]];</span>
<a href="#l21.82"></a><span id="l21.82">   let box = &quot;&quot;;</span>
<a href="#l21.83"></a><span id="l21.83">   </span>
<a href="#l21.84"></a><span id="l21.84">   // check all dates</span>
<a href="#l21.85"></a><span id="l21.85">   for(let i = 0; i &lt; checkingData.length; i++){</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">-    CalendarUtils.goToDate(checkingData[i][0], checkingData[i][1], checkingData[i][2], controller);</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+    calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l21.88"></a><span id="l21.88">     </span>
<a href="#l21.89"></a><span id="l21.89">     // day view</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-    CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour,</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+      + eventPath;</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.98"></a><span id="l21.98">     </span>
<a href="#l21.99"></a><span id="l21.99">     // week view</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-    CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l21.102"></a><span id="l21.102">     let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l21.103"></a><span id="l21.103">     let column = date.getDay() + 1;</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, column, hour,</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour)</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineplus">+      + eventPath;</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.110"></a><span id="l21.110">     </span>
<a href="#l21.111"></a><span id="l21.111">     // multiweek view</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineminus">-    CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;multiweek&quot;, CalendarUtils.EVENT_BOX, 1, column, undefined,</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineminus">-      controller) + eventPath;</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined)</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+      + eventPath;</span>
<a href="#l21.118"></a><span id="l21.118">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.119"></a><span id="l21.119">     </span>
<a href="#l21.120"></a><span id="l21.120">     // month view</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-    CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineminus">-      column, undefined, controller) + eventPath;</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineplus">+      column, undefined) + eventPath;</span>
<a href="#l21.127"></a><span id="l21.127">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.128"></a><span id="l21.128">   }</span>
<a href="#l21.129"></a><span id="l21.129">   </span>
<a href="#l21.130"></a><span id="l21.130">   // delete event</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineminus">-  CalendarUtils.goToDate(checkingData[0][0], checkingData[0][1], checkingData[0][2], controller);</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX,</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineminus">-    undefined, 1, hour, controller) + eventPath;</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineplus">+  calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineplus">+    undefined, 1, hour) + eventPath;</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineplus">+  calUtils.handleParentDeletion(false);</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.143"></a><span id="l21.143">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l21.144"></a><span id="l21.144">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l21.146"></a><span id="l21.146">   </span>
<a href="#l21.147"></a><span id="l21.147">   // reset view</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l21.153"></a><span id="l21.153"> }</span>
<a href="#l21.154"></a><span id="l21.154"> </span>
<a href="#l21.155"></a><span id="l21.155"> function setRecurrence(recurrence){</span>
<a href="#l21.156"></a><span id="l21.156">   recurrence.sleep(sleep);</span>
<a href="#l21.157"></a><span id="l21.157">   </span>
<a href="#l21.158"></a><span id="l21.158">   // monthly</span>
<a href="#l21.159"></a><span id="l21.159">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l21.160"></a><span id="l21.160">     undefined, &quot;2&quot;);</span>
<a href="#l21.161"></a><span id="l21.161" class="difflineat">@@ -154,10 +159,10 @@ function setRecurrence(recurrence){</span>
<a href="#l21.162"></a><span id="l21.162">   recurrence.sleep(sleep);</span>
<a href="#l21.163"></a><span id="l21.163">   </span>
<a href="#l21.164"></a><span id="l21.164">   // close dialog</span>
<a href="#l21.165"></a><span id="l21.165">   recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l21.166"></a><span id="l21.166">     '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l21.167"></a><span id="l21.167"> }</span>
<a href="#l21.168"></a><span id="l21.168"> </span>
<a href="#l21.169"></a><span id="l21.169"> var teardownTest = function(module) {</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l21.171"></a><span id="l21.171" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l21.172"></a><span id="l21.172"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testWeeklyNRecursion.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -29,114 +29,120 @@</span>
<a href="#l22.4"></a><span id="l22.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.5"></a><span id="l22.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l22.6"></a><span id="l22.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l22.7"></a><span id="l22.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.8"></a><span id="l22.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.9"></a><span id="l22.9">  *</span>
<a href="#l22.10"></a><span id="l22.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+</span>
<a href="#l22.16"></a><span id="l22.16"> const sleep = 500;</span>
<a href="#l22.17"></a><span id="l22.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l22.18"></a><span id="l22.18"> var hour = 8;</span>
<a href="#l22.19"></a><span id="l22.19"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">-</span>
<a href="#l22.24"></a><span id="l22.24"> var setupModule = function(module) {</span>
<a href="#l22.25"></a><span id="l22.25">   controller = mozmill.getMail3PaneController();</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l22.28"></a><span id="l22.28"> }</span>
<a href="#l22.29"></a><span id="l22.29"> </span>
<a href="#l22.30"></a><span id="l22.30"> var testWeeklyNRecursion = function () {</span>
<a href="#l22.31"></a><span id="l22.31">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l22.35"></a><span id="l22.35">   </span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l22.37"></a><span id="l22.37">   // rotate view</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l22.44"></a><span id="l22.44">   </span>
<a href="#l22.45"></a><span id="l22.45">   // create weekly recurring event</span>
<a href="#l22.46"></a><span id="l22.46">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l22.51"></a><span id="l22.51">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l22.53"></a><span id="l22.53">   </span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-  md.start();</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l22.59"></a><span id="l22.59">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l22.60"></a><span id="l22.60">   </span>
<a href="#l22.61"></a><span id="l22.61">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+  </span>
<a href="#l22.64"></a><span id="l22.64">   </span>
<a href="#l22.65"></a><span id="l22.65">   // check day view</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l22.68"></a><span id="l22.68">     + eventPath;</span>
<a href="#l22.69"></a><span id="l22.69">   </span>
<a href="#l22.70"></a><span id="l22.70">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l22.71"></a><span id="l22.71">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l22.72"></a><span id="l22.72">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineminus">-    CalendarUtils.forward(1);</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l22.75"></a><span id="l22.75">   }</span>
<a href="#l22.76"></a><span id="l22.76">   </span>
<a href="#l22.77"></a><span id="l22.77">   // Saturday</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l22.80"></a><span id="l22.80">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.81"></a><span id="l22.81">   </span>
<a href="#l22.82"></a><span id="l22.82">   // check week view</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l22.85"></a><span id="l22.85">   </span>
<a href="#l22.86"></a><span id="l22.86">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l22.87"></a><span id="l22.87">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, i, hour, controller)</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour)</span>
<a href="#l22.90"></a><span id="l22.90">       + eventPath;</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.93"></a><span id="l22.93">   }</span>
<a href="#l22.94"></a><span id="l22.94">   </span>
<a href="#l22.95"></a><span id="l22.95">   // Saturday</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller)</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l22.98"></a><span id="l22.98">     + eventPath;</span>
<a href="#l22.99"></a><span id="l22.99">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.100"></a><span id="l22.100">   </span>
<a href="#l22.101"></a><span id="l22.101">   // check multiweek view</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l22.104"></a><span id="l22.104">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l22.105"></a><span id="l22.105">   </span>
<a href="#l22.106"></a><span id="l22.106">   // check month view</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l22.109"></a><span id="l22.109">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l22.110"></a><span id="l22.110">   </span>
<a href="#l22.111"></a><span id="l22.111">   // delete event</span>
<a href="#l22.112"></a><span id="l22.112" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 2, hour, controller)</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineminus">-      + eventPath));</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l22.116"></a><span id="l22.116" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour)</span>
<a href="#l22.117"></a><span id="l22.117" class="difflineplus">+    + eventPath;</span>
<a href="#l22.118"></a><span id="l22.118" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.119"></a><span id="l22.119" class="difflineplus">+  calUtils.handleParentDeletion(false);</span>
<a href="#l22.120"></a><span id="l22.120">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l22.121"></a><span id="l22.121">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.123"></a><span id="l22.123">   </span>
<a href="#l22.124"></a><span id="l22.124">   // reset view</span>
<a href="#l22.125"></a><span id="l22.125" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l22.128"></a><span id="l22.128" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l22.129"></a><span id="l22.129" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l22.130"></a><span id="l22.130" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l22.131"></a><span id="l22.131" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l22.132"></a><span id="l22.132"> }</span>
<a href="#l22.133"></a><span id="l22.133"> </span>
<a href="#l22.134"></a><span id="l22.134"> function setRecurrence(recurrence){</span>
<a href="#l22.135"></a><span id="l22.135" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineminus">-  </span>
<a href="#l22.137"></a><span id="l22.137">   // weekly</span>
<a href="#l22.138"></a><span id="l22.138" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l22.139"></a><span id="l22.139">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l22.140"></a><span id="l22.140">   recurrence.sleep(sleep);</span>
<a href="#l22.141"></a><span id="l22.141">   </span>
<a href="#l22.142"></a><span id="l22.142" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l22.143"></a><span id="l22.143" class="difflineminus">-  let tue = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l22.144"></a><span id="l22.144" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l22.145"></a><span id="l22.145" class="difflineminus">-  let thu = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l22.146"></a><span id="l22.146" class="difflineminus">-  let sat = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l22.147"></a><span id="l22.147" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l22.148"></a><span id="l22.148" class="difflineplus">+  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l22.149"></a><span id="l22.149" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l22.150"></a><span id="l22.150" class="difflineplus">+  let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l22.151"></a><span id="l22.151" class="difflineplus">+  let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l22.152"></a><span id="l22.152">   </span>
<a href="#l22.153"></a><span id="l22.153">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l22.154"></a><span id="l22.154">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l22.155"></a><span id="l22.155">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l22.156"></a><span id="l22.156">   </span>
<a href="#l22.157"></a><span id="l22.157">   // starting from Monday so it should be checked</span>
<a href="#l22.158"></a><span id="l22.158">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l22.159"></a><span id="l22.159">   // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l22.160"></a><span id="l22.160" class="difflineat">@@ -145,40 +151,39 @@ function setRecurrence(recurrence){</span>
<a href="#l22.161"></a><span id="l22.161">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l22.162"></a><span id="l22.162">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l22.163"></a><span id="l22.163">   </span>
<a href="#l22.164"></a><span id="l22.164">   // set number of occurrences</span>
<a href="#l22.165"></a><span id="l22.165">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l22.166"></a><span id="l22.166">   let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/'</span>
<a href="#l22.167"></a><span id="l22.167">     + 'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/'</span>
<a href="#l22.168"></a><span id="l22.168">     + 'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l22.169"></a><span id="l22.169" class="difflineminus">-  // delete previous number</span>
<a href="#l22.170"></a><span id="l22.170" class="difflineplus">+  // replace previous number</span>
<a href="#l22.171"></a><span id="l22.171">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l22.172"></a><span id="l22.172" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l22.173"></a><span id="l22.173">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l22.174"></a><span id="l22.174">     </span>
<a href="#l22.175"></a><span id="l22.175">   // close dialog</span>
<a href="#l22.176"></a><span id="l22.176">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l22.177"></a><span id="l22.177">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l22.178"></a><span id="l22.178"> }</span>
<a href="#l22.179"></a><span id="l22.179"> </span>
<a href="#l22.180"></a><span id="l22.180"> function checkMultiWeekView(view){</span>
<a href="#l22.181"></a><span id="l22.181">   let week = 1;</span>
<a href="#l22.182"></a><span id="l22.182">   </span>
<a href="#l22.183"></a><span id="l22.183">   // in month view event starts from 2nd row</span>
<a href="#l22.184"></a><span id="l22.184">   if(view == &quot;month&quot;) week++;</span>
<a href="#l22.185"></a><span id="l22.185"> </span>
<a href="#l22.186"></a><span id="l22.186">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l22.187"></a><span id="l22.187">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l22.188"></a><span id="l22.188" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, i, undefined, controller)</span>
<a href="#l22.189"></a><span id="l22.189" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined)</span>
<a href="#l22.190"></a><span id="l22.190">       + eventPath;</span>
<a href="#l22.191"></a><span id="l22.191">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.192"></a><span id="l22.192">   }</span>
<a href="#l22.193"></a><span id="l22.193">   </span>
<a href="#l22.194"></a><span id="l22.194">   // Saturday</span>
<a href="#l22.195"></a><span id="l22.195" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 7, undefined, controller)</span>
<a href="#l22.196"></a><span id="l22.196" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined)</span>
<a href="#l22.197"></a><span id="l22.197">     + eventPath;</span>
<a href="#l22.198"></a><span id="l22.198">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l22.199"></a><span id="l22.199"> }</span>
<a href="#l22.200"></a><span id="l22.200"> </span>
<a href="#l22.201"></a><span id="l22.201"> var teardownTest = function(module) {</span>
<a href="#l22.202"></a><span id="l22.202" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l22.203"></a><span id="l22.203" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l22.204"></a><span id="l22.204"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testWeeklyUntilRecursion.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -29,138 +29,144 @@</span>
<a href="#l23.4"></a><span id="l23.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l23.5"></a><span id="l23.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l23.6"></a><span id="l23.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l23.7"></a><span id="l23.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l23.8"></a><span id="l23.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l23.9"></a><span id="l23.9">  *</span>
<a href="#l23.10"></a><span id="l23.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l23.11"></a><span id="l23.11">  </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+</span>
<a href="#l23.16"></a><span id="l23.16"> const sleep = 500;</span>
<a href="#l23.17"></a><span id="l23.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l23.18"></a><span id="l23.18"> var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l23.19"></a><span id="l23.19"> var hour = 8;</span>
<a href="#l23.20"></a><span id="l23.20"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-</span>
<a href="#l23.25"></a><span id="l23.25"> var setupModule = function(module) {</span>
<a href="#l23.26"></a><span id="l23.26">   controller = mozmill.getMail3PaneController();</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l23.29"></a><span id="l23.29"> }</span>
<a href="#l23.30"></a><span id="l23.30"> </span>
<a href="#l23.31"></a><span id="l23.31"> var testWeeklyUntilRecursion = function () {</span>
<a href="#l23.32"></a><span id="l23.32">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l23.36"></a><span id="l23.36">   </span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l23.38"></a><span id="l23.38">   // rotate view</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller); // Monday</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l23.45"></a><span id="l23.45">   </span>
<a href="#l23.46"></a><span id="l23.46">   // create weekly recurring event</span>
<a href="#l23.47"></a><span id="l23.47">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l23.52"></a><span id="l23.52">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l23.54"></a><span id="l23.54">   </span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineminus">-  md.start();</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l23.60"></a><span id="l23.60">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l23.61"></a><span id="l23.61">   </span>
<a href="#l23.62"></a><span id="l23.62">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l23.65"></a><span id="l23.65">   </span>
<a href="#l23.66"></a><span id="l23.66" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l23.67"></a><span id="l23.67" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l23.68"></a><span id="l23.68">     + eventPath;</span>
<a href="#l23.69"></a><span id="l23.69">   </span>
<a href="#l23.70"></a><span id="l23.70">   // check day view</span>
<a href="#l23.71"></a><span id="l23.71">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l23.72"></a><span id="l23.72">     // Monday</span>
<a href="#l23.73"></a><span id="l23.73">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-    CalendarUtils.forward(2);</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineplus">+    calUtils.forward(controller, 2);</span>
<a href="#l23.76"></a><span id="l23.76">     // Wednesday</span>
<a href="#l23.77"></a><span id="l23.77">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineminus">-    CalendarUtils.forward(2);</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineplus">+    calUtils.forward(controller, 2);</span>
<a href="#l23.80"></a><span id="l23.80">     // Friday</span>
<a href="#l23.81"></a><span id="l23.81">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-    CalendarUtils.forward(3);</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineplus">+    calUtils.forward(controller, 3);</span>
<a href="#l23.84"></a><span id="l23.84">   }</span>
<a href="#l23.85"></a><span id="l23.85">   </span>
<a href="#l23.86"></a><span id="l23.86">   // Monday, last occurrence</span>
<a href="#l23.87"></a><span id="l23.87">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineminus">-  CalendarUtils.forward(2);</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineplus">+  calUtils.forward(controller, 2);</span>
<a href="#l23.90"></a><span id="l23.90">   // Wednesday</span>
<a href="#l23.91"></a><span id="l23.91">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-  CalendarUtils.forward(2);</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+  calUtils.forward(controller, 2);</span>
<a href="#l23.94"></a><span id="l23.94">   </span>
<a href="#l23.95"></a><span id="l23.95">   // check week view</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l23.100"></a><span id="l23.100">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l23.101"></a><span id="l23.101">     // Monday</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller)</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l23.104"></a><span id="l23.104">       + eventPath;</span>
<a href="#l23.105"></a><span id="l23.105">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.106"></a><span id="l23.106">     // Wednesday</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller)</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l23.109"></a><span id="l23.109">       + eventPath;</span>
<a href="#l23.110"></a><span id="l23.110">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.111"></a><span id="l23.111">     // Friday</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 6, hour, controller)</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour)</span>
<a href="#l23.114"></a><span id="l23.114">       + eventPath;</span>
<a href="#l23.115"></a><span id="l23.115">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.116"></a><span id="l23.116">     </span>
<a href="#l23.117"></a><span id="l23.117" class="difflineminus">-    CalendarUtils.forward(1);</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l23.119"></a><span id="l23.119">   }</span>
<a href="#l23.120"></a><span id="l23.120">   </span>
<a href="#l23.121"></a><span id="l23.121">   // Monday, last occurrence</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller)</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l23.124"></a><span id="l23.124">     + eventPath;</span>
<a href="#l23.125"></a><span id="l23.125">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.126"></a><span id="l23.126">   // Wednesday</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller)</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l23.129"></a><span id="l23.129">     + eventPath;</span>
<a href="#l23.130"></a><span id="l23.130">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.131"></a><span id="l23.131">   </span>
<a href="#l23.132"></a><span id="l23.132">   // check multiweek view</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l23.135"></a><span id="l23.135" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l23.137"></a><span id="l23.137">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l23.138"></a><span id="l23.138">   </span>
<a href="#l23.139"></a><span id="l23.139">   // check month view</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l23.144"></a><span id="l23.144">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l23.145"></a><span id="l23.145">   </span>
<a href="#l23.146"></a><span id="l23.146">   // delete event</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;month&quot;, CalendarUtils.EVENT_BOX, 2, 2, undefined, controller)</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineminus">-      + eventPath));</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l23.151"></a><span id="l23.151" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined)</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineplus">+    + eventPath;</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l23.155"></a><span id="l23.155">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l23.156"></a><span id="l23.156">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l23.157"></a><span id="l23.157" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.158"></a><span id="l23.158">   </span>
<a href="#l23.159"></a><span id="l23.159">   // reset view</span>
<a href="#l23.160"></a><span id="l23.160" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l23.166"></a><span id="l23.166" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l23.167"></a><span id="l23.167"> }</span>
<a href="#l23.168"></a><span id="l23.168"> </span>
<a href="#l23.169"></a><span id="l23.169"> function setRecurrence(recurrence){</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l23.171"></a><span id="l23.171" class="difflineminus">-  </span>
<a href="#l23.172"></a><span id="l23.172">   // weekly</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l23.174"></a><span id="l23.174">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l23.175"></a><span id="l23.175">   recurrence.sleep(sleep);</span>
<a href="#l23.176"></a><span id="l23.176">   </span>
<a href="#l23.177"></a><span id="l23.177" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l23.178"></a><span id="l23.178" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l23.179"></a><span id="l23.179" class="difflineminus">-  let fri = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l23.180"></a><span id="l23.180" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l23.181"></a><span id="l23.181" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l23.182"></a><span id="l23.182" class="difflineplus">+  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l23.183"></a><span id="l23.183">   </span>
<a href="#l23.184"></a><span id="l23.184">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l23.185"></a><span id="l23.185">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l23.186"></a><span id="l23.186">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l23.187"></a><span id="l23.187">   </span>
<a href="#l23.188"></a><span id="l23.188">   // starting from Monday so it should be checked</span>
<a href="#l23.189"></a><span id="l23.189">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l23.190"></a><span id="l23.190">   // check Wednesday and Friday too</span>
<a href="#l23.191"></a><span id="l23.191" class="difflineat">@@ -176,50 +182,50 @@ function setRecurrence(recurrence){</span>
<a href="#l23.192"></a><span id="l23.192">   // delete previous date</span>
<a href="#l23.193"></a><span id="l23.193">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l23.194"></a><span id="l23.194">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l23.195"></a><span id="l23.195">   </span>
<a href="#l23.196"></a><span id="l23.196">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l23.197"></a><span id="l23.197">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l23.198"></a><span id="l23.198">   let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l23.199"></a><span id="l23.199">                                              endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l23.200"></a><span id="l23.200" class="difflineminus">-	</span>
<a href="#l23.201"></a><span id="l23.201" class="difflineplus">+  </span>
<a href="#l23.202"></a><span id="l23.202">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l23.203"></a><span id="l23.203">   </span>
<a href="#l23.204"></a><span id="l23.204">   // close dialog</span>
<a href="#l23.205"></a><span id="l23.205">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l23.206"></a><span id="l23.206">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l23.207"></a><span id="l23.207"> }</span>
<a href="#l23.208"></a><span id="l23.208"> </span>
<a href="#l23.209"></a><span id="l23.209"> function checkMultiWeekView(view){</span>
<a href="#l23.210"></a><span id="l23.210">   let startWeek = 1;</span>
<a href="#l23.211"></a><span id="l23.211">   </span>
<a href="#l23.212"></a><span id="l23.212">   // in month view event starts from 2nd row</span>
<a href="#l23.213"></a><span id="l23.213">   if(view == &quot;month&quot;) startWeek++;</span>
<a href="#l23.214"></a><span id="l23.214"> </span>
<a href="#l23.215"></a><span id="l23.215">   for(let week = startWeek; week &lt; startWeek + 3; week++){</span>
<a href="#l23.216"></a><span id="l23.216">     // Monday</span>
<a href="#l23.217"></a><span id="l23.217" class="difflineminus">-    let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 2, undefined, controller)</span>
<a href="#l23.218"></a><span id="l23.218" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined)</span>
<a href="#l23.219"></a><span id="l23.219">       + eventPath;</span>
<a href="#l23.220"></a><span id="l23.220">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.221"></a><span id="l23.221">     // Wednesday</span>
<a href="#l23.222"></a><span id="l23.222" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 4, undefined, controller)</span>
<a href="#l23.223"></a><span id="l23.223" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined)</span>
<a href="#l23.224"></a><span id="l23.224">       + eventPath;</span>
<a href="#l23.225"></a><span id="l23.225">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.226"></a><span id="l23.226">     // Friday</span>
<a href="#l23.227"></a><span id="l23.227" class="difflineminus">-    box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, week, 6, undefined, controller)</span>
<a href="#l23.228"></a><span id="l23.228" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined)</span>
<a href="#l23.229"></a><span id="l23.229">       + eventPath;</span>
<a href="#l23.230"></a><span id="l23.230">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.231"></a><span id="l23.231">   }</span>
<a href="#l23.232"></a><span id="l23.232">   </span>
<a href="#l23.233"></a><span id="l23.233">   // Monday, last occurrence</span>
<a href="#l23.234"></a><span id="l23.234" class="difflineminus">-  let box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 3, 2, </span>
<a href="#l23.235"></a><span id="l23.235" class="difflineminus">-    undefined, controller) + eventPath;</span>
<a href="#l23.236"></a><span id="l23.236" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2, </span>
<a href="#l23.237"></a><span id="l23.237" class="difflineplus">+    undefined) + eventPath;</span>
<a href="#l23.238"></a><span id="l23.238">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.239"></a><span id="l23.239">   // Wednesday</span>
<a href="#l23.240"></a><span id="l23.240" class="difflineminus">-  box = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l23.241"></a><span id="l23.241" class="difflineminus">-    undefined, controller) + eventPath;</span>
<a href="#l23.242"></a><span id="l23.242" class="difflineplus">+  box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l23.243"></a><span id="l23.243" class="difflineplus">+    undefined) + eventPath;</span>
<a href="#l23.244"></a><span id="l23.244">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l23.245"></a><span id="l23.245"> }</span>
<a href="#l23.246"></a><span id="l23.246"> </span>
<a href="#l23.247"></a><span id="l23.247"> var teardownTest = function(module) {</span>
<a href="#l23.248"></a><span id="l23.248" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l23.249"></a><span id="l23.249" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l23.250"></a><span id="l23.250"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/test/mozmill/testRecursionRotated/testWeeklyWithExceptionRecursion.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -29,59 +29,61 @@</span>
<a href="#l24.4"></a><span id="l24.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.5"></a><span id="l24.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l24.6"></a><span id="l24.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.7"></a><span id="l24.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.8"></a><span id="l24.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.9"></a><span id="l24.9">  *</span>
<a href="#l24.10"></a><span id="l24.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+</span>
<a href="#l24.16"></a><span id="l24.16"> const sleep = 500;</span>
<a href="#l24.17"></a><span id="l24.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l24.18"></a><span id="l24.18"> var hour = 8;</span>
<a href="#l24.19"></a><span id="l24.19"> var startDate = new Date(2009, 0, 6);</span>
<a href="#l24.20"></a><span id="l24.20"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l24.21"></a><span id="l24.21"> </span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'UtilsAPI'];</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-</span>
<a href="#l24.25"></a><span id="l24.25"> var setupModule = function(module) {</span>
<a href="#l24.26"></a><span id="l24.26">   controller = mozmill.getMail3PaneController();</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l24.29"></a><span id="l24.29"> }</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31"> var testWeeklyWithExceptionRecursion = function () {</span>
<a href="#l24.32"></a><span id="l24.32">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l24.36"></a><span id="l24.36">   </span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l24.38"></a><span id="l24.38">   // rotate view</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    return view.orient == &quot;horizontal&quot;});</span>
<a href="#l24.45"></a><span id="l24.45">   </span>
<a href="#l24.46"></a><span id="l24.46">   // create weekly recurring event</span>
<a href="#l24.47"></a><span id="l24.47">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, hour, controller)));</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l24.52"></a><span id="l24.52">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l24.54"></a><span id="l24.54">   </span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(setRecurrence);</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-  md.start();</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+  md.start(setRecurrence);</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l24.60"></a><span id="l24.60">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l24.61"></a><span id="l24.61">   </span>
<a href="#l24.62"></a><span id="l24.62">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l24.64"></a><span id="l24.64">   </span>
<a href="#l24.65"></a><span id="l24.65">   // move 5th January occurrence to 6th January</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineminus">-  CalendarUtils.handleOccurrenceModification(false);</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineplus">+  calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l24.68"></a><span id="l24.68">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l24.71"></a><span id="l24.71">       + eventPath));</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l24.74"></a><span id="l24.74">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l24.75"></a><span id="l24.75">   event.sleep(sleep);</span>
<a href="#l24.76"></a><span id="l24.76">   </span>
<a href="#l24.77"></a><span id="l24.77">   let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l24.78"></a><span id="l24.78">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/'</span>
<a href="#l24.79"></a><span id="l24.79">     + 'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/'</span>
<a href="#l24.80"></a><span id="l24.80">     + 'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l24.81"></a><span id="l24.81">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineat">@@ -98,162 +100,165 @@ var testWeeklyWithExceptionRecursion = f</span>
<a href="#l24.83"></a><span id="l24.83">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l24.84"></a><span id="l24.84">   let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l24.85"></a><span id="l24.85">                                              startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l24.86"></a><span id="l24.86">   event.type(startDateInput, startDateString);</span>
<a href="#l24.87"></a><span id="l24.87">   // applies startdate change</span>
<a href="#l24.88"></a><span id="l24.88">   event.click(endDateInput);</span>
<a href="#l24.89"></a><span id="l24.89"> </span>
<a href="#l24.90"></a><span id="l24.90">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l24.93"></a><span id="l24.93">   </span>
<a href="#l24.94"></a><span id="l24.94">   // change recurrence rule</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 7, controller);</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineminus">-  CalendarUtils.handleParentModification(false);</span>
<a href="#l24.97"></a><span id="l24.97" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l24.98"></a><span id="l24.98" class="difflineplus">+  calUtils.handleParentModification(controller, false);</span>
<a href="#l24.99"></a><span id="l24.99">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.100"></a><span id="l24.100" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l24.102"></a><span id="l24.102">       + eventPath));</span>
<a href="#l24.103"></a><span id="l24.103" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l24.104"></a><span id="l24.104" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l24.105"></a><span id="l24.105">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l24.107"></a><span id="l24.107">   </span>
<a href="#l24.108"></a><span id="l24.108" class="difflineminus">-  let md = new ModalDialogAPI.modalDialog(changeRecurrence);</span>
<a href="#l24.109"></a><span id="l24.109" class="difflineminus">-  md.start();</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineplus">+  let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l24.111"></a><span id="l24.111" class="difflineplus">+  md.start(changeRecurrence);</span>
<a href="#l24.112"></a><span id="l24.112" class="difflineplus">+  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l24.113"></a><span id="l24.113">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l24.114"></a><span id="l24.114">   </span>
<a href="#l24.115"></a><span id="l24.115">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l24.118"></a><span id="l24.118">   </span>
<a href="#l24.119"></a><span id="l24.119">   // check two weeks</span>
<a href="#l24.120"></a><span id="l24.120">   // day view</span>
<a href="#l24.121"></a><span id="l24.121" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineminus">-  let path = CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l24.123"></a><span id="l24.123" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineplus">+  let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l24.125"></a><span id="l24.125">     + eventPath;</span>
<a href="#l24.126"></a><span id="l24.126">   </span>
<a href="#l24.127"></a><span id="l24.127" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l24.128"></a><span id="l24.128" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l24.129"></a><span id="l24.129">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.130"></a><span id="l24.130">   </span>
<a href="#l24.131"></a><span id="l24.131" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.132"></a><span id="l24.132" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.133"></a><span id="l24.133">   let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l24.134"></a><span id="l24.134">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l24.135"></a><span id="l24.135">     + 'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l24.136"></a><span id="l24.136">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l24.137"></a><span id="l24.137">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l24.138"></a><span id="l24.138">   // assert exactly two</span>
<a href="#l24.139"></a><span id="l24.139">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.140"></a><span id="l24.140">     tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l24.141"></a><span id="l24.141">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.142"></a><span id="l24.142">     tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l24.143"></a><span id="l24.143">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.144"></a><span id="l24.144">     tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l24.145"></a><span id="l24.145">   </span>
<a href="#l24.146"></a><span id="l24.146" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.147"></a><span id="l24.147" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.148"></a><span id="l24.148">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.149"></a><span id="l24.149" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.150"></a><span id="l24.150" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.151"></a><span id="l24.151">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.153"></a><span id="l24.153" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.154"></a><span id="l24.154">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.155"></a><span id="l24.155" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.156"></a><span id="l24.156" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.157"></a><span id="l24.157">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.158"></a><span id="l24.158" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.159"></a><span id="l24.159" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.160"></a><span id="l24.160">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.161"></a><span id="l24.161">   </span>
<a href="#l24.162"></a><span id="l24.162">   // next week</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.165"></a><span id="l24.165">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.167"></a><span id="l24.167" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.168"></a><span id="l24.168">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.169"></a><span id="l24.169" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.170"></a><span id="l24.170" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.171"></a><span id="l24.171">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.172"></a><span id="l24.172" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.173"></a><span id="l24.173" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.174"></a><span id="l24.174">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.175"></a><span id="l24.175" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.176"></a><span id="l24.176" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.177"></a><span id="l24.177">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.178"></a><span id="l24.178" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.179"></a><span id="l24.179" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.180"></a><span id="l24.180">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.181"></a><span id="l24.181">   </span>
<a href="#l24.182"></a><span id="l24.182">   // week view</span>
<a href="#l24.183"></a><span id="l24.183" class="difflineminus">-  CalendarUtils.switchToView(&quot;week&quot;, controller);</span>
<a href="#l24.184"></a><span id="l24.184" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l24.185"></a><span id="l24.185" class="difflineplus">+  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l24.187"></a><span id="l24.187">   </span>
<a href="#l24.188"></a><span id="l24.188" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller)</span>
<a href="#l24.189"></a><span id="l24.189" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l24.190"></a><span id="l24.190">     + eventPath;</span>
<a href="#l24.191"></a><span id="l24.191">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.192"></a><span id="l24.192">   </span>
<a href="#l24.193"></a><span id="l24.193">   tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l24.194"></a><span id="l24.194">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l24.195"></a><span id="l24.195">     + 'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l24.196"></a><span id="l24.196">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l24.197"></a><span id="l24.197">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l24.198"></a><span id="l24.198">   // assert exactly two</span>
<a href="#l24.199"></a><span id="l24.199">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.200"></a><span id="l24.200">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l24.201"></a><span id="l24.201">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.202"></a><span id="l24.202">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l24.203"></a><span id="l24.203">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.204"></a><span id="l24.204">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l24.205"></a><span id="l24.205">   </span>
<a href="#l24.206"></a><span id="l24.206" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller);</span>
<a href="#l24.207"></a><span id="l24.207" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l24.208"></a><span id="l24.208">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.209"></a><span id="l24.209" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 5, hour, controller);</span>
<a href="#l24.210"></a><span id="l24.210" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l24.211"></a><span id="l24.211">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.212"></a><span id="l24.212" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 6, hour, controller);</span>
<a href="#l24.213"></a><span id="l24.213" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l24.214"></a><span id="l24.214">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.215"></a><span id="l24.215" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller);</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l24.217"></a><span id="l24.217">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.218"></a><span id="l24.218">   </span>
<a href="#l24.219"></a><span id="l24.219" class="difflineminus">-  CalendarUtils.forward(1);</span>
<a href="#l24.220"></a><span id="l24.220" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller);</span>
<a href="#l24.221"></a><span id="l24.221" class="difflineplus">+  calUtils.forward(controller, 1);</span>
<a href="#l24.222"></a><span id="l24.222" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l24.223"></a><span id="l24.223">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.224"></a><span id="l24.224" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 2, hour, controller);</span>
<a href="#l24.225"></a><span id="l24.225" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l24.226"></a><span id="l24.226">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.227"></a><span id="l24.227" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 3, hour, controller);</span>
<a href="#l24.228"></a><span id="l24.228" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l24.229"></a><span id="l24.229">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.230"></a><span id="l24.230" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 4, hour, controller);</span>
<a href="#l24.231"></a><span id="l24.231" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l24.232"></a><span id="l24.232">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.233"></a><span id="l24.233" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 5, hour, controller);</span>
<a href="#l24.234"></a><span id="l24.234" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l24.235"></a><span id="l24.235">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.236"></a><span id="l24.236" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 6, hour, controller);</span>
<a href="#l24.237"></a><span id="l24.237" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l24.238"></a><span id="l24.238">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.239"></a><span id="l24.239" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(&quot;week&quot;, CalendarUtils.EVENT_BOX, undefined, 7, hour, controller);</span>
<a href="#l24.240"></a><span id="l24.240" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l24.241"></a><span id="l24.241">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.242"></a><span id="l24.242">   </span>
<a href="#l24.243"></a><span id="l24.243">   // multiweek view</span>
<a href="#l24.244"></a><span id="l24.244" class="difflineminus">-  CalendarUtils.switchToView(&quot;multiweek&quot;, controller);</span>
<a href="#l24.245"></a><span id="l24.245" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 5, controller);</span>
<a href="#l24.246"></a><span id="l24.246" class="difflineplus">+  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l24.247"></a><span id="l24.247" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l24.248"></a><span id="l24.248">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l24.249"></a><span id="l24.249">   </span>
<a href="#l24.250"></a><span id="l24.250">   // month view</span>
<a href="#l24.251"></a><span id="l24.251" class="difflineminus">-  CalendarUtils.switchToView(&quot;month&quot;, controller);</span>
<a href="#l24.252"></a><span id="l24.252" class="difflineplus">+  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l24.253"></a><span id="l24.253">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l24.254"></a><span id="l24.254">   </span>
<a href="#l24.255"></a><span id="l24.255">   // delete event</span>
<a href="#l24.256"></a><span id="l24.256" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l24.257"></a><span id="l24.257" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 12, controller);</span>
<a href="#l24.258"></a><span id="l24.258" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.259"></a><span id="l24.259" class="difflineminus">-    CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, hour, controller)</span>
<a href="#l24.260"></a><span id="l24.260" class="difflineminus">-      + eventPath));</span>
<a href="#l24.261"></a><span id="l24.261" class="difflineminus">-  CalendarUtils.handleParentDeletion(false);</span>
<a href="#l24.262"></a><span id="l24.262" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.263"></a><span id="l24.263" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l24.264"></a><span id="l24.264" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l24.265"></a><span id="l24.265" class="difflineplus">+    + eventPath;</span>
<a href="#l24.266"></a><span id="l24.266" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.267"></a><span id="l24.267" class="difflineplus">+  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l24.268"></a><span id="l24.268">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l24.269"></a><span id="l24.269">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l24.270"></a><span id="l24.270" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l24.271"></a><span id="l24.271">   </span>
<a href="#l24.272"></a><span id="l24.272">   // reset view</span>
<a href="#l24.273"></a><span id="l24.273" class="difflineminus">-  controller.click(new elementslib.Elem(controller.menus.menu_View.ltnCalendarMenu.ltnCalendarCurrentViewMenu.ltnViewRotated));</span>
<a href="#l24.274"></a><span id="l24.274" class="difflineplus">+  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l24.275"></a><span id="l24.275" class="difflineplus">+  controller.waitFor(function() {</span>
<a href="#l24.276"></a><span id="l24.276" class="difflineplus">+    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l24.277"></a><span id="l24.277" class="difflineplus">+    return view.orient == &quot;vertical&quot;});</span>
<a href="#l24.278"></a><span id="l24.278"> }</span>
<a href="#l24.279"></a><span id="l24.279"> </span>
<a href="#l24.280"></a><span id="l24.280"> function setRecurrence(recurrence){</span>
<a href="#l24.281"></a><span id="l24.281" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l24.282"></a><span id="l24.282" class="difflineminus">-  </span>
<a href="#l24.283"></a><span id="l24.283">   // weekly</span>
<a href="#l24.284"></a><span id="l24.284" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l24.285"></a><span id="l24.285">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l24.286"></a><span id="l24.286">   recurrence.sleep(sleep);</span>
<a href="#l24.287"></a><span id="l24.287">   </span>
<a href="#l24.288"></a><span id="l24.288" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l24.289"></a><span id="l24.289" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l24.290"></a><span id="l24.290" class="difflineminus">-  let fri = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l24.291"></a><span id="l24.291" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l24.292"></a><span id="l24.292" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l24.293"></a><span id="l24.293" class="difflineplus">+  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l24.294"></a><span id="l24.294">   </span>
<a href="#l24.295"></a><span id="l24.295">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l24.296"></a><span id="l24.296">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l24.297"></a><span id="l24.297">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l24.298"></a><span id="l24.298">   </span>
<a href="#l24.299"></a><span id="l24.299">   // starting from Monday so it should be checked</span>
<a href="#l24.300"></a><span id="l24.300">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l24.301"></a><span id="l24.301">   // check Wednesday and Friday too</span>
<a href="#l24.302"></a><span id="l24.302" class="difflineat">@@ -261,26 +266,25 @@ function setRecurrence(recurrence){</span>
<a href="#l24.303"></a><span id="l24.303">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l24.304"></a><span id="l24.304">     </span>
<a href="#l24.305"></a><span id="l24.305">   // close dialog</span>
<a href="#l24.306"></a><span id="l24.306">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l24.307"></a><span id="l24.307">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l24.308"></a><span id="l24.308"> }</span>
<a href="#l24.309"></a><span id="l24.309"> </span>
<a href="#l24.310"></a><span id="l24.310"> function changeRecurrence(recurrence){</span>
<a href="#l24.311"></a><span id="l24.311" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l24.312"></a><span id="l24.312" class="difflineminus">-  </span>
<a href="#l24.313"></a><span id="l24.313">   // weekly</span>
<a href="#l24.314"></a><span id="l24.314" class="difflineplus">+  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l24.315"></a><span id="l24.315">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l24.316"></a><span id="l24.316">   recurrence.sleep(sleep);</span>
<a href="#l24.317"></a><span id="l24.317">   </span>
<a href="#l24.318"></a><span id="l24.318" class="difflineminus">-  let mon = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l24.319"></a><span id="l24.319" class="difflineminus">-  let tue = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l24.320"></a><span id="l24.320" class="difflineminus">-  let wed = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l24.321"></a><span id="l24.321" class="difflineminus">-  let fri = UtilsAPI.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l24.322"></a><span id="l24.322" class="difflineplus">+  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l24.323"></a><span id="l24.323" class="difflineplus">+  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l24.324"></a><span id="l24.324" class="difflineplus">+  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l24.325"></a><span id="l24.325" class="difflineplus">+  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l24.326"></a><span id="l24.326">   </span>
<a href="#l24.327"></a><span id="l24.327">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l24.328"></a><span id="l24.328">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l24.329"></a><span id="l24.329">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l24.330"></a><span id="l24.330">   </span>
<a href="#l24.331"></a><span id="l24.331">   // check old rule</span>
<a href="#l24.332"></a><span id="l24.332">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l24.333"></a><span id="l24.333">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l24.334"></a><span id="l24.334" class="difflineat">@@ -292,45 +296,45 @@ function changeRecurrence(recurrence){</span>
<a href="#l24.335"></a><span id="l24.335">   // close dialog</span>
<a href="#l24.336"></a><span id="l24.336">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l24.337"></a><span id="l24.337">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l24.338"></a><span id="l24.338"> }</span>
<a href="#l24.339"></a><span id="l24.339"> </span>
<a href="#l24.340"></a><span id="l24.340"> function checkMultiWeekView(view){</span>
<a href="#l24.341"></a><span id="l24.341">   let startWeek = view == &quot;multiweek&quot; ? 1 : 2</span>
<a href="#l24.342"></a><span id="l24.342"> </span>
<a href="#l24.343"></a><span id="l24.343" class="difflineminus">-  let path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 2, hour, controller);</span>
<a href="#l24.344"></a><span id="l24.344" class="difflineplus">+  let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l24.345"></a><span id="l24.345">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.346"></a><span id="l24.346">   // assert exactly two</span>
<a href="#l24.347"></a><span id="l24.347" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 3, hour, controller);</span>
<a href="#l24.348"></a><span id="l24.348" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l24.349"></a><span id="l24.349">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + '/[0]'));</span>
<a href="#l24.350"></a><span id="l24.350" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 3, hour, controller);</span>
<a href="#l24.351"></a><span id="l24.351" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l24.352"></a><span id="l24.352">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + '/[1]'));</span>
<a href="#l24.353"></a><span id="l24.353" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 3, hour, controller);</span>
<a href="#l24.354"></a><span id="l24.354" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l24.355"></a><span id="l24.355">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + '/[2]'));</span>
<a href="#l24.356"></a><span id="l24.356" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 4, hour, controller);</span>
<a href="#l24.357"></a><span id="l24.357" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l24.358"></a><span id="l24.358">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.359"></a><span id="l24.359" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 5, hour, controller);</span>
<a href="#l24.360"></a><span id="l24.360" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l24.361"></a><span id="l24.361">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.362"></a><span id="l24.362" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 6, hour, controller);</span>
<a href="#l24.363"></a><span id="l24.363" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l24.364"></a><span id="l24.364">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.365"></a><span id="l24.365" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek, 7, hour, controller);</span>
<a href="#l24.366"></a><span id="l24.366" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l24.367"></a><span id="l24.367">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.368"></a><span id="l24.368">   </span>
<a href="#l24.369"></a><span id="l24.369" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 1, hour, controller);</span>
<a href="#l24.370"></a><span id="l24.370" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l24.371"></a><span id="l24.371">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.372"></a><span id="l24.372" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 2, hour, controller);</span>
<a href="#l24.373"></a><span id="l24.373" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l24.374"></a><span id="l24.374">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.375"></a><span id="l24.375" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 3, hour, controller);</span>
<a href="#l24.376"></a><span id="l24.376" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l24.377"></a><span id="l24.377">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.378"></a><span id="l24.378" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 4, hour, controller);</span>
<a href="#l24.379"></a><span id="l24.379" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l24.380"></a><span id="l24.380">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.381"></a><span id="l24.381" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 5, hour, controller);</span>
<a href="#l24.382"></a><span id="l24.382" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l24.383"></a><span id="l24.383">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.384"></a><span id="l24.384" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 6, hour, controller);</span>
<a href="#l24.385"></a><span id="l24.385" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l24.386"></a><span id="l24.386">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.387"></a><span id="l24.387" class="difflineminus">-  path = CalendarUtils.getEventBoxPath(view, CalendarUtils.EVENT_BOX, startWeek + 1, 7, hour, controller);</span>
<a href="#l24.388"></a><span id="l24.388" class="difflineplus">+  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l24.389"></a><span id="l24.389">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l24.390"></a><span id="l24.390"> }</span>
<a href="#l24.391"></a><span id="l24.391"> </span>
<a href="#l24.392"></a><span id="l24.392"> var teardownTest = function(module) {</span>
<a href="#l24.393"></a><span id="l24.393" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l24.394"></a><span id="l24.394" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l24.395"></a><span id="l24.395"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/test/mozmill/testTaskView.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/test/mozmill/testTaskView.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -29,28 +29,28 @@</span>
<a href="#l25.4"></a><span id="l25.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l25.5"></a><span id="l25.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l25.6"></a><span id="l25.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l25.7"></a><span id="l25.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l25.8"></a><span id="l25.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l25.9"></a><span id="l25.9">  *</span>
<a href="#l25.10"></a><span id="l25.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'UtilsAPI'];</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+var utils = require(&quot;./shared-modules/utils&quot;);</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17"> var sleep = 500;</span>
<a href="#l25.18"></a><span id="l25.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l25.19"></a><span id="l25.19"> var title = &quot;Task&quot;;</span>
<a href="#l25.20"></a><span id="l25.20"> var description = &quot;1. Do A\n2. Do B&quot;;</span>
<a href="#l25.21"></a><span id="l25.21"> var percentComplete = &quot;50&quot;;</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23"> var setupModule = function(module) {</span>
<a href="#l25.24"></a><span id="l25.24">   controller = mozmill.getMail3PaneController();</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l25.27"></a><span id="l25.27"> }</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29"> // mozmill doesn't support trees yet, therefore completed checkbox and line-through style are not</span>
<a href="#l25.30"></a><span id="l25.30"> // checked</span>
<a href="#l25.31"></a><span id="l25.31"> var testTaskView = function () {</span>
<a href="#l25.32"></a><span id="l25.32">   // paths</span>
<a href="#l25.33"></a><span id="l25.33">   let taskView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l25.34"></a><span id="l25.34">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineat">@@ -84,37 +84,36 @@ var testTaskView = function () {</span>
<a href="#l25.36"></a><span id="l25.36">     + 'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l25.37"></a><span id="l25.37">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l25.38"></a><span id="l25.38">     title);</span>
<a href="#l25.39"></a><span id="l25.39">   controller.keypress(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l25.40"></a><span id="l25.40">     + 'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l25.41"></a><span id="l25.41">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l25.42"></a><span id="l25.42">     &quot;VK_RETURN&quot;,</span>
<a href="#l25.43"></a><span id="l25.43">     {});</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l25.45"></a><span id="l25.45">   </span>
<a href="#l25.46"></a><span id="l25.46">   // verify added</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-  let countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-  controller.assertJS(countBefore + 1 == countAfter);</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineplus">+  let countAfter;</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+  controller.waitFor(function() {countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineplus">+                                 return countBefore + 1 == countAfter});</span>
<a href="#l25.52"></a><span id="l25.52">   </span>
<a href="#l25.53"></a><span id="l25.53">   // last added task is automatically selected so verify detail window data</span>
<a href="#l25.54"></a><span id="l25.54">   controller.assertValue(new elementslib.ID(controller.window.document,</span>
<a href="#l25.55"></a><span id="l25.55">     &quot;calendar-task-details-title&quot;),</span>
<a href="#l25.56"></a><span id="l25.56">     title);</span>
<a href="#l25.57"></a><span id="l25.57">   </span>
<a href="#l25.58"></a><span id="l25.58">   // open added task</span>
<a href="#l25.59"></a><span id="l25.59">   // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l25.60"></a><span id="l25.60">   // left where the checkbox is located</span>
<a href="#l25.61"></a><span id="l25.61">   controller.doubleClick(new elementslib.Lookup(controller.window.document, treeChildren), 50, 0);</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l25.64"></a><span id="l25.64">   let task = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineminus">-  task.sleep(sleep);</span>
<a href="#l25.66"></a><span id="l25.66">   </span>
<a href="#l25.67"></a><span id="l25.67">   // verify calendar</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineminus">-  task.assertNode(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+  task.waitForElement(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l25.70"></a><span id="l25.70">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/'</span>
<a href="#l25.71"></a><span id="l25.71">     + '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'))</span>
<a href="#l25.72"></a><span id="l25.72">   </span>
<a href="#l25.73"></a><span id="l25.73">   // add description, mark needs action and add percent complete</span>
<a href="#l25.74"></a><span id="l25.74">   task.type(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l25.75"></a><span id="l25.75">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l25.76"></a><span id="l25.76">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l25.77"></a><span id="l25.77">     description);</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineat">@@ -130,65 +129,67 @@ var testTaskView = function () {</span>
<a href="#l25.79"></a><span id="l25.79">   task.type(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l25.80"></a><span id="l25.80">     + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/'</span>
<a href="#l25.81"></a><span id="l25.81">     + 'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/'</span>
<a href="#l25.82"></a><span id="l25.82">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l25.83"></a><span id="l25.83">     percentComplete);</span>
<a href="#l25.84"></a><span id="l25.84">   </span>
<a href="#l25.85"></a><span id="l25.85">   // save</span>
<a href="#l25.86"></a><span id="l25.86">   task.click(new elementslib.ID(task.window.document, &quot;button-save&quot;));</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l25.89"></a><span id="l25.89">   </span>
<a href="#l25.90"></a><span id="l25.90">   // verify description and status in details pane</span>
<a href="#l25.91"></a><span id="l25.91">   controller.assertValue(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l25.92"></a><span id="l25.92">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details-description&quot;)/'</span>
<a href="#l25.93"></a><span id="l25.93">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l25.94"></a><span id="l25.94">     description);</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineminus">-  let status = UtilsAPI.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+  let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l25.97"></a><span id="l25.97">     &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l25.98"></a><span id="l25.98">   controller.assertValue(new elementslib.ID(controller.window.document, &quot;calendar-task-details-status&quot;),</span>
<a href="#l25.99"></a><span id="l25.99">     status);</span>
<a href="#l25.100"></a><span id="l25.100">   </span>
<a href="#l25.101"></a><span id="l25.101">   // set high priority and verify it in detail pane</span>
<a href="#l25.102"></a><span id="l25.102">   controller.click(new elementslib.ID(controller.window.document, &quot;task-actions-priority&quot;));</span>
<a href="#l25.103"></a><span id="l25.103">   controller.sleep(sleep);</span>
<a href="#l25.104"></a><span id="l25.104">   controller.click(new elementslib.ID(controller.window.document, &quot;priority-1-menuitem&quot;));</span>
<a href="#l25.105"></a><span id="l25.105">   controller.sleep(sleep);</span>
<a href="#l25.106"></a><span id="l25.106">   let priorityNode = new elementslib.ID(controller.window.document, &quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineminus">-  controller.assertPropertyNotExist(priorityNode, &quot;hidden&quot;);</span>
<a href="#l25.108"></a><span id="l25.108" class="difflineplus">+  controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l25.109"></a><span id="l25.109">   </span>
<a href="#l25.110"></a><span id="l25.110">   // verify that tooltip shows status, priority and percent complete</span>
<a href="#l25.111"></a><span id="l25.111">   let toolTipNode = new elementslib.Lookup(controller.window.document, toolTip).getNode();</span>
<a href="#l25.112"></a><span id="l25.112">   toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l25.113"></a><span id="l25.113">   </span>
<a href="#l25.114"></a><span id="l25.114">   let toolTipName = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[0]/[1]');</span>
<a href="#l25.115"></a><span id="l25.115" class="difflineminus">-  let toolTipPriority = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[1]/[1]');</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineminus">-  let toolTipStatus = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[2]/[1]');</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineminus">-  let toolTipComplete = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[3]/[1]');</span>
<a href="#l25.118"></a><span id="l25.118" class="difflineminus">-  let priority = UtilsAPI.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l25.119"></a><span id="l25.119" class="difflineplus">+  let toolTipCalendar = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[1]/[1]');</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineplus">+  let toolTipPriority = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[2]/[1]');</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineplus">+  let toolTipStatus = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[3]/[1]');</span>
<a href="#l25.122"></a><span id="l25.122" class="difflineplus">+  let toolTipComplete = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[4]/[1]');</span>
<a href="#l25.123"></a><span id="l25.123" class="difflineplus">+  let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l25.124"></a><span id="l25.124">     &quot;highPriority&quot;);</span>
<a href="#l25.125"></a><span id="l25.125">   </span>
<a href="#l25.126"></a><span id="l25.126">   controller.assertJS(toolTipName.getNode().textContent == title);</span>
<a href="#l25.127"></a><span id="l25.127" class="difflineplus">+  controller.assertJS(toolTipCalendar.getNode().textContent == calendar);</span>
<a href="#l25.128"></a><span id="l25.128">   controller.assertJS(toolTipPriority.getNode().textContent == priority);</span>
<a href="#l25.129"></a><span id="l25.129">   controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l25.130"></a><span id="l25.130">   controller.assertJS(toolTipComplete.getNode().textContent == percentComplete + '%');</span>
<a href="#l25.131"></a><span id="l25.131">   </span>
<a href="#l25.132"></a><span id="l25.132">   // mark completed, verify</span>
<a href="#l25.133"></a><span id="l25.133">   controller.click(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l25.134"></a><span id="l25.134">     + '[1]/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details&quot;)/'</span>
<a href="#l25.135"></a><span id="l25.135">     + 'id(&quot;other-actions-box&quot;)/id(&quot;task-actions-markcompleted&quot;)/anon({&quot;anonid&quot;:&quot;button&quot;})'));</span>
<a href="#l25.136"></a><span id="l25.136">   controller.sleep(sleep);</span>
<a href="#l25.137"></a><span id="l25.137">   </span>
<a href="#l25.138"></a><span id="l25.138" class="difflineminus">-  status = UtilsAPI.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l25.139"></a><span id="l25.139" class="difflineplus">+  status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l25.140"></a><span id="l25.140">     &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l25.141"></a><span id="l25.141">   toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l25.142"></a><span id="l25.142">   controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l25.143"></a><span id="l25.143">   </span>
<a href="#l25.144"></a><span id="l25.144">   // delete task, verify</span>
<a href="#l25.145"></a><span id="l25.145">   controller.click(new elementslib.ID(controller.window.document, &quot;task-context-menu-delete&quot;));</span>
<a href="#l25.146"></a><span id="l25.146">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-delete-task-button&quot;));</span>
<a href="#l25.147"></a><span id="l25.147">   let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l25.148"></a><span id="l25.148">   controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l25.149"></a><span id="l25.149"> }</span>
<a href="#l25.150"></a><span id="l25.150"> </span>
<a href="#l25.151"></a><span id="l25.151"> var teardownTest = function(module) {</span>
<a href="#l25.152"></a><span id="l25.152" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l25.153"></a><span id="l25.153" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l25.154"></a><span id="l25.154"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -29,25 +29,24 @@</span>
<a href="#l26.4"></a><span id="l26.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l26.5"></a><span id="l26.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l26.6"></a><span id="l26.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l26.7"></a><span id="l26.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l26.8"></a><span id="l26.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l26.9"></a><span id="l26.9">  *</span>
<a href="#l26.10"></a><span id="l26.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16"> var sleep = 500;</span>
<a href="#l26.17"></a><span id="l26.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19"> var setupModule = function(module) {</span>
<a href="#l26.20"></a><span id="l26.20">   controller = mozmill.getMail3PaneController();</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l26.23"></a><span id="l26.23"> }</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25"> var testTodayPane = function () {</span>
<a href="#l26.26"></a><span id="l26.26">   // paths</span>
<a href="#l26.27"></a><span id="l26.27">   let panels = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l26.28"></a><span id="l26.28">     + 'id(&quot;tabpanelcontainer&quot;)/';</span>
<a href="#l26.29"></a><span id="l26.29">   let miniMonth = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/'</span>
<a href="#l26.30"></a><span id="l26.30">     + 'id(&quot;minimonth-pane&quot;)/';</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineat">@@ -57,20 +56,19 @@ var testTodayPane = function () {</span>
<a href="#l26.32"></a><span id="l26.32">     + 'anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l26.33"></a><span id="l26.33">   let eventName = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/'</span>
<a href="#l26.34"></a><span id="l26.34">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l26.35"></a><span id="l26.35">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l26.36"></a><span id="l26.36">   </span>
<a href="#l26.37"></a><span id="l26.37">   // open calendar view</span>
<a href="#l26.38"></a><span id="l26.38">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l26.39"></a><span id="l26.39">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.41"></a><span id="l26.41">   </span>
<a href="#l26.42"></a><span id="l26.42">   // go to today and verify date</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l26.45"></a><span id="l26.45">     + '{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/'</span>
<a href="#l26.46"></a><span id="l26.46">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;today-button&quot;})'));</span>
<a href="#l26.47"></a><span id="l26.47">   let dayNode = (new elementslib.Lookup(controller.window.document, dayPath)).getNode();</span>
<a href="#l26.48"></a><span id="l26.48">   controller.assertJS(dayNode.mDate.icalString == getIsoDate());</span>
<a href="#l26.49"></a><span id="l26.49"> </span>
<a href="#l26.50"></a><span id="l26.50">   // create event 6 hours from now, if this is tomorrow then at 23 today</span>
<a href="#l26.51"></a><span id="l26.51">   // doubleclick only triggers new event dialog on visible boxes, so scrolling may be needed</span>
<a href="#l26.52"></a><span id="l26.52">   // by default visible time is 08:00 - 17:00, box of 17th hour is out of view</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineat">@@ -79,68 +77,68 @@ var testTodayPane = function () {</span>
<a href="#l26.54"></a><span id="l26.54">   let view = (new elementslib.Lookup(controller.window.document, dayView)).getNode();</span>
<a href="#l26.55"></a><span id="l26.55">   </span>
<a href="#l26.56"></a><span id="l26.56">   if(startHour &lt; 8 || startHour &gt; 16)</span>
<a href="#l26.57"></a><span id="l26.57">     view.scrollToMinute(60 * startHour);</span>
<a href="#l26.58"></a><span id="l26.58">     </span>
<a href="#l26.59"></a><span id="l26.59">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l26.60"></a><span id="l26.60">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l26.61"></a><span id="l26.61">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + ']'));</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + ']'), 1, 1);</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l26.66"></a><span id="l26.66">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineminus">-  </span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+    </span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+  event.waitForElement(new elementslib.Lookup(event.window.document, eventName));</span>
<a href="#l26.71"></a><span id="l26.71">   event.type(new elementslib.Lookup(event.window.document, eventName),&quot;Today's Event&quot;);</span>
<a href="#l26.72"></a><span id="l26.72">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l26.75"></a><span id="l26.75">   </span>
<a href="#l26.76"></a><span id="l26.76">   // reset view</span>
<a href="#l26.77"></a><span id="l26.77">   view.scrollToMinute(60 * 8);</span>
<a href="#l26.78"></a><span id="l26.78">   </span>
<a href="#l26.79"></a><span id="l26.79">   // go to tomorrow and add an event</span>
<a href="#l26.80"></a><span id="l26.80">   controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l26.81"></a><span id="l26.81">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l26.82"></a><span id="l26.82">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l26.83"></a><span id="l26.83">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l26.84"></a><span id="l26.84" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l26.85"></a><span id="l26.85" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l26.86"></a><span id="l26.86" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l26.87"></a><span id="l26.87" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l26.88"></a><span id="l26.88">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l26.90"></a><span id="l26.90">   </span>
<a href="#l26.91"></a><span id="l26.91" class="difflineplus">+  event.waitForElement(new elementslib.Lookup(event.window.document, eventName));</span>
<a href="#l26.92"></a><span id="l26.92">   event.type(new elementslib.Lookup(event.window.document, eventName),&quot;Tomorrow's Event&quot;);</span>
<a href="#l26.93"></a><span id="l26.93">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l26.94"></a><span id="l26.94" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.95"></a><span id="l26.95" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l26.96"></a><span id="l26.96">   </span>
<a href="#l26.97"></a><span id="l26.97">   // go 5 days forward and add an event</span>
<a href="#l26.98"></a><span id="l26.98">   for(let i = 0; i &lt; 5; i++)</span>
<a href="#l26.99"></a><span id="l26.99">     controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l26.100"></a><span id="l26.100">   controller.sleep(sleep);</span>
<a href="#l26.101"></a><span id="l26.101">   </span>
<a href="#l26.102"></a><span id="l26.102">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l26.103"></a><span id="l26.103">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l26.104"></a><span id="l26.104">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l26.105"></a><span id="l26.105" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l26.106"></a><span id="l26.106" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l26.108"></a><span id="l26.108" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l26.109"></a><span id="l26.109">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l26.110"></a><span id="l26.110" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l26.111"></a><span id="l26.111">   </span>
<a href="#l26.112"></a><span id="l26.112" class="difflineplus">+  event.waitForElement(new elementslib.Lookup(event.window.document, eventName));</span>
<a href="#l26.113"></a><span id="l26.113">   event.type(new elementslib.Lookup(event.window.document, eventName),&quot;Future's Event&quot;);</span>
<a href="#l26.114"></a><span id="l26.114">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l26.115"></a><span id="l26.115" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.116"></a><span id="l26.116" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l26.117"></a><span id="l26.117">   </span>
<a href="#l26.118"></a><span id="l26.118">   // go to mail tab</span>
<a href="#l26.119"></a><span id="l26.119">   controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/'</span>
<a href="#l26.120"></a><span id="l26.120">     + 'id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/anon({&quot;anonid&quot;:&quot;tabbox&quot;})/anon({&quot;anonid&quot;:&quot;strip&quot;})/'</span>
<a href="#l26.121"></a><span id="l26.121">     + 'anon({&quot;anonid&quot;:&quot;tabcontainer&quot;})/{&quot;type&quot;:&quot;folder&quot;,&quot;first-tab&quot;:&quot;true&quot;}/'</span>
<a href="#l26.122"></a><span id="l26.122">     + 'anon({&quot;class&quot;:&quot;tab-image-middle box-inherit&quot;})/{&quot;class&quot;:&quot;tab-text&quot;}'));</span>
<a href="#l26.123"></a><span id="l26.123">   controller.sleep(sleep);</span>
<a href="#l26.124"></a><span id="l26.124">   </span>
<a href="#l26.125"></a><span id="l26.125">   // verify today pane open</span>
<a href="#l26.126"></a><span id="l26.126" class="difflineminus">-  controller.assertPropertyNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.127"></a><span id="l26.127" class="difflineplus">+  controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.128"></a><span id="l26.128">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l26.129"></a><span id="l26.129">   </span>
<a href="#l26.130"></a><span id="l26.130">   // verify today pane's date</span>
<a href="#l26.131"></a><span id="l26.131">   controller.assertValue(new elementslib.ID(controller.window.document, &quot;datevalue-label&quot;),</span>
<a href="#l26.132"></a><span id="l26.132">     (new Date()).getDate());</span>
<a href="#l26.133"></a><span id="l26.133">     </span>
<a href="#l26.134"></a><span id="l26.134">   // tomorrow and soon are collapsed by default</span>
<a href="#l26.135"></a><span id="l26.135">   controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/'</span>
<a href="#l26.136"></a><span id="l26.136" class="difflineat">@@ -172,51 +170,48 @@ var testTodayPane = function () {</span>
<a href="#l26.137"></a><span id="l26.137">   </span>
<a href="#l26.138"></a><span id="l26.138">   // delete events</span>
<a href="#l26.139"></a><span id="l26.139">   controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.140"></a><span id="l26.140">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/'</span>
<a href="#l26.141"></a><span id="l26.141">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[1]'));</span>
<a href="#l26.142"></a><span id="l26.142">   controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l26.143"></a><span id="l26.143">     &quot;VK_DELETE&quot;,</span>
<a href="#l26.144"></a><span id="l26.144">     {});</span>
<a href="#l26.145"></a><span id="l26.145" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.146"></a><span id="l26.146" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.147"></a><span id="l26.147" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.148"></a><span id="l26.148">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/'</span>
<a href="#l26.149"></a><span id="l26.149">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[5]'));</span>
<a href="#l26.150"></a><span id="l26.150">     </span>
<a href="#l26.151"></a><span id="l26.151">   controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.152"></a><span id="l26.152">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/'</span>
<a href="#l26.153"></a><span id="l26.153">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]'));</span>
<a href="#l26.154"></a><span id="l26.154">   controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l26.155"></a><span id="l26.155">     &quot;VK_DELETE&quot;,</span>
<a href="#l26.156"></a><span id="l26.156">     {});</span>
<a href="#l26.157"></a><span id="l26.157" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.158"></a><span id="l26.158" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.159"></a><span id="l26.159" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.160"></a><span id="l26.160">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/'</span>
<a href="#l26.161"></a><span id="l26.161">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l26.162"></a><span id="l26.162">   </span>
<a href="#l26.163"></a><span id="l26.163">   controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.164"></a><span id="l26.164">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/'</span>
<a href="#l26.165"></a><span id="l26.165">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[3]'));</span>
<a href="#l26.166"></a><span id="l26.166">   controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l26.167"></a><span id="l26.167">     &quot;VK_DELETE&quot;,</span>
<a href="#l26.168"></a><span id="l26.168">     {});</span>
<a href="#l26.169"></a><span id="l26.169" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l26.170"></a><span id="l26.170" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.171"></a><span id="l26.171" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.172"></a><span id="l26.172">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/'</span>
<a href="#l26.173"></a><span id="l26.173">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[3]'));</span>
<a href="#l26.174"></a><span id="l26.174">     </span>
<a href="#l26.175"></a><span id="l26.175">   // hide and verify today pane hidden</span>
<a href="#l26.176"></a><span id="l26.176">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l26.177"></a><span id="l26.177">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.178"></a><span id="l26.178">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/{&quot;collapsed&quot;:&quot;true&quot;}'));</span>
<a href="#l26.179"></a><span id="l26.179">   </span>
<a href="#l26.180"></a><span id="l26.180">   // reset today pane</span>
<a href="#l26.181"></a><span id="l26.181">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l26.182"></a><span id="l26.182" class="difflineminus">-  controller.assertPropertyNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.183"></a><span id="l26.183" class="difflineplus">+  controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l26.184"></a><span id="l26.184">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l26.185"></a><span id="l26.185">   controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/'</span>
<a href="#l26.186"></a><span id="l26.186">     + 'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/'</span>
<a href="#l26.187"></a><span id="l26.187">     + 'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/'</span>
<a href="#l26.188"></a><span id="l26.188">     + 'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l26.189"></a><span id="l26.189">   controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/'</span>
<a href="#l26.190"></a><span id="l26.190">     + 'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/'</span>
<a href="#l26.191"></a><span id="l26.191">     + 'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/'</span>
<a href="#l26.192"></a><span id="l26.192" class="difflineat">@@ -241,10 +236,10 @@ var getIsoDate = function() {</span>
<a href="#l26.193"></a><span id="l26.193">   let year = date.getFullYear();</span>
<a href="#l26.194"></a><span id="l26.194">   let month = (date.getMonth() &lt; 9)? '0' + (date.getMonth() + 1) : (date.getMonth() + 1);</span>
<a href="#l26.195"></a><span id="l26.195">   let day = (date.getDate() &lt; 10)? '0' + date.getDate() : date.getDate();</span>
<a href="#l26.196"></a><span id="l26.196">   let isoDate = year + '' + month + '' + day;</span>
<a href="#l26.197"></a><span id="l26.197">   return isoDate;</span>
<a href="#l26.198"></a><span id="l26.198"> }</span>
<a href="#l26.199"></a><span id="l26.199"> </span>
<a href="#l26.200"></a><span id="l26.200"> var teardownTest = function(module) {</span>
<a href="#l26.201"></a><span id="l26.201" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l26.202"></a><span id="l26.202" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l26.203"></a><span id="l26.203"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/test/mozmill/testUTF8.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/test/mozmill/testUTF8.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -29,93 +29,92 @@</span>
<a href="#l27.4"></a><span id="l27.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l27.5"></a><span id="l27.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l27.6"></a><span id="l27.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l27.7"></a><span id="l27.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l27.8"></a><span id="l27.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l27.9"></a><span id="l27.9">  *</span>
<a href="#l27.10"></a><span id="l27.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'PrefsAPI'];</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+var prefs = require(&quot;./shared-modules/prefs&quot;);</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17"> var sleep = 500;</span>
<a href="#l27.18"></a><span id="l27.18"> var UTF8string = &quot;õäöü&quot;;</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20"> var setupModule = function(module) {</span>
<a href="#l27.21"></a><span id="l27.21">   controller = mozmill.getMail3PaneController();</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">-  CalendarUtils.createCalendar(UTF8string);</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineminus">-  PrefsAPI.preferences.setPref(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+  calUtils.createCalendar(controller, UTF8string);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+  prefs.preferences.setPref(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l27.26"></a><span id="l27.26"> }</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28"> /***</span>
<a href="#l27.29"></a><span id="l27.29">  ** NOTE: This test will fail until Mozmill bug 506760 is fixed.</span>
<a href="#l27.30"></a><span id="l27.30">  ***/</span>
<a href="#l27.31"></a><span id="l27.31"> </span>
<a href="#l27.32"></a><span id="l27.32"> var testUTF8 = function () {</span>
<a href="#l27.33"></a><span id="l27.33">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l27.34"></a><span id="l27.34">   </span>
<a href="#l27.35"></a><span id="l27.35">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l27.39"></a><span id="l27.39">   </span>
<a href="#l27.40"></a><span id="l27.40">   // create new event</span>
<a href="#l27.41"></a><span id="l27.41">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">-      CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, 8, controller)));</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l27.46"></a><span id="l27.46">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l27.48"></a><span id="l27.48">   </span>
<a href="#l27.49"></a><span id="l27.49">   // fill in name, location, description</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.52"></a><span id="l27.52">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-    UTF8string);</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineplus">+  event.waitForElement(titleTextBox);</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineplus">+  event.type(titleTextBox, UTF8string);</span>
<a href="#l27.58"></a><span id="l27.58">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.59"></a><span id="l27.59">     + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l27.60"></a><span id="l27.60">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l27.61"></a><span id="l27.61">     UTF8string);</span>
<a href="#l27.62"></a><span id="l27.62">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.63"></a><span id="l27.63">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l27.64"></a><span id="l27.64">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l27.65"></a><span id="l27.65">     UTF8string);</span>
<a href="#l27.66"></a><span id="l27.66">   </span>
<a href="#l27.67"></a><span id="l27.67">   // select category</span>
<a href="#l27.68"></a><span id="l27.68">   event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l27.69"></a><span id="l27.69">     UTF8string);</span>
<a href="#l27.70"></a><span id="l27.70">   </span>
<a href="#l27.71"></a><span id="l27.71">   // save</span>
<a href="#l27.72"></a><span id="l27.72">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l27.74"></a><span id="l27.74">   </span>
<a href="#l27.75"></a><span id="l27.75">   // open</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineminus">-      CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.EVENT_BOX, undefined, 1, 8, controller)</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-      + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}'));</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineplus">+  let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineplus">+    + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}');</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+  controller.waitForElement(eventBox);</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineplus">+  controller.doubleClick(eventBox);</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l27.86"></a><span id="l27.86">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineminus">-  // wait for input elements' values to be populated</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l27.89"></a><span id="l27.89">   </span>
<a href="#l27.90"></a><span id="l27.90">   // check values</span>
<a href="#l27.91"></a><span id="l27.91" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineplus">+  titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.93"></a><span id="l27.93">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l27.94"></a><span id="l27.94" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineminus">-    UTF8string);</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineplus">+  event.waitForElement(titleTextBox);</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineplus">+  event.assertValue(titleTextBox, UTF8string);</span>
<a href="#l27.99"></a><span id="l27.99">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.100"></a><span id="l27.100">     + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l27.101"></a><span id="l27.101">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l27.102"></a><span id="l27.102">     UTF8string);</span>
<a href="#l27.103"></a><span id="l27.103">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l27.104"></a><span id="l27.104">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l27.105"></a><span id="l27.105">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l27.106"></a><span id="l27.106">     UTF8string);</span>
<a href="#l27.107"></a><span id="l27.107">   event.assertValue(new elementslib.ID(event.window.document, &quot;item-categories&quot;),</span>
<a href="#l27.108"></a><span id="l27.108">     UTF8string);</span>
<a href="#l27.109"></a><span id="l27.109">   </span>
<a href="#l27.110"></a><span id="l27.110">   // escape the event window</span>
<a href="#l27.111"></a><span id="l27.111">   event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l27.112"></a><span id="l27.112"> }</span>
<a href="#l27.113"></a><span id="l27.113"> </span>
<a href="#l27.114"></a><span id="l27.114"> var teardownTest = function(module) {</span>
<a href="#l27.115"></a><span id="l27.115" class="difflineminus">-  CalendarUtils.deleteCalendars(UTF8string);</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-  PrefsAPI.preferences.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineplus">+  calUtils.deleteCalendars(controller, UTF8string);</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l27.119"></a><span id="l27.119"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/test/mozmill/testWeekView.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/test/mozmill/testWeekView.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -29,28 +29,27 @@</span>
<a href="#l28.4"></a><span id="l28.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l28.5"></a><span id="l28.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l28.6"></a><span id="l28.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l28.7"></a><span id="l28.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l28.8"></a><span id="l28.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l28.9"></a><span id="l28.9">  *</span>
<a href="#l28.10"></a><span id="l28.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-var RELATIVE_ROOT = './shared-modules';</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils'];</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> var sleep = 500;</span>
<a href="#l28.17"></a><span id="l28.17"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l28.18"></a><span id="l28.18"> var title1 = &quot;Week View Event&quot;;</span>
<a href="#l28.19"></a><span id="l28.19"> var title2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l28.20"></a><span id="l28.20"> var desc = &quot;Week View Event Description&quot;;</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22"> var setupModule = function(module) {</span>
<a href="#l28.23"></a><span id="l28.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l28.26"></a><span id="l28.26"> }</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28"> var testWeekView = function () {</span>
<a href="#l28.29"></a><span id="l28.29">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l28.30"></a><span id="l28.30">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l28.31"></a><span id="l28.31">   // paths</span>
<a href="#l28.32"></a><span id="l28.32">   let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l28.33"></a><span id="l28.33">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/'</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineat">@@ -68,53 +67,50 @@ var testWeekView = function () {</span>
<a href="#l28.35"></a><span id="l28.35">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-week-view-button&quot;));</span>
<a href="#l28.36"></a><span id="l28.36">   </span>
<a href="#l28.37"></a><span id="l28.37">   // pick year</span>
<a href="#l28.38"></a><span id="l28.38">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.39"></a><span id="l28.39">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l28.40"></a><span id="l28.40">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.41"></a><span id="l28.41">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l28.42"></a><span id="l28.42">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l28.44"></a><span id="l28.44">   </span>
<a href="#l28.45"></a><span id="l28.45">   // pick month</span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.48"></a><span id="l28.48">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l28.49"></a><span id="l28.49">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.50"></a><span id="l28.50">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l28.51"></a><span id="l28.51">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l28.53"></a><span id="l28.53"> </span>
<a href="#l28.54"></a><span id="l28.54">   // pick day</span>
<a href="#l28.55"></a><span id="l28.55" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineplus">+  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l28.57"></a><span id="l28.57">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l28.59"></a><span id="l28.59">   </span>
<a href="#l28.60"></a><span id="l28.60">   // verify date</span>
<a href="#l28.61"></a><span id="l28.61">   let day = new elementslib.Lookup(controller.window.document, weekView</span>
<a href="#l28.62"></a><span id="l28.62">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/'</span>
<a href="#l28.63"></a><span id="l28.63">     + '{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-  controller.assertJS(day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+  controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l28.66"></a><span id="l28.66"> </span>
<a href="#l28.67"></a><span id="l28.67">   // create event at 8 AM</span>
<a href="#l28.68"></a><span id="l28.68">   // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l28.69"></a><span id="l28.69">   controller.doubleClick(new elementslib.Lookup(controller.window.document, weekView</span>
<a href="#l28.70"></a><span id="l28.70">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-    + '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'));</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineplus">+    + '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineplus">+  controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l28.75"></a><span id="l28.75">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l28.77"></a><span id="l28.77">   </span>
<a href="#l28.78"></a><span id="l28.78">   // check that the start time is correct</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineplus">+  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.81"></a><span id="l28.81">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l28.82"></a><span id="l28.82">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l28.83"></a><span id="l28.83">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-    '8:00');</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineplus">+    + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineplus">+  event.waitForElement(startTimeInput);</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineplus">+  event.assertValue(startTimeInput, '8:00');</span>
<a href="#l28.89"></a><span id="l28.89">   let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l28.90"></a><span id="l28.90">     2009, 1, 1);</span>
<a href="#l28.91"></a><span id="l28.91">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.92"></a><span id="l28.92">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l28.93"></a><span id="l28.93">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l28.94"></a><span id="l28.94">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l28.95"></a><span id="l28.95">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l28.96"></a><span id="l28.96">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineat">@@ -124,50 +120,45 @@ var testWeekView = function () {</span>
<a href="#l28.98"></a><span id="l28.98">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.99"></a><span id="l28.99">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l28.100"></a><span id="l28.100">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l28.101"></a><span id="l28.101">     title1);</span>
<a href="#l28.102"></a><span id="l28.102">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.103"></a><span id="l28.103">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l28.104"></a><span id="l28.104">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l28.105"></a><span id="l28.105">     desc);</span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-  event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-    + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/'</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineminus">-    + '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineplus">+  event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l28.112"></a><span id="l28.112">   </span>
<a href="#l28.113"></a><span id="l28.113">   // save</span>
<a href="#l28.114"></a><span id="l28.114">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l28.116"></a><span id="l28.116">   </span>
<a href="#l28.117"></a><span id="l28.117">   // if it was created successfully, it can be opened</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineplus">+  controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l28.119"></a><span id="l28.119">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-  controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineplus">+  controller.waitFor(function () {return utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l28.122"></a><span id="l28.122">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l28.124"></a><span id="l28.124">   </span>
<a href="#l28.125"></a><span id="l28.125">   // change title and save changes</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineplus">+  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l28.128"></a><span id="l28.128">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineminus">-    title2);</span>
<a href="#l28.131"></a><span id="l28.131" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineplus">+  event.waitForElement(titleTextBox);</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineplus">+  event.type(titleTextBox, title2);</span>
<a href="#l28.134"></a><span id="l28.134">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l28.136"></a><span id="l28.136">   </span>
<a href="#l28.137"></a><span id="l28.137">   // check if name was saved</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineminus">-  controller.assertProperty(new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineplus">+  let eventName = new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l28.140"></a><span id="l28.140">     + '/anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l28.141"></a><span id="l28.141">     + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/'</span>
<a href="#l28.142"></a><span id="l28.142" class="difflineminus">-    + 'anon({&quot;anonid&quot;:&quot;event-name&quot;})'),</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineminus">-    &quot;textContent&quot;, title2);</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineplus">+    + 'anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineplus">+  controller.waitForElement(eventName);</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineplus">+  controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l28.147"></a><span id="l28.147">   </span>
<a href="#l28.148"></a><span id="l28.148">   // delete event</span>
<a href="#l28.149"></a><span id="l28.149">   controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l28.150"></a><span id="l28.150">   controller.keypress(new elementslib.ID(controller.window.document, &quot;week-view&quot;),</span>
<a href="#l28.151"></a><span id="l28.151">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l28.155"></a><span id="l28.155"> }</span>
<a href="#l28.156"></a><span id="l28.156"> </span>
<a href="#l28.157"></a><span id="l28.157"> var teardownTest = function(module) {</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l28.160"></a><span id="l28.160"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -28,22 +28,22 @@</span>
<a href="#l29.4"></a><span id="l29.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l29.5"></a><span id="l29.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l29.6"></a><span id="l29.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l29.7"></a><span id="l29.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l29.8"></a><span id="l29.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l29.9"></a><span id="l29.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l29.10"></a><span id="l29.10">  *</span>
<a href="#l29.11"></a><span id="l29.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">- </span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">- var calendar = &quot;Mozmill&quot;;</span>
<a href="#l29.14"></a><span id="l29.14"> </span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+var calendar = &quot;Mozmill&quot;;</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22"> var setupModule = function(module) {</span>
<a href="#l29.23"></a><span id="l29.23">   controller = mozmill.getMail3PaneController();</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineminus">-  CalendarUtils.createCalendar(calendar);</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineplus">+  calUtils.createCalendar(controller, calendar);</span>
<a href="#l29.26"></a><span id="l29.26"> }</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28"> var testTimezones1_SetGMT = function () {</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-  TimezoneUtils.switchAppTimezone(&quot;Europe/London&quot;, controller);</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+  timezoneUtils.switchAppTimezone(&quot;Europe/London&quot;);</span>
<a href="#l29.31"></a><span id="l29.31"> }</span>
<a href="#l29.32"></a><span id="l29.32">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -28,17 +28,21 @@</span>
<a href="#l30.4"></a><span id="l30.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l30.5"></a><span id="l30.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l30.6"></a><span id="l30.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l30.7"></a><span id="l30.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l30.8"></a><span id="l30.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l30.9"></a><span id="l30.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l30.10"></a><span id="l30.10">  *</span>
<a href="#l30.11"></a><span id="l30.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">- </span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+</span>
<a href="#l30.18"></a><span id="l30.18"> const sleep = 500;</span>
<a href="#l30.19"></a><span id="l30.19"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l30.20"></a><span id="l30.20"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l30.21"></a><span id="l30.21">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l30.22"></a><span id="l30.22"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l30.23"></a><span id="l30.23">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l30.24"></a><span id="l30.24"> /* rows - dates</span>
<a href="#l30.25"></a><span id="l30.25">    columns - correct time for each event */</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineat">@@ -46,30 +50,26 @@ var times = [[[18, 30], [19, 30], [20, 3</span>
<a href="#l30.27"></a><span id="l30.27">              [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l30.28"></a><span id="l30.28">              [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30],    [1, 30, +1]],</span>
<a href="#l30.29"></a><span id="l30.29">              [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30],    [1, 30, +1]],</span>
<a href="#l30.30"></a><span id="l30.30">              [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30],    [1, 30, +1]],</span>
<a href="#l30.31"></a><span id="l30.31">              [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l30.32"></a><span id="l30.32">              [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l30.33"></a><span id="l30.33">              [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]]</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineminus">-</span>
<a href="#l30.38"></a><span id="l30.38"> var setupModule = function(module) {</span>
<a href="#l30.39"></a><span id="l30.39">   controller = mozmill.getMail3PaneController();</span>
<a href="#l30.40"></a><span id="l30.40"> }</span>
<a href="#l30.41"></a><span id="l30.41"> </span>
<a href="#l30.42"></a><span id="l30.42"> var testTimezones10_checkAdelaide = function () {</span>
<a href="#l30.43"></a><span id="l30.43">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l30.44"></a><span id="l30.44">   </span>
<a href="#l30.45"></a><span id="l30.45">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l30.49"></a><span id="l30.49">   </span>
<a href="#l30.50"></a><span id="l30.50" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineminus">-  </span>
<a href="#l30.53"></a><span id="l30.53" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l30.55"></a><span id="l30.55"> }</span>
<a href="#l30.56"></a><span id="l30.56"> </span>
<a href="#l30.57"></a><span id="l30.57"> var teardownTest = function(module) {</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineminus">-  CalendarUtils.deleteCalendars(calendar);</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+  prefs.preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l30.60"></a><span id="l30.60" class="difflineplus">+  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l30.61"></a><span id="l30.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -28,76 +28,75 @@</span>
<a href="#l31.4"></a><span id="l31.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l31.5"></a><span id="l31.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l31.6"></a><span id="l31.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l31.7"></a><span id="l31.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.8"></a><span id="l31.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.9"></a><span id="l31.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.10"></a><span id="l31.10">  *</span>
<a href="#l31.11"></a><span id="l31.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">- </span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+</span>
<a href="#l31.18"></a><span id="l31.18"> const sleep = 500;</span>
<a href="#l31.19"></a><span id="l31.19"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l31.20"></a><span id="l31.20"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l31.21"></a><span id="l31.21">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l31.22"></a><span id="l31.22"> var times = [[4, 30], [4, 30], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l31.23"></a><span id="l31.23"> var gTimezone;</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'ModalDialogAPI', 'TimezoneUtils'];</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-</span>
<a href="#l31.28"></a><span id="l31.28"> var setupModule = function(module) {</span>
<a href="#l31.29"></a><span id="l31.29">   controller = mozmill.getMail3PaneController();</span>
<a href="#l31.30"></a><span id="l31.30"> }</span>
<a href="#l31.31"></a><span id="l31.31"> </span>
<a href="#l31.32"></a><span id="l31.32"> var testTimezones2_CreateEvents = function () {</span>
<a href="#l31.33"></a><span id="l31.33">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineminus">-  </span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l31.40"></a><span id="l31.40">   </span>
<a href="#l31.41"></a><span id="l31.41">   // create daily recurring events in all timezones</span>
<a href="#l31.42"></a><span id="l31.42">   let time = new Date();</span>
<a href="#l31.43"></a><span id="l31.43">   for (let i = 0; i &lt; timezones.length; i++) {</span>
<a href="#l31.44"></a><span id="l31.44">     controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineminus">-      CalendarUtils.getEventBoxPath(&quot;day&quot;, CalendarUtils.CANVAS_BOX, undefined, 1, i + 8, controller)));</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineminus">-    controller.waitForEval('utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0', sleep);</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, i + 8)), 1, 1);</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineplus">+    controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l31.49"></a><span id="l31.49">     let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-    event.sleep(sleep);</span>
<a href="#l31.51"></a><span id="l31.51">     </span>
<a href="#l31.52"></a><span id="l31.52">     time.setHours(times[i][0]);</span>
<a href="#l31.53"></a><span id="l31.53">     time.setMinutes(times[i][1]);</span>
<a href="#l31.54"></a><span id="l31.54">     </span>
<a href="#l31.55"></a><span id="l31.55">     // set timezone</span>
<a href="#l31.56"></a><span id="l31.56">     setTimezone(event, timezones[i]);</span>
<a href="#l31.57"></a><span id="l31.57">     </span>
<a href="#l31.58"></a><span id="l31.58">     // set title and repeat</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-    CalendarUtils.setData({title:timezones[i], repeat:&quot;weekly&quot;, starttime:time}, event);</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+    calUtils.setData(event, {title:timezones[i], repeat:&quot;weekly&quot;, starttime:time});</span>
<a href="#l31.61"></a><span id="l31.61"> </span>
<a href="#l31.62"></a><span id="l31.62">     // save</span>
<a href="#l31.63"></a><span id="l31.63">     event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineplus">+    controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l31.66"></a><span id="l31.66">   }</span>
<a href="#l31.67"></a><span id="l31.67"> }</span>
<a href="#l31.68"></a><span id="l31.68"> </span>
<a href="#l31.69"></a><span id="l31.69"> var teardownTest = function(module) {</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[0], controller);</span>
<a href="#l31.71"></a><span id="l31.71" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[0]);</span>
<a href="#l31.72"></a><span id="l31.72"> }</span>
<a href="#l31.73"></a><span id="l31.73"> </span>
<a href="#l31.74"></a><span id="l31.74"> function setTimezone(event, timezone) {</span>
<a href="#l31.75"></a><span id="l31.75">   gTimezone = timezone;</span>
<a href="#l31.76"></a><span id="l31.76">   </span>
<a href="#l31.77"></a><span id="l31.77">   // for some reason setting checked is needed, no other menuitem with checkbox needs it</span>
<a href="#l31.78"></a><span id="l31.78">   let menuitem = new elementslib.ID(event.window.document, &quot;options-timezone-menuitem&quot;);</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineplus">+  event.waitForElement(menuitem);</span>
<a href="#l31.80"></a><span id="l31.80">   menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l31.81"></a><span id="l31.81">   event.click(menuitem);</span>
<a href="#l31.82"></a><span id="l31.82">   </span>
<a href="#l31.83"></a><span id="l31.83" class="difflineminus">-  let modal = new ModalDialogAPI.modalDialog(eventCallback);</span>
<a href="#l31.84"></a><span id="l31.84" class="difflineminus">-  modal.start();</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineplus">+  let modal = new modalDialog.modalDialog(event.window);</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineplus">+  modal.start(eventCallback);</span>
<a href="#l31.87"></a><span id="l31.87">   event.waitForElement(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l31.88"></a><span id="l31.88">   event.click(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l31.89"></a><span id="l31.89"> }</span>
<a href="#l31.90"></a><span id="l31.90"> </span>
<a href="#l31.91"></a><span id="l31.91"> function eventCallback(timezone) {</span>
<a href="#l31.92"></a><span id="l31.92">   let item = new elementslib.XPath(timezone.window.document, &quot;/*[name()='dialog']/&quot;</span>
<a href="#l31.93"></a><span id="l31.93">      + &quot;*[name()='menulist'][1]/*[name()='menupopup'][1]/*[@value='&quot; + gTimezone + &quot;']&quot;);</span>
<a href="#l31.94"></a><span id="l31.94">   timezone.waitForElement(item);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l32.4"></a><span id="l32.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l32.5"></a><span id="l32.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l32.6"></a><span id="l32.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l32.7"></a><span id="l32.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l32.8"></a><span id="l32.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l32.9"></a><span id="l32.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l32.10"></a><span id="l32.10">  *</span>
<a href="#l32.11"></a><span id="l32.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">- </span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+</span>
<a href="#l32.17"></a><span id="l32.17"> const sleep = 500;</span>
<a href="#l32.18"></a><span id="l32.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l32.19"></a><span id="l32.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l32.20"></a><span id="l32.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l32.21"></a><span id="l32.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l32.22"></a><span id="l32.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l32.23"></a><span id="l32.23"> /* rows - dates</span>
<a href="#l32.24"></a><span id="l32.24">    columns - correct time for each event */</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[4, 30], [5, 30], [6, 30],</span>
<a href="#l32.26"></a><span id="l32.26">              [[4, 30], [6, 30], [7, 30], [7, 30],  [9, 30],  [9, 30], [11, 30], [12, 30]],</span>
<a href="#l32.27"></a><span id="l32.27">              [[4, 30], [6, 30], [7, 30], [7, 30],  [9, 30],  [9, 30], [11, 30], [13, 30]],</span>
<a href="#l32.28"></a><span id="l32.28">              [[4, 30], [6, 30], [7, 30], [7, 30],  [9, 30],  [9, 30], [11, 30], [13, 30]],</span>
<a href="#l32.29"></a><span id="l32.29">              [[4, 30], [6, 30], [7, 30], [7, 30],  [9, 30],  [9, 30], [11, 30], [13, 30]],</span>
<a href="#l32.30"></a><span id="l32.30">              [[4, 30], [6, 30], [7, 30], [7, 30],  [9, 30],  [9, 30], [11, 30], [12, 30]],</span>
<a href="#l32.31"></a><span id="l32.31">              [[4, 30], [6, 30], [7, 30], [7, 30],  [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l32.32"></a><span id="l32.32">              [[4, 30], [5, 30], [6, 30], [7, 30],  [8, 30],  [9, 30], [10, 30], [11, 30]]]</span>
<a href="#l32.33"></a><span id="l32.33"> </span>
<a href="#l32.34"></a><span id="l32.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-</span>
<a href="#l32.37"></a><span id="l32.37"> var setupModule = function(module) {</span>
<a href="#l32.38"></a><span id="l32.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l32.39"></a><span id="l32.39"> }</span>
<a href="#l32.40"></a><span id="l32.40"> </span>
<a href="#l32.41"></a><span id="l32.41"> var testTimezones3_checkStJohns = function () {</span>
<a href="#l32.42"></a><span id="l32.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l32.43"></a><span id="l32.43">   </span>
<a href="#l32.44"></a><span id="l32.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l32.48"></a><span id="l32.48">   </span>
<a href="#l32.49"></a><span id="l32.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineminus">-  </span>
<a href="#l32.52"></a><span id="l32.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l32.54"></a><span id="l32.54"> }</span>
<a href="#l32.55"></a><span id="l32.55"> </span>
<a href="#l32.56"></a><span id="l32.56"> var teardownTest = function(module) {</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[1], controller);</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[1]);</span>
<a href="#l32.59"></a><span id="l32.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l33.4"></a><span id="l33.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l33.5"></a><span id="l33.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l33.6"></a><span id="l33.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l33.7"></a><span id="l33.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l33.8"></a><span id="l33.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l33.9"></a><span id="l33.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l33.10"></a><span id="l33.10">  *</span>
<a href="#l33.11"></a><span id="l33.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">- </span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+</span>
<a href="#l33.17"></a><span id="l33.17"> const sleep = 500;</span>
<a href="#l33.18"></a><span id="l33.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l33.19"></a><span id="l33.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l33.20"></a><span id="l33.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l33.21"></a><span id="l33.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l33.22"></a><span id="l33.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l33.23"></a><span id="l33.23"> /* rows - dates</span>
<a href="#l33.24"></a><span id="l33.24">    columns - correct time for each event */</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[3, 30], [4, 30], [5, 30],</span>
<a href="#l33.26"></a><span id="l33.26">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l33.27"></a><span id="l33.27">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l33.28"></a><span id="l33.28">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l33.29"></a><span id="l33.29">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l33.30"></a><span id="l33.30">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l33.31"></a><span id="l33.31">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l33.32"></a><span id="l33.32">              [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]]]</span>
<a href="#l33.33"></a><span id="l33.33"> </span>
<a href="#l33.34"></a><span id="l33.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineminus">-</span>
<a href="#l33.37"></a><span id="l33.37"> var setupModule = function(module) {</span>
<a href="#l33.38"></a><span id="l33.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l33.39"></a><span id="l33.39"> }</span>
<a href="#l33.40"></a><span id="l33.40"> </span>
<a href="#l33.41"></a><span id="l33.41"> var testTimezones4_checkCaracas = function () {</span>
<a href="#l33.42"></a><span id="l33.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l33.43"></a><span id="l33.43">   </span>
<a href="#l33.44"></a><span id="l33.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l33.48"></a><span id="l33.48">   </span>
<a href="#l33.49"></a><span id="l33.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineminus">-  </span>
<a href="#l33.52"></a><span id="l33.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l33.54"></a><span id="l33.54"> }</span>
<a href="#l33.55"></a><span id="l33.55"> </span>
<a href="#l33.56"></a><span id="l33.56"> var teardownTest = function(module) {</span>
<a href="#l33.57"></a><span id="l33.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[2], controller);</span>
<a href="#l33.58"></a><span id="l33.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[2]);</span>
<a href="#l33.59"></a><span id="l33.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l34.4"></a><span id="l34.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l34.5"></a><span id="l34.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l34.6"></a><span id="l34.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l34.7"></a><span id="l34.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l34.8"></a><span id="l34.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l34.9"></a><span id="l34.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l34.10"></a><span id="l34.10">  *</span>
<a href="#l34.11"></a><span id="l34.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">- </span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+</span>
<a href="#l34.17"></a><span id="l34.17"> const sleep = 500;</span>
<a href="#l34.18"></a><span id="l34.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l34.19"></a><span id="l34.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l34.20"></a><span id="l34.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l34.21"></a><span id="l34.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l34.22"></a><span id="l34.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l34.23"></a><span id="l34.23"> /* rows - dates</span>
<a href="#l34.24"></a><span id="l34.24">    columns - correct time for each event */</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[1, 0], [2, 0], [3, 0], [4</span>
<a href="#l34.26"></a><span id="l34.26">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l34.27"></a><span id="l34.27">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l34.28"></a><span id="l34.28">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l34.29"></a><span id="l34.29">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l34.30"></a><span id="l34.30">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l34.31"></a><span id="l34.31">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l34.32"></a><span id="l34.32">              [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]]</span>
<a href="#l34.33"></a><span id="l34.33"> </span>
<a href="#l34.34"></a><span id="l34.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-</span>
<a href="#l34.37"></a><span id="l34.37"> var setupModule = function(module) {</span>
<a href="#l34.38"></a><span id="l34.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l34.39"></a><span id="l34.39"> }</span>
<a href="#l34.40"></a><span id="l34.40"> </span>
<a href="#l34.41"></a><span id="l34.41"> var testTimezones5_checkPhoenix = function () {</span>
<a href="#l34.42"></a><span id="l34.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l34.43"></a><span id="l34.43">   </span>
<a href="#l34.44"></a><span id="l34.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l34.48"></a><span id="l34.48">   </span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-  </span>
<a href="#l34.52"></a><span id="l34.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l34.54"></a><span id="l34.54"> }</span>
<a href="#l34.55"></a><span id="l34.55"> </span>
<a href="#l34.56"></a><span id="l34.56"> var teardownTest = function(module) {</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[3], controller);</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[3]);</span>
<a href="#l34.59"></a><span id="l34.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l35.4"></a><span id="l35.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l35.5"></a><span id="l35.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.6"></a><span id="l35.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.7"></a><span id="l35.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.8"></a><span id="l35.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.9"></a><span id="l35.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.10"></a><span id="l35.10">  *</span>
<a href="#l35.11"></a><span id="l35.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">- </span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+</span>
<a href="#l35.17"></a><span id="l35.17"> const sleep = 500;</span>
<a href="#l35.18"></a><span id="l35.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l35.19"></a><span id="l35.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l35.20"></a><span id="l35.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l35.21"></a><span id="l35.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l35.22"></a><span id="l35.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l35.23"></a><span id="l35.23"> /* rows - dates</span>
<a href="#l35.24"></a><span id="l35.24">    columns - correct time for each event */</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[0, 0], [1, 0], [2, 0], [3</span>
<a href="#l35.26"></a><span id="l35.26">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l35.27"></a><span id="l35.27">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l35.28"></a><span id="l35.28">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l35.29"></a><span id="l35.29">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l35.30"></a><span id="l35.30">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l35.31"></a><span id="l35.31">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l35.32"></a><span id="l35.32">              [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]]</span>
<a href="#l35.33"></a><span id="l35.33"> </span>
<a href="#l35.34"></a><span id="l35.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineminus">-</span>
<a href="#l35.37"></a><span id="l35.37"> var setupModule = function(module) {</span>
<a href="#l35.38"></a><span id="l35.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l35.39"></a><span id="l35.39"> }</span>
<a href="#l35.40"></a><span id="l35.40"> </span>
<a href="#l35.41"></a><span id="l35.41"> var testTimezones6_checkLosAngeles = function () {</span>
<a href="#l35.42"></a><span id="l35.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l35.43"></a><span id="l35.43">   </span>
<a href="#l35.44"></a><span id="l35.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l35.48"></a><span id="l35.48">   </span>
<a href="#l35.49"></a><span id="l35.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-  </span>
<a href="#l35.52"></a><span id="l35.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l35.54"></a><span id="l35.54"> }</span>
<a href="#l35.55"></a><span id="l35.55"> </span>
<a href="#l35.56"></a><span id="l35.56"> var teardownTest = function(module) {</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[4], controller);</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[4]);</span>
<a href="#l35.59"></a><span id="l35.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l36.4"></a><span id="l36.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l36.5"></a><span id="l36.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l36.6"></a><span id="l36.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l36.7"></a><span id="l36.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l36.8"></a><span id="l36.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l36.9"></a><span id="l36.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l36.10"></a><span id="l36.10">  *</span>
<a href="#l36.11"></a><span id="l36.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">- </span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+</span>
<a href="#l36.17"></a><span id="l36.17"> const sleep = 500;</span>
<a href="#l36.18"></a><span id="l36.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l36.19"></a><span id="l36.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l36.20"></a><span id="l36.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l36.21"></a><span id="l36.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l36.22"></a><span id="l36.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l36.23"></a><span id="l36.23"> /* rows - dates</span>
<a href="#l36.24"></a><span id="l36.24">    columns - correct time for each event */</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[5, 0], [6, 0], [7, 0], [8</span>
<a href="#l36.26"></a><span id="l36.26">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0],  [9, 0], [11, 0], [12, 0]],</span>
<a href="#l36.27"></a><span id="l36.27">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0],  [9, 0], [11, 0], [13, 0]],</span>
<a href="#l36.28"></a><span id="l36.28">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0],  [9, 0], [11, 0], [13, 0]],</span>
<a href="#l36.29"></a><span id="l36.29">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0],  [9, 0], [11, 0], [13, 0]],</span>
<a href="#l36.30"></a><span id="l36.30">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0],  [9, 0], [11, 0], [12, 0]],</span>
<a href="#l36.31"></a><span id="l36.31">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l36.32"></a><span id="l36.32">              [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]]</span>
<a href="#l36.33"></a><span id="l36.33"> </span>
<a href="#l36.34"></a><span id="l36.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-</span>
<a href="#l36.37"></a><span id="l36.37"> var setupModule = function(module) {</span>
<a href="#l36.38"></a><span id="l36.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l36.39"></a><span id="l36.39"> }</span>
<a href="#l36.40"></a><span id="l36.40"> </span>
<a href="#l36.41"></a><span id="l36.41"> var testTimezones7_checkBuenosAires = function () {</span>
<a href="#l36.42"></a><span id="l36.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l36.43"></a><span id="l36.43">   </span>
<a href="#l36.44"></a><span id="l36.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.48"></a><span id="l36.48">   </span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineminus">-  </span>
<a href="#l36.52"></a><span id="l36.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l36.54"></a><span id="l36.54"> }</span>
<a href="#l36.55"></a><span id="l36.55"> </span>
<a href="#l36.56"></a><span id="l36.56"> var teardownTest = function(module) {</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[5], controller);</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[5]);</span>
<a href="#l36.59"></a><span id="l36.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l37.4"></a><span id="l37.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l37.5"></a><span id="l37.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l37.6"></a><span id="l37.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l37.7"></a><span id="l37.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l37.8"></a><span id="l37.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l37.9"></a><span id="l37.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l37.10"></a><span id="l37.10">  *</span>
<a href="#l37.11"></a><span id="l37.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">- </span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+</span>
<a href="#l37.17"></a><span id="l37.17"> const sleep = 500;</span>
<a href="#l37.18"></a><span id="l37.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l37.19"></a><span id="l37.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l37.20"></a><span id="l37.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l37.21"></a><span id="l37.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l37.22"></a><span id="l37.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l37.23"></a><span id="l37.23"> /* rows - dates</span>
<a href="#l37.24"></a><span id="l37.24">    columns - correct time for each event */</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[9, 0], [10, 0], [11, 0], </span>
<a href="#l37.26"></a><span id="l37.26">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l37.27"></a><span id="l37.27">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l37.28"></a><span id="l37.28">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l37.29"></a><span id="l37.29">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l37.30"></a><span id="l37.30">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l37.31"></a><span id="l37.31">              [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l37.32"></a><span id="l37.32">              [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]]</span>
<a href="#l37.33"></a><span id="l37.33"> </span>
<a href="#l37.34"></a><span id="l37.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineminus">-</span>
<a href="#l37.37"></a><span id="l37.37"> var setupModule = function(module) {</span>
<a href="#l37.38"></a><span id="l37.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l37.39"></a><span id="l37.39"> }</span>
<a href="#l37.40"></a><span id="l37.40"> </span>
<a href="#l37.41"></a><span id="l37.41"> var testTimezones8_checkParis = function () {</span>
<a href="#l37.42"></a><span id="l37.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l37.43"></a><span id="l37.43">   </span>
<a href="#l37.44"></a><span id="l37.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.48"></a><span id="l37.48">   </span>
<a href="#l37.49"></a><span id="l37.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-  </span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l37.54"></a><span id="l37.54"> }</span>
<a href="#l37.55"></a><span id="l37.55"> </span>
<a href="#l37.56"></a><span id="l37.56"> var teardownTest = function(module) {</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[6], controller);</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[6]);</span>
<a href="#l37.59"></a><span id="l37.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -28,17 +28,20 @@</span>
<a href="#l38.4"></a><span id="l38.4">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l38.5"></a><span id="l38.5">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l38.6"></a><span id="l38.6">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l38.7"></a><span id="l38.7">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l38.8"></a><span id="l38.8">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l38.9"></a><span id="l38.9">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l38.10"></a><span id="l38.10">  *</span>
<a href="#l38.11"></a><span id="l38.11">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">- </span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+</span>
<a href="#l38.17"></a><span id="l38.17"> const sleep = 500;</span>
<a href="#l38.18"></a><span id="l38.18"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l38.19"></a><span id="l38.19"> var dates = [[2009,  1,  1], [2009,  4,  2], [2009,  4, 16], [2009,  4, 30],</span>
<a href="#l38.20"></a><span id="l38.20">              [2009,  7,  2], [2009, 10, 15], [2009, 10, 29], [2009, 11,  5]];</span>
<a href="#l38.21"></a><span id="l38.21"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l38.22"></a><span id="l38.22">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l38.23"></a><span id="l38.23"> /* rows - dates</span>
<a href="#l38.24"></a><span id="l38.24">    columns - correct time for each event */</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineat">@@ -46,30 +49,25 @@ var times = [[[13, 45], [14, 45], [15, 4</span>
<a href="#l38.26"></a><span id="l38.26">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l38.27"></a><span id="l38.27">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l38.28"></a><span id="l38.28">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l38.29"></a><span id="l38.29">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l38.30"></a><span id="l38.30">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l38.31"></a><span id="l38.31">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l38.32"></a><span id="l38.32">              [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]]</span>
<a href="#l38.33"></a><span id="l38.33"> </span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">-var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-var MODULE_REQUIRES = ['CalendarUtils', 'TimezoneUtils'];</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">-</span>
<a href="#l38.37"></a><span id="l38.37"> var setupModule = function(module) {</span>
<a href="#l38.38"></a><span id="l38.38">   controller = mozmill.getMail3PaneController();</span>
<a href="#l38.39"></a><span id="l38.39"> }</span>
<a href="#l38.40"></a><span id="l38.40"> </span>
<a href="#l38.41"></a><span id="l38.41"> var testTimezones9_checkKathmandu = function () {</span>
<a href="#l38.42"></a><span id="l38.42">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l38.43"></a><span id="l38.43">   </span>
<a href="#l38.44"></a><span id="l38.44">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineplus">+  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineplus">+  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l38.48"></a><span id="l38.48">   </span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-  CalendarUtils.switchToView(&quot;day&quot;, controller);</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-  CalendarUtils.goToDate(2009, 1, 1, controller);</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-  </span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-  TimezoneUtils.verify(dates, timezones, times, controller);</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineplus">+  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l38.54"></a><span id="l38.54"> }</span>
<a href="#l38.55"></a><span id="l38.55"> </span>
<a href="#l38.56"></a><span id="l38.56"> var teardownTest = function(module) {</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineminus">-  TimezoneUtils.switchAppTimezone(timezones[7], controller);</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineplus">+  timezoneUtils.switchAppTimezone(timezones[7]);</span>
<a href="#l38.59"></a><span id="l38.59"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

