<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29986:9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29" />
<meta property="og:url" content="/comm-central/rev/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29" />
<meta property="og:description" content="Bug 1648197 - Remove Skype code. r=khushil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">shortlog</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">files</a> |
changeset |
<a href="/comm-central/raw-rev/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">raw</a>  | <a href="/comm-central/archive/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648197">Bug 1648197</a> - Remove Skype code. r=khushil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#116;&#114;&#105;&#99;&#107;&#32;&#67;&#108;&#111;&#107;&#101;&#32;&#60;&#99;&#108;&#111;&#107;&#101;&#112;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 26 Jun 2020 13:33:47 +0300</td></tr>

<tr>
 <td>changeset 29986</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29</a></td>
</tr>



<tr>
<td>parent 29985</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8c8d9d0413bec934104b2eb7fcadcc9f156c7f24">8c8d9d0413bec934104b2eb7fcadcc9f156c7f24</a>
</td>
</tr>

<tr>
<td>child 29987</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/50d5257d603730a7c872210e64bd09909c368714">50d5257d603730a7c872210e64bd09909c368714</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29">17628</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Fri, 26 Jun 2020 10:39:43 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2ed0af82d827 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2ed0af82d827adc47871335b491a2e30870a9dd8">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2ed0af82d827adc47871335b491a2e30870a9dd8&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2ed0af82d827adc47871335b491a2e30870a9dd8&newProject=comm-central&newRevision=8c8d9d0413bec934104b2eb7fcadcc9f156c7f24&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2ed0af82d827adc47871335b491a2e30870a9dd8&newProject=comm-central&newRevision=8c8d9d0413bec934104b2eb7fcadcc9f156c7f24&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2ed0af82d827adc47871335b491a2e30870a9dd8&newProject=comm-central&newRevision=8c8d9d0413bec934104b2eb7fcadcc9f156c7f24&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28khushil%29&revcount=50">khushil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648197">1648197</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1648197">Bug 1648197</a> - Remove Skype code. r=khushil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/.eslintignore">file</a> |
<a href="/comm-central/annotate/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/.eslintignore">annotate</a> |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/.eslintignore">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/.eslintignore">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/chat-prefs.js">chat/chat-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/chat-prefs.js">file</a> |
<a href="/comm-central/annotate/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/chat-prefs.js">annotate</a> |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/chat-prefs.js">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/chat-prefs.js">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/chat-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/en-US/skype.properties">chat/locales/en-US/skype.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/en-US/skype.properties">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/en-US/skype.properties">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/en-US/skype.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/jar.mn">chat/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/BigInteger.jsm">chat/modules/BigInteger.jsm</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/BigInteger.jsm">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/BigInteger.jsm">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/BigInteger.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/moz.build">chat/modules/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/moz.build">file</a> |
<a href="/comm-central/annotate/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/moz.build">annotate</a> |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/moz.build">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/moz.build">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/modules/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/moz.build">chat/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/moz.build">file</a> |
<a href="/comm-central/annotate/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/moz.build">annotate</a> |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/moz.build">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/moz.build">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/components.conf">chat/protocols/skype/components.conf</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/components.conf">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/components.conf">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/components.conf">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-32.png">chat/protocols/skype/icons/prpl-skype-32.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-32.png">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-32.png">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-32.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-48.png">chat/protocols/skype/icons/prpl-skype-48.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-48.png">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-48.png">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype-48.png">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype.png">chat/protocols/skype/icons/prpl-skype.png</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype.png">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype.png">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/icons/prpl-skype.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/jar.mn">chat/protocols/skype/jar.mn</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/jar.mn">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/jar.mn">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/moz.build">chat/protocols/skype/moz.build</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/moz.build">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/moz.build">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/skype.jsm">chat/protocols/skype/skype.jsm</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/skype.jsm">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/skype.jsm">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/skype.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_MagicSha256.js">chat/protocols/skype/test/test_MagicSha256.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_MagicSha256.js">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_MagicSha256.js">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_MagicSha256.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_contactUrlToName.js">chat/protocols/skype/test/test_contactUrlToName.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_contactUrlToName.js">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_contactUrlToName.js">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/test_contactUrlToName.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/xpcshell.ini">chat/protocols/skype/test/xpcshell.ini</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/9c89f01b1df102025c9fe5fcad8b7fd4e8ce4b29/chat/protocols/skype/test/xpcshell.ini">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -30,17 +30,16 @@ suite/**</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> # calendar/ exclusions</span>
<a href="#l1.6"></a><span id="l1.6"> calendar/lightning/content/lightning.js</span>
<a href="#l1.7"></a><span id="l1.7"> calendar/base/modules/Ical.jsm</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> # chat exclusions</span>
<a href="#l1.10"></a><span id="l1.10"> chat/chat-prefs.js</span>
<a href="#l1.11"></a><span id="l1.11"> # third-party code</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-chat/modules/BigInteger.jsm</span>
<a href="#l1.13"></a><span id="l1.13"> chat/protocols/matrix/lib/**</span>
<a href="#l1.14"></a><span id="l1.14"> chat/protocols/twitter/twitter-text.jsm</span>
<a href="#l1.15"></a><span id="l1.15"> # preprocessed files</span>
<a href="#l1.16"></a><span id="l1.16"> chat/content/imtooltip.xml</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> # editor exclusions (most files not shipped with Thunderbird)</span>
<a href="#l1.19"></a><span id="l1.19"> editor/ui/composer.js</span>
<a href="#l1.20"></a><span id="l1.20"> editor/ui/composer/content/**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/chat-prefs.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/chat-prefs.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -77,18 +77,16 @@ pref(&quot;messenger.status.userDisplayName&quot;,</span>
<a href="#l2.4"></a><span id="l2.4"> // Default message used when quitting IRC. This is overridable per account.</span>
<a href="#l2.5"></a><span id="l2.5"> pref(&quot;chat.irc.defaultQuitMessage&quot;, &quot;&quot;);</span>
<a href="#l2.6"></a><span id="l2.6"> // If this is true, requestRooomInfo will return LIST results when it is</span>
<a href="#l2.7"></a><span id="l2.7"> // called automatically by the awesometab. Otherwise, requestRoomInfo will</span>
<a href="#l2.8"></a><span id="l2.8"> // only do so when explicitly requested by the user, e.g. via the /list command.</span>
<a href="#l2.9"></a><span id="l2.9"> pref(&quot;chat.irc.automaticList&quot;, true);</span>
<a href="#l2.10"></a><span id="l2.10"> // Whether to enable or disable message carbons protocol (XEP-0280).</span>
<a href="#l2.11"></a><span id="l2.11"> pref(&quot;chat.xmpp.messageCarbons&quot;, true);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-// Disable Skype until it can be tested further.</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-pref(&quot;chat.prpls.prpl-skype.disable&quot;, true);</span>
<a href="#l2.14"></a><span id="l2.14"> // Disable Facebook as the XMPP gateway no longer exists.</span>
<a href="#l2.15"></a><span id="l2.15"> pref(&quot;chat.prpls.prpl-facebook.disable&quot;, true);</span>
<a href="#l2.16"></a><span id="l2.16"> // Disable experimental Matrix support.</span>
<a href="#l2.17"></a><span id="l2.17"> pref(&quot;chat.prpls.prpl-matrix.disable&quot;, true);</span>
<a href="#l2.18"></a><span id="l2.18"> // Disable Twitter until support for the updated API is complete. See bug 1445778.</span>
<a href="#l2.19"></a><span id="l2.19"> pref(&quot;chat.prpls.prpl-twitter.disable&quot;, true);</span>
<a href="#l2.20"></a><span id="l2.20"> // Disable Yahoo Messenger as legacy Yahoo was shut down.</span>
<a href="#l2.21"></a><span id="l2.21"> pref(&quot;chat.prpls.prpl-yahoo.disable&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">deleted file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- a/chat/locales/en-US/skype.properties</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ /dev/null</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -1,14 +0,0 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-# LOCALIZATION NOTE (connection.*):</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-#   These will show in the account manager to show progress during a connection.</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-connecting.authenticating=Authenticating</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-connecting.registrationToken=Getting registration token</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-# LOCALIZATION NOTE (error.*):</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-#   These will show in the account manager if the account is disconnected</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-#   because of an error.</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-error.auth=Failed to authenticate to the server</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-error.registrationToken=Failed getting Registration Token</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/locales/jar.mn</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/locales/jar.mn</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -12,13 +12,12 @@</span>
<a href="#l4.4"></a><span id="l4.4"> 	locale/@AB_CD@/chat/commands.properties (%commands.properties)</span>
<a href="#l4.5"></a><span id="l4.5"> 	locale/@AB_CD@/chat/contacts.properties	(%contacts.properties)</span>
<a href="#l4.6"></a><span id="l4.6"> 	locale/@AB_CD@/chat/conversations.properties (%conversations.properties)</span>
<a href="#l4.7"></a><span id="l4.7"> 	locale/@AB_CD@/chat/dateFormat.properties (%dateFormat.properties)</span>
<a href="#l4.8"></a><span id="l4.8"> 	locale/@AB_CD@/chat/facebook.properties	(%facebook.properties)</span>
<a href="#l4.9"></a><span id="l4.9"> 	locale/@AB_CD@/chat/irc.properties	(%irc.properties)</span>
<a href="#l4.10"></a><span id="l4.10"> 	locale/@AB_CD@/chat/logger.properties	(%logger.properties)</span>
<a href="#l4.11"></a><span id="l4.11"> 	locale/@AB_CD@/chat/matrix.properties	(%matrix.properties)</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-	locale/@AB_CD@/chat/skype.properties	(%skype.properties)</span>
<a href="#l4.13"></a><span id="l4.13"> 	locale/@AB_CD@/chat/status.properties	(%status.properties)</span>
<a href="#l4.14"></a><span id="l4.14"> 	locale/@AB_CD@/chat/twitter.properties	(%twitter.properties)</span>
<a href="#l4.15"></a><span id="l4.15"> 	locale/@AB_CD@/chat/xmpp.properties	(%xmpp.properties)</span>
<a href="#l4.16"></a><span id="l4.16"> 	locale/@AB_CD@/chat/yahoo.properties	(%yahoo.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/chat/modules/BigInteger.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,689 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-/*</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">- * This is free and unencumbered software released into the public domain.</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">- *</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">- * Anyone is free to copy, modify, publish, use, compile, sell, or</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">- * distribute this software, either in source code form or as a compiled</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">- * binary, for any purpose, commercial or non-commercial, and by any</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">- * means.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">- *</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">- * In jurisdictions that recognize copyright laws, the author or authors</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">- * of this software dedicate any and all copyright interest in the</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">- * software to the public domain. We make this dedication for the benefit</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">- * of the public at large and to the detriment of our heirs and</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">- * successors. We intend this dedication to be an overt act of</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">- * relinquishment in perpetuity of all present and future rights to this</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">- * software under copyright law.</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">- *</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">- * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">- * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">- * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">- * OTHER DEALINGS IN THE SOFTWARE.</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">- *</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">- * For more information, please refer to &lt;http://unlicense.org&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">- */</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-&quot;use strict&quot;;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-const EXPORTED_SYMBOLS = [&quot;bigInt&quot;];</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-var bigInt = (function () {</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-    var base = 10000000, logBase = 7;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-    var sign = {</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-        positive: false,</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-        negative: true</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-    };</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-    function BigInteger(value, sign) {</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-        this.value = value;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-        this.sign = sign;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-    }</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-    function trim(value) {</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-        var i = value.length - 1;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        while (value[i] === 0 &amp;&amp; i &gt; 0) i--;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-        return value.slice(0, i + 1);</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-    }</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-    function fastAdd(a, b) {</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-        var sign = b &lt; 0;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-        if (a.sign !== sign) {</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-            if(sign) return fastSubtract(a.abs(), -b);</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-            return fastSubtract(a.abs(), b).negate();</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-        }</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-        if (sign) b = -b;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-        var value = a.value,</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-            result = [],</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-            carry = 0;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-        for (var i = 0; i &lt; value.length || carry &gt; 0; i++) {</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-            var sum = (value[i] || 0) + (i &gt; 0 ? 0 : b) + carry;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-            carry = sum &gt;= base ? 1 : 0;</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-            result.push(sum % base);</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-        }</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-        return new BigInteger(result, a.sign);</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-    }</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-    function fastSubtract(a, b) {</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-        if (a.sign !== (b &lt; 0)) return fastAdd(a, -b);</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-        var sign = false;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-        if (a.sign) sign = true;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-        var value = a.value;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-        if (value.length === 1 &amp;&amp; value[0] &lt; b) return new BigInteger([b - value[0]], !sign);</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-        if (sign) b = -b;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-        var result = [],</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-            borrow = 0;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-        for (var i = 0; i &lt; value.length; i++) {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-            var tmp = value[i] - borrow - (i &gt; 0 ? 0 : b);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-            borrow = tmp &lt; 0 ? 1 : 0;</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-            result.push((borrow * base) + tmp);</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-        }</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-        return new BigInteger(result, sign);</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-    }</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-    function fastMultiply(a, b) {</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-        var value = a.value,</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-            sign = b &lt; 0,</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-            result = [],</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-            carry = 0;</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-        if (sign) b = -b;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-        for (var i = 0; i &lt; value.length || carry &gt; 0; i++) {</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-            var product = (value[i] || 0) * b + carry;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-            carry = (product / base) | 0;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-            result.push(product % base);</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-        }</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-        return new BigInteger(result, sign ? !a.sign : a.sign);</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-    }</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-    function fastDivMod(a, b) {</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-        if (b === 0) throw new Error(&quot;Cannot divide by zero.&quot;);</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-        var value = a.value,</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-            sign = b &lt; 0,</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-            result = [],</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-            remainder = 0;</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-        if (sign) b = -b;</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-        for (var i = value.length - 1; i &gt;= 0; i--) {</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-            var divisor = remainder * base + value[i];</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-            remainder = divisor % b;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-            result.push(divisor / b | 0);</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-        }</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-        return {</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-            quotient: new BigInteger(trim(result.reverse()), sign ? !a.sign : a.sign),</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineminus">-            remainder: new BigInteger([remainder], a.sign)</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-        };</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-    }</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-    function isSmall(n) {</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-        return ((typeof n === &quot;number&quot; || typeof n === &quot;string&quot;) &amp;&amp; +n &lt;= base) ||</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-            (n instanceof BigInteger &amp;&amp; n.value.length &lt;= 1);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-    }</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-    BigInteger.prototype.negate = function () {</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-        return new BigInteger(this.value, !this.sign);</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-    };</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-    BigInteger.prototype.abs = function () {</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-        return new BigInteger(this.value, sign.positive);</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-    };</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-    BigInteger.prototype.add = function (n) {</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-        if(isSmall(n)) return fastAdd(this, +n);</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-        if (this.sign !== n.sign) {</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-            if (this.sign === sign.positive) return this.abs().subtract(n.abs());</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-            return n.abs().subtract(this.abs());</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-        }</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-        var a = this.value, b = n.value;</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-        var result = [],</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-            carry = 0,</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-            length = Math.max(a.length, b.length);</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-        for (var i = 0; i &lt; length || carry &gt; 0; i++) {</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-            var sum = (a[i] || 0) + (b[i] || 0) + carry;</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-            carry = sum &gt;= base ? 1 : 0;</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-            result.push(sum % base);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-        }</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-        return new BigInteger(trim(result), this.sign);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-    };</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-    BigInteger.prototype.plus = function (n) {</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-        return this.add(n);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-    };</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-    BigInteger.prototype.subtract = function (n) {</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-        if (isSmall(n)) return fastSubtract(this, +n);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-        if (this.sign !== n.sign) return this.add(n.negate());</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-        if (this.sign === sign.negative) return n.negate().subtract(this.negate());</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-        if (this.compare(n) &lt; 0) return n.subtract(this).negate();</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-        var a = this.value, b = n.value;</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-        var result = [],</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-            borrow = 0,</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-            length = Math.max(a.length, b.length);</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-        for (var i = 0; i &lt; length; i++) {</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-            var ai = a[i] || 0, bi = b[i] || 0;</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-            var tmp = ai - borrow;</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-            borrow = tmp &lt; bi ? 1 : 0;</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-            result.push((borrow * base) + tmp - bi);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-        }</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-        return new BigInteger(trim(result), sign.positive);</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-    };</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-    BigInteger.prototype.minus = function (n) {</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-        return this.subtract(n);</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-    };</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineminus">-    BigInteger.prototype.multiply = function (n) {</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-        if (isSmall(n)) return fastMultiply(this, +n);</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-        var sign = this.sign !== n.sign;</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineminus">-</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-        var a = this.value, b = n.value;</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineminus">-        var length = Math.max(a.length, b.length);</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-        var resultSum = [];</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineminus">-        for (var i = 0; i &lt; length; i++) {</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-            resultSum[i] = [];</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineminus">-            var j = i;</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineminus">-            while (j--) {</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-                resultSum[i].push(0);</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-            }</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-        }</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-        var carry = 0;</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-        for (var i = 0; i &lt; a.length; i++) {</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-            var x = a[i];</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-            for (var j = 0; j &lt; b.length || carry &gt; 0; j++) {</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-                var y = b[j];</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineminus">-                var product = y ? (x * y) + carry : carry;</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineminus">-                carry = Math.floor(product / base);</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineminus">-                resultSum[i].push(product % base);</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineminus">-            }</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-        }</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-        var max = -1;</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineminus">-        for (var i = 0; i &lt; resultSum.length; i++) {</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineminus">-            var len = resultSum[i].length;</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-            if (len &gt; max) max = len;</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineminus">-        }</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-        var result = [], carry = 0;</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-        for (var i = 0; i &lt; max || carry &gt; 0; i++) {</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineminus">-            var sum = carry;</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineminus">-            for (var j = 0; j &lt; resultSum.length; j++) {</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineminus">-                sum += resultSum[j][i] || 0;</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineminus">-            }</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineminus">-            carry = sum &gt; base ? Math.floor(sum / base) : 0;</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineminus">-            sum -= carry * base;</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineminus">-            result.push(sum);</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineminus">-        }</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineminus">-        return new BigInteger(trim(result), sign);</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineminus">-    };</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineminus">-    BigInteger.prototype.times = function (n) {</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineminus">-        return this.multiply(n);</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineminus">-    };</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineminus">-    BigInteger.prototype.divmod = function (n) {</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineminus">-        if (isSmall(n)) return fastDivMod(this, +n);</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineminus">-        var quotientSign = this.sign !== n.sign;</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineminus">-        if (this.equals(0)) return {</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-            quotient: new BigInteger([0], sign.positive),</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineminus">-            remainder: new BigInteger([0], sign.positive)</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineminus">-        };</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineminus">-        if (n.equals(0)) throw new Error(&quot;Cannot divide by zero&quot;);</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineminus">-        var a = this.value, b = n.value;</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineminus">-        var result = [], remainder = [];</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineminus">-        for (var i = a.length - 1; i &gt;= 0; i--) {</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineminus">-            var m = [a[i]].concat(remainder);</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineminus">-            var quotient = goesInto(b, m);</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineminus">-            result.push(quotient.result);</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineminus">-            remainder = quotient.remainder;</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineminus">-        }</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineminus">-        result.reverse();</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineminus">-        return {</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineminus">-            quotient: new BigInteger(trim(result), quotientSign),</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineminus">-            remainder: new BigInteger(trim(remainder), this.sign)</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-        };</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineminus">-    };</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineminus">-    BigInteger.prototype.divide = function (n) {</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineminus">-        return this.divmod(n).quotient;</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-    };</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-    BigInteger.prototype.over = function (n) {</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineminus">-        return this.divide(n);</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineminus">-    };</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineminus">-    BigInteger.prototype.mod = function (n) {</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineminus">-        return this.divmod(n).remainder;</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineminus">-    };</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineminus">-    BigInteger.prototype.remainder = function (n) {</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineminus">-        return this.mod(n);</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineminus">-    };</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineminus">-    BigInteger.prototype.pow = function (n) {</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineminus">-        var a = this, b = n, r = ONE;</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineminus">-        if (b.equals(ZERO)) return r;</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineminus">-        if (a.equals(ZERO) || b.lesser(ZERO)) return ZERO;</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineminus">-        while (true) {</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineminus">-            if (b.isOdd()) {</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineminus">-                r = r.times(a);</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineminus">-            }</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineminus">-            b = b.divide(2);</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineminus">-            if (b.equals(ZERO)) break;</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineminus">-            a = a.times(a);</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineminus">-        }</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineminus">-        return r;</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineminus">-    };</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineminus">-    BigInteger.prototype.modPow = function (exp, mod) {</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineminus">-        exp = parseInput(exp);</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineminus">-        mod = parseInput(mod);</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-        if (mod.equals(ZERO)) throw new Error(&quot;Cannot take modPow with modulus 0&quot;);</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineminus">-        var r = ONE,</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineminus">-            base = this.mod(mod);</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineminus">-        if (base.equals(ZERO)) return ZERO;</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineminus">-        while (exp.greater(0)) {</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineminus">-            if (exp.isOdd()) r = r.multiply(base).mod(mod);</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineminus">-            exp = exp.divide(2);</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineminus">-            base = base.square().mod(mod);</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineminus">-        }</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineminus">-        return r;</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineminus">-    };</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineminus">-    BigInteger.prototype.square = function () {</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineminus">-        return this.multiply(this);</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineminus">-    };</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineminus">-    function gcd(a, b) {</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineminus">-        a = parseInput(a).abs();</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineminus">-        b = parseInput(b).abs();</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineminus">-        if (a.equals(b)) return a;</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineminus">-        if (a.equals(ZERO)) return b;</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineminus">-        if (b.equals(ZERO)) return a;</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineminus">-        if (a.isEven()) {</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineminus">-            if (b.isOdd()) {</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineminus">-                return gcd(a.divide(2), b);</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineminus">-            }</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineminus">-            return gcd(a.divide(2), b.divide(2)).multiply(2);</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineminus">-        }</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineminus">-        if (b.isEven()) {</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineminus">-            return gcd(a, b.divide(2));</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineminus">-        }</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineminus">-        if (a.greater(b)) {</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineminus">-            return gcd(a.subtract(b).divide(2), b);</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineminus">-        }</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineminus">-        return gcd(b.subtract(a).divide(2), a);</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineminus">-    }</span>
<a href="#l5.307"></a><span id="l5.307" class="difflineminus">-    function lcm(a, b) {</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineminus">-        a = parseInput(a).abs();</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineminus">-        b = parseInput(b).abs();</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineminus">-        return a.multiply(b).divide(gcd(a, b));</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineminus">-    }</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineminus">-    BigInteger.prototype.next = function () {</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineminus">-        return fastAdd(this, 1);</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineminus">-    };</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineminus">-    BigInteger.prototype.prev = function () {</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-        return fastSubtract(this, 1);</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineminus">-    };</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineminus">-    BigInteger.prototype.compare = function (n) {</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineminus">-        var first = this, second = parseInput(n);</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineminus">-        if (first.value.length === 1 &amp;&amp; second.value.length === 1 &amp;&amp; first.value[0] === 0 &amp;&amp; second.value[0] === 0) return 0;</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineminus">-        if (second.sign !== first.sign) return first.sign === sign.positive ? 1 : -1;</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineminus">-        var multiplier = first.sign === sign.positive ? 1 : -1;</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineminus">-        var a = first.value, b = second.value,</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineminus">-            length = Math.max(a.length, b.length) - 1;</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineminus">-        for (var i = length; i &gt;= 0; i--) {</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineminus">-            var ai = (a[i] || 0), bi = (b[i] || 0);</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineminus">-            if (ai &gt; bi) return 1 * multiplier;</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineminus">-            if (bi &gt; ai) return -1 * multiplier;</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-        }</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineminus">-        return 0;</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineminus">-    };</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineminus">-    BigInteger.prototype.compareTo = function (n) {</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineminus">-        return this.compare(n);</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineminus">-    };</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineminus">-    BigInteger.prototype.compareAbs = function (n) {</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineminus">-        return this.abs().compare(n.abs());</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineminus">-    };</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineminus">-    BigInteger.prototype.equals = function (n) {</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineminus">-        return this.compare(n) === 0;</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineminus">-    };</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineminus">-    BigInteger.prototype.notEquals = function (n) {</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineminus">-        return !this.equals(n);</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineminus">-    };</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineminus">-    BigInteger.prototype.lesser = function (n) {</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineminus">-        return this.compare(n) &lt; 0;</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineminus">-    };</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineminus">-    BigInteger.prototype.greater = function (n) {</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineminus">-        return this.compare(n) &gt; 0;</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineminus">-    };</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineminus">-    BigInteger.prototype.greaterOrEquals = function (n) {</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineminus">-        return this.compare(n) &gt;= 0;</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineminus">-    };</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineminus">-    BigInteger.prototype.lesserOrEquals = function (n) {</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineminus">-        return this.compare(n) &lt;= 0;</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineminus">-    };</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineminus">-</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineminus">-    BigInteger.prototype.lt = BigInteger.prototype.lesser;</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineminus">-    BigInteger.prototype.leq = BigInteger.prototype.lesserOrEquals;</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineminus">-    BigInteger.prototype.gt = BigInteger.prototype.greater;</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineminus">-    BigInteger.prototype.geq = BigInteger.prototype.greaterOrEquals;</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineminus">-    BigInteger.prototype.eq = BigInteger.prototype.equals;</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineminus">-    BigInteger.prototype.neq = BigInteger.prototype.notEquals;</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineminus">-</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineminus">-    function max (a, b) {</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineminus">-        a = parseInput(a);</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineminus">-        b = parseInput(b);</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineminus">-        return a.greater(b) ? a : b;</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineminus">-    }</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineminus">-    function min (a, b) {</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineminus">-        a = parseInput(a);</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineminus">-        b = parseInput(b);</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineminus">-        return a.lesser(b) ? a : b;</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineminus">-    }</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineminus">-    BigInteger.prototype.isPositive = function () {</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineminus">-        return this.sign === sign.positive;</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineminus">-    };</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineminus">-    BigInteger.prototype.isNegative = function () {</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineminus">-        return this.sign === sign.negative;</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineminus">-    };</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineminus">-    BigInteger.prototype.isEven = function () {</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineminus">-        return this.value[0] % 2 === 0;</span>
<a href="#l5.382"></a><span id="l5.382" class="difflineminus">-    };</span>
<a href="#l5.383"></a><span id="l5.383" class="difflineminus">-    BigInteger.prototype.isOdd = function () {</span>
<a href="#l5.384"></a><span id="l5.384" class="difflineminus">-        return this.value[0] % 2 === 1;</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineminus">-    };</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineminus">-    BigInteger.prototype.isUnit = function () {</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineminus">-        return this.value.length === 1 &amp;&amp; this.value[0] === 1;</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineminus">-    };</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineminus">-    BigInteger.prototype.isDivisibleBy = function (n) {</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineminus">-        return this.mod(n).equals(ZERO);</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineminus">-    };</span>
<a href="#l5.392"></a><span id="l5.392" class="difflineminus">-    BigInteger.prototype.isPrime = function () {</span>
<a href="#l5.393"></a><span id="l5.393" class="difflineminus">-        var n = this.abs(),</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineminus">-            nPrev = n.prev();</span>
<a href="#l5.395"></a><span id="l5.395" class="difflineminus">-        if (n.isUnit()) return false;</span>
<a href="#l5.396"></a><span id="l5.396" class="difflineminus">-        if (n.equals(2) || n.equals(3) || n.equals(5)) return true;</span>
<a href="#l5.397"></a><span id="l5.397" class="difflineminus">-        if (n.isEven() || n.isDivisibleBy(3) || n.isDivisibleBy(5)) return false;</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineminus">-        if (n.lesser(25)) return true;</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineminus">-        var a = [2, 3, 5, 7, 11, 13, 17, 19],</span>
<a href="#l5.400"></a><span id="l5.400" class="difflineminus">-            b = nPrev,</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineminus">-            d, t, i, x;</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineminus">-        while (b.isEven()) b = b.divide(2);</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineminus">-        for (i = 0; i &lt; a.length; i++) {</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineminus">-            x = bigInt(a[i]).modPow(b, n);</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineminus">-            if (x.equals(ONE) || x.equals(nPrev)) continue;</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineminus">-            for (t = true, d = b; t &amp;&amp; d.lesser(nPrev); d = d.multiply(2)) {</span>
<a href="#l5.407"></a><span id="l5.407" class="difflineminus">-                x = x.square().mod(n);</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineminus">-                if (x.equals(nPrev)) t = false;</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineminus">-            }</span>
<a href="#l5.410"></a><span id="l5.410" class="difflineminus">-            if (t) return false;</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineminus">-        }</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineminus">-        return true;</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineminus">-    };</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineminus">-    function randBetween (a, b) {</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineminus">-        a = parseInput(a);</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineminus">-        b = parseInput(b);</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineminus">-        var low = min(a, b), high = max(a, b);</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineminus">-        var range = high.subtract(low);</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineminus">-        var length = range.value.length - 1;</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineminus">-        var result = [], restricted = true;</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineminus">-        for (var i = length; i &gt;= 0; i--) {</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineminus">-            var top = restricted ? range.value[i] : base;</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineminus">-            var digit = Math.floor(Math.random() * top);</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineminus">-            result.unshift(digit);</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineminus">-            if (digit &lt; top) restricted = false;</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineminus">-        }</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineminus">-        return low.add(new BigInteger(result, false));</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineminus">-    }</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineminus">-</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineminus">-    var powersOfTwo = [1];</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineminus">-    while (powersOfTwo[powersOfTwo.length - 1] &lt;= base) powersOfTwo.push(2 * powersOfTwo[powersOfTwo.length - 1]);</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineminus">-    var powers2Length = powersOfTwo.length, highestPower2 = powersOfTwo[powers2Length - 1];</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineminus">-</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineminus">-    BigInteger.prototype.shiftLeft = function (n) {</span>
<a href="#l5.435"></a><span id="l5.435" class="difflineminus">-        if (!isSmall(n)) {</span>
<a href="#l5.436"></a><span id="l5.436" class="difflineminus">-            if (n.isNegative()) return this.shiftRight(n.abs());</span>
<a href="#l5.437"></a><span id="l5.437" class="difflineminus">-            return this.times(bigInt(2).pow(n));</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineminus">-        }</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineminus">-        n = +n;</span>
<a href="#l5.440"></a><span id="l5.440" class="difflineminus">-        if (n &lt; 0) return this.shiftRight(-n);</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineminus">-        var result = this;</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineminus">-        while (n &gt;= powers2Length) {</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineminus">-            result = fastMultiply(result, highestPower2);</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineminus">-            n -= powers2Length - 1;</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineminus">-        }</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineminus">-        return fastMultiply(result, powersOfTwo[n]);</span>
<a href="#l5.447"></a><span id="l5.447" class="difflineminus">-    };</span>
<a href="#l5.448"></a><span id="l5.448" class="difflineminus">-</span>
<a href="#l5.449"></a><span id="l5.449" class="difflineminus">-    BigInteger.prototype.shiftRight = function (n) {</span>
<a href="#l5.450"></a><span id="l5.450" class="difflineminus">-        if (!isSmall(n)) {</span>
<a href="#l5.451"></a><span id="l5.451" class="difflineminus">-            if (n.isNegative()) return this.shiftLeft(n.abs());</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineminus">-            return this.over(bigInt(2).pow(n));</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineminus">-        }</span>
<a href="#l5.454"></a><span id="l5.454" class="difflineminus">-        n = +n;</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineminus">-        if (n &lt; 0) return this.shiftLeft(-n);</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineminus">-        var result = this;</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-        while (n &gt;= powers2Length) {</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineminus">-            if (result.equals(ZERO)) return result;</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineminus">-            result = fastDivMod(result, highestPower2).quotient;</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineminus">-            n -= powers2Length - 1;</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineminus">-        }</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineminus">-        return fastDivMod(result, powersOfTwo[n]).quotient;</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineminus">-    };</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineminus">-</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineminus">-    // Reference: http://en.wikipedia.org/wiki/Bitwise_operation#Mathematical_equivalents</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineminus">-    function bitwise(x, y, fn) {</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineminus">-        var sum = ZERO;</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineminus">-        var limit = max(x.abs(), y.abs());</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineminus">-        var n = 0, _2n = ONE;</span>
<a href="#l5.470"></a><span id="l5.470" class="difflineminus">-        while (_2n.lesserOrEquals(limit)) {</span>
<a href="#l5.471"></a><span id="l5.471" class="difflineminus">-            var xMod, yMod;</span>
<a href="#l5.472"></a><span id="l5.472" class="difflineminus">-            xMod = x.over(_2n).isEven() ? 0 : 1;</span>
<a href="#l5.473"></a><span id="l5.473" class="difflineminus">-            yMod = y.over(_2n).isEven() ? 0 : 1;</span>
<a href="#l5.474"></a><span id="l5.474" class="difflineminus">-</span>
<a href="#l5.475"></a><span id="l5.475" class="difflineminus">-            sum = sum.add(_2n.times(fn(xMod, yMod)));</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineminus">-</span>
<a href="#l5.477"></a><span id="l5.477" class="difflineminus">-            _2n = fastMultiply(_2n, 2);</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineminus">-        }</span>
<a href="#l5.479"></a><span id="l5.479" class="difflineminus">-        return sum;</span>
<a href="#l5.480"></a><span id="l5.480" class="difflineminus">-    }</span>
<a href="#l5.481"></a><span id="l5.481" class="difflineminus">-</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineminus">-    BigInteger.prototype.not = function () {</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineminus">-        var body = bitwise(this, this, function (xMod) { return (xMod + 1) % 2; });</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineminus">-        return !this.sign ? body.negate() : body;</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineminus">-    };</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineminus">-</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineminus">-    BigInteger.prototype.and = function (n) {</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineminus">-        var body = bitwise(this, n, function (xMod, yMod) { return xMod * yMod; });</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineminus">-        return this.sign &amp;&amp; n.sign ? body.negate() : body;</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineminus">-    };</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineminus">-</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineminus">-    BigInteger.prototype.or = function (n) {</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineminus">-        var body = bitwise(this, n, function (xMod, yMod) { return (xMod + yMod + xMod * yMod) % 2 });</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineminus">-        return this.sign || n.sign ? body.negate() : body;</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineminus">-    };</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineminus">-</span>
<a href="#l5.499"></a><span id="l5.499" class="difflineminus">-    BigInteger.prototype.xor = function (n) {</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineminus">-        n = parseInput(n);</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineminus">-        var body = bitwise(this, n, function (xMod, yMod) { return (xMod + yMod) % 2; });</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineminus">-        return this.sign ^ n.sign ? body.negate() : body;</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineminus">-    };</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineminus">-</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineminus">-    BigInteger.prototype.toString = function (radix) {</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineminus">-        if (radix === undefined) {</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineminus">-            radix = 10;</span>
<a href="#l5.508"></a><span id="l5.508" class="difflineminus">-        }</span>
<a href="#l5.509"></a><span id="l5.509" class="difflineminus">-        if (radix !== 10) return toBase(this, radix);</span>
<a href="#l5.510"></a><span id="l5.510" class="difflineminus">-        var first = this;</span>
<a href="#l5.511"></a><span id="l5.511" class="difflineminus">-        var str = &quot;&quot;, len = first.value.length;</span>
<a href="#l5.512"></a><span id="l5.512" class="difflineminus">-        if (len === 0) {</span>
<a href="#l5.513"></a><span id="l5.513" class="difflineminus">-            return &quot;0&quot;;</span>
<a href="#l5.514"></a><span id="l5.514" class="difflineminus">-        }</span>
<a href="#l5.515"></a><span id="l5.515" class="difflineminus">-        while (len--) {</span>
<a href="#l5.516"></a><span id="l5.516" class="difflineminus">-            if (first.value[len].toString().length === 8) str += first.value[len];</span>
<a href="#l5.517"></a><span id="l5.517" class="difflineminus">-            else str += (base.toString() + first.value[len]).slice(-logBase);</span>
<a href="#l5.518"></a><span id="l5.518" class="difflineminus">-        }</span>
<a href="#l5.519"></a><span id="l5.519" class="difflineminus">-        while (str[0] === &quot;0&quot;) {</span>
<a href="#l5.520"></a><span id="l5.520" class="difflineminus">-            str = str.slice(1);</span>
<a href="#l5.521"></a><span id="l5.521" class="difflineminus">-        }</span>
<a href="#l5.522"></a><span id="l5.522" class="difflineminus">-        if (!str.length) str = &quot;0&quot;;</span>
<a href="#l5.523"></a><span id="l5.523" class="difflineminus">-        if (str === &quot;0&quot;) return str;</span>
<a href="#l5.524"></a><span id="l5.524" class="difflineminus">-        var s = first.sign === sign.positive ? &quot;&quot; : &quot;-&quot;;</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineminus">-        return s + str;</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineminus">-    };</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineminus">-    BigInteger.prototype.toJSNumber = function () {</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineminus">-        return this.valueOf();</span>
<a href="#l5.529"></a><span id="l5.529" class="difflineminus">-    };</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineminus">-    BigInteger.prototype.valueOf = function () {</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineminus">-        if (this.value.length === 1) return this.sign ? -this.value[0] : this.value[0];</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineminus">-        return +this.toString();</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineminus">-    };</span>
<a href="#l5.534"></a><span id="l5.534" class="difflineminus">-</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineminus">-    var goesInto = function (a, b) {</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineminus">-        var a = new BigInteger(a, sign.positive), b = new BigInteger(b, sign.positive);</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineminus">-        if (a.equals(0)) throw new Error(&quot;Cannot divide by 0&quot;);</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineminus">-        var n = 0;</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineminus">-        do {</span>
<a href="#l5.540"></a><span id="l5.540" class="difflineminus">-            var inc = 1;</span>
<a href="#l5.541"></a><span id="l5.541" class="difflineminus">-            var c = a, t = c.times(10);</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineminus">-            while (t.lesser(b)) {</span>
<a href="#l5.543"></a><span id="l5.543" class="difflineminus">-                c = t;</span>
<a href="#l5.544"></a><span id="l5.544" class="difflineminus">-                inc *= 10;</span>
<a href="#l5.545"></a><span id="l5.545" class="difflineminus">-                t = t.times(10);</span>
<a href="#l5.546"></a><span id="l5.546" class="difflineminus">-            }</span>
<a href="#l5.547"></a><span id="l5.547" class="difflineminus">-            while (c.lesserOrEquals(b)) {</span>
<a href="#l5.548"></a><span id="l5.548" class="difflineminus">-                b = b.minus(c);</span>
<a href="#l5.549"></a><span id="l5.549" class="difflineminus">-                n += inc;</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineminus">-            }</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineminus">-        } while (a.lesserOrEquals(b));</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineminus">-</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineminus">-        return {</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineminus">-            remainder: b.value,</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineminus">-            result: n</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineminus">-        };</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineminus">-    };</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineminus">-</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineminus">-    var ZERO = new BigInteger([0], sign.positive);</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineminus">-    var ONE = new BigInteger([1], sign.positive);</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineminus">-    var MINUS_ONE = new BigInteger([1], sign.negative);</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineminus">-</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineminus">-</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineminus">-    function parseInput(text) {</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineminus">-        if (text instanceof BigInteger) return text;</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineminus">-        if (Math.abs(+text) &lt; base &amp;&amp; +text === (+text | 0)) {</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineminus">-            var value = +text;</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineminus">-            return new BigInteger([Math.abs(value)], (value &lt; 0 || (1 / value) === -Infinity));</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineminus">-        }</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineminus">-        text += &quot;&quot;;</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineminus">-        var s = sign.positive, value = [];</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineminus">-        if (text[0] === &quot;-&quot;) {</span>
<a href="#l5.573"></a><span id="l5.573" class="difflineminus">-            s = sign.negative;</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineminus">-            text = text.slice(1);</span>
<a href="#l5.575"></a><span id="l5.575" class="difflineminus">-        }</span>
<a href="#l5.576"></a><span id="l5.576" class="difflineminus">-        var text = text.split(/e/i);</span>
<a href="#l5.577"></a><span id="l5.577" class="difflineminus">-        if (text.length &gt; 2) throw new Error(&quot;Invalid integer: &quot; + text.join(&quot;e&quot;));</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineminus">-        if (text[1]) {</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineminus">-            var exp = text[1];</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineminus">-            if (exp[0] === &quot;+&quot;) exp = exp.slice(1);</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineminus">-            exp = parseInput(exp);</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineminus">-            if (exp.lesser(0)) throw new Error(&quot;Cannot include negative exponent part for integers&quot;);</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineminus">-            while (exp.notEquals(0)) {</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineminus">-                text[0] += &quot;0&quot;;</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineminus">-                exp = exp.prev();</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineminus">-            }</span>
<a href="#l5.587"></a><span id="l5.587" class="difflineminus">-        }</span>
<a href="#l5.588"></a><span id="l5.588" class="difflineminus">-        text = text[0];</span>
<a href="#l5.589"></a><span id="l5.589" class="difflineminus">-        if (text === &quot;-0&quot;) text = &quot;0&quot;;</span>
<a href="#l5.590"></a><span id="l5.590" class="difflineminus">-        var isValid = /^([0-9][0-9]*)$/.test(text);</span>
<a href="#l5.591"></a><span id="l5.591" class="difflineminus">-        if (!isValid) throw new Error(&quot;Invalid integer: &quot; + text);</span>
<a href="#l5.592"></a><span id="l5.592" class="difflineminus">-        while (text.length) {</span>
<a href="#l5.593"></a><span id="l5.593" class="difflineminus">-            var divider = text.length &gt; logBase ? text.length - logBase : 0;</span>
<a href="#l5.594"></a><span id="l5.594" class="difflineminus">-            value.push(+text.slice(divider));</span>
<a href="#l5.595"></a><span id="l5.595" class="difflineminus">-            text = text.slice(0, divider);</span>
<a href="#l5.596"></a><span id="l5.596" class="difflineminus">-        }</span>
<a href="#l5.597"></a><span id="l5.597" class="difflineminus">-        return new BigInteger(value, s);</span>
<a href="#l5.598"></a><span id="l5.598" class="difflineminus">-    }</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineminus">-</span>
<a href="#l5.600"></a><span id="l5.600" class="difflineminus">-    var parseBase = function (text, base) {</span>
<a href="#l5.601"></a><span id="l5.601" class="difflineminus">-        base = parseInput(base);</span>
<a href="#l5.602"></a><span id="l5.602" class="difflineminus">-        var val = ZERO;</span>
<a href="#l5.603"></a><span id="l5.603" class="difflineminus">-        var digits = [];</span>
<a href="#l5.604"></a><span id="l5.604" class="difflineminus">-        var i;</span>
<a href="#l5.605"></a><span id="l5.605" class="difflineminus">-        var isNegative = false;</span>
<a href="#l5.606"></a><span id="l5.606" class="difflineminus">-        function parseToken(text) {</span>
<a href="#l5.607"></a><span id="l5.607" class="difflineminus">-            var c = text[i].toLowerCase();</span>
<a href="#l5.608"></a><span id="l5.608" class="difflineminus">-            if (i === 0 &amp;&amp; text[i] === &quot;-&quot;) {</span>
<a href="#l5.609"></a><span id="l5.609" class="difflineminus">-                isNegative = true;</span>
<a href="#l5.610"></a><span id="l5.610" class="difflineminus">-                return;</span>
<a href="#l5.611"></a><span id="l5.611" class="difflineminus">-            }</span>
<a href="#l5.612"></a><span id="l5.612" class="difflineminus">-            if (/[0-9]/.test(c)) digits.push(parseInput(c));</span>
<a href="#l5.613"></a><span id="l5.613" class="difflineminus">-            else if (/[a-z]/.test(c)) digits.push(parseInput(c.charCodeAt(0) - 87));</span>
<a href="#l5.614"></a><span id="l5.614" class="difflineminus">-            else if (c === &quot;&lt;&quot;) {</span>
<a href="#l5.615"></a><span id="l5.615" class="difflineminus">-                var start = i;</span>
<a href="#l5.616"></a><span id="l5.616" class="difflineminus">-                do { i++; } while (text[i] !== &quot;&gt;&quot;);</span>
<a href="#l5.617"></a><span id="l5.617" class="difflineminus">-                digits.push(parseInput(text.slice(start + 1, i)));</span>
<a href="#l5.618"></a><span id="l5.618" class="difflineminus">-            }</span>
<a href="#l5.619"></a><span id="l5.619" class="difflineminus">-            else throw new Error(c + &quot; is not a valid character&quot;);</span>
<a href="#l5.620"></a><span id="l5.620" class="difflineminus">-        }</span>
<a href="#l5.621"></a><span id="l5.621" class="difflineminus">-        for (i = 0; i &lt; text.length; i++) {</span>
<a href="#l5.622"></a><span id="l5.622" class="difflineminus">-            parseToken(text);</span>
<a href="#l5.623"></a><span id="l5.623" class="difflineminus">-        }</span>
<a href="#l5.624"></a><span id="l5.624" class="difflineminus">-        digits.reverse();</span>
<a href="#l5.625"></a><span id="l5.625" class="difflineminus">-        for (i = 0; i &lt; digits.length; i++) {</span>
<a href="#l5.626"></a><span id="l5.626" class="difflineminus">-            val = val.add(digits[i].times(base.pow(i)));</span>
<a href="#l5.627"></a><span id="l5.627" class="difflineminus">-        }</span>
<a href="#l5.628"></a><span id="l5.628" class="difflineminus">-        return isNegative ? val.negate() : val;</span>
<a href="#l5.629"></a><span id="l5.629" class="difflineminus">-    };</span>
<a href="#l5.630"></a><span id="l5.630" class="difflineminus">-</span>
<a href="#l5.631"></a><span id="l5.631" class="difflineminus">-    function stringify(digit) {</span>
<a href="#l5.632"></a><span id="l5.632" class="difflineminus">-        var v = digit.value;</span>
<a href="#l5.633"></a><span id="l5.633" class="difflineminus">-        if (v.length === 1 &amp;&amp; v[0] &lt;= 36) {</span>
<a href="#l5.634"></a><span id="l5.634" class="difflineminus">-            return &quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;.charAt(v[0]);</span>
<a href="#l5.635"></a><span id="l5.635" class="difflineminus">-        }</span>
<a href="#l5.636"></a><span id="l5.636" class="difflineminus">-        return &quot;&lt;&quot; + v + &quot;&gt;&quot;;</span>
<a href="#l5.637"></a><span id="l5.637" class="difflineminus">-    }</span>
<a href="#l5.638"></a><span id="l5.638" class="difflineminus">-</span>
<a href="#l5.639"></a><span id="l5.639" class="difflineminus">-    function toBase(n, base) {</span>
<a href="#l5.640"></a><span id="l5.640" class="difflineminus">-        base = bigInt(base);</span>
<a href="#l5.641"></a><span id="l5.641" class="difflineminus">-        if (base.equals(0)) {</span>
<a href="#l5.642"></a><span id="l5.642" class="difflineminus">-            if (n.equals(0)) return &quot;0&quot;;</span>
<a href="#l5.643"></a><span id="l5.643" class="difflineminus">-            throw new Error(&quot;Cannot convert nonzero numbers to base 0.&quot;);</span>
<a href="#l5.644"></a><span id="l5.644" class="difflineminus">-        }</span>
<a href="#l5.645"></a><span id="l5.645" class="difflineminus">-        if (base.equals(-1)) {</span>
<a href="#l5.646"></a><span id="l5.646" class="difflineminus">-            if (n.equals(0)) return &quot;0&quot;;</span>
<a href="#l5.647"></a><span id="l5.647" class="difflineminus">-            if (n.lesser(0)) return Array(1 - n).join(&quot;10&quot;);</span>
<a href="#l5.648"></a><span id="l5.648" class="difflineminus">-            return &quot;1&quot; + Array(+n).join(&quot;01&quot;);</span>
<a href="#l5.649"></a><span id="l5.649" class="difflineminus">-        }</span>
<a href="#l5.650"></a><span id="l5.650" class="difflineminus">-        var minusSign = &quot;&quot;;</span>
<a href="#l5.651"></a><span id="l5.651" class="difflineminus">-        if (n.isNegative() &amp;&amp; base.isPositive()) {</span>
<a href="#l5.652"></a><span id="l5.652" class="difflineminus">-            minusSign = &quot;-&quot;;</span>
<a href="#l5.653"></a><span id="l5.653" class="difflineminus">-            n = n.abs();</span>
<a href="#l5.654"></a><span id="l5.654" class="difflineminus">-        }</span>
<a href="#l5.655"></a><span id="l5.655" class="difflineminus">-        if (base.equals(1)) {</span>
<a href="#l5.656"></a><span id="l5.656" class="difflineminus">-            if (n.equals(0)) return &quot;0&quot;;</span>
<a href="#l5.657"></a><span id="l5.657" class="difflineminus">-            return minusSign + Array(+n + 1).join(1);</span>
<a href="#l5.658"></a><span id="l5.658" class="difflineminus">-        }</span>
<a href="#l5.659"></a><span id="l5.659" class="difflineminus">-        var out = [];</span>
<a href="#l5.660"></a><span id="l5.660" class="difflineminus">-        var left = n, divmod;</span>
<a href="#l5.661"></a><span id="l5.661" class="difflineminus">-        while (left.lesser(0) || left.compareAbs(base) &gt;= 0) {</span>
<a href="#l5.662"></a><span id="l5.662" class="difflineminus">-            divmod = left.divmod(base);</span>
<a href="#l5.663"></a><span id="l5.663" class="difflineminus">-            left = divmod.quotient;</span>
<a href="#l5.664"></a><span id="l5.664" class="difflineminus">-            var digit = divmod.remainder;</span>
<a href="#l5.665"></a><span id="l5.665" class="difflineminus">-            if (digit.lesser(0)) {</span>
<a href="#l5.666"></a><span id="l5.666" class="difflineminus">-                digit = base.minus(digit).abs();</span>
<a href="#l5.667"></a><span id="l5.667" class="difflineminus">-                left = left.next();</span>
<a href="#l5.668"></a><span id="l5.668" class="difflineminus">-            }</span>
<a href="#l5.669"></a><span id="l5.669" class="difflineminus">-            out.push(stringify(digit));</span>
<a href="#l5.670"></a><span id="l5.670" class="difflineminus">-        }</span>
<a href="#l5.671"></a><span id="l5.671" class="difflineminus">-        out.push(stringify(left));</span>
<a href="#l5.672"></a><span id="l5.672" class="difflineminus">-        return minusSign + out.reverse().join(&quot;&quot;);</span>
<a href="#l5.673"></a><span id="l5.673" class="difflineminus">-    }</span>
<a href="#l5.674"></a><span id="l5.674" class="difflineminus">-</span>
<a href="#l5.675"></a><span id="l5.675" class="difflineminus">-    var fnReturn = function (a, b) {</span>
<a href="#l5.676"></a><span id="l5.676" class="difflineminus">-        if (typeof a === &quot;undefined&quot;) return ZERO;</span>
<a href="#l5.677"></a><span id="l5.677" class="difflineminus">-        if (typeof b !== &quot;undefined&quot;) return parseBase(a, b);</span>
<a href="#l5.678"></a><span id="l5.678" class="difflineminus">-        return parseInput(a);</span>
<a href="#l5.679"></a><span id="l5.679" class="difflineminus">-    };</span>
<a href="#l5.680"></a><span id="l5.680" class="difflineminus">-    fnReturn.zero = ZERO;</span>
<a href="#l5.681"></a><span id="l5.681" class="difflineminus">-    fnReturn.one = ONE;</span>
<a href="#l5.682"></a><span id="l5.682" class="difflineminus">-    fnReturn.minusOne = MINUS_ONE;</span>
<a href="#l5.683"></a><span id="l5.683" class="difflineminus">-    fnReturn.randBetween = randBetween;</span>
<a href="#l5.684"></a><span id="l5.684" class="difflineminus">-    fnReturn.min = min;</span>
<a href="#l5.685"></a><span id="l5.685" class="difflineminus">-    fnReturn.max = max;</span>
<a href="#l5.686"></a><span id="l5.686" class="difflineminus">-    fnReturn.gcd = gcd;</span>
<a href="#l5.687"></a><span id="l5.687" class="difflineminus">-    fnReturn.lcm = lcm;</span>
<a href="#l5.688"></a><span id="l5.688" class="difflineminus">-    return fnReturn;</span>
<a href="#l5.689"></a><span id="l5.689" class="difflineminus">-})();</span>
<a href="#l5.690"></a><span id="l5.690" class="difflineminus">-</span>
<a href="#l5.691"></a><span id="l5.691" class="difflineminus">-if (typeof module !== &quot;undefined&quot;) {</span>
<a href="#l5.692"></a><span id="l5.692" class="difflineminus">-    module.exports = bigInt;</span>
<a href="#l5.693"></a><span id="l5.693" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/chat/modules/moz.build</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/chat/modules/moz.build</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -2,17 +2,16 @@</span>
<a href="#l6.4"></a><span id="l6.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> XPCSHELL_TESTS_MANIFESTS += ['test/xpcshell.ini']</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> EXTRA_JS_MODULES += [</span>
<a href="#l6.11"></a><span id="l6.11">     'ArrayBufferUtils.jsm',</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    'BigInteger.jsm',</span>
<a href="#l6.13"></a><span id="l6.13">     'CLib.jsm',</span>
<a href="#l6.14"></a><span id="l6.14">     'hiddenWindow.jsm',</span>
<a href="#l6.15"></a><span id="l6.15">     'imContentSink.jsm',</span>
<a href="#l6.16"></a><span id="l6.16">     'imServices.jsm',</span>
<a href="#l6.17"></a><span id="l6.17">     'imSmileys.jsm',</span>
<a href="#l6.18"></a><span id="l6.18">     'imStatusUtils.jsm',</span>
<a href="#l6.19"></a><span id="l6.19">     'imTextboxUtils.jsm',</span>
<a href="#l6.20"></a><span id="l6.20">     'imThemes.jsm',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/chat/moz.build</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/chat/moz.build</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -10,17 +10,16 @@ DIRS += [</span>
<a href="#l7.4"></a><span id="l7.4">     'content',</span>
<a href="#l7.5"></a><span id="l7.5">     'themes',</span>
<a href="#l7.6"></a><span id="l7.6">     'locales',</span>
<a href="#l7.7"></a><span id="l7.7">     'protocols/facebook',</span>
<a href="#l7.8"></a><span id="l7.8">     'protocols/gtalk',</span>
<a href="#l7.9"></a><span id="l7.9">     'protocols/irc',</span>
<a href="#l7.10"></a><span id="l7.10">     'protocols/matrix',</span>
<a href="#l7.11"></a><span id="l7.11">     'protocols/odnoklassniki',</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    'protocols/skype',</span>
<a href="#l7.13"></a><span id="l7.13">     'protocols/twitter',</span>
<a href="#l7.14"></a><span id="l7.14">     'protocols/xmpp',</span>
<a href="#l7.15"></a><span id="l7.15">     'protocols/yahoo',</span>
<a href="#l7.16"></a><span id="l7.16"> ]</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> if CONFIG['MOZ_DEBUG']:</span>
<a href="#l7.19"></a><span id="l7.19">     DIRS += ['protocols/jsTest']</span>
<a href="#l7.20"></a><span id="l7.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/chat/protocols/skype/components.conf</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,15 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-# vim: set filetype=python:</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-Classes = [</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    'cid': '{8446c0f6-9f59-4710-844e-eaa6c1f49d35}',</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-    'contract_ids': ['@mozilla.org/chat/skype;1'],</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-    'jsm': 'resource:///modules/skype.jsm',</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-    'constructor': 'SkypeProtocol',</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-    'categories': {'im-protocol-plugin': 'prpl-skype'},</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-  },</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2">index 90984bc748eff02450decdc876f039c54b5ef238..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l9.3"></a><span id="l9.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2">index 1c487b7372027e3dd17093b407ce874715e38707..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l10.3"></a><span id="l10.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2">index 13e296143b0edfdb75c5841975d4c1ac013c102c..e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span>
<a href="#l11.3"></a><span id="l11.3">GIT binary patch
literal 0
Hc$@&lt;O00001</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">deleted file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- a/chat/protocols/skype/jar.mn</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ /dev/null</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -1,9 +0,0 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">-</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineminus">-chat.jar:</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-% skin prpl-skype classic/1.0 %skin/classic/prpl/skype/</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-	skin/classic/prpl/skype/icon32.png	(icons/prpl-skype-32.png)</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-	skin/classic/prpl/skype/icon48.png	(icons/prpl-skype-48.png)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-	skin/classic/prpl/skype/icon.png	(icons/prpl-skype.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">deleted file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- a/chat/protocols/skype/moz.build</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ /dev/null</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -1,16 +0,0 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineminus">-# vim: set filetype=python:</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-XPCSHELL_TESTS_MANIFESTS += ['test/xpcshell.ini']</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-JAR_MANIFESTS += ['jar.mn']</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-EXTRA_JS_MODULES += [</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-    'skype.jsm',</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-]</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-XPCOM_MANIFESTS += [</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-    'components.conf',</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/chat/protocols/skype/skype.jsm</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,960 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">-</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">-var EXPORTED_SYMBOLS = [&quot;SkypeProtocol&quot;];</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-var { httpRequest } = ChromeUtils.import(&quot;resource://gre/modules/Http.jsm&quot;);</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">-var { StringToArrayBuffer } = ChromeUtils.import(</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  &quot;resource:///modules/ArrayBufferUtils.jsm&quot;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-var { bigInt } = ChromeUtils.import(&quot;resource:///modules/BigInteger.jsm&quot;);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-var {</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-  XPCOMUtils,</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-  setTimeout,</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-  clearTimeout,</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-  l10nHelper,</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-  nsSimpleEnumerator,</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-  EmptyEnumerator,</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-} = ChromeUtils.import(&quot;resource:///modules/imXPCOMUtils.jsm&quot;);</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-var {</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-  GenericAccountPrototype,</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-  GenericAccountBuddyPrototype,</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-  GenericConvIMPrototype,</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-  GenericProtocolPrototype,</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-  TooltipInfo,</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-} = ChromeUtils.import(&quot;resource:///modules/jsProtoHelper.jsm&quot;);</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-// Constants used by the login process. This emulates a captured session using</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-// official means.</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-var kLockAndKeyAppId = &quot;msmsgs@msnmsgr.com&quot;;</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-var kLockAndKeySecret = &quot;Q1P7W2E4J9R8U3S5&quot;;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-var kClientId = &quot;578134&quot;;</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-var kClientInfo =</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-  &quot;os=Windows; osVer=8.1; proc=Win32; lcid=en-us; &quot; +</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-  &quot;deviceType=1; country=n/a; clientName=swx-skype.com; clientVer=908/1.0.0.20&quot;;</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-var kLoginHost = &quot;login.skype.com&quot;;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-var kContactsHost = &quot;api.skype.com&quot;;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-var kMessagesHost = &quot;client-s.gateway.messenger.live.com&quot;;</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-// Map from strings returned by the SkypeWeb API to statuses.</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-var kStatusMap = {</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  Online: &quot;AVAILABLE&quot;,</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-  Offline: &quot;OFFLINE&quot;,</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-  Idle: &quot;IDLE&quot;,</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  Away: &quot;AWAY&quot;,</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-  Hidden: &quot;INVISIBLE&quot;,</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-};</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-XPCOMUtils.defineLazyGetter(this, &quot;_&quot;, () =&gt;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-  l10nHelper(&quot;chrome://chat/locale/skype.properties&quot;)</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-/*</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">- * Convert a URL to a user's name.</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">- *</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">- * E.g. https://bay-client-s.gateway.messenger.live.com/v1/users/ME/contacts/8:clokep</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">- *      https://bay-client-s.gateway.messenger.live.com/v1/users/8:clokep/presenceDocs/messagingService</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">- *</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineminus">- *</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">- * Note that some contacts might have a /1: in them (instead of a /8:), that's</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">- * for MSN linked contacts.</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">- */</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-function contactUrlToName(aUrl) {</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-  let start = aUrl.indexOf(&quot;/8:&quot;);</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-  if (start == -1) {</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-    return null;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-  }</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-  // Skip over the separator.</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-  start += &quot;/8:&quot;.length;</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-  let end = aUrl.indexOf(&quot;/&quot;, start);</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-  if (end == -1) {</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-    end = undefined;</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-  }</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-  return aUrl.slice(start, end);</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-}</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-function SkypeConversation(aAccount, aName) {</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-  this.buddy = aAccount._buddies.get(aName);</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-  this._init(aAccount, aName);</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-}</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-SkypeConversation.prototype = {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-  __proto__: GenericConvIMPrototype,</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-  _account: null,</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-  sendMsg(aMessage) {</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-    if (!aMessage.length) {</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-      return;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-    }</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-    let target = &quot;8:&quot; + this.name;</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-    let url =</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-      &quot;https://&quot; +</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-      kMessagesHost +</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-      &quot;/v1/users/ME/conversations/&quot; +</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-      target +</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-      &quot;/messages&quot;;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-    let clientMessageId = Date.now().toString();</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-    let message = {</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-      clientmessageid: clientMessageId,</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-      content: aMessage,</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-      messagetype: &quot;RichText&quot;,</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-      contenttype: &quot;text&quot;,</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-    };</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-    let options = {</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-      onLoad: (aResponse, aXhr) =&gt; {</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-        this._account.LOG(&quot;Message response: &quot; + aResponse);</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineminus">-        this._account.LOG(&quot;Successfully sent message: &quot; + aMessage);</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-      },</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineminus">-      onError: this._account._onHttpFailure(&quot;sending message&quot;),</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-      postData: JSON.stringify(message),</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-      logger: this._account.logger,</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-    };</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-    // TODO Track the messages we sent?</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-    this._account._messagesRequest(url, options);</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-  },</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineminus">-};</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-function SkypeAccountBuddy(aAccount, aBuddy, aTag, aUserName) {</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-  aAccount.LOG(&quot;Creating account buddy for &quot; + aUserName);</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineminus">-</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-  this._init(aAccount, aBuddy, aTag, aUserName);</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-}</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-SkypeAccountBuddy.prototype = {</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-  __proto__: GenericAccountBuddyPrototype,</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineminus">-  _info: null,</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-  mood: null,</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineminus">-  // Called when the user wants to chat with the buddy.</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineminus">-  createConversation() {</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineminus">-    return this._account.createConversation(this.userName);</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineminus">-  },</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-  // Returns a list of imITooltipInfo objects to be displayed when the user</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-  // hovers over the buddy.</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-  getTooltipInfo() {</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-    if (!this._info) {</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-      return EmptyEnumerator;</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-    }</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineminus">-</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-    let tooltipInfo = [];</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-    for (let info in this._info) {</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-      // If there's no value, skip the element.</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineminus">-      if (!this._info[info]) {</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-        continue;</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-      }</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineminus">-      // TODO Put real labels on here.</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineminus">-      tooltipInfo.push(new TooltipInfo(info, this._info[info]));</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineminus">-    }</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineminus">-    if (this.mood) {</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-      tooltipInfo.push(new TooltipInfo(&quot;Mood&quot;, this.mood));</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineminus">-    }</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineminus">-</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-    return new nsSimpleEnumerator(tooltipInfo);</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-  },</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-  remove() {</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineminus">-    this._account.removeBuddy(this);</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-    GenericAccountBuddyPrototype.remove.call(this);</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineminus">-  },</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineminus">-};</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-/*</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">- * Cut out a part of a larger string bordered by aStart and aEnd. Returns an</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">- * empty string if the needle is not found.</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineminus">- */</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineminus">-function extractString(aStr, aStart, aEnd) {</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineminus">-  // First find the start index, then offset by the string length.</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineminus">-  let startIndex = aStr.indexOf(aStart) + aStart.length;</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-  if (startIndex == -1) {</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-  }</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineminus">-  // Now find the next occurrence of end after the start.</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineminus">-  let endIndex = aStr.indexOf(aEnd, startIndex);</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineminus">-  if (endIndex == -1) {</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-  }</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-  return aStr.slice(startIndex, endIndex);</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-}</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineminus">-</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineminus">-/*</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineminus">- * A magic method (originally from MSN) to stop 3rd parties from connecting.</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineminus">- * Differs from MSN by swapping MD5 for SHA256.</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">- *</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">- * A pre-emptive apology is necessary for those about to embark on the journey</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineminus">- * of understanding this code. I wish you luck and God's speed.</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineminus">- */</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-function magicSha256(aInput) {</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineminus">-  let productId = kLockAndKeyAppId;</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineminus">-  // Create a SHA 256 hash.</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineminus">-  let converter = Cc[</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineminus">-    &quot;@mozilla.org/intl/scriptableunicodeconverter&quot;</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineminus">-  ].createInstance(Ci.nsIScriptableUnicodeConverter);</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-  converter.charset = &quot;UTF-8&quot;;</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineminus">-  let data = converter.convertToByteArray(aInput);</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineminus">-  let productKey = converter.convertToByteArray(kLockAndKeySecret);</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineminus">-</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineminus">-  let hash = Cc[&quot;@mozilla.org/security/hash;1&quot;].createInstance(</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineminus">-    Ci.nsICryptoHash</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineminus">-  );</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineminus">-  hash.init(hash.SHA256);</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineminus">-  hash.update(data, data.length);</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineminus">-  hash.update(productKey, productKey.length);</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineminus">-  // Finalize the hash as a set of bytes.</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineminus">-  let sha256Hash = hash.finish(false);</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineminus">-</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineminus">-  // Split it into four integers (note that this ignores the second half of the</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineminus">-  // hash).</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineminus">-  let sha256Buffer = StringToArrayBuffer(sha256Hash);</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineminus">-  let view = new DataView(sha256Buffer, 0, 16);</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineminus">-</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineminus">-  let sha256Parts = [];</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineminus">-  let newHashParts = [];</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-  for (let i = 0; i &lt; 4; ++i) {</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineminus">-    // Ensure little-endianness is used.</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineminus">-    sha256Parts.push(view.getUint32(i * 4, true));</span>
<a href="#l14.228"></a><span id="l14.228" class="difflineminus">-</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineminus">-    newHashParts.push(sha256Parts[i]);</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineminus">-    sha256Parts[i] &amp;= 0x7fffffff;</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineminus">-  }</span>
<a href="#l14.232"></a><span id="l14.232" class="difflineminus">-</span>
<a href="#l14.233"></a><span id="l14.233" class="difflineminus">-  // Make a new string and pad with '0' to a length that's a multiple of 8.</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineminus">-  let buf = aInput + productId;</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineminus">-  let len = buf.length;</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineminus">-  let modLen = len % 8;</span>
<a href="#l14.237"></a><span id="l14.237" class="difflineminus">-  if (modLen != 0) {</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineminus">-    let fix = 8 - modLen;</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineminus">-    buf += &quot;0&quot;.repeat(fix);</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineminus">-    len += fix;</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineminus">-  }</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineminus">-</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineminus">-  // Split into integers.</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineminus">-  view = new DataView(StringToArrayBuffer(buf));</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineminus">-</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineminus">-  // This is magic.</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineminus">-  let nHigh = bigInt(0);</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineminus">-  let nLow = bigInt(0);</span>
<a href="#l14.249"></a><span id="l14.249" class="difflineminus">-  for (let i = 0; i &lt; len / 4; i += 2) {</span>
<a href="#l14.250"></a><span id="l14.250" class="difflineminus">-    let temp = bigInt(0x0e79a9c1)</span>
<a href="#l14.251"></a><span id="l14.251" class="difflineminus">-      .times(view.getUint32(i * 4, true))</span>
<a href="#l14.252"></a><span id="l14.252" class="difflineminus">-      .divmod(0x7fffffff).remainder;</span>
<a href="#l14.253"></a><span id="l14.253" class="difflineminus">-    temp = temp</span>
<a href="#l14.254"></a><span id="l14.254" class="difflineminus">-      .plus(nLow)</span>
<a href="#l14.255"></a><span id="l14.255" class="difflineminus">-      .times(sha256Parts[0])</span>
<a href="#l14.256"></a><span id="l14.256" class="difflineminus">-      .plus(sha256Parts[1])</span>
<a href="#l14.257"></a><span id="l14.257" class="difflineminus">-      .divmod(0x7fffffff).remainder;</span>
<a href="#l14.258"></a><span id="l14.258" class="difflineminus">-    nHigh = nHigh.plus(temp);</span>
<a href="#l14.259"></a><span id="l14.259" class="difflineminus">-</span>
<a href="#l14.260"></a><span id="l14.260" class="difflineminus">-    temp = temp.plus(view.getUint32((i + 1) * 4, true)).divmod(0x7fffffff)</span>
<a href="#l14.261"></a><span id="l14.261" class="difflineminus">-      .remainder;</span>
<a href="#l14.262"></a><span id="l14.262" class="difflineminus">-    nLow = temp</span>
<a href="#l14.263"></a><span id="l14.263" class="difflineminus">-      .times(sha256Parts[2])</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineminus">-      .plus(sha256Parts[3])</span>
<a href="#l14.265"></a><span id="l14.265" class="difflineminus">-      .divmod(0x7fffffff).remainder;</span>
<a href="#l14.266"></a><span id="l14.266" class="difflineminus">-    nHigh = nHigh.plus(nLow);</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineminus">-  }</span>
<a href="#l14.268"></a><span id="l14.268" class="difflineminus">-  nLow = nLow</span>
<a href="#l14.269"></a><span id="l14.269" class="difflineminus">-    .plus(sha256Parts[1])</span>
<a href="#l14.270"></a><span id="l14.270" class="difflineminus">-    .divmod(0x7fffffff)</span>
<a href="#l14.271"></a><span id="l14.271" class="difflineminus">-    .remainder.toJSNumber();</span>
<a href="#l14.272"></a><span id="l14.272" class="difflineminus">-  nHigh = nHigh</span>
<a href="#l14.273"></a><span id="l14.273" class="difflineminus">-    .plus(sha256Parts[3])</span>
<a href="#l14.274"></a><span id="l14.274" class="difflineminus">-    .divmod(0x7fffffff)</span>
<a href="#l14.275"></a><span id="l14.275" class="difflineminus">-    .remainder.toJSNumber();</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineminus">-</span>
<a href="#l14.277"></a><span id="l14.277" class="difflineminus">-  newHashParts[0] ^= nLow;</span>
<a href="#l14.278"></a><span id="l14.278" class="difflineminus">-  newHashParts[1] ^= nHigh;</span>
<a href="#l14.279"></a><span id="l14.279" class="difflineminus">-  newHashParts[2] ^= nLow;</span>
<a href="#l14.280"></a><span id="l14.280" class="difflineminus">-  newHashParts[3] ^= nHigh;</span>
<a href="#l14.281"></a><span id="l14.281" class="difflineminus">-</span>
<a href="#l14.282"></a><span id="l14.282" class="difflineminus">-  // Make a string of the parts and convert to hexadecimal.</span>
<a href="#l14.283"></a><span id="l14.283" class="difflineminus">-  let output = &quot;&quot;;</span>
<a href="#l14.284"></a><span id="l14.284" class="difflineminus">-  for (let i = 0; i &lt; 4; ++i) {</span>
<a href="#l14.285"></a><span id="l14.285" class="difflineminus">-    let part = newHashParts[i];</span>
<a href="#l14.286"></a><span id="l14.286" class="difflineminus">-    // Adjust to little-endianness.</span>
<a href="#l14.287"></a><span id="l14.287" class="difflineminus">-    part =</span>
<a href="#l14.288"></a><span id="l14.288" class="difflineminus">-      ((part &amp; 0xff) &lt;&lt; 24) |</span>
<a href="#l14.289"></a><span id="l14.289" class="difflineminus">-      ((part &amp; 0xff00) &lt;&lt; 8) |</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineminus">-      ((part &gt;&gt; 8) &amp; 0xff00) |</span>
<a href="#l14.291"></a><span id="l14.291" class="difflineminus">-      ((part &gt;&gt; 24) &amp; 0xff);</span>
<a href="#l14.292"></a><span id="l14.292" class="difflineminus">-</span>
<a href="#l14.293"></a><span id="l14.293" class="difflineminus">-    // JavaScript likes to use signed numbers, force this to give us the</span>
<a href="#l14.294"></a><span id="l14.294" class="difflineminus">-    // unsigned representation.</span>
<a href="#l14.295"></a><span id="l14.295" class="difflineminus">-    if (part &lt; 0) {</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineminus">-      part += 0xffffffff + 1;</span>
<a href="#l14.297"></a><span id="l14.297" class="difflineminus">-    }</span>
<a href="#l14.298"></a><span id="l14.298" class="difflineminus">-</span>
<a href="#l14.299"></a><span id="l14.299" class="difflineminus">-    let hexPart = part.toString(16);</span>
<a href="#l14.300"></a><span id="l14.300" class="difflineminus">-    // Ensure that the string has 8 characters (4 bytes).</span>
<a href="#l14.301"></a><span id="l14.301" class="difflineminus">-    output += &quot;0&quot;.repeat(8 - hexPart.length) + hexPart;</span>
<a href="#l14.302"></a><span id="l14.302" class="difflineminus">-  }</span>
<a href="#l14.303"></a><span id="l14.303" class="difflineminus">-</span>
<a href="#l14.304"></a><span id="l14.304" class="difflineminus">-  return output;</span>
<a href="#l14.305"></a><span id="l14.305" class="difflineminus">-}</span>
<a href="#l14.306"></a><span id="l14.306" class="difflineminus">-</span>
<a href="#l14.307"></a><span id="l14.307" class="difflineminus">-// TODO Add tests for this function.</span>
<a href="#l14.308"></a><span id="l14.308" class="difflineminus">-// Calculate the timezone offset of the local computer as [+-]HH:MM.</span>
<a href="#l14.309"></a><span id="l14.309" class="difflineminus">-function getTimezone() {</span>
<a href="#l14.310"></a><span id="l14.310" class="difflineminus">-  /*</span>
<a href="#l14.311"></a><span id="l14.311" class="difflineminus">-   * Zero-pad aNum to the length of aLen.</span>
<a href="#l14.312"></a><span id="l14.312" class="difflineminus">-   */</span>
<a href="#l14.313"></a><span id="l14.313" class="difflineminus">-  function zeroPad(aNum, aLen) {</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineminus">-    let nStr = aNum.toString();</span>
<a href="#l14.315"></a><span id="l14.315" class="difflineminus">-    let nLen = nStr.length;</span>
<a href="#l14.316"></a><span id="l14.316" class="difflineminus">-</span>
<a href="#l14.317"></a><span id="l14.317" class="difflineminus">-    if (nLen &gt; aLen) {</span>
<a href="#l14.318"></a><span id="l14.318" class="difflineminus">-      throw new Error(</span>
<a href="#l14.319"></a><span id="l14.319" class="difflineminus">-        &quot;Can't zero-pad when longer than expected length: &quot; +</span>
<a href="#l14.320"></a><span id="l14.320" class="difflineminus">-          nStr +</span>
<a href="#l14.321"></a><span id="l14.321" class="difflineminus">-          &quot;.length &gt; &quot; +</span>
<a href="#l14.322"></a><span id="l14.322" class="difflineminus">-          aLen</span>
<a href="#l14.323"></a><span id="l14.323" class="difflineminus">-      );</span>
<a href="#l14.324"></a><span id="l14.324" class="difflineminus">-    }</span>
<a href="#l14.325"></a><span id="l14.325" class="difflineminus">-</span>
<a href="#l14.326"></a><span id="l14.326" class="difflineminus">-    return &quot;0&quot;.repeat(aLen - nLen) + nStr;</span>
<a href="#l14.327"></a><span id="l14.327" class="difflineminus">-  }</span>
<a href="#l14.328"></a><span id="l14.328" class="difflineminus">-</span>
<a href="#l14.329"></a><span id="l14.329" class="difflineminus">-  // Invert the sign of the timezone from JavaScript's date object.</span>
<a href="#l14.330"></a><span id="l14.330" class="difflineminus">-  let sign = &quot;+&quot;;</span>
<a href="#l14.331"></a><span id="l14.331" class="difflineminus">-  let timezone = new Date().getTimezoneOffset() * -1;</span>
<a href="#l14.332"></a><span id="l14.332" class="difflineminus">-  if (timezone &lt; 0) {</span>
<a href="#l14.333"></a><span id="l14.333" class="difflineminus">-    sign = &quot;-&quot;;</span>
<a href="#l14.334"></a><span id="l14.334" class="difflineminus">-  }</span>
<a href="#l14.335"></a><span id="l14.335" class="difflineminus">-  timezone = Math.abs(timezone);</span>
<a href="#l14.336"></a><span id="l14.336" class="difflineminus">-</span>
<a href="#l14.337"></a><span id="l14.337" class="difflineminus">-  // Separate the timezone into hours and minutes.</span>
<a href="#l14.338"></a><span id="l14.338" class="difflineminus">-  let minutes = timezone % 60;</span>
<a href="#l14.339"></a><span id="l14.339" class="difflineminus">-  let hours = (timezone - minutes) / 60;</span>
<a href="#l14.340"></a><span id="l14.340" class="difflineminus">-</span>
<a href="#l14.341"></a><span id="l14.341" class="difflineminus">-  // Ensure both hours and minutes are two digits long.</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineminus">-  minutes = zeroPad(minutes, 2);</span>
<a href="#l14.343"></a><span id="l14.343" class="difflineminus">-  hours = zeroPad(hours, 2);</span>
<a href="#l14.344"></a><span id="l14.344" class="difflineminus">-</span>
<a href="#l14.345"></a><span id="l14.345" class="difflineminus">-  // The final timezone string.</span>
<a href="#l14.346"></a><span id="l14.346" class="difflineminus">-  return sign + hours + &quot;|&quot; + minutes;</span>
<a href="#l14.347"></a><span id="l14.347" class="difflineminus">-}</span>
<a href="#l14.348"></a><span id="l14.348" class="difflineminus">-</span>
<a href="#l14.349"></a><span id="l14.349" class="difflineminus">-function SkypeAccount(aProtoInstance, aImAccount) {</span>
<a href="#l14.350"></a><span id="l14.350" class="difflineminus">-  this._init(aProtoInstance, aImAccount);</span>
<a href="#l14.351"></a><span id="l14.351" class="difflineminus">-</span>
<a href="#l14.352"></a><span id="l14.352" class="difflineminus">-  // Initialize some maps.</span>
<a href="#l14.353"></a><span id="l14.353" class="difflineminus">-  this._buddies = new Map();</span>
<a href="#l14.354"></a><span id="l14.354" class="difflineminus">-  this._conversations = new Map();</span>
<a href="#l14.355"></a><span id="l14.355" class="difflineminus">-  this._chats = new Map();</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineminus">-  this._logger = { log: this.LOG.bind(this), debug: this.DEBUG.bind(this) };</span>
<a href="#l14.358"></a><span id="l14.358" class="difflineminus">-}</span>
<a href="#l14.359"></a><span id="l14.359" class="difflineminus">-SkypeAccount.prototype = {</span>
<a href="#l14.360"></a><span id="l14.360" class="difflineminus">-  __proto__: GenericAccountPrototype,</span>
<a href="#l14.361"></a><span id="l14.361" class="difflineminus">-  // A Map holding the list of buddies associated with their usernames.</span>
<a href="#l14.362"></a><span id="l14.362" class="difflineminus">-  _buddies: null,</span>
<a href="#l14.363"></a><span id="l14.363" class="difflineminus">-  // A Map holding the list of open conversations by the username of the buddy.</span>
<a href="#l14.364"></a><span id="l14.364" class="difflineminus">-  _conversations: null,</span>
<a href="#l14.365"></a><span id="l14.365" class="difflineminus">-  // A Map holding the list of open (multiple user) chats by name.</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineminus">-  _chats: null,</span>
<a href="#l14.367"></a><span id="l14.367" class="difflineminus">-  // The current request in the polling loop.</span>
<a href="#l14.368"></a><span id="l14.368" class="difflineminus">-  _request: null,</span>
<a href="#l14.369"></a><span id="l14.369" class="difflineminus">-  // The timer for the next poll.</span>
<a href="#l14.370"></a><span id="l14.370" class="difflineminus">-  _poller: null,</span>
<a href="#l14.371"></a><span id="l14.371" class="difflineminus">-</span>
<a href="#l14.372"></a><span id="l14.372" class="difflineminus">-  // Some tokens.</span>
<a href="#l14.373"></a><span id="l14.373" class="difflineminus">-  _skypeToken: null,</span>
<a href="#l14.374"></a><span id="l14.374" class="difflineminus">-  _registrationToken: null,</span>
<a href="#l14.375"></a><span id="l14.375" class="difflineminus">-</span>
<a href="#l14.376"></a><span id="l14.376" class="difflineminus">-  // Logger used for HTTP requests.</span>
<a href="#l14.377"></a><span id="l14.377" class="difflineminus">-  _logger: null,</span>
<a href="#l14.378"></a><span id="l14.378" class="difflineminus">-</span>
<a href="#l14.379"></a><span id="l14.379" class="difflineminus">-  mapStatusString(aStatus) {</span>
<a href="#l14.380"></a><span id="l14.380" class="difflineminus">-    if (aStatus in kStatusMap) {</span>
<a href="#l14.381"></a><span id="l14.381" class="difflineminus">-      return Ci.imIStatusInfo[&quot;STATUS_&quot; + kStatusMap[aStatus]];</span>
<a href="#l14.382"></a><span id="l14.382" class="difflineminus">-    }</span>
<a href="#l14.383"></a><span id="l14.383" class="difflineminus">-</span>
<a href="#l14.384"></a><span id="l14.384" class="difflineminus">-    // Uh-oh, we got something not in the map.</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineminus">-    this.WARN(&quot;Received unknown status type: &quot; + aStatus);</span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-    return Ci.imIStatusInfo.STATUS_UNKNOWN;</span>
<a href="#l14.387"></a><span id="l14.387" class="difflineminus">-  },</span>
<a href="#l14.388"></a><span id="l14.388" class="difflineminus">-</span>
<a href="#l14.389"></a><span id="l14.389" class="difflineminus">-  connect() {</span>
<a href="#l14.390"></a><span id="l14.390" class="difflineminus">-    this.reportConnecting();</span>
<a href="#l14.391"></a><span id="l14.391" class="difflineminus">-</span>
<a href="#l14.392"></a><span id="l14.392" class="difflineminus">-    this.LOG(&quot;STARTING Login&quot;);</span>
<a href="#l14.393"></a><span id="l14.393" class="difflineminus">-</span>
<a href="#l14.394"></a><span id="l14.394" class="difflineminus">-    // Perform the request to get the session token values.</span>
<a href="#l14.395"></a><span id="l14.395" class="difflineminus">-    let loginUrl = &quot;https://&quot; + kLoginHost + &quot;/login&quot;;</span>
<a href="#l14.396"></a><span id="l14.396" class="difflineminus">-    let options = {</span>
<a href="#l14.397"></a><span id="l14.397" class="difflineminus">-      onLoad: this._onPieResponse.bind(this),</span>
<a href="#l14.398"></a><span id="l14.398" class="difflineminus">-      onError: this._onHttpFailure(&quot;requesting pie&quot;),</span>
<a href="#l14.399"></a><span id="l14.399" class="difflineminus">-      logger: this.logger,</span>
<a href="#l14.400"></a><span id="l14.400" class="difflineminus">-    };</span>
<a href="#l14.401"></a><span id="l14.401" class="difflineminus">-    httpRequest(loginUrl, options);</span>
<a href="#l14.402"></a><span id="l14.402" class="difflineminus">-  },</span>
<a href="#l14.403"></a><span id="l14.403" class="difflineminus">-</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineminus">-  /*</span>
<a href="#l14.405"></a><span id="l14.405" class="difflineminus">-   * Generates a callback which causes the account to enter an error state with</span>
<a href="#l14.406"></a><span id="l14.406" class="difflineminus">-   * the given error string.</span>
<a href="#l14.407"></a><span id="l14.407" class="difflineminus">-   */</span>
<a href="#l14.408"></a><span id="l14.408" class="difflineminus">-  _onHttpFailure(aErrorStr) {</span>
<a href="#l14.409"></a><span id="l14.409" class="difflineminus">-    return (aError, aResponse, aXhr) =&gt; {</span>
<a href="#l14.410"></a><span id="l14.410" class="difflineminus">-      this.ERROR(&quot;HTTP failure occurred: &quot; + aErrorStr + &quot;\n&quot; + aError);</span>
<a href="#l14.411"></a><span id="l14.411" class="difflineminus">-      this._disconnectWithAuthFailure();</span>
<a href="#l14.412"></a><span id="l14.412" class="difflineminus">-    };</span>
<a href="#l14.413"></a><span id="l14.413" class="difflineminus">-  },</span>
<a href="#l14.414"></a><span id="l14.414" class="difflineminus">-</span>
<a href="#l14.415"></a><span id="l14.415" class="difflineminus">-  _onHttpError(aError, aResponse, aXhr) {</span>
<a href="#l14.416"></a><span id="l14.416" class="difflineminus">-    this.ERROR(&quot;Received error response:\n&quot; + aError);</span>
<a href="#l14.417"></a><span id="l14.417" class="difflineminus">-  },</span>
<a href="#l14.418"></a><span id="l14.418" class="difflineminus">-</span>
<a href="#l14.419"></a><span id="l14.419" class="difflineminus">-  // Mmmmm...pie.</span>
<a href="#l14.420"></a><span id="l14.420" class="difflineminus">-  _onPieResponse(aResponse, aXhr) {</span>
<a href="#l14.421"></a><span id="l14.421" class="difflineminus">-    this.reportConnecting(_(&quot;connecting.authenticating&quot;));</span>
<a href="#l14.422"></a><span id="l14.422" class="difflineminus">-</span>
<a href="#l14.423"></a><span id="l14.423" class="difflineminus">-    // Parse the pie/etm and do the actual login.</span>
<a href="#l14.424"></a><span id="l14.424" class="difflineminus">-    let loginUrl = &quot;https://&quot; + kLoginHost + &quot;/login&quot;;</span>
<a href="#l14.425"></a><span id="l14.425" class="difflineminus">-</span>
<a href="#l14.426"></a><span id="l14.426" class="difflineminus">-    let params = [</span>
<a href="#l14.427"></a><span id="l14.427" class="difflineminus">-      [&quot;client_id&quot;, kClientId],</span>
<a href="#l14.428"></a><span id="l14.428" class="difflineminus">-      [&quot;redirect_uri&quot;, &quot;https://web.skype.com&quot;],</span>
<a href="#l14.429"></a><span id="l14.429" class="difflineminus">-    ];</span>
<a href="#l14.430"></a><span id="l14.430" class="difflineminus">-    loginUrl +=</span>
<a href="#l14.431"></a><span id="l14.431" class="difflineminus">-      &quot;?&quot; + params.map(p =&gt; p.map(encodeURIComponent).join(&quot;=&quot;)).join(&quot;&amp;&quot;);</span>
<a href="#l14.432"></a><span id="l14.432" class="difflineminus">-</span>
<a href="#l14.433"></a><span id="l14.433" class="difflineminus">-    this.LOG(&quot;Received PIE response:\n&quot; + aResponse);</span>
<a href="#l14.434"></a><span id="l14.434" class="difflineminus">-</span>
<a href="#l14.435"></a><span id="l14.435" class="difflineminus">-    // Note that the response is really just an HTML page with some JavaScript</span>
<a href="#l14.436"></a><span id="l14.436" class="difflineminus">-    // and forms that these values are being pulled from.</span>
<a href="#l14.437"></a><span id="l14.437" class="difflineminus">-    let pie = extractString(aResponse, '=&quot;pie&quot; value=&quot;', '&quot;');</span>
<a href="#l14.438"></a><span id="l14.438" class="difflineminus">-    if (!pie) {</span>
<a href="#l14.439"></a><span id="l14.439" class="difflineminus">-      this.ERROR(&quot;pie value not found.&quot;);</span>
<a href="#l14.440"></a><span id="l14.440" class="difflineminus">-      this._disconnectWithAuthFailure();</span>
<a href="#l14.441"></a><span id="l14.441" class="difflineminus">-      return;</span>
<a href="#l14.442"></a><span id="l14.442" class="difflineminus">-    }</span>
<a href="#l14.443"></a><span id="l14.443" class="difflineminus">-    let etm = extractString(aResponse, '=&quot;etm&quot; value=&quot;', '&quot;');</span>
<a href="#l14.444"></a><span id="l14.444" class="difflineminus">-    if (!etm) {</span>
<a href="#l14.445"></a><span id="l14.445" class="difflineminus">-      this.ERROR(&quot;etm value not found.&quot;);</span>
<a href="#l14.446"></a><span id="l14.446" class="difflineminus">-      this._disconnectWithAuthFailure();</span>
<a href="#l14.447"></a><span id="l14.447" class="difflineminus">-      return;</span>
<a href="#l14.448"></a><span id="l14.448" class="difflineminus">-    }</span>
<a href="#l14.449"></a><span id="l14.449" class="difflineminus">-</span>
<a href="#l14.450"></a><span id="l14.450" class="difflineminus">-    let options = {</span>
<a href="#l14.451"></a><span id="l14.451" class="difflineminus">-      onLoad: this._onLoginResponse.bind(this),</span>
<a href="#l14.452"></a><span id="l14.452" class="difflineminus">-      onError: this._onHttpFailure(&quot;requesting skypetoken&quot;),</span>
<a href="#l14.453"></a><span id="l14.453" class="difflineminus">-      postData: [</span>
<a href="#l14.454"></a><span id="l14.454" class="difflineminus">-        [&quot;username&quot;, this.name],</span>
<a href="#l14.455"></a><span id="l14.455" class="difflineminus">-        [&quot;password&quot;, this.imAccount.password],</span>
<a href="#l14.456"></a><span id="l14.456" class="difflineminus">-        [&quot;timezone_field&quot;, getTimezone()],</span>
<a href="#l14.457"></a><span id="l14.457" class="difflineminus">-        [&quot;pie&quot;, pie],</span>
<a href="#l14.458"></a><span id="l14.458" class="difflineminus">-        [&quot;etm&quot;, etm],</span>
<a href="#l14.459"></a><span id="l14.459" class="difflineminus">-        [&quot;js_time&quot;, Date.now()],</span>
<a href="#l14.460"></a><span id="l14.460" class="difflineminus">-        [&quot;client_id&quot;, kClientId],</span>
<a href="#l14.461"></a><span id="l14.461" class="difflineminus">-        [&quot;redirect_uri&quot;, &quot;https://web.skype.com/&quot;],</span>
<a href="#l14.462"></a><span id="l14.462" class="difflineminus">-      ],</span>
<a href="#l14.463"></a><span id="l14.463" class="difflineminus">-      headers: [</span>
<a href="#l14.464"></a><span id="l14.464" class="difflineminus">-        [&quot;Connection&quot;, &quot;close&quot;],</span>
<a href="#l14.465"></a><span id="l14.465" class="difflineminus">-        // BehaviorOverride is a custom microsoft header. It stops the</span>
<a href="#l14.466"></a><span id="l14.466" class="difflineminus">-        // response from doing a 302 Found Location redirect, since</span>
<a href="#l14.467"></a><span id="l14.467" class="difflineminus">-        // there are important headers that need to be plucked before</span>
<a href="#l14.468"></a><span id="l14.468" class="difflineminus">-        // the redirect happens.</span>
<a href="#l14.469"></a><span id="l14.469" class="difflineminus">-        [&quot;BehaviorOverride&quot;, &quot;redirectAs404&quot;],</span>
<a href="#l14.470"></a><span id="l14.470" class="difflineminus">-      ],</span>
<a href="#l14.471"></a><span id="l14.471" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.472"></a><span id="l14.472" class="difflineminus">-    };</span>
<a href="#l14.473"></a><span id="l14.473" class="difflineminus">-    httpRequest(loginUrl, options);</span>
<a href="#l14.474"></a><span id="l14.474" class="difflineminus">-  },</span>
<a href="#l14.475"></a><span id="l14.475" class="difflineminus">-  _onLoginResponse(aResponse, aXhr) {</span>
<a href="#l14.476"></a><span id="l14.476" class="difflineminus">-    this.LOG(&quot;Received LOGIN response:\n&quot; + aResponse);</span>
<a href="#l14.477"></a><span id="l14.477" class="difflineminus">-</span>
<a href="#l14.478"></a><span id="l14.478" class="difflineminus">-    let refreshToken = extractString(aResponse, '=&quot;skypetoken&quot; value=&quot;', '&quot;');</span>
<a href="#l14.479"></a><span id="l14.479" class="difflineminus">-    if (!refreshToken) {</span>
<a href="#l14.480"></a><span id="l14.480" class="difflineminus">-      this.ERROR(&quot;skypetoken value not found.&quot;);</span>
<a href="#l14.481"></a><span id="l14.481" class="difflineminus">-      this._disconnectWithAuthFailure();</span>
<a href="#l14.482"></a><span id="l14.482" class="difflineminus">-      return;</span>
<a href="#l14.483"></a><span id="l14.483" class="difflineminus">-    }</span>
<a href="#l14.484"></a><span id="l14.484" class="difflineminus">-</span>
<a href="#l14.485"></a><span id="l14.485" class="difflineminus">-    // All done!</span>
<a href="#l14.486"></a><span id="l14.486" class="difflineminus">-    this._skypeToken = refreshToken;</span>
<a href="#l14.487"></a><span id="l14.487" class="difflineminus">-    this.LOG(&quot;Received Skype token: &quot; + this._skypeToken);</span>
<a href="#l14.488"></a><span id="l14.488" class="difflineminus">-</span>
<a href="#l14.489"></a><span id="l14.489" class="difflineminus">-    if (this._registrationToken) {</span>
<a href="#l14.490"></a><span id="l14.490" class="difflineminus">-      // Subscribe to receive particular events.</span>
<a href="#l14.491"></a><span id="l14.491" class="difflineminus">-      this._subscribe();</span>
<a href="#l14.492"></a><span id="l14.492" class="difflineminus">-      return;</span>
<a href="#l14.493"></a><span id="l14.493" class="difflineminus">-    }</span>
<a href="#l14.494"></a><span id="l14.494" class="difflineminus">-</span>
<a href="#l14.495"></a><span id="l14.495" class="difflineminus">-    this.reportConnecting(_(&quot;connecting.registrationToken&quot;));</span>
<a href="#l14.496"></a><span id="l14.496" class="difflineminus">-</span>
<a href="#l14.497"></a><span id="l14.497" class="difflineminus">-    // Request the registration token.</span>
<a href="#l14.498"></a><span id="l14.498" class="difflineminus">-    let messagesUrl = &quot;https://&quot; + kMessagesHost + &quot;/v1/users/ME/endpoints&quot;;</span>
<a href="#l14.499"></a><span id="l14.499" class="difflineminus">-    // The current time in seconds, converted to a string.</span>
<a href="#l14.500"></a><span id="l14.500" class="difflineminus">-    let curTime = String(Math.floor(Date.now() / 1000));</span>
<a href="#l14.501"></a><span id="l14.501" class="difflineminus">-    let response = magicSha256(curTime);</span>
<a href="#l14.502"></a><span id="l14.502" class="difflineminus">-    let options = {</span>
<a href="#l14.503"></a><span id="l14.503" class="difflineminus">-      onLoad: this._onRegistrationTokenReceived.bind(this),</span>
<a href="#l14.504"></a><span id="l14.504" class="difflineminus">-      onError: (aError, aResponse, aXhr) =&gt; {</span>
<a href="#l14.505"></a><span id="l14.505" class="difflineminus">-        this.ERROR(</span>
<a href="#l14.506"></a><span id="l14.506" class="difflineminus">-          &quot;HTTP failure occurred: requesting registration token\n&quot; + aError</span>
<a href="#l14.507"></a><span id="l14.507" class="difflineminus">-        );</span>
<a href="#l14.508"></a><span id="l14.508" class="difflineminus">-        this._disconnectWithAuthFailure(&quot;error.registrationToken&quot;);</span>
<a href="#l14.509"></a><span id="l14.509" class="difflineminus">-      },</span>
<a href="#l14.510"></a><span id="l14.510" class="difflineminus">-      postData: &quot;{}&quot;, // Empty JSON object.</span>
<a href="#l14.511"></a><span id="l14.511" class="difflineminus">-      headers: [</span>
<a href="#l14.512"></a><span id="l14.512" class="difflineminus">-        [&quot;Connection&quot;, &quot;close&quot;],</span>
<a href="#l14.513"></a><span id="l14.513" class="difflineminus">-        // BehaviorOverride is a custom microsoft header. It stops the</span>
<a href="#l14.514"></a><span id="l14.514" class="difflineminus">-        // response from doing a 302 Found Location redirect, since</span>
<a href="#l14.515"></a><span id="l14.515" class="difflineminus">-        // there are important headers that need to be plucked before</span>
<a href="#l14.516"></a><span id="l14.516" class="difflineminus">-        // the redirect happens.</span>
<a href="#l14.517"></a><span id="l14.517" class="difflineminus">-        [&quot;BehaviorOverride&quot;, &quot;redirectAs404&quot;],</span>
<a href="#l14.518"></a><span id="l14.518" class="difflineminus">-        [</span>
<a href="#l14.519"></a><span id="l14.519" class="difflineminus">-          &quot;LockAndKey&quot;,</span>
<a href="#l14.520"></a><span id="l14.520" class="difflineminus">-          &quot;appId=&quot; +</span>
<a href="#l14.521"></a><span id="l14.521" class="difflineminus">-            kLockAndKeyAppId +</span>
<a href="#l14.522"></a><span id="l14.522" class="difflineminus">-            &quot;; time=&quot; +</span>
<a href="#l14.523"></a><span id="l14.523" class="difflineminus">-            curTime +</span>
<a href="#l14.524"></a><span id="l14.524" class="difflineminus">-            &quot;; lockAndKeyResponse=&quot; +</span>
<a href="#l14.525"></a><span id="l14.525" class="difflineminus">-            response,</span>
<a href="#l14.526"></a><span id="l14.526" class="difflineminus">-        ],</span>
<a href="#l14.527"></a><span id="l14.527" class="difflineminus">-        [&quot;ClientInfo&quot;, kClientInfo],</span>
<a href="#l14.528"></a><span id="l14.528" class="difflineminus">-        [&quot;Authentication&quot;, &quot;skypetoken=&quot; + this._skypeToken],</span>
<a href="#l14.529"></a><span id="l14.529" class="difflineminus">-      ],</span>
<a href="#l14.530"></a><span id="l14.530" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.531"></a><span id="l14.531" class="difflineminus">-    };</span>
<a href="#l14.532"></a><span id="l14.532" class="difflineminus">-    httpRequest(messagesUrl, options);</span>
<a href="#l14.533"></a><span id="l14.533" class="difflineminus">-  },</span>
<a href="#l14.534"></a><span id="l14.534" class="difflineminus">-  _onRegistrationTokenReceived(aResponse, aXhr) {</span>
<a href="#l14.535"></a><span id="l14.535" class="difflineminus">-    this.LOG(&quot;Registration token received: &quot; + aResponse);</span>
<a href="#l14.536"></a><span id="l14.536" class="difflineminus">-</span>
<a href="#l14.537"></a><span id="l14.537" class="difflineminus">-    let registrationToken = aXhr.getResponseHeader(&quot;Set-RegistrationToken&quot;);</span>
<a href="#l14.538"></a><span id="l14.538" class="difflineminus">-    this.LOG(&quot;regToken: &quot; + registrationToken);</span>
<a href="#l14.539"></a><span id="l14.539" class="difflineminus">-    if (!registrationToken) {</span>
<a href="#l14.540"></a><span id="l14.540" class="difflineminus">-      this.ERROR(&quot;registraation token value not found.&quot;);</span>
<a href="#l14.541"></a><span id="l14.541" class="difflineminus">-      this._disconnectWithAuthFailure();</span>
<a href="#l14.542"></a><span id="l14.542" class="difflineminus">-      return;</span>
<a href="#l14.543"></a><span id="l14.543" class="difflineminus">-    }</span>
<a href="#l14.544"></a><span id="l14.544" class="difflineminus">-</span>
<a href="#l14.545"></a><span id="l14.545" class="difflineminus">-    this._registrationToken = registrationToken;</span>
<a href="#l14.546"></a><span id="l14.546" class="difflineminus">-    this._subscribe();</span>
<a href="#l14.547"></a><span id="l14.547" class="difflineminus">-  },</span>
<a href="#l14.548"></a><span id="l14.548" class="difflineminus">-</span>
<a href="#l14.549"></a><span id="l14.549" class="difflineminus">-  // Subscribe to the events we want to see.</span>
<a href="#l14.550"></a><span id="l14.550" class="difflineminus">-  _subscribe() {</span>
<a href="#l14.551"></a><span id="l14.551" class="difflineminus">-    this.LOG(&quot;Sending subscription.&quot;);</span>
<a href="#l14.552"></a><span id="l14.552" class="difflineminus">-</span>
<a href="#l14.553"></a><span id="l14.553" class="difflineminus">-    // Subscribe to particular events.</span>
<a href="#l14.554"></a><span id="l14.554" class="difflineminus">-    let messagesUrl =</span>
<a href="#l14.555"></a><span id="l14.555" class="difflineminus">-      &quot;https://&quot; + kMessagesHost + &quot;/v1/users/ME/endpoints/SELF/subscriptions&quot;;</span>
<a href="#l14.556"></a><span id="l14.556" class="difflineminus">-    // The endpoints to subscribe to.</span>
<a href="#l14.557"></a><span id="l14.557" class="difflineminus">-    let subscriptions = {</span>
<a href="#l14.558"></a><span id="l14.558" class="difflineminus">-      interestedResources: [</span>
<a href="#l14.559"></a><span id="l14.559" class="difflineminus">-        &quot;/v1/users/ME/conversations/ALL/properties&quot;,</span>
<a href="#l14.560"></a><span id="l14.560" class="difflineminus">-        &quot;/v1/users/ME/conversations/ALL/messages&quot;,</span>
<a href="#l14.561"></a><span id="l14.561" class="difflineminus">-        &quot;/v1/users/ME/contacts/ALL&quot;,</span>
<a href="#l14.562"></a><span id="l14.562" class="difflineminus">-        &quot;/v1/threads/ALL&quot;,</span>
<a href="#l14.563"></a><span id="l14.563" class="difflineminus">-      ],</span>
<a href="#l14.564"></a><span id="l14.564" class="difflineminus">-      template: &quot;raw&quot;,</span>
<a href="#l14.565"></a><span id="l14.565" class="difflineminus">-      channelType: &quot;httpLongPoll&quot;,</span>
<a href="#l14.566"></a><span id="l14.566" class="difflineminus">-    };</span>
<a href="#l14.567"></a><span id="l14.567" class="difflineminus">-    let options = {</span>
<a href="#l14.568"></a><span id="l14.568" class="difflineminus">-      onLoad: this._onSubscription.bind(this),</span>
<a href="#l14.569"></a><span id="l14.569" class="difflineminus">-      onError: this._onHttpFailure(&quot;subscribing to notifications&quot;),</span>
<a href="#l14.570"></a><span id="l14.570" class="difflineminus">-      postData: JSON.stringify(subscriptions),</span>
<a href="#l14.571"></a><span id="l14.571" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.572"></a><span id="l14.572" class="difflineminus">-    };</span>
<a href="#l14.573"></a><span id="l14.573" class="difflineminus">-    this._messagesRequest(messagesUrl, options);</span>
<a href="#l14.574"></a><span id="l14.574" class="difflineminus">-  },</span>
<a href="#l14.575"></a><span id="l14.575" class="difflineminus">-</span>
<a href="#l14.576"></a><span id="l14.576" class="difflineminus">-  _onSubscription(aResponse, aXhr) {</span>
<a href="#l14.577"></a><span id="l14.577" class="difflineminus">-    this.LOG(&quot;Got subscription response: &quot; + aResponse);</span>
<a href="#l14.578"></a><span id="l14.578" class="difflineminus">-    this.reportConnected();</span>
<a href="#l14.579"></a><span id="l14.579" class="difflineminus">-</span>
<a href="#l14.580"></a><span id="l14.580" class="difflineminus">-    // TODO Check auth requests.</span>
<a href="#l14.581"></a><span id="l14.581" class="difflineminus">-</span>
<a href="#l14.582"></a><span id="l14.582" class="difflineminus">-    // Get friends list.</span>
<a href="#l14.583"></a><span id="l14.583" class="difflineminus">-    let contactListUrl = &quot;https://&quot; + kContactsHost + &quot;/users/self/contacts&quot;;</span>
<a href="#l14.584"></a><span id="l14.584" class="difflineminus">-    let options = {</span>
<a href="#l14.585"></a><span id="l14.585" class="difflineminus">-      onLoad: this._onContactsList.bind(this),</span>
<a href="#l14.586"></a><span id="l14.586" class="difflineminus">-      onError: this._onHttpError.bind(this),</span>
<a href="#l14.587"></a><span id="l14.587" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.588"></a><span id="l14.588" class="difflineminus">-    };</span>
<a href="#l14.589"></a><span id="l14.589" class="difflineminus">-    this._contactsRequest(contactListUrl, options);</span>
<a href="#l14.590"></a><span id="l14.590" class="difflineminus">-</span>
<a href="#l14.591"></a><span id="l14.591" class="difflineminus">-    // Poll for messages.</span>
<a href="#l14.592"></a><span id="l14.592" class="difflineminus">-    this._getMessages();</span>
<a href="#l14.593"></a><span id="l14.593" class="difflineminus">-  },</span>
<a href="#l14.594"></a><span id="l14.594" class="difflineminus">-</span>
<a href="#l14.595"></a><span id="l14.595" class="difflineminus">-  _onContactsList(aResponse, aXhr) {</span>
<a href="#l14.596"></a><span id="l14.596" class="difflineminus">-    this.LOG(&quot;Contacts list: &quot; + aResponse);</span>
<a href="#l14.597"></a><span id="l14.597" class="difflineminus">-</span>
<a href="#l14.598"></a><span id="l14.598" class="difflineminus">-    let buddies = JSON.parse(aResponse);</span>
<a href="#l14.599"></a><span id="l14.599" class="difflineminus">-    if (!buddies) {</span>
<a href="#l14.600"></a><span id="l14.600" class="difflineminus">-      this.ERROR(&quot;Unable to parse JSON response: &quot; + aResponse);</span>
<a href="#l14.601"></a><span id="l14.601" class="difflineminus">-      return;</span>
<a href="#l14.602"></a><span id="l14.602" class="difflineminus">-    }</span>
<a href="#l14.603"></a><span id="l14.603" class="difflineminus">-</span>
<a href="#l14.604"></a><span id="l14.604" class="difflineminus">-    // You have no friends. :( Nothing to do, just move along.</span>
<a href="#l14.605"></a><span id="l14.605" class="difflineminus">-    if (!buddies.length) {</span>
<a href="#l14.606"></a><span id="l14.606" class="difflineminus">-      return;</span>
<a href="#l14.607"></a><span id="l14.607" class="difflineminus">-    }</span>
<a href="#l14.608"></a><span id="l14.608" class="difflineminus">-</span>
<a href="#l14.609"></a><span id="l14.609" class="difflineminus">-    // This gets a little confusing, buddyObj refers to the JSON that was parsed</span>
<a href="#l14.610"></a><span id="l14.610" class="difflineminus">-    // and returned from the server, buddy refers to the prplIAccountBuddy.</span>
<a href="#l14.611"></a><span id="l14.611" class="difflineminus">-    for (let buddyObj of buddies) {</span>
<a href="#l14.612"></a><span id="l14.612" class="difflineminus">-      let buddy = this._buddies.get(buddyObj.skypename);</span>
<a href="#l14.613"></a><span id="l14.613" class="difflineminus">-      if (!buddy) {</span>
<a href="#l14.614"></a><span id="l14.614" class="difflineminus">-        buddy = new SkypeAccountBuddy(</span>
<a href="#l14.615"></a><span id="l14.615" class="difflineminus">-          this,</span>
<a href="#l14.616"></a><span id="l14.616" class="difflineminus">-          null,</span>
<a href="#l14.617"></a><span id="l14.617" class="difflineminus">-          Services.tags.defaultTag,</span>
<a href="#l14.618"></a><span id="l14.618" class="difflineminus">-          buddyObj.skypename</span>
<a href="#l14.619"></a><span id="l14.619" class="difflineminus">-        );</span>
<a href="#l14.620"></a><span id="l14.620" class="difflineminus">-</span>
<a href="#l14.621"></a><span id="l14.621" class="difflineminus">-        // Store the buddy for later.</span>
<a href="#l14.622"></a><span id="l14.622" class="difflineminus">-        this._buddies.set(buddyObj.skypename, buddy);</span>
<a href="#l14.623"></a><span id="l14.623" class="difflineminus">-</span>
<a href="#l14.624"></a><span id="l14.624" class="difflineminus">-        // Notify the UI of the buddy.</span>
<a href="#l14.625"></a><span id="l14.625" class="difflineminus">-        Services.contacts.accountBuddyAdded(buddy);</span>
<a href="#l14.626"></a><span id="l14.626" class="difflineminus">-      }</span>
<a href="#l14.627"></a><span id="l14.627" class="difflineminus">-</span>
<a href="#l14.628"></a><span id="l14.628" class="difflineminus">-      // TODO There is also fullname / skypename.</span>
<a href="#l14.629"></a><span id="l14.629" class="difflineminus">-      // Note that display_name is the public alias that the buddy has set for</span>
<a href="#l14.630"></a><span id="l14.630" class="difflineminus">-      // themselves, skypename is the buddy's unique ID name, fullname is their</span>
<a href="#l14.631"></a><span id="l14.631" class="difflineminus">-      // real name.</span>
<a href="#l14.632"></a><span id="l14.632" class="difflineminus">-      if (buddyObj.display_name) {</span>
<a href="#l14.633"></a><span id="l14.633" class="difflineminus">-        buddy.serverAlias = buddyObj.display_name;</span>
<a href="#l14.634"></a><span id="l14.634" class="difflineminus">-      }</span>
<a href="#l14.635"></a><span id="l14.635" class="difflineminus">-      // Store the buddy info into the object for tooltips.</span>
<a href="#l14.636"></a><span id="l14.636" class="difflineminus">-      buddy._info = buddyObj;</span>
<a href="#l14.637"></a><span id="l14.637" class="difflineminus">-</span>
<a href="#l14.638"></a><span id="l14.638" class="difflineminus">-      // Set the buddy's status to offline until we get an update.</span>
<a href="#l14.639"></a><span id="l14.639" class="difflineminus">-      buddy.setStatus(Ci.imIStatusInfo.STATUS_OFFLINE, &quot;&quot;);</span>
<a href="#l14.640"></a><span id="l14.640" class="difflineminus">-    }</span>
<a href="#l14.641"></a><span id="l14.641" class="difflineminus">-</span>
<a href="#l14.642"></a><span id="l14.642" class="difflineminus">-    // Download profiles.</span>
<a href="#l14.643"></a><span id="l14.643" class="difflineminus">-    let profilesUrl =</span>
<a href="#l14.644"></a><span id="l14.644" class="difflineminus">-      &quot;https://&quot; + kContactsHost + &quot;/users/self/contacts/profiles&quot;;</span>
<a href="#l14.645"></a><span id="l14.645" class="difflineminus">-    let options = {</span>
<a href="#l14.646"></a><span id="l14.646" class="difflineminus">-      postData: buddies.map(b =&gt; [&quot;contacts[]&quot;, b.skypename]),</span>
<a href="#l14.647"></a><span id="l14.647" class="difflineminus">-      onLoad: this._onProfiles.bind(this),</span>
<a href="#l14.648"></a><span id="l14.648" class="difflineminus">-      onError: this._onHttpError.bind(this),</span>
<a href="#l14.649"></a><span id="l14.649" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.650"></a><span id="l14.650" class="difflineminus">-    };</span>
<a href="#l14.651"></a><span id="l14.651" class="difflineminus">-    this.LOG(JSON.stringify(options));</span>
<a href="#l14.652"></a><span id="l14.652" class="difflineminus">-    this._contactsRequest(profilesUrl, options);</span>
<a href="#l14.653"></a><span id="l14.653" class="difflineminus">-</span>
<a href="#l14.654"></a><span id="l14.654" class="difflineminus">-    // Subscribe to user statuses.</span>
<a href="#l14.655"></a><span id="l14.655" class="difflineminus">-    let contactsUrl = &quot;https://&quot; + kMessagesHost + &quot;/v1/users/ME/contacts&quot;;</span>
<a href="#l14.656"></a><span id="l14.656" class="difflineminus">-    let contacts = buddies.map(b =&gt; {</span>
<a href="#l14.657"></a><span id="l14.657" class="difflineminus">-      return { id: &quot;8:&quot; + b.skypename };</span>
<a href="#l14.658"></a><span id="l14.658" class="difflineminus">-    });</span>
<a href="#l14.659"></a><span id="l14.659" class="difflineminus">-    options = {</span>
<a href="#l14.660"></a><span id="l14.660" class="difflineminus">-      postData: JSON.stringify({ contacts }),</span>
<a href="#l14.661"></a><span id="l14.661" class="difflineminus">-      onLoad: (aResponse, aXhr) =&gt;</span>
<a href="#l14.662"></a><span id="l14.662" class="difflineminus">-        this.LOG(&quot;Successfully subscribed to contacts.&quot;),</span>
<a href="#l14.663"></a><span id="l14.663" class="difflineminus">-      onError: this._onHttpError.bind(this),</span>
<a href="#l14.664"></a><span id="l14.664" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.665"></a><span id="l14.665" class="difflineminus">-    };</span>
<a href="#l14.666"></a><span id="l14.666" class="difflineminus">-    this.LOG(JSON.stringify(options));</span>
<a href="#l14.667"></a><span id="l14.667" class="difflineminus">-    this._messagesRequest(contactsUrl, options);</span>
<a href="#l14.668"></a><span id="l14.668" class="difflineminus">-  },</span>
<a href="#l14.669"></a><span id="l14.669" class="difflineminus">-</span>
<a href="#l14.670"></a><span id="l14.670" class="difflineminus">-  _onProfiles(aResponse, aXhr) {</span>
<a href="#l14.671"></a><span id="l14.671" class="difflineminus">-    this.LOG(&quot;Profiles: &quot; + aResponse);</span>
<a href="#l14.672"></a><span id="l14.672" class="difflineminus">-</span>
<a href="#l14.673"></a><span id="l14.673" class="difflineminus">-    let skypeContacts = JSON.parse(aResponse);</span>
<a href="#l14.674"></a><span id="l14.674" class="difflineminus">-</span>
<a href="#l14.675"></a><span id="l14.675" class="difflineminus">-    // TODO Error checking.</span>
<a href="#l14.676"></a><span id="l14.676" class="difflineminus">-</span>
<a href="#l14.677"></a><span id="l14.677" class="difflineminus">-    for (let skypeContact of skypeContacts) {</span>
<a href="#l14.678"></a><span id="l14.678" class="difflineminus">-      let username = skypeContact.username;</span>
<a href="#l14.679"></a><span id="l14.679" class="difflineminus">-</span>
<a href="#l14.680"></a><span id="l14.680" class="difflineminus">-      let buddy = this._buddies.get(username);</span>
<a href="#l14.681"></a><span id="l14.681" class="difflineminus">-      if (!buddy) {</span>
<a href="#l14.682"></a><span id="l14.682" class="difflineminus">-        continue;</span>
<a href="#l14.683"></a><span id="l14.683" class="difflineminus">-      }</span>
<a href="#l14.684"></a><span id="l14.684" class="difflineminus">-</span>
<a href="#l14.685"></a><span id="l14.685" class="difflineminus">-      // Set some properties on the buddy.</span>
<a href="#l14.686"></a><span id="l14.686" class="difflineminus">-      buddy.serverAlias = skypeContact.displayname;</span>
<a href="#l14.687"></a><span id="l14.687" class="difflineminus">-      // TODO There's also firstname and lastname fields.</span>
<a href="#l14.688"></a><span id="l14.688" class="difflineminus">-      buddy.mood = skypeContact.mood;</span>
<a href="#l14.689"></a><span id="l14.689" class="difflineminus">-</span>
<a href="#l14.690"></a><span id="l14.690" class="difflineminus">-      // TODO Download the file and store it in the profile.</span>
<a href="#l14.691"></a><span id="l14.691" class="difflineminus">-      let avatarUrl = skypeContact.avatarUrl;</span>
<a href="#l14.692"></a><span id="l14.692" class="difflineminus">-      if (!avatarUrl) {</span>
<a href="#l14.693"></a><span id="l14.693" class="difflineminus">-        avatarUrl =</span>
<a href="#l14.694"></a><span id="l14.694" class="difflineminus">-          &quot;https://&quot; +</span>
<a href="#l14.695"></a><span id="l14.695" class="difflineminus">-          kContactsHost +</span>
<a href="#l14.696"></a><span id="l14.696" class="difflineminus">-          &quot;/users/&quot; +</span>
<a href="#l14.697"></a><span id="l14.697" class="difflineminus">-          buddy.userName +</span>
<a href="#l14.698"></a><span id="l14.698" class="difflineminus">-          &quot;/profile/avatar&quot;;</span>
<a href="#l14.699"></a><span id="l14.699" class="difflineminus">-      }</span>
<a href="#l14.700"></a><span id="l14.700" class="difflineminus">-      buddy.buddyIconFilename = skypeContact.avatarUrl;</span>
<a href="#l14.701"></a><span id="l14.701" class="difflineminus">-    }</span>
<a href="#l14.702"></a><span id="l14.702" class="difflineminus">-  },</span>
<a href="#l14.703"></a><span id="l14.703" class="difflineminus">-</span>
<a href="#l14.704"></a><span id="l14.704" class="difflineminus">-  /*</span>
<a href="#l14.705"></a><span id="l14.705" class="difflineminus">-   * Download the actual messages, this will recurse through its callback.</span>
<a href="#l14.706"></a><span id="l14.706" class="difflineminus">-   */</span>
<a href="#l14.707"></a><span id="l14.707" class="difflineminus">-  _getMessages() {</span>
<a href="#l14.708"></a><span id="l14.708" class="difflineminus">-    let messagesUrl =</span>
<a href="#l14.709"></a><span id="l14.709" class="difflineminus">-      &quot;https://&quot; +</span>
<a href="#l14.710"></a><span id="l14.710" class="difflineminus">-      kMessagesHost +</span>
<a href="#l14.711"></a><span id="l14.711" class="difflineminus">-      &quot;/v1/users/ME/endpoints/SELF/subscriptions/0/poll&quot;;</span>
<a href="#l14.712"></a><span id="l14.712" class="difflineminus">-    let options = {</span>
<a href="#l14.713"></a><span id="l14.713" class="difflineminus">-      method: &quot;POST&quot;,</span>
<a href="#l14.714"></a><span id="l14.714" class="difflineminus">-      onLoad: this._onMessages.bind(this),</span>
<a href="#l14.715"></a><span id="l14.715" class="difflineminus">-      onError: this._onHttpError.bind(this),</span>
<a href="#l14.716"></a><span id="l14.716" class="difflineminus">-      logger: this._logger,</span>
<a href="#l14.717"></a><span id="l14.717" class="difflineminus">-    };</span>
<a href="#l14.718"></a><span id="l14.718" class="difflineminus">-    this._request = this._messagesRequest(messagesUrl, options);</span>
<a href="#l14.719"></a><span id="l14.719" class="difflineminus">-  },</span>
<a href="#l14.720"></a><span id="l14.720" class="difflineminus">-</span>
<a href="#l14.721"></a><span id="l14.721" class="difflineminus">-  _onMessages(aResponse, aXhr) {</span>
<a href="#l14.722"></a><span id="l14.722" class="difflineminus">-    this.LOG(&quot;Messages: &quot; + aResponse);</span>
<a href="#l14.723"></a><span id="l14.723" class="difflineminus">-</span>
<a href="#l14.724"></a><span id="l14.724" class="difflineminus">-    // Poll for new events by performing another XHR in 1 second.</span>
<a href="#l14.725"></a><span id="l14.725" class="difflineminus">-    this._request = null;</span>
<a href="#l14.726"></a><span id="l14.726" class="difflineminus">-    this._poller = setTimeout(this._getMessages.bind(this), 1000);</span>
<a href="#l14.727"></a><span id="l14.727" class="difflineminus">-</span>
<a href="#l14.728"></a><span id="l14.728" class="difflineminus">-    // Empty responses are received as keep alives.</span>
<a href="#l14.729"></a><span id="l14.729" class="difflineminus">-    if (!aResponse) {</span>
<a href="#l14.730"></a><span id="l14.730" class="difflineminus">-      return;</span>
<a href="#l14.731"></a><span id="l14.731" class="difflineminus">-    }</span>
<a href="#l14.732"></a><span id="l14.732" class="difflineminus">-</span>
<a href="#l14.733"></a><span id="l14.733" class="difflineminus">-    // Otherwise, parse the response as JSON.</span>
<a href="#l14.734"></a><span id="l14.734" class="difflineminus">-    let obj = JSON.parse(aResponse);</span>
<a href="#l14.735"></a><span id="l14.735" class="difflineminus">-    if (!obj) {</span>
<a href="#l14.736"></a><span id="l14.736" class="difflineminus">-      this.ERROR(&quot;Unable to parse JSON response: &quot; + aResponse);</span>
<a href="#l14.737"></a><span id="l14.737" class="difflineminus">-      return;</span>
<a href="#l14.738"></a><span id="l14.738" class="difflineminus">-    }</span>
<a href="#l14.739"></a><span id="l14.739" class="difflineminus">-</span>
<a href="#l14.740"></a><span id="l14.740" class="difflineminus">-    // If no messages, nothing to do.</span>
<a href="#l14.741"></a><span id="l14.741" class="difflineminus">-    if (!(&quot;eventMessages&quot; in obj)) {</span>
<a href="#l14.742"></a><span id="l14.742" class="difflineminus">-      return;</span>
<a href="#l14.743"></a><span id="l14.743" class="difflineminus">-    }</span>
<a href="#l14.744"></a><span id="l14.744" class="difflineminus">-</span>
<a href="#l14.745"></a><span id="l14.745" class="difflineminus">-    for (let message of obj.eventMessages) {</span>
<a href="#l14.746"></a><span id="l14.746" class="difflineminus">-      // The type of message (e.g. new message, new status).</span>
<a href="#l14.747"></a><span id="l14.747" class="difflineminus">-      let resourceType = message.resourceType;</span>
<a href="#l14.748"></a><span id="l14.748" class="difflineminus">-      // The message object.</span>
<a href="#l14.749"></a><span id="l14.749" class="difflineminus">-      let resource = message.resource;</span>
<a href="#l14.750"></a><span id="l14.750" class="difflineminus">-</span>
<a href="#l14.751"></a><span id="l14.751" class="difflineminus">-      // Based on what the message is, totally different things are done below.</span>
<a href="#l14.752"></a><span id="l14.752" class="difflineminus">-      // Sorry for the mess. We can probably abstract this better.</span>
<a href="#l14.753"></a><span id="l14.753" class="difflineminus">-      if (resourceType == &quot;NewMessage&quot;) {</span>
<a href="#l14.754"></a><span id="l14.754" class="difflineminus">-        let messageType = resource.messagetype;</span>
<a href="#l14.755"></a><span id="l14.755" class="difflineminus">-        let from = contactUrlToName(resource.from);</span>
<a href="#l14.756"></a><span id="l14.756" class="difflineminus">-        if (!from) {</span>
<a href="#l14.757"></a><span id="l14.757" class="difflineminus">-          this.WARN(</span>
<a href="#l14.758"></a><span id="l14.758" class="difflineminus">-            &quot;Received a message without a parseable from field: &quot; +</span>
<a href="#l14.759"></a><span id="l14.759" class="difflineminus">-              resource.from</span>
<a href="#l14.760"></a><span id="l14.760" class="difflineminus">-          );</span>
<a href="#l14.761"></a><span id="l14.761" class="difflineminus">-          return;</span>
<a href="#l14.762"></a><span id="l14.762" class="difflineminus">-        }</span>
<a href="#l14.763"></a><span id="l14.763" class="difflineminus">-</span>
<a href="#l14.764"></a><span id="l14.764" class="difflineminus">-        // TODO Handle composetime field?</span>
<a href="#l14.765"></a><span id="l14.765" class="difflineminus">-        let conversationLink = resource.conversationLink;</span>
<a href="#l14.766"></a><span id="l14.766" class="difflineminus">-</span>
<a href="#l14.767"></a><span id="l14.767" class="difflineminus">-        // Check if the conversation is a chat.</span>
<a href="#l14.768"></a><span id="l14.768" class="difflineminus">-        if (conversationLink.includes(&quot;/19:&quot;)) {</span>
<a href="#l14.769"></a><span id="l14.769" class="difflineminus">-          // TODO</span>
<a href="#l14.770"></a><span id="l14.770" class="difflineminus">-          this.WARN(&quot;Received message from MUC.&quot;);</span>
<a href="#l14.771"></a><span id="l14.771" class="difflineminus">-          continue;</span>
<a href="#l14.772"></a><span id="l14.772" class="difflineminus">-        }</span>
<a href="#l14.773"></a><span id="l14.773" class="difflineminus">-</span>
<a href="#l14.774"></a><span id="l14.774" class="difflineminus">-        // Get or create the conversation.</span>
<a href="#l14.775"></a><span id="l14.775" class="difflineminus">-        let conversationName = contactUrlToName(conversationLink);</span>
<a href="#l14.776"></a><span id="l14.776" class="difflineminus">-        let conv = this._conversations.get(conversationName);</span>
<a href="#l14.777"></a><span id="l14.777" class="difflineminus">-</span>
<a href="#l14.778"></a><span id="l14.778" class="difflineminus">-        let messageTypeParts = messageType.split(&quot;/&quot;);</span>
<a href="#l14.779"></a><span id="l14.779" class="difflineminus">-        // Set the typing state (if the conversation exists).</span>
<a href="#l14.780"></a><span id="l14.780" class="difflineminus">-        if (messageTypeParts[0] == &quot;Control&quot; &amp;&amp; conv) {</span>
<a href="#l14.781"></a><span id="l14.781" class="difflineminus">-          let typingState = null;</span>
<a href="#l14.782"></a><span id="l14.782" class="difflineminus">-          // NotTyping or Typing.</span>
<a href="#l14.783"></a><span id="l14.783" class="difflineminus">-          if (messageTypeParts[1] == &quot;Typing&quot;) {</span>
<a href="#l14.784"></a><span id="l14.784" class="difflineminus">-            typingState = Ci.prplIConvIM.TYPING;</span>
<a href="#l14.785"></a><span id="l14.785" class="difflineminus">-          } else if (messageTypeParts[1] == &quot;ClearTyping&quot;) {</span>
<a href="#l14.786"></a><span id="l14.786" class="difflineminus">-            typingState = Ci.prplIConvIM.NOT_TYPING;</span>
<a href="#l14.787"></a><span id="l14.787" class="difflineminus">-          }</span>
<a href="#l14.788"></a><span id="l14.788" class="difflineminus">-          if (typingState !== null) {</span>
<a href="#l14.789"></a><span id="l14.789" class="difflineminus">-            conv.updateTyping(typingState);</span>
<a href="#l14.790"></a><span id="l14.790" class="difflineminus">-          }</span>
<a href="#l14.791"></a><span id="l14.791" class="difflineminus">-          // TODO There doesn't seem to be a &quot;typed&quot; state.</span>
<a href="#l14.792"></a><span id="l14.792" class="difflineminus">-        } else if (messageType == &quot;RichText&quot; || messageType == &quot;Text&quot;) {</span>
<a href="#l14.793"></a><span id="l14.793" class="difflineminus">-          // Create a conversation if it doesn't exist.</span>
<a href="#l14.794"></a><span id="l14.794" class="difflineminus">-          if (!conv) {</span>
<a href="#l14.795"></a><span id="l14.795" class="difflineminus">-            conv = this.createConversation(conversationName);</span>
<a href="#l14.796"></a><span id="l14.796" class="difflineminus">-          }</span>
<a href="#l14.797"></a><span id="l14.797" class="difflineminus">-</span>
<a href="#l14.798"></a><span id="l14.798" class="difflineminus">-          // TODO Handle RichText vs. Text.</span>
<a href="#l14.799"></a><span id="l14.799" class="difflineminus">-</span>
<a href="#l14.800"></a><span id="l14.800" class="difflineminus">-          // Put the message into the conversation.</span>
<a href="#l14.801"></a><span id="l14.801" class="difflineminus">-          let options = {};</span>
<a href="#l14.802"></a><span id="l14.802" class="difflineminus">-          if (from == this.name) {</span>
<a href="#l14.803"></a><span id="l14.803" class="difflineminus">-            options.outgoing = true;</span>
<a href="#l14.804"></a><span id="l14.804" class="difflineminus">-          } else {</span>
<a href="#l14.805"></a><span id="l14.805" class="difflineminus">-            options.incoming = true;</span>
<a href="#l14.806"></a><span id="l14.806" class="difflineminus">-          }</span>
<a href="#l14.807"></a><span id="l14.807" class="difflineminus">-          conv.writeMessage(from, resource.content, options);</span>
<a href="#l14.808"></a><span id="l14.808" class="difflineminus">-        }</span>
<a href="#l14.809"></a><span id="l14.809" class="difflineminus">-      } else if (resourceType == &quot;UserPresence&quot;) {</span>
<a href="#l14.810"></a><span id="l14.810" class="difflineminus">-        // Ignore our own statuses.</span>
<a href="#l14.811"></a><span id="l14.811" class="difflineminus">-        let from = contactUrlToName(resource.selfLink);</span>
<a href="#l14.812"></a><span id="l14.812" class="difflineminus">-        if (!from) {</span>
<a href="#l14.813"></a><span id="l14.813" class="difflineminus">-          continue;</span>
<a href="#l14.814"></a><span id="l14.814" class="difflineminus">-        }</span>
<a href="#l14.815"></a><span id="l14.815" class="difflineminus">-</span>
<a href="#l14.816"></a><span id="l14.816" class="difflineminus">-        // Get the buddy and update the status.</span>
<a href="#l14.817"></a><span id="l14.817" class="difflineminus">-        let buddy = this._buddies.get(from);</span>
<a href="#l14.818"></a><span id="l14.818" class="difflineminus">-        if (buddy) {</span>
<a href="#l14.819"></a><span id="l14.819" class="difflineminus">-          buddy.setStatus(this.mapStatusString(resource.status), &quot;&quot;);</span>
<a href="#l14.820"></a><span id="l14.820" class="difflineminus">-        }</span>
<a href="#l14.821"></a><span id="l14.821" class="difflineminus">-      } else if (resourceType == &quot;EndpointPresence&quot;) {</span>
<a href="#l14.822"></a><span id="l14.822" class="difflineminus">-        // Nothing to do.</span>
<a href="#l14.823"></a><span id="l14.823" class="difflineminus">-      } else if (resourceType == &quot;ConversationUpdate&quot;) {</span>
<a href="#l14.824"></a><span id="l14.824" class="difflineminus">-        // Nothing to do.</span>
<a href="#l14.825"></a><span id="l14.825" class="difflineminus">-      } else if (resourceType == &quot;ThreadUpdate&quot;) {</span>
<a href="#l14.826"></a><span id="l14.826" class="difflineminus">-        // Nothing to do.</span>
<a href="#l14.827"></a><span id="l14.827" class="difflineminus">-      } else {</span>
<a href="#l14.828"></a><span id="l14.828" class="difflineminus">-        this.WARN(&quot;Unhandled resource type: &quot; + resourceType);</span>
<a href="#l14.829"></a><span id="l14.829" class="difflineminus">-      }</span>
<a href="#l14.830"></a><span id="l14.830" class="difflineminus">-    }</span>
<a href="#l14.831"></a><span id="l14.831" class="difflineminus">-  },</span>
<a href="#l14.832"></a><span id="l14.832" class="difflineminus">-</span>
<a href="#l14.833"></a><span id="l14.833" class="difflineminus">-  /*</span>
<a href="#l14.834"></a><span id="l14.834" class="difflineminus">-   * Make a request to the Skype contacts API, this is essentially just</span>
<a href="#l14.835"></a><span id="l14.835" class="difflineminus">-   * httpRequest, but auto-adds a bunch of headers that are necessary.</span>
<a href="#l14.836"></a><span id="l14.836" class="difflineminus">-   */</span>
<a href="#l14.837"></a><span id="l14.837" class="difflineminus">-  _contactsRequest(aUrl, aOptions = {}) {</span>
<a href="#l14.838"></a><span id="l14.838" class="difflineminus">-    let headers = aOptions.headers || [];</span>
<a href="#l14.839"></a><span id="l14.839" class="difflineminus">-</span>
<a href="#l14.840"></a><span id="l14.840" class="difflineminus">-    // Add some special Skype headers.</span>
<a href="#l14.841"></a><span id="l14.841" class="difflineminus">-    headers = headers.concat([</span>
<a href="#l14.842"></a><span id="l14.842" class="difflineminus">-      [&quot;X-Skypetoken&quot;, this._skypeToken],</span>
<a href="#l14.843"></a><span id="l14.843" class="difflineminus">-      [&quot;X-Stratus-Caller&quot;, &quot;swx-skype.com&quot;],</span>
<a href="#l14.844"></a><span id="l14.844" class="difflineminus">-      [&quot;X-Stratus-Request&quot;, &quot;abcd1234&quot;],</span>
<a href="#l14.845"></a><span id="l14.845" class="difflineminus">-      [&quot;Origin&quot;, &quot;https://web.skype.com&quot;],</span>
<a href="#l14.846"></a><span id="l14.846" class="difflineminus">-      [&quot;Referer&quot;, &quot;https://web.skype.com/main&quot;],</span>
<a href="#l14.847"></a><span id="l14.847" class="difflineminus">-      [&quot;Accept&quot;, &quot;application/json; ver=1.0;&quot;],</span>
<a href="#l14.848"></a><span id="l14.848" class="difflineminus">-    ]);</span>
<a href="#l14.849"></a><span id="l14.849" class="difflineminus">-</span>
<a href="#l14.850"></a><span id="l14.850" class="difflineminus">-    aOptions.headers = headers;</span>
<a href="#l14.851"></a><span id="l14.851" class="difflineminus">-</span>
<a href="#l14.852"></a><span id="l14.852" class="difflineminus">-    return httpRequest(aUrl, aOptions);</span>
<a href="#l14.853"></a><span id="l14.853" class="difflineminus">-  },</span>
<a href="#l14.854"></a><span id="l14.854" class="difflineminus">-</span>
<a href="#l14.855"></a><span id="l14.855" class="difflineminus">-  /*</span>
<a href="#l14.856"></a><span id="l14.856" class="difflineminus">-   * Make a request to the Skype messages API, this is essentially just</span>
<a href="#l14.857"></a><span id="l14.857" class="difflineminus">-   * httpRequest, but auto-adds a bunch of headers that are necessary.</span>
<a href="#l14.858"></a><span id="l14.858" class="difflineminus">-   */</span>
<a href="#l14.859"></a><span id="l14.859" class="difflineminus">-  _messagesRequest(aUrl, aOptions = {}) {</span>
<a href="#l14.860"></a><span id="l14.860" class="difflineminus">-    let headers = aOptions.headers || [];</span>
<a href="#l14.861"></a><span id="l14.861" class="difflineminus">-</span>
<a href="#l14.862"></a><span id="l14.862" class="difflineminus">-    // Add some special Skype headers.</span>
<a href="#l14.863"></a><span id="l14.863" class="difflineminus">-    headers = headers.concat([</span>
<a href="#l14.864"></a><span id="l14.864" class="difflineminus">-      [&quot;RegistrationToken&quot;, this._registrationToken],</span>
<a href="#l14.865"></a><span id="l14.865" class="difflineminus">-      [&quot;Referer&quot;, &quot;https://web.skype.com/main&quot;],</span>
<a href="#l14.866"></a><span id="l14.866" class="difflineminus">-      [&quot;Accept&quot;, &quot;application/json; ver=1.0;&quot;],</span>
<a href="#l14.867"></a><span id="l14.867" class="difflineminus">-      [&quot;ClientInfo&quot;, kClientInfo],</span>
<a href="#l14.868"></a><span id="l14.868" class="difflineminus">-    ]);</span>
<a href="#l14.869"></a><span id="l14.869" class="difflineminus">-</span>
<a href="#l14.870"></a><span id="l14.870" class="difflineminus">-    aOptions.headers = headers;</span>
<a href="#l14.871"></a><span id="l14.871" class="difflineminus">-</span>
<a href="#l14.872"></a><span id="l14.872" class="difflineminus">-    return httpRequest(aUrl, aOptions);</span>
<a href="#l14.873"></a><span id="l14.873" class="difflineminus">-  },</span>
<a href="#l14.874"></a><span id="l14.874" class="difflineminus">-</span>
<a href="#l14.875"></a><span id="l14.875" class="difflineminus">-  // Helper function to disconnect with authentication failed.</span>
<a href="#l14.876"></a><span id="l14.876" class="difflineminus">-  _disconnectWithAuthFailure(aMessageId = &quot;error.auth&quot;) {</span>
<a href="#l14.877"></a><span id="l14.877" class="difflineminus">-    this.reportDisconnecting(</span>
<a href="#l14.878"></a><span id="l14.878" class="difflineminus">-      Ci.prplIAccount.ERROR_AUTHENTICATION_FAILED,</span>
<a href="#l14.879"></a><span id="l14.879" class="difflineminus">-      _(aMessageId)</span>
<a href="#l14.880"></a><span id="l14.880" class="difflineminus">-    );</span>
<a href="#l14.881"></a><span id="l14.881" class="difflineminus">-    this.reportDisconnected();</span>
<a href="#l14.882"></a><span id="l14.882" class="difflineminus">-  },</span>
<a href="#l14.883"></a><span id="l14.883" class="difflineminus">-</span>
<a href="#l14.884"></a><span id="l14.884" class="difflineminus">-  disconnect() {</span>
<a href="#l14.885"></a><span id="l14.885" class="difflineminus">-    if (this.disconnected || this.disconnecting) {</span>
<a href="#l14.886"></a><span id="l14.886" class="difflineminus">-      return;</span>
<a href="#l14.887"></a><span id="l14.887" class="difflineminus">-    }</span>
<a href="#l14.888"></a><span id="l14.888" class="difflineminus">-</span>
<a href="#l14.889"></a><span id="l14.889" class="difflineminus">-    clearTimeout(this._poller);</span>
<a href="#l14.890"></a><span id="l14.890" class="difflineminus">-    if (this._request) {</span>
<a href="#l14.891"></a><span id="l14.891" class="difflineminus">-      this._request.abort();</span>
<a href="#l14.892"></a><span id="l14.892" class="difflineminus">-    }</span>
<a href="#l14.893"></a><span id="l14.893" class="difflineminus">-</span>
<a href="#l14.894"></a><span id="l14.894" class="difflineminus">-    this._request = null;</span>
<a href="#l14.895"></a><span id="l14.895" class="difflineminus">-    this._poller = null;</span>
<a href="#l14.896"></a><span id="l14.896" class="difflineminus">-</span>
<a href="#l14.897"></a><span id="l14.897" class="difflineminus">-    // Mark all contacts on the account as having an unknown status.</span>
<a href="#l14.898"></a><span id="l14.898" class="difflineminus">-    this._buddies.forEach(aBuddy =&gt;</span>
<a href="#l14.899"></a><span id="l14.899" class="difflineminus">-      aBuddy.setStatus(Ci.imIStatusInfo.STATUS_UNKNOWN, &quot;&quot;)</span>
<a href="#l14.900"></a><span id="l14.900" class="difflineminus">-    );</span>
<a href="#l14.901"></a><span id="l14.901" class="difflineminus">-</span>
<a href="#l14.902"></a><span id="l14.902" class="difflineminus">-    this.reportDisconnected();</span>
<a href="#l14.903"></a><span id="l14.903" class="difflineminus">-  },</span>
<a href="#l14.904"></a><span id="l14.904" class="difflineminus">-</span>
<a href="#l14.905"></a><span id="l14.905" class="difflineminus">-  // TODO?</span>
<a href="#l14.906"></a><span id="l14.906" class="difflineminus">-  observe(aSubject, aTopic, aData) {},</span>
<a href="#l14.907"></a><span id="l14.907" class="difflineminus">-</span>
<a href="#l14.908"></a><span id="l14.908" class="difflineminus">-  remove() {</span>
<a href="#l14.909"></a><span id="l14.909" class="difflineminus">-    this._conversations.forEach(conv =&gt; conv.close());</span>
<a href="#l14.910"></a><span id="l14.910" class="difflineminus">-    delete this._conversations;</span>
<a href="#l14.911"></a><span id="l14.911" class="difflineminus">-    this.buddies.forEach(aBuddy =&gt; aBuddy.remove());</span>
<a href="#l14.912"></a><span id="l14.912" class="difflineminus">-    delete this.buddies;</span>
<a href="#l14.913"></a><span id="l14.913" class="difflineminus">-  },</span>
<a href="#l14.914"></a><span id="l14.914" class="difflineminus">-</span>
<a href="#l14.915"></a><span id="l14.915" class="difflineminus">-  unInit() {</span>
<a href="#l14.916"></a><span id="l14.916" class="difflineminus">-    delete this.imAccount;</span>
<a href="#l14.917"></a><span id="l14.917" class="difflineminus">-    clearTimeout(this._poller);</span>
<a href="#l14.918"></a><span id="l14.918" class="difflineminus">-  },</span>
<a href="#l14.919"></a><span id="l14.919" class="difflineminus">-</span>
<a href="#l14.920"></a><span id="l14.920" class="difflineminus">-  createConversation(aName) {</span>
<a href="#l14.921"></a><span id="l14.921" class="difflineminus">-    let conv = new SkypeConversation(this, aName);</span>
<a href="#l14.922"></a><span id="l14.922" class="difflineminus">-    this._conversations.set(aName, conv);</span>
<a href="#l14.923"></a><span id="l14.923" class="difflineminus">-    return conv;</span>
<a href="#l14.924"></a><span id="l14.924" class="difflineminus">-  },</span>
<a href="#l14.925"></a><span id="l14.925" class="difflineminus">-</span>
<a href="#l14.926"></a><span id="l14.926" class="difflineminus">-  // Called when the user adds or authorizes a new contact.</span>
<a href="#l14.927"></a><span id="l14.927" class="difflineminus">-  addBuddy(aTag, aName) {},</span>
<a href="#l14.928"></a><span id="l14.928" class="difflineminus">-</span>
<a href="#l14.929"></a><span id="l14.929" class="difflineminus">-  loadBuddy(aBuddy, aTag) {</span>
<a href="#l14.930"></a><span id="l14.930" class="difflineminus">-    let buddy = new SkypeAccountBuddy(this, aBuddy, aTag);</span>
<a href="#l14.931"></a><span id="l14.931" class="difflineminus">-    this._buddies.set(buddy.userName, buddy);</span>
<a href="#l14.932"></a><span id="l14.932" class="difflineminus">-</span>
<a href="#l14.933"></a><span id="l14.933" class="difflineminus">-    return buddy;</span>
<a href="#l14.934"></a><span id="l14.934" class="difflineminus">-  },</span>
<a href="#l14.935"></a><span id="l14.935" class="difflineminus">-</span>
<a href="#l14.936"></a><span id="l14.936" class="difflineminus">-  // TODO Add support for MUCs.</span>
<a href="#l14.937"></a><span id="l14.937" class="difflineminus">-  get canJoinChat() {</span>
<a href="#l14.938"></a><span id="l14.938" class="difflineminus">-    return false;</span>
<a href="#l14.939"></a><span id="l14.939" class="difflineminus">-  },</span>
<a href="#l14.940"></a><span id="l14.940" class="difflineminus">-  chatRoomFields: {},</span>
<a href="#l14.941"></a><span id="l14.941" class="difflineminus">-  joinChat(aComponents) {},</span>
<a href="#l14.942"></a><span id="l14.942" class="difflineminus">-};</span>
<a href="#l14.943"></a><span id="l14.943" class="difflineminus">-</span>
<a href="#l14.944"></a><span id="l14.944" class="difflineminus">-function SkypeProtocol() {}</span>
<a href="#l14.945"></a><span id="l14.945" class="difflineminus">-SkypeProtocol.prototype = {</span>
<a href="#l14.946"></a><span id="l14.946" class="difflineminus">-  __proto__: GenericProtocolPrototype,</span>
<a href="#l14.947"></a><span id="l14.947" class="difflineminus">-  get name() {</span>
<a href="#l14.948"></a><span id="l14.948" class="difflineminus">-    return &quot;Skype&quot;;</span>
<a href="#l14.949"></a><span id="l14.949" class="difflineminus">-  },</span>
<a href="#l14.950"></a><span id="l14.950" class="difflineminus">-  get iconBaseURI() {</span>
<a href="#l14.951"></a><span id="l14.951" class="difflineminus">-    return &quot;chrome://prpl-skype/skin/&quot;;</span>
<a href="#l14.952"></a><span id="l14.952" class="difflineminus">-  },</span>
<a href="#l14.953"></a><span id="l14.953" class="difflineminus">-  get baseId() {</span>
<a href="#l14.954"></a><span id="l14.954" class="difflineminus">-    return &quot;prpl-skype&quot;;</span>
<a href="#l14.955"></a><span id="l14.955" class="difflineminus">-  },</span>
<a href="#l14.956"></a><span id="l14.956" class="difflineminus">-</span>
<a href="#l14.957"></a><span id="l14.957" class="difflineminus">-  get passwordOptional() {</span>
<a href="#l14.958"></a><span id="l14.958" class="difflineminus">-    return false;</span>
<a href="#l14.959"></a><span id="l14.959" class="difflineminus">-  },</span>
<a href="#l14.960"></a><span id="l14.960" class="difflineminus">-</span>
<a href="#l14.961"></a><span id="l14.961" class="difflineminus">-  getAccount(aImAccount) {</span>
<a href="#l14.962"></a><span id="l14.962" class="difflineminus">-    return new SkypeAccount(this, aImAccount);</span>
<a href="#l14.963"></a><span id="l14.963" class="difflineminus">-  },</span>
<a href="#l14.964"></a><span id="l14.964" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">deleted file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- a/chat/protocols/skype/test/test_MagicSha256.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ /dev/null</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -1,26 +0,0 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">- * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">-</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">-var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">-var skype = {};</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-Services.scriptloader.loadSubScript(&quot;resource:///modules/skype.jsm&quot;, skype);</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">-</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-var data = {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  &quot;1416264993&quot;: &quot;3a33ac47fe2ec1a33d569f4be5c69ddc&quot;,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  &quot;1416387358&quot;: &quot;eca9716e1eedcbe93320ba794cea3388&quot;,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  &quot;1416392361&quot;: &quot;2ed6fc80c3303caa137ae3fd4fcc7d80&quot;,</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-};</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-function run_test() {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-  add_test(test_MagicSha256);</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-  run_next_test();</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-}</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-function test_MagicSha256() {</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-  for (let input in data) {</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-    equal(data[input], skype.magicSha256(input));</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-  }</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-  run_next_test();</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">deleted file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- a/chat/protocols/skype/test/test_contactUrlToName.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ /dev/null</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -1,27 +0,0 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineminus">-/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineminus">- * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineminus">-</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineminus">-var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineminus">-var skype = {};</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">-Services.scriptloader.loadSubScript(&quot;resource:///modules/skype.jsm&quot;, skype);</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">-</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-var data = {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  &quot;https://bay-client-s.gateway.messenger.live.com/v1/users/ME/contacts/8:clokep&quot;:</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-    &quot;clokep&quot;,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  &quot;https://bay-client-s.gateway.messenger.live.com/v1/users/8:clokep/presenceDocs/messagingService&quot;:</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-    &quot;clokep&quot;,</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-};</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-function run_test() {</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-  add_test(test_contactUrlToName);</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-  run_next_test();</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-}</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-function test_contactUrlToName() {</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-  for (let input in data) {</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-    equal(data[input], skype.contactUrlToName(input));</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-  }</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-  run_next_test();</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">deleted file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- a/chat/protocols/skype/test/xpcshell.ini</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ /dev/null</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -1,6 +0,0 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineminus">-[DEFAULT]</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineminus">-head =</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineminus">-tail =</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineminus">-</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineminus">-[test_contactUrlToName.js]</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">-[test_MagicSha256.js]</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

