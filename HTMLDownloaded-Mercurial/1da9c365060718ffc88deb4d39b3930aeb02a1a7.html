<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28932:1da9c365060718ffc88deb4d39b3930aeb02a1a7</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1da9c365060718ffc88deb4d39b3930aeb02a1a7" />
<meta property="og:url" content="/comm-central/rev/1da9c365060718ffc88deb4d39b3930aeb02a1a7" />
<meta property="og:description" content="Bug 1614846 - remove nsIArray use in nsIMsgAccountManager (part one: accounts). r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1da9c365060718ffc88deb4d39b3930aeb02a1a7 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1da9c365060718ffc88deb4d39b3930aeb02a1a7">shortlog</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1da9c365060718ffc88deb4d39b3930aeb02a1a7">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7">files</a> |
changeset |
<a href="/comm-central/raw-rev/1da9c365060718ffc88deb4d39b3930aeb02a1a7">raw</a>  | <a href="/comm-central/archive/1da9c365060718ffc88deb4d39b3930aeb02a1a7.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1614846">Bug 1614846</a> - remove nsIArray use in nsIMsgAccountManager (part one: accounts). r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#66;&#101;&#110;&#32;&#67;&#97;&#109;&#112;&#98;&#101;&#108;&#108;&#32;&#60;&#98;&#101;&#110;&#99;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 16 Feb 2020 08:48:01 +1300</td></tr>

<tr>
 <td>changeset 28932</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1da9c365060718ffc88deb4d39b3930aeb02a1a7">1da9c365060718ffc88deb4d39b3930aeb02a1a7</a></td>
</tr>



<tr>
<td>parent 28931</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7d7596b594c302f882acb50ebe5d98d971ceb1a2">7d7596b594c302f882acb50ebe5d98d971ceb1a2</a>
</td>
</tr>

<tr>
<td>child 28933</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cd8871b0a49c89f2265cb1c039f1efe139052fb8">cd8871b0a49c89f2265cb1c039f1efe139052fb8</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1da9c365060718ffc88deb4d39b3930aeb02a1a7">17114</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Mon, 09 Mar 2020 04:32:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d1e9c855e247 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d1e9c855e2476af1edeb549575195eae1c318354">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d1e9c855e2476af1edeb549575195eae1c318354&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d1e9c855e2476af1edeb549575195eae1c318354&newProject=comm-central&newRevision=15b43b265eb46cbfcd989bb9e817cdead267fef1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d1e9c855e2476af1edeb549575195eae1c318354&newProject=comm-central&newRevision=15b43b265eb46cbfcd989bb9e817cdead267fef1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d1e9c855e2476af1edeb549575195eae1c318354&newProject=comm-central&newRevision=15b43b265eb46cbfcd989bb9e817cdead267fef1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1614846">1614846</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1614846">Bug 1614846</a> - remove nsIArray use in nsIMsgAccountManager (part one: accounts). r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calEmailUtils.jsm">calendar/base/modules/utils/calEmailUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calEmailUtils.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calEmailUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calEmailUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calEmailUtils.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calEmailUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calProviderUtils.jsm">calendar/base/modules/utils/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/calendar/base/modules/utils/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/about-support/content/accounts.js">mail/components/about-support/content/accounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/about-support/content/accounts.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/about-support/content/accounts.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/about-support/content/accounts.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/about-support/content/accounts.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/about-support/content/accounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/cloudfile/test/browser/head.js">mail/components/cloudfile/test/browser/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/cloudfile/test/browser/head.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/cloudfile/test/browser/head.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/cloudfile/test/browser/head.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/cloudfile/test/browser/head.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/cloudfile/test/browser/head.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/parent/ext-accounts.js">mail/components/extensions/parent/ext-accounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/parent/ext-accounts.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/parent/ext-accounts.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/parent/ext-accounts.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/parent/ext-accounts.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/parent/ext-accounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/browser/head.js">mail/components/extensions/test/browser/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/browser/head.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/browser/head.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/browser/head.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/browser/head.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/browser/head.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/xpcshell/head.js">mail/components/extensions/test/xpcshell/head.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/xpcshell/head.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/xpcshell/head.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/xpcshell/head.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/xpcshell/head.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/extensions/test/xpcshell/head.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/content/imAccounts.js">mail/components/im/content/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/content/imAccounts.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/content/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/content/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/content/imAccounts.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/content/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/chatHandler.jsm">mail/components/im/modules/chatHandler.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/chatHandler.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/chatHandler.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/chatHandler.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/chatHandler.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/chatHandler.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/index_im.jsm">mail/components/im/modules/index_im.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/index_im.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/index_im.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/index_im.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/index_im.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/components/im/modules/index_im.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/configure.jsm">mail/extensions/openpgp/content/modules/configure.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/configure.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/configure.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/configure.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/configure.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/configure.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/funcs.jsm">mail/extensions/openpgp/content/modules/funcs.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/funcs.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/funcs.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/funcs.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/funcs.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/funcs.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/keyUsability.jsm">mail/extensions/openpgp/content/modules/keyUsability.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/keyUsability.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/keyUsability.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/keyUsability.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/keyUsability.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/keyUsability.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">mail/extensions/openpgp/content/modules/stdlib/misc.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/composition/browser_addressWidgets.js">mail/test/browser/composition/browser_addressWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/composition/browser_addressWidgets.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/composition/browser_addressWidgets.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/composition/browser_addressWidgets.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/composition/browser_addressWidgets.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/composition/browser_addressWidgets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js">mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/multiple-identities/browser_displayNames.js">mail/test/browser/multiple-identities/browser_displayNames.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/multiple-identities/browser_displayNames.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/multiple-identities/browser_displayNames.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/multiple-identities/browser_displayNames.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/multiple-identities/browser_displayNames.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/multiple-identities/browser_displayNames.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm">mail/test/browser/shared-modules/NewMailAccountHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/accountUtils.js">mailnews/base/prefs/content/accountUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/accountUtils.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/accountUtils.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/accountUtils.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/accountUtils.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/accountUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/am-server.js">mailnews/base/prefs/content/am-server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/am-server.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/am-server.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/am-server.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/am-server.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/am-server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/amUtils.js">mailnews/base/prefs/content/amUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/amUtils.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/amUtils.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/amUtils.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/amUtils.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/prefs/content/amUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/public/nsIMsgAccountManager.idl">mailnews/base/public/nsIMsgAccountManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/public/nsIMsgAccountManager.idl">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/public/nsIMsgAccountManager.idl">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/public/nsIMsgAccountManager.idl">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/public/nsIMsgAccountManager.idl">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/public/nsIMsgAccountManager.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/test/unit/test_nsIMsgFolder.js">mailnews/base/test/unit/test_nsIMsgFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/test/unit/test_nsIMsgFolder.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/test/unit/test_nsIMsgFolder.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/test/unit/test_nsIMsgFolder.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/test/unit/test_nsIMsgFolder.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/test/unit/test_nsIMsgFolder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/util/folderUtils.jsm">mailnews/base/util/folderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/util/folderUtils.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/util/folderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/util/folderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/util/folderUtils.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/base/util/folderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/db/gloda/modules/IndexMsg.jsm">mailnews/db/gloda/modules/IndexMsg.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/db/gloda/modules/IndexMsg.jsm">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/db/gloda/modules/IndexMsg.jsm">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/db/gloda/modules/IndexMsg.jsm">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/db/gloda/modules/IndexMsg.jsm">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/db/gloda/modules/IndexMsg.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/imap/src/nsAutoSyncManager.cpp">mailnews/imap/src/nsAutoSyncManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/imap/src/nsAutoSyncManager.cpp">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/imap/src/nsAutoSyncManager.cpp">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/imap/src/nsAutoSyncManager.cpp">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/imap/src/nsAutoSyncManager.cpp">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/imap/src/nsAutoSyncManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/becky/src/nsBeckyFilters.cpp">mailnews/import/becky/src/nsBeckyFilters.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/becky/src/nsBeckyFilters.cpp">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/becky/src/nsBeckyFilters.cpp">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/becky/src/nsBeckyFilters.cpp">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/becky/src/nsBeckyFilters.cpp">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/becky/src/nsBeckyFilters.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/test/unit/resources/import_helper.js">mailnews/import/test/unit/resources/import_helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/test/unit/resources/import_helper.js">file</a> |
<a href="/comm-central/annotate/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/test/unit/resources/import_helper.js">annotate</a> |
<a href="/comm-central/diff/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/test/unit/resources/import_helper.js">diff</a> |
<a href="/comm-central/comparison/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/test/unit/resources/import_helper.js">comparison</a> |
<a href="/comm-central/log/1da9c365060718ffc88deb4d39b3930aeb02a1a7/mailnews/import/test/unit/resources/import_helper.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/modules/utils/calEmailUtils.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/modules/utils/calEmailUtils.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -48,19 +48,17 @@ var calemail = {</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">   /**</span>
<a href="#l1.6"></a><span id="l1.6">    * Iterates all email identities and calls the passed function with identity and account.</span>
<a href="#l1.7"></a><span id="l1.7">    * If the called function returns false, iteration is stopped.</span>
<a href="#l1.8"></a><span id="l1.8">    *</span>
<a href="#l1.9"></a><span id="l1.9">    * @param {Function} aFunc       The function to be called for each identity and account</span>
<a href="#l1.10"></a><span id="l1.10">    */</span>
<a href="#l1.11"></a><span id="l1.11">   iterateIdentities(aFunc) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    let accounts = MailServices.accounts.accounts;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-    for (let i = 0; i &lt; accounts.length; ++i) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-      let account = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    for (let account of MailServices.accounts.accounts) {</span>
<a href="#l1.16"></a><span id="l1.16">       let identities = account.identities;</span>
<a href="#l1.17"></a><span id="l1.17">       for (let j = 0; j &lt; identities.length; ++j) {</span>
<a href="#l1.18"></a><span id="l1.18">         let identity = identities.queryElementAt(j, Ci.nsIMsgIdentity);</span>
<a href="#l1.19"></a><span id="l1.19">         if (!aFunc(identity, account)) {</span>
<a href="#l1.20"></a><span id="l1.20">           break;</span>
<a href="#l1.21"></a><span id="l1.21">         }</span>
<a href="#l1.22"></a><span id="l1.22">       }</span>
<a href="#l1.23"></a><span id="l1.23">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> var { MailServices } = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l2.9"></a><span id="l2.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineminus">-var { fixIterator } = ChromeUtils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12"> ChromeUtils.defineModuleGetter(this, &quot;cal&quot;, &quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> /*</span>
<a href="#l2.15"></a><span id="l2.15">  * Helpers and base class for calendar providers</span>
<a href="#l2.16"></a><span id="l2.16">  */</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> // NOTE: This module should not be loaded directly, it is available when</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineat">@@ -262,18 +261,17 @@ var calprovider = {</span>
<a href="#l2.20"></a><span id="l2.20">         }</span>
<a href="#l2.21"></a><span id="l2.21">         return null;</span>
<a href="#l2.22"></a><span id="l2.22">       };</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">       let foundAccount = MailServices.accounts.defaultAccount;</span>
<a href="#l2.25"></a><span id="l2.25">       let foundIdentity = findIdentity(foundAccount);</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27">       if (!foundAccount || !foundIdentity) {</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-        let accounts = MailServices.accounts.accounts;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-        for (let account of fixIterator(accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+        for (let account of MailServices.accounts.accounts) {</span>
<a href="#l2.31"></a><span id="l2.31">           let identity = findIdentity(account);</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33">           if (account &amp;&amp; identity) {</span>
<a href="#l2.34"></a><span id="l2.34">             foundAccount = account;</span>
<a href="#l2.35"></a><span id="l2.35">             foundIdentity = identity;</span>
<a href="#l2.36"></a><span id="l2.36">             break;</span>
<a href="#l2.37"></a><span id="l2.37">           }</span>
<a href="#l2.38"></a><span id="l2.38">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/about-support/content/accounts.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/about-support/content/accounts.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -85,19 +85,18 @@ var AboutSupport = {</span>
<a href="#l3.4"></a><span id="l3.4">     return smtpDetails;</span>
<a href="#l3.5"></a><span id="l3.5">   },</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">   /**</span>
<a href="#l3.8"></a><span id="l3.8">    * Returns account details as an array of records.</span>
<a href="#l3.9"></a><span id="l3.9">    */</span>
<a href="#l3.10"></a><span id="l3.10">   getAccountDetails() {</span>
<a href="#l3.11"></a><span id="l3.11">     let accountDetails = [];</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    let accounts = MailServices.accounts.accounts;</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-    for (let account of fixIterator(accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    for (let account of MailServices.accounts.accounts) {</span>
<a href="#l3.16"></a><span id="l3.16">       let server = account.incomingServer;</span>
<a href="#l3.17"></a><span id="l3.17">       accountDetails.push({</span>
<a href="#l3.18"></a><span id="l3.18">         key: account.key,</span>
<a href="#l3.19"></a><span id="l3.19">         name: server.prettyName,</span>
<a href="#l3.20"></a><span id="l3.20">         hostDetails:</span>
<a href="#l3.21"></a><span id="l3.21">           &quot;(&quot; +</span>
<a href="#l3.22"></a><span id="l3.22">           server.type +</span>
<a href="#l3.23"></a><span id="l3.23">           &quot;) &quot; +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/cloudfile/test/browser/head.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/cloudfile/test/browser/head.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -12,21 +12,21 @@ add_task(async function setup() {</span>
<a href="#l4.4"></a><span id="l4.4">   let rootFolder = gAccount.incomingServer.rootFolder;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">   window.gFolderTreeView.selectFolder(rootFolder);</span>
<a href="#l4.7"></a><span id="l4.7">   await new Promise(resolve =&gt; executeSoon(resolve));</span>
<a href="#l4.8"></a><span id="l4.8"> });</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> function createAccount() {</span>
<a href="#l4.11"></a><span id="l4.11">   registerCleanupFunction(() =&gt; {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    [...MailServices.accounts.accounts.enumerate()].forEach(cleanUpAccount);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    MailServices.accounts.accounts.forEach(cleanUpAccount);</span>
<a href="#l4.14"></a><span id="l4.14">   });</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">   MailServices.accounts.createLocalMailAccount();</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-  let account = MailServices.accounts.accounts.enumerate().getNext();</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  let account = MailServices.accounts.accounts[0];</span>
<a href="#l4.19"></a><span id="l4.19">   info(`Created account ${account.toString()}`);</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">   return account;</span>
<a href="#l4.22"></a><span id="l4.22"> }</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24"> function cleanUpAccount(account) {</span>
<a href="#l4.25"></a><span id="l4.25">   info(`Cleaning up account ${account.toString()}`);</span>
<a href="#l4.26"></a><span id="l4.26">   MailServices.accounts.removeAccount(account, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -6696,20 +6696,17 @@ function DetermineConvertibility() {</span>
<a href="#l5.4"></a><span id="l5.4">  *</span>
<a href="#l5.5"></a><span id="l5.5">  * @param {string} accountKey - Key of the account that is currently selected</span>
<a href="#l5.6"></a><span id="l5.6">  *   as the sending account.</span>
<a href="#l5.7"></a><span id="l5.7">  * @param {string} prevKey - Key of the account that was previously selected</span>
<a href="#l5.8"></a><span id="l5.8">  *   as the sending account.</span>
<a href="#l5.9"></a><span id="l5.9">  */</span>
<a href="#l5.10"></a><span id="l5.10"> function hideIrrelevantAddressingOptions(accountKey, prevKey) {</span>
<a href="#l5.11"></a><span id="l5.11">   let hideNews = true;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  for (let account of fixIterator(</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-    MailServices.accounts.accounts,</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  )) {</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  for (let account of MailServices.accounts.accounts) {</span>
<a href="#l5.17"></a><span id="l5.17">     if (account.incomingServer.type == &quot;nntp&quot;) {</span>
<a href="#l5.18"></a><span id="l5.18">       hideNews = false;</span>
<a href="#l5.19"></a><span id="l5.19">     }</span>
<a href="#l5.20"></a><span id="l5.20">   }</span>
<a href="#l5.21"></a><span id="l5.21">   // If there is no News (NNTP) account existing then</span>
<a href="#l5.22"></a><span id="l5.22">   // hide the Newsgroup and Followup-To recipient type in all the menulists.</span>
<a href="#l5.23"></a><span id="l5.23">   for (let item of document.querySelectorAll(&quot;.news-label&quot;)) {</span>
<a href="#l5.24"></a><span id="l5.24">     item.collapsed = hideNews;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-accounts.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-accounts.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -44,20 +44,17 @@ function convertAccount(account) {</span>
<a href="#l6.4"></a><span id="l6.4"> }</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> this.accounts = class extends ExtensionAPI {</span>
<a href="#l6.7"></a><span id="l6.7">   getAPI(context) {</span>
<a href="#l6.8"></a><span id="l6.8">     return {</span>
<a href="#l6.9"></a><span id="l6.9">       accounts: {</span>
<a href="#l6.10"></a><span id="l6.10">         async list() {</span>
<a href="#l6.11"></a><span id="l6.11">           let accounts = [];</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-          for (let account of fixIterator(</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-            MailServices.accounts.accounts,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-            Ci.nsIMsgAccount</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-          )) {</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+          for (let account of MailServices.accounts.accounts) {</span>
<a href="#l6.17"></a><span id="l6.17">             account = convertAccount(account);</span>
<a href="#l6.18"></a><span id="l6.18">             if (account) {</span>
<a href="#l6.19"></a><span id="l6.19">               accounts.push(account);</span>
<a href="#l6.20"></a><span id="l6.20">             }</span>
<a href="#l6.21"></a><span id="l6.21">           }</span>
<a href="#l6.22"></a><span id="l6.22">           return accounts;</span>
<a href="#l6.23"></a><span id="l6.23">         },</span>
<a href="#l6.24"></a><span id="l6.24">         async get(accountId) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/extensions/test/browser/head.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/extensions/test/browser/head.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -28,21 +28,21 @@ registerCleanupFunction(() =&gt; {</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">   while (tabmail.tabInfo.length &gt; 1) {</span>
<a href="#l7.6"></a><span id="l7.6">     tabmail.closeTab(tabmail.tabInfo[1]);</span>
<a href="#l7.7"></a><span id="l7.7">   }</span>
<a href="#l7.8"></a><span id="l7.8"> });</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> function createAccount() {</span>
<a href="#l7.11"></a><span id="l7.11">   registerCleanupFunction(() =&gt; {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    [...MailServices.accounts.accounts.enumerate()].forEach(cleanUpAccount);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    MailServices.accounts.accounts.forEach(cleanUpAccount);</span>
<a href="#l7.14"></a><span id="l7.14">   });</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">   MailServices.accounts.createLocalMailAccount();</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  let account = MailServices.accounts.accounts.enumerate().getNext();</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+  let account = MailServices.accounts.accounts[0];</span>
<a href="#l7.19"></a><span id="l7.19">   info(`Created account ${account.toString()}`);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   return account;</span>
<a href="#l7.22"></a><span id="l7.22"> }</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24"> function cleanUpAccount(account) {</span>
<a href="#l7.25"></a><span id="l7.25">   info(`Cleaning up account ${account.toString()}`);</span>
<a href="#l7.26"></a><span id="l7.26">   MailServices.accounts.removeAccount(account, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/extensions/test/xpcshell/head.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/extensions/test/xpcshell/head.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -28,33 +28,30 @@ Services.prefs.deleteBranch(&quot;ldap_2.serv</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> var createHttpServer = (...args) =&gt; {</span>
<a href="#l8.6"></a><span id="l8.6">   AddonTestUtils.maybeInit(this);</span>
<a href="#l8.7"></a><span id="l8.7">   return AddonTestUtils.createHttpServer(...args);</span>
<a href="#l8.8"></a><span id="l8.8"> };</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> function createAccount() {</span>
<a href="#l8.11"></a><span id="l8.11">   MailServices.accounts.createLocalMailAccount();</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  let account = MailServices.accounts.accounts</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    .enumerate()</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-    .getNext()</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-    .QueryInterface(Ci.nsIMsgAccount);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+  let account = MailServices.accounts.accounts[0];</span>
<a href="#l8.17"></a><span id="l8.17">   account.incomingServer = MailServices.accounts.localFoldersServer;</span>
<a href="#l8.18"></a><span id="l8.18">   info(`Created account ${account.toString()}`);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   return account;</span>
<a href="#l8.21"></a><span id="l8.21"> }</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23"> function cleanUpAccount(account) {</span>
<a href="#l8.24"></a><span id="l8.24">   info(`Cleaning up account ${account.toString()}`);</span>
<a href="#l8.25"></a><span id="l8.25">   MailServices.accounts.removeAccount(account, true);</span>
<a href="#l8.26"></a><span id="l8.26"> }</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28"> registerCleanupFunction(() =&gt; {</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-  [...MailServices.accounts.accounts.enumerate()].forEach(cleanUpAccount);</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+  MailServices.accounts.accounts.forEach(cleanUpAccount);</span>
<a href="#l8.31"></a><span id="l8.31"> });</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33"> function addIdentity(account, email = &quot;xpcshell@localhost&quot;) {</span>
<a href="#l8.34"></a><span id="l8.34">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l8.35"></a><span id="l8.35">   identity.email = email;</span>
<a href="#l8.36"></a><span id="l8.36">   account.addIdentity(identity);</span>
<a href="#l8.37"></a><span id="l8.37">   if (!account.defaultIdentity) {</span>
<a href="#l8.38"></a><span id="l8.38">     account.defaultIdentity = identity;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -2,19 +2,16 @@</span>
<a href="#l9.4"></a><span id="l9.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.5"></a><span id="l9.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> /* globals MozElements */</span>
<a href="#l9.8"></a><span id="l9.8"> /* globals statusSelector */</span>
<a href="#l9.9"></a><span id="l9.9"> /* globals MsgAccountManager */</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-var { fixIterator } = ChromeUtils.import(</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-);</span>
<a href="#l9.15"></a><span id="l9.15"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l9.16"></a><span id="l9.16">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l9.17"></a><span id="l9.17"> );</span>
<a href="#l9.18"></a><span id="l9.18"> var { DownloadUtils } = ChromeUtils.import(</span>
<a href="#l9.19"></a><span id="l9.19">   &quot;resource://gre/modules/DownloadUtils.jsm&quot;</span>
<a href="#l9.20"></a><span id="l9.20"> );</span>
<a href="#l9.21"></a><span id="l9.21"> ChromeUtils.defineModuleGetter(</span>
<a href="#l9.22"></a><span id="l9.22">   this,</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineat">@@ -359,18 +356,17 @@ var gAccountManager = {</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   new() {</span>
<a href="#l9.26"></a><span id="l9.26">     this.openDialog(&quot;chrome://messenger/content/chat/imAccountWizard.xhtml&quot;);</span>
<a href="#l9.27"></a><span id="l9.27">   },</span>
<a href="#l9.28"></a><span id="l9.28">   edit() {</span>
<a href="#l9.29"></a><span id="l9.29">     // Find the nsIIncomingServer for the current imIAccount.</span>
<a href="#l9.30"></a><span id="l9.30">     let server = null;</span>
<a href="#l9.31"></a><span id="l9.31">     let imAccountId = this.accountList.selectedItem.account.numericId;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-    let mgr = MailServices.accounts;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-    for (let account of fixIterator(mgr.accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+    for (let account of MailServices.accounts.accounts) {</span>
<a href="#l9.35"></a><span id="l9.35">       let incomingServer = account.incomingServer;</span>
<a href="#l9.36"></a><span id="l9.36">       if (!incomingServer || incomingServer.type != &quot;im&quot;) {</span>
<a href="#l9.37"></a><span id="l9.37">         continue;</span>
<a href="#l9.38"></a><span id="l9.38">       }</span>
<a href="#l9.39"></a><span id="l9.39">       if (incomingServer.wrappedJSObject.imAccount.numericId == imAccountId) {</span>
<a href="#l9.40"></a><span id="l9.40">         server = incomingServer;</span>
<a href="#l9.41"></a><span id="l9.41">         break;</span>
<a href="#l9.42"></a><span id="l9.42">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/im/modules/chatHandler.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/im/modules/chatHandler.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,18 +1,15 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l10.6"></a><span id="l10.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> const EXPORTED_SYMBOLS = [&quot;allContacts&quot;, &quot;onlineContacts&quot;, &quot;ChatCore&quot;];</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> const { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-const { fixIterator } = ChromeUtils.import(</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-);</span>
<a href="#l10.14"></a><span id="l10.14"> const { MailServices } = ChromeUtils.import(</span>
<a href="#l10.15"></a><span id="l10.15">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> );</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> var allContacts = {};</span>
<a href="#l10.19"></a><span id="l10.19"> var onlineContacts = {};</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> var ChatCore = {</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -48,17 +45,17 @@ var ChatCore = {</span>
<a href="#l10.23"></a><span id="l10.23">           // not in nsMsgAccountManager. They have probably been lost if</span>
<a href="#l10.24"></a><span id="l10.24">           // the user has used an older version of Thunderbird on a</span>
<a href="#l10.25"></a><span id="l10.25">           // profile with IM accounts. See bug 736035.</span>
<a href="#l10.26"></a><span id="l10.26">           let accountsById = {};</span>
<a href="#l10.27"></a><span id="l10.27">           for (let account of Services.accounts.getAccounts()) {</span>
<a href="#l10.28"></a><span id="l10.28">             accountsById[account.numericId] = account;</span>
<a href="#l10.29"></a><span id="l10.29">           }</span>
<a href="#l10.30"></a><span id="l10.30">           let mgr = MailServices.accounts;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-          for (let account of fixIterator(mgr.accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+          for (let account of mgr.accounts) {</span>
<a href="#l10.33"></a><span id="l10.33">             let incomingServer = account.incomingServer;</span>
<a href="#l10.34"></a><span id="l10.34">             if (!incomingServer || incomingServer.type != &quot;im&quot;) {</span>
<a href="#l10.35"></a><span id="l10.35">               continue;</span>
<a href="#l10.36"></a><span id="l10.36">             }</span>
<a href="#l10.37"></a><span id="l10.37">             delete accountsById[</span>
<a href="#l10.38"></a><span id="l10.38">               incomingServer.wrappedJSObject.imAccount.numericId</span>
<a href="#l10.39"></a><span id="l10.39">             ];</span>
<a href="#l10.40"></a><span id="l10.40">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/im/modules/index_im.jsm</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/im/modules/index_im.jsm</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -10,19 +10,16 @@ const { Gloda } = ChromeUtils.import(</span>
<a href="#l11.4"></a><span id="l11.4">   &quot;resource:///modules/gloda/GlodaPublic.jsm&quot;</span>
<a href="#l11.5"></a><span id="l11.5"> );</span>
<a href="#l11.6"></a><span id="l11.6"> const { GlodaAccount } = ChromeUtils.import(</span>
<a href="#l11.7"></a><span id="l11.7">   &quot;resource:///modules/gloda/GlodaDataModel.jsm&quot;</span>
<a href="#l11.8"></a><span id="l11.8"> );</span>
<a href="#l11.9"></a><span id="l11.9"> const { GlodaIndexer, IndexingJob } = ChromeUtils.import(</span>
<a href="#l11.10"></a><span id="l11.10">   &quot;resource:///modules/gloda/GlodaIndexer.jsm&quot;</span>
<a href="#l11.11"></a><span id="l11.11"> );</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-const { fixIterator } = ChromeUtils.import(</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-);</span>
<a href="#l11.15"></a><span id="l11.15"> const { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l11.16"></a><span id="l11.16"> const { MailServices } = ChromeUtils.import(</span>
<a href="#l11.17"></a><span id="l11.17">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> );</span>
<a href="#l11.19"></a><span id="l11.19"> const { FileUtils } = ChromeUtils.import(</span>
<a href="#l11.20"></a><span id="l11.20">   &quot;resource://gre/modules/FileUtils.jsm&quot;</span>
<a href="#l11.21"></a><span id="l11.21"> );</span>
<a href="#l11.22"></a><span id="l11.22"> const { XPCOMUtils } = ChromeUtils.import(</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineat">@@ -98,18 +95,17 @@ GlodaIMConversation.prototype = {</span>
<a href="#l11.24"></a><span id="l11.24">     let [protocol, username] = this._path.split(&quot;/&quot;, 2);</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">     let cacheName = protocol + &quot;/&quot; + username;</span>
<a href="#l11.27"></a><span id="l11.27">     if (cacheName in gIMAccounts) {</span>
<a href="#l11.28"></a><span id="l11.28">       return gIMAccounts[cacheName];</span>
<a href="#l11.29"></a><span id="l11.29">     }</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31">     // Find the nsIIncomingServer for the current imIAccount.</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-    let mgr = MailServices.accounts;</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-    for (let account of fixIterator(mgr.accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+    for (let account of MailServices.accounts.accounts) {</span>
<a href="#l11.35"></a><span id="l11.35">       let incomingServer = account.incomingServer;</span>
<a href="#l11.36"></a><span id="l11.36">       if (!incomingServer || incomingServer.type != &quot;im&quot;) {</span>
<a href="#l11.37"></a><span id="l11.37">         continue;</span>
<a href="#l11.38"></a><span id="l11.38">       }</span>
<a href="#l11.39"></a><span id="l11.39">       let imAccount = incomingServer.wrappedJSObject.imAccount;</span>
<a href="#l11.40"></a><span id="l11.40">       if (</span>
<a href="#l11.41"></a><span id="l11.41">         imAccount.protocol.normalizedName == protocol &amp;&amp;</span>
<a href="#l11.42"></a><span id="l11.42">         imAccount.normalizedName == username</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/configure.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/configure.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -41,16 +41,19 @@ const { EnigmailStdlib } = ChromeUtils.i</span>
<a href="#l12.4"></a><span id="l12.4">   &quot;chrome://openpgp/content/modules/stdlib.jsm&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> );</span>
<a href="#l12.6"></a><span id="l12.6"> const { EnigmailLazy } = ChromeUtils.import(</span>
<a href="#l12.7"></a><span id="l12.7">   &quot;chrome://openpgp/content/modules/lazy.jsm&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> );</span>
<a href="#l12.9"></a><span id="l12.9"> const { EnigmailAutoSetup } = ChromeUtils.import(</span>
<a href="#l12.10"></a><span id="l12.10">   &quot;chrome://openpgp/content/modules/autoSetup.jsm&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> );</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+const { MailServices } = ChromeUtils.import(</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+);</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16"> /**</span>
<a href="#l12.17"></a><span id="l12.17">  * Upgrade sending prefs</span>
<a href="#l12.18"></a><span id="l12.18">  * (v1.6.x -&gt; v1.7 )</span>
<a href="#l12.19"></a><span id="l12.19">  */</span>
<a href="#l12.20"></a><span id="l12.20"> function upgradePrefsSending() {</span>
<a href="#l12.21"></a><span id="l12.21">   EnigmailLog.DEBUG(&quot;enigmailCommon.jsm: upgradePrefsSending()\n&quot;);</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23" class="difflineat">@@ -144,23 +147,19 @@ function replaceKeyIdWithFpr() {</span>
<a href="#l12.24"></a><span id="l12.24">   }</span>
<a href="#l12.25"></a><span id="l12.25"> }</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27"> /**</span>
<a href="#l12.28"></a><span id="l12.28">  * Change the default to PGP/MIME for all accounts, except nntp</span>
<a href="#l12.29"></a><span id="l12.29">  * (v1.8.x -&gt; v1.9)</span>
<a href="#l12.30"></a><span id="l12.30">  */</span>
<a href="#l12.31"></a><span id="l12.31"> function defaultPgpMime() {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-  let accountManager = Cc[</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-    &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  ].getService(Ci.nsIMsgAccountManager);</span>
<a href="#l12.35"></a><span id="l12.35">   let changedSomething = false;</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-  for (let acct = 0; acct &lt; accountManager.accounts.length; acct++) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-    let ac = accountManager.accounts.queryElementAt(acct, Ci.nsIMsgAccount);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l12.40"></a><span id="l12.40">     if (ac.incomingServer.type.search(/(pop3|imap|movemail)/) &gt;= 0) {</span>
<a href="#l12.41"></a><span id="l12.41">       for (let i = 0; i &lt; ac.identities.length; i++) {</span>
<a href="#l12.42"></a><span id="l12.42">         let id = ac.identities.queryElementAt(i, Ci.nsIMsgIdentity);</span>
<a href="#l12.43"></a><span id="l12.43">         if (</span>
<a href="#l12.44"></a><span id="l12.44">           id.getBoolAttribute(&quot;enablePgp&quot;) &amp;&amp;</span>
<a href="#l12.45"></a><span id="l12.45">           !id.getBoolAttribute(&quot;pgpMimeMode&quot;)</span>
<a href="#l12.46"></a><span id="l12.46">         ) {</span>
<a href="#l12.47"></a><span id="l12.47">           changedSomething = true;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineat">@@ -179,22 +178,17 @@ function defaultPgpMime() {</span>
<a href="#l12.49"></a><span id="l12.49"> }</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51"> /**</span>
<a href="#l12.52"></a><span id="l12.52">  * set the Autocrypt prefer-encrypt option to &quot;mutual&quot; for all existing</span>
<a href="#l12.53"></a><span id="l12.53">  * accounts</span>
<a href="#l12.54"></a><span id="l12.54">  */</span>
<a href="#l12.55"></a><span id="l12.55"> function setAutocryptForOldAccounts() {</span>
<a href="#l12.56"></a><span id="l12.56">   try {</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineminus">-    let accountManager = Cc[</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineminus">-      &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-    ].getService(Ci.nsIMsgAccountManager);</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineminus">-    for (let acct = 0; acct &lt; accountManager.accounts.length; acct++) {</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineminus">-      let ac = accountManager.accounts.queryElementAt(acct, Ci.nsIMsgAccount);</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+    for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l12.64"></a><span id="l12.64">       if (ac.incomingServer.type.search(/(pop3|imap|movemail)/) &gt;= 0) {</span>
<a href="#l12.65"></a><span id="l12.65">         ac.incomingServer.setIntValue(&quot;acPreferEncrypt&quot;, 1);</span>
<a href="#l12.66"></a><span id="l12.66">       }</span>
<a href="#l12.67"></a><span id="l12.67">     }</span>
<a href="#l12.68"></a><span id="l12.68">   } catch (ex) {}</span>
<a href="#l12.69"></a><span id="l12.69"> }</span>
<a href="#l12.70"></a><span id="l12.70"> </span>
<a href="#l12.71"></a><span id="l12.71"> function setDefaultKeyServer() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/funcs.jsm</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/funcs.jsm</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -17,16 +17,19 @@ const { EnigmailLog } = ChromeUtils.impo</span>
<a href="#l13.4"></a><span id="l13.4">   &quot;chrome://openpgp/content/modules/log.jsm&quot;</span>
<a href="#l13.5"></a><span id="l13.5"> );</span>
<a href="#l13.6"></a><span id="l13.6"> const { EnigmailPrefs } = ChromeUtils.import(</span>
<a href="#l13.7"></a><span id="l13.7">   &quot;chrome://openpgp/content/modules/prefs.jsm&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> );</span>
<a href="#l13.9"></a><span id="l13.9"> const { EnigmailData } = ChromeUtils.import(</span>
<a href="#l13.10"></a><span id="l13.10">   &quot;chrome://openpgp/content/modules/data.jsm&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> );</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+const { MailServices } = ChromeUtils.import(</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+);</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16"> var gTxtConverter = null;</span>
<a href="#l13.17"></a><span id="l13.17"> </span>
<a href="#l13.18"></a><span id="l13.18"> var EnigmailFuncs = {</span>
<a href="#l13.19"></a><span id="l13.19">   /**</span>
<a href="#l13.20"></a><span id="l13.20">    * get a list of plain email addresses without name or surrounding &lt;&gt;</span>
<a href="#l13.21"></a><span id="l13.21">    * @param mailAddrs |string| - address-list encdoded in Unicode as specified in RFC 2822, 3.4</span>
<a href="#l13.22"></a><span id="l13.22">    *                             separated by , or ;</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineat">@@ -409,48 +412,37 @@ var EnigmailFuncs = {</span>
<a href="#l13.24"></a><span id="l13.24">     }</span>
<a href="#l13.25"></a><span id="l13.25">     return 0;</span>
<a href="#l13.26"></a><span id="l13.26">   },</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   /**</span>
<a href="#l13.29"></a><span id="l13.29">    * Get the nsIMsgAccount associated with a given nsIMsgIdentity</span>
<a href="#l13.30"></a><span id="l13.30">    */</span>
<a href="#l13.31"></a><span id="l13.31">   getAccountForIdentity(identity) {</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-    let accountManager = Cc[</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-      &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-    ].getService(Ci.nsIMsgAccountManager);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-    for (let acct = 0; acct &lt; accountManager.accounts.length; acct++) {</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-      let ac = accountManager.accounts.queryElementAt(acct, Ci.nsIMsgAccount);</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+    for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l13.40"></a><span id="l13.40">       for (let i = 0; i &lt; ac.identities.length; i++) {</span>
<a href="#l13.41"></a><span id="l13.41">         let id = ac.identities.queryElementAt(i, Ci.nsIMsgIdentity);</span>
<a href="#l13.42"></a><span id="l13.42">         if (id.key === identity.key) {</span>
<a href="#l13.43"></a><span id="l13.43">           return ac;</span>
<a href="#l13.44"></a><span id="l13.44">         }</span>
<a href="#l13.45"></a><span id="l13.45">       }</span>
<a href="#l13.46"></a><span id="l13.46">     }</span>
<a href="#l13.47"></a><span id="l13.47">     return null;</span>
<a href="#l13.48"></a><span id="l13.48">   },</span>
<a href="#l13.49"></a><span id="l13.49"> </span>
<a href="#l13.50"></a><span id="l13.50">   /**</span>
<a href="#l13.51"></a><span id="l13.51">    * Get the default identity of the default account</span>
<a href="#l13.52"></a><span id="l13.52">    */</span>
<a href="#l13.53"></a><span id="l13.53">   getDefaultIdentity() {</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-    let accountManager = Cc[</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-      &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-    ].getService(Ci.nsIMsgAccountManager);</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-</span>
<a href="#l13.58"></a><span id="l13.58">     try {</span>
<a href="#l13.59"></a><span id="l13.59">       let ac;</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-      if (accountManager.defaultAccount) {</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-        ac = accountManager.defaultAccount;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+      if (MailServices.accounts.defaultAccount) {</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+        ac = MailServices.accounts.defaultAccount;</span>
<a href="#l13.64"></a><span id="l13.64">       } else {</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineminus">-        for (let i = 0; i &lt; accountManager.accounts.length; i++) {</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-          ac = accountManager.accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+        for (ac of MailServices.accounts.accounts) {</span>
<a href="#l13.68"></a><span id="l13.68">           if (</span>
<a href="#l13.69"></a><span id="l13.69">             ac.incomingServer.type === &quot;imap&quot; ||</span>
<a href="#l13.70"></a><span id="l13.70">             ac.incomingServer.type === &quot;pop3&quot;</span>
<a href="#l13.71"></a><span id="l13.71">           ) {</span>
<a href="#l13.72"></a><span id="l13.72">             break;</span>
<a href="#l13.73"></a><span id="l13.73">           }</span>
<a href="#l13.74"></a><span id="l13.74">         }</span>
<a href="#l13.75"></a><span id="l13.75">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/keyUsability.jsm</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/keyUsability.jsm</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -21,16 +21,19 @@ const { EnigmailCore } = ChromeUtils.imp</span>
<a href="#l14.4"></a><span id="l14.4">   &quot;chrome://openpgp/content/modules/core.jsm&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> );</span>
<a href="#l14.6"></a><span id="l14.6"> const { EnigmailConstants } = ChromeUtils.import(</span>
<a href="#l14.7"></a><span id="l14.7">   &quot;chrome://openpgp/content/modules/constants.jsm&quot;</span>
<a href="#l14.8"></a><span id="l14.8"> );</span>
<a href="#l14.9"></a><span id="l14.9"> const { EnigmailLazy } = ChromeUtils.import(</span>
<a href="#l14.10"></a><span id="l14.10">   &quot;chrome://openpgp/content/modules/lazy.jsm&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> );</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+const { MailServices } = ChromeUtils.import(</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> const getDialog = EnigmailLazy.loader(&quot;enigmail/dialog.jsm&quot;, &quot;EnigmailDialog&quot;);</span>
<a href="#l14.17"></a><span id="l14.17"> const getWindows = EnigmailLazy.loader(</span>
<a href="#l14.18"></a><span id="l14.18">   &quot;enigmail/windows.jsm&quot;,</span>
<a href="#l14.19"></a><span id="l14.19">   &quot;EnigmailWindows&quot;</span>
<a href="#l14.20"></a><span id="l14.20"> );</span>
<a href="#l14.21"></a><span id="l14.21"> const getKeyRing = EnigmailLazy.loader(</span>
<a href="#l14.22"></a><span id="l14.22">   &quot;enigmail/keyRing.jsm&quot;,</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineat">@@ -92,25 +95,20 @@ var EnigmailKeyUsability = {</span>
<a href="#l14.24"></a><span id="l14.24">   /**</span>
<a href="#l14.25"></a><span id="l14.25">    * Determine the configured key specifications for all identities</span>
<a href="#l14.26"></a><span id="l14.26">    * where Enigmail is enabled</span>
<a href="#l14.27"></a><span id="l14.27">    *</span>
<a href="#l14.28"></a><span id="l14.28">    * @return  Array of Strings - list of keyId and email addresses</span>
<a href="#l14.29"></a><span id="l14.29">    */</span>
<a href="#l14.30"></a><span id="l14.30">   getKeysSpecForIdentities() {</span>
<a href="#l14.31"></a><span id="l14.31">     EnigmailLog.DEBUG(&quot;keyUsability.jsm: getKeysSpecForIdentities()\n&quot;);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-    let accountManager = Cc[</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-      &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-    ].getService(Ci.nsIMsgAccountManager);</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">     let keySpecList = [];</span>
<a href="#l14.37"></a><span id="l14.37"> </span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-    for (let acct = 0; acct &lt; accountManager.accounts.length; acct++) {</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-      let ac = accountManager.accounts.queryElementAt(acct, Ci.nsIMsgAccount);</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+    for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l14.42"></a><span id="l14.42">       for (let i = 0; i &lt; ac.identities.length; i++) {</span>
<a href="#l14.43"></a><span id="l14.43">         let id = ac.identities.queryElementAt(i, Ci.nsIMsgIdentity);</span>
<a href="#l14.44"></a><span id="l14.44">         if (id.getBoolAttribute(&quot;enablePgp&quot;)) {</span>
<a href="#l14.45"></a><span id="l14.45">           if (id.getIntAttribute(&quot;pgpKeyMode&quot;) === 1) {</span>
<a href="#l14.46"></a><span id="l14.46">             keySpecList.push(id.getCharAttribute(&quot;pgpkeyId&quot;));</span>
<a href="#l14.47"></a><span id="l14.47">           } else {</span>
<a href="#l14.48"></a><span id="l14.48">             keySpecList.push(id.email);</span>
<a href="#l14.49"></a><span id="l14.49">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/stdlib/misc.jsm</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/stdlib/misc.jsm</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -177,20 +177,17 @@ function getDefaultIdentity() {</span>
<a href="#l15.4"></a><span id="l15.4"> /**</span>
<a href="#l15.5"></a><span id="l15.5">  * Returns a list of all identities in the form [{ boolean isDefault; nsIMsgIdentity identity }].</span>
<a href="#l15.6"></a><span id="l15.6">  * It is assured that there is exactly one default identity.</span>
<a href="#l15.7"></a><span id="l15.7">  * If only the default identity is needed, getDefaultIdentity() can be used.</span>
<a href="#l15.8"></a><span id="l15.8">  * @param aSkipNntpIdentities (default: true) Should we avoid including nntp identities in the list?</span>
<a href="#l15.9"></a><span id="l15.9">  */</span>
<a href="#l15.10"></a><span id="l15.10"> function getIdentities(aSkipNntpIdentities = true) {</span>
<a href="#l15.11"></a><span id="l15.11">   let identities = [];</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  for (let account of fixIterator(</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    MailServices.accounts.accounts,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  )) {</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+  for (let account of MailServices.accounts.accounts) {</span>
<a href="#l15.17"></a><span id="l15.17">     let server = account.incomingServer;</span>
<a href="#l15.18"></a><span id="l15.18">     if (</span>
<a href="#l15.19"></a><span id="l15.19">       aSkipNntpIdentities &amp;&amp;</span>
<a href="#l15.20"></a><span id="l15.20">       (!server || (server.type != &quot;pop3&quot; &amp;&amp; server.type != &quot;imap&quot;))</span>
<a href="#l15.21"></a><span id="l15.21">     ) {</span>
<a href="#l15.22"></a><span id="l15.22">       continue;</span>
<a href="#l15.23"></a><span id="l15.23">     }</span>
<a href="#l15.24"></a><span id="l15.24">     for (let currentIdentity of fixIterator(</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineat">@@ -419,23 +416,17 @@ function combine(a1, a2) {</span>
<a href="#l15.26"></a><span id="l15.26">   return [...range(0, a1.length)].map(i =&gt; [a1[i], a2[i]]);</span>
<a href="#l15.27"></a><span id="l15.27"> }</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29"> /**</span>
<a href="#l15.30"></a><span id="l15.30">  * Determine if at least one account / identity is configured</span>
<a href="#l15.31"></a><span id="l15.31">  * @return {Bool}</span>
<a href="#l15.32"></a><span id="l15.32">  */</span>
<a href="#l15.33"></a><span id="l15.33"> function hasConfiguredAccounts() {</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-  let accountManager = Cc[</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-    &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-  ].getService(Ci.nsIMsgAccountManager);</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-  for (let acct = 0; acct &lt; accountManager.accounts.length; acct++) {</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-    let ac = accountManager.accounts.queryElementAt(acct, Ci.nsIMsgAccount);</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+  for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l15.42"></a><span id="l15.42">     if (ac.incomingServer.type !== &quot;none&quot;) {</span>
<a href="#l15.43"></a><span id="l15.43">       if (ac.defaultIdentity.email.length &gt; 0) {</span>
<a href="#l15.44"></a><span id="l15.44">         return true;</span>
<a href="#l15.45"></a><span id="l15.45">       }</span>
<a href="#l15.46"></a><span id="l15.46">     }</span>
<a href="#l15.47"></a><span id="l15.47">   }</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">   return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/test/browser/composition/browser_addressWidgets.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/test/browser/composition/browser_addressWidgets.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -113,20 +113,17 @@ function remove_NNTP_account() {</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> /**</span>
<a href="#l16.6"></a><span id="l16.6">  * Bug 399446 &amp; bug 922614</span>
<a href="#l16.7"></a><span id="l16.7">  * Test that the allowed address types depend on the account type</span>
<a href="#l16.8"></a><span id="l16.8">  * we are sending from.</span>
<a href="#l16.9"></a><span id="l16.9">  */</span>
<a href="#l16.10"></a><span id="l16.10"> add_task(function test_address_types() {</span>
<a href="#l16.11"></a><span id="l16.11">   // Be sure there is no NNTP account yet.</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  for (let account of fixIterator(</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-    MailServices.accounts.accounts,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  )) {</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+  for (let account of MailServices.accounts.accounts) {</span>
<a href="#l16.17"></a><span id="l16.17">     Assert.notEqual(</span>
<a href="#l16.18"></a><span id="l16.18">       account.incomingServer.type,</span>
<a href="#l16.19"></a><span id="l16.19">       &quot;nntp&quot;,</span>
<a href="#l16.20"></a><span id="l16.20">       &quot;There is a NNTP account existing unexpectedly&quot;</span>
<a href="#l16.21"></a><span id="l16.21">     );</span>
<a href="#l16.22"></a><span id="l16.22">   }</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24">   // Open compose window on the existing POP3 account.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/test/browser/folder-pane/browser_folderNamesInRecentMode.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -30,30 +30,27 @@ add_task(function setupModule(module) {</span>
<a href="#l17.4"></a><span id="l17.4">   assert_folder_mode(&quot;all&quot;);</span>
<a href="#l17.5"></a><span id="l17.5">   assert_folder_tree_view_row_count(7);</span>
<a href="#l17.6"></a><span id="l17.6"> });</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> add_task(function test_folder_names_in_recent_view_mode() {</span>
<a href="#l17.9"></a><span id="l17.9">   // We need 2 local accounts that have pristine folders with</span>
<a href="#l17.10"></a><span id="l17.10">   // unmodified times, so that it does not influence the</span>
<a href="#l17.11"></a><span id="l17.11">   // list of Recent folders. So clear out the most-recently-used time.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  for (let acc of fixIterator(</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    MailServices.accounts.accounts,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-  )) {</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+  for (let acc of MailServices.accounts.accounts) {</span>
<a href="#l17.17"></a><span id="l17.17">     for (let fld of fixIterator(</span>
<a href="#l17.18"></a><span id="l17.18">       acc.incomingServer.rootFolder.subFolders,</span>
<a href="#l17.19"></a><span id="l17.19">       Ci.nsIMsgFolder</span>
<a href="#l17.20"></a><span id="l17.20">     )) {</span>
<a href="#l17.21"></a><span id="l17.21">       fld.setStringProperty(&quot;MRUTime&quot;, &quot;0&quot;);</span>
<a href="#l17.22"></a><span id="l17.22">     }</span>
<a href="#l17.23"></a><span id="l17.23">   }</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-  let acc1 = MailServices.accounts.accounts.queryElementAt(1, Ci.nsIMsgAccount);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-  let acc2 = MailServices.accounts.accounts.queryElementAt(0, Ci.nsIMsgAccount);</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+  let acc1 = MailServices.accounts.accounts[1];</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+  let acc2 = MailServices.accounts.accounts[0];</span>
<a href="#l17.29"></a><span id="l17.29">   let rootFolder1 = acc1.incomingServer.rootFolder;</span>
<a href="#l17.30"></a><span id="l17.30">   let rootFolder2 = acc2.incomingServer.rootFolder;</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32">   // Create some test folders.</span>
<a href="#l17.33"></a><span id="l17.33">   rootFolder1.createSubfolder(&quot;uniqueName&quot;, null);</span>
<a href="#l17.34"></a><span id="l17.34">   rootFolder1.createSubfolder(&quot;duplicatedName&quot;, null);</span>
<a href="#l17.35"></a><span id="l17.35">   rootFolder2.createSubfolder(&quot;duplicatedName&quot;, null);</span>
<a href="#l17.36"></a><span id="l17.36">   let inbox2 = rootFolder2.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/test/browser/multiple-identities/browser_displayNames.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/test/browser/multiple-identities/browser_displayNames.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -40,21 +40,17 @@ var collectedAddresses;</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> add_task(function setupModule(module) {</span>
<a href="#l18.6"></a><span id="l18.6">   localAccount = MailServices.accounts.FindAccountForServer(</span>
<a href="#l18.7"></a><span id="l18.7">     MailServices.accounts.localFoldersServer</span>
<a href="#l18.8"></a><span id="l18.8">   );</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">   // We need to make sure we have only one identity:</span>
<a href="#l18.11"></a><span id="l18.11">   // 1) Delete all accounts except for Local Folders</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  for (let i = MailServices.accounts.accounts.length - 1; i &gt;= 0; i--) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-    let account = MailServices.accounts.accounts.queryElementAt(</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-      i,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-      Ci.nsIMsgAccount</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-    );</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  for (let account of MailServices.accounts.accounts) {</span>
<a href="#l18.18"></a><span id="l18.18">     if (account != localAccount) {</span>
<a href="#l18.19"></a><span id="l18.19">       MailServices.accounts.removeAccount(account);</span>
<a href="#l18.20"></a><span id="l18.20">     }</span>
<a href="#l18.21"></a><span id="l18.21">   }</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">   // 2) Delete all identities except for one</span>
<a href="#l18.24"></a><span id="l18.24">   for (let i = localAccount.identities.length - 1; i &gt;= 0; i--) {</span>
<a href="#l18.25"></a><span id="l18.25">     let identity = localAccount.identities.queryElementAt(i, Ci.nsIMsgIdentity);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/NewMailAccountHelpers.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -27,19 +27,16 @@ var fdh = ChromeUtils.import(</span>
<a href="#l19.4"></a><span id="l19.4">   &quot;resource://testing-common/mozmill/FolderDisplayHelpers.jsm&quot;</span>
<a href="#l19.5"></a><span id="l19.5"> );</span>
<a href="#l19.6"></a><span id="l19.6"> var { input_value } = ChromeUtils.import(</span>
<a href="#l19.7"></a><span id="l19.7">   &quot;resource://testing-common/mozmill/KeyboardHelpers.jsm&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> );</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10"> var { Assert } = ChromeUtils.import(&quot;resource://testing-common/Assert.jsm&quot;);</span>
<a href="#l19.11"></a><span id="l19.11"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-var { fixIterator } = ChromeUtils.import(</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-);</span>
<a href="#l19.15"></a><span id="l19.15"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l19.16"></a><span id="l19.16">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l19.17"></a><span id="l19.17"> );</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19"> var mc = fdh.mc;</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21"> /* Wait until the list of providers is loaded and displayed.</span>
<a href="#l19.22"></a><span id="l19.22">  */</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineat">@@ -140,20 +137,17 @@ function wait_to_be_offline(w) {</span>
<a href="#l19.24"></a><span id="l19.24"> }</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26"> /**</span>
<a href="#l19.27"></a><span id="l19.27">  * Remove an account with address aAddress from the current profile.</span>
<a href="#l19.28"></a><span id="l19.28">  *</span>
<a href="#l19.29"></a><span id="l19.29">  * @param aAddress the email address to try to remove.</span>
<a href="#l19.30"></a><span id="l19.30">  */</span>
<a href="#l19.31"></a><span id="l19.31"> function remove_email_account(aAddress) {</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-  for (let account of fixIterator(</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-    MailServices.accounts.accounts,</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-  )) {</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+  for (let account of MailServices.accounts.accounts) {</span>
<a href="#l19.37"></a><span id="l19.37">     if (account.defaultIdentity &amp;&amp; account.defaultIdentity.email == aAddress) {</span>
<a href="#l19.38"></a><span id="l19.38">       MailServices.accounts.removeAccount(account);</span>
<a href="#l19.39"></a><span id="l19.39">       break;</span>
<a href="#l19.40"></a><span id="l19.40">     }</span>
<a href="#l19.41"></a><span id="l19.41">   }</span>
<a href="#l19.42"></a><span id="l19.42"> }</span>
<a href="#l19.43"></a><span id="l19.43"> </span>
<a href="#l19.44"></a><span id="l19.44"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/prefs/content/accountUtils.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/prefs/content/accountUtils.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -16,21 +16,19 @@ var { MailServices } = ChromeUtils.impor</span>
<a href="#l20.4"></a><span id="l20.4"> );</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6"> var gAnyValidIdentity = false; // If there are no valid identities for any account</span>
<a href="#l20.7"></a><span id="l20.7"> // returns the first account with an invalid server or identity</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> var gNewAccountToLoad = null; // used to load new messages if we come from the mail3pane</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> function getInvalidAccounts(accounts) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  let numAccounts = accounts.length;</span>
<a href="#l20.13"></a><span id="l20.13">   let invalidAccounts = [];</span>
<a href="#l20.14"></a><span id="l20.14">   let numIdentities = 0;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-  for (let i = 0; i &lt; numAccounts; i++) {</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-    let account = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+  for (let account of accounts) {</span>
<a href="#l20.18"></a><span id="l20.18">     try {</span>
<a href="#l20.19"></a><span id="l20.19">       if (!account.incomingServer.valid) {</span>
<a href="#l20.20"></a><span id="l20.20">         invalidAccounts[invalidAccounts.length] = account;</span>
<a href="#l20.21"></a><span id="l20.21">         // skip to the next account</span>
<a href="#l20.22"></a><span id="l20.22">         continue;</span>
<a href="#l20.23"></a><span id="l20.23">       }</span>
<a href="#l20.24"></a><span id="l20.24">     } catch (ex) {</span>
<a href="#l20.25"></a><span id="l20.25">       // this account is busted, just keep going</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -300,20 +300,17 @@ function onAdvanced() {</span>
<a href="#l21.4"></a><span id="l21.4">       // to that folder (moveOnSpam = true) then moving junk is disabled</span>
<a href="#l21.5"></a><span id="l21.5">       // (so that the user notices it and checks the settings).</span>
<a href="#l21.6"></a><span id="l21.6">       // This is the same sanitization as in am-junk.js, just applied to all POP accounts.</span>
<a href="#l21.7"></a><span id="l21.7">       let deferredURI =</span>
<a href="#l21.8"></a><span id="l21.8">         serverSettings.deferredToAccount &amp;&amp;</span>
<a href="#l21.9"></a><span id="l21.9">         MailServices.accounts.getAccount(serverSettings.deferredToAccount)</span>
<a href="#l21.10"></a><span id="l21.10">           .incomingServer.serverURI;</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      for (let account of fixIterator(</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-        MailServices.accounts.accounts,</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-        Ci.nsIMsgAccount</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-      )) {</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+      for (let account of MailServices.accounts.accounts) {</span>
<a href="#l21.17"></a><span id="l21.17">         let accountValues = parent.getValueArrayFor(account);</span>
<a href="#l21.18"></a><span id="l21.18">         let type = parent.getAccountValue(</span>
<a href="#l21.19"></a><span id="l21.19">           account,</span>
<a href="#l21.20"></a><span id="l21.20">           accountValues,</span>
<a href="#l21.21"></a><span id="l21.21">           &quot;server&quot;,</span>
<a href="#l21.22"></a><span id="l21.22">           &quot;type&quot;,</span>
<a href="#l21.23"></a><span id="l21.23">           null,</span>
<a href="#l21.24"></a><span id="l21.24">           false</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/prefs/content/amUtils.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/prefs/content/amUtils.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -229,20 +229,17 @@ function openPrefsFromAccountManager(</span>
<a href="#l22.4"></a><span id="l22.4"> /**</span>
<a href="#l22.5"></a><span id="l22.5">  * Check if the given account name already exists in any account.</span>
<a href="#l22.6"></a><span id="l22.6">  *</span>
<a href="#l22.7"></a><span id="l22.7">  * @param aAccountName  The account name string to look for.</span>
<a href="#l22.8"></a><span id="l22.8">  * @param aAccountKey   Optional. The key of an account that is skipped when</span>
<a href="#l22.9"></a><span id="l22.9">  *                      searching the name. If unset, do not skip any account.</span>
<a href="#l22.10"></a><span id="l22.10">  */</span>
<a href="#l22.11"></a><span id="l22.11"> function accountNameExists(aAccountName, aAccountKey) {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  for (let account of fixIterator(</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    MailServices.accounts.accounts,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-  )) {</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+  for (let account of MailServices.accounts.accounts) {</span>
<a href="#l22.17"></a><span id="l22.17">     if (</span>
<a href="#l22.18"></a><span id="l22.18">       account.key != aAccountKey &amp;&amp;</span>
<a href="#l22.19"></a><span id="l22.19">       account.incomingServer &amp;&amp;</span>
<a href="#l22.20"></a><span id="l22.20">       aAccountName == account.incomingServer.prettyName</span>
<a href="#l22.21"></a><span id="l22.21">     ) {</span>
<a href="#l22.22"></a><span id="l22.22">       return true;</span>
<a href="#l22.23"></a><span id="l22.23">     }</span>
<a href="#l22.24"></a><span id="l22.24">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgAccountManager.idl</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgAccountManager.idl</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -80,17 +80,17 @@ interface nsIMsgAccountManager : nsISupp</span>
<a href="#l23.4"></a><span id="l23.4">    */</span>
<a href="#l23.5"></a><span id="l23.5">   attribute nsIMsgAccount defaultAccount;</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">   /**</span>
<a href="#l23.8"></a><span id="l23.8">    * Ordered list of all accounts, by the order they are in the prefs.</span>
<a href="#l23.9"></a><span id="l23.9">    * Accounts with hidden servers are not returned.</span>
<a href="#l23.10"></a><span id="l23.10">    * array of nsIMsgAccount</span>
<a href="#l23.11"></a><span id="l23.11">    */</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  readonly attribute nsIArray accounts;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  readonly attribute Array&lt;nsIMsgAccount&gt; accounts;</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15">   /* list of all identities in all accounts</span>
<a href="#l23.16"></a><span id="l23.16">    * array of nsIMsgIdentity</span>
<a href="#l23.17"></a><span id="l23.17">    */</span>
<a href="#l23.18"></a><span id="l23.18">   readonly attribute nsIArray allIdentities;</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20">   /* list of all servers in all accounts, except for hidden and IM servers</span>
<a href="#l23.21"></a><span id="l23.21">    * array of nsIMsgIncomingServer</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -824,37 +824,33 @@ NS_IMETHODIMP nsMsgAccountManager::GetFo</span>
<a href="#l24.4"></a><span id="l24.4">     m_msgFolderCache-&gt;Init(cacheFile);</span>
<a href="#l24.5"></a><span id="l24.5">   }</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7">   NS_IF_ADDREF(*aFolderCache = m_msgFolderCache);</span>
<a href="#l24.8"></a><span id="l24.8">   return rv;</span>
<a href="#l24.9"></a><span id="l24.9"> }</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> NS_IMETHODIMP</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-nsMsgAccountManager::GetAccounts(nsIArray **_retval) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+nsMsgAccountManager::GetAccounts(nsTArray&lt;RefPtr&lt;nsIMsgAccount&gt;&gt; &amp;accounts) {</span>
<a href="#l24.14"></a><span id="l24.14">   nsresult rv = LoadAccounts();</span>
<a href="#l24.15"></a><span id="l24.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-  nsCOMPtr&lt;nsIMutableArray&gt; accounts(</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-      do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">-</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">-  for (uint32_t index = 0; index &lt; m_accounts.Length(); index++) {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-    nsCOMPtr&lt;nsIMsgAccount&gt; existingAccount(m_accounts[index]);</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+  accounts.Clear();</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+  accounts.SetCapacity(m_accounts.Length());</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+  for (auto existingAccount : m_accounts) {</span>
<a href="#l24.26"></a><span id="l24.26">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l24.27"></a><span id="l24.27">     existingAccount-&gt;GetIncomingServer(getter_AddRefs(server));</span>
<a href="#l24.28"></a><span id="l24.28">     if (!server) continue;</span>
<a href="#l24.29"></a><span id="l24.29">     if (server) {</span>
<a href="#l24.30"></a><span id="l24.30">       bool hidden = false;</span>
<a href="#l24.31"></a><span id="l24.31">       server-&gt;GetHidden(&amp;hidden);</span>
<a href="#l24.32"></a><span id="l24.32">       if (hidden) continue;</span>
<a href="#l24.33"></a><span id="l24.33">     }</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-    accounts-&gt;AppendElement(existingAccount);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+    accounts.AppendElement(existingAccount);</span>
<a href="#l24.36"></a><span id="l24.36">   }</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  accounts.forget(_retval);</span>
<a href="#l24.38"></a><span id="l24.38">   return NS_OK;</span>
<a href="#l24.39"></a><span id="l24.39"> }</span>
<a href="#l24.40"></a><span id="l24.40"> </span>
<a href="#l24.41"></a><span id="l24.41"> NS_IMETHODIMP</span>
<a href="#l24.42"></a><span id="l24.42"> nsMsgAccountManager::GetAllIdentities(nsIArray **_retval) {</span>
<a href="#l24.43"></a><span id="l24.43">   nsresult rv = LoadAccounts();</span>
<a href="#l24.44"></a><span id="l24.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.45"></a><span id="l24.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -350,25 +350,24 @@ NS_IMETHODIMP nsSpamSettings::Initialize</span>
<a href="#l25.4"></a><span id="l25.4">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">     nsAutoCString accountKey;</span>
<a href="#l25.7"></a><span id="l25.7">     if (account) account-&gt;GetKey(accountKey);</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">     // Loop through all accounts, adding emails from this account, as well as</span>
<a href="#l25.10"></a><span id="l25.10">     // from any accounts that defer to this account.</span>
<a href="#l25.11"></a><span id="l25.11">     mEmails.Clear();</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    nsCOMPtr&lt;nsIArray&gt; accounts;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-    rv = accountManager-&gt;GetAccounts(getter_AddRefs(accounts));</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-    uint32_t accountCount = 0;</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+    nsTArray&lt;RefPtr&lt;nsIMsgAccount&gt;&gt; accounts;</span>
<a href="#l25.17"></a><span id="l25.17">     // No sense scanning accounts if we've nothing to match.</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-    if (account &amp;&amp; accounts) accounts-&gt;GetLength(&amp;accountCount);</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+    if (account) {</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineplus">+      rv = accountManager-&gt;GetAccounts(accounts);</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineplus">+      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineplus">+    }</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-    for (uint32_t i = 0; i &lt; accountCount; i++) {</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">-      nsCOMPtr&lt;nsIMsgAccount&gt; loopAccount(do_QueryElementAt(accounts, i));</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+    for (auto loopAccount : accounts) {</span>
<a href="#l25.27"></a><span id="l25.27">       if (!loopAccount) continue;</span>
<a href="#l25.28"></a><span id="l25.28">       nsAutoCString loopAccountKey;</span>
<a href="#l25.29"></a><span id="l25.29">       loopAccount-&gt;GetKey(loopAccountKey);</span>
<a href="#l25.30"></a><span id="l25.30">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; loopServer;</span>
<a href="#l25.31"></a><span id="l25.31">       loopAccount-&gt;GetIncomingServer(getter_AddRefs(loopServer));</span>
<a href="#l25.32"></a><span id="l25.32">       nsAutoCString deferredToAccountKey;</span>
<a href="#l25.33"></a><span id="l25.33">       if (loopServer)</span>
<a href="#l25.34"></a><span id="l25.34">         loopServer-&gt;GetCharValue(&quot;deferred_to_account&quot;, deferredToAccountKey);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgFolder.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgFolder.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -7,20 +7,17 @@ var { MailServices } = ChromeUtils.impor</span>
<a href="#l26.4"></a><span id="l26.4">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> );</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7"> function run_test() {</span>
<a href="#l26.8"></a><span id="l26.8">   // Create a local mail account (we need this first)</span>
<a href="#l26.9"></a><span id="l26.9">   MailServices.accounts.createLocalMailAccount();</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11">   // Get the account</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  let account = MailServices.accounts.accounts.queryElementAt(</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-    0,</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-    Ci.nsIMsgAccount</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-  );</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+  let account = MailServices.accounts.accounts[0];</span>
<a href="#l26.17"></a><span id="l26.17"> </span>
<a href="#l26.18"></a><span id="l26.18">   // Get the root folder</span>
<a href="#l26.19"></a><span id="l26.19">   var root = account.incomingServer.rootFolder;</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21">   // Add a sub folder to ensure that we have some folders created</span>
<a href="#l26.22"></a><span id="l26.22">   root.createSubfolder(&quot;folder1&quot;, null);</span>
<a href="#l26.23"></a><span id="l26.23"> </span>
<a href="#l26.24"></a><span id="l26.24">   // Test - getChildNamed</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/util/folderUtils.jsm</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/util/folderUtils.jsm</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -12,19 +12,16 @@ this.EXPORTED_SYMBOLS = [</span>
<a href="#l27.4"></a><span id="l27.4">   &quot;allAccountsSorted&quot;,</span>
<a href="#l27.5"></a><span id="l27.5">   &quot;getMostRecentFolders&quot;,</span>
<a href="#l27.6"></a><span id="l27.6">   &quot;folderNameCompare&quot;,</span>
<a href="#l27.7"></a><span id="l27.7"> ];</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9"> const { MailServices } = ChromeUtils.import(</span>
<a href="#l27.10"></a><span id="l27.10">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l27.11"></a><span id="l27.11"> );</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-const { fixIterator, toArray } = ChromeUtils.import(</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-);</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> /**</span>
<a href="#l27.17"></a><span id="l27.17">  * Returns a string representation of a folder's &quot;special&quot; type.</span>
<a href="#l27.18"></a><span id="l27.18">  *</span>
<a href="#l27.19"></a><span id="l27.19">  * @param aFolder  the nsIMsgFolder whose special type should be returned</span>
<a href="#l27.20"></a><span id="l27.20">  */</span>
<a href="#l27.21"></a><span id="l27.21"> function getSpecialFolderString(aFolder) {</span>
<a href="#l27.22"></a><span id="l27.22">   let flags = aFolder.flags;</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineat">@@ -154,25 +151,22 @@ function compareAccounts(aAccount1, aAcc</span>
<a href="#l27.24"></a><span id="l27.24"> }</span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26"> /**</span>
<a href="#l27.27"></a><span id="l27.27">  * Returns a list of accounts sorted by server type.</span>
<a href="#l27.28"></a><span id="l27.28">  *</span>
<a href="#l27.29"></a><span id="l27.29">  * @param aExcludeIMAccounts  Remove IM accounts from the list?</span>
<a href="#l27.30"></a><span id="l27.30">  */</span>
<a href="#l27.31"></a><span id="l27.31"> function allAccountsSorted(aExcludeIMAccounts) {</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">-  // Get the account list, and add the proper items.</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">-  let accountList = toArray(</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-    fixIterator(MailServices.accounts.accounts, Ci.nsIMsgAccount)</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-  );</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-</span>
<a href="#l27.37"></a><span id="l27.37">   // This is a HACK to work around bug 41133. If we have one of the</span>
<a href="#l27.38"></a><span id="l27.38">   // dummy &quot;news&quot; accounts there, that account won't have an</span>
<a href="#l27.39"></a><span id="l27.39">   // incomingServer attached to it, and everything will blow up.</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">-  accountList = accountList.filter(a =&gt; a.incomingServer);</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineplus">+  let accountList = MailServices.accounts.accounts.filter(</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineplus">+    a =&gt; a.incomingServer</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineplus">+  );</span>
<a href="#l27.44"></a><span id="l27.44"> </span>
<a href="#l27.45"></a><span id="l27.45">   // Remove IM servers.</span>
<a href="#l27.46"></a><span id="l27.46">   if (aExcludeIMAccounts) {</span>
<a href="#l27.47"></a><span id="l27.47">     accountList = accountList.filter(a =&gt; a.incomingServer.type != &quot;im&quot;);</span>
<a href="#l27.48"></a><span id="l27.48">   }</span>
<a href="#l27.49"></a><span id="l27.49"> </span>
<a href="#l27.50"></a><span id="l27.50">   return accountList.sort(compareAccounts);</span>
<a href="#l27.51"></a><span id="l27.51"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -610,23 +610,22 @@ nsMsgSendLater::HasUnsentMessages(nsIMsg</span>
<a href="#l28.4"></a><span id="l28.4">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l28.5"></a><span id="l28.5">   *aResult = false;</span>
<a href="#l28.6"></a><span id="l28.6">   nsresult rv;</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l28.9"></a><span id="l28.9">       do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l28.10"></a><span id="l28.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  nsCOMPtr&lt;nsIArray&gt; accounts;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-  accountManager-&gt;GetAccounts(getter_AddRefs(accounts));</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+  nsTArray&lt;RefPtr&lt;nsIMsgAccount&gt;&gt; accounts;</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+  rv = accountManager-&gt;GetAccounts(accounts);</span>
<a href="#l28.16"></a><span id="l28.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-  uint32_t cnt = 0;</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">-  rv = accounts-&gt;GetLength(&amp;cnt);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">-  if (cnt == 0) return NS_OK;  // no account set up -&gt; no unsent messages</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+  if (accounts.IsEmpty())</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+    return NS_OK;  // no account set up -&gt; no unsent messages</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24">   // XXX This code should be set up for multiple unsent folders, however we</span>
<a href="#l28.25"></a><span id="l28.25">   // don't support that at the moment, so for now just assume one folder.</span>
<a href="#l28.26"></a><span id="l28.26">   if (!mMessageFolder) {</span>
<a href="#l28.27"></a><span id="l28.27">     nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l28.28"></a><span id="l28.28">     rv = GetUnsentMessagesFolder(nullptr, getter_AddRefs(folder));</span>
<a href="#l28.29"></a><span id="l28.29">     // There doesn't have to be a nsMsgQueueForLater flagged folder.</span>
<a href="#l28.30"></a><span id="l28.30">     if (NS_FAILED(rv) || !folder) return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/db/gloda/modules/IndexMsg.jsm</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/IndexMsg.jsm</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -2009,20 +2009,17 @@ var GlodaMsgIndexer = {</span>
<a href="#l29.4"></a><span id="l29.4">    *  and have an accurate estimate of the number of folders that need to be</span>
<a href="#l29.5"></a><span id="l29.5">    *  indexed.  (We previously queued accounts rather than immediately</span>
<a href="#l29.6"></a><span id="l29.6">    *  walking their list of folders.)</span>
<a href="#l29.7"></a><span id="l29.7">    */</span>
<a href="#l29.8"></a><span id="l29.8">   indexEverything() {</span>
<a href="#l29.9"></a><span id="l29.9">     this._log.info(&quot;Queueing all accounts for indexing.&quot;);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11">     GlodaDatastore._beginTransaction();</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    for (let account of fixIterator(</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-      MailServices.accounts.accounts,</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-      Ci.nsIMsgAccount</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-    )) {</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+    for (let account of MailServices.accounts.accounts) {</span>
<a href="#l29.17"></a><span id="l29.17">       this.indexAccount(account);</span>
<a href="#l29.18"></a><span id="l29.18">     }</span>
<a href="#l29.19"></a><span id="l29.19">     GlodaDatastore._commitTransaction();</span>
<a href="#l29.20"></a><span id="l29.20">   },</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22">   /**</span>
<a href="#l29.23"></a><span id="l29.23">    * Queue all of the folders belonging to an account for indexing.</span>
<a href="#l29.24"></a><span id="l29.24">    */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncManager.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncManager.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -650,25 +650,21 @@ nsresult nsAutoSyncManager::AutoUpdateFo</span>
<a href="#l30.4"></a><span id="l30.4">   nsresult rv;</span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6">   // iterate through each imap account and update offline folders automatically</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l30.9"></a><span id="l30.9">       do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l30.10"></a><span id="l30.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  nsCOMPtr&lt;nsIArray&gt; accounts;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-  rv = accountManager-&gt;GetAccounts(getter_AddRefs(accounts));</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  nsTArray&lt;RefPtr&lt;nsIMsgAccount&gt;&gt; accounts;</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+  rv = accountManager-&gt;GetAccounts(accounts);</span>
<a href="#l30.16"></a><span id="l30.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-  uint32_t accountCount;</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineminus">-  accounts-&gt;GetLength(&amp;accountCount);</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineminus">-</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineminus">-  for (uint32_t i = 0; i &lt; accountCount; ++i) {</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineminus">-    nsCOMPtr&lt;nsIMsgAccount&gt; account(do_QueryElementAt(accounts, i, &amp;rv));</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+  for (auto account : accounts) {</span>
<a href="#l30.24"></a><span id="l30.24">     if (!account) continue;</span>
<a href="#l30.25"></a><span id="l30.25"> </span>
<a href="#l30.26"></a><span id="l30.26">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l30.27"></a><span id="l30.27">     rv = account-&gt;GetIncomingServer(getter_AddRefs(incomingServer));</span>
<a href="#l30.28"></a><span id="l30.28">     if (!incomingServer) continue;</span>
<a href="#l30.29"></a><span id="l30.29"> </span>
<a href="#l30.30"></a><span id="l30.30">     nsCString type;</span>
<a href="#l30.31"></a><span id="l30.31">     rv = incomingServer-&gt;GetType(type);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckyFilters.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckyFilters.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -650,27 +650,22 @@ nsresult nsBeckyFilters::FindMessageFold</span>
<a href="#l31.4"></a><span id="l31.4"> nsresult nsBeckyFilters::GetMessageFolder(const nsAString &amp;aName,</span>
<a href="#l31.5"></a><span id="l31.5">                                           nsIMsgFolder **_retval) {</span>
<a href="#l31.6"></a><span id="l31.6">   nsresult rv;</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager;</span>
<a href="#l31.9"></a><span id="l31.9">   accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l31.10"></a><span id="l31.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  nsCOMPtr&lt;nsIArray&gt; accounts;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-  rv = accountManager-&gt;GetAccounts(getter_AddRefs(accounts));</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-  uint32_t accountCount;</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-  rv = accounts-&gt;GetLength(&amp;accountCount);</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+  nsTArray&lt;RefPtr&lt;nsIMsgAccount&gt;&gt; accounts;</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+  rv = accountManager-&gt;GetAccounts(accounts);</span>
<a href="#l31.20"></a><span id="l31.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.21"></a><span id="l31.21"> </span>
<a href="#l31.22"></a><span id="l31.22">   nsCOMPtr&lt;nsIMsgFolder&gt; found;</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineminus">-  for (uint32_t i = 0; i &lt; accountCount; i++) {</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-    nsCOMPtr&lt;nsIMsgAccount&gt; account(do_QueryElementAt(accounts, i));</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+  for (auto account : accounts) {</span>
<a href="#l31.26"></a><span id="l31.26">     if (!account) continue;</span>
<a href="#l31.27"></a><span id="l31.27"> </span>
<a href="#l31.28"></a><span id="l31.28">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l31.29"></a><span id="l31.29">     account-&gt;GetIncomingServer(getter_AddRefs(server));</span>
<a href="#l31.30"></a><span id="l31.30">     if (!server) continue;</span>
<a href="#l31.31"></a><span id="l31.31">     FindMessageFolderInServer(aName, server, getter_AddRefs(found));</span>
<a href="#l31.32"></a><span id="l31.32">     if (found) break;</span>
<a href="#l31.33"></a><span id="l31.33">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -468,20 +468,17 @@ SettingsImportHelper.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">     } else {</span>
<a href="#l32.5"></a><span id="l32.5">       Assert.equal(true, this.mInterface.AutoLocate({}, {}));</span>
<a href="#l32.6"></a><span id="l32.6">     }</span>
<a href="#l32.7"></a><span id="l32.7">     Assert.equal(true, this.mInterface.Import({}));</span>
<a href="#l32.8"></a><span id="l32.8">     this.checkResults();</span>
<a href="#l32.9"></a><span id="l32.9">   },</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11">   _ensureNoAccounts() {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    let accounts = MailServices.accounts.accounts;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineminus">-    for (let i = 0; i &lt; accounts.length; i++) {</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-      let account = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+    for (let account of MailServices.accounts.accounts) {</span>
<a href="#l32.17"></a><span id="l32.17">       MailServices.accounts.removeAccount(account);</span>
<a href="#l32.18"></a><span id="l32.18">     }</span>
<a href="#l32.19"></a><span id="l32.19">   },</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21">   _checkSmtpServer(expected, actual) {</span>
<a href="#l32.22"></a><span id="l32.22">     Assert.equal(expected.port, actual.port);</span>
<a href="#l32.23"></a><span id="l32.23">     Assert.equal(expected.username, actual.username);</span>
<a href="#l32.24"></a><span id="l32.24">     Assert.equal(expected.authMethod, actual.authMethod);</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineat">@@ -559,19 +556,17 @@ SettingsImportHelper.prototype = {</span>
<a href="#l32.26"></a><span id="l32.26">           account.incomingServer.username &amp;&amp;</span>
<a href="#l32.27"></a><span id="l32.27">         expectedAccount.incomingServer.hostName ==</span>
<a href="#l32.28"></a><span id="l32.28">           account.incomingServer.hostName</span>
<a href="#l32.29"></a><span id="l32.29">       );</span>
<a href="#l32.30"></a><span id="l32.30">     });</span>
<a href="#l32.31"></a><span id="l32.31">   },</span>
<a href="#l32.32"></a><span id="l32.32"> </span>
<a href="#l32.33"></a><span id="l32.33">   checkResults() {</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineminus">-    let accounts = MailServices.accounts.accounts;</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-    for (let i = 0; i &lt; accounts.length - 1; i++) {</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-      let actualAccount = accounts.queryElementAt(i, Ci.nsIMsgAccount);</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+    for (let actualAccount of MailServices.accounts.accounts) {</span>
<a href="#l32.38"></a><span id="l32.38">       if (this._isLocalMailAccount(actualAccount)) {</span>
<a href="#l32.39"></a><span id="l32.39">         continue;</span>
<a href="#l32.40"></a><span id="l32.40">       }</span>
<a href="#l32.41"></a><span id="l32.41">       let expectedAccounts = this._findExpectedAccount(actualAccount);</span>
<a href="#l32.42"></a><span id="l32.42">       Assert.notEqual(null, expectedAccounts);</span>
<a href="#l32.43"></a><span id="l32.43">       Assert.equal(1, expectedAccounts.length);</span>
<a href="#l32.44"></a><span id="l32.44">       this._checkAccount(expectedAccounts[0], actualAccount);</span>
<a href="#l32.45"></a><span id="l32.45">     }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

