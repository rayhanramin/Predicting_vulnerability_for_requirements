<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8459:f7fd0a2c188abaac750411d23947cbb7c79315f8</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f7fd0a2c188abaac750411d23947cbb7c79315f8" />
<meta property="og:url" content="/comm-central/rev/f7fd0a2c188abaac750411d23947cbb7c79315f8" />
<meta property="og:description" content="remove xpcom proxy use from mailnews import, part of bug 675407, r=standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f7fd0a2c188abaac750411d23947cbb7c79315f8 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f7fd0a2c188abaac750411d23947cbb7c79315f8">shortlog</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f7fd0a2c188abaac750411d23947cbb7c79315f8">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8">files</a> |
changeset |
<a href="/comm-central/raw-rev/f7fd0a2c188abaac750411d23947cbb7c79315f8">raw</a>  | <a href="/comm-central/archive/f7fd0a2c188abaac750411d23947cbb7c79315f8.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
remove xpcom proxy use from mailnews import, part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=675407">bug 675407</a>, r=standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#66;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#32;&#60;&#98;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#64;&#110;&#118;&#101;&#110;&#116;&#117;&#114;&#101;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 09 Sep 2011 19:20:28 -0700</td></tr>

<tr>
 <td>changeset 8459</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f7fd0a2c188abaac750411d23947cbb7c79315f8">f7fd0a2c188abaac750411d23947cbb7c79315f8</a></td>
</tr>



<tr>
<td>parent 8458</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/aa9149fef1814903132bf1477dcfcc68ff41de43">aa9149fef1814903132bf1477dcfcc68ff41de43</a>
</td>
</tr>

<tr>
<td>child 8460</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/38e2832e047612983e382afdfa8f3edee0a2e801">38e2832e047612983e382afdfa8f3edee0a2e801</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f7fd0a2c188abaac750411d23947cbb7c79315f8">6494</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Sat, 10 Sep 2011 02:21:08 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f7fd0a2c188a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f7fd0a2c188abaac750411d23947cbb7c79315f8">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f7fd0a2c188abaac750411d23947cbb7c79315f8&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f7fd0a2c188abaac750411d23947cbb7c79315f8&newProject=comm-central&newRevision=f7fd0a2c188abaac750411d23947cbb7c79315f8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f7fd0a2c188abaac750411d23947cbb7c79315f8&newProject=comm-central&newRevision=f7fd0a2c188abaac750411d23947cbb7c79315f8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f7fd0a2c188abaac750411d23947cbb7c79315f8&newProject=comm-central&newRevision=f7fd0a2c188abaac750411d23947cbb7c79315f8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28standard8%29&revcount=50">standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=675407">675407</a></td></tr>




</table></div>

<div class="page_body description">remove xpcom proxy use from mailnews import, part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=675407">bug 675407</a>, r=standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.h">mailnews/import/applemail/src/nsAppleMailImport.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/applemail/src/nsAppleMailImport.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">mailnews/import/comm4x/src/nsComm4xMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.h">mailnews/import/comm4x/src/nsComm4xMailImport.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/comm4x/src/nsComm4xMailImport.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.cpp">mailnews/import/eudora/src/nsEudoraAddress.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.h">mailnews/import/eudora/src/nsEudoraAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraAddress.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.cpp">mailnews/import/eudora/src/nsEudoraCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.h">mailnews/import/eudora/src/nsEudoraCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraCompose.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraImport.cpp">mailnews/import/eudora/src/nsEudoraImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">mailnews/import/eudora/src/nsEudoraStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.h">mailnews/import/eudora/src/nsEudoraStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/eudora/src/nsEudoraStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEImport.cpp">mailnews/import/oexpress/nsOEImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.cpp">mailnews/import/oexpress/nsOEStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.h">mailnews/import/oexpress/nsOEStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/oexpress/nsOEStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.cpp">mailnews/import/outlook/src/nsOutlookCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.h">mailnews/import/outlook/src/nsOutlookCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookCompose.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookImport.cpp">mailnews/import/outlook/src/nsOutlookImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">mailnews/import/outlook/src/nsOutlookStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.h">mailnews/import/outlook/src/nsOutlookStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/outlook/src/nsOutlookStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/public/nsIImportService.idl">mailnews/import/public/nsIImportService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/public/nsIImportService.idl">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/public/nsIImportService.idl">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/public/nsIImportService.idl">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/public/nsIImportService.idl">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/public/nsIImportService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportFieldMap.cpp">mailnews/import/src/nsImportFieldMap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportFieldMap.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportFieldMap.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportFieldMap.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportFieldMap.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportFieldMap.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportService.cpp">mailnews/import/src/nsImportService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportService.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportService.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportService.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportService.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.cpp">mailnews/import/src/nsImportStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.h">mailnews/import/src/nsImportStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/src/nsImportStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/text/src/nsTextImport.cpp">mailnews/import/text/src/nsTextImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/text/src/nsTextImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/text/src/nsTextImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/text/src/nsTextImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/text/src/nsTextImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/text/src/nsTextImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/vcard/src/nsVCardImport.cpp">mailnews/import/vcard/src/nsVCardImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/vcard/src/nsVCardImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/vcard/src/nsVCardImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/vcard/src/nsVCardImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/vcard/src/nsVCardImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/vcard/src/nsVCardImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMImport.cpp">mailnews/import/winlivemail/nsWMImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMImport.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMImport.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMImport.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMImport.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.cpp">mailnews/import/winlivemail/nsWMStringBundle.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.cpp">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.cpp">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.cpp">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.cpp">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.h">mailnews/import/winlivemail/nsWMStringBundle.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.h">file</a> |
<a href="/comm-central/annotate/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.h">annotate</a> |
<a href="/comm-central/diff/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.h">diff</a> |
<a href="/comm-central/comparison/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.h">comparison</a> |
<a href="/comm-central/log/f7fd0a2c188abaac750411d23947cbb7c79315f8/mailnews/import/winlivemail/nsWMStringBundle.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -43,18 +43,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l1.6"></a><span id="l1.6"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-#include &quot;nsXPCOMCIDInternal.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> #include &quot;nsEmlxHelperUtils.h&quot;</span>
<a href="#l1.18"></a><span id="l1.18"> #include &quot;nsAppleMailImport.h&quot;</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> PRLogModuleInfo *APPLEMAILLOGMODULE = nsnull;</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -168,28 +166,17 @@ nsAppleMailImportMail::nsAppleMailImport</span>
<a href="#l1.23"></a><span id="l1.23"> }</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25"> nsresult nsAppleMailImportMail::Initialize()</span>
<a href="#l1.26"></a><span id="l1.26"> {</span>
<a href="#l1.27"></a><span id="l1.27">   nsresult rv;</span>
<a href="#l1.28"></a><span id="l1.28">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv));</span>
<a href="#l1.29"></a><span id="l1.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-  rv = bundleService-&gt;CreateBundle(APPLEMAIL_MSGS_URL, getter_AddRefs(bundle));</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-  nsCOMPtr&lt;nsIProxyObjectManager&gt; proxyObjectManager = </span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-    do_GetService(NS_XPCOMPROXY_CONTRACTID, &amp;rv);</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-  return proxyObjectManager-&gt;GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, </span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-                                               NS_GET_IID(nsIStringBundle),</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-                                               bundle, NS_PROXY_SYNC | NS_PROXY_ALWAYS, </span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-                                               getter_AddRefs(mBundleProxy));</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+  return bundleService-&gt;CreateBundle(APPLEMAIL_MSGS_URL, getter_AddRefs(mBundle));</span>
<a href="#l1.44"></a><span id="l1.44"> }</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46"> nsAppleMailImportMail::~nsAppleMailImportMail()</span>
<a href="#l1.47"></a><span id="l1.47"> {</span>
<a href="#l1.48"></a><span id="l1.48">   IMPORT_LOG0(&quot;nsAppleMailImportMail destroyed&quot;);</span>
<a href="#l1.49"></a><span id="l1.49"> }</span>
<a href="#l1.50"></a><span id="l1.50"> </span>
<a href="#l1.51"></a><span id="l1.51"> NS_IMPL_THREADSAFE_ISUPPORTS1(nsAppleMailImportMail, nsIImportMail)</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineat">@@ -619,17 +606,17 @@ NS_IMETHODIMP nsAppleMailImportMail::Imp</span>
<a href="#l1.53"></a><span id="l1.53">   return NS_OK;</span>
<a href="#l1.54"></a><span id="l1.54"> }</span>
<a href="#l1.55"></a><span id="l1.55"> </span>
<a href="#l1.56"></a><span id="l1.56"> void nsAppleMailImportMail::ReportStatus(PRInt32 aErrorNum, nsString &amp;aName, nsAString &amp;aStream)</span>
<a href="#l1.57"></a><span id="l1.57"> {</span>
<a href="#l1.58"></a><span id="l1.58">   // get (and format, if needed) the error string from the bundle  </span>
<a href="#l1.59"></a><span id="l1.59">   nsAutoString outString;</span>
<a href="#l1.60"></a><span id="l1.60">   const PRUnichar *fmt = { aName.get() };</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-  nsresult rv = mBundleProxy-&gt;FormatStringFromID(aErrorNum, &amp;fmt, 1, getter_Copies(outString));</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+  nsresult rv = mBundle-&gt;FormatStringFromID(aErrorNum, &amp;fmt, 1, getter_Copies(outString));</span>
<a href="#l1.63"></a><span id="l1.63">   // write it out the stream</span>
<a href="#l1.64"></a><span id="l1.64">   if (NS_SUCCEEDED(rv))</span>
<a href="#l1.65"></a><span id="l1.65">     aStream.Append(outString + NS_LITERAL_STRING(&quot;\n&quot;));</span>
<a href="#l1.66"></a><span id="l1.66"> }</span>
<a href="#l1.67"></a><span id="l1.67"> </span>
<a href="#l1.68"></a><span id="l1.68"> void nsAppleMailImportMail::SetLogs(const nsAString &amp;aSuccess, const nsAString &amp;aError, PRUnichar **aOutSuccess, PRUnichar **aOutError)</span>
<a href="#l1.69"></a><span id="l1.69"> {</span>
<a href="#l1.70"></a><span id="l1.70">   if (aOutError &amp;&amp; !*aOutError)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -78,33 +78,33 @@ class nsAppleMailImportModule : public n</span>
<a href="#l2.4"></a><span id="l2.4">   private:</span>
<a href="#l2.5"></a><span id="l2.5">     </span>
<a href="#l2.6"></a><span id="l2.6">   nsCOMPtr&lt;nsIStringBundle&gt; mBundle;</span>
<a href="#l2.7"></a><span id="l2.7"> };</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> class nsAppleMailImportMail : public nsIImportMail</span>
<a href="#l2.10"></a><span id="l2.10"> {</span>
<a href="#l2.11"></a><span id="l2.11">   public:</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14">   nsAppleMailImportMail();</span>
<a href="#l2.15"></a><span id="l2.15">   virtual ~nsAppleMailImportMail();</span>
<a href="#l2.16"></a><span id="l2.16"> </span>
<a href="#l2.17"></a><span id="l2.17">   NS_DECL_ISUPPORTS</span>
<a href="#l2.18"></a><span id="l2.18">   NS_DECL_NSIIMPORTMAIL</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">   nsresult Initialize();</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22">   private:</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-  </span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+</span>
<a href="#l2.25"></a><span id="l2.25">   void FindAccountMailDirs(nsIFile *aRoot, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.26"></a><span id="l2.26">   nsresult FindMboxDirs(nsILocalFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.27"></a><span id="l2.27">   nsresult AddMboxDir(nsILocalFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l2.28"></a><span id="l2.28">     </span>
<a href="#l2.29"></a><span id="l2.29">   // aInfoString is the format to a &quot;foo %s&quot; string. It may be NULL if the error string needs no such format.</span>
<a href="#l2.30"></a><span id="l2.30">   void ReportStatus(PRInt32 aErrorNum, nsString &amp;aName, nsAString &amp;aStream);</span>
<a href="#l2.31"></a><span id="l2.31">   static void SetLogs(const nsAString&amp; success, const nsAString&amp; error, PRUnichar **aOutErrorLog, PRUnichar **aSuccessLog);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-  </span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt;  mBundleProxy;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundle&gt;  mBundle;</span>
<a href="#l2.36"></a><span id="l2.36">   PRUint32                   mProgress;</span>
<a href="#l2.37"></a><span id="l2.37">   PRUint16                   mCurDepth;</span>
<a href="#l2.38"></a><span id="l2.38"> };</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40"> #endif /* nsAppleMailImport_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMailImport.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/import/comm4x/src/nsComm4xMailImport.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -63,18 +63,16 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsComm4xMailStringBundle.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;Comm4xMailDebugLog.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-#include &quot;nsXPCOMCIDInternal.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> #define COMM4XMAIL_MSGS_URL   &quot;chrome://messenger/locale/comm4xMailImportMsgs.properties&quot;</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> PRLogModuleInfo *COMM4XLOGMODULE = nsnull;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.20"></a><span id="l3.20"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -177,41 +175,26 @@ NS_IMETHODIMP nsComm4xMailImport::GetImp</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24">     return NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l3.25"></a><span id="l3.25"> }</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> /////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> ImportComm4xMailImpl::ImportComm4xMailImpl()</span>
<a href="#l3.30"></a><span id="l3.30"> {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    m_pBundleProxy = nsnull;</span>
<a href="#l3.32"></a><span id="l3.32"> }</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34"> nsresult ImportComm4xMailImpl::Initialize()</span>
<a href="#l3.35"></a><span id="l3.35"> {</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-    nsCOMPtr &lt;nsIStringBundleService&gt; pBundleService;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-    nsresult rv;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-    nsCOMPtr &lt;nsIStringBundle&gt;  pBundle;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-    pBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; (pBundleService)) {</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-        pBundleService-&gt;CreateBundle(COMM4XMAIL_MSGS_URL, getter_AddRefs(pBundle));</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundleService&gt; pBundleService;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  nsresult rv;</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-	nsCOMPtr&lt;nsIProxyObjectManager&gt; proxyObjectManager =</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-	  do_GetService(NS_XPCOMPROXY_CONTRACTID, &amp;rv);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-	if (NS_FAILED(rv))</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-	  return nsnull;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-	rv = proxyObjectManager-&gt;GetProxyForObject(NS_PROXY_TO_MAIN_THREAD,</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-						   NS_GET_IID(nsIStringBundle),</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-						   pBundle,</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-						   NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-						   getter_AddRefs(m_pBundleProxy));</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-    }</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-    return rv;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+  pBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+  return pBundleService-&gt;CreateBundle(COMM4XMAIL_MSGS_URL, getter_AddRefs(m_pBundle));</span>
<a href="#l3.61"></a><span id="l3.61"> }</span>
<a href="#l3.62"></a><span id="l3.62"> </span>
<a href="#l3.63"></a><span id="l3.63"> ImportComm4xMailImpl::~ImportComm4xMailImpl()</span>
<a href="#l3.64"></a><span id="l3.64"> {</span>
<a href="#l3.65"></a><span id="l3.65"> }</span>
<a href="#l3.66"></a><span id="l3.66"> </span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68"> </span>
<a href="#l3.69"></a><span id="l3.69" class="difflineat">@@ -251,17 +234,17 @@ NS_IMETHODIMP ImportComm4xMailImpl::Find</span>
<a href="#l3.70"></a><span id="l3.70">     return rv;</span>
<a href="#l3.71"></a><span id="l3.71"> }</span>
<a href="#l3.72"></a><span id="l3.72"> </span>
<a href="#l3.73"></a><span id="l3.73"> void ImportComm4xMailImpl::ReportStatus( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l3.74"></a><span id="l3.74"> {</span>
<a href="#l3.75"></a><span id="l3.75">     if (!pStream) return;</span>
<a href="#l3.76"></a><span id="l3.76">     nsString statusStr;</span>
<a href="#l3.77"></a><span id="l3.77">     const PRUnichar * fmtStr = name.get();</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-    nsresult rv = m_pBundleProxy-&gt;FormatStringFromID(errorNum, &amp;fmtStr, 1, getter_Copies(statusStr));</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    nsresult rv = m_pBundle-&gt;FormatStringFromID(errorNum, &amp;fmtStr, 1, getter_Copies(statusStr));</span>
<a href="#l3.80"></a><span id="l3.80">     if (NS_SUCCEEDED (rv)) {</span>
<a href="#l3.81"></a><span id="l3.81">         pStream-&gt;Append (statusStr.get());</span>
<a href="#l3.82"></a><span id="l3.82">         pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l3.83"></a><span id="l3.83">     }</span>
<a href="#l3.84"></a><span id="l3.84"> </span>
<a href="#l3.85"></a><span id="l3.85"> }</span>
<a href="#l3.86"></a><span id="l3.86"> </span>
<a href="#l3.87"></a><span id="l3.87"> void ImportComm4xMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineat">@@ -281,17 +264,17 @@ NS_IMETHODIMP ImportComm4xMailImpl::Impo</span>
<a href="#l3.89"></a><span id="l3.89">     NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l3.90"></a><span id="l3.90">     NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l3.91"></a><span id="l3.91">     NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l3.92"></a><span id="l3.92"> </span>
<a href="#l3.93"></a><span id="l3.93">     nsString    success;</span>
<a href="#l3.94"></a><span id="l3.94">     nsString    error;</span>
<a href="#l3.95"></a><span id="l3.95">     if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l3.96"></a><span id="l3.96">         nsString errorString;</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-        m_pBundleProxy-&gt;GetStringFromID(COMM4XMAILIMPORT_MAILBOX_BADPARAM, getter_Copies(errorString));</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+        m_pBundle-&gt;GetStringFromID(COMM4XMAILIMPORT_MAILBOX_BADPARAM, getter_Copies(errorString));</span>
<a href="#l3.99"></a><span id="l3.99">         error = errorString;</span>
<a href="#l3.100"></a><span id="l3.100">         if (fatalError)</span>
<a href="#l3.101"></a><span id="l3.101">             *fatalError = PR_TRUE;</span>
<a href="#l3.102"></a><span id="l3.102">         SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l3.103"></a><span id="l3.103">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l3.104"></a><span id="l3.104">     }</span>
<a href="#l3.105"></a><span id="l3.105"> </span>
<a href="#l3.106"></a><span id="l3.106">     nsString    name;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMailImport.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/import/comm4x/src/nsComm4xMailImport.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -67,17 +67,17 @@ public:</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l4.6"></a><span id="l4.6">     // we suppport the nsIImportModule interface </span>
<a href="#l4.7"></a><span id="l4.7">     ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">     NS_DECL_NSIIMPORTMODULE</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11"> protected:</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-     nsCOMPtr &lt;nsIStringBundle&gt;  m_pBundle;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+     nsCOMPtr&lt;nsIStringBundle&gt;  m_pBundle;</span>
<a href="#l4.14"></a><span id="l4.14"> };</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> class ImportComm4xMailImpl : public nsIImportMail</span>
<a href="#l4.17"></a><span id="l4.17"> {</span>
<a href="#l4.18"></a><span id="l4.18"> public:</span>
<a href="#l4.19"></a><span id="l4.19">     ImportComm4xMailImpl();</span>
<a href="#l4.20"></a><span id="l4.20">     virtual ~ImportComm4xMailImpl();</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -104,13 +104,13 @@ public:</span>
<a href="#l4.23"></a><span id="l4.23"> public:</span>
<a href="#l4.24"></a><span id="l4.24">     static void SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l4.25"></a><span id="l4.25">     void ReportStatus(PRInt32 errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l4.26"></a><span id="l4.26">     nsresult Initialize();</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28"> private:</span>
<a href="#l4.29"></a><span id="l4.29">     nsComm4xMail  m_mail;</span>
<a href="#l4.30"></a><span id="l4.30">     PRUint32      m_bytesDone;</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt;  m_pBundleProxy;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundle&gt;  m_pBundle;</span>
<a href="#l4.33"></a><span id="l4.33"> };</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> #endif /* nsComm4xMailImport_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -750,20 +750,20 @@ void nsEudoraAddress::ExtractNoteField( </span>
<a href="#l5.4"></a><span id="l5.4">       note.Left( tempL, idx);</span>
<a href="#l5.5"></a><span id="l5.5">     nsCString tempR;</span>
<a href="#l5.6"></a><span id="l5.6">     note.Right( tempR, note.Length() - endIdx - 1);</span>
<a href="#l5.7"></a><span id="l5.7">     note = tempL;</span>
<a href="#l5.8"></a><span id="l5.8">     note.Append( tempR);</span>
<a href="#l5.9"></a><span id="l5.9">   }</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-void nsEudoraAddress::FormatExtraDataInNoteField(PRInt32 labelStringID, nsIStringBundle* bundle, nsCString&amp; extraData, nsString&amp; noteUTF16)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+void nsEudoraAddress::FormatExtraDataInNoteField(PRInt32 labelStringID, nsCString&amp; extraData, nsString&amp; noteUTF16)</span>
<a href="#l5.14"></a><span id="l5.14"> {</span>
<a href="#l5.15"></a><span id="l5.15">   nsAutoString    label;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  nsEudoraStringBundle::GetStringByID(labelStringID, label, bundle);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+  nsEudoraStringBundle::GetStringByID(labelStringID, label);</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19">   noteUTF16.Append(label);</span>
<a href="#l5.20"></a><span id="l5.20">   noteUTF16.AppendLiteral(&quot;\n&quot;);</span>
<a href="#l5.21"></a><span id="l5.21">   noteUTF16.Append( NS_ConvertASCIItoUTF16(extraData) );</span>
<a href="#l5.22"></a><span id="l5.22">   noteUTF16.AppendLiteral(&quot;\n\n&quot;);</span>
<a href="#l5.23"></a><span id="l5.23"> }</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25"> void nsEudoraAddress::SanitizeValue( nsCString&amp; val)</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineat">@@ -810,17 +810,16 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.27"></a><span id="l5.27">   nsCString                   phoneWK, webLinkWK, title, company;</span>
<a href="#l5.28"></a><span id="l5.28">   nsCString                   addressWK, address2WK, cityWK, stateWK, zipWK, countryWK;</span>
<a href="#l5.29"></a><span id="l5.29">   nsCString                   primaryLocation, otherPhone, otherWeb;</span>
<a href="#l5.30"></a><span id="l5.30">   nsCString                   additionalEmail, stillMoreEmail;</span>
<a href="#l5.31"></a><span id="l5.31">   nsCString                   note(pEntry-&gt;m_notes);</span>
<a href="#l5.32"></a><span id="l5.32">   nsString                    noteUTF16;</span>
<a href="#l5.33"></a><span id="l5.33">   PRBool                      isSecondaryMobileWorkNumber = PR_TRUE;</span>
<a href="#l5.34"></a><span id="l5.34">   PRBool                      isSecondaryFaxWorkNumber = PR_TRUE;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt;   bundle( dont_AddRef(nsEudoraStringBundle::GetStringBundleProxy()) );</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37">   if (!note.IsEmpty())</span>
<a href="#l5.38"></a><span id="l5.38">   {</span>
<a href="#l5.39"></a><span id="l5.39">     ExtractNoteField( note, fax, &quot;fax&quot;);</span>
<a href="#l5.40"></a><span id="l5.40">     ExtractNoteField( note, secondaryFax, &quot;fax2&quot;);</span>
<a href="#l5.41"></a><span id="l5.41">     ExtractNoteField( note, phone, &quot;phone&quot;);</span>
<a href="#l5.42"></a><span id="l5.42">     ExtractNoteField( note, mobile, &quot;mobile&quot;);</span>
<a href="#l5.43"></a><span id="l5.43">     ExtractNoteField( note, secondaryMobile, &quot;mobile2&quot;);</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineat">@@ -873,35 +872,35 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.45"></a><span id="l5.45">           // Separate out the first address.</span>
<a href="#l5.46"></a><span id="l5.46">           nsCString   tempStashEmail(additionalEmail);</span>
<a href="#l5.47"></a><span id="l5.47">           tempStashEmail.Left(additionalEmail, idx);</span>
<a href="#l5.48"></a><span id="l5.48">         }</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50">         // If there were more than one additional email addresses store all the extra</span>
<a href="#l5.51"></a><span id="l5.51">         // ones in the notes field, labeled nicely.</span>
<a href="#l5.52"></a><span id="l5.52">         if ( !stillMoreEmail.IsEmpty() )</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-          FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHEREMAIL, bundle, stillMoreEmail, noteUTF16);</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+          FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHEREMAIL, stillMoreEmail, noteUTF16);</span>
<a href="#l5.55"></a><span id="l5.55">       }</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57">       if ( !otherPhone.IsEmpty() )</span>
<a href="#l5.58"></a><span id="l5.58">       {</span>
<a href="#l5.59"></a><span id="l5.59">         // Reconstitute line breaks for other phone numbers</span>
<a href="#l5.60"></a><span id="l5.60">         otherPhone.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.61"></a><span id="l5.61"> </span>
<a href="#l5.62"></a><span id="l5.62">         // Store other phone numbers in the notes field, labeled nicely</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-        FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERPHONE, bundle, otherPhone, noteUTF16);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+        FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERPHONE, otherPhone, noteUTF16);</span>
<a href="#l5.65"></a><span id="l5.65">       }</span>
<a href="#l5.66"></a><span id="l5.66"> </span>
<a href="#l5.67"></a><span id="l5.67">       if ( !otherWeb.IsEmpty() )</span>
<a href="#l5.68"></a><span id="l5.68">       {</span>
<a href="#l5.69"></a><span id="l5.69">         // Reconstitute line breaks for other web sites</span>
<a href="#l5.70"></a><span id="l5.70">         otherWeb.ReplaceSubstring( &quot;\x03&quot;, &quot;\n&quot;);</span>
<a href="#l5.71"></a><span id="l5.71"> </span>
<a href="#l5.72"></a><span id="l5.72">         // Store other web sites in the notes field, labeled nicely</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-        FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERWEB, bundle, otherWeb, noteUTF16);</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+        FormatExtraDataInNoteField(EUDORAIMPORT_ADDRESS_LABEL_OTHERWEB, otherWeb, noteUTF16);</span>
<a href="#l5.75"></a><span id="l5.75">       }</span>
<a href="#l5.76"></a><span id="l5.76"> </span>
<a href="#l5.77"></a><span id="l5.77">       noteUTF16.Append( NS_ConvertASCIItoUTF16(note) );</span>
<a href="#l5.78"></a><span id="l5.78">     }</span>
<a href="#l5.79"></a><span id="l5.79">   }</span>
<a href="#l5.80"></a><span id="l5.80"> </span>
<a href="#l5.81"></a><span id="l5.81">   CAliasData *pData = emailList.Count() ? (CAliasData *)emailList.ElementAt(0) : nsnull;</span>
<a href="#l5.82"></a><span id="l5.82"> </span>
<a href="#l5.83"></a><span id="l5.83" class="difflineat">@@ -1013,27 +1012,27 @@ void nsEudoraAddress::AddSingleCard( CAl</span>
<a href="#l5.84"></a><span id="l5.84">     nsString        pFormat;</span>
<a href="#l5.85"></a><span id="l5.85">     nsString        pCustomData;</span>
<a href="#l5.86"></a><span id="l5.86"> </span>
<a href="#l5.87"></a><span id="l5.87">     // Add second mobile number, if any, to the Custom 1 field</span>
<a href="#l5.88"></a><span id="l5.88">     if ( !secondaryMobile.IsEmpty() )</span>
<a href="#l5.89"></a><span id="l5.89">     {</span>
<a href="#l5.90"></a><span id="l5.90">       stringID = isSecondaryMobileWorkNumber ?</span>
<a href="#l5.91"></a><span id="l5.91">                  EUDORAIMPORT_ADDRESS_LABEL_WORKMOBILE : EUDORAIMPORT_ADDRESS_LABEL_HOMEMOBILE;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-      pFormat.Adopt( nsEudoraStringBundle::GetStringByID(stringID, bundle) );</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+      pFormat.Adopt(nsEudoraStringBundle::GetStringByID(stringID));</span>
<a href="#l5.94"></a><span id="l5.94">       pCustomData.Adopt( nsTextFormatter::smprintf(pFormat.get(), NS_ConvertASCIItoUTF16(secondaryMobile).get()) );</span>
<a href="#l5.95"></a><span id="l5.95">       pDb-&gt;AddCustom1( newRow, NS_ConvertUTF16toUTF8(pCustomData).get() );</span>
<a href="#l5.96"></a><span id="l5.96">     }</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98">     // Add second fax number, if any, to the Custom 2 field</span>
<a href="#l5.99"></a><span id="l5.99">     if ( !secondaryFax.IsEmpty() )</span>
<a href="#l5.100"></a><span id="l5.100">     {</span>
<a href="#l5.101"></a><span id="l5.101">       stringID = isSecondaryFaxWorkNumber ?</span>
<a href="#l5.102"></a><span id="l5.102">                  EUDORAIMPORT_ADDRESS_LABEL_WORKFAX : EUDORAIMPORT_ADDRESS_LABEL_HOMEFAX;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-      pFormat.Adopt( nsEudoraStringBundle::GetStringByID(stringID, bundle) );</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+      pFormat.Adopt(nsEudoraStringBundle::GetStringByID(stringID));</span>
<a href="#l5.105"></a><span id="l5.105">       pCustomData.Adopt( nsTextFormatter::smprintf(pFormat.get(), NS_ConvertASCIItoUTF16(secondaryFax).get()) );</span>
<a href="#l5.106"></a><span id="l5.106">       pDb-&gt;AddCustom2( newRow, NS_ConvertUTF16toUTF8(pCustomData).get() );</span>
<a href="#l5.107"></a><span id="l5.107">     }</span>
<a href="#l5.108"></a><span id="l5.108"> </span>
<a href="#l5.109"></a><span id="l5.109">     // Lastly, note field.</span>
<a href="#l5.110"></a><span id="l5.110">     pDb-&gt;AddNotes( newRow, NS_ConvertUTF16toUTF8(noteUTF16).get() );</span>
<a href="#l5.111"></a><span id="l5.111"> </span>
<a href="#l5.112"></a><span id="l5.112">     pDb-&gt;AddCardRowToDB( newRow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -84,17 +84,17 @@ private:</span>
<a href="#l6.4"></a><span id="l6.4">   void       ResolveEntries( nsCString&amp; name, nsVoidArray&amp; list, nsVoidArray&amp; result, PRBool addResolvedEntries, PRBool wasResolved, PRInt32&amp; numResolved);</span>
<a href="#l6.5"></a><span id="l6.5">   void      BuildABCards( PRUint32 *pBytes, nsIAddrDatabase *pDb);</span>
<a href="#l6.6"></a><span id="l6.6">   void      AddSingleCard( CAliasEntry *pEntry, nsVoidArray &amp;emailList, nsIAddrDatabase *pDb);</span>
<a href="#l6.7"></a><span id="l6.7">   nsresult  AddSingleList( CAliasEntry *pEntry, nsVoidArray &amp;emailList, nsIAddrDatabase *pDb);</span>
<a href="#l6.8"></a><span id="l6.8">   nsresult  AddGroupMembersAsCards(nsVoidArray &amp;membersArray, nsIAddrDatabase *pDb);</span>
<a href="#l6.9"></a><span id="l6.9">   void      RememberGroupMembers(nsVoidArray &amp;membersArray, nsVoidArray &amp;emailList);</span>
<a href="#l6.10"></a><span id="l6.10">   PRInt32      FindAlias( nsCString&amp; name);</span>
<a href="#l6.11"></a><span id="l6.11">   void      ExtractNoteField( nsCString&amp; note, nsCString&amp; field, const char *pFieldName);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  void FormatExtraDataInNoteField(PRInt32 labelStringID, nsIStringBundle* bundle, nsCString&amp; extraData, nsString&amp; noteUTF16);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  void FormatExtraDataInNoteField(PRInt32 labelStringID, nsCString&amp; extraData, nsString&amp; noteUTF16);</span>
<a href="#l6.14"></a><span id="l6.14">   void      SanitizeValue( nsCString&amp; val);</span>
<a href="#l6.15"></a><span id="l6.15">   void      SplitString( nsCString&amp; val1, nsCString&amp; val2);</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> public:</span>
<a href="#l6.18"></a><span id="l6.18">   static PRInt32     CountQuote( const char *pLine, PRInt32 len);</span>
<a href="#l6.19"></a><span id="l6.19">   static PRInt32     CountComment( const char *pLine, PRInt32 len);</span>
<a href="#l6.20"></a><span id="l6.20">   static PRInt32     CountAngle( const char *pLine, PRInt32 len);</span>
<a href="#l6.21"></a><span id="l6.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -188,18 +188,16 @@ nsresult EudoraSendListener::CreateSendL</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> nsEudoraCompose::nsEudoraCompose()</span>
<a href="#l7.8"></a><span id="l7.8"> {</span>
<a href="#l7.9"></a><span id="l7.9">   m_pIOService = nsnull;</span>
<a href="#l7.10"></a><span id="l7.10">   m_pAttachments = nsnull;</span>
<a href="#l7.11"></a><span id="l7.11">   m_pListener = nsnull;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  m_pMsgSend = nsnull;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-  m_pSendProxy = nsnull;</span>
<a href="#l7.14"></a><span id="l7.14">   m_pMsgFields = nsnull;</span>
<a href="#l7.15"></a><span id="l7.15">   m_pHeaders = p_test_headers;</span>
<a href="#l7.16"></a><span id="l7.16">   if (m_pHeaders)</span>
<a href="#l7.17"></a><span id="l7.17">     m_headerLen = strlen( m_pHeaders);</span>
<a href="#l7.18"></a><span id="l7.18">   else</span>
<a href="#l7.19"></a><span id="l7.19">     m_headerLen = 0;</span>
<a href="#l7.20"></a><span id="l7.20">   m_pBody = p_test_body;</span>
<a href="#l7.21"></a><span id="l7.21">   if (m_pBody)</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -208,19 +206,17 @@ nsEudoraCompose::nsEudoraCompose()</span>
<a href="#l7.23"></a><span id="l7.23">     m_bodyLen = 0;</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">   m_readHeaders.m_convertCRs = PR_TRUE;</span>
<a href="#l7.26"></a><span id="l7.26"> }</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29"> nsEudoraCompose::~nsEudoraCompose()</span>
<a href="#l7.30"></a><span id="l7.30"> {</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  NS_IF_RELEASE( m_pSendProxy);</span>
<a href="#l7.32"></a><span id="l7.32">   NS_IF_RELEASE( m_pIOService);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  NS_IF_RELEASE( m_pMsgSend);</span>
<a href="#l7.34"></a><span id="l7.34">   NS_IF_RELEASE( m_pListener);</span>
<a href="#l7.35"></a><span id="l7.35">   NS_IF_RELEASE( m_pMsgFields);</span>
<a href="#l7.36"></a><span id="l7.36"> }</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38"> nsresult nsEudoraCompose::CreateIdentity( void)</span>
<a href="#l7.39"></a><span id="l7.39"> {</span>
<a href="#l7.40"></a><span id="l7.40">   if (s_pIdentity)</span>
<a href="#l7.41"></a><span id="l7.41">     return( NS_OK);</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineat">@@ -268,33 +264,20 @@ nsresult nsEudoraCompose::CreateComponen</span>
<a href="#l7.43"></a><span id="l7.43">     NS_WITH_PROXIED_SERVICE(nsIIOService, service, NS_IOSERVICE_CONTRACTID, NS_PROXY_TO_MAIN_THREAD, &amp;rv);</span>
<a href="#l7.44"></a><span id="l7.44">     if (NS_FAILED(rv))</span>
<a href="#l7.45"></a><span id="l7.45">       return( rv);</span>
<a href="#l7.46"></a><span id="l7.46">     m_pIOService = service;</span>
<a href="#l7.47"></a><span id="l7.47">     NS_IF_ADDREF( m_pIOService);</span>
<a href="#l7.48"></a><span id="l7.48">   }</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50">   NS_IF_RELEASE( m_pMsgFields);</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-  if (!m_pMsgSend) {</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-    rv = CallCreateInstance( kMsgSendCID, &amp;m_pMsgSend);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; m_pMsgSend) {</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-      rv = NS_GetProxyForObject( NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIMsgSend),</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-                  m_pMsgSend, NS_PROXY_SYNC, (void**)&amp;m_pSendProxy);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-      if (NS_FAILED( rv)) {</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-        m_pSendProxy = nsnull;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-        NS_RELEASE( m_pMsgSend);</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-        m_pMsgSend = nsnull;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-      }</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-    }</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-  }</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-  if (!m_pListener &amp;&amp; NS_SUCCEEDED( rv)) {</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+  if (!m_pListener &amp;&amp; NS_SUCCEEDED( rv))</span>
<a href="#l7.65"></a><span id="l7.65">     rv = EudoraSendListener::CreateSendListener( &amp;m_pListener);</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-  }</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; m_pMsgSend) {</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l7.70"></a><span id="l7.70">       rv = CallCreateInstance( kMsgCompFieldsCID, &amp;m_pMsgFields);</span>
<a href="#l7.71"></a><span id="l7.71">     if (NS_SUCCEEDED(rv) &amp;&amp; m_pMsgFields) {</span>
<a href="#l7.72"></a><span id="l7.72">       // IMPORT_LOG0( &quot;nsOutlookCompose - CreateComponents succeeded\n&quot;);</span>
<a href="#l7.73"></a><span id="l7.73">       m_pMsgFields-&gt;SetForcePlainText( PR_FALSE);</span>
<a href="#l7.74"></a><span id="l7.74">       return( NS_OK);</span>
<a href="#l7.75"></a><span id="l7.75">     }</span>
<a href="#l7.76"></a><span id="l7.76">   }</span>
<a href="#l7.77"></a><span id="l7.77"> </span>
<a href="#l7.78"></a><span id="l7.78" class="difflineat">@@ -709,67 +692,29 @@ nsresult nsEudoraCompose::SendTheMessage</span>
<a href="#l7.79"></a><span id="l7.79">   // editor when it helps.</span>
<a href="#l7.80"></a><span id="l7.80">   nsRefPtr&lt;nsEudoraEditor&gt;  pEudoraEditor = new nsEudoraEditor(m_pBody, pMailImportLocation);</span>
<a href="#l7.81"></a><span id="l7.81">   nsCOMPtr&lt;nsIEditor&gt;       pEditor;</span>
<a href="#l7.82"></a><span id="l7.82"> </span>
<a href="#l7.83"></a><span id="l7.83">   if (pEudoraEditor-&gt;HasEmbeddedContent())</span>
<a href="#l7.84"></a><span id="l7.84">     // There's embedded content that we need to import, so query for the editor interface</span>
<a href="#l7.85"></a><span id="l7.85">     pEudoraEditor-&gt;QueryInterface( NS_GET_IID(nsIEditor), getter_AddRefs(pEditor) );</span>
<a href="#l7.86"></a><span id="l7.86"> </span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-  if (NS_FAILED( rv)) {</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-    rv = m_pSendProxy-&gt;CreateAndSendMessage(</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-                          pEditor.get(),                // pseudo editor shell when there's embedded content</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-                          s_pIdentity,                  // dummy identity</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-                          nsnull,                       // account key</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-                          m_pMsgFields,                 // message fields</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-                          PR_FALSE,                     // digest = NO</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-                          PR_TRUE,                      // dont_deliver = YES, make a file</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-                          mode,                         // mode</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-                          nsnull,                       // no message to replace</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-                          pMimeType,                    // body type</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-                          m_pBody,                      // body pointer</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-                          m_bodyLen,                    // body length</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-                          nsnull,                       // remote attachment data</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-                          pAttach,                      // local attachments</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-                          nsnull,                       // related part</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-                          nsnull,                       // parent window</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineminus">-                          nsnull,                       // progress listener</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineminus">-                          m_pListener,                  // listener</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-                          nsnull,                       // password</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineminus">-                          EmptyCString(),               // originalMsgURI</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-                          nsnull);                      // message compose type</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+  nsCOMPtr&lt;nsIImportService&gt; impService(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+  impService-&gt;ProxySend(pEditor,                       // pseudo editor shell when there's embedded content</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineplus">+                        s_pIdentity,                  // dummy identity</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineplus">+                        m_pMsgFields,                 // message fields</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineplus">+                        mode,                         // mode</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineplus">+                        pMimeType,                    // body type</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineplus">+                        body.get(),                   // body pointer</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+                        body.Length(),                // body length</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+                        pAttach,                      // local attachments</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+                        m_pListener);              // originalMsgURI</span>
<a href="#l7.121"></a><span id="l7.121"> </span>
<a href="#l7.122"></a><span id="l7.122" class="difflineminus">-  }</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineminus">-  else {</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineminus">-    rv = m_pSendProxy-&gt;CreateAndSendMessage(</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineminus">-                          pEditor.get(),                // pseudo editor shell when there's embedded content</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineminus">-                          s_pIdentity,                  // dummy identity</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineminus">-                          nsnull,                       // account key</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-                          m_pMsgFields,                 // message fields</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineminus">-                          PR_FALSE,                     // digest = NO</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineminus">-                          PR_TRUE,                      // dont_deliver = YES, make a file</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineminus">-                          mode,                         // mode</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-                          nsnull,                       // no message to replace</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-                          pMimeType,                    // body type</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineminus">-                          body.get(),                   // body pointer</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineminus">-                          body.Length(),                // body length</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineminus">-                          nsnull,                       // remote attachment data</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-                          pAttach,                      // local attachments</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineminus">-                          nsnull,                       // related part</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineminus">-                          nsnull,                       // parent window</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-                          nsnull,                       // progress listener</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineminus">-                          m_pListener,                  // listener</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineminus">-                          nsnull,                       // password</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineminus">-                          EmptyCString(),               // originalMsgURI</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineminus">-                          nsnull);                      // message compose type</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineminus">-</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineminus">-  }</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineminus">-  // IMPORT_LOG0( &quot;Returned from CreateAndSendMessage\n&quot;);</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+  // IMPORT_LOG0( &quot;Returned from ProxySend\n&quot;);</span>
<a href="#l7.150"></a><span id="l7.150"> </span>
<a href="#l7.151"></a><span id="l7.151">   if (pAttach)</span>
<a href="#l7.152"></a><span id="l7.152">     delete [] pAttach;</span>
<a href="#l7.153"></a><span id="l7.153"> </span>
<a href="#l7.154"></a><span id="l7.154">   EudoraSendListener *pListen = (EudoraSendListener *)m_pListener;</span>
<a href="#l7.155"></a><span id="l7.155">   if (NS_FAILED( rv)) {</span>
<a href="#l7.156"></a><span id="l7.156">     IMPORT_LOG1( &quot;*** Error, CreateAndSendMessage FAILED: 0x%lx\n&quot;, rv);</span>
<a href="#l7.157"></a><span id="l7.157">     // IMPORT_LOG1( &quot;Headers: %80s\n&quot;, m_pHeaders);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -170,18 +170,16 @@ private:</span>
<a href="#l8.4"></a><span id="l8.4">   nsresult  WriteHeaders( nsIOutputStream *pDst, SimpleBufferTonyRCopiedOnce&amp; newHeaders);</span>
<a href="#l8.5"></a><span id="l8.5">   PRBool    IsReplaceHeader( const char *pHeader);</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> private:</span>
<a href="#l8.8"></a><span id="l8.8">   static nsIMsgIdentity *    s_pIdentity;</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">   nsVoidArray *      m_pAttachments;</span>
<a href="#l8.11"></a><span id="l8.11">   nsIMsgSendListener *  m_pListener;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  nsIMsgSend *      m_pMsgSend;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-  nsIMsgSend *      m_pSendProxy;</span>
<a href="#l8.14"></a><span id="l8.14">   nsIMsgCompFields *    m_pMsgFields;</span>
<a href="#l8.15"></a><span id="l8.15">   nsIIOService *      m_pIOService;</span>
<a href="#l8.16"></a><span id="l8.16">   PRInt32          m_headerLen;</span>
<a href="#l8.17"></a><span id="l8.17">   const char *      m_pHeaders;</span>
<a href="#l8.18"></a><span id="l8.18">   PRInt32          m_bodyLen;</span>
<a href="#l8.19"></a><span id="l8.19">   const char *      m_pBody;</span>
<a href="#l8.20"></a><span id="l8.20">   nsCString        m_bodyType;</span>
<a href="#l8.21"></a><span id="l8.21">   nsString        m_defCharset;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -483,39 +483,35 @@ void ImportEudoraMailImpl::AddLinebreak(</span>
<a href="#l9.4"></a><span id="l9.4">     pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l9.5"></a><span id="l9.5"> }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> void ImportEudoraMailImpl::ReportSuccess( nsString&amp; name, PRInt32 count, nsString *pStream)</span>
<a href="#l9.8"></a><span id="l9.8"> {</span>
<a href="#l9.9"></a><span id="l9.9">   if (!pStream)</span>
<a href="#l9.10"></a><span id="l9.10">     return;</span>
<a href="#l9.11"></a><span id="l9.11">   // load the success string</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  nsIStringBundle *pBundle = nsEudoraStringBundle::GetStringBundleProxy();</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_MAILBOX_SUCCESS, pBundle);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l9.15"></a><span id="l9.15">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get(), count);</span>
<a href="#l9.16"></a><span id="l9.16">   pStream-&gt;Append( pText);</span>
<a href="#l9.17"></a><span id="l9.17">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l9.18"></a><span id="l9.18">   nsEudoraStringBundle::FreeString( pFmt);</span>
<a href="#l9.19"></a><span id="l9.19">   AddLinebreak( pStream);</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23"> void ImportEudoraMailImpl::ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l9.24"></a><span id="l9.24"> {</span>
<a href="#l9.25"></a><span id="l9.25">   if (!pStream)</span>
<a href="#l9.26"></a><span id="l9.26">     return;</span>
<a href="#l9.27"></a><span id="l9.27">   // load the error string</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-  nsIStringBundle *pBundle = nsEudoraStringBundle::GetStringBundleProxy();</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID( errorNum);</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-  PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID(errorNum);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  PRUnichar *pText = nsTextFormatter::smprintf(pFmt, name.get());</span>
<a href="#l9.33"></a><span id="l9.33">   pStream-&gt;Append( pText);</span>
<a href="#l9.34"></a><span id="l9.34">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l9.35"></a><span id="l9.35">   nsEudoraStringBundle::FreeString( pFmt);</span>
<a href="#l9.36"></a><span id="l9.36">   AddLinebreak( pStream);</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l9.38"></a><span id="l9.38"> }</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40"> </span>
<a href="#l9.41"></a><span id="l9.41"> void ImportEudoraMailImpl::SetLogs( nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l9.42"></a><span id="l9.42"> {</span>
<a href="#l9.43"></a><span id="l9.43">   if (pError)</span>
<a href="#l9.44"></a><span id="l9.44">     *pError = ToNewUnicode(error);</span>
<a href="#l9.45"></a><span id="l9.45">   if (pSuccess)</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineat">@@ -528,24 +524,24 @@ NS_IMETHODIMP ImportEudoraMailImpl::Impo</span>
<a href="#l9.47"></a><span id="l9.47">             PRUnichar **pSuccessLog,</span>
<a href="#l9.48"></a><span id="l9.48">             PRBool *fatalError)</span>
<a href="#l9.49"></a><span id="l9.49"> {</span>
<a href="#l9.50"></a><span id="l9.50">   NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l9.51"></a><span id="l9.51">   NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l9.52"></a><span id="l9.52">   NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l9.53"></a><span id="l9.53"> </span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle( dont_AddRef( nsEudoraStringBundle::GetStringBundleProxy()));</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundle&gt; bundle( dont_AddRef( nsEudoraStringBundle::GetStringBundle()));</span>
<a href="#l9.57"></a><span id="l9.57"> </span>
<a href="#l9.58"></a><span id="l9.58">   nsString  success;</span>
<a href="#l9.59"></a><span id="l9.59">   nsString  error;</span>
<a href="#l9.60"></a><span id="l9.60">   if (!pSource || !pDestination || !fatalError)</span>
<a href="#l9.61"></a><span id="l9.61">   {</span>
<a href="#l9.62"></a><span id="l9.62">     IMPORT_LOG0( &quot;*** Bad param passed to eudora mailbox import\n&quot;);</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-    nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_MAILBOX_BADPARAM, error, bundle);</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+    nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_MAILBOX_BADPARAM, error);</span>
<a href="#l9.65"></a><span id="l9.65">     if (fatalError)</span>
<a href="#l9.66"></a><span id="l9.66">       *fatalError = PR_TRUE;</span>
<a href="#l9.67"></a><span id="l9.67">     SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l9.68"></a><span id="l9.68">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l9.69"></a><span id="l9.69">   }</span>
<a href="#l9.70"></a><span id="l9.70"> </span>
<a href="#l9.71"></a><span id="l9.71">   PRBool    abort = PR_FALSE;</span>
<a href="#l9.72"></a><span id="l9.72">   nsString  name;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineat">@@ -706,47 +702,43 @@ NS_IMETHODIMP ImportEudoraAddressImpl::F</span>
<a href="#l9.74"></a><span id="l9.74"> </span>
<a href="#l9.75"></a><span id="l9.75"> </span>
<a href="#l9.76"></a><span id="l9.76"> </span>
<a href="#l9.77"></a><span id="l9.77"> void ImportEudoraAddressImpl::ReportSuccess( nsString&amp; name, nsString *pStream)</span>
<a href="#l9.78"></a><span id="l9.78"> {</span>
<a href="#l9.79"></a><span id="l9.79">   if (!pStream)</span>
<a href="#l9.80"></a><span id="l9.80">     return;</span>
<a href="#l9.81"></a><span id="l9.81">   // load the success string</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-  nsIStringBundle *pBundle = nsEudoraStringBundle::GetStringBundleProxy();</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_ADDRESS_SUCCESS, pBundle);</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+  PRUnichar *pFmt = nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l9.85"></a><span id="l9.85">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l9.86"></a><span id="l9.86">   pStream-&gt;Append( pText);</span>
<a href="#l9.87"></a><span id="l9.87">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l9.88"></a><span id="l9.88">   nsEudoraStringBundle::FreeString( pFmt);</span>
<a href="#l9.89"></a><span id="l9.89">   ImportEudoraMailImpl::AddLinebreak( pStream);</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l9.91"></a><span id="l9.91"> }</span>
<a href="#l9.92"></a><span id="l9.92"> </span>
<a href="#l9.93"></a><span id="l9.93"> </span>
<a href="#l9.94"></a><span id="l9.94"> NS_IMETHODIMP</span>
<a href="#l9.95"></a><span id="l9.95"> ImportEudoraAddressImpl::ImportAddressBook(nsIImportABDescriptor *pSource,</span>
<a href="#l9.96"></a><span id="l9.96">                                            nsIAddrDatabase *pDestination,</span>
<a href="#l9.97"></a><span id="l9.97">                                            nsIImportFieldMap *fieldMap,</span>
<a href="#l9.98"></a><span id="l9.98">                                            nsISupports *aSupportService,</span>
<a href="#l9.99"></a><span id="l9.99">                                            PRUnichar **pErrorLog,</span>
<a href="#l9.100"></a><span id="l9.100">                                            PRUnichar **pSuccessLog,</span>
<a href="#l9.101"></a><span id="l9.101">                                            PRBool *fatalError)</span>
<a href="#l9.102"></a><span id="l9.102"> {</span>
<a href="#l9.103"></a><span id="l9.103">     NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l9.104"></a><span id="l9.104">     NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l9.105"></a><span id="l9.105">     NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l9.106"></a><span id="l9.106"> </span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle( dont_AddRef( nsEudoraStringBundle::GetStringBundleProxy()));</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-</span>
<a href="#l9.109"></a><span id="l9.109">   nsString  success;</span>
<a href="#l9.110"></a><span id="l9.110">   nsString  error;</span>
<a href="#l9.111"></a><span id="l9.111">     if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l9.112"></a><span id="l9.112">     IMPORT_LOG0( &quot;*** Bad param passed to eudora address import\n&quot;);</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">-    nsEudoraStringBundle::GetStringByID( EUDORAIMPORT_ADDRESS_BADPARAM, error, bundle);</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+    nsEudoraStringBundle::GetStringByID(EUDORAIMPORT_ADDRESS_BADPARAM, error);</span>
<a href="#l9.115"></a><span id="l9.115">     if (fatalError)</span>
<a href="#l9.116"></a><span id="l9.116">       *fatalError = PR_TRUE;</span>
<a href="#l9.117"></a><span id="l9.117">     ImportEudoraMailImpl::SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l9.118"></a><span id="l9.118">       return NS_ERROR_NULL_POINTER;</span>
<a href="#l9.119"></a><span id="l9.119">   }</span>
<a href="#l9.120"></a><span id="l9.120"> </span>
<a href="#l9.121"></a><span id="l9.121">     PRBool    abort = PR_FALSE;</span>
<a href="#l9.122"></a><span id="l9.122">     nsString  name;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -39,73 +39,58 @@</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> #include &quot;prprf.h&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> #include &quot;prmem.h&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l10.8"></a><span id="l10.8"> #include &quot;nsReadableUtils.h&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-#include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsIURI.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> #define EUDORA_MSGS_URL       &quot;chrome://messenger/locale/eudoraImportMsgs.properties&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> nsIStringBundle *  nsEudoraStringBundle::m_pBundle = nsnull;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> nsIStringBundle *nsEudoraStringBundle::GetStringBundle( void)</span>
<a href="#l10.21"></a><span id="l10.21"> {</span>
<a href="#l10.22"></a><span id="l10.22">   if (m_pBundle)</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-    return( m_pBundle);</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+    return m_pBundle;</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">   nsresult          rv;</span>
<a href="#l10.27"></a><span id="l10.27">   const char*       propertyURL = EUDORA_MSGS_URL;</span>
<a href="#l10.28"></a><span id="l10.28">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l10.31"></a><span id="l10.31">            do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l10.32"></a><span id="l10.32">   if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService))</span>
<a href="#l10.33"></a><span id="l10.33">     rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35">   m_pBundle = sBundle;</span>
<a href="#l10.36"></a><span id="l10.36">   return( sBundle);</span>
<a href="#l10.37"></a><span id="l10.37"> }</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-nsIStringBundle *nsEudoraStringBundle::GetStringBundleProxy( void)</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-{</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-  if (!m_pBundle)</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-    return( nsnull);</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-  nsIStringBundle *strProxy = nsnull;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-  // create a proxy object if we aren't on the same thread?</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-  NS_GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-                       m_pBundle, NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-                       (void **) &amp;strProxy);</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-  return( strProxy);</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-}</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-void nsEudoraStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle)</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+void nsEudoraStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span>
<a href="#l10.55"></a><span id="l10.55"> {</span>
<a href="#l10.56"></a><span id="l10.56"> </span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-  PRUnichar *ptrv = GetStringByID( stringID, pBundle);</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l10.59"></a><span id="l10.59">   result = ptrv;</span>
<a href="#l10.60"></a><span id="l10.60">   FreeString( ptrv);</span>
<a href="#l10.61"></a><span id="l10.61"> }</span>
<a href="#l10.62"></a><span id="l10.62"> </span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-PRUnichar *nsEudoraStringBundle::GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle)</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+PRUnichar *nsEudoraStringBundle::GetStringByID(PRInt32 stringID)</span>
<a href="#l10.65"></a><span id="l10.65"> {</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-  if (!pBundle)</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-    pBundle = GetStringBundle();</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+  if (!m_pBundle)</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+    m_pBundle = GetStringBundle();</span>
<a href="#l10.70"></a><span id="l10.70"> </span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-  if (pBundle)</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+  if (m_pBundle)</span>
<a href="#l10.73"></a><span id="l10.73">   {</span>
<a href="#l10.74"></a><span id="l10.74">     PRUnichar *ptrv = nsnull;</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-    nsresult rv = pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+    nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l10.77"></a><span id="l10.77"> </span>
<a href="#l10.78"></a><span id="l10.78">     if (NS_SUCCEEDED( rv) &amp;&amp; ptrv)</span>
<a href="#l10.79"></a><span id="l10.79">       return( ptrv);</span>
<a href="#l10.80"></a><span id="l10.80">   }</span>
<a href="#l10.81"></a><span id="l10.81"> </span>
<a href="#l10.82"></a><span id="l10.82">   nsString resultString(NS_LITERAL_STRING(&quot;[StringID &quot;));</span>
<a href="#l10.83"></a><span id="l10.83">   resultString.AppendInt(stringID);</span>
<a href="#l10.84"></a><span id="l10.84">   resultString.AppendLiteral(&quot;?]&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraStringBundle.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraStringBundle.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -40,21 +40,20 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #define nsEudoraStringBundle_H__</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> #include &quot;nsString.h&quot;</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> class nsIStringBundle;</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10"> class nsEudoraStringBundle {</span>
<a href="#l11.11"></a><span id="l11.11"> public:</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  static PRUnichar       *  GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  static void               GetStringByID(PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  static PRUnichar       *  GetStringByID(PRInt32 stringID);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+  static void               GetStringByID(PRInt32 stringID, nsString&amp; result);</span>
<a href="#l11.16"></a><span id="l11.16">   static nsString           FormatString(PRInt32 stringID, ...);</span>
<a href="#l11.17"></a><span id="l11.17">   static nsIStringBundle *  GetStringBundle( void); // don't release</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-  static nsIStringBundle *  GetStringBundleProxy( void); // release</span>
<a href="#l11.19"></a><span id="l11.19">   static void               FreeString( PRUnichar *pStr) { NS_Free( pStr);}</span>
<a href="#l11.20"></a><span id="l11.20">   static void               Cleanup( void);</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22"> private:</span>
<a href="#l11.23"></a><span id="l11.23">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l11.24"></a><span id="l11.24"> };</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -385,39 +385,35 @@ void ImportOEMailImpl::AddLinebreak( nsS</span>
<a href="#l12.4"></a><span id="l12.4">     pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l12.5"></a><span id="l12.5"> }</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> void ImportOEMailImpl::ReportSuccess( nsString&amp; name, PRInt32 count, nsString *pStream)</span>
<a href="#l12.8"></a><span id="l12.8"> {</span>
<a href="#l12.9"></a><span id="l12.9">   if (!pStream)</span>
<a href="#l12.10"></a><span id="l12.10">     return;</span>
<a href="#l12.11"></a><span id="l12.11">   // load the success string</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  nsIStringBundle *pBundle = nsOEStringBundle::GetStringBundleProxy();</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( OEIMPORT_MAILBOX_SUCCESS, pBundle);</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( OEIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l12.15"></a><span id="l12.15">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get(), count);</span>
<a href="#l12.16"></a><span id="l12.16">   pStream-&gt;Append( pText);</span>
<a href="#l12.17"></a><span id="l12.17">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l12.18"></a><span id="l12.18">   nsOEStringBundle::FreeString( pFmt);</span>
<a href="#l12.19"></a><span id="l12.19">   AddLinebreak( pStream);</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l12.21"></a><span id="l12.21"> }</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23"> void ImportOEMailImpl::ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l12.24"></a><span id="l12.24"> {</span>
<a href="#l12.25"></a><span id="l12.25">   if (!pStream)</span>
<a href="#l12.26"></a><span id="l12.26">     return;</span>
<a href="#l12.27"></a><span id="l12.27">   // load the error string</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-  nsIStringBundle *pBundle = nsOEStringBundle::GetStringBundleProxy();</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( errorNum, pBundle);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+  PRUnichar *pFmt = nsOEStringBundle::GetStringByID(errorNum);</span>
<a href="#l12.31"></a><span id="l12.31">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l12.32"></a><span id="l12.32">   pStream-&gt;Append( pText);</span>
<a href="#l12.33"></a><span id="l12.33">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l12.34"></a><span id="l12.34">   nsOEStringBundle::FreeString( pFmt);</span>
<a href="#l12.35"></a><span id="l12.35">   AddLinebreak( pStream);</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l12.37"></a><span id="l12.37"> }</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40"> void ImportOEMailImpl::SetLogs( nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l12.41"></a><span id="l12.41"> {</span>
<a href="#l12.42"></a><span id="l12.42">   if (pError)</span>
<a href="#l12.43"></a><span id="l12.43">     *pError = ToNewUnicode(error);</span>
<a href="#l12.44"></a><span id="l12.44">   if (pSuccess)</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineat">@@ -429,22 +425,20 @@ NS_IMETHODIMP ImportOEMailImpl::ImportMa</span>
<a href="#l12.46"></a><span id="l12.46">                                               PRUnichar **pErrorLog,</span>
<a href="#l12.47"></a><span id="l12.47">                                               PRUnichar **pSuccessLog,</span>
<a href="#l12.48"></a><span id="l12.48">                                               PRBool *fatalError)</span>
<a href="#l12.49"></a><span id="l12.49"> {</span>
<a href="#l12.50"></a><span id="l12.50">   NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l12.51"></a><span id="l12.51">   NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l12.52"></a><span id="l12.52">   NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l12.53"></a><span id="l12.53"> </span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle( dont_AddRef( nsOEStringBundle::GetStringBundleProxy()));</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-</span>
<a href="#l12.56"></a><span id="l12.56">   nsString success;</span>
<a href="#l12.57"></a><span id="l12.57">   nsString error;</span>
<a href="#l12.58"></a><span id="l12.58">   if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-    nsOEStringBundle::GetStringByID( OEIMPORT_MAILBOX_BADPARAM, error, bundle);</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+    nsOEStringBundle::GetStringByID( OEIMPORT_MAILBOX_BADPARAM, error);</span>
<a href="#l12.61"></a><span id="l12.61">     if (fatalError)</span>
<a href="#l12.62"></a><span id="l12.62">       *fatalError = PR_TRUE;</span>
<a href="#l12.63"></a><span id="l12.63">     SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l12.64"></a><span id="l12.64">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l12.65"></a><span id="l12.65">   }</span>
<a href="#l12.66"></a><span id="l12.66"> </span>
<a href="#l12.67"></a><span id="l12.67">   PRBool abort = PR_FALSE;</span>
<a href="#l12.68"></a><span id="l12.68">   nsString name;</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineat">@@ -611,22 +605,21 @@ NS_IMETHODIMP ImportOEAddressImpl::Impor</span>
<a href="#l12.70"></a><span id="l12.70">   // we assume it is our one and only address book.</span>
<a href="#l12.71"></a><span id="l12.71">   if (!m_pWab) {</span>
<a href="#l12.72"></a><span id="l12.72">     IMPORT_LOG0( &quot;Wab not loaded in ImportAddressBook call\n&quot;);</span>
<a href="#l12.73"></a><span id="l12.73">     return( NS_ERROR_FAILURE);</span>
<a href="#l12.74"></a><span id="l12.74">   }</span>
<a href="#l12.75"></a><span id="l12.75"> </span>
<a href="#l12.76"></a><span id="l12.76">   IMPORT_LOG0( &quot;IMPORTING OUTLOOK EXPRESS ADDRESS BOOK\n&quot;);</span>
<a href="#l12.77"></a><span id="l12.77"> </span>
<a href="#l12.78"></a><span id="l12.78" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt;  bundle( dont_AddRef( nsOEStringBundle::GetStringBundleProxy()));</span>
<a href="#l12.79"></a><span id="l12.79">   nsString success;</span>
<a href="#l12.80"></a><span id="l12.80">   nsString error;</span>
<a href="#l12.81"></a><span id="l12.81">   if (!source || !destination || !fatalError)</span>
<a href="#l12.82"></a><span id="l12.82">   {</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-    nsOEStringBundle::GetStringByID( OEIMPORT_ADDRESS_BADPARAM, error, bundle);</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+    nsOEStringBundle::GetStringByID( OEIMPORT_ADDRESS_BADPARAM, error);</span>
<a href="#l12.85"></a><span id="l12.85">     if (fatalError)</span>
<a href="#l12.86"></a><span id="l12.86">       *fatalError = PR_TRUE;</span>
<a href="#l12.87"></a><span id="l12.87">     ImportOEMailImpl::SetLogs( success, error, errorLog, successLog);</span>
<a href="#l12.88"></a><span id="l12.88">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l12.89"></a><span id="l12.89">   }</span>
<a href="#l12.90"></a><span id="l12.90"> </span>
<a href="#l12.91"></a><span id="l12.91">   m_doneSoFar = 0;</span>
<a href="#l12.92"></a><span id="l12.92">   nsOEAddressIterator * pIter = new nsOEAddressIterator( m_pWab, destination);</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineat">@@ -661,17 +654,15 @@ NS_IMETHODIMP ImportOEAddressImpl::GetIm</span>
<a href="#l12.94"></a><span id="l12.94">   return( NS_OK);</span>
<a href="#l12.95"></a><span id="l12.95"> }</span>
<a href="#l12.96"></a><span id="l12.96"> </span>
<a href="#l12.97"></a><span id="l12.97"> void ImportOEAddressImpl::ReportSuccess( nsString&amp; name, nsString *pStream)</span>
<a href="#l12.98"></a><span id="l12.98"> {</span>
<a href="#l12.99"></a><span id="l12.99">   if (!pStream)</span>
<a href="#l12.100"></a><span id="l12.100">     return;</span>
<a href="#l12.101"></a><span id="l12.101">   // load the success string</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-  nsIStringBundle *pBundle = nsOEStringBundle::GetStringBundleProxy();</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( OEIMPORT_ADDRESS_SUCCESS, pBundle);</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+  PRUnichar *pFmt = nsOEStringBundle::GetStringByID( OEIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l12.105"></a><span id="l12.105">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l12.106"></a><span id="l12.106">   pStream-&gt;Append( pText);</span>
<a href="#l12.107"></a><span id="l12.107">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l12.108"></a><span id="l12.108">   nsOEStringBundle::FreeString( pFmt);</span>
<a href="#l12.109"></a><span id="l12.109">   ImportOEMailImpl::AddLinebreak( pStream);</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l12.111"></a><span id="l12.111"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEStringBundle.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -36,17 +36,16 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;prprf.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;prmem.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsReadableUtils.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;nsOEStringBundle.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsIURI.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15"> #define OE_MSGS_URL       &quot;chrome://messenger/locale/oeImportMsgs.properties&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17"> nsIStringBundle *  nsOEStringBundle::m_pBundle = nsnull;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> nsIStringBundle *nsOEStringBundle::GetStringBundle( void)</span>
<a href="#l13.20"></a><span id="l13.20"> {</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -64,47 +63,32 @@ nsIStringBundle *nsOEStringBundle::GetSt</span>
<a href="#l13.22"></a><span id="l13.22">     rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l13.23"></a><span id="l13.23">   }</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">   m_pBundle = sBundle;</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27">   return( sBundle);</span>
<a href="#l13.28"></a><span id="l13.28"> }</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-nsIStringBundle *nsOEStringBundle::GetStringBundleProxy( void)</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+void nsOEStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span>
<a href="#l13.33"></a><span id="l13.33"> {</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  if (!m_pBundle)</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-    return( nsnull);</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-  nsIStringBundle *strProxy = nsnull;</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-  // create a proxy object if we aren't on the same thread?</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-  NS_GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-                       m_pBundle, NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-                       (void **) &amp;strProxy);</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-  return( strProxy);</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-}</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-void nsOEStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle)</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-{</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-  PRUnichar *ptrv = GetStringByID( stringID, pBundle);</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+  PRUnichar *ptrv = GetStringByID( stringID);</span>
<a href="#l13.51"></a><span id="l13.51">   result = ptrv;</span>
<a href="#l13.52"></a><span id="l13.52">   FreeString( ptrv);</span>
<a href="#l13.53"></a><span id="l13.53"> }</span>
<a href="#l13.54"></a><span id="l13.54"> </span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-PRUnichar *nsOEStringBundle::GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle)</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+PRUnichar *nsOEStringBundle::GetStringByID(PRInt32 stringID)</span>
<a href="#l13.57"></a><span id="l13.57"> {</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-  if (!pBundle) {</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-    pBundle = GetStringBundle();</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-  }</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+  if (!m_pBundle)</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+    m_pBundle = GetStringBundle();</span>
<a href="#l13.63"></a><span id="l13.63"> </span>
<a href="#l13.64"></a><span id="l13.64" class="difflineminus">-  if (pBundle) {</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+  if (m_pBundle) {</span>
<a href="#l13.66"></a><span id="l13.66">     PRUnichar *ptrv = nsnull;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    nsresult rv = pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+    nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l13.69"></a><span id="l13.69"> </span>
<a href="#l13.70"></a><span id="l13.70">     if (NS_SUCCEEDED( rv) &amp;&amp; ptrv)</span>
<a href="#l13.71"></a><span id="l13.71">       return( ptrv);</span>
<a href="#l13.72"></a><span id="l13.72">   }</span>
<a href="#l13.73"></a><span id="l13.73"> </span>
<a href="#l13.74"></a><span id="l13.74">   nsString resultString;</span>
<a href="#l13.75"></a><span id="l13.75">   resultString.AppendLiteral(&quot;[StringID &quot;);</span>
<a href="#l13.76"></a><span id="l13.76">   resultString.AppendInt(stringID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEStringBundle.h</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEStringBundle.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -38,22 +38,21 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #define _nsOEStringBundle_H__</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> #include &quot;nsString.h&quot;</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> class nsIStringBundle;</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> class nsOEStringBundle {</span>
<a href="#l14.11"></a><span id="l14.11"> public:</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  static PRUnichar     *    GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-  static void          GetStringByID(PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  static PRUnichar     *    GetStringByID(PRInt32 stringID);</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+  static void          GetStringByID(PRInt32 stringID, nsString&amp; result);</span>
<a href="#l14.16"></a><span id="l14.16">   static nsIStringBundle *  GetStringBundle( void); // don't release</span>
<a href="#l14.17"></a><span id="l14.17">   static void          FreeString( PRUnichar *pStr) { NS_Free( pStr);}</span>
<a href="#l14.18"></a><span id="l14.18">   static void          Cleanup( void);</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-  static nsIStringBundle *  GetStringBundleProxy( void); // release</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21"> private:</span>
<a href="#l14.22"></a><span id="l14.22">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l14.23"></a><span id="l14.23"> };</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26"> </span>
<a href="#l14.27"></a><span id="l14.27"> #define OEIMPORT_NAME                     2000</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -217,29 +217,25 @@ nsresult OutlookSendListener::CreateSend</span>
<a href="#l15.4"></a><span id="l15.4"> #define hackCRLFA &quot;crlf&quot;</span>
<a href="#l15.5"></a><span id="l15.5"> #define hackCRLFW NS_L(hackCRLFA)</span>
<a href="#l15.6"></a><span id="l15.6"> #define hackAmpersandA &quot;amp&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #define hackAmpersandW NS_L(hackAmpersandA)</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> nsOutlookCompose::nsOutlookCompose()</span>
<a href="#l15.10"></a><span id="l15.10"> {</span>
<a href="#l15.11"></a><span id="l15.11">   m_pListener = nsnull;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  m_pMsgSend = nsnull;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  m_pSendProxy = nsnull;</span>
<a href="#l15.14"></a><span id="l15.14">   m_pMsgFields = nsnull;</span>
<a href="#l15.15"></a><span id="l15.15">   m_pIdentity = nsnull;</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17">   m_optimizationBufferSize = 16*1024;</span>
<a href="#l15.18"></a><span id="l15.18">   m_optimizationBuffer = new char[m_optimizationBufferSize];</span>
<a href="#l15.19"></a><span id="l15.19"> }</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21"> nsOutlookCompose::~nsOutlookCompose()</span>
<a href="#l15.22"></a><span id="l15.22"> {</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-  NS_IF_RELEASE(m_pSendProxy);</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-  NS_IF_RELEASE(m_pMsgSend);</span>
<a href="#l15.25"></a><span id="l15.25">   NS_IF_RELEASE(m_pListener);</span>
<a href="#l15.26"></a><span id="l15.26">   NS_IF_RELEASE(m_pMsgFields);</span>
<a href="#l15.27"></a><span id="l15.27">   if (m_pIdentity) {</span>
<a href="#l15.28"></a><span id="l15.28">     nsresult rv = m_pIdentity-&gt;ClearAllValues();</span>
<a href="#l15.29"></a><span id="l15.29">     NS_ASSERTION(NS_SUCCEEDED(rv),&quot;failed to clear values&quot;);</span>
<a href="#l15.30"></a><span id="l15.30">     if (NS_FAILED(rv))</span>
<a href="#l15.31"></a><span id="l15.31">       return;</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33" class="difflineat">@@ -277,32 +273,20 @@ nsresult nsOutlookCompose::CreateIdentit</span>
<a href="#l15.34"></a><span id="l15.34">   return rv;</span>
<a href="#l15.35"></a><span id="l15.35"> }</span>
<a href="#l15.36"></a><span id="l15.36"> </span>
<a href="#l15.37"></a><span id="l15.37"> nsresult nsOutlookCompose::CreateComponents( void)</span>
<a href="#l15.38"></a><span id="l15.38"> {</span>
<a href="#l15.39"></a><span id="l15.39">   nsresult rv = NS_OK;</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41">   NS_IF_RELEASE(m_pMsgFields);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-  if (!m_pMsgSend) {</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-    rv = CallCreateInstance( kMsgSendCID, &amp;m_pMsgSend);</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-    if (NS_SUCCEEDED( rv) &amp;&amp; m_pMsgSend) {</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-      rv = NS_GetProxyForObject( NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIMsgSend),</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-                  m_pMsgSend, NS_PROXY_SYNC, (void **)&amp;m_pSendProxy);</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-      if (NS_FAILED( rv)) {</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-        m_pSendProxy = nsnull;</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-        NS_RELEASE(m_pMsgSend);</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-      }</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-    }</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-  }</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-  if (!m_pListener &amp;&amp; NS_SUCCEEDED( rv)) {</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+  if (!m_pListener &amp;&amp; NS_SUCCEEDED( rv))</span>
<a href="#l15.55"></a><span id="l15.55">     rv = OutlookSendListener::CreateSendListener( &amp;m_pListener);</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-  }</span>
<a href="#l15.57"></a><span id="l15.57"> </span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; m_pMsgSend) {</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l15.60"></a><span id="l15.60">       rv = CallCreateInstance( kMsgCompFieldsCID, &amp;m_pMsgFields);</span>
<a href="#l15.61"></a><span id="l15.61">     if (NS_SUCCEEDED(rv) &amp;&amp; m_pMsgFields) {</span>
<a href="#l15.62"></a><span id="l15.62">       // IMPORT_LOG0( &quot;nsOutlookCompose - CreateComponents succeeded\n&quot;);</span>
<a href="#l15.63"></a><span id="l15.63">       m_pMsgFields-&gt;SetForcePlainText( PR_FALSE);</span>
<a href="#l15.64"></a><span id="l15.64">       return NS_OK;</span>
<a href="#l15.65"></a><span id="l15.65">     }</span>
<a href="#l15.66"></a><span id="l15.66">   }</span>
<a href="#l15.67"></a><span id="l15.67"> </span>
<a href="#l15.68"></a><span id="l15.68" class="difflineat">@@ -374,37 +358,29 @@ nsresult nsOutlookCompose::ComposeTheMes</span>
<a href="#l15.69"></a><span id="l15.69">   else {</span>
<a href="#l15.70"></a><span id="l15.70">     if (bodyW.IsEmpty())</span>
<a href="#l15.71"></a><span id="l15.71">       msg.GetBody(bodyA);</span>
<a href="#l15.72"></a><span id="l15.72">     else</span>
<a href="#l15.73"></a><span id="l15.73">       nsMsgI18NConvertFromUnicode(msg.GetBodyCharset(), bodyW, bodyA);</span>
<a href="#l15.74"></a><span id="l15.74">   }</span>
<a href="#l15.75"></a><span id="l15.75"> </span>
<a href="#l15.76"></a><span id="l15.76">   // IMPORT_LOG0( &quot;Outlook compose calling CreateAndSendMessage\n&quot;);</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-  rv = m_pSendProxy-&gt;CreateAndSendMessage(</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+  nsCOMPtr&lt;nsIImportService&gt; impService(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+  rv = impService-&gt;ProxySend(</span>
<a href="#l15.82"></a><span id="l15.82">                     pEditor,                      // editor shell</span>
<a href="#l15.83"></a><span id="l15.83">                     m_pIdentity,                  // dummy identity</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-                    nsnull,                       // account key</span>
<a href="#l15.85"></a><span id="l15.85">                     m_pMsgFields,                 // message fields</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-                    PR_FALSE,                     // digest = NO</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-                    PR_TRUE,                      // dont_deliver = YES, make a file</span>
<a href="#l15.88"></a><span id="l15.88">                     mode,                         // mode</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-                    nsnull,                       // no message to replace</span>
<a href="#l15.90"></a><span id="l15.90">                     msg.BodyIsHtml() ? &quot;text/html&quot; : &quot;text/plain&quot;,           // body type</span>
<a href="#l15.91"></a><span id="l15.91">                     bodyA.get(),                  // body pointer</span>
<a href="#l15.92"></a><span id="l15.92">                     bodyA.Length(),               // body length</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-                    nsnull,                       // remote attachment data</span>
<a href="#l15.94"></a><span id="l15.94">                     pAttach,                      // local attachments</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-                    nsnull,                       // related part</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-                    nsnull,                       // parent window</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-                    nsnull,                       // progress listener</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-                    m_pListener,                  // listener</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-                    nsnull,                       // password</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-                    EmptyCString(),               // originalMsgURI</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-                    nsnull);                      // message compose type</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+                    m_pListener);              // originalMsgURI</span>
<a href="#l15.103"></a><span id="l15.103">   // IMPORT_LOG0( &quot;Returned from CreateAndSendMessage\n&quot;);</span>
<a href="#l15.104"></a><span id="l15.104"> </span>
<a href="#l15.105"></a><span id="l15.105">   OutlookSendListener *pListen = (OutlookSendListener *)m_pListener;</span>
<a href="#l15.106"></a><span id="l15.106">   if (NS_FAILED(rv)) {</span>
<a href="#l15.107"></a><span id="l15.107">     IMPORT_LOG1( &quot;*** Error, CreateAndSendMessage FAILED: 0x%lx\n&quot;, rv);</span>
<a href="#l15.108"></a><span id="l15.108">   }</span>
<a href="#l15.109"></a><span id="l15.109">   else {</span>
<a href="#l15.110"></a><span id="l15.110">     // wait for the listener to get done!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookCompose.h</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookCompose.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -98,18 +98,16 @@ private:</span>
<a href="#l16.4"></a><span id="l16.4">     void operator () (const CidReplacePair* pair);</span>
<a href="#l16.5"></a><span id="l16.5">   private:</span>
<a href="#l16.6"></a><span id="l16.6">     nsCString&amp; m_line;</span>
<a href="#l16.7"></a><span id="l16.7">     bool m_finishedReplacing;</span>
<a href="#l16.8"></a><span id="l16.8">   };</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">   nsIMsgSendListener *  m_pListener;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  nsIMsgSend *      m_pMsgSend;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-  nsIMsgSend *      m_pSendProxy;</span>
<a href="#l16.14"></a><span id="l16.14">   nsIMsgCompFields *    m_pMsgFields;</span>
<a href="#l16.15"></a><span id="l16.15">   nsIMsgIdentity *    m_pIdentity;</span>
<a href="#l16.16"></a><span id="l16.16">   char* m_optimizationBuffer;</span>
<a href="#l16.17"></a><span id="l16.17">   unsigned int m_optimizationBufferSize;</span>
<a href="#l16.18"></a><span id="l16.18">   nsCOMPtr&lt;nsIImportService&gt;  m_pImportService;</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20">   // Bug 593907</span>
<a href="#l16.21"></a><span id="l16.21">   nsString m_hackedPostfix;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -383,39 +383,35 @@ void ImportOutlookMailImpl::AddLinebreak</span>
<a href="#l17.4"></a><span id="l17.4">     pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l17.5"></a><span id="l17.5"> }</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7"> void ImportOutlookMailImpl::ReportSuccess( nsString&amp; name, PRInt32 count, nsString *pStream)</span>
<a href="#l17.8"></a><span id="l17.8"> {</span>
<a href="#l17.9"></a><span id="l17.9">   if (!pStream)</span>
<a href="#l17.10"></a><span id="l17.10">     return;</span>
<a href="#l17.11"></a><span id="l17.11">   // load the success string</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  nsIStringBundle *pBundle = nsOutlookStringBundle::GetStringBundleProxy();</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_MAILBOX_SUCCESS, pBundle);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l17.15"></a><span id="l17.15">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get(), count);</span>
<a href="#l17.16"></a><span id="l17.16">   pStream-&gt;Append( pText);</span>
<a href="#l17.17"></a><span id="l17.17">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l17.18"></a><span id="l17.18">   nsOutlookStringBundle::FreeString( pFmt);</span>
<a href="#l17.19"></a><span id="l17.19">   AddLinebreak( pStream);</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l17.21"></a><span id="l17.21"> }</span>
<a href="#l17.22"></a><span id="l17.22"> </span>
<a href="#l17.23"></a><span id="l17.23"> void ImportOutlookMailImpl::ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l17.24"></a><span id="l17.24"> {</span>
<a href="#l17.25"></a><span id="l17.25">   if (!pStream)</span>
<a href="#l17.26"></a><span id="l17.26">     return;</span>
<a href="#l17.27"></a><span id="l17.27">   // load the error string</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-  nsIStringBundle *pBundle = nsOutlookStringBundle::GetStringBundleProxy();</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID( errorNum);</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID(errorNum);</span>
<a href="#l17.31"></a><span id="l17.31">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l17.32"></a><span id="l17.32">   pStream-&gt;Append( pText);</span>
<a href="#l17.33"></a><span id="l17.33">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l17.34"></a><span id="l17.34">   nsOutlookStringBundle::FreeString( pFmt);</span>
<a href="#l17.35"></a><span id="l17.35">   AddLinebreak( pStream);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l17.37"></a><span id="l17.37"> }</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40"> void ImportOutlookMailImpl::SetLogs( nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l17.41"></a><span id="l17.41"> {</span>
<a href="#l17.42"></a><span id="l17.42">   if (pError)</span>
<a href="#l17.43"></a><span id="l17.43">     *pError = ToNewUnicode(error);</span>
<a href="#l17.44"></a><span id="l17.44">   if (pSuccess)</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineat">@@ -427,22 +423,20 @@ NS_IMETHODIMP ImportOutlookMailImpl::Imp</span>
<a href="#l17.46"></a><span id="l17.46">                         PRUnichar **pErrorLog,</span>
<a href="#l17.47"></a><span id="l17.47">                         PRUnichar **pSuccessLog,</span>
<a href="#l17.48"></a><span id="l17.48">                         PRBool *fatalError)</span>
<a href="#l17.49"></a><span id="l17.49"> {</span>
<a href="#l17.50"></a><span id="l17.50">   NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l17.51"></a><span id="l17.51">   NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l17.52"></a><span id="l17.52">   NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l17.53"></a><span id="l17.53"> </span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt;  bundle( dont_AddRef( nsOutlookStringBundle::GetStringBundleProxy()));</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-</span>
<a href="#l17.56"></a><span id="l17.56">   nsString  success;</span>
<a href="#l17.57"></a><span id="l17.57">   nsString  error;</span>
<a href="#l17.58"></a><span id="l17.58">   if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-    nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_MAILBOX_BADPARAM, error, bundle);</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+    nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_MAILBOX_BADPARAM, error);</span>
<a href="#l17.61"></a><span id="l17.61">     if (fatalError)</span>
<a href="#l17.62"></a><span id="l17.62">       *fatalError = PR_TRUE;</span>
<a href="#l17.63"></a><span id="l17.63">     SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l17.64"></a><span id="l17.64">       return NS_ERROR_NULL_POINTER;</span>
<a href="#l17.65"></a><span id="l17.65">   }</span>
<a href="#l17.66"></a><span id="l17.66"> </span>
<a href="#l17.67"></a><span id="l17.67">     PRBool    abort = PR_FALSE;</span>
<a href="#l17.68"></a><span id="l17.68">     nsString  name;</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineat">@@ -561,23 +555,21 @@ NS_IMETHODIMP ImportOutlookAddressImpl::</span>
<a href="#l17.70"></a><span id="l17.70">                                                           PRBool *fatalError)</span>
<a href="#l17.71"></a><span id="l17.71"> {</span>
<a href="#l17.72"></a><span id="l17.72">   m_msgCount = 0;</span>
<a href="#l17.73"></a><span id="l17.73">   m_msgTotal = 0;</span>
<a href="#l17.74"></a><span id="l17.74">     NS_PRECONDITION(source != nsnull, &quot;null ptr&quot;);</span>
<a href="#l17.75"></a><span id="l17.75">     NS_PRECONDITION(destination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l17.76"></a><span id="l17.76">   NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l17.77"></a><span id="l17.77"> </span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle( dont_AddRef( nsOutlookStringBundle::GetStringBundleProxy()));</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-</span>
<a href="#l17.80"></a><span id="l17.80">   nsString  success;</span>
<a href="#l17.81"></a><span id="l17.81">   nsString  error;</span>
<a href="#l17.82"></a><span id="l17.82">     if (!source || !destination || !fatalError) {</span>
<a href="#l17.83"></a><span id="l17.83">     IMPORT_LOG0( &quot;*** Bad param passed to outlook address import\n&quot;);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-    nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_ADDRESS_BADPARAM, error, bundle);</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+    nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_ADDRESS_BADPARAM, error);</span>
<a href="#l17.86"></a><span id="l17.86">     if (fatalError)</span>
<a href="#l17.87"></a><span id="l17.87">       *fatalError = PR_TRUE;</span>
<a href="#l17.88"></a><span id="l17.88">     ImportOutlookMailImpl::SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l17.89"></a><span id="l17.89">       return NS_ERROR_NULL_POINTER;</span>
<a href="#l17.90"></a><span id="l17.90">   }</span>
<a href="#l17.91"></a><span id="l17.91"> </span>
<a href="#l17.92"></a><span id="l17.92">     nsString name;</span>
<a href="#l17.93"></a><span id="l17.93">     source-&gt;GetPreferredName(name);</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineat">@@ -624,17 +616,15 @@ NS_IMETHODIMP ImportOutlookAddressImpl::</span>
<a href="#l17.95"></a><span id="l17.95">   return( NS_OK);</span>
<a href="#l17.96"></a><span id="l17.96"> }</span>
<a href="#l17.97"></a><span id="l17.97"> </span>
<a href="#l17.98"></a><span id="l17.98"> void ImportOutlookAddressImpl::ReportSuccess( nsString&amp; name, nsString *pStream)</span>
<a href="#l17.99"></a><span id="l17.99"> {</span>
<a href="#l17.100"></a><span id="l17.100">   if (!pStream)</span>
<a href="#l17.101"></a><span id="l17.101">     return;</span>
<a href="#l17.102"></a><span id="l17.102">   // load the success string</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-  nsIStringBundle *pBundle = nsOutlookStringBundle::GetStringBundleProxy();</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID( OUTLOOKIMPORT_ADDRESS_SUCCESS, pBundle);</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+  PRUnichar *pFmt = nsOutlookStringBundle::GetStringByID(OUTLOOKIMPORT_ADDRESS_SUCCESS);</span>
<a href="#l17.106"></a><span id="l17.106">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l17.107"></a><span id="l17.107">   pStream-&gt;Append( pText);</span>
<a href="#l17.108"></a><span id="l17.108">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l17.109"></a><span id="l17.109">   nsOutlookStringBundle::FreeString( pFmt);</span>
<a href="#l17.110"></a><span id="l17.110">   ImportOutlookMailImpl::AddLinebreak( pStream);</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l17.112"></a><span id="l17.112"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookStringBundle.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookStringBundle.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -46,17 +46,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> #define OUTLOOK_MSGS_URL       &quot;chrome://messenger/locale/outlookImportMsgs.properties&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> nsIStringBundle *  nsOutlookStringBundle::m_pBundle = nsnull;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> nsIStringBundle *nsOutlookStringBundle::GetStringBundle( void)</span>
<a href="#l18.10"></a><span id="l18.10"> {</span>
<a href="#l18.11"></a><span id="l18.11">   if (m_pBundle)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    return( m_pBundle);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    return m_pBundle;</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   nsresult      rv;</span>
<a href="#l18.16"></a><span id="l18.16">   char*        propertyURL = OUTLOOK_MSGS_URL;</span>
<a href="#l18.17"></a><span id="l18.17">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l18.21"></a><span id="l18.21">            do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -64,49 +64,34 @@ nsIStringBundle *nsOutlookStringBundle::</span>
<a href="#l18.23"></a><span id="l18.23">     rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l18.24"></a><span id="l18.24">   }</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26">   m_pBundle = sBundle;</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">   return( sBundle);</span>
<a href="#l18.29"></a><span id="l18.29"> }</span>
<a href="#l18.30"></a><span id="l18.30"> </span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-nsIStringBundle *nsOutlookStringBundle::GetStringBundleProxy( void)</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+void nsOutlookStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span>
<a href="#l18.33"></a><span id="l18.33"> {</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-  if (!m_pBundle)</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">-    return( nsnull);</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-  nsIStringBundle *strProxy = nsnull;</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-  // create a proxy object if we aren't on the same thread?</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-  NS_GetProxyForObject( NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-                       m_pBundle, NS_PROXY_SYNC | NS_PROXY_ALWAYS, (void **) &amp;strProxy);</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-  return( strProxy);</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-}</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-void nsOutlookStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle)</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-{</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-  PRUnichar *ptrv = GetStringByID( stringID, pBundle);</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l18.50"></a><span id="l18.50">   result = ptrv;</span>
<a href="#l18.51"></a><span id="l18.51">   FreeString( ptrv);</span>
<a href="#l18.52"></a><span id="l18.52"> }</span>
<a href="#l18.53"></a><span id="l18.53"> </span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-PRUnichar *nsOutlookStringBundle::GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle)</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+PRUnichar *nsOutlookStringBundle::GetStringByID(PRInt32 stringID)</span>
<a href="#l18.56"></a><span id="l18.56"> {</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-  if (!pBundle) {</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineminus">-    pBundle = GetStringBundle();</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-  }</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+  if (m_pBundle)</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+    m_pBundle = GetStringBundle();</span>
<a href="#l18.62"></a><span id="l18.62"> </span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-  if (pBundle) {</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineplus">+  if (m_pBundle) {</span>
<a href="#l18.65"></a><span id="l18.65">     PRUnichar *ptrv = nsnull;</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-    nsresult rv = pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineplus">+    nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l18.68"></a><span id="l18.68"> </span>
<a href="#l18.69"></a><span id="l18.69">     if (NS_SUCCEEDED( rv) &amp;&amp; ptrv)</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-      return( ptrv);</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineplus">+      return ptrv;</span>
<a href="#l18.72"></a><span id="l18.72">   }</span>
<a href="#l18.73"></a><span id="l18.73"> </span>
<a href="#l18.74"></a><span id="l18.74">   nsString resultString;</span>
<a href="#l18.75"></a><span id="l18.75">   resultString.AppendLiteral(&quot;[StringID &quot;);</span>
<a href="#l18.76"></a><span id="l18.76">   resultString.AppendInt(stringID);</span>
<a href="#l18.77"></a><span id="l18.77">   resultString.AppendLiteral(&quot;?]&quot;);</span>
<a href="#l18.78"></a><span id="l18.78"> </span>
<a href="#l18.79"></a><span id="l18.79">   return ToNewUnicode(resultString);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookStringBundle.h</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookStringBundle.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -39,23 +39,22 @@</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l19.6"></a><span id="l19.6"> #include &quot;nsString.h&quot;</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> class nsIStringBundle;</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10"> class nsOutlookStringBundle {</span>
<a href="#l19.11"></a><span id="l19.11"> public:</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  static PRUnichar     * GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-  static void GetStringByID(PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+  static PRUnichar     * GetStringByID(PRInt32 stringID);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+  static void GetStringByID(PRInt32 stringID, nsString&amp; result);</span>
<a href="#l19.16"></a><span id="l19.16">   static nsIStringBundle * GetStringBundle( void); // don't release</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-  static nsIStringBundle * GetStringBundleProxy( void); // release</span>
<a href="#l19.18"></a><span id="l19.18">   static void FreeString( PRUnichar *pStr) { NS_Free( pStr);}</span>
<a href="#l19.19"></a><span id="l19.19">   static void Cleanup( void);</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-  private:</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+private:</span>
<a href="#l19.22"></a><span id="l19.22">   static nsIStringBundle * m_pBundle;</span>
<a href="#l19.23"></a><span id="l19.23"> };</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27"> #define OUTLOOKIMPORT_NAME                     2000</span>
<a href="#l19.28"></a><span id="l19.28"> #define OUTLOOKIMPORT_DESCRIPTION              2010</span>
<a href="#l19.29"></a><span id="l19.29"> #define OUTLOOKIMPORT_MAILBOX_SUCCESS          2002</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/import/public/nsIImportService.idl</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/import/public/nsIImportService.idl</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -37,40 +37,53 @@</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> /*</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7">   The import service.</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">  */</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+#include &quot;nsIMsgSend.idl&quot;</span>
<a href="#l20.13"></a><span id="l20.13"> </span>
<a href="#l20.14"></a><span id="l20.14"> interface nsIImportModule;</span>
<a href="#l20.15"></a><span id="l20.15"> interface nsIImportMailboxDescriptor;</span>
<a href="#l20.16"></a><span id="l20.16"> interface nsIImportABDescriptor;</span>
<a href="#l20.17"></a><span id="l20.17"> interface nsIImportGeneric;</span>
<a href="#l20.18"></a><span id="l20.18"> interface nsIImportFieldMap;</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+interface nsIMsgSendListener;</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+interface nsIMsgCompFields;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+interface nsIMsgSendListener;</span>
<a href="#l20.22"></a><span id="l20.22"> </span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-[scriptable, uuid(c035e4a5-6dcc-4c70-8ff7-5b740bd2ed2b)]</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+[scriptable, uuid(55a52e05-8ce7-4e23-8a2f-a9226b01bcfb)]</span>
<a href="#l20.25"></a><span id="l20.25"> interface nsIImportService : nsISupports</span>
<a href="#l20.26"></a><span id="l20.26"> {</span>
<a href="#l20.27"></a><span id="l20.27">     void DiscoverModules();</span>
<a href="#l20.28"></a><span id="l20.28"> </span>
<a href="#l20.29"></a><span id="l20.29">   long GetModuleCount( in string filter);</span>
<a href="#l20.30"></a><span id="l20.30">   void GetModuleInfo( in string filter, in long index, out wstring name, out wstring description);</span>
<a href="#l20.31"></a><span id="l20.31">   wstring GetModuleName( in string filter, in long index);</span>
<a href="#l20.32"></a><span id="l20.32">   wstring GetModuleDescription( in string filter, in long index);</span>
<a href="#l20.33"></a><span id="l20.33">   nsIImportModule  GetModule( in string filter, in long index);</span>
<a href="#l20.34"></a><span id="l20.34">   nsIImportModule GetModuleWithCID( in nsCIDRef cid);</span>
<a href="#l20.35"></a><span id="l20.35"> </span>
<a href="#l20.36"></a><span id="l20.36">   nsIImportFieldMap      CreateNewFieldMap();</span>
<a href="#l20.37"></a><span id="l20.37">   nsIImportMailboxDescriptor  CreateNewMailboxDescriptor();</span>
<a href="#l20.38"></a><span id="l20.38">   nsIImportABDescriptor    CreateNewABDescriptor();</span>
<a href="#l20.39"></a><span id="l20.39">   nsIImportGeneric      CreateNewGenericMail();</span>
<a href="#l20.40"></a><span id="l20.40">   nsIImportGeneric      CreateNewGenericAddressBooks();</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+  [noscript] void ProxySend(in nsIEditor aEditor, in nsIMsgIdentity aIdentity,</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+                            in nsIMsgCompFields aMsgFields,</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineplus">+                            in nsMsgDeliverMode aDeliverMode,</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+                            in string attachment1_type,</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+                            in string attachment1_body,</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+                            in PRUint32 attachment1_body_length,</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+                            [const] in nsMsgAttachedFile loaded_attachments,</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+                            in nsIMsgSendListener aListener);</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+</span>
<a href="#l20.50"></a><span id="l20.50"> };</span>
<a href="#l20.51"></a><span id="l20.51"> </span>
<a href="#l20.52"></a><span id="l20.52"> %{ C++</span>
<a href="#l20.53"></a><span id="l20.53"> #define NS_IMPORTSERVICE_CID              \</span>
<a href="#l20.54"></a><span id="l20.54"> { /* 5df96d60-1726-11d3-a206-00a0cc26da63 */      \</span>
<a href="#l20.55"></a><span id="l20.55">    0x5df96d60, 0x1726, 0x11d3,                   \</span>
<a href="#l20.56"></a><span id="l20.56">    {0xa2, 0x06, 0x0, 0xa0, 0xcc, 0x26, 0xda, 0x63}}</span>
<a href="#l20.57"></a><span id="l20.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/import/src/nsImportFieldMap.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/import/src/nsImportFieldMap.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -71,18 +71,17 @@ nsImportFieldMap::nsImportFieldMap(nsISt</span>
<a href="#l21.4"></a><span id="l21.4"> {</span>
<a href="#l21.5"></a><span id="l21.5">   m_numFields = 0;</span>
<a href="#l21.6"></a><span id="l21.6">   m_pFields = nsnull;</span>
<a href="#l21.7"></a><span id="l21.7">   m_pActive = nsnull;</span>
<a href="#l21.8"></a><span id="l21.8">   m_allocated = 0;</span>
<a href="#l21.9"></a><span id="l21.9">   // need to init the description array</span>
<a href="#l21.10"></a><span id="l21.10">   m_mozFieldCount = 0;</span>
<a href="#l21.11"></a><span id="l21.11">     m_skipFirstRecord = false;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; pBundle;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-  nsImportStringBundle::GetStringBundleProxy(aBundle, getter_AddRefs(pBundle));</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  nsCOMPtr&lt;nsIStringBundle&gt; pBundle = aBundle;</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16">   nsString *pStr;</span>
<a href="#l21.17"></a><span id="l21.17">   for (PRInt32 i = IMPORT_FIELD_DESC_START; i &lt;= IMPORT_FIELD_DESC_END; i++, m_mozFieldCount++) {</span>
<a href="#l21.18"></a><span id="l21.18">     pStr = new nsString();</span>
<a href="#l21.19"></a><span id="l21.19">     if (pBundle) {</span>
<a href="#l21.20"></a><span id="l21.20">       nsImportStringBundle::GetStringByID(i, pBundle, *pStr);</span>
<a href="#l21.21"></a><span id="l21.21">     }</span>
<a href="#l21.22"></a><span id="l21.22">     else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -753,24 +753,16 @@ ImportMailThread( void *stuff)</span>
<a href="#l22.4"></a><span id="l22.4">   nsCOMPtr&lt;nsIMsgFolder&gt;          subFolder;</span>
<a href="#l22.5"></a><span id="l22.5">   nsCOMPtr&lt;nsISimpleEnumerator&gt;   enumerator;</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">   PRBool            exists;</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9">   nsString  success;</span>
<a href="#l22.10"></a><span id="l22.10">   nsString  error;</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; pBundle;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-  rv = nsImportStringBundle::GetStringBundleProxy(pData-&gt;stringBundle, getter_AddRefs(pBundle));</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-  {</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-    IMPORT_LOG0(&quot;*** ImportMailThread: Unable to obtain proxy string service for the import.&quot;);</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-    pData-&gt;abort = PR_TRUE;</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-  }</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-</span>
<a href="#l22.20"></a><span id="l22.20">   // Initialize the curFolder proxy object</span>
<a href="#l22.21"></a><span id="l22.21">   nsCOMPtr&lt;nsIProxyObjectManager&gt; proxyObjMgr =</span>
<a href="#l22.22"></a><span id="l22.22">     do_GetService(NS_XPCOMPROXY_CONTRACTID, &amp;rv);</span>
<a href="#l22.23"></a><span id="l22.23">   if (NS_FAILED(rv))</span>
<a href="#l22.24"></a><span id="l22.24">   {</span>
<a href="#l22.25"></a><span id="l22.25">     IMPORT_LOG0(&quot;*** ImportMailThread: Unable to obtain proxy object manager for the import.&quot;);</span>
<a href="#l22.26"></a><span id="l22.26">     pData-&gt;abort = PR_TRUE;</span>
<a href="#l22.27"></a><span id="l22.27">   }</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineat">@@ -808,60 +800,64 @@ ImportMailThread( void *stuff)</span>
<a href="#l22.29"></a><span id="l22.29">       rv = box-&gt;GetDepth( &amp;newDepth);</span>
<a href="#l22.30"></a><span id="l22.30">       if (newDepth &gt; depth) {</span>
<a href="#l22.31"></a><span id="l22.31">           // OK, we are going to add a subfolder under the last/previous folder we processed, so</span>
<a href="#l22.32"></a><span id="l22.32">           // find this folder (stored in 'lastName') who is going to be the new parent folder.</span>
<a href="#l22.33"></a><span id="l22.33">         IMPORT_LOG1(&quot;ImportMailThread: Processing child folder '%s'.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l22.34"></a><span id="l22.34">         rv = curProxy-&gt;GetChildNamed( lastName, getter_AddRefs( subFolder));</span>
<a href="#l22.35"></a><span id="l22.35">         if (NS_FAILED( rv)) {</span>
<a href="#l22.36"></a><span id="l22.36">           IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the interface for child folder '%s'.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">-          nsImportGenericMail::ReportError(IMPORT_ERROR_MB_FINDCHILD, lastName.get(), &amp;error, pBundle);</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+          nsImportGenericMail::ReportError(IMPORT_ERROR_MB_FINDCHILD,</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+                                           lastName.get(),</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+                                           &amp;error, pData-&gt;stringBundle);</span>
<a href="#l22.41"></a><span id="l22.41">           pData-&gt;fatalError = PR_TRUE;</span>
<a href="#l22.42"></a><span id="l22.42">           break;</span>
<a href="#l22.43"></a><span id="l22.43">         }</span>
<a href="#l22.44"></a><span id="l22.44"> </span>
<a href="#l22.45"></a><span id="l22.45">         rv = proxyObjMgr-&gt;GetProxyForObject(NS_PROXY_TO_MAIN_THREAD,</span>
<a href="#l22.46"></a><span id="l22.46">                                             NS_GET_IID(nsIMsgFolder),</span>
<a href="#l22.47"></a><span id="l22.47">                                             subFolder,</span>
<a href="#l22.48"></a><span id="l22.48">                                             NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l22.49"></a><span id="l22.49">                                             getter_AddRefs(curProxy));</span>
<a href="#l22.50"></a><span id="l22.50">         if (NS_FAILED( rv)) {</span>
<a href="#l22.51"></a><span id="l22.51">           IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the proxy interface for child folder '%s'.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-          nsImportStringBundle::GetStringByID(IMPORT_ERROR_MB_NOPROXY, pBundle,</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-                                               error);</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+          nsImportStringBundle::GetStringByID(IMPORT_ERROR_MB_NOPROXY, pData-&gt;stringBundle,</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineplus">+                                              error);</span>
<a href="#l22.56"></a><span id="l22.56">           pData-&gt;fatalError = PR_TRUE;</span>
<a href="#l22.57"></a><span id="l22.57">           break;</span>
<a href="#l22.58"></a><span id="l22.58">         }</span>
<a href="#l22.59"></a><span id="l22.59"> </span>
<a href="#l22.60"></a><span id="l22.60">         // Make sure this new parent folder obj has the correct subfolder list so far.</span>
<a href="#l22.61"></a><span id="l22.61">         rv = curProxy-&gt;GetSubFolders(getter_AddRefs(enumerator));</span>
<a href="#l22.62"></a><span id="l22.62">       }</span>
<a href="#l22.63"></a><span id="l22.63">       else if (newDepth &lt; depth) {</span>
<a href="#l22.64"></a><span id="l22.64">         rv = NS_OK;</span>
<a href="#l22.65"></a><span id="l22.65">         while ((newDepth &lt; depth) &amp;&amp; NS_SUCCEEDED( rv)) {</span>
<a href="#l22.66"></a><span id="l22.66">           nsCOMPtr&lt;nsIMsgFolder&gt; parFolder;</span>
<a href="#l22.67"></a><span id="l22.67">           rv = curProxy-&gt;GetParent( getter_AddRefs( parFolder));</span>
<a href="#l22.68"></a><span id="l22.68">           if (NS_FAILED( rv)) {</span>
<a href="#l22.69"></a><span id="l22.69">             IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the interface for parent folder '%s'.&quot;, lastName.get());</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-            nsImportGenericMail::ReportError(IMPORT_ERROR_MB_FINDCHILD, lastName.get(), &amp;error, pBundle);</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+            nsImportGenericMail::ReportError(IMPORT_ERROR_MB_FINDCHILD,</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineplus">+                                             lastName.get(), &amp;error,</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+                                             pData-&gt;stringBundle);</span>
<a href="#l22.74"></a><span id="l22.74">             pData-&gt;fatalError = PR_TRUE;</span>
<a href="#l22.75"></a><span id="l22.75">             break;</span>
<a href="#l22.76"></a><span id="l22.76">           }</span>
<a href="#l22.77"></a><span id="l22.77"> </span>
<a href="#l22.78"></a><span id="l22.78">           rv = proxyObjMgr-&gt;GetProxyForObject(NS_PROXY_TO_MAIN_THREAD,</span>
<a href="#l22.79"></a><span id="l22.79">                                               NS_GET_IID(nsIMsgFolder),</span>
<a href="#l22.80"></a><span id="l22.80">                                               parFolder,</span>
<a href="#l22.81"></a><span id="l22.81">                                               NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l22.82"></a><span id="l22.82">                                               getter_AddRefs(curProxy));</span>
<a href="#l22.83"></a><span id="l22.83">           depth--;</span>
<a href="#l22.84"></a><span id="l22.84">         }</span>
<a href="#l22.85"></a><span id="l22.85">         if (NS_FAILED( rv)) {</span>
<a href="#l22.86"></a><span id="l22.86">           IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the proxy interface for parent folder '%s'.&quot;, lastName.get());</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineminus">-          nsImportStringBundle::GetStringByID(IMPORT_ERROR_MB_NOPROXY, pBundle,</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-                                              error);</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+          nsImportStringBundle::GetStringByID(IMPORT_ERROR_MB_NOPROXY,</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+                                              pData-&gt;stringBundle, error);</span>
<a href="#l22.91"></a><span id="l22.91">           pData-&gt;fatalError = PR_TRUE;</span>
<a href="#l22.92"></a><span id="l22.92">           break;</span>
<a href="#l22.93"></a><span id="l22.93">         }</span>
<a href="#l22.94"></a><span id="l22.94">       }</span>
<a href="#l22.95"></a><span id="l22.95">       depth = newDepth;</span>
<a href="#l22.96"></a><span id="l22.96">       pName = nsnull;</span>
<a href="#l22.97"></a><span id="l22.97">       box-&gt;GetDisplayName( &amp;pName);</span>
<a href="#l22.98"></a><span id="l22.98">       if (pName) {</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineat">@@ -895,17 +891,18 @@ ImportMailThread( void *stuff)</span>
<a href="#l22.100"></a><span id="l22.100"> </span>
<a href="#l22.101"></a><span id="l22.101">       rv = curProxy-&gt;GetChildNamed(lastName, getter_AddRefs(newFolder));</span>
<a href="#l22.102"></a><span id="l22.102">       if (NS_SUCCEEDED(rv))</span>
<a href="#l22.103"></a><span id="l22.103">         newFolder-&gt;GetFilePath(getter_AddRefs(outBox));</span>
<a href="#l22.104"></a><span id="l22.104">       else</span>
<a href="#l22.105"></a><span id="l22.105">         IMPORT_LOG1(&quot;*** ImportMailThread: Failed to locate subfolder '%s' after it's been created.&quot;, lastName.get());</span>
<a href="#l22.106"></a><span id="l22.106"> </span>
<a href="#l22.107"></a><span id="l22.107">       if (NS_FAILED( rv)) {</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineminus">-        nsImportGenericMail::ReportError(IMPORT_ERROR_MB_CREATE, lastName.get(), &amp;error, pBundle);</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineplus">+        nsImportGenericMail::ReportError(IMPORT_ERROR_MB_CREATE, lastName.get(),</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineplus">+                                         &amp;error, pData-&gt;stringBundle);</span>
<a href="#l22.111"></a><span id="l22.111">       }</span>
<a href="#l22.112"></a><span id="l22.112"> </span>
<a href="#l22.113"></a><span id="l22.113">       if (size &amp;&amp; import &amp;&amp; newFolder &amp;&amp; outBox &amp;&amp; NS_SUCCEEDED( rv)) {</span>
<a href="#l22.114"></a><span id="l22.114">         PRBool fatalError = PR_FALSE;</span>
<a href="#l22.115"></a><span id="l22.115">         pData-&gt;currentSize = size;</span>
<a href="#l22.116"></a><span id="l22.116">         PRUnichar *pSuccess = nsnull;</span>
<a href="#l22.117"></a><span id="l22.117">         PRUnichar *pError = nsnull;</span>
<a href="#l22.118"></a><span id="l22.118">         rv = pData-&gt;mailImport-&gt;ImportMailbox( box, outBox, &amp;pError, &amp;pSuccess, &amp;fatalError);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/import/src/nsImportService.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/import/src/nsImportService.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -57,16 +57,19 @@</span>
<a href="#l23.4"></a><span id="l23.4"> #include &quot;nsImportABDescriptor.h&quot;</span>
<a href="#l23.5"></a><span id="l23.5"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l23.6"></a><span id="l23.6"> #include &quot;nsImportFieldMap.h&quot;</span>
<a href="#l23.7"></a><span id="l23.7"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l23.8"></a><span id="l23.8"> #include &quot;nsXPCOM.h&quot;</span>
<a href="#l23.9"></a><span id="l23.9"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l23.10"></a><span id="l23.10"> #include &quot;plstr.h&quot;</span>
<a href="#l23.11"></a><span id="l23.11"> #include &quot;prmem.h&quot;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+#include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+#include &quot;nsThreadUtils.h&quot;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+#include &quot;nsIEditor.h&quot;</span>
<a href="#l23.15"></a><span id="l23.15"> #include &quot;ImportDebug.h&quot;</span>
<a href="#l23.16"></a><span id="l23.16"> #include &quot;nsImportService.h&quot;</span>
<a href="#l23.17"></a><span id="l23.17"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l23.18"></a><span id="l23.18"> #include &quot;nsCRTGlue.h&quot;</span>
<a href="#l23.19"></a><span id="l23.19"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l23.20"></a><span id="l23.20"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22"> PRLogModuleInfo *IMPORTLOGMODULE = nsnull;</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineat">@@ -308,17 +311,92 @@ NS_IMETHODIMP nsImportService::GetModule</span>
<a href="#l23.24"></a><span id="l23.24">       else</span>
<a href="#l23.25"></a><span id="l23.25">         count++;</span>
<a href="#l23.26"></a><span id="l23.26">     }</span>
<a href="#l23.27"></a><span id="l23.27">   }</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29">   return( NS_ERROR_FAILURE);</span>
<a href="#l23.30"></a><span id="l23.30"> }</span>
<a href="#l23.31"></a><span id="l23.31"> </span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+class nsProxySendRunnable : public nsRunnable</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+{</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+public:</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+  nsProxySendRunnable(nsIEditor *aEditor, nsIMsgIdentity *aIdentity,</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+                       nsIMsgCompFields *aMsgFields,</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+                       nsMsgDeliverMode aDeliverMode,</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineplus">+                       const char *attachment1_type,</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineplus">+                       const char *attachment1_body,</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+                       PRUint32 attachment1_body_length,</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+                       const nsMsgAttachedFile *loaded_attachments,</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+                       nsIMsgSendListener *aListener);</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+  NS_DECL_NSIRUNNABLE</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+private:</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+  nsCOMPtr&lt;nsIEditor&gt; m_editor;</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+  nsCOMPtr&lt;nsIMsgIdentity&gt; m_identity;</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineplus">+  nsCOMPtr&lt;nsIMsgCompFields&gt; m_compFields;</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+  nsMsgDeliverMode m_deliverMode;</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+  nsCString m_bodyType;</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+  nsCString m_body;</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+  PRUint32 m_bodyLength;</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+  const nsMsgAttachedFile *m_loadedAttachments;</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSendListener&gt; m_listener;</span>
<a href="#l23.54"></a><span id="l23.54"> </span>
<a href="#l23.55"></a><span id="l23.55" class="difflineplus">+};</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineplus">+</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineplus">+nsProxySendRunnable::nsProxySendRunnable(nsIEditor *aEditor, nsIMsgIdentity *aIdentity,</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineplus">+                                         nsIMsgCompFields *aMsgFields,</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineplus">+                                         nsMsgDeliverMode aDeliverMode,</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineplus">+                                         const char *aBodyType,</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineplus">+                                         const char *aBody,</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+                                         PRUint32 aBodyLength,</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineplus">+                                         const nsMsgAttachedFile *aLoadedAttachments,</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineplus">+                                         nsIMsgSendListener *aListener) :</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineplus">+  m_editor(aEditor), m_identity(aIdentity), m_compFields(aMsgFields),</span>
<a href="#l23.66"></a><span id="l23.66" class="difflineplus">+  m_deliverMode(aDeliverMode), m_bodyType(aBodyType),</span>
<a href="#l23.67"></a><span id="l23.67" class="difflineplus">+  m_body(aBody), m_bodyLength(aBodyLength), m_loadedAttachments(aLoadedAttachments),</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineplus">+  m_listener(aListener)</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineplus">+{</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineplus">+}</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineplus">+</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineplus">+NS_IMETHODIMP nsProxySendRunnable::Run()</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineplus">+{</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineplus">+  nsresult rv;</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSend&gt; msgSend = do_CreateInstance(NS_MSGSEND_CONTRACTID, &amp;rv);</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineplus">+  return msgSend-&gt;CreateAndSendMessage(m_editor, m_identity, nsnull, m_compFields,</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineplus">+                                       PR_FALSE, PR_TRUE, </span>
<a href="#l23.80"></a><span id="l23.80" class="difflineplus">+                                       m_deliverMode, nsnull, m_bodyType.get(), m_body.get(),</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineplus">+                                       m_bodyLength, nsnull, m_loadedAttachments,</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineplus">+                                       nsnull, nsnull, nsnull, m_listener, nsnull,</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineplus">+                                       EmptyCString(), nsnull);</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineplus">+}</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineplus">+</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineplus">+</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineplus">+NS_IMETHODIMP nsImportService::ProxySend(nsIEditor *aEditor, nsIMsgIdentity *aIdentity,</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineplus">+                                         nsIMsgCompFields *aMsgFields,</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineplus">+                                         nsMsgDeliverMode aDeliverMode,</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineplus">+                                         const char *attachment1_type,</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineplus">+                                         const char *attachment1_body,</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineplus">+                                         PRUint32 attachment1_body_length,</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+                                         const nsMsgAttachedFile *loaded_attachments,</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineplus">+                                         nsIMsgSendListener *aListener)</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineplus">+{</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineplus">+    nsRefPtr&lt;nsProxySendRunnable&gt; runnable =</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineplus">+      new nsProxySendRunnable(aEditor, aIdentity,</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineplus">+                                       aMsgFields,</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineplus">+                                       aDeliverMode,</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineplus">+                                       attachment1_type,</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineplus">+                                       attachment1_body,</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineplus">+                                       attachment1_body_length,</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineplus">+                                       loaded_attachments,</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineplus">+                                       aListener);</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineplus">+    // invoke the callback</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineplus">+    return NS_DispatchToMainThread(runnable);</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineplus">+}</span>
<a href="#l23.108"></a><span id="l23.108"> </span>
<a href="#l23.109"></a><span id="l23.109"> NS_IMETHODIMP nsImportService::GetModule( const char *filter, PRInt32 index, nsIImportModule **_retval)</span>
<a href="#l23.110"></a><span id="l23.110"> {</span>
<a href="#l23.111"></a><span id="l23.111">     NS_PRECONDITION(_retval != nsnull, &quot;null ptr&quot;);</span>
<a href="#l23.112"></a><span id="l23.112">     if (!_retval)</span>
<a href="#l23.113"></a><span id="l23.113">         return NS_ERROR_NULL_POINTER;</span>
<a href="#l23.114"></a><span id="l23.114">   *_retval = nsnull;</span>
<a href="#l23.115"></a><span id="l23.115"> </span>
<a href="#l23.116"></a><span id="l23.116" class="difflineat">@@ -526,8 +604,9 @@ void nsImportModuleList::AddModule( cons</span>
<a href="#l23.117"></a><span id="l23.117">   m_pList[m_count]-&gt;SetName( pName);</span>
<a href="#l23.118"></a><span id="l23.118">   m_pList[m_count]-&gt;SetDescription( pDesc);</span>
<a href="#l23.119"></a><span id="l23.119"> </span>
<a href="#l23.120"></a><span id="l23.120">   m_count++;</span>
<a href="#l23.121"></a><span id="l23.121"> #ifdef IMPORT_DEBUG</span>
<a href="#l23.122"></a><span id="l23.122">   IMPORT_LOG3( &quot;* nsImportService registered import module: %s, %s, %s\n&quot;, NS_LossyConvertUTF16toASCII(pName).get(), NS_LossyConvertUTF16toASCII(pDesc).get(), pSupports);</span>
<a href="#l23.123"></a><span id="l23.123"> #endif</span>
<a href="#l23.124"></a><span id="l23.124"> }</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/import/src/nsImportStringBundle.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/import/src/nsImportStringBundle.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -39,48 +39,31 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l24.8"></a><span id="l24.8"> #include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;nsIURI.h&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-#include &quot;nsXPCOMCIDInternal.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13"> </span>
<a href="#l24.14"></a><span id="l24.14"> nsresult nsImportStringBundle::GetStringBundle(const char *aPropertyURL,</span>
<a href="#l24.15"></a><span id="l24.15">                                                nsIStringBundle **aBundle)</span>
<a href="#l24.16"></a><span id="l24.16"> {</span>
<a href="#l24.17"></a><span id="l24.17">   nsresult rv;</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l24.20"></a><span id="l24.20">            do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l24.21"></a><span id="l24.21">   if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l24.22"></a><span id="l24.22">     rv = sBundleService-&gt;CreateBundle(aPropertyURL, aBundle);</span>
<a href="#l24.23"></a><span id="l24.23">   }</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25">   return rv;</span>
<a href="#l24.26"></a><span id="l24.26"> }</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-nsresult nsImportStringBundle::GetStringBundleProxy(nsIStringBundle *aOriginalBundle,</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-                                                    nsIStringBundle **aProxy)</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-{</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-  nsresult rv;</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-  nsCOMPtr&lt;nsIProxyObjectManager&gt; proxyObjMgr =</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-    do_GetService(NS_XPCOMPROXY_CONTRACTID, &amp;rv);</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-  // create a proxy object if we aren't on the same thread?</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-  return proxyObjMgr-&gt;GetProxyForObject(NS_PROXY_TO_MAIN_THREAD,</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-                                        NS_GET_IID(nsIStringBundle),</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-                                        aOriginalBundle,</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-                                        NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-                                        (void **) aProxy);</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-}</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-</span>
<a href="#l24.44"></a><span id="l24.44"> void nsImportStringBundle::GetStringByID(PRInt32 aStringID,</span>
<a href="#l24.45"></a><span id="l24.45">                                          nsIStringBundle *aBundle,</span>
<a href="#l24.46"></a><span id="l24.46">                                          nsString &amp;aResult)</span>
<a href="#l24.47"></a><span id="l24.47"> {</span>
<a href="#l24.48"></a><span id="l24.48">   aResult.Adopt(GetStringByID(aStringID, aBundle));</span>
<a href="#l24.49"></a><span id="l24.49"> }</span>
<a href="#l24.50"></a><span id="l24.50"> </span>
<a href="#l24.51"></a><span id="l24.51"> PRUnichar *nsImportStringBundle::GetStringByID(PRInt32 aStringID,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/import/src/nsImportStringBundle.h</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/import/src/nsImportStringBundle.h</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -51,18 +51,16 @@ public:</span>
<a href="#l25.4"></a><span id="l25.4">                             nsString &amp;aResult);</span>
<a href="#l25.5"></a><span id="l25.5">   static PRUnichar* GetStringByName(const char *aName,</span>
<a href="#l25.6"></a><span id="l25.6">                                     nsIStringBundle *aBundle = nsnull);</span>
<a href="#l25.7"></a><span id="l25.7">   static void GetStringByName(const char *aName,</span>
<a href="#l25.8"></a><span id="l25.8">                                 nsIStringBundle *aBundle,</span>
<a href="#l25.9"></a><span id="l25.9">                                 nsString &amp;aResult);</span>
<a href="#l25.10"></a><span id="l25.10">   static nsresult GetStringBundle(const char *aPropertyURL,</span>
<a href="#l25.11"></a><span id="l25.11">                                   nsIStringBundle **aBundle);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  static nsresult GetStringBundleProxy(nsIStringBundle *aOriginalBundle,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-                                       nsIStringBundle **aProxy);</span>
<a href="#l25.14"></a><span id="l25.14"> };</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16"> #define IMPORT_MSGS_URL       &quot;chrome://messenger/locale/importMsgs.properties&quot;</span>
<a href="#l25.17"></a><span id="l25.17"> </span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19"> #define  IMPORT_NO_ADDRBOOKS                            2000</span>
<a href="#l25.20"></a><span id="l25.20"> #define  IMPORT_ERROR_AB_NOTINITIALIZED            2001</span>
<a href="#l25.21"></a><span id="l25.21"> #define IMPORT_ERROR_AB_NOTHREAD              2002</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -262,23 +262,17 @@ NS_IMETHODIMP ImportAddressImpl::GetAuto</span>
<a href="#l26.4"></a><span id="l26.4">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">   nsString str;</span>
<a href="#l26.7"></a><span id="l26.7">   *_retval = PR_FALSE;</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   if (!m_notProxyBundle)</span>
<a href="#l26.10"></a><span id="l26.10">     return NS_ERROR_FAILURE;</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; proxy;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  nsresult rv =</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-    nsImportStringBundle::GetStringBundleProxy(m_notProxyBundle,</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-                                               getter_AddRefs(proxy));</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-  nsImportStringBundle::GetStringByID(TEXTIMPORT_ADDRESS_NAME, proxy, str);</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+  nsImportStringBundle::GetStringByID(TEXTIMPORT_ADDRESS_NAME, m_notProxyBundle, str);</span>
<a href="#l26.20"></a><span id="l26.20">   *addrDescription = ToNewUnicode(str);</span>
<a href="#l26.21"></a><span id="l26.21">   return( NS_OK);</span>
<a href="#l26.22"></a><span id="l26.22"> }</span>
<a href="#l26.23"></a><span id="l26.23"> </span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25"> NS_IMETHODIMP ImportAddressImpl::GetDefaultLocation(nsIFile **ppLoc, PRBool *found, PRBool *userVerify)</span>
<a href="#l26.26"></a><span id="l26.26"> {</span>
<a href="#l26.27"></a><span id="l26.27">   NS_PRECONDITION(found != nsnull, &quot;null ptr&quot;);</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineat">@@ -425,29 +419,23 @@ ImportAddressImpl::ImportAddressBook(nsI</span>
<a href="#l26.29"></a><span id="l26.29">                                      PRUnichar ** pErrorLog,</span>
<a href="#l26.30"></a><span id="l26.30">                                      PRUnichar ** pSuccessLog,</span>
<a href="#l26.31"></a><span id="l26.31">                                      PRBool * fatalError)</span>
<a href="#l26.32"></a><span id="l26.32"> {</span>
<a href="#l26.33"></a><span id="l26.33">   NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l26.34"></a><span id="l26.34">   NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l26.35"></a><span id="l26.35">   NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l26.36"></a><span id="l26.36"> </span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; pBundle;</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-  nsresult rv =</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">-    nsImportStringBundle::GetStringBundleProxy(m_notProxyBundle,</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">-                                               getter_AddRefs(pBundle));</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-</span>
<a href="#l26.43"></a><span id="l26.43">   m_bytesImported = 0;</span>
<a href="#l26.44"></a><span id="l26.44"> </span>
<a href="#l26.45"></a><span id="l26.45">   nsString success, error;</span>
<a href="#l26.46"></a><span id="l26.46">   if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l26.47"></a><span id="l26.47">     IMPORT_LOG0( &quot;*** Bad param passed to text address import\n&quot;);</span>
<a href="#l26.48"></a><span id="l26.48">     nsImportStringBundle::GetStringByID(TEXTIMPORT_ADDRESS_BADPARAM,</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineminus">-                                        pBundle,</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+                                        m_notProxyBundle,</span>
<a href="#l26.51"></a><span id="l26.51">                                         error);</span>
<a href="#l26.52"></a><span id="l26.52"> </span>
<a href="#l26.53"></a><span id="l26.53">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l26.54"></a><span id="l26.54"> </span>
<a href="#l26.55"></a><span id="l26.55">     if (fatalError)</span>
<a href="#l26.56"></a><span id="l26.56">       *fatalError = PR_TRUE;</span>
<a href="#l26.57"></a><span id="l26.57"> </span>
<a href="#l26.58"></a><span id="l26.58">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineat">@@ -458,66 +446,67 @@ ImportAddressImpl::ImportAddressBook(nsI</span>
<a href="#l26.60"></a><span id="l26.60">   PRBool addrAbort = PR_FALSE;</span>
<a href="#l26.61"></a><span id="l26.61">   nsString name;</span>
<a href="#l26.62"></a><span id="l26.62">   pSource-&gt;GetPreferredName(name);</span>
<a href="#l26.63"></a><span id="l26.63"> </span>
<a href="#l26.64"></a><span id="l26.64">   PRUint32 addressSize = 0;</span>
<a href="#l26.65"></a><span id="l26.65">   pSource-&gt;GetSize( &amp;addressSize);</span>
<a href="#l26.66"></a><span id="l26.66">   if (addressSize == 0) {</span>
<a href="#l26.67"></a><span id="l26.67">     IMPORT_LOG0( &quot;Address book size is 0, skipping import.\n&quot;);</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineminus">-    ReportSuccess(name, &amp;success, pBundle);</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+    ReportSuccess(name, &amp;success, m_notProxyBundle);</span>
<a href="#l26.70"></a><span id="l26.70">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l26.71"></a><span id="l26.71">     return NS_OK;</span>
<a href="#l26.72"></a><span id="l26.72">   }</span>
<a href="#l26.73"></a><span id="l26.73"> </span>
<a href="#l26.74"></a><span id="l26.74">   nsCOMPtr&lt;nsIFile&gt; inFile;</span>
<a href="#l26.75"></a><span id="l26.75">   if (NS_FAILED(pSource-&gt;GetAbFile(getter_AddRefs(inFile)))) {</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineminus">-    ReportError(TEXTIMPORT_ADDRESS_BADSOURCEFILE, name, &amp;error, pBundle);</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineplus">+    ReportError(TEXTIMPORT_ADDRESS_BADSOURCEFILE, name, &amp;error, m_notProxyBundle);</span>
<a href="#l26.78"></a><span id="l26.78">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l26.79"></a><span id="l26.79">     return NS_ERROR_FAILURE;</span>
<a href="#l26.80"></a><span id="l26.80">   }</span>
<a href="#l26.81"></a><span id="l26.81"> </span>
<a href="#l26.82"></a><span id="l26.82">   if (!aSupportService) {</span>
<a href="#l26.83"></a><span id="l26.83">     IMPORT_LOG0(&quot;Missing support service to import call&quot;);</span>
<a href="#l26.84"></a><span id="l26.84">     return NS_ERROR_FAILURE;</span>
<a href="#l26.85"></a><span id="l26.85">   }</span>
<a href="#l26.86"></a><span id="l26.86"> </span>
<a href="#l26.87"></a><span id="l26.87">   PRBool isLDIF = PR_FALSE;</span>
<a href="#l26.88"></a><span id="l26.88" class="difflineplus">+  nsresult rv;</span>
<a href="#l26.89"></a><span id="l26.89">   nsCOMPtr&lt;nsIAbLDIFService&gt; ldifService(do_QueryInterface(aSupportService, &amp;rv));</span>
<a href="#l26.90"></a><span id="l26.90"> </span>
<a href="#l26.91"></a><span id="l26.91">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l26.92"></a><span id="l26.92">       rv = ldifService-&gt;IsLDIFFile(inFile, &amp;isLDIF);</span>
<a href="#l26.93"></a><span id="l26.93">       if (NS_FAILED(rv)) {</span>
<a href="#l26.94"></a><span id="l26.94">         IMPORT_LOG0( &quot;*** Error reading address file\n&quot;);</span>
<a href="#l26.95"></a><span id="l26.95">       }</span>
<a href="#l26.96"></a><span id="l26.96">     }</span>
<a href="#l26.97"></a><span id="l26.97"> </span>
<a href="#l26.98"></a><span id="l26.98">   if (NS_FAILED( rv)) {</span>
<a href="#l26.99"></a><span id="l26.99" class="difflineminus">-    ReportError(TEXTIMPORT_ADDRESS_CONVERTERROR, name, &amp;error, pBundle);</span>
<a href="#l26.100"></a><span id="l26.100" class="difflineplus">+    ReportError(TEXTIMPORT_ADDRESS_CONVERTERROR, name, &amp;error, m_notProxyBundle);</span>
<a href="#l26.101"></a><span id="l26.101">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l26.102"></a><span id="l26.102">     return( rv);</span>
<a href="#l26.103"></a><span id="l26.103">   }</span>
<a href="#l26.104"></a><span id="l26.104"> </span>
<a href="#l26.105"></a><span id="l26.105">   if (isLDIF) {</span>
<a href="#l26.106"></a><span id="l26.106">     if (ldifService)</span>
<a href="#l26.107"></a><span id="l26.107">       rv = ldifService-&gt;ImportLDIFFile(pDestination, inFile, PR_FALSE, &amp;m_bytesImported);</span>
<a href="#l26.108"></a><span id="l26.108">     else</span>
<a href="#l26.109"></a><span id="l26.109">       return NS_ERROR_FAILURE;</span>
<a href="#l26.110"></a><span id="l26.110">   }</span>
<a href="#l26.111"></a><span id="l26.111">   else {</span>
<a href="#l26.112"></a><span id="l26.112">     rv = m_text.ImportAddresses( &amp;addrAbort, name.get(), inFile, pDestination, fieldMap, error, &amp;m_bytesImported);</span>
<a href="#l26.113"></a><span id="l26.113">     SaveFieldMap( fieldMap);</span>
<a href="#l26.114"></a><span id="l26.114">   }</span>
<a href="#l26.115"></a><span id="l26.115"> </span>
<a href="#l26.116"></a><span id="l26.116">   if (NS_SUCCEEDED( rv) &amp;&amp; error.IsEmpty()) {</span>
<a href="#l26.117"></a><span id="l26.117" class="difflineminus">-    ReportSuccess(name, &amp;success, pBundle);</span>
<a href="#l26.118"></a><span id="l26.118" class="difflineplus">+    ReportSuccess(name, &amp;success, m_notProxyBundle);</span>
<a href="#l26.119"></a><span id="l26.119">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l26.120"></a><span id="l26.120">   }</span>
<a href="#l26.121"></a><span id="l26.121">   else {</span>
<a href="#l26.122"></a><span id="l26.122" class="difflineminus">-    ReportError(TEXTIMPORT_ADDRESS_CONVERTERROR, name, &amp;error, pBundle);</span>
<a href="#l26.123"></a><span id="l26.123" class="difflineplus">+    ReportError(TEXTIMPORT_ADDRESS_CONVERTERROR, name, &amp;error, m_notProxyBundle);</span>
<a href="#l26.124"></a><span id="l26.124">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l26.125"></a><span id="l26.125">   }</span>
<a href="#l26.126"></a><span id="l26.126"> </span>
<a href="#l26.127"></a><span id="l26.127">   IMPORT_LOG0( &quot;*** Text address import done\n&quot;);</span>
<a href="#l26.128"></a><span id="l26.128">   return rv;</span>
<a href="#l26.129"></a><span id="l26.129"> }</span>
<a href="#l26.130"></a><span id="l26.130"> </span>
<a href="#l26.131"></a><span id="l26.131"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -233,22 +233,17 @@ NS_IMETHODIMP ImportVCardAddressImpl::Ge</span>
<a href="#l27.4"></a><span id="l27.4">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">   nsString str;</span>
<a href="#l27.7"></a><span id="l27.7">   *_retval = PR_FALSE;</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9">   if (!m_notProxyBundle)</span>
<a href="#l27.10"></a><span id="l27.10">     return NS_ERROR_FAILURE;</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; proxy;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-  nsresult rv = nsImportStringBundle::GetStringBundleProxy(</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-      m_notProxyBundle, getter_AddRefs(proxy));</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-  nsImportStringBundle::GetStringByName(&quot;vCardImportAddressName&quot;, proxy, str);</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+  nsImportStringBundle::GetStringByName(&quot;vCardImportAddressName&quot;, m_notProxyBundle, str);</span>
<a href="#l27.19"></a><span id="l27.19">   *addrDescription = ToNewUnicode(str);</span>
<a href="#l27.20"></a><span id="l27.20">   return NS_OK;</span>
<a href="#l27.21"></a><span id="l27.21"> }</span>
<a href="#l27.22"></a><span id="l27.22"> </span>
<a href="#l27.23"></a><span id="l27.23"> NS_IMETHODIMP ImportVCardAddressImpl::GetDefaultLocation(</span>
<a href="#l27.24"></a><span id="l27.24">     nsIFile **ppLoc, PRBool *found, PRBool *userVerify)</span>
<a href="#l27.25"></a><span id="l27.25"> {</span>
<a href="#l27.26"></a><span id="l27.26">   NS_ENSURE_ARG_POINTER(found);</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineat">@@ -382,57 +377,52 @@ NS_IMETHODIMP ImportVCardAddressImpl::Im</span>
<a href="#l27.28"></a><span id="l27.28"> {</span>
<a href="#l27.29"></a><span id="l27.29">   NS_ENSURE_ARG_POINTER(pSource);</span>
<a href="#l27.30"></a><span id="l27.30">   NS_ENSURE_ARG_POINTER(pDestination);</span>
<a href="#l27.31"></a><span id="l27.31">   NS_ENSURE_ARG_POINTER(fatalError);</span>
<a href="#l27.32"></a><span id="l27.32"> </span>
<a href="#l27.33"></a><span id="l27.33">   if (!m_notProxyBundle)</span>
<a href="#l27.34"></a><span id="l27.34">     return NS_ERROR_FAILURE;</span>
<a href="#l27.35"></a><span id="l27.35"> </span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; proxy;</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">-  nsresult rv = nsImportStringBundle::GetStringBundleProxy(</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">-      m_notProxyBundle, getter_AddRefs(proxy));</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">-</span>
<a href="#l27.41"></a><span id="l27.41">   m_bytesImported = 0;</span>
<a href="#l27.42"></a><span id="l27.42">   nsString success, error;</span>
<a href="#l27.43"></a><span id="l27.43">   PRBool addrAbort = PR_FALSE;</span>
<a href="#l27.44"></a><span id="l27.44">   nsString name;</span>
<a href="#l27.45"></a><span id="l27.45">   pSource-&gt;GetPreferredName(name);</span>
<a href="#l27.46"></a><span id="l27.46"> </span>
<a href="#l27.47"></a><span id="l27.47">   PRUint32 addressSize = 0;</span>
<a href="#l27.48"></a><span id="l27.48">   pSource-&gt;GetSize(&amp;addressSize);</span>
<a href="#l27.49"></a><span id="l27.49">   if (addressSize == 0) {</span>
<a href="#l27.50"></a><span id="l27.50">     IMPORT_LOG0(&quot;Address book size is 0, skipping import.\n&quot;);</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineminus">-    ReportSuccess(name, &amp;success, proxy);</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineplus">+    ReportSuccess(name, &amp;success, m_notProxyBundle);</span>
<a href="#l27.53"></a><span id="l27.53">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l27.54"></a><span id="l27.54">     return NS_OK;</span>
<a href="#l27.55"></a><span id="l27.55">   }</span>
<a href="#l27.56"></a><span id="l27.56"> </span>
<a href="#l27.57"></a><span id="l27.57">   nsCOMPtr&lt;nsIFile&gt; inFile;</span>
<a href="#l27.58"></a><span id="l27.58">   if (NS_FAILED(pSource-&gt;GetAbFile(getter_AddRefs(inFile)))) {</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineminus">-    ReportError(&quot;vCardImportAddressBadSourceFile&quot;, name, &amp;error, proxy);</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineplus">+    ReportError(&quot;vCardImportAddressBadSourceFile&quot;, name, &amp;error, m_notProxyBundle);</span>
<a href="#l27.61"></a><span id="l27.61">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l27.62"></a><span id="l27.62">     return NS_ERROR_FAILURE;</span>
<a href="#l27.63"></a><span id="l27.63">   }</span>
<a href="#l27.64"></a><span id="l27.64"> </span>
<a href="#l27.65"></a><span id="l27.65">   if (!aSupportService) {</span>
<a href="#l27.66"></a><span id="l27.66">     IMPORT_LOG0(&quot;Missing support service to import call\n&quot;);</span>
<a href="#l27.67"></a><span id="l27.67">     return NS_ERROR_FAILURE;</span>
<a href="#l27.68"></a><span id="l27.68">   }</span>
<a href="#l27.69"></a><span id="l27.69"> </span>
<a href="#l27.70"></a><span id="l27.70" class="difflineminus">-  rv = m_vCard.ImportAddresses(</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineplus">+  nsresult rv = m_vCard.ImportAddresses(</span>
<a href="#l27.72"></a><span id="l27.72">       &amp;addrAbort, name.get(), inFile, pDestination, error, &amp;m_bytesImported);</span>
<a href="#l27.73"></a><span id="l27.73"> </span>
<a href="#l27.74"></a><span id="l27.74">   if (NS_SUCCEEDED(rv) &amp;&amp; error.IsEmpty()) {</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-    ReportSuccess(name, &amp;success, proxy);</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineplus">+    ReportSuccess(name, &amp;success, m_notProxyBundle);</span>
<a href="#l27.77"></a><span id="l27.77">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l27.78"></a><span id="l27.78">   }</span>
<a href="#l27.79"></a><span id="l27.79">   else {</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-    ReportError(&quot;vCardImportAddressConvertError&quot;, name, &amp;error, proxy);</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+    ReportError(&quot;vCardImportAddressConvertError&quot;, name, &amp;error, m_notProxyBundle);</span>
<a href="#l27.82"></a><span id="l27.82">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l27.83"></a><span id="l27.83">   }</span>
<a href="#l27.84"></a><span id="l27.84"> </span>
<a href="#l27.85"></a><span id="l27.85">   IMPORT_LOG0(&quot;*** VCard address import done\n&quot;);</span>
<a href="#l27.86"></a><span id="l27.86">   return rv;</span>
<a href="#l27.87"></a><span id="l27.87"> }</span>
<a href="#l27.88"></a><span id="l27.88"> </span>
<a href="#l27.89"></a><span id="l27.89"> NS_IMETHODIMP ImportVCardAddressImpl::GetImportProgress(PRUint32 *_retval)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMImport.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -235,39 +235,35 @@ void ImportWMMailImpl::AddLinebreak( nsS</span>
<a href="#l28.4"></a><span id="l28.4">     pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l28.5"></a><span id="l28.5"> }</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7"> void ImportWMMailImpl::ReportSuccess( nsString&amp; name, PRInt32 count, nsString *pStream)</span>
<a href="#l28.8"></a><span id="l28.8"> {</span>
<a href="#l28.9"></a><span id="l28.9">   if (!pStream)</span>
<a href="#l28.10"></a><span id="l28.10">     return;</span>
<a href="#l28.11"></a><span id="l28.11">   // load the success string</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  nsIStringBundle *pBundle = nsWMStringBundle::GetStringBundleProxy();</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-  PRUnichar *pFmt = nsWMStringBundle::GetStringByID( WMIMPORT_MAILBOX_SUCCESS, pBundle);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+  PRUnichar *pFmt = nsWMStringBundle::GetStringByID( WMIMPORT_MAILBOX_SUCCESS);</span>
<a href="#l28.15"></a><span id="l28.15">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get(), count);</span>
<a href="#l28.16"></a><span id="l28.16">   pStream-&gt;Append( pText);</span>
<a href="#l28.17"></a><span id="l28.17">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l28.18"></a><span id="l28.18">   nsWMStringBundle::FreeString( pFmt);</span>
<a href="#l28.19"></a><span id="l28.19">   AddLinebreak( pStream);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l28.21"></a><span id="l28.21"> }</span>
<a href="#l28.22"></a><span id="l28.22"> </span>
<a href="#l28.23"></a><span id="l28.23"> void ImportWMMailImpl::ReportError( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l28.24"></a><span id="l28.24"> {</span>
<a href="#l28.25"></a><span id="l28.25">   if (!pStream)</span>
<a href="#l28.26"></a><span id="l28.26">     return;</span>
<a href="#l28.27"></a><span id="l28.27">   // load the error string</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-  nsIStringBundle *pBundle = nsWMStringBundle::GetStringBundleProxy();</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">-  PRUnichar *pFmt = nsWMStringBundle::GetStringByID( errorNum, pBundle);</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+  PRUnichar *pFmt = nsWMStringBundle::GetStringByID( errorNum);</span>
<a href="#l28.31"></a><span id="l28.31">   PRUnichar *pText = nsTextFormatter::smprintf( pFmt, name.get());</span>
<a href="#l28.32"></a><span id="l28.32">   pStream-&gt;Append( pText);</span>
<a href="#l28.33"></a><span id="l28.33">   nsTextFormatter::smprintf_free( pText);</span>
<a href="#l28.34"></a><span id="l28.34">   nsWMStringBundle::FreeString( pFmt);</span>
<a href="#l28.35"></a><span id="l28.35">   AddLinebreak( pStream);</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-  NS_IF_RELEASE( pBundle);</span>
<a href="#l28.37"></a><span id="l28.37"> }</span>
<a href="#l28.38"></a><span id="l28.38"> </span>
<a href="#l28.39"></a><span id="l28.39"> void ImportWMMailImpl::SetLogs(nsString&amp; success, nsString&amp; error,</span>
<a href="#l28.40"></a><span id="l28.40">                                PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l28.41"></a><span id="l28.41"> {</span>
<a href="#l28.42"></a><span id="l28.42">   if (pError)</span>
<a href="#l28.43"></a><span id="l28.43">     *pError = ToNewUnicode(error);</span>
<a href="#l28.44"></a><span id="l28.44">   if (pSuccess)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -36,75 +36,57 @@</span>
<a href="#l29.4"></a><span id="l29.4">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l29.5"></a><span id="l29.5"> #include &quot;prprf.h&quot;</span>
<a href="#l29.6"></a><span id="l29.6"> #include &quot;prmem.h&quot;</span>
<a href="#l29.7"></a><span id="l29.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l29.8"></a><span id="l29.8"> #include &quot;nsReadableUtils.h&quot;</span>
<a href="#l29.9"></a><span id="l29.9"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l29.10"></a><span id="l29.10"> #include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l29.11"></a><span id="l29.11"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-#include &quot;nsIProxyObjectManager.h&quot;</span>
<a href="#l29.13"></a><span id="l29.13"> #include &quot;nsIURI.h&quot;</span>
<a href="#l29.14"></a><span id="l29.14"> </span>
<a href="#l29.15"></a><span id="l29.15"> #define WM_MSGS_URL       &quot;chrome://messenger/locale/wmImportMsgs.properties&quot;</span>
<a href="#l29.16"></a><span id="l29.16"> </span>
<a href="#l29.17"></a><span id="l29.17"> nsIStringBundle *  nsWMStringBundle::m_pBundle = nsnull;</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19"> nsIStringBundle *nsWMStringBundle::GetStringBundle( void)</span>
<a href="#l29.20"></a><span id="l29.20"> {</span>
<a href="#l29.21"></a><span id="l29.21">   if (m_pBundle)</span>
<a href="#l29.22"></a><span id="l29.22">     return( m_pBundle);</span>
<a href="#l29.23"></a><span id="l29.23"> </span>
<a href="#l29.24"></a><span id="l29.24">   nsresult      rv;</span>
<a href="#l29.25"></a><span id="l29.25">   char*        propertyURL = WM_MSGS_URL;</span>
<a href="#l29.26"></a><span id="l29.26">   nsIStringBundle*  sBundle = nsnull;</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-</span>
<a href="#l29.29"></a><span id="l29.29">   nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l29.30"></a><span id="l29.30">            do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l29.31"></a><span id="l29.31">   if (NS_SUCCEEDED(rv) &amp;&amp; (nsnull != sBundleService)) {</span>
<a href="#l29.32"></a><span id="l29.32">     rv = sBundleService-&gt;CreateBundle(propertyURL, &amp;sBundle);</span>
<a href="#l29.33"></a><span id="l29.33">   }</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">   m_pBundle = sBundle;</span>
<a href="#l29.36"></a><span id="l29.36"> </span>
<a href="#l29.37"></a><span id="l29.37">   return( sBundle);</span>
<a href="#l29.38"></a><span id="l29.38"> }</span>
<a href="#l29.39"></a><span id="l29.39"> </span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">-nsIStringBundle *nsWMStringBundle::GetStringBundleProxy( void)</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineplus">+void nsWMStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result)</span>
<a href="#l29.42"></a><span id="l29.42"> {</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-  if (!m_pBundle)</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-    return( nsnull);</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-  nsIStringBundle *strProxy = nsnull;</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-  // create a proxy object if we aren't on the same thread?</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-  NS_GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-                       m_pBundle, NS_PROXY_SYNC | NS_PROXY_ALWAYS,</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-                       (void **) &amp;strProxy);</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-  return( strProxy);</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-}</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-void nsWMStringBundle::GetStringByID( PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle)</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-{</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-  PRUnichar *ptrv = GetStringByID( stringID, pBundle);</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineplus">+  PRUnichar *ptrv = GetStringByID(stringID);</span>
<a href="#l29.60"></a><span id="l29.60">   result = ptrv;</span>
<a href="#l29.61"></a><span id="l29.61">   FreeString( ptrv);</span>
<a href="#l29.62"></a><span id="l29.62"> }</span>
<a href="#l29.63"></a><span id="l29.63"> </span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-PRUnichar *nsWMStringBundle::GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle)</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineplus">+PRUnichar *nsWMStringBundle::GetStringByID(PRInt32 stringID)</span>
<a href="#l29.66"></a><span id="l29.66"> {</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-  if (!pBundle) {</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineminus">-    pBundle = GetStringBundle();</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-  }</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineplus">+  if (!m_pBundle)</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineplus">+    m_pBundle = GetStringBundle();</span>
<a href="#l29.72"></a><span id="l29.72"> </span>
<a href="#l29.73"></a><span id="l29.73" class="difflineminus">-  if (pBundle) {</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+  if (m_pBundle) {</span>
<a href="#l29.75"></a><span id="l29.75">     PRUnichar *ptrv = nsnull;</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">-    nsresult rv = pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineplus">+    nsresult rv = m_pBundle-&gt;GetStringFromID(stringID, &amp;ptrv);</span>
<a href="#l29.78"></a><span id="l29.78"> </span>
<a href="#l29.79"></a><span id="l29.79">     if (NS_SUCCEEDED( rv) &amp;&amp; ptrv)</span>
<a href="#l29.80"></a><span id="l29.80">       return( ptrv);</span>
<a href="#l29.81"></a><span id="l29.81">   }</span>
<a href="#l29.82"></a><span id="l29.82"> </span>
<a href="#l29.83"></a><span id="l29.83">   nsString resultString;</span>
<a href="#l29.84"></a><span id="l29.84">   resultString.AppendLiteral(&quot;[StringID &quot;);</span>
<a href="#l29.85"></a><span id="l29.85">   resultString.AppendInt(stringID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMStringBundle.h</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMStringBundle.h</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -38,22 +38,21 @@</span>
<a href="#l30.4"></a><span id="l30.4"> #define _nsWMStringBundle_H__</span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6"> #include &quot;nsString.h&quot;</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> class nsIStringBundle;</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10"> class nsWMStringBundle {</span>
<a href="#l30.11"></a><span id="l30.11"> public:</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  static PRUnichar     *    GetStringByID(PRInt32 stringID, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-  static void          GetStringByID(PRInt32 stringID, nsString&amp; result, nsIStringBundle *pBundle = nsnull);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  static PRUnichar     *    GetStringByID(PRInt32 stringID);</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+  static void          GetStringByID(PRInt32 stringID, nsString&amp; result);</span>
<a href="#l30.16"></a><span id="l30.16">   static nsIStringBundle *  GetStringBundle( void); // don't release</span>
<a href="#l30.17"></a><span id="l30.17">   static void          FreeString( PRUnichar *pStr) { NS_Free( pStr);}</span>
<a href="#l30.18"></a><span id="l30.18">   static void          Cleanup( void);</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineminus">-  static nsIStringBundle *  GetStringBundleProxy( void); // release</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21"> private:</span>
<a href="#l30.22"></a><span id="l30.22">   static nsIStringBundle *  m_pBundle;</span>
<a href="#l30.23"></a><span id="l30.23"> };</span>
<a href="#l30.24"></a><span id="l30.24"> </span>
<a href="#l30.25"></a><span id="l30.25"> </span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27"> #define WMIMPORT_NAME                     2000</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

