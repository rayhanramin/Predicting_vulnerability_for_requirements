<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 8960:5d6b25eda12e22f97ff3165f187bedb79d426e36</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 5d6b25eda12e22f97ff3165f187bedb79d426e36" />
<meta property="og:url" content="/comm-central/rev/5d6b25eda12e22f97ff3165f187bedb79d426e36" />
<meta property="og:description" content="fix libreg bustage" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 5d6b25eda12e22f97ff3165f187bedb79d426e36 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/5d6b25eda12e22f97ff3165f187bedb79d426e36">shortlog</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/5d6b25eda12e22f97ff3165f187bedb79d426e36">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36">files</a> |
changeset |
<a href="/comm-central/raw-rev/5d6b25eda12e22f97ff3165f187bedb79d426e36">raw</a>  | <a href="/comm-central/archive/5d6b25eda12e22f97ff3165f187bedb79d426e36.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
fix libreg bustage
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#69;&#100;&#32;&#77;&#111;&#114;&#108;&#101;&#121;&#32;&#60;&#98;&#109;&#111;&#64;&#101;&#100;&#109;&#111;&#114;&#108;&#101;&#121;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 11 Dec 2011 19:07:00 -0500</td></tr>

<tr>
 <td>changeset 8960</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/5d6b25eda12e22f97ff3165f187bedb79d426e36">5d6b25eda12e22f97ff3165f187bedb79d426e36</a></td>
</tr>



<tr>
<td>parent 8959</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e490369977e676f9288b27bec53b19e8acab6015">e490369977e676f9288b27bec53b19e8acab6015</a>
</td>
</tr>

<tr>
<td>child 8961</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1afd843a67b122114438dfb7f9cd3f6524bf78d1">1afd843a67b122114438dfb7f9cd3f6524bf78d1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=5d6b25eda12e22f97ff3165f187bedb79d426e36">6872</a></td></tr>
<tr><td>push user</td><td>Callek@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 12 Dec 2011 11:01:04 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1afd843a67b1 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1afd843a67b122114438dfb7f9cd3f6524bf78d1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1afd843a67b122114438dfb7f9cd3f6524bf78d1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1afd843a67b122114438dfb7f9cd3f6524bf78d1&newProject=comm-central&newRevision=5d6b25eda12e22f97ff3165f187bedb79d426e36&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1afd843a67b122114438dfb7f9cd3f6524bf78d1&newProject=comm-central&newRevision=5d6b25eda12e22f97ff3165f187bedb79d426e36&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1afd843a67b122114438dfb7f9cd3f6524bf78d1&newProject=comm-central&newRevision=5d6b25eda12e22f97ff3165f187bedb79d426e36&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=689437">689437</a></td></tr>




</table></div>

<div class="page_body description">fix libreg bustage
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=689437">Bug 689437</a> - fix libreg bustage (WIP -- part 1) f=Callek
review on next cset, r=Standard8 sr=Neil on combined.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/build/Makefile.in">mail/components/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">mail/components/migration/src/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.cpp">mail/components/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.h">mail/components/migration/src/nsProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/installer/package-manifest.in">mail/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/en-US/chrome/messenger/comm4xMailImportMsgs.properties">mail/locales/en-US/chrome/messenger/comm4xMailImportMsgs.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/en-US/chrome/messenger/comm4xMailImportMsgs.properties">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/en-US/chrome/messenger/comm4xMailImportMsgs.properties">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/en-US/chrome/messenger/comm4xMailImportMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/build/Makefile.in">mailnews/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/Makefile.in">mailnews/import/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/Makefile.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/Makefile.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/Makefile.in">mailnews/import/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/nsImportModule.cpp">mailnews/import/build/nsImportModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/nsImportModule.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/nsImportModule.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/nsImportModule.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/nsImportModule.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/build/nsImportModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/Makefile.in">mailnews/import/comm4x/public/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/nsIComm4xProfile.idl">mailnews/import/comm4x/public/nsIComm4xProfile.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/nsIComm4xProfile.idl">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/nsIComm4xProfile.idl">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/public/nsIComm4xProfile.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Comm4xMailDebugLog.h">mailnews/import/comm4x/src/Comm4xMailDebugLog.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Comm4xMailDebugLog.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Comm4xMailDebugLog.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Comm4xMailDebugLog.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Makefile.in">mailnews/import/comm4x/src/Makefile.in</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.cpp">mailnews/import/comm4x/src/nsComm4xMail.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.h">mailnews/import/comm4x/src/nsComm4xMail.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMail.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">mailnews/import/comm4x/src/nsComm4xMailImport.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.h">mailnews/import/comm4x/src/nsComm4xMailImport.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailImport.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailStringBundle.h">mailnews/import/comm4x/src/nsComm4xMailStringBundle.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailStringBundle.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailStringBundle.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xMailStringBundle.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.cpp">mailnews/import/comm4x/src/nsComm4xProfile.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.h">mailnews/import/comm4x/src/nsComm4xProfile.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/comm4x/src/nsComm4xProfile.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.js">mailnews/import/content/importDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.js">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.js">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.js">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.js">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.xul">mailnews/import/content/importDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.xul">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.xul">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.xul">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.xul">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/import/content/importDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/makefiles.sh">mailnews/makefiles.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/makefiles.sh">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/makefiles.sh">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/makefiles.sh">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/makefiles.sh">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/mailnews/makefiles.sh">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/build/Makefile.in">suite/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/installer/package-manifest.in">suite/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/en-US/chrome/mailnews/comm4xMailImportMsgs.properties">suite/locales/en-US/chrome/mailnews/comm4xMailImportMsgs.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/en-US/chrome/mailnews/comm4xMailImportMsgs.properties">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/en-US/chrome/mailnews/comm4xMailImportMsgs.properties">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/en-US/chrome/mailnews/comm4xMailImportMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/jar.mn">suite/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.cpp">suite/profile/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.h">suite/profile/migration/src/nsProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp">suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5d6b25eda12e22f97ff3165f187bedb79d426e36/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/build/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/build/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -80,23 +80,21 @@ SHARED_LIBRARY_LIBS += ../shell/$(LIB_PR</span>
<a href="#l1.4"></a><span id="l1.4"> endif</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6"> ifneq (,$(filter windows, $(MOZ_WIDGET_TOOLKIT)))</span>
<a href="#l1.7"></a><span id="l1.7"> SHARED_LIBRARY_LIBS += ../search/$(LIB_PREFIX)winsearch_s.$(LIB_SUFFIX)</span>
<a href="#l1.8"></a><span id="l1.8"> endif</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> ifdef MOZILLA_INTERNAL_API</span>
<a href="#l1.11"></a><span id="l1.11"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-	$(LIBXUL_DIST)/../modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l1.13"></a><span id="l1.13"> 	$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l1.14"></a><span id="l1.14"> 	$(MOZ_UNICHARUTIL_LIBS) \</span>
<a href="#l1.15"></a><span id="l1.15"> 	$(NULL)</span>
<a href="#l1.16"></a><span id="l1.16"> else</span>
<a href="#l1.17"></a><span id="l1.17"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-	$(LIBXUL_DIST)/../modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l1.19"></a><span id="l1.19"> 	$(LIBXUL_DIST)/lib/$(LIB_PREFIX)xpcomglue_s.$(LIB_SUFFIX) \</span>
<a href="#l1.20"></a><span id="l1.20"> 	$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l1.21"></a><span id="l1.21"> 	$(NULL)</span>
<a href="#l1.22"></a><span id="l1.22"> endif</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> # Mac: Need to link to CoreFoundation for Mac shell service</span>
<a href="#l1.25"></a><span id="l1.25"> # GTK2: Need to link with glib for GNOME shell service</span>
<a href="#l1.26"></a><span id="l1.26"> ifneq (,$(filter cocoa gtk2,$(MOZ_WIDGET_TOOLKIT)))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -39,17 +39,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsIFile.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-#include &quot;NSReg.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l2.14"></a><span id="l2.14"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l2.15"></a><span id="l2.15"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l2.16"></a><span id="l2.16"> #include &quot;nsIURL.h&quot;</span>
<a href="#l2.17"></a><span id="l2.17"> #include &quot;nsNetscapeProfileMigratorBase.h&quot;</span>
<a href="#l2.18"></a><span id="l2.18"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l2.19"></a><span id="l2.19"> #include &quot;prtime.h&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> #include &quot;prprf.h&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -68,31 +67,16 @@ nsNetscapeProfileMigratorBase::nsNetscap</span>
<a href="#l2.22"></a><span id="l2.22">   mMaxProgress = LL_ZERO;</span>
<a href="#l2.23"></a><span id="l2.23">   mCurrentProgress = LL_ZERO;</span>
<a href="#l2.24"></a><span id="l2.24">   mFileCopyTransactionIndex = 0;</span>
<a href="#l2.25"></a><span id="l2.25"> }</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> NS_IMPL_ISUPPORTS2(nsNetscapeProfileMigratorBase, nsIMailProfileMigrator,</span>
<a href="#l2.28"></a><span id="l2.28">                    nsITimerCallback)</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-static nsresult</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-regerr2nsresult(REGERR errCode)</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-{</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-  switch (errCode) {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-    case REGERR_PARAM:</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-    case REGERR_BADTYPE:</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-    case REGERR_BADNAME:</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-      return NS_ERROR_INVALID_ARG;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-    case REGERR_MEMORY:</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-      return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-  }</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-}</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-</span>
<a href="#l2.45"></a><span id="l2.45"> nsresult</span>
<a href="#l2.46"></a><span id="l2.46"> nsNetscapeProfileMigratorBase::GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l2.47"></a><span id="l2.47">                                                              nsIMutableArray* aProfileNames,</span>
<a href="#l2.48"></a><span id="l2.48">                                                              nsIMutableArray* aProfileLocations)</span>
<a href="#l2.49"></a><span id="l2.49"> {</span>
<a href="#l2.50"></a><span id="l2.50">   nsCOMPtr&lt;nsIFile&gt; dataDir;</span>
<a href="#l2.51"></a><span id="l2.51">   nsresult rv = aDataDir-&gt;Clone(getter_AddRefs(dataDir));</span>
<a href="#l2.52"></a><span id="l2.52">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineat">@@ -160,119 +144,16 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55">       profileNameString-&gt;SetData(NS_ConvertUTF8toUTF16(buffer));</span>
<a href="#l2.56"></a><span id="l2.56">       aProfileNames-&gt;AppendElement(profileNameString, PR_FALSE);</span>
<a href="#l2.57"></a><span id="l2.57">     }</span>
<a href="#l2.58"></a><span id="l2.58">   }</span>
<a href="#l2.59"></a><span id="l2.59">   return NS_OK;</span>
<a href="#l2.60"></a><span id="l2.60"> }</span>
<a href="#l2.61"></a><span id="l2.61"> </span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-nsresult</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-nsNetscapeProfileMigratorBase::GetProfileDataFromRegistry(nsILocalFile* aRegistryFile,</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-                                                          nsIMutableArray* aProfileNames,</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-                                                          nsIMutableArray* aProfileLocations)</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-{</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-  REGERR errCode;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-  // Ensure aRegistryFile exists before opening it</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-  bool regFileExists = false;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-  nsresult rv = aRegistryFile-&gt;Exists(&amp;regFileExists);</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-  if (!regFileExists)</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-    return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-  // Open It</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-  nsCAutoString regPath;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-  rv = aRegistryFile-&gt;GetNativePath(regPath);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-  if ((errCode = NR_StartupRegistry()))</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-    return regerr2nsresult(errCode);</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-  HREG reg;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-  if ((errCode = NR_RegOpen(regPath.get(), &amp;reg))) {</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-    NR_ShutdownRegistry();</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-    return regerr2nsresult(errCode);</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-  }</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-  RKEY profilesTree;</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-  if ((errCode = NR_RegGetKey(reg, ROOTKEY_COMMON, &quot;Profiles&quot;, &amp;profilesTree))) {</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-    NR_RegClose(reg);</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-    NR_ShutdownRegistry();</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-    return regerr2nsresult(errCode);</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-  }</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-  char profileStr[MAXREGPATHLEN];</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-  REGENUM enumState = nsnull;</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-  while (!NR_RegEnumSubkeys(reg, profilesTree, &amp;enumState, profileStr,</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-                            sizeof(profileStr), REGENUM_CHILDREN))</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-  {</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-    RKEY profileKey;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-    if (NR_RegGetKey(reg, profilesTree, profileStr, &amp;profileKey))</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-      continue;</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-    // &quot;migrated&quot; is &quot;yes&quot; for all valid Seamonkey profiles. It is only &quot;no&quot;</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-    // for 4.x profiles.</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-    char migratedStr[3];</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-    errCode = NR_RegGetEntryString(reg, profileKey, &quot;migrated&quot;,</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-                                   migratedStr, sizeof(migratedStr));</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-    if ((errCode != REGERR_OK &amp;&amp; errCode != REGERR_BUFTOOSMALL) ||</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-        strcmp(migratedStr, &quot;no&quot;) == 0)</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-      continue;</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-    // Get the profile location and add it to the locations array</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-    REGINFO regInfo;</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-    regInfo.size = sizeof(REGINFO);</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">- </span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-    if (NR_RegGetEntryInfo(reg, profileKey, &quot;directory&quot;, &amp;regInfo))</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-      continue;</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-    nsCAutoString dirStr;</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-    dirStr.SetLength(regInfo.entryLength);</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineminus">-    errCode = NR_RegGetEntryString(reg, profileKey, &quot;directory&quot;,</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-                                   dirStr.BeginWriting(), regInfo.entryLength);</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineminus">-    // Remove trailing \0</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-    dirStr.SetLength(regInfo.entryLength-1);</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; dir;</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-    rv = NS_NewNativeLocalFile(EmptyCString(), PR_TRUE, getter_AddRefs(dir));</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-    if (NS_FAILED(rv)) break;</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-    dir-&gt;SetPersistentDescriptor(dirStr);</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-#else</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-    rv = NS_NewLocalFile(NS_ConvertUTF8toUTF16(dirStr), PR_TRUE,</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-                         getter_AddRefs(dir));</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-    if (NS_FAILED(rv)) break;</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-#endif</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-    bool exists;</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-    dir-&gt;Exists(&amp;exists);</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-    if (exists) {</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-      aProfileLocations-&gt;AppendElement(dir, PR_FALSE);</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-      // Add the profile name to the names array</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-      nsCOMPtr&lt;nsISupportsString&gt; profileNameString(</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-        do_CreateInstance(&quot;@mozilla.org/supports-string;1&quot;));</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-      profileNameString-&gt;SetData(NS_ConvertUTF8toUTF16(profileStr));</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-      aProfileNames-&gt;AppendElement(profileNameString, PR_FALSE);</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-    }</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">-  }</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-  NR_RegClose(reg);</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-  NR_ShutdownRegistry();</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-  return rv;</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-}</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-</span>
<a href="#l2.165"></a><span id="l2.165"> #define GETPREF(xform, method, value) \</span>
<a href="#l2.166"></a><span id="l2.166">   nsresult rv = aBranch-&gt;method(xform-&gt;sourcePrefName, value); \</span>
<a href="#l2.167"></a><span id="l2.167">   if (NS_SUCCEEDED(rv)) \</span>
<a href="#l2.168"></a><span id="l2.168">     xform-&gt;prefHasValue = PR_TRUE; \</span>
<a href="#l2.169"></a><span id="l2.169">   return rv;</span>
<a href="#l2.170"></a><span id="l2.170"> </span>
<a href="#l2.171"></a><span id="l2.171"> #define SETPREF(xform, method, value) \</span>
<a href="#l2.172"></a><span id="l2.172">   if (xform-&gt;prefHasValue) { \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -117,19 +117,16 @@ public:</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> protected:</span>
<a href="#l3.6"></a><span id="l3.6">   void CopyNextFolder();</span>
<a href="#l3.7"></a><span id="l3.7">   void EndCopyFolders();</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">   nsresult GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l3.10"></a><span id="l3.10">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l3.11"></a><span id="l3.11">                                          nsIMutableArray* aProfileLocations);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  nsresult GetProfileDataFromRegistry(nsILocalFile* aRegistryFile,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                                      nsIMutableArray* aProfileNames,</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                                      nsIMutableArray* aProfileLocations);</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">   nsresult CopyFile(const nsAString&amp; aSourceFileName, const nsAString&amp; aTargetFileName);</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18">   nsresult GetSignonFileName(bool aReplace, char** aFileName);</span>
<a href="#l3.19"></a><span id="l3.19">   nsresult LocateSignonsFile(char** aResult);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">   nsCOMPtr&lt;nsILocalFile&gt; mSourceProfile;</span>
<a href="#l3.22"></a><span id="l3.22">   nsCOMPtr&lt;nsIFile&gt; mTargetProfile;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -48,35 +48,22 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsIProperties.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsProfileMigrator.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;nsMailMigrationCID.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#include &quot;NSReg.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> #ifdef XP_WIN</span>
<a href="#l4.14"></a><span id="l4.14"> #include &lt;windows.h&gt;</span>
<a href="#l4.15"></a><span id="l4.15"> #else</span>
<a href="#l4.16"></a><span id="l4.16"> #include &lt;limits.h&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> #endif</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-#ifndef MAXPATHLEN</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-#ifdef PATH_MAX</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-#define MAXPATHLEN PATH_MAX</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-#elif defined(_MAX_PATH)</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-#define MAXPATHLEN _MAX_PATH</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-#elif defined(CCHMAXPATH)</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-#define MAXPATHLEN CCHMAXPATH</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-#else</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-#define MAXPATHLEN 1024</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-#endif</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-#endif</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-</span>
<a href="#l4.31"></a><span id="l4.31"> NS_IMPL_ISUPPORTS1(nsProfileMigrator, nsIProfileMigrator)</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33"> #define MIGRATION_WIZARD_FE_URL &quot;chrome://messenger/content/migration/migration.xul&quot;</span>
<a href="#l4.34"></a><span id="l4.34"> #define MIGRATION_WIZARD_FE_FEATURES &quot;chrome,dialog,modal,centerscreen&quot;</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> NS_IMETHODIMP</span>
<a href="#l4.37"></a><span id="l4.37"> nsProfileMigrator::Migrate(nsIProfileStartup* aStartup)</span>
<a href="#l4.38"></a><span id="l4.38"> {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -176,129 +163,8 @@ nsProfileMigrator::GetDefaultMailMigrato</span>
<a href="#l4.40"></a><span id="l4.40">     {</span>
<a href="#l4.41"></a><span id="l4.41">       mailMigrator = nsnull;</span>
<a href="#l4.42"></a><span id="l4.42">       return NS_OK;</span>
<a href="#l4.43"></a><span id="l4.43">     }</span>
<a href="#l4.44"></a><span id="l4.44">   }</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">   return NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l4.47"></a><span id="l4.47"> }</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-nsProfileMigrator::Import()</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-{</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-  if (ImportRegistryProfiles(NS_LITERAL_CSTRING(&quot;Thunderbird&quot;)))</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-    return NS_OK;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-}</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-bool</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-nsProfileMigrator::ImportRegistryProfiles(const nsACString&amp; aAppName)</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-{</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-  nsresult rv;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-  nsCOMPtr&lt;nsIToolkitProfileService&gt; profileSvc</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-    (do_GetService(NS_PROFILESERVICE_CONTRACTID));</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-  NS_ENSURE_TRUE(profileSvc, PR_FALSE);</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-  nsCOMPtr&lt;nsIProperties&gt; dirService</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-    (do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-  NS_ENSURE_TRUE(dirService, PR_FALSE);</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; regFile;</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-#ifdef XP_WIN</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-  rv = dirService-&gt;Get(NS_WIN_APPDATA_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-                       getter_AddRefs(regFile));</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-  regFile-&gt;AppendNative(aAppName);</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-  regFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;registry.dat&quot;));</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-#elif defined(XP_MACOSX)</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-  rv = dirService-&gt;Get(NS_MAC_USER_LIB_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-                       getter_AddRefs(regFile));</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  regFile-&gt;AppendNative(aAppName);</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-  regFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Application Registry&quot;));</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-#elif defined(XP_OS2)</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-  rv = dirService-&gt;Get(NS_OS2_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-                       getter_AddRefs(regFile));</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-  regFile-&gt;AppendNative(aAppName);</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-  regFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;registry.dat&quot;));</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-#elif defined(XP_BEOS)</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-  rv = dirService-&gt;Get(NS_BEOS_SETTINGS_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-                       getter_AddRefs(regFile));</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-  regFile-&gt;AppendNative(aAppName);</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-  regFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;appreg&quot;));</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-#else</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-  rv = dirService-&gt;Get(NS_UNIX_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-                       getter_AddRefs(regFile));</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-  nsCAutoString dotAppName;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-  ToLowerCase(aAppName, dotAppName);</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-  dotAppName.Insert('.', 0);</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-  regFile-&gt;AppendNative(dotAppName);</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-  regFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;appreg&quot;));</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-#endif</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-  nsCAutoString path;</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-  rv = regFile-&gt;GetNativePath(path);</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, PR_FALSE);</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-  if (NR_StartupRegistry())</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-  bool migrated = false;</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-  HREG reg = nsnull;</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-  RKEY profiles = 0;</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-  REGENUM enumstate = 0;</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-  char profileName[MAXREGNAMELEN];</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineminus">-  if (NR_RegOpen(path.get(), &amp;reg))</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-    goto cleanup;</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-  if (NR_RegGetKey(reg, ROOTKEY_COMMON, &quot;Profiles&quot;, &amp;profiles))</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-    goto cleanup;</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-  while (!NR_RegEnumSubkeys(reg, profiles, &amp;enumstate,</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-                            profileName, MAXREGNAMELEN, REGENUM_CHILDREN)) {</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-#ifdef DEBUG_bsmedberg</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-    printf(&quot;Found profile %s.\n&quot;, profileName);</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-#endif</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-    RKEY profile = 0;</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-    if (NR_RegGetKey(reg, profiles, profileName, &amp;profile)) {</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-      NS_ERROR(&quot;Could not get the key that was enumerated.&quot;);</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-      continue;</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-    }</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-    char profilePath[MAXPATHLEN];</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-    if (NR_RegGetEntryString(reg, profile, &quot;directory&quot;,</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-                             profilePath, MAXPATHLEN))</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-      continue;</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; profileFile</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-      (do_CreateInstance(&quot;@mozilla.org/file/local;1&quot;));</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-    if (!profileFile)</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-      continue;</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-#if defined (XP_MACOSX)</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-    rv = profileFile-&gt;SetPersistentDescriptor(nsDependentCString(profilePath));</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-#else</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-    NS_ConvertUTF8toUTF16 widePath(profilePath);</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-    rv = profileFile-&gt;InitWithPath(widePath);</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-#endif</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-    if (NS_FAILED(rv)) continue;</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-    nsCOMPtr&lt;nsIToolkitProfile&gt; tprofile;</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-    profileSvc-&gt;CreateProfile(profileFile, nsnull,</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-                              nsDependentCString(profileName),</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-                              getter_AddRefs(tprofile));</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-    migrated = PR_TRUE;</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-  }</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-cleanup:</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-  if (reg)</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    NR_RegClose(reg);</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-  NR_ShutdownRegistry();</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-  return migrated;</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -40,33 +40,26 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsIProfileMigrator.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;nsIMailProfileMigrator.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsIToolkitProfile.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsIToolkitProfileService.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;NSReg.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> #define NS_THUNDERBIRD_PROFILEIMPORT_CID \</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-{ 0xb3c78baf, 0x3a52, 0x41d2, { 0x97, 0x18, 0xc3, 0x19, 0xbe, 0xf9, 0xaf, 0xfc } }</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+{ 0xea05dd97, 0xb66b, 0x4305, { 0xa6, 0x58, 0xd5, 0xde, 0x7f, 0x54, 0x0c, 0xc9 } }</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> class nsProfileMigrator : public nsIProfileMigrator</span>
<a href="#l5.20"></a><span id="l5.20"> {</span>
<a href="#l5.21"></a><span id="l5.21"> public:</span>
<a href="#l5.22"></a><span id="l5.22">   NS_DECL_NSIPROFILEMIGRATOR</span>
<a href="#l5.23"></a><span id="l5.23">   NS_DECL_ISUPPORTS</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">   nsProfileMigrator() { };</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27"> protected:</span>
<a href="#l5.28"></a><span id="l5.28">   ~nsProfileMigrator() { };</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30">   nsresult GetDefaultMailMigratorKey(nsACString&amp; key, nsCOMPtr&lt;nsIMailProfileMigrator&gt;&amp; mailMigrator);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  /**</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-   * Import profiles from ~/.thunderbird/ </span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-   * @return PR_TRUE if any profiles imported.</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-   */</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-  bool ImportRegistryProfiles(const nsACString&amp; aAppName);</span>
<a href="#l5.37"></a><span id="l5.37"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -298,24 +298,17 @@ nsSeamonkeyProfileMigrator::FillProfileD</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   nsCOMPtr&lt;nsILocalFile&gt; newSmDataLocal(do_QueryInterface(newSeamonkeyData));</span>
<a href="#l6.6"></a><span id="l6.6">   NS_ENSURE_TRUE(newSmDataLocal, NS_ERROR_FAILURE);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   nsresult rv = GetProfileDataFromProfilesIni(newSmDataLocal,</span>
<a href="#l6.9"></a><span id="l6.9">                                               mProfileNames,</span>
<a href="#l6.10"></a><span id="l6.10">                                               mProfileLocations);</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  if (rv != NS_ERROR_FILE_NOT_FOUND)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-    return rv;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-  seamonkeyData-&gt;Append(NS_LITERAL_STRING(OLD_FOLDER));</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-  seamonkeyData-&gt;Append(NS_LITERAL_STRING(REGISTRY_FILE));</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-  return GetProfileDataFromRegistry(seamonkeyData, mProfileNames,</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-                                    mProfileLocations);</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+  return rv;</span>
<a href="#l6.21"></a><span id="l6.21"> }</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23"> static</span>
<a href="#l6.24"></a><span id="l6.24"> nsSeamonkeyProfileMigrator::PrefTransform gTransforms[] = {</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">   MAKESAMETYPEPREFTRANSFORM(&quot;signon.SignonFileName&quot;,                    String),</span>
<a href="#l6.28"></a><span id="l6.28">   MAKESAMETYPEPREFTRANSFORM(&quot;mailnews.headers.showUserAgent&quot;,           Bool),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/installer/package-manifest.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/installer/package-manifest.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -146,17 +146,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> @BINPATH@/components/msgBase.manifest</span>
<a href="#l7.5"></a><span id="l7.5"> @BINPATH@/components/msgcompose.xpt</span>
<a href="#l7.6"></a><span id="l7.6"> @BINPATH@/components/msgdb.xpt</span>
<a href="#l7.7"></a><span id="l7.7"> @BINPATH@/components/msgimap.xpt</span>
<a href="#l7.8"></a><span id="l7.8"> @BINPATH@/components/msglocal.xpt</span>
<a href="#l7.9"></a><span id="l7.9"> @BINPATH@/components/msgnews.xpt</span>
<a href="#l7.10"></a><span id="l7.10"> @BINPATH@/components/msgsearch.xpt</span>
<a href="#l7.11"></a><span id="l7.11"> @BINPATH@/components/import.xpt</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-@BINPATH@/components/impComm4xMail.xpt</span>
<a href="#l7.13"></a><span id="l7.13"> @BINPATH@/components/mailview.xpt</span>
<a href="#l7.14"></a><span id="l7.14"> @BINPATH@/components/mailprofilemigration.xpt</span>
<a href="#l7.15"></a><span id="l7.15"> @BINPATH@/components/messageWakeupService.js</span>
<a href="#l7.16"></a><span id="l7.16"> @BINPATH@/components/messageWakeupService.manifest</span>
<a href="#l7.17"></a><span id="l7.17"> @BINPATH@/components/nsActivity.js</span>
<a href="#l7.18"></a><span id="l7.18"> @BINPATH@/components/nsActivityManager.js</span>
<a href="#l7.19"></a><span id="l7.19"> @BINPATH@/components/nsActivityManagerUI.js</span>
<a href="#l7.20"></a><span id="l7.20"> @BINPATH@/components/nsAddrbook.manifest</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">deleted file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/comm4xMailImportMsgs.properties</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ /dev/null</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -1,63 +0,0 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-#</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-#</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-# License.</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-#</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-#</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-#</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-#   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-#</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-#</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-# LOCALIZATION NOTE (comm4xImportName) : &quot;Communicator 4.x&quot; below is the used for previous versions of Netscape Communicator. Please translate using the brandname in respective languages for Netscape Communicator 4 releases.</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-comm4xImportName=Communicator 4.x</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-# Description of import module</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-# LOCALIZATION NOTE : &quot;Communicator 4.x&quot; below is the used for previous versions of Netscape Communicator</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-# Please translate using the brandname in respective languages for Netscape Communicator 4 releases.</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-## @name COMM4XMAILIMPORT_DESCRIPTION</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-## @loc None</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-2001=Import Local Mail from Communicator 4.x.</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-# Success Message</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-# LOCALIZATION NOTE : Do not translate the word &quot;%S&quot; below.</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-## @name COMM4XMAILIMPORT_MAILBOX_SUCCESS</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-## @loc None</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-2002=Local messages were successfully imported from %S</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-# Error Message</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-## @name COMM4XMAILIMPORT_MAILBOX_BADPARAM</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-## @loc None</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-2003=An internal error occurred. Importing failed. Try importing again.</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-# Error message</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-# LOCALIZATION NOTE : Do not translate the word &quot;%S&quot; below.</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-## @name COMM4XMAILIMPORT_MAILBOX_CONVERTERROR</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-## @loc None</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-2004=An error occurred while importing messages from %S. Messages were not imported. Make more disk space available and try again.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -88,17 +88,16 @@</span>
<a href="#l9.4"></a><span id="l9.4">   locale/@AB_CD@/messenger/mailViewList.dtd                             (%chrome/messenger/mailViewList.dtd)</span>
<a href="#l9.5"></a><span id="l9.5">   locale/@AB_CD@/messenger/offlineStartup.properties                    (%chrome/messenger/offlineStartup.properties)</span>
<a href="#l9.6"></a><span id="l9.6">   locale/@AB_CD@/messenger/importMsgs.properties                        (%chrome/messenger/importMsgs.properties)</span>
<a href="#l9.7"></a><span id="l9.7">   locale/@AB_CD@/messenger/importDialog.dtd                             (%chrome/messenger/importDialog.dtd)</span>
<a href="#l9.8"></a><span id="l9.8">   locale/@AB_CD@/messenger/fieldMapImport.dtd                           (%chrome/messenger/fieldMapImport.dtd)</span>
<a href="#l9.9"></a><span id="l9.9">   locale/@AB_CD@/messenger/textImportMsgs.properties                    (%chrome/messenger/textImportMsgs.properties)</span>
<a href="#l9.10"></a><span id="l9.10">   locale/@AB_CD@/messenger/vCardImportMsgs.properties                   (%chrome/messenger/vCardImportMsgs.properties)</span>
<a href="#l9.11"></a><span id="l9.11">   locale/@AB_CD@/messenger/appleMailImportMsgs.properties               (%chrome/messenger/appleMailImportMsgs.properties)</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  locale/@AB_CD@/messenger/comm4xMailImportMsgs.properties              (%chrome/messenger/comm4xMailImportMsgs.properties)</span>
<a href="#l9.13"></a><span id="l9.13">   locale/@AB_CD@/messenger/eudoraImportMsgs.properties                  (%chrome/messenger/eudoraImportMsgs.properties)</span>
<a href="#l9.14"></a><span id="l9.14">   locale/@AB_CD@/messenger/oeImportMsgs.properties                      (%chrome/messenger/oeImportMsgs.properties)</span>
<a href="#l9.15"></a><span id="l9.15">   locale/@AB_CD@/messenger/wmImportMsgs.properties                      (%chrome/messenger/wmImportMsgs.properties)</span>
<a href="#l9.16"></a><span id="l9.16">   locale/@AB_CD@/messenger/outlookImportMsgs.properties                 (%chrome/messenger/outlookImportMsgs.properties)</span>
<a href="#l9.17"></a><span id="l9.17">   locale/@AB_CD@/messenger/shutdownWindow.properties                    (%chrome/messenger/shutdownWindow.properties)</span>
<a href="#l9.18"></a><span id="l9.18">   locale/@AB_CD@/messenger/featureConfigurator.dtd                      (%chrome/messenger/featureConfigurator.dtd)</span>
<a href="#l9.19"></a><span id="l9.19">   locale/@AB_CD@/messenger/configEditorOverlay.dtd                      (%chrome/messenger/configEditorOverlay.dtd)</span>
<a href="#l9.20"></a><span id="l9.20">   locale/@AB_CD@/messenger/gloda.properties                             (%chrome/messenger/gloda.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/build/Makefile.in</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/build/Makefile.in</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -85,17 +85,16 @@ SHARED_LIBRARY_LIBS = \</span>
<a href="#l10.4"></a><span id="l10.4">                 ../extensions/mdn/src/$(LIB_PREFIX)msgmdn_s.$(LIB_SUFFIX) \</span>
<a href="#l10.5"></a><span id="l10.5">                 ../mime/cthandlers/vcard/$(LIB_PREFIX)vcard_s.$(LIB_SUFFIX) \</span>
<a href="#l10.6"></a><span id="l10.6">                 ../mime/cthandlers/glue/$(LIB_PREFIX)mimecthglue_s.$(LIB_SUFFIX) \</span>
<a href="#l10.7"></a><span id="l10.7">                 $(NULL)</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> ifdef MOZILLA_INTERNAL_API</span>
<a href="#l10.10"></a><span id="l10.10"> EXTRA_DSO_LDOPTS = \</span>
<a href="#l10.11"></a><span id="l10.11"> 		$(MOZDEPTH)/rdf/util/src/internal/$(LIB_PREFIX)rdfutil_s.$(LIB_SUFFIX) \</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-		$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l10.13"></a><span id="l10.13"> 		$(MOZ_JS_LIBS) \</span>
<a href="#l10.14"></a><span id="l10.14"> 		$(MOZ_UNICHARUTIL_LIBS) \</span>
<a href="#l10.15"></a><span id="l10.15"> 		$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l10.16"></a><span id="l10.16"> 		$(ZLIB_LIBS) \</span>
<a href="#l10.17"></a><span id="l10.17"> 		$(MOZ_ZLIB_LIBS) \</span>
<a href="#l10.18"></a><span id="l10.18"> 		$(NULL)</span>
<a href="#l10.19"></a><span id="l10.19"> else</span>
<a href="#l10.20"></a><span id="l10.20"> EXTRA_DSO_LDOPTS = \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/Makefile.in</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/Makefile.in</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -39,17 +39,17 @@ DEPTH		= ../..</span>
<a href="#l11.4"></a><span id="l11.4"> topsrcdir	= @top_srcdir@</span>
<a href="#l11.5"></a><span id="l11.5"> srcdir		= @srcdir@</span>
<a href="#l11.6"></a><span id="l11.6"> VPATH		= @srcdir@</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> include $(DEPTH)/config/autoconf.mk</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10"> MODULE		= import</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-PARALLEL_DIRS	= public src text/src vcard/src comm4x/public comm4x/src</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+PARALLEL_DIRS	= public src text/src vcard/src</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l11.16"></a><span id="l11.16"> PARALLEL_DIRS	+= eudora/src applemail/src</span>
<a href="#l11.17"></a><span id="l11.17"> endif</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l11.20"></a><span id="l11.20"> PARALLEL_DIRS	+= eudora/src</span>
<a href="#l11.21"></a><span id="l11.21"> ifndef GNU_CC</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/build/Makefile.in</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/build/Makefile.in</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -56,17 +56,16 @@ endif</span>
<a href="#l12.4"></a><span id="l12.4"> MODULE_NAME	= nsImportServiceModule</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> CPPSRCS		=  nsImportModule.cpp</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> SHARED_LIBRARY_LIBS = \</span>
<a href="#l12.9"></a><span id="l12.9"> 		../src/$(LIB_PREFIX)import_s.$(LIB_SUFFIX) \</span>
<a href="#l12.10"></a><span id="l12.10"> 		../text/src/$(LIB_PREFIX)imptext_s.$(LIB_SUFFIX) \</span>
<a href="#l12.11"></a><span id="l12.11"> 		../vcard/src/$(LIB_PREFIX)impvcard_s.$(LIB_SUFFIX) \</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-		../comm4x/src/$(LIB_PREFIX)imp4mail_s.$(LIB_SUFFIX) \</span>
<a href="#l12.13"></a><span id="l12.13"> 		$(NULL)</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l12.16"></a><span id="l12.16"> SHARED_LIBRARY_LIBS += ../eudora/src/$(LIB_PREFIX)impEudra_s.$(LIB_SUFFIX)</span>
<a href="#l12.17"></a><span id="l12.17"> SHARED_LIBRARY_LIBS += ../applemail/src/$(LIB_PREFIX)applmail_s.$(LIB_SUFFIX)</span>
<a href="#l12.18"></a><span id="l12.18"> endif</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -76,17 +75,16 @@ ifndef GNU_CC</span>
<a href="#l12.22"></a><span id="l12.22"> SHARED_LIBRARY_LIBS += ../oexpress/$(LIB_PREFIX)importOE_s.$(LIB_SUFFIX)</span>
<a href="#l12.23"></a><span id="l12.23"> SHARED_LIBRARY_LIBS += ../outlook/src/$(LIB_PREFIX)impOutlk_s.$(LIB_SUFFIX)</span>
<a href="#l12.24"></a><span id="l12.24"> SHARED_LIBRARY_LIBS += ../winlivemail/$(LIB_PREFIX)importWM_s.$(LIB_SUFFIX)</span>
<a href="#l12.25"></a><span id="l12.25"> endif</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27"> endif</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29"> LOCAL_INCLUDES += -I$(srcdir)/../src \</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-	-I$(srcdir)/../comm4x/src \</span>
<a href="#l12.31"></a><span id="l12.31"> 	-I$(srcdir)/../text/src \</span>
<a href="#l12.32"></a><span id="l12.32">   -I$(srcdir)/../vcard/src \</span>
<a href="#l12.33"></a><span id="l12.33"> 	$(NULL)</span>
<a href="#l12.34"></a><span id="l12.34"> </span>
<a href="#l12.35"></a><span id="l12.35"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l12.36"></a><span id="l12.36"> LOCAL_INCLUDES += -I$(srcdir)/../eudora/src \</span>
<a href="#l12.37"></a><span id="l12.37"> 									-I$(srcdir)/../applemail/src \</span>
<a href="#l12.38"></a><span id="l12.38"> 									$(NULL)</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -104,29 +102,27 @@ endif</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41"> EXTRA_DSO_LDOPTS += ../../base/util/$(LIB_PREFIX)msgbsutl_s.$(LIB_SUFFIX)</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43"> ifdef MOZILLA_INTERNAL_API</span>
<a href="#l12.44"></a><span id="l12.44"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l12.45"></a><span id="l12.45"> 	$(LIBS_DIR) \</span>
<a href="#l12.46"></a><span id="l12.46"> 	$(EXTRA_DSO_LIBS) \</span>
<a href="#l12.47"></a><span id="l12.47"> 	$(MOZ_UNICHARUTIL_LIBS) \</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-	$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l12.49"></a><span id="l12.49"> 	$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l12.50"></a><span id="l12.50"> 	$(NULL)</span>
<a href="#l12.51"></a><span id="l12.51"> else</span>
<a href="#l12.52"></a><span id="l12.52"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l12.53"></a><span id="l12.53"> 	$(LIBS_DIR) \</span>
<a href="#l12.54"></a><span id="l12.54"> 	$(ZLIB_LIBS) \</span>
<a href="#l12.55"></a><span id="l12.55"> 	$(MOZ_ZLIB_LIBS) \</span>
<a href="#l12.56"></a><span id="l12.56"> 	$(MOZ_JS_LIBS) \</span>
<a href="#l12.57"></a><span id="l12.57"> 	$(XPCOM_GLUE_LDOPTS) \</span>
<a href="#l12.58"></a><span id="l12.58"> 	$(call EXPAND_LIBNAME_PATH,unicharutil_external_s,$(LIBXUL_DIST)/lib) \</span>
<a href="#l12.59"></a><span id="l12.59"> 	$(MOZDEPTH)/rdf/util/src/$(LIB_PREFIX)rdfutil_external_s.$(LIB_SUFFIX) \</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineminus">-	$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l12.61"></a><span id="l12.61"> 	$(NSPR_LIBS) \</span>
<a href="#l12.62"></a><span id="l12.62"> 	$(NULL)</span>
<a href="#l12.63"></a><span id="l12.63"> endif</span>
<a href="#l12.64"></a><span id="l12.64"> </span>
<a href="#l12.65"></a><span id="l12.65"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l12.66"></a><span id="l12.66"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l12.67"></a><span id="l12.67"> 	-framework Cocoa  \</span>
<a href="#l12.68"></a><span id="l12.68"> 	$(TK_LIBS) \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/build/nsImportModule.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/build/nsImportModule.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -60,26 +60,16 @@ NS_DEFINE_NAMED_CID(NS_TEXTIMPORT_CID);</span>
<a href="#l13.4"></a><span id="l13.4"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.5"></a><span id="l13.5"> // vCard import Include Files</span>
<a href="#l13.6"></a><span id="l13.6"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsVCardImport.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> NS_DEFINE_NAMED_CID(NS_VCARDIMPORT_CID);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-// nsComm4x import Include Files</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-#include &quot;nsComm4xProfile.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-#include &quot;nsComm4xMailStringBundle.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-#include &quot;nsComm4xMailImport.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_COMM4XMAILIMPORT_CID);</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_ICOMM4XPROFILE_CID);</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_COMM4XMAILIMPL_CID);</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.22"></a><span id="l13.22"> // eudora import Include Files</span>
<a href="#l13.23"></a><span id="l13.23"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.24"></a><span id="l13.24"> #if defined(XP_WIN) || defined(XP_MACOSX)</span>
<a href="#l13.25"></a><span id="l13.25"> #include &quot;nsEudoraImport.h&quot;</span>
<a href="#l13.26"></a><span id="l13.26"> #include &quot;nsEudoraStringBundle.h&quot;</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28"> NS_DEFINE_NAMED_CID(NS_EUDORAIMPORT_CID);</span>
<a href="#l13.29"></a><span id="l13.29"> #endif</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineat">@@ -122,23 +112,16 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsIImport</span>
<a href="#l13.31"></a><span id="l13.31"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsTextImport)</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.34"></a><span id="l13.34"> // vcard import factories</span>
<a href="#l13.35"></a><span id="l13.35"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.36"></a><span id="l13.36"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsVCardImport)</span>
<a href="#l13.37"></a><span id="l13.37"> </span>
<a href="#l13.38"></a><span id="l13.38"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-// nsComm4x import factories</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR(nsComm4xMailImport)</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(ImportComm4xMailImpl, Initialize)</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR(nsComm4xProfile)</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.46"></a><span id="l13.46"> // eudora import factories</span>
<a href="#l13.47"></a><span id="l13.47"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.48"></a><span id="l13.48"> #if defined(XP_WIN) || defined(XP_MACOSX)</span>
<a href="#l13.49"></a><span id="l13.49"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsEudoraImport)</span>
<a href="#l13.50"></a><span id="l13.50"> #endif</span>
<a href="#l13.51"></a><span id="l13.51"> </span>
<a href="#l13.52"></a><span id="l13.52"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.53"></a><span id="l13.53"> // apple mail import factories</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineat">@@ -157,17 +140,16 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsOutlook</span>
<a href="#l13.55"></a><span id="l13.55"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsWMImport)</span>
<a href="#l13.56"></a><span id="l13.56"> #endif // XP_WIN</span>
<a href="#l13.57"></a><span id="l13.57"> </span>
<a href="#l13.58"></a><span id="l13.58"> static const mozilla::Module::CategoryEntry kMailNewsImportCategories[] = {</span>
<a href="#l13.59"></a><span id="l13.59">   // XXX These CIDs should match the explicit CIDs defined in the header files,</span>
<a href="#l13.60"></a><span id="l13.60">   // or be changed so that they are contract IDs (with appropriate code updates)</span>
<a href="#l13.61"></a><span id="l13.61">   { &quot;mailnewsimport&quot;, &quot;{A5991D01-ADA7-11d3-A9C2-00A0CC26DA63}&quot;, NS_IMPORT_ADDRESS_STR },</span>
<a href="#l13.62"></a><span id="l13.62">   { &quot;mailnewsimport&quot;, &quot;{0eb034a3-964a-4e2f-92eb-cc55d9ae9dd2}&quot;, NS_IMPORT_ADDRESS_STR },</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-  { &quot;mailnewsimport&quot;, &quot;{647cc990-2bdb-11d6-92a0-0010a4b26cda}&quot;, kComm4xMailSupportsString},</span>
<a href="#l13.64"></a><span id="l13.64"> #if defined(XP_WIN) || defined(XP_MACOSX)</span>
<a href="#l13.65"></a><span id="l13.65">   { &quot;mailnewsimport&quot;, &quot;{c8448da0-8f83-11d3-a206-00a0cc26da63}&quot;, kEudoraSupportsString },</span>
<a href="#l13.66"></a><span id="l13.66"> #endif</span>
<a href="#l13.67"></a><span id="l13.67"> #ifdef XP_WIN</span>
<a href="#l13.68"></a><span id="l13.68">   { &quot;mailnewsimport&quot;, &quot;{42bc82bc-8e9f-4597-8b6e-e529daaf3af1}&quot;, kWMSupportsString },</span>
<a href="#l13.69"></a><span id="l13.69">   { &quot;mailnewsimport&quot;, &quot;{1DB469A0-8B00-11d3-A206-00A0CC26DA63}&quot;, kOutlookSupportsString },</span>
<a href="#l13.70"></a><span id="l13.70">   { &quot;mailnewsimport&quot;, &quot;{be0bc880-1742-11d3-a206-00a0cc26da63}&quot;, kOESupportsString },</span>
<a href="#l13.71"></a><span id="l13.71"> #endif</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineat">@@ -177,19 +159,16 @@ static const mozilla::Module::CategoryEn</span>
<a href="#l13.73"></a><span id="l13.73">   { NULL }</span>
<a href="#l13.74"></a><span id="l13.74"> };</span>
<a href="#l13.75"></a><span id="l13.75"> </span>
<a href="#l13.76"></a><span id="l13.76"> const mozilla::Module::CIDEntry kMailNewsImportCIDs[] = {</span>
<a href="#l13.77"></a><span id="l13.77">   { &amp;kNS_IMPORTSERVICE_CID, false, NULL, nsImportServiceConstructor },</span>
<a href="#l13.78"></a><span id="l13.78">   { &amp;kNS_IMPORTMIMEENCODE_CID, false, NULL, nsIImportMimeEncodeImplConstructor },</span>
<a href="#l13.79"></a><span id="l13.79">   { &amp;kNS_TEXTIMPORT_CID, false, NULL, nsTextImportConstructor },</span>
<a href="#l13.80"></a><span id="l13.80">   { &amp;kNS_VCARDIMPORT_CID, false, NULL, nsVCardImportConstructor },</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-  { &amp;kNS_COMM4XMAILIMPORT_CID, false, NULL, nsComm4xMailImportConstructor },</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-  { &amp;kNS_COMM4XMAILIMPL_CID, false, NULL, ImportComm4xMailImplConstructor },</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-  { &amp;kNS_ICOMM4XPROFILE_CID, false, NULL, nsComm4xProfileConstructor },</span>
<a href="#l13.84"></a><span id="l13.84"> #if defined(XP_WIN) || defined(XP_MACOSX)</span>
<a href="#l13.85"></a><span id="l13.85">   { &amp;kNS_EUDORAIMPORT_CID, false, NULL, nsEudoraImportConstructor },</span>
<a href="#l13.86"></a><span id="l13.86"> #endif</span>
<a href="#l13.87"></a><span id="l13.87"> #if defined(XP_MACOSX)</span>
<a href="#l13.88"></a><span id="l13.88">   { &amp;kNS_APPLEMAILIMPORT_CID, false, NULL, nsAppleMailImportModuleConstructor },</span>
<a href="#l13.89"></a><span id="l13.89">   { &amp;kNS_APPLEMAILIMPL_CID, false, NULL, nsAppleMailImportMailConstructor },</span>
<a href="#l13.90"></a><span id="l13.90"> #endif</span>
<a href="#l13.91"></a><span id="l13.91"> </span>
<a href="#l13.92"></a><span id="l13.92" class="difflineat">@@ -201,19 +180,16 @@ const mozilla::Module::CIDEntry kMailNew</span>
<a href="#l13.93"></a><span id="l13.93">   { NULL }</span>
<a href="#l13.94"></a><span id="l13.94"> };</span>
<a href="#l13.95"></a><span id="l13.95"> </span>
<a href="#l13.96"></a><span id="l13.96"> const mozilla::Module::ContractIDEntry kMailNewsImportContracts[] = {</span>
<a href="#l13.97"></a><span id="l13.97">   { NS_IMPORTSERVICE_CONTRACTID, &amp;kNS_IMPORTSERVICE_CID },</span>
<a href="#l13.98"></a><span id="l13.98">   { &quot;@mozilla.org/import/import-mimeencode;1&quot;, &amp;kNS_IMPORTMIMEENCODE_CID },</span>
<a href="#l13.99"></a><span id="l13.99">   { &quot;@mozilla.org/import/import-text;1&quot;, &amp;kNS_TEXTIMPORT_CID },</span>
<a href="#l13.100"></a><span id="l13.100">   { &quot;@mozilla.org/import/import-vcard;1&quot;, &amp;kNS_VCARDIMPORT_CID },</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineminus">-  { &quot;@mozilla.org/import/import-comm4xMail;1&quot;, &amp;kNS_COMM4XMAILIMPORT_CID },</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineminus">-  { NS_COMM4XMAILIMPL_CONTRACTID, &amp;kNS_COMM4XMAILIMPL_CID },</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineminus">-  { NS_ICOMM4XPROFILE_CONTRACTID, &amp;kNS_ICOMM4XPROFILE_CID },</span>
<a href="#l13.104"></a><span id="l13.104"> #if defined(XP_WIN) || defined(XP_MACOSX)</span>
<a href="#l13.105"></a><span id="l13.105">   { &quot;@mozilla.org/import/import-eudora;1&quot;, &amp;kNS_EUDORAIMPORT_CID },</span>
<a href="#l13.106"></a><span id="l13.106"> #endif</span>
<a href="#l13.107"></a><span id="l13.107"> #if defined(XP_MACOSX)</span>
<a href="#l13.108"></a><span id="l13.108">   { &quot;@mozilla.org/import/import-applemail;1&quot;, &amp;kNS_APPLEMAILIMPORT_CID },</span>
<a href="#l13.109"></a><span id="l13.109">   { NS_APPLEMAILIMPL_CONTRACTID, &amp;kNS_APPLEMAILIMPL_CID },</span>
<a href="#l13.110"></a><span id="l13.110"> #endif</span>
<a href="#l13.111"></a><span id="l13.111"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">deleted file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- a/mailnews/import/comm4x/public/Makefile.in</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ /dev/null</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -1,51 +0,0 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineminus">-#</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-# License.</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-#</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-#</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-#</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-#   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-#</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-#</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-DEPTH		= ../../../..</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-MODULE		= impComm4xMail</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-XPIDLSRCS	= \</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-		nsIComm4xProfile.idl  				\</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-        $(NULL)</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-                </span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">deleted file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- a/mailnews/import/comm4x/public/nsIComm4xProfile.idl</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ /dev/null</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -1,63 +0,0 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">- *</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">- *</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">- * License.</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">- *</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">- *</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">- *</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">- *</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">- *</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-#include &quot;nsILocalFile.idl&quot;</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-/**</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">- * This interface provides support for getting 4.x profile information</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">- * This interface can be used to get the existing 4.x profiles</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">- * and for getting the mail directory for the profile.</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">- * </span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">- */</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-[scriptable, uuid(c66c1060-2bdc-11d6-92a0-0010a4b26cda)]</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-interface nsIComm4xProfile: nsISupports {</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-   /**</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-    *  Parses the 4.x registry file and returns a list of profiles. </span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-    */</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-   void getProfileList(out unsigned long length, [array, size_is(length), retval] out wstring selectList); </span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-   </span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-   /**</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-    *  Searches the preferences file of the given profile for the pref mail.directory</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-    *  If the pref does not exist it, returns the default value.</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-    *  @param profileName  name of the profile in the profiles array </span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-    *  @return             The path to the mail directory for the profile with the name profileName</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-    *   </span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-    */</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-   wstring getMailDir(in wstring profileName);</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">deleted file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- a/mailnews/import/comm4x/src/Comm4xMailDebugLog.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ /dev/null</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -1,50 +0,0 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineminus">- *</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">- *</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">- * License.</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">- *</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">- *</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">- *</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">- *</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineminus">- *</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-#ifndef Comm4xMailDebugLog_h___</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-#define Comm4xMailDebugLog_h___</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-// Use PR_LOG for logging.</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-#include &quot;prlog.h&quot;</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-extern PRLogModuleInfo *COMM4XLOGMODULE;</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-#define IMPORT_LOG0(x)          PR_LOG(COMM4XLOGMODULE, PR_LOG_DEBUG, (x))</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-#define IMPORT_LOG1(x, y)       PR_LOG(COMM4XLOGMODULE, PR_LOG_DEBUG, (x, y))</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-#define IMPORT_LOG2(x, y, z)    PR_LOG(COMM4XLOGMODULE, PR_LOG_DEBUG, (x, y, z))</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-#define IMPORT_LOG3(a, b, c, d) PR_LOG(COMM4XLOGMODULE, PR_LOG_DEBUG, (a, b, c, d))</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineminus">-#endif /* Comm4xMailDebugLog_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">deleted file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- a/mailnews/import/comm4x/src/Makefile.in</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ /dev/null</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -1,61 +0,0 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineminus">-#</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-#</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-# License.</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-#</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-#</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-#</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-#   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-#</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-#</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-DEPTH		= ../../../..</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-topsrcdir	= @top_srcdir@</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-srcdir		= @srcdir@</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-VPATH		= @srcdir@</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-include $(DEPTH)/config/autoconf.mk</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-MODULE		= impComm4xMail</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-LIBRARY_NAME   = imp4mail_s</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-ifndef MOZ_INCOMPLETE_EXTERNAL_LINKAGE</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-MOZILLA_INTERNAL_API = 1</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-LIBXUL_LIBRARY = 1</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-endif</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-CPPSRCS		= 	\</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-			nsComm4xMailImport.cpp			\</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-			nsComm4xMail.cpp				\</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-			nsComm4xProfile.cpp				\</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-			$(NULL)</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-# we don't want the shared lib, but we want to force the creation of a static lib.</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-FORCE_STATIC_LIB = 1</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-include $(topsrcdir)/config/rules.mk</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">deleted file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMail.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ /dev/null</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -1,202 +0,0 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineminus">- *</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">- *</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">- * License.</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">- *</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineminus">- *</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">- *</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">- *</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">- *</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-#include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-#include &quot;nsMsgI18N.h&quot;</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-#include &quot;nsComm4xMail.h&quot;</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-#include &quot;nsIImportService.h&quot;</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-#include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-#include &quot;nsComm4xMailStringBundle.h&quot;</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-#include &quot;nsComm4xMailImport.h&quot;</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-#include &quot;Comm4xMailDebugLog.h&quot;</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-#include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineminus">-</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineminus">-#define  kCopyBufferSize    8192</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineminus">-#define  kMailReadBufferSize  16384</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-static bool</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-nsShouldIgnoreFile(nsString&amp; name)</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-{</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-    PRUnichar firstChar=name.CharAt(0);</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-    if (firstChar == '.' || firstChar == '#' || name.CharAt(name.Length() - 1) == '~')</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineminus">-      return PR_TRUE;</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-    if (name.LowerCaseEqualsLiteral(&quot;rules.dat&quot;) || name.LowerCaseEqualsLiteral(&quot;rulesbackup.dat&quot;))</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-        return PR_TRUE;</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-    // don't add summary files to the list of folders;</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-    // don't add popstate files to the list either, or rules (sort.dat).</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-    if (StringEndsWith(name, NS_LITERAL_STRING(&quot;.snm&quot;)) ||</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineminus">-        name.LowerCaseEqualsLiteral(&quot;popstate.dat&quot;) ||</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineminus">-        name.LowerCaseEqualsLiteral(&quot;sort.dat&quot;) ||</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineminus">-        name.LowerCaseEqualsLiteral(&quot;mailfilt.log&quot;) ||</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-        name.LowerCaseEqualsLiteral(&quot;filters.js&quot;) ||</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineminus">-        StringEndsWith(name, NS_LITERAL_STRING(&quot;.toc&quot;)) ||</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineminus">-        StringEndsWith(name, NS_LITERAL_STRING(&quot;.sbd&quot;)))</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-        return PR_TRUE;</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineminus">-</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineminus">-    return PR_FALSE;</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineminus">-}</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineminus">-</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-nsComm4xMail::nsComm4xMail()</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineminus">-{</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineminus">-}</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineminus">-</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineminus">-nsComm4xMail::~nsComm4xMail()</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineminus">-{</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineminus">-}</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineminus">-</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineminus">-nsresult nsComm4xMail::FindMailboxes(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-{</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineminus">-    nsresult rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineminus">-    if (NS_FAILED(rv)) {</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineminus">-        IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-        return rv;</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-    }</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-    nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineminus">-        return rv;</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-    m_depth = 0;</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-    return (ScanMailDir(pRoot, *ppArray, impSvc));</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineminus">-}</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineminus">-</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineminus">-</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineminus">-nsresult nsComm4xMail::ScanMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineminus">-{</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineminus">-</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineminus">-    m_depth++;</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineminus">-    nsresult rv = IterateMailDir(pFolder, pArray, pImport);</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineminus">-    m_depth--;</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-    return rv;</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-}</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-nsresult nsComm4xMail::IterateMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-{</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-  nsresult rv = pFolder-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-  bool hasMore;</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineminus">-  directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-  while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineminus">-  {</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineminus">-    rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; currentFolderPath(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-    directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineminus">-</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineminus">-    bool                      isFile;</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-    nsCString            pName;</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineminus">-    nsCString            dirName;</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineminus">-    nsAutoString              currentFolderNameStr;</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineminus">-    bool                      isDirectory, exists;</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineminus">-    nsAutoString              ext;</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineminus">-</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineminus">-    rv = currentFolderPath-&gt;GetLeafName(currentFolderNameStr);</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-    isFile = PR_FALSE;</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineminus">-    currentFolderPath-&gt;IsFile(&amp;isFile);</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineminus">-    if (isFile)</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineminus">-    {</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineminus">-      if (!nsShouldIgnoreFile(currentFolderNameStr))</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineminus">-      {</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineminus">-        rv = FoundMailbox(currentFolderPath, &amp;currentFolderNameStr, pArray, pImport);</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineminus">-          return rv;</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineminus">-        currentFolderNameStr.AppendLiteral(&quot;.sbd&quot;);</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineminus">-        rv = currentFolderPath-&gt;SetLeafName(currentFolderNameStr);</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineminus">-          return rv;</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineminus">-        exists = PR_FALSE;</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineminus">-        currentFolderPath-&gt;Exists(&amp;exists);</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineminus">-        isDirectory = PR_FALSE;</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineminus">-        currentFolderPath-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineminus">-        if (exists &amp;&amp; isDirectory) {</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineminus">-          rv = ScanMailDir (currentFolderPath, pArray, pImport);</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineminus">-          if (NS_FAILED(rv))</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineminus">-            return rv;</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineminus">-        }</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineminus">-      }</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineminus">-    }</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineminus">-  }</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineminus">-  return rv;</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineminus">-}</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineminus">-</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineminus">-nsresult nsComm4xMail::FoundMailbox(nsIFile *mailFile, nsAutoString *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineminus">-{</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineminus">-    nsCOMPtr&lt;nsIImportMailboxDescriptor&gt;    desc;</span>
<a href="#l18.179"></a><span id="l18.179" class="difflineminus">-</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineminus">-    nsCString pPath;</span>
<a href="#l18.181"></a><span id="l18.181" class="difflineminus">-    mailFile-&gt;GetNativePath(pPath);</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineminus">-    if (!pPath.IsEmpty())</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineminus">-      IMPORT_LOG2(&quot;Found comm4x mailbox: %s, m_depth = %d\n&quot;, pPath.get(), m_depth);</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineminus">-    else</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineminus">-      IMPORT_LOG2(&quot;Can't get native path but found comm4x mailbox: %s, m_depth = %d\n&quot;, NS_ConvertUTF16toUTF8(*pName).get(), m_depth);</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineminus">-</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineminus">-    nsresult rv = pImport-&gt;CreateNewMailboxDescriptor(getter_AddRefs(desc));</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineminus">-    if (NS_SUCCEEDED(rv)) {</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineminus">-        PRInt64        sz = 0;</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineminus">-        mailFile-&gt;GetFileSize(&amp;sz);</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineminus">-        desc-&gt;SetDisplayName(pName-&gt;get());</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineminus">-        desc-&gt;SetDepth(m_depth);</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineminus">-        desc-&gt;SetSize((PRUint32) sz);</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; pFile;</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineminus">-        desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineminus">-        if (pFile) {</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineminus">-          nsCOMPtr &lt;nsILocalFile&gt; localMailFile = do_QueryInterface(mailFile);</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineminus">-          pFile-&gt;InitWithFile(localMailFile);</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineminus">-        }</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineminus">-        nsCOMPtr &lt;nsISupports&gt; pInterface = do_QueryInterface(desc);</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineminus">-        if (pInterface)</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineminus">-            pArray-&gt;AppendElement(pInterface);</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineminus">-    }</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineminus">-    return NS_OK;</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineminus">-}</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">deleted file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMail.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ /dev/null</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -1,69 +0,0 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">- *</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">- *</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">- * License.</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">- *</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">- *</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">- *</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">- *</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">- *</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-#ifndef nsComm4xMail_h__</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-#define nsComm4xMail_h__</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineminus">-</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineminus">-#include &quot;nscore.h&quot;</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineminus">-#include &quot;nsStringGlue.h&quot;</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-class nsIImportService;</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-class nsIMsgAccountManager;</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-class nsIMsgAccount;</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-class nsComm4xMail {</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-public:</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-    nsComm4xMail();</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-    virtual    ~nsComm4xMail();</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-    // get the list of mailboxes</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-    virtual nsresult    FindMailboxes(nsIFile *pRoot, nsISupportsArray **ppArray);</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-    </span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-private:</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-    nsresult    ScanMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-    nsresult    IterateMailDir(nsIFile *pFolder, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-    nsresult    FoundMailbox(nsIFile *mailFile, nsAutoString *pName, nsISupportsArray *pArray, nsIImportService *pImport);</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-private:</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineminus">-    PRUint32    m_depth;</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-};</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineminus">-</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineminus">-#endif /* nsComm4xMail_h__ */</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">deleted file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMailImport.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ /dev/null</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -1,352 +0,0 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineminus">- *</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">- *</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">- * License.</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">- *</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">- *</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">- *</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineminus">- *</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">- *</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-/*</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-  Comm4xMail import mail interface</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineminus">-</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-*/</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineminus">-#ifdef MOZ_LOGGING</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineminus">-// sorry, this has to be before the pre-compiled header</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-#define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineminus">-#endif</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineminus">-</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-#include &quot;nscore.h&quot;</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-#include &quot;nsStringGlue.h&quot;</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineminus">-#include &quot;nsIImportService.h&quot;</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineminus">-#include &quot;nsIComponentManager.h&quot;</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineminus">-#include &quot;nsComm4xMailImport.h&quot;</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineminus">-#include &quot;nsIMemory.h&quot;</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineminus">-#include &quot;nsXPCOM.h&quot;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineminus">-#include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineminus">-#include &quot;nsIImportService.h&quot;</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineminus">-#include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineminus">-#include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineminus">-#include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineminus">-#include &quot;nsIOutputStream.h&quot;</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-#include &quot;nsTextFormatter.h&quot;</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-#include &quot;nsComm4xMailStringBundle.h&quot;</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineminus">-#include &quot;nsIStringBundle.h&quot;</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineminus">-#include &quot;Comm4xMailDebugLog.h&quot;</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-#include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-#define COMM4XMAIL_MSGS_URL   &quot;chrome://messenger/locale/comm4xMailImportMsgs.properties&quot;</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-PRLogModuleInfo *COMM4XLOGMODULE = nsnull;</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineminus">-////////////////////////////////////////////////////////////////////////</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-////////////////////////////////////////////////////////////////////////</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineminus">-</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineminus">-</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineminus">-nsComm4xMailImport::nsComm4xMailImport()</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-{</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineminus">-    // Init logging module.</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineminus">-    if (!COMM4XLOGMODULE)</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineminus">-      COMM4XLOGMODULE = PR_NewLogModule(&quot;IMPORT&quot;);</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineminus">-</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineminus">-    IMPORT_LOG0(&quot;nsComm4xMailImport Module Created\n&quot;);</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineminus">-</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineminus">-    nsCOMPtr &lt;nsIStringBundleService&gt; pBundleService;</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineminus">-    nsresult rv;</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineminus">-    m_pBundle = nsnull;</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineminus">-</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineminus">-    pBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; (pBundleService))</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineminus">-           pBundleService-&gt;CreateBundle(COMM4XMAIL_MSGS_URL, getter_AddRefs(m_pBundle));</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineminus">-}</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineminus">-nsComm4xMailImport::~nsComm4xMailImport()</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineminus">-{</span>
<a href="#l20.105"></a><span id="l20.105" class="difflineminus">-</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineminus">-    IMPORT_LOG0(&quot;nsComm4xMailImport Module Deleted\n&quot;);</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineminus">-</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineminus">-}</span>
<a href="#l20.109"></a><span id="l20.109" class="difflineminus">-</span>
<a href="#l20.110"></a><span id="l20.110" class="difflineminus">-</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineminus">-</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineminus">-NS_IMPL_THREADSAFE_ISUPPORTS1(nsComm4xMailImport, nsIImportModule)</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineminus">-</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineminus">-</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineminus">-NS_IMETHODIMP nsComm4xMailImport::GetName(PRUnichar **name)</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineminus">-{</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineminus">-  NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l20.118"></a><span id="l20.118" class="difflineminus">-  if (m_pBundle)</span>
<a href="#l20.119"></a><span id="l20.119" class="difflineminus">-    return m_pBundle-&gt;GetStringFromName(NS_LITERAL_STRING(COMM4XMAILIMPORT_NAME).get(),</span>
<a href="#l20.120"></a><span id="l20.120" class="difflineminus">-                                        name);</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineminus">-}</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineminus">-</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineminus">-NS_IMETHODIMP nsComm4xMailImport::GetDescription(PRUnichar **name)</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineminus">-{</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineminus">-  NS_ENSURE_ARG_POINTER (name);</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineminus">-  nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l20.128"></a><span id="l20.128" class="difflineminus">-  if (m_pBundle)</span>
<a href="#l20.129"></a><span id="l20.129" class="difflineminus">-    rv = m_pBundle-&gt;GetStringFromID(COMM4XMAILIMPORT_DESCRIPTION, name);</span>
<a href="#l20.130"></a><span id="l20.130" class="difflineminus">-  return rv;</span>
<a href="#l20.131"></a><span id="l20.131" class="difflineminus">-}</span>
<a href="#l20.132"></a><span id="l20.132" class="difflineminus">-</span>
<a href="#l20.133"></a><span id="l20.133" class="difflineminus">-NS_IMETHODIMP nsComm4xMailImport::GetSupports(char **supports)</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineminus">-{</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineminus">-  NS_ENSURE_ARG_POINTER (supports);</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineminus">-  *supports = strdup(kComm4xMailSupportsString);</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineminus">-  return NS_OK;</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineminus">-}</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineminus">-</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineminus">-NS_IMETHODIMP nsComm4xMailImport::GetSupportsUpgrade(bool *pUpgrade)</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineminus">-{</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineminus">-    NS_ENSURE_ARG_POINTER (pUpgrade);</span>
<a href="#l20.143"></a><span id="l20.143" class="difflineminus">-    *pUpgrade = PR_FALSE;</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineminus">-    return NS_OK;</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineminus">-}</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineminus">-</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineminus">-</span>
<a href="#l20.148"></a><span id="l20.148" class="difflineminus">-NS_IMETHODIMP nsComm4xMailImport::GetImportInterface(const char *pImportType, nsISupports **ppInterface)</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineminus">-{</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineminus">-    NS_ENSURE_ARG_POINTER (pImportType);</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineminus">-    NS_ENSURE_ARG_POINTER (ppInterface);</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineminus">-    *ppInterface = nsnull;</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineminus">-    nsresult    rv;</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineminus">-</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-    if (!strcmp(pImportType, &quot;mail&quot;)) {</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineminus">-        // create the nsIImportMail interface and return it!</span>
<a href="#l20.157"></a><span id="l20.157" class="difflineminus">-        nsCOMPtr &lt;nsIImportMail&gt; pMail = do_CreateInstance(NS_COMM4XMAILIMPL_CONTRACTID, &amp;rv);</span>
<a href="#l20.158"></a><span id="l20.158" class="difflineminus">-        if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.159"></a><span id="l20.159" class="difflineminus">-            nsCOMPtr &lt;nsIImportGeneric&gt; pGeneric;</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineminus">-            nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l20.161"></a><span id="l20.161" class="difflineminus">-            if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.162"></a><span id="l20.162" class="difflineminus">-                rv = impSvc-&gt;CreateNewGenericMail(getter_AddRefs(pGeneric));</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineminus">-                if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.164"></a><span id="l20.164" class="difflineminus">-                    pGeneric-&gt;SetData(&quot;mailInterface&quot;, pMail);</span>
<a href="#l20.165"></a><span id="l20.165" class="difflineminus">-                    nsString name;</span>
<a href="#l20.166"></a><span id="l20.166" class="difflineminus">-                    rv = GetName(getter_Copies(name));</span>
<a href="#l20.167"></a><span id="l20.167" class="difflineminus">-                    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.168"></a><span id="l20.168" class="difflineminus">-</span>
<a href="#l20.169"></a><span id="l20.169" class="difflineminus">-                    nsCOMPtr&lt;nsISupportsString&gt; nameString (do_CreateInstance(NS_SUPPORTS_STRING_CONTRACTID, &amp;rv));</span>
<a href="#l20.170"></a><span id="l20.170" class="difflineminus">-                    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.171"></a><span id="l20.171" class="difflineminus">-                    nameString-&gt;SetData(name);</span>
<a href="#l20.172"></a><span id="l20.172" class="difflineminus">-                    pGeneric-&gt;SetData(&quot;name&quot;, nameString);</span>
<a href="#l20.173"></a><span id="l20.173" class="difflineminus">-                    rv = CallQueryInterface(pGeneric, ppInterface);</span>
<a href="#l20.174"></a><span id="l20.174" class="difflineminus">-                }</span>
<a href="#l20.175"></a><span id="l20.175" class="difflineminus">-            }</span>
<a href="#l20.176"></a><span id="l20.176" class="difflineminus">-        }</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineminus">-        return rv;</span>
<a href="#l20.178"></a><span id="l20.178" class="difflineminus">-    }</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineminus">-</span>
<a href="#l20.180"></a><span id="l20.180" class="difflineminus">-    return NS_ERROR_NOT_AVAILABLE;</span>
<a href="#l20.181"></a><span id="l20.181" class="difflineminus">-}</span>
<a href="#l20.182"></a><span id="l20.182" class="difflineminus">-</span>
<a href="#l20.183"></a><span id="l20.183" class="difflineminus">-/////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineminus">-</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineminus">-ImportComm4xMailImpl::ImportComm4xMailImpl()</span>
<a href="#l20.186"></a><span id="l20.186" class="difflineminus">-{</span>
<a href="#l20.187"></a><span id="l20.187" class="difflineminus">-}</span>
<a href="#l20.188"></a><span id="l20.188" class="difflineminus">-</span>
<a href="#l20.189"></a><span id="l20.189" class="difflineminus">-nsresult ImportComm4xMailImpl::Initialize()</span>
<a href="#l20.190"></a><span id="l20.190" class="difflineminus">-{</span>
<a href="#l20.191"></a><span id="l20.191" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; pBundleService;</span>
<a href="#l20.192"></a><span id="l20.192" class="difflineminus">-  nsresult rv;</span>
<a href="#l20.193"></a><span id="l20.193" class="difflineminus">-</span>
<a href="#l20.194"></a><span id="l20.194" class="difflineminus">-  pBundleService = do_GetService(NS_STRINGBUNDLE_CONTRACTID, &amp;rv);</span>
<a href="#l20.195"></a><span id="l20.195" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.196"></a><span id="l20.196" class="difflineminus">-  return pBundleService-&gt;CreateBundle(COMM4XMAIL_MSGS_URL, getter_AddRefs(m_pBundle));</span>
<a href="#l20.197"></a><span id="l20.197" class="difflineminus">-}</span>
<a href="#l20.198"></a><span id="l20.198" class="difflineminus">-</span>
<a href="#l20.199"></a><span id="l20.199" class="difflineminus">-ImportComm4xMailImpl::~ImportComm4xMailImpl()</span>
<a href="#l20.200"></a><span id="l20.200" class="difflineminus">-{</span>
<a href="#l20.201"></a><span id="l20.201" class="difflineminus">-}</span>
<a href="#l20.202"></a><span id="l20.202" class="difflineminus">-</span>
<a href="#l20.203"></a><span id="l20.203" class="difflineminus">-</span>
<a href="#l20.204"></a><span id="l20.204" class="difflineminus">-</span>
<a href="#l20.205"></a><span id="l20.205" class="difflineminus">-NS_IMPL_THREADSAFE_ISUPPORTS1(ImportComm4xMailImpl, nsIImportMail)</span>
<a href="#l20.206"></a><span id="l20.206" class="difflineminus">-</span>
<a href="#l20.207"></a><span id="l20.207" class="difflineminus">-NS_IMETHODIMP ImportComm4xMailImpl::GetDefaultLocation(nsIFile **ppLoc, bool *found, bool *userVerify)</span>
<a href="#l20.208"></a><span id="l20.208" class="difflineminus">-{</span>
<a href="#l20.209"></a><span id="l20.209" class="difflineminus">-    NS_ENSURE_ARG_POINTER(found);</span>
<a href="#l20.210"></a><span id="l20.210" class="difflineminus">-    NS_ENSURE_ARG_POINTER(ppLoc);</span>
<a href="#l20.211"></a><span id="l20.211" class="difflineminus">-    NS_ENSURE_ARG_POINTER(userVerify);</span>
<a href="#l20.212"></a><span id="l20.212" class="difflineminus">-</span>
<a href="#l20.213"></a><span id="l20.213" class="difflineminus">-    *ppLoc = nsnull;</span>
<a href="#l20.214"></a><span id="l20.214" class="difflineminus">-    *found = PR_FALSE;</span>
<a href="#l20.215"></a><span id="l20.215" class="difflineminus">-    *userVerify = PR_TRUE;</span>
<a href="#l20.216"></a><span id="l20.216" class="difflineminus">-    return NS_OK;</span>
<a href="#l20.217"></a><span id="l20.217" class="difflineminus">-}</span>
<a href="#l20.218"></a><span id="l20.218" class="difflineminus">-</span>
<a href="#l20.219"></a><span id="l20.219" class="difflineminus">-</span>
<a href="#l20.220"></a><span id="l20.220" class="difflineminus">-NS_IMETHODIMP ImportComm4xMailImpl::FindMailboxes(nsIFile *pLoc, nsISupportsArray **ppArray)</span>
<a href="#l20.221"></a><span id="l20.221" class="difflineminus">-{</span>
<a href="#l20.222"></a><span id="l20.222" class="difflineminus">-    NS_ENSURE_ARG_POINTER(pLoc);</span>
<a href="#l20.223"></a><span id="l20.223" class="difflineminus">-    NS_ENSURE_ARG_POINTER(ppArray);</span>
<a href="#l20.224"></a><span id="l20.224" class="difflineminus">-</span>
<a href="#l20.225"></a><span id="l20.225" class="difflineminus">-    bool exists = false;</span>
<a href="#l20.226"></a><span id="l20.226" class="difflineminus">-    nsresult rv = pLoc-&gt;Exists(&amp;exists);</span>
<a href="#l20.227"></a><span id="l20.227" class="difflineminus">-    if (NS_FAILED(rv) || !exists)</span>
<a href="#l20.228"></a><span id="l20.228" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l20.229"></a><span id="l20.229" class="difflineminus">-</span>
<a href="#l20.230"></a><span id="l20.230" class="difflineminus">-    // find mail boxes</span>
<a href="#l20.231"></a><span id="l20.231" class="difflineminus">-    rv = m_mail.FindMailboxes(pLoc, ppArray);</span>
<a href="#l20.232"></a><span id="l20.232" class="difflineminus">-</span>
<a href="#l20.233"></a><span id="l20.233" class="difflineminus">-    if (NS_FAILED(rv) &amp;&amp; *ppArray) {</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineminus">-        NS_RELEASE(*ppArray);</span>
<a href="#l20.235"></a><span id="l20.235" class="difflineminus">-        *ppArray = nsnull;</span>
<a href="#l20.236"></a><span id="l20.236" class="difflineminus">-    }</span>
<a href="#l20.237"></a><span id="l20.237" class="difflineminus">-</span>
<a href="#l20.238"></a><span id="l20.238" class="difflineminus">-    return rv;</span>
<a href="#l20.239"></a><span id="l20.239" class="difflineminus">-}</span>
<a href="#l20.240"></a><span id="l20.240" class="difflineminus">-</span>
<a href="#l20.241"></a><span id="l20.241" class="difflineminus">-void ImportComm4xMailImpl::ReportStatus( PRInt32 errorNum, nsString&amp; name, nsString *pStream)</span>
<a href="#l20.242"></a><span id="l20.242" class="difflineminus">-{</span>
<a href="#l20.243"></a><span id="l20.243" class="difflineminus">-    if (!pStream) return;</span>
<a href="#l20.244"></a><span id="l20.244" class="difflineminus">-    nsString statusStr;</span>
<a href="#l20.245"></a><span id="l20.245" class="difflineminus">-    const PRUnichar * fmtStr = name.get();</span>
<a href="#l20.246"></a><span id="l20.246" class="difflineminus">-    nsresult rv = m_pBundle-&gt;FormatStringFromID(errorNum, &amp;fmtStr, 1, getter_Copies(statusStr));</span>
<a href="#l20.247"></a><span id="l20.247" class="difflineminus">-    if (NS_SUCCEEDED (rv)) {</span>
<a href="#l20.248"></a><span id="l20.248" class="difflineminus">-        pStream-&gt;Append (statusStr.get());</span>
<a href="#l20.249"></a><span id="l20.249" class="difflineminus">-        pStream-&gt;Append( PRUnichar('\n'));</span>
<a href="#l20.250"></a><span id="l20.250" class="difflineminus">-    }</span>
<a href="#l20.251"></a><span id="l20.251" class="difflineminus">-</span>
<a href="#l20.252"></a><span id="l20.252" class="difflineminus">-}</span>
<a href="#l20.253"></a><span id="l20.253" class="difflineminus">-</span>
<a href="#l20.254"></a><span id="l20.254" class="difflineminus">-void ImportComm4xMailImpl::SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess)</span>
<a href="#l20.255"></a><span id="l20.255" class="difflineminus">-{</span>
<a href="#l20.256"></a><span id="l20.256" class="difflineminus">-    if (pError)</span>
<a href="#l20.257"></a><span id="l20.257" class="difflineminus">-        *pError = ToNewUnicode(error);</span>
<a href="#l20.258"></a><span id="l20.258" class="difflineminus">-    if (pSuccess)</span>
<a href="#l20.259"></a><span id="l20.259" class="difflineminus">-        *pSuccess = ToNewUnicode(success);</span>
<a href="#l20.260"></a><span id="l20.260" class="difflineminus">-}</span>
<a href="#l20.261"></a><span id="l20.261" class="difflineminus">-</span>
<a href="#l20.262"></a><span id="l20.262" class="difflineminus">-NS_IMETHODIMP ImportComm4xMailImpl::ImportMailbox(nsIImportMailboxDescriptor *pSource,</span>
<a href="#l20.263"></a><span id="l20.263" class="difflineminus">-                                                nsIFile *pDestination,</span>
<a href="#l20.264"></a><span id="l20.264" class="difflineminus">-                                                PRUnichar **pErrorLog,</span>
<a href="#l20.265"></a><span id="l20.265" class="difflineminus">-                                                PRUnichar **pSuccessLog,</span>
<a href="#l20.266"></a><span id="l20.266" class="difflineminus">-                                                bool *fatalError)</span>
<a href="#l20.267"></a><span id="l20.267" class="difflineminus">-{</span>
<a href="#l20.268"></a><span id="l20.268" class="difflineminus">-    NS_PRECONDITION(pSource != nsnull, &quot;null ptr&quot;);</span>
<a href="#l20.269"></a><span id="l20.269" class="difflineminus">-    NS_PRECONDITION(pDestination != nsnull, &quot;null ptr&quot;);</span>
<a href="#l20.270"></a><span id="l20.270" class="difflineminus">-    NS_PRECONDITION(fatalError != nsnull, &quot;null ptr&quot;);</span>
<a href="#l20.271"></a><span id="l20.271" class="difflineminus">-</span>
<a href="#l20.272"></a><span id="l20.272" class="difflineminus">-    nsString    success;</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineminus">-    nsString    error;</span>
<a href="#l20.274"></a><span id="l20.274" class="difflineminus">-    if (!pSource || !pDestination || !fatalError) {</span>
<a href="#l20.275"></a><span id="l20.275" class="difflineminus">-        nsString errorString;</span>
<a href="#l20.276"></a><span id="l20.276" class="difflineminus">-        m_pBundle-&gt;GetStringFromID(COMM4XMAILIMPORT_MAILBOX_BADPARAM, getter_Copies(errorString));</span>
<a href="#l20.277"></a><span id="l20.277" class="difflineminus">-        error = errorString;</span>
<a href="#l20.278"></a><span id="l20.278" class="difflineminus">-        if (fatalError)</span>
<a href="#l20.279"></a><span id="l20.279" class="difflineminus">-            *fatalError = PR_TRUE;</span>
<a href="#l20.280"></a><span id="l20.280" class="difflineminus">-        SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l20.281"></a><span id="l20.281" class="difflineminus">-        return NS_ERROR_NULL_POINTER;</span>
<a href="#l20.282"></a><span id="l20.282" class="difflineminus">-    }</span>
<a href="#l20.283"></a><span id="l20.283" class="difflineminus">-</span>
<a href="#l20.284"></a><span id="l20.284" class="difflineminus">-    nsString    name;</span>
<a href="#l20.285"></a><span id="l20.285" class="difflineminus">-    PRUnichar *    pName;</span>
<a href="#l20.286"></a><span id="l20.286" class="difflineminus">-    if (NS_SUCCEEDED(pSource-&gt;GetDisplayName(&amp;pName))) {</span>
<a href="#l20.287"></a><span id="l20.287" class="difflineminus">-        name.Adopt(pName);</span>
<a href="#l20.288"></a><span id="l20.288" class="difflineminus">-    }</span>
<a href="#l20.289"></a><span id="l20.289" class="difflineminus">-</span>
<a href="#l20.290"></a><span id="l20.290" class="difflineminus">-    PRUint32 mailSize = 0;</span>
<a href="#l20.291"></a><span id="l20.291" class="difflineminus">-    pSource-&gt;GetSize(&amp;mailSize);</span>
<a href="#l20.292"></a><span id="l20.292" class="difflineminus">-    if (mailSize == 0) {</span>
<a href="#l20.293"></a><span id="l20.293" class="difflineminus">-        ReportStatus(COMM4XMAILIMPORT_MAILBOX_SUCCESS, name, &amp;success);</span>
<a href="#l20.294"></a><span id="l20.294" class="difflineminus">-        SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l20.295"></a><span id="l20.295" class="difflineminus">-        return NS_OK;</span>
<a href="#l20.296"></a><span id="l20.296" class="difflineminus">-    }</span>
<a href="#l20.297"></a><span id="l20.297" class="difflineminus">-</span>
<a href="#l20.298"></a><span id="l20.298" class="difflineminus">-    PRUint32 index = 0;</span>
<a href="#l20.299"></a><span id="l20.299" class="difflineminus">-    pSource-&gt;GetIdentifier(&amp;index);</span>
<a href="#l20.300"></a><span id="l20.300" class="difflineminus">-    nsresult rv = NS_OK;</span>
<a href="#l20.301"></a><span id="l20.301" class="difflineminus">-</span>
<a href="#l20.302"></a><span id="l20.302" class="difflineminus">-    m_bytesDone = 0;</span>
<a href="#l20.303"></a><span id="l20.303" class="difflineminus">-</span>
<a href="#l20.304"></a><span id="l20.304" class="difflineminus">-    // copy files from 4.x to here.</span>
<a href="#l20.305"></a><span id="l20.305" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; inFile;</span>
<a href="#l20.306"></a><span id="l20.306" class="difflineminus">-    if (NS_FAILED(pSource-&gt;GetFile(getter_AddRefs(inFile)))) {</span>
<a href="#l20.307"></a><span id="l20.307" class="difflineminus">-        ReportStatus(COMM4XMAILIMPORT_MAILBOX_CONVERTERROR, name, &amp;error);</span>
<a href="#l20.308"></a><span id="l20.308" class="difflineminus">-        SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l20.309"></a><span id="l20.309" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l20.310"></a><span id="l20.310" class="difflineminus">-    }</span>
<a href="#l20.311"></a><span id="l20.311" class="difflineminus">-</span>
<a href="#l20.312"></a><span id="l20.312" class="difflineminus">-    nsCString pSrcPath, pDestPath;;</span>
<a href="#l20.313"></a><span id="l20.313" class="difflineminus">-    inFile-&gt;GetNativePath(pSrcPath);</span>
<a href="#l20.314"></a><span id="l20.314" class="difflineminus">-    pDestination -&gt;GetNativePath(pDestPath);</span>
<a href="#l20.315"></a><span id="l20.315" class="difflineminus">-    IMPORT_LOG2(&quot;ImportComm4xMailImpl::ImportMailbox: Copying folder from '%s' to '%s'.&quot;, pSrcPath.get(), pDestPath.get());</span>
<a href="#l20.316"></a><span id="l20.316" class="difflineminus">-</span>
<a href="#l20.317"></a><span id="l20.317" class="difflineminus">-    nsCOMPtr &lt;nsIFile&gt; parent;</span>
<a href="#l20.318"></a><span id="l20.318" class="difflineminus">-    if (NS_FAILED (pDestination-&gt;GetParent(getter_AddRefs(parent))))</span>
<a href="#l20.319"></a><span id="l20.319" class="difflineminus">-    {</span>
<a href="#l20.320"></a><span id="l20.320" class="difflineminus">-        ReportStatus( COMM4XMAILIMPORT_MAILBOX_CONVERTERROR, name, &amp;error);</span>
<a href="#l20.321"></a><span id="l20.321" class="difflineminus">-        SetLogs( success, error, pErrorLog, pSuccessLog);</span>
<a href="#l20.322"></a><span id="l20.322" class="difflineminus">-        return( NS_ERROR_FAILURE);</span>
<a href="#l20.323"></a><span id="l20.323" class="difflineminus">-    }</span>
<a href="#l20.324"></a><span id="l20.324" class="difflineminus">-    bool exists = false;</span>
<a href="#l20.325"></a><span id="l20.325" class="difflineminus">-    pDestination-&gt;Exists(&amp;exists);</span>
<a href="#l20.326"></a><span id="l20.326" class="difflineminus">-    if (exists)</span>
<a href="#l20.327"></a><span id="l20.327" class="difflineminus">-        rv = pDestination-&gt;Remove(PR_FALSE);</span>
<a href="#l20.328"></a><span id="l20.328" class="difflineminus">-    rv = inFile-&gt;CopyTo(parent, EmptyString());</span>
<a href="#l20.329"></a><span id="l20.329" class="difflineminus">-</span>
<a href="#l20.330"></a><span id="l20.330" class="difflineminus">-    if (NS_SUCCEEDED(rv)) {</span>
<a href="#l20.331"></a><span id="l20.331" class="difflineminus">-        m_bytesDone = mailSize;</span>
<a href="#l20.332"></a><span id="l20.332" class="difflineminus">-        ReportStatus(COMM4XMAILIMPORT_MAILBOX_SUCCESS, name, &amp;success);</span>
<a href="#l20.333"></a><span id="l20.333" class="difflineminus">-    }</span>
<a href="#l20.334"></a><span id="l20.334" class="difflineminus">-    else {</span>
<a href="#l20.335"></a><span id="l20.335" class="difflineminus">-        ReportStatus(COMM4XMAILIMPORT_MAILBOX_CONVERTERROR, name, &amp;error);</span>
<a href="#l20.336"></a><span id="l20.336" class="difflineminus">-    }</span>
<a href="#l20.337"></a><span id="l20.337" class="difflineminus">-</span>
<a href="#l20.338"></a><span id="l20.338" class="difflineminus">-    SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l20.339"></a><span id="l20.339" class="difflineminus">-</span>
<a href="#l20.340"></a><span id="l20.340" class="difflineminus">-    return rv;</span>
<a href="#l20.341"></a><span id="l20.341" class="difflineminus">-}</span>
<a href="#l20.342"></a><span id="l20.342" class="difflineminus">-</span>
<a href="#l20.343"></a><span id="l20.343" class="difflineminus">-</span>
<a href="#l20.344"></a><span id="l20.344" class="difflineminus">-NS_IMETHODIMP ImportComm4xMailImpl::GetImportProgress(PRUint32 *pDoneSoFar)</span>
<a href="#l20.345"></a><span id="l20.345" class="difflineminus">-{</span>
<a href="#l20.346"></a><span id="l20.346" class="difflineminus">-    NS_ENSURE_ARG_POINTER(pDoneSoFar);</span>
<a href="#l20.347"></a><span id="l20.347" class="difflineminus">-</span>
<a href="#l20.348"></a><span id="l20.348" class="difflineminus">-    *pDoneSoFar = m_bytesDone;</span>
<a href="#l20.349"></a><span id="l20.349" class="difflineminus">-    return NS_OK;</span>
<a href="#l20.350"></a><span id="l20.350" class="difflineminus">-}</span>
<a href="#l20.351"></a><span id="l20.351" class="difflineminus">-</span>
<a href="#l20.352"></a><span id="l20.352" class="difflineminus">-NS_IMETHODIMP ImportComm4xMailImpl::TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval)</span>
<a href="#l20.353"></a><span id="l20.353" class="difflineminus">-{</span>
<a href="#l20.354"></a><span id="l20.354" class="difflineminus">-  _retval = aFolderName;</span>
<a href="#l20.355"></a><span id="l20.355" class="difflineminus">-  return NS_OK;</span>
<a href="#l20.356"></a><span id="l20.356" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">deleted file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMailImport.h</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ /dev/null</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -1,116 +0,0 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">- *</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">- *</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">- * License.</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">- *</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">- *</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">- *</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">- *</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">- *</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineminus">-#ifndef nsComm4xMailImport_h___</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineminus">-#define nsComm4xMailImport_h___</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-#include &quot;nsIImportModule.h&quot;</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-#include &quot;nsIStringBundle.h&quot;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-#include &quot;nsIImportMail.h&quot;</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-#include &quot;nsIFile.h&quot;</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineminus">-#include &quot;nsComm4xMail.h&quot;</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-//{7792e9e0-412a-11d6-92bf-0010a4b26cda}</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-#define NS_COMM4XMAILIMPL_CID \</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-{ 0x7792e9e0, 0x412a, 0x11d6, { 0x92, 0xbf, 0x0, 0x10, 0xa4, 0xb2, 0x6c, 0xda } }</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-#define NS_COMM4XMAILIMPL_CONTRACTID &quot;@mozilla.org/import/import-comm4xMailImpl;1&quot; </span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-// {647cc990-2bdb-11d6-92a0-0010a4b26cda}</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-#define NS_COMM4XMAILIMPORT_CID                 \</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-{ 0x647ff990, 0x2bdb, 0x11d6, { 0x92, 0xa0, 0x0, 0x10, 0xa4, 0xb2, 0x6c, 0xda } }</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineminus">-#define kComm4xMailSupportsString NS_IMPORT_MAIL_STR</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineminus">-</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineminus">-class nsComm4xMailImport : public nsIImportModule</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-{</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-public:</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">-</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-    nsComm4xMailImport();</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">-    virtual ~nsComm4xMailImport();</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">-    </span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-    NS_DECL_ISUPPORTS</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineminus">-    ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineminus">-    // we suppport the nsIImportModule interface </span>
<a href="#l21.74"></a><span id="l21.74" class="difflineminus">-    ////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineminus">-</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineminus">-    NS_DECL_NSIIMPORTMODULE</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineminus">-</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineminus">-protected:</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-     nsCOMPtr&lt;nsIStringBundle&gt;  m_pBundle;</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineminus">-};</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineminus">-</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineminus">-class ImportComm4xMailImpl : public nsIImportMail</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineminus">-{</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineminus">-public:</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineminus">-    ImportComm4xMailImpl();</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">-    virtual ~ImportComm4xMailImpl();</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">-</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineminus">-    // nsISupports interface</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-    NS_DECL_ISUPPORTS</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineminus">-    // nsIImportMail interface</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-    </span>
<a href="#l21.93"></a><span id="l21.93" class="difflineminus">-    /* void GetDefaultLocation (out nsIFile location, out boolean found, out boolean userVerify); */</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineminus">-    NS_IMETHOD GetDefaultLocation(nsIFile **location, bool *found, bool *userVerify);</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineminus">-</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-    /* nsISupportsArray FindMailboxes (in nsIFile location); */</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineminus">-    NS_IMETHOD FindMailboxes(nsIFile *location, nsISupportsArray **_retval);</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineminus">-</span>
<a href="#l21.99"></a><span id="l21.99" class="difflineminus">-    /* void ImportMailbox (in nsIImportMailboxDescriptor source, in nsIFile destination, out boolean fatalError); */</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-    NS_IMETHOD ImportMailbox(nsIImportMailboxDescriptor *source, nsIFile *destination, </span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-                             PRUnichar **pErrorLog, PRUnichar **pSuccessLog, bool *fatalError);</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-    /* unsigned long GetImportProgress (); */</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-    NS_IMETHOD GetImportProgress(PRUint32 *_retval);</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineminus">-    NS_IMETHOD TranslateFolderName(const nsAString &amp; aFolderName, nsAString &amp; _retval);</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineminus">-</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-public:</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-    static void SetLogs(nsString&amp; success, nsString&amp; error, PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineminus">-    void ReportStatus(PRInt32 errorNum, nsString&amp; name, nsString *pStream);</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineminus">-    nsresult Initialize();</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineminus">-</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-private:</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineminus">-    nsComm4xMail  m_mail;</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineminus">-    PRUint32      m_bytesDone;</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt;  m_pBundle;</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineminus">-};</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineminus">-</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-#endif /* nsComm4xMailImport_h___ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">deleted file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xMailStringBundle.h</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ /dev/null</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -1,46 +0,0 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineminus">- *</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">- *</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">- * License.</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">- *</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">- *</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">- *</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">- *</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">- *</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineminus">-#ifndef nsComm4xMailStringBundle_H__</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-#define nsComm4xMailStringBundle_H__</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-#define COMM4XMAILIMPORT_NAME                 &quot;comm4xImportName&quot;</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineminus">-#define COMM4XMAILIMPORT_DESCRIPTION                            2001</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineminus">-#define COMM4XMAILIMPORT_MAILBOX_SUCCESS                        2002</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">-#define COMM4XMAILIMPORT_MAILBOX_BADPARAM                       2003</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineminus">-#define COMM4XMAILIMPORT_MAILBOX_CONVERTERROR                   2004</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineminus">-</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-#endif /* nsComm4xMailStringBundle_H__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">deleted file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xProfile.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ /dev/null</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -1,284 +0,0 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineminus">- *</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">- *</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">- * License.</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">- *</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">- *</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">- *</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">- *</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">- *</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineminus">-</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-#include &quot;nsComm4xProfile.h&quot;</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-#include &quot;nsIFileStreams.h&quot;</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-#include &quot;nsILineInputStream.h&quot;</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineminus">-#include &quot;nsNetCID.h&quot;</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineminus">-#include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineminus">-#include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineminus">-#include &quot;NSReg.h&quot;</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineminus">-</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineminus">-#ifdef XP_UNIX</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineminus">-#include &lt;limits.h&gt;</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineminus">-#endif</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">-</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineminus">-#if defined(XP_MACOSX)</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineminus">-#define PREF_FILE_NAME_IN_4x &quot;Netscape Preferences&quot;</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineminus">-#define OLDREG_NAME               &quot;Netscape Registry&quot;</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineminus">-#define OLDREG_DIR                NS_MAC_PREFS_DIR</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineminus">-#elif defined(XP_UNIX) &amp;&amp; !defined(XP_MACOSX)</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineminus">-#define PREF_FILE_NAME_IN_4x &quot;preferences.js&quot;</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineminus">-#elif defined(XP_WIN) || defined(XP_OS2)</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">-#define PREF_FILE_NAME_IN_4x &quot;prefs.js&quot;</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineminus">-#define OLDREG_NAME               &quot;nsreg.dat&quot;</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineminus">-#ifdef XP_WIN</span>
<a href="#l23.66"></a><span id="l23.66" class="difflineminus">-#define OLDREG_DIR                NS_WIN_WINDOWS_DIR</span>
<a href="#l23.67"></a><span id="l23.67" class="difflineminus">-#else</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineminus">-#define OLDREG_DIR                NS_OS2_DIR</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineminus">-#endif</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineminus">-#else</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineminus">-/* this will cause a failure at run time, as it should, since we don't know</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineminus">-   how to migrate platforms other than Mac, Windows and UNIX */</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineminus">-#define PREF_FILE_NAME_IN_4x &quot;&quot;</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-#endif</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineminus">-</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineminus">-#ifndef MAXPATHLEN</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineminus">-#ifdef PATH_MAX</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineminus">-#define MAXPATHLEN PATH_MAX</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineminus">-#elif defined(_MAX_PATH)</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineminus">-#define MAXPATHLEN _MAX_PATH</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineminus">-#elif defined(CCHMAXPATH)</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-#define MAXPATHLEN CCHMAXPATH</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineminus">-#else</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineminus">-#define MAXPATHLEN 1024</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineminus">-#endif</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineminus">-#endif</span>
<a href="#l23.87"></a><span id="l23.87" class="difflineminus">-</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineminus">-nsComm4xProfile::nsComm4xProfile()</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineminus">-{</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-}</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-nsComm4xProfile::~nsComm4xProfile()</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineminus">-{</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineminus">-}</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineminus">-</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineminus">-NS_IMPL_ISUPPORTS1(nsComm4xProfile, nsIComm4xProfile)</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineminus">-</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineminus">-nsComm4xProfile::GetProfileList(PRUint32 *length, PRUnichar ***profileNames)</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineminus">-{</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineminus">-// on win/mac/os2, NS4x uses a registry to determine profile locations</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineminus">-#if defined(XP_WIN) || defined(XP_MACOSX) || defined(XP_OS2)</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineminus">-    nsresult rv;</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineminus">-</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; regFile;</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineminus">-    rv = NS_GetSpecialDirectory(OLDREG_DIR, getter_AddRefs(regFile));</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineminus">-    regFile-&gt;AppendNative(NS_LITERAL_CSTRING(OLDREG_NAME));</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineminus">-</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineminus">-    nsCAutoString path;</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineminus">-    rv = regFile-&gt;GetNativePath(path);</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineminus">-</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineminus">-    if (NR_StartupRegistry())</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineminus">-      return NS_ERROR_FAILURE;</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineminus">-</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineminus">-    HREG reg = nsnull;</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineminus">-    if (NR_RegOpen(path.get(), &amp;reg)) {</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineminus">-      NR_ShutdownRegistry();</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineminus">-      return NS_ERROR_FAILURE;</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineminus">-    }</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineminus">-</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineminus">-    PRInt32 numProfileEntries = 0;</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineminus">-    REGENUM enumstate = 0;</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineminus">-    PRInt32 localLength = 0;</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineminus">-</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-    char profileName[MAXREGNAMELEN];</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineminus">-    while (!NR_RegEnumSubkeys(reg, ROOTKEY_USERS, &amp;enumstate,</span>
<a href="#l23.129"></a><span id="l23.129" class="difflineminus">-                              profileName, MAXREGNAMELEN, REGENUM_CHILDREN))</span>
<a href="#l23.130"></a><span id="l23.130" class="difflineminus">-        numProfileEntries++;</span>
<a href="#l23.131"></a><span id="l23.131" class="difflineminus">-</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineminus">-    // reset our enumerator</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineminus">-    enumstate = 0;</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineminus">-</span>
<a href="#l23.135"></a><span id="l23.135" class="difflineminus">-    PRUnichar **outArray, **next;</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineminus">-    next = outArray = (PRUnichar **)NS_Alloc(numProfileEntries * sizeof(PRUnichar *));</span>
<a href="#l23.137"></a><span id="l23.137" class="difflineminus">-    if (!outArray)</span>
<a href="#l23.138"></a><span id="l23.138" class="difflineminus">-        return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l23.139"></a><span id="l23.139" class="difflineminus">-</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineminus">-    while (!NR_RegEnumSubkeys(reg, ROOTKEY_USERS, &amp;enumstate,</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineminus">-                              profileName, MAXREGNAMELEN, REGENUM_CHILDREN)) {</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineminus">-        *next = ToNewUnicode(NS_ConvertUTF8toUTF16(profileName));</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineminus">-        next++;</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineminus">-        localLength++;</span>
<a href="#l23.145"></a><span id="l23.145" class="difflineminus">-    }</span>
<a href="#l23.146"></a><span id="l23.146" class="difflineminus">-</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineminus">-    *profileNames = outArray;</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineminus">-    *length = localLength;</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineminus">-    return NS_OK;</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineminus">-#else</span>
<a href="#l23.151"></a><span id="l23.151" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineminus">-#endif</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineminus">-}</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineminus">-</span>
<a href="#l23.155"></a><span id="l23.155" class="difflineminus">-#define PREF_NAME &quot;user_pref(\&quot;mail.directory\&quot;, \&quot;&quot;</span>
<a href="#l23.156"></a><span id="l23.156" class="difflineminus">-#define PREF_LENGTH 29</span>
<a href="#l23.157"></a><span id="l23.157" class="difflineminus">-#define PREF_END &quot;\&quot;)&quot;</span>
<a href="#l23.158"></a><span id="l23.158" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l23.159"></a><span id="l23.159" class="difflineminus">-nsComm4xProfile::GetMailDir(const PRUnichar *aProfile, PRUnichar **_retval)</span>
<a href="#l23.160"></a><span id="l23.160" class="difflineminus">-{</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineminus">-    NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineminus">-    *_retval = nsnull;</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineminus">-#if defined(XP_WIN) || defined(XP_OS2) || defined(XP_MACOSX)</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineminus">-    nsresult rv;</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; resolvedLocation = do_CreateInstance(&quot;@mozilla.org/file/local;1&quot;);</span>
<a href="#l23.166"></a><span id="l23.166" class="difflineminus">-    // on macos, registry entries are UTF8 encoded</span>
<a href="#l23.167"></a><span id="l23.167" class="difflineminus">-    NS_ConvertUTF16toUTF8 profileName(aProfile);</span>
<a href="#l23.168"></a><span id="l23.168" class="difflineminus">-</span>
<a href="#l23.169"></a><span id="l23.169" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; regFile;</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineminus">-    rv = NS_GetSpecialDirectory(OLDREG_DIR, getter_AddRefs(regFile));</span>
<a href="#l23.171"></a><span id="l23.171" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.172"></a><span id="l23.172" class="difflineminus">-</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineminus">-    regFile-&gt;AppendNative(NS_LITERAL_CSTRING(OLDREG_NAME));</span>
<a href="#l23.174"></a><span id="l23.174" class="difflineminus">-</span>
<a href="#l23.175"></a><span id="l23.175" class="difflineminus">-    nsCAutoString path;</span>
<a href="#l23.176"></a><span id="l23.176" class="difflineminus">-    rv = regFile-&gt;GetNativePath(path);</span>
<a href="#l23.177"></a><span id="l23.177" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.178"></a><span id="l23.178" class="difflineminus">-</span>
<a href="#l23.179"></a><span id="l23.179" class="difflineminus">-    if (NR_StartupRegistry())</span>
<a href="#l23.180"></a><span id="l23.180" class="difflineminus">-        return NS_ERROR_FAILURE;</span>
<a href="#l23.181"></a><span id="l23.181" class="difflineminus">-</span>
<a href="#l23.182"></a><span id="l23.182" class="difflineminus">-    HREG reg = nsnull;</span>
<a href="#l23.183"></a><span id="l23.183" class="difflineminus">-    RKEY profile = nsnull;</span>
<a href="#l23.184"></a><span id="l23.184" class="difflineminus">-</span>
<a href="#l23.185"></a><span id="l23.185" class="difflineminus">-    if (NR_RegOpen(path.get(), &amp;reg))</span>
<a href="#l23.186"></a><span id="l23.186" class="difflineminus">-      goto cleanup;</span>
<a href="#l23.187"></a><span id="l23.187" class="difflineminus">-</span>
<a href="#l23.188"></a><span id="l23.188" class="difflineminus">-    if (NR_RegGetKey(reg, ROOTKEY_USERS, profileName.get(), &amp;profile))</span>
<a href="#l23.189"></a><span id="l23.189" class="difflineminus">-        goto cleanup;</span>
<a href="#l23.190"></a><span id="l23.190" class="difflineminus">-</span>
<a href="#l23.191"></a><span id="l23.191" class="difflineminus">-    char profilePath[MAXPATHLEN];</span>
<a href="#l23.192"></a><span id="l23.192" class="difflineminus">-    if (NR_RegGetEntryString(reg, profile, &quot;ProfileLocation&quot;, profilePath, MAXPATHLEN))</span>
<a href="#l23.193"></a><span id="l23.193" class="difflineminus">-        goto cleanup;</span>
<a href="#l23.194"></a><span id="l23.194" class="difflineminus">-</span>
<a href="#l23.195"></a><span id="l23.195" class="difflineminus">-    resolvedLocation-&gt;InitWithPath(NS_ConvertUTF8toUTF16(profilePath));</span>
<a href="#l23.196"></a><span id="l23.196" class="difflineminus">-    if (resolvedLocation) {</span>
<a href="#l23.197"></a><span id="l23.197" class="difflineminus">-        nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l23.198"></a><span id="l23.198" class="difflineminus">-        rv = resolvedLocation-&gt;Clone(getter_AddRefs(file));</span>
<a href="#l23.199"></a><span id="l23.199" class="difflineminus">-        if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.200"></a><span id="l23.200" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; profileLocation;</span>
<a href="#l23.201"></a><span id="l23.201" class="difflineminus">-        profileLocation = do_QueryInterface(file);</span>
<a href="#l23.202"></a><span id="l23.202" class="difflineminus">-        rv = profileLocation-&gt;AppendNative(NS_LITERAL_CSTRING(PREF_FILE_NAME_IN_4x));</span>
<a href="#l23.203"></a><span id="l23.203" class="difflineminus">-        if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.204"></a><span id="l23.204" class="difflineminus">-        bool exists = false;</span>
<a href="#l23.205"></a><span id="l23.205" class="difflineminus">-        rv = profileLocation-&gt;Exists(&amp;exists);</span>
<a href="#l23.206"></a><span id="l23.206" class="difflineminus">-        if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.207"></a><span id="l23.207" class="difflineminus">-        if (exists) {</span>
<a href="#l23.208"></a><span id="l23.208" class="difflineminus">-            nsString prefValue;</span>
<a href="#l23.209"></a><span id="l23.209" class="difflineminus">-            rv = GetPrefValue(profileLocation, PREF_NAME, PREF_END, getter_Copies(prefValue));</span>
<a href="#l23.210"></a><span id="l23.210" class="difflineminus">-            if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.211"></a><span id="l23.211" class="difflineminus">-            if (!prefValue.IsEmpty()) {</span>
<a href="#l23.212"></a><span id="l23.212" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l23.213"></a><span id="l23.213" class="difflineminus">-                rv = profileLocation-&gt;SetPersistentDescriptor(NS_ConvertUTF16toUTF8(prefValue));</span>
<a href="#l23.214"></a><span id="l23.214" class="difflineminus">-                if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.215"></a><span id="l23.215" class="difflineminus">-                nsAutoString path;</span>
<a href="#l23.216"></a><span id="l23.216" class="difflineminus">-                rv = profileLocation-&gt;GetPath(path);</span>
<a href="#l23.217"></a><span id="l23.217" class="difflineminus">-                if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.218"></a><span id="l23.218" class="difflineminus">-                *_retval = ToNewUnicode(path);</span>
<a href="#l23.219"></a><span id="l23.219" class="difflineminus">-#else</span>
<a href="#l23.220"></a><span id="l23.220" class="difflineminus">-                *_retval = ToNewUnicode(prefValue);</span>
<a href="#l23.221"></a><span id="l23.221" class="difflineminus">-#endif</span>
<a href="#l23.222"></a><span id="l23.222" class="difflineminus">-            }</span>
<a href="#l23.223"></a><span id="l23.223" class="difflineminus">-#if defined(XP_WIN) || defined(XP_OS2) || defined(XP_MACOSX)</span>
<a href="#l23.224"></a><span id="l23.224" class="difflineminus">-            else {</span>
<a href="#l23.225"></a><span id="l23.225" class="difflineminus">-                nsCOMPtr &lt;nsIFile&gt; mailLocation;</span>
<a href="#l23.226"></a><span id="l23.226" class="difflineminus">-                rv =  resolvedLocation-&gt;Clone(getter_AddRefs(mailLocation));</span>
<a href="#l23.227"></a><span id="l23.227" class="difflineminus">-                if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.228"></a><span id="l23.228" class="difflineminus">-                rv = mailLocation-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Mail&quot;));</span>
<a href="#l23.229"></a><span id="l23.229" class="difflineminus">-                if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.230"></a><span id="l23.230" class="difflineminus">-                nsAutoString path;</span>
<a href="#l23.231"></a><span id="l23.231" class="difflineminus">-                rv = mailLocation-&gt;GetPath(path);</span>
<a href="#l23.232"></a><span id="l23.232" class="difflineminus">-                if (NS_FAILED(rv)) return rv;</span>
<a href="#l23.233"></a><span id="l23.233" class="difflineminus">-                *_retval = ToNewUnicode(path);</span>
<a href="#l23.234"></a><span id="l23.234" class="difflineminus">-            }</span>
<a href="#l23.235"></a><span id="l23.235" class="difflineminus">-#endif</span>
<a href="#l23.236"></a><span id="l23.236" class="difflineminus">-        }</span>
<a href="#l23.237"></a><span id="l23.237" class="difflineminus">-    }</span>
<a href="#l23.238"></a><span id="l23.238" class="difflineminus">-</span>
<a href="#l23.239"></a><span id="l23.239" class="difflineminus">-cleanup:</span>
<a href="#l23.240"></a><span id="l23.240" class="difflineminus">-    if (reg)</span>
<a href="#l23.241"></a><span id="l23.241" class="difflineminus">-        NR_RegClose(reg);</span>
<a href="#l23.242"></a><span id="l23.242" class="difflineminus">-    NR_ShutdownRegistry();</span>
<a href="#l23.243"></a><span id="l23.243" class="difflineminus">-    return rv;</span>
<a href="#l23.244"></a><span id="l23.244" class="difflineminus">-#else</span>
<a href="#l23.245"></a><span id="l23.245" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l23.246"></a><span id="l23.246" class="difflineminus">-#endif</span>
<a href="#l23.247"></a><span id="l23.247" class="difflineminus">-}</span>
<a href="#l23.248"></a><span id="l23.248" class="difflineminus">-</span>
<a href="#l23.249"></a><span id="l23.249" class="difflineminus">-nsresult nsComm4xProfile::GetPrefValue(nsILocalFile *filePath, const char * prefName, const char * prefEnd, PRUnichar ** retval)</span>
<a href="#l23.250"></a><span id="l23.250" class="difflineminus">-{</span>
<a href="#l23.251"></a><span id="l23.251" class="difflineminus">-   nsString buffer;</span>
<a href="#l23.252"></a><span id="l23.252" class="difflineminus">-   bool more = true;</span>
<a href="#l23.253"></a><span id="l23.253" class="difflineminus">-   nsresult rv;</span>
<a href="#l23.254"></a><span id="l23.254" class="difflineminus">-   nsCOMPtr&lt;nsIFileInputStream&gt; fileStream(do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv));</span>
<a href="#l23.255"></a><span id="l23.255" class="difflineminus">-   if (NS_FAILED(rv))</span>
<a href="#l23.256"></a><span id="l23.256" class="difflineminus">-     return rv;</span>
<a href="#l23.257"></a><span id="l23.257" class="difflineminus">-   rv = fileStream-&gt;Init(filePath, -1, -1, PR_FALSE);</span>
<a href="#l23.258"></a><span id="l23.258" class="difflineminus">-   if (NS_FAILED(rv))</span>
<a href="#l23.259"></a><span id="l23.259" class="difflineminus">-     return rv;</span>
<a href="#l23.260"></a><span id="l23.260" class="difflineminus">-</span>
<a href="#l23.261"></a><span id="l23.261" class="difflineminus">-   nsCOMPtr&lt;nsILineInputStream&gt; lineStream(do_QueryInterface(fileStream, &amp;rv));</span>
<a href="#l23.262"></a><span id="l23.262" class="difflineminus">-   if (NS_FAILED(rv)) {</span>
<a href="#l23.263"></a><span id="l23.263" class="difflineminus">-     return rv;</span>
<a href="#l23.264"></a><span id="l23.264" class="difflineminus">-   }</span>
<a href="#l23.265"></a><span id="l23.265" class="difflineminus">-   bool found = false;</span>
<a href="#l23.266"></a><span id="l23.266" class="difflineminus">-   PRInt32 offset;</span>
<a href="#l23.267"></a><span id="l23.267" class="difflineminus">-   PRInt32 endOffset;</span>
<a href="#l23.268"></a><span id="l23.268" class="difflineminus">-   while (!found &amp;&amp; more) {</span>
<a href="#l23.269"></a><span id="l23.269" class="difflineminus">-      nsCAutoString cLine;</span>
<a href="#l23.270"></a><span id="l23.270" class="difflineminus">-       rv = lineStream-&gt;ReadLine(cLine, &amp;more);</span>
<a href="#l23.271"></a><span id="l23.271" class="difflineminus">-       if (NS_FAILED(rv))</span>
<a href="#l23.272"></a><span id="l23.272" class="difflineminus">-           break;</span>
<a href="#l23.273"></a><span id="l23.273" class="difflineminus">-       CopyASCIItoUTF16(cLine, buffer);</span>
<a href="#l23.274"></a><span id="l23.274" class="difflineminus">-       offset = buffer.Find(prefName);</span>
<a href="#l23.275"></a><span id="l23.275" class="difflineminus">-       if (offset != -1) {</span>
<a href="#l23.276"></a><span id="l23.276" class="difflineminus">-           endOffset = buffer.Find(prefEnd);</span>
<a href="#l23.277"></a><span id="l23.277" class="difflineminus">-           if (endOffset != -1) {</span>
<a href="#l23.278"></a><span id="l23.278" class="difflineminus">-             *retval = ToNewUnicode(Substring(buffer, offset + PREF_LENGTH, endOffset - (offset + PREF_LENGTH)));</span>
<a href="#l23.279"></a><span id="l23.279" class="difflineminus">-             found = PR_TRUE;</span>
<a href="#l23.280"></a><span id="l23.280" class="difflineminus">-             break;</span>
<a href="#l23.281"></a><span id="l23.281" class="difflineminus">-           }</span>
<a href="#l23.282"></a><span id="l23.282" class="difflineminus">-       }</span>
<a href="#l23.283"></a><span id="l23.283" class="difflineminus">-  }</span>
<a href="#l23.284"></a><span id="l23.284" class="difflineminus">-</span>
<a href="#l23.285"></a><span id="l23.285" class="difflineminus">-  fileStream-&gt;Close();</span>
<a href="#l23.286"></a><span id="l23.286" class="difflineminus">-  return rv;</span>
<a href="#l23.287"></a><span id="l23.287" class="difflineminus">-}</span>
<a href="#l23.288"></a><span id="l23.288" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">deleted file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- a/mailnews/import/comm4x/src/nsComm4xProfile.h</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ /dev/null</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -1,68 +0,0 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineminus">- *</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">- *</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">- * License.</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">- *</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">- *</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">- *</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">- * Contributor(s):</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">- *   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">- *</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">- *</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-#ifndef nsComm4xProfile_h__</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-#define nsComm4xProfile_h__</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-#include &quot;nsISupports.h&quot;</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-#include &quot;nsIFile.h&quot;</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-#include &quot;nsIComm4xProfile.h&quot;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-#include &quot;nsStringGlue.h&quot;</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-/* c66c1060-2bdc-11d6-92a0-0010a4b26cda */</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-#define NS_ICOMM4XPROFILE_CID \</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">- { 0xc66c1060, 0x2bdc, 0x11d6, {0x92, 0xa0, 0x0, 0x10, 0xa4, 0xb2, 0x6c, 0xda} }</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-#define NS_ICOMM4XPROFILE_CONTRACTID    &quot;@mozilla.org/comm4xProfile;1&quot;</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-#define NS_ICOMM4XPROFILE_CLASSNAME &quot;Communicator 4.x Profile&quot;</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineminus">-class nsComm4xProfile : public nsIComm4xProfile</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineminus">-{</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineminus">-public:</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineminus">-    nsComm4xProfile();</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineminus">-    virtual ~nsComm4xProfile();</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineminus">-    nsresult Get4xProfileInfo(const char *registryName);</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineminus">-    nsresult GetPrefValue(nsILocalFile *filePath, const char * prefName, const char * prefEnd, PRUnichar ** value);</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineminus">-</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineminus">-    NS_DECL_ISUPPORTS</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineminus">-    NS_DECL_NSICOMM4XPROFILE</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineminus">-</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-};</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineminus">-</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineminus">-#endif /* nsComm4xProfile_h__ */</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/import/content/importDialog.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/import/content/importDialog.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -646,72 +646,16 @@ function ImportMail( module, success, er</span>
<a href="#l25.4"></a><span id="l25.4">     return( false);</span>
<a href="#l25.5"></a><span id="l25.5">   }</span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7">   var loc = mailInterface.GetData( &quot;mailLocation&quot;);</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">   if (loc == null) {</span>
<a href="#l25.10"></a><span id="l25.10">     // No location found, check to see if we can ask the user.</span>
<a href="#l25.11"></a><span id="l25.11">     if (mailInterface.GetStatus( &quot;canUserSetLocation&quot;) != 0) {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-      if (selectedModuleName ==</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-          document.getElementById(&quot;bundle_comm4xImportMsgs&quot;)</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-                  .getString('comm4xImportName'))</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-    {</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-      var errorValue = true;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">-      //open the profile dialog.</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-      var comm4xprofile = Components.classes[&quot;@mozilla.org/comm4xProfile;1&quot;].createInstance();</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-      if(comm4xprofile != null) {</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-        comm4xprofile = comm4xprofile.QueryInterface( Components.interfaces.nsIComm4xProfile);</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-        if(comm4xprofile != null) {</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-          var length = {value:0};</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-          var profileList = null;</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-          try {</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineminus">-            profileList = comm4xprofile.getProfileList(length);</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineminus">-          }</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-          catch (ex) {}</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-          if (length.value)</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-          {</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-            var selected = {value:0};</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-            if (length.value == 1)</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-            {</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">-               errorValue = false;</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-            }</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">-            else {</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-              var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService(Components.interfaces.nsIPromptService);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-              if (promptService) {</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-                var clickedOk = false;</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-                clickedOk = promptService.select(window, </span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-                                               gImportMsgsBundle.getString('profileTitle'),</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineminus">-                                               gImportMsgsBundle.getString('profileText'),</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">-                                               length.value, profileList, selected);</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-                if (clickedOk) {</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-                  errorValue = false;</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-                }</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-                else {</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-                  // users cancel the pick list dialog so just return and</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-                  // don't set error string so that current dialog can stay.</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-                  return( false);</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-                }</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-              } // promptService</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-            }</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-            if (!errorValue) {</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-              var profileDir = comm4xprofile.getMailDir(profileList[selected.value]);</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-              var localfile = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-              localfile.initWithPath(profileDir);</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineminus">-              mailInterface.SetData( &quot;mailLocation&quot;, localfile);</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineminus">-            }</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineminus">-          } // profileList</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineminus">-        } // comm4xprofile</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineminus">-      } // comm4xprofile</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineminus">-      if (errorValue) {</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineminus">-        error.data = gImportMsgsBundle.getString('ImportMailNotFound');</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineminus">-        return(false);</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineminus">-      }         </span>
<a href="#l25.66"></a><span id="l25.66" class="difflineminus">-    }</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineminus">-    else {</span>
<a href="#l25.68"></a><span id="l25.68">       var filePicker = Components.classes[&quot;@mozilla.org/filepicker;1&quot;].createInstance();</span>
<a href="#l25.69"></a><span id="l25.69">       if (filePicker != null) {</span>
<a href="#l25.70"></a><span id="l25.70">         filePicker = filePicker.QueryInterface( Components.interfaces.nsIFilePicker);</span>
<a href="#l25.71"></a><span id="l25.71">         if (filePicker != null) {</span>
<a href="#l25.72"></a><span id="l25.72">           try {</span>
<a href="#l25.73"></a><span id="l25.73">             filePicker.init( top.window, gImportMsgsBundle.getString('ImportSelectMailDir'), Components.interfaces.nsIFilePicker.modeGetFolder);</span>
<a href="#l25.74"></a><span id="l25.74">             filePicker.appendFilters( Components.interfaces.nsIFilePicker.filterAll);</span>
<a href="#l25.75"></a><span id="l25.75">             filePicker.show();</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineat">@@ -728,17 +672,16 @@ function ImportMail( module, success, er</span>
<a href="#l25.77"></a><span id="l25.77">           error.data = gImportMsgsBundle.getString('ImportMailNotFound');</span>
<a href="#l25.78"></a><span id="l25.78">           return( false);</span>
<a href="#l25.79"></a><span id="l25.79">         }</span>
<a href="#l25.80"></a><span id="l25.80">       }</span>
<a href="#l25.81"></a><span id="l25.81">       else {</span>
<a href="#l25.82"></a><span id="l25.82">         error.data = gImportMsgsBundle.getString('ImportMailNotFound');</span>
<a href="#l25.83"></a><span id="l25.83">         return( false);</span>
<a href="#l25.84"></a><span id="l25.84">       }</span>
<a href="#l25.85"></a><span id="l25.85" class="difflineminus">-      }</span>
<a href="#l25.86"></a><span id="l25.86">     }</span>
<a href="#l25.87"></a><span id="l25.87">     else {</span>
<a href="#l25.88"></a><span id="l25.88">       error.data = gImportMsgsBundle.getString('ImportMailNotFound');</span>
<a href="#l25.89"></a><span id="l25.89">       return( false);</span>
<a href="#l25.90"></a><span id="l25.90">     }</span>
<a href="#l25.91"></a><span id="l25.91">   }</span>
<a href="#l25.92"></a><span id="l25.92"> </span>
<a href="#l25.93"></a><span id="l25.93">   if (mailInterface.WantsProgress()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/import/content/importDialog.xul</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/import/content/importDialog.xul</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -56,17 +56,16 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #else</span>
<a href="#l26.5"></a><span id="l26.5">         style=&quot;width: &amp;window.width; !important;&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #endif</span>
<a href="#l26.7"></a><span id="l26.7">         title=&quot;&amp;importDialog.windowTitle;&quot;&gt;</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   &lt;stringbundle id=&quot;bundle_importMsgs&quot; src=&quot;chrome://messenger/locale/importMsgs.properties&quot;/&gt;</span>
<a href="#l26.10"></a><span id="l26.10">   &lt;stringbundle id=&quot;bundle_addressbook&quot; src=&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;/&gt;</span>
<a href="#l26.11"></a><span id="l26.11">   &lt;stringbundle id=&quot;bundle_vcardImportMsgs&quot; src=&quot;chrome://messenger/locale/vCardImportMsgs.properties&quot;/&gt;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  &lt;stringbundle id=&quot;bundle_comm4xImportMsgs&quot; src=&quot;chrome://messenger/locale/comm4xMailImportMsgs.properties&quot;/&gt;</span>
<a href="#l26.13"></a><span id="l26.13">   &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger/content/importDialog.js&quot;/&gt;</span>
<a href="#l26.14"></a><span id="l26.14"> </span>
<a href="#l26.15"></a><span id="l26.15">   &lt;keyset id=&quot;dialogKeys&quot;/&gt;</span>
<a href="#l26.16"></a><span id="l26.16">   </span>
<a href="#l26.17"></a><span id="l26.17">   &lt;hbox class=&quot;box-header&quot; id=&quot;header&quot;</span>
<a href="#l26.18"></a><span id="l26.18">        title=&quot;&amp;importTitle.label;&quot;</span>
<a href="#l26.19"></a><span id="l26.19">        description=&quot;&amp;importShortDesc.label;&quot;/&gt;</span>
<a href="#l26.20"></a><span id="l26.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/makefiles.sh</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/makefiles.sh</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -84,18 +84,16 @@ mailnews/extensions/smime/public/Makefil</span>
<a href="#l27.4"></a><span id="l27.4"> mailnews/extensions/smime/src/Makefile</span>
<a href="#l27.5"></a><span id="l27.5"> mailnews/imap/Makefile</span>
<a href="#l27.6"></a><span id="l27.6"> mailnews/imap/public/Makefile</span>
<a href="#l27.7"></a><span id="l27.7"> mailnews/imap/src/Makefile</span>
<a href="#l27.8"></a><span id="l27.8"> mailnews/imap/test/Makefile</span>
<a href="#l27.9"></a><span id="l27.9"> mailnews/import/Makefile</span>
<a href="#l27.10"></a><span id="l27.10"> mailnews/import/applemail/src/Makefile</span>
<a href="#l27.11"></a><span id="l27.11"> mailnews/import/build/Makefile</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-mailnews/import/comm4x/public/Makefile</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-mailnews/import/comm4x/src/Makefile</span>
<a href="#l27.14"></a><span id="l27.14"> mailnews/import/eudora/src/Makefile</span>
<a href="#l27.15"></a><span id="l27.15"> mailnews/import/oexpress/Makefile</span>
<a href="#l27.16"></a><span id="l27.16"> mailnews/import/outlook/src/Makefile</span>
<a href="#l27.17"></a><span id="l27.17"> mailnews/import/public/Makefile</span>
<a href="#l27.18"></a><span id="l27.18"> mailnews/import/src/Makefile</span>
<a href="#l27.19"></a><span id="l27.19"> mailnews/import/test/Makefile</span>
<a href="#l27.20"></a><span id="l27.20"> mailnews/import/text/src/Makefile</span>
<a href="#l27.21"></a><span id="l27.21"> mailnews/import/vcard/src/Makefile</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/build/Makefile.in</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/build/Makefile.in</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -74,17 +74,16 @@ SHARED_LIBRARY_LIBS = \</span>
<a href="#l28.4"></a><span id="l28.4"> ifneq (,$(filter windows cocoa gtk2, $(MOZ_WIDGET_TOOLKIT)))</span>
<a href="#l28.5"></a><span id="l28.5"> SHARED_LIBRARY_LIBS += ../shell/src/$(LIB_PREFIX)shellservice_s.$(LIB_SUFFIX)</span>
<a href="#l28.6"></a><span id="l28.6"> endif</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> EXTRA_DSO_LDOPTS += \</span>
<a href="#l28.9"></a><span id="l28.9"> 	$(LIBS_DIR) \</span>
<a href="#l28.10"></a><span id="l28.10"> 	$(EXTRA_DSO_LIBS) \</span>
<a href="#l28.11"></a><span id="l28.11"> 	$(call EXPAND_LIBNAME_PATH,unicharutil_external_s,$(LIBXUL_DIST)/lib) \</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-	$(LIBXUL_DIST)/../modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \</span>
<a href="#l28.13"></a><span id="l28.13"> 	$(MOZ_JS_LIBS) \</span>
<a href="#l28.14"></a><span id="l28.14"> 	$(XPCOM_GLUE_LDOPTS) \</span>
<a href="#l28.15"></a><span id="l28.15"> 	$(MOZ_COMPONENT_LIBS) \</span>
<a href="#l28.16"></a><span id="l28.16"> 	$(NULL)</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19"> # Mac: Need to link with CoreFoundation for Mac Migrators (PList reading code)</span>
<a href="#l28.20"></a><span id="l28.20"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/installer/package-manifest.in</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/installer/package-manifest.in</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -646,17 +646,16 @@ bin/libfreebl_32int64_3.so</span>
<a href="#l29.4"></a><span id="l29.4"> #endif</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6"> [mail]</span>
<a href="#l29.7"></a><span id="l29.7"> ; MailNews component xpts</span>
<a href="#l29.8"></a><span id="l29.8"> @BINPATH@/components/addrbook.xpt</span>
<a href="#l29.9"></a><span id="l29.9"> @BINPATH@/components/nsAddrbook.manifest</span>
<a href="#l29.10"></a><span id="l29.10"> @BINPATH@/components/fts3tok.xpt</span>
<a href="#l29.11"></a><span id="l29.11"> @BINPATH@/components/import.xpt</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-@BINPATH@/components/impComm4xMail.xpt</span>
<a href="#l29.13"></a><span id="l29.13"> @BINPATH@/components/ldapComponents.manifest</span>
<a href="#l29.14"></a><span id="l29.14"> @BINPATH@/components/mailview.xpt</span>
<a href="#l29.15"></a><span id="l29.15"> @BINPATH@/components/mime.xpt</span>
<a href="#l29.16"></a><span id="l29.16"> #ifdef XP_WIN32</span>
<a href="#l29.17"></a><span id="l29.17"> @BINPATH@/components/mapihook.xpt</span>
<a href="#l29.18"></a><span id="l29.18"> #endif</span>
<a href="#l29.19"></a><span id="l29.19"> @BINPATH@/components/msgbase.xpt</span>
<a href="#l29.20"></a><span id="l29.20"> @BINPATH@/components/msgBase.manifest</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">deleted file mode 100644</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/comm4xMailImportMsgs.properties</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ /dev/null</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -1,65 +0,0 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l30.6"></a><span id="l30.6" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l30.7"></a><span id="l30.7" class="difflineminus">-#</span>
<a href="#l30.8"></a><span id="l30.8" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-#</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-# License.</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-#</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-# The Original Code is mozilla.org code.</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineminus">-#</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineminus">-# Netscape Communications Corporation.</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2002</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-#</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineminus">-# Contributor(s):</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineminus">-#   Srilatha Moturi &lt;srilatha@netscape.com&gt;</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineminus">-#</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineminus">-# either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-# or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineminus">-#</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineminus">-</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineminus">-# LOCALIZATION NOTE (comm4xImportName) : &quot;Communicator 4.x&quot; below is the used for previous versions of Netscape Communicator. Please translate using the brandname in respective languages for Netscape Communicator 4 releases.</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineminus">-comm4xImportName=Communicator 4.x</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineminus">-</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-# Description of import module</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineminus">-# LOCALIZATION NOTE : &quot;Communicator 4.x&quot; below is the used for previous versions of Netscape Communicator</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineminus">-# Please translate using the brandname in respective languages for Netscape Communicator 4 releases.</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineminus">-## @name COMM4XMAILIMPORT_DESCRIPTION</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineminus">-## @loc None</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineminus">-2001=Import Local Mail from Communicator 4.x.</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineminus">-# Success Message</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineminus">-# LOCALIZATION NOTE : Do not translate the word &quot;%S&quot; below.</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineminus">-## @name COMM4XMAILIMPORT_MAILBOX_SUCCESS</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineminus">-## @loc None</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineminus">-2002=Local messages were successfully imported from %S</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineminus">-</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineminus">-# Error Message</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineminus">-## @name COMM4XMAILIMPORT_MAILBOX_BADPARAM</span>
<a href="#l30.60"></a><span id="l30.60" class="difflineminus">-## @loc None</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineminus">-2003=An internal error occurred. Importing failed. Try importing again.</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineminus">-</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineminus">-# Error message</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineminus">-# LOCALIZATION NOTE : Do not translate the word &quot;%S&quot; below.</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineminus">-## @name COMM4XMAILIMPORT_MAILBOX_CONVERTERROR</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineminus">-## @loc None</span>
<a href="#l30.67"></a><span id="l30.67" class="difflineminus">-2004=An error occurred while importing messages from %S. Messages were not imported. Make more disk space available and try again.</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineminus">-</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -235,17 +235,16 @@</span>
<a href="#l31.4"></a><span id="l31.4">   locale/@AB_CD@/messenger/am-mdn.dtd                                       (%chrome/mailnews/pref/am-mdn.dtd)</span>
<a href="#l31.5"></a><span id="l31.5">   locale/@AB_CD@/messenger/am-mdn.properties                                (%chrome/mailnews/pref/am-mdn.properties)</span>
<a href="#l31.6"></a><span id="l31.6">   locale/@AB_CD@/messenger/am-offline.dtd                                   (%chrome/mailnews/pref/am-offline.dtd)</span>
<a href="#l31.7"></a><span id="l31.7">   locale/@AB_CD@/messenger/am-serverwithnoidentities.dtd                    (%chrome/mailnews/pref/am-serverwithnoidentities.dtd)</span>
<a href="#l31.8"></a><span id="l31.8">   locale/@AB_CD@/messenger/am-server-advanced.dtd                           (%chrome/mailnews/pref/am-server-advanced.dtd)</span>
<a href="#l31.9"></a><span id="l31.9">   locale/@AB_CD@/messenger/am-server-top.dtd                                (%chrome/mailnews/pref/am-server-top.dtd)</span>
<a href="#l31.10"></a><span id="l31.10">   locale/@AB_CD@/messenger/am-archiveoptions.dtd                            (%chrome/mailnews/pref/am-archiveoptions.dtd)</span>
<a href="#l31.11"></a><span id="l31.11">   locale/@AB_CD@/messenger/appleMailImportMsgs.properties                   (%chrome/mailnews/appleMailImportMsgs.properties)</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  locale/@AB_CD@/messenger/comm4xMailImportMsgs.properties                  (%chrome/mailnews/comm4xMailImportMsgs.properties)</span>
<a href="#l31.13"></a><span id="l31.13">   locale/@AB_CD@/messenger/custom.properties                                (%chrome/mailnews/custom.properties)</span>
<a href="#l31.14"></a><span id="l31.14">   locale/@AB_CD@/messenger/CustomHeaders.dtd                                (%chrome/mailnews/CustomHeaders.dtd)</span>
<a href="#l31.15"></a><span id="l31.15">   locale/@AB_CD@/messenger/eudoraImportMsgs.properties                      (%chrome/mailnews/eudoraImportMsgs.properties)</span>
<a href="#l31.16"></a><span id="l31.16">   locale/@AB_CD@/messenger/downloadheaders.dtd                              (%chrome/mailnews/downloadheaders.dtd)</span>
<a href="#l31.17"></a><span id="l31.17">   locale/@AB_CD@/messenger/fieldMapImport.dtd                               (%chrome/mailnews/fieldMapImport.dtd)</span>
<a href="#l31.18"></a><span id="l31.18">   locale/@AB_CD@/messenger/filter.properties                                (%chrome/mailnews/filter.properties)</span>
<a href="#l31.19"></a><span id="l31.19">   locale/@AB_CD@/messenger/FilterEditor.dtd                                 (%chrome/mailnews/FilterEditor.dtd)</span>
<a href="#l31.20"></a><span id="l31.20">   locale/@AB_CD@/messenger/FilterListDialog.dtd                             (%chrome/mailnews/FilterListDialog.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -41,47 +41,31 @@</span>
<a href="#l32.4"></a><span id="l32.4"> #include &quot;nsCRT.h&quot;</span>
<a href="#l32.5"></a><span id="l32.5"> #include &quot;nsICookieManager2.h&quot;</span>
<a href="#l32.6"></a><span id="l32.6"> #include &quot;nsIFile.h&quot;</span>
<a href="#l32.7"></a><span id="l32.7"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l32.8"></a><span id="l32.8"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l32.9"></a><span id="l32.9"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l32.10"></a><span id="l32.10"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l32.11"></a><span id="l32.11"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-#include &quot;NSReg.h&quot;</span>
<a href="#l32.13"></a><span id="l32.13"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l32.14"></a><span id="l32.14"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l32.15"></a><span id="l32.15"> #include &quot;nsIURL.h&quot;</span>
<a href="#l32.16"></a><span id="l32.16"> #include &quot;nsNetscapeProfileMigratorBase.h&quot;</span>
<a href="#l32.17"></a><span id="l32.17"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l32.18"></a><span id="l32.18"> #include &quot;prtime.h&quot;</span>
<a href="#l32.19"></a><span id="l32.19"> #include &quot;nsILoginManagerStorage.h&quot;</span>
<a href="#l32.20"></a><span id="l32.20"> #include &quot;nsINIParser.h&quot;</span>
<a href="#l32.21"></a><span id="l32.21"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l32.22"></a><span id="l32.22"> </span>
<a href="#l32.23"></a><span id="l32.23"> #define MAIL_DIR_50_NAME             NS_LITERAL_STRING(&quot;Mail&quot;)</span>
<a href="#l32.24"></a><span id="l32.24"> #define IMAP_MAIL_DIR_50_NAME        NS_LITERAL_STRING(&quot;ImapMail&quot;)</span>
<a href="#l32.25"></a><span id="l32.25"> #define NEWS_DIR_50_NAME             NS_LITERAL_STRING(&quot;News&quot;)</span>
<a href="#l32.26"></a><span id="l32.26"> #define DIR_NAME_CHROME              NS_LITERAL_STRING(&quot;chrome&quot;)</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28" class="difflineminus">-static nsresult</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-regerr2nsresult(REGERR errCode)</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-{</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-  switch (errCode) {</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineminus">-    case REGERR_PARAM:</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineminus">-    case REGERR_BADTYPE:</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineminus">-    case REGERR_BADNAME:</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-      return NS_ERROR_INVALID_ARG;</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-    case REGERR_MEMORY:</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-      return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-  }</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineminus">-  return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineminus">-}</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineminus">-</span>
<a href="#l32.43"></a><span id="l32.43"> NS_IMPL_ISUPPORTS2(nsNetscapeProfileMigratorBase, nsISuiteProfileMigrator,</span>
<a href="#l32.44"></a><span id="l32.44">                    nsITimerCallback)</span>
<a href="#l32.45"></a><span id="l32.45"> </span>
<a href="#l32.46"></a><span id="l32.46"> </span>
<a href="#l32.47"></a><span id="l32.47"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l32.48"></a><span id="l32.48"> // nsITimerCallback</span>
<a href="#l32.49"></a><span id="l32.49"> </span>
<a href="#l32.50"></a><span id="l32.50"> NS_IMETHODIMP</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineat">@@ -438,121 +422,16 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l32.52"></a><span id="l32.52">       profileNameString-&gt;SetData(NS_ConvertUTF8toUTF16(buffer));</span>
<a href="#l32.53"></a><span id="l32.53">       aProfileNames-&gt;AppendElement(profileNameString, PR_FALSE);</span>
<a href="#l32.54"></a><span id="l32.54">     }</span>
<a href="#l32.55"></a><span id="l32.55">   }</span>
<a href="#l32.56"></a><span id="l32.56">   return NS_OK;</span>
<a href="#l32.57"></a><span id="l32.57"> }</span>
<a href="#l32.58"></a><span id="l32.58"> </span>
<a href="#l32.59"></a><span id="l32.59"> nsresult</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineminus">-nsNetscapeProfileMigratorBase::GetProfileDataFromRegistry(nsILocalFile* aRegistryFile,</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineminus">-                                                          nsIMutableArray* aProfileNames,</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineminus">-                                                          nsIMutableArray* aProfileLocations)</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineminus">-{</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineminus">-  REGERR errCode;</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineminus">-</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineminus">-  // Ensure aRegistryFile exists before open it</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineminus">-  bool regFileExists = false;</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineminus">-  nsresult rv = aRegistryFile-&gt;Exists(&amp;regFileExists);</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineminus">-</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineminus">-  if (!regFileExists)</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineminus">-    return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineminus">-</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineminus">-  // Open It</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineminus">-  nsCAutoString regPath;</span>
<a href="#l32.76"></a><span id="l32.76" class="difflineminus">-  rv = aRegistryFile-&gt;GetNativePath(regPath);</span>
<a href="#l32.77"></a><span id="l32.77" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l32.78"></a><span id="l32.78" class="difflineminus">-</span>
<a href="#l32.79"></a><span id="l32.79" class="difflineminus">-  if ((errCode = NR_StartupRegistry()))</span>
<a href="#l32.80"></a><span id="l32.80" class="difflineminus">-    return regerr2nsresult(errCode);</span>
<a href="#l32.81"></a><span id="l32.81" class="difflineminus">-</span>
<a href="#l32.82"></a><span id="l32.82" class="difflineminus">-  HREG reg;</span>
<a href="#l32.83"></a><span id="l32.83" class="difflineminus">-  if ((errCode = NR_RegOpen(regPath.get(), &amp;reg))) {</span>
<a href="#l32.84"></a><span id="l32.84" class="difflineminus">-    NR_ShutdownRegistry();</span>
<a href="#l32.85"></a><span id="l32.85" class="difflineminus">-</span>
<a href="#l32.86"></a><span id="l32.86" class="difflineminus">-    return regerr2nsresult(errCode);</span>
<a href="#l32.87"></a><span id="l32.87" class="difflineminus">-  }</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineminus">-</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineminus">-  RKEY profilesTree;</span>
<a href="#l32.90"></a><span id="l32.90" class="difflineminus">-  if ((errCode = NR_RegGetKey(reg, ROOTKEY_COMMON, &quot;Profiles&quot;, &amp;profilesTree))) {</span>
<a href="#l32.91"></a><span id="l32.91" class="difflineminus">-    NR_RegClose(reg);</span>
<a href="#l32.92"></a><span id="l32.92" class="difflineminus">-    NR_ShutdownRegistry();</span>
<a href="#l32.93"></a><span id="l32.93" class="difflineminus">-</span>
<a href="#l32.94"></a><span id="l32.94" class="difflineminus">-    return regerr2nsresult(errCode);</span>
<a href="#l32.95"></a><span id="l32.95" class="difflineminus">-  }</span>
<a href="#l32.96"></a><span id="l32.96" class="difflineminus">-</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineminus">-  char profileStr[MAXREGPATHLEN];</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineminus">-  REGENUM enumState = nsnull;</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineminus">-</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineminus">-  while (!NR_RegEnumSubkeys(reg, profilesTree, &amp;enumState, profileStr,</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineminus">-                            sizeof(profileStr), REGENUM_CHILDREN)) {</span>
<a href="#l32.102"></a><span id="l32.102" class="difflineminus">-    RKEY profileKey;</span>
<a href="#l32.103"></a><span id="l32.103" class="difflineminus">-    if (NR_RegGetKey(reg, profilesTree, profileStr, &amp;profileKey))</span>
<a href="#l32.104"></a><span id="l32.104" class="difflineminus">-      continue;</span>
<a href="#l32.105"></a><span id="l32.105" class="difflineminus">-</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineminus">-    // &quot;migrated&quot; is &quot;yes&quot; for all valid Seamonkey profiles. It is only &quot;no&quot;</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineminus">-    // for 4.x profiles.</span>
<a href="#l32.108"></a><span id="l32.108" class="difflineminus">-    char migratedStr[3] = {0};</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineminus">-    errCode = NR_RegGetEntryString(reg, profileKey, &quot;migrated&quot;,</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineminus">-                                   migratedStr, sizeof(migratedStr));</span>
<a href="#l32.111"></a><span id="l32.111" class="difflineminus">-    if ((errCode != REGERR_OK &amp;&amp; errCode != REGERR_BUFTOOSMALL) ||</span>
<a href="#l32.112"></a><span id="l32.112" class="difflineminus">-        strcmp(migratedStr, &quot;no&quot;) == 0)</span>
<a href="#l32.113"></a><span id="l32.113" class="difflineminus">-      continue;</span>
<a href="#l32.114"></a><span id="l32.114" class="difflineminus">-</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineminus">-    // Get the profile location and add it to the locations array</span>
<a href="#l32.116"></a><span id="l32.116" class="difflineminus">-    REGINFO regInfo;</span>
<a href="#l32.117"></a><span id="l32.117" class="difflineminus">-    regInfo.size = sizeof(REGINFO);</span>
<a href="#l32.118"></a><span id="l32.118" class="difflineminus">-</span>
<a href="#l32.119"></a><span id="l32.119" class="difflineminus">-    if (NR_RegGetEntryInfo(reg, profileKey, &quot;directory&quot;, &amp;regInfo))</span>
<a href="#l32.120"></a><span id="l32.120" class="difflineminus">-      continue;</span>
<a href="#l32.121"></a><span id="l32.121" class="difflineminus">-</span>
<a href="#l32.122"></a><span id="l32.122" class="difflineminus">-    nsCAutoString dirStr;</span>
<a href="#l32.123"></a><span id="l32.123" class="difflineminus">-    dirStr.SetLength(regInfo.entryLength);</span>
<a href="#l32.124"></a><span id="l32.124" class="difflineminus">-</span>
<a href="#l32.125"></a><span id="l32.125" class="difflineminus">-    errCode = NR_RegGetEntryString(reg, profileKey, &quot;directory&quot;,</span>
<a href="#l32.126"></a><span id="l32.126" class="difflineminus">-                                   dirStr.BeginWriting(), regInfo.entryLength);</span>
<a href="#l32.127"></a><span id="l32.127" class="difflineminus">-    // Remove trailing \0</span>
<a href="#l32.128"></a><span id="l32.128" class="difflineminus">-    dirStr.SetLength(regInfo.entryLength-1);</span>
<a href="#l32.129"></a><span id="l32.129" class="difflineminus">-</span>
<a href="#l32.130"></a><span id="l32.130" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; dir;</span>
<a href="#l32.131"></a><span id="l32.131" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l32.132"></a><span id="l32.132" class="difflineminus">-    rv = NS_NewNativeLocalFile(EmptyCString(), PR_TRUE, getter_AddRefs(dir));</span>
<a href="#l32.133"></a><span id="l32.133" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l32.134"></a><span id="l32.134" class="difflineminus">-      break;</span>
<a href="#l32.135"></a><span id="l32.135" class="difflineminus">-</span>
<a href="#l32.136"></a><span id="l32.136" class="difflineminus">-    dir-&gt;SetPersistentDescriptor(dirStr);</span>
<a href="#l32.137"></a><span id="l32.137" class="difflineminus">-#else</span>
<a href="#l32.138"></a><span id="l32.138" class="difflineminus">-    rv = NS_NewLocalFile(NS_ConvertUTF8toUTF16(dirStr), PR_TRUE,</span>
<a href="#l32.139"></a><span id="l32.139" class="difflineminus">-                         getter_AddRefs(dir));</span>
<a href="#l32.140"></a><span id="l32.140" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l32.141"></a><span id="l32.141" class="difflineminus">-      break;</span>
<a href="#l32.142"></a><span id="l32.142" class="difflineminus">-#endif</span>
<a href="#l32.143"></a><span id="l32.143" class="difflineminus">-</span>
<a href="#l32.144"></a><span id="l32.144" class="difflineminus">-    bool exists;</span>
<a href="#l32.145"></a><span id="l32.145" class="difflineminus">-    dir-&gt;Exists(&amp;exists);</span>
<a href="#l32.146"></a><span id="l32.146" class="difflineminus">-</span>
<a href="#l32.147"></a><span id="l32.147" class="difflineminus">-    if (exists) {</span>
<a href="#l32.148"></a><span id="l32.148" class="difflineminus">-      aProfileLocations-&gt;AppendElement(dir, PR_FALSE);</span>
<a href="#l32.149"></a><span id="l32.149" class="difflineminus">-</span>
<a href="#l32.150"></a><span id="l32.150" class="difflineminus">-      // Add the profile name to the names array</span>
<a href="#l32.151"></a><span id="l32.151" class="difflineminus">-      nsCOMPtr&lt;nsISupportsString&gt; profileNameString(</span>
<a href="#l32.152"></a><span id="l32.152" class="difflineminus">-        do_CreateInstance(&quot;@mozilla.org/supports-string;1&quot;));</span>
<a href="#l32.153"></a><span id="l32.153" class="difflineminus">-</span>
<a href="#l32.154"></a><span id="l32.154" class="difflineminus">-      profileNameString-&gt;SetData(NS_ConvertUTF8toUTF16(profileStr));</span>
<a href="#l32.155"></a><span id="l32.155" class="difflineminus">-      aProfileNames-&gt;AppendElement(profileNameString, PR_FALSE);</span>
<a href="#l32.156"></a><span id="l32.156" class="difflineminus">-    }</span>
<a href="#l32.157"></a><span id="l32.157" class="difflineminus">-  }</span>
<a href="#l32.158"></a><span id="l32.158" class="difflineminus">-  NR_RegClose(reg);</span>
<a href="#l32.159"></a><span id="l32.159" class="difflineminus">-  NR_ShutdownRegistry();</span>
<a href="#l32.160"></a><span id="l32.160" class="difflineminus">-</span>
<a href="#l32.161"></a><span id="l32.161" class="difflineminus">-  return rv;</span>
<a href="#l32.162"></a><span id="l32.162" class="difflineminus">-}</span>
<a href="#l32.163"></a><span id="l32.163" class="difflineminus">-</span>
<a href="#l32.164"></a><span id="l32.164" class="difflineminus">-nsresult</span>
<a href="#l32.165"></a><span id="l32.165"> nsNetscapeProfileMigratorBase::CopyFile(const char* aSourceFileName,</span>
<a href="#l32.166"></a><span id="l32.166">                                         const char* aTargetFileName)</span>
<a href="#l32.167"></a><span id="l32.167"> {</span>
<a href="#l32.168"></a><span id="l32.168">   nsCOMPtr&lt;nsIFile&gt; sourceFile;</span>
<a href="#l32.169"></a><span id="l32.169">   mSourceProfile-&gt;Clone(getter_AddRefs(sourceFile));</span>
<a href="#l32.170"></a><span id="l32.170"> </span>
<a href="#l32.171"></a><span id="l32.171">   sourceFile-&gt;AppendNative(nsDependentCString(aSourceFileName));</span>
<a href="#l32.172"></a><span id="l32.172">   bool exists = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -134,19 +134,16 @@ protected:</span>
<a href="#l33.4"></a><span id="l33.4">   // the required profile data for the specific application can be obtained.</span>
<a href="#l33.5"></a><span id="l33.5">   virtual nsresult FillProfileDataFromRegistry() = 0;</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">   // General Utility Methods</span>
<a href="#l33.8"></a><span id="l33.8">   nsresult GetSourceProfile(const PRUnichar* aProfile);</span>
<a href="#l33.9"></a><span id="l33.9">   nsresult GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l33.10"></a><span id="l33.10">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l33.11"></a><span id="l33.11">                                          nsIMutableArray* aProfileLocations);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  nsresult GetProfileDataFromRegistry(nsILocalFile* aRegistryFile,</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-                                      nsIMutableArray* aProfileNames,</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">-                                      nsIMutableArray* aProfileLocations);</span>
<a href="#l33.15"></a><span id="l33.15">   nsresult GetFileValue(nsIPrefBranch* aPrefBranch, const char* aRelPrefName,</span>
<a href="#l33.16"></a><span id="l33.16">                         const char* aPrefName, nsILocalFile** aReturnFile);</span>
<a href="#l33.17"></a><span id="l33.17">   nsresult CopyFile(const char* aSourceFileName,</span>
<a href="#l33.18"></a><span id="l33.18">                     const char* aTargetFileName);</span>
<a href="#l33.19"></a><span id="l33.19">   nsresult RecursiveCopy(nsIFile* srcDir, nsIFile* destDir);</span>
<a href="#l33.20"></a><span id="l33.20">   void ReadBranch(const char * branchName, nsIPrefService* aPrefService,</span>
<a href="#l33.21"></a><span id="l33.21">                   PBStructArray &amp;aPrefs);</span>
<a href="#l33.22"></a><span id="l33.22">   void WriteBranch(const char * branchName, nsIPrefService* aPrefService,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/suite/profile/migration/src/nsProfileMigrator.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/suite/profile/migration/src/nsProfileMigrator.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -42,37 +42,26 @@</span>
<a href="#l34.4"></a><span id="l34.4"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l34.5"></a><span id="l34.5"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l34.6"></a><span id="l34.6"> #include &quot;nsIToolkitProfile.h&quot;</span>
<a href="#l34.7"></a><span id="l34.7"> #include &quot;nsIToolkitProfileService.h&quot;</span>
<a href="#l34.8"></a><span id="l34.8"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l34.9"></a><span id="l34.9"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l34.10"></a><span id="l34.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l34.11"></a><span id="l34.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-#include &quot;NSReg.h&quot;</span>
<a href="#l34.13"></a><span id="l34.13"> #include &quot;nsStringAPI.h&quot;</span>
<a href="#l34.14"></a><span id="l34.14"> #include &quot;nsIProperties.h&quot;</span>
<a href="#l34.15"></a><span id="l34.15"> #include &quot;nsMemory.h&quot;</span>
<a href="#l34.16"></a><span id="l34.16"> #ifdef XP_WIN</span>
<a href="#l34.17"></a><span id="l34.17"> #include &lt;windows.h&gt;</span>
<a href="#l34.18"></a><span id="l34.18"> #include &quot;nsIWindowsRegKey.h&quot;</span>
<a href="#l34.19"></a><span id="l34.19"> #include &quot;nsILocalFileWin.h&quot;</span>
<a href="#l34.20"></a><span id="l34.20"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l34.21"></a><span id="l34.21"> #endif</span>
<a href="#l34.22"></a><span id="l34.22"> </span>
<a href="#l34.23"></a><span id="l34.23" class="difflineminus">-#ifndef MAXPATHLEN</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-#ifdef _MAX_PATH</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineminus">-#define MAXPATHLEN _MAX_PATH</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineminus">-#elif defined(CCHMAXPATH)</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-#define MAXPATHLEN CCHMAXPATH</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineminus">-#else</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-#define MAXPATHLEN 1024</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-#endif</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-#endif</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineminus">-</span>
<a href="#l34.33"></a><span id="l34.33"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l34.34"></a><span id="l34.34"> // nsIProfileMigrator</span>
<a href="#l34.35"></a><span id="l34.35"> </span>
<a href="#l34.36"></a><span id="l34.36"> #define MIGRATION_WIZARD_FE_URL &quot;chrome://communicator/content/migration/migration.xul&quot;</span>
<a href="#l34.37"></a><span id="l34.37"> #define MIGRATION_WIZARD_FE_FEATURES &quot;chrome,dialog,modal,centerscreen,titlebar&quot;</span>
<a href="#l34.38"></a><span id="l34.38"> </span>
<a href="#l34.39"></a><span id="l34.39"> NS_IMETHODIMP</span>
<a href="#l34.40"></a><span id="l34.40"> nsProfileMigrator::Migrate(nsIProfileStartup* aStartup)</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineat">@@ -108,29 +97,16 @@ nsProfileMigrator::Migrate(nsIProfileSta</span>
<a href="#l34.42"></a><span id="l34.42">   return ww-&gt;OpenWindow(nsnull,</span>
<a href="#l34.43"></a><span id="l34.43">                         MIGRATION_WIZARD_FE_URL,</span>
<a href="#l34.44"></a><span id="l34.44">                         &quot;_blank&quot;,</span>
<a href="#l34.45"></a><span id="l34.45">                         MIGRATION_WIZARD_FE_FEATURES,</span>
<a href="#l34.46"></a><span id="l34.46">                         params,</span>
<a href="#l34.47"></a><span id="l34.47">                         getter_AddRefs(migrateWizard));</span>
<a href="#l34.48"></a><span id="l34.48"> }</span>
<a href="#l34.49"></a><span id="l34.49"> </span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-nsProfileMigrator::Import()</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineminus">-{</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineminus">-  // This is purposely broken as using this would mean that we have</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineminus">-  // to use data from where profiles exist currently. We want to copy</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineminus">-  // it so that we can create a &quot;fresh&quot; profile. There may be a way</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineminus">-  // to do it from here, but currently we haven't found an easy one.</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineminus">-  //if (ImportRegistryProfiles(NS_LITERAL_CSTRING(&quot;mozilla&quot;)))</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineminus">-  //    return NS_OK;</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineminus">-</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineminus">-}</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineminus">-</span>
<a href="#l34.63"></a><span id="l34.63"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l34.64"></a><span id="l34.64"> // nsProfileMigrator</span>
<a href="#l34.65"></a><span id="l34.65"> </span>
<a href="#l34.66"></a><span id="l34.66"> NS_IMPL_ISUPPORTS1(nsProfileMigrator, nsIProfileMigrator)</span>
<a href="#l34.67"></a><span id="l34.67"> </span>
<a href="#l34.68"></a><span id="l34.68"> struct sInternalNameToMigratorName {</span>
<a href="#l34.69"></a><span id="l34.69">   const char* internalName;</span>
<a href="#l34.70"></a><span id="l34.70">   const char* key;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/profile/migration/src/nsProfileMigrator.h</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/profile/migration/src/nsProfileMigrator.h</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -38,17 +38,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #ifndef ProfileMigrator_h__</span>
<a href="#l35.5"></a><span id="l35.5"> #define ProfileMigrator_h__</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7"> #include &quot;nsISuiteProfileMigrator.h&quot;</span>
<a href="#l35.8"></a><span id="l35.8"> #include &quot;nsIProfileMigrator.h&quot;</span>
<a href="#l35.9"></a><span id="l35.9"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l35.10"></a><span id="l35.10"> </span>
<a href="#l35.11"></a><span id="l35.11"> #define NS_SUITEPROFILEMIGRATOR_CID \</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-{ 0x4ca3c946, 0x5408, 0x49f0, { 0x9e, 0xca, 0x3a, 0x97, 0xd5, 0xc6, 0x77, 0x50 } }</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+{ 0x0c12a924, 0xc052, 0x4c7d, { 0x82, 0x7b, 0xba, 0x8c, 0x96, 0x32, 0xa6, 0x36 } }</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15"> #define NS_SUITEPROFILEMIGRATOR_CONTRACTID_PREFIX &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot;</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17"> class nsProfileMigrator : public nsIProfileMigrator</span>
<a href="#l35.18"></a><span id="l35.18"> {</span>
<a href="#l35.19"></a><span id="l35.19"> public:</span>
<a href="#l35.20"></a><span id="l35.20">   NS_DECL_NSIPROFILEMIGRATOR</span>
<a href="#l35.21"></a><span id="l35.21">   NS_DECL_ISUPPORTS</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -222,54 +222,17 @@ nsSeamonkeyProfileMigrator::GetSupported</span>
<a href="#l36.4"></a><span id="l36.4">   *aSupportedItems = nsISuiteProfileMigrator::ALL;</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6">   return NS_OK;</span>
<a href="#l36.7"></a><span id="l36.7"> }</span>
<a href="#l36.8"></a><span id="l36.8"> </span>
<a href="#l36.9"></a><span id="l36.9"> nsresult</span>
<a href="#l36.10"></a><span id="l36.10"> nsSeamonkeyProfileMigrator::FillProfileDataFromRegistry()</span>
<a href="#l36.11"></a><span id="l36.11"> {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  // Find the Seamonkey Registry</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-  nsCOMPtr&lt;nsIProperties&gt; fileLocator(</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-    do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; seamonkeyRegistry;</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-#ifdef XP_WIN</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-  fileLocator-&gt;Get(NS_WIN_APPDATA_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-                   getter_AddRefs(seamonkeyRegistry));</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">-</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;Mozilla&quot;));</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;registry.dat&quot;));</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">-#elif defined(XP_MACOSX)</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineminus">-  fileLocator-&gt;Get(NS_MAC_USER_LIB_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineminus">-                   getter_AddRefs(seamonkeyRegistry));</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineminus">-</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;Mozilla&quot;));</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;Application Registry&quot;));</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">-#elif defined(XP_UNIX)</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineminus">-  fileLocator-&gt;Get(NS_UNIX_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineminus">-                   getter_AddRefs(seamonkeyRegistry));</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;.mozilla&quot;));</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;appreg&quot;));</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineminus">-#elif defined(XP_BEOS)</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">-   fileLocator-&gt;Get(NS_BEOS_SETTINGS_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-                    getter_AddRefs(seamonkeyRegistry));</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineminus">-</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineminus">-   seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;Mozilla&quot;));</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-   seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;appreg&quot;));</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">-#elif defined(XP_OS2)</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-  fileLocator-&gt;Get(NS_OS2_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-                   getter_AddRefs(seamonkeyRegistry));</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineminus">-</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;Mozilla&quot;));</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-  seamonkeyRegistry-&gt;Append(NS_LITERAL_STRING(&quot;registry.dat&quot;));</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-#endif</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineminus">-  return GetProfileDataFromRegistry(seamonkeyRegistry, mProfileNames,</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-                                    mProfileLocations);</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineplus">+  return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l36.51"></a><span id="l36.51"> }</span>
<a href="#l36.52"></a><span id="l36.52"> </span>
<a href="#l36.53"></a><span id="l36.53"> static</span>
<a href="#l36.54"></a><span id="l36.54"> nsSeamonkeyProfileMigrator::PrefTransform gTransforms[] = {</span>
<a href="#l36.55"></a><span id="l36.55">   MAKESAMETYPEPREFTRANSFORM(&quot;addressbook.throbber.url&quot;,                String),</span>
<a href="#l36.56"></a><span id="l36.56">   MAKESAMETYPEPREFTRANSFORM(&quot;advanced.mailftp&quot;,                        Bool),</span>
<a href="#l36.57"></a><span id="l36.57">   MAKESAMETYPEPREFTRANSFORM(&quot;application.use_ns_plugin_finder&quot;,        Bool),</span>
<a href="#l36.58"></a><span id="l36.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -271,24 +271,17 @@ nsThunderbirdProfileMigrator::FillProfil</span>
<a href="#l37.4"></a><span id="l37.4">   return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l37.5"></a><span id="l37.5"> #endif</span>
<a href="#l37.6"></a><span id="l37.6"> </span>
<a href="#l37.7"></a><span id="l37.7">   // Try profiles.ini first</span>
<a href="#l37.8"></a><span id="l37.8">   nsresult rv = GetProfileDataFromProfilesIni(thunderbirdData,</span>
<a href="#l37.9"></a><span id="l37.9">                                               mProfileNames,</span>
<a href="#l37.10"></a><span id="l37.10">                                               mProfileLocations);</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  if (rv != NS_ERROR_FILE_NOT_FOUND)</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-    return rv;</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-  thunderbirdData-&gt;Append(NS_LITERAL_STRING(REGISTRY_FILE));</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">-  // Then try the old registry format</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-  return GetProfileDataFromRegistry(thunderbirdData, mProfileNames,</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-                                    mProfileLocations);</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+  return rv;</span>
<a href="#l37.21"></a><span id="l37.21"> }</span>
<a href="#l37.22"></a><span id="l37.22"> </span>
<a href="#l37.23"></a><span id="l37.23"> static</span>
<a href="#l37.24"></a><span id="l37.24"> nsThunderbirdProfileMigrator::PrefTransform gTransforms[] = {</span>
<a href="#l37.25"></a><span id="l37.25">   MAKESAMETYPEPREFTRANSFORM(&quot;accessibility.typeaheadfind.autostart&quot;,   Bool),</span>
<a href="#l37.26"></a><span id="l37.26">   MAKESAMETYPEPREFTRANSFORM(&quot;accessibility.typeaheadfind.linksonly&quot;,   Bool),</span>
<a href="#l37.27"></a><span id="l37.27"> </span>
<a href="#l37.28"></a><span id="l37.28">   MAKESAMETYPEPREFTRANSFORM(&quot;browser.anchor_color&quot;,                    String),</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

