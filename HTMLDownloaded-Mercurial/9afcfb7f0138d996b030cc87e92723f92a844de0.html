<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28892:9afcfb7f0138d996b030cc87e92723f92a844de0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9afcfb7f0138d996b030cc87e92723f92a844de0" />
<meta property="og:url" content="/comm-central/rev/9afcfb7f0138d996b030cc87e92723f92a844de0" />
<meta property="og:description" content="Bug 1619097 - Port bug 1617794: Wrap Windows tools with Wine on cross builds. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9afcfb7f0138d996b030cc87e92723f92a844de0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9afcfb7f0138d996b030cc87e92723f92a844de0">shortlog</a> |
<a href="/comm-central/log/9afcfb7f0138d996b030cc87e92723f92a844de0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9afcfb7f0138d996b030cc87e92723f92a844de0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9afcfb7f0138d996b030cc87e92723f92a844de0">files</a> |
changeset |
<a href="/comm-central/raw-rev/9afcfb7f0138d996b030cc87e92723f92a844de0">raw</a>  | <a href="/comm-central/archive/9afcfb7f0138d996b030cc87e92723f92a844de0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1619097">Bug 1619097</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1617794">bug 1617794</a>: Wrap Windows tools with Wine on cross builds. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#32;&#76;&#101;&#109;&#108;&#101;&#121;&#32;&#60;&#114;&#111;&#98;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 27 Feb 2020 21:35:23 -0500</td></tr>

<tr>
 <td>changeset 28892</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9afcfb7f0138d996b030cc87e92723f92a844de0">9afcfb7f0138d996b030cc87e92723f92a844de0</a></td>
</tr>



<tr>
<td>parent 28891</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5eae61097a7e9ede09c2151df88eeaf6edb77ae7">5eae61097a7e9ede09c2151df88eeaf6edb77ae7</a>
</td>
</tr>

<tr>
<td>child 28893</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/526492aedbb6b9ea320fdaf1d38b2e0b170117be">526492aedbb6b9ea320fdaf1d38b2e0b170117be</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9afcfb7f0138d996b030cc87e92723f92a844de0">17100</a></td></tr>
<tr><td>push user</td><td>thunderbird@calypsoblue.org</td></tr>
<tr><td>push date</td><td class="date age">Thu, 05 Mar 2020 15:07:39 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@526492aedbb6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=526492aedbb6b9ea320fdaf1d38b2e0b170117be">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=526492aedbb6b9ea320fdaf1d38b2e0b170117be&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=526492aedbb6b9ea320fdaf1d38b2e0b170117be&newProject=comm-central&newRevision=9afcfb7f0138d996b030cc87e92723f92a844de0&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=526492aedbb6b9ea320fdaf1d38b2e0b170117be&newProject=comm-central&newRevision=9afcfb7f0138d996b030cc87e92723f92a844de0&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=526492aedbb6b9ea320fdaf1d38b2e0b170117be&newProject=comm-central&newRevision=9afcfb7f0138d996b030cc87e92723f92a844de0&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1619097">1619097</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1617794">1617794</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1619097">Bug 1619097</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1617794">bug 1617794</a>: Wrap Windows tools with Wine on cross builds. r=darktrojan

WINEWRAP does path translation for running Windows tools such as MIDL via
WINE. Unix absolute paths also need to be converted to relative paths.
The only IDL in Thunderbird is for MAPI. Both of the DEFFILE entries for
the MAPI code need to be changed to relative paths rather than prepending
SRCPATH to make them absolute. This is the case elsewhere as well.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapiDll/moz.build">mailnews/mapi/mapiDll/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapiDll/moz.build">file</a> |
<a href="/comm-central/annotate/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapiDll/moz.build">annotate</a> |
<a href="/comm-central/diff/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapiDll/moz.build">diff</a> |
<a href="/comm-central/comparison/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapiDll/moz.build">comparison</a> |
<a href="/comm-central/log/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapiDll/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/Makefile.in">mailnews/mapi/mapihook/build/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/Makefile.in">file</a> |
<a href="/comm-central/annotate/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/Makefile.in">annotate</a> |
<a href="/comm-central/diff/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/Makefile.in">diff</a> |
<a href="/comm-central/comparison/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/Makefile.in">comparison</a> |
<a href="/comm-central/log/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/moz.build">mailnews/mapi/mapihook/build/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/moz.build">file</a> |
<a href="/comm-central/annotate/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/moz.build">annotate</a> |
<a href="/comm-central/diff/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/moz.build">diff</a> |
<a href="/comm-central/comparison/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/moz.build">comparison</a> |
<a href="/comm-central/log/9afcfb7f0138d996b030cc87e92723f92a844de0/mailnews/mapi/mapihook/build/moz.build">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/mapi/mapiDll/moz.build</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/mapi/mapiDll/moz.build</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -14,9 +14,9 @@ SOURCES += [</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> OS_LIBS += [</span>
<a href="#l1.6"></a><span id="l1.6">     'ole32',</span>
<a href="#l1.7"></a><span id="l1.7"> ]</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> DEFINES['UNICODE'] = True</span>
<a href="#l1.10"></a><span id="l1.10"> DEFINES['_UNICODE'] = True</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-DEFFILE = SRCDIR + '/Mapi32.def'</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+DEFFILE = 'Mapi32.def'</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/mapi/mapihook/build/Makefile.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/build/Makefile.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -9,17 +9,17 @@ MIDL_GENERATED_FILES = \</span>
<a href="#l2.4"></a><span id="l2.4"> 	msgMapi.h \</span>
<a href="#l2.5"></a><span id="l2.5"> 	msgMapi_p.c \</span>
<a href="#l2.6"></a><span id="l2.6"> 	msgMapi_i.c \</span>
<a href="#l2.7"></a><span id="l2.7"> 	$(NULL)</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> $(MIDL_GENERATED_FILES): done_gen ;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> done_gen: $(srcdir)/msgMapi.idl</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-	$(MIDL) $(MIDL_FLAGS) -I $(srcdir) -Oicf $(srcdir)/msgMapi.idl</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+	$(call WINEWRAP,$(MIDL)) $(MIDL_FLAGS) -I $(srcdir_rel) -Oicf $(srcdir_rel)/msgMapi.idl</span>
<a href="#l2.14"></a><span id="l2.14"> 	touch $@</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> export:: done_gen</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> midl_exports := \</span>
<a href="#l2.19"></a><span id="l2.19"> 	msgMapi.h \</span>
<a href="#l2.20"></a><span id="l2.20"> 	msgMapi_i.c \</span>
<a href="#l2.21"></a><span id="l2.21"> 	$(NULL)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/mapi/mapihook/build/moz.build</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/build/moz.build</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -20,17 +20,17 @@ GENERATED_FILES += [</span>
<a href="#l3.4"></a><span id="l3.4">     'msgMapi.h',</span>
<a href="#l3.5"></a><span id="l3.5">     'msgMapi_i.c',</span>
<a href="#l3.6"></a><span id="l3.6">     'msgMapi_p.c'</span>
<a href="#l3.7"></a><span id="l3.7"> ]</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> for var in ('REGISTER_PROXY_DLL', 'UNICODE', '_UNICODE'):</span>
<a href="#l3.10"></a><span id="l3.10">     DEFINES[var] = True</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-DEFFILE = SRCDIR + '/MapiProxy.def'</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+DEFFILE = 'MapiProxy.def'</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> # The Windows MIDL code generator creates things like:</span>
<a href="#l3.16"></a><span id="l3.16"> #</span>
<a href="#l3.17"></a><span id="l3.17"> #   #endif !_MIDL_USE_GUIDDEF_</span>
<a href="#l3.18"></a><span id="l3.18"> #</span>
<a href="#l3.19"></a><span id="l3.19"> # which clang-cl complains about.  MSVC doesn't, so turn this warning off.</span>
<a href="#l3.20"></a><span id="l3.20"> if CONFIG['CC_TYPE'] == 'clang-cl':</span>
<a href="#l3.21"></a><span id="l3.21">     CFLAGS += ['-Wno-extra-tokens']</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

