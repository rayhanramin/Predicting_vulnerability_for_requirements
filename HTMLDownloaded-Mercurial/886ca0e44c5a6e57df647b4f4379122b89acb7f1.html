<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24627:886ca0e44c5a6e57df647b4f4379122b89acb7f1</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 886ca0e44c5a6e57df647b4f4379122b89acb7f1" />
<meta property="og:url" content="/comm-central/rev/886ca0e44c5a6e57df647b4f4379122b89acb7f1" />
<meta property="og:description" content="Bug 1475867 - Port |Bug 1238712 - Remove duplication between nsWindowsShellService, nsGnomeShellService, and nsMacShellService| to SeaMonkey r=frg" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 886ca0e44c5a6e57df647b4f4379122b89acb7f1 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/886ca0e44c5a6e57df647b4f4379122b89acb7f1">shortlog</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/886ca0e44c5a6e57df647b4f4379122b89acb7f1">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1">files</a> |
changeset |
<a href="/comm-central/raw-rev/886ca0e44c5a6e57df647b4f4379122b89acb7f1">raw</a>  | <a href="/comm-central/archive/886ca0e44c5a6e57df647b4f4379122b89acb7f1.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1475867">Bug 1475867</a> - Port |<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1238712">Bug 1238712</a> - Remove duplication between nsWindowsShellService, nsGnomeShellService, and nsMacShellService| to SeaMonkey r=frg
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 02 Sep 2018 19:34:32 +0200</td></tr>

<tr>
 <td>changeset 24627</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/886ca0e44c5a6e57df647b4f4379122b89acb7f1">886ca0e44c5a6e57df647b4f4379122b89acb7f1</a></td>
</tr>



<tr>
<td>parent 24626</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/52a24ee9c3cc72e039c89101dc82cc1486b177bf">52a24ee9c3cc72e039c89101dc82cc1486b177bf</a>
</td>
</tr>

<tr>
<td>child 24628</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/b79e5c816ecb7c6a41b0a9e6f27d4ca4c9eb6a6e">b79e5c816ecb7c6a41b0a9e6f27d4ca4c9eb6a6e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=886ca0e44c5a6e57df647b4f4379122b89acb7f1">14819</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 02 Sep 2018 17:37:24 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@886ca0e44c5a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=886ca0e44c5a6e57df647b4f4379122b89acb7f1">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&newProject=comm-central&newRevision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&newProject=comm-central&newRevision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&newProject=comm-central&newRevision=886ca0e44c5a6e57df647b4f4379122b89acb7f1&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28frg%29&revcount=50">frg</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1475867">1475867</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1238712">1238712</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1475867">Bug 1475867</a> - Port |<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1238712">Bug 1238712</a> - Remove duplication between nsWindowsShellService, nsGnomeShellService, and nsMacShellService| to SeaMonkey r=frg</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/defaultClientDialog.js">suite/base/content/defaultClientDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/defaultClientDialog.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/defaultClientDialog.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/defaultClientDialog.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/defaultClientDialog.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/defaultClientDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/nsContextMenu.js">suite/base/content/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/base/content/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/nsSuiteGlue.js">suite/components/nsSuiteGlue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/nsSuiteGlue.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/nsSuiteGlue.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/nsSuiteGlue.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/nsSuiteGlue.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/nsSuiteGlue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-advanced.js">suite/components/pref/content/pref-advanced.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-advanced.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-advanced.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-advanced.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-advanced.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-advanced.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-navigator.js">suite/components/pref/content/pref-navigator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-navigator.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-navigator.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-navigator.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-navigator.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/pref/content/pref-navigator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/ShellService.jsm">suite/components/shell/ShellService.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/ShellService.jsm">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/ShellService.jsm">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/ShellService.jsm">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/ShellService.jsm">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/ShellService.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/content/setDesktopBackground.js">suite/components/shell/content/setDesktopBackground.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/content/setDesktopBackground.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/content/setDesktopBackground.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/content/setDesktopBackground.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/content/setDesktopBackground.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/content/setDesktopBackground.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/moz.build">suite/components/shell/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/moz.build">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/moz.build">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/moz.build">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/moz.build">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.cpp">suite/components/shell/nsGNOMEShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.cpp">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.cpp">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.cpp">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.cpp">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.h">suite/components/shell/nsGNOMEShellService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.h">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.h">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.h">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.h">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsGNOMEShellService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIGNOMEShellService.idl">suite/components/shell/nsIGNOMEShellService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIGNOMEShellService.idl">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIGNOMEShellService.idl">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIGNOMEShellService.idl">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIGNOMEShellService.idl">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIGNOMEShellService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIMacShellService.idl">suite/components/shell/nsIMacShellService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIMacShellService.idl">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIMacShellService.idl">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIMacShellService.idl">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIMacShellService.idl">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIMacShellService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIShellService.idl">suite/components/shell/nsIShellService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIShellService.idl">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIShellService.idl">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIShellService.idl">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIShellService.idl">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsIShellService.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.cpp">suite/components/shell/nsMacShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.cpp">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.cpp">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.cpp">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.cpp">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.h">suite/components/shell/nsMacShellService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.h">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.h">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.h">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.h">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsMacShellService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsSetDefault.js">suite/components/shell/nsSetDefault.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsSetDefault.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsSetDefault.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsSetDefault.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsSetDefault.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsSetDefault.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.cpp">suite/components/shell/nsWindowsShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.cpp">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.cpp">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.cpp">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.cpp">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.h">suite/components/shell/nsWindowsShellService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.h">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.h">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.h">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.h">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/components/shell/nsWindowsShellService.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/mailnews/prefs/pref-mailnews.js">suite/mailnews/prefs/pref-mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/mailnews/prefs/pref-mailnews.js">file</a> |
<a href="/comm-central/annotate/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/mailnews/prefs/pref-mailnews.js">annotate</a> |
<a href="/comm-central/diff/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/mailnews/prefs/pref-mailnews.js">diff</a> |
<a href="/comm-central/comparison/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/mailnews/prefs/pref-mailnews.js">comparison</a> |
<a href="/comm-central/log/886ca0e44c5a6e57df647b4f4379122b89acb7f1/suite/mailnews/prefs/pref-mailnews.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/base/content/defaultClientDialog.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/base/content/defaultClientDialog.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,62 +1,58 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l1.5"></a><span id="l1.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.6"></a><span id="l1.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.7"></a><span id="l1.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> // this dialog can only be opened if we have a shell service</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-const nsIShellService = Ci.nsIShellService;</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+ChromeUtils.import(&quot;resource:///modules/ShellService.jsm&quot;);</span>
<a href="#l1.12"></a><span id="l1.12"> const nsIPrefBranch = Ci.nsIPrefBranch;</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> function onLoad()</span>
<a href="#l1.15"></a><span id="l1.15"> {</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-  var shellSvc = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-                   .getService(nsIShellService);</span>
<a href="#l1.18"></a><span id="l1.18">   var defaultList = document.getElementById(&quot;defaultList&quot;);</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-  var appTypes = shellSvc.shouldBeDefaultClientFor;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+  var appTypes = ShellService.shouldBeDefaultClientFor;</span>
<a href="#l1.21"></a><span id="l1.21">   /* Iterate through the list of possible default client types and check for</span>
<a href="#l1.22"></a><span id="l1.22">      each list item if we want to be the default for that type using the AND</span>
<a href="#l1.23"></a><span id="l1.23">      conjunction */</span>
<a href="#l1.24"></a><span id="l1.24">   for (var i = 0; i &lt; defaultList.getRowCount(); i++) {</span>
<a href="#l1.25"></a><span id="l1.25">     var currentItem = defaultList.getItemAtIndex(i);</span>
<a href="#l1.26"></a><span id="l1.26">     try {</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-      if (shellSvc.isDefaultClient(false, nsIShellService[currentItem.value])) {</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+      if (ShellService.isDefaultClient(false, Ci.nsIShellService[currentItem.value])) {</span>
<a href="#l1.29"></a><span id="l1.29">         currentItem.checked = true;</span>
<a href="#l1.30"></a><span id="l1.30">         currentItem.disabled = true;</span>
<a href="#l1.31"></a><span id="l1.31">       }</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-      else if (nsIShellService[currentItem.value] &amp; appTypes)</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+      else if (Ci.nsIShellService[currentItem.value] &amp; appTypes)</span>
<a href="#l1.34"></a><span id="l1.34">         currentItem.checked = true;</span>
<a href="#l1.35"></a><span id="l1.35">     } catch (e) {</span>
<a href="#l1.36"></a><span id="l1.36">       currentItem.hidden = true;</span>
<a href="#l1.37"></a><span id="l1.37">     }</span>
<a href="#l1.38"></a><span id="l1.38">   }</span>
<a href="#l1.39"></a><span id="l1.39"> }</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41"> function onAccept()</span>
<a href="#l1.42"></a><span id="l1.42"> {</span>
<a href="#l1.43"></a><span id="l1.43">   // for each checked item, if we aren't already the default, make us the default.</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-  var shellSvc = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-                   .getService(nsIShellService);</span>
<a href="#l1.46"></a><span id="l1.46">   var appTypes = 0;</span>
<a href="#l1.47"></a><span id="l1.47">   var appTypesCheck = 0;</span>
<a href="#l1.48"></a><span id="l1.48">   var defaultList = document.getElementById(&quot;defaultList&quot;);</span>
<a href="#l1.49"></a><span id="l1.49"> </span>
<a href="#l1.50"></a><span id="l1.50">   for (var i = 0; i &lt; defaultList.getRowCount(); i++) {</span>
<a href="#l1.51"></a><span id="l1.51">     var currentItem = defaultList.getItemAtIndex(i);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-    var currentAppType = nsIShellService[currentItem.value];</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+    var currentAppType = Ci.nsIShellService[currentItem.value];</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55">     if (currentItem.checked) {</span>
<a href="#l1.56"></a><span id="l1.56">       appTypesCheck |= currentAppType;</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58">       if (!currentItem.disabled)</span>
<a href="#l1.59"></a><span id="l1.59">         appTypes |= currentAppType;</span>
<a href="#l1.60"></a><span id="l1.60">     }</span>
<a href="#l1.61"></a><span id="l1.61">   }</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63">   if (appTypes)</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-    shellSvc.setDefaultClient(false, true, appTypes);</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+    ShellService.setDefaultClient(false, true, appTypes);</span>
<a href="#l1.66"></a><span id="l1.66"> </span>
<a href="#l1.67"></a><span id="l1.67">   // Update the pref for which app types we should check if we are the default app</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-  shellSvc.shouldBeDefaultClientFor = appTypesCheck;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+  ShellService.shouldBeDefaultClientFor = appTypesCheck;</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-  shellSvc.shouldCheckDefaultClient = document.getElementById('checkOnStartup').checked;</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+  ShellService.shouldCheckDefaultClient = document.getElementById('checkOnStartup').checked;</span>
<a href="#l1.73"></a><span id="l1.73"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/base/content/nsContextMenu.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/base/content/nsContextMenu.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -29,16 +29,17 @@ XPCOMUtils.defineLazyGetter(this, &quot;PageM</span>
<a href="#l2.4"></a><span id="l2.4">   ChromeUtils.import(&quot;resource://gre/modules/PageMenu.jsm&quot;, tmp);</span>
<a href="#l2.5"></a><span id="l2.5">   return new tmp.PageMenuParent();</span>
<a href="#l2.6"></a><span id="l2.6"> });</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> XPCOMUtils.defineLazyModuleGetters(this, {</span>
<a href="#l2.9"></a><span id="l2.9">   DevToolsShim: &quot;chrome://devtools-shim/content/DevToolsShim.jsm&quot;,</span>
<a href="#l2.10"></a><span id="l2.10">   findCssSelector: &quot;resource://gre/modules/css-selector.js&quot;,</span>
<a href="#l2.11"></a><span id="l2.11">   NetUtil: &quot;resource://gre/modules/NetUtil.jsm&quot;,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  ShellService: &quot;resource:///modules/ShellService.jsm&quot;,</span>
<a href="#l2.13"></a><span id="l2.13"> });</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15"> function nsContextMenu(aXulMenu, aIsShift, aEvent) {</span>
<a href="#l2.16"></a><span id="l2.16">   this.shouldDisplay = true;</span>
<a href="#l2.17"></a><span id="l2.17">   this.initMenu(aXulMenu, aIsShift, aEvent);</span>
<a href="#l2.18"></a><span id="l2.18"> }</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> // Prototype for nsContextMenu &quot;class.&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -233,24 +234,18 @@ nsContextMenu.prototype = {</span>
<a href="#l2.22"></a><span id="l2.22">     this.showItem(&quot;inspect-separator&quot;, showInspect);</span>
<a href="#l2.23"></a><span id="l2.23">     this.showItem(&quot;context-inspect&quot;, showInspect);</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">     this.showItem(&quot;context-sep-properties&quot;,</span>
<a href="#l2.26"></a><span id="l2.26">                   !(this.inDirList || this.isContentSelected || this.onTextInput ||</span>
<a href="#l2.27"></a><span id="l2.27">                     this.onCanvas || this.onVideo || this.onAudio));</span>
<a href="#l2.28"></a><span id="l2.28">     // Set Desktop Background depends on whether an image was clicked on,</span>
<a href="#l2.29"></a><span id="l2.29">     // and requires the shell service.</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-    var canSetDesktopBackground = false;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-    if (&quot;@mozilla.org/suite/shell-service;1&quot; in Cc) try {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-      canSetDesktopBackground =</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-          Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-            .getService(Ci.nsIShellService)</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-            .canSetDesktopBackground;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-    } catch (e) {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-    }</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+    var canSetDesktopBackground = ShellService &amp;&amp;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+                                  ShellService.canSetDesktopBackground;</span>
<a href="#l2.40"></a><span id="l2.40">     this.showItem(&quot;context-setDesktopBackground&quot;,</span>
<a href="#l2.41"></a><span id="l2.41">                   canSetDesktopBackground &amp;&amp; (this.onLoadedImage || this.onStandaloneImage));</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43">     this.showItem(&quot;context-sep-image&quot;,</span>
<a href="#l2.44"></a><span id="l2.44">                   this.onLoadedImage || this.onStandaloneImage);</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46">     if (canSetDesktopBackground &amp;&amp; this.onLoadedImage)</span>
<a href="#l2.47"></a><span id="l2.47">       // Disable the Set Desktop Background menu item if we're still trying to load the image</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/components/nsSuiteGlue.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/components/nsSuiteGlue.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -18,16 +18,17 @@ XPCOMUtils.defineLazyModuleGetters(this,</span>
<a href="#l3.4"></a><span id="l3.4">   PlacesUtils: &quot;resource://gre/modules/PlacesUtils.jsm&quot;,</span>
<a href="#l3.5"></a><span id="l3.5">   PlacesBackups: &quot;resource://gre/modules/PlacesBackups.jsm&quot;,</span>
<a href="#l3.6"></a><span id="l3.6">   AsyncShutdown: &quot;resource://gre/modules/AsyncShutdown.jsm&quot;,</span>
<a href="#l3.7"></a><span id="l3.7">   AutoCompletePopup: &quot;resource://gre/modules/AutoCompletePopup.jsm&quot;,</span>
<a href="#l3.8"></a><span id="l3.8">   BookmarkHTMLUtils: &quot;resource://gre/modules/BookmarkHTMLUtils.jsm&quot;,</span>
<a href="#l3.9"></a><span id="l3.9">   BookmarkJSONUtils: &quot;resource://gre/modules/BookmarkJSONUtils.jsm&quot;,</span>
<a href="#l3.10"></a><span id="l3.10">   RecentWindow: &quot;resource:///modules/RecentWindow.jsm&quot;,</span>
<a href="#l3.11"></a><span id="l3.11">   Sanitizer: &quot;resource:///modules/Sanitizer.jsm&quot;,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  ShellService: &quot;resource:///modules/ShellService.jsm&quot;,</span>
<a href="#l3.13"></a><span id="l3.13">   DownloadsCommon: &quot;resource:///modules/DownloadsCommon.jsm&quot;,</span>
<a href="#l3.14"></a><span id="l3.14">   PrivateBrowsingUtils: &quot;resource://gre/modules/PrivateBrowsingUtils.jsm&quot;,</span>
<a href="#l3.15"></a><span id="l3.15">   Integration: &quot;resource://gre/modules/Integration.jsm&quot;,</span>
<a href="#l3.16"></a><span id="l3.16">   PermissionUI: &quot;resource:///modules/PermissionUI.jsm&quot;,</span>
<a href="#l3.17"></a><span id="l3.17"> });</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> XPCOMUtils.defineLazyGetter(this, &quot;DebuggerServer&quot;, () =&gt; {</span>
<a href="#l3.20"></a><span id="l3.20">   var tmp = {};</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -881,29 +882,24 @@ SuiteGlue.prototype = {</span>
<a href="#l3.22"></a><span id="l3.22">     // We should warn if the build is older than the max age.</span>
<a href="#l3.23"></a><span id="l3.23">     return (buildTime + maxAge &lt;= now);</span>
<a href="#l3.24"></a><span id="l3.24">   },</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">   // This method gets the shell service and has it check its settings.</span>
<a href="#l3.27"></a><span id="l3.27">   // This will do nothing on platforms without a shell service.</span>
<a href="#l3.28"></a><span id="l3.28">   _checkForDefaultClient: function checkForDefaultClient(aWindow)</span>
<a href="#l3.29"></a><span id="l3.29">   {</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-    const NS_SHELLSERVICE_CID = &quot;@mozilla.org/suite/shell-service;1&quot;;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    if (NS_SHELLSERVICE_CID in Cc) try {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-      var nsIShellService = Ci.nsIShellService;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-      var shellService = Cc[NS_SHELLSERVICE_CID]</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-                           .getService(nsIShellService);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-      var appTypes = shellService.shouldBeDefaultClientFor;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+    if (ShellService) try {</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+      var appTypes = ShellService.shouldBeDefaultClientFor;</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40">       // Show the default client dialog only if we should check for the default</span>
<a href="#l3.41"></a><span id="l3.41">       // client and we aren't already the default for the stored app types in</span>
<a href="#l3.42"></a><span id="l3.42">       // shell.checkDefaultApps.</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-      if (appTypes &amp;&amp; shellService.shouldCheckDefaultClient &amp;&amp;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-          !shellService.isDefaultClient(true, appTypes)) {</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+      if (appTypes &amp;&amp; ShellService.shouldCheckDefaultClient &amp;&amp;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+          !ShellService.isDefaultClient(true, appTypes)) {</span>
<a href="#l3.47"></a><span id="l3.47">         aWindow.openDialog(&quot;chrome://communicator/content/defaultClientDialog.xul&quot;,</span>
<a href="#l3.48"></a><span id="l3.48">                            &quot;DefaultClient&quot;,</span>
<a href="#l3.49"></a><span id="l3.49">                            &quot;modal,centerscreen,chrome,resizable=no&quot;);</span>
<a href="#l3.50"></a><span id="l3.50">       }</span>
<a href="#l3.51"></a><span id="l3.51">     } catch (e) {}</span>
<a href="#l3.52"></a><span id="l3.52">   },</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/components/pref/content/pref-advanced.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/components/pref/content/pref-advanced.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.5"></a><span id="l4.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.6"></a><span id="l4.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.7"></a><span id="l4.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+ChromeUtils.import(&quot;resource:///modules/ShellService.jsm&quot;);</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+</span>
<a href="#l4.11"></a><span id="l4.11"> function Startup()</span>
<a href="#l4.12"></a><span id="l4.12"> {</span>
<a href="#l4.13"></a><span id="l4.13">   SysPrefCheck();</span>
<a href="#l4.14"></a><span id="l4.14">   ShellServiceCheck();</span>
<a href="#l4.15"></a><span id="l4.15">   CrashReportsCheck();</span>
<a href="#l4.16"></a><span id="l4.16"> }</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> /**</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineat">@@ -19,22 +21,18 @@ function SysPrefCheck()</span>
<a href="#l4.20"></a><span id="l4.20">   const kPrefService = &quot;@mozilla.org/system-preference-service;1&quot;;</span>
<a href="#l4.21"></a><span id="l4.21">   let visible = kPrefService in Cc &amp;&amp;</span>
<a href="#l4.22"></a><span id="l4.22">     Cc[kPrefService].getService() instanceof Ci.nsIPrefBranch;</span>
<a href="#l4.23"></a><span id="l4.23">   document.getElementById(&quot;systemPrefs&quot;).hidden = !visible;</span>
<a href="#l4.24"></a><span id="l4.24"> }</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26"> function ShellServiceCheck()</span>
<a href="#l4.27"></a><span id="l4.27"> {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-  const NS_SHELLSERVICE_CID = &quot;@mozilla.org/suite/shell-service;1&quot;;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  if (NS_SHELLSERVICE_CID in Cc) try {</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    Cc[NS_SHELLSERVICE_CID]</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-      .getService(Ci.nsIShellService)</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-      .shouldCheckDefaultClient;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+  if (ShellService) try {</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+    ShellService.shouldCheckDefaultClient;</span>
<a href="#l4.36"></a><span id="l4.36">     document.getElementById(&quot;checkDefault&quot;).hidden = false;</span>
<a href="#l4.37"></a><span id="l4.37">   } catch (e) {</span>
<a href="#l4.38"></a><span id="l4.38">   }</span>
<a href="#l4.39"></a><span id="l4.39"> }</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41"> function CrashReportsCheck()</span>
<a href="#l4.42"></a><span id="l4.42"> {</span>
<a href="#l4.43"></a><span id="l4.43">   if (&quot;nsICrashReporter&quot; in Ci)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/components/pref/content/pref-navigator.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/components/pref/content/pref-navigator.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.5"></a><span id="l5.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+ChromeUtils.import(&quot;resource:///modules/ShellService.jsm&quot;);</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+</span>
<a href="#l5.11"></a><span id="l5.11"> // The contents of this file will be loaded into the scope of the object</span>
<a href="#l5.12"></a><span id="l5.12"> // &lt;prefpane id=&quot;navigator_pane&quot;&gt;!</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> // platform integration</span>
<a href="#l5.15"></a><span id="l5.15"> const PFINT_NOT_DEFAULT = 0;</span>
<a href="#l5.16"></a><span id="l5.16"> const PFINT_DEFAULT     = 1;</span>
<a href="#l5.17"></a><span id="l5.17"> const PFINT_PENDING     = 2;</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19" class="difflineat">@@ -262,38 +264,28 @@ function WriteConcurrentTabs()</span>
<a href="#l5.20"></a><span id="l5.20">   var val = document.getElementById(&quot;maxConcurrentTabsGroup&quot;).value;</span>
<a href="#l5.21"></a><span id="l5.21">   return val &gt; 0 ? document.getElementById(&quot;maxConcurrentTabs&quot;).value : val;</span>
<a href="#l5.22"></a><span id="l5.22"> }</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24"> // platform integration</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26"> function ApplySetAsDefaultBrowser()</span>
<a href="#l5.27"></a><span id="l5.27"> {</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-  const nsIShellService = Ci.nsIShellService;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-  var shellSvc = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-                   .getService(nsIShellService);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  shellSvc.setDefaultClient(false, false, nsIShellService.BROWSER);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-  shellSvc.shouldBeDefaultClientFor |= nsIShellService.BROWSER;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  ShellService.setDefaultClient(false, false, Ci.nsIShellService.BROWSER);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+  ShellService.shouldBeDefaultClientFor |= Ci.nsIShellService.BROWSER;</span>
<a href="#l5.36"></a><span id="l5.36"> }</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38"> function IsDefaultBrowser()</span>
<a href="#l5.39"></a><span id="l5.39"> {</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-  const nsIShellService = Ci.nsIShellService;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-  var shellSvc = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-                   .getService(nsIShellService);</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-  return shellSvc.isDefaultClient(false, nsIShellService.BROWSER);</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+  return ShellService.isDefaultClient(false, Ci.nsIShellService.BROWSER);</span>
<a href="#l5.46"></a><span id="l5.46"> }</span>
<a href="#l5.47"></a><span id="l5.47"> </span>
<a href="#l5.48"></a><span id="l5.48"> function InitPlatformIntegration()</span>
<a href="#l5.49"></a><span id="l5.49"> {</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-  const NS_SHELLSERVICE_CID = &quot;@mozilla.org/suite/shell-service;1&quot;;</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-  if (NS_SHELLSERVICE_CID in Cc) try {</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+  if (ShellService) try {</span>
<a href="#l5.54"></a><span id="l5.54">     var desc = document.getElementById(&quot;defaultBrowserDesc&quot;);</span>
<a href="#l5.55"></a><span id="l5.55">     if (IsDefaultBrowser())</span>
<a href="#l5.56"></a><span id="l5.56">       desc.textContent = desc.getAttribute(&quot;desc1&quot;);</span>
<a href="#l5.57"></a><span id="l5.57">     else {</span>
<a href="#l5.58"></a><span id="l5.58">       desc.textContent = desc.getAttribute(&quot;desc0&quot;);</span>
<a href="#l5.59"></a><span id="l5.59">       document.getElementById(&quot;defaultBrowserButton&quot;).disabled = false;</span>
<a href="#l5.60"></a><span id="l5.60">     }</span>
<a href="#l5.61"></a><span id="l5.61"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/suite/components/shell/ShellService.jsm</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,108 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+* License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+* You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+var EXPORTED_SYMBOLS = [&quot;ShellService&quot;];</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+/**</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+ * Internal functionality to save and restore the docShell.allow* properties.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+ */</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+let ShellServiceInternal = {</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+  /**</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+   * Used to determine whether or not to offer &quot;Set as desktop background&quot;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+   * functionality. Even if shell service is available it is not</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+   * guaranteed that it is able to set the background for every desktop</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+   * which is especially true for Linux with its many different desktop</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+   * environments.</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+   */</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  get canSetDesktopBackground() {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+    if (AppConstants.platform == &quot;win&quot; ||</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+        AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+      return true;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+    }</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+    if (AppConstants.platform == &quot;linux&quot;) {</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+      if (this.shellService) {</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+        let linuxShellService = this.shellService</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+                                    .QueryInterface(Ci.nsIGNOMEShellService);</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+        return linuxShellService.canSetDesktopBackground;</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+      }</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+    }</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+    return false;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+  },</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+  /**</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+   * Used to determine whether or not to show a &quot;Set Default Client&quot;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+   * query dialog. This attribute is true if the application is starting</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+   * up and &quot;shell.checkDefaultClient&quot; is true, otherwise it is false.</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+   */</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+  _checkedThisSession: false,</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+  get shouldCheckDefaultClient() {</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+    // If we've already checked, the suite has been started and this is a</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+    // new window open, and we don't want to check again.</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    if (this._checkedThisSession) {</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+      return false;</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+    }</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+    return Services.prefs.getBoolPref(&quot;shell.checkDefaultClient&quot;);</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+  },</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+  set shouldCheckDefaultClient(shouldCheck) {</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+    Services.prefs.setBoolPref(&quot;shell.checkDefaultClient&quot;, !!shouldCheck);</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+  },</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+  get shouldBeDefaultClientFor() {</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+    return Services.prefs.getIntPref(&quot;shell.checkDefaultApps&quot;);</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+  },</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+  set shouldBeDefaultClientFor(appTypes) {</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+    Services.prefs.setIntPref(&quot;shell.checkDefaultApps&quot;, appTypes);</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+  },</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+  setDefaultClient(forAllUsers, claimAllTypes, appTypes) {</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+    try {</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+      this.shellService.setDefaultClient(forAllUsers, claimAllTypes, appTypes);</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+    } catch (ex) {</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+      Cu.reportError(ex);</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+    }</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+  },</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+  isDefaultClient(startupCheck, appTypes) {</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+    // If this is the first window, maintain internal state that we've</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+    // checked this session (so that subsequent window opens don't show the</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+    // default client dialog).</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+    if (startupCheck) {</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+      this._checkedThisSession = true;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+    }</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+    if (this.shellService) {</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+      return this.shellService.isDefaultClient(startupCheck, appTypes);</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+    }</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+    return false;</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+  }</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+};</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+XPCOMUtils.defineLazyServiceGetter(ShellServiceInternal, &quot;shellService&quot;,</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+  &quot;@mozilla.org/suite/shell-service;1&quot;, Ci.nsIShellService);</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+/**</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+ * The external API exported by this module.</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+ */</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+var ShellService = new Proxy(ShellServiceInternal, {</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineplus">+  get(target, name) {</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+    if (name in target) {</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+      return target[name];</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+    }</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+    if (target.shellService) {</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+      return target.shellService[name];</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+    }</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+    Services.console.logStringMessage(`${name} not found in ShellService: ${target.shellService}`);</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+    return undefined;</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+  }</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/components/shell/content/setDesktopBackground.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/components/shell/content/setDesktopBackground.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l7.5"></a><span id="l7.5">  *</span>
<a href="#l7.6"></a><span id="l7.6">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.7"></a><span id="l7.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.8"></a><span id="l7.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-const nsIShellService = Ci.nsIShellService;</span>
<a href="#l7.11"></a><span id="l7.11"> var gShell = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-               .getService(nsIShellService);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+               .getService(Ci.nsIShellService);</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15"> var gImage, gPosition, gPicker, gDesktop;</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> function onLoad()</span>
<a href="#l7.18"></a><span id="l7.18"> {</span>
<a href="#l7.19"></a><span id="l7.19">   document.getElementById(&quot;itemsBox&quot;).hidden = /Mac/.test(navigator.platform);</span>
<a href="#l7.20"></a><span id="l7.20">   gImage = window.arguments[0];</span>
<a href="#l7.21"></a><span id="l7.21">   gPosition = document.getElementById(&quot;position&quot;);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -36,17 +35,17 @@ function onLoad()</span>
<a href="#l7.23"></a><span id="l7.23">   updatePosition();</span>
<a href="#l7.24"></a><span id="l7.24"> }</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26"> function onApply()</span>
<a href="#l7.27"></a><span id="l7.27"> {</span>
<a href="#l7.28"></a><span id="l7.28">   if (!gPicker.parentNode.hidden)</span>
<a href="#l7.29"></a><span id="l7.29">     gShell.desktopBackgroundColor = parseInt(gPicker.color.substr(1), 16);</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  gShell.setDesktopBackground(gImage, nsIShellService[gPosition.value]);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  gShell.setDesktopBackground(gImage, Ci.nsIShellService[gPosition.value]);</span>
<a href="#l7.33"></a><span id="l7.33"> }</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35"> function updatePosition()</span>
<a href="#l7.36"></a><span id="l7.36"> {</span>
<a href="#l7.37"></a><span id="l7.37">   gDesktop.style.backgroundPosition = &quot;center&quot;;</span>
<a href="#l7.38"></a><span id="l7.38">   gDesktop.style.backgroundRepeat = &quot;no-repeat&quot;;</span>
<a href="#l7.39"></a><span id="l7.39">   switch (gPosition.value) {</span>
<a href="#l7.40"></a><span id="l7.40">     case &quot;BACKGROUND_FIT&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/components/shell/moz.build</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/components/shell/moz.build</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -3,16 +3,25 @@</span>
<a href="#l8.4"></a><span id="l8.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> XPIDL_SOURCES += [</span>
<a href="#l8.9"></a><span id="l8.9">     'nsIShellService.idl',</span>
<a href="#l8.10"></a><span id="l8.10"> ]</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'cocoa':</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    XPIDL_SOURCES += [</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+        'nsIMacShellService.idl',</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    ]</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gtk3':</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+    XPIDL_SOURCES += [</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+        'nsIGNOMEShellService.idl',</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+    ]</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+</span>
<a href="#l8.21"></a><span id="l8.21"> XPIDL_MODULE = 'shellservice'</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23"> if CONFIG['OS_ARCH'] == 'WINNT':</span>
<a href="#l8.24"></a><span id="l8.24">     SOURCES += [</span>
<a href="#l8.25"></a><span id="l8.25">         'nsWindowsShellService.cpp',</span>
<a href="#l8.26"></a><span id="l8.26">     ]</span>
<a href="#l8.27"></a><span id="l8.27">     LOCAL_INCLUDES += [</span>
<a href="#l8.28"></a><span id="l8.28">         '/other-licenses/nsis/Contrib/CityHash/cityhash',</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineat">@@ -29,13 +38,17 @@ elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gt</span>
<a href="#l8.30"></a><span id="l8.30">     SOURCES += ['nsGNOMEShellService.cpp']</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32"> if SOURCES:</span>
<a href="#l8.33"></a><span id="l8.33">     EXTRA_COMPONENTS += [</span>
<a href="#l8.34"></a><span id="l8.34">         'nsSetDefault.js',</span>
<a href="#l8.35"></a><span id="l8.35">         'nsSetDefault.manifest',</span>
<a href="#l8.36"></a><span id="l8.36">     ]</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+EXTRA_JS_MODULES += [</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+    'ShellService.jsm',</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+]</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+</span>
<a href="#l8.42"></a><span id="l8.42"> FINAL_LIBRARY = 'suite'</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44"> CXXFLAGS += CONFIG['TK_CFLAGS']</span>
<a href="#l8.45"></a><span id="l8.45"> </span>
<a href="#l8.46"></a><span id="l8.46"> JAR_MANIFESTS += ['jar.mn']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/components/shell/nsGNOMEShellService.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/components/shell/nsGNOMEShellService.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -76,31 +76,31 @@ static const ProtocolAssociation gProtoc</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> static const MimeTypeAssociation gMimeTypes[] = {</span>
<a href="#l9.6"></a><span id="l9.6">   { nsIShellService::BROWSER, &quot;text/html&quot;, &quot;htm html&quot; },</span>
<a href="#l9.7"></a><span id="l9.7">   { nsIShellService::BROWSER, &quot;application/xhtml+xml&quot;, &quot;xhtml&quot; },</span>
<a href="#l9.8"></a><span id="l9.8">   { nsIShellService::MAIL, &quot;message/rfc822&quot;, &quot;eml&quot; },</span>
<a href="#l9.9"></a><span id="l9.9">   { nsIShellService::RSS, &quot;application/rss+xml&quot;, &quot;rss&quot; }</span>
<a href="#l9.10"></a><span id="l9.10"> };</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-NS_IMPL_ISUPPORTS(nsGNOMEShellService, nsIShellService)</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+NS_IMPL_ISUPPORTS(nsGNOMEShellService, nsIGNOMEShellService, nsIShellService)</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15"> nsresult</span>
<a href="#l9.16"></a><span id="l9.16"> GetBrandName(nsACString&amp; aBrandName)</span>
<a href="#l9.17"></a><span id="l9.17"> {</span>
<a href="#l9.18"></a><span id="l9.18">   // get the product brand name from localized strings</span>
<a href="#l9.19"></a><span id="l9.19">   nsresult rv;</span>
<a href="#l9.20"></a><span id="l9.20">   nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l9.21"></a><span id="l9.21">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23">   nsCOMPtr&lt;nsIStringBundle&gt; brandBundle;</span>
<a href="#l9.24"></a><span id="l9.24">   rv = bundleService-&gt;CreateBundle(BRAND_PROPERTIES, getter_AddRefs(brandBundle));</span>
<a href="#l9.25"></a><span id="l9.25">   NS_ENSURE_TRUE(brandBundle, rv);</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-  nsString brandName;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+  nsAutoString brandName;</span>
<a href="#l9.29"></a><span id="l9.29">   rv = brandBundle-&gt;GetStringFromName(&quot;brandShortName&quot;, brandName);</span>
<a href="#l9.30"></a><span id="l9.30">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32">   CopyUTF16toUTF8(brandName, aBrandName);</span>
<a href="#l9.33"></a><span id="l9.33">   return rv;</span>
<a href="#l9.34"></a><span id="l9.34"> }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> nsresult</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineat">@@ -165,20 +165,18 @@ nsGNOMEShellService::HandlerMatchesAppNa</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39">   return matches;</span>
<a href="#l9.40"></a><span id="l9.40"> }</span>
<a href="#l9.41"></a><span id="l9.41"> </span>
<a href="#l9.42"></a><span id="l9.42"> NS_IMETHODIMP</span>
<a href="#l9.43"></a><span id="l9.43"> nsGNOMEShellService::IsDefaultClient(bool aStartupCheck, uint16_t aApps,</span>
<a href="#l9.44"></a><span id="l9.44">                                      bool* aIsDefaultClient)</span>
<a href="#l9.45"></a><span id="l9.45"> {</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-  if (aStartupCheck)</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-    mCheckedThisSessionClient = true;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+  *aIsDefaultClient = false;</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-  *aIsDefaultClient = false;</span>
<a href="#l9.51"></a><span id="l9.51">   nsCString handler;</span>
<a href="#l9.52"></a><span id="l9.52">   nsCOMPtr&lt;nsIGIOMimeApp&gt; gioApp;</span>
<a href="#l9.53"></a><span id="l9.53">   nsCOMPtr&lt;nsIGIOService&gt; giovfs = do_GetService(NS_GIOSERVICE_CONTRACTID);</span>
<a href="#l9.54"></a><span id="l9.54">   nsCOMPtr&lt;nsIGConfService&gt; gconf = do_GetService(NS_GCONFSERVICE_CONTRACTID);</span>
<a href="#l9.55"></a><span id="l9.55"> </span>
<a href="#l9.56"></a><span id="l9.56">   for (unsigned i = 0; i &lt; mozilla::ArrayLength(gProtocols); i++) {</span>
<a href="#l9.57"></a><span id="l9.57">     if (aApps &amp; gProtocols[i].app) {</span>
<a href="#l9.58"></a><span id="l9.58">       nsDependentCString protocol(gProtocols[i].protocol);</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineat">@@ -259,60 +257,16 @@ nsGNOMEShellService::SetDefaultClient(bo</span>
<a href="#l9.60"></a><span id="l9.60">       }</span>
<a href="#l9.61"></a><span id="l9.61">     }</span>
<a href="#l9.62"></a><span id="l9.62">   }</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64">   return NS_OK;</span>
<a href="#l9.65"></a><span id="l9.65"> }</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67"> NS_IMETHODIMP</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-nsGNOMEShellService::GetShouldCheckDefaultClient(bool* aResult)</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-{</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-  if (mCheckedThisSessionClient) {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-    *aResult = false;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-    return NS_OK;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-  }</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-  nsresult rv;</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-  return prefs-&gt;GetBoolPref(PREF_CHECKDEFAULTCLIENT, aResult);</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-}</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-nsGNOMEShellService::SetShouldCheckDefaultClient(bool aShouldCheck)</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-{</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-  nsresult rv;</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-  return prefs-&gt;SetBoolPref(PREF_CHECKDEFAULTCLIENT, aShouldCheck);</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-}</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineminus">-nsGNOMEShellService::GetShouldBeDefaultClientFor(uint16_t* aApps)</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-{</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-  nsresult rv;</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineminus">-  int32_t result;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineminus">-  rv = prefs-&gt;GetIntPref(&quot;shell.checkDefaultApps&quot;, &amp;result);</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineminus">-  *aApps = result;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineminus">-  return rv;</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineminus">-}</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineminus">-</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-nsGNOMEShellService::SetShouldBeDefaultClientFor(uint16_t aApps)</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-{</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-  nsresult rv;</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-  return prefs-&gt;SetIntPref(&quot;shell.checkDefaultApps&quot;, aApps);</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-}</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l9.112"></a><span id="l9.112"> nsGNOMEShellService::GetCanSetDesktopBackground(bool* aResult)</span>
<a href="#l9.113"></a><span id="l9.113"> {</span>
<a href="#l9.114"></a><span id="l9.114">   nsCOMPtr&lt;nsIGConfService&gt; gconf(do_GetService(NS_GCONFSERVICE_CONTRACTID));</span>
<a href="#l9.115"></a><span id="l9.115">   *aResult = gconf &amp;&amp; getenv(&quot;GNOME_DESKTOP_SESSION_ID&quot;);</span>
<a href="#l9.116"></a><span id="l9.116">   return NS_OK;</span>
<a href="#l9.117"></a><span id="l9.117"> }</span>
<a href="#l9.118"></a><span id="l9.118"> </span>
<a href="#l9.119"></a><span id="l9.119"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/components/shell/nsGNOMEShellService.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/components/shell/nsGNOMEShellService.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,37 +1,38 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> #ifndef nsgnomeshellservice_h____</span>
<a href="#l10.10"></a><span id="l10.10"> #define nsgnomeshellservice_h____</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-#include &quot;nsShellService.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+#include &quot;nsIGNOMEShellService.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsString.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsSuiteCID.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> struct ProtocolAssociation;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-class nsGNOMEShellService final : public nsIShellService</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+class nsGNOMEShellService final : public nsIGNOMEShellService</span>
<a href="#l10.22"></a><span id="l10.22"> {</span>
<a href="#l10.23"></a><span id="l10.23"> public:</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-  nsGNOMEShellService() : mCheckedThisSessionClient(false) { }</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+  nsGNOMEShellService() {};</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">   NS_DECL_ISUPPORTS</span>
<a href="#l10.28"></a><span id="l10.28">   NS_DECL_NSISHELLSERVICE</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+  NS_DECL_NSIGNOMESHELLSERVICE</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31">   nsresult Init();</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33"> private:</span>
<a href="#l10.34"></a><span id="l10.34">   ~nsGNOMEShellService() {}</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+</span>
<a href="#l10.36"></a><span id="l10.36">   bool HandlerMatchesAppName(const char* aHandler);</span>
<a href="#l10.37"></a><span id="l10.37"> </span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+  bool mUseLocaleFilenames;</span>
<a href="#l10.39"></a><span id="l10.39">   nsCString mAppPath;</span>
<a href="#l10.40"></a><span id="l10.40">   bool mAppIsInPath;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-  bool mUseLocaleFilenames;</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-  bool mCheckedThisSessionClient;</span>
<a href="#l10.43"></a><span id="l10.43"> };</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45"> #endif // nsgnomeshellservice_h____</span>
<a href="#l10.46"></a><span id="l10.46"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/suite/components/shell/nsIGNOMEShellService.idl</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,18 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+#include &quot;nsIShellService.idl&quot;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+[scriptable, uuid(26ea117f-f1f1-4d53-8581-1322fcafa0d4)]</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+interface nsIGNOMEShellService : nsIShellService</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+{</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  /**</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+   * Used to determine whether or not to offer &quot;Set as desktop background&quot;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+   * functionality. Even if shell service is available it is not</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+   * guaranteed that it is able to set the background for every desktop</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+   * which is especially true for Linux with its many different desktop</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+   * environments.</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+   */</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+  readonly attribute boolean canSetDesktopBackground;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/suite/components/shell/nsIMacShellService.idl</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+#include &quot;nsIShellService.idl&quot;</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+[scriptable, uuid(66f4a5cf-8807-43dd-8e65-9954f3c34cf2)]</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+interface nsIMacShellService : nsIShellService</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+{</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+  const long APPLICATION_KEYCHAIN_ACCESS  = 2;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  const long APPLICATION_NETWORK          = 3;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+  const long APPLICATION_DESKTOP          = 4;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/components/shell/nsIShellService.idl</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/components/shell/nsIShellService.idl</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> interface nsIFile;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> webidl Element;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-[scriptable, uuid(4244d99e-0fbf-4cf3-903a-893634704e84)]</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+[scriptable, uuid(5a00c44b-e3bd-4769-b021-a83c8212a794)]</span>
<a href="#l13.14"></a><span id="l13.14"> interface nsIShellService : nsISupports</span>
<a href="#l13.15"></a><span id="l13.15"> {</span>
<a href="#l13.16"></a><span id="l13.16">   /**</span>
<a href="#l13.17"></a><span id="l13.17">    * app types we can be registered to handle</span>
<a href="#l13.18"></a><span id="l13.18">    */</span>
<a href="#l13.19"></a><span id="l13.19">   const unsigned short BROWSER = 0x0001;</span>
<a href="#l13.20"></a><span id="l13.20">   const unsigned short MAIL    = 0x0002;</span>
<a href="#l13.21"></a><span id="l13.21">   const unsigned short NEWS    = 0x0004;</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -45,36 +45,16 @@ interface nsIShellService : nsISupports</span>
<a href="#l13.23"></a><span id="l13.23">    * @param aClaimAllTypes Register SeaMonkey as the handler for</span>
<a href="#l13.24"></a><span id="l13.24">    *                       additional protocols (ftp, chrome etc)</span>
<a href="#l13.25"></a><span id="l13.25">    *                       and web documents (.html, .xhtml etc).</span>
<a href="#l13.26"></a><span id="l13.26">    * @param aApps the application types being tested (Mail, News, Browser, RSS)</span>
<a href="#l13.27"></a><span id="l13.27">    */</span>
<a href="#l13.28"></a><span id="l13.28">   void setDefaultClient(in boolean aForAllUsers, in boolean aClaimAllTypes, in unsigned short aApps);</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">   /**</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-   * Used to determine whether or not to show a &quot;Set Default Client&quot;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-   * query dialog. This attribute is true if the application is starting</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-   * up and &quot;shell.checkDefaultClient&quot; is true, otherwise it</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-   * is false.</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-   */</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-  attribute boolean shouldCheckDefaultClient;</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-  /**</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-   * Returns the appTypes constants we should be the default client for.</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-   * Saves/reads the default apps to/from the pref shell.checkDefaultApps</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-   */</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-  attribute unsigned short shouldBeDefaultClientFor;</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-  /**</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-   * Attempt to determine whether it is possible to change the wallpaper.</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-   */</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-  readonly attribute boolean canSetDesktopBackground;</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-  /**</span>
<a href="#l13.51"></a><span id="l13.51">    * Sets the desktop background image using either the HTML &lt;IMG&gt;</span>
<a href="#l13.52"></a><span id="l13.52">    * element supplied or the background image of the element supplied.</span>
<a href="#l13.53"></a><span id="l13.53">    *</span>
<a href="#l13.54"></a><span id="l13.54">    * @param aImageElement Either a HTML &lt;IMG&gt; element or an element with</span>
<a href="#l13.55"></a><span id="l13.55">    *                      a background image from which to source the</span>
<a href="#l13.56"></a><span id="l13.56">    *                      background image.</span>
<a href="#l13.57"></a><span id="l13.57">    * @param aPosition     How to place the image on the desktop</span>
<a href="#l13.58"></a><span id="l13.58">    */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/components/shell/nsMacShellService.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/components/shell/nsMacShellService.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -29,22 +29,16 @@</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> using mozilla::dom::Element;</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> NS_IMPL_ISUPPORTS(nsMacShellService, nsIShellService, nsIWebProgressListener)</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> NS_IMETHODIMP</span>
<a href="#l14.10"></a><span id="l14.10"> nsMacShellService::IsDefaultClient(bool aStartupCheck, uint16_t aApps, bool *aIsDefaultClient)</span>
<a href="#l14.11"></a><span id="l14.11"> {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  // If this is the first window, maintain internal state that we've</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-  // checked this session (so that subsequent window opens don't show the</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-  // default client dialog).</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-  if (aStartupCheck)</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-    mCheckedThisSessionClient = true;</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-</span>
<a href="#l14.18"></a><span id="l14.18">   *aIsDefaultClient = false;</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   if (aApps &amp; nsIShellService::BROWSER)</span>
<a href="#l14.21"></a><span id="l14.21">     if(!isDefaultHandlerForProtocol(CFSTR(&quot;http&quot;)))</span>
<a href="#l14.22"></a><span id="l14.22">       return NS_OK;</span>
<a href="#l14.23"></a><span id="l14.23">   if (aApps &amp; nsIShellService::MAIL)</span>
<a href="#l14.24"></a><span id="l14.24">     if(!isDefaultHandlerForProtocol(CFSTR(&quot;mailto&quot;)))</span>
<a href="#l14.25"></a><span id="l14.25">       return NS_OK;</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineat">@@ -90,40 +84,16 @@ nsMacShellService::SetDefaultClient(bool</span>
<a href="#l14.27"></a><span id="l14.27">       return NS_ERROR_FAILURE;</span>
<a href="#l14.28"></a><span id="l14.28">   if (aApps &amp; nsIShellService::RSS)</span>
<a href="#l14.29"></a><span id="l14.29">     if (::LSSetDefaultHandlerForURLScheme(CFSTR(&quot;feed&quot;), suiteID) != noErr)</span>
<a href="#l14.30"></a><span id="l14.30">       return NS_ERROR_FAILURE;</span>
<a href="#l14.31"></a><span id="l14.31"> </span>
<a href="#l14.32"></a><span id="l14.32">   return NS_OK;</span>
<a href="#l14.33"></a><span id="l14.33"> }</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-nsMacShellService::GetShouldCheckDefaultClient(bool* aResult)</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-{</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-  if (mCheckedThisSessionClient)</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-  {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-    *aResult = false;</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-    return NS_OK;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-  }</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-  nsresult rv;</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  return prefs-&gt;GetBoolPref(PREF_CHECKDEFAULTCLIENT, aResult);</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-}</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-nsMacShellService::SetShouldCheckDefaultClient(bool aShouldCheck)</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-{</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-  nsresult rv;</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-  return prefs-&gt;SetBoolPref(PREF_CHECKDEFAULTCLIENT, aShouldCheck);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-}</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-</span>
<a href="#l14.59"></a><span id="l14.59"> bool</span>
<a href="#l14.60"></a><span id="l14.60"> nsMacShellService::isDefaultHandlerForProtocol(CFStringRef aScheme)</span>
<a href="#l14.61"></a><span id="l14.61"> {</span>
<a href="#l14.62"></a><span id="l14.62">   bool isDefault = false;</span>
<a href="#l14.63"></a><span id="l14.63"> </span>
<a href="#l14.64"></a><span id="l14.64">   CFStringRef suiteID = ::CFBundleGetIdentifier(::CFBundleGetMainBundle());</span>
<a href="#l14.65"></a><span id="l14.65">   if (!suiteID)</span>
<a href="#l14.66"></a><span id="l14.66">   {</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineat">@@ -144,44 +114,16 @@ nsMacShellService::isDefaultHandlerForPr</span>
<a href="#l14.68"></a><span id="l14.68">                                   kCFCompareCaseInsensitive) == kCFCompareEqualTo;</span>
<a href="#l14.69"></a><span id="l14.69">     ::CFRelease(defaultHandlerID);</span>
<a href="#l14.70"></a><span id="l14.70">    }</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72">   return isDefault;</span>
<a href="#l14.73"></a><span id="l14.73"> }</span>
<a href="#l14.74"></a><span id="l14.74"> </span>
<a href="#l14.75"></a><span id="l14.75"> NS_IMETHODIMP</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-nsMacShellService::GetShouldBeDefaultClientFor(uint16_t* aApps)</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-{</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-  nsresult rv;</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-  int32_t result;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-  rv = prefs-&gt;GetIntPref(&quot;shell.checkDefaultApps&quot;, &amp;result);</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineminus">-  *aApps = result;</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-  return rv;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-}</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineminus">-</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-nsMacShellService::SetShouldBeDefaultClientFor(uint16_t aApps)</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-{</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-  nsresult rv;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineminus">-  return prefs-&gt;SetIntPref(&quot;shell.checkDefaultApps&quot;, aApps);</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-}</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-nsMacShellService::GetCanSetDesktopBackground(bool* aResult)</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineminus">-{</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineminus">-  *aResult = true;</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-  return NS_OK;</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-}</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l14.104"></a><span id="l14.104"> nsMacShellService::SetDesktopBackground(Element* aElement,</span>
<a href="#l14.105"></a><span id="l14.105">                                         int32_t aPosition)</span>
<a href="#l14.106"></a><span id="l14.106"> {</span>
<a href="#l14.107"></a><span id="l14.107">   // Note: We don't support aPosition on OS X.</span>
<a href="#l14.108"></a><span id="l14.108"> </span>
<a href="#l14.109"></a><span id="l14.109">   // Get the image URI:</span>
<a href="#l14.110"></a><span id="l14.110">   nsresult rv;</span>
<a href="#l14.111"></a><span id="l14.111">   nsCOMPtr&lt;nsIImageLoadingContent&gt; imageContent = do_QueryInterface(aElement, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/components/shell/nsMacShellService.h</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/components/shell/nsMacShellService.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,37 +1,36 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l15.5"></a><span id="l15.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.6"></a><span id="l15.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.7"></a><span id="l15.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> #ifndef nsmacshellservice_h____</span>
<a href="#l15.10"></a><span id="l15.10"> #define nsmacshellservice_h____</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-#include &quot;nsShellService.h&quot;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+#include &quot;nsIMacShellService.h&quot;</span>
<a href="#l15.14"></a><span id="l15.14"> #include &quot;nsIWebProgressListener.h&quot;</span>
<a href="#l15.15"></a><span id="l15.15"> #include &quot;nsIFile.h&quot;</span>
<a href="#l15.16"></a><span id="l15.16"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l15.17"></a><span id="l15.17"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l15.18"></a><span id="l15.18"> #include &quot;nsSuiteCID.h&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20"> #include &lt;CoreFoundation/CoreFoundation.h&gt;</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22"> class nsMacShellService final : public nsIShellService,</span>
<a href="#l15.23"></a><span id="l15.23">                                 public nsIWebProgressListener</span>
<a href="#l15.24"></a><span id="l15.24"> {</span>
<a href="#l15.25"></a><span id="l15.25"> public:</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-  nsMacShellService() : mCheckedThisSessionClient(false) {};</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+  nsMacShellService() {};</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">   NS_DECL_ISUPPORTS</span>
<a href="#l15.30"></a><span id="l15.30">   NS_DECL_NSISHELLSERVICE</span>
<a href="#l15.31"></a><span id="l15.31">   NS_DECL_NSIWEBPROGRESSLISTENER</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33"> protected:</span>
<a href="#l15.34"></a><span id="l15.34">   ~nsMacShellService() {}</span>
<a href="#l15.35"></a><span id="l15.35">   bool isDefaultHandlerForProtocol(CFStringRef aScheme);</span>
<a href="#l15.36"></a><span id="l15.36"> </span>
<a href="#l15.37"></a><span id="l15.37"> private:</span>
<a href="#l15.38"></a><span id="l15.38">   nsCOMPtr&lt;nsIFile&gt; mBackgroundFile;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-  bool mCheckedThisSessionClient;</span>
<a href="#l15.40"></a><span id="l15.40"> };</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/components/shell/nsSetDefault.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/components/shell/nsSetDefault.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -5,44 +5,43 @@</span>
<a href="#l16.4"></a><span id="l16.4"> /*</span>
<a href="#l16.5"></a><span id="l16.5">  * This component handles the startup command line arguments of the form:</span>
<a href="#l16.6"></a><span id="l16.6">  *   -setDefaultBrowser</span>
<a href="#l16.7"></a><span id="l16.7">  *   -setDefaultMail</span>
<a href="#l16.8"></a><span id="l16.8">  *   -setDefaultNews</span>
<a href="#l16.9"></a><span id="l16.9">  *   -setDefaultFeed</span>
<a href="#l16.10"></a><span id="l16.10">  */</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-const nsIShellService = Ci.nsIShellService;</span>
<a href="#l16.13"></a><span id="l16.13"> const nsICommandLineHandler = Ci.nsICommandLineHandler;</span>
<a href="#l16.14"></a><span id="l16.14"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16"> function nsSetDefault() {</span>
<a href="#l16.17"></a><span id="l16.17"> }</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> nsSetDefault.prototype = {</span>
<a href="#l16.20"></a><span id="l16.20">   handle: function nsSetDefault_handle(aCmdline) {</span>
<a href="#l16.21"></a><span id="l16.21">     if (aCmdline.handleFlag(&quot;setDefaultBrowser&quot;, false)) {</span>
<a href="#l16.22"></a><span id="l16.22">       var shell = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-                    .getService(nsIShellService);</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-      shell.setDefaultClient(true, true, nsIShellService.BROWSER);</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+                    .getService(Ci.nsIShellService);</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+      shell.setDefaultClient(true, true, Ci.nsIShellService.BROWSER);</span>
<a href="#l16.27"></a><span id="l16.27">     }</span>
<a href="#l16.28"></a><span id="l16.28">     else if (aCmdline.handleFlag(&quot;setDefaultMail&quot;, false)) {</span>
<a href="#l16.29"></a><span id="l16.29">       var shell = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-                    .getService(nsIShellService);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-      shell.setDefaultClient(true, true, nsIShellService.MAIL);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+                    .getService(Ci.nsIShellService);</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+      shell.setDefaultClient(true, true, Ci.nsIShellService.MAIL);</span>
<a href="#l16.34"></a><span id="l16.34">     }</span>
<a href="#l16.35"></a><span id="l16.35">     else if (aCmdline.handleFlag(&quot;setDefaultNews&quot;, false)) {</span>
<a href="#l16.36"></a><span id="l16.36">       var shell = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-                    .getService(nsIShellService);</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-      shell.setDefaultClient(true, true, nsIShellService.NEWS);</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+                    .getService(Ci.nsIShellService);</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+      shell.setDefaultClient(true, true, Ci.nsIShellService.NEWS);</span>
<a href="#l16.41"></a><span id="l16.41">     }</span>
<a href="#l16.42"></a><span id="l16.42">     else if (aCmdline.handleFlag(&quot;setDefaultFeed&quot;, false)) {</span>
<a href="#l16.43"></a><span id="l16.43">       var shell = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-                    .getService(nsIShellService);</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-      shell.setDefaultClient(true, true, nsIShellService.RSS);</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+                    .getService(Ci.nsIShellService);</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+      shell.setDefaultClient(true, true, Ci.nsIShellService.RSS);</span>
<a href="#l16.48"></a><span id="l16.48">     }</span>
<a href="#l16.49"></a><span id="l16.49">   },</span>
<a href="#l16.50"></a><span id="l16.50"> </span>
<a href="#l16.51"></a><span id="l16.51">   helpInfo: &quot;  -setDefaultBrowser Set this app as the default browser client.\n&quot; +</span>
<a href="#l16.52"></a><span id="l16.52">             &quot;  -setDefaultMail    Set this app as the default mail client.\n&quot; +</span>
<a href="#l16.53"></a><span id="l16.53">             &quot;  -setDefaultNews    Set this app as the default newsreader.\n&quot; +</span>
<a href="#l16.54"></a><span id="l16.54">             &quot;  -setDefaultFeed    Set this app as the default feedreader.\n&quot;,</span>
<a href="#l16.55"></a><span id="l16.55"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/components/shell/nsWindowsShellService.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/components/shell/nsWindowsShellService.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -441,22 +441,16 @@ nsWindowsShellService::IsDefaultClientVi</span>
<a href="#l17.4"></a><span id="l17.4">     return true;</span>
<a href="#l17.5"></a><span id="l17.5">   }</span>
<a href="#l17.6"></a><span id="l17.6">   return false;</span>
<a href="#l17.7"></a><span id="l17.7"> }</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> NS_IMETHODIMP</span>
<a href="#l17.10"></a><span id="l17.10"> nsWindowsShellService::IsDefaultClient(bool aStartupCheck, uint16_t aApps, bool *aIsDefaultClient)</span>
<a href="#l17.11"></a><span id="l17.11"> {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  // If this is the first application window, maintain internal state that we've</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  // checked this session (so that subsequent window opens don't show the</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-  // default client dialog).</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-  if (aStartupCheck)</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-    mCheckedThisSessionClient = true;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-</span>
<a href="#l17.18"></a><span id="l17.18">   *aIsDefaultClient = true;</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">   // for each type, check if it is the default app</span>
<a href="#l17.21"></a><span id="l17.21">   // browser check needs to be at the top</span>
<a href="#l17.22"></a><span id="l17.22">   if (aApps &amp; nsIShellService::BROWSER) {</span>
<a href="#l17.23"></a><span id="l17.23">     *aIsDefaultClient &amp;= TestForDefault(gBrowserSettings, sizeof(gBrowserSettings)/sizeof(SETTING));</span>
<a href="#l17.24"></a><span id="l17.24">     // Only check if this app is default on Vista if the previous checks</span>
<a href="#l17.25"></a><span id="l17.25">     // indicate that this app is the default.</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineat">@@ -502,68 +496,16 @@ nsWindowsShellService::SetDefaultClient(</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28">     if (aApps &amp; nsIShellService::NEWS)</span>
<a href="#l17.29"></a><span id="l17.29">       appHelperPath.AppendLiteral(&quot; News&quot;);</span>
<a href="#l17.30"></a><span id="l17.30">    }</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32">   return LaunchHelper(appHelperPath);</span>
<a href="#l17.33"></a><span id="l17.33"> }</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-nsWindowsShellService::GetShouldCheckDefaultClient(bool* aResult)</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-{</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-  if (mCheckedThisSessionClient) {</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    *aResult = false;</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-    return NS_OK;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-  }</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-  nsresult rv;</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-  return prefs-&gt;GetBoolPref(PREF_CHECKDEFAULTCLIENT, aResult);</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineminus">-}</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineminus">-</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-nsWindowsShellService::SetShouldCheckDefaultClient(bool aShouldCheck)</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-{</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-  NS_ENSURE_TRUE(prefs, NS_ERROR_FAILURE);</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-  return prefs-&gt;SetBoolPref(PREF_CHECKDEFAULTCLIENT, aShouldCheck);</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-}</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-nsWindowsShellService::GetShouldBeDefaultClientFor(uint16_t* aApps)</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-{</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-  nsresult rv;</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-  int32_t result;</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-  rv = prefs-&gt;GetIntPref(&quot;shell.checkDefaultApps&quot;, &amp;result);</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineminus">-  *aApps = result;</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineminus">-  return rv;</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-}</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-nsWindowsShellService::SetShouldBeDefaultClientFor(uint16_t aApps)</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-{</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-  nsresult rv;</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-  return prefs-&gt;SetIntPref(&quot;shell.checkDefaultApps&quot;, aApps);</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-}</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-nsWindowsShellService::GetCanSetDesktopBackground(bool* aResult)</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-{</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-  *aResult = true;</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-  return NS_OK;</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-}</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-</span>
<a href="#l17.87"></a><span id="l17.87"> static nsresult</span>
<a href="#l17.88"></a><span id="l17.88"> WriteBitmap(nsIFile* aFile, imgIContainer* aImage)</span>
<a href="#l17.89"></a><span id="l17.89"> {</span>
<a href="#l17.90"></a><span id="l17.90">   nsresult rv;</span>
<a href="#l17.91"></a><span id="l17.91"> </span>
<a href="#l17.92"></a><span id="l17.92">   RefPtr&lt;SourceSurface&gt; surface =</span>
<a href="#l17.93"></a><span id="l17.93">     aImage-&gt;GetFrame(imgIContainer::FRAME_CURRENT,</span>
<a href="#l17.94"></a><span id="l17.94">                      imgIContainer::FLAG_SYNC_DECODE);</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineat">@@ -681,19 +623,19 @@ nsWindowsShellService::SetDesktopBackgro</span>
<a href="#l17.96"></a><span id="l17.96">   NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l17.97"></a><span id="l17.97"> </span>
<a href="#l17.98"></a><span id="l17.98">   nsCOMPtr&lt;nsIStringBundle&gt; shellBundle;</span>
<a href="#l17.99"></a><span id="l17.99">   rv = bundleService-&gt;CreateBundle(SHELLSERVICE_PROPERTIES,</span>
<a href="#l17.100"></a><span id="l17.100">                                    getter_AddRefs(shellBundle));</span>
<a href="#l17.101"></a><span id="l17.101">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.102"></a><span id="l17.102"> </span>
<a href="#l17.103"></a><span id="l17.103">   // e.g. &quot;Desktop Background.bmp&quot;</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  nsString fileLeafName;</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-  rv = shellBundle-&gt;GetStringFromName</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineminus">-                      (&quot;desktopBackgroundLeafNameWin&quot;, fileLeafName);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+  nsAutoString fileLeafName;</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+  rv = shellBundle-&gt;GetStringFromName(&quot;desktopBackgroundLeafNameWin&quot;,</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineplus">+                                      fileLeafName);</span>
<a href="#l17.110"></a><span id="l17.110">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.111"></a><span id="l17.111"> </span>
<a href="#l17.112"></a><span id="l17.112">   // get the profile root directory</span>
<a href="#l17.113"></a><span id="l17.113">   nsCOMPtr&lt;nsIFile&gt; file;</span>
<a href="#l17.114"></a><span id="l17.114">   rv = NS_GetSpecialDirectory(NS_APP_APPLICATION_REGISTRY_DIR,</span>
<a href="#l17.115"></a><span id="l17.115">                               getter_AddRefs(file));</span>
<a href="#l17.116"></a><span id="l17.116">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.117"></a><span id="l17.117"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/components/shell/nsWindowsShellService.h</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/components/shell/nsWindowsShellService.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -18,25 +18,24 @@ typedef struct {</span>
<a href="#l18.4"></a><span id="l18.4">   const char* valueData;</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">   int32_t flags;</span>
<a href="#l18.7"></a><span id="l18.7"> } SETTING;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9"> class nsWindowsShellService final : public nsIShellService</span>
<a href="#l18.10"></a><span id="l18.10"> {</span>
<a href="#l18.11"></a><span id="l18.11"> public:</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  nsWindowsShellService() : mCheckedThisSessionClient(false) {};</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  nsWindowsShellService() {};</span>
<a href="#l18.14"></a><span id="l18.14">   nsresult Init();</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">   NS_DECL_ISUPPORTS</span>
<a href="#l18.17"></a><span id="l18.17">   NS_DECL_NSISHELLSERVICE</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19"> protected:</span>
<a href="#l18.20"></a><span id="l18.20">   ~nsWindowsShellService() {}</span>
<a href="#l18.21"></a><span id="l18.21">   bool IsDefaultClientVista(uint16_t aApps, bool* aIsDefaultClient);</span>
<a href="#l18.22"></a><span id="l18.22">   bool TestForDefault(SETTING aSettings[], int32_t aSize);</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24"> private:</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-  bool mCheckedThisSessionClient;</span>
<a href="#l18.26"></a><span id="l18.26">   nsString mAppLongPath;</span>
<a href="#l18.27"></a><span id="l18.27">   nsString mAppShortPath;</span>
<a href="#l18.28"></a><span id="l18.28"> };</span>
<a href="#l18.29"></a><span id="l18.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/mailnews/prefs/pref-mailnews.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/mailnews/prefs/pref-mailnews.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,15 +1,14 @@</span>
<a href="#l19.4"></a><span id="l19.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l19.5"></a><span id="l19.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.7"></a><span id="l19.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9" class="difflineminus">-if (&quot;@mozilla.org/suite/shell-service;1&quot; in Cc)</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">-  var nsIShellService = Ci.nsIShellService;</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+ChromeUtils.import(&quot;resource:///modules/ShellService.jsm&quot;);</span>
<a href="#l19.12"></a><span id="l19.12"> </span>
<a href="#l19.13"></a><span id="l19.13"> function Startup()</span>
<a href="#l19.14"></a><span id="l19.14"> {</span>
<a href="#l19.15"></a><span id="l19.15">   startPageCheck();</span>
<a href="#l19.16"></a><span id="l19.16">   defaultClientSetup();</span>
<a href="#l19.17"></a><span id="l19.17"> }</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19"> function startPageCheck()</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineat">@@ -25,40 +24,34 @@ function setHomePageToDefaultPage()</span>
<a href="#l19.21"></a><span id="l19.21"> {</span>
<a href="#l19.22"></a><span id="l19.22">   var startPagePref = document.getElementById(&quot;mailnews.start_page.url&quot;);</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24">   startPagePref.value = startPagePref.defaultValue;</span>
<a href="#l19.25"></a><span id="l19.25"> }</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27"> function defaultClientSetup()</span>
<a href="#l19.28"></a><span id="l19.28"> {</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">-  if (&quot;@mozilla.org/suite/shell-service;1&quot; in Cc) try {</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-    var shellService = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-                         .getService(nsIShellService);</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+  if (ShellService) try {</span>
<a href="#l19.34"></a><span id="l19.34">     [&quot;Mail&quot;, &quot;News&quot;, &quot;Rss&quot;].forEach(function(aType) {</span>
<a href="#l19.35"></a><span id="l19.35">       var button = document.getElementById(&quot;setDefault&quot; + aType);</span>
<a href="#l19.36"></a><span id="l19.36">       try {</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-        button.disabled = shellService.isDefaultClient(false, nsIShellService[aType.toUpperCase()]);</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+        button.disabled = ShellService.isDefaultClient(false, Ci.nsIShellService[aType.toUpperCase()]);</span>
<a href="#l19.39"></a><span id="l19.39">         document.getElementById(&quot;defaultMailPrefs&quot;).hidden = false;</span>
<a href="#l19.40"></a><span id="l19.40">       } catch (e) {</span>
<a href="#l19.41"></a><span id="l19.41">         button.hidden = true;</span>
<a href="#l19.42"></a><span id="l19.42">       }</span>
<a href="#l19.43"></a><span id="l19.43">     });</span>
<a href="#l19.44"></a><span id="l19.44">   } catch (e) {</span>
<a href="#l19.45"></a><span id="l19.45">   }</span>
<a href="#l19.46"></a><span id="l19.46"> }</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48"> function onSetDefault(aButton, aType)</span>
<a href="#l19.49"></a><span id="l19.49"> {</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-  var shellService = Cc[&quot;@mozilla.org/suite/shell-service;1&quot;]</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-                       .getService(nsIShellService);</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-  shellService.setDefaultClient(false, false, nsIShellService[aType]);</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-  shellService.shouldBeDefaultClientFor |= nsIShellService[aType];</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+  ShellService.setDefaultClient(false, false, Ci.nsIShellService[aType]);</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+  ShellService.shouldBeDefaultClientFor |= Ci.nsIShellService[aType];</span>
<a href="#l19.57"></a><span id="l19.57"> </span>
<a href="#l19.58"></a><span id="l19.58">   aButton.disabled = true;</span>
<a href="#l19.59"></a><span id="l19.59"> }</span>
<a href="#l19.60"></a><span id="l19.60"> </span>
<a href="#l19.61"></a><span id="l19.61"> function onNewsChange(aChecked)</span>
<a href="#l19.62"></a><span id="l19.62"> {</span>
<a href="#l19.63"></a><span id="l19.63">   let snews = document.getElementById(&quot;network.protocol-handler.external.snews&quot;);</span>
<a href="#l19.64"></a><span id="l19.64">   let nntp = document.getElementById(&quot;network.protocol-handler.external.nntp&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

