<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 16134:98e5bde73ece1019cb3dc46971ada2b4db258070</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 98e5bde73ece1019cb3dc46971ada2b4db258070" />
<meta property="og:url" content="/comm-central/rev/98e5bde73ece1019cb3dc46971ada2b4db258070" />
<meta property="og:description" content="Bug 905910: Run comm-central xpcshell tests in parallel, r=Standard8, a=jcranmer" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 98e5bde73ece1019cb3dc46971ada2b4db258070 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/98e5bde73ece1019cb3dc46971ada2b4db258070">shortlog</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/98e5bde73ece1019cb3dc46971ada2b4db258070">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070">files</a> |
changeset |
<a href="/comm-central/raw-rev/98e5bde73ece1019cb3dc46971ada2b4db258070">raw</a>  | <a href="/comm-central/archive/98e5bde73ece1019cb3dc46971ada2b4db258070.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=905910">Bug 905910</a>: Run comm-central xpcshell tests in parallel, r=Standard8, a=jcranmer
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#115;&#104;&#117;&#97;&#32;&#67;&#114;&#97;&#110;&#109;&#101;&#114;&#32;&#60;&#80;&#105;&#100;&#103;&#101;&#111;&#116;&#49;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 28 Apr 2014 10:30:57 -0500</td></tr>

<tr>
 <td>changeset 16134</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/98e5bde73ece1019cb3dc46971ada2b4db258070">98e5bde73ece1019cb3dc46971ada2b4db258070</a></td>
</tr>



<tr>
<td>parent 16133</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f006681a23c0a18feb89b332e8bd75141b72f39b">f006681a23c0a18feb89b332e8bd75141b72f39b</a>
</td>
</tr>

<tr>
<td>child 16135</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a184d0a8e93c696a0d8097daf8059366eabe7b09">a184d0a8e93c696a0d8097daf8059366eabe7b09</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=98e5bde73ece1019cb3dc46971ada2b4db258070">10088</a></td></tr>
<tr><td>push user</td><td>Pidgeot18@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 28 Apr 2014 15:33:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@98e5bde73ece [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=98e5bde73ece1019cb3dc46971ada2b4db258070">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=98e5bde73ece1019cb3dc46971ada2b4db258070&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=98e5bde73ece1019cb3dc46971ada2b4db258070&newProject=comm-central&newRevision=98e5bde73ece1019cb3dc46971ada2b4db258070&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=98e5bde73ece1019cb3dc46971ada2b4db258070&newProject=comm-central&newRevision=98e5bde73ece1019cb3dc46971ada2b4db258070&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=98e5bde73ece1019cb3dc46971ada2b4db258070&newProject=comm-central&newRevision=98e5bde73ece1019cb3dc46971ada2b4db258070&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a>, <a href="/comm-central/log?rev=reviewer%28jcranmer%29&revcount=50">jcranmer</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=905910">905910</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=905910">Bug 905910</a>: Run comm-central xpcshell tests in parallel, r=Standard8, a=jcranmer</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/components/src/test/xpcshell.ini">chat/components/src/test/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/components/src/test/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/components/src/test/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/components/src/test/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/components/src/test/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/components/src/test/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/modules/test/xpcshell.ini">chat/modules/test/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/modules/test/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/modules/test/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/modules/test/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/modules/test/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/modules/test/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/irc/test/xpcshell.ini">chat/protocols/irc/test/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/irc/test/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/irc/test/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/irc/test/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/irc/test/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/irc/test/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/yahoo/test/xpcshell.ini">chat/protocols/yahoo/test/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/yahoo/test/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/yahoo/test/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/yahoo/test/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/yahoo/test/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/chat/protocols/yahoo/test/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/ldap/xpcom/tests/unit/xpcshell.ini">ldap/xpcom/tests/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/ldap/xpcom/tests/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/ldap/xpcom/tests/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/ldap/xpcom/tests/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/ldap/xpcom/tests/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/ldap/xpcom/tests/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mail/base/test/unit/xpcshell.ini">mail/base/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mail/base/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mail/base/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mail/base/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mail/base/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mail/base/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/test_searchChaining.js">mailnews/base/test/unit/test_searchChaining.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/test_searchChaining.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/test_searchChaining.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/test_searchChaining.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/test_searchChaining.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/test_searchChaining.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/xpcshell.ini">mailnews/base/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/base/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/head_compose.js">mailnews/compose/test/unit/head_compose.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/head_compose.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/head_compose.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/head_compose.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/head_compose.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/head_compose.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug155172.js">mailnews/compose/test/unit/test_bug155172.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug155172.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug155172.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug155172.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug155172.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug155172.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug474774.js">mailnews/compose/test/unit/test_bug474774.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug474774.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug474774.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug474774.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug474774.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_bug474774.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendBackground.js">mailnews/compose/test/unit/test_sendBackground.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendBackground.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendBackground.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendBackground.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendBackground.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendBackground.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailAddressIDN.js">mailnews/compose/test/unit/test_sendMailAddressIDN.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailAddressIDN.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailAddressIDN.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailAddressIDN.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailAddressIDN.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailAddressIDN.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailMessage.js">mailnews/compose/test/unit/test_sendMailMessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailMessage.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailMessage.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailMessage.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailMessage.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMailMessage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageFile.js">mailnews/compose/test/unit/test_sendMessageFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageFile.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageFile.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageFile.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageFile.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageFile.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater.js">mailnews/compose/test/unit/test_sendMessageLater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater2.js">mailnews/compose/test/unit/test_sendMessageLater2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater2.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater2.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater2.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater2.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_sendMessageLater2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpAuthMethods.js">mailnews/compose/test/unit/test_smtpAuthMethods.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpAuthMethods.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpAuthMethods.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpAuthMethods.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpAuthMethods.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpAuthMethods.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPassword.js">mailnews/compose/test/unit/test_smtpPassword.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPassword.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPassword.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPassword.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPassword.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPassword.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">mailnews/compose/test/unit/test_smtpPasswordFailure1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">mailnews/compose/test/unit/test_smtpPasswordFailure2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">mailnews/compose/test/unit/test_smtpPasswordFailure3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/test_smtpPasswordFailure3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/xpcshell.ini">mailnews/compose/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/compose/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/db/gloda/test/unit/xpcshell.ini">mailnews/db/gloda/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/db/gloda/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/db/gloda/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/db/gloda/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/db/gloda/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/db/gloda/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/head_server.js">mailnews/imap/test/unit/head_server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/head_server.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/head_server.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/head_server.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/head_server.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/head_server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_chunkLastLF.js">mailnews/imap/test/unit/test_chunkLastLF.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_chunkLastLF.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_chunkLastLF.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_chunkLastLF.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_chunkLastLF.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_chunkLastLF.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dod.js">mailnews/imap/test/unit/test_dod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dod.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dod.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dod.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dod.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dod.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dontStatNoSelect.js">mailnews/imap/test/unit/test_dontStatNoSelect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dontStatNoSelect.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dontStatNoSelect.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dontStatNoSelect.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dontStatNoSelect.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_dontStatNoSelect.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapAuthMethods.js">mailnews/imap/test/unit/test_imapAuthMethods.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapAuthMethods.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapAuthMethods.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapAuthMethods.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapAuthMethods.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapAuthMethods.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapChunks.js">mailnews/imap/test/unit/test_imapChunks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapChunks.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapChunks.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapChunks.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapChunks.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapChunks.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapFilterActions.js">mailnews/imap/test/unit/test_imapFilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapFilterActions.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapFilterActions.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapFilterActions.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapFilterActions.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapFilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapHighWater.js">mailnews/imap/test/unit/test_imapHighWater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapHighWater.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapHighWater.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapHighWater.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapHighWater.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapHighWater.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapPasswordFailure.js">mailnews/imap/test/unit/test_imapPasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapPasswordFailure.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapPasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapPasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapPasswordFailure.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapPasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapUrls.js">mailnews/imap/test/unit/test_imapUrls.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapUrls.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapUrls.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapUrls.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapUrls.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_imapUrls.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlineDraftDataloss.js">mailnews/imap/test/unit/test_offlineDraftDataloss.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlineDraftDataloss.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlineDraftDataloss.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlineDraftDataloss.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlineDraftDataloss.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlineDraftDataloss.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlinePlayback.js">mailnews/imap/test/unit/test_offlinePlayback.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlinePlayback.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlinePlayback.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlinePlayback.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlinePlayback.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_offlinePlayback.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_starttlsFailure.js">mailnews/imap/test/unit/test_starttlsFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_starttlsFailure.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_starttlsFailure.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_starttlsFailure.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_starttlsFailure.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/test_starttlsFailure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/xpcshell.ini">mailnews/imap/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/imap/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/head_maillocal.js">mailnews/local/test/unit/head_maillocal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/head_maillocal.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/head_maillocal.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/head_maillocal.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/head_maillocal.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/head_maillocal.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_bug457168.js">mailnews/local/test/unit/test_bug457168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_bug457168.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_bug457168.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_bug457168.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_bug457168.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_bug457168.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3AuthMethods.js">mailnews/local/test/unit/test_pop3AuthMethods.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3AuthMethods.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3AuthMethods.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3AuthMethods.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3AuthMethods.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3AuthMethods.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GSSAPIFail.js">mailnews/local/test/unit/test_pop3GSSAPIFail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GSSAPIFail.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GSSAPIFail.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GSSAPIFail.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GSSAPIFail.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GSSAPIFail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GetNewMail.js">mailnews/local/test/unit/test_pop3GetNewMail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GetNewMail.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GetNewMail.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GetNewMail.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GetNewMail.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3GetNewMail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password.js">mailnews/local/test/unit/test_pop3Password.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password2.js">mailnews/local/test/unit/test_pop3Password2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password2.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password2.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password2.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password2.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3Password2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure.js">mailnews/local/test/unit/test_pop3PasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure2.js">mailnews/local/test/unit/test_pop3PasswordFailure2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure2.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure2.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure2.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure2.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure3.js">mailnews/local/test/unit/test_pop3PasswordFailure3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure3.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure3.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure3.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure3.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3PasswordFailure3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_verifyLogon.js">mailnews/local/test/unit/test_verifyLogon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_verifyLogon.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_verifyLogon.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_verifyLogon.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_verifyLogon.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/test_verifyLogon.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/xpcshell.ini">mailnews/local/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/local/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_biff.js">mailnews/news/test/unit/test_biff.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_biff.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_biff.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_biff.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_biff.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_biff.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug37465.js">mailnews/news/test/unit/test_bug37465.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug37465.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug37465.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug37465.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug37465.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug37465.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug403242.js">mailnews/news/test/unit/test_bug403242.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug403242.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug403242.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug403242.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug403242.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug403242.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug540288.js">mailnews/news/test/unit/test_bug540288.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug540288.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug540288.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug540288.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug540288.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug540288.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug695309.js">mailnews/news/test/unit/test_bug695309.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug695309.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug695309.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug695309.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug695309.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_bug695309.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_filter.js">mailnews/news/test/unit/test_filter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_filter.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_filter.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_filter.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_filter.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_filter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_getNewsMessage.js">mailnews/news/test/unit/test_getNewsMessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_getNewsMessage.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_getNewsMessage.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_getNewsMessage.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_getNewsMessage.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_getNewsMessage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_internalUris.js">mailnews/news/test/unit/test_internalUris.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_internalUris.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_internalUris.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_internalUris.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_internalUris.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_internalUris.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_newsAutocomplete.js">mailnews/news/test/unit/test_newsAutocomplete.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_newsAutocomplete.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_newsAutocomplete.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_newsAutocomplete.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_newsAutocomplete.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_newsAutocomplete.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpContentLength.js">mailnews/news/test/unit/test_nntpContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpContentLength.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpContentLength.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpContentLength.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpContentLength.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpGroupPassword.js">mailnews/news/test/unit/test_nntpGroupPassword.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpGroupPassword.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpGroupPassword.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpGroupPassword.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpGroupPassword.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpGroupPassword.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword.js">mailnews/news/test/unit/test_nntpPassword.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword2.js">mailnews/news/test/unit/test_nntpPassword2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword2.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword2.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword2.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword2.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPassword2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPasswordFailure.js">mailnews/news/test/unit/test_nntpPasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPasswordFailure.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPasswordFailure.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPost.js">mailnews/news/test/unit/test_nntpPost.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPost.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPost.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPost.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPost.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpPost.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpUrl.js">mailnews/news/test/unit/test_nntpUrl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpUrl.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpUrl.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpUrl.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpUrl.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_nntpUrl.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_server.js">mailnews/news/test/unit/test_server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_server.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_server.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_server.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_server.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/test_server.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/xpcshell.ini">mailnews/news/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/news/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/fakeserver/maild.js">mailnews/test/fakeserver/maild.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/fakeserver/maild.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/fakeserver/maild.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/fakeserver/maild.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/fakeserver/maild.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/fakeserver/maild.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/IMAPpump.js">mailnews/test/resources/IMAPpump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/IMAPpump.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/IMAPpump.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/IMAPpump.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/IMAPpump.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/IMAPpump.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/POP3pump.js">mailnews/test/resources/POP3pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/POP3pump.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/POP3pump.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/POP3pump.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/POP3pump.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/POP3pump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/messageInjection.js">mailnews/test/resources/messageInjection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/messageInjection.js">file</a> |
<a href="/comm-central/annotate/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/messageInjection.js">annotate</a> |
<a href="/comm-central/diff/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/messageInjection.js">diff</a> |
<a href="/comm-central/comparison/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/messageInjection.js">comparison</a> |
<a href="/comm-central/log/98e5bde73ece1019cb3dc46971ada2b4db258070/mailnews/test/resources/messageInjection.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/components/src/test/xpcshell.ini</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/components/src/test/xpcshell.ini</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,11 +1,10 @@</span>
<a href="#l1.4"></a><span id="l1.4"> ; This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5"> ; License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6"> ; file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> [DEFAULT]</span>
<a href="#l1.9"></a><span id="l1.9"> head = </span>
<a href="#l1.10"></a><span id="l1.10"> tail = </span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l1.12"></a><span id="l1.12"> </span>
<a href="#l1.13"></a><span id="l1.13"> [test_accounts.js]</span>
<a href="#l1.14"></a><span id="l1.14"> [test_commands.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/modules/test/xpcshell.ini</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/modules/test/xpcshell.ini</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,7 +1,6 @@</span>
<a href="#l2.4"></a><span id="l2.4"> [DEFAULT]</span>
<a href="#l2.5"></a><span id="l2.5"> head =</span>
<a href="#l2.6"></a><span id="l2.6"> tail =</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> [test_ArrayBufferUtils.js]</span>
<a href="#l2.10"></a><span id="l2.10"> [test_filtering.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/chat/protocols/irc/test/xpcshell.ini</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/chat/protocols/irc/test/xpcshell.ini</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l3.4"></a><span id="l3.4"> [DEFAULT]</span>
<a href="#l3.5"></a><span id="l3.5"> head =</span>
<a href="#l3.6"></a><span id="l3.6"> tail =</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> [test_ctcpFormatting.js]</span>
<a href="#l3.10"></a><span id="l3.10"> [test_ctcpColoring.js]</span>
<a href="#l3.11"></a><span id="l3.11"> [test_ctcpDequote.js]</span>
<a href="#l3.12"></a><span id="l3.12"> [test_ctcpQuote.js]</span>
<a href="#l3.13"></a><span id="l3.13"> [test_ircMessage.js]</span>
<a href="#l3.14"></a><span id="l3.14"> [test_splitLongMessages.js]</span>
<a href="#l3.15"></a><span id="l3.15"> [test_tryNewNick.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/protocols/yahoo/test/xpcshell.ini</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/protocols/yahoo/test/xpcshell.ini</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,8 +1,7 @@</span>
<a href="#l4.4"></a><span id="l4.4"> [DEFAULT]</span>
<a href="#l4.5"></a><span id="l4.5"> head =</span>
<a href="#l4.6"></a><span id="l4.6"> tail =</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> [test_yahooAccount.js]</span>
<a href="#l4.10"></a><span id="l4.10"> [test_yahooLoginHelper.js]</span>
<a href="#l4.11"></a><span id="l4.11"> [test_yahoopacket.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/ldap/xpcom/tests/unit/xpcshell.ini</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/ldap/xpcom/tests/unit/xpcshell.ini</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,6 +1,5 @@</span>
<a href="#l5.4"></a><span id="l5.4"> [DEFAULT]</span>
<a href="#l5.5"></a><span id="l5.5"> head =</span>
<a href="#l5.6"></a><span id="l5.6"> tail =</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> [test_nsLDAPURL.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/test/unit/xpcshell.ini</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/test/unit/xpcshell.ini</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,17 +1,19 @@</span>
<a href="#l6.4"></a><span id="l6.4"> [DEFAULT]</span>
<a href="#l6.5"></a><span id="l6.5"> head = head_mailbase.js</span>
<a href="#l6.6"></a><span id="l6.6"> tail = tail_base.js</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l6.8"></a><span id="l6.8"> support-files = distribution.ini resources/*</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> [test_alertHook.js]</span>
<a href="#l6.11"></a><span id="l6.11"> [test_attachmentChecker.js]</span>
<a href="#l6.12"></a><span id="l6.12"> [test_emptyTrash_dbViewWrapper.js]</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+run-sequentially = Avoid bustage.</span>
<a href="#l6.14"></a><span id="l6.14"> [test_viewWrapper_imapFolder.js]</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+run-sequentially = Avoid bustage.</span>
<a href="#l6.16"></a><span id="l6.16"> [test_viewWrapper_logic.js]</span>
<a href="#l6.17"></a><span id="l6.17"> [test_viewWrapper_realFolder.js]</span>
<a href="#l6.18"></a><span id="l6.18"> [test_viewWrapper_virtualFolder.js]</span>
<a href="#l6.19"></a><span id="l6.19"> [test_viewWrapper_virtualFolderCustomTerm.js]</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+run-sequentially = Avoid bustage.</span>
<a href="#l6.21"></a><span id="l6.21"> [test_windows_font_migration.js]</span>
<a href="#l6.22"></a><span id="l6.22"> skip-if = os != &quot;win&quot;</span>
<a href="#l6.23"></a><span id="l6.23"> [test_mailGlue_distribution.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchChaining.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchChaining.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -6,77 +6,37 @@</span>
<a href="#l7.4"></a><span id="l7.4"> //  Bug 541969 made us not search an imap folder if the search scope before it</span>
<a href="#l7.5"></a><span id="l7.5"> // there was an empty local folder.</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> // main test</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-var gIMAPInbox;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-var gIMAPDaemon, gServer, gIMAPIncomingServer;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+Components.utils.import(&quot;resource://testing-common/mailnews/IMAPpump.js&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+Components.utils.import(&quot;resource://testing-common/mailnews/imapd.js&quot;);</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> function run_test()</span>
<a href="#l7.19"></a><span id="l7.19"> {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-  // Pull in the IMAP fake server code</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-  load(&quot;../../../imap/test/unit/head_server.js&quot;);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-  localAccountUtils.loadLocalMailAccount();</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-  /*</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-   * Set up an IMAP server.</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-   */</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-  let IMAPDaemon = new imapDaemon();</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-  gServer = makeServer(IMAPDaemon, &quot;&quot;);</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  IMAPDaemon.createMailbox(&quot;secondFolder&quot;, {subscribed : true});</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-  gIMAPIncomingServer.maximumConnectionsNumber = 1;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-  // We need an identity so that updateFolder doesn't fail</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-  let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-  let identity = MailServices.accounts.createIdentity();</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-  localAccount.addIdentity(identity);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-  localAccount.defaultIdentity = identity;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-  localAccount.incomingServer = localAccountUtils.incomingServer;</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-  MailServices.accounts.defaultAccount = localAccount;</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-  </span>
<a href="#l7.42"></a><span id="l7.42" class="difflineminus">-  // Let's also have another account, using the same identity</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-  let imapAccount = MailServices.accounts.createAccount();</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-  imapAccount.addIdentity(identity);</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-  imapAccount.defaultIdentity = identity;</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-  imapAccount.incomingServer = gIMAPIncomingServer;</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-  </span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-  // pref tuning: one connection only, turn off notifications</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-  Services.prefs.setBoolPref(&quot;mail.biff.play_sound&quot;, false);</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-  Services.prefs.setBoolPref(&quot;mail.biff.show_alert&quot;, false);</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-  Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-  Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+  setupIMAPPump(&quot;&quot;);</span>
<a href="#l7.55"></a><span id="l7.55">   // add a single message to the imap inbox.</span>
<a href="#l7.56"></a><span id="l7.56">   let messages = [];</span>
<a href="#l7.57"></a><span id="l7.57">   let gMessageGenerator = new MessageGenerator();</span>
<a href="#l7.58"></a><span id="l7.58">   messages = messages.concat(gMessageGenerator.makeMessage());</span>
<a href="#l7.59"></a><span id="l7.59">   gSynthMessage = messages[0];</span>
<a href="#l7.60"></a><span id="l7.60"> </span>
<a href="#l7.61"></a><span id="l7.61">   let msgURI =</span>
<a href="#l7.62"></a><span id="l7.62">     Services.io.newURI(&quot;data:text/plain;base64,&quot; +</span>
<a href="#l7.63"></a><span id="l7.63">                        btoa(gSynthMessage.toMessageString()),</span>
<a href="#l7.64"></a><span id="l7.64">                        null, null);</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineminus">-  let imapInbox =  IMAPDaemon.getMailbox(&quot;INBOX&quot;)</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-  gMessage = new imapMessage(msgURI.spec, imapInbox.uidnext++, []);</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-  imapInbox.addMessage(gMessage);</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-  // Get the IMAP inbox...</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-  let rootFolder = gIMAPIncomingServer.rootFolder;</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-  gIMAPInbox = rootFolder.getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox)</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-                         .QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+  gMessage = new imapMessage(msgURI.spec, IMAPPump.mailbox.uidnext++, []);</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineplus">+  IMAPPump.mailbox.addMessage(gMessage);</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76">   // update folder to download header.</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-  gIMAPInbox.updateFolderWithListener(null, UrlListener);</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+  IMAPPump.inbox.updateFolderWithListener(null, UrlListener);</span>
<a href="#l7.79"></a><span id="l7.79">   do_test_pending();</span>
<a href="#l7.80"></a><span id="l7.80"> }</span>
<a href="#l7.81"></a><span id="l7.81"> </span>
<a href="#l7.82"></a><span id="l7.82"> var UrlListener = </span>
<a href="#l7.83"></a><span id="l7.83"> {</span>
<a href="#l7.84"></a><span id="l7.84">   OnStartRunningUrl: function(url) { },</span>
<a href="#l7.85"></a><span id="l7.85">   OnStopRunningUrl: function(url, rc)</span>
<a href="#l7.86"></a><span id="l7.86">   {</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineat">@@ -93,17 +53,17 @@ function searchTest()</span>
<a href="#l7.88"></a><span id="l7.88"> </span>
<a href="#l7.89"></a><span id="l7.89">   let searchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l7.90"></a><span id="l7.90">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l7.91"></a><span id="l7.91"> </span>
<a href="#l7.92"></a><span id="l7.92">   let searchTerm = searchSession.createTerm();</span>
<a href="#l7.93"></a><span id="l7.93">   searchTerm.matchAll = true;</span>
<a href="#l7.94"></a><span id="l7.94">   searchSession.appendTerm(searchTerm);</span>
<a href="#l7.95"></a><span id="l7.95">   searchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail, emptyLocal1);</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-  searchSession.addScopeTerm(Ci.nsMsgSearchScope.onlineMail, gIMAPInbox);</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineplus">+  searchSession.addScopeTerm(Ci.nsMsgSearchScope.onlineMail, IMAPPump.inbox);</span>
<a href="#l7.98"></a><span id="l7.98">   searchSession.registerListener(searchListener);</span>
<a href="#l7.99"></a><span id="l7.99">   searchSession.search(null);</span>
<a href="#l7.100"></a><span id="l7.100"> }</span>
<a href="#l7.101"></a><span id="l7.101"> </span>
<a href="#l7.102"></a><span id="l7.102"> var numTotalMessages;</span>
<a href="#l7.103"></a><span id="l7.103"> </span>
<a href="#l7.104"></a><span id="l7.104"> // nsIMsgSearchNotify implementation</span>
<a href="#l7.105"></a><span id="l7.105"> var searchListener =</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineat">@@ -123,17 +83,11 @@ var searchListener =</span>
<a href="#l7.107"></a><span id="l7.107">     return true;</span>
<a href="#l7.108"></a><span id="l7.108">   }</span>
<a href="#l7.109"></a><span id="l7.109"> };</span>
<a href="#l7.110"></a><span id="l7.110"> </span>
<a href="#l7.111"></a><span id="l7.111"> function endTest()</span>
<a href="#l7.112"></a><span id="l7.112"> {</span>
<a href="#l7.113"></a><span id="l7.113">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l7.114"></a><span id="l7.114">   // server</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineminus">-  gIMAPIncomingServer.closeCachedConnections();</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineminus">-  gServer.stop();</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineminus">-  var thread = gThreadManager.currentThread;</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineminus">-  while (thread.hasPendingEvents())</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineminus">-    thread.processNextEvent(true);</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineminus">-</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+  teardownIMAPPump();</span>
<a href="#l7.123"></a><span id="l7.123">   do_test_finished();</span>
<a href="#l7.124"></a><span id="l7.124"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/test/unit/xpcshell.ini</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/test/unit/xpcshell.ini</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l8.4"></a><span id="l8.4"> [DEFAULT]</span>
<a href="#l8.5"></a><span id="l8.5"> head = head_mailbase.js</span>
<a href="#l8.6"></a><span id="l8.6"> tail = tail_base.js</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l8.8"></a><span id="l8.8"> support-files = nodelist_test.xml data/*</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> [test_accountMgr.js]</span>
<a href="#l8.11"></a><span id="l8.11"> [test_accountMgrCustomTypes.js]</span>
<a href="#l8.12"></a><span id="l8.12"> [test_accountMigration.js]</span>
<a href="#l8.13"></a><span id="l8.13"> [test_acctRepair.js]</span>
<a href="#l8.14"></a><span id="l8.14"> [test_autoconfigFetchDisk.js]</span>
<a href="#l8.15"></a><span id="l8.15"> [test_autoconfigUtils.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/compose/test/unit/head_compose.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/compose/test/unit/head_compose.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -20,29 +20,28 @@ load(&quot;../../../resources/abSetup.js&quot;);</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5"> // Import the smtp server scripts</span>
<a href="#l9.6"></a><span id="l9.6"> Components.utils.import(&quot;resource://testing-common/mailnews/maild.js&quot;);</span>
<a href="#l9.7"></a><span id="l9.7"> Components.utils.import(&quot;resource://testing-common/mailnews/smtpd.js&quot;);</span>
<a href="#l9.8"></a><span id="l9.8"> Components.utils.import(&quot;resource://testing-common/mailnews/auth.js&quot;);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-const SMTP_PORT = 1024+120;</span>
<a href="#l9.13"></a><span id="l9.13"> var gDraftFolder;</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15"> // Setup the daemon and server</span>
<a href="#l9.16"></a><span id="l9.16"> function setupServerDaemon(handler) {</span>
<a href="#l9.17"></a><span id="l9.17">   if (!handler)</span>
<a href="#l9.18"></a><span id="l9.18">     handler = function (d) { return new SMTP_RFC2821_handler(d); };</span>
<a href="#l9.19"></a><span id="l9.19">   var server = new nsMailServer(handler, new smtpDaemon());</span>
<a href="#l9.20"></a><span id="l9.20">   return server;</span>
<a href="#l9.21"></a><span id="l9.21"> }</span>
<a href="#l9.22"></a><span id="l9.22"> </span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-function getBasicSmtpServer() {</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-  let server = localAccountUtils.create_outgoing_server(SMTP_PORT, &quot;user&quot;, &quot;password&quot;);</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+function getBasicSmtpServer(port=1) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  let server = localAccountUtils.create_outgoing_server(port, &quot;user&quot;, &quot;password&quot;);</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28">   // Override the default greeting so we get something predicitable</span>
<a href="#l9.29"></a><span id="l9.29">   // in the ELHO message</span>
<a href="#l9.30"></a><span id="l9.30">   Services.prefs.setCharPref(&quot;mail.smtpserver.default.hello_argument&quot;, &quot;test&quot;);</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32">   return server;</span>
<a href="#l9.33"></a><span id="l9.33"> }</span>
<a href="#l9.34"></a><span id="l9.34"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_bug155172.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_bug155172.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -52,24 +52,23 @@ function run_test() {</span>
<a href="#l10.4"></a><span id="l10.4">   setupForPassword(&quot;signons-smtp.sqlite&quot;)</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   // Test file</span>
<a href="#l10.7"></a><span id="l10.7">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">   // Ensure we have at least one mail account</span>
<a href="#l10.10"></a><span id="l10.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-  var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-</span>
<a href="#l10.15"></a><span id="l10.15">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l10.16"></a><span id="l10.16">   // the server if something fails.</span>
<a href="#l10.17"></a><span id="l10.17">   try {</span>
<a href="#l10.18"></a><span id="l10.18">     // Start the fake SMTP server</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+    server.start();</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+    var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+    var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24">     // This time with auth</span>
<a href="#l10.25"></a><span id="l10.25">     test = &quot;Auth sendMailMessage&quot;;</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">     smtpServer.authMethod = Ci.nsMsgAuthMethod.passwordCleartext;</span>
<a href="#l10.28"></a><span id="l10.28">     smtpServer.socketType = Ci.nsMsgSocketType.plain;</span>
<a href="#l10.29"></a><span id="l10.29">     smtpServer.username = kUsername;</span>
<a href="#l10.30"></a><span id="l10.30"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_bug474774.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_bug474774.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -4,16 +4,17 @@</span>
<a href="#l11.4"></a><span id="l11.4">  * FCC switched off.</span>
<a href="#l11.5"></a><span id="l11.5">  */</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> var type = null;</span>
<a href="#l11.10"></a><span id="l11.10"> var test = null;</span>
<a href="#l11.11"></a><span id="l11.11"> var server;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+var smtpServer;</span>
<a href="#l11.13"></a><span id="l11.13"> var sentFolder;</span>
<a href="#l11.14"></a><span id="l11.14"> var originalData;</span>
<a href="#l11.15"></a><span id="l11.15"> var finished = false;</span>
<a href="#l11.16"></a><span id="l11.16"> var identity = null;</span>
<a href="#l11.17"></a><span id="l11.17"> var testFile = do_get_file(&quot;data/429891_testcase.eml&quot;);</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> const kSender = &quot;from@foo.invalid&quot;;</span>
<a href="#l11.20"></a><span id="l11.20"> const kTo = &quot;to@foo.invalid&quot;;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -130,17 +131,18 @@ function sendMessageLater()</span>
<a href="#l11.22"></a><span id="l11.22">   server = setupServerDaemon();</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">   type = &quot;sendMessageLater&quot;;</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l11.27"></a><span id="l11.27">   // the server if something fails.</span>
<a href="#l11.28"></a><span id="l11.28">   try {</span>
<a href="#l11.29"></a><span id="l11.29">     // Start the fake SMTP server</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+    server.start();</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    smtpServer.port = server.port;</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34">     // A test to check that we are sending files correctly, including checking</span>
<a href="#l11.35"></a><span id="l11.35">     // what the server receives and what we output.</span>
<a href="#l11.36"></a><span id="l11.36">     test = &quot;sendMessageLater&quot;;</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38">     var messageListener = new msll();</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">     msgSendLater.addListener(messageListener);</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -175,17 +177,17 @@ function run_test() {</span>
<a href="#l11.42"></a><span id="l11.42">   // servers and identities.</span>
<a href="#l11.43"></a><span id="l11.43">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l11.46"></a><span id="l11.46"> </span>
<a href="#l11.47"></a><span id="l11.47">   let account = MailServices.accounts.createAccount();</span>
<a href="#l11.48"></a><span id="l11.48">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  smtpServer = getBasicSmtpServer(0);</span>
<a href="#l11.52"></a><span id="l11.52">   identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l11.53"></a><span id="l11.53"> </span>
<a href="#l11.54"></a><span id="l11.54">   account.addIdentity(identity);</span>
<a href="#l11.55"></a><span id="l11.55">   account.defaultIdentity = identity;</span>
<a href="#l11.56"></a><span id="l11.56">   account.incomingServer = incomingServer;</span>
<a href="#l11.57"></a><span id="l11.57"> </span>
<a href="#l11.58"></a><span id="l11.58">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l11.59"></a><span id="l11.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendBackground.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendBackground.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -99,17 +99,20 @@ function run_test() {</span>
<a href="#l12.4"></a><span id="l12.4">   // Check that the send later service thinks we don't have messages to send</span>
<a href="#l12.5"></a><span id="l12.5">   do_check_eq(gMsgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   let account = MailServices.accounts.createAccount();</span>
<a href="#l12.10"></a><span id="l12.10">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  // Start the fake SMTP server</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+  server = setupServerDaemon();</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+  server.start();</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l12.17"></a><span id="l12.17">   identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">   account.addIdentity(identity);</span>
<a href="#l12.20"></a><span id="l12.20">   account.defaultIdentity = identity;</span>
<a href="#l12.21"></a><span id="l12.21">   account.incomingServer = incomingServer;</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25" class="difflineat">@@ -122,26 +125,21 @@ function run_test() {</span>
<a href="#l12.26"></a><span id="l12.26">                      .createInstance(Ci.nsIMsgCompFields);</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">   compFields.from = identity.email;</span>
<a href="#l12.29"></a><span id="l12.29">   compFields.to = kTo;</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">   var msgSend = Cc[&quot;@mozilla.org/messengercompose/send;1&quot;]</span>
<a href="#l12.32"></a><span id="l12.32">                   .createInstance(Ci.nsIMsgSend);</span>
<a href="#l12.33"></a><span id="l12.33"> </span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  // Set up the SMTP server.</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-  server = setupServerDaemon();</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-</span>
<a href="#l12.37"></a><span id="l12.37">   type = &quot;sendMessageLater&quot;;</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l12.40"></a><span id="l12.40">   // the server if something fails.</span>
<a href="#l12.41"></a><span id="l12.41">   try {</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-    // Start the fake SMTP server</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45">     // A test to check that we are sending files correctly, including checking</span>
<a href="#l12.46"></a><span id="l12.46">     // what the server receives and what we output.</span>
<a href="#l12.47"></a><span id="l12.47">     test = &quot;sendMessageLater&quot;;</span>
<a href="#l12.48"></a><span id="l12.48"> </span>
<a href="#l12.49"></a><span id="l12.49">     var messageListener = new msll();</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51">     gMsgSendLater.addListener(messageListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMailAddressIDN.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMailAddressIDN.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -114,33 +114,31 @@ msgListener.prototype =</span>
<a href="#l13.4"></a><span id="l13.4">       return this;</span>
<a href="#l13.5"></a><span id="l13.5">     throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l13.6"></a><span id="l13.6">   }</span>
<a href="#l13.7"></a><span id="l13.7"> }</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> function DoSendTest(aRecipient, aRecipientExpected, aExceptionExpected)</span>
<a href="#l13.11"></a><span id="l13.11"> {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  server = setupServerDaemon();</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  server.start();</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+  var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l13.16"></a><span id="l13.16">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l13.17"></a><span id="l13.17">   do_check_eq(identity.doFcc, true);</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">   // Random test file with data we don't actually care about. ;-)</span>
<a href="#l13.20"></a><span id="l13.20">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l13.21"></a><span id="l13.21">   originalData = IOUtils.loadFileToString(testFile);</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l13.24"></a><span id="l13.24">   // the server if something fails.</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineminus">-  server = setupServerDaemon();</span>
<a href="#l13.26"></a><span id="l13.26">   var exceptionCaught = 0;</span>
<a href="#l13.27"></a><span id="l13.27">   try</span>
<a href="#l13.28"></a><span id="l13.28">   {</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-    // Start the fake SMTP server</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-</span>
<a href="#l13.32"></a><span id="l13.32">     var compFields = Cc[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l13.33"></a><span id="l13.33">                        .createInstance(Ci.nsIMsgCompFields);</span>
<a href="#l13.34"></a><span id="l13.34">     compFields.from = identity.email;</span>
<a href="#l13.35"></a><span id="l13.35">     compFields.to = aRecipient;</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37">     var msgSend = Cc[&quot;@mozilla.org/messengercompose/send;1&quot;]</span>
<a href="#l13.38"></a><span id="l13.38">                     .createInstance(Ci.nsIMsgSend);</span>
<a href="#l13.39"></a><span id="l13.39">     msgSend.sendMessageFile(identity, &quot;&quot;, compFields, testFile,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMailMessage.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMailMessage.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -19,24 +19,23 @@ const kPassword = &quot;smtptest&quot;;</span>
<a href="#l14.4"></a><span id="l14.4"> function test_RFC2821() {</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">   // Test file</span>
<a href="#l14.7"></a><span id="l14.7">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">   // Ensure we have at least one mail account</span>
<a href="#l14.10"></a><span id="l14.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  server.start();</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l14.15"></a><span id="l14.15">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l14.18"></a><span id="l14.18">   // the server if something fails.</span>
<a href="#l14.19"></a><span id="l14.19">   try {</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-    // Start the fake SMTP server</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23">     // Just a basic test to check we're sending mail correctly.</span>
<a href="#l14.24"></a><span id="l14.24">     test = &quot;Basic sendMailMessage&quot;;</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">     MailServices.smtp.sendMailMessage(testFile, kTo, identity,</span>
<a href="#l14.27"></a><span id="l14.27">                                       null, null, null, null,</span>
<a href="#l14.28"></a><span id="l14.28">                                       false, {}, {});</span>
<a href="#l14.29"></a><span id="l14.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageFile.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageFile.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -111,32 +111,30 @@ function run_test() {</span>
<a href="#l15.4"></a><span id="l15.4">   var testFile = do_get_file(&quot;data/429891_testcase.eml&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">   originalData = IOUtils.loadFileToString(testFile);</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">   // Ensure we have at least one mail account</span>
<a href="#l15.8"></a><span id="l15.8">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  server.start();</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l15.15"></a><span id="l15.15">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   do_check_eq(identity.doFcc, true);</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21">   var msgSend = Cc[&quot;@mozilla.org/messengercompose/send;1&quot;]</span>
<a href="#l15.22"></a><span id="l15.22">                   .createInstance(Ci.nsIMsgSend);</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l15.25"></a><span id="l15.25">   // the server if something fails.</span>
<a href="#l15.26"></a><span id="l15.26">   try {</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-    // Start the fake SMTP server</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-</span>
<a href="#l15.30"></a><span id="l15.30">     // A test to check that we are sending files correctly, including checking</span>
<a href="#l15.31"></a><span id="l15.31">     // what the server receives and what we output.</span>
<a href="#l15.32"></a><span id="l15.32">     test = &quot;sendMessageFile&quot;;</span>
<a href="#l15.33"></a><span id="l15.33"> </span>
<a href="#l15.34"></a><span id="l15.34">     // Msg Comp Fields</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">     var compFields = Cc[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l15.37"></a><span id="l15.37">                        .createInstance(Ci.nsIMsgCompFields);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -11,16 +11,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * mangling the message.</span>
<a href="#l16.5"></a><span id="l16.5">  */</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> var type = null;</span>
<a href="#l16.10"></a><span id="l16.10"> var test = null;</span>
<a href="#l16.11"></a><span id="l16.11"> var server;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+var smtpServer;</span>
<a href="#l16.13"></a><span id="l16.13"> var sentFolder;</span>
<a href="#l16.14"></a><span id="l16.14"> var originalData;</span>
<a href="#l16.15"></a><span id="l16.15"> var finished = false;</span>
<a href="#l16.16"></a><span id="l16.16"> var identity = null;</span>
<a href="#l16.17"></a><span id="l16.17"> var testFile = do_get_file(&quot;data/429891_testcase.eml&quot;);</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> const kSender = &quot;from@foo.invalid&quot;;</span>
<a href="#l16.20"></a><span id="l16.20"> const kTo = &quot;to@foo.invalid&quot;;</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -137,17 +138,18 @@ function sendMessageLater()</span>
<a href="#l16.22"></a><span id="l16.22">   server = setupServerDaemon();</span>
<a href="#l16.23"></a><span id="l16.23"> </span>
<a href="#l16.24"></a><span id="l16.24">   type = &quot;sendMessageLater&quot;;</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l16.27"></a><span id="l16.27">   // the server if something fails.</span>
<a href="#l16.28"></a><span id="l16.28">   try {</span>
<a href="#l16.29"></a><span id="l16.29">     // Start the fake SMTP server</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+    server.start();</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+    smtpServer.port = server.port;</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34">     // A test to check that we are sending files correctly, including checking</span>
<a href="#l16.35"></a><span id="l16.35">     // what the server receives and what we output.</span>
<a href="#l16.36"></a><span id="l16.36">     test = &quot;sendMessageLater&quot;;</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38">     var messageListener = new msll();</span>
<a href="#l16.39"></a><span id="l16.39"> </span>
<a href="#l16.40"></a><span id="l16.40">     msgSendLater.addListener(messageListener);</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineat">@@ -182,17 +184,17 @@ function run_test() {</span>
<a href="#l16.42"></a><span id="l16.42">   // Check that the send later service thinks we don't have messages to send</span>
<a href="#l16.43"></a><span id="l16.43">   do_check_eq(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l16.44"></a><span id="l16.44"> </span>
<a href="#l16.45"></a><span id="l16.45">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l16.46"></a><span id="l16.46"> </span>
<a href="#l16.47"></a><span id="l16.47">   let account = MailServices.accounts.createAccount();</span>
<a href="#l16.48"></a><span id="l16.48">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l16.49"></a><span id="l16.49"> </span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+  smtpServer = getBasicSmtpServer(1);</span>
<a href="#l16.52"></a><span id="l16.52">   identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l16.53"></a><span id="l16.53"> </span>
<a href="#l16.54"></a><span id="l16.54">   account.addIdentity(identity);</span>
<a href="#l16.55"></a><span id="l16.55">   account.defaultIdentity = identity;</span>
<a href="#l16.56"></a><span id="l16.56">   account.incomingServer = incomingServer;</span>
<a href="#l16.57"></a><span id="l16.57"> </span>
<a href="#l16.58"></a><span id="l16.58">   sentFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l16.59"></a><span id="l16.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_sendMessageLater2.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_sendMessageLater2.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -14,16 +14,17 @@</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5"> load(&quot;../../../resources/logHelper.js&quot;);</span>
<a href="#l17.6"></a><span id="l17.6"> load(&quot;../../../resources/asyncTestUtils.js&quot;);</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10"> var test = &quot;sendMessageLater&quot;;</span>
<a href="#l17.11"></a><span id="l17.11"> var server = null;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+var smtpServer;</span>
<a href="#l17.13"></a><span id="l17.13"> var gSentFolder;</span>
<a href="#l17.14"></a><span id="l17.14"> var originalData;</span>
<a href="#l17.15"></a><span id="l17.15"> var identity = null;</span>
<a href="#l17.16"></a><span id="l17.16"> var gMsgFile =</span>
<a href="#l17.17"></a><span id="l17.17"> [</span>
<a href="#l17.18"></a><span id="l17.18">   do_get_file(&quot;data/message1.eml&quot;),</span>
<a href="#l17.19"></a><span id="l17.19">   do_get_file(&quot;data/429891_testcase.eml&quot;)</span>
<a href="#l17.20"></a><span id="l17.20"> ];</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineat">@@ -159,17 +160,18 @@ function resetCounts()</span>
<a href="#l17.22"></a><span id="l17.22"> // This function does the actual send later</span>
<a href="#l17.23"></a><span id="l17.23"> function sendUnsentMessages()</span>
<a href="#l17.24"></a><span id="l17.24"> {</span>
<a href="#l17.25"></a><span id="l17.25">   gMessageSendStatus = 0;</span>
<a href="#l17.26"></a><span id="l17.26">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l17.27"></a><span id="l17.27">   // the server if something fails.</span>
<a href="#l17.28"></a><span id="l17.28">   try {</span>
<a href="#l17.29"></a><span id="l17.29">     // Start the fake SMTP server</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+    server.start();</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+    smtpServer.port = server.port;</span>
<a href="#l17.33"></a><span id="l17.33"> </span>
<a href="#l17.34"></a><span id="l17.34">     // Send the unsent message</span>
<a href="#l17.35"></a><span id="l17.35">     msgSendLater.sendUnsentMessages(identity);</span>
<a href="#l17.36"></a><span id="l17.36">     server.performTest();</span>
<a href="#l17.37"></a><span id="l17.37">   } catch (e) {</span>
<a href="#l17.38"></a><span id="l17.38">     do_throw(e);</span>
<a href="#l17.39"></a><span id="l17.39">   }</span>
<a href="#l17.40"></a><span id="l17.40">   return false;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineat">@@ -225,17 +227,17 @@ function run_test() {</span>
<a href="#l17.42"></a><span id="l17.42">   // Check that the send later service thinks we don't have messages to send.</span>
<a href="#l17.43"></a><span id="l17.43">   do_check_eq(msgSendLater.hasUnsentMessages(identity), false);</span>
<a href="#l17.44"></a><span id="l17.44"> </span>
<a href="#l17.45"></a><span id="l17.45">   MailServices.accounts.setSpecialFolders();</span>
<a href="#l17.46"></a><span id="l17.46"> </span>
<a href="#l17.47"></a><span id="l17.47">   let account = MailServices.accounts.createAccount();</span>
<a href="#l17.48"></a><span id="l17.48">   let incomingServer = MailServices.accounts.createIncomingServer(&quot;test&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l17.49"></a><span id="l17.49"> </span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  smtpServer = getBasicSmtpServer(1);</span>
<a href="#l17.52"></a><span id="l17.52">   identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l17.53"></a><span id="l17.53"> </span>
<a href="#l17.54"></a><span id="l17.54">   account.addIdentity(identity);</span>
<a href="#l17.55"></a><span id="l17.55">   account.defaultIdentity = identity;</span>
<a href="#l17.56"></a><span id="l17.56">   account.incomingServer = incomingServer;</span>
<a href="#l17.57"></a><span id="l17.57"> </span>
<a href="#l17.58"></a><span id="l17.58">   localAccountUtils.rootFolder.createLocalSubfolder(&quot;Sent&quot;);</span>
<a href="#l17.59"></a><span id="l17.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpAuthMethods.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpAuthMethods.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -93,20 +93,20 @@ function run_test() {</span>
<a href="#l18.4"></a><span id="l18.4">       handler.kUsername = kUsername;</span>
<a href="#l18.5"></a><span id="l18.5">       handler.kPassword = kPassword;</span>
<a href="#l18.6"></a><span id="l18.6">       handler.kAuthRequired = true;</span>
<a href="#l18.7"></a><span id="l18.7">       handler.kAuthSchemes = kAuthSchemes;</span>
<a href="#l18.8"></a><span id="l18.8">       return handler;</span>
<a href="#l18.9"></a><span id="l18.9">     }</span>
<a href="#l18.10"></a><span id="l18.10">     server = setupServerDaemon(createHandler);</span>
<a href="#l18.11"></a><span id="l18.11">     dump(&quot;AUTH PLAIN = &quot; + AUTHPLAIN + &quot;\n&quot;);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    server.start();</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-    smtpServer = getBasicSmtpServer();</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+    smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l18.18"></a><span id="l18.18">     smtpServer.socketType = Ci.nsMsgSocketType.plain;</span>
<a href="#l18.19"></a><span id="l18.19">     smtpServer.username = kUsername;</span>
<a href="#l18.20"></a><span id="l18.20">     smtpServer.password = kPassword;</span>
<a href="#l18.21"></a><span id="l18.21">     identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23">     testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l18.24"></a><span id="l18.24"> </span>
<a href="#l18.25"></a><span id="l18.25">     nextTest();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPassword.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPassword.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -30,24 +30,23 @@ function run_test() {</span>
<a href="#l19.4"></a><span id="l19.4">   setupForPassword(&quot;signons-mailnews1.8.sqlite&quot;)</span>
<a href="#l19.5"></a><span id="l19.5"> </span>
<a href="#l19.6"></a><span id="l19.6">   // Test file</span>
<a href="#l19.7"></a><span id="l19.7">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   // Ensure we have at least one mail account</span>
<a href="#l19.10"></a><span id="l19.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-  var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-</span>
<a href="#l19.15"></a><span id="l19.15">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l19.16"></a><span id="l19.16">   // the server if something fails.</span>
<a href="#l19.17"></a><span id="l19.17">   try {</span>
<a href="#l19.18"></a><span id="l19.18">     // Start the fake SMTP server</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+    server.start();</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+    var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+    var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24">     // This time with auth</span>
<a href="#l19.25"></a><span id="l19.25">     test = &quot;Auth sendMailMessage&quot;;</span>
<a href="#l19.26"></a><span id="l19.26"> </span>
<a href="#l19.27"></a><span id="l19.27">     smtpServer.authMethod = Ci.nsMsgAuthMethod.passwordCleartext;</span>
<a href="#l19.28"></a><span id="l19.28">     smtpServer.socketType = Ci.nsMsgSocketType.plain;</span>
<a href="#l19.29"></a><span id="l19.29">     smtpServer.username = kUsername;</span>
<a href="#l19.30"></a><span id="l19.30"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPasswordFailure1.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPasswordFailure1.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -71,25 +71,23 @@ function run_test() {</span>
<a href="#l20.4"></a><span id="l20.4">   registerAlertTestUtils();</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6">   // Test file</span>
<a href="#l20.7"></a><span id="l20.7">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">   // Ensure we have at least one mail account</span>
<a href="#l20.10"></a><span id="l20.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  server.start();</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+  var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l20.15"></a><span id="l20.15">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l20.18"></a><span id="l20.18">   // the server if something fails.</span>
<a href="#l20.19"></a><span id="l20.19">   try {</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-    // Start the fake SMTP server</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-</span>
<a href="#l20.23"></a><span id="l20.23">     // This time with auth</span>
<a href="#l20.24"></a><span id="l20.24">     test = &quot;Auth sendMailMessage&quot;;</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26">     smtpServer.authMethod = Ci.nsMsgAuthMethod.passwordCleartext;</span>
<a href="#l20.27"></a><span id="l20.27">     smtpServer.socketType = Ci.nsMsgSocketType.plain;</span>
<a href="#l20.28"></a><span id="l20.28">     smtpServer.username = kUsername;</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30">     dump(&quot;Send\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPasswordFailure2.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPasswordFailure2.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -82,24 +82,23 @@ function run_test() {</span>
<a href="#l21.4"></a><span id="l21.4">   registerAlertTestUtils();</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6">   // Test file</span>
<a href="#l21.7"></a><span id="l21.7">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">   // Ensure we have at least one mail account</span>
<a href="#l21.10"></a><span id="l21.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-  var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-</span>
<a href="#l21.15"></a><span id="l21.15">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l21.16"></a><span id="l21.16">   // the server if something fails.</span>
<a href="#l21.17"></a><span id="l21.17">   try {</span>
<a href="#l21.18"></a><span id="l21.18">     // Start the fake SMTP server</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineminus">-    server.start(SMTP_PORT);</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+    server.start();</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+    var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+    var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l21.23"></a><span id="l21.23"> </span>
<a href="#l21.24"></a><span id="l21.24">     // This time with auth</span>
<a href="#l21.25"></a><span id="l21.25">     test = &quot;Auth sendMailMessage&quot;;</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27">     smtpServer.authMethod = Ci.nsMsgAuthMethod.passwordCleartext;</span>
<a href="#l21.28"></a><span id="l21.28">     smtpServer.socketType = Ci.nsMsgSocketType.plain;</span>
<a href="#l21.29"></a><span id="l21.29">     smtpServer.username = kUsername;</span>
<a href="#l21.30"></a><span id="l21.30"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_smtpPasswordFailure3.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_smtpPasswordFailure3.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -81,22 +81,21 @@ function run_test() {</span>
<a href="#l22.4"></a><span id="l22.4">   registerAlertTestUtils();</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6">   // Test file</span>
<a href="#l22.7"></a><span id="l22.7">   var testFile = do_get_file(&quot;data/message1.eml&quot;);</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9">   // Ensure we have at least one mail account</span>
<a href="#l22.10"></a><span id="l22.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  var smtpServer = getBasicSmtpServer();</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  // Start the fake SMTP server</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+  server.start();</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+  var smtpServer = getBasicSmtpServer(server.port);</span>
<a href="#l22.16"></a><span id="l22.16">   var identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l22.17"></a><span id="l22.17"> </span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-  // Start the fake SMTP server</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-  server.start(SMTP_PORT);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-</span>
<a href="#l22.21"></a><span id="l22.21">   // This time with auth</span>
<a href="#l22.22"></a><span id="l22.22">   test = &quot;Auth sendMailMessage&quot;;</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24">   smtpServer.authMethod = Ci.nsMsgAuthMethod.passwordCleartext;</span>
<a href="#l22.25"></a><span id="l22.25">   smtpServer.socketType = Ci.nsMsgSocketType.plain;</span>
<a href="#l22.26"></a><span id="l22.26">   smtpServer.username = kUsername;</span>
<a href="#l22.27"></a><span id="l22.27"> </span>
<a href="#l22.28"></a><span id="l22.28">   do_test_pending();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/compose/test/unit/xpcshell.ini</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/compose/test/unit/xpcshell.ini</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l23.4"></a><span id="l23.4"> [DEFAULT]</span>
<a href="#l23.5"></a><span id="l23.5"> head = head_compose.js</span>
<a href="#l23.6"></a><span id="l23.6"> tail = tail_compose.js</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l23.8"></a><span id="l23.8"> support-files = data/*</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10"> [test_attachment.js]</span>
<a href="#l23.11"></a><span id="l23.11"> [test_attachment_intl.js]</span>
<a href="#l23.12"></a><span id="l23.12"> [test_bug155172.js]</span>
<a href="#l23.13"></a><span id="l23.13"> [test_bug235432.js]</span>
<a href="#l23.14"></a><span id="l23.14"> [test_bug474774.js]</span>
<a href="#l23.15"></a><span id="l23.15"> [test_detectAttachmentCharset.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/xpcshell.ini</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/xpcshell.ini</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l24.4"></a><span id="l24.4"> [DEFAULT]</span>
<a href="#l24.5"></a><span id="l24.5"> head = head_gloda.js</span>
<a href="#l24.6"></a><span id="l24.6"> tail = tail_gloda.js</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l24.8"></a><span id="l24.8"> support-files = base_*.js resources/*</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10"> [test_cleanup_msf_databases.js]</span>
<a href="#l24.11"></a><span id="l24.11"> [test_corrupt_database.js]</span>
<a href="#l24.12"></a><span id="l24.12"> [test_folder_logic.js]</span>
<a href="#l24.13"></a><span id="l24.13"> [test_fts3_tokenizer.js]</span>
<a href="#l24.14"></a><span id="l24.14"> [test_gloda_content_imap_offline.js]</span>
<a href="#l24.15"></a><span id="l24.15"> [test_gloda_content_local.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/imap/test/unit/head_server.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/imap/test/unit/head_server.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -18,18 +18,16 @@ var CC = Components.Constructor;</span>
<a href="#l25.4"></a><span id="l25.4"> // Ensure the profile directory is set up</span>
<a href="#l25.5"></a><span id="l25.5"> do_get_profile();</span>
<a href="#l25.6"></a><span id="l25.6"> </span>
<a href="#l25.7"></a><span id="l25.7"> // Import fakeserver</span>
<a href="#l25.8"></a><span id="l25.8"> Components.utils.import(&quot;resource://testing-common/mailnews/maild.js&quot;);</span>
<a href="#l25.9"></a><span id="l25.9"> Components.utils.import(&quot;resource://testing-common/mailnews/imapd.js&quot;);</span>
<a href="#l25.10"></a><span id="l25.10"> Components.utils.import(&quot;resource://testing-common/mailnews/auth.js&quot;);</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-const IMAP_PORT = 1024 + 143;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-</span>
<a href="#l25.14"></a><span id="l25.14"> function makeServer(daemon, infoString, otherProps) {</span>
<a href="#l25.15"></a><span id="l25.15">   if (infoString in configurations)</span>
<a href="#l25.16"></a><span id="l25.16">     return makeServer(daemon, configurations[infoString].join(&quot;,&quot;), otherProps);</span>
<a href="#l25.17"></a><span id="l25.17"> </span>
<a href="#l25.18"></a><span id="l25.18">   function createHandler(d) {</span>
<a href="#l25.19"></a><span id="l25.19">     var handler = new IMAP_RFC3501_handler(d);</span>
<a href="#l25.20"></a><span id="l25.20">     if (!infoString)</span>
<a href="#l25.21"></a><span id="l25.21">       infoString = &quot;RFC2195&quot;;</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -41,22 +39,22 @@ function makeServer(daemon, infoString, </span>
<a href="#l25.23"></a><span id="l25.23">     }</span>
<a href="#l25.24"></a><span id="l25.24">     if (otherProps) {</span>
<a href="#l25.25"></a><span id="l25.25">       for (var prop in otherProps)</span>
<a href="#l25.26"></a><span id="l25.26">         handler[prop] = otherProps[prop];</span>
<a href="#l25.27"></a><span id="l25.27">     }</span>
<a href="#l25.28"></a><span id="l25.28">     return handler;</span>
<a href="#l25.29"></a><span id="l25.29">   }</span>
<a href="#l25.30"></a><span id="l25.30">   var server = new nsMailServer(createHandler, daemon);</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-  server.start(IMAP_PORT);</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+  server.start();</span>
<a href="#l25.33"></a><span id="l25.33">   return server;</span>
<a href="#l25.34"></a><span id="l25.34"> }</span>
<a href="#l25.35"></a><span id="l25.35"> </span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-function createLocalIMAPServer() {</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-  let server = localAccountUtils.create_incoming_server(&quot;imap&quot;, IMAP_PORT,</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+function createLocalIMAPServer(port) {</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+  let server = localAccountUtils.create_incoming_server(&quot;imap&quot;, port,</span>
<a href="#l25.40"></a><span id="l25.40"> 							&quot;user&quot;, &quot;password&quot;);</span>
<a href="#l25.41"></a><span id="l25.41">   server.QueryInterface(Ci.nsIImapIncomingServer);</span>
<a href="#l25.42"></a><span id="l25.42">   return server;</span>
<a href="#l25.43"></a><span id="l25.43"> }</span>
<a href="#l25.44"></a><span id="l25.44"> </span>
<a href="#l25.45"></a><span id="l25.45"> // &lt;copied from=&quot;head_maillocal.js&quot;&gt;</span>
<a href="#l25.46"></a><span id="l25.46"> /**</span>
<a href="#l25.47"></a><span id="l25.47">  * @param fromServer server.playTransaction</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -41,17 +41,17 @@ function run_test()</span>
<a href="#l26.4"></a><span id="l26.4">   Services.prefs.setBoolPref(&quot;mail.server.default.fetch_by_chunks&quot;, true);</span>
<a href="#l26.5"></a><span id="l26.5">   Services.prefs.setIntPref(&quot;mail.imap.chunk_size&quot;, 1000);</span>
<a href="#l26.6"></a><span id="l26.6">   Services.prefs.setIntPref(&quot;mail.imap.min_chunk_size_threshold&quot;, 1500);</span>
<a href="#l26.7"></a><span id="l26.7">   Services.prefs.setIntPref(&quot;mail.imap.chunk_add&quot;, 0);</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   // set up IMAP fakeserver and incoming server</span>
<a href="#l26.10"></a><span id="l26.10">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l26.11"></a><span id="l26.11">   gIMAPServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  gIMAPIncomingServer = createLocalIMAPServer(gIMAPServer.port);</span>
<a href="#l26.14"></a><span id="l26.14"> </span>
<a href="#l26.15"></a><span id="l26.15">   // The server doesn't support more than one connection</span>
<a href="#l26.16"></a><span id="l26.16">   Services.prefs.setIntPref(&quot;mail.server.server1.max_cached_connections&quot;, 1);</span>
<a href="#l26.17"></a><span id="l26.17">   // We aren't interested in downloading messages automatically</span>
<a href="#l26.18"></a><span id="l26.18">   Services.prefs.setBoolPref(&quot;mail.server.server1.download_on_biff&quot;, false);</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20">   async_run_tests([verifyContentLength, endTest]);</span>
<a href="#l26.21"></a><span id="l26.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -37,17 +37,17 @@ function run_test()</span>
<a href="#l27.4"></a><span id="l27.4">   Services.prefs.setBoolPref(&quot;mail.inline_attachments&quot;,     false);</span>
<a href="#l27.5"></a><span id="l27.5">   Services.prefs.setIntPref (&quot;browser.cache.disk.capacity&quot;,              0);</span>
<a href="#l27.6"></a><span id="l27.6">   Services.prefs.setIntPref (&quot;mail.imap.mime_parts_on_demand_threshold&quot;, 1);</span>
<a href="#l27.7"></a><span id="l27.7">   Services.prefs.setIntPref (&quot;mailnews.display.disallow_mime_handlers&quot;,  0);</span>
<a href="#l27.8"></a><span id="l27.8">   Services.prefs.setBoolPref(&quot;mail.server.default.fetch_by_chunks&quot;,  false);</span>
<a href="#l27.9"></a><span id="l27.9">   Services.prefs.setBoolPref(&quot;mail.server.server1.autosync_offline_stores&quot;, false);</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  gIMAPIncomingServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">   //start first test</span>
<a href="#l27.16"></a><span id="l27.16">   async_run_tests(tests);</span>
<a href="#l27.17"></a><span id="l27.17"> }</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19"> function streamMessages() {</span>
<a href="#l27.20"></a><span id="l27.20">   let inbox = gIMAPDaemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l27.21"></a><span id="l27.21">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dontStatNoSelect.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -24,17 +24,17 @@ function run_test() {</span>
<a href="#l28.4"></a><span id="l28.4">   daemon.createMailbox(&quot;folder 1&quot;, {subscribed : true});</span>
<a href="#l28.5"></a><span id="l28.5">   let folder1Mailbox = daemon.getMailbox(&quot;folder 1&quot;);</span>
<a href="#l28.6"></a><span id="l28.6">   folder1Mailbox.flags.push(&quot;\\Noselect&quot;);</span>
<a href="#l28.7"></a><span id="l28.7">   daemon.createMailbox(&quot;folder 2&quot;, {subscribed : true});</span>
<a href="#l28.8"></a><span id="l28.8">   gFolder2Mailbox = daemon.getMailbox(&quot;folder 2&quot;);</span>
<a href="#l28.9"></a><span id="l28.9">   addMessageToFolder(gFolder2Mailbox);</span>
<a href="#l28.10"></a><span id="l28.10">   gServer = makeServer(daemon, &quot;&quot;);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  gImapServer = createLocalIMAPServer();</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  gImapServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l28.14"></a><span id="l28.14">   gImapServer.maximumConnectionsNumber = 1;</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l28.17"></a><span id="l28.17"> </span>
<a href="#l28.18"></a><span id="l28.18">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l28.19"></a><span id="l28.19">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l28.20"></a><span id="l28.20">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l28.21"></a><span id="l28.21">   localAccount.addIdentity(identity);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAuthMethods.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAuthMethods.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -86,17 +86,17 @@ function nextTest() {</span>
<a href="#l29.4"></a><span id="l29.4"> </span>
<a href="#l29.5"></a><span id="l29.5">     // (re)create fake server</span>
<a href="#l29.6"></a><span id="l29.6">     var daemon = new imapDaemon();</span>
<a href="#l29.7"></a><span id="l29.7">     var server = makeServer(daemon, &quot;&quot;,</span>
<a href="#l29.8"></a><span id="l29.8">       {kAuthSchemes: thisTest.serverAuthMethods});</span>
<a href="#l29.9"></a><span id="l29.9">     server.setDebugLevel(fsDebugAll);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11">     // If Mailnews ever caches server capabilities, delete and re-create the incomingServer here</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    var incomingServer = createLocalIMAPServer();</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+    var incomingServer = createLocalIMAPServer(server.port);</span>
<a href="#l29.14"></a><span id="l29.14"> </span>
<a href="#l29.15"></a><span id="l29.15">     let msgServer = incomingServer;</span>
<a href="#l29.16"></a><span id="l29.16">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l29.17"></a><span id="l29.17">     msgServer.authMethod = thisTest.clientAuthMethod;</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">     // connect</span>
<a href="#l29.20"></a><span id="l29.20">     incomingServer.performExpand(null);</span>
<a href="#l29.21"></a><span id="l29.21">     server.performTest(&quot;LSUB&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapChunks.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapChunks.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -16,17 +16,17 @@ const gMsgFile = do_get_file(&quot;../../../d</span>
<a href="#l30.4"></a><span id="l30.4"> function run_test()</span>
<a href="#l30.5"></a><span id="l30.5"> {</span>
<a href="#l30.6"></a><span id="l30.6">   /*</span>
<a href="#l30.7"></a><span id="l30.7">    * Set up an IMAP server. The bug is only triggered when nsMsgSaveAsListener</span>
<a href="#l30.8"></a><span id="l30.8">    * is used (i.e., for IMAP and NNTP).</span>
<a href="#l30.9"></a><span id="l30.9">    */</span>
<a href="#l30.10"></a><span id="l30.10">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l30.11"></a><span id="l30.11">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  gIMAPIncomingServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l30.14"></a><span id="l30.14"> </span>
<a href="#l30.15"></a><span id="l30.15">   // pref tuning: one connection only, turn off notifications</span>
<a href="#l30.16"></a><span id="l30.16">   Services.prefs.setBoolPref(&quot;mail.server.server1.autosync_offline_stores&quot;, false);</span>
<a href="#l30.17"></a><span id="l30.17">   Services.prefs.setIntPref(&quot;mail.server.server1.max_cached_connections&quot;, 1);</span>
<a href="#l30.18"></a><span id="l30.18">   Services.prefs.setBoolPref(&quot;mail.biff.play_sound&quot;, false);</span>
<a href="#l30.19"></a><span id="l30.19">   Services.prefs.setBoolPref(&quot;mail.biff.show_alert&quot;, false);</span>
<a href="#l30.20"></a><span id="l30.20">   Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l30.21"></a><span id="l30.21">   Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -322,17 +322,17 @@ const gTestArray =</span>
<a href="#l31.4"></a><span id="l31.4"> ];</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> function run_test()</span>
<a href="#l31.7"></a><span id="l31.7"> {</span>
<a href="#l31.8"></a><span id="l31.8">   // Add a listener.</span>
<a href="#l31.9"></a><span id="l31.9">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l31.10"></a><span id="l31.10">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  gIMAPIncomingServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15">   if (!localAccountUtils.inboxFolder)</span>
<a href="#l31.16"></a><span id="l31.16">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l31.19"></a><span id="l31.19">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l31.20"></a><span id="l31.20">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l31.21"></a><span id="l31.21">   localAccount.addIdentity(identity);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -35,17 +35,17 @@ function run_test()</span>
<a href="#l32.4"></a><span id="l32.4">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l32.5"></a><span id="l32.5"> </span>
<a href="#l32.6"></a><span id="l32.6">   /*</span>
<a href="#l32.7"></a><span id="l32.7">    * Set up an IMAP server.</span>
<a href="#l32.8"></a><span id="l32.8">    */</span>
<a href="#l32.9"></a><span id="l32.9">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l32.10"></a><span id="l32.10">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l32.11"></a><span id="l32.11">   gIMAPDaemon.createMailbox(&quot;folder 1&quot;, {subscribed : true});</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  gIMAPIncomingServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l32.14"></a><span id="l32.14">   gIMAPIncomingServer.maximumConnectionsNumber = 1;</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l32.17"></a><span id="l32.17">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l32.18"></a><span id="l32.18">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l32.19"></a><span id="l32.19">   localAccount.addIdentity(identity);</span>
<a href="#l32.20"></a><span id="l32.20">   localAccount.defaultIdentity = identity;</span>
<a href="#l32.21"></a><span id="l32.21">   localAccount.incomingServer = localAccountUtils.incomingServer;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapPasswordFailure.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapPasswordFailure.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -70,17 +70,17 @@ function run_test() {</span>
<a href="#l33.4"></a><span id="l33.4">   server = makeServer(daemon, &quot;&quot;, {</span>
<a href="#l33.5"></a><span id="l33.5">     // Make username of server match the singons.txt file</span>
<a href="#l33.6"></a><span id="l33.6">     // (pw there is intentionally invalid)</span>
<a href="#l33.7"></a><span id="l33.7">     kUsername: kUserName,</span>
<a href="#l33.8"></a><span id="l33.8">     kPassword: kValidPassword});</span>
<a href="#l33.9"></a><span id="l33.9">   server.setDebugLevel(fsDebugAll);</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11"> </span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  incomingServer = createLocalIMAPServer();</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  incomingServer = createLocalIMAPServer(server.port);</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15">   // PerformExpand expects us to already have a password loaded into the</span>
<a href="#l33.16"></a><span id="l33.16">   // incomingServer when we call it, so force a get password call to get it</span>
<a href="#l33.17"></a><span id="l33.17">   // out of the signons file (first removing the value that</span>
<a href="#l33.18"></a><span id="l33.18">   // createLocalIMAPServer puts in there).</span>
<a href="#l33.19"></a><span id="l33.19">   incomingServer.password = &quot;&quot;;</span>
<a href="#l33.20"></a><span id="l33.20">   let password = incomingServer.getPasswordWithUI(&quot;Prompt Message&quot;,</span>
<a href="#l33.21"></a><span id="l33.21">                                                   &quot;Prompt Title&quot;, null, {});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUrls.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUrls.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -15,13 +15,13 @@ setupIMAPPump();</span>
<a href="#l34.4"></a><span id="l34.4">  */</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6"> function run_test()</span>
<a href="#l34.7"></a><span id="l34.7"> {</span>
<a href="#l34.8"></a><span id="l34.8">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l34.9"></a><span id="l34.9">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l34.10"></a><span id="l34.10">   let uri = {};</span>
<a href="#l34.11"></a><span id="l34.11">   imapS.GetUrlForUri(&quot;imap-message://user@localhost/INBOX#4294967168&quot;, uri, null);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  do_check_eq(uri.value.spec,</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-              &quot;imap://user@localhost:1167/fetch%3EUID%3E%5EINBOX%3E4294967168&quot;);</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+  do_check_eq(uri.value.spec, &quot;imap://user@localhost:&quot; + IMAPPump.server.port +</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+      &quot;/fetch%3EUID%3E%5EINBOX%3E4294967168&quot;);</span>
<a href="#l34.16"></a><span id="l34.16">   teardownIMAPPump();</span>
<a href="#l34.17"></a><span id="l34.17"> }</span>
<a href="#l34.18"></a><span id="l34.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_nsIMsgFolderListenerIMAP.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -197,17 +197,17 @@ function run_test()</span>
<a href="#l35.4"></a><span id="l35.4">   // This is before any of the actual tests, so...</span>
<a href="#l35.5"></a><span id="l35.5">   gTest = 0;</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7">   // Add a listener.</span>
<a href="#l35.8"></a><span id="l35.8">   gMFNService.addListener(gMFListener, allTestedEvents);</span>
<a href="#l35.9"></a><span id="l35.9">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l35.10"></a><span id="l35.10">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  gIMAPIncomingServer = createLocalIMAPServer(gServer.port);</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15">   // Also make sure a local folders server is created, as that's what is used</span>
<a href="#l35.16"></a><span id="l35.16">   // for sent items</span>
<a href="#l35.17"></a><span id="l35.17">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l35.20"></a><span id="l35.20">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l35.21"></a><span id="l35.21">   let identity = MailServices.accounts.createIdentity();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineDraftDataloss.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineDraftDataloss.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -85,17 +85,17 @@ function saveDraft()</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5"> function goOnline()</span>
<a href="#l36.6"></a><span id="l36.6"> {</span>
<a href="#l36.7"></a><span id="l36.7">   let offlineManager = Cc[&quot;@mozilla.org/messenger/offline-manager;1&quot;]</span>
<a href="#l36.8"></a><span id="l36.8">                        .getService(Ci.nsIMsgOfflineManager);</span>
<a href="#l36.9"></a><span id="l36.9">   IMAPPump.daemon.closing = false;</span>
<a href="#l36.10"></a><span id="l36.10">   Services.io.offline = false;</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  IMAPPump.server.start(IMAP_PORT);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  IMAPPump.server.start();</span>
<a href="#l36.14"></a><span id="l36.14">   offlineManager.inProgress = true;</span>
<a href="#l36.15"></a><span id="l36.15">   offlineManager.goOnline(false, true, null);</span>
<a href="#l36.16"></a><span id="l36.16">   let waitForNotInProgress = function () {</span>
<a href="#l36.17"></a><span id="l36.17">     if (offlineManager.inProgress)</span>
<a href="#l36.18"></a><span id="l36.18">       do_timeout(250, waitForNotInProgress);</span>
<a href="#l36.19"></a><span id="l36.19">     else</span>
<a href="#l36.20"></a><span id="l36.20">       async_driver();</span>
<a href="#l36.21"></a><span id="l36.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlinePlayback.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlinePlayback.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -59,17 +59,17 @@ var tests = [</span>
<a href="#l37.4"></a><span id="l37.4">     yield false;</span>
<a href="#l37.5"></a><span id="l37.5">   },</span>
<a href="#l37.6"></a><span id="l37.6">   function goOnline() {</span>
<a href="#l37.7"></a><span id="l37.7">     gOfflineManager = Cc[&quot;@mozilla.org/messenger/offline-manager;1&quot;]</span>
<a href="#l37.8"></a><span id="l37.8">                            .getService(Ci.nsIMsgOfflineManager);</span>
<a href="#l37.9"></a><span id="l37.9">     IMAPPump.daemon.closing = false;</span>
<a href="#l37.10"></a><span id="l37.10">     Services.io.offline = false;</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    IMAPPump.server.start(IMAP_PORT);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    IMAPPump.server.start();</span>
<a href="#l37.14"></a><span id="l37.14">     gOfflineManager.goOnline(false, true, null);</span>
<a href="#l37.15"></a><span id="l37.15">     do_timeout(2000, async_driver);</span>
<a href="#l37.16"></a><span id="l37.16">     yield false;</span>
<a href="#l37.17"></a><span id="l37.17">   },</span>
<a href="#l37.18"></a><span id="l37.18">   function updateSecondFolder() {</span>
<a href="#l37.19"></a><span id="l37.19">     if (gOfflineManager.inProgress)</span>
<a href="#l37.20"></a><span id="l37.20">       do_timeout(2000, updateSecondFolder);</span>
<a href="#l37.21"></a><span id="l37.21">     gSecondFolder.updateFolderWithListener(null, asyncUrlListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_starttlsFailure.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_starttlsFailure.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -23,17 +23,17 @@ var tests = [</span>
<a href="#l38.4"></a><span id="l38.4">   check_alert,</span>
<a href="#l38.5"></a><span id="l38.5">   teardown</span>
<a href="#l38.6"></a><span id="l38.6"> ];</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> function setup() {</span>
<a href="#l38.9"></a><span id="l38.9">   // set up IMAP fakeserver and incoming server</span>
<a href="#l38.10"></a><span id="l38.10">   IMAPPump.daemon = new imapDaemon();</span>
<a href="#l38.11"></a><span id="l38.11">   IMAPPump.server = makeServer(IMAPPump.daemon, &quot;&quot;, {dropOnStartTLS: true});</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  IMAPPump.incomingServer = createLocalIMAPServer();</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  IMAPPump.incomingServer = createLocalIMAPServer(IMAPPump.server.port);</span>
<a href="#l38.14"></a><span id="l38.14">   IMAPPump.incomingServer.socketType = Ci.nsMsgSocketType.alwaysSTARTTLS;</span>
<a href="#l38.15"></a><span id="l38.15"> </span>
<a href="#l38.16"></a><span id="l38.16">   // we need a local account for the IMAP server to have its sent messages in</span>
<a href="#l38.17"></a><span id="l38.17">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l38.20"></a><span id="l38.20">   let imapAccount = MailServices.accounts.createAccount();</span>
<a href="#l38.21"></a><span id="l38.21">   let identity = MailServices.accounts.createIdentity();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/imap/test/unit/xpcshell.ini</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/imap/test/unit/xpcshell.ini</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l39.4"></a><span id="l39.4"> [DEFAULT]</span>
<a href="#l39.5"></a><span id="l39.5"> head = head_server.js</span>
<a href="#l39.6"></a><span id="l39.6"> tail = tail_imap.js</span>
<a href="#l39.7"></a><span id="l39.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l39.8"></a><span id="l39.8"> </span>
<a href="#l39.9"></a><span id="l39.9"> [test_autosync_date_constraints.js]</span>
<a href="#l39.10"></a><span id="l39.10"> [test_bccProperty.js]</span>
<a href="#l39.11"></a><span id="l39.11"> [test_bug460636.js]</span>
<a href="#l39.12"></a><span id="l39.12"> [test_chunkLastLF.js]</span>
<a href="#l39.13"></a><span id="l39.13"> [test_compactOfflineStore.js]</span>
<a href="#l39.14"></a><span id="l39.14"> # Disabled until bug 870864 is resolved</span>
<a href="#l39.15"></a><span id="l39.15"> skip-if = true</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineat">@@ -29,16 +28,17 @@ skip-if = true</span>
<a href="#l39.17"></a><span id="l39.17"> skip-if = true</span>
<a href="#l39.18"></a><span id="l39.18"> [test_imapAutoSync.js]</span>
<a href="#l39.19"></a><span id="l39.19"> [test_imapChunks.js]</span>
<a href="#l39.20"></a><span id="l39.20"> [test_imapContentLength.js]</span>
<a href="#l39.21"></a><span id="l39.21"> [test_imapCopyTimeout.js]</span>
<a href="#l39.22"></a><span id="l39.22"> # Disabled until bug 870864 is resolved</span>
<a href="#l39.23"></a><span id="l39.23"> skip-if = true</span>
<a href="#l39.24"></a><span id="l39.24"> [test_imapFilterActions.js]</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineplus">+run-sequentially = failed once when run in parallel</span>
<a href="#l39.26"></a><span id="l39.26"> [test_imapFlagChange.js]</span>
<a href="#l39.27"></a><span id="l39.27"> [test_imapFolderCopy.js]</span>
<a href="#l39.28"></a><span id="l39.28"> [test_imapHdrChunking.js]</span>
<a href="#l39.29"></a><span id="l39.29"> # Disabled until bug 870864 is resolved</span>
<a href="#l39.30"></a><span id="l39.30"> skip-if = true</span>
<a href="#l39.31"></a><span id="l39.31"> [test_imapHdrStreaming.js]</span>
<a href="#l39.32"></a><span id="l39.32"> [test_imapHighWater.js]</span>
<a href="#l39.33"></a><span id="l39.33"> # Disabled until bug 870864 is resolved</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineat">@@ -63,17 +63,19 @@ skip-if = os == 'mac'</span>
<a href="#l39.35"></a><span id="l39.35"> # Disabled due to intermittent failures, bug 502928</span>
<a href="#l39.36"></a><span id="l39.36"> skip-if = true</span>
<a href="#l39.37"></a><span id="l39.37"> [test_localToImapFilterQuarantine.js]</span>
<a href="#l39.38"></a><span id="l39.38"> [test_lsub.js]</span>
<a href="#l39.39"></a><span id="l39.39"> [test_mailboxes.js]</span>
<a href="#l39.40"></a><span id="l39.40"> [test_nsIMsgFolderListenerIMAP.js]</span>
<a href="#l39.41"></a><span id="l39.41"> [test_offlineCopy.js]</span>
<a href="#l39.42"></a><span id="l39.42"> [test_offlineDraftDataloss.js]</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineplus">+run-sequentially = Starts server twice.</span>
<a href="#l39.44"></a><span id="l39.44"> [test_offlinePlayback.js]</span>
<a href="#l39.45"></a><span id="l39.45" class="difflineplus">+run-sequentially = Starts server twice.</span>
<a href="#l39.46"></a><span id="l39.46"> [test_offlineStoreLocking.js]</span>
<a href="#l39.47"></a><span id="l39.47"> # Doesn't currently work on Windows, bug 782625</span>
<a href="#l39.48"></a><span id="l39.48"> # Disabled until bug 870864 is resolved</span>
<a href="#l39.49"></a><span id="l39.49"> skip-if = true</span>
<a href="#l39.50"></a><span id="l39.50"> [test_partsOnDemand.js]</span>
<a href="#l39.51"></a><span id="l39.51"> [test_preserveDataOnMove.js]</span>
<a href="#l39.52"></a><span id="l39.52"> [test_saveImapDraft.js]</span>
<a href="#l39.53"></a><span id="l39.53"> [test_saveTemplate.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/local/test/unit/head_maillocal.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/local/test/unit/head_maillocal.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -16,18 +16,16 @@ var gDEPTH = &quot;../../../../&quot;;</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5"> // Import the pop3 server scripts</span>
<a href="#l40.6"></a><span id="l40.6"> Components.utils.import(&quot;resource://testing-common/mailnews/maild.js&quot;);</span>
<a href="#l40.7"></a><span id="l40.7"> Components.utils.import(&quot;resource://testing-common/mailnews/auth.js&quot;);</span>
<a href="#l40.8"></a><span id="l40.8"> Components.utils.import(&quot;resource://testing-common/mailnews/pop3d.js&quot;);</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-const POP3_PORT = 1024+110;</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-</span>
<a href="#l40.14"></a><span id="l40.14"> // Setup the daemon and server</span>
<a href="#l40.15"></a><span id="l40.15"> // If the debugOption is set, then it will be applied to the server.</span>
<a href="#l40.16"></a><span id="l40.16"> function setupServerDaemon(debugOption) {</span>
<a href="#l40.17"></a><span id="l40.17">   var daemon = new pop3Daemon();</span>
<a href="#l40.18"></a><span id="l40.18">   var extraProps = {};</span>
<a href="#l40.19"></a><span id="l40.19">   function createHandler(d) {</span>
<a href="#l40.20"></a><span id="l40.20">     var handler = new POP3_RFC5034_handler(d);</span>
<a href="#l40.21"></a><span id="l40.21">     for (var prop in extraProps) {</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -36,19 +34,19 @@ function setupServerDaemon(debugOption) </span>
<a href="#l40.23"></a><span id="l40.23">     return handler;</span>
<a href="#l40.24"></a><span id="l40.24">   }</span>
<a href="#l40.25"></a><span id="l40.25">   var server = new nsMailServer(createHandler, daemon);</span>
<a href="#l40.26"></a><span id="l40.26">   if (debugOption)</span>
<a href="#l40.27"></a><span id="l40.27">     server.setDebugLevel(debugOption);</span>
<a href="#l40.28"></a><span id="l40.28">   return [daemon, server, extraProps];</span>
<a href="#l40.29"></a><span id="l40.29"> }</span>
<a href="#l40.30"></a><span id="l40.30"> </span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-function createPop3ServerAndLocalFolders() {</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+function createPop3ServerAndLocalFolders(port) {</span>
<a href="#l40.33"></a><span id="l40.33">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineminus">-  let server = localAccountUtils.create_incoming_server(&quot;pop3&quot;, POP3_PORT,</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineplus">+  let server = localAccountUtils.create_incoming_server(&quot;pop3&quot;, port,</span>
<a href="#l40.36"></a><span id="l40.36"> 							&quot;fred&quot;, &quot;wilma&quot;);</span>
<a href="#l40.37"></a><span id="l40.37">   return server;</span>
<a href="#l40.38"></a><span id="l40.38"> }</span>
<a href="#l40.39"></a><span id="l40.39"> </span>
<a href="#l40.40"></a><span id="l40.40"> var gCopyListener =</span>
<a href="#l40.41"></a><span id="l40.41"> {</span>
<a href="#l40.42"></a><span id="l40.42">   callbackFunction: null,</span>
<a href="#l40.43"></a><span id="l40.43">   copiedMessageHeaderKeys: [],</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -4,17 +4,16 @@</span>
<a href="#l41.4"></a><span id="l41.4">  */</span>
<a href="#l41.5"></a><span id="l41.5"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7"> var type = null;</span>
<a href="#l41.8"></a><span id="l41.8"> var test = null;</span>
<a href="#l41.9"></a><span id="l41.9"> var server;</span>
<a href="#l41.10"></a><span id="l41.10"> var daemon;</span>
<a href="#l41.11"></a><span id="l41.11"> var incomingServer;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-var firstTest = true;</span>
<a href="#l41.13"></a><span id="l41.13"> var thisTest;</span>
<a href="#l41.14"></a><span id="l41.14"> </span>
<a href="#l41.15"></a><span id="l41.15"> var tests = [</span>
<a href="#l41.16"></a><span id="l41.16">   { title: &quot;Get New Mail, One Message&quot;,</span>
<a href="#l41.17"></a><span id="l41.17">     messages: [ &quot;message2.eml&quot;, &quot;message2.eml&quot;, &quot;message3.eml&quot; ],</span>
<a href="#l41.18"></a><span id="l41.18">     transaction: [ &quot;AUTH&quot;, &quot;CAPA&quot;, &quot;AUTH PLAIN&quot;, &quot;STAT&quot;, &quot;LIST&quot;, &quot;UIDL&quot;,</span>
<a href="#l41.19"></a><span id="l41.19">                    &quot;RETR 1&quot;, &quot;DELE 1&quot;, &quot;RETR 2&quot;, &quot;DELE 2&quot;, &quot;RETR 3&quot;, &quot;DELE 3&quot; ] }</span>
<a href="#l41.20"></a><span id="l41.20"> ];</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineat">@@ -77,24 +76,17 @@ function checkBusy() {</span>
<a href="#l41.22"></a><span id="l41.22"> }</span>
<a href="#l41.23"></a><span id="l41.23"> </span>
<a href="#l41.24"></a><span id="l41.24"> function testNext() {</span>
<a href="#l41.25"></a><span id="l41.25">   thisTest = tests.shift();</span>
<a href="#l41.26"></a><span id="l41.26"> </span>
<a href="#l41.27"></a><span id="l41.27">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l41.28"></a><span id="l41.28">   // the server if something fails.</span>
<a href="#l41.29"></a><span id="l41.29">   try {</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">-    if (firstTest) {</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-      firstTest = false;</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineminus">-</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">-      // Start the fake POP3 server</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineminus">-      server.start(POP3_PORT);</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineminus">-    }</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineminus">-    else</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineminus">-      server.resetTest();</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+    server.resetTest();</span>
<a href="#l41.39"></a><span id="l41.39"> </span>
<a href="#l41.40"></a><span id="l41.40">     // Set up the test</span>
<a href="#l41.41"></a><span id="l41.41">     test = thisTest.title;</span>
<a href="#l41.42"></a><span id="l41.42"> </span>
<a href="#l41.43"></a><span id="l41.43">     daemon.setMessages(thisTest.messages);</span>
<a href="#l41.44"></a><span id="l41.44"> </span>
<a href="#l41.45"></a><span id="l41.45">     // Now get the mail</span>
<a href="#l41.46"></a><span id="l41.46">     MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineat">@@ -118,21 +110,22 @@ function run_test() {</span>
<a href="#l41.48"></a><span id="l41.48">   Services.prefs.setBoolPref(&quot;mail.biff.show_alert&quot;, false);</span>
<a href="#l41.49"></a><span id="l41.49">   Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l41.50"></a><span id="l41.50">   Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l41.51"></a><span id="l41.51">   Services.prefs.setIntPref(&quot;mail.server.default.dup_action&quot;, 2);</span>
<a href="#l41.52"></a><span id="l41.52"> </span>
<a href="#l41.53"></a><span id="l41.53">   server = setupServerDaemon();</span>
<a href="#l41.54"></a><span id="l41.54">   daemon = server[0];</span>
<a href="#l41.55"></a><span id="l41.55">   server = server[1];</span>
<a href="#l41.56"></a><span id="l41.56" class="difflineplus">+  server.start();</span>
<a href="#l41.57"></a><span id="l41.57"> </span>
<a href="#l41.58"></a><span id="l41.58">   type = &quot;RFC 1939&quot;;</span>
<a href="#l41.59"></a><span id="l41.59"> </span>
<a href="#l41.60"></a><span id="l41.60">   // Set up the basic accounts and folders</span>
<a href="#l41.61"></a><span id="l41.61" class="difflineminus">-  incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineplus">+  incomingServer = createPop3ServerAndLocalFolders(server.port);</span>
<a href="#l41.63"></a><span id="l41.63"> </span>
<a href="#l41.64"></a><span id="l41.64">   // Create a cc filter</span>
<a href="#l41.65"></a><span id="l41.65">   var filters = incomingServer.getFilterList(null);</span>
<a href="#l41.66"></a><span id="l41.66"> </span>
<a href="#l41.67"></a><span id="l41.67">   var filter = filters.createFilter(&quot;cc dup test&quot;);</span>
<a href="#l41.68"></a><span id="l41.68">   filter.filterType = Ci.nsMsgFilterType.Incoming;</span>
<a href="#l41.69"></a><span id="l41.69">   var searchTerm = filter.createTerm();</span>
<a href="#l41.70"></a><span id="l41.70">   searchTerm.attrib = Ci.nsMsgSearchAttrib.CC;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3AuthMethods.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3AuthMethods.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -140,17 +140,17 @@ function testNext() {</span>
<a href="#l42.4"></a><span id="l42.4">     do_throw(e);</span>
<a href="#l42.5"></a><span id="l42.5">   }</span>
<a href="#l42.6"></a><span id="l42.6"> }</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8"> // &lt;copied from=&quot;head_maillocal.js::createPop3ServerAndLocalFolders()&quot;&gt;</span>
<a href="#l42.9"></a><span id="l42.9"> function createPop3Server()</span>
<a href="#l42.10"></a><span id="l42.10"> {</span>
<a href="#l42.11"></a><span id="l42.11">   let incoming = MailServices.accounts.createIncomingServer(&quot;fred&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  incoming.port = POP3_PORT;</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  incoming.port = server.port;</span>
<a href="#l42.14"></a><span id="l42.14">   incoming.password = &quot;wilma&quot;;</span>
<a href="#l42.15"></a><span id="l42.15">   return incoming;</span>
<a href="#l42.16"></a><span id="l42.16"> }</span>
<a href="#l42.17"></a><span id="l42.17"> //&lt;/copied&gt;</span>
<a href="#l42.18"></a><span id="l42.18"> </span>
<a href="#l42.19"></a><span id="l42.19"> function deletePop3Server()</span>
<a href="#l42.20"></a><span id="l42.20"> {</span>
<a href="#l42.21"></a><span id="l42.21">   if (!incomingServer)</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -165,17 +165,17 @@ function run_test() {</span>
<a href="#l42.23"></a><span id="l42.23">   Services.prefs.setBoolPref(&quot;mail.biff.show_alert&quot;, false);</span>
<a href="#l42.24"></a><span id="l42.24">   Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l42.25"></a><span id="l42.25">   Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l42.26"></a><span id="l42.26"> </span>
<a href="#l42.27"></a><span id="l42.27">   ssd = setupServerDaemon();</span>
<a href="#l42.28"></a><span id="l42.28">   daemon = ssd[0];</span>
<a href="#l42.29"></a><span id="l42.29">   server = ssd[1];</span>
<a href="#l42.30"></a><span id="l42.30">   handler = ssd[2];</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-  server.start(POP3_PORT);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+  server.start();</span>
<a href="#l42.33"></a><span id="l42.33"> </span>
<a href="#l42.34"></a><span id="l42.34">   //incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l42.35"></a><span id="l42.35">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l42.36"></a><span id="l42.36"> </span>
<a href="#l42.37"></a><span id="l42.37">   do_test_pending();</span>
<a href="#l42.38"></a><span id="l42.38"> </span>
<a href="#l42.39"></a><span id="l42.39">   testNext();</span>
<a href="#l42.40"></a><span id="l42.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GSSAPIFail.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GSSAPIFail.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -137,17 +137,17 @@ function testNext() {</span>
<a href="#l43.4"></a><span id="l43.4">     do_throw(e);</span>
<a href="#l43.5"></a><span id="l43.5">   }</span>
<a href="#l43.6"></a><span id="l43.6"> }</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8"> // &lt;copied from=&quot;head_maillocal.js::createPop3ServerAndLocalFolders()&quot;&gt;</span>
<a href="#l43.9"></a><span id="l43.9"> function createPop3Server()</span>
<a href="#l43.10"></a><span id="l43.10"> {</span>
<a href="#l43.11"></a><span id="l43.11">   let incoming = MailServices.accounts.createIncomingServer(&quot;fred&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  incoming.port = POP3_PORT;</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  incoming.port = server.port;</span>
<a href="#l43.14"></a><span id="l43.14">   incoming.password = &quot;wilma&quot;;</span>
<a href="#l43.15"></a><span id="l43.15">   return incoming;</span>
<a href="#l43.16"></a><span id="l43.16"> }</span>
<a href="#l43.17"></a><span id="l43.17"> //&lt;/copied&gt;</span>
<a href="#l43.18"></a><span id="l43.18"> </span>
<a href="#l43.19"></a><span id="l43.19"> function deletePop3Server()</span>
<a href="#l43.20"></a><span id="l43.20"> {</span>
<a href="#l43.21"></a><span id="l43.21">   if (!incomingServer)</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -198,17 +198,17 @@ function run_test() {</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24">   daemon = new pop3Daemon();</span>
<a href="#l43.25"></a><span id="l43.25">   function createHandler(d) {</span>
<a href="#l43.26"></a><span id="l43.26">     var handler = new GSSAPIFail_handler(d);</span>
<a href="#l43.27"></a><span id="l43.27">     handler.kAuthSchemes = authSchemes;</span>
<a href="#l43.28"></a><span id="l43.28">     return handler;</span>
<a href="#l43.29"></a><span id="l43.29">   }</span>
<a href="#l43.30"></a><span id="l43.30">   server = new nsMailServer(createHandler, daemon);</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-  server.start(POP3_PORT);</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+  server.start();</span>
<a href="#l43.33"></a><span id="l43.33"> </span>
<a href="#l43.34"></a><span id="l43.34">   //incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l43.35"></a><span id="l43.35">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l43.36"></a><span id="l43.36"> </span>
<a href="#l43.37"></a><span id="l43.37">   do_test_pending();</span>
<a href="#l43.38"></a><span id="l43.38"> </span>
<a href="#l43.39"></a><span id="l43.39">   testNext();</span>
<a href="#l43.40"></a><span id="l43.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l44.4"></a><span id="l44.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l44.5"></a><span id="l44.5"> /**</span>
<a href="#l44.6"></a><span id="l44.6">  * Protocol tests for POP3.</span>
<a href="#l44.7"></a><span id="l44.7">  */</span>
<a href="#l44.8"></a><span id="l44.8"> var test = null;</span>
<a href="#l44.9"></a><span id="l44.9"> var server;</span>
<a href="#l44.10"></a><span id="l44.10"> var daemon;</span>
<a href="#l44.11"></a><span id="l44.11"> var incomingServer;</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-var firstTest = true;</span>
<a href="#l44.13"></a><span id="l44.13"> var thisTest;</span>
<a href="#l44.14"></a><span id="l44.14"> </span>
<a href="#l44.15"></a><span id="l44.15"> var tests = [</span>
<a href="#l44.16"></a><span id="l44.16">   { title: &quot;Get New Mail, No Messages&quot;,</span>
<a href="#l44.17"></a><span id="l44.17">     messages: [],</span>
<a href="#l44.18"></a><span id="l44.18">     transaction: [ &quot;AUTH&quot;, &quot;CAPA&quot;, &quot;AUTH PLAIN&quot;, &quot;STAT&quot; ] },</span>
<a href="#l44.19"></a><span id="l44.19">   { title: &quot;Get New Mail, No Messages 2&quot;,</span>
<a href="#l44.20"></a><span id="l44.20">     messages: [],</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineat">@@ -80,24 +79,17 @@ function checkBusy() {</span>
<a href="#l44.22"></a><span id="l44.22"> }</span>
<a href="#l44.23"></a><span id="l44.23"> </span>
<a href="#l44.24"></a><span id="l44.24"> function testNext() {</span>
<a href="#l44.25"></a><span id="l44.25">   thisTest = tests.shift();</span>
<a href="#l44.26"></a><span id="l44.26"> </span>
<a href="#l44.27"></a><span id="l44.27">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l44.28"></a><span id="l44.28">   // the server if something fails.</span>
<a href="#l44.29"></a><span id="l44.29">   try {</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineminus">-    if (firstTest) {</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-      firstTest = false;</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">-</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineminus">-      // Start the fake POP3 server</span>
<a href="#l44.34"></a><span id="l44.34" class="difflineminus">-      server.start(POP3_PORT);</span>
<a href="#l44.35"></a><span id="l44.35" class="difflineminus">-    }</span>
<a href="#l44.36"></a><span id="l44.36" class="difflineminus">-    else</span>
<a href="#l44.37"></a><span id="l44.37" class="difflineminus">-      server.resetTest();</span>
<a href="#l44.38"></a><span id="l44.38" class="difflineplus">+    server.resetTest();</span>
<a href="#l44.39"></a><span id="l44.39"> </span>
<a href="#l44.40"></a><span id="l44.40">     // Set up the test</span>
<a href="#l44.41"></a><span id="l44.41">     test = thisTest.title;</span>
<a href="#l44.42"></a><span id="l44.42">     daemon.setMessages(thisTest.messages);</span>
<a href="#l44.43"></a><span id="l44.43"> </span>
<a href="#l44.44"></a><span id="l44.44">     // Now get the mail</span>
<a href="#l44.45"></a><span id="l44.45">     MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l44.46"></a><span id="l44.46">                                  incomingServer);</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineat">@@ -119,19 +111,20 @@ function run_test() {</span>
<a href="#l44.48"></a><span id="l44.48">   Services.prefs.setBoolPref(&quot;mail.biff.play_sound&quot;, false);</span>
<a href="#l44.49"></a><span id="l44.49">   Services.prefs.setBoolPref(&quot;mail.biff.show_alert&quot;, false);</span>
<a href="#l44.50"></a><span id="l44.50">   Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l44.51"></a><span id="l44.51">   Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l44.52"></a><span id="l44.52"> </span>
<a href="#l44.53"></a><span id="l44.53">   server = setupServerDaemon();</span>
<a href="#l44.54"></a><span id="l44.54">   daemon = server[0];</span>
<a href="#l44.55"></a><span id="l44.55">   server = server[1];</span>
<a href="#l44.56"></a><span id="l44.56" class="difflineplus">+  server.start();</span>
<a href="#l44.57"></a><span id="l44.57"> </span>
<a href="#l44.58"></a><span id="l44.58">   // Set up the basic accounts and folders</span>
<a href="#l44.59"></a><span id="l44.59" class="difflineminus">-  incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineplus">+  incomingServer = createPop3ServerAndLocalFolders(server.port);</span>
<a href="#l44.61"></a><span id="l44.61"> </span>
<a href="#l44.62"></a><span id="l44.62">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l44.63"></a><span id="l44.63">   // setup issue.</span>
<a href="#l44.64"></a><span id="l44.64">   do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l44.65"></a><span id="l44.65"> </span>
<a href="#l44.66"></a><span id="l44.66">   do_test_pending();</span>
<a href="#l44.67"></a><span id="l44.67"> </span>
<a href="#l44.68"></a><span id="l44.68">   testNext();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -6,17 +6,16 @@</span>
<a href="#l45.4"></a><span id="l45.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6"> load(&quot;../../../resources/passwordStorage.js&quot;);</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8"> var test = null;</span>
<a href="#l45.9"></a><span id="l45.9"> var server;</span>
<a href="#l45.10"></a><span id="l45.10"> var daemon;</span>
<a href="#l45.11"></a><span id="l45.11"> var incomingServer;</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-var firstTest = true;</span>
<a href="#l45.13"></a><span id="l45.13"> var thisTest;</span>
<a href="#l45.14"></a><span id="l45.14"> </span>
<a href="#l45.15"></a><span id="l45.15"> var tests = [</span>
<a href="#l45.16"></a><span id="l45.16">   { title: &quot;Get New Mail, One Message&quot;,</span>
<a href="#l45.17"></a><span id="l45.17">     messages: [&quot;message1.eml&quot;],</span>
<a href="#l45.18"></a><span id="l45.18">     transaction: [ &quot;AUTH&quot;, &quot;CAPA&quot;, &quot;AUTH PLAIN&quot;, &quot;STAT&quot;, &quot;LIST&quot;,</span>
<a href="#l45.19"></a><span id="l45.19">                    &quot;UIDL&quot;, &quot;RETR 1&quot;, &quot;DELE 1&quot; ] }</span>
<a href="#l45.20"></a><span id="l45.20"> ];</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineat">@@ -79,24 +78,17 @@ function checkBusy() {</span>
<a href="#l45.22"></a><span id="l45.22"> }</span>
<a href="#l45.23"></a><span id="l45.23"> </span>
<a href="#l45.24"></a><span id="l45.24"> function testNext() {</span>
<a href="#l45.25"></a><span id="l45.25">   thisTest = tests.shift();</span>
<a href="#l45.26"></a><span id="l45.26"> </span>
<a href="#l45.27"></a><span id="l45.27">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l45.28"></a><span id="l45.28">   // the server if something fails.</span>
<a href="#l45.29"></a><span id="l45.29">   try {</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineminus">-    if (firstTest) {</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-      firstTest = false;</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">-</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">-      // Start the fake POP3 server</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineminus">-      server.start(POP3_PORT);</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineminus">-    }</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineminus">-    else</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineminus">-      server.resetTest();</span>
<a href="#l45.38"></a><span id="l45.38" class="difflineplus">+    server.resetTest();</span>
<a href="#l45.39"></a><span id="l45.39"> </span>
<a href="#l45.40"></a><span id="l45.40">     // Set up the test</span>
<a href="#l45.41"></a><span id="l45.41">     test = thisTest.title;</span>
<a href="#l45.42"></a><span id="l45.42">     daemon.setMessages(thisTest.messages);</span>
<a href="#l45.43"></a><span id="l45.43"> </span>
<a href="#l45.44"></a><span id="l45.44">     // Now get the mail</span>
<a href="#l45.45"></a><span id="l45.45">     MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l45.46"></a><span id="l45.46">                                  incomingServer);</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineat">@@ -122,31 +114,32 @@ function run_test() {</span>
<a href="#l45.48"></a><span id="l45.48"> </span>
<a href="#l45.49"></a><span id="l45.49">   // Prepare files for passwords (generated by a script in bug 925489).</span>
<a href="#l45.50"></a><span id="l45.50">   setupForPassword(&quot;signons-mailnews1.8.sqlite&quot;)</span>
<a href="#l45.51"></a><span id="l45.51"> </span>
<a href="#l45.52"></a><span id="l45.52">   // Set up the Server</span>
<a href="#l45.53"></a><span id="l45.53">   var serverArray = setupServerDaemon();</span>
<a href="#l45.54"></a><span id="l45.54">   daemon = serverArray[0];</span>
<a href="#l45.55"></a><span id="l45.55">   server = serverArray[1];</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineminus">-  var handler = serverArray[2]</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineplus">+  var handler = serverArray[2];</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineplus">+  server.start();</span>
<a href="#l45.59"></a><span id="l45.59"> </span>
<a href="#l45.60"></a><span id="l45.60">   // Set the server expected username &amp; password to what we have in signons.txt</span>
<a href="#l45.61"></a><span id="l45.61">   handler.kUsername = &quot;testpop3&quot;;</span>
<a href="#l45.62"></a><span id="l45.62">   handler.kPassword = &quot;pop3test&quot;;</span>
<a href="#l45.63"></a><span id="l45.63"> </span>
<a href="#l45.64"></a><span id="l45.64">   // Set up the basic accounts and folders.</span>
<a href="#l45.65"></a><span id="l45.65">   // We would use createPop3ServerAndLocalFolders() however we want to have</span>
<a href="#l45.66"></a><span id="l45.66">   // a different username and NO password for this test (as we expect to load</span>
<a href="#l45.67"></a><span id="l45.67">   // it from signons.txt).</span>
<a href="#l45.68"></a><span id="l45.68">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l45.69"></a><span id="l45.69"> </span>
<a href="#l45.70"></a><span id="l45.70">   incomingServer = MailServices.accounts.createIncomingServer(&quot;testpop3&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l45.71"></a><span id="l45.71"> </span>
<a href="#l45.72"></a><span id="l45.72" class="difflineminus">-  incomingServer.port = POP3_PORT;</span>
<a href="#l45.73"></a><span id="l45.73" class="difflineplus">+  incomingServer.port = server.port;</span>
<a href="#l45.74"></a><span id="l45.74"> </span>
<a href="#l45.75"></a><span id="l45.75">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l45.76"></a><span id="l45.76">   // setup issue.</span>
<a href="#l45.77"></a><span id="l45.77">   do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l45.78"></a><span id="l45.78"> </span>
<a href="#l45.79"></a><span id="l45.79">   do_test_pending();</span>
<a href="#l45.80"></a><span id="l45.80"> </span>
<a href="#l45.81"></a><span id="l45.81">   testNext();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -8,17 +8,16 @@</span>
<a href="#l46.4"></a><span id="l46.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l46.5"></a><span id="l46.5"> </span>
<a href="#l46.6"></a><span id="l46.6"> load(&quot;../../../resources/passwordStorage.js&quot;);</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> var test = null;</span>
<a href="#l46.9"></a><span id="l46.9"> var server;</span>
<a href="#l46.10"></a><span id="l46.10"> var daemon;</span>
<a href="#l46.11"></a><span id="l46.11"> var incomingServer;</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-var firstTest = true;</span>
<a href="#l46.13"></a><span id="l46.13"> var thisTest;</span>
<a href="#l46.14"></a><span id="l46.14"> </span>
<a href="#l46.15"></a><span id="l46.15"> var tests = [</span>
<a href="#l46.16"></a><span id="l46.16">   { title: &quot;Get New Mail, One Message&quot;,</span>
<a href="#l46.17"></a><span id="l46.17">     messages: [&quot;message1.eml&quot;],</span>
<a href="#l46.18"></a><span id="l46.18">     transaction: [ &quot;AUTH&quot;, &quot;CAPA&quot;, &quot;AUTH PLAIN&quot;, &quot;STAT&quot;, &quot;LIST&quot;,</span>
<a href="#l46.19"></a><span id="l46.19">                    &quot;UIDL&quot;, &quot;RETR 1&quot;, &quot;DELE 1&quot; ] }</span>
<a href="#l46.20"></a><span id="l46.20"> ];</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineat">@@ -81,24 +80,17 @@ function checkBusy() {</span>
<a href="#l46.22"></a><span id="l46.22"> }</span>
<a href="#l46.23"></a><span id="l46.23"> </span>
<a href="#l46.24"></a><span id="l46.24"> function testNext() {</span>
<a href="#l46.25"></a><span id="l46.25">   thisTest = tests.shift();</span>
<a href="#l46.26"></a><span id="l46.26"> </span>
<a href="#l46.27"></a><span id="l46.27">   // Handle the server in a try/catch/finally loop so that we always will stop</span>
<a href="#l46.28"></a><span id="l46.28">   // the server if something fails.</span>
<a href="#l46.29"></a><span id="l46.29">   try {</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-    if (firstTest) {</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-      firstTest = false;</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineminus">-</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineminus">-      // Start the fake POP3 server</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineminus">-      server.start(POP3_PORT);</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineminus">-    }</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineminus">-    else</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineminus">-      server.resetTest();</span>
<a href="#l46.38"></a><span id="l46.38" class="difflineplus">+    server.resetTest();</span>
<a href="#l46.39"></a><span id="l46.39"> </span>
<a href="#l46.40"></a><span id="l46.40">     // Set up the test</span>
<a href="#l46.41"></a><span id="l46.41">     test = thisTest.title;</span>
<a href="#l46.42"></a><span id="l46.42">     daemon.setMessages(thisTest.messages);</span>
<a href="#l46.43"></a><span id="l46.43"> </span>
<a href="#l46.44"></a><span id="l46.44">     // Now get the mail</span>
<a href="#l46.45"></a><span id="l46.45">     MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l46.46"></a><span id="l46.46">                                  incomingServer);</span>
<a href="#l46.47"></a><span id="l46.47" class="difflineat">@@ -138,30 +130,31 @@ function run_test() {</span>
<a href="#l46.48"></a><span id="l46.48">   Services.prefs.setCharPref(&quot;mail.server.server1.directory-rel&quot;, &quot;[ProfD]Mail/Local Folders&quot;);</span>
<a href="#l46.49"></a><span id="l46.49">   Services.prefs.setCharPref(&quot;mail.server.server1.hostname&quot;, &quot;Local Folders&quot;);</span>
<a href="#l46.50"></a><span id="l46.50">   Services.prefs.setCharPref(&quot;mail.server.server1.name&quot;, &quot;Local Folders&quot;);</span>
<a href="#l46.51"></a><span id="l46.51">   Services.prefs.setCharPref(&quot;mail.server.server1.type&quot;, &quot;none&quot;);</span>
<a href="#l46.52"></a><span id="l46.52">   Services.prefs.setCharPref(&quot;mail.server.server1.userName&quot;, &quot;nobody&quot;);</span>
<a href="#l46.53"></a><span id="l46.53">   Services.prefs.setCharPref(&quot;mail.server.server2.directory-rel&quot;, &quot;[ProfD]Mail/invalid&quot;);</span>
<a href="#l46.54"></a><span id="l46.54">   Services.prefs.setCharPref(&quot;mail.server.server2.hostname&quot;, &quot;invalid&quot;);</span>
<a href="#l46.55"></a><span id="l46.55">   Services.prefs.setCharPref(&quot;mail.server.server2.name&quot;, &quot;testpop3 on localhost&quot;);</span>
<a href="#l46.56"></a><span id="l46.56" class="difflineminus">-  Services.prefs.setIntPref(&quot;mail.server.server2.port&quot;, 1134);</span>
<a href="#l46.57"></a><span id="l46.57">   Services.prefs.setCharPref(&quot;mail.server.server2.realhostname&quot;, &quot;localhost&quot;);</span>
<a href="#l46.58"></a><span id="l46.58">   Services.prefs.setCharPref(&quot;mail.server.server2.realuserName&quot;, &quot;testpop3&quot;);</span>
<a href="#l46.59"></a><span id="l46.59">   Services.prefs.setCharPref(&quot;mail.server.server2.type&quot;, &quot;pop3&quot;);</span>
<a href="#l46.60"></a><span id="l46.60">   Services.prefs.setCharPref(&quot;mail.server.server2.userName&quot;, &quot;othername&quot;);</span>
<a href="#l46.61"></a><span id="l46.61"> </span>
<a href="#l46.62"></a><span id="l46.62">   // Prepare files for passwords (generated by a script in bug 925489).</span>
<a href="#l46.63"></a><span id="l46.63">   setupForPassword(&quot;signons-mailnews1.8-alt.sqlite&quot;)</span>
<a href="#l46.64"></a><span id="l46.64"> </span>
<a href="#l46.65"></a><span id="l46.65">   // Set up the Server</span>
<a href="#l46.66"></a><span id="l46.66">   var serverArray = setupServerDaemon();</span>
<a href="#l46.67"></a><span id="l46.67">   daemon = serverArray[0];</span>
<a href="#l46.68"></a><span id="l46.68">   server = serverArray[1];</span>
<a href="#l46.69"></a><span id="l46.69">   var handler = serverArray[2];</span>
<a href="#l46.70"></a><span id="l46.70" class="difflineplus">+  server.start();</span>
<a href="#l46.71"></a><span id="l46.71" class="difflineplus">+  Services.prefs.setIntPref(&quot;mail.server.server2.port&quot;, server.port);</span>
<a href="#l46.72"></a><span id="l46.72"> </span>
<a href="#l46.73"></a><span id="l46.73">   // Set the server expected username &amp; password to what we have in signons.txt</span>
<a href="#l46.74"></a><span id="l46.74">   handler.kUsername = &quot;testpop3&quot;;</span>
<a href="#l46.75"></a><span id="l46.75">   handler.kPassword = &quot;pop3test&quot;;</span>
<a href="#l46.76"></a><span id="l46.76"> </span>
<a href="#l46.77"></a><span id="l46.77">   MailServices.accounts.LoadAccounts();</span>
<a href="#l46.78"></a><span id="l46.78"> </span>
<a href="#l46.79"></a><span id="l46.79">   localAccountUtils.incomingServer = MailServices.accounts.localFoldersServer;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -103,17 +103,16 @@ var urlListener =</span>
<a href="#l47.4"></a><span id="l47.4">         thread.processNextEvent(true);</span>
<a href="#l47.5"></a><span id="l47.5"> </span>
<a href="#l47.6"></a><span id="l47.6">       do_throw(e);</span>
<a href="#l47.7"></a><span id="l47.7">     }</span>
<a href="#l47.8"></a><span id="l47.8">   }</span>
<a href="#l47.9"></a><span id="l47.9"> };</span>
<a href="#l47.10"></a><span id="l47.10"> </span>
<a href="#l47.11"></a><span id="l47.11"> function actually_run_test() {</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  server.start(POP3_PORT);</span>
<a href="#l47.13"></a><span id="l47.13">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l47.14"></a><span id="l47.14"> </span>
<a href="#l47.15"></a><span id="l47.15">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l47.16"></a><span id="l47.16"> </span>
<a href="#l47.17"></a><span id="l47.17">   // Now get mail</span>
<a href="#l47.18"></a><span id="l47.18">   getPopMail();</span>
<a href="#l47.19"></a><span id="l47.19"> </span>
<a href="#l47.20"></a><span id="l47.20">   dump(&quot;\nGot Mail 1\n&quot;);</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineat">@@ -163,30 +162,31 @@ function run_test()</span>
<a href="#l47.22"></a><span id="l47.22"> </span>
<a href="#l47.23"></a><span id="l47.23">   registerAlertTestUtils();</span>
<a href="#l47.24"></a><span id="l47.24"> </span>
<a href="#l47.25"></a><span id="l47.25">   // Set up the Server</span>
<a href="#l47.26"></a><span id="l47.26">   var serverArray = setupServerDaemon();</span>
<a href="#l47.27"></a><span id="l47.27">   daemon = serverArray[0];</span>
<a href="#l47.28"></a><span id="l47.28">   server = serverArray[1];</span>
<a href="#l47.29"></a><span id="l47.29">   var handler = serverArray[2];</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineplus">+  server.start();</span>
<a href="#l47.31"></a><span id="l47.31"> </span>
<a href="#l47.32"></a><span id="l47.32">   // Set the server expected username &amp; password to what we have in signons.txt</span>
<a href="#l47.33"></a><span id="l47.33">   handler.kUsername = kUserName;</span>
<a href="#l47.34"></a><span id="l47.34">   handler.kPassword = kValidPassword;</span>
<a href="#l47.35"></a><span id="l47.35"> </span>
<a href="#l47.36"></a><span id="l47.36">   // Set up the basic accounts and folders.</span>
<a href="#l47.37"></a><span id="l47.37">   // We would use createPop3ServerAndLocalFolders() however we want to have</span>
<a href="#l47.38"></a><span id="l47.38">   // a different username and NO password for this test (as we expect to load</span>
<a href="#l47.39"></a><span id="l47.39">   // it from signons.txt).</span>
<a href="#l47.40"></a><span id="l47.40">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l47.41"></a><span id="l47.41"> </span>
<a href="#l47.42"></a><span id="l47.42">   incomingServer = MailServices.accounts.createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l47.43"></a><span id="l47.43"> </span>
<a href="#l47.44"></a><span id="l47.44" class="difflineminus">-  incomingServer.port = POP3_PORT;</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineplus">+  incomingServer.port = server.port;</span>
<a href="#l47.46"></a><span id="l47.46"> </span>
<a href="#l47.47"></a><span id="l47.47">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l47.48"></a><span id="l47.48">   // setup issue.</span>
<a href="#l47.49"></a><span id="l47.49">   do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l47.50"></a><span id="l47.50"> </span>
<a href="#l47.51"></a><span id="l47.51">   do_test_pending();</span>
<a href="#l47.52"></a><span id="l47.52"> </span>
<a href="#l47.53"></a><span id="l47.53">   actually_run_test();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -111,17 +111,16 @@ var urlListener =</span>
<a href="#l48.4"></a><span id="l48.4"> // Definition of tests</span>
<a href="#l48.5"></a><span id="l48.5"> var tests = [</span>
<a href="#l48.6"></a><span id="l48.6">   getMail1,</span>
<a href="#l48.7"></a><span id="l48.7">   getMail2,</span>
<a href="#l48.8"></a><span id="l48.8">   endTest</span>
<a href="#l48.9"></a><span id="l48.9"> ]</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11"> function actually_run_test() {</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  server.start(POP3_PORT);</span>
<a href="#l48.13"></a><span id="l48.13">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l48.14"></a><span id="l48.14">   async_run_tests(tests);</span>
<a href="#l48.15"></a><span id="l48.15"> }</span>
<a href="#l48.16"></a><span id="l48.16"> </span>
<a href="#l48.17"></a><span id="l48.17"> function getMail1() {</span>
<a href="#l48.18"></a><span id="l48.18">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l48.19"></a><span id="l48.19"> </span>
<a href="#l48.20"></a><span id="l48.20">   // Now get mail</span>
<a href="#l48.21"></a><span id="l48.21" class="difflineat">@@ -185,25 +184,26 @@ function run_test()</span>
<a href="#l48.22"></a><span id="l48.22">     handler.dropOnAuthFailure = true;</span>
<a href="#l48.23"></a><span id="l48.23"> </span>
<a href="#l48.24"></a><span id="l48.24">     // Set the server expected username &amp; password to what we have in signons.txt</span>
<a href="#l48.25"></a><span id="l48.25">     handler.kUsername = kUserName;</span>
<a href="#l48.26"></a><span id="l48.26">     handler.kPassword = kValidPassword;</span>
<a href="#l48.27"></a><span id="l48.27">     return handler;</span>
<a href="#l48.28"></a><span id="l48.28">   }</span>
<a href="#l48.29"></a><span id="l48.29">   server = new nsMailServer(createHandler, daemon);</span>
<a href="#l48.30"></a><span id="l48.30" class="difflineplus">+  server.start();</span>
<a href="#l48.31"></a><span id="l48.31"> </span>
<a href="#l48.32"></a><span id="l48.32">   // Set up the basic accounts and folders.</span>
<a href="#l48.33"></a><span id="l48.33">   // We would use createPop3ServerAndLocalFolders() however we want to have</span>
<a href="#l48.34"></a><span id="l48.34">   // a different username and NO password for this test (as we expect to load</span>
<a href="#l48.35"></a><span id="l48.35">   // it from signons.txt).</span>
<a href="#l48.36"></a><span id="l48.36">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l48.37"></a><span id="l48.37"> </span>
<a href="#l48.38"></a><span id="l48.38">   incomingServer = MailServices.accounts</span>
<a href="#l48.39"></a><span id="l48.39">                     .createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l48.40"></a><span id="l48.40" class="difflineminus">-  incomingServer.port = POP3_PORT;</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineplus">+  incomingServer.port = server.port;</span>
<a href="#l48.42"></a><span id="l48.42"> </span>
<a href="#l48.43"></a><span id="l48.43">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l48.44"></a><span id="l48.44">   // setup issue.</span>
<a href="#l48.45"></a><span id="l48.45">   do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l48.46"></a><span id="l48.46"> </span>
<a href="#l48.47"></a><span id="l48.47">   actually_run_test();</span>
<a href="#l48.48"></a><span id="l48.48"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -113,17 +113,16 @@ var urlListener =</span>
<a href="#l49.4"></a><span id="l49.4"> // Definition of tests</span>
<a href="#l49.5"></a><span id="l49.5"> var tests = [</span>
<a href="#l49.6"></a><span id="l49.6">   getMail1,</span>
<a href="#l49.7"></a><span id="l49.7">   getMail2,</span>
<a href="#l49.8"></a><span id="l49.8">   endTest</span>
<a href="#l49.9"></a><span id="l49.9"> ]</span>
<a href="#l49.10"></a><span id="l49.10"> </span>
<a href="#l49.11"></a><span id="l49.11"> function actually_run_test() {</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  server.start(POP3_PORT);</span>
<a href="#l49.13"></a><span id="l49.13">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l49.14"></a><span id="l49.14">   async_run_tests(tests);</span>
<a href="#l49.15"></a><span id="l49.15"> }</span>
<a href="#l49.16"></a><span id="l49.16"> </span>
<a href="#l49.17"></a><span id="l49.17"> function getMail1() {</span>
<a href="#l49.18"></a><span id="l49.18">   dump(&quot;\nGet Mail 1\n&quot;);</span>
<a href="#l49.19"></a><span id="l49.19"> </span>
<a href="#l49.20"></a><span id="l49.20">   // Now get mail</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineat">@@ -186,26 +185,26 @@ function run_test()</span>
<a href="#l49.22"></a><span id="l49.22">     var handler = new POP3_RFC5034_handler(d);</span>
<a href="#l49.23"></a><span id="l49.23">     handler.dropOnAuthFailure = true;</span>
<a href="#l49.24"></a><span id="l49.24">     // Set the server expected username &amp; password to what we have in signons.txt</span>
<a href="#l49.25"></a><span id="l49.25">     handler.kUsername = kUserName;</span>
<a href="#l49.26"></a><span id="l49.26">     handler.kPassword = kValidPassword;</span>
<a href="#l49.27"></a><span id="l49.27">     return handler;</span>
<a href="#l49.28"></a><span id="l49.28">   }</span>
<a href="#l49.29"></a><span id="l49.29">   server = new nsMailServer(createHandler, daemon);</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineplus">+  server.start();</span>
<a href="#l49.32"></a><span id="l49.32"> </span>
<a href="#l49.33"></a><span id="l49.33">   // Set up the basic accounts and folders.</span>
<a href="#l49.34"></a><span id="l49.34">   // We would use createPop3ServerAndLocalFolders() however we want to have</span>
<a href="#l49.35"></a><span id="l49.35">   // a different username and NO password for this test (as we expect to load</span>
<a href="#l49.36"></a><span id="l49.36">   // it from signons.txt).</span>
<a href="#l49.37"></a><span id="l49.37">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l49.38"></a><span id="l49.38"> </span>
<a href="#l49.39"></a><span id="l49.39">   incomingServer = MailServices.accounts</span>
<a href="#l49.40"></a><span id="l49.40">                     .createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineminus">-  incomingServer.port = POP3_PORT;</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineplus">+  incomingServer.port = server.port;</span>
<a href="#l49.43"></a><span id="l49.43"> </span>
<a href="#l49.44"></a><span id="l49.44">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l49.45"></a><span id="l49.45">   // setup issue.</span>
<a href="#l49.46"></a><span id="l49.46">   do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l49.47"></a><span id="l49.47"> </span>
<a href="#l49.48"></a><span id="l49.48">   actually_run_test();</span>
<a href="#l49.49"></a><span id="l49.49"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -95,19 +95,19 @@ function run_test() {</span>
<a href="#l50.4"></a><span id="l50.4">     Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l50.5"></a><span id="l50.5">     Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l50.6"></a><span id="l50.6"> </span>
<a href="#l50.7"></a><span id="l50.7">     daemon = new pop3Daemon();</span>
<a href="#l50.8"></a><span id="l50.8">     function createHandler(d) {</span>
<a href="#l50.9"></a><span id="l50.9">       return new CRAMFail_handler(d);</span>
<a href="#l50.10"></a><span id="l50.10">     }</span>
<a href="#l50.11"></a><span id="l50.11">     server = new nsMailServer(createHandler, daemon);</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    server.start(POP3_PORT);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    server.start();</span>
<a href="#l50.14"></a><span id="l50.14"> </span>
<a href="#l50.15"></a><span id="l50.15" class="difflineminus">-    incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineplus">+    incomingServer = createPop3ServerAndLocalFolders(server.port);</span>
<a href="#l50.17"></a><span id="l50.17">     let msgServer = incomingServer;</span>
<a href="#l50.18"></a><span id="l50.18">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l50.19"></a><span id="l50.19">     // Need to allow any auth here, although that's not use in TB really,</span>
<a href="#l50.20"></a><span id="l50.20">     // because we need to fall back to something after CRAM-MD5 and</span>
<a href="#l50.21"></a><span id="l50.21">     // check that login works after we fell back.</span>
<a href="#l50.22"></a><span id="l50.22">     msgServer.authMethod = Ci.nsMsgAuthMethod.anything;</span>
<a href="#l50.23"></a><span id="l50.23"> </span>
<a href="#l50.24"></a><span id="l50.24">     MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -86,19 +86,19 @@ function run_test() {</span>
<a href="#l51.4"></a><span id="l51.4">     Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span>
<a href="#l51.5"></a><span id="l51.5">     Services.prefs.setBoolPref(&quot;mail.biff.animate_dock_icon&quot;, false);</span>
<a href="#l51.6"></a><span id="l51.6"> </span>
<a href="#l51.7"></a><span id="l51.7">     daemon = new pop3Daemon();</span>
<a href="#l51.8"></a><span id="l51.8">     function createHandler(d) {</span>
<a href="#l51.9"></a><span id="l51.9">       return new CRAMFail_handler(d);</span>
<a href="#l51.10"></a><span id="l51.10">     }</span>
<a href="#l51.11"></a><span id="l51.11">     server = new nsMailServer(createHandler, daemon);</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    server.start(POP3_PORT);</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    server.start();</span>
<a href="#l51.14"></a><span id="l51.14"> </span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-    incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineplus">+    incomingServer = createPop3ServerAndLocalFolders(server.port);</span>
<a href="#l51.17"></a><span id="l51.17">     let msgServer = incomingServer;</span>
<a href="#l51.18"></a><span id="l51.18">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l51.19"></a><span id="l51.19">     // Need to allow any auth here, although that's not use in TB really,</span>
<a href="#l51.20"></a><span id="l51.20">     // because we need to fall back to something after CRAM-MD5 and</span>
<a href="#l51.21"></a><span id="l51.21">     // check that login works after we fell back.</span>
<a href="#l51.22"></a><span id="l51.22">     msgServer.authMethod = Ci.nsMsgAuthMethod.anything;</span>
<a href="#l51.23"></a><span id="l51.23"> </span>
<a href="#l51.24"></a><span id="l51.24">     MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/local/test/unit/test_verifyLogon.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_verifyLogon.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -38,17 +38,16 @@ var urlListener =</span>
<a href="#l52.4"></a><span id="l52.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l52.5"></a><span id="l52.5">   },</span>
<a href="#l52.6"></a><span id="l52.6">   OnStopRunningUrl: function (url, aResult) {</span>
<a href="#l52.7"></a><span id="l52.7">     do_check_eq(Components.isSuccessCode(aResult), this.expectSuccess);</span>
<a href="#l52.8"></a><span id="l52.8">   }</span>
<a href="#l52.9"></a><span id="l52.9"> };</span>
<a href="#l52.10"></a><span id="l52.10"> </span>
<a href="#l52.11"></a><span id="l52.11"> function actually_run_test() {</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  server.start(POP3_PORT);</span>
<a href="#l52.13"></a><span id="l52.13">   daemon.setMessages([&quot;message1.eml&quot;]);</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">   // check that verifyLogon fails with bad password</span>
<a href="#l52.16"></a><span id="l52.16">   verifyPop3Logon(false);</span>
<a href="#l52.17"></a><span id="l52.17"> </span>
<a href="#l52.18"></a><span id="l52.18">   dump(&quot;\nverify logon false 1\n&quot;);</span>
<a href="#l52.19"></a><span id="l52.19">   do_timeout(1000, verifyGoodLogon);</span>
<a href="#l52.20"></a><span id="l52.20"> }</span>
<a href="#l52.21"></a><span id="l52.21" class="difflineat">@@ -76,25 +75,26 @@ function run_test()</span>
<a href="#l52.22"></a><span id="l52.22">     var handler = new POP3_RFC1939_handler(d);</span>
<a href="#l52.23"></a><span id="l52.23">     // Set the server expected username &amp; password to what we have in signons.txt</span>
<a href="#l52.24"></a><span id="l52.24">     handler.kUsername = kUserName;</span>
<a href="#l52.25"></a><span id="l52.25">     handler.kPassword = kValidPassword;</span>
<a href="#l52.26"></a><span id="l52.26">     handler.dropOnAuthFailure = true;</span>
<a href="#l52.27"></a><span id="l52.27">     return handler;</span>
<a href="#l52.28"></a><span id="l52.28">   }</span>
<a href="#l52.29"></a><span id="l52.29">   server = new nsMailServer(createHandler, daemon);</span>
<a href="#l52.30"></a><span id="l52.30" class="difflineplus">+  server.start();</span>
<a href="#l52.31"></a><span id="l52.31"> </span>
<a href="#l52.32"></a><span id="l52.32">   // Set up the basic accounts and folders.</span>
<a href="#l52.33"></a><span id="l52.33">   // We would use createPop3ServerAndLocalFolders() however we want to have</span>
<a href="#l52.34"></a><span id="l52.34">   // a different username and NO password for this test (as we expect to load</span>
<a href="#l52.35"></a><span id="l52.35">   // it from signons.txt).</span>
<a href="#l52.36"></a><span id="l52.36">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l52.37"></a><span id="l52.37"> </span>
<a href="#l52.38"></a><span id="l52.38"> </span>
<a href="#l52.39"></a><span id="l52.39">   incomingServer = MailServices.accounts</span>
<a href="#l52.40"></a><span id="l52.40">                     .createIncomingServer(kUserName,&quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l52.41"></a><span id="l52.41"> </span>
<a href="#l52.42"></a><span id="l52.42" class="difflineminus">-  incomingServer.port = POP3_PORT;</span>
<a href="#l52.43"></a><span id="l52.43" class="difflineplus">+  incomingServer.port = server.port;</span>
<a href="#l52.44"></a><span id="l52.44"> </span>
<a href="#l52.45"></a><span id="l52.45">   do_test_pending();</span>
<a href="#l52.46"></a><span id="l52.46"> </span>
<a href="#l52.47"></a><span id="l52.47">   actually_run_test();</span>
<a href="#l52.48"></a><span id="l52.48"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/local/test/unit/xpcshell.ini</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/local/test/unit/xpcshell.ini</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -1,12 +1,11 @@</span>
<a href="#l53.4"></a><span id="l53.4"> [DEFAULT]</span>
<a href="#l53.5"></a><span id="l53.5"> head = head_maillocal.js</span>
<a href="#l53.6"></a><span id="l53.6"> tail = tail_local.js</span>
<a href="#l53.7"></a><span id="l53.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l53.8"></a><span id="l53.8"> support-files = data/*</span>
<a href="#l53.9"></a><span id="l53.9"> </span>
<a href="#l53.10"></a><span id="l53.10"> [test_bug457168.js]</span>
<a href="#l53.11"></a><span id="l53.11"> [test_fileName.js]</span>
<a href="#l53.12"></a><span id="l53.12"> [test_folderLoaded.js]</span>
<a href="#l53.13"></a><span id="l53.13"> [test_localFolder.js]</span>
<a href="#l53.14"></a><span id="l53.14"> [test_mailboxContentLength.js]</span>
<a href="#l53.15"></a><span id="l53.15"> [test_mailboxProtocol.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/news/test/unit/test_biff.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_biff.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -3,35 +3,34 @@</span>
<a href="#l54.4"></a><span id="l54.4"> </span>
<a href="#l54.5"></a><span id="l54.5"> load(&quot;../../../resources/filterTestUtils.js&quot;);</span>
<a href="#l54.6"></a><span id="l54.6"> </span>
<a href="#l54.7"></a><span id="l54.7"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l54.8"></a><span id="l54.8"> </span>
<a href="#l54.9"></a><span id="l54.9"> function run_test() {</span>
<a href="#l54.10"></a><span id="l54.10">   // Set up the server and add in filters</span>
<a href="#l54.11"></a><span id="l54.11">   let daemon = setupNNTPDaemon();</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  let localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+  let server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineplus">+  server.start();</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineplus">+  let localserver = setupLocalServer(server.port);</span>
<a href="#l54.16"></a><span id="l54.16">   // Remove all but the test.filter folder</span>
<a href="#l54.17"></a><span id="l54.17">   let rootFolder = localserver.rootFolder;</span>
<a href="#l54.18"></a><span id="l54.18">   let enumerator = rootFolder.subFolders;</span>
<a href="#l54.19"></a><span id="l54.19">   while (enumerator.hasMoreElements()) {</span>
<a href="#l54.20"></a><span id="l54.20">     let folder = enumerator.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l54.21"></a><span id="l54.21">     if (folder.name != &quot;test.filter&quot;)</span>
<a href="#l54.22"></a><span id="l54.22">       rootFolder.propagateDelete(folder, true, null);</span>
<a href="#l54.23"></a><span id="l54.23">   }</span>
<a href="#l54.24"></a><span id="l54.24"> </span>
<a href="#l54.25"></a><span id="l54.25">   // Create a filter to mark one message read.</span>
<a href="#l54.26"></a><span id="l54.26">   let filters = localserver.getFilterList(null);</span>
<a href="#l54.27"></a><span id="l54.27">   filters.loggingEnabled = true;</span>
<a href="#l54.28"></a><span id="l54.28">   createFilter(filters, &quot;subject&quot;, &quot;Odd&quot;, &quot;read&quot;);</span>
<a href="#l54.29"></a><span id="l54.29">   localserver.setFilterList(filters);</span>
<a href="#l54.30"></a><span id="l54.30"> </span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-  let server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l54.33"></a><span id="l54.33" class="difflineminus">-</span>
<a href="#l54.34"></a><span id="l54.34">   // This is a bit hackish, but we don't have any really functional callbacks</span>
<a href="#l54.35"></a><span id="l54.35">   // for biff. Instead, we use the notifier to look for all 7 messages to be</span>
<a href="#l54.36"></a><span id="l54.36">   // added and take that as our sign that the download is finished.</span>
<a href="#l54.37"></a><span id="l54.37">   let expectCount = 7, seen = 0;</span>
<a href="#l54.38"></a><span id="l54.38">   let listener = { msgAdded: function() {</span>
<a href="#l54.39"></a><span id="l54.39">     if (++seen == expectCount)</span>
<a href="#l54.40"></a><span id="l54.40">       localserver.closeCachedConnections();</span>
<a href="#l54.41"></a><span id="l54.41">     }};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -1,24 +1,25 @@</span>
<a href="#l55.4"></a><span id="l55.4"> // Bug 37465 -- assertions with no accounts</span>
<a href="#l55.5"></a><span id="l55.5"> </span>
<a href="#l55.6"></a><span id="l55.6"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l55.7"></a><span id="l55.7"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l55.8"></a><span id="l55.8"> </span>
<a href="#l55.9"></a><span id="l55.9"> function run_test() {</span>
<a href="#l55.10"></a><span id="l55.10">   var daemon = setupNNTPDaemon();</span>
<a href="#l55.11"></a><span id="l55.11">   var server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  server.start();</span>
<a href="#l55.14"></a><span id="l55.14"> </span>
<a href="#l55.15"></a><span id="l55.15">   // Correct URI?</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineminus">-  let uri = Services.io.newURI(&quot;news://localhost:1143/1@regular.invalid&quot;,</span>
<a href="#l55.17"></a><span id="l55.17" class="difflineplus">+  let uri = Services.io.newURI(&quot;news://localhost:&quot; + server.port +</span>
<a href="#l55.18"></a><span id="l55.18" class="difflineplus">+                                 &quot;/1@regular.invalid&quot;,</span>
<a href="#l55.19"></a><span id="l55.19">                                null, null);</span>
<a href="#l55.20"></a><span id="l55.20">   let newsUri = uri.QueryInterface(Ci.nsINntpUrl)</span>
<a href="#l55.21"></a><span id="l55.21">                    .QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l55.22"></a><span id="l55.22" class="difflineminus">-  do_check_eq(uri.port, NNTP_PORT);</span>
<a href="#l55.23"></a><span id="l55.23" class="difflineplus">+  do_check_eq(uri.port, server.port);</span>
<a href="#l55.24"></a><span id="l55.24">   do_check_eq(newsUri.server, null);</span>
<a href="#l55.25"></a><span id="l55.25">   do_check_eq(newsUri.messageID, &quot;1@regular.invalid&quot;);</span>
<a href="#l55.26"></a><span id="l55.26">   do_check_eq(newsUri.folder, null);</span>
<a href="#l55.27"></a><span id="l55.27"> </span>
<a href="#l55.28"></a><span id="l55.28">   // Run the URI and make sure we get the message</span>
<a href="#l55.29"></a><span id="l55.29">   let channel = Services.io.newChannelFromURI(uri);</span>
<a href="#l55.30"></a><span id="l55.30">   channel.asyncOpen(articleTextListener, null);</span>
<a href="#l55.31"></a><span id="l55.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug403242.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug403242.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -3,20 +3,20 @@</span>
<a href="#l56.4"></a><span id="l56.4"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l56.5"></a><span id="l56.5"> </span>
<a href="#l56.6"></a><span id="l56.6"> var daemon, localserver, server;</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8"> function run_test() {</span>
<a href="#l56.9"></a><span id="l56.9">   daemon = setupNNTPDaemon();</span>
<a href="#l56.10"></a><span id="l56.10">   daemon.addGroup(&quot;test1&quot;);</span>
<a href="#l56.11"></a><span id="l56.11">   daemon.addArticle(make_article(do_get_file(&quot;postings/bug403242.eml&quot;)));</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+  server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineplus">+  server.start();</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineplus">+  localserver = setupLocalServer(server.port);</span>
<a href="#l56.16"></a><span id="l56.16">   localserver.subscribeToNewsgroup(&quot;test1&quot;);</span>
<a href="#l56.17"></a><span id="l56.17" class="difflineminus">-  server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l56.18"></a><span id="l56.18" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l56.19"></a><span id="l56.19"> </span>
<a href="#l56.20"></a><span id="l56.20">   let folder = localserver.rootFolder.getChildNamed(&quot;test1&quot;);</span>
<a href="#l56.21"></a><span id="l56.21">   folder.getNewMessages(null, {</span>
<a href="#l56.22"></a><span id="l56.22">     OnStopRunningUrl: function () { localserver.closeCachedConnections(); }});</span>
<a href="#l56.23"></a><span id="l56.23">   server.performTest();</span>
<a href="#l56.24"></a><span id="l56.24"> </span>
<a href="#l56.25"></a><span id="l56.25">   // Fetch the message</span>
<a href="#l56.26"></a><span id="l56.26">   let uri = folder.generateMessageURI(1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug540288.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug540288.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -1,20 +1,16 @@</span>
<a href="#l57.4"></a><span id="l57.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l57.5"></a><span id="l57.5"> /* Tests that an empty cache entry doesn't return an empty message for news. */</span>
<a href="#l57.6"></a><span id="l57.6"> </span>
<a href="#l57.7"></a><span id="l57.7"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l57.8"></a><span id="l57.8"> </span>
<a href="#l57.9"></a><span id="l57.9"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l57.10"></a><span id="l57.10"> var daemon = setupNNTPDaemon();</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-// Define these up here for checking with the transaction</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-var type = null;</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-var test = null;</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-</span>
<a href="#l57.16"></a><span id="l57.16"> var server;</span>
<a href="#l57.17"></a><span id="l57.17"> var localserver;</span>
<a href="#l57.18"></a><span id="l57.18"> </span>
<a href="#l57.19"></a><span id="l57.19"> var streamListener =</span>
<a href="#l57.20"></a><span id="l57.20"> {</span>
<a href="#l57.21"></a><span id="l57.21">   _data: &quot;&quot;,</span>
<a href="#l57.22"></a><span id="l57.22"> </span>
<a href="#l57.23"></a><span id="l57.23">   QueryInterface:</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineat">@@ -54,23 +50,22 @@ function doTestFinished() {</span>
<a href="#l57.25"></a><span id="l57.25"> </span>
<a href="#l57.26"></a><span id="l57.26">     var thread = gThreadManager.currentThread;</span>
<a href="#l57.27"></a><span id="l57.27">     while (thread.hasPendingEvents())</span>
<a href="#l57.28"></a><span id="l57.28">       thread.processNextEvent(true);</span>
<a href="#l57.29"></a><span id="l57.29"> </span>
<a href="#l57.30"></a><span id="l57.30">     do_test_finished();</span>
<a href="#l57.31"></a><span id="l57.31"> }</span>
<a href="#l57.32"></a><span id="l57.32"> </span>
<a href="#l57.33"></a><span id="l57.33" class="difflineminus">-const kCacheKey = &quot;news://localhost:&quot; + NNTP_PORT + &quot;/TSS1%40nntp.test&quot;;</span>
<a href="#l57.34"></a><span id="l57.34"> </span>
<a href="#l57.35"></a><span id="l57.35"> function run_test() {</span>
<a href="#l57.36"></a><span id="l57.36" class="difflineminus">-  type = &quot;RFC 977&quot;;</span>
<a href="#l57.37"></a><span id="l57.37" class="difflineminus">-  localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l57.38"></a><span id="l57.38">   server = makeServer(NNTP_RFC977_handler, daemon);</span>
<a href="#l57.39"></a><span id="l57.39" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l57.40"></a><span id="l57.40" class="difflineplus">+  server.start();</span>
<a href="#l57.41"></a><span id="l57.41" class="difflineplus">+  localserver = setupLocalServer(server.port);</span>
<a href="#l57.42"></a><span id="l57.42" class="difflineplus">+  const kCacheKey = &quot;news://localhost:&quot; + server.port + &quot;/TSS1%40nntp.test&quot;;</span>
<a href="#l57.43"></a><span id="l57.43"> </span>
<a href="#l57.44"></a><span id="l57.44">   try {</span>
<a href="#l57.45"></a><span id="l57.45">     // Add an empty message to the cache</span>
<a href="#l57.46"></a><span id="l57.46">     MailServices.nntp</span>
<a href="#l57.47"></a><span id="l57.47">                 .cacheSession</span>
<a href="#l57.48"></a><span id="l57.48">                 .asyncOpenCacheEntry(kCacheKey, Ci.nsICache.ACCESS_WRITE, {</span>
<a href="#l57.49"></a><span id="l57.49">       onCacheEntryAvailable: function(cacheEntry, access, status) {</span>
<a href="#l57.50"></a><span id="l57.50">         do_check_eq(status, Components.results.NS_OK);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug695309.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug695309.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -49,18 +49,17 @@ function test_newMsgs() {</span>
<a href="#l58.4"></a><span id="l58.4">   highWater = folder.getTotalMessages(false);</span>
<a href="#l58.5"></a><span id="l58.5">   do_check_eq(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l58.6"></a><span id="l58.6"> }</span>
<a href="#l58.7"></a><span id="l58.7"> </span>
<a href="#l58.8"></a><span id="l58.8"> function trigger_bug() {</span>
<a href="#l58.9"></a><span id="l58.9">   // Kill the connection and start it up again.</span>
<a href="#l58.10"></a><span id="l58.10">   dump(&quot;Stopping server!\n&quot;);</span>
<a href="#l58.11"></a><span id="l58.11">   server.stop();</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineplus">+  server.start();</span>
<a href="#l58.15"></a><span id="l58.15"> </span>
<a href="#l58.16"></a><span id="l58.16">   // Get new messages for all folders. Once we've seen one folder, trigger a</span>
<a href="#l58.17"></a><span id="l58.17">   // load of the folder in question. This second load should, if the bug is</span>
<a href="#l58.18"></a><span id="l58.18">   // present, be overwritten with one from the load queue that causes the</span>
<a href="#l58.19"></a><span id="l58.19">   // confusion. It then loads it again, and should (before the patch that fixes</span>
<a href="#l58.20"></a><span id="l58.20">   // this) read the 200 logon instead of the 211 group.</span>
<a href="#l58.21"></a><span id="l58.21">   let folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l58.22"></a><span id="l58.22">   localserver.performExpand(null);</span>
<a href="#l58.23"></a><span id="l58.23" class="difflineat">@@ -84,16 +83,16 @@ function trigger_bug() {</span>
<a href="#l58.24"></a><span id="l58.24">   do_check_eq(folder.msgDatabase.dBFolderInfo.highWater, highWater);</span>
<a href="#l58.25"></a><span id="l58.25">   yield true;</span>
<a href="#l58.26"></a><span id="l58.26"> }</span>
<a href="#l58.27"></a><span id="l58.27"> function cleanUp() {</span>
<a href="#l58.28"></a><span id="l58.28">   localserver.closeCachedConnections();</span>
<a href="#l58.29"></a><span id="l58.29"> }</span>
<a href="#l58.30"></a><span id="l58.30"> function run_test() {</span>
<a href="#l58.31"></a><span id="l58.31">   daemon = setupNNTPDaemon();</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineminus">-  localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l58.33"></a><span id="l58.33" class="difflineplus">+  server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l58.34"></a><span id="l58.34" class="difflineplus">+  server.start();</span>
<a href="#l58.35"></a><span id="l58.35" class="difflineplus">+  localserver = setupLocalServer(server.port);</span>
<a href="#l58.36"></a><span id="l58.36">   localserver.maximumConnectionsNumber = 2;</span>
<a href="#l58.37"></a><span id="l58.37" class="difflineminus">-  server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l58.38"></a><span id="l58.38" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l58.39"></a><span id="l58.39"> </span>
<a href="#l58.40"></a><span id="l58.40">   async_run_tests(tests);</span>
<a href="#l58.41"></a><span id="l58.41"> }</span>
<a href="#l58.42"></a><span id="l58.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/news/test/unit/test_filter.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_filter.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -28,17 +28,18 @@ var attribResults = {</span>
<a href="#l59.4"></a><span id="l59.4">   &quot;4@regular.invalid&quot; : [&quot;isRead&quot;, true],</span>
<a href="#l59.5"></a><span id="l59.5">   &quot;5@regular.invalid&quot; : [&quot;isRead&quot;, true],</span>
<a href="#l59.6"></a><span id="l59.6">   &quot;6.odd@regular.invalid&quot; : [&quot;isRead&quot;, true],</span>
<a href="#l59.7"></a><span id="l59.7">   &quot;7@regular.invalid&quot; : [&quot;isRead&quot;, true],</span>
<a href="#l59.8"></a><span id="l59.8">   &quot;8.unread@regular.invalid&quot; : [&quot;isRead&quot;, true]</span>
<a href="#l59.9"></a><span id="l59.9"> };</span>
<a href="#l59.10"></a><span id="l59.10"> function testAttrib(handler, daemon, localserver) {</span>
<a href="#l59.11"></a><span id="l59.11">   var server = makeServer(handler, daemon);</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+  server.start();</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineplus">+  localserver.port = server.port;</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16">   // Get the folder and force filters to run</span>
<a href="#l59.17"></a><span id="l59.17">   var folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l59.18"></a><span id="l59.18">   folder.getNewMessages(null, {</span>
<a href="#l59.19"></a><span id="l59.19">     OnStopRunningUrl: function () { localserver.closeCachedConnections() }});</span>
<a href="#l59.20"></a><span id="l59.20">   server.performTest();</span>
<a href="#l59.21"></a><span id="l59.21"> </span>
<a href="#l59.22"></a><span id="l59.22">   var headerEnum = folder.messages;</span>
<a href="#l59.23"></a><span id="l59.23" class="difflineat">@@ -84,17 +85,18 @@ var actionResults = {</span>
<a href="#l59.24"></a><span id="l59.24">   &quot;6.odd@regular.invalid&quot; : [&quot;isRead&quot;, false],</span>
<a href="#l59.25"></a><span id="l59.25">   &quot;7@regular.invalid&quot; : function (header, folder) {</span>
<a href="#l59.26"></a><span id="l59.26">     return header.getStringProperty(&quot;keywords&quot;) == &quot;tag&quot;;</span>
<a href="#l59.27"></a><span id="l59.27">   },</span>
<a href="#l59.28"></a><span id="l59.28">   &quot;8.unread@regular.invalid&quot; : [&quot;isRead&quot;, false]</span>
<a href="#l59.29"></a><span id="l59.29"> };</span>
<a href="#l59.30"></a><span id="l59.30"> function testAction(handler, daemon, localserver) {</span>
<a href="#l59.31"></a><span id="l59.31">   var server = makeServer(handler, daemon);</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineplus">+  server.start();</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineplus">+  localserver.port = server.port;</span>
<a href="#l59.35"></a><span id="l59.35"> </span>
<a href="#l59.36"></a><span id="l59.36">   // Get the folder and force filters to run</span>
<a href="#l59.37"></a><span id="l59.37">   var folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l59.38"></a><span id="l59.38">   folder.getNewMessages(null, {</span>
<a href="#l59.39"></a><span id="l59.39">     OnStopRunningUrl: function () { localserver.closeCachedConnections() }});</span>
<a href="#l59.40"></a><span id="l59.40">   server.performTest();</span>
<a href="#l59.41"></a><span id="l59.41"> </span>
<a href="#l59.42"></a><span id="l59.42">   var headerEnum = folder.messages;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/news/test/unit/test_getNewsMessage.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_getNewsMessage.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -6,20 +6,16 @@</span>
<a href="#l60.4"></a><span id="l60.4">  *   - Downloading a single message and checking content in stream is correct.</span>
<a href="#l60.5"></a><span id="l60.5">  */</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l60.8"></a><span id="l60.8"> </span>
<a href="#l60.9"></a><span id="l60.9"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l60.10"></a><span id="l60.10"> var daemon = setupNNTPDaemon();</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-// Define these up here for checking with the transaction</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-var type = null;</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-var test = null;</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineminus">-</span>
<a href="#l60.16"></a><span id="l60.16"> var server;</span>
<a href="#l60.17"></a><span id="l60.17"> var localserver;</span>
<a href="#l60.18"></a><span id="l60.18"> </span>
<a href="#l60.19"></a><span id="l60.19"> var streamListener =</span>
<a href="#l60.20"></a><span id="l60.20"> {</span>
<a href="#l60.21"></a><span id="l60.21">   _data: &quot;&quot;,</span>
<a href="#l60.22"></a><span id="l60.22"> </span>
<a href="#l60.23"></a><span id="l60.23">   QueryInterface:</span>
<a href="#l60.24"></a><span id="l60.24" class="difflineat">@@ -60,20 +56,19 @@ function doTestFinished() {</span>
<a href="#l60.25"></a><span id="l60.25">     var thread = gThreadManager.currentThread;</span>
<a href="#l60.26"></a><span id="l60.26">     while (thread.hasPendingEvents())</span>
<a href="#l60.27"></a><span id="l60.27">       thread.processNextEvent(true);</span>
<a href="#l60.28"></a><span id="l60.28"> </span>
<a href="#l60.29"></a><span id="l60.29">     do_test_finished();</span>
<a href="#l60.30"></a><span id="l60.30"> }</span>
<a href="#l60.31"></a><span id="l60.31"> </span>
<a href="#l60.32"></a><span id="l60.32"> function run_test() {</span>
<a href="#l60.33"></a><span id="l60.33" class="difflineminus">-  type = &quot;RFC 977&quot;;</span>
<a href="#l60.34"></a><span id="l60.34" class="difflineminus">-  localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l60.35"></a><span id="l60.35">   server = makeServer(NNTP_RFC977_handler, daemon);</span>
<a href="#l60.36"></a><span id="l60.36" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l60.37"></a><span id="l60.37" class="difflineplus">+  server.start();</span>
<a href="#l60.38"></a><span id="l60.38" class="difflineplus">+  localserver = setupLocalServer(server.port);</span>
<a href="#l60.39"></a><span id="l60.39"> </span>
<a href="#l60.40"></a><span id="l60.40">   try {</span>
<a href="#l60.41"></a><span id="l60.41">     // Get the folder and new mail</span>
<a href="#l60.42"></a><span id="l60.42">     var folder = localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l60.43"></a><span id="l60.43">     folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l60.44"></a><span id="l60.44">     folder.getNewMessages(null, {</span>
<a href="#l60.45"></a><span id="l60.45">       OnStopRunningUrl: function () { localserver.closeCachedConnections(); }});</span>
<a href="#l60.46"></a><span id="l60.46">     server.performTest();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/news/test/unit/test_internalUris.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_internalUris.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -210,20 +210,19 @@ function test_escapedName() {</span>
<a href="#l61.4"></a><span id="l61.4">   MailServices.nntp.fetchMessage(folder, 1, null, streamlistener, asyncUrlListener);</span>
<a href="#l61.5"></a><span id="l61.5">   yield false;</span>
<a href="#l61.6"></a><span id="l61.6">   do_check_eq(statuscode, Components.results.NS_OK);</span>
<a href="#l61.7"></a><span id="l61.7">   yield true;</span>
<a href="#l61.8"></a><span id="l61.8"> }</span>
<a href="#l61.9"></a><span id="l61.9"> </span>
<a href="#l61.10"></a><span id="l61.10"> function run_test() {</span>
<a href="#l61.11"></a><span id="l61.11">   daemon = setupNNTPDaemon();</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l61.13"></a><span id="l61.13">   server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineminus">-  server.setDebugLevel(fsDebugAll);</span>
<a href="#l61.16"></a><span id="l61.16" class="difflineplus">+  server.start();</span>
<a href="#l61.17"></a><span id="l61.17" class="difflineplus">+  localserver = setupLocalServer(server.port);</span>
<a href="#l61.18"></a><span id="l61.18"> </span>
<a href="#l61.19"></a><span id="l61.19">   // Set up an identity for posting</span>
<a href="#l61.20"></a><span id="l61.20">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l61.21"></a><span id="l61.21">   identity.fullName = &quot;Normal Person&quot;;</span>
<a href="#l61.22"></a><span id="l61.22">   identity.email = &quot;fake@acme.invalid&quot;;</span>
<a href="#l61.23"></a><span id="l61.23">   MailServices.accounts.FindAccountForServer(localserver).addIdentity(identity);</span>
<a href="#l61.24"></a><span id="l61.24"> </span>
<a href="#l61.25"></a><span id="l61.25">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/news/test/unit/test_newsAutocomplete.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_newsAutocomplete.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -21,19 +21,17 @@ acObserver.prototype = {</span>
<a href="#l62.4"></a><span id="l62.4"> </span>
<a href="#l62.5"></a><span id="l62.5">   onSearchResult: function (aSearch, aResult) {</span>
<a href="#l62.6"></a><span id="l62.6">     this._search = aSearch;</span>
<a href="#l62.7"></a><span id="l62.7">     this._result = aResult;</span>
<a href="#l62.8"></a><span id="l62.8">   }</span>
<a href="#l62.9"></a><span id="l62.9"> };</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11"> function run_test() {</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  let type = &quot;RFC 977&quot;;</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineminus">-  let localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineminus">-  let server = makeServer(NNTP_RFC977_handler, gDaemon);</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineplus">+  let localserver = setupLocalServer(119);</span>
<a href="#l62.16"></a><span id="l62.16"> </span>
<a href="#l62.17"></a><span id="l62.17">   // create identity</span>
<a href="#l62.18"></a><span id="l62.18">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l62.19"></a><span id="l62.19">   _account.addIdentity(identity);</span>
<a href="#l62.20"></a><span id="l62.20"> </span>
<a href="#l62.21"></a><span id="l62.21">   let acs = Components.classes[&quot;@mozilla.org/autocomplete/search;1?name=news&quot;]</span>
<a href="#l62.22"></a><span id="l62.22">     .getService(Components.interfaces.nsIAutoCompleteSearch);</span>
<a href="#l62.23"></a><span id="l62.23">   let obs;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -13,20 +13,19 @@</span>
<a href="#l63.4"></a><span id="l63.4"> </span>
<a href="#l63.5"></a><span id="l63.5"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l63.6"></a><span id="l63.6"> var daemon = setupNNTPDaemon();</span>
<a href="#l63.7"></a><span id="l63.7"> </span>
<a href="#l63.8"></a><span id="l63.8"> var server;</span>
<a href="#l63.9"></a><span id="l63.9"> var localserver;</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11"> function run_test() {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  type = &quot;RFC 977&quot;;</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineminus">-  localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l63.14"></a><span id="l63.14">   server = makeServer(NNTP_RFC977_handler, daemon);</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l63.16"></a><span id="l63.16" class="difflineplus">+  server.start();</span>
<a href="#l63.17"></a><span id="l63.17" class="difflineplus">+  localserver = setupLocalServer(server.port);</span>
<a href="#l63.18"></a><span id="l63.18"> </span>
<a href="#l63.19"></a><span id="l63.19">   try {</span>
<a href="#l63.20"></a><span id="l63.20">     // Get the folder and new mail</span>
<a href="#l63.21"></a><span id="l63.21">     let folder = localserver.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l63.22"></a><span id="l63.22">     folder.clearFlag(Ci.nsMsgFolderFlags.Offline);</span>
<a href="#l63.23"></a><span id="l63.23">     folder.getNewMessages(null, {</span>
<a href="#l63.24"></a><span id="l63.24">       OnStopRunningUrl: function () { localserver.closeCachedConnections(); }});</span>
<a href="#l63.25"></a><span id="l63.25">     server.performTest();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpGroupPassword.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpGroupPassword.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -2,61 +2,58 @@</span>
<a href="#l64.4"></a><span id="l64.4"> /**</span>
<a href="#l64.5"></a><span id="l64.5">  * Authentication tests for NNTP (based on RFC4643).</span>
<a href="#l64.6"></a><span id="l64.6">  */</span>
<a href="#l64.7"></a><span id="l64.7"> </span>
<a href="#l64.8"></a><span id="l64.8"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l64.9"></a><span id="l64.9"> var daemon = setupNNTPDaemon();</span>
<a href="#l64.10"></a><span id="l64.10"> </span>
<a href="#l64.11"></a><span id="l64.11"> // Define these up here for checking with the transaction</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-var type = null;</span>
<a href="#l64.13"></a><span id="l64.13"> var test = null;</span>
<a href="#l64.14"></a><span id="l64.14"> </span>
<a href="#l64.15"></a><span id="l64.15"> function run_test() {</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineminus">-  type = &quot;RFC 4643&quot;;</span>
<a href="#l64.17"></a><span id="l64.17" class="difflineminus">-</span>
<a href="#l64.18"></a><span id="l64.18">   daemon.groupCredentials = {</span>
<a href="#l64.19"></a><span id="l64.19">     &quot;test.subscribe.empty&quot;: [&quot;group1&quot;, &quot;pass1&quot;],</span>
<a href="#l64.20"></a><span id="l64.20">     &quot;test.filter&quot;: [&quot;group2&quot;, &quot;pass2&quot;]</span>
<a href="#l64.21"></a><span id="l64.21">   };</span>
<a href="#l64.22"></a><span id="l64.22"> </span>
<a href="#l64.23"></a><span id="l64.23">   var server = makeServer(NNTP_RFC4643_extension, daemon);</span>
<a href="#l64.24"></a><span id="l64.24" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l64.25"></a><span id="l64.25" class="difflineminus">-  var localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l64.26"></a><span id="l64.26" class="difflineplus">+  server.start();</span>
<a href="#l64.27"></a><span id="l64.27" class="difflineplus">+  var localserver = setupLocalServer(server.port);</span>
<a href="#l64.28"></a><span id="l64.28">   localserver.singleSignon = false;</span>
<a href="#l64.29"></a><span id="l64.29"> </span>
<a href="#l64.30"></a><span id="l64.30">   // Add passwords to the manager</span>
<a href="#l64.31"></a><span id="l64.31">   var serverURI = &quot;news://localhost/&quot;;</span>
<a href="#l64.32"></a><span id="l64.32">   var loginInfo1 = Cc[&quot;@mozilla.org/login-manager/loginInfo;1&quot;]</span>
<a href="#l64.33"></a><span id="l64.33">                      .createInstance(Ci.nsILoginInfo);</span>
<a href="#l64.34"></a><span id="l64.34">   loginInfo1.init(serverURI + &quot;test.subscribe.empty&quot;, null,</span>
<a href="#l64.35"></a><span id="l64.35">     serverURI + &quot;test.subscribe.empty&quot;, &quot;group1&quot;, &quot;pass1&quot;, &quot;&quot;, &quot;&quot;);</span>
<a href="#l64.36"></a><span id="l64.36">   Services.logins.addLogin(loginInfo1);</span>
<a href="#l64.37"></a><span id="l64.37">   var loginInfo2 = Cc[&quot;@mozilla.org/login-manager/loginInfo;1&quot;]</span>
<a href="#l64.38"></a><span id="l64.38">                      .createInstance(Ci.nsILoginInfo);</span>
<a href="#l64.39"></a><span id="l64.39">   loginInfo2.init(serverURI + &quot;test.filter&quot;, null,</span>
<a href="#l64.40"></a><span id="l64.40">     serverURI + &quot;test.filter&quot;, &quot;group2&quot;, &quot;pass2&quot;, &quot;&quot;, &quot;&quot;);</span>
<a href="#l64.41"></a><span id="l64.41">   Services.logins.addLogin(loginInfo2);</span>
<a href="#l64.42"></a><span id="l64.42">   try {</span>
<a href="#l64.43"></a><span id="l64.43" class="difflineminus">-    var prefix = &quot;news://localhost:&quot;+NNTP_PORT+&quot;/&quot;;</span>
<a href="#l64.44"></a><span id="l64.44" class="difflineplus">+    var prefix = &quot;news://localhost:&quot; + server.port + &quot;/&quot;;</span>
<a href="#l64.45"></a><span id="l64.45">     var transaction;</span>
<a href="#l64.46"></a><span id="l64.46"> </span>
<a href="#l64.47"></a><span id="l64.47">     test = &quot;per-group password part 1&quot;;</span>
<a href="#l64.48"></a><span id="l64.48" class="difflineminus">-    setupProtocolTest(NNTP_PORT, prefix+&quot;test.subscribe.empty&quot;, localserver);</span>
<a href="#l64.49"></a><span id="l64.49" class="difflineplus">+    setupProtocolTest(server.port, prefix+&quot;test.subscribe.empty&quot;, localserver);</span>
<a href="#l64.50"></a><span id="l64.50">     server.performTest();</span>
<a href="#l64.51"></a><span id="l64.51">     transaction = server.playTransaction();</span>
<a href="#l64.52"></a><span id="l64.52">     do_check_transaction(transaction, [&quot;MODE READER&quot;,</span>
<a href="#l64.53"></a><span id="l64.53">                                        &quot;GROUP test.subscribe.empty&quot;,</span>
<a href="#l64.54"></a><span id="l64.54">                                        &quot;AUTHINFO user group1&quot;,</span>
<a href="#l64.55"></a><span id="l64.55">                                        &quot;AUTHINFO pass pass1&quot;,</span>
<a href="#l64.56"></a><span id="l64.56">                                        &quot;GROUP test.subscribe.empty&quot;]);</span>
<a href="#l64.57"></a><span id="l64.57"> </span>
<a href="#l64.58"></a><span id="l64.58">     test = &quot;per-group password part 2&quot;;</span>
<a href="#l64.59"></a><span id="l64.59">     server.resetTest();</span>
<a href="#l64.60"></a><span id="l64.60" class="difflineminus">-    setupProtocolTest(NNTP_PORT, prefix+&quot;test.filter&quot;, localserver);</span>
<a href="#l64.61"></a><span id="l64.61" class="difflineplus">+    setupProtocolTest(server.port, prefix+&quot;test.filter&quot;, localserver);</span>
<a href="#l64.62"></a><span id="l64.62">     server.performTest();</span>
<a href="#l64.63"></a><span id="l64.63">     transaction = server.playTransaction();</span>
<a href="#l64.64"></a><span id="l64.64">     do_check_transaction(transaction, [&quot;MODE READER&quot;, &quot;GROUP test.filter&quot;,</span>
<a href="#l64.65"></a><span id="l64.65">                                        &quot;AUTHINFO user group2&quot;,</span>
<a href="#l64.66"></a><span id="l64.66">                                        &quot;AUTHINFO pass pass2&quot;,</span>
<a href="#l64.67"></a><span id="l64.67">                                        &quot;GROUP test.filter&quot;,</span>
<a href="#l64.68"></a><span id="l64.68">                                        &quot;XOVER 1-8&quot;]);</span>
<a href="#l64.69"></a><span id="l64.69"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPassword.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPassword.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -7,35 +7,32 @@</span>
<a href="#l65.4"></a><span id="l65.4">  */</span>
<a href="#l65.5"></a><span id="l65.5"> </span>
<a href="#l65.6"></a><span id="l65.6"> load(&quot;../../../resources/passwordStorage.js&quot;);</span>
<a href="#l65.7"></a><span id="l65.7"> </span>
<a href="#l65.8"></a><span id="l65.8"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l65.9"></a><span id="l65.9"> var daemon = setupNNTPDaemon();</span>
<a href="#l65.10"></a><span id="l65.10"> </span>
<a href="#l65.11"></a><span id="l65.11"> // Define these up here for checking with the transaction</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-var type = null;</span>
<a href="#l65.13"></a><span id="l65.13"> var test = null;</span>
<a href="#l65.14"></a><span id="l65.14"> </span>
<a href="#l65.15"></a><span id="l65.15"> function run_test() {</span>
<a href="#l65.16"></a><span id="l65.16" class="difflineminus">-  type = &quot;RFC 4643&quot;;</span>
<a href="#l65.17"></a><span id="l65.17" class="difflineminus">-</span>
<a href="#l65.18"></a><span id="l65.18">   // Prepare files for passwords (generated by a script in bug 925489).</span>
<a href="#l65.19"></a><span id="l65.19">   setupForPassword(&quot;signons-mailnews1.8.sqlite&quot;)</span>
<a href="#l65.20"></a><span id="l65.20"> </span>
<a href="#l65.21"></a><span id="l65.21">   var server = makeServer(NNTP_RFC4643_extension, daemon);</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l65.23"></a><span id="l65.23" class="difflineplus">+  server.start();</span>
<a href="#l65.24"></a><span id="l65.24"> </span>
<a href="#l65.25"></a><span id="l65.25">   try {</span>
<a href="#l65.26"></a><span id="l65.26" class="difflineminus">-    var prefix = &quot;news://localhost:&quot;+NNTP_PORT+&quot;/&quot;;</span>
<a href="#l65.27"></a><span id="l65.27" class="difflineplus">+    var prefix = &quot;news://localhost:&quot; + server.port + &quot;/&quot;;</span>
<a href="#l65.28"></a><span id="l65.28">     var transaction;</span>
<a href="#l65.29"></a><span id="l65.29"> </span>
<a href="#l65.30"></a><span id="l65.30">     // Test - group subscribe listing</span>
<a href="#l65.31"></a><span id="l65.31">     test = &quot;news:*&quot;;</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineminus">-    setupProtocolTest(NNTP_PORT, prefix+&quot;*&quot;);</span>
<a href="#l65.33"></a><span id="l65.33" class="difflineplus">+    setupProtocolTest(server.port, prefix+&quot;*&quot;);</span>
<a href="#l65.34"></a><span id="l65.34">     server.performTest();</span>
<a href="#l65.35"></a><span id="l65.35">     transaction = server.playTransaction();</span>
<a href="#l65.36"></a><span id="l65.36">     do_check_transaction(transaction, [&quot;MODE READER&quot;, &quot;LIST&quot;,</span>
<a href="#l65.37"></a><span id="l65.37">                                        &quot;AUTHINFO user testnews&quot;,</span>
<a href="#l65.38"></a><span id="l65.38">                                        &quot;AUTHINFO pass newstest&quot;, &quot;LIST&quot;]);</span>
<a href="#l65.39"></a><span id="l65.39"> </span>
<a href="#l65.40"></a><span id="l65.40">   } catch (e) {</span>
<a href="#l65.41"></a><span id="l65.41">     dump(&quot;NNTP Protocol test &quot;+test+&quot; failed for type RFC 977:\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPassword2.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPassword2.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -10,20 +10,22 @@</span>
<a href="#l66.4"></a><span id="l66.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l66.5"></a><span id="l66.5"> </span>
<a href="#l66.6"></a><span id="l66.6"> load(&quot;../../../resources/passwordStorage.js&quot;);</span>
<a href="#l66.7"></a><span id="l66.7"> </span>
<a href="#l66.8"></a><span id="l66.8"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l66.9"></a><span id="l66.9"> var daemon = setupNNTPDaemon();</span>
<a href="#l66.10"></a><span id="l66.10"> </span>
<a href="#l66.11"></a><span id="l66.11"> // Define these up here for checking with the transaction</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-var type = null;</span>
<a href="#l66.13"></a><span id="l66.13"> var test = null;</span>
<a href="#l66.14"></a><span id="l66.14"> </span>
<a href="#l66.15"></a><span id="l66.15"> function run_test() {</span>
<a href="#l66.16"></a><span id="l66.16" class="difflineplus">+  let server = makeServer(NNTP_RFC4643_extension, daemon);</span>
<a href="#l66.17"></a><span id="l66.17" class="difflineplus">+  server.start();</span>
<a href="#l66.18"></a><span id="l66.18" class="difflineplus">+</span>
<a href="#l66.19"></a><span id="l66.19">   // These preferences set up a local news server that has had its hostname</span>
<a href="#l66.20"></a><span id="l66.20">   // and username changed from the original settings. We can't do this by</span>
<a href="#l66.21"></a><span id="l66.21">   // function calls for this test as they would cause the password to be</span>
<a href="#l66.22"></a><span id="l66.22">   // forgotten when changing the hostname/username and this breaks the test.</span>
<a href="#l66.23"></a><span id="l66.23">   Services.prefs.setCharPref(&quot;mail.account.account1.server&quot;, &quot;server1&quot;);</span>
<a href="#l66.24"></a><span id="l66.24">   Services.prefs.setCharPref(&quot;mail.account.account2.server&quot;, &quot;server2&quot;);</span>
<a href="#l66.25"></a><span id="l66.25">   Services.prefs.setCharPref(&quot;mail.account.account2.identities&quot;, &quot;id1&quot;);</span>
<a href="#l66.26"></a><span id="l66.26">   Services.prefs.setCharPref(&quot;mail.accountmanager.accounts&quot;,</span>
<a href="#l66.27"></a><span id="l66.27" class="difflineat">@@ -43,47 +45,42 @@ function run_test() {</span>
<a href="#l66.28"></a><span id="l66.28">   Services.prefs.setCharPref(&quot;mail.server.server1.name&quot;, &quot;Local Folders&quot;);</span>
<a href="#l66.29"></a><span id="l66.29">   Services.prefs.setCharPref(&quot;mail.server.server1.type&quot;, &quot;none&quot;);</span>
<a href="#l66.30"></a><span id="l66.30">   Services.prefs.setCharPref(&quot;mail.server.server1.userName&quot;, &quot;nobody&quot;);</span>
<a href="#l66.31"></a><span id="l66.31">   Services.prefs.setCharPref(&quot;mail.server.server2.directory-rel&quot;,</span>
<a href="#l66.32"></a><span id="l66.32">                              &quot;[ProfD]News/invalid&quot;);</span>
<a href="#l66.33"></a><span id="l66.33">   Services.prefs.setCharPref(&quot;mail.server.server2.hostname&quot;, &quot;invalid&quot;);</span>
<a href="#l66.34"></a><span id="l66.34">   Services.prefs.setCharPref(&quot;mail.server.server2.name&quot;,</span>
<a href="#l66.35"></a><span id="l66.35">                              &quot;testnntp on localhost&quot;);</span>
<a href="#l66.36"></a><span id="l66.36" class="difflineminus">-  Services.prefs.setIntPref(&quot;mail.server.server2.port&quot;, NNTP_PORT);</span>
<a href="#l66.37"></a><span id="l66.37" class="difflineplus">+  Services.prefs.setIntPref(&quot;mail.server.server2.port&quot;, server.port);</span>
<a href="#l66.38"></a><span id="l66.38">   Services.prefs.setCharPref(&quot;mail.server.server2.realhostname&quot;,</span>
<a href="#l66.39"></a><span id="l66.39">                              &quot;localhost&quot;);</span>
<a href="#l66.40"></a><span id="l66.40">   Services.prefs.setCharPref(&quot;mail.server.server2.type&quot;, &quot;nntp&quot;);</span>
<a href="#l66.41"></a><span id="l66.41"> </span>
<a href="#l66.42"></a><span id="l66.42" class="difflineminus">-  type = &quot;RFC 4643&quot;;</span>
<a href="#l66.43"></a><span id="l66.43" class="difflineminus">-</span>
<a href="#l66.44"></a><span id="l66.44">   // Prepare files for passwords (generated by a script in bug 925489).</span>
<a href="#l66.45"></a><span id="l66.45">   setupForPassword(&quot;signons-mailnews1.8-alt.sqlite&quot;)</span>
<a href="#l66.46"></a><span id="l66.46"> </span>
<a href="#l66.47"></a><span id="l66.47" class="difflineminus">-  var server = makeServer(NNTP_RFC4643_extension, daemon);</span>
<a href="#l66.48"></a><span id="l66.48" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l66.49"></a><span id="l66.49" class="difflineminus">-</span>
<a href="#l66.50"></a><span id="l66.50">   try {</span>
<a href="#l66.51"></a><span id="l66.51">     // Note, the uri is for hostname &quot;invalid&quot; which is the original uri. See </span>
<a href="#l66.52"></a><span id="l66.52">     // setupProtocolTest parameters.</span>
<a href="#l66.53"></a><span id="l66.53" class="difflineminus">-    var prefix = &quot;news://invalid:&quot;+NNTP_PORT+&quot;/&quot;;</span>
<a href="#l66.54"></a><span id="l66.54" class="difflineplus">+    var prefix = &quot;news://invalid:&quot; + server.port + &quot;/&quot;;</span>
<a href="#l66.55"></a><span id="l66.55"> </span>
<a href="#l66.56"></a><span id="l66.56">     // Test - group subscribe listing</span>
<a href="#l66.57"></a><span id="l66.57">     test = &quot;news:*&quot;;</span>
<a href="#l66.58"></a><span id="l66.58"> </span>
<a href="#l66.59"></a><span id="l66.59">     // Get the existing incoming server</span>
<a href="#l66.60"></a><span id="l66.60">     MailServices.accounts.LoadAccounts();</span>
<a href="#l66.61"></a><span id="l66.61"> </span>
<a href="#l66.62"></a><span id="l66.62">     // Create the incoming server with &quot;original&quot; details.</span>
<a href="#l66.63"></a><span id="l66.63">     var incomingServer = MailServices.accounts.getIncomingServer(&quot;server2&quot;);</span>
<a href="#l66.64"></a><span id="l66.64"> </span>
<a href="#l66.65"></a><span id="l66.65">     subscribeServer(incomingServer);</span>
<a href="#l66.66"></a><span id="l66.66"> </span>
<a href="#l66.67"></a><span id="l66.67">     // Now set up and run the tests</span>
<a href="#l66.68"></a><span id="l66.68" class="difflineminus">-    setupProtocolTest(NNTP_PORT, prefix+&quot;*&quot;, incomingServer);</span>
<a href="#l66.69"></a><span id="l66.69" class="difflineplus">+    setupProtocolTest(server.port, prefix+&quot;*&quot;, incomingServer);</span>
<a href="#l66.70"></a><span id="l66.70">     server.performTest();</span>
<a href="#l66.71"></a><span id="l66.71">     var transaction = server.playTransaction();</span>
<a href="#l66.72"></a><span id="l66.72">     do_check_transaction(transaction, [&quot;MODE READER&quot;, &quot;LIST&quot;,</span>
<a href="#l66.73"></a><span id="l66.73">                                        &quot;AUTHINFO user testnews&quot;,</span>
<a href="#l66.74"></a><span id="l66.74">                                        &quot;AUTHINFO pass newstest&quot;, &quot;LIST&quot;]);</span>
<a href="#l66.75"></a><span id="l66.75">     incomingServer.QueryInterface(Components.interfaces.nsISubscribableServer)</span>
<a href="#l66.76"></a><span id="l66.76">                   .subscribeCleanup();</span>
<a href="#l66.77"></a><span id="l66.77"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPasswordFailure.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPasswordFailure.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -176,19 +176,18 @@ function run_test()</span>
<a href="#l67.4"></a><span id="l67.4">   // Set up the server</span>
<a href="#l67.5"></a><span id="l67.5">   daemon = setupNNTPDaemon();</span>
<a href="#l67.6"></a><span id="l67.6">   function createHandler(d) {</span>
<a href="#l67.7"></a><span id="l67.7">     var handler = new NNTP_RFC4643_extension(d);</span>
<a href="#l67.8"></a><span id="l67.8">     handler.expectedPassword = kValidPassword;</span>
<a href="#l67.9"></a><span id="l67.9">     return handler;</span>
<a href="#l67.10"></a><span id="l67.10">   }</span>
<a href="#l67.11"></a><span id="l67.11">   server = new nsMailServer(createHandler, daemon);</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-  incomingServer = setupLocalServer(NNTP_PORT);</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+  server.start();</span>
<a href="#l67.14"></a><span id="l67.14" class="difflineplus">+  incomingServer = setupLocalServer(server.port);</span>
<a href="#l67.15"></a><span id="l67.15">   folder = incomingServer.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l67.16"></a><span id="l67.16"> </span>
<a href="#l67.17"></a><span id="l67.17">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l67.18"></a><span id="l67.18">   // setup issue.</span>
<a href="#l67.19"></a><span id="l67.19">   do_check_eq(folder.getTotalMessages(false), 0);</span>
<a href="#l67.20"></a><span id="l67.20"> </span>
<a href="#l67.21"></a><span id="l67.21" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineminus">-  server.setDebugLevel(fsDebugAll);</span>
<a href="#l67.23"></a><span id="l67.23">   async_run_tests(tests);</span>
<a href="#l67.24"></a><span id="l67.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpPost.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpPost.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -1,27 +1,26 @@</span>
<a href="#l68.4"></a><span id="l68.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l68.5"></a><span id="l68.5"> // Tests that the news can correctly post messages</span>
<a href="#l68.6"></a><span id="l68.6"> </span>
<a href="#l68.7"></a><span id="l68.7"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l68.8"></a><span id="l68.8"> </span>
<a href="#l68.9"></a><span id="l68.9"> function run_test() {</span>
<a href="#l68.10"></a><span id="l68.10">   var daemon = setupNNTPDaemon();</span>
<a href="#l68.11"></a><span id="l68.11" class="difflineminus">-  var localserver = setupLocalServer(NNTP_PORT);</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineplus">+  var server = makeServer(NNTP_RFC977_handler, daemon);</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+  server.start();</span>
<a href="#l68.14"></a><span id="l68.14" class="difflineplus">+  var localserver = setupLocalServer(server.port);</span>
<a href="#l68.15"></a><span id="l68.15">   var listener = { OnStopRunningUrl: function () {</span>
<a href="#l68.16"></a><span id="l68.16">     localserver.closeCachedConnections();</span>
<a href="#l68.17"></a><span id="l68.17">   }};</span>
<a href="#l68.18"></a><span id="l68.18"> </span>
<a href="#l68.19"></a><span id="l68.19">   // Tests bug 484656.</span>
<a href="#l68.20"></a><span id="l68.20">   localserver.realHostName = localserver.hostName;</span>
<a href="#l68.21"></a><span id="l68.21">   localserver.hostName = &quot;news.example.com&quot;;</span>
<a href="#l68.22"></a><span id="l68.22"> </span>
<a href="#l68.23"></a><span id="l68.23" class="difflineminus">-  var server = makeServer(NNTP_RFC977_handler, daemon);</span>
<a href="#l68.24"></a><span id="l68.24" class="difflineminus">-  server.start(NNTP_PORT);</span>
<a href="#l68.25"></a><span id="l68.25" class="difflineminus">-</span>
<a href="#l68.26"></a><span id="l68.26">   try {</span>
<a href="#l68.27"></a><span id="l68.27">     MailServices.nntp.postMessage(do_get_file(&quot;postings/post1.eml&quot;), &quot;test.empty&quot;,</span>
<a href="#l68.28"></a><span id="l68.28">       localserver.key, listener, null);</span>
<a href="#l68.29"></a><span id="l68.29">     server.performTest();</span>
<a href="#l68.30"></a><span id="l68.30">     server.stop();</span>
<a href="#l68.31"></a><span id="l68.31"> </span>
<a href="#l68.32"></a><span id="l68.32">     var thread = gThreadManager.currentThread;</span>
<a href="#l68.33"></a><span id="l68.33">     while (thread.hasPendingEvents())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpUrl.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpUrl.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -16,15 +16,15 @@ function getMessageHeaderFromUrl(aUrl) {</span>
<a href="#l69.4"></a><span id="l69.4">   return msgUrl.messageHeader;</span>
<a href="#l69.5"></a><span id="l69.5"> }</span>
<a href="#l69.6"></a><span id="l69.6"> </span>
<a href="#l69.7"></a><span id="l69.7"> function run_test() {</span>
<a href="#l69.8"></a><span id="l69.8"> </span>
<a href="#l69.9"></a><span id="l69.9">   // This is crash test for Bug 392729</span>
<a href="#l69.10"></a><span id="l69.10">   try {</span>
<a href="#l69.11"></a><span id="l69.11">     // msgkey is invalid for news:// protocol</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-    let hdr = getMessageHeaderFromUrl(&quot;news://localhost:&quot; + NNTP_PORT +</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+    let hdr = getMessageHeaderFromUrl(&quot;news://localhost:119&quot; +</span>
<a href="#l69.14"></a><span id="l69.14">                                       &quot;/123@example.invalid?group=test.subscribe.simple&amp;key=abcdefghijk&quot;);</span>
<a href="#l69.15"></a><span id="l69.15">     do_check_true(false); </span>
<a href="#l69.16"></a><span id="l69.16">   } catch (e) {</span>
<a href="#l69.17"></a><span id="l69.17">     do_check_eq(e.result, Components.results.NS_ERROR_MALFORMED_URI);</span>
<a href="#l69.18"></a><span id="l69.18">   }</span>
<a href="#l69.19"></a><span id="l69.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/news/test/unit/test_server.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_server.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -7,33 +7,31 @@</span>
<a href="#l70.4"></a><span id="l70.4"> // * We need to hook up mochitest,</span>
<a href="#l70.5"></a><span id="l70.5"> // * TLS negotiation.</span>
<a href="#l70.6"></a><span id="l70.6"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l70.7"></a><span id="l70.7"> </span>
<a href="#l70.8"></a><span id="l70.8"> // The basic daemon to use for testing nntpd.js implementations</span>
<a href="#l70.9"></a><span id="l70.9"> var daemon = setupNNTPDaemon();</span>
<a href="#l70.10"></a><span id="l70.10"> </span>
<a href="#l70.11"></a><span id="l70.11"> // Define these up here for checking with the transaction</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-var type = null;</span>
<a href="#l70.13"></a><span id="l70.13"> var test = null;</span>
<a href="#l70.14"></a><span id="l70.14"> </span>
<a href="#l70.15"></a><span id="l70.15"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l70.16"></a><span id="l70.16"> //                             NNTP SERVER TESTS                              //</span>
<a href="#l70.17"></a><span id="l70.17"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l70.18"></a><span id="l70.18"> // Functions in order as defined in nntpd.js. Each function tests the URLs    //</span>
<a href="#l70.19"></a><span id="l70.19"> // that are located over the implementation of nsNNTPProtocol::LoadURL and    //</span>
<a href="#l70.20"></a><span id="l70.20"> // added in bug 400331. Furthermore, they are tested in rough order as they   //</span>
<a href="#l70.21"></a><span id="l70.21"> // would be expected to be used in a session. If more URL types are modified, //</span>
<a href="#l70.22"></a><span id="l70.22"> // please add a corresponding type to the following tests.                    //</span>
<a href="#l70.23"></a><span id="l70.23"> // When adding new servers, only test the commands that become different for  //</span>
<a href="#l70.24"></a><span id="l70.24"> // each specified server, to keep down redudant tests.                        //</span>
<a href="#l70.25"></a><span id="l70.25"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l70.26"></a><span id="l70.26"> </span>
<a href="#l70.27"></a><span id="l70.27"> function testRFC977() {</span>
<a href="#l70.28"></a><span id="l70.28" class="difflineminus">-  type = &quot;RFC 977&quot;;</span>
<a href="#l70.29"></a><span id="l70.29">   var server = makeServer(NNTP_RFC977_handler, daemon);</span>
<a href="#l70.30"></a><span id="l70.30">   server.start(NNTP_PORT);</span>
<a href="#l70.31"></a><span id="l70.31"> </span>
<a href="#l70.32"></a><span id="l70.32">   try {</span>
<a href="#l70.33"></a><span id="l70.33">     var prefix = &quot;news://localhost:&quot;+NNTP_PORT+&quot;/&quot;;</span>
<a href="#l70.34"></a><span id="l70.34">     var transaction;</span>
<a href="#l70.35"></a><span id="l70.35"> </span>
<a href="#l70.36"></a><span id="l70.36">     // Test - group subscribe listing</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/news/test/unit/xpcshell.ini</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/news/test/unit/xpcshell.ini</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -1,28 +1,29 @@</span>
<a href="#l71.4"></a><span id="l71.4"> [DEFAULT]</span>
<a href="#l71.5"></a><span id="l71.5"> head = head_server_setup.js</span>
<a href="#l71.6"></a><span id="l71.6"> tail = tail_news.js</span>
<a href="#l71.7"></a><span id="l71.7" class="difflineminus">-run-sequentially = Avoid bustage.</span>
<a href="#l71.8"></a><span id="l71.8"> support-files = postings/*</span>
<a href="#l71.9"></a><span id="l71.9"> </span>
<a href="#l71.10"></a><span id="l71.10"> [test_biff.js]</span>
<a href="#l71.11"></a><span id="l71.11"> [test_bug37465.js]</span>
<a href="#l71.12"></a><span id="l71.12"> [test_bug403242.js]</span>
<a href="#l71.13"></a><span id="l71.13"> [test_bug540288.js]</span>
<a href="#l71.14"></a><span id="l71.14"> [test_bug695309.js]</span>
<a href="#l71.15"></a><span id="l71.15" class="difflineplus">+run-sequentially = Restarts server twice--may work but dangerous</span>
<a href="#l71.16"></a><span id="l71.16"> [test_filter.js]</span>
<a href="#l71.17"></a><span id="l71.17"> [test_getNewsMessage.js]</span>
<a href="#l71.18"></a><span id="l71.18"> [test_internalUris.js]</span>
<a href="#l71.19"></a><span id="l71.19"> [test_nntpContentLength.js]</span>
<a href="#l71.20"></a><span id="l71.20"> # The server doesn't support returning sizes! (bug 782629)</span>
<a href="#l71.21"></a><span id="l71.21"> skip-if = true</span>
<a href="#l71.22"></a><span id="l71.22"> [test_newsAutocomplete.js]</span>
<a href="#l71.23"></a><span id="l71.23"> [test_nntpGroupPassword.js]</span>
<a href="#l71.24"></a><span id="l71.24"> [test_nntpPassword.js]</span>
<a href="#l71.25"></a><span id="l71.25"> [test_nntpPassword2.js]</span>
<a href="#l71.26"></a><span id="l71.26"> [test_nntpPassword3.js]</span>
<a href="#l71.27"></a><span id="l71.27"> [test_nntpPasswordFailure.js]</span>
<a href="#l71.28"></a><span id="l71.28"> [test_nntpPost.js]</span>
<a href="#l71.29"></a><span id="l71.29"> [test_nntpProtocols.js]</span>
<a href="#l71.30"></a><span id="l71.30"> [test_nntpUrl.js]</span>
<a href="#l71.31"></a><span id="l71.31"> [test_server.js]</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineplus">+run-sequentially = Uses fixed NNTP_PORT</span>
<a href="#l71.33"></a><span id="l71.33"> [test_uriParser.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/test/fakeserver/maild.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/test/fakeserver/maild.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -87,17 +87,17 @@ const TIMEOUT = 3*60*1000;</span>
<a href="#l72.4"></a><span id="l72.4">  *   thread.processNextEvent(true);</span>
<a href="#l72.5"></a><span id="l72.5">  *</span>
<a href="#l72.6"></a><span id="l72.6">  * do_test_finished();</span>
<a href="#l72.7"></a><span id="l72.7">  *****************************************************************************/</span>
<a href="#l72.8"></a><span id="l72.8"> function nsMailServer(handlerCreator, daemon) {</span>
<a href="#l72.9"></a><span id="l72.9">   this._debug = fsDebugNone;</span>
<a href="#l72.10"></a><span id="l72.10"> </span>
<a href="#l72.11"></a><span id="l72.11">   /** The port on which this server listens. */</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  this._port = undefined;</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+  this._port = -1;</span>
<a href="#l72.14"></a><span id="l72.14"> </span>
<a href="#l72.15"></a><span id="l72.15">   /** The socket associated with this. */</span>
<a href="#l72.16"></a><span id="l72.16">   this._socket = null;</span>
<a href="#l72.17"></a><span id="l72.17"> </span>
<a href="#l72.18"></a><span id="l72.18">   /**</span>
<a href="#l72.19"></a><span id="l72.19">    * True if the socket in this is closed (and closure notifications have been</span>
<a href="#l72.20"></a><span id="l72.20">    * sent and processed if the socket was ever opened), false otherwise.</span>
<a href="#l72.21"></a><span id="l72.21">    */</span>
<a href="#l72.22"></a><span id="l72.22" class="difflineat">@@ -159,21 +159,22 @@ nsMailServer.prototype = {</span>
<a href="#l72.23"></a><span id="l72.23">   },</span>
<a href="#l72.24"></a><span id="l72.24"> </span>
<a href="#l72.25"></a><span id="l72.25">   setDebugLevel : function (debug) {</span>
<a href="#l72.26"></a><span id="l72.26">     this._debug = debug;</span>
<a href="#l72.27"></a><span id="l72.27">     for (var i = 0; i &lt; this._readers.length; i++)</span>
<a href="#l72.28"></a><span id="l72.28">       this._readers[i].setDebugLevel(debug);</span>
<a href="#l72.29"></a><span id="l72.29">   },</span>
<a href="#l72.30"></a><span id="l72.30"> </span>
<a href="#l72.31"></a><span id="l72.31" class="difflineminus">-  start : function (port) {</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineplus">+  start : function (port=-1) {</span>
<a href="#l72.33"></a><span id="l72.33">     if (this._socket)</span>
<a href="#l72.34"></a><span id="l72.34">       throw Cr.NS_ERROR_ALREADY_INITIALIZED;</span>
<a href="#l72.35"></a><span id="l72.35"> </span>
<a href="#l72.36"></a><span id="l72.36" class="difflineminus">-    this._port = port;</span>
<a href="#l72.37"></a><span id="l72.37" class="difflineplus">+    if (port &gt; 0)</span>
<a href="#l72.38"></a><span id="l72.38" class="difflineplus">+      this._port = port;</span>
<a href="#l72.39"></a><span id="l72.39">     this._socketClosed = false;</span>
<a href="#l72.40"></a><span id="l72.40"> </span>
<a href="#l72.41"></a><span id="l72.41">     var socket = new ServerSocket(this._port,</span>
<a href="#l72.42"></a><span id="l72.42">                                   true, // loopback only</span>
<a href="#l72.43"></a><span id="l72.43">                                   -1);  // default number of pending connections</span>
<a href="#l72.44"></a><span id="l72.44"> </span>
<a href="#l72.45"></a><span id="l72.45">     socket.asyncListen(this);</span>
<a href="#l72.46"></a><span id="l72.46">     this._socket = socket;</span>
<a href="#l72.47"></a><span id="l72.47" class="difflineat">@@ -181,32 +182,39 @@ nsMailServer.prototype = {</span>
<a href="#l72.48"></a><span id="l72.48"> </span>
<a href="#l72.49"></a><span id="l72.49">   stop : function () {</span>
<a href="#l72.50"></a><span id="l72.50">     if (!this._socket)</span>
<a href="#l72.51"></a><span id="l72.51">       return;</span>
<a href="#l72.52"></a><span id="l72.52"> </span>
<a href="#l72.53"></a><span id="l72.53">     this._socket.close();</span>
<a href="#l72.54"></a><span id="l72.54">     this._socket = null;</span>
<a href="#l72.55"></a><span id="l72.55"> </span>
<a href="#l72.56"></a><span id="l72.56" class="difflineminus">-    for each (let reader in this._readers)</span>
<a href="#l72.57"></a><span id="l72.57" class="difflineplus">+    for (let reader of this._readers)</span>
<a href="#l72.58"></a><span id="l72.58">       reader._realCloseSocket();</span>
<a href="#l72.59"></a><span id="l72.59"> </span>
<a href="#l72.60"></a><span id="l72.60">     if (this._readers.some(function (e) { return e.observer.forced }))</span>
<a href="#l72.61"></a><span id="l72.61">       return;</span>
<a href="#l72.62"></a><span id="l72.62"> </span>
<a href="#l72.63"></a><span id="l72.63">     // spin an event loop and wait for the socket-close notification</span>
<a href="#l72.64"></a><span id="l72.64">     let thr = Services.tm.currentThread;</span>
<a href="#l72.65"></a><span id="l72.65">     while (!this._socketClosed)</span>
<a href="#l72.66"></a><span id="l72.66">       // Don't wait for the next event, just in case there isn't one.</span>
<a href="#l72.67"></a><span id="l72.67">       thr.processNextEvent(false);</span>
<a href="#l72.68"></a><span id="l72.68">   },</span>
<a href="#l72.69"></a><span id="l72.69">   stopTest : function () {</span>
<a href="#l72.70"></a><span id="l72.70">     this._test = false;</span>
<a href="#l72.71"></a><span id="l72.71">   },</span>
<a href="#l72.72"></a><span id="l72.72"> </span>
<a href="#l72.73"></a><span id="l72.73" class="difflineplus">+  get port() {</span>
<a href="#l72.74"></a><span id="l72.74" class="difflineplus">+    if (this._port == -1) {</span>
<a href="#l72.75"></a><span id="l72.75" class="difflineplus">+      this._port = this._socket.port;</span>
<a href="#l72.76"></a><span id="l72.76" class="difflineplus">+    }</span>
<a href="#l72.77"></a><span id="l72.77" class="difflineplus">+    return this._port;</span>
<a href="#l72.78"></a><span id="l72.78" class="difflineplus">+  },</span>
<a href="#l72.79"></a><span id="l72.79" class="difflineplus">+</span>
<a href="#l72.80"></a><span id="l72.80">   // NSISUPPORTS</span>
<a href="#l72.81"></a><span id="l72.81"> </span>
<a href="#l72.82"></a><span id="l72.82">   //</span>
<a href="#l72.83"></a><span id="l72.83">   // see nsISupports.QueryInterface</span>
<a href="#l72.84"></a><span id="l72.84">   //</span>
<a href="#l72.85"></a><span id="l72.85">   QueryInterface : function (iid) {</span>
<a href="#l72.86"></a><span id="l72.86">     if (iid.equals(Ci.nsIServerSocketListener) ||</span>
<a href="#l72.87"></a><span id="l72.87">         iid.equals(Ci.nsISupports))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/test/resources/IMAPpump.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/test/resources/IMAPpump.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -38,42 +38,39 @@ var Ci = Components.interfaces;</span>
<a href="#l73.4"></a><span id="l73.4"> </span>
<a href="#l73.5"></a><span id="l73.5"> function setupIMAPPump(extensions)</span>
<a href="#l73.6"></a><span id="l73.6"> {</span>
<a href="#l73.7"></a><span id="l73.7">   // Create Application info if we need it.</span>
<a href="#l73.8"></a><span id="l73.8">   updateAppInfo();</span>
<a href="#l73.9"></a><span id="l73.9"> </span>
<a href="#l73.10"></a><span id="l73.10">   // These are copied from imap's head_server.js to here so we can run</span>
<a href="#l73.11"></a><span id="l73.11">   //   this from any directory.</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineminus">-  const IMAP_PORT = 1024 + 143;</span>
<a href="#l73.14"></a><span id="l73.14" class="difflineminus">-</span>
<a href="#l73.15"></a><span id="l73.15">   function makeServer(daemon, infoString) {</span>
<a href="#l73.16"></a><span id="l73.16">     if (infoString in configurations)</span>
<a href="#l73.17"></a><span id="l73.17">       return makeServer(daemon, configurations[infoString].join(&quot;,&quot;));</span>
<a href="#l73.18"></a><span id="l73.18"> </span>
<a href="#l73.19"></a><span id="l73.19">     function createHandler(d) {</span>
<a href="#l73.20"></a><span id="l73.20">       var handler = new IMAP_RFC3501_handler(d);</span>
<a href="#l73.21"></a><span id="l73.21">       if (!infoString)</span>
<a href="#l73.22"></a><span id="l73.22">         infoString = &quot;RFC2195&quot;;</span>
<a href="#l73.23"></a><span id="l73.23"> </span>
<a href="#l73.24"></a><span id="l73.24">       var parts = infoString.split(/ *, */);</span>
<a href="#l73.25"></a><span id="l73.25">       for each (var part in parts) {</span>
<a href="#l73.26"></a><span id="l73.26">         mixinExtension(handler, eval(&quot;IMAP_&quot; + part + &quot;_extension&quot;));</span>
<a href="#l73.27"></a><span id="l73.27">       }</span>
<a href="#l73.28"></a><span id="l73.28">       return handler;</span>
<a href="#l73.29"></a><span id="l73.29">     }</span>
<a href="#l73.30"></a><span id="l73.30">     var server = new nsMailServer(createHandler, daemon);</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-    server.start(IMAP_PORT);</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+    server.start();</span>
<a href="#l73.33"></a><span id="l73.33">     return server;</span>
<a href="#l73.34"></a><span id="l73.34">   }</span>
<a href="#l73.35"></a><span id="l73.35"> </span>
<a href="#l73.36"></a><span id="l73.36">   function createLocalIMAPServer() {</span>
<a href="#l73.37"></a><span id="l73.37" class="difflineminus">-    let server = localAccountUtils.create_incoming_server(&quot;imap&quot;, IMAP_PORT,</span>
<a href="#l73.38"></a><span id="l73.38" class="difflineminus">-							  &quot;user&quot;, &quot;password&quot;);</span>
<a href="#l73.39"></a><span id="l73.39" class="difflineplus">+    let server = localAccountUtils.create_incoming_server(&quot;imap&quot;,</span>
<a href="#l73.40"></a><span id="l73.40" class="difflineplus">+      IMAPPump.server.port, &quot;user&quot;, &quot;password&quot;);</span>
<a href="#l73.41"></a><span id="l73.41">     server.QueryInterface(Ci.nsIImapIncomingServer);</span>
<a href="#l73.42"></a><span id="l73.42">     return server;</span>
<a href="#l73.43"></a><span id="l73.43">   }</span>
<a href="#l73.44"></a><span id="l73.44"> </span>
<a href="#l73.45"></a><span id="l73.45">   // end copy from head_server.js</span>
<a href="#l73.46"></a><span id="l73.46"> </span>
<a href="#l73.47"></a><span id="l73.47">   IMAPPump.daemon = new imapDaemon();</span>
<a href="#l73.48"></a><span id="l73.48">   IMAPPump.server = makeServer(IMAPPump.daemon, extensions);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/test/resources/POP3pump.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/test/resources/POP3pump.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -144,17 +144,20 @@ POP3Pump.prototype._testNext = function </span>
<a href="#l74.4"></a><span id="l74.4">   // the server if something fails.</span>
<a href="#l74.5"></a><span id="l74.5">   try</span>
<a href="#l74.6"></a><span id="l74.6">   {</span>
<a href="#l74.7"></a><span id="l74.7">     if (this._firstFile)</span>
<a href="#l74.8"></a><span id="l74.8">     {</span>
<a href="#l74.9"></a><span id="l74.9">       this._firstFile = false;</span>
<a href="#l74.10"></a><span id="l74.10"> </span>
<a href="#l74.11"></a><span id="l74.11">       // Start the fake POP3 server</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-      this._server.start(this.kPOP3_PORT);</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+      this._server.start();</span>
<a href="#l74.14"></a><span id="l74.14" class="difflineplus">+      this.kPOP3_PORT = this._server.port;</span>
<a href="#l74.15"></a><span id="l74.15" class="difflineplus">+      if (this.fakeServer)</span>
<a href="#l74.16"></a><span id="l74.16" class="difflineplus">+        this.fakeServer.port = this.kPOP3_PORT;</span>
<a href="#l74.17"></a><span id="l74.17">     }</span>
<a href="#l74.18"></a><span id="l74.18">     else</span>
<a href="#l74.19"></a><span id="l74.19">     {</span>
<a href="#l74.20"></a><span id="l74.20">       this._server.resetTest();</span>
<a href="#l74.21"></a><span id="l74.21">     }</span>
<a href="#l74.22"></a><span id="l74.22"> </span>
<a href="#l74.23"></a><span id="l74.23">     // Set up the test</span>
<a href="#l74.24"></a><span id="l74.24">     this._daemon.setMessages(thisFiles);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/test/resources/messageInjection.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/test/resources/messageInjection.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -1,14 +1,20 @@</span>
<a href="#l75.4"></a><span id="l75.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l75.5"></a><span id="l75.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l75.6"></a><span id="l75.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l75.7"></a><span id="l75.7"> </span>
<a href="#l75.8"></a><span id="l75.8"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l75.9"></a><span id="l75.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l75.10"></a><span id="l75.10" class="difflineplus">+try {</span>
<a href="#l75.11"></a><span id="l75.11" class="difflineplus">+  Components.utils.import(&quot;resource://testing-common/mailnews/imapd.js&quot;);</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineplus">+} catch (e) {</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+  // mozmill tests include this file, but they don't have testing-only modules</span>
<a href="#l75.14"></a><span id="l75.14" class="difflineplus">+  // loaded. In this case, they don't get to use IMAP.</span>
<a href="#l75.15"></a><span id="l75.15" class="difflineplus">+}</span>
<a href="#l75.16"></a><span id="l75.16"> </span>
<a href="#l75.17"></a><span id="l75.17"> var gMessageGenerator, gMessageScenarioFactory;</span>
<a href="#l75.18"></a><span id="l75.18"> </span>
<a href="#l75.19"></a><span id="l75.19"> // We can be executed from multiple depths</span>
<a href="#l75.20"></a><span id="l75.20"> // Provide understandable error message</span>
<a href="#l75.21"></a><span id="l75.21"> if (typeof gDEPTH == &quot;undefined&quot;)</span>
<a href="#l75.22"></a><span id="l75.22">   do_throw(&quot;gDEPTH must be defined when using messageInjection.js&quot;);</span>
<a href="#l75.23"></a><span id="l75.23"> </span>
<a href="#l75.24"></a><span id="l75.24" class="difflineat">@@ -102,46 +108,34 @@ function configure_message_injection(aIn</span>
<a href="#l75.25"></a><span id="l75.25">     Services.prefs.setBoolPref(&quot;mail.server.default.autosync_offline_stores&quot;,</span>
<a href="#l75.26"></a><span id="l75.26">                                false);</span>
<a href="#l75.27"></a><span id="l75.27">     // Set the offline property based on the configured setting.  This will</span>
<a href="#l75.28"></a><span id="l75.28">     //  affect newly created folders.</span>
<a href="#l75.29"></a><span id="l75.29">     Services.prefs.setBoolPref(&quot;mail.server.default.offline_download&quot;,</span>
<a href="#l75.30"></a><span id="l75.30">                                mis.injectionConfig.offline);</span>
<a href="#l75.31"></a><span id="l75.31"> </span>
<a href="#l75.32"></a><span id="l75.32">     // Pull in the IMAP fake server code</span>
<a href="#l75.33"></a><span id="l75.33" class="difflineminus">-    load(gDEPTH + &quot;mailnews/imap/test/unit/head_server.js&quot;);</span>
<a href="#l75.34"></a><span id="l75.34" class="difflineplus">+    Components.utils.import(&quot;resource://testing-common/mailnews/IMAPpump.js&quot;);</span>
<a href="#l75.35"></a><span id="l75.35"> </span>
<a href="#l75.36"></a><span id="l75.36">     // set up IMAP fakeserver and incoming server</span>
<a href="#l75.37"></a><span id="l75.37" class="difflineminus">-    mis.daemon = new imapDaemon();</span>
<a href="#l75.38"></a><span id="l75.38" class="difflineminus">-    mis.server = makeServer(mis.daemon, &quot;&quot;);</span>
<a href="#l75.39"></a><span id="l75.39" class="difflineminus">-    mis.incomingServer = createLocalIMAPServer();</span>
<a href="#l75.40"></a><span id="l75.40" class="difflineplus">+    setupIMAPPump(&quot;&quot;);</span>
<a href="#l75.41"></a><span id="l75.41" class="difflineplus">+    mis.daemon = IMAPPump.daemon;</span>
<a href="#l75.42"></a><span id="l75.42" class="difflineplus">+    mis.server = IMAPPump.server;</span>
<a href="#l75.43"></a><span id="l75.43" class="difflineplus">+    mis.incomingServer = IMAPPump.incomingServer;</span>
<a href="#l75.44"></a><span id="l75.44">     //mis.server._debug = 3;</span>
<a href="#l75.45"></a><span id="l75.45"> </span>
<a href="#l75.46"></a><span id="l75.46">     // do not log transactions; it's just a memory leak to us</span>
<a href="#l75.47"></a><span id="l75.47">     mis.server._logTransactions = false;</span>
<a href="#l75.48"></a><span id="l75.48"> </span>
<a href="#l75.49"></a><span id="l75.49" class="difflineminus">-    // we need a local account for the IMAP server to have its sent messages in</span>
<a href="#l75.50"></a><span id="l75.50" class="difflineminus">-    MailServices.accounts.createLocalMailAccount();</span>
<a href="#l75.51"></a><span id="l75.51" class="difflineminus">-</span>
<a href="#l75.52"></a><span id="l75.52">     // We need an identity so that updateFolder doesn't fail</span>
<a href="#l75.53"></a><span id="l75.53" class="difflineminus">-    let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l75.54"></a><span id="l75.54" class="difflineminus">-    let identity = MailServices.accounts.createIdentity();</span>
<a href="#l75.55"></a><span id="l75.55" class="difflineplus">+    let localAccount = MailServices.accounts.defaultAccount;</span>
<a href="#l75.56"></a><span id="l75.56">     // We need an email to protect against random code assuming it exists and</span>
<a href="#l75.57"></a><span id="l75.57">     // throwing exceptions.</span>
<a href="#l75.58"></a><span id="l75.58" class="difflineplus">+    let identity = localAccount.defaultIdentity;</span>
<a href="#l75.59"></a><span id="l75.59">     identity.email = &quot;sender@nul.invalid&quot;;</span>
<a href="#l75.60"></a><span id="l75.60" class="difflineminus">-    localAccount.addIdentity(identity);</span>
<a href="#l75.61"></a><span id="l75.61" class="difflineminus">-    localAccount.defaultIdentity = identity;</span>
<a href="#l75.62"></a><span id="l75.62" class="difflineminus">-    localAccount.incomingServer = mis.incomingServer;</span>
<a href="#l75.63"></a><span id="l75.63" class="difflineminus">-    MailServices.accounts.defaultAccount = localAccount;</span>
<a href="#l75.64"></a><span id="l75.64" class="difflineminus">-</span>
<a href="#l75.65"></a><span id="l75.65" class="difflineminus">-    // Let's also have another account, using the same identity</span>
<a href="#l75.66"></a><span id="l75.66" class="difflineminus">-    let imapAccount = MailServices.accounts.createAccount();</span>
<a href="#l75.67"></a><span id="l75.67" class="difflineminus">-    imapAccount.addIdentity(identity);</span>
<a href="#l75.68"></a><span id="l75.68" class="difflineminus">-    imapAccount.defaultIdentity = identity;</span>
<a href="#l75.69"></a><span id="l75.69" class="difflineminus">-    imapAccount.incomingServer = mis.incomingServer;</span>
<a href="#l75.70"></a><span id="l75.70"> </span>
<a href="#l75.71"></a><span id="l75.71">     // The server doesn't support more than one connection</span>
<a href="#l75.72"></a><span id="l75.72">     Services.prefs.setIntPref(&quot;mail.server.server1.max_cached_connections&quot;, 1);</span>
<a href="#l75.73"></a><span id="l75.73">     // We aren't interested in downloading messages automatically</span>
<a href="#l75.74"></a><span id="l75.74">     Services.prefs.setBoolPref(&quot;mail.server.server1.download_on_biff&quot;, false);</span>
<a href="#l75.75"></a><span id="l75.75"> </span>
<a href="#l75.76"></a><span id="l75.76">     mis.rootFolder = mis.incomingServer.rootMsgFolder;</span>
<a href="#l75.77"></a><span id="l75.77"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

