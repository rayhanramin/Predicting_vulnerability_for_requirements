<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21620:6431fecfdf99c9cf927373c0de46a26c20428f32</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6431fecfdf99c9cf927373c0de46a26c20428f32" />
<meta property="og:url" content="/comm-central/rev/6431fecfdf99c9cf927373c0de46a26c20428f32" />
<meta property="og:description" content="Bug 1351453 - Deprecate the prettiestName attribute of nsIMsgFolder. r=aceman,jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6431fecfdf99c9cf927373c0de46a26c20428f32 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6431fecfdf99c9cf927373c0de46a26c20428f32">shortlog</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6431fecfdf99c9cf927373c0de46a26c20428f32">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32">files</a> |
changeset |
<a href="/comm-central/raw-rev/6431fecfdf99c9cf927373c0de46a26c20428f32">raw</a>  | <a href="/comm-central/archive/6431fecfdf99c9cf927373c0de46a26c20428f32.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1351453">Bug 1351453</a> - Deprecate the prettiestName attribute of nsIMsgFolder. r=aceman,jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#117;&#115;&#104;&#97;&#108;&#32;&#83;&#105;&#110;&#103;&#104;&#32;&#60;&#107;&#117;&#115;&#104;&#97;&#108;&#46;&#115;&#112;&#105;&#100;&#101;&#114;&#109;&#97;&#110;&#46;&#115;&#105;&#110;&#103;&#104;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;&#32;&#97;&#110;&#100;&#32;&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 29 May 2017 03:05:06 +0530</td></tr>

<tr>
 <td>changeset 21620</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6431fecfdf99c9cf927373c0de46a26c20428f32">6431fecfdf99c9cf927373c0de46a26c20428f32</a></td>
</tr>



<tr>
<td>parent 21619</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/390652940243a160294d0082e9d10497c8fdbdbe">390652940243a160294d0082e9d10497c8fdbdbe</a>
</td>
</tr>

<tr>
<td>child 21621</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/57b7bce56f6b5a431672b257798eef387ef836aa">57b7bce56f6b5a431672b257798eef387ef836aa</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6431fecfdf99c9cf927373c0de46a26c20428f32">13176</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 01 Jun 2017 07:13:15 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6431fecfdf99 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6431fecfdf99c9cf927373c0de46a26c20428f32">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6431fecfdf99c9cf927373c0de46a26c20428f32&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6431fecfdf99c9cf927373c0de46a26c20428f32&newProject=comm-central&newRevision=6431fecfdf99c9cf927373c0de46a26c20428f32&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6431fecfdf99c9cf927373c0de46a26c20428f32&newProject=comm-central&newRevision=6431fecfdf99c9cf927373c0de46a26c20428f32&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6431fecfdf99c9cf927373c0de46a26c20428f32&newProject=comm-central&newRevision=6431fecfdf99c9cf927373c0de46a26c20428f32&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1351453">1351453</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1351453">Bug 1351453</a> - Deprecate the prettiestName attribute of nsIMsgFolder. r=aceman,jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/public/nsIMsgFolder.idl">mailnews/base/public/nsIMsgFolder.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/public/nsIMsgFolder.idl">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/public/nsIMsgFolder.idl">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/public/nsIMsgFolder.idl">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/public/nsIMsgFolder.idl">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/public/nsIMsgFolder.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_copyThenMove.js">mailnews/imap/test/unit/test_copyThenMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_copyThenMove.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_copyThenMove.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_copyThenMove.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_copyThenMove.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_copyThenMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAttachmentSaves.js">mailnews/imap/test/unit/test_imapAttachmentSaves.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAttachmentSaves.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAttachmentSaves.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAttachmentSaves.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAttachmentSaves.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAttachmentSaves.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAutoSync.js">mailnews/imap/test/unit/test_imapAutoSync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAutoSync.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAutoSync.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAutoSync.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAutoSync.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapAutoSync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapFolderCopy.js">mailnews/imap/test/unit/test_imapFolderCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapFolderCopy.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapFolderCopy.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapFolderCopy.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapFolderCopy.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapFolderCopy.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">mailnews/imap/test/unit/test_imapStatusCloseDBs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapStatusCloseDBs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapUndo.js">mailnews/imap/test/unit/test_imapUndo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapUndo.js">file</a> |
<a href="/comm-central/annotate/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapUndo.js">annotate</a> |
<a href="/comm-central/diff/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapUndo.js">diff</a> |
<a href="/comm-central/comparison/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapUndo.js">comparison</a> |
<a href="/comm-central/log/6431fecfdf99c9cf927373c0de46a26c20428f32/mailnews/imap/test/unit/test_imapUndo.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/test/unit/test_emptyTrash_dbViewWrapper.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -27,17 +27,17 @@ function* test_empty_trash() {</span>
<a href="#l1.4"></a><span id="l1.4">   yield wait_for_async_promises();</span>
<a href="#l1.5"></a><span id="l1.5">   let trashFolder = get_real_injection_folder(trashHandle);</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">   yield async_view_open(viewWrapper, trashFolder);</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">   yield async_empty_trash();</span>
<a href="#l1.10"></a><span id="l1.10">   verify_empty_view(viewWrapper);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  do_check_neq(null, viewWrapper.displayedFolder);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  do_check_true(viewWrapper.displayedFolder !== null);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">   let [msgSet] = make_new_sets_in_folders([trashHandle], [{count: 1}]);</span>
<a href="#l1.16"></a><span id="l1.16">   yield wait_for_message_injection();</span>
<a href="#l1.17"></a><span id="l1.17">   verify_messages_in_view(msgSet, viewWrapper);</span>
<a href="#l1.18"></a><span id="l1.18"> }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> var tests = [</span>
<a href="#l1.21"></a><span id="l1.21">   test_real_folder_load_and_move_to_trash,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -32,27 +32,35 @@ typedef long nsMsgDispositionState;</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> [scriptable, uuid(5d253ba2-42aa-43a7-b584-0059855ababf)]</span>
<a href="#l2.6"></a><span id="l2.6"> interface nsIMsgFolder : nsISupports {</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">   const nsMsgBiffState nsMsgBiffState_NewMail = 0; // User has new mail waiting.</span>
<a href="#l2.9"></a><span id="l2.9">   const nsMsgBiffState nsMsgBiffState_NoMail =  1; // No new mail is waiting.</span>
<a href="#l2.10"></a><span id="l2.10">   const nsMsgBiffState nsMsgBiffState_Unknown = 2; // We dunno whether there is new mail.</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  /* folder name properties */</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  readonly attribute ACString URI;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  attribute AString name;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  attribute AString prettyName;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  readonly attribute AString abbreviatedName;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  // [deprecated]</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  readonly attribute AString prettiestName;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  attribute nsIMsgFolder parent;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22">   /// Returns an enumerator containing the messages within the current database.</span>
<a href="#l2.23"></a><span id="l2.23">   readonly attribute nsISimpleEnumerator messages;</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">   void startFolderLoading();</span>
<a href="#l2.26"></a><span id="l2.26">   void endFolderLoading();</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">   /* get new headers for db */</span>
<a href="#l2.29"></a><span id="l2.29">   void updateFolder(in nsIMsgWindow aWindow);</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  readonly attribute AString prettiestName;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-</span>
<a href="#l2.33"></a><span id="l2.33">   /**</span>
<a href="#l2.34"></a><span id="l2.34">    * URL for this folder</span>
<a href="#l2.35"></a><span id="l2.35">    */</span>
<a href="#l2.36"></a><span id="l2.36">   readonly attribute ACString folderURL;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">   /**</span>
<a href="#l2.39"></a><span id="l2.39">    * should probably move to the server</span>
<a href="#l2.40"></a><span id="l2.40">    */</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -611,24 +619,16 @@ interface nsIMsgFolder : nsISupports {</span>
<a href="#l2.42"></a><span id="l2.42">   attribute nsIDBFolderInfo dBTransferInfo;</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">   ACString getStringProperty(in string propertyName);</span>
<a href="#l2.45"></a><span id="l2.45">   void setStringProperty(in string propertyName, in ACString propertyValue);</span>
<a href="#l2.46"></a><span id="l2.46"> </span>
<a href="#l2.47"></a><span id="l2.47">   /* does not persist across sessions */</span>
<a href="#l2.48"></a><span id="l2.48">   attribute nsMsgKey lastMessageLoaded;</span>
<a href="#l2.49"></a><span id="l2.49"> </span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-  /* old nsIFolder properties and methods */</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-  readonly attribute ACString URI;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-  attribute AString name;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-  attribute AString prettyName;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-  readonly attribute AString abbreviatedName;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-  attribute nsIMsgFolder parent;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-</span>
<a href="#l2.58"></a><span id="l2.58">   /**</span>
<a href="#l2.59"></a><span id="l2.59">    * Returns an enumerator containing a list of nsIMsgFolder items that are</span>
<a href="#l2.60"></a><span id="l2.60">    * subfolders of the instance this is called on.</span>
<a href="#l2.61"></a><span id="l2.61">    */</span>
<a href="#l2.62"></a><span id="l2.62">   readonly attribute nsISimpleEnumerator subFolders;</span>
<a href="#l2.63"></a><span id="l2.63"> </span>
<a href="#l2.64"></a><span id="l2.64">   /**</span>
<a href="#l2.65"></a><span id="l2.65">    * Returns true if this folder has sub folders.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -64,16 +64,18 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &lt;algorithm&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> #define oneHour 3600000000U</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsIMsgFilter.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#include &quot;nsIConsoleService.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;nsIScriptError.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> static PRTime gtimeOfLastPurgeCheck;    //variable to know when to check for purge_threshhold</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> #define PREF_MAIL_PROMPT_PURGE_THRESHOLD &quot;mail.prompt_purge_threshhold&quot;</span>
<a href="#l3.18"></a><span id="l3.18"> #define PREF_MAIL_PURGE_THRESHOLD &quot;mail.purge_threshhold&quot;</span>
<a href="#l3.19"></a><span id="l3.19"> #define PREF_MAIL_PURGE_THRESHOLD_MB &quot;mail.purge_threshhold_mb&quot;</span>
<a href="#l3.20"></a><span id="l3.20"> #define PREF_MAIL_PURGE_MIGRATED &quot;mail.purge_threshold_migrated&quot;</span>
<a href="#l3.21"></a><span id="l3.21"> #define PREF_MAIL_PURGE_ASK &quot;mail.purge.ask&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -3530,16 +3532,33 @@ NS_IMETHODIMP nsMsgDBFolder::GetChildWit</span>
<a href="#l3.23"></a><span id="l3.23">       }</span>
<a href="#l3.24"></a><span id="l3.24">     }</span>
<a href="#l3.25"></a><span id="l3.25">   }</span>
<a href="#l3.26"></a><span id="l3.26">   return NS_OK;</span>
<a href="#l3.27"></a><span id="l3.27"> }</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> NS_IMETHODIMP nsMsgDBFolder::GetPrettiestName(nsAString&amp; name)</span>
<a href="#l3.30"></a><span id="l3.30"> {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  if (NS_IsMainThread()) {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    nsCOMPtr&lt;nsIConsoleService&gt; cs = do_GetService(NS_CONSOLESERVICE_CONTRACTID);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    if (cs) {</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+      nsCString msg(__FUNCTION__);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+      msg.AppendLiteral(&quot; is deprecated and will be removed soon.&quot;);</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+      nsCOMPtr&lt;nsIScriptError&gt; e = do_CreateInstance(NS_SCRIPTERROR_CONTRACTID);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+      if (e &amp;&amp; NS_SUCCEEDED(e-&gt;Init(NS_ConvertUTF8toUTF16(msg), EmptyString(),</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+                                    EmptyString(), 0, 0,</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+                                    nsIScriptError::warningFlag, &quot;mailnews&quot;))) {</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+        cs-&gt;LogMessage(e);</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+      }</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+    }</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+  }</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  NS_WARNING(&quot;You are trying to use the deprecated attribute 'prettiestName'.&quot;);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+</span>
<a href="#l3.48"></a><span id="l3.48">   if (NS_SUCCEEDED(GetPrettyName(name)))</span>
<a href="#l3.49"></a><span id="l3.49">     return NS_OK;</span>
<a href="#l3.50"></a><span id="l3.50">   return GetName(name);</span>
<a href="#l3.51"></a><span id="l3.51"> }</span>
<a href="#l3.52"></a><span id="l3.52"> </span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54"> NS_IMETHODIMP nsMsgDBFolder::GetShowDeletedMessages(bool *showDeletedMessages)</span>
<a href="#l3.55"></a><span id="l3.55"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_cleanup_msf_databases.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -48,35 +48,35 @@ function* test_msf_closure() {</span>
<a href="#l4.4"></a><span id="l4.4">  *</span>
<a href="#l4.5"></a><span id="l4.5">  * @param aSynthMessage The synthetic message we indexed.</span>
<a href="#l4.6"></a><span id="l4.6">  * @param aGlodaMessage Its exciting gloda representation</span>
<a href="#l4.7"></a><span id="l4.7">  */</span>
<a href="#l4.8"></a><span id="l4.8"> function poke_and_verify_msf_closure(aSynthMessage, aGlodaMessage) {</span>
<a href="#l4.9"></a><span id="l4.9">   // get the nsIMsgDBHdr</span>
<a href="#l4.10"></a><span id="l4.10">   let header = aGlodaMessage.folderMessage;</span>
<a href="#l4.11"></a><span id="l4.11">   // if we don't have a header, this test is unlikely to work...</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  do_check_neq(header, null);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  do_check_true(header !== null);</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">   // we need a reference to the glodaFolder</span>
<a href="#l4.16"></a><span id="l4.16">   let glodaFolder = aGlodaMessage.folder;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">   // -- check that everyone is tracking things correctly</span>
<a href="#l4.19"></a><span id="l4.19">   // the message's folder should be holding an XPCOM reference to the folder</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  do_check_neq(glodaFolder._xpcomFolder, null);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  do_check_true(glodaFolder._xpcomFolder !== null);</span>
<a href="#l4.22"></a><span id="l4.22">   // the cleanup timer should now be alive</span>
<a href="#l4.23"></a><span id="l4.23">   do_check_true(GlodaDatastore._folderCleanupActive);</span>
<a href="#l4.24"></a><span id="l4.24">   // live folder count should be one</span>
<a href="#l4.25"></a><span id="l4.25">   do_check_eq(1, getLiveFolderCount());</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27">   // -- simulate a timer cleanup firing...</span>
<a href="#l4.28"></a><span id="l4.28">   GlodaDatastore._performFolderCleanup();</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">   // -- verify that things are still as they were before the cleanup firing</span>
<a href="#l4.31"></a><span id="l4.31">   // the message's folder should be holding an XPCOM reference to the folder</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-  do_check_neq(glodaFolder._xpcomFolder, null);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+  do_check_true(glodaFolder._xpcomFolder !== null);</span>
<a href="#l4.34"></a><span id="l4.34">   // the cleanup timer should now be alive</span>
<a href="#l4.35"></a><span id="l4.35">   do_check_true(GlodaDatastore._folderCleanupActive);</span>
<a href="#l4.36"></a><span id="l4.36">   // live folder count should be one</span>
<a href="#l4.37"></a><span id="l4.37">   do_check_eq(1, getLiveFolderCount());</span>
<a href="#l4.38"></a><span id="l4.38"> </span>
<a href="#l4.39"></a><span id="l4.39">   // -- change oldness constant so that it cannot help but be true</span>
<a href="#l4.40"></a><span id="l4.40">   // (the goal is to avoid getting tricked by the granularity of the timer</span>
<a href="#l4.41"></a><span id="l4.41">   //  updates, as well as to make sure our logic is right by skewing the</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineat">@@ -85,17 +85,17 @@ function poke_and_verify_msf_closure(aSy</span>
<a href="#l4.43"></a><span id="l4.43">   //  the future, for obvious reasons.</span>
<a href="#l4.44"></a><span id="l4.44">   GlodaFolder.prototype.ACCEPTABLY_OLD_THRESHOLD = -1000000;</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">   // -- simulate a timer cleanup firing...</span>
<a href="#l4.47"></a><span id="l4.47">   GlodaDatastore._performFolderCleanup();</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49">   // -- verify that cleanup has occurred and the cleanup mechanism shutdown.</span>
<a href="#l4.50"></a><span id="l4.50">   // the message's folder should no longer be holding an XPCOM reference</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-  do_check_eq(glodaFolder._xpcomFolder, null);</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+  do_check_true(glodaFolder._xpcomFolder === null);</span>
<a href="#l4.53"></a><span id="l4.53">   // the cleanup timer should now be dead</span>
<a href="#l4.54"></a><span id="l4.54">   do_check_false(GlodaDatastore._folderCleanupActive);</span>
<a href="#l4.55"></a><span id="l4.55">   // live folder count should be zero</span>
<a href="#l4.56"></a><span id="l4.56">   do_check_eq(0, getLiveFolderCount());</span>
<a href="#l4.57"></a><span id="l4.57"> }</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59"> var tests = [</span>
<a href="#l4.60"></a><span id="l4.60">   test_msf_closure,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -75,19 +75,19 @@ var tests = [</span>
<a href="#l5.4"></a><span id="l5.4">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l5.5"></a><span id="l5.5">     folder2.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l5.6"></a><span id="l5.6">     yield false;</span>
<a href="#l5.7"></a><span id="l5.7">   },</span>
<a href="#l5.8"></a><span id="l5.8">   function verifyFolders() {</span>
<a href="#l5.9"></a><span id="l5.9">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l5.10"></a><span id="l5.10">     do_check_eq(folderCount(folder1), 2);</span>
<a href="#l5.11"></a><span id="l5.11">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    do_check_neq(folder2, null);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    do_check_true(folder2 !== null);</span>
<a href="#l5.14"></a><span id="l5.14">     // folder 1 and 2 should each now have two messages in them.</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-    do_check_neq(folder1, null);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+    do_check_true(folder1 !== null);</span>
<a href="#l5.17"></a><span id="l5.17">     do_check_eq(folderCount(folder2), 2);</span>
<a href="#l5.18"></a><span id="l5.18">     // The local inbox folder should now be empty, since the second</span>
<a href="#l5.19"></a><span id="l5.19">     // operation was a move.</span>
<a href="#l5.20"></a><span id="l5.20">     do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l5.21"></a><span id="l5.21">   },</span>
<a href="#l5.22"></a><span id="l5.22">   teardown</span>
<a href="#l5.23"></a><span id="l5.23"> ];</span>
<a href="#l5.24"></a><span id="l5.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_gmailOfflineMsgStore.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -180,17 +180,17 @@ function* crossStreaming() {</span>
<a href="#l6.4"></a><span id="l6.4">   /**</span>
<a href="#l6.5"></a><span id="l6.5">    * Streaming message1 from fooFolder. message1 is present in</span>
<a href="#l6.6"></a><span id="l6.6">    * offline store of inbox. We now test that streaming the message1</span>
<a href="#l6.7"></a><span id="l6.7">    * from fooFolder does not make us add message1 to offline store of</span>
<a href="#l6.8"></a><span id="l6.8">    * fooFolder. We check this by comparing the sizes of inbox and fooFolder</span>
<a href="#l6.9"></a><span id="l6.9">    * before and after streaming.</span>
<a href="#l6.10"></a><span id="l6.10">    */</span>
<a href="#l6.11"></a><span id="l6.11">   let msg2 = fooFolder.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  do_check_neq(msg2, null);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  do_check_true(msg2 !== null);</span>
<a href="#l6.14"></a><span id="l6.14">   let msgURI = fooFolder.getUriForMsg(msg2);</span>
<a href="#l6.15"></a><span id="l6.15">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l6.16"></a><span id="l6.16">   let msgServ = messenger.messageServiceFromURI(msgURI);</span>
<a href="#l6.17"></a><span id="l6.17">   // pass true for aLocalOnly since message should be in offline store of Inbox.</span>
<a href="#l6.18"></a><span id="l6.18">   msgServ.streamMessage(msgURI, gStreamListener, null, null, false, &quot;&quot;, true);</span>
<a href="#l6.19"></a><span id="l6.19">   gFooOfflineStoreSizeFinal = fooFolder.filePath.fileSize;</span>
<a href="#l6.20"></a><span id="l6.20">   gImapInboxOfflineStoreSizeFinal = IMAPPump.inbox.filePath.fileSize;</span>
<a href="#l6.21"></a><span id="l6.21">   do_check_eq(gFooOfflineStoreSizeFinal, gFooOfflineStoreSizeInitial);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAttachmentSaves.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -97,17 +97,17 @@ function* testDetach()</span>
<a href="#l7.4"></a><span id="l7.4">   checkFile.append(kAttachFileName);</span>
<a href="#l7.5"></a><span id="l7.5">   do_check_true(checkFile.exists());</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   // The message should now have a detached attachment. Read the message,</span>
<a href="#l7.8"></a><span id="l7.8">   //  and search for &quot;AttachmentDetached&quot; which is added on detachment.</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">   // Get the message header - detached copy has UID 2.</span>
<a href="#l7.11"></a><span id="l7.11">   let msgHdr = IMAPPump.inbox.GetMessageHeader(2);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  do_check_neq(msgHdr, null);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  do_check_true(msgHdr !== null);</span>
<a href="#l7.14"></a><span id="l7.14">   let messageContent = getContentFromMessage(msgHdr);</span>
<a href="#l7.15"></a><span id="l7.15">   do_check_true(messageContent.includes(&quot;AttachmentDetached&quot;));</span>
<a href="#l7.16"></a><span id="l7.16"> }</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> // Cleanup</span>
<a href="#l7.19"></a><span id="l7.19"> function endTest()</span>
<a href="#l7.20"></a><span id="l7.20"> {</span>
<a href="#l7.21"></a><span id="l7.21">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -86,17 +86,17 @@ function test_triggerAutoSyncIdle()</span>
<a href="#l8.4"></a><span id="l8.4"> }</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> // move the message to a diffent folder</span>
<a href="#l8.7"></a><span id="l8.7"> function* test_moveMessageToTargetFolder()</span>
<a href="#l8.8"></a><span id="l8.8"> {</span>
<a href="#l8.9"></a><span id="l8.9">   let observer = gAutoSyncManager.QueryInterface(Ci.nsIObserver);</span>
<a href="#l8.10"></a><span id="l8.10">   observer.observe(null, &quot;mail:appIdle&quot;, &quot;back&quot;);</span>
<a href="#l8.11"></a><span id="l8.11">   let msgHdr = mailTestUtils.firstMsgHdr(IMAPPump.inbox);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  do_check_neq(msgHdr, null);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  do_check_true(msgHdr !== null);</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   // Now move this message to the target folder.</span>
<a href="#l8.16"></a><span id="l8.16">   let messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l8.17"></a><span id="l8.17">                    .createInstance(Ci.nsIMutableArray);</span>
<a href="#l8.18"></a><span id="l8.18">   messages.appendElement(msgHdr, false);</span>
<a href="#l8.19"></a><span id="l8.19">   MailServices.copy.CopyMessages(IMAPPump.inbox, messages, gTargetFolder, true,</span>
<a href="#l8.20"></a><span id="l8.20">                                  asyncCopyListener, null, false);</span>
<a href="#l8.21"></a><span id="l8.21">   yield false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFolderCopy.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -40,19 +40,19 @@ var tests = [</span>
<a href="#l9.4"></a><span id="l9.4">   },</span>
<a href="#l9.5"></a><span id="l9.5">   function verifyFolders() {</span>
<a href="#l9.6"></a><span id="l9.6">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l9.7"></a><span id="l9.7">     dump(&quot;found folder1\n&quot;);</span>
<a href="#l9.8"></a><span id="l9.8">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l9.9"></a><span id="l9.9">     dump(&quot;found folder2\n&quot;);</span>
<a href="#l9.10"></a><span id="l9.10">     let folder3 = IMAPPump.inbox.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l9.11"></a><span id="l9.11">     dump(&quot;found folder3\n&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    do_check_neq(folder1, null);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-    do_check_neq(folder2, null);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-    do_check_neq(folder3, null);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+    do_check_true(folder1 !== null);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+    do_check_true(folder2 !== null);</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+    do_check_true(folder3 !== null);</span>
<a href="#l9.18"></a><span id="l9.18">   },</span>
<a href="#l9.19"></a><span id="l9.19">   function* moveImapFolder1() {</span>
<a href="#l9.20"></a><span id="l9.20">     let folders = new Array;</span>
<a href="#l9.21"></a><span id="l9.21">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l9.22"></a><span id="l9.22">     let folder2 = IMAPPump.inbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l9.23"></a><span id="l9.23">     folders.push(folder2.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l9.24"></a><span id="l9.24">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l9.25"></a><span id="l9.25">     MailServices.copy.CopyFolders(array, folder1, true, CopyListener, null);</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineat">@@ -69,19 +69,19 @@ var tests = [</span>
<a href="#l9.27"></a><span id="l9.27">   },</span>
<a href="#l9.28"></a><span id="l9.28">   function verifyImapFolders() {</span>
<a href="#l9.29"></a><span id="l9.29">     let folder1 = IMAPPump.inbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l9.30"></a><span id="l9.30">     dump(&quot;found folder1\n&quot;);</span>
<a href="#l9.31"></a><span id="l9.31">     let folder2 = folder1.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l9.32"></a><span id="l9.32">     dump(&quot;found folder2\n&quot;);</span>
<a href="#l9.33"></a><span id="l9.33">     let folder3 = folder1.getChildNamed(&quot;empty 3&quot;);</span>
<a href="#l9.34"></a><span id="l9.34">     dump(&quot;found folder3\n&quot;);</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-    do_check_neq(folder1, null);</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-    do_check_neq(folder2, null);</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-    do_check_neq(folder3, null);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+    do_check_true(folder1 !== null);</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+    do_check_true(folder2 !== null);</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+    do_check_true(folder3 !== null);</span>
<a href="#l9.41"></a><span id="l9.41">   },</span>
<a href="#l9.42"></a><span id="l9.42">   function* testImapFolderCopyFailure() {</span>
<a href="#l9.43"></a><span id="l9.43">     let folders = new Array;</span>
<a href="#l9.44"></a><span id="l9.44">     folders.push(gNotEmptyLocal4.QueryInterface(Ci.nsIMsgFolder));</span>
<a href="#l9.45"></a><span id="l9.45">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l9.46"></a><span id="l9.46">     IMAPPump.daemon.commandToFail = &quot;APPEND&quot;;</span>
<a href="#l9.47"></a><span id="l9.47">     // we expect NS_MSG_ERROR_IMAP_COMMAND_FAILED;</span>
<a href="#l9.48"></a><span id="l9.48">     CopyListener._expectedStatus = 0x80550021;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapStatusCloseDBs.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapStatusCloseDBs.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -33,19 +33,19 @@ function* setup() {</span>
<a href="#l10.4"></a><span id="l10.4">   IMAPPump.server.performTest(&quot;STATUS&quot;);</span>
<a href="#l10.5"></a><span id="l10.5">   mailTestUtils.do_timeout_function(1000, async_driver);</span>
<a href="#l10.6"></a><span id="l10.6">   yield false;</span>
<a href="#l10.7"></a><span id="l10.7"> }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> function check() {</span>
<a href="#l10.10"></a><span id="l10.10">   const gDbService = Cc[&quot;@mozilla.org/msgDatabase/msgDBService;1&quot;]</span>
<a href="#l10.11"></a><span id="l10.11">                        .getService(Ci.nsIMsgDBService);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  do_check_neq(gDbService.cachedDBForFolder(IMAPPump.inbox), null);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-  do_check_eq(gDbService.cachedDBForFolder(gFolder1), null);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-  do_check_eq(gDbService.cachedDBForFolder(gFolder2), null);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+  do_check_true(gDbService.cachedDBForFolder(IMAPPump.inbox) !== null);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  do_check_true(gDbService.cachedDBForFolder(gFolder1) === null);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+  do_check_true(gDbService.cachedDBForFolder(gFolder2) === null);</span>
<a href="#l10.18"></a><span id="l10.18"> }</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> function teardown() {</span>
<a href="#l10.21"></a><span id="l10.21">   teardownIMAPPump();</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24"> function run_test() {</span>
<a href="#l10.25"></a><span id="l10.25">   async_run_tests(tests);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapUndo.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -94,17 +94,17 @@ var tests = [</span>
<a href="#l11.4"></a><span id="l11.4">     yield false;</span>
<a href="#l11.5"></a><span id="l11.5">   },</span>
<a href="#l11.6"></a><span id="l11.6">   function* goBackToInbox() {</span>
<a href="#l11.7"></a><span id="l11.7">     IMAPPump.inbox.updateFolderWithListener(gMsgWindow, asyncUrlListener);</span>
<a href="#l11.8"></a><span id="l11.8">     yield false;</span>
<a href="#l11.9"></a><span id="l11.9">   },</span>
<a href="#l11.10"></a><span id="l11.10">   function verifyFolders() {</span>
<a href="#l11.11"></a><span id="l11.11">     let msgRestored = IMAPPump.inbox.msgDatabase.getMsgHdrForMessageID(gMsgId1);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    do_check_neq(msgRestored, null);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    do_check_true(msgRestored !== null);</span>
<a href="#l11.14"></a><span id="l11.14">     do_check_eq(IMAPPump.inbox.msgDatabase.dBFolderInfo.numMessages, 4);</span>
<a href="#l11.15"></a><span id="l11.15">   },</span>
<a href="#l11.16"></a><span id="l11.16">   teardown</span>
<a href="#l11.17"></a><span id="l11.17"> ];</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> function setup() {</span>
<a href="#l11.20"></a><span id="l11.20">   setupIMAPPump();</span>
<a href="#l11.21"></a><span id="l11.21"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

