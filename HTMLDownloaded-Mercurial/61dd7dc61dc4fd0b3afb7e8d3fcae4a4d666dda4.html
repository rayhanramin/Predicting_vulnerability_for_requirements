<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 16769:61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4" />
<meta property="og:url" content="/comm-central/rev/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4" />
<meta property="og:description" content="Fix bug 1063085 - Get rid of calIDateTime::jsDate. r=Standard8 CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">shortlog</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">files</a> |
changeset |
<a href="/comm-central/raw-rev/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">raw</a>  | <a href="/comm-central/archive/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1063085">bug 1063085</a> - Get rid of calIDateTime::jsDate. r=Standard8 CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 04 Sep 2014 22:09:44 +0200</td></tr>

<tr>
 <td>changeset 16769</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4</a></td>
</tr>



<tr>
<td>parent 16768</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a8b23b49d30ff867b802dc8081961a63cf033a8e">a8b23b49d30ff867b802dc8081961a63cf033a8e</a>
</td>
</tr>

<tr>
<td>child 16770</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cb30b3acc3634dac6f133c916802ec4049e01c24">cb30b3acc3634dac6f133c916802ec4049e01c24</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">10434</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Mon, 08 Sep 2014 21:38:51 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@61dd7dc61dc4 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&newProject=comm-central&newRevision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&newProject=comm-central&newRevision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&newProject=comm-central&newRevision=61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1063085">1063085</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1063085">bug 1063085</a> - Get rid of calIDateTime::jsDate. r=Standard8 CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calDateTime.js">calendar/base/backend/icaljs/calDateTime.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calDateTime.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calDateTime.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calDateTime.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calDateTime.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calDateTime.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calIDateTimeJS.idl">calendar/base/backend/icaljs/calIDateTimeJS.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calIDateTimeJS.idl">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calIDateTimeJS.idl">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/calIDateTimeJS.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/icaljs.manifest">calendar/base/backend/icaljs/icaljs.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/icaljs.manifest">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/icaljs.manifest">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/icaljs.manifest">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/icaljs.manifest">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/icaljs.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/moz.build">calendar/base/backend/icaljs/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/moz.build">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/moz.build">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/moz.build">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/moz.build">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/icaljs/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/build/libical.manifest">calendar/base/backend/libical/build/libical.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/build/libical.manifest">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/build/libical.manifest">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/build/libical.manifest">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/build/libical.manifest">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/build/libical.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calDateTime.cpp">calendar/base/backend/libical/calDateTime.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calDateTime.cpp">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calDateTime.cpp">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calDateTime.cpp">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calDateTime.cpp">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calDateTime.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calIDateTime.idl">calendar/base/backend/libical/calIDateTime.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calIDateTime.idl">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calIDateTime.idl">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calIDateTime.idl">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calIDateTime.idl">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/calIDateTime.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/moz.build">calendar/base/backend/libical/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/moz.build">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/moz.build">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/moz.build">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/moz.build">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/backend/libical/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">calendar/base/content/dialogs/calendar-event-dialog-timezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog.js">calendar/base/content/dialogs/calendar-event-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-event-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/calIDateTime.idl">calendar/base/public/calIDateTime.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/calIDateTime.idl">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/calIDateTime.idl">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/calIDateTime.idl">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/calIDateTime.idl">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/calIDateTime.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/moz.build">calendar/base/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/moz.build">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/moz.build">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/moz.build">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/moz.build">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/providers/wcap/calWcapUtils.js">calendar/providers/wcap/calWcapUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/providers/wcap/calWcapUtils.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/providers/wcap/calWcapUtils.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/providers/wcap/calWcapUtils.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/providers/wcap/calWcapUtils.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/providers/wcap/calWcapUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_bug272411.js">calendar/test/unit/test_bug272411.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_bug272411.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_bug272411.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_bug272411.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_bug272411.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_bug272411.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime.js">calendar/test/unit/test_datetime.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime_before_1970.js">calendar/test/unit/test_datetime_before_1970.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime_before_1970.js">file</a> |
<a href="/comm-central/annotate/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime_before_1970.js">annotate</a> |
<a href="/comm-central/diff/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime_before_1970.js">diff</a> |
<a href="/comm-central/comparison/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime_before_1970.js">comparison</a> |
<a href="/comm-central/log/61dd7dc61dc4fd0b3afb7e8d3fcae4a4d666dda4/calendar/test/unit/test_datetime_before_1970.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calDateTime.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calDateTime.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -111,13 +111,10 @@ calDateTime.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">     set icalString(val) {</span>
<a href="#l1.5"></a><span id="l1.5">         let jcalString;</span>
<a href="#l1.6"></a><span id="l1.6">         if (val.length &gt; 10) {</span>
<a href="#l1.7"></a><span id="l1.7">            jcalString = ICAL.design.value[&quot;date-time&quot;].fromICAL(val);</span>
<a href="#l1.8"></a><span id="l1.8">         } else {</span>
<a href="#l1.9"></a><span id="l1.9">            jcalString = ICAL.design.value.date.fromICAL(val);</span>
<a href="#l1.10"></a><span id="l1.10">         }</span>
<a href="#l1.11"></a><span id="l1.11">         this.innerObject = ICAL.Time.fromString(jcalString);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    },</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    get jsDate() this.innerObject.toJSDate(),</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-    set jsDate(val) this.innerObject.fromJSDate(val, true)</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+    }</span>
<a href="#l1.17"></a><span id="l1.17"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/backend/icaljs/icaljs.manifest</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/icaljs.manifest</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -10,10 +10,8 @@ contract @mozilla.org/calendar/ics-servi</span>
<a href="#l2.4"></a><span id="l2.4"> component {394a281f-7299-45f7-8b1f-cce21258972f} calICALJSComponents.js</span>
<a href="#l2.5"></a><span id="l2.5"> contract @mozilla.org/calendar/period;1 {394a281f-7299-45f7-8b1f-cce21258972f}</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> component {df19281a-5389-4146-b941-798cb93a7f0d} calICALJSComponents.js</span>
<a href="#l2.8"></a><span id="l2.8"> contract @mozilla.org/calendar/recurrence-rule;1 {df19281a-5389-4146-b941-798cb93a7f0d}</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> component {6702eb17-a968-4b43-b562-0d0c5f8e9eb5} calICALJSComponents.js</span>
<a href="#l2.11"></a><span id="l2.11"> contract @mozilla.org/calendar/timezone;1 {6702eb17-a968-4b43-b562-0d0c5f8e9eb5}</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-interfaces caldatetime_icaljs.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/backend/icaljs/moz.build</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/moz.build</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,15 +1,8 @@</span>
<a href="#l3.4"></a><span id="l3.4"> # vim: set filetype=python:</span>
<a href="#l3.5"></a><span id="l3.5"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-    'calIDateTimeJS.idl',</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-]</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-XPIDL_MODULE = 'caldatetime_icaljs'</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-</span>
<a href="#l3.15"></a><span id="l3.15"> EXTRA_COMPONENTS += [</span>
<a href="#l3.16"></a><span id="l3.16">     'calICALJSComponents.js',</span>
<a href="#l3.17"></a><span id="l3.17"> ]</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/backend/libical/build/libical.manifest</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/backend/libical/build/libical.manifest</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,2 +1,1 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #expand binary-component __SHARED_LIBRARY__</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-interfaces caldatetime_libical.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/backend/libical/calDateTime.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/backend/libical/calDateTime.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -587,52 +587,8 @@ calDateTime::Compare(calIDateTime * aOth</span>
<a href="#l5.4"></a><span id="l5.4">     if (mIsDate || otherIsDate) {</span>
<a href="#l5.5"></a><span id="l5.5">         *aResult = icaltime_compare_date_only_tz(a, b, cal::getIcalTimezone(mTimezone));</span>
<a href="#l5.6"></a><span id="l5.6">     } else {</span>
<a href="#l5.7"></a><span id="l5.7">         *aResult = icaltime_compare(a, b);</span>
<a href="#l5.8"></a><span id="l5.8">     }</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">     return NS_OK;</span>
<a href="#l5.11"></a><span id="l5.11"> }</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-calDateTime::GetJsDate(JSContext* aCx, JS::MutableHandleValue aResult)</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-{</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-    double msec = double(mNativeTime / 1000);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-    ensureTimezone();</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-    JSObject* obj;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-    bool b;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-    if (NS_SUCCEEDED(mTimezone-&gt;GetIsFloating(&amp;b)) &amp;&amp; b) {</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-        obj = JS_NewDateObject(aCx, mYear, mMonth, mDay, mHour, mMinute, mSecond);</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-    } else {</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-        obj = JS_NewDateObjectMsec(aCx, msec);</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-    }</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-    aResult.set(JS::ObjectOrNullValue(obj));</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-}</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-calDateTime::SetJsDate(JSContext* aCx, JS::HandleValue aDate)</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-{</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-    if (!aDate.isObject()) {</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-        mIsValid = false;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-        return NS_OK;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-    }</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-    JS::Rooted&lt;JSObject*&gt; dobj(aCx, &amp;aDate.toObject());</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-    dobj = js::CheckedUnwrap(dobj);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-    if (!dobj) {</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-        mIsValid = false;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-        return NS_OK;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-    }</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-    JSAutoCompartment ac(aCx, dobj);</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-    if (!JS_ObjectIsDate(aCx, dobj) || !js_DateIsValid(dobj)) {</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-        mIsValid = false;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-        return NS_OK;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-    }</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-    PRTime utcTime = PRTime(js_DateGetMsecSinceEpoch(dobj)) * 1000;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-    mIsValid = NS_SUCCEEDED(SetNativeTime(utcTime));</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/backend/libical/calIDateTime.idl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/backend/libical/calIDateTime.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -218,18 +218,9 @@ interface calIDateTime : nsISupports</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   [noscript,notxpcom] void toIcalTime(in icaltimetypeptr itt);</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">   /**</span>
<a href="#l6.8"></a><span id="l6.8">    * This object as either an iCalendar DATE or DATETIME string, as</span>
<a href="#l6.9"></a><span id="l6.9">    * appropriate and sets the timezone to either UTC or floating.</span>
<a href="#l6.10"></a><span id="l6.10">    */</span>
<a href="#l6.11"></a><span id="l6.11">   attribute ACString icalString;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  /**</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-   * Setting jsDate via a JavaScript Date object will set</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-   * the calIDateTime to the jsDate's time ***in UTC***.</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-   * There's no way for us to recover TZ info from a jsDate,</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-   * so we always pull it out as UTC, and force the calIDateTime's</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-   * timezone to UTC.</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-   */</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-  [implicit_jscontext] attribute jsval jsDate;</span>
<a href="#l6.21"></a><span id="l6.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/backend/libical/moz.build</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/backend/libical/moz.build</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -2,26 +2,19 @@</span>
<a href="#l7.4"></a><span id="l7.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> DIRS = [</span>
<a href="#l7.9"></a><span id="l7.9">     'build'</span>
<a href="#l7.10"></a><span id="l7.10"> ]</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    'calIDateTime.idl',</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-]</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-XPIDL_MODULE = 'caldatetime_libical'</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-</span>
<a href="#l7.18"></a><span id="l7.18"> SOURCES += [</span>
<a href="#l7.19"></a><span id="l7.19">     'calDateTime.cpp',</span>
<a href="#l7.20"></a><span id="l7.20">     'calDuration.cpp',</span>
<a href="#l7.21"></a><span id="l7.21">     'calICSService.cpp',</span>
<a href="#l7.22"></a><span id="l7.22">     'calPeriod.cpp',</span>
<a href="#l7.23"></a><span id="l7.23">     'calRecurrenceRule.cpp',</span>
<a href="#l7.24"></a><span id="l7.24">     'calTimezone.cpp',</span>
<a href="#l7.25"></a><span id="l7.25">     'calUtils.cpp',</span>
<a href="#l7.26"></a><span id="l7.26"> ]</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28"> FINAL_LIBRARY = 'calbasecomps'</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -506,21 +506,19 @@</span>
<a href="#l8.4"></a><span id="l8.4">           for (let i = 0; i &lt; labeldayboxkids.length; i++) {</span>
<a href="#l8.5"></a><span id="l8.5">               labeldayboxkids[i].shortWeekNames = useShortNames;</span>
<a href="#l8.6"></a><span id="l8.6">           }</span>
<a href="#l8.7"></a><span id="l8.7">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.8"></a><span id="l8.8">       &lt;/method&gt;</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">       &lt;method name=&quot;today&quot;&gt;</span>
<a href="#l8.11"></a><span id="l8.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          let date = createDateTime();</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-          date.jsDate = new Date();</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-          date = date.getInTimezone(this.mTimezone);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-          date.isDate = true;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-          return date;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+          var d = cal.jsDateToDateTime(new Date()).getInTimezone(this.mTimezone);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+          d.isDate = true;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+          return d;</span>
<a href="#l8.20"></a><span id="l8.20">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.21"></a><span id="l8.21">       &lt;/method&gt;</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23">       &lt;method name=&quot;isVisible&quot;&gt;</span>
<a href="#l8.24"></a><span id="l8.24">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l8.25"></a><span id="l8.25">             return (this.nodeName == currentView().nodeName);</span>
<a href="#l8.26"></a><span id="l8.26">         ]]&gt;&lt;/body&gt;</span>
<a href="#l8.27"></a><span id="l8.27">       &lt;/method&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -656,17 +656,17 @@ function toggleShowCompletedInView() {</span>
<a href="#l9.4"></a><span id="l9.4"> }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> /**</span>
<a href="#l9.7"></a><span id="l9.7">  * Provides a neutral way to go to the current day in the views and minimonth.</span>
<a href="#l9.8"></a><span id="l9.8">  *</span>
<a href="#l9.9"></a><span id="l9.9">  * @param aDate     The date to go.</span>
<a href="#l9.10"></a><span id="l9.10">  */</span>
<a href="#l9.11"></a><span id="l9.11"> function goToDate(aDate) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    getMinimonth().value = aDate.jsDate;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    getMinimonth().value = cal.dateTimeToJsDate(aDate);</span>
<a href="#l9.14"></a><span id="l9.14">     currentView().goToDay(aDate);</span>
<a href="#l9.15"></a><span id="l9.15"> }</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17"> /**</span>
<a href="#l9.18"></a><span id="l9.18">  * Returns the calendar view that was selected before restart, or the current</span>
<a href="#l9.19"></a><span id="l9.19">  * calendar view if it has already been set in this session</span>
<a href="#l9.20"></a><span id="l9.20">  *</span>
<a href="#l9.21"></a><span id="l9.21">  * @return          The last calendar view.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,12 +1,13 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l10.9"></a><span id="l10.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.10"></a><span id="l10.10"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12"> var gStartDate = null;</span>
<a href="#l10.13"></a><span id="l10.13"> var gEndDate = null;</span>
<a href="#l10.14"></a><span id="l10.14"> var gStartTimezone = null;</span>
<a href="#l10.15"></a><span id="l10.15"> var gEndTimezone = null;</span>
<a href="#l10.16"></a><span id="l10.16"> var gDuration = null;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineat">@@ -260,18 +261,18 @@ function updateDateTime() {</span>
<a href="#l10.18"></a><span id="l10.18">         }</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">         // Before feeding the date/time value into the control we need</span>
<a href="#l10.21"></a><span id="l10.21">         // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l10.22"></a><span id="l10.22">         // automatic conversion back into the OS timezone.</span>
<a href="#l10.23"></a><span id="l10.23">         startTime.timezone = floating();</span>
<a href="#l10.24"></a><span id="l10.24">         endTime.timezone = floating();</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-        document.getElementById(&quot;event-starttime&quot;).value = startTime.jsDate;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-        document.getElementById(&quot;event-endtime&quot;).value = endTime.jsDate;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+        document.getElementById(&quot;event-starttime&quot;).value = cal.dateTimeToJsDate(startTime);</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+        document.getElementById(&quot;event-endtime&quot;).value = cal.dateTimeToJsDate(endTime);</span>
<a href="#l10.30"></a><span id="l10.30">     } else {</span>
<a href="#l10.31"></a><span id="l10.31">         var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33">         var startTime = gStartDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l10.34"></a><span id="l10.34">         var endTime = gEndDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">         if (startTime.isDate) {</span>
<a href="#l10.37"></a><span id="l10.37">             document.getElementById(&quot;all-day&quot;)</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineat">@@ -279,18 +280,18 @@ function updateDateTime() {</span>
<a href="#l10.39"></a><span id="l10.39">         }</span>
<a href="#l10.40"></a><span id="l10.40"> </span>
<a href="#l10.41"></a><span id="l10.41">         // Before feeding the date/time value into the control we need</span>
<a href="#l10.42"></a><span id="l10.42">         // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l10.43"></a><span id="l10.43">         // automatic conversion back into the OS timezone.</span>
<a href="#l10.44"></a><span id="l10.44">         startTime.timezone = floating();</span>
<a href="#l10.45"></a><span id="l10.45">         endTime.timezone = floating();</span>
<a href="#l10.46"></a><span id="l10.46"> </span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-        document.getElementById(&quot;event-starttime&quot;).value = startTime.jsDate;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-        document.getElementById(&quot;event-endtime&quot;).value = endTime.jsDate;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+        document.getElementById(&quot;event-starttime&quot;).value = cal.dateTimeToJsDate(startTime);</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+        document.getElementById(&quot;event-endtime&quot;).value = cal.dateTimeToJsDate(endTime);</span>
<a href="#l10.51"></a><span id="l10.51">     }</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53">     updateTimezone();</span>
<a href="#l10.54"></a><span id="l10.54">     updateAllDay();</span>
<a href="#l10.55"></a><span id="l10.55"> }</span>
<a href="#l10.56"></a><span id="l10.56"> </span>
<a href="#l10.57"></a><span id="l10.57"> /**</span>
<a href="#l10.58"></a><span id="l10.58">  * This function requires gStartDate and gEndDate and the respective timezone</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -147,25 +147,25 @@</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">           this.updateContent();</span>
<a href="#l11.6"></a><span id="l11.6">           this.updatePreview(this.mRecurrenceInfo);</span>
<a href="#l11.7"></a><span id="l11.7">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.8"></a><span id="l11.8">       &lt;/method&gt;</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">       &lt;method name=&quot;updateContent&quot;&gt;</span>
<a href="#l11.11"></a><span id="l11.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-          var date = this.dateTime.clone().jsDate;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+          var dt = cal.dateTimeToJsDate(this.dateTime);</span>
<a href="#l11.14"></a><span id="l11.14">           var row = document.getAnonymousElementByAttribute(</span>
<a href="#l11.15"></a><span id="l11.15">                         this, &quot;anonid&quot;, &quot;row&quot;);</span>
<a href="#l11.16"></a><span id="l11.16">           while (row) {</span>
<a href="#l11.17"></a><span id="l11.17">               var numChilds = row.childNodes.length - 1;</span>
<a href="#l11.18"></a><span id="l11.18">               for (var i = 0; i &lt; numChilds; i++) {</span>
<a href="#l11.19"></a><span id="l11.19">                   var minimonth = row.childNodes[i];</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-                  minimonth.showMonth(date);</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-                  date.setMonth(date.getMonth() + 1);</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+                  minimonth.showMonth(dt);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+                  dt.setMonth(dt.getMonth() + 1);</span>
<a href="#l11.24"></a><span id="l11.24">               }</span>
<a href="#l11.25"></a><span id="l11.25">               row = row.nextSibling;</span>
<a href="#l11.26"></a><span id="l11.26">           }</span>
<a href="#l11.27"></a><span id="l11.27">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.28"></a><span id="l11.28">       &lt;/method&gt;</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30">       &lt;method name=&quot;updatePreview&quot;&gt;</span>
<a href="#l11.31"></a><span id="l11.31">         &lt;parameter name=&quot;aRecurrenceInfo&quot;/&gt;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineat">@@ -187,17 +187,17 @@</span>
<a href="#l11.33"></a><span id="l11.33">               // now iterater all the child nodes of this row</span>
<a href="#l11.34"></a><span id="l11.34">               // in order to visit each minimonth in turn.</span>
<a href="#l11.35"></a><span id="l11.35">               var numChilds = row.childNodes.length - 1;</span>
<a href="#l11.36"></a><span id="l11.36">               for (var i = 0; i &lt; numChilds; i++) {</span>
<a href="#l11.37"></a><span id="l11.37">               </span>
<a href="#l11.38"></a><span id="l11.38">                   // we now have one of the minimonth controls while 'start'</span>
<a href="#l11.39"></a><span id="l11.39">                   // and 'end' are set to the interval this minimonth shows.</span>
<a href="#l11.40"></a><span id="l11.40">                   var minimonth = row.childNodes[i];</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-                  minimonth.showMonth(start.jsDate);</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+                  minimonth.showMonth(cal.dateTimeToJsDate(start));</span>
<a href="#l11.43"></a><span id="l11.43">                   if (aRecurrenceInfo) {</span>
<a href="#l11.44"></a><span id="l11.44">                       </span>
<a href="#l11.45"></a><span id="l11.45">                       // retrieve an array of dates that represents all occurrences</span>
<a href="#l11.46"></a><span id="l11.46">                       // that fall into this time interval [start,end[.</span>
<a href="#l11.47"></a><span id="l11.47">                       // note: the following loop assumes that this array conains</span>
<a href="#l11.48"></a><span id="l11.48">                       // dates that are strictly monotonically increasing.</span>
<a href="#l11.49"></a><span id="l11.49">                       // should getOccurrenceDates() not enforce this assumption we</span>
<a href="#l11.50"></a><span id="l11.50">                       // need to fall back to some different algorithm.</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineat">@@ -209,17 +209,17 @@</span>
<a href="#l11.52"></a><span id="l11.52">                       var occurrence = null;</span>
<a href="#l11.53"></a><span id="l11.53">                       if (index &lt; dates.length) {</span>
<a href="#l11.54"></a><span id="l11.54">                           occurrence =</span>
<a href="#l11.55"></a><span id="l11.55">                               dates[index++]</span>
<a href="#l11.56"></a><span id="l11.56">                                   .getInTimezone(start.timezone);</span>
<a href="#l11.57"></a><span id="l11.57">                       }</span>
<a href="#l11.58"></a><span id="l11.58">                       var current = start.clone();</span>
<a href="#l11.59"></a><span id="l11.59">                       while (current.compare(end) &lt; 0) {</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-                        var box = minimonth.getBoxForDate(current.jsDate);</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+                        var box = minimonth.getBoxForDate(cal.dateTimeToJsDate(current));</span>
<a href="#l11.62"></a><span id="l11.62">                         if (box) {</span>
<a href="#l11.63"></a><span id="l11.63">                             if (occurrence &amp;&amp;</span>
<a href="#l11.64"></a><span id="l11.64">                                 occurrence.day == current.day &amp;&amp;</span>
<a href="#l11.65"></a><span id="l11.65">                                 occurrence.month == current.month &amp;&amp;</span>
<a href="#l11.66"></a><span id="l11.66">                                 occurrence.year == current.year) {</span>
<a href="#l11.67"></a><span id="l11.67">                                 box.setAttribute(&quot;busy&quot;, 1);</span>
<a href="#l11.68"></a><span id="l11.68">                                 if (index &lt; dates.length) {</span>
<a href="#l11.69"></a><span id="l11.69">                                     occurrence =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.5"></a><span id="l12.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.6"></a><span id="l12.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l12.10"></a><span id="l12.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12"> var gIsReadOnly = false;</span>
<a href="#l12.13"></a><span id="l12.13"> var gStartTime = null;</span>
<a href="#l12.14"></a><span id="l12.14"> var gEndTime = null;</span>
<a href="#l12.15"></a><span id="l12.15"> var gUntilDate = null;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> /**</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineat">@@ -25,17 +26,18 @@ function onLoad() {</span>
<a href="#l12.19"></a><span id="l12.19">     gStartTime = args.startTime;</span>
<a href="#l12.20"></a><span id="l12.20">     gEndTime = args.endTime;</span>
<a href="#l12.21"></a><span id="l12.21">     var preview = document.getElementById(&quot;recurrence-preview&quot;);</span>
<a href="#l12.22"></a><span id="l12.22">     preview.dateTime = gStartTime.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">     onChangeCalendar(calendar);</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">     // Set starting value for 'repeat until' rule.</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-    setElementValue(&quot;repeat-until-date&quot;, gStartTime.getInTimezone(floating()).jsDate);</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+    let repeatDate = cal.dateTimeToJsDate(gStartTime.getInTimezone(cal.floating()));</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+    setElementValue(&quot;repeat-until-date&quot;, repeatDate);</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">     if (item.parentItem != item) {</span>
<a href="#l12.32"></a><span id="l12.32">         item = item.parentItem;</span>
<a href="#l12.33"></a><span id="l12.33">     }</span>
<a href="#l12.34"></a><span id="l12.34">     var rule = null;</span>
<a href="#l12.35"></a><span id="l12.35">     if (recinfo) {</span>
<a href="#l12.36"></a><span id="l12.36">         // Split out rules and exceptions</span>
<a href="#l12.37"></a><span id="l12.37">         try {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineat">@@ -203,18 +205,19 @@ function initializeControls(rule) {</span>
<a href="#l12.39"></a><span id="l12.39">             setElementValue(&quot;recurrence-duration&quot;, &quot;forever&quot;);</span>
<a href="#l12.40"></a><span id="l12.40">         } else {</span>
<a href="#l12.41"></a><span id="l12.41">             gUntilDate = untilDate.getInTimezone(gStartTime.timezone); // calIRecurrenceRule::untilDate is always UTC or floating</span>
<a href="#l12.42"></a><span id="l12.42">             // Change the until date to start date if the rule has a forbidden</span>
<a href="#l12.43"></a><span id="l12.43">             // value (earlier than the start date).</span>
<a href="#l12.44"></a><span id="l12.44">             if (gUntilDate.compare(gStartTime) &lt; 0) {</span>
<a href="#l12.45"></a><span id="l12.45">                 gUntilDate = gStartTime.clone();</span>
<a href="#l12.46"></a><span id="l12.46">             }</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+            let repeatDate = cal.dateTimeToJsDate(gUntilDate.getInTimezone(cal.floating()));</span>
<a href="#l12.48"></a><span id="l12.48">             setElementValue(&quot;recurrence-duration&quot;, &quot;until&quot;);</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-            setElementValue(&quot;repeat-until-date&quot;, gUntilDate.getInTimezone(floating()).jsDate);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+            setElementValue(&quot;repeat-until-date&quot;, repeatDate);</span>
<a href="#l12.51"></a><span id="l12.51">         }</span>
<a href="#l12.52"></a><span id="l12.52">     }</span>
<a href="#l12.53"></a><span id="l12.53"> }</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55"> /**</span>
<a href="#l12.56"></a><span id="l12.56">  * Save the recurrence information selected in the dialog back to the given</span>
<a href="#l12.57"></a><span id="l12.57">  * item.</span>
<a href="#l12.58"></a><span id="l12.58">  *</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineat">@@ -591,17 +594,18 @@ function updatePreview() {</span>
<a href="#l12.60"></a><span id="l12.60">  * Restores the previous correct date, shows a warning and prevents to close the</span>
<a href="#l12.61"></a><span id="l12.61">  * dialog when the user enters a wrong until date.</span>
<a href="#l12.62"></a><span id="l12.62">  */</span>
<a href="#l12.63"></a><span id="l12.63"> function checkUntilDate() {</span>
<a href="#l12.64"></a><span id="l12.64">     let untilDate = cal.jsDateToDateTime(getElementValue(&quot;repeat-until-date&quot;), gStartTime.timezone);</span>
<a href="#l12.65"></a><span id="l12.65">     let startDate = gStartTime.clone();</span>
<a href="#l12.66"></a><span id="l12.66">     startDate.isDate = true;</span>
<a href="#l12.67"></a><span id="l12.67">     if (untilDate.compare(startDate) &lt; 0) {</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineminus">-        setElementValue(&quot;repeat-until-date&quot;, (gUntilDate || gStartTime).getInTimezone(floating()).jsDate);</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+        let repeatDate = cal.dateTimeToJsDate((gUntilDate || gStartTime).getInTimezone(cal.floating()));</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+        setElementValue(&quot;repeat-until-date&quot;, repeatDate);</span>
<a href="#l12.71"></a><span id="l12.71">         checkUntilDate.warning = true;</span>
<a href="#l12.72"></a><span id="l12.72">         let callback = function() {</span>
<a href="#l12.73"></a><span id="l12.73">             // No warning when the dialog is being closed with the Cancel button.</span>
<a href="#l12.74"></a><span id="l12.74">             if (!checkUntilDate.warning) {</span>
<a href="#l12.75"></a><span id="l12.75">                 return;</span>
<a href="#l12.76"></a><span id="l12.76">             }</span>
<a href="#l12.77"></a><span id="l12.77">             Services.prompt.alert(null, document.title,</span>
<a href="#l12.78"></a><span id="l12.78">                                   calGetString(&quot;calendar&quot;, &quot;warningUntilBeforeStart&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -86,17 +86,17 @@ function loadReminders() {</span>
<a href="#l13.4"></a><span id="l13.4">             // action is actually supported by the calendar.</span>
<a href="#l13.5"></a><span id="l13.5">             listbox.appendChild(setupListItem(null, reminders[i].clone(), args.item));</span>
<a href="#l13.6"></a><span id="l13.6">         }</span>
<a href="#l13.7"></a><span id="l13.7">     }</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9">     // Set up a default absolute date. This will be overridden if the selected</span>
<a href="#l13.10"></a><span id="l13.10">     // alarm is absolute.</span>
<a href="#l13.11"></a><span id="l13.11">     let absDate = document.getElementById(&quot;reminder-absolute-date&quot;);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    absDate.value = getDefaultStartDate().jsDate;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    absDate.value = cal.dateTimeToJsDate(getDefaultStartDate());</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15">     if (listbox.childNodes.length) {</span>
<a href="#l13.16"></a><span id="l13.16">         // We have reminders, select the first by default. For some reason,</span>
<a href="#l13.17"></a><span id="l13.17">         // setting the selected index in a load handler makes the selection</span>
<a href="#l13.18"></a><span id="l13.18">         // break for the set item, therefore we need a setTimeout.</span>
<a href="#l13.19"></a><span id="l13.19">         setupMaxReminders();</span>
<a href="#l13.20"></a><span id="l13.20">         setTimeout(function() { listbox.selectedIndex = 0; }, 0);</span>
<a href="#l13.21"></a><span id="l13.21">     } else {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -237,17 +237,17 @@ function onReminderSelected() {</span>
<a href="#l13.23"></a><span id="l13.23">         // Action</span>
<a href="#l13.24"></a><span id="l13.24">         actionType.value = reminder.action;</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">         // Absolute/relative things</span>
<a href="#l13.27"></a><span id="l13.27">         if (reminder.related == Components.interfaces.calIAlarm.ALARM_RELATED_ABSOLUTE) {</span>
<a href="#l13.28"></a><span id="l13.28">             relationType.value = &quot;absolute&quot;;</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">             // Date</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-            absDate.value = (reminder.alarmDate || getDefaultStartDate()).jsDate;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+            absDate.value = cal.dateTimeToJsDate(reminder.alarmDate || cal.getDefaultStartDate());</span>
<a href="#l13.33"></a><span id="l13.33">         } else {</span>
<a href="#l13.34"></a><span id="l13.34">             relationType.value =  &quot;relative&quot;;</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36">             // Unit and length</span>
<a href="#l13.37"></a><span id="l13.37">             let alarmlen = Math.abs(reminder.offset.inSeconds / 60);</span>
<a href="#l13.38"></a><span id="l13.38">             if (alarmlen % 1440 == 0) {</span>
<a href="#l13.39"></a><span id="l13.39">                 unit.value = &quot;days&quot;;</span>
<a href="#l13.40"></a><span id="l13.40">                 length.value = alarmlen / 1440;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -92,18 +92,18 @@ function updateTimezone() {</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5">     // convert the date/time to the currently selected timezone</span>
<a href="#l14.6"></a><span id="l14.6">     // and display the result in the appropriate control.</span>
<a href="#l14.7"></a><span id="l14.7">     // before feeding the date/time value into the control we need</span>
<a href="#l14.8"></a><span id="l14.8">     // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l14.9"></a><span id="l14.9">     // automatic conversion back into the OS timezone.</span>
<a href="#l14.10"></a><span id="l14.10">     let datetime = document.getElementById(&quot;timezone-time&quot;);</span>
<a href="#l14.11"></a><span id="l14.11">     let time = window.time.getInTimezone(tz);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    time.timezone = floating();</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-    datetime.value = time.jsDate;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+    time.timezone = cal.floating();</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+    datetime.value = cal.dateTimeToJsDate(time);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">     // don't highlight any timezone in the map by default</span>
<a href="#l14.18"></a><span id="l14.18">     let standardTZOffset = &quot;none&quot;;</span>
<a href="#l14.19"></a><span id="l14.19">     if (tz.isUTC) {</span>
<a href="#l14.20"></a><span id="l14.20">         standardTZOffset = &quot;+0000&quot;;</span>
<a href="#l14.21"></a><span id="l14.21">     } else if (!tz.isFloating) {</span>
<a href="#l14.22"></a><span id="l14.22">         let standard = tz.icalComponent.getFirstSubcomponent(&quot;STANDARD&quot;);</span>
<a href="#l14.23"></a><span id="l14.23">         // any reason why valueAsIcalString is used instead of plain value? xxx todo: ask mickey</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -208,17 +208,17 @@ function onLoad() {</span>
<a href="#l15.4"></a><span id="l15.4">             .setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">     document.documentElement.getButton(&quot;cancel&quot;)</span>
<a href="#l15.6"></a><span id="l15.6">             .setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l15.7"></a><span id="l15.7">     document.documentElement.getButton(&quot;cancel&quot;)</span>
<a href="#l15.8"></a><span id="l15.8">             .parentNode.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">     // Set initial values for datepickers in New Tasks dialog</span>
<a href="#l15.11"></a><span id="l15.11">     if (isToDo(item)) {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        let initialDatesValue = args.initialStartDateValue.jsDate;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        let initialDatesValue = cal.dateTimeToJsDate(args.initialStartDateValue);</span>
<a href="#l15.14"></a><span id="l15.14">         setElementValue(&quot;completed-date-picker&quot;, initialDatesValue);</span>
<a href="#l15.15"></a><span id="l15.15">         setElementValue(&quot;todo-entrydate&quot;, initialDatesValue);</span>
<a href="#l15.16"></a><span id="l15.16">         setElementValue(&quot;todo-duedate&quot;, initialDatesValue);</span>
<a href="#l15.17"></a><span id="l15.17">     }</span>
<a href="#l15.18"></a><span id="l15.18">     loadDialog(window.calendarItem);</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20">     opener.setCursor(&quot;auto&quot;);</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -381,17 +381,17 @@ function loadDialog(item) {</span>
<a href="#l15.23"></a><span id="l15.23">             // No selected item means there was no &lt;menuitem&gt; that matches the</span>
<a href="#l15.24"></a><span id="l15.24">             // value given. Select the &quot;NONE&quot; item by default.</span>
<a href="#l15.25"></a><span id="l15.25">             setElementValue(todoStatus, &quot;NONE&quot;);</span>
<a href="#l15.26"></a><span id="l15.26">         }</span>
<a href="#l15.27"></a><span id="l15.27">     }</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">     // Task completed date</span>
<a href="#l15.30"></a><span id="l15.30">     if (item.completedDate) {</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-        updateToDoStatus(item.status, item.completedDate.jsDate);</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+        updateToDoStatus(item.status, cal.dateTimeToJsDate(item.completedDate));</span>
<a href="#l15.33"></a><span id="l15.33">     } else {</span>
<a href="#l15.34"></a><span id="l15.34">         updateToDoStatus(item.status);</span>
<a href="#l15.35"></a><span id="l15.35">     }</span>
<a href="#l15.36"></a><span id="l15.36"> </span>
<a href="#l15.37"></a><span id="l15.37">     // Task percent complete</span>
<a href="#l15.38"></a><span id="l15.38">     if (isToDo(item)) {</span>
<a href="#l15.39"></a><span id="l15.39">         var percentCompleteInteger = 0;</span>
<a href="#l15.40"></a><span id="l15.40">         var percentCompleteProperty = item.getProperty(&quot;PERCENT-COMPLETE&quot;);</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineat">@@ -949,17 +949,17 @@ function loadRepeat(item) {</span>
<a href="#l15.42"></a><span id="l15.42">  *</span>
<a href="#l15.43"></a><span id="l15.43">  * @param rule    The recurrence rule.</span>
<a href="#l15.44"></a><span id="l15.44">  */</span>
<a href="#l15.45"></a><span id="l15.45"> function updateUntilControls(rule) {</span>
<a href="#l15.46"></a><span id="l15.46">     let untilDate = &quot;forever&quot;;</span>
<a href="#l15.47"></a><span id="l15.47">     if (!rule.isByCount) {</span>
<a href="#l15.48"></a><span id="l15.48">         gUntilDate = rule.untilDate;</span>
<a href="#l15.49"></a><span id="l15.49">         if (gUntilDate) {</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-            untilDate = gUntilDate.getInTimezone(cal.floating()).jsDate;</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+            untilDate = cal.dateTimeToJsDate(gUntilDate.getInTimezone(cal.floating()));</span>
<a href="#l15.52"></a><span id="l15.52">         }</span>
<a href="#l15.53"></a><span id="l15.53">     }</span>
<a href="#l15.54"></a><span id="l15.54">     document.getElementById(&quot;repeat-deck&quot;).selectedIndex = 0;</span>
<a href="#l15.55"></a><span id="l15.55">     setElementValue(&quot;repeat-until-datepicker&quot;, untilDate);</span>
<a href="#l15.56"></a><span id="l15.56"> }</span>
<a href="#l15.57"></a><span id="l15.57"> </span>
<a href="#l15.58"></a><span id="l15.58"> /**</span>
<a href="#l15.59"></a><span id="l15.59">  * Update reminder related elements on the dialog.</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineat">@@ -2339,17 +2339,17 @@ function updateCalendar() {</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">         var collapseElements = document.getElementsByAttribute(&quot;collapse-on-readonly&quot;, &quot;true&quot;);</span>
<a href="#l15.63"></a><span id="l15.63">         for (var i = 0; i &lt; collapseElements.length; i++) {</span>
<a href="#l15.64"></a><span id="l15.64">             collapseElements[i].removeAttribute('collapsed');</span>
<a href="#l15.65"></a><span id="l15.65">         }</span>
<a href="#l15.66"></a><span id="l15.66"> </span>
<a href="#l15.67"></a><span id="l15.67">         // Task completed date</span>
<a href="#l15.68"></a><span id="l15.68">         if (item.completedDate) {</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-            updateToDoStatus(item.status, item.completedDate.jsDate);</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+            updateToDoStatus(item.status, cal.dateTimeToJsDate(item.completedDate));</span>
<a href="#l15.71"></a><span id="l15.71">         } else {</span>
<a href="#l15.72"></a><span id="l15.72">             updateToDoStatus(item.status);</span>
<a href="#l15.73"></a><span id="l15.73">         }</span>
<a href="#l15.74"></a><span id="l15.74"> </span>
<a href="#l15.75"></a><span id="l15.75">         // disable repeat menupopup if this is an occurrence</span>
<a href="#l15.76"></a><span id="l15.76">         var item = window.calendarItem;</span>
<a href="#l15.77"></a><span id="l15.77">         if (item.parentItem != item) {</span>
<a href="#l15.78"></a><span id="l15.78">             disableElement(&quot;item-repeat&quot;);</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineat">@@ -2522,18 +2522,18 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l15.80"></a><span id="l15.80">                     // Try to recover the last occurrence in 10(?) years.</span>
<a href="#l15.81"></a><span id="l15.81">                     let endDate = gStartTime.clone();</span>
<a href="#l15.82"></a><span id="l15.82">                     endDate.year += 10;</span>
<a href="#l15.83"></a><span id="l15.83">                     let lastOccurrenceDate = null;</span>
<a href="#l15.84"></a><span id="l15.84">                     let dates = recurrenceInfo.getOccurrenceDates(gStartTime, endDate, 0, {});</span>
<a href="#l15.85"></a><span id="l15.85">                     if (dates) {</span>
<a href="#l15.86"></a><span id="l15.86">                         lastOccurrenceDate = dates[dates.length - 1];</span>
<a href="#l15.87"></a><span id="l15.87">                     }</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-                    setElementValue(&quot;repeat-until-datepicker&quot;,</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-                                    (lastOccurrenceDate || proposedUntilDate).getInTimezone(cal.floating()).jsDate);</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+                    let repeatDate = cal.dateTimeToJsDate((lastOccurrenceDate || proposedUntilDate).getInTimezone(cal.floating()));</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+                    setElementValue(&quot;repeat-until-datepicker&quot;, repeatDate);</span>
<a href="#l15.92"></a><span id="l15.92">                 }</span>
<a href="#l15.93"></a><span id="l15.93">             }</span>
<a href="#l15.94"></a><span id="l15.94">             if (rrules[0].length &gt; 0) {</span>
<a href="#l15.95"></a><span id="l15.95">                 recurrenceInfo.deleteRecurrenceItem(rule);</span>
<a href="#l15.96"></a><span id="l15.96">             }</span>
<a href="#l15.97"></a><span id="l15.97">         } else {</span>
<a href="#l15.98"></a><span id="l15.98">             // New event proposes &quot;forever&quot; as default until date.</span>
<a href="#l15.99"></a><span id="l15.99">             recurrenceInfo = createRecurrenceInfo(item);</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineat">@@ -3151,110 +3151,110 @@ function updateDateTime() {</span>
<a href="#l15.101"></a><span id="l15.101">           }</span>
<a href="#l15.102"></a><span id="l15.102"> </span>
<a href="#l15.103"></a><span id="l15.103">           // before feeding the date/time value into the control we need</span>
<a href="#l15.104"></a><span id="l15.104">           // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l15.105"></a><span id="l15.105">           // automatic conversion back into the OS timezone.</span>
<a href="#l15.106"></a><span id="l15.106">           startTime.timezone = floating();</span>
<a href="#l15.107"></a><span id="l15.107">           endTime.timezone = floating();</span>
<a href="#l15.108"></a><span id="l15.108"> </span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-          setElementValue(&quot;event-starttime&quot;, startTime.jsDate);</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineminus">-          setElementValue(&quot;event-endtime&quot;, endTime.jsDate);</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+          setElementValue(&quot;event-starttime&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+          setElementValue(&quot;event-endtime&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.113"></a><span id="l15.113">         }</span>
<a href="#l15.114"></a><span id="l15.114"> </span>
<a href="#l15.115"></a><span id="l15.115">         if (isToDo(item)) {</span>
<a href="#l15.116"></a><span id="l15.116">           var startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l15.117"></a><span id="l15.117">           var endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l15.118"></a><span id="l15.118">           var hasEntryDate = (startTime != null);</span>
<a href="#l15.119"></a><span id="l15.119">           var hasDueDate = (endTime != null);</span>
<a href="#l15.120"></a><span id="l15.120"> </span>
<a href="#l15.121"></a><span id="l15.121">           if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l15.122"></a><span id="l15.122">               setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l15.123"></a><span id="l15.123">               startTime.timezone = floating();</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, startTime.jsDate);</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineplus">+              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.126"></a><span id="l15.126"> </span>
<a href="#l15.127"></a><span id="l15.127">               setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l15.128"></a><span id="l15.128">               endTime.timezone = floating();</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, endTime.jsDate);</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineplus">+              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.131"></a><span id="l15.131">           } else if (hasEntryDate) {</span>
<a href="#l15.132"></a><span id="l15.132">               setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l15.133"></a><span id="l15.133">               startTime.timezone = floating();</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, startTime.jsDate);</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineplus">+              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.136"></a><span id="l15.136"> </span>
<a href="#l15.137"></a><span id="l15.137">               startTime.timezone = floating();</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, startTime.jsDate);</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineplus">+              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.140"></a><span id="l15.140">           } else if (hasDueDate) {</span>
<a href="#l15.141"></a><span id="l15.141">               endTime.timezone = floating();</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, endTime.jsDate);</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineplus">+              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.144"></a><span id="l15.144"> </span>
<a href="#l15.145"></a><span id="l15.145">               setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l15.146"></a><span id="l15.146">               endTime.timezone = floating();</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, endTime.jsDate);</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineplus">+              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.149"></a><span id="l15.149">           } else {</span>
<a href="#l15.150"></a><span id="l15.150">               startTime = window.initialStartDateValue;</span>
<a href="#l15.151"></a><span id="l15.151">               startTime.timezone = floating();</span>
<a href="#l15.152"></a><span id="l15.152">               endTime = startTime.clone();</span>
<a href="#l15.153"></a><span id="l15.153"> </span>
<a href="#l15.154"></a><span id="l15.154" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, startTime.jsDate);</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, endTime.jsDate);</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineplus">+              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineplus">+              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.158"></a><span id="l15.158">           }</span>
<a href="#l15.159"></a><span id="l15.159">         }</span>
<a href="#l15.160"></a><span id="l15.160">     } else {</span>
<a href="#l15.161"></a><span id="l15.161">         var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l15.162"></a><span id="l15.162"> </span>
<a href="#l15.163"></a><span id="l15.163">         if (isEvent(item)) {</span>
<a href="#l15.164"></a><span id="l15.164">             var startTime = gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.165"></a><span id="l15.165">             var endTime = gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.166"></a><span id="l15.166">             setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l15.167"></a><span id="l15.167"> </span>
<a href="#l15.168"></a><span id="l15.168">             // before feeding the date/time value into the control we need</span>
<a href="#l15.169"></a><span id="l15.169">             // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l15.170"></a><span id="l15.170">             // automatic conversion back into the OS timezone.</span>
<a href="#l15.171"></a><span id="l15.171">             startTime.timezone = floating();</span>
<a href="#l15.172"></a><span id="l15.172">             endTime.timezone = floating();</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineminus">-            setElementValue(&quot;event-starttime&quot;, startTime.jsDate);</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineminus">-            setElementValue(&quot;event-endtime&quot;, endTime.jsDate);</span>
<a href="#l15.175"></a><span id="l15.175" class="difflineplus">+            setElementValue(&quot;event-starttime&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.176"></a><span id="l15.176" class="difflineplus">+            setElementValue(&quot;event-endtime&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.177"></a><span id="l15.177">         }</span>
<a href="#l15.178"></a><span id="l15.178"> </span>
<a href="#l15.179"></a><span id="l15.179">         if (isToDo(item)) {</span>
<a href="#l15.180"></a><span id="l15.180">             var startTime = gStartTime &amp;&amp;</span>
<a href="#l15.181"></a><span id="l15.181">                             gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.182"></a><span id="l15.182">             var endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.183"></a><span id="l15.183">             var hasEntryDate = (startTime != null);</span>
<a href="#l15.184"></a><span id="l15.184">             var hasDueDate = (endTime != null);</span>
<a href="#l15.185"></a><span id="l15.185"> </span>
<a href="#l15.186"></a><span id="l15.186">             if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l15.187"></a><span id="l15.187">                 setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l15.188"></a><span id="l15.188">                 startTime.timezone = floating();</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineminus">-                setElementValue(&quot;todo-entrydate&quot;, startTime.jsDate);</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.191"></a><span id="l15.191"> </span>
<a href="#l15.192"></a><span id="l15.192">                 setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l15.193"></a><span id="l15.193">                 endTime.timezone = floating();</span>
<a href="#l15.194"></a><span id="l15.194" class="difflineminus">-                setElementValue(&quot;todo-duedate&quot;, endTime.jsDate);</span>
<a href="#l15.195"></a><span id="l15.195" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.196"></a><span id="l15.196">             } else if (hasEntryDate) {</span>
<a href="#l15.197"></a><span id="l15.197">                 setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l15.198"></a><span id="l15.198">                 startTime.timezone = floating();</span>
<a href="#l15.199"></a><span id="l15.199" class="difflineminus">-                setElementValue(&quot;todo-entrydate&quot;, startTime.jsDate);</span>
<a href="#l15.200"></a><span id="l15.200" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.201"></a><span id="l15.201"> </span>
<a href="#l15.202"></a><span id="l15.202">                 startTime.timezone = floating();</span>
<a href="#l15.203"></a><span id="l15.203" class="difflineminus">-                setElementValue(&quot;todo-duedate&quot;, startTime.jsDate);</span>
<a href="#l15.204"></a><span id="l15.204" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.205"></a><span id="l15.205">             } else if (hasDueDate) {</span>
<a href="#l15.206"></a><span id="l15.206">                 endTime.timezone = floating();</span>
<a href="#l15.207"></a><span id="l15.207" class="difflineminus">-                setElementValue(&quot;todo-entrydate&quot;, endTime.jsDate);</span>
<a href="#l15.208"></a><span id="l15.208" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.209"></a><span id="l15.209"> </span>
<a href="#l15.210"></a><span id="l15.210">                 setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l15.211"></a><span id="l15.211">                 endTime.timezone = floating();</span>
<a href="#l15.212"></a><span id="l15.212" class="difflineminus">-                setElementValue(&quot;todo-duedate&quot;, endTime.jsDate);</span>
<a href="#l15.213"></a><span id="l15.213" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.214"></a><span id="l15.214">             } else {</span>
<a href="#l15.215"></a><span id="l15.215">                 startTime = window.initialStartDateValue</span>
<a href="#l15.216"></a><span id="l15.216">                 startTime.timezone = floating();</span>
<a href="#l15.217"></a><span id="l15.217">                 endTime = startTime.clone();</span>
<a href="#l15.218"></a><span id="l15.218"> </span>
<a href="#l15.219"></a><span id="l15.219" class="difflineminus">-                setElementValue(&quot;todo-entrydate&quot;, startTime.jsDate);</span>
<a href="#l15.220"></a><span id="l15.220" class="difflineminus">-                setElementValue(&quot;todo-duedate&quot;, endTime.jsDate);</span>
<a href="#l15.221"></a><span id="l15.221" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l15.222"></a><span id="l15.222" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l15.223"></a><span id="l15.223">             }</span>
<a href="#l15.224"></a><span id="l15.224">         }</span>
<a href="#l15.225"></a><span id="l15.225">     }</span>
<a href="#l15.226"></a><span id="l15.226"> </span>
<a href="#l15.227"></a><span id="l15.227">     updateTimezone();</span>
<a href="#l15.228"></a><span id="l15.228">     updateAllDay();</span>
<a href="#l15.229"></a><span id="l15.229">     updateRepeatDetails();</span>
<a href="#l15.230"></a><span id="l15.230"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -17,18 +17,18 @@ function getCalendarView() {</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> /**</span>
<a href="#l16.6"></a><span id="l16.6">  * Loads the print dialog, setting up all needed elements.</span>
<a href="#l16.7"></a><span id="l16.7">  */</span>
<a href="#l16.8"></a><span id="l16.8"> function loadCalendarPrintDialog() {</span>
<a href="#l16.9"></a><span id="l16.9">     // set the datepickers to the currently selected dates</span>
<a href="#l16.10"></a><span id="l16.10">     let theView = getCalendarView();</span>
<a href="#l16.11"></a><span id="l16.11">     if (theView) {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        document.getElementById(&quot;start-date-picker&quot;).value = theView.startDay.jsDate;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-        document.getElementById(&quot;end-date-picker&quot;).value = theView.endDay.jsDate;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+        document.getElementById(&quot;start-date-picker&quot;).value = cal.dateTimeToJsDate(theView.startDay);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+        document.getElementById(&quot;end-date-picker&quot;).value = cal.dateTimeToJsDate(theView.endDay);</span>
<a href="#l16.16"></a><span id="l16.16">     } else {</span>
<a href="#l16.17"></a><span id="l16.17">         document.getElementById(&quot;printCurrentViewRadio&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l16.18"></a><span id="l16.18">     }</span>
<a href="#l16.19"></a><span id="l16.19">     if (!theView || !theView.getSelectedItems({}).length) {</span>
<a href="#l16.20"></a><span id="l16.20">         document.getElementById(&quot;selected&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l16.21"></a><span id="l16.21">     }</span>
<a href="#l16.22"></a><span id="l16.22">     document.getElementById(theView ? &quot;printCurrentViewRadio&quot; : &quot;custom-range&quot;)</span>
<a href="#l16.23"></a><span id="l16.23">             .setAttribute(&quot;selected&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -348,17 +348,17 @@ var TodayPane = {</span>
<a href="#l17.4"></a><span id="l17.4">         monthnamedeck.selectedIndex = this.start.month;</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6">         let selMonthPanel = monthnamedeck.selectedPanel;</span>
<a href="#l17.7"></a><span id="l17.7">         this.setMonthDescription(selMonthPanel,</span>
<a href="#l17.8"></a><span id="l17.8">                                  this.start.month,</span>
<a href="#l17.9"></a><span id="l17.9">                                  this.start.year,</span>
<a href="#l17.10"></a><span id="l17.10">                                  cal.getWeekInfoService().getWeekTitle(this.start));</span>
<a href="#l17.11"></a><span id="l17.11">         if (!aDontUpdateMinimonth) {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-            document.getElementById(&quot;today-Minimonth&quot;).value = this.start.jsDate;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+            document.getElementById(&quot;today-Minimonth&quot;).value = cal.dateTimeToJsDate(this.start);</span>
<a href="#l17.14"></a><span id="l17.14">         }</span>
<a href="#l17.15"></a><span id="l17.15">         this.updatePeriod();</span>
<a href="#l17.16"></a><span id="l17.16">     },</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">     /**</span>
<a href="#l17.19"></a><span id="l17.19">      * Advance by a given number of days in the today pane.</span>
<a href="#l17.20"></a><span id="l17.20">      *</span>
<a href="#l17.21"></a><span id="l17.21">      * @param aDir      The number of days to advance. Negative numbers advance</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -508,21 +508,37 @@ let cal = {</span>
<a href="#l18.4"></a><span id="l18.4">             newDate.resetTo(aDate.getFullYear(),</span>
<a href="#l18.5"></a><span id="l18.5">                             aDate.getMonth(),</span>
<a href="#l18.6"></a><span id="l18.6">                             aDate.getDate(),</span>
<a href="#l18.7"></a><span id="l18.7">                             aDate.getHours(),</span>
<a href="#l18.8"></a><span id="l18.8">                             aDate.getMinutes(),</span>
<a href="#l18.9"></a><span id="l18.9">                             aDate.getSeconds(),</span>
<a href="#l18.10"></a><span id="l18.10">                             aTimezone);</span>
<a href="#l18.11"></a><span id="l18.11">         } else {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-            newDate.jsDate = aDate;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+            newDate.nativeTime = aDate.getTime() * 1000;</span>
<a href="#l18.14"></a><span id="l18.14">         }</span>
<a href="#l18.15"></a><span id="l18.15">         return newDate;</span>
<a href="#l18.16"></a><span id="l18.16">     },</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+    /**</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+     * Convert a calIDateTime to a Javascript date object. This is the</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+     * replacement for the former .jsDate property.</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+     *</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+     * @param cdt       The calIDateTime instnace</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+     * @return          The Javascript date equivalent.</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+     */</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+    dateTimeToJsDate: function(cdt) {</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+        if (cdt.timezone == cal.floating()) {</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+            return new Date(cdt.year, cdt.month, cdt.day,</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+                            cdt.hour, cdt.minute, cdt.second);</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+        } else {</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+            return new Date(cdt.nativeTime / 1000);</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+        }</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    },</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+</span>
<a href="#l18.34"></a><span id="l18.34">     sortEntry: function cal_sortEntry(aItem) {</span>
<a href="#l18.35"></a><span id="l18.35">         let key = cal.getItemSortKey(aItem, this.mSortKey, this.mSortStartedDate);</span>
<a href="#l18.36"></a><span id="l18.36">         return { mSortKey : key, mItem: aItem };</span>
<a href="#l18.37"></a><span id="l18.37">     },</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39">     sortEntryItem: function cal_sortEntryItem(sortEntry) {</span>
<a href="#l18.40"></a><span id="l18.40">         return sortEntry.mItem;</span>
<a href="#l18.41"></a><span id="l18.41">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">rename from calendar/base/backend/icaljs/calIDateTimeJS.idl</span>
<a href="#l19.2"></a><span id="l19.2">rename to calendar/base/public/calIDateTime.idl</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineminus">--- a/calendar/base/backend/icaljs/calIDateTimeJS.idl</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineplus">+++ b/calendar/base/public/calIDateTime.idl</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineat">@@ -218,18 +218,9 @@ interface calIDateTime : nsISupports</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">   [noscript,notxpcom] void toIcalTime(in icaltimetypeptr itt);</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   /**</span>
<a href="#l19.10"></a><span id="l19.10">    * This object as either an iCalendar DATE or DATETIME string, as</span>
<a href="#l19.11"></a><span id="l19.11">    * appropriate and sets the timezone to either UTC or floating.</span>
<a href="#l19.12"></a><span id="l19.12">    */</span>
<a href="#l19.13"></a><span id="l19.13">   attribute ACString icalString;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-  /**</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-   * Setting jsDate via a JavaScript Date object will set</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-   * the calIDateTime to the jsDate's time ***in UTC***.</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-   * There's no way for us to recover TZ info from a jsDate,</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-   * so we always pull it out as UTC, and force the calIDateTime's</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-   * timezone to UTC.</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-   */</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">-  attribute jsval jsDate;</span>
<a href="#l19.23"></a><span id="l19.23"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/public/moz.build</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/public/moz.build</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -11,16 +11,17 @@ XPIDL_SOURCES += [</span>
<a href="#l20.4"></a><span id="l20.4">     'calICalendar.idl',</span>
<a href="#l20.5"></a><span id="l20.5">     'calICalendarACLManager.idl',</span>
<a href="#l20.6"></a><span id="l20.6">     'calICalendarManager.idl',</span>
<a href="#l20.7"></a><span id="l20.7">     'calICalendarProvider.idl',</span>
<a href="#l20.8"></a><span id="l20.8">     'calICalendarSearchProvider.idl',</span>
<a href="#l20.9"></a><span id="l20.9">     'calICalendarView.idl',</span>
<a href="#l20.10"></a><span id="l20.10">     'calICalendarViewController.idl',</span>
<a href="#l20.11"></a><span id="l20.11">     'calIChangeLog.idl',</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+    'calIDateTime.idl',</span>
<a href="#l20.13"></a><span id="l20.13">     'calIDateTimeFormatter.idl',</span>
<a href="#l20.14"></a><span id="l20.14">     'calIDeletedItems.idl',</span>
<a href="#l20.15"></a><span id="l20.15">     'calIDuration.idl',</span>
<a href="#l20.16"></a><span id="l20.16">     'calIErrors.idl',</span>
<a href="#l20.17"></a><span id="l20.17">     'calIEvent.idl',</span>
<a href="#l20.18"></a><span id="l20.18">     'calIFreeBusyProvider.idl',</span>
<a href="#l20.19"></a><span id="l20.19">     'calIIcsParser.idl',</span>
<a href="#l20.20"></a><span id="l20.20">     'calIIcsSerializer.idl',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.5"></a><span id="l21.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.6"></a><span id="l21.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> /**</span>
<a href="#l21.12"></a><span id="l21.12">  * Object that contains a set of filter properties that may be used by a calFilter object</span>
<a href="#l21.13"></a><span id="l21.13">  * to filter a set of items.</span>
<a href="#l21.14"></a><span id="l21.14">  * Supported filter properties:</span>
<a href="#l21.15"></a><span id="l21.15">  *   start, end:   Specifies the relative date range to use when calculating the filter date</span>
<a href="#l21.16"></a><span id="l21.16">  *               range. The relative date range may relative to the current date and time, the</span>
<a href="#l21.17"></a><span id="l21.17">  *               currently selected date, or the dates range of the current view. The actual</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineat">@@ -473,59 +474,63 @@ calFilter.prototype = {</span>
<a href="#l21.19"></a><span id="l21.19">      *                            start of the relative date range, otherwise it will return the</span>
<a href="#l21.20"></a><span id="l21.20">      *                            date value for the end of the date range.</span>
<a href="#l21.21"></a><span id="l21.21">      * @return                    The calculated date for the property.</span>
<a href="#l21.22"></a><span id="l21.22">      */</span>
<a href="#l21.23"></a><span id="l21.23">     getDateForProperty: function cF_getDateForProperty(prop, start) {</span>
<a href="#l21.24"></a><span id="l21.24">         let props = this.mFilterProperties || new calFilterProperties();</span>
<a href="#l21.25"></a><span id="l21.25">         let result = null;</span>
<a href="#l21.26"></a><span id="l21.26">         let selectedDate = this.mSelectedDate || currentView().selectedDay || cal.now();</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+        let nowDate = cal.now();</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29">         if (typeof(prop) == &quot;string&quot;) {</span>
<a href="#l21.30"></a><span id="l21.30">             let duration = cal.createDuration(prop);</span>
<a href="#l21.31"></a><span id="l21.31">             if (duration) {</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-                result = cal.now();</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+                result = nowDate;</span>
<a href="#l21.34"></a><span id="l21.34">                 result.addDuration(duration);</span>
<a href="#l21.35"></a><span id="l21.35">             }</span>
<a href="#l21.36"></a><span id="l21.36">         } else {</span>
<a href="#l21.37"></a><span id="l21.37">             switch (prop) {</span>
<a href="#l21.38"></a><span id="l21.38">                 case props.FILTER_DATE_ALL:</span>
<a href="#l21.39"></a><span id="l21.39">                     result = null;</span>
<a href="#l21.40"></a><span id="l21.40">                     break;</span>
<a href="#l21.41"></a><span id="l21.41">                 case props.FILTER_DATE_VIEW:</span>
<a href="#l21.42"></a><span id="l21.42">                     result = start ? currentView().startDay.clone() :</span>
<a href="#l21.43"></a><span id="l21.43">                                      currentView().endDay.clone();</span>
<a href="#l21.44"></a><span id="l21.44">                     break;</span>
<a href="#l21.45"></a><span id="l21.45">                 case props.FILTER_DATE_SELECTED:</span>
<a href="#l21.46"></a><span id="l21.46">                     result = selectedDate.clone();</span>
<a href="#l21.47"></a><span id="l21.47">                     result.isDate = true;</span>
<a href="#l21.48"></a><span id="l21.48">                     break;</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-                case props.FILTER_DATE_SELECTED_OR_NOW:</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+                case props.FILTER_DATE_SELECTED_OR_NOW: {</span>
<a href="#l21.51"></a><span id="l21.51">                     result = selectedDate.clone();</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-                    if ((start &amp;&amp; result.jsDate &gt; cal.now().jsDate) ||</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-                        (!start &amp;&amp; result.jsDate &lt; cal.now().jsDate)) {</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-                        result = cal.now();</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+                    let resultJSDate = cal.dateTimeToJsDate(result);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+                    let nowJSDate = cal.dateTimeToJsDate(nowDate);</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+                    if ((start &amp;&amp; resultJSDate &gt; nowJSDate) ||</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+                        (!start &amp;&amp; resultJSDate &lt; nowJSDate)) {</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+                        result = nowDate;</span>
<a href="#l21.60"></a><span id="l21.60">                     }</span>
<a href="#l21.61"></a><span id="l21.61">                     result.isDate = true;</span>
<a href="#l21.62"></a><span id="l21.62">                     break;</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+                }</span>
<a href="#l21.64"></a><span id="l21.64">                 case props.FILTER_DATE_NOW:</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-                    result = cal.now();</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+                    result = nowDate;</span>
<a href="#l21.67"></a><span id="l21.67">                     break;</span>
<a href="#l21.68"></a><span id="l21.68">                 case props.FILTER_DATE_TODAY:</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">-                    result = cal.now();</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+                    result = nowDate;</span>
<a href="#l21.71"></a><span id="l21.71">                     result.isDate = true;</span>
<a href="#l21.72"></a><span id="l21.72">                     break;</span>
<a href="#l21.73"></a><span id="l21.73">                 case props.FILTER_DATE_CURRENT_WEEK:</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineminus">-                    result = start ? cal.now().startOfWeek : cal.now().endOfWeek;</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+                    result = start ? nowDate.startOfWeek : nowDate.endOfWeek;</span>
<a href="#l21.76"></a><span id="l21.76">                     break;</span>
<a href="#l21.77"></a><span id="l21.77">                 case props.FILTER_DATE_CURRENT_MONTH:</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineminus">-                    result = start ? cal.now().startOfMonth : cal.now().endOfMonth;</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+                    result = start ? nowDate.startOfMonth : nowDate.endOfMonth;</span>
<a href="#l21.80"></a><span id="l21.80">                     break;</span>
<a href="#l21.81"></a><span id="l21.81">                 case props.FILTER_DATE_CURRENT_YEAR:</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineminus">-                    result = start ? cal.now().startOfYear : cal.now().endOfYear;</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+                    result = start ? nowDate.startOfYear : nowDate.endOfYear;</span>
<a href="#l21.84"></a><span id="l21.84">                     break;</span>
<a href="#l21.85"></a><span id="l21.85">             }</span>
<a href="#l21.86"></a><span id="l21.86"> </span>
<a href="#l21.87"></a><span id="l21.87">             // date ranges are inclusive, so we need to include the day for the end date</span>
<a href="#l21.88"></a><span id="l21.88">             if (!start &amp;&amp; result &amp;&amp; prop != props.FILTER_DATE_NOW) {</span>
<a href="#l21.89"></a><span id="l21.89">                 result.day++;</span>
<a href="#l21.90"></a><span id="l21.90">             }</span>
<a href="#l21.91"></a><span id="l21.91">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -490,18 +490,17 @@ function guessSystemTimezone() {</span>
<a href="#l22.4"></a><span id="l22.4">             (beforeSpringShiftJSDate.getTimezoneOffset() &gt;</span>
<a href="#l22.5"></a><span id="l22.5">              afterSpringShiftJSDate.getTimezoneOffset())) {</span>
<a href="#l22.6"></a><span id="l22.6">             return 1;</span>
<a href="#l22.7"></a><span id="l22.7">         }</span>
<a href="#l22.8"></a><span id="l22.8">         // no match</span>
<a href="#l22.9"></a><span id="l22.9">         return 0;</span>
<a href="#l22.10"></a><span id="l22.10">     }</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    const todayUTC = cal.createDateTime();</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    todayUTC.jsDate = new Date();</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+    const todayUTC = cal.jsDateToDateTime(new Date());</span>
<a href="#l22.15"></a><span id="l22.15">     const oneYrUTC = todayUTC.clone(); oneYrUTC.year += 1;</span>
<a href="#l22.16"></a><span id="l22.16">     const periodStartCalDate = cal.createDateTime();</span>
<a href="#l22.17"></a><span id="l22.17">     const periodUntilCalDate = cal.createDateTime(); // until timezone is UTC</span>
<a href="#l22.18"></a><span id="l22.18">     const periodCalRule = cal.createRecurrenceRule();</span>
<a href="#l22.19"></a><span id="l22.19">     const untilRegex = /UNTIL=(\d{8}T\d{6}Z)/;</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21">     function findCurrentTimePeriod(tz, subComp, standardOrDaylight,</span>
<a href="#l22.22"></a><span id="l22.22">                                    isForNextTransitionDate) {</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineat">@@ -533,26 +532,26 @@ function guessSystemTimezone() {</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25">             // found period that covers today.</span>
<a href="#l22.26"></a><span id="l22.26">             if (!isForNextTransitionDate) {</span>
<a href="#l22.27"></a><span id="l22.27">                 return period;</span>
<a href="#l22.28"></a><span id="l22.28">             } else /*isForNextTranstionDate*/ {</span>
<a href="#l22.29"></a><span id="l22.29">                 if (todayUTC.nativeTime &lt; periodStartCalDate.nativeTime) {</span>
<a href="#l22.30"></a><span id="l22.30">                     // already know periodStartCalDate &lt; oneYr from now,</span>
<a href="#l22.31"></a><span id="l22.31">                     // and transitions are at most once per year, so it is next.</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-                    return periodStartCalDate.jsDate;</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+                    return cal.dateTimeToJsDate(periodStartCalDate);</span>
<a href="#l22.34"></a><span id="l22.34">                 } else if (rrule) {</span>
<a href="#l22.35"></a><span id="l22.35">                     // find next occurrence after today</span>
<a href="#l22.36"></a><span id="l22.36">                     periodCalRule.icalProperty = rrule;</span>
<a href="#l22.37"></a><span id="l22.37">                     var nextTransitionDate =</span>
<a href="#l22.38"></a><span id="l22.38">                         periodCalRule.getNextOccurrence(periodStartCalDate,</span>
<a href="#l22.39"></a><span id="l22.39">                                                         todayUTC);</span>
<a href="#l22.40"></a><span id="l22.40">                     // make sure rule doesn't end before next transition date.</span>
<a href="#l22.41"></a><span id="l22.41">                     if (nextTransitionDate) {</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-                        return nextTransitionDate.jsDate;</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+                        return cal.dateTimeToJsDate(nextTransitionDate);</span>
<a href="#l22.44"></a><span id="l22.44">                     }</span>
<a href="#l22.45"></a><span id="l22.45">                 }</span>
<a href="#l22.46"></a><span id="l22.46">             }</span>
<a href="#l22.47"></a><span id="l22.47">         }</span>
<a href="#l22.48"></a><span id="l22.48">         // no such period found</span>
<a href="#l22.49"></a><span id="l22.49">         return null;</span>
<a href="#l22.50"></a><span id="l22.50">     }</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52" class="difflineat">@@ -817,17 +816,17 @@ function guessSystemTimezone() {</span>
<a href="#l22.53"></a><span id="l22.53">             var warningDetail;</span>
<a href="#l22.54"></a><span id="l22.54">             if (probableTZScore == 1) {</span>
<a href="#l22.55"></a><span id="l22.55">                 // score 1 means has daylight time,</span>
<a href="#l22.56"></a><span id="l22.56">                 // but transitions start on different weekday from os timezone.</span>
<a href="#l22.57"></a><span id="l22.57">                 function weekday(icsDate) {</span>
<a href="#l22.58"></a><span id="l22.58">                     var calDate = cal.createDateTime();</span>
<a href="#l22.59"></a><span id="l22.59">                     calDate.icalString = icsDate;</span>
<a href="#l22.60"></a><span id="l22.60">                     calDate.timezone = tz;</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-                    return calDate.jsDate.toLocaleFormat(&quot;%a&quot;);</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+                    return cal.dateTimeToJsDate(calDate).toLocaleFormat(&quot;%a&quot;);</span>
<a href="#l22.63"></a><span id="l22.63">                 }</span>
<a href="#l22.64"></a><span id="l22.64">                 var standardStart = getIcalString(standard, &quot;DTSTART&quot;);</span>
<a href="#l22.65"></a><span id="l22.65">                 var standardStartWeekday = weekday(standardStart);</span>
<a href="#l22.66"></a><span id="l22.66">                 var standardRule  = getIcalString(standard, &quot;RRULE&quot;);</span>
<a href="#l22.67"></a><span id="l22.67">                 var standardText =</span>
<a href="#l22.68"></a><span id="l22.68">                     (&quot;  Standard: &quot;+standardStart+&quot; &quot;+standardStartWeekday+&quot;\n&quot;+</span>
<a href="#l22.69"></a><span id="l22.69">                      &quot;            &quot;+standardRule+&quot;\n&quot;);</span>
<a href="#l22.70"></a><span id="l22.70">                 var daylightStart = getIcalString(daylight, &quot;DTSTART&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -372,18 +372,17 @@ function makeURL(aUriString) {</span>
<a href="#l23.4"></a><span id="l23.4">     return Services.io.newURI(aUriString, null, null);</span>
<a href="#l23.5"></a><span id="l23.5"> }</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7"> /**</span>
<a href="#l23.8"></a><span id="l23.8">  * Returns a calIDateTime that corresponds to the current time in the user's</span>
<a href="#l23.9"></a><span id="l23.9">  * default timezone.</span>
<a href="#l23.10"></a><span id="l23.10">  */</span>
<a href="#l23.11"></a><span id="l23.11"> function now() {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    var d = createDateTime();</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-    d.jsDate = new Date();</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+    var d = cal.jsDateToDateTime(new Date());</span>
<a href="#l23.15"></a><span id="l23.15">     return d.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l23.16"></a><span id="l23.16"> }</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18"> /**</span>
<a href="#l23.19"></a><span id="l23.19">  * Selects an item with id aItemId in the radio group with id aRadioGroupId</span>
<a href="#l23.20"></a><span id="l23.20">  *</span>
<a href="#l23.21"></a><span id="l23.21">  * @param aRadioGroupId  the id of the radio group which contains the item</span>
<a href="#l23.22"></a><span id="l23.22">  * @param aItemId        the item to be selected</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineat">@@ -1127,27 +1126,27 @@ function getProgressAtom(aTask) {</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25">     if (aTask.recurrenceInfo)</span>
<a href="#l23.26"></a><span id="l23.26">       return &quot;repeating&quot;;</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28">     if (aTask.isCompleted)</span>
<a href="#l23.29"></a><span id="l23.29">       return &quot;completed&quot;;</span>
<a href="#l23.30"></a><span id="l23.30"> </span>
<a href="#l23.31"></a><span id="l23.31">     if (aTask.dueDate &amp;&amp; aTask.dueDate.isValid) {</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-        if (aTask.dueDate.jsDate.getTime() &lt; now.getTime()) {</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+        if (cal.dateTimeToJsDate(aTask.dueDate).getTime() &lt; now.getTime()) {</span>
<a href="#l23.34"></a><span id="l23.34">             return &quot;overdue&quot;;</span>
<a href="#l23.35"></a><span id="l23.35">         } else if (aTask.dueDate.year == now.getFullYear() &amp;&amp;</span>
<a href="#l23.36"></a><span id="l23.36">                    aTask.dueDate.month == now.getMonth() &amp;&amp;</span>
<a href="#l23.37"></a><span id="l23.37">                    aTask.dueDate.day == now.getDate()) {</span>
<a href="#l23.38"></a><span id="l23.38">             return &quot;duetoday&quot;;</span>
<a href="#l23.39"></a><span id="l23.39">         }</span>
<a href="#l23.40"></a><span id="l23.40">     }</span>
<a href="#l23.41"></a><span id="l23.41"> </span>
<a href="#l23.42"></a><span id="l23.42">     if (aTask.entryDate &amp;&amp; aTask.entryDate.isValid &amp;&amp;</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-        aTask.entryDate.jsDate.getTime() &lt; now.getTime()) {</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+        cal.dateTimeToJsDate(aTask.entryDate).getTime() &lt; now.getTime()) {</span>
<a href="#l23.45"></a><span id="l23.45">         return &quot;inprogress&quot;;</span>
<a href="#l23.46"></a><span id="l23.46">     }</span>
<a href="#l23.47"></a><span id="l23.47"> </span>
<a href="#l23.48"></a><span id="l23.48">     return &quot;future&quot;;</span>
<a href="#l23.49"></a><span id="l23.49"> }</span>
<a href="#l23.50"></a><span id="l23.50"> </span>
<a href="#l23.51"></a><span id="l23.51"> function calInterfaceBag(iid) {</span>
<a href="#l23.52"></a><span id="l23.52">     this.init(iid);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l24.4"></a><span id="l24.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.5"></a><span id="l24.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.6"></a><span id="l24.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l24.10"></a><span id="l24.10"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l24.11"></a><span id="l24.11"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l24.12"></a><span id="l24.12"> </span>
<a href="#l24.13"></a><span id="l24.13"> const localeEn = {</span>
<a href="#l24.14"></a><span id="l24.14">     headTitle       : &quot;Subject&quot;,</span>
<a href="#l24.15"></a><span id="l24.15">     headStartDate   : &quot;Start Date&quot;,</span>
<a href="#l24.16"></a><span id="l24.16">     headStartTime   : &quot;Start Time&quot;,</span>
<a href="#l24.17"></a><span id="l24.17">     headEndDate     : &quot;End Date&quot;,</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineat">@@ -430,18 +431,18 @@ calOutlookCSVExporter.prototype = {</span>
<a href="#l24.19"></a><span id="l24.19">         classDescription: &quot;Calendar Outlook CSV Exporter&quot;,</span>
<a href="#l24.20"></a><span id="l24.20">         interfaces: calOutlookCSVExporterInterfaces</span>
<a href="#l24.21"></a><span id="l24.21">     }),</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">     getFileTypes: getOutlookCsvFileTypes,</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25">     exportToStream: function csv_exportToStream(aStream, aCount, aItems) {</span>
<a href="#l24.26"></a><span id="l24.26">         // Helper functions</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-        function dateString(aDateTime) aDateTime.jsDate.toLocaleFormat(localeEn.dateFormat);</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-        function timeString(aDateTime) aDateTime.jsDate.toLocaleFormat(localeEn.timeFormat);</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+        function dateString(aDateTime) cal.dateTimeToJsDate(aDateTime).toLocaleFormat(localeEn.dateFormat);</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+        function timeString(aDateTime) cal.dateTimeToJsDate(aDateTime).toLocaleFormat(localeEn.timeFormat);</span>
<a href="#l24.31"></a><span id="l24.31">         function txtString(aString) aString || &quot;&quot;;</span>
<a href="#l24.32"></a><span id="l24.32"> </span>
<a href="#l24.33"></a><span id="l24.33">         let str = &quot;&quot;;</span>
<a href="#l24.34"></a><span id="l24.34">         let headers = [];</span>
<a href="#l24.35"></a><span id="l24.35">         // Not using a loop here, since we need to be sure the order here matches</span>
<a href="#l24.36"></a><span id="l24.36">         // with the orders the field data is added later on</span>
<a href="#l24.37"></a><span id="l24.37">         headers.push(localeEn['headTitle']);</span>
<a href="#l24.38"></a><span id="l24.38">         headers.push(localeEn['headStartDate']);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l25.4"></a><span id="l25.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l25.5"></a><span id="l25.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l25.6"></a><span id="l25.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l25.10"></a><span id="l25.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l25.11"></a><span id="l25.11"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l25.12"></a><span id="l25.12"> </span>
<a href="#l25.13"></a><span id="l25.13"> var g_bShutdown = false;</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15"> function initLogging() {</span>
<a href="#l25.16"></a><span id="l25.16">     initLogging.mLogTimezone = calendarDefaultTimezone();</span>
<a href="#l25.17"></a><span id="l25.17">     if (initLogging.mLogFilestream) {</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineat">@@ -171,19 +172,17 @@ function filterXmlNodes(name, rootNode) </span>
<a href="#l25.19"></a><span id="l25.19">     }</span>
<a href="#l25.20"></a><span id="l25.20">     return ret;</span>
<a href="#l25.21"></a><span id="l25.21"> }</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23"> function getTime() {</span>
<a href="#l25.24"></a><span id="l25.24">     if (g_bShutdown) {</span>
<a href="#l25.25"></a><span id="l25.25">         return null;</span>
<a href="#l25.26"></a><span id="l25.26">     }</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-    var ret = createDateTime();</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-    ret.jsDate = new Date();</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-    return ret;</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+    return cal.jsDateToDateTime(new Date());</span>
<a href="#l25.31"></a><span id="l25.31"> }</span>
<a href="#l25.32"></a><span id="l25.32"> </span>
<a href="#l25.33"></a><span id="l25.33"> function getIcalUTC(dt) {</span>
<a href="#l25.34"></a><span id="l25.34">     if (!dt || !dt.isValid) {</span>
<a href="#l25.35"></a><span id="l25.35">         return &quot;0&quot;;</span>
<a href="#l25.36"></a><span id="l25.36">     } else {</span>
<a href="#l25.37"></a><span id="l25.37">         var dtz = dt.timezone;</span>
<a href="#l25.38"></a><span id="l25.38">         if (dtz.isUTC || dtz.isFloating) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -42,16 +42,17 @@</span>
<a href="#l26.4"></a><span id="l26.4">     &lt;implementation&gt;</span>
<a href="#l26.5"></a><span id="l26.5">       &lt;field name=&quot;mRelativeDates&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l26.6"></a><span id="l26.6">       &lt;field name=&quot;mDayNames&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l26.7"></a><span id="l26.7">       &lt;field name=&quot;mRelationWords&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l26.8"></a><span id="l26.8">       &lt;field name=&quot;mMonthLongNames&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l26.9"></a><span id="l26.9">       &lt;field name=&quot;mMonthShortNames&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l26.13"></a><span id="l26.13">         var goButton = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-go-button&quot;);</span>
<a href="#l26.14"></a><span id="l26.14">         goButton.setAttribute(&quot;label&quot;, calGetString(&quot;calendar&quot;, &quot;go&quot;));</span>
<a href="#l26.15"></a><span id="l26.15">         // Load the stuff we're going to use to parse written dates</span>
<a href="#l26.16"></a><span id="l26.16">         this.mRelativeDates = [</span>
<a href="#l26.17"></a><span id="l26.17">             {word:calGetString(&quot;calendar&quot;, &quot;today&quot;).toLowerCase(), offset: 0},</span>
<a href="#l26.18"></a><span id="l26.18">             {word:calGetString(&quot;calendar&quot;, &quot;yesterday&quot;).toLowerCase(), offset: -1},</span>
<a href="#l26.19"></a><span id="l26.19">             {word:calGetString(&quot;calendar&quot;, &quot;tomorrow&quot;).toLowerCase(), offset: 1}];</span>
<a href="#l26.20"></a><span id="l26.20">         var i;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -146,17 +147,17 @@</span>
<a href="#l26.22"></a><span id="l26.22">                }</span>
<a href="#l26.23"></a><span id="l26.23">                // Figure out what day of the week today is.</span>
<a href="#l26.24"></a><span id="l26.24">                var today = now();</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">                // i-weekday gets the offset. Add 7 to ensure that the %</span>
<a href="#l26.27"></a><span id="l26.27">                // operation stays positive.</span>
<a href="#l26.28"></a><span id="l26.28">                var offset = (i - today.weekday + 7) % 7;</span>
<a href="#l26.29"></a><span id="l26.29">                today.day = today.day + offset;</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-               return today.jsDate;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+               return cal.dateTimeToJsDate(today);</span>
<a href="#l26.32"></a><span id="l26.32">              }</span>
<a href="#l26.33"></a><span id="l26.33">              return null;</span>
<a href="#l26.34"></a><span id="l26.34">            }</span>
<a href="#l26.35"></a><span id="l26.35"> </span>
<a href="#l26.36"></a><span id="l26.36">            // Remove commas</span>
<a href="#l26.37"></a><span id="l26.37">            val = val.replace(',', '');</span>
<a href="#l26.38"></a><span id="l26.38"> </span>
<a href="#l26.39"></a><span id="l26.39">            if (val.indexOf(' ') == -1) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/test/unit/test_bug272411.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/test/unit/test_bug272411.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l27.4"></a><span id="l27.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.5"></a><span id="l27.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.6"></a><span id="l27.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> function run_test() {</span>
<a href="#l27.9"></a><span id="l27.9">     let jsd = new Date();</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+    let cdt = cal.jsDateToDateTime(jsd);</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    let cdt = cal.createDateTime();</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-    cdt.jsDate = jsd;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+    let cdtTime = cal.dateTimeToJsDate(cdt).getTime() / 1000;</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+    let jsdTime = Math.floor(jsd.getTime() / 1000);</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17">     // calIDateTime is only accurate to the second, milliseconds need to be</span>
<a href="#l27.18"></a><span id="l27.18">     // stripped.</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineminus">-    do_check_eq(cdt.jsDate.getTime() / 1000, Math.floor(jsd.getTime() / 1000));</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+    do_check_eq(cdtTime, jsdTime);</span>
<a href="#l27.21"></a><span id="l27.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/test/unit/test_datetime.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/test/unit/test_datetime.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -49,18 +49,17 @@ function run_test() {</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5">     // Bug 398724 - Problems with floating all-day items</span>
<a href="#l28.6"></a><span id="l28.6">     let event = cal.createEvent(&quot;BEGIN:VEVENT\nUID:45674d53-229f-48c6-9f3b-f2b601e7ae4d\nSUMMARY:New Event\nDTSTART;VALUE=DATE:20071003\nDTEND;VALUE=DATE:20071004\nEND:VEVENT&quot;);</span>
<a href="#l28.7"></a><span id="l28.7">     do_check_true(event.startDate.timezone.isFloating);</span>
<a href="#l28.8"></a><span id="l28.8">     do_check_true(event.endDate.timezone.isFloating);</span>
<a href="#l28.9"></a><span id="l28.9"> </span>
<a href="#l28.10"></a><span id="l28.10">     // Bug 392853 - Same times, different timezones, but subtractDate says times are PT0S apart</span>
<a href="#l28.11"></a><span id="l28.11">     const zeroLength = cal.createDuration();</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-    const a = cal.createDateTime();</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-    a.jsDate = new Date();</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+    const a = cal.jsDateToDateTime(new Date());</span>
<a href="#l28.15"></a><span id="l28.15">     a.timezone = getMozTimezone(&quot;/mozilla.org/20071231_1/Europe/Berlin&quot;);</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17">     let b = a.clone();</span>
<a href="#l28.18"></a><span id="l28.18">     b.timezone = getMozTimezone(&quot;/mozilla.org/20071231_1/America/New_York&quot;);</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">     let duration = a.subtractDate(b);</span>
<a href="#l28.21"></a><span id="l28.21">     do_check_neq(duration.compare(zeroLength), 0);</span>
<a href="#l28.22"></a><span id="l28.22">     do_check_neq(a.compare(b), 0);</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineat">@@ -84,15 +83,15 @@ function run_test() {</span>
<a href="#l28.24"></a><span id="l28.24">     do_check_eq(utc.timezone.tzid, &quot;UTC&quot;);</span>
<a href="#l28.25"></a><span id="l28.25">     do_check_eq(utc.clone().timezone.tzid, &quot;UTC&quot;);</span>
<a href="#l28.26"></a><span id="l28.26">     do_check_eq(utc.timezoneOffset, 0);</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28">     // Bug 794477 - setting jsdate across compartments needs to work</span>
<a href="#l28.29"></a><span id="l28.29">     let someDate = new Date();</span>
<a href="#l28.30"></a><span id="l28.30">     let createdDate = cal.jsDateToDateTime(someDate).getInTimezone(cal.calendarDefaultTimezone());</span>
<a href="#l28.31"></a><span id="l28.31">     do_check_eq(Math.floor(someDate.getTime() / 1000),</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-                Math.floor(createdDate.jsDate.getTime() / 1000));</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+                Math.floor(cal.dateTimeToJsDate(createdDate).getTime() / 1000));</span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35">     // Comparing a date-time with a date of the same day should be 0</span>
<a href="#l28.36"></a><span id="l28.36">     do_check_eq(cal.createDateTime(&quot;20120101T120000&quot;).compare(cal.createDateTime(&quot;20120101&quot;)), 0);</span>
<a href="#l28.37"></a><span id="l28.37">     do_check_eq(cal.createDateTime(&quot;20120101&quot;).compare(cal.createDateTime(&quot;20120101T120000&quot;)), 0);</span>
<a href="#l28.38"></a><span id="l28.38"> }</span>
<a href="#l28.39"></a><span id="l28.39"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/test/unit/test_datetime_before_1970.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/test/unit/test_datetime_before_1970.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -6,18 +6,17 @@ function run_test() {</span>
<a href="#l29.4"></a><span id="l29.4"> </span>
<a href="#l29.5"></a><span id="l29.5">     // Bug 769938 - dates before 1970 are not handled correctly</span>
<a href="#l29.6"></a><span id="l29.6">     // due to signed vs. unsigned mismatch in PRTime in xpconnect</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8">     let dateTime1950 = cal.createDateTime();</span>
<a href="#l29.9"></a><span id="l29.9">     dateTime1950.year = 1950;</span>
<a href="#l29.10"></a><span id="l29.10">     do_check_eq(dateTime1950.year, 1950);</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    let dateTime1955 = cal.createDateTime();</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-    dateTime1955.jsDate = new Date(1955, 06, 15);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+    let dateTime1955 = cal.jsDateToDateTime(new Date(1955, 06, 15));</span>
<a href="#l29.15"></a><span id="l29.15">     do_check_eq(dateTime1955.year, 1955);</span>
<a href="#l29.16"></a><span id="l29.16">     </span>
<a href="#l29.17"></a><span id="l29.17">     let dateTime1965 = cal.createDateTime();</span>
<a href="#l29.18"></a><span id="l29.18">     dateTime1965.nativeTime = -150000000000000;</span>
<a href="#l29.19"></a><span id="l29.19">     do_check_eq(dateTime1965.year, 1965);</span>
<a href="#l29.20"></a><span id="l29.20">     do_check_eq(dateTime1965.nativeTime, -150000000000000);</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22">     let dateTime1990 = cal.createDateTime();</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

