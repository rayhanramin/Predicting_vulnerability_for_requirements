<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20017:b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a" />
<meta property="og:url" content="/comm-central/rev/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - initial rules and minimal automatic fixes. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">shortlog</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">files</a> |
changeset |
<a href="/comm-central/raw-rev/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">raw</a>  | <a href="/comm-central/archive/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - initial rules and minimal automatic fixes. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 11:14:45 +0200</td></tr>

<tr>
 <td>changeset 20017</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a</a></td>
</tr>



<tr>
<td>parent 20016</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7567d39ae92880708c25b023f8428be8d5afd51d">7567d39ae92880708c25b023f8428be8d5afd51d</a>
</td>
</tr>

<tr>
<td>child 20018</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/236b9899c452443b01830bc85071c5a14c0f0ae4">236b9899c452443b01830bc85071c5a14c0f0ae4</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a">12288</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Thu, 15 Sep 2016 22:48:47 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d56d63967713 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d56d639677139ede62ac3c3736e23c7a05aeee42">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d56d639677139ede62ac3c3736e23c7a05aeee42&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d56d639677139ede62ac3c3736e23c7a05aeee42&newProject=comm-central&newRevision=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d56d639677139ede62ac3c3736e23c7a05aeee42&newProject=comm-central&newRevision=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d56d639677139ede62ac3c3736e23c7a05aeee42&newProject=comm-central&newRevision=b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - initial rules and minimal automatic fixes. r=MakeMyDay

MozReview-Commit-ID: 5UnTP50Iqtv</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/.eslintignore">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/.eslintignore">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/.eslintignore">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/.eslintignore">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/backend/icaljs/calICSService.js">calendar/base/backend/icaljs/calICSService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/backend/icaljs/calICSService.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/backend/icaljs/calICSService.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/backend/icaljs/calICSService.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/backend/icaljs/calICSService.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/backend/icaljs/calICSService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-item-bindings.xml">calendar/base/content/calendar-item-bindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-item-bindings.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-item-bindings.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-item-bindings.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-item-bindings.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-item-bindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-unifinder-todo.js">calendar/base/content/calendar-unifinder-todo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-unifinder-todo.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-unifinder-todo.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-unifinder-todo.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-unifinder-todo.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-unifinder-todo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">calendar/base/content/dialogs/calendar-event-dialog-timezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-invitations-list.xml">calendar/base/content/dialogs/calendar-invitations-list.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-invitations-list.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-invitations-list.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-invitations-list.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-invitations-list.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-invitations-list.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-summary-dialog.js">calendar/base/content/dialogs/calendar-summary-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-summary-dialog.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-summary-dialog.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-summary-dialog.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-summary-dialog.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/dialogs/calendar-summary-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/preferences/categories.js">calendar/base/content/preferences/categories.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/preferences/categories.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/preferences/categories.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/preferences/categories.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/preferences/categories.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/preferences/categories.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-subscriptions-list.xml">calendar/base/content/widgets/calendar-subscriptions-list.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-subscriptions-list.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-subscriptions-list.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-subscriptions-list.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-subscriptions-list.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-subscriptions-list.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calIteratorUtils.jsm">calendar/base/modules/calIteratorUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calIteratorUtils.jsm">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calIteratorUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calIteratorUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calIteratorUtils.jsm">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calIteratorUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calDefaultACLManager.js">calendar/base/src/calDefaultACLManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calDefaultACLManager.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calDefaultACLManager.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calDefaultACLManager.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calDefaultACLManager.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calDefaultACLManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calRecurrenceInfo.js">calendar/base/src/calRecurrenceInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calRecurrenceInfo.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calRecurrenceInfo.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calRecurrenceInfo.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calRecurrenceInfo.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calRecurrenceInfo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calWeekInfoService.js">calendar/base/src/calWeekInfoService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calWeekInfoService.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calWeekInfoService.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calWeekInfoService.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calWeekInfoService.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/base/src/calWeekInfoService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/lightning/components/calItipProtocolHandler.js">calendar/lightning/components/calItipProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/lightning/components/calItipProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/lightning/components/calItipProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/lightning/components/calItipProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/lightning/components/calItipProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/lightning/components/calItipProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageHelpers.jsm">calendar/providers/storage/calStorageHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageHelpers.jsm">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageHelpers.jsm">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarModule.js">calendar/providers/wcap/calWcapCalendarModule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarModule.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarModule.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarModule.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarModule.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapCalendarModule.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapUtils.js">calendar/providers/wcap/calWcapUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapUtils.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapUtils.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapUtils.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapUtils.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/providers/wcap/calWcapUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publishDialog.js">calendar/resources/content/publishDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publishDialog.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publishDialog.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publishDialog.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publishDialog.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/resources/content/publishDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">calendar/test/mozmill/recurrence/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testDailyRecurrence.js">calendar/test/mozmill/recurrence/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/timezone-utils.js">calendar/test/mozmill/shared-modules/timezone-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/timezone-utils.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/timezone-utils.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/timezone-utils.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/shared-modules/timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testLocalICS.js">calendar/test/mozmill/testLocalICS.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testLocalICS.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testLocalICS.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testLocalICS.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testLocalICS.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/testLocalICS.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test10.js">calendar/test/mozmill/timezoneTests/test10.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test10.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test10.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test10.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test10.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test10.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test2.js">calendar/test/mozmill/timezoneTests/test2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test2.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test2.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test2.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test2.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test3.js">calendar/test/mozmill/timezoneTests/test3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test3.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test3.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test3.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test3.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test4.js">calendar/test/mozmill/timezoneTests/test4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test4.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test4.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test4.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test4.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test4.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test5.js">calendar/test/mozmill/timezoneTests/test5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test5.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test5.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test5.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test5.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test5.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test6.js">calendar/test/mozmill/timezoneTests/test6.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test6.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test6.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test6.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test6.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test6.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test7.js">calendar/test/mozmill/timezoneTests/test7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test7.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test7.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test7.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test7.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test7.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test8.js">calendar/test/mozmill/timezoneTests/test8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test8.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test8.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test8.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test8.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test9.js">calendar/test/mozmill/timezoneTests/test9.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test9.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test9.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test9.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test9.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/timezoneTests/test9.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testDayView.js">calendar/test/mozmill/views/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testDayView.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testDayView.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testDayView.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testDayView.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMonthView.js">calendar/test/mozmill/views/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMonthView.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMonthView.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMultiweekView.js">calendar/test/mozmill/views/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testWeekView.js">calendar/test/mozmill/views/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testWeekView.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testWeekView.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/mozmill/views/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_calutils.js">calendar/test/unit/test_calutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_calutils.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_calutils.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_calutils.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_calutils.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_calutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_datetime_before_1970.js">calendar/test/unit/test_datetime_before_1970.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_datetime_before_1970.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_datetime_before_1970.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_datetime_before_1970.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_datetime_before_1970.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_datetime_before_1970.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_deleted_items.js">calendar/test/unit/test_deleted_items.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_deleted_items.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_deleted_items.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_deleted_items.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_deleted_items.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_deleted_items.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_providers.js">calendar/test/unit/test_providers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_providers.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_providers.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_providers.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_providers.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_providers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/b1be8f5e02be13b1fb3ea3734c095e0e4f784b3a/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -12,16 +12,31 @@ config/**</span>
<a href="#l1.4"></a><span id="l1.4"> db/**</span>
<a href="#l1.5"></a><span id="l1.5"> other-licenses/**</span>
<a href="#l1.6"></a><span id="l1.6"> testing/**</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> # We ignore all these directories by default, until we get them enabled.</span>
<a href="#l1.9"></a><span id="l1.9"> # If you are enabling a directory, please add directory specific exclusions</span>
<a href="#l1.10"></a><span id="l1.10"> # below.</span>
<a href="#l1.11"></a><span id="l1.11"> build/**</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-calendar/**</span>
<a href="#l1.13"></a><span id="l1.13"> chat/**</span>
<a href="#l1.14"></a><span id="l1.14"> editor/**</span>
<a href="#l1.15"></a><span id="l1.15"> im/**</span>
<a href="#l1.16"></a><span id="l1.16"> ldap/**</span>
<a href="#l1.17"></a><span id="l1.17"> mail/**</span>
<a href="#l1.18"></a><span id="l1.18"> mailnews/**</span>
<a href="#l1.19"></a><span id="l1.19"> suite/**</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+# calendar/ exclusions</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+# prefs files</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+calendar/lightning/content/lightning.js</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+calendar/locales/en-US/lightning-l10n.js</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+# gdata-provider uses non-standard javascript for Postbox compatibility</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+calendar/providers/gdata/**</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+# third party library</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+calendar/base/modules/ical.js</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+# preprocessed files</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+calendar/base/content/calendar-dnd-listener.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,97 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+{</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+  &quot;extends&quot;: [</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+    &quot;../mozilla/toolkit/.eslintrc&quot;</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+  ],</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+  &quot;rules&quot;: {</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+    // Enforce newline at the end of file, with no multiple empty lines.</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+    &quot;eol-last&quot;: 2,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    // Enforce the spacing around the * in generator functions.</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    &quot;generator-star-spacing&quot;: [2, &quot;after&quot;],</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    // Disallow deletion of variables (deleting properties is fine).</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    &quot;no-delete-var&quot;: 2,</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    // Disallow duplicate arguments in functions.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    &quot;no-dupe-args&quot;: 2,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+    // Disallow duplicate keys when creating object literals.</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+    &quot;no-dupe-keys&quot;: 2,</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+    // Disallow a duplicate case label.</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+    &quot;no-duplicate-case&quot;: 2,</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    // Disallow the use of empty character classes in regular expressions.</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+    &quot;no-empty-character-class&quot;: 2,</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+    // Disallow assigning to the exception in a catch block.</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    &quot;no-ex-assign&quot;: 2,</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    // Disallow adding to native types</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    &quot;no-extend-native&quot;: 2,</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+    // Disallow double-negation boolean casts in a boolean context.</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+    &quot;no-extra-boolean-cast&quot;: 2,</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+    // Disallow unnecessary semicolons.</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+    &quot;no-extra-semi&quot;: 2,</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+    // Disallow mixed spaces and tabs for indentation.</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+    &quot;no-mixed-spaces-and-tabs&quot;: 2,</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+    // Disallow reassignments of native objects.</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+    &quot;no-native-reassign&quot;: 2,</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+    // Disallow nested ternary expressions, they make the code hard to read.</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+    &quot;no-nested-ternary&quot;: 2,</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    // Disallow use of octal literals.</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+    &quot;no-octal&quot;: 2,</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+    // Disallow comparisons where both sides are exactly the same.</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+    &quot;no-self-compare&quot;: 2,</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+    // Disallow sparse arrays, eg. let arr = [,,2].</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+    // Array destructuring is fine though:</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+    // for (let [, breakpointPromise] of aPromises)</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    &quot;no-sparse-arrays&quot;: 2,</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+    // Disallow trailing whitespace at the end of lines.</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+    &quot;no-trailing-spaces&quot;: 2,</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+    // Disallow use of the with statement.</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+    &quot;no-with&quot;: 2,</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+    // Disallow comparisons with the value NaN.</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+    &quot;use-isnan&quot;: 2,</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+    // Ensure that the results of typeof are compared against a valid string.</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+    &quot;valid-typeof&quot;: 2,</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    // disallow the use of object properties of the global object (Math and</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+    // JSON) as functions</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+    &quot;no-obj-calls&quot;: 2,</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+    // disallow use of octal escape sequences in string literals, such as</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    // var foo = &quot;Copyright \251&quot;;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    &quot;no-octal-escape&quot;: 2,</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    // disallow use of void operator</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+    &quot;no-void&quot;: 2,</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+    // Will enable these rules later</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+    &quot;comma-spacing&quot;: 0,</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+    &quot;keyword-spacing&quot;: 0,</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+    &quot;block-spacing&quot;: 0,</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+    &quot;no-lonely-if&quot;: 0,</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+    &quot;space-before-blocks&quot;: 0,</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+    &quot;computed-property-spacing&quot;: 0,</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+    &quot;consistent-return&quot;: 0,</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+    &quot;no-redeclare&quot;: 0,</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+    &quot;no-empty&quot;: 0,</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+    // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+    // easier updates in the future.</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+    &quot;no-else-return&quot;: 0,</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+  }</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calICSService.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calICSService.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -172,17 +172,17 @@ calIcalProperty.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">     clearXParameters: function() {</span>
<a href="#l3.5"></a><span id="l3.5">         cal.WARN(&quot;calIICSService::clearXParameters is no longer implemented, &quot; +</span>
<a href="#l3.6"></a><span id="l3.6">                  &quot;please use removeParameter&quot;);</span>
<a href="#l3.7"></a><span id="l3.7">     },</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">     paramIterator: null,</span>
<a href="#l3.10"></a><span id="l3.10">     getFirstParameterName: function() {</span>
<a href="#l3.11"></a><span id="l3.11">         let innerObject = this.innerObject;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        this.paramIterator = (function*() {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        this.paramIterator = (function* () {</span>
<a href="#l3.14"></a><span id="l3.14">             let propname = innerObject.name.toLowerCase();</span>
<a href="#l3.15"></a><span id="l3.15">             let defaultType = innerObject.getDefaultType();</span>
<a href="#l3.16"></a><span id="l3.16">             if (defaultType != innerObject.type) {</span>
<a href="#l3.17"></a><span id="l3.17">                 yield &quot;VALUE&quot;;</span>
<a href="#l3.18"></a><span id="l3.18">             }</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">             let paramNames = Object.keys(innerObject.jCal[1] || {});</span>
<a href="#l3.21"></a><span id="l3.21">             for (let name of paramNames) {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -235,17 +235,17 @@ calIcalComponent.prototype = {</span>
<a href="#l3.23"></a><span id="l3.23">     componentIterator: null,</span>
<a href="#l3.24"></a><span id="l3.24">     getFirstSubcomponent: function(kind) {</span>
<a href="#l3.25"></a><span id="l3.25">         if (kind == &quot;ANY&quot;) {</span>
<a href="#l3.26"></a><span id="l3.26">             kind = null;</span>
<a href="#l3.27"></a><span id="l3.27">         } else if (kind) {</span>
<a href="#l3.28"></a><span id="l3.28">             kind = kind.toLowerCase();</span>
<a href="#l3.29"></a><span id="l3.29">         }</span>
<a href="#l3.30"></a><span id="l3.30">         let innerObject = this.innerObject;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-        this.componentIterator = (function*() {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+        this.componentIterator = (function* () {</span>
<a href="#l3.33"></a><span id="l3.33">             let comps = innerObject.getAllSubcomponents(kind);</span>
<a href="#l3.34"></a><span id="l3.34">             if (comps) {</span>
<a href="#l3.35"></a><span id="l3.35">                 for (let comp of comps) {</span>
<a href="#l3.36"></a><span id="l3.36">                     yield new calIcalComponent(comp);</span>
<a href="#l3.37"></a><span id="l3.37">                 }</span>
<a href="#l3.38"></a><span id="l3.38">             }</span>
<a href="#l3.39"></a><span id="l3.39">         })();</span>
<a href="#l3.40"></a><span id="l3.40">         return this.getNextSubcomponent(kind)</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -355,17 +355,17 @@ calIcalComponent.prototype = {</span>
<a href="#l3.42"></a><span id="l3.42">     propertyIterator: null,</span>
<a href="#l3.43"></a><span id="l3.43">     getFirstProperty: function getFirstProperty(kind) {</span>
<a href="#l3.44"></a><span id="l3.44">         if (kind == &quot;ANY&quot;) {</span>
<a href="#l3.45"></a><span id="l3.45">             kind = null;</span>
<a href="#l3.46"></a><span id="l3.46">         } else if (kind) {</span>
<a href="#l3.47"></a><span id="l3.47">             kind = kind.toLowerCase();</span>
<a href="#l3.48"></a><span id="l3.48">         }</span>
<a href="#l3.49"></a><span id="l3.49">         let innerObject = this.innerObject;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-        this.propertyIterator = (function*() {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+        this.propertyIterator = (function* () {</span>
<a href="#l3.52"></a><span id="l3.52">             let props = innerObject.getAllProperties(kind);</span>
<a href="#l3.53"></a><span id="l3.53">             if (!props) {</span>
<a href="#l3.54"></a><span id="l3.54">                 return;</span>
<a href="#l3.55"></a><span id="l3.55">             }</span>
<a href="#l3.56"></a><span id="l3.56">             for (var prop of props) {</span>
<a href="#l3.57"></a><span id="l3.57">                 let hell = prop.getValues();</span>
<a href="#l3.58"></a><span id="l3.58">                 if (hell.length &gt; 1) {</span>
<a href="#l3.59"></a><span id="l3.59">                     // Uh oh, multiple property values. Our code expects each as one</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -121,17 +121,17 @@ agendaListbox.onCheckboxChange =</span>
<a href="#l4.4"></a><span id="l4.4"> function onCheckboxChange(event) {</span>
<a href="#l4.5"></a><span id="l4.5">     var periodCheckbox = event.target;</span>
<a href="#l4.6"></a><span id="l4.6">     var lopen = (periodCheckbox.getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l4.7"></a><span id="l4.7">     var listItem = getParentNodeOrThis(periodCheckbox, &quot;agenda-checkbox-richlist-item&quot;);</span>
<a href="#l4.8"></a><span id="l4.8">     var period = listItem.getItem();</span>
<a href="#l4.9"></a><span id="l4.9">     period.open= lopen;</span>
<a href="#l4.10"></a><span id="l4.10">     // as the agenda-checkboxes are only transient we have to set the &quot;checked&quot;</span>
<a href="#l4.11"></a><span id="l4.11">     // attribute at their hidden origins to make that attribute persistent.</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    document.getElementById(listItem.id + &quot;-hidden&quot;).setAttribute(&quot;checked&quot;, </span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    document.getElementById(listItem.id + &quot;-hidden&quot;).setAttribute(&quot;checked&quot;,</span>
<a href="#l4.14"></a><span id="l4.14">                             periodCheckbox.getAttribute(&quot;checked&quot;));</span>
<a href="#l4.15"></a><span id="l4.15">     if (lopen) {</span>
<a href="#l4.16"></a><span id="l4.16">         agendaListbox.refreshCalendarQuery(period.start, period.end);</span>
<a href="#l4.17"></a><span id="l4.17">     } else {</span>
<a href="#l4.18"></a><span id="l4.18">         listItem = listItem.nextSibling;</span>
<a href="#l4.19"></a><span id="l4.19">         do {</span>
<a href="#l4.20"></a><span id="l4.20">             var leaveloop = (listItem == null);</span>
<a href="#l4.21"></a><span id="l4.21">             if (!leaveloop) {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -139,17 +139,17 @@ function onCheckboxChange(event) {</span>
<a href="#l4.23"></a><span id="l4.23">                 leaveloop = (!agendaListbox.isEventListItem(listItem));</span>
<a href="#l4.24"></a><span id="l4.24">                 if (!leaveloop) {</span>
<a href="#l4.25"></a><span id="l4.25">                     listItem.remove();</span>
<a href="#l4.26"></a><span id="l4.26">                     listItem = nextItemSibling;</span>
<a href="#l4.27"></a><span id="l4.27">                 }</span>
<a href="#l4.28"></a><span id="l4.28">             }</span>
<a href="#l4.29"></a><span id="l4.29">         } while (!leaveloop);</span>
<a href="#l4.30"></a><span id="l4.30">     }</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    calendarController.onSelectionChanged({detail: []});    </span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+    calendarController.onSelectionChanged({detail: []});</span>
<a href="#l4.33"></a><span id="l4.33"> };</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35"> /**</span>
<a href="#l4.36"></a><span id="l4.36">  * Handler function called when an agenda listbox item is selected</span>
<a href="#l4.37"></a><span id="l4.37">  *</span>
<a href="#l4.38"></a><span id="l4.38">  * @param aListItem     The agenda-base-richlist-item that was selected.</span>
<a href="#l4.39"></a><span id="l4.39">  */</span>
<a href="#l4.40"></a><span id="l4.40"> agendaListbox.onSelect =</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineat">@@ -455,17 +455,17 @@ function comparisonDate(aItem, aPeriod) </span>
<a href="#l4.42"></a><span id="l4.42">  * @param aPeriod       (optional) the period to search in.</span>
<a href="#l4.43"></a><span id="l4.43">  * @return              An array of list items for the given item.</span>
<a href="#l4.44"></a><span id="l4.44">  */</span>
<a href="#l4.45"></a><span id="l4.45"> agendaListbox.getListItems =</span>
<a href="#l4.46"></a><span id="l4.46"> function getListItems(aItem, aPeriod) {</span>
<a href="#l4.47"></a><span id="l4.47">     var retlistItems = new Array();</span>
<a href="#l4.48"></a><span id="l4.48">     var periods = [aPeriod];</span>
<a href="#l4.49"></a><span id="l4.49">     if (!aPeriod) {</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-        var periods = this.findPeriodsForItem(aItem);</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+        periods = this.findPeriodsForItem(aItem);</span>
<a href="#l4.52"></a><span id="l4.52">     }</span>
<a href="#l4.53"></a><span id="l4.53">     if (periods.length &gt; 0) {</span>
<a href="#l4.54"></a><span id="l4.54">         for (var i = 0; i &lt; periods.length; i++) {</span>
<a href="#l4.55"></a><span id="l4.55">             let period = periods[i];</span>
<a href="#l4.56"></a><span id="l4.56">             let complistItem = period.listItem;</span>
<a href="#l4.57"></a><span id="l4.57">             do {</span>
<a href="#l4.58"></a><span id="l4.58">                 complistItem = complistItem.nextSibling;</span>
<a href="#l4.59"></a><span id="l4.59">                 var leaveloop = (!this.isEventListItem(complistItem));</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineat">@@ -1067,22 +1067,22 @@ function setCurrentEvent() {</span>
<a href="#l4.61"></a><span id="l4.61">         var removelist = [];</span>
<a href="#l4.62"></a><span id="l4.62">         var anow = now();</span>
<a href="#l4.63"></a><span id="l4.63">         var msuntillend = 0;</span>
<a href="#l4.64"></a><span id="l4.64">         var msuntillstart = 0;</span>
<a href="#l4.65"></a><span id="l4.65">         do {</span>
<a href="#l4.66"></a><span id="l4.66">             var leaveloop = (!agendaListbox.isEventListItem(complistItem));</span>
<a href="#l4.67"></a><span id="l4.67">             if (!leaveloop) {</span>
<a href="#l4.68"></a><span id="l4.68">                 msuntillstart =  complistItem.occurrence.startDate</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-                                .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-                                .subtractDate(anow).inSeconds;</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+                                             .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+                                             .subtractDate(anow).inSeconds;</span>
<a href="#l4.73"></a><span id="l4.73">                 if (msuntillstart &lt;= 0) {</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-                    var msuntillend = complistItem.occurrence.endDate</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-                                        .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-                                        .subtractDate(anow).inSeconds;</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+                    msuntillend = complistItem.occurrence.endDate</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+                                              .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+                                              .subtractDate(anow).inSeconds;</span>
<a href="#l4.80"></a><span id="l4.80">                     if (msuntillend &gt; 0) {</span>
<a href="#l4.81"></a><span id="l4.81">                         complistItem.setAttribute(&quot;current&quot;, &quot;true&quot;);</span>
<a href="#l4.82"></a><span id="l4.82">                         if ((msuntillend &lt; msScheduleTime)  || (msScheduleTime == -1)){</span>
<a href="#l4.83"></a><span id="l4.83">                             msScheduleTime = msuntillend;</span>
<a href="#l4.84"></a><span id="l4.84">                         }</span>
<a href="#l4.85"></a><span id="l4.85">                     } else {</span>
<a href="#l4.86"></a><span id="l4.86">                          removelist.push(complistItem);</span>
<a href="#l4.87"></a><span id="l4.87">                     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -41,43 +41,44 @@</span>
<a href="#l5.4"></a><span id="l5.4">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.5"></a><span id="l5.5">       &lt;/property&gt;</span>
<a href="#l5.6"></a><span id="l5.6">       &lt;property name=&quot;Item&quot;&gt;</span>
<a href="#l5.7"></a><span id="l5.7">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.8"></a><span id="l5.8">             return mItem;</span>
<a href="#l5.9"></a><span id="l5.9">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.10"></a><span id="l5.10">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l5.11"></a><span id="l5.11">           this.mItem = val;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          var headerLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-label&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-          var itemDateTimeLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-value&quot;);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+          let headerLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-label&quot;);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+          let itemDateTimeLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-value&quot;);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+          let date;</span>
<a href="#l5.17"></a><span id="l5.17">           if (this.mode == &quot;start&quot;) {</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-              var date = this.mItem[calGetStartDateProp(this.mItem)];</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+              date = this.mItem[calGetStartDateProp(this.mItem)];</span>
<a href="#l5.20"></a><span id="l5.20">               //this.mItem.startDate || this.mItem.entryDate;</span>
<a href="#l5.21"></a><span id="l5.21">               if (date) {</span>
<a href="#l5.22"></a><span id="l5.22">                   let label;</span>
<a href="#l5.23"></a><span id="l5.23">                   if (isToDo(this.mItem)) {</span>
<a href="#l5.24"></a><span id="l5.24">                       label = this.getAttribute(&quot;taskStartLabel&quot;);</span>
<a href="#l5.25"></a><span id="l5.25">                   } else {</span>
<a href="#l5.26"></a><span id="l5.26">                       label = this.getAttribute(&quot;eventStartLabel&quot;);</span>
<a href="#l5.27"></a><span id="l5.27">                   }</span>
<a href="#l5.28"></a><span id="l5.28">                   headerLabel.value = label;</span>
<a href="#l5.29"></a><span id="l5.29">               }</span>
<a href="#l5.30"></a><span id="l5.30">           } else {</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-              var date = this.mItem[calGetEndDateProp(this.mItem)];</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+              date = this.mItem[calGetEndDateProp(this.mItem)];</span>
<a href="#l5.33"></a><span id="l5.33">               if (date) {</span>
<a href="#l5.34"></a><span id="l5.34">                   let label;</span>
<a href="#l5.35"></a><span id="l5.35">                   if (isToDo(this.mItem)) {</span>
<a href="#l5.36"></a><span id="l5.36">                           label = this.getAttribute(&quot;taskDueLabel&quot;);</span>
<a href="#l5.37"></a><span id="l5.37">                   } else {</span>
<a href="#l5.38"></a><span id="l5.38">                       label = this.getAttribute(&quot;eventEndLabel&quot;);</span>
<a href="#l5.39"></a><span id="l5.39">                   }</span>
<a href="#l5.40"></a><span id="l5.40">                   headerLabel.value = label;</span>
<a href="#l5.41"></a><span id="l5.41">               }</span>
<a href="#l5.42"></a><span id="l5.42">           }</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-          var hideLabels = (date == null);</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+          let hideLabels = (date == null);</span>
<a href="#l5.45"></a><span id="l5.45">           if (hideLabels) {</span>
<a href="#l5.46"></a><span id="l5.46">               this.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l5.47"></a><span id="l5.47">           } else {</span>
<a href="#l5.48"></a><span id="l5.48">               const kDefaultTimezone = cal.calendarDefaultTimezone();</span>
<a href="#l5.49"></a><span id="l5.49">               let localTime = date.getInTimezone(kDefaultTimezone);</span>
<a href="#l5.50"></a><span id="l5.50">               let formatter = getDateFormatter();</span>
<a href="#l5.51"></a><span id="l5.51">               itemDateTimeLabel.value = formatter.formatDateTime(localTime);</span>
<a href="#l5.52"></a><span id="l5.52">               if (date.timezone.tzid != kDefaultTimezone.tzid) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -513,20 +513,16 @@</span>
<a href="#l6.4"></a><span id="l6.4">                    // Refresh the view so the settings take effect</span>
<a href="#l6.5"></a><span id="l6.5">                    this.refreshView();</span>
<a href="#l6.6"></a><span id="l6.6">                    break;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">                case &quot;calendar.weeks.inview&quot;:</span>
<a href="#l6.9"></a><span id="l6.9">                    this.weeksInView = aSubject.getIntPref(aPreference);</span>
<a href="#l6.10"></a><span id="l6.10">                    break;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-               case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                   this.refreshView();</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                   break;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-</span>
<a href="#l6.16"></a><span id="l6.16">                case &quot;calendar.view-minimonth.showWeekNumber&quot;:</span>
<a href="#l6.17"></a><span id="l6.17">                    this.mShowWeekNumber = aSubject.getBoolPref(aPreference);</span>
<a href="#l6.18"></a><span id="l6.18">                    if (this.mShowWeekNumber) {</span>
<a href="#l6.19"></a><span id="l6.19">                        this.refreshView();</span>
<a href="#l6.20"></a><span id="l6.20">                    } else {</span>
<a href="#l6.21"></a><span id="l6.21">                        this.hideWeekNumbers();</span>
<a href="#l6.22"></a><span id="l6.22">                    }</span>
<a href="#l6.23"></a><span id="l6.23">                    break;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineat">@@ -548,28 +544,28 @@</span>
<a href="#l6.25"></a><span id="l6.25">       &lt;/method&gt;</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">       &lt;method name=&quot;setSelectedItems&quot;&gt;</span>
<a href="#l6.28"></a><span id="l6.28">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l6.29"></a><span id="l6.29">         &lt;parameter name=&quot;aItems&quot;/&gt;</span>
<a href="#l6.30"></a><span id="l6.30">         &lt;parameter name=&quot;aSuppressEvent&quot;/&gt;</span>
<a href="#l6.31"></a><span id="l6.31">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.32"></a><span id="l6.32">           if (this.mSelectedItems.length) {</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-              for (var item of this.mSelectedItems) {</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+              for (let item of this.mSelectedItems) {</span>
<a href="#l6.35"></a><span id="l6.35">                   let oldboxes = this.findDayBoxesForItem(item);</span>
<a href="#l6.36"></a><span id="l6.36">                   for (let oldbox of oldboxes) {</span>
<a href="#l6.37"></a><span id="l6.37">                       oldbox.unselectItem(item);</span>
<a href="#l6.38"></a><span id="l6.38">                   }</span>
<a href="#l6.39"></a><span id="l6.39">               }</span>
<a href="#l6.40"></a><span id="l6.40">           }</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42">           this.mSelectedItems = aItems || [];</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44">           if (this.mSelectedItems.length) {</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-              for (var item of this.mSelectedItems) {</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+              for (let item of this.mSelectedItems) {</span>
<a href="#l6.47"></a><span id="l6.47">                   let newboxes = this.findDayBoxesForItem(item);</span>
<a href="#l6.48"></a><span id="l6.48">                   for (let newbox of newboxes) {</span>
<a href="#l6.49"></a><span id="l6.49">                       newbox.selectItem(item);</span>
<a href="#l6.50"></a><span id="l6.50">                   }</span>
<a href="#l6.51"></a><span id="l6.51">               }</span>
<a href="#l6.52"></a><span id="l6.52">           }</span>
<a href="#l6.53"></a><span id="l6.53"> </span>
<a href="#l6.54"></a><span id="l6.54">           if (!aSuppressEvent) {</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineat">@@ -772,23 +768,23 @@</span>
<a href="#l6.56"></a><span id="l6.56">           var dateList = this.getDateList({})</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58">           // This allows to find the first column of dayboxes where to set the</span>
<a href="#l6.59"></a><span id="l6.59">           // week labels taking into account whether days-off are displayed or not.</span>
<a href="#l6.60"></a><span id="l6.60">           let weekLabelColumnPos = -1;</span>
<a href="#l6.61"></a><span id="l6.61"> </span>
<a href="#l6.62"></a><span id="l6.62">           var rows = this.monthgridrows.childNodes;</span>
<a href="#l6.63"></a><span id="l6.63"> </span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-          // Iterate through each monthgridrow and set up the day-boxes that </span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+          // Iterate through each monthgridrow and set up the day-boxes that</span>
<a href="#l6.66"></a><span id="l6.66">           // are its child nodes.  Remember, childNodes is not a normal array,</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-          // so don't use the in operator if you don't want extra properties </span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+          // so don't use the in operator if you don't want extra properties</span>
<a href="#l6.69"></a><span id="l6.69">           // coming out.</span>
<a href="#l6.70"></a><span id="l6.70">           for (var i = 0; i &lt; rows.length; i++) {</span>
<a href="#l6.71"></a><span id="l6.71">             var row = rows[i];</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-            // If we've already assigned all of the day-boxes that we need, just </span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+            // If we've already assigned all of the day-boxes that we need, just</span>
<a href="#l6.74"></a><span id="l6.74">             // collapse the rest of the rows, otherwise expand them if needed.</span>
<a href="#l6.75"></a><span id="l6.75">             if (finished) {</span>
<a href="#l6.76"></a><span id="l6.76">               row.setAttribute(&quot;collapsed&quot;, true);</span>
<a href="#l6.77"></a><span id="l6.77">               continue;</span>
<a href="#l6.78"></a><span id="l6.78">             } else {</span>
<a href="#l6.79"></a><span id="l6.79">               row.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l6.80"></a><span id="l6.80">             }</span>
<a href="#l6.81"></a><span id="l6.81">             for (var j = 0; j &lt; row.childNodes.length; j++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -2444,17 +2444,17 @@</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">                 this.parentColumn.startSweepingToModifyEvent(this, this.mOccurrence, &quot;middle&quot;, this.mMouseX, this.mMouseY);</span>
<a href="#l7.6"></a><span id="l7.6">                 this.mInMouseDown = false;</span>
<a href="#l7.7"></a><span id="l7.7">             }</span>
<a href="#l7.8"></a><span id="l7.8">         }</span>
<a href="#l7.9"></a><span id="l7.9">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">       &lt;handler event=&quot;mouseout&quot;&gt;&lt;![CDATA[</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        if (!this.mEditing &amp;&amp; this.mInMouseDown &amp;&amp; this.parentColumn) { </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+        if (!this.mEditing &amp;&amp; this.mInMouseDown &amp;&amp; this.parentColumn) {</span>
<a href="#l7.14"></a><span id="l7.14">             if (this.editingTimer) {</span>
<a href="#l7.15"></a><span id="l7.15">                 clearTimeout(this.editingTimer);</span>
<a href="#l7.16"></a><span id="l7.16">                 this.editingTimer = null;</span>
<a href="#l7.17"></a><span id="l7.17">             }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">             this.calendarView.setSelectedItems(1, [this.mOccurrence]);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">             this.mEditing = false;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -2886,26 +2886,27 @@</span>
<a href="#l7.23"></a><span id="l7.23">           }</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.26"></a><span id="l7.26">       &lt;/method&gt;</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28">       &lt;method name=&quot;getDateList&quot;&gt;</span>
<a href="#l7.29"></a><span id="l7.29">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l7.30"></a><span id="l7.30">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-           var dates = new Array();</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+           let dates = new Array();</span>
<a href="#l7.33"></a><span id="l7.33">            if (this.mStartDate &amp;&amp; this.mEndDate) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-               var d = this.mStartDate.clone();</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+               let d = this.mStartDate.clone();</span>
<a href="#l7.36"></a><span id="l7.36">                while (d.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l7.37"></a><span id="l7.37">                    dates.push(d.clone());</span>
<a href="#l7.38"></a><span id="l7.38">                    d.day += 1;</span>
<a href="#l7.39"></a><span id="l7.39">                }</span>
<a href="#l7.40"></a><span id="l7.40">            } else if (this.mDateList) {</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-               for (var d of this.mDateList)</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+               for (let d of this.mDateList) {</span>
<a href="#l7.43"></a><span id="l7.43">                    dates.push(d.clone());</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+               }</span>
<a href="#l7.45"></a><span id="l7.45">            }</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47">            aCount.value = dates.length;</span>
<a href="#l7.48"></a><span id="l7.48">            return dates;</span>
<a href="#l7.49"></a><span id="l7.49">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.50"></a><span id="l7.50">       &lt;/method&gt;</span>
<a href="#l7.51"></a><span id="l7.51"> </span>
<a href="#l7.52"></a><span id="l7.52">       &lt;property name=&quot;selectedDateTime&quot;&gt;</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineat">@@ -2969,30 +2970,30 @@</span>
<a href="#l7.54"></a><span id="l7.54">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.55"></a><span id="l7.55">       &lt;/method&gt;</span>
<a href="#l7.56"></a><span id="l7.56">       &lt;method name=&quot;setSelectedItems&quot;&gt;</span>
<a href="#l7.57"></a><span id="l7.57">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l7.58"></a><span id="l7.58">         &lt;parameter name=&quot;aItems&quot;/&gt;</span>
<a href="#l7.59"></a><span id="l7.59">         &lt;parameter name=&quot;aSuppressEvent&quot;/&gt;</span>
<a href="#l7.60"></a><span id="l7.60">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.61"></a><span id="l7.61">           if (this.mSelectedItems) {</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-              for (var item of this.mSelectedItems) {</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-                  for (var occ of this.getItemOccurrencesInView(item)) {</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-                      var cols = this.findColumnsForItem(occ);</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+              for (let item of this.mSelectedItems) {</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+                  for (let occ of this.getItemOccurrencesInView(item)) {</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+                      let cols = this.findColumnsForItem(occ);</span>
<a href="#l7.68"></a><span id="l7.68">                       for (let col of cols) {</span>
<a href="#l7.69"></a><span id="l7.69">                           col.header.unselectOccurrence(occ);</span>
<a href="#l7.70"></a><span id="l7.70">                           col.column.unselectOccurrence(occ);</span>
<a href="#l7.71"></a><span id="l7.71">                       }</span>
<a href="#l7.72"></a><span id="l7.72">                   }</span>
<a href="#l7.73"></a><span id="l7.73">               }</span>
<a href="#l7.74"></a><span id="l7.74">           }</span>
<a href="#l7.75"></a><span id="l7.75">           this.mSelectedItems = aItems || [];</span>
<a href="#l7.76"></a><span id="l7.76"> </span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-          for (var item of this.mSelectedItems) {</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-              for (var occ of this.getItemOccurrencesInView(item)) {</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+          for (let item of this.mSelectedItems) {</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+              for (let occ of this.getItemOccurrencesInView(item)) {</span>
<a href="#l7.81"></a><span id="l7.81">                   let cols = this.findColumnsForItem(occ);</span>
<a href="#l7.82"></a><span id="l7.82">                   if (cols.length &gt; 0) {</span>
<a href="#l7.83"></a><span id="l7.83">                       let start = item.startDate || item.entryDate || item.dueDate;</span>
<a href="#l7.84"></a><span id="l7.84">                       for (let col of cols) {</span>
<a href="#l7.85"></a><span id="l7.85">                           if (start.isDate) {</span>
<a href="#l7.86"></a><span id="l7.86">                               col.header.selectOccurrence(occ);</span>
<a href="#l7.87"></a><span id="l7.87">                           } else {</span>
<a href="#l7.88"></a><span id="l7.88">                               col.column.selectOccurrence(occ);</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineat">@@ -3066,17 +3067,17 @@</span>
<a href="#l7.90"></a><span id="l7.90">                   if (this.queryEndDate.compare(occEnd) &lt; 0) {</span>
<a href="#l7.91"></a><span id="l7.91">                       occEnd = this.queryEndDate;</span>
<a href="#l7.92"></a><span id="l7.92">                   }</span>
<a href="#l7.93"></a><span id="l7.93"> </span>
<a href="#l7.94"></a><span id="l7.94">                   // Convert to display timezone if different</span>
<a href="#l7.95"></a><span id="l7.95">                   if (occStart.timezone != displayTZ) {</span>
<a href="#l7.96"></a><span id="l7.96">                       occStart = occStart.getInTimezone(displayTZ);</span>
<a href="#l7.97"></a><span id="l7.97">                   }</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-                  if (occEnd.timezone != displayTZ) { </span>
<a href="#l7.99"></a><span id="l7.99" class="difflineplus">+                  if (occEnd.timezone != displayTZ) {</span>
<a href="#l7.100"></a><span id="l7.100">                       occEnd = occEnd.getInTimezone(displayTZ);</span>
<a href="#l7.101"></a><span id="l7.101">                   }</span>
<a href="#l7.102"></a><span id="l7.102">                   // If crosses midnite in current TZ, set end just</span>
<a href="#l7.103"></a><span id="l7.103">                   // before midnite after start so start/title usually visible.</span>
<a href="#l7.104"></a><span id="l7.104">                   if (!sameDay(occStart, occEnd)) {</span>
<a href="#l7.105"></a><span id="l7.105">                       occEnd = occStart.clone();</span>
<a href="#l7.106"></a><span id="l7.106">                       occEnd.day = occStart.day;</span>
<a href="#l7.107"></a><span id="l7.107">                       occEnd.hour = 23;</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineat">@@ -3115,17 +3116,17 @@</span>
<a href="#l7.109"></a><span id="l7.109">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l7.110"></a><span id="l7.110">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l7.111"></a><span id="l7.111">           this.mPixPerMin = val;</span>
<a href="#l7.112"></a><span id="l7.112"> </span>
<a href="#l7.113"></a><span id="l7.113">           let timebar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timebar&quot;);</span>
<a href="#l7.114"></a><span id="l7.114">           timebar.pixelsPerMinute = val;</span>
<a href="#l7.115"></a><span id="l7.115"> </span>
<a href="#l7.116"></a><span id="l7.116">           if (!this.mDateColumns) {</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-              return;</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineplus">+              return val;</span>
<a href="#l7.119"></a><span id="l7.119">           }</span>
<a href="#l7.120"></a><span id="l7.120">           for (let col of this.mDateColumns) {</span>
<a href="#l7.121"></a><span id="l7.121">               col.column.pixelsPerMinute = val;</span>
<a href="#l7.122"></a><span id="l7.122">           }</span>
<a href="#l7.123"></a><span id="l7.123">           return val;</span>
<a href="#l7.124"></a><span id="l7.124">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l7.125"></a><span id="l7.125">       &lt;/property&gt;</span>
<a href="#l7.126"></a><span id="l7.126"> </span>
<a href="#l7.127"></a><span id="l7.127" class="difflineat">@@ -3189,61 +3190,61 @@</span>
<a href="#l7.128"></a><span id="l7.128">               this.reorient();</span>
<a href="#l7.129"></a><span id="l7.129"> </span>
<a href="#l7.130"></a><span id="l7.130">           return ret;</span>
<a href="#l7.131"></a><span id="l7.131">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.132"></a><span id="l7.132">       &lt;/method&gt;</span>
<a href="#l7.133"></a><span id="l7.133"> </span>
<a href="#l7.134"></a><span id="l7.134">       &lt;method name=&quot;reorient&quot;&gt;</span>
<a href="#l7.135"></a><span id="l7.135">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineminus">-          var orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-          var otherorient = &quot;vertical&quot;;</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+          let orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+          let otherorient = &quot;vertical&quot;;</span>
<a href="#l7.140"></a><span id="l7.140">           if (!orient) orient = &quot;horizontal&quot;;</span>
<a href="#l7.141"></a><span id="l7.141">           if (orient == &quot;vertical&quot;) otherorient = &quot;horizontal&quot;;</span>
<a href="#l7.142"></a><span id="l7.142"> </span>
<a href="#l7.143"></a><span id="l7.143">           if (orient == &quot;horizontal&quot;) {</span>
<a href="#l7.144"></a><span id="l7.144">               this.pixelsPerMinute = 1.5;</span>
<a href="#l7.145"></a><span id="l7.145">           } else {</span>
<a href="#l7.146"></a><span id="l7.146">               this.pixelsPerMinute = 0.6;</span>
<a href="#l7.147"></a><span id="l7.147">           }</span>
<a href="#l7.148"></a><span id="l7.148"> </span>
<a href="#l7.149"></a><span id="l7.149" class="difflineminus">-          var normalelems = ['mainbox', 'timebar'];</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineminus">-          var otherelems = ['labelbox', 'labeldaybox', 'headertimespacer',</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+          let normalelems = ['mainbox', 'timebar'];</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineplus">+          let otherelems = ['labelbox', 'labeldaybox', 'headertimespacer',</span>
<a href="#l7.153"></a><span id="l7.153">                             'headerbox', 'headerdaybox', 'scrollbox', 'daybox'];</span>
<a href="#l7.154"></a><span id="l7.154"> </span>
<a href="#l7.155"></a><span id="l7.155" class="difflineminus">-          for (var id of normalelems) {</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+          for (let id of normalelems) {</span>
<a href="#l7.157"></a><span id="l7.157">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, id).setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l7.158"></a><span id="l7.158">           }</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-          for (var id of otherelems) {</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+          for (let id of otherelems) {</span>
<a href="#l7.161"></a><span id="l7.161">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, id).setAttribute(&quot;orient&quot;, otherorient);</span>
<a href="#l7.162"></a><span id="l7.162">           }</span>
<a href="#l7.163"></a><span id="l7.163"> </span>
<a href="#l7.164"></a><span id="l7.164" class="difflineminus">-          var scrollbox = document.getAnonymousElementByAttribute(</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineplus">+          let scrollbox = document.getAnonymousElementByAttribute(</span>
<a href="#l7.166"></a><span id="l7.166">                          this, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineminus">-          var mainbox = document.getAnonymousElementByAttribute(</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineplus">+          let mainbox = document.getAnonymousElementByAttribute(</span>
<a href="#l7.169"></a><span id="l7.169">                         this, &quot;anonid&quot;, &quot;mainbox&quot;);</span>
<a href="#l7.170"></a><span id="l7.170"> </span>
<a href="#l7.171"></a><span id="l7.171">           if (orient == &quot;vertical&quot;) {</span>
<a href="#l7.172"></a><span id="l7.172">               scrollbox.setAttribute(</span>
<a href="#l7.173"></a><span id="l7.173">                   &quot;style&quot;, &quot;overflow-x: hidden; overflow-y: auto;&quot;);</span>
<a href="#l7.174"></a><span id="l7.174">               mainbox.setAttribute(</span>
<a href="#l7.175"></a><span id="l7.175">                   &quot;style&quot;, &quot;overflow-x: auto; overflow-y: hidden;&quot;);</span>
<a href="#l7.176"></a><span id="l7.176">           } else {</span>
<a href="#l7.177"></a><span id="l7.177">               scrollbox.setAttribute(</span>
<a href="#l7.178"></a><span id="l7.178">                   &quot;style&quot;, &quot;overflow-x: auto; overflow-y: hidden;&quot;);</span>
<a href="#l7.179"></a><span id="l7.179">               mainbox.setAttribute(</span>
<a href="#l7.180"></a><span id="l7.180">                   &quot;style&quot;, &quot;overflow-x: hidden; overflow-y: auto;&quot;);</span>
<a href="#l7.181"></a><span id="l7.181">           }</span>
<a href="#l7.182"></a><span id="l7.182"> </span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-          var boxes = [&quot;daybox&quot;, &quot;headerdaybox&quot;];</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineminus">-          for (var boxname of boxes) {</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineminus">-              var box = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, boxname);</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineplus">+          let boxes = [&quot;daybox&quot;, &quot;headerdaybox&quot;];</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineplus">+          for (let boxname of boxes) {</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+              let box = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, boxname);</span>
<a href="#l7.189"></a><span id="l7.189">               setAttributeToChildren(box, &quot;orient&quot;, orient);</span>
<a href="#l7.190"></a><span id="l7.190">           }</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineminus">-          var box = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;labeldaybox&quot;);</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineplus">+</span>
<a href="#l7.193"></a><span id="l7.193">           setAttributeToChildren(this.labeldaybox, &quot;orient&quot;, otherorient);</span>
<a href="#l7.194"></a><span id="l7.194"> </span>
<a href="#l7.195"></a><span id="l7.195">           // Refresh</span>
<a href="#l7.196"></a><span id="l7.196">           this.refresh();</span>
<a href="#l7.197"></a><span id="l7.197">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.198"></a><span id="l7.198">       &lt;/method&gt;</span>
<a href="#l7.199"></a><span id="l7.199"> </span>
<a href="#l7.200"></a><span id="l7.200">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineat">@@ -3449,17 +3450,17 @@</span>
<a href="#l7.202"></a><span id="l7.202">           this.mToggleStatus = toggleStatus;</span>
<a href="#l7.203"></a><span id="l7.203">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.204"></a><span id="l7.204">       &lt;/method&gt;</span>
<a href="#l7.205"></a><span id="l7.205"> </span>
<a href="#l7.206"></a><span id="l7.206">       &lt;method name=&quot;findColumnForDate&quot;&gt;</span>
<a href="#l7.207"></a><span id="l7.207">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l7.208"></a><span id="l7.208">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.209"></a><span id="l7.209">           if (!this.mDateColumns) {</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineminus">-              return;</span>
<a href="#l7.211"></a><span id="l7.211" class="difflineplus">+              return null;</span>
<a href="#l7.212"></a><span id="l7.212">           }</span>
<a href="#l7.213"></a><span id="l7.213">           for (var col of this.mDateColumns) {</span>
<a href="#l7.214"></a><span id="l7.214">               if (col.date.compare(aDate) == 0)</span>
<a href="#l7.215"></a><span id="l7.215">                   return col;</span>
<a href="#l7.216"></a><span id="l7.216">           }</span>
<a href="#l7.217"></a><span id="l7.217">           return null;</span>
<a href="#l7.218"></a><span id="l7.218">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.219"></a><span id="l7.219">       &lt;/method&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -90,17 +90,17 @@ function handleTaskContextMenuStateChang</span>
<a href="#l8.4"></a><span id="l8.4"> }</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> /**</span>
<a href="#l8.7"></a><span id="l8.7">  * Change the opening menu for the selected tasks.</span>
<a href="#l8.8"></a><span id="l8.8">  *</span>
<a href="#l8.9"></a><span id="l8.9">  * @param aEvent    The popupshowing event of the opening menu.</span>
<a href="#l8.10"></a><span id="l8.10">  */</span>
<a href="#l8.11"></a><span id="l8.11"> function changeMenuForTask(aEvent) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    // Make sure to update the status of some commands. </span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    // Make sure to update the status of some commands.</span>
<a href="#l8.14"></a><span id="l8.14">     [&quot;calendar_delete_todo_command&quot;,</span>
<a href="#l8.15"></a><span id="l8.15">      &quot;calendar_toggle_completed_command&quot;,</span>
<a href="#l8.16"></a><span id="l8.16">      &quot;calendar_general-progress_command&quot;,</span>
<a href="#l8.17"></a><span id="l8.17">      &quot;calendar_general-priority_command&quot;,</span>
<a href="#l8.18"></a><span id="l8.18">      &quot;calendar_general-postpone_command&quot;].forEach(goUpdateCommand);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     let tasks = getSelectedTasks(aEvent);</span>
<a href="#l8.21"></a><span id="l8.21">     let tasksSelected = (tasks.length &gt; 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1184,17 +1184,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">             &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.5"></a><span id="l9.5">               let initialDate = agendaListbox.today ? agendaListbox.today.start : now();</span>
<a href="#l9.6"></a><span id="l9.6">               return initialDate ? initialDate : now();</span>
<a href="#l9.7"></a><span id="l9.7">             ]]&gt;&lt;/body&gt;</span>
<a href="#l9.8"></a><span id="l9.8">       &lt;/method&gt;</span>
<a href="#l9.9"></a><span id="l9.9">       &lt;method name=&quot;updateFilter&quot;&gt;</span>
<a href="#l9.10"></a><span id="l9.10">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l9.11"></a><span id="l9.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-            this.mFilter.selectedDate = agendaListbox.today &amp;&amp; agendaListbox.today.start ? </span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+            this.mFilter.selectedDate = agendaListbox.today &amp;&amp; agendaListbox.today.start ?</span>
<a href="#l9.14"></a><span id="l9.14">                                         agendaListbox.today.start : now();</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16">             this.doUpdateFilter(aFilter);</span>
<a href="#l9.17"></a><span id="l9.17">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.18"></a><span id="l9.18">       &lt;/method&gt;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-    &lt;/implementation&gt;    </span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l9.21"></a><span id="l9.21">   &lt;/binding&gt;</span>
<a href="#l9.22"></a><span id="l9.22"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -68,17 +68,17 @@ var taskDetailsView = {</span>
<a href="#l10.4"></a><span id="l10.4">                         statusDetails.value = calGetString(</span>
<a href="#l10.5"></a><span id="l10.5">                             &quot;calendar&quot;,</span>
<a href="#l10.6"></a><span id="l10.6">                             &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l10.7"></a><span id="l10.7">                         break;</span>
<a href="#l10.8"></a><span id="l10.8">                     case &quot;IN-PROCESS&quot;:</span>
<a href="#l10.9"></a><span id="l10.9">                         var percent = 0;</span>
<a href="#l10.10"></a><span id="l10.10">                         var property = item.getProperty(&quot;PERCENT-COMPLETE&quot;);</span>
<a href="#l10.11"></a><span id="l10.11">                         if (property != null) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                            var percent = parseInt(property);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+                            percent = parseInt(property, 10);</span>
<a href="#l10.14"></a><span id="l10.14">                         }</span>
<a href="#l10.15"></a><span id="l10.15">                         statusDetails.value = calGetString(</span>
<a href="#l10.16"></a><span id="l10.16">                             &quot;calendar&quot;,</span>
<a href="#l10.17"></a><span id="l10.17">                             &quot;taskDetailsStatusInProgress&quot;, [percent]);</span>
<a href="#l10.18"></a><span id="l10.18">                         break;</span>
<a href="#l10.19"></a><span id="l10.19">                     case &quot;COMPLETED&quot;:</span>
<a href="#l10.20"></a><span id="l10.20">                         if (item.completedDate) {</span>
<a href="#l10.21"></a><span id="l10.21">                             var completedDate = item.completedDate.getInTimezone(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder-todo.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder-todo.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -19,17 +19,17 @@ function prepareCalendarToDoUnifinder() </span>
<a href="#l11.4"></a><span id="l11.4">  */</span>
<a href="#l11.5"></a><span id="l11.5"> function updateCalendarToDoUnifinder(aFilter) {</span>
<a href="#l11.6"></a><span id="l11.6">     // Set up hiding completed tasks for the unifinder-todo tree</span>
<a href="#l11.7"></a><span id="l11.7">     let showCompleted = document.getElementById(&quot;show-completed-checkbox&quot;).checked;</span>
<a href="#l11.8"></a><span id="l11.8">     let tree = document.getElementById(&quot;unifinder-todo-tree&quot;);</span>
<a href="#l11.9"></a><span id="l11.9">     let oldFilter = document.getElementById(&quot;unifinder-todo-filter-broadcaster&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l11.10"></a><span id="l11.10">     let filter = oldFilter;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    // This function acts as an event listener, in which case we get the Event as the </span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    // This function acts as an event listener, in which case we get the Event as the</span>
<a href="#l11.14"></a><span id="l11.14">     // parameter instead of a filter.</span>
<a href="#l11.15"></a><span id="l11.15">     if (aFilter &amp;&amp; !(aFilter instanceof Event)) {</span>
<a href="#l11.16"></a><span id="l11.16">         filter = aFilter;</span>
<a href="#l11.17"></a><span id="l11.17">     }</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">     if (filter &amp;&amp; (filter != oldFilter)) {</span>
<a href="#l11.20"></a><span id="l11.20">         document.getElementById(&quot;unifinder-todo-filter-broadcaster&quot;).setAttribute(&quot;value&quot;, aFilter);</span>
<a href="#l11.21"></a><span id="l11.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -78,17 +78,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">          this.eventNameTextbox.onkeypress = function onKeyPress(event) {</span>
<a href="#l12.5"></a><span id="l12.5">              // save on enter</span>
<a href="#l12.6"></a><span id="l12.6">              if (event.keyCode == 13)</span>
<a href="#l12.7"></a><span id="l12.7">                  self.stopEditing(true);</span>
<a href="#l12.8"></a><span id="l12.8">              // abort on escape</span>
<a href="#l12.9"></a><span id="l12.9">              else if (event.keyCode == 27)</span>
<a href="#l12.10"></a><span id="l12.10">                  self.stopEditing(false);</span>
<a href="#l12.11"></a><span id="l12.11">          };</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-         function stopPropagationIfEditing(event) { </span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+         function stopPropagationIfEditing(event) {</span>
<a href="#l12.14"></a><span id="l12.14">            if (self.mEditing) {</span>
<a href="#l12.15"></a><span id="l12.15">              event.stopPropagation();</span>
<a href="#l12.16"></a><span id="l12.16">            }</span>
<a href="#l12.17"></a><span id="l12.17">          }</span>
<a href="#l12.18"></a><span id="l12.18">          // while editing, single click positions cursor, so don't propagate.</span>
<a href="#l12.19"></a><span id="l12.19">          this.eventNameTextbox.onclick = stopPropagationIfEditing;</span>
<a href="#l12.20"></a><span id="l12.20">          // while editing, double click selects words, so don't propagate.</span>
<a href="#l12.21"></a><span id="l12.21">          this.eventNameTextbox.ondblclick = stopPropagationIfEditing;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -153,17 +153,17 @@</span>
<a href="#l12.23"></a><span id="l12.23">           var item = this.mOccurrence;</span>
<a href="#l12.24"></a><span id="l12.24">           evl.value = (item.title ? item.title.replace(/\n/g, ' ') :</span>
<a href="#l12.25"></a><span id="l12.25">                                     cal.calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;));</span>
<a href="#l12.26"></a><span id="l12.26">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.27"></a><span id="l12.27">       &lt;/method&gt;</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29">       &lt;method name=&quot;setCSSClasses&quot;&gt;</span>
<a href="#l12.30"></a><span id="l12.30">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-          var item = this.mOccurrence;          </span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+          var item = this.mOccurrence;</span>
<a href="#l12.33"></a><span id="l12.33">           this.setAttribute(&quot;calendar-uri&quot;, item.calendar.uri.spec);</span>
<a href="#l12.34"></a><span id="l12.34">           this.setAttribute(&quot;calendar-id&quot;, item.calendar.id);</span>
<a href="#l12.35"></a><span id="l12.35">           var categoriesArray = item.getCategories({});</span>
<a href="#l12.36"></a><span id="l12.36">           if (categoriesArray.length &gt; 0) {</span>
<a href="#l12.37"></a><span id="l12.37">             var cssClassesArray = categoriesArray.map(formatStringForCSSRule);</span>
<a href="#l12.38"></a><span id="l12.38">             this.setAttribute(&quot;categories&quot;, cssClassesArray.join(&quot; &quot;));</span>
<a href="#l12.39"></a><span id="l12.39">           }</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -262,17 +262,17 @@</span>
<a href="#l12.42"></a><span id="l12.42">       &lt;/method&gt;</span>
<a href="#l12.43"></a><span id="l12.43">       &lt;method name=&quot;select&quot;&gt;</span>
<a href="#l12.44"></a><span id="l12.44">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l12.45"></a><span id="l12.45">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.46"></a><span id="l12.46">             if (!this.calendarView) {</span>
<a href="#l12.47"></a><span id="l12.47">                 return;</span>
<a href="#l12.48"></a><span id="l12.48">             }</span>
<a href="#l12.49"></a><span id="l12.49">             let items = this.calendarView.mSelectedItems.slice();</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-            if (event.ctrlKey || event.metaKey) {    </span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+            if (event.ctrlKey || event.metaKey) {</span>
<a href="#l12.52"></a><span id="l12.52">                 if (this.selected) {</span>
<a href="#l12.53"></a><span id="l12.53">                     let pos = items.indexOf(this.mOccurrence);</span>
<a href="#l12.54"></a><span id="l12.54">                     items.splice(pos, 1);</span>
<a href="#l12.55"></a><span id="l12.55">                 } else {</span>
<a href="#l12.56"></a><span id="l12.56">                     items.push(this.mOccurrence);</span>
<a href="#l12.57"></a><span id="l12.57">                 }</span>
<a href="#l12.58"></a><span id="l12.58">             } else {</span>
<a href="#l12.59"></a><span id="l12.59">                 items = [this.mOccurrence];</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineat">@@ -284,17 +284,17 @@</span>
<a href="#l12.61"></a><span id="l12.61">         &lt;parameter name=&quot;saveChanges&quot;/&gt;</span>
<a href="#l12.62"></a><span id="l12.62">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.63"></a><span id="l12.63">           if (!this.mEditing)</span>
<a href="#l12.64"></a><span id="l12.64">             return;</span>
<a href="#l12.65"></a><span id="l12.65"> </span>
<a href="#l12.66"></a><span id="l12.66">           this.mEditing = false;</span>
<a href="#l12.67"></a><span id="l12.67"> </span>
<a href="#l12.68"></a><span id="l12.68">           if (saveChanges &amp;&amp; (this.eventNameTextbox.value != this.mOriginalTextLabel)) {</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineminus">-              this.calendarView.controller.modifyOccurrence(this.mOccurrence, </span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+              this.calendarView.controller.modifyOccurrence(this.mOccurrence,</span>
<a href="#l12.71"></a><span id="l12.71">                                                             null, null,</span>
<a href="#l12.72"></a><span id="l12.72">                                                             this.eventNameTextbox.value);</span>
<a href="#l12.73"></a><span id="l12.73"> </span>
<a href="#l12.74"></a><span id="l12.74">               // Note that as soon as we do the modifyItem, this element ceases to exist,</span>
<a href="#l12.75"></a><span id="l12.75">               // so don't bother trying to modify anything further here! ('this' exists,</span>
<a href="#l12.76"></a><span id="l12.76">               // because it's being kept alive, but our child content etc. is all gone)</span>
<a href="#l12.77"></a><span id="l12.77">               return;</span>
<a href="#l12.78"></a><span id="l12.78">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -111,31 +111,33 @@ var calendarViewController = {</span>
<a href="#l13.4"></a><span id="l13.4">         // Make sure we are modifying a copy of aOccurrences, otherwise we will</span>
<a href="#l13.5"></a><span id="l13.5">         // run into race conditions when the view's doDeleteItem removes the</span>
<a href="#l13.6"></a><span id="l13.6">         // array elements while we are iterating through them. While we are at</span>
<a href="#l13.7"></a><span id="l13.7">         // it, filter out any items that have readonly calendars, so that</span>
<a href="#l13.8"></a><span id="l13.8">         // checking for one total item below also works out if all but one item</span>
<a href="#l13.9"></a><span id="l13.9">         // are readonly.</span>
<a href="#l13.10"></a><span id="l13.10">         var occurrences = aOccurrences.filter(function(item) { return isCalendarWritable(item.calendar); });</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-        for (var itemToDelete of occurrences) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        for (let itemToDelete of occurrences) {</span>
<a href="#l13.14"></a><span id="l13.14">             if (aUseParentItems) {</span>
<a href="#l13.15"></a><span id="l13.15">                 // Usually happens when ctrl-click is used. In that case we</span>
<a href="#l13.16"></a><span id="l13.16">                 // don't need to ask the user if he wants to delete an</span>
<a href="#l13.17"></a><span id="l13.17">                 // occurrence or not.</span>
<a href="#l13.18"></a><span id="l13.18">                 itemToDelete = itemToDelete.parentItem;</span>
<a href="#l13.19"></a><span id="l13.19">             } else if (!aDoNotConfirm &amp;&amp; occurrences.length == 1) {</span>
<a href="#l13.20"></a><span id="l13.20">                 // Only give the user the selection if only one occurrence is</span>
<a href="#l13.21"></a><span id="l13.21">                 // selected. Otherwise he will get a dialog for each occurrence</span>
<a href="#l13.22"></a><span id="l13.22">                 // he deletes.</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-                var [itemToDelete, hasFutureItem, response] = promptOccurrenceModification(itemToDelete, false, &quot;delete&quot;);</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+                let [targetItem, hasFutureItem, response] = promptOccurrenceModification(itemToDelete, false, &quot;delete&quot;);</span>
<a href="#l13.25"></a><span id="l13.25">                 if (!response) {</span>
<a href="#l13.26"></a><span id="l13.26">                     // The user canceled the dialog, bail out</span>
<a href="#l13.27"></a><span id="l13.27">                     break;</span>
<a href="#l13.28"></a><span id="l13.28">                 }</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+                itemToDelete = targetItem;</span>
<a href="#l13.31"></a><span id="l13.31">             }</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33">             // Now some dirty work: Make sure more than one occurrence can be</span>
<a href="#l13.34"></a><span id="l13.34">             // deleted by saving the recurring items and removing occurrences as</span>
<a href="#l13.35"></a><span id="l13.35">             // they come in. If this is not an occurrence, we can go ahead and</span>
<a href="#l13.36"></a><span id="l13.36">             // delete the whole item.</span>
<a href="#l13.37"></a><span id="l13.37">             if (itemToDelete.parentItem.hashId != itemToDelete.hashId) {</span>
<a href="#l13.38"></a><span id="l13.38">                 var savedItem = getSavedItem(itemToDelete);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -259,17 +259,17 @@ function matchCustomReminderToMenuitem(r</span>
<a href="#l14.4"></a><span id="l14.4">         }</span>
<a href="#l14.5"></a><span id="l14.5">     }</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">     return false;</span>
<a href="#l14.8"></a><span id="l14.8"> }</span>
<a href="#l14.9"></a><span id="l14.9"> /**</span>
<a href="#l14.10"></a><span id="l14.10">  * Load an item's reminders into the dialog</span>
<a href="#l14.11"></a><span id="l14.11">  *</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">- * @param reminders     An array of calIAlarms to load. </span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+ * @param reminders     An array of calIAlarms to load.</span>
<a href="#l14.14"></a><span id="l14.14">  */</span>
<a href="#l14.15"></a><span id="l14.15"> function loadReminders(reminders) {</span>
<a href="#l14.16"></a><span id="l14.16">     // select 'no reminder' by default</span>
<a href="#l14.17"></a><span id="l14.17">     let reminderList = document.getElementById(&quot;item-alarm&quot;);</span>
<a href="#l14.18"></a><span id="l14.18">     let reminderPopup = reminderList.firstChild;</span>
<a href="#l14.19"></a><span id="l14.19">     let customItem = document.getElementById(&quot;reminder-custom-menuitem&quot;);</span>
<a href="#l14.20"></a><span id="l14.20">     reminderList.selectedIndex = 0;</span>
<a href="#l14.21"></a><span id="l14.21">     gLastAlarmSelection = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -236,18 +236,18 @@ function propagateDateTime() {</span>
<a href="#l15.4"></a><span id="l15.4">  * variables to be initialized. It updates the date/time information displayed in</span>
<a href="#l15.5"></a><span id="l15.5">  * the dialog from the above noted variables.</span>
<a href="#l15.6"></a><span id="l15.6">  */</span>
<a href="#l15.7"></a><span id="l15.7"> function updateDateTime() {</span>
<a href="#l15.8"></a><span id="l15.8">     // Convert to default timezone if the timezone option</span>
<a href="#l15.9"></a><span id="l15.9">     // is *not* checked, otherwise keep the specific timezone</span>
<a href="#l15.10"></a><span id="l15.10">     // and display the labels in order to modify the timezone.</span>
<a href="#l15.11"></a><span id="l15.11">     if (gDisplayTimezone) {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        var startTime = gStartDate.getInTimezone(gStartTimezone);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-        var endTime = gEndDate.getInTimezone(gEndTimezone);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+        let startTime = gStartDate.getInTimezone(gStartTimezone);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        let endTime = gEndDate.getInTimezone(gEndTimezone);</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17">         if (startTime.isDate) {</span>
<a href="#l15.18"></a><span id="l15.18">             document.getElementById(&quot;all-day&quot;)</span>
<a href="#l15.19"></a><span id="l15.19">                 .setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l15.20"></a><span id="l15.20">         }</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">         // In the case where the timezones are different but</span>
<a href="#l15.23"></a><span id="l15.23">         // the timezone of the endtime is &quot;UTC&quot;, we convert</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineat">@@ -264,20 +264,20 @@ function updateDateTime() {</span>
<a href="#l15.25"></a><span id="l15.25">         // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l15.26"></a><span id="l15.26">         // automatic conversion back into the OS timezone.</span>
<a href="#l15.27"></a><span id="l15.27">         startTime.timezone = floating();</span>
<a href="#l15.28"></a><span id="l15.28">         endTime.timezone = floating();</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30">         document.getElementById(&quot;event-starttime&quot;).value = cal.dateTimeToJsDate(startTime);</span>
<a href="#l15.31"></a><span id="l15.31">         document.getElementById(&quot;event-endtime&quot;).value = cal.dateTimeToJsDate(endTime);</span>
<a href="#l15.32"></a><span id="l15.32">     } else {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-        var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+        let kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-        var startTime = gStartDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-        var endTime = gEndDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+        let startTime = gStartDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+        let endTime = gEndDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l15.40"></a><span id="l15.40"> </span>
<a href="#l15.41"></a><span id="l15.41">         if (startTime.isDate) {</span>
<a href="#l15.42"></a><span id="l15.42">             document.getElementById(&quot;all-day&quot;)</span>
<a href="#l15.43"></a><span id="l15.43">                 .setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l15.44"></a><span id="l15.44">         }</span>
<a href="#l15.45"></a><span id="l15.45"> </span>
<a href="#l15.46"></a><span id="l15.46">         // Before feeding the date/time value into the control we need</span>
<a href="#l15.47"></a><span id="l15.47">         // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineat">@@ -350,17 +350,17 @@ function updateStartTime() {</span>
<a href="#l15.49"></a><span id="l15.49">     let startWidget = document.getElementById(startWidgetId);</span>
<a href="#l15.50"></a><span id="l15.50">     let endWidget = document.getElementById(endWidgetId);</span>
<a href="#l15.51"></a><span id="l15.51"> </span>
<a href="#l15.52"></a><span id="l15.52">     // jsDate is always in OS timezone, thus we create a calIDateTime</span>
<a href="#l15.53"></a><span id="l15.53">     // object from the jsDate representation and simply set the new</span>
<a href="#l15.54"></a><span id="l15.54">     // timezone instead of converting.</span>
<a href="#l15.55"></a><span id="l15.55">     let timezone = gDisplayTimezone ? gStartTimezone : calendarDefaultTimezone();</span>
<a href="#l15.56"></a><span id="l15.56">     let start = cal.jsDateToDateTime(startWidget.value, timezone);</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-                                    </span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+</span>
<a href="#l15.59"></a><span id="l15.59">     gStartDate = start.clone();</span>
<a href="#l15.60"></a><span id="l15.60">     start.addDuration(gDuration);</span>
<a href="#l15.61"></a><span id="l15.61">     gEndDate = start.getInTimezone(gEndTimezone);</span>
<a href="#l15.62"></a><span id="l15.62"> </span>
<a href="#l15.63"></a><span id="l15.63">     let allDayElement = document.getElementById(&quot;all-day&quot;);</span>
<a href="#l15.64"></a><span id="l15.64">     let allDay = allDayElement.getAttribute(&quot;checked&quot;) == &quot;true&quot;;</span>
<a href="#l15.65"></a><span id="l15.65">     if (allDay) {</span>
<a href="#l15.66"></a><span id="l15.66">         gStartDate.isDate = true;</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineat">@@ -579,34 +579,34 @@ function changeAllDay() {</span>
<a href="#l15.68"></a><span id="l15.68">  * Handler function used when the window is resized.</span>
<a href="#l15.69"></a><span id="l15.69">  */</span>
<a href="#l15.70"></a><span id="l15.70"> function onResize() {</span>
<a href="#l15.71"></a><span id="l15.71">     // Don't do anything if we haven't been initialized.</span>
<a href="#l15.72"></a><span id="l15.72">     if (!gStartDate || !gEndDate) {</span>
<a href="#l15.73"></a><span id="l15.73">         return;</span>
<a href="#l15.74"></a><span id="l15.74">     }</span>
<a href="#l15.75"></a><span id="l15.75"> </span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-    var grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-    var gridScrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+    let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+    let gridScrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span>
<a href="#l15.80"></a><span id="l15.80">     grid.fitDummyRows();</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineminus">-    var ratio = grid.boxObject.width / grid.documentSize;</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineminus">-    var maxpos = gridScrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineminus">-    var inc = maxpos * ratio / (1 - ratio);</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineminus">-    gridScrollbar.setAttribute(&quot;pageincrement&quot;, inc);</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+    let gridRatio = grid.boxObject.width / grid.documentSize;</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+    let gridMaxpos = gridScrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+    let gridInc = gridMaxpos * gridRatio / (1 - gridRatio);</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+    gridScrollbar.setAttribute(&quot;pageincrement&quot;, gridInc);</span>
<a href="#l15.89"></a><span id="l15.89"> </span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-    var attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-    var attendeesScrollbar = document.getElementById(&quot;vertical-scrollbar&quot;);</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineminus">-    var box = document.getElementById(&quot;vertical-scrollbar-box&quot;);</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+    let attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+    let attendeesScrollbar = document.getElementById(&quot;vertical-scrollbar&quot;);</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+    let box = document.getElementById(&quot;vertical-scrollbar-box&quot;);</span>
<a href="#l15.96"></a><span id="l15.96">     attendees.fitDummyRows();</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-    var ratio = attendees.boxObject.height / attendees.documentSize;</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-    if (ratio &lt; 1) {</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineplus">+    let attRatio = attendees.boxObject.height / attendees.documentSize;</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+    let attMaxpos = attendeesScrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineplus">+    if (attRatio &lt; 1) {</span>
<a href="#l15.102"></a><span id="l15.102">         box.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-        var maxpos = attendeesScrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-        var inc = maxpos * ratio / (1 - ratio);</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-        attendeesScrollbar.setAttribute(&quot;pageincrement&quot;, inc);</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+        let attInc = attMaxpos * attRatio / (1 - attRatio);</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+        attendeesScrollbar.setAttribute(&quot;pageincrement&quot;, attInc);</span>
<a href="#l15.108"></a><span id="l15.108">     } else {</span>
<a href="#l15.109"></a><span id="l15.109">         box.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l15.110"></a><span id="l15.110">     }</span>
<a href="#l15.111"></a><span id="l15.111"> }</span>
<a href="#l15.112"></a><span id="l15.112"> </span>
<a href="#l15.113"></a><span id="l15.113"> /**</span>
<a href="#l15.114"></a><span id="l15.114">  * Handler function to call when changing the calendar used in this dialog.</span>
<a href="#l15.115"></a><span id="l15.115">  *</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineat">@@ -744,17 +744,17 @@ function scrollToCurrentTime() {</span>
<a href="#l15.117"></a><span id="l15.117"> </span>
<a href="#l15.118"></a><span id="l15.118"> /**</span>
<a href="#l15.119"></a><span id="l15.119">  * Sets the zoom factor for the time grid</span>
<a href="#l15.120"></a><span id="l15.120">  *</span>
<a href="#l15.121"></a><span id="l15.121">  * @param aValue        The zoom factor to set.</span>
<a href="#l15.122"></a><span id="l15.122">  * @return              aValue (for chaining)</span>
<a href="#l15.123"></a><span id="l15.123">  */</span>
<a href="#l15.124"></a><span id="l15.124"> function setZoomFactor(aValue) {</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-    // Correct zoom factor, if needed </span>
<a href="#l15.126"></a><span id="l15.126" class="difflineplus">+    // Correct zoom factor, if needed</span>
<a href="#l15.127"></a><span id="l15.127">     aValue = parseInt(aValue, 10) || 100;</span>
<a href="#l15.128"></a><span id="l15.128"> </span>
<a href="#l15.129"></a><span id="l15.129">     if (gZoomFactor == aValue) {</span>
<a href="#l15.130"></a><span id="l15.130">         return aValue;</span>
<a href="#l15.131"></a><span id="l15.131">     }</span>
<a href="#l15.132"></a><span id="l15.132"> </span>
<a href="#l15.133"></a><span id="l15.133">     gZoomFactor = aValue;</span>
<a href="#l15.134"></a><span id="l15.134">     applyCurrentZoomFactor();</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineat">@@ -881,58 +881,58 @@ function onMouseScroll(event) {</span>
<a href="#l15.136"></a><span id="l15.136"> </span>
<a href="#l15.137"></a><span id="l15.137"> /**</span>
<a href="#l15.138"></a><span id="l15.138">  * Hanlder function to take care of attribute changes on the window</span>
<a href="#l15.139"></a><span id="l15.139">  *</span>
<a href="#l15.140"></a><span id="l15.140">  * @param event     The DOMAttrModified event caused by this change.</span>
<a href="#l15.141"></a><span id="l15.141">  */</span>
<a href="#l15.142"></a><span id="l15.142"> function onAttrModified(event) {</span>
<a href="#l15.143"></a><span id="l15.143">     if (event.attrName == &quot;width&quot;) {</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-        var selectionbar = document.getElementById(&quot;selection-bar&quot;);</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineplus">+        let selectionbar = document.getElementById(&quot;selection-bar&quot;);</span>
<a href="#l15.146"></a><span id="l15.146">         selectionbar.setWidth(selectionbar.boxObject.width);</span>
<a href="#l15.147"></a><span id="l15.147">         return;</span>
<a href="#l15.148"></a><span id="l15.148">     }</span>
<a href="#l15.149"></a><span id="l15.149"> </span>
<a href="#l15.150"></a><span id="l15.150">     // Synchronize grid and attendee list</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineminus">-    var target = event.originalTarget;</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineplus">+    let target = event.originalTarget;</span>
<a href="#l15.153"></a><span id="l15.153">     if (target.hasAttribute(&quot;anonid&quot;) &amp;&amp;</span>
<a href="#l15.154"></a><span id="l15.154">         target.getAttribute(&quot;anonid&quot;) == &quot;input&quot; &amp;&amp;</span>
<a href="#l15.155"></a><span id="l15.155">         event.attrName == &quot;focused&quot;) {</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineminus">-        var attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineplus">+        let attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l15.158"></a><span id="l15.158">         if (event.newValue == &quot;true&quot;) {</span>
<a href="#l15.159"></a><span id="l15.159">             let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.160"></a><span id="l15.160">             if (grid.firstVisibleRow != attendees.firstVisibleRow) {</span>
<a href="#l15.161"></a><span id="l15.161">                 grid.firstVisibleRow = attendees.firstVisibleRow;</span>
<a href="#l15.162"></a><span id="l15.162">             }</span>
<a href="#l15.163"></a><span id="l15.163">         }</span>
<a href="#l15.164"></a><span id="l15.164">         if (!target.lastListCheckedValue</span>
<a href="#l15.165"></a><span id="l15.165">             || target.lastListCheckedValue != target.value) {</span>
<a href="#l15.166"></a><span id="l15.166">             attendees.resolvePotentialList(target);</span>
<a href="#l15.167"></a><span id="l15.167">             target.lastListCheckedValue = target.value;</span>
<a href="#l15.168"></a><span id="l15.168">         }</span>
<a href="#l15.169"></a><span id="l15.169">     }</span>
<a href="#l15.170"></a><span id="l15.170"> </span>
<a href="#l15.171"></a><span id="l15.171">     if (event.originalTarget.localName == &quot;scrollbar&quot;) {</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineminus">-        var scrollbar = event.originalTarget;</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineplus">+        let scrollbar = event.originalTarget;</span>
<a href="#l15.174"></a><span id="l15.174">         if (scrollbar.hasAttribute(&quot;maxpos&quot;)) {</span>
<a href="#l15.175"></a><span id="l15.175">             if (scrollbar.getAttribute(&quot;id&quot;) == &quot;vertical-scrollbar&quot;) {</span>
<a href="#l15.176"></a><span id="l15.176" class="difflineminus">-                var attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l15.177"></a><span id="l15.177" class="difflineminus">-                var grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineplus">+                let attendees = document.getElementById(&quot;attendees-list&quot;);</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineplus">+                let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.180"></a><span id="l15.180">                 if (event.attrName == &quot;curpos&quot;) {</span>
<a href="#l15.181"></a><span id="l15.181" class="difflineminus">-                    var maxpos = scrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.182"></a><span id="l15.182" class="difflineplus">+                    let maxpos = scrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.183"></a><span id="l15.183">                     attendees.ratio = event.newValue / maxpos;</span>
<a href="#l15.184"></a><span id="l15.184">                 }</span>
<a href="#l15.185"></a><span id="l15.185">                 grid.firstVisibleRow = attendees.firstVisibleRow;</span>
<a href="#l15.186"></a><span id="l15.186">             } else if (scrollbar.getAttribute(&quot;id&quot;) == &quot;horizontal-scrollbar&quot;) {</span>
<a href="#l15.187"></a><span id="l15.187">                 if (event.attrName == &quot;curpos&quot;) {</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineminus">-                    var maxpos = scrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineminus">-                    var ratio = event.newValue/maxpos;</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineminus">-                    var timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l15.191"></a><span id="l15.191" class="difflineminus">-                    var grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.192"></a><span id="l15.192" class="difflineminus">-                    var selectionbar = document.getElementById(&quot;selection-bar&quot;);</span>
<a href="#l15.193"></a><span id="l15.193" class="difflineplus">+                    let maxpos = scrollbar.getAttribute(&quot;maxpos&quot;);</span>
<a href="#l15.194"></a><span id="l15.194" class="difflineplus">+                    let ratio = event.newValue/maxpos;</span>
<a href="#l15.195"></a><span id="l15.195" class="difflineplus">+                    let timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l15.196"></a><span id="l15.196" class="difflineplus">+                    let grid = document.getElementById(&quot;freebusy-grid&quot;);</span>
<a href="#l15.197"></a><span id="l15.197" class="difflineplus">+                    let selectionbar = document.getElementById(&quot;selection-bar&quot;);</span>
<a href="#l15.198"></a><span id="l15.198">                     timebar.scroll = ratio;</span>
<a href="#l15.199"></a><span id="l15.199">                     grid.scroll = ratio;</span>
<a href="#l15.200"></a><span id="l15.200">                     selectionbar.ratio = ratio;</span>
<a href="#l15.201"></a><span id="l15.201">                 }</span>
<a href="#l15.202"></a><span id="l15.202">             }</span>
<a href="#l15.203"></a><span id="l15.203">         }</span>
<a href="#l15.204"></a><span id="l15.204">     }</span>
<a href="#l15.205"></a><span id="l15.205"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1420,17 +1420,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">           this.mMargin = start_offset_in_hours * hour_width;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">           // Calculate the difference between content and container in pixels.</span>
<a href="#l16.7"></a><span id="l16.7">           // The container is the window showing this control, the content is the</span>
<a href="#l16.8"></a><span id="l16.8">           // total number of pixels the selection bar can theoretically take up.</span>
<a href="#l16.9"></a><span id="l16.9">           var total_width = this.mContentWidth * this.mRange - this.parentNode.boxObject.width;</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">           // Calculate the current scroll offset.</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-          var offset = Math.floor(total_width * this.mRatio);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+          offset = Math.floor(total_width * this.mRatio);</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">           // The final margin is the difference between the date-based margin</span>
<a href="#l16.16"></a><span id="l16.16">           // and the scroll-based margin.</span>
<a href="#l16.17"></a><span id="l16.17">           this.mMargin -= offset;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19">           // Set the styles based on the calculations above for the 'selection-bar'.</span>
<a href="#l16.20"></a><span id="l16.20">           var style = &quot;width: &quot; + this.mWidth +</span>
<a href="#l16.21"></a><span id="l16.21">                       &quot;px; margin-inline-start: &quot; + this.mMargin +</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -1548,18 +1548,18 @@</span>
<a href="#l16.23"></a><span id="l16.23">             }</span>
<a href="#l16.24"></a><span id="l16.24">         }</span>
<a href="#l16.25"></a><span id="l16.25">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27">       &lt;handler event=&quot;mousemove&quot;&gt;&lt;![CDATA[</span>
<a href="#l16.28"></a><span id="l16.28">         var mouseX = event.screenX;</span>
<a href="#l16.29"></a><span id="l16.29">         if (this.mDragState == 1) {</span>
<a href="#l16.30"></a><span id="l16.30">             // Move the startdate and the enddate</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-            var delta = mouseX - this.mMouseX;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-            var newStart = this.moveTime(this.mStartDate, delta, false);</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+            let delta = mouseX - this.mMouseX;</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+            let newStart = this.moveTime(this.mStartDate, delta, false);</span>
<a href="#l16.35"></a><span id="l16.35">             if (newStart.compare(this.mStartDate) != 0) {</span>
<a href="#l16.36"></a><span id="l16.36">                 newEnd = this.moveTime(this.mEndDate, delta, false);</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38">                 // We need to adapt this date in case we're dealing with</span>
<a href="#l16.39"></a><span id="l16.39">                 // an all-day event. This is because setting 'endDate' will</span>
<a href="#l16.40"></a><span id="l16.40">                 // automatically add one day extra for all-day events.</span>
<a href="#l16.41"></a><span id="l16.41">                 if (newEnd.isDate) {</span>
<a href="#l16.42"></a><span id="l16.42">                     newEnd.day--;</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineat">@@ -1567,35 +1567,35 @@</span>
<a href="#l16.44"></a><span id="l16.44"> </span>
<a href="#l16.45"></a><span id="l16.45">                 this.startDate = newStart;</span>
<a href="#l16.46"></a><span id="l16.46">                 this.endDate = newEnd;</span>
<a href="#l16.47"></a><span id="l16.47">                 this.mMouseX = mouseX;</span>
<a href="#l16.48"></a><span id="l16.48">                 this.update();</span>
<a href="#l16.49"></a><span id="l16.49">             }</span>
<a href="#l16.50"></a><span id="l16.50">         } else if (this.mDragState == 2) {</span>
<a href="#l16.51"></a><span id="l16.51">             // Move the startdate only...</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-            var delta = event.screenX - this.mSelectionbar.boxObject.screenX;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineminus">-            var newStart = this.moveTime(this.mStartDate, delta, true);</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+            let delta = event.screenX - this.mSelectionbar.boxObject.screenX;</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+            let newStart = this.moveTime(this.mStartDate, delta, true);</span>
<a href="#l16.56"></a><span id="l16.56">             if (newStart.compare(this.mEndDate) &gt;= 0) {</span>
<a href="#l16.57"></a><span id="l16.57">                 if (!this.mStartDate.isDate) {</span>
<a href="#l16.58"></a><span id="l16.58">                     newStart = this.mEndDate;</span>
<a href="#l16.59"></a><span id="l16.59">                 }</span>
<a href="#l16.60"></a><span id="l16.60">                 else{</span>
<a href="#l16.61"></a><span id="l16.61">                     return;</span>
<a href="#l16.62"></a><span id="l16.62">                 }</span>
<a href="#l16.63"></a><span id="l16.63">             }</span>
<a href="#l16.64"></a><span id="l16.64">             if (newStart.compare(this.mStartDate) != 0) {</span>
<a href="#l16.65"></a><span id="l16.65">                 this.startDate = newStart;</span>
<a href="#l16.66"></a><span id="l16.66">                 this.update();</span>
<a href="#l16.67"></a><span id="l16.67">             }</span>
<a href="#l16.68"></a><span id="l16.68">         } else if (this.mDragState == 3) {</span>
<a href="#l16.69"></a><span id="l16.69">             // Move the enddate only..</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-            var delta = mouseX - (this.mSelectionbar.boxObject.screenX +</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+            let delta = mouseX - (this.mSelectionbar.boxObject.screenX +</span>
<a href="#l16.72"></a><span id="l16.72">                                   this.mSelectionbar.boxObject.width);</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-            var newEnd = this.moveTime(this.mEndDate, delta, true);</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+            let newEnd = this.moveTime(this.mEndDate, delta, true);</span>
<a href="#l16.75"></a><span id="l16.75">             if (newEnd.compare(this.mStartDate) &lt; 0) {</span>
<a href="#l16.76"></a><span id="l16.76">                 newEnd = this.mStartDate;</span>
<a href="#l16.77"></a><span id="l16.77">             }</span>
<a href="#l16.78"></a><span id="l16.78">             if (newEnd.compare(this.mEndDate) != 0) {</span>
<a href="#l16.79"></a><span id="l16.79">                 // We need to adapt this date in case we're dealing with</span>
<a href="#l16.80"></a><span id="l16.80">                 // an all-day event. This is because setting 'endDate' will</span>
<a href="#l16.81"></a><span id="l16.81">                 // automatically add one day extra for all-day events.</span>
<a href="#l16.82"></a><span id="l16.82">                 if (newEnd.isDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -163,40 +163,40 @@</span>
<a href="#l17.4"></a><span id="l17.4">               this.mDateFormatter =</span>
<a href="#l17.5"></a><span id="l17.5">                   Components.classes[</span>
<a href="#l17.6"></a><span id="l17.6">                       &quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l17.7"></a><span id="l17.7">                           .getService(</span>
<a href="#l17.8"></a><span id="l17.8">                               Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l17.9"></a><span id="l17.9">           }</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">           // First set the formatted date string as title</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-          var day =</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+          let day =</span>
<a href="#l17.14"></a><span id="l17.14">               document.getAnonymousElementByAttribute(</span>
<a href="#l17.15"></a><span id="l17.15">                   this, &quot;anonid&quot;, &quot;day&quot;);</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-          var value = (this.mZoomFactor &gt; 100) ?</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+          let value = (this.mZoomFactor &gt; 100) ?</span>
<a href="#l17.18"></a><span id="l17.18">               this.mDateFormatter.formatDateShort(date) :</span>
<a href="#l17.19"></a><span id="l17.19">               this.mDateFormatter.formatDateLong(date);</span>
<a href="#l17.20"></a><span id="l17.20">           day.setAttribute(&quot;value&quot;, value);</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22">           // Now create as many 'hour' elements as needed</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-          var step_in_minutes = Math.floor(60 * this.mZoomFactor / 100);</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-          var hours =</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+          let step_in_minutes = Math.floor(60 * this.mZoomFactor / 100);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+          let hours =</span>
<a href="#l17.27"></a><span id="l17.27">               document.getAnonymousElementByAttribute(</span>
<a href="#l17.28"></a><span id="l17.28">                   this, &quot;anonid&quot;, &quot;hours&quot;);</span>
<a href="#l17.29"></a><span id="l17.29">           date.hour = this.mStartHour;</span>
<a href="#l17.30"></a><span id="l17.30">           if (hours.childNodes.length &lt;= 0) {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-              var template = createXULElement(&quot;text&quot;);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+              let template = createXULElement(&quot;text&quot;);</span>
<a href="#l17.33"></a><span id="l17.33">               template.className = &quot;freebusy-timebar-hour&quot;;</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-              var count = Math.ceil(</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+              let count = Math.ceil(</span>
<a href="#l17.36"></a><span id="l17.36">                   (this.mEndHour - this.mStartHour) * 60 / step_in_minutes);</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-              var remain = count;</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+              let remain = count;</span>
<a href="#l17.39"></a><span id="l17.39">               let first = true;</span>
<a href="#l17.40"></a><span id="l17.40">               while (remain--) {</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-                  var newNode = template.cloneNode(false);</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-                  var value = this.mDateFormatter.formatTime(date);</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+                  let newNode = template.cloneNode(false);</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+                  let value = this.mDateFormatter.formatTime(date);</span>
<a href="#l17.45"></a><span id="l17.45">                   if (first) {</span>
<a href="#l17.46"></a><span id="l17.46">                       newNode.className += &quot; first-in-day&quot;;</span>
<a href="#l17.47"></a><span id="l17.47">                       first = false;</span>
<a href="#l17.48"></a><span id="l17.48">                   }</span>
<a href="#l17.49"></a><span id="l17.49">                   newNode.setAttribute(&quot;value&quot;, value);</span>
<a href="#l17.50"></a><span id="l17.50">                   hours.appendChild(newNode);</span>
<a href="#l17.51"></a><span id="l17.51">                   date.minute += step_in_minutes;</span>
<a href="#l17.52"></a><span id="l17.52"> </span>
<a href="#l17.53"></a><span id="l17.53" class="difflineat">@@ -1345,19 +1345,19 @@</span>
<a href="#l17.54"></a><span id="l17.54">           // Now iterate all freebusy-rows and ask each one</span>
<a href="#l17.55"></a><span id="l17.55">           // if it wants to modify the suggested time slot.</span>
<a href="#l17.56"></a><span id="l17.56">           // we keep iterating the rows until all of them</span>
<a href="#l17.57"></a><span id="l17.57">           // are happy with it.</span>
<a href="#l17.58"></a><span id="l17.58">           var recheck;</span>
<a href="#l17.59"></a><span id="l17.59">           do {</span>
<a href="#l17.60"></a><span id="l17.60">               recheck = false;</span>
<a href="#l17.61"></a><span id="l17.61"> </span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-              for (var i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+              for (let i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l17.64"></a><span id="l17.64">                   var row = this.getFreeBusyElement(i);</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-                  var newTime = row.nextSlot(startTime, endTime, allDay);</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+                  let newTime = row.nextSlot(startTime, endTime, allDay);</span>
<a href="#l17.67"></a><span id="l17.67">                   if (newTime) {</span>
<a href="#l17.68"></a><span id="l17.68">                     if (newTime.compare(startTime) != 0) {</span>
<a href="#l17.69"></a><span id="l17.69">                         startTime = newTime;</span>
<a href="#l17.70"></a><span id="l17.70"> </span>
<a href="#l17.71"></a><span id="l17.71">                         if (startTime.hour &lt; this.mStartHour) {</span>
<a href="#l17.72"></a><span id="l17.72">                             startTime.hour = this.mStartHour;</span>
<a href="#l17.73"></a><span id="l17.73">                             startTime.minute = 0;</span>
<a href="#l17.74"></a><span id="l17.74">                         }</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineat">@@ -1396,18 +1396,18 @@</span>
<a href="#l17.76"></a><span id="l17.76">               startTime.isDate = true;</span>
<a href="#l17.77"></a><span id="l17.77">           }</span>
<a href="#l17.78"></a><span id="l17.78"> </span>
<a href="#l17.79"></a><span id="l17.79">           // In case the new starttime happens to be scheduled</span>
<a href="#l17.80"></a><span id="l17.80">           // on a different day, we also need to update the</span>
<a href="#l17.81"></a><span id="l17.81">           // complete freebusy informations and appropriate</span>
<a href="#l17.82"></a><span id="l17.82">           // underlying arrays holding the informaion.</span>
<a href="#l17.83"></a><span id="l17.83">           if (this.mStartDate.day != startTime.day) {</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-              for (var i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-                  var row = this.getFreeBusyElement(i);</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+              for (let i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+                  let row = this.getFreeBusyElement(i);</span>
<a href="#l17.88"></a><span id="l17.88">                   row.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l17.89"></a><span id="l17.89">               }</span>
<a href="#l17.90"></a><span id="l17.90">               this.updateFreeBusy();</span>
<a href="#l17.91"></a><span id="l17.91">           }</span>
<a href="#l17.92"></a><span id="l17.92"> </span>
<a href="#l17.93"></a><span id="l17.93">           // Return the new starttime of the item.</span>
<a href="#l17.94"></a><span id="l17.94">           return startTime;</span>
<a href="#l17.95"></a><span id="l17.95">         ]]&gt;&lt;/body&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> &lt;bindings xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l18.6"></a><span id="l18.6">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l18.7"></a><span id="l18.7">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">   &lt;binding id=&quot;recurrence-preview&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l18.10"></a><span id="l18.10">     &lt;resources&gt;</span>
<a href="#l18.11"></a><span id="l18.11">       &lt;stylesheet src=&quot;chrome://calendar/content/widgets/calendar-widget-bindings.css&quot;/&gt;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    &lt;/resources&gt;               </span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    &lt;/resources&gt;</span>
<a href="#l18.14"></a><span id="l18.14">     &lt;content&gt;</span>
<a href="#l18.15"></a><span id="l18.15">       &lt;xul:box flex=&quot;1&quot; style=&quot;overflow: hidden;&quot;&gt;</span>
<a href="#l18.16"></a><span id="l18.16">         &lt;xul:grid flex=&quot;1&quot; anonid=&quot;mainbox&quot;&gt;</span>
<a href="#l18.17"></a><span id="l18.17">           &lt;xul:columns&gt;</span>
<a href="#l18.18"></a><span id="l18.18">             &lt;xul:column anonid=&quot;column&quot;/&gt;</span>
<a href="#l18.19"></a><span id="l18.19">             &lt;xul:column flex=&quot;1&quot;/&gt;</span>
<a href="#l18.20"></a><span id="l18.20">           &lt;/xul:columns&gt;</span>
<a href="#l18.21"></a><span id="l18.21">           &lt;xul:rows&gt;</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -103,17 +103,17 @@</span>
<a href="#l18.23"></a><span id="l18.23">           var rowIterator = row;</span>
<a href="#l18.24"></a><span id="l18.24">           while (rowIterator) {</span>
<a href="#l18.25"></a><span id="l18.25">               numRows++;</span>
<a href="#l18.26"></a><span id="l18.26">               rowIterator = rowIterator.nextSibling;</span>
<a href="#l18.27"></a><span id="l18.27">           }</span>
<a href="#l18.28"></a><span id="l18.28"> </span>
<a href="#l18.29"></a><span id="l18.29">           // Adjust rows</span>
<a href="#l18.30"></a><span id="l18.30">           while (numRows &lt; numVertical) {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-              var newNode = row.cloneNode(true);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+              let newNode = row.cloneNode(true);</span>
<a href="#l18.33"></a><span id="l18.33">               rows.appendChild(newNode);</span>
<a href="#l18.34"></a><span id="l18.34">               numRows++;</span>
<a href="#l18.35"></a><span id="l18.35">           }</span>
<a href="#l18.36"></a><span id="l18.36">           while (numRows &gt; numVertical) {</span>
<a href="#l18.37"></a><span id="l18.37">               rows.firstChild.remove();</span>
<a href="#l18.38"></a><span id="l18.38">               numRows--</span>
<a href="#l18.39"></a><span id="l18.39">           }</span>
<a href="#l18.40"></a><span id="l18.40"> </span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -131,17 +131,17 @@</span>
<a href="#l18.42"></a><span id="l18.42">           }</span>
<a href="#l18.43"></a><span id="l18.43"> </span>
<a href="#l18.44"></a><span id="l18.44">           // Walk all rows and adjust column elements</span>
<a href="#l18.45"></a><span id="l18.45">           row = document.getAnonymousElementByAttribute(</span>
<a href="#l18.46"></a><span id="l18.46">                    this, &quot;anonid&quot;, &quot;row&quot;);</span>
<a href="#l18.47"></a><span id="l18.47">           while (row) {</span>
<a href="#l18.48"></a><span id="l18.48">               var firstChild = row.firstChild;</span>
<a href="#l18.49"></a><span id="l18.49">               while ((row.childNodes.length - 1) &lt; numHorizontal) {</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-                  var newNode = firstChild.cloneNode(true);</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+                  let newNode = firstChild.cloneNode(true);</span>
<a href="#l18.52"></a><span id="l18.52">                   firstChild.parentNode.insertBefore(newNode, firstChild);</span>
<a href="#l18.53"></a><span id="l18.53">               }</span>
<a href="#l18.54"></a><span id="l18.54">               while ((row.childNodes.length - 1) &gt; numHorizontal) {</span>
<a href="#l18.55"></a><span id="l18.55">                   row.firstChild.remove();</span>
<a href="#l18.56"></a><span id="l18.56">               }</span>
<a href="#l18.57"></a><span id="l18.57">               row = row.nextSibling;</span>
<a href="#l18.58"></a><span id="l18.58">           }</span>
<a href="#l18.59"></a><span id="l18.59"> </span>
<a href="#l18.60"></a><span id="l18.60" class="difflineat">@@ -173,41 +173,41 @@</span>
<a href="#l18.61"></a><span id="l18.61">           this.mRecurrenceInfo = aRecurrenceInfo;</span>
<a href="#l18.62"></a><span id="l18.62">           var start = this.dateTime.clone();</span>
<a href="#l18.63"></a><span id="l18.63">           start.day = 1;</span>
<a href="#l18.64"></a><span id="l18.64">           start.hour = 0;</span>
<a href="#l18.65"></a><span id="l18.65">           start.minute = 0;</span>
<a href="#l18.66"></a><span id="l18.66">           start.second = 0;</span>
<a href="#l18.67"></a><span id="l18.67">           var end = start.clone();</span>
<a href="#l18.68"></a><span id="l18.68">           end.month++;</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-                      </span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+</span>
<a href="#l18.71"></a><span id="l18.71">           // the 'minimonth' controls are arranged in a</span>
<a href="#l18.72"></a><span id="l18.72">           // grid, sorted by rows first -&gt; iterate the rows that may exist.</span>
<a href="#l18.73"></a><span id="l18.73">           var row = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;row&quot;);</span>
<a href="#l18.74"></a><span id="l18.74">           while (row) {</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-          </span>
<a href="#l18.76"></a><span id="l18.76" class="difflineplus">+</span>
<a href="#l18.77"></a><span id="l18.77">               // now iterater all the child nodes of this row</span>
<a href="#l18.78"></a><span id="l18.78">               // in order to visit each minimonth in turn.</span>
<a href="#l18.79"></a><span id="l18.79">               var numChilds = row.childNodes.length - 1;</span>
<a href="#l18.80"></a><span id="l18.80">               for (var i = 0; i &lt; numChilds; i++) {</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineminus">-              </span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+</span>
<a href="#l18.83"></a><span id="l18.83">                   // we now have one of the minimonth controls while 'start'</span>
<a href="#l18.84"></a><span id="l18.84">                   // and 'end' are set to the interval this minimonth shows.</span>
<a href="#l18.85"></a><span id="l18.85">                   var minimonth = row.childNodes[i];</span>
<a href="#l18.86"></a><span id="l18.86">                   minimonth.showMonth(cal.dateTimeToJsDate(start));</span>
<a href="#l18.87"></a><span id="l18.87">                   if (aRecurrenceInfo) {</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineminus">-                      </span>
<a href="#l18.89"></a><span id="l18.89" class="difflineplus">+</span>
<a href="#l18.90"></a><span id="l18.90">                       // retrieve an array of dates that represents all occurrences</span>
<a href="#l18.91"></a><span id="l18.91">                       // that fall into this time interval [start,end[.</span>
<a href="#l18.92"></a><span id="l18.92">                       // note: the following loop assumes that this array conains</span>
<a href="#l18.93"></a><span id="l18.93">                       // dates that are strictly monotonically increasing.</span>
<a href="#l18.94"></a><span id="l18.94">                       // should getOccurrenceDates() not enforce this assumption we</span>
<a href="#l18.95"></a><span id="l18.95">                       // need to fall back to some different algorithm.</span>
<a href="#l18.96"></a><span id="l18.96">                       var dates = aRecurrenceInfo.getOccurrenceDates(start, end, 0, {});</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineminus">-                      </span>
<a href="#l18.98"></a><span id="l18.98" class="difflineplus">+</span>
<a href="#l18.99"></a><span id="l18.99">                       // now run throgh all days of this month and set the</span>
<a href="#l18.100"></a><span id="l18.100">                       // 'busy' attribute with respect to the occurrence array.</span>
<a href="#l18.101"></a><span id="l18.101">                       var index = 0;</span>
<a href="#l18.102"></a><span id="l18.102">                       var occurrence = null;</span>
<a href="#l18.103"></a><span id="l18.103">                       if (index &lt; dates.length) {</span>
<a href="#l18.104"></a><span id="l18.104">                           occurrence =</span>
<a href="#l18.105"></a><span id="l18.105">                               dates[index++]</span>
<a href="#l18.106"></a><span id="l18.106">                                   .getInTimezone(start.timezone);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -280,31 +280,31 @@ function onSave(item) {</span>
<a href="#l19.4"></a><span id="l19.4">         recurrenceInfo = createRecurrenceInfo(item);</span>
<a href="#l19.5"></a><span id="l19.5">     }</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">     var recRule = createRecurrenceRule();</span>
<a href="#l19.8"></a><span id="l19.8">     const ALL_WEEKDAYS = [2,3,4,5,6,7,1]; // The sequence MO,TU,WE,TH,FR,SA,SU.</span>
<a href="#l19.9"></a><span id="l19.9">     switch (deckNumber) {</span>
<a href="#l19.10"></a><span id="l19.10">     case 0:</span>
<a href="#l19.11"></a><span id="l19.11">         recRule.type = &quot;DAILY&quot;;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-        var dailyGroup = document.getElementById(&quot;daily-group&quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+        let dailyGroup = document.getElementById(&quot;daily-group&quot;);</span>
<a href="#l19.14"></a><span id="l19.14">         if (dailyGroup.selectedIndex == 0) {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-            var ndays = Math.max(1, Number(getElementValue(&quot;daily-days&quot;)));</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+            let ndays = Math.max(1, Number(getElementValue(&quot;daily-days&quot;)));</span>
<a href="#l19.17"></a><span id="l19.17">             recRule.interval = ndays;</span>
<a href="#l19.18"></a><span id="l19.18">         } else {</span>
<a href="#l19.19"></a><span id="l19.19">             recRule.interval = 1;</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-            var onDays = [2, 3, 4, 5, 6];</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+            let onDays = [2, 3, 4, 5, 6];</span>
<a href="#l19.22"></a><span id="l19.22">             recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l19.23"></a><span id="l19.23">         }</span>
<a href="#l19.24"></a><span id="l19.24">         break;</span>
<a href="#l19.25"></a><span id="l19.25">     case 1:</span>
<a href="#l19.26"></a><span id="l19.26">         recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineminus">-        var ndays = Number(getElementValue(&quot;weekly-weeks&quot;));</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+        let ndays = Number(getElementValue(&quot;weekly-weeks&quot;));</span>
<a href="#l19.29"></a><span id="l19.29">         recRule.interval = ndays;</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-        var onDays = document.getElementById(&quot;daypicker-weekday&quot;).days;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+        let onDays = document.getElementById(&quot;daypicker-weekday&quot;).days;</span>
<a href="#l19.32"></a><span id="l19.32">         if (onDays.length &gt; 0) {</span>
<a href="#l19.33"></a><span id="l19.33">             recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l19.34"></a><span id="l19.34">         }</span>
<a href="#l19.35"></a><span id="l19.35">         break;</span>
<a href="#l19.36"></a><span id="l19.36">     case 2:</span>
<a href="#l19.37"></a><span id="l19.37">         recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l19.38"></a><span id="l19.38">         var monthInterval = Number(getElementValue(&quot;monthly-interval&quot;));</span>
<a href="#l19.39"></a><span id="l19.39">         recRule.interval = monthInterval;</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineat">@@ -329,29 +329,29 @@ function onSave(item) {</span>
<a href="#l19.41"></a><span id="l19.41">             var monthlyDays = document.getElementById(&quot;monthly-days&quot;).days;</span>
<a href="#l19.42"></a><span id="l19.42">             if (monthlyDays.length &gt; 0) {</span>
<a href="#l19.43"></a><span id="l19.43">                 recRule.setComponent(&quot;BYMONTHDAY&quot;, monthlyDays.length, monthlyDays);</span>
<a href="#l19.44"></a><span id="l19.44">             }</span>
<a href="#l19.45"></a><span id="l19.45">         }</span>
<a href="#l19.46"></a><span id="l19.46">         break;</span>
<a href="#l19.47"></a><span id="l19.47">     case 3:</span>
<a href="#l19.48"></a><span id="l19.48">         recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-        var yearInterval = Number(getElementValue(&quot;yearly-interval&quot;));</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineplus">+        let yearInterval = Number(getElementValue(&quot;yearly-interval&quot;));</span>
<a href="#l19.51"></a><span id="l19.51">         recRule.interval = yearInterval;</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-        var yearlyGroup = document.getElementById(&quot;yearly-group&quot;);</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+        let yearlyGroup = document.getElementById(&quot;yearly-group&quot;);</span>
<a href="#l19.54"></a><span id="l19.54">         if (yearlyGroup.selectedIndex == 0) {</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-            var yearlyByMonth = [ Number(getElementValue(&quot;yearly-month-ordinal&quot;)) ];</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+            let yearlyByMonth = [ Number(getElementValue(&quot;yearly-month-ordinal&quot;)) ];</span>
<a href="#l19.57"></a><span id="l19.57">             recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-            var yearlyByDay = [ Number(getElementValue(&quot;yearly-days&quot;)) ];</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+            let yearlyByDay = [ Number(getElementValue(&quot;yearly-days&quot;)) ];</span>
<a href="#l19.60"></a><span id="l19.60">             recRule.setComponent(&quot;BYMONTHDAY&quot;, yearlyByDay.length, yearlyByDay);</span>
<a href="#l19.61"></a><span id="l19.61">         } else {</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-            var yearlyByMonth = [ Number(getElementValue(&quot;yearly-month-rule&quot;)) ];</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineplus">+            let yearlyByMonth = [ Number(getElementValue(&quot;yearly-month-rule&quot;)) ];</span>
<a href="#l19.64"></a><span id="l19.64">             recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-            var ordinal = Number(getElementValue(&quot;yearly-ordinal&quot;));</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-            var day_of_week = Number(getElementValue(&quot;yearly-weekday&quot;));</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineplus">+            let ordinal = Number(getElementValue(&quot;yearly-ordinal&quot;));</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineplus">+            let day_of_week = Number(getElementValue(&quot;yearly-weekday&quot;));</span>
<a href="#l19.69"></a><span id="l19.69">             if (day_of_week &lt; 0) {</span>
<a href="#l19.70"></a><span id="l19.70">                 if (ordinal == 0) {</span>
<a href="#l19.71"></a><span id="l19.71">                     // Yearly rule &quot;Every day of a month&quot;.</span>
<a href="#l19.72"></a><span id="l19.72">                     recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l19.73"></a><span id="l19.73">                 } else {</span>
<a href="#l19.74"></a><span id="l19.74">                     // One of the first five days or the last of a month.</span>
<a href="#l19.75"></a><span id="l19.75">                     recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [ ordinal ]);</span>
<a href="#l19.76"></a><span id="l19.76">                 }</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineat">@@ -742,17 +742,16 @@ function updateRecurrencePattern() {</span>
<a href="#l19.78"></a><span id="l19.78">  * @param aPropKey      The locale property key to get the order from</span>
<a href="#l19.79"></a><span id="l19.79">  * @param aPropParams   An array of ids to be passed to the locale property.</span>
<a href="#l19.80"></a><span id="l19.80">  *                        These should be the ids of the elements to change</span>
<a href="#l19.81"></a><span id="l19.81">  *                        the order for.</span>
<a href="#l19.82"></a><span id="l19.82">  */</span>
<a href="#l19.83"></a><span id="l19.83"> function changeOrderForElements(aPropKey, aPropParams) {</span>
<a href="#l19.84"></a><span id="l19.84">     var localeOrder;</span>
<a href="#l19.85"></a><span id="l19.85">     var parents = {};</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineminus">-    var i = 0;</span>
<a href="#l19.87"></a><span id="l19.87"> </span>
<a href="#l19.88"></a><span id="l19.88">     for (var key in aPropParams) {</span>
<a href="#l19.89"></a><span id="l19.89">         // Save original parents so that the nodes to reorder get appended to</span>
<a href="#l19.90"></a><span id="l19.90">         // the correct parent nodes.</span>
<a href="#l19.91"></a><span id="l19.91">         parents[key] = document.getElementById(aPropParams[key]).parentNode;</span>
<a href="#l19.92"></a><span id="l19.92">     }</span>
<a href="#l19.93"></a><span id="l19.93"> </span>
<a href="#l19.94"></a><span id="l19.94">     try {</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineat">@@ -765,17 +764,17 @@ function changeOrderForElements(aPropKey</span>
<a href="#l19.96"></a><span id="l19.96">         var s = &quot;The key &quot; + aPropKey + &quot; in calendar-event-dialog.prop&quot; +</span>
<a href="#l19.97"></a><span id="l19.97">                 &quot;erties has incorrect number of params. Expected &quot; +</span>
<a href="#l19.98"></a><span id="l19.98">                 aPropParams.length + &quot; params.&quot;;</span>
<a href="#l19.99"></a><span id="l19.99">         Components.utils.reportError(s + &quot; &quot; + ex);</span>
<a href="#l19.100"></a><span id="l19.100">         return;</span>
<a href="#l19.101"></a><span id="l19.101">     }</span>
<a href="#l19.102"></a><span id="l19.102"> </span>
<a href="#l19.103"></a><span id="l19.103">     // Add elements in the right order, removing them from their old parent</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineminus">-    for (var i = 0; i &lt; aPropParams.length; i++) {</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineplus">+    for (let i = 0; i &lt; aPropParams.length; i++) {</span>
<a href="#l19.106"></a><span id="l19.106">         var newEl = document.getElementById(localeOrder[i]);</span>
<a href="#l19.107"></a><span id="l19.107">         if (newEl) {</span>
<a href="#l19.108"></a><span id="l19.108">             parents[i].appendChild(newEl.parentNode.removeChild(newEl));</span>
<a href="#l19.109"></a><span id="l19.109">         } else {</span>
<a href="#l19.110"></a><span id="l19.110">             cal.ERROR(&quot;Localization error, could not find node '&quot; + localeOrder[i] + &quot;'. Please have your localizer check the string '&quot; + aPropKey + &quot;'&quot;);</span>
<a href="#l19.111"></a><span id="l19.111">         }</span>
<a href="#l19.112"></a><span id="l19.112">     }</span>
<a href="#l19.113"></a><span id="l19.113"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.5"></a><span id="l20.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l20.8"></a><span id="l20.8"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l20.9"></a><span id="l20.9"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l20.10"></a><span id="l20.10"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-var allowedActionsMap = {}; </span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+var allowedActionsMap = {};</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15"> /**</span>
<a href="#l20.16"></a><span id="l20.16">  * Sets up the reminder dialog.</span>
<a href="#l20.17"></a><span id="l20.17">  */</span>
<a href="#l20.18"></a><span id="l20.18"> function onLoad() {</span>
<a href="#l20.19"></a><span id="l20.19">     let calendar = window.arguments[0].calendar;</span>
<a href="#l20.20"></a><span id="l20.20"> </span>
<a href="#l20.21"></a><span id="l20.21">     // Make sure the origin menulist uses the right labels, depending on if the</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -158,20 +158,20 @@ function setupMaxReminders() {</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">     // != null is needed here to ensure cond to be true/false, instead of</span>
<a href="#l20.25"></a><span id="l20.25">     // true/null. The former is needed for setElementValue.</span>
<a href="#l20.26"></a><span id="l20.26">     let cond = (maxReminders != null &amp;&amp; listbox.childNodes.length &gt;= maxReminders);</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">     // If we hit the maximum number of reminders, show the error box and</span>
<a href="#l20.29"></a><span id="l20.29">     // disable the new button.</span>
<a href="#l20.30"></a><span id="l20.30">     setElementValue(&quot;reminder-new-button&quot;, cond &amp;&amp; &quot;true&quot;, &quot;disabled&quot;);</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-    </span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+</span>
<a href="#l20.33"></a><span id="l20.33">     if (!setupMaxReminders.notification) {</span>
<a href="#l20.34"></a><span id="l20.34">         let notification = createXULElement(&quot;notification&quot;);</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-        let localeErrorString = </span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+        let localeErrorString =</span>
<a href="#l20.37"></a><span id="l20.37">             calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l20.38"></a><span id="l20.38">                          getItemBundleStringName(&quot;reminderErrorMaxCountReached&quot;),</span>
<a href="#l20.39"></a><span id="l20.39">                          [maxReminders]);</span>
<a href="#l20.40"></a><span id="l20.40">         let pluralErrorLabel = PluralForm.get(maxReminders, localeErrorString)</span>
<a href="#l20.41"></a><span id="l20.41">                                          .replace(&quot;#1&quot;, maxReminders);</span>
<a href="#l20.42"></a><span id="l20.42"> </span>
<a href="#l20.43"></a><span id="l20.43">         notification.setAttribute(&quot;label&quot;, pluralErrorLabel);</span>
<a href="#l20.44"></a><span id="l20.44">         notification.setAttribute(&quot;type&quot;, &quot;warning&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-timezone.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -8,58 +8,58 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l21.4"></a><span id="l21.4">  * Sets up the timezone dialog from the window arguments, also setting up all</span>
<a href="#l21.5"></a><span id="l21.5">  * dialog controls from the window's dates.</span>
<a href="#l21.6"></a><span id="l21.6">  */</span>
<a href="#l21.7"></a><span id="l21.7"> function onLoad() {</span>
<a href="#l21.8"></a><span id="l21.8">     var args = window.arguments[0];</span>
<a href="#l21.9"></a><span id="l21.9">     window.time = args.time;</span>
<a href="#l21.10"></a><span id="l21.10">     window.onAcceptCallback = args.onOk;</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    var tzProvider = (args.calendar.getProperty(&quot;timezones.provider&quot;) ||</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+    let tzProvider = (args.calendar.getProperty(&quot;timezones.provider&quot;) ||</span>
<a href="#l21.14"></a><span id="l21.14">                       cal.getTimezoneService());</span>
<a href="#l21.15"></a><span id="l21.15">     window.tzProvider = tzProvider;</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-    var menulist = document.getElementById(&quot;timezone-menulist&quot;);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">-    var tzMenuPopup = document.getElementById(&quot;timezone-menupopup&quot;);</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+    let menulist = document.getElementById(&quot;timezone-menulist&quot;);</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+    let tzMenuPopup = document.getElementById(&quot;timezone-menupopup&quot;);</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22">     // floating and UTC (if supported) at the top:</span>
<a href="#l21.23"></a><span id="l21.23">     if (args.calendar.getProperty(&quot;capabilities.timezones.floating.supported&quot;) !== false) {</span>
<a href="#l21.24"></a><span id="l21.24">         addMenuItem(tzMenuPopup, floating().displayName, floating().tzid);</span>
<a href="#l21.25"></a><span id="l21.25">     }</span>
<a href="#l21.26"></a><span id="l21.26">     if (args.calendar.getProperty(&quot;capabilities.timezones.UTC.supported&quot;) !== false) {</span>
<a href="#l21.27"></a><span id="l21.27">         addMenuItem(tzMenuPopup, UTC().displayName, UTC().tzid);</span>
<a href="#l21.28"></a><span id="l21.28">     }</span>
<a href="#l21.29"></a><span id="l21.29"> </span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-    var enumerator = tzProvider.timezoneIds;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-    var tzids = {};</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-    var displayNames = [];</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+    let enumerator = tzProvider.timezoneIds;</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+    let tzids = {};</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+    let displayNames = [];</span>
<a href="#l21.36"></a><span id="l21.36">     while (enumerator.hasMore()) {</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-        var tz = tzProvider.getTimezone(enumerator.getNext());</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+        let tz = tzProvider.getTimezone(enumerator.getNext());</span>
<a href="#l21.39"></a><span id="l21.39">         if (tz &amp;&amp; !tz.isFloating &amp;&amp; !tz.isUTC) {</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-            var displayName = tz.displayName;</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+            let displayName = tz.displayName;</span>
<a href="#l21.42"></a><span id="l21.42">             displayNames.push(displayName);</span>
<a href="#l21.43"></a><span id="l21.43">             tzids[displayName] = tz.tzid;</span>
<a href="#l21.44"></a><span id="l21.44">         }</span>
<a href="#l21.45"></a><span id="l21.45">     }</span>
<a href="#l21.46"></a><span id="l21.46">     // the display names need to be sorted</span>
<a href="#l21.47"></a><span id="l21.47">     displayNames.sort(String.localeCompare);</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-    for (var i = 0; i &lt; displayNames.length; ++i) {</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-        var displayName = displayNames[i];</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+    for (let i = 0; i &lt; displayNames.length; ++i) {</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+        let displayName = displayNames[i];</span>
<a href="#l21.52"></a><span id="l21.52">         addMenuItem(tzMenuPopup, displayName, tzids[displayName]);</span>
<a href="#l21.53"></a><span id="l21.53">     }</span>
<a href="#l21.54"></a><span id="l21.54"> </span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-    var index = findTimezone(window.time.timezone);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+    let index = findTimezone(window.time.timezone);</span>
<a href="#l21.57"></a><span id="l21.57">     if (index &lt; 0) {</span>
<a href="#l21.58"></a><span id="l21.58">         index = findTimezone(calendarDefaultTimezone());</span>
<a href="#l21.59"></a><span id="l21.59">         if (index &lt; 0) {</span>
<a href="#l21.60"></a><span id="l21.60">             index = 0;</span>
<a href="#l21.61"></a><span id="l21.61">         }</span>
<a href="#l21.62"></a><span id="l21.62">     }</span>
<a href="#l21.63"></a><span id="l21.63"> </span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-    var menulist = document.getElementById(&quot;timezone-menulist&quot;);</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+    menulist = document.getElementById(&quot;timezone-menulist&quot;);</span>
<a href="#l21.66"></a><span id="l21.66">     menulist.selectedIndex = index;</span>
<a href="#l21.67"></a><span id="l21.67"> </span>
<a href="#l21.68"></a><span id="l21.68">     updateTimezone();</span>
<a href="#l21.69"></a><span id="l21.69"> </span>
<a href="#l21.70"></a><span id="l21.70">     opener.setCursor(&quot;auto&quot;);</span>
<a href="#l21.71"></a><span id="l21.71"> }</span>
<a href="#l21.72"></a><span id="l21.72"> </span>
<a href="#l21.73"></a><span id="l21.73"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-invitations-list.xml</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-invitations-list.xml</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -64,16 +64,27 @@</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">     &lt;implementation&gt;</span>
<a href="#l22.6"></a><span id="l22.6">       &lt;!-- fields --&gt;</span>
<a href="#l22.7"></a><span id="l22.7">       &lt;field name=&quot;mDateFormatter&quot;&gt;null&lt;/field&gt;</span>
<a href="#l22.8"></a><span id="l22.8">       &lt;field name=&quot;mCalendarItem&quot;&gt;null&lt;/field&gt;</span>
<a href="#l22.9"></a><span id="l22.9">       &lt;field name=&quot;mInitialParticipationStatus&quot;&gt;null&lt;/field&gt;</span>
<a href="#l22.10"></a><span id="l22.10">       &lt;field name=&quot;mParticipationStatus&quot;&gt;null&lt;/field&gt;</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+      &lt;property name=&quot;mStrings&quot;&gt;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+        &lt;getter&gt;return {</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+            alldayEvent: &quot;&amp;calendar.invitations.list.alldayevent.text;&quot;,</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+            recurrentEvent: &quot;&amp;calendar.invitations.list.recurrentevent.text;&quot;,</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+            location: &quot;&amp;calendar.invitations.list.location.text;&quot;,</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+            organizer: &quot;&amp;calendar.invitations.list.organizer.text;&quot;,</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+            attendee: &quot;&amp;calendar.invitations.list.attendee.text;&quot;,</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+            none: &quot;&amp;calendar.invitations.list.none.text;&quot;</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+        };&lt;/getter&gt;</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+</span>
<a href="#l22.23"></a><span id="l22.23">       &lt;!-- properties --&gt;</span>
<a href="#l22.24"></a><span id="l22.24">       &lt;property name=&quot;calendarItem&quot;&gt;</span>
<a href="#l22.25"></a><span id="l22.25">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l22.26"></a><span id="l22.26">           return this.mCalendarItem;</span>
<a href="#l22.27"></a><span id="l22.27">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l22.28"></a><span id="l22.28">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l22.29"></a><span id="l22.29">           this.setCalendarItem(val);</span>
<a href="#l22.30"></a><span id="l22.30">           return val;</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineat">@@ -107,79 +118,72 @@</span>
<a href="#l22.32"></a><span id="l22.32">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l22.33"></a><span id="l22.33">         Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l22.34"></a><span id="l22.34">         this.mDateFormatter = getDateFormatter();</span>
<a href="#l22.35"></a><span id="l22.35">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l22.36"></a><span id="l22.36"> </span>
<a href="#l22.37"></a><span id="l22.37">       &lt;!-- methods --&gt;</span>
<a href="#l22.38"></a><span id="l22.38">       &lt;method name=&quot;setCalendarItem&quot;&gt;</span>
<a href="#l22.39"></a><span id="l22.39">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineminus">-          var alldayEventText = &quot;&amp;calendar.invitations.list.alldayevent.text;&quot;;</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-          var recurrentEventText = &quot;&amp;calendar.invitations.list.recurrentevent.text;&quot;;</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-          var locationText = &quot;&amp;calendar.invitations.list.location.text;&quot;;</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-          var organizerText = &quot;&amp;calendar.invitations.list.organizer.text;&quot;;</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineminus">-          var attendeeText = &quot;&amp;calendar.invitations.list.attendee.text;&quot;;</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineminus">-          var noneText = &quot;&amp;calendar.invitations.list.none.text;&quot;;</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l22.49"></a><span id="l22.49">             this.mCalendarItem = aItem;</span>
<a href="#l22.50"></a><span id="l22.50">             this.mInitialParticipationStatus =</span>
<a href="#l22.51"></a><span id="l22.51">                 this.getCalendarItemParticipationStatus(aItem);</span>
<a href="#l22.52"></a><span id="l22.52">             this.participationStatus = this.mInitialParticipationStatus;</span>
<a href="#l22.53"></a><span id="l22.53"> </span>
<a href="#l22.54"></a><span id="l22.54">             var titleLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l22.55"></a><span id="l22.55">                 this, &quot;anonid&quot;, &quot;title&quot;);</span>
<a href="#l22.56"></a><span id="l22.56">             titleLabel.setAttribute(&quot;value&quot;, aItem.title);</span>
<a href="#l22.57"></a><span id="l22.57"> </span>
<a href="#l22.58"></a><span id="l22.58">             var dateLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l22.59"></a><span id="l22.59">                 this, &quot;anonid&quot;, &quot;date&quot;);</span>
<a href="#l22.60"></a><span id="l22.60">             var dateString = this.mDateFormatter.formatItemInterval(aItem);</span>
<a href="#l22.61"></a><span id="l22.61">             if (aItem.startDate.isDate) {</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-                dateString += &quot;, &quot; + alldayEventText;</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+                dateString += &quot;, &quot; + this.mStrings.alldayEvent;</span>
<a href="#l22.64"></a><span id="l22.64">             }</span>
<a href="#l22.65"></a><span id="l22.65">             dateLabel.setAttribute(&quot;value&quot;, dateString);</span>
<a href="#l22.66"></a><span id="l22.66"> </span>
<a href="#l22.67"></a><span id="l22.67">             var recurrenceLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l22.68"></a><span id="l22.68">                 this, &quot;anonid&quot;, &quot;recurrence&quot;);</span>
<a href="#l22.69"></a><span id="l22.69">             if (aItem.recurrenceInfo) {</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-                recurrenceLabel.setAttribute(&quot;value&quot;, recurrentEventText);</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+                recurrenceLabel.setAttribute(&quot;value&quot;, this.mStrings.recurrentEvent);</span>
<a href="#l22.72"></a><span id="l22.72">             } else {</span>
<a href="#l22.73"></a><span id="l22.73">                 recurrenceLabel.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l22.74"></a><span id="l22.74">                 var spacer = document.getAnonymousElementByAttribute(</span>
<a href="#l22.75"></a><span id="l22.75">                     this, &quot;anonid&quot;, &quot;spacer&quot;);</span>
<a href="#l22.76"></a><span id="l22.76">                 spacer.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l22.77"></a><span id="l22.77">             }</span>
<a href="#l22.78"></a><span id="l22.78"> </span>
<a href="#l22.79"></a><span id="l22.79">             var locationLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l22.80"></a><span id="l22.80">                 this, &quot;anonid&quot;, &quot;location&quot;);</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineminus">-            var locationString = locationText;</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+            var locationString = this.mStrings.location;</span>
<a href="#l22.83"></a><span id="l22.83">             var locationProperty = aItem.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l22.84"></a><span id="l22.84">             if (locationProperty &amp;&amp; locationProperty.length &gt; 0) {</span>
<a href="#l22.85"></a><span id="l22.85">                 locationString += locationProperty;</span>
<a href="#l22.86"></a><span id="l22.86">             } else {</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineminus">-                locationString += noneText;</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineplus">+                locationString += this.mStrings.none;</span>
<a href="#l22.89"></a><span id="l22.89">             }</span>
<a href="#l22.90"></a><span id="l22.90">             locationLabel.setAttribute(&quot;value&quot;, locationString);</span>
<a href="#l22.91"></a><span id="l22.91"> </span>
<a href="#l22.92"></a><span id="l22.92">             var organizerLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l22.93"></a><span id="l22.93">                 this, &quot;anonid&quot;, &quot;organizer&quot;);</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineminus">-            var organizerString = organizerText;</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineplus">+            var organizerString = this.mStrings.organizer;</span>
<a href="#l22.96"></a><span id="l22.96">             var org = aItem.organizer;</span>
<a href="#l22.97"></a><span id="l22.97">             if (org) {</span>
<a href="#l22.98"></a><span id="l22.98">                 if (org.commonName &amp;&amp; org.commonName.length &gt; 0) {</span>
<a href="#l22.99"></a><span id="l22.99">                     organizerString += org.commonName;</span>
<a href="#l22.100"></a><span id="l22.100">                 } else if (org.id) {</span>
<a href="#l22.101"></a><span id="l22.101">                     organizerString += org.id.replace(/^mailto:/i, &quot;&quot;);</span>
<a href="#l22.102"></a><span id="l22.102">                 }</span>
<a href="#l22.103"></a><span id="l22.103">             }</span>
<a href="#l22.104"></a><span id="l22.104">             organizerLabel.setAttribute(&quot;value&quot;, organizerString);</span>
<a href="#l22.105"></a><span id="l22.105"> </span>
<a href="#l22.106"></a><span id="l22.106">             let attendeeLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l22.107"></a><span id="l22.107">                 this, &quot;anonid&quot;, &quot;attendee&quot;);</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineminus">-            let attendeeString = attendeeText;</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineplus">+            let attendeeString = this.mStrings.attendee;</span>
<a href="#l22.110"></a><span id="l22.110">             let att = cal.getInvitedAttendee(aItem);</span>
<a href="#l22.111"></a><span id="l22.111">             if (att) {</span>
<a href="#l22.112"></a><span id="l22.112">                 if (att.commonName &amp;&amp; att.commonName.length &gt; 0) {</span>
<a href="#l22.113"></a><span id="l22.113">                     attendeeString += att.commonName;</span>
<a href="#l22.114"></a><span id="l22.114">                 } else if (att.id) {</span>
<a href="#l22.115"></a><span id="l22.115">                     attendeeString += att.id.replace(/^mailto:/i, &quot;&quot;);</span>
<a href="#l22.116"></a><span id="l22.116">                 }</span>
<a href="#l22.117"></a><span id="l22.117">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -10,17 +10,16 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l23.4"></a><span id="l23.4"> /**</span>
<a href="#l23.5"></a><span id="l23.5">  * Sets up the summary dialog, setting all needed fields on the dialog from the</span>
<a href="#l23.6"></a><span id="l23.6">  * item received in the window arguments.</span>
<a href="#l23.7"></a><span id="l23.7">  */</span>
<a href="#l23.8"></a><span id="l23.8"> function onLoad() {</span>
<a href="#l23.9"></a><span id="l23.9">     var args = window.arguments[0];</span>
<a href="#l23.10"></a><span id="l23.10">     var item = args.calendarEvent;</span>
<a href="#l23.11"></a><span id="l23.11">     item = item.clone(); // use an own copy of the passed item</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    var calendar = item.calendar;</span>
<a href="#l23.13"></a><span id="l23.13">     window.calendarItem = item;</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15">     // the calling entity provides us with an object that is responsible</span>
<a href="#l23.16"></a><span id="l23.16">     // for recording details about the initiated modification. the 'finalize'-property</span>
<a href="#l23.17"></a><span id="l23.17">     // is our hook in order to receive a notification in case the operation needs</span>
<a href="#l23.18"></a><span id="l23.18">     // to be terminated prematurely. this function will be called if the calling</span>
<a href="#l23.19"></a><span id="l23.19">     // entity needs to immediately terminate the pending modification. in this</span>
<a href="#l23.20"></a><span id="l23.20">     // case we serialize the item and close the window.</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineat">@@ -48,17 +47,17 @@ function onLoad() {</span>
<a href="#l23.22"></a><span id="l23.22">     if (cal.isEvent(item)) {</span>
<a href="#l23.23"></a><span id="l23.23">         setDialogId(document.documentElement, &quot;calendar-event-summary-dialog&quot;);</span>
<a href="#l23.24"></a><span id="l23.24">     } else if (cal.isToDo(item)) {</span>
<a href="#l23.25"></a><span id="l23.25">         setDialogId(document.documentElement, &quot;calendar-task-summary-dialog&quot;);</span>
<a href="#l23.26"></a><span id="l23.26">     }</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28">     window.attendees = item.getAttendees({});</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-    calendar = cal.wrapInstance(item.calendar, Components.interfaces.calISchedulingSupport);</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+    let calendar = cal.wrapInstance(item.calendar, Components.interfaces.calISchedulingSupport);</span>
<a href="#l23.32"></a><span id="l23.32">     window.readOnly = !(isCalendarWritable(calendar)</span>
<a href="#l23.33"></a><span id="l23.33">                         &amp;&amp; (userCanModifyItem(item)</span>
<a href="#l23.34"></a><span id="l23.34">                             || (calendar</span>
<a href="#l23.35"></a><span id="l23.35">                                 &amp;&amp; item.calendar.isInvitation(item)</span>
<a href="#l23.36"></a><span id="l23.36">                                 &amp;&amp; userCanRespondToInvitation(item))));</span>
<a href="#l23.37"></a><span id="l23.37">     if (!window.readOnly &amp;&amp; calendar) {</span>
<a href="#l23.38"></a><span id="l23.38">         var attendee = calendar.getInvitedAttendee(item);</span>
<a href="#l23.39"></a><span id="l23.39">         if (attendee) {</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineat">@@ -87,19 +86,19 @@ function onLoad() {</span>
<a href="#l23.41"></a><span id="l23.41"> </span>
<a href="#l23.42"></a><span id="l23.42">     document.getElementById(&quot;item-start-row&quot;).Item = item;</span>
<a href="#l23.43"></a><span id="l23.43">     document.getElementById(&quot;item-end-row&quot;).Item = item;</span>
<a href="#l23.44"></a><span id="l23.44"> </span>
<a href="#l23.45"></a><span id="l23.45">     updateInvitationStatus();</span>
<a href="#l23.46"></a><span id="l23.46"> </span>
<a href="#l23.47"></a><span id="l23.47">     // show reminder if this item is *not* readonly.</span>
<a href="#l23.48"></a><span id="l23.48">     // this case happens for example if this is an invitation.</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineminus">-    var calendar = window.arguments[0].calendarEvent.calendar;</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+    let argCalendar = window.arguments[0].calendarEvent.calendar;</span>
<a href="#l23.51"></a><span id="l23.51">     var supportsReminders =</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineminus">-        (calendar.getProperty(&quot;capabilities.alarms.oninvitations.supported&quot;) !== false);</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+        (argCalendar.getProperty(&quot;capabilities.alarms.oninvitations.supported&quot;) !== false);</span>
<a href="#l23.54"></a><span id="l23.54">     if (!window.readOnly &amp;&amp; supportsReminders) {</span>
<a href="#l23.55"></a><span id="l23.55">         document.getElementById(&quot;reminder-row&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l23.56"></a><span id="l23.56">         loadReminders(window.calendarItem.getAlarms({}));</span>
<a href="#l23.57"></a><span id="l23.57">         updateReminder();</span>
<a href="#l23.58"></a><span id="l23.58">     }</span>
<a href="#l23.59"></a><span id="l23.59"> </span>
<a href="#l23.60"></a><span id="l23.60">     updateRepeatDetails();</span>
<a href="#l23.61"></a><span id="l23.61">     updateAttendees();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/content/preferences/categories.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/content/preferences/categories.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -22,17 +22,17 @@ var gCategoriesPane = {</span>
<a href="#l24.4"></a><span id="l24.4">     init: function gCP_init() {</span>
<a href="#l24.5"></a><span id="l24.5">         // On non-instant-apply platforms, once this pane has been loaded,</span>
<a href="#l24.6"></a><span id="l24.6">         // attach our &quot;revert all changes&quot; function to the parent prefwindow's</span>
<a href="#l24.7"></a><span id="l24.7">         // &quot;ondialogcancel&quot; event.</span>
<a href="#l24.8"></a><span id="l24.8">         var parentPrefWindow = document.documentElement;</span>
<a href="#l24.9"></a><span id="l24.9">         if (!parentPrefWindow.instantApply) {</span>
<a href="#l24.10"></a><span id="l24.10">             var existingOnDialogCancel = parentPrefWindow.getAttribute(&quot;ondialogcancel&quot;);</span>
<a href="#l24.11"></a><span id="l24.11">             parentPrefWindow.setAttribute(&quot;ondialogcancel&quot;,</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-                                          &quot;gCategoriesPane.panelOnCancel(); &quot; + </span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+                                          &quot;gCategoriesPane.panelOnCancel(); &quot; +</span>
<a href="#l24.14"></a><span id="l24.14">                                           existingOnDialogCancel);</span>
<a href="#l24.15"></a><span id="l24.15">         }</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17">         // A list of preferences to be reverted when the dialog is cancelled.</span>
<a href="#l24.18"></a><span id="l24.18">         // It needs to be a property of the parent to be visible onCancel</span>
<a href="#l24.19"></a><span id="l24.19">         if (!(&quot;backupPrefList&quot; in parent)) {</span>
<a href="#l24.20"></a><span id="l24.20">             parent.backupPrefList = [];</span>
<a href="#l24.21"></a><span id="l24.21">         }</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -117,24 +117,24 @@ var gCategoriesPane = {</span>
<a href="#l24.23"></a><span id="l24.23">                             &quot;modal,centerscreen,chrome,resizable=no&quot;,</span>
<a href="#l24.24"></a><span id="l24.24">                           &quot;&quot;, null, addTitle);</span>
<a href="#l24.25"></a><span id="l24.25">     },</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">     /**</span>
<a href="#l24.28"></a><span id="l24.28">      * Edits the currently selected category using the edit category dialog.</span>
<a href="#l24.29"></a><span id="l24.29">      */</span>
<a href="#l24.30"></a><span id="l24.30">     editCategory: function gCP_editCategory() {</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-        var list = document.getElementById(&quot;categorieslist&quot;);</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-        var categoryNameFix = formatStringForCSSRule(gCategoryList[list.selectedIndex]);</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+        let list = document.getElementById(&quot;categorieslist&quot;);</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+        let categoryNameFix = formatStringForCSSRule(gCategoryList[list.selectedIndex]);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+        let currentColor = null;</span>
<a href="#l24.36"></a><span id="l24.36">         try {</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-            var currentColor = categoryPrefBranch.getCharPref(categoryNameFix);</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+            currentColor = categoryPrefBranch.getCharPref(categoryNameFix);</span>
<a href="#l24.39"></a><span id="l24.39">         } catch (ex) {</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-            var currentColor = null;</span>
<a href="#l24.41"></a><span id="l24.41">         }</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">- </span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+</span>
<a href="#l24.44"></a><span id="l24.44">         if (list.selectedItem) {</span>
<a href="#l24.45"></a><span id="l24.45">             window.openDialog(&quot;chrome://calendar/content/preferences/editCategory.xul&quot;,</span>
<a href="#l24.46"></a><span id="l24.46">                               &quot;editCategory&quot;,</span>
<a href="#l24.47"></a><span id="l24.47">                               // Workaround for Bug 1151440 - the HTML color picker won't work</span>
<a href="#l24.48"></a><span id="l24.48">                               // in linux when opened from modal dialog</span>
<a href="#l24.49"></a><span id="l24.49">                               (AppConstants.platform == &quot;linux&quot;) ?</span>
<a href="#l24.50"></a><span id="l24.50">                                 &quot;centerscreen,chrome,resizable=no&quot; :</span>
<a href="#l24.51"></a><span id="l24.51">                                 &quot;modal,centerscreen,chrome,resizable=no&quot;,</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineat">@@ -232,17 +232,17 @@ var gCategoriesPane = {</span>
<a href="#l24.53"></a><span id="l24.53">         if (toBeDeleted != -1) {</span>
<a href="#l24.54"></a><span id="l24.54">             list.selectedIndex = toBeDeleted;</span>
<a href="#l24.55"></a><span id="l24.55">             this.deleteCategory();</span>
<a href="#l24.56"></a><span id="l24.56">         }</span>
<a href="#l24.57"></a><span id="l24.57"> </span>
<a href="#l24.58"></a><span id="l24.58">         this.updateCategoryList();</span>
<a href="#l24.59"></a><span id="l24.59"> </span>
<a href="#l24.60"></a><span id="l24.60">         var updatedCategory = gCategoryList.indexOf(categoryName);</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineminus">-        list.ensureIndexIsVisible(updatedCategory); </span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+        list.ensureIndexIsVisible(updatedCategory);</span>
<a href="#l24.63"></a><span id="l24.63">         list.selectedIndex = updatedCategory;</span>
<a href="#l24.64"></a><span id="l24.64">     },</span>
<a href="#l24.65"></a><span id="l24.65"> </span>
<a href="#l24.66"></a><span id="l24.66">     /**</span>
<a href="#l24.67"></a><span id="l24.67">      * Enable the edit and delete category buttons.</span>
<a href="#l24.68"></a><span id="l24.68">      */</span>
<a href="#l24.69"></a><span id="l24.69">     updateButtons: function  gCP_updateButtons() {</span>
<a href="#l24.70"></a><span id="l24.70">         let categoriesList = document.getElementById(&quot;categorieslist&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-subscriptions-list.xml</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-subscriptions-list.xml</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -92,17 +92,17 @@</span>
<a href="#l25.4"></a><span id="l25.4">           }</span>
<a href="#l25.5"></a><span id="l25.5">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l25.6"></a><span id="l25.6">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l25.7"></a><span id="l25.7">           var checkbox = document.getAnonymousElementByAttribute(</span>
<a href="#l25.8"></a><span id="l25.8">             this, &quot;anonid&quot;, &quot;subscription-checkbox&quot;);</span>
<a href="#l25.9"></a><span id="l25.9">           if (val) {</span>
<a href="#l25.10"></a><span id="l25.10">             checkbox.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l25.11"></a><span id="l25.11">           } else {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-            checkbox.removeAttribute(&quot;checked&quot;);          </span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+            checkbox.removeAttribute(&quot;checked&quot;);</span>
<a href="#l25.14"></a><span id="l25.14">           }</span>
<a href="#l25.15"></a><span id="l25.15">           return val;</span>
<a href="#l25.16"></a><span id="l25.16">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l25.17"></a><span id="l25.17">       &lt;/property&gt;</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19">       &lt;property name=&quot;disabled&quot;&gt;</span>
<a href="#l25.20"></a><span id="l25.20">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l25.21"></a><span id="l25.21">           var checkbox = document.getAnonymousElementByAttribute(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -385,18 +385,18 @@</span>
<a href="#l26.4"></a><span id="l26.4">             var notifyRefControl = ((aNotifyRefControl == null) || (aNotifyRefControl === true))</span>
<a href="#l26.5"></a><span id="l26.5">             var pushModeCollapsedAttribute = ((aPushModeCollapsedAttribute == null)</span>
<a href="#l26.6"></a><span id="l26.6">                                                  || (aPushModeCollapsedAttribute === true));</span>
<a href="#l26.7"></a><span id="l26.7">             var collapsedModes = [];</span>
<a href="#l26.8"></a><span id="l26.8">             var modeIndex = -1;</span>
<a href="#l26.9"></a><span id="l26.9">             var display = aVisible;</span>
<a href="#l26.10"></a><span id="l26.10">             var collapsedInMode = false;</span>
<a href="#l26.11"></a><span id="l26.11">             if (this.hasAttribute(&quot;collapsedinmodes&quot;)) {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-                var collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                var modeIndex = collapsedModes.indexOf(this.currentMode);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+                collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+                modeIndex = collapsedModes.indexOf(this.currentMode);</span>
<a href="#l26.16"></a><span id="l26.16">                 collapsedInMode = (modeIndex &gt; -1);</span>
<a href="#l26.17"></a><span id="l26.17">             }</span>
<a href="#l26.18"></a><span id="l26.18">             if ((aVisible === true) &amp;&amp; (pushModeCollapsedAttribute == false)){</span>
<a href="#l26.19"></a><span id="l26.19">                 display = (aVisible === true) &amp;&amp; (!collapsedInMode);</span>
<a href="#l26.20"></a><span id="l26.20">             }</span>
<a href="#l26.21"></a><span id="l26.21"> </span>
<a href="#l26.22"></a><span id="l26.22">             setBooleanAttribute(this, &quot;collapsed&quot;, (!display || !this.isVisibleInMode()));</span>
<a href="#l26.23"></a><span id="l26.23">             if (pushModeCollapsedAttribute) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l27.4"></a><span id="l27.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.7"></a><span id="l27.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.8"></a><span id="l27.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10"> &lt;!--</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineminus">-/* MiniMonth Calendar: day-of-month grid XBL component.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+   MiniMonth Calendar: day-of-month grid XBL component.</span>
<a href="#l27.13"></a><span id="l27.13">    Displays month name and year above grid of days of month by week rows.</span>
<a href="#l27.14"></a><span id="l27.14">    Arrows move forward or back a month.</span>
<a href="#l27.15"></a><span id="l27.15">    Selecting a month name from month menu moves to that month in same year.</span>
<a href="#l27.16"></a><span id="l27.16">    Selecting a year from year menu moves to same month in selected year.</span>
<a href="#l27.17"></a><span id="l27.17">    Clicking on a day cell calls onchange attribute.</span>
<a href="#l27.18"></a><span id="l27.18">    Changing month via arrows or menus calls onmonthchange attribute.</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">    At site, can provide id, and code to run when value changed by picker.</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineat">@@ -21,17 +21,16 @@</span>
<a href="#l27.22"></a><span id="l27.22"> </span>
<a href="#l27.23"></a><span id="l27.23">    Use attributes onpopuplisthidden and onmonthchange for working around</span>
<a href="#l27.24"></a><span id="l27.24">    bugs that occur when minimonth is displayed in a popup (as in datepicker):</span>
<a href="#l27.25"></a><span id="l27.25">      Currently (2005.3)</span>
<a href="#l27.26"></a><span id="l27.26">        whenever a child popup is hidden, the parent popup needs to be reshown.</span>
<a href="#l27.27"></a><span id="l27.27">          Use onpopuplisthidden to reshow parent popop (hidePopup, openPopup).</span>
<a href="#l27.28"></a><span id="l27.28">        When title month or year changes, parent popup may need to be reshown.</span>
<a href="#l27.29"></a><span id="l27.29">          Use onmonthchange to reshow parent popop (hidePopup, openPopup).</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-*/</span>
<a href="#l27.31"></a><span id="l27.31"> --&gt;</span>
<a href="#l27.32"></a><span id="l27.32"> &lt;!DOCTYPE bindings</span>
<a href="#l27.33"></a><span id="l27.33"> [</span>
<a href="#l27.34"></a><span id="l27.34">     &lt;!ENTITY % dtd1 SYSTEM &quot;chrome://calendar/locale/global.dtd&quot; &gt; %dtd1;</span>
<a href="#l27.35"></a><span id="l27.35">     &lt;!ENTITY % dtd2 SYSTEM &quot;chrome://global/locale/global.dtd&quot; &gt; %dtd2;</span>
<a href="#l27.36"></a><span id="l27.36"> ]&gt;</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38"> &lt;bindings id=&quot;xulMiniMonth&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/modules/calIteratorUtils.jsm</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/modules/calIteratorUtils.jsm</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -116,18 +116,16 @@ cal.ical = {</span>
<a href="#l28.4"></a><span id="l28.4">         if (aComponent &amp;&amp; aComponent.componentType == &quot;VCALENDAR&quot;) {</span>
<a href="#l28.5"></a><span id="l28.5">             yield* cal.ical.subcomponentIterator(aComponent, compType);</span>
<a href="#l28.6"></a><span id="l28.6">         } else if (aComponent &amp;&amp; aComponent.componentType == &quot;XROOT&quot;) {</span>
<a href="#l28.7"></a><span id="l28.7">             for (let calComp of cal.ical.subcomponentIterator(aComponent, &quot;VCALENDAR&quot;)) {</span>
<a href="#l28.8"></a><span id="l28.8">                 yield* cal.ical.subcomponentIterator(calComp, compType);</span>
<a href="#l28.9"></a><span id="l28.9">             }</span>
<a href="#l28.10"></a><span id="l28.10">         } else if (aComponent &amp;&amp; (compType == &quot;ANY&quot; || compType == aComponent.componentType)) {</span>
<a href="#l28.11"></a><span id="l28.11">             yield aComponent;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        } else {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-            return null;</span>
<a href="#l28.14"></a><span id="l28.14">         }</span>
<a href="#l28.15"></a><span id="l28.15">     },</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17">     /**</span>
<a href="#l28.18"></a><span id="l28.18">      * Use to iterate through all subcomponents of a calIIcalComponent. This</span>
<a href="#l28.19"></a><span id="l28.19">      * iterators depth is 1, this means no sub-sub-components will be iterated.</span>
<a href="#l28.20"></a><span id="l28.20">      *</span>
<a href="#l28.21"></a><span id="l28.21">      * This iterator can only be used in a for() block:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1060,17 +1060,17 @@ function sendMessage(aItem, aMethod, aRe</span>
<a href="#l29.4"></a><span id="l29.4">             let sendToList = [aRecipient];</span>
<a href="#l29.5"></a><span id="l29.5">             // remove other recipients from vevent attendee list</span>
<a href="#l29.6"></a><span id="l29.6">             let sendItem = aItem.clone();</span>
<a href="#l29.7"></a><span id="l29.7">             sendItem.removeAllAttendees();</span>
<a href="#l29.8"></a><span id="l29.8">             sendItem.addAttendee(aRecipient);</span>
<a href="#l29.9"></a><span id="l29.9">             // send message</span>
<a href="#l29.10"></a><span id="l29.10">             if (!_sendItem(sendToList, sendItem)) {</span>
<a href="#l29.11"></a><span id="l29.11">                 return false;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-            };</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+            }</span>
<a href="#l29.14"></a><span id="l29.14">         }</span>
<a href="#l29.15"></a><span id="l29.15">         return true;</span>
<a href="#l29.16"></a><span id="l29.16">     } else {</span>
<a href="#l29.17"></a><span id="l29.17">         return _sendItem(aRecipientsList, aItem);</span>
<a href="#l29.18"></a><span id="l29.18">     }</span>
<a href="#l29.19"></a><span id="l29.19"> }</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21"> /** local to this module file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -459,18 +459,23 @@ var cal = {</span>
<a href="#l30.4"></a><span id="l30.4">         }</span>
<a href="#l30.5"></a><span id="l30.5">         return transp;</span>
<a href="#l30.6"></a><span id="l30.6">     },</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8">     // The below functions will move to some different place once the</span>
<a href="#l30.9"></a><span id="l30.9">     // unifinder tress are consolidated.</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">     compareNativeTime: function cal_compareNativeTime(a, b) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-      return (a &lt; b ? -1 :</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-              a &gt; b ?  1 : 0);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+      if (a &lt; b) {</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+        return -1;</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+      } else if (a &gt; b) {</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+        return 1;</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+      } else {</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+        return 0;</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+      }</span>
<a href="#l30.21"></a><span id="l30.21">     },</span>
<a href="#l30.22"></a><span id="l30.22"> </span>
<a href="#l30.23"></a><span id="l30.23">     compareNativeTimeFilledAsc: function cal_compareNativeTimeFilledAsc(a, b) {</span>
<a href="#l30.24"></a><span id="l30.24">       if (a == b)</span>
<a href="#l30.25"></a><span id="l30.25">         return 0;</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27">       // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l30.28"></a><span id="l30.28">       if (a == -62168601600000000) // value for (0000/00/00 00:00:00)</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineat">@@ -492,18 +497,23 @@ var cal = {</span>
<a href="#l30.30"></a><span id="l30.30">         return -1;</span>
<a href="#l30.31"></a><span id="l30.31"> </span>
<a href="#l30.32"></a><span id="l30.32">       return (a &lt; b ? 1 : -1);</span>
<a href="#l30.33"></a><span id="l30.33">     },</span>
<a href="#l30.34"></a><span id="l30.34"> </span>
<a href="#l30.35"></a><span id="l30.35">     compareNumber: function cal_compareNumber(a, b) {</span>
<a href="#l30.36"></a><span id="l30.36">       a = Number(a);</span>
<a href="#l30.37"></a><span id="l30.37">       b = Number(b);</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-      return ((a &lt; b) ? -1 :      // avoid underflow problems of subtraction</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineminus">-              (a &gt; b) ?  1 : 0);</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+      if (a &lt; b) {</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+        return -1;</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+      } else if (a &gt; b) {</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+        return 1;</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+      } else {</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+        return 0;</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+      }</span>
<a href="#l30.47"></a><span id="l30.47">     },</span>
<a href="#l30.48"></a><span id="l30.48"> </span>
<a href="#l30.49"></a><span id="l30.49">     sortEntryComparer: function cal_sortEntryComparer(sortType, modifier) {</span>
<a href="#l30.50"></a><span id="l30.50">       switch (sortType) {</span>
<a href="#l30.51"></a><span id="l30.51">         case &quot;number&quot;:</span>
<a href="#l30.52"></a><span id="l30.52">           return function compareNumbers(sortEntryA, sortEntryB) {</span>
<a href="#l30.53"></a><span id="l30.53">             let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l30.54"></a><span id="l30.54">             let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineat">@@ -827,17 +837,17 @@ var cal = {</span>
<a href="#l30.56"></a><span id="l30.56">                 childNode.remove();</span>
<a href="#l30.57"></a><span id="l30.57">              } else if (!aValue || aValue === undefined) {</span>
<a href="#l30.58"></a><span id="l30.58">                 childNode.remove();</span>
<a href="#l30.59"></a><span id="l30.59">             } else if (childNode &amp;&amp; childNode.hasAttribute(aAttribute)</span>
<a href="#l30.60"></a><span id="l30.60">                 &amp;&amp; childNode.getAttribute(aAttribute) == aValue) {</span>
<a href="#l30.61"></a><span id="l30.61">                 childNode.remove();</span>
<a href="#l30.62"></a><span id="l30.62">             }</span>
<a href="#l30.63"></a><span id="l30.63">             childNode = prevChildNode;</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineminus">-        };</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+        }</span>
<a href="#l30.66"></a><span id="l30.66">     },</span>
<a href="#l30.67"></a><span id="l30.67"> </span>
<a href="#l30.68"></a><span id="l30.68">     /**</span>
<a href="#l30.69"></a><span id="l30.69">      * Returns the most recent calendar window in an application independent way</span>
<a href="#l30.70"></a><span id="l30.70">      */</span>
<a href="#l30.71"></a><span id="l30.71">     getCalendarWindow: function cal_getCalendarWindow() {</span>
<a href="#l30.72"></a><span id="l30.72">         return Services.wm.getMostRecentWindow(&quot;calendarMainWindow&quot;) ||</span>
<a href="#l30.73"></a><span id="l30.73">                Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;);</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineat">@@ -860,23 +870,23 @@ var cal = {</span>
<a href="#l30.75"></a><span id="l30.75">                     func(subject, topic, data);</span>
<a href="#l30.76"></a><span id="l30.76">                 }</span>
<a href="#l30.77"></a><span id="l30.77">             }</span>
<a href="#l30.78"></a><span id="l30.78">         };</span>
<a href="#l30.79"></a><span id="l30.79">         Services.obs.addObserver(observer, topic, false /* don't hold weakly */);</span>
<a href="#l30.80"></a><span id="l30.80">     },</span>
<a href="#l30.81"></a><span id="l30.81"> </span>
<a href="#l30.82"></a><span id="l30.82">     /**</span>
<a href="#l30.83"></a><span id="l30.83" class="difflineminus">-     * Wraps an instance. Replaces calInstanceOf from calUtils.js </span>
<a href="#l30.84"></a><span id="l30.84" class="difflineplus">+     * Wraps an instance. Replaces calInstanceOf from calUtils.js</span>
<a href="#l30.85"></a><span id="l30.85">      *</span>
<a href="#l30.86"></a><span id="l30.86" class="difflineminus">-     * @param aObj the object under consideration </span>
<a href="#l30.87"></a><span id="l30.87" class="difflineplus">+     * @param aObj the object under consideration</span>
<a href="#l30.88"></a><span id="l30.88">      * @param aInterface the interface to be wrapped</span>
<a href="#l30.89"></a><span id="l30.89">      *</span>
<a href="#l30.90"></a><span id="l30.90" class="difflineminus">-     * Use this function to QueryInterface the object to a particular interface. </span>
<a href="#l30.91"></a><span id="l30.91" class="difflineminus">-     * You may only expect the return value to be wrapped, not the original passed object. </span>
<a href="#l30.92"></a><span id="l30.92" class="difflineplus">+     * Use this function to QueryInterface the object to a particular interface.</span>
<a href="#l30.93"></a><span id="l30.93" class="difflineplus">+     * You may only expect the return value to be wrapped, not the original passed object.</span>
<a href="#l30.94"></a><span id="l30.94">      * For example:</span>
<a href="#l30.95"></a><span id="l30.95">      * // BAD USAGE:</span>
<a href="#l30.96"></a><span id="l30.96">      * if (cal.wrapInstance(foo, Ci.nsIBar)) {</span>
<a href="#l30.97"></a><span id="l30.97">      *   foo.barMethod();</span>
<a href="#l30.98"></a><span id="l30.98">      * }</span>
<a href="#l30.99"></a><span id="l30.99">      * // GOOD USAGE:</span>
<a href="#l30.100"></a><span id="l30.100">      * foo = cal.wrapInstance(foo, Ci.nsIBar);</span>
<a href="#l30.101"></a><span id="l30.101">      * if (foo) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -99,17 +99,17 @@ calDefaultCalendarACLEntry.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4">     },</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6">     refresh: function calDefaultCalendarACLEntry_refresh() {</span>
<a href="#l31.7"></a><span id="l31.7">     }</span>
<a href="#l31.8"></a><span id="l31.8"> };</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10"> function calDefaultItemACLEntry(aCalendarEntry) {</span>
<a href="#l31.11"></a><span id="l31.11">     this.calendarEntry = aCalendarEntry;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-};</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+}</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15"> calDefaultItemACLEntry.prototype = {</span>
<a href="#l31.16"></a><span id="l31.16">     /* nsISupports */</span>
<a href="#l31.17"></a><span id="l31.17">     QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIItemACLEntry]),</span>
<a href="#l31.18"></a><span id="l31.18"> </span>
<a href="#l31.19"></a><span id="l31.19">     /* calIItemACLEntry */</span>
<a href="#l31.20"></a><span id="l31.20">     calendarEntry: null,</span>
<a href="#l31.21"></a><span id="l31.21">     userCanModify: true,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -349,27 +349,27 @@ calItemBase.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">                 mCurrentProp: null,</span>
<a href="#l32.5"></a><span id="l32.5"> </span>
<a href="#l32.6"></a><span id="l32.6">                 hasMoreElements: function cib_pe_hasMoreElements() {</span>
<a href="#l32.7"></a><span id="l32.7">                     if (this.mCurrentProp) {</span>
<a href="#l32.8"></a><span id="l32.8">                         return true;</span>
<a href="#l32.9"></a><span id="l32.9">                     }</span>
<a href="#l32.10"></a><span id="l32.10">                     if (this.mProxyEnum) {</span>
<a href="#l32.11"></a><span id="l32.11">                         while (this.mProxyEnum.hasMoreElements()) {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-                            var prop = this.mProxyEnum.getNext();</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+                            let prop = this.mProxyEnum.getNext();</span>
<a href="#l32.14"></a><span id="l32.14">                             this.mHandledProps[prop.name] = true;</span>
<a href="#l32.15"></a><span id="l32.15">                             if (prop.value !== null) {</span>
<a href="#l32.16"></a><span id="l32.16">                                 this.mCurrentProp = prop;</span>
<a href="#l32.17"></a><span id="l32.17">                                 return true;</span>
<a href="#l32.18"></a><span id="l32.18">                             } // else skip the deleted properties</span>
<a href="#l32.19"></a><span id="l32.19">                         }</span>
<a href="#l32.20"></a><span id="l32.20">                         this.mProxyEnum = null;</span>
<a href="#l32.21"></a><span id="l32.21">                     }</span>
<a href="#l32.22"></a><span id="l32.22">                     while (this.mParentEnum.hasMoreElements()) {</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineminus">-                        var prop = this.mParentEnum.getNext();</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineplus">+                        let prop = this.mParentEnum.getNext();</span>
<a href="#l32.25"></a><span id="l32.25">                         if (!this.mHandledProps[prop.name]) {</span>
<a href="#l32.26"></a><span id="l32.26">                             this.mCurrentProp = prop;</span>
<a href="#l32.27"></a><span id="l32.27">                             return true;</span>
<a href="#l32.28"></a><span id="l32.28">                         }</span>
<a href="#l32.29"></a><span id="l32.29">                     }</span>
<a href="#l32.30"></a><span id="l32.30">                     return false;</span>
<a href="#l32.31"></a><span id="l32.31">                 },</span>
<a href="#l32.32"></a><span id="l32.32"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -487,58 +487,58 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l33.4"></a><span id="l33.4">         if (rangeStart &amp;&amp; rangeEnd) {</span>
<a href="#l33.5"></a><span id="l33.5">             maxCount = 0;</span>
<a href="#l33.6"></a><span id="l33.6">         } else {</span>
<a href="#l33.7"></a><span id="l33.7">             maxCount = aMaxCount;</span>
<a href="#l33.8"></a><span id="l33.8">         }</span>
<a href="#l33.9"></a><span id="l33.9"> </span>
<a href="#l33.10"></a><span id="l33.10">         // Apply positive rules</span>
<a href="#l33.11"></a><span id="l33.11">         for (let ritem of this.mPositiveRules) {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-            var cur_dates = ritem.getOccurrences(startDate,</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+            let cur_dates = ritem.getOccurrences(startDate,</span>
<a href="#l33.14"></a><span id="l33.14">                                                  searchStart,</span>
<a href="#l33.15"></a><span id="l33.15">                                                  rangeEnd,</span>
<a href="#l33.16"></a><span id="l33.16">                                                  maxCount, {});</span>
<a href="#l33.17"></a><span id="l33.17">             if (cur_dates.length == 0) {</span>
<a href="#l33.18"></a><span id="l33.18">                 continue;</span>
<a href="#l33.19"></a><span id="l33.19">             }</span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21">             // if positive, we just add these date to the existing set,</span>
<a href="#l33.22"></a><span id="l33.22">             // but only if they're not already there</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24" class="difflineminus">-            var index = 0;</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineminus">-            var len = cur_dates.length;</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineplus">+            let index = 0;</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineplus">+            let len = cur_dates.length;</span>
<a href="#l33.28"></a><span id="l33.28"> </span>
<a href="#l33.29"></a><span id="l33.29">             // skip items before rangeStart due to searchStart libical hack:</span>
<a href="#l33.30"></a><span id="l33.30">             if (rangeStart &amp;&amp; baseDuration) {</span>
<a href="#l33.31"></a><span id="l33.31">                 for (; index &lt; len; ++index) {</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineminus">-                    var date = cur_dates[index].clone();</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+                    let date = cur_dates[index].clone();</span>
<a href="#l33.34"></a><span id="l33.34">                     date.addDuration(baseDuration);</span>
<a href="#l33.35"></a><span id="l33.35">                     if (rangeStart.compare(date) &lt; 0) {</span>
<a href="#l33.36"></a><span id="l33.36">                         break;</span>
<a href="#l33.37"></a><span id="l33.37">                     }</span>
<a href="#l33.38"></a><span id="l33.38">                 }</span>
<a href="#l33.39"></a><span id="l33.39">             }</span>
<a href="#l33.40"></a><span id="l33.40">             for (; index &lt; len; ++index) {</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineminus">-                var date = cur_dates[index];</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineminus">-                var dateKey = getRidKey(date);</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineplus">+                let date = cur_dates[index];</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineplus">+                let dateKey = getRidKey(date);</span>
<a href="#l33.45"></a><span id="l33.45">                 if (occurrenceMap[dateKey]) {</span>
<a href="#l33.46"></a><span id="l33.46">                     // Don't add occurrences twice (i.e exception was</span>
<a href="#l33.47"></a><span id="l33.47">                     // already added before)</span>
<a href="#l33.48"></a><span id="l33.48">                     continue;</span>
<a href="#l33.49"></a><span id="l33.49">                 }</span>
<a href="#l33.50"></a><span id="l33.50">                 // TODO if cur_dates[] is also sorted, then this binary</span>
<a href="#l33.51"></a><span id="l33.51">                 // search could be optimized further</span>
<a href="#l33.52"></a><span id="l33.52">                 binaryInsert(dates, { id: date, rstart: date }, ridDateSortComptor);</span>
<a href="#l33.53"></a><span id="l33.53">                 occurrenceMap[dateKey] = true;</span>
<a href="#l33.54"></a><span id="l33.54">             }</span>
<a href="#l33.55"></a><span id="l33.55">         }</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57">         // Apply negative rules</span>
<a href="#l33.58"></a><span id="l33.58">         for (let ritem of this.mNegativeRules) {</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineminus">-            var cur_dates = ritem.getOccurrences(startDate,</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineplus">+            let cur_dates = ritem.getOccurrences(startDate,</span>
<a href="#l33.61"></a><span id="l33.61">                                                  searchStart,</span>
<a href="#l33.62"></a><span id="l33.62">                                                  rangeEnd,</span>
<a href="#l33.63"></a><span id="l33.63">                                                  maxCount, {});</span>
<a href="#l33.64"></a><span id="l33.64">             if (cur_dates.length == 0) {</span>
<a href="#l33.65"></a><span id="l33.65">                 continue;</span>
<a href="#l33.66"></a><span id="l33.66">             }</span>
<a href="#l33.67"></a><span id="l33.67"> </span>
<a href="#l33.68"></a><span id="l33.68">             // XXX: i'm pretty sure negative dates can't really have exceptions</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -362,17 +362,17 @@ function guessSystemTimezone() {</span>
<a href="#l34.4"></a><span id="l34.4">                 return 3;</span>
<a href="#l34.5"></a><span id="l34.5">             } else {</span>
<a href="#l34.6"></a><span id="l34.6">                 return 2;</span>
<a href="#l34.7"></a><span id="l34.7">             }</span>
<a href="#l34.8"></a><span id="l34.8">         }</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">         if (offsetDec == standardTZOffset &amp;&amp; offsetJun == daylightTZOffset &amp;&amp;</span>
<a href="#l34.11"></a><span id="l34.11">             daylight) {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-            var dateMatchWt = systemTZMatchesTimeShiftDates(tz, subComp);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+            let dateMatchWt = systemTZMatchesTimeShiftDates(tz, subComp);</span>
<a href="#l34.14"></a><span id="l34.14">             if (dateMatchWt &gt; 0) {</span>
<a href="#l34.15"></a><span id="l34.15">                 if (standardName &amp;&amp; standardName == tzNameJun &amp;&amp;</span>
<a href="#l34.16"></a><span id="l34.16">                     daylightName &amp;&amp; daylightName == tzNameDec) {</span>
<a href="#l34.17"></a><span id="l34.17">                     return 3;</span>
<a href="#l34.18"></a><span id="l34.18">                 } else {</span>
<a href="#l34.19"></a><span id="l34.19">                     return dateMatchWt;</span>
<a href="#l34.20"></a><span id="l34.20">                 }</span>
<a href="#l34.21"></a><span id="l34.21">             }</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -385,17 +385,17 @@ function guessSystemTimezone() {</span>
<a href="#l34.23"></a><span id="l34.23">                 return 3;</span>
<a href="#l34.24"></a><span id="l34.24">             } else {</span>
<a href="#l34.25"></a><span id="l34.25">                 return 2;</span>
<a href="#l34.26"></a><span id="l34.26">             }</span>
<a href="#l34.27"></a><span id="l34.27">         }</span>
<a href="#l34.28"></a><span id="l34.28"> </span>
<a href="#l34.29"></a><span id="l34.29">         if (offsetJun == standardTZOffset &amp;&amp; offsetDec == daylightTZOffset &amp;&amp;</span>
<a href="#l34.30"></a><span id="l34.30">             daylight) {</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-            var dateMatchWt = systemTZMatchesTimeShiftDates(tz, subComp);</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+            let dateMatchWt = systemTZMatchesTimeShiftDates(tz, subComp);</span>
<a href="#l34.33"></a><span id="l34.33">             if (dateMatchWt &gt; 0) {</span>
<a href="#l34.34"></a><span id="l34.34">                 if (standardName &amp;&amp; standardName == tzNameJun &amp;&amp;</span>
<a href="#l34.35"></a><span id="l34.35">                     daylightName &amp;&amp; daylightName == tzNameDec) {</span>
<a href="#l34.36"></a><span id="l34.36">                     return 3;</span>
<a href="#l34.37"></a><span id="l34.37">                 } else {</span>
<a href="#l34.38"></a><span id="l34.38">                     return dateMatchWt;</span>
<a href="#l34.39"></a><span id="l34.39">                 }</span>
<a href="#l34.40"></a><span id="l34.40">             }</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineat">@@ -657,18 +657,18 @@ function guessSystemTimezone() {</span>
<a href="#l34.42"></a><span id="l34.42">             let results = osUserTimeZone.match(tzRegex);</span>
<a href="#l34.43"></a><span id="l34.43">             if (results) {</span>
<a href="#l34.44"></a><span id="l34.44">                 zoneInfoIdFromOSUserTimeZone = results[1];</span>
<a href="#l34.45"></a><span id="l34.45">             }</span>
<a href="#l34.46"></a><span id="l34.46">         }</span>
<a href="#l34.47"></a><span id="l34.47"> </span>
<a href="#l34.48"></a><span id="l34.48">         // check how well OS tz matches tz defined in our version of zoneinfo db</span>
<a href="#l34.49"></a><span id="l34.49">         if (zoneInfoIdFromOSUserTimeZone != null) {</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-            var tzId = zoneInfoIdFromOSUserTimeZone;</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-            var score = checkTZ(tzId);</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineplus">+            let tzId = zoneInfoIdFromOSUserTimeZone;</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+            let score = checkTZ(tzId);</span>
<a href="#l34.54"></a><span id="l34.54">             switch(score) {</span>
<a href="#l34.55"></a><span id="l34.55">             case 0:</span>
<a href="#l34.56"></a><span id="l34.56">                 // Did not match.</span>
<a href="#l34.57"></a><span id="l34.57">                 // Maybe OS or Application is old, and the timezone changed.</span>
<a href="#l34.58"></a><span id="l34.58">                 // Or maybe user turned off DST in Date/Time control panel.</span>
<a href="#l34.59"></a><span id="l34.59">                 // Will look for a better matching tz, or fallback to floating.</span>
<a href="#l34.60"></a><span id="l34.60">                 // (Match OS so alarms go off at time indicated by OS clock.)</span>
<a href="#l34.61"></a><span id="l34.61">                 cal.WARN(calProperties.formatStringFromName(</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineat">@@ -676,102 +676,99 @@ function guessSystemTimezone() {</span>
<a href="#l34.63"></a><span id="l34.63">                 break;</span>
<a href="#l34.64"></a><span id="l34.64">             case 1: case 2:</span>
<a href="#l34.65"></a><span id="l34.65">                 // inexact match: OS TZ and our ZoneInfo TZ matched imperfectly.</span>
<a href="#l34.66"></a><span id="l34.66">                 // Will keep looking, will use tzId unless another is better.</span>
<a href="#l34.67"></a><span id="l34.67">                 // (maybe OS TZ has changed to match a nearby TZ, so maybe</span>
<a href="#l34.68"></a><span id="l34.68">                 // another ZoneInfo TZ matches it better).</span>
<a href="#l34.69"></a><span id="l34.69">                 probableTZId = tzId;</span>
<a href="#l34.70"></a><span id="l34.70">                 probableTZScore = score;</span>
<a href="#l34.71"></a><span id="l34.71" class="difflineminus">-                probableTZSource = (calProperties.formatStringFromName</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-                                    (&quot;TZFromOS&quot;, [osUserTimeZone], 1));</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineplus">+                probableTZSource = calProperties.formatStringFromName(</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineplus">+                    &quot;TZFromOS&quot;, [osUserTimeZone], 1);</span>
<a href="#l34.75"></a><span id="l34.75" class="difflineplus">+</span>
<a href="#l34.76"></a><span id="l34.76">                 break;</span>
<a href="#l34.77"></a><span id="l34.77">             case 3:</span>
<a href="#l34.78"></a><span id="l34.78">                 // exact match</span>
<a href="#l34.79"></a><span id="l34.79">                 return tzId;</span>
<a href="#l34.80"></a><span id="l34.80">             }</span>
<a href="#l34.81"></a><span id="l34.81">         }</span>
<a href="#l34.82"></a><span id="l34.82">     } catch (ex) {</span>
<a href="#l34.83"></a><span id="l34.83">         // zoneInfo id given was not recognized by our ZoneInfo database</span>
<a href="#l34.84"></a><span id="l34.84" class="difflineminus">-        var errMsg = (calProperties.formatStringFromName</span>
<a href="#l34.85"></a><span id="l34.85" class="difflineminus">-                      (&quot;SkippingOSTimezone&quot;,</span>
<a href="#l34.86"></a><span id="l34.86" class="difflineminus">-                       [zoneInfoIdFromOSUserTimeZone || osUserTimeZone], 1));</span>
<a href="#l34.87"></a><span id="l34.87" class="difflineminus">-        Components.utils.reportError(errMsg+&quot; &quot;+ex);</span>
<a href="#l34.88"></a><span id="l34.88" class="difflineplus">+        let errParams = [zoneInfoIdFromOSUserTimeZone || osUserTimeZone];</span>
<a href="#l34.89"></a><span id="l34.89" class="difflineplus">+        let errMsg = calProperties.formatStringFromName(&quot;SkippingOSTimezone&quot;, errParams, 1);</span>
<a href="#l34.90"></a><span id="l34.90" class="difflineplus">+        Components.utils.reportError(errMsg + &quot; &quot; + ex);</span>
<a href="#l34.91"></a><span id="l34.91">     }</span>
<a href="#l34.92"></a><span id="l34.92"> </span>
<a href="#l34.93"></a><span id="l34.93">     // Second, give priority to &quot;likelyTimezone&quot;s if provided by locale.</span>
<a href="#l34.94"></a><span id="l34.94">     try {</span>
<a href="#l34.95"></a><span id="l34.95">         // The likelyTimezone property is a comma-separated list of</span>
<a href="#l34.96"></a><span id="l34.96">         // ZoneInfo timezone ids.</span>
<a href="#l34.97"></a><span id="l34.97">         const bundleTZString =</span>
<a href="#l34.98"></a><span id="l34.98">             calProperties.GetStringFromName(&quot;likelyTimezone&quot;);</span>
<a href="#l34.99"></a><span id="l34.99">         const bundleTZIds = bundleTZString.split(/\s*,\s*/);</span>
<a href="#l34.100"></a><span id="l34.100" class="difflineminus">-        for (var bareTZId of bundleTZIds) {</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineminus">-            var tzId = bareTZId;</span>
<a href="#l34.102"></a><span id="l34.102" class="difflineplus">+        for (let bareTZId of bundleTZIds) {</span>
<a href="#l34.103"></a><span id="l34.103" class="difflineplus">+            let tzId = bareTZId;</span>
<a href="#l34.104"></a><span id="l34.104">             try {</span>
<a href="#l34.105"></a><span id="l34.105" class="difflineminus">-                var score = checkTZ(tzId);</span>
<a href="#l34.106"></a><span id="l34.106" class="difflineplus">+                let score = checkTZ(tzId);</span>
<a href="#l34.107"></a><span id="l34.107"> </span>
<a href="#l34.108"></a><span id="l34.108">                 switch (score) {</span>
<a href="#l34.109"></a><span id="l34.109">                 case 0:</span>
<a href="#l34.110"></a><span id="l34.110">                     break;</span>
<a href="#l34.111"></a><span id="l34.111">                 case 1: case 2:</span>
<a href="#l34.112"></a><span id="l34.112">                     if (score &gt; probableTZScore) {</span>
<a href="#l34.113"></a><span id="l34.113">                         probableTZId = tzId;</span>
<a href="#l34.114"></a><span id="l34.114">                         probableTZScore = score;</span>
<a href="#l34.115"></a><span id="l34.115" class="difflineminus">-                        probableTZSource = (calProperties.GetStringFromName</span>
<a href="#l34.116"></a><span id="l34.116" class="difflineminus">-                                            (&quot;TZFromLocale&quot;));</span>
<a href="#l34.117"></a><span id="l34.117" class="difflineplus">+                        probableTZSource = calProperties.GetStringFromName(&quot;TZFromLocale&quot;);</span>
<a href="#l34.118"></a><span id="l34.118">                     }</span>
<a href="#l34.119"></a><span id="l34.119">                     break;</span>
<a href="#l34.120"></a><span id="l34.120">                 case 3:</span>
<a href="#l34.121"></a><span id="l34.121">                     return tzId;</span>
<a href="#l34.122"></a><span id="l34.122">                 }</span>
<a href="#l34.123"></a><span id="l34.123">             } catch (ex) {</span>
<a href="#l34.124"></a><span id="l34.124" class="difflineminus">-                var errMsg = (calProperties.formatStringFromName</span>
<a href="#l34.125"></a><span id="l34.125" class="difflineminus">-                              (&quot;SkippingLocaleTimezone&quot;, [bareTZId], 1));</span>
<a href="#l34.126"></a><span id="l34.126" class="difflineplus">+                let errMsg = calProperties.formatStringFromName(</span>
<a href="#l34.127"></a><span id="l34.127" class="difflineplus">+                    &quot;SkippingLocaleTimezone&quot;, [bareTZId], 1);</span>
<a href="#l34.128"></a><span id="l34.128">                 Components.utils.reportError(errMsg+&quot; &quot;+ex);</span>
<a href="#l34.129"></a><span id="l34.129">             }</span>
<a href="#l34.130"></a><span id="l34.130">         }</span>
<a href="#l34.131"></a><span id="l34.131">     } catch (ex) { // Oh well, this didn't work, next option...</span>
<a href="#l34.132"></a><span id="l34.132">         Components.utils.reportError(ex);</span>
<a href="#l34.133"></a><span id="l34.133">     }</span>
<a href="#l34.134"></a><span id="l34.134"> </span>
<a href="#l34.135"></a><span id="l34.135">     // Third, try all known timezones.</span>
<a href="#l34.136"></a><span id="l34.136">     const tzIDs = tzSvc.timezoneIds;</span>
<a href="#l34.137"></a><span id="l34.137">     while (tzIDs.hasMore()) {</span>
<a href="#l34.138"></a><span id="l34.138" class="difflineminus">-        var tzId = tzIDs.getNext();</span>
<a href="#l34.139"></a><span id="l34.139" class="difflineplus">+        let tzId = tzIDs.getNext();</span>
<a href="#l34.140"></a><span id="l34.140">         try {</span>
<a href="#l34.141"></a><span id="l34.141" class="difflineminus">-            var score = checkTZ(tzId);</span>
<a href="#l34.142"></a><span id="l34.142" class="difflineplus">+            let score = checkTZ(tzId);</span>
<a href="#l34.143"></a><span id="l34.143">             switch(score) {</span>
<a href="#l34.144"></a><span id="l34.144">             case 0: break;</span>
<a href="#l34.145"></a><span id="l34.145">             case 1: case 2:</span>
<a href="#l34.146"></a><span id="l34.146">                 if (score &gt; probableTZScore) {</span>
<a href="#l34.147"></a><span id="l34.147">                     probableTZId = tzId;</span>
<a href="#l34.148"></a><span id="l34.148">                     probableTZScore = score;</span>
<a href="#l34.149"></a><span id="l34.149" class="difflineminus">-                    probableTZSource = (calProperties.GetStringFromName</span>
<a href="#l34.150"></a><span id="l34.150" class="difflineminus">-                                        (&quot;TZFromKnownTimezones&quot;));</span>
<a href="#l34.151"></a><span id="l34.151" class="difflineplus">+                    probableTZSource = calProperties.GetStringFromName(&quot;TZFromKnownTimezones&quot;);</span>
<a href="#l34.152"></a><span id="l34.152">                 }</span>
<a href="#l34.153"></a><span id="l34.153">                 break;</span>
<a href="#l34.154"></a><span id="l34.154">             case 3:</span>
<a href="#l34.155"></a><span id="l34.155">                 return tzId;</span>
<a href="#l34.156"></a><span id="l34.156">             }</span>
<a href="#l34.157"></a><span id="l34.157">         } catch (ex) { // bug if ics service doesn't recognize own tzid!</span>
<a href="#l34.158"></a><span id="l34.158" class="difflineminus">-            var msg = (&quot;ics-service doesn't recognize own tzid: &quot;+tzId+&quot;\n&quot;+</span>
<a href="#l34.159"></a><span id="l34.159" class="difflineminus">-                       ex);</span>
<a href="#l34.160"></a><span id="l34.160" class="difflineplus">+            let msg = &quot;ics-service doesn't recognize own tzid: &quot; + tzId + &quot;\n&quot; + ex;</span>
<a href="#l34.161"></a><span id="l34.161">             Components.utils.reportError(msg);</span>
<a href="#l34.162"></a><span id="l34.162">         }</span>
<a href="#l34.163"></a><span id="l34.163">     }</span>
<a href="#l34.164"></a><span id="l34.164"> </span>
<a href="#l34.165"></a><span id="l34.165">     // If reach here, there were no score=3 matches, so Warn in console.</span>
<a href="#l34.166"></a><span id="l34.166">     try {</span>
<a href="#l34.167"></a><span id="l34.167">         switch(probableTZScore) {</span>
<a href="#l34.168"></a><span id="l34.168">         case 0:</span>
<a href="#l34.169"></a><span id="l34.169">             cal.WARN(calProperties.GetStringFromName(&quot;warningUsingFloatingTZNoMatch&quot;));</span>
<a href="#l34.170"></a><span id="l34.170">             break;</span>
<a href="#l34.171"></a><span id="l34.171">         case 1: case 2:</span>
<a href="#l34.172"></a><span id="l34.172" class="difflineminus">-            var tzId = probableTZId;</span>
<a href="#l34.173"></a><span id="l34.173" class="difflineplus">+            let tzId = probableTZId;</span>
<a href="#l34.174"></a><span id="l34.174">             var tz = tzSvc.getTimezone(tzId);</span>
<a href="#l34.175"></a><span id="l34.175">             var subComp = tz.icalComponent;</span>
<a href="#l34.176"></a><span id="l34.176">             var standard = findCurrentTimePeriod(tz, subComp, &quot;STANDARD&quot;);</span>
<a href="#l34.177"></a><span id="l34.177">             var standardTZOffset = getIcalString(standard, &quot;TZOFFSETTO&quot;);</span>
<a href="#l34.178"></a><span id="l34.178">             var daylight = findCurrentTimePeriod(tz, subComp, &quot;DAYLIGHT&quot;);</span>
<a href="#l34.179"></a><span id="l34.179">             var daylightTZOffset = getIcalString(daylight, &quot;TZOFFSETTO&quot;);</span>
<a href="#l34.180"></a><span id="l34.180">             var warningDetail;</span>
<a href="#l34.181"></a><span id="l34.181">             if (probableTZScore == 1) {</span>
<a href="#l34.182"></a><span id="l34.182" class="difflineat">@@ -788,28 +785,25 @@ function guessSystemTimezone() {</span>
<a href="#l34.183"></a><span id="l34.183">                 var daylightRule  = getIcalString(daylight, &quot;RRULE&quot;);</span>
<a href="#l34.184"></a><span id="l34.184">                 var daylightText =</span>
<a href="#l34.185"></a><span id="l34.185">                     (&quot;  Daylight: &quot;+daylightStart+&quot; &quot;+daylightStartWeekday+&quot;\n&quot;+</span>
<a href="#l34.186"></a><span id="l34.186">                      &quot;            &quot;+daylightRule+&quot;\n&quot;);</span>
<a href="#l34.187"></a><span id="l34.187">                 warningDetail =</span>
<a href="#l34.188"></a><span id="l34.188">                     ((standardStart &lt; daylightStart</span>
<a href="#l34.189"></a><span id="l34.189">                       ? standardText + daylightText</span>
<a href="#l34.190"></a><span id="l34.190">                       : daylightText + standardText)+</span>
<a href="#l34.191"></a><span id="l34.191" class="difflineminus">-                     (calProperties.GetStringFromName</span>
<a href="#l34.192"></a><span id="l34.192" class="difflineminus">-                      (&quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;)));</span>
<a href="#l34.193"></a><span id="l34.193" class="difflineplus">+                     (calProperties.GetStringFromName(</span>
<a href="#l34.194"></a><span id="l34.194" class="difflineplus">+                      &quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;)));</span>
<a href="#l34.195"></a><span id="l34.195">             } else {</span>
<a href="#l34.196"></a><span id="l34.196" class="difflineminus">-                warningDetail =</span>
<a href="#l34.197"></a><span id="l34.197" class="difflineminus">-                    (calProperties.GetStringFromName(&quot;TZSeemsToMatchOS&quot;));</span>
<a href="#l34.198"></a><span id="l34.198" class="difflineplus">+                warningDetail = calProperties.GetStringFromName(&quot;TZSeemsToMatchOS&quot;);</span>
<a href="#l34.199"></a><span id="l34.199">             }</span>
<a href="#l34.200"></a><span id="l34.200" class="difflineminus">-            var offsetString = (standardTZOffset+</span>
<a href="#l34.201"></a><span id="l34.201" class="difflineminus">-                                 (!daylightTZOffset? &quot;&quot;: &quot;/&quot;+daylightTZOffset));</span>
<a href="#l34.202"></a><span id="l34.202" class="difflineminus">-            var warningMsg = (calProperties.formatStringFromName</span>
<a href="#l34.203"></a><span id="l34.203" class="difflineminus">-                              (&quot;WarningUsingGuessedTZ&quot;,</span>
<a href="#l34.204"></a><span id="l34.204" class="difflineminus">-                               [tzId, offsetString, warningDetail,</span>
<a href="#l34.205"></a><span id="l34.205" class="difflineminus">-                                probableTZSource], 4));</span>
<a href="#l34.206"></a><span id="l34.206" class="difflineplus">+            var offsetString = standardTZOffset+</span>
<a href="#l34.207"></a><span id="l34.207" class="difflineplus">+                                 (!daylightTZOffset ? &quot;&quot; : &quot;/&quot; + daylightTZOffset);</span>
<a href="#l34.208"></a><span id="l34.208" class="difflineplus">+            var warningMsg = calProperties.formatStringFromName(&quot;WarningUsingGuessedTZ&quot;,</span>
<a href="#l34.209"></a><span id="l34.209" class="difflineplus">+                              [tzId, offsetString, warningDetail, probableTZSource], 4);</span>
<a href="#l34.210"></a><span id="l34.210">             cal.WARN(warningMsg);</span>
<a href="#l34.211"></a><span id="l34.211">             break;</span>
<a href="#l34.212"></a><span id="l34.212">         }</span>
<a href="#l34.213"></a><span id="l34.213">     } catch (ex) { // don't abort if error occurs warning user</span>
<a href="#l34.214"></a><span id="l34.214">         Components.utils.reportError(ex);</span>
<a href="#l34.215"></a><span id="l34.215">     }</span>
<a href="#l34.216"></a><span id="l34.216"> </span>
<a href="#l34.217"></a><span id="l34.217">     // return the guessed timezone</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -915,26 +915,24 @@ function LOG(aArg) {</span>
<a href="#l35.4"></a><span id="l35.4">     try {</span>
<a href="#l35.5"></a><span id="l35.5">         shouldLog = Services.prefs.getBoolPref(&quot;calendar.debug.log&quot;);</span>
<a href="#l35.6"></a><span id="l35.6">     } catch(ex) {}</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8">     if (!shouldLog) {</span>
<a href="#l35.9"></a><span id="l35.9">         return;</span>
<a href="#l35.10"></a><span id="l35.10">     }</span>
<a href="#l35.11"></a><span id="l35.11">     ASSERT(aArg, &quot;Bad log argument.&quot;, false);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    var string;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    var string = aArg;</span>
<a href="#l35.14"></a><span id="l35.14">     // We should just dump() both String objects, and string primitives.</span>
<a href="#l35.15"></a><span id="l35.15">     if (!(aArg instanceof String) &amp;&amp; !(typeof(aArg) == &quot;string&quot;)) {</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">-        var string = &quot;Logging object...\n&quot;;</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+        string = &quot;Logging object...\n&quot;;</span>
<a href="#l35.18"></a><span id="l35.18">         for (var prop in aArg) {</span>
<a href="#l35.19"></a><span id="l35.19">             string += prop + ': ' + aArg[prop] + '\n';</span>
<a href="#l35.20"></a><span id="l35.20">         }</span>
<a href="#l35.21"></a><span id="l35.21">         string += &quot;End object\n&quot;;</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">-    } else {</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">-        string = aArg;</span>
<a href="#l35.24"></a><span id="l35.24">     }</span>
<a href="#l35.25"></a><span id="l35.25"> </span>
<a href="#l35.26"></a><span id="l35.26">     dump(string + '\n');</span>
<a href="#l35.27"></a><span id="l35.27">     _log(string, Components.interfaces.nsIScriptError.infoFlag);</span>
<a href="#l35.28"></a><span id="l35.28"> }</span>
<a href="#l35.29"></a><span id="l35.29"> </span>
<a href="#l35.30"></a><span id="l35.30"> /**</span>
<a href="#l35.31"></a><span id="l35.31">  * Dumps a warning to both console and js console.</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineat">@@ -1449,17 +1447,17 @@ function isPropertyValueSame(aObjects, a</span>
<a href="#l35.33"></a><span id="l35.33">  */</span>
<a href="#l35.34"></a><span id="l35.34"> function getParentNodeOrThis(aChildNode, aLocalName) {</span>
<a href="#l35.35"></a><span id="l35.35">     var node = aChildNode;</span>
<a href="#l35.36"></a><span id="l35.36">     while (node &amp;&amp; (node.localName != aLocalName)) {</span>
<a href="#l35.37"></a><span id="l35.37">         node = node.parentNode;</span>
<a href="#l35.38"></a><span id="l35.38">         if (node.tagName == undefined) {</span>
<a href="#l35.39"></a><span id="l35.39">             return null;</span>
<a href="#l35.40"></a><span id="l35.40">         }</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineminus">-    };</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+    }</span>
<a href="#l35.43"></a><span id="l35.43">     return node;</span>
<a href="#l35.44"></a><span id="l35.44"> }</span>
<a href="#l35.45"></a><span id="l35.45"> </span>
<a href="#l35.46"></a><span id="l35.46"> /**</span>
<a href="#l35.47"></a><span id="l35.47">  * Returns a parentnode  - or the overgiven node -  with the given attributevalue</span>
<a href="#l35.48"></a><span id="l35.48">  * for the given attributename by &quot;walking up&quot; the DOM-hierarchy.</span>
<a href="#l35.49"></a><span id="l35.49">  *</span>
<a href="#l35.50"></a><span id="l35.50">  * @param aChildNode      The childnode.</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineat">@@ -1472,17 +1470,17 @@ function getParentNodeOrThis(aChildNode,</span>
<a href="#l35.52"></a><span id="l35.52">  */</span>
<a href="#l35.53"></a><span id="l35.53"> function getParentNodeOrThisByAttribute(aChildNode, aAttributeName, aAttributeValue) {</span>
<a href="#l35.54"></a><span id="l35.54">     var node = aChildNode;</span>
<a href="#l35.55"></a><span id="l35.55">     while (node &amp;&amp; (node.getAttribute(aAttributeName) != aAttributeValue)) {</span>
<a href="#l35.56"></a><span id="l35.56">         node = node.parentNode;</span>
<a href="#l35.57"></a><span id="l35.57">         if (node.tagName == undefined) {</span>
<a href="#l35.58"></a><span id="l35.58">             return null;</span>
<a href="#l35.59"></a><span id="l35.59">         }</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineminus">-    };</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineplus">+    }</span>
<a href="#l35.62"></a><span id="l35.62">     return node;</span>
<a href="#l35.63"></a><span id="l35.63"> }</span>
<a href="#l35.64"></a><span id="l35.64"> </span>
<a href="#l35.65"></a><span id="l35.65"> function setItemProperty(item, propertyName, aValue, aCapability) {</span>
<a href="#l35.66"></a><span id="l35.66">     var isSupported = (item.calendar.getProperty(&quot;capabilities.&quot; + aCapability + &quot;.supported&quot;) !== false)</span>
<a href="#l35.67"></a><span id="l35.67">     var value = (aCapability &amp;&amp; !isSupported ? null : aValue);</span>
<a href="#l35.68"></a><span id="l35.68"> </span>
<a href="#l35.69"></a><span id="l35.69">     switch (propertyName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/src/calWeekInfoService.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/src/calWeekInfoService.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -20,21 +20,21 @@ calWeekInfoService.prototype = {</span>
<a href="#l36.4"></a><span id="l36.4">         classDescription: &quot;Calendar WeekInfo Service&quot;,</span>
<a href="#l36.5"></a><span id="l36.5">         interfaces: calWeekInfoServiceInterfaces,</span>
<a href="#l36.6"></a><span id="l36.6">         flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l36.7"></a><span id="l36.7">     }),</span>
<a href="#l36.8"></a><span id="l36.8"> </span>
<a href="#l36.9"></a><span id="l36.9">     // calIWeekInfoService:</span>
<a href="#l36.10"></a><span id="l36.10">     getWeekTitle: function(aDateTime) {</span>
<a href="#l36.11"></a><span id="l36.11">         /**</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-         * This implementation is based on the ISO 8601 standard.  </span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+         * This implementation is based on the ISO 8601 standard.</span>
<a href="#l36.14"></a><span id="l36.14">          * ISO 8601 defines week one as the first week with at least 4</span>
<a href="#l36.15"></a><span id="l36.15">          * days, and defines Monday as the first day of the week.</span>
<a href="#l36.16"></a><span id="l36.16">          * Equivalently, the week one is the week with the first Thursday.</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-         * </span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+         *</span>
<a href="#l36.19"></a><span id="l36.19">          * This implementation uses the second definition, because it</span>
<a href="#l36.20"></a><span id="l36.20">          * enables the user to set a different start-day of the week</span>
<a href="#l36.21"></a><span id="l36.21">          * (Sunday instead of Monday is a common setting).  If the first</span>
<a href="#l36.22"></a><span id="l36.22">          * definition was used, all week-numbers could be off by one</span>
<a href="#l36.23"></a><span id="l36.23">          * depending on the week start day.  (For example, if weeks start</span>
<a href="#l36.24"></a><span id="l36.24">          * on Sunday, a year that starts on Thursday has only 3 days</span>
<a href="#l36.25"></a><span id="l36.25">          * [Thu-Sat] in that week, so it would be part of the last week of</span>
<a href="#l36.26"></a><span id="l36.26">          * the previous year, but if weeks start on Monday, the year would</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineat">@@ -56,17 +56,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l36.28"></a><span id="l36.28">         // which may be part of the week counted in the previous year.) So we</span>
<a href="#l36.29"></a><span id="l36.29">         // need the startWeekday.</span>
<a href="#l36.30"></a><span id="l36.30">         const SUNDAY = 0;</span>
<a href="#l36.31"></a><span id="l36.31">         var startWeekday = Preferences.get(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l36.32"></a><span id="l36.32"> </span>
<a href="#l36.33"></a><span id="l36.33">         // The number of days since the start of the week.</span>
<a href="#l36.34"></a><span id="l36.34">         // Notice that the result of the substraction might be negative.</span>
<a href="#l36.35"></a><span id="l36.35">         // We correct for that by adding 7, and then using the remainder operator.</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-        var sinceStartOfWeek = (aDateTime.weekday - startWeekday + 7) % 7; </span>
<a href="#l36.37"></a><span id="l36.37" class="difflineplus">+        var sinceStartOfWeek = (aDateTime.weekday - startWeekday + 7) % 7;</span>
<a href="#l36.38"></a><span id="l36.38"> </span>
<a href="#l36.39"></a><span id="l36.39">         // The number of days to Thursday is the difference between Thursday</span>
<a href="#l36.40"></a><span id="l36.40">         // and the start-day of the week (again corrected for negative values).</span>
<a href="#l36.41"></a><span id="l36.41">         const THURSDAY = 4;</span>
<a href="#l36.42"></a><span id="l36.42">         var startToThursday = (THURSDAY - startWeekday + 7) % 7;</span>
<a href="#l36.43"></a><span id="l36.43"> </span>
<a href="#l36.44"></a><span id="l36.44">         // The yearday number of the Thursday this week.</span>
<a href="#l36.45"></a><span id="l36.45">         var thisWeeksThursday = aDateTime.yearday - sinceStartOfWeek + startToThursday;</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineat">@@ -81,17 +81,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l36.47"></a><span id="l36.47">             thisWeeksThursday -= aDateTime.endOfYear.yearday;</span>
<a href="#l36.48"></a><span id="l36.48">         }</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50">         var weekNumber = Math.ceil(thisWeeksThursday/7);</span>
<a href="#l36.51"></a><span id="l36.51">         return weekNumber;</span>
<a href="#l36.52"></a><span id="l36.52">     },</span>
<a href="#l36.53"></a><span id="l36.53"> </span>
<a href="#l36.54"></a><span id="l36.54">     /**</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineminus">-     * gets the first day of a week of a passed day under consideration </span>
<a href="#l36.56"></a><span id="l36.56" class="difflineplus">+     * gets the first day of a week of a passed day under consideration</span>
<a href="#l36.57"></a><span id="l36.57">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l36.58"></a><span id="l36.58">      *</span>
<a href="#l36.59"></a><span id="l36.59">      * @param aDate     a date time object</span>
<a href="#l36.60"></a><span id="l36.60">      * @return          a dateTime-object denoting the first day of the week</span>
<a href="#l36.61"></a><span id="l36.61">      */</span>
<a href="#l36.62"></a><span id="l36.62">     getStartOfWeek: function(aDate) {</span>
<a href="#l36.63"></a><span id="l36.63">         var date = aDate.clone();</span>
<a href="#l36.64"></a><span id="l36.64">         date.isDate = true;</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineat">@@ -100,17 +100,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l36.66"></a><span id="l36.66">             date.day -= (7 - offset);</span>
<a href="#l36.67"></a><span id="l36.67">         } else {</span>
<a href="#l36.68"></a><span id="l36.68">             date.day += offset;</span>
<a href="#l36.69"></a><span id="l36.69">         }</span>
<a href="#l36.70"></a><span id="l36.70">         return date;</span>
<a href="#l36.71"></a><span id="l36.71">     },</span>
<a href="#l36.72"></a><span id="l36.72"> </span>
<a href="#l36.73"></a><span id="l36.73">     /**</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineminus">-     * gets the last day of a week of a passed day under consideration </span>
<a href="#l36.75"></a><span id="l36.75" class="difflineplus">+     * gets the last day of a week of a passed day under consideration</span>
<a href="#l36.76"></a><span id="l36.76">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l36.77"></a><span id="l36.77">      *</span>
<a href="#l36.78"></a><span id="l36.78">      * @param aDate     a date time object</span>
<a href="#l36.79"></a><span id="l36.79">      * @return          a dateTime-object denoting the last day of the week</span>
<a href="#l36.80"></a><span id="l36.80">      */</span>
<a href="#l36.81"></a><span id="l36.81">     getEndOfWeek: function(aDate) {</span>
<a href="#l36.82"></a><span id="l36.82">         var date = this.getStartOfWeek(aDate);</span>
<a href="#l36.83"></a><span id="l36.83">         date.day += 6;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -125,257 +125,254 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">      *   If the parse is cancelled, a zero length array is returned.</span>
<a href="#l37.5"></a><span id="l37.5">      */</span>
<a href="#l37.6"></a><span id="l37.6">     importFromStream: function csv_importFromStream(aStream, aCount) {</span>
<a href="#l37.7"></a><span id="l37.7">         let scriptableInputStream = Components.classes[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l37.8"></a><span id="l37.8">                                               .createInstance(Components.interfaces.nsIScriptableInputStream);</span>
<a href="#l37.9"></a><span id="l37.9">         scriptableInputStream.init(aStream);</span>
<a href="#l37.10"></a><span id="l37.10">         let str = scriptableInputStream.read(-1);</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-        parse: {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-            // parse header line of quoted comma separated column names.</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-            let trimEndQuotesRegExp = /^&quot;(.*)&quot;$/m;</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-            let trimResults = trimEndQuotesRegExp.exec( str );</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-            let header = trimResults &amp;&amp; trimResults[1].split(/&quot;,&quot;/);</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">-            if (header == null) {</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-                break parse;</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-            }</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+        // parse header line of quoted comma separated column names.</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineplus">+        let trimEndQuotesRegExp = /^&quot;(.*)&quot;$/m;</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineplus">+        let trimResults = trimEndQuotesRegExp.exec( str );</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineplus">+        let header = trimResults &amp;&amp; trimResults[1].split(/&quot;,&quot;/);</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineplus">+        if (header == null) {</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineplus">+            aCount.value = 0;</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+            return [];</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+        }</span>
<a href="#l37.28"></a><span id="l37.28"> </span>
<a href="#l37.29"></a><span id="l37.29" class="difflineminus">-            //strip header from string</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">-            str = str.slice(trimResults[0].length);</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+        //strip header from string</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+        str = str.slice(trimResults[0].length);</span>
<a href="#l37.33"></a><span id="l37.33"> </span>
<a href="#l37.34"></a><span id="l37.34" class="difflineminus">-            let args = {};</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineminus">-            //args.fieldList contains the field names from the first row of CSV</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineminus">-            args.fieldList = header;</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineplus">+        let args = {};</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineplus">+        //args.fieldList contains the field names from the first row of CSV</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineplus">+        args.fieldList = header;</span>
<a href="#l37.40"></a><span id="l37.40"> </span>
<a href="#l37.41"></a><span id="l37.41" class="difflineminus">-            let locale;</span>
<a href="#l37.42"></a><span id="l37.42" class="difflineminus">-            let i;</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineminus">-            let knownIndxs;</span>
<a href="#l37.44"></a><span id="l37.44" class="difflineminus">-            for (i in locales) {</span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-                locale = locales[i];</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineminus">-                knownIndxs = 0;</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineminus">-                args.titleIndex = 0;</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineminus">-                args.startDateIndex = 0;</span>
<a href="#l37.49"></a><span id="l37.49" class="difflineminus">-                for (let i = 1; i &lt;= header.length; ++i) {</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineminus">-                    switch( header[i-1] ) {</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-                        case locale.headTitle:        args.titleIndex = i;       knownIndxs++; break;</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-                        case locale.headStartDate:    args.startDateIndex = i;   knownIndxs++; break;</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-                        case locale.headStartTime:    args.startTimeIndex = i;   knownIndxs++; break;</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineminus">-                        case locale.headEndDate:      args.endDateIndex = i;     knownIndxs++; break;</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineminus">-                        case locale.headEndTime:      args.endTimeIndex = i;     knownIndxs++; break;</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineminus">-                        case locale.headAllDayEvent:  args.allDayIndex = i;      knownIndxs++; break;</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineminus">-                        case locale.headAlarm:        args.alarmIndex = i;       knownIndxs++; break;</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineminus">-                        case locale.headAlarmDate:    args.alarmDateIndex = i;   knownIndxs++; break;</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineminus">-                        case locale.headAlarmTime:    args.alarmTimeIndex = i;   knownIndxs++; break;</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-                        case locale.headCategories:   args.categoriesIndex = i;  knownIndxs++; break;</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineminus">-                        case locale.headDescription:  args.descriptionIndex = i; knownIndxs++; break;</span>
<a href="#l37.62"></a><span id="l37.62" class="difflineminus">-                        case locale.headLocation:     args.locationIndex = i;    knownIndxs++; break;</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-                        case locale.headPrivate:      args.privateIndex = i;     knownIndxs++; break;</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineminus">-                    }</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineminus">-                }</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineminus">-                // Were both mandatory fields recognized?</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineminus">-                if (args.titleIndex != 0 &amp;&amp; args.startDateIndex != 0) {</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineminus">-                    break;</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineplus">+        let locale;</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineplus">+        let i;</span>
<a href="#l37.71"></a><span id="l37.71" class="difflineplus">+        let knownIndxs;</span>
<a href="#l37.72"></a><span id="l37.72" class="difflineplus">+        for (i in locales) {</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineplus">+            locale = locales[i];</span>
<a href="#l37.74"></a><span id="l37.74" class="difflineplus">+            knownIndxs = 0;</span>
<a href="#l37.75"></a><span id="l37.75" class="difflineplus">+            args.titleIndex = 0;</span>
<a href="#l37.76"></a><span id="l37.76" class="difflineplus">+            args.startDateIndex = 0;</span>
<a href="#l37.77"></a><span id="l37.77" class="difflineplus">+            for (let i = 1; i &lt;= header.length; ++i) {</span>
<a href="#l37.78"></a><span id="l37.78" class="difflineplus">+                switch( header[i-1] ) {</span>
<a href="#l37.79"></a><span id="l37.79" class="difflineplus">+                    case locale.headTitle:        args.titleIndex = i;       knownIndxs++; break;</span>
<a href="#l37.80"></a><span id="l37.80" class="difflineplus">+                    case locale.headStartDate:    args.startDateIndex = i;   knownIndxs++; break;</span>
<a href="#l37.81"></a><span id="l37.81" class="difflineplus">+                    case locale.headStartTime:    args.startTimeIndex = i;   knownIndxs++; break;</span>
<a href="#l37.82"></a><span id="l37.82" class="difflineplus">+                    case locale.headEndDate:      args.endDateIndex = i;     knownIndxs++; break;</span>
<a href="#l37.83"></a><span id="l37.83" class="difflineplus">+                    case locale.headEndTime:      args.endTimeIndex = i;     knownIndxs++; break;</span>
<a href="#l37.84"></a><span id="l37.84" class="difflineplus">+                    case locale.headAllDayEvent:  args.allDayIndex = i;      knownIndxs++; break;</span>
<a href="#l37.85"></a><span id="l37.85" class="difflineplus">+                    case locale.headAlarm:        args.alarmIndex = i;       knownIndxs++; break;</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+                    case locale.headAlarmDate:    args.alarmDateIndex = i;   knownIndxs++; break;</span>
<a href="#l37.87"></a><span id="l37.87" class="difflineplus">+                    case locale.headAlarmTime:    args.alarmTimeIndex = i;   knownIndxs++; break;</span>
<a href="#l37.88"></a><span id="l37.88" class="difflineplus">+                    case locale.headCategories:   args.categoriesIndex = i;  knownIndxs++; break;</span>
<a href="#l37.89"></a><span id="l37.89" class="difflineplus">+                    case locale.headDescription:  args.descriptionIndex = i; knownIndxs++; break;</span>
<a href="#l37.90"></a><span id="l37.90" class="difflineplus">+                    case locale.headLocation:     args.locationIndex = i;    knownIndxs++; break;</span>
<a href="#l37.91"></a><span id="l37.91" class="difflineplus">+                    case locale.headPrivate:      args.privateIndex = i;     knownIndxs++; break;</span>
<a href="#l37.92"></a><span id="l37.92">                 }</span>
<a href="#l37.93"></a><span id="l37.93">             }</span>
<a href="#l37.94"></a><span id="l37.94" class="difflineplus">+            // Were both mandatory fields recognized?</span>
<a href="#l37.95"></a><span id="l37.95" class="difflineplus">+            if (args.titleIndex != 0 &amp;&amp; args.startDateIndex != 0) {</span>
<a href="#l37.96"></a><span id="l37.96" class="difflineplus">+                break;</span>
<a href="#l37.97"></a><span id="l37.97" class="difflineplus">+            }</span>
<a href="#l37.98"></a><span id="l37.98" class="difflineplus">+        }</span>
<a href="#l37.99"></a><span id="l37.99"> </span>
<a href="#l37.100"></a><span id="l37.100" class="difflineminus">-            if (knownIndxs == 0 &amp;&amp; header.length == 22) {</span>
<a href="#l37.101"></a><span id="l37.101" class="difflineminus">-                // set default indexes for a default Outlook2000 CSV file</span>
<a href="#l37.102"></a><span id="l37.102" class="difflineminus">-                args.titleIndex = 1;</span>
<a href="#l37.103"></a><span id="l37.103" class="difflineminus">-                args.startDateIndex = 2;</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineminus">-                args.startTimeIndex = 3;</span>
<a href="#l37.105"></a><span id="l37.105" class="difflineminus">-                args.endDateIndex = 4;</span>
<a href="#l37.106"></a><span id="l37.106" class="difflineminus">-                args.endTimeIndex = 5;</span>
<a href="#l37.107"></a><span id="l37.107" class="difflineminus">-                args.allDayIndex = 6;</span>
<a href="#l37.108"></a><span id="l37.108" class="difflineminus">-                args.alarmIndex = 7;</span>
<a href="#l37.109"></a><span id="l37.109" class="difflineminus">-                args.alarmDateIndex = 8;</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineminus">-                args.alarmTimeIndex = 9;</span>
<a href="#l37.111"></a><span id="l37.111" class="difflineminus">-                args.categoriesIndex = 15;</span>
<a href="#l37.112"></a><span id="l37.112" class="difflineminus">-                args.descriptionIndex = 16;</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineminus">-                args.locationIndex = 17;</span>
<a href="#l37.114"></a><span id="l37.114" class="difflineminus">-                args.privateIndex = 20;</span>
<a href="#l37.115"></a><span id="l37.115" class="difflineminus">-            }</span>
<a href="#l37.116"></a><span id="l37.116" class="difflineplus">+        if (knownIndxs == 0 &amp;&amp; header.length == 22) {</span>
<a href="#l37.117"></a><span id="l37.117" class="difflineplus">+            // set default indexes for a default Outlook2000 CSV file</span>
<a href="#l37.118"></a><span id="l37.118" class="difflineplus">+            args.titleIndex = 1;</span>
<a href="#l37.119"></a><span id="l37.119" class="difflineplus">+            args.startDateIndex = 2;</span>
<a href="#l37.120"></a><span id="l37.120" class="difflineplus">+            args.startTimeIndex = 3;</span>
<a href="#l37.121"></a><span id="l37.121" class="difflineplus">+            args.endDateIndex = 4;</span>
<a href="#l37.122"></a><span id="l37.122" class="difflineplus">+            args.endTimeIndex = 5;</span>
<a href="#l37.123"></a><span id="l37.123" class="difflineplus">+            args.allDayIndex = 6;</span>
<a href="#l37.124"></a><span id="l37.124" class="difflineplus">+            args.alarmIndex = 7;</span>
<a href="#l37.125"></a><span id="l37.125" class="difflineplus">+            args.alarmDateIndex = 8;</span>
<a href="#l37.126"></a><span id="l37.126" class="difflineplus">+            args.alarmTimeIndex = 9;</span>
<a href="#l37.127"></a><span id="l37.127" class="difflineplus">+            args.categoriesIndex = 15;</span>
<a href="#l37.128"></a><span id="l37.128" class="difflineplus">+            args.descriptionIndex = 16;</span>
<a href="#l37.129"></a><span id="l37.129" class="difflineplus">+            args.locationIndex = 17;</span>
<a href="#l37.130"></a><span id="l37.130" class="difflineplus">+            args.privateIndex = 20;</span>
<a href="#l37.131"></a><span id="l37.131" class="difflineplus">+        }</span>
<a href="#l37.132"></a><span id="l37.132" class="difflineplus">+</span>
<a href="#l37.133"></a><span id="l37.133" class="difflineplus">+        if (args.titleIndex == 0 || args.startDateIndex == 0) {</span>
<a href="#l37.134"></a><span id="l37.134" class="difflineplus">+            dump(&quot;Can't import. Life sucks\n&quot;)</span>
<a href="#l37.135"></a><span id="l37.135" class="difflineplus">+            aCount.value = 0;</span>
<a href="#l37.136"></a><span id="l37.136" class="difflineplus">+            return [];</span>
<a href="#l37.137"></a><span id="l37.137" class="difflineplus">+        }</span>
<a href="#l37.138"></a><span id="l37.138" class="difflineplus">+</span>
<a href="#l37.139"></a><span id="l37.139" class="difflineplus">+        // Construct event regexp according to field indexes. The regexp can</span>
<a href="#l37.140"></a><span id="l37.140" class="difflineplus">+        // be made stricter, if it seems this matches too loosely.</span>
<a href="#l37.141"></a><span id="l37.141" class="difflineplus">+        let regExpStr = &quot;^&quot;;</span>
<a href="#l37.142"></a><span id="l37.142" class="difflineplus">+        for (i = 1; i &lt;= header.length; i++) {</span>
<a href="#l37.143"></a><span id="l37.143" class="difflineplus">+            if (i &gt; 1)</span>
<a href="#l37.144"></a><span id="l37.144" class="difflineplus">+                regExpStr += &quot;,&quot;;</span>
<a href="#l37.145"></a><span id="l37.145" class="difflineplus">+            regExpStr += &quot;(?:\&quot;((?:[^\&quot;]|\&quot;\&quot;)*)\&quot;)?&quot;;</span>
<a href="#l37.146"></a><span id="l37.146" class="difflineplus">+        }</span>
<a href="#l37.147"></a><span id="l37.147" class="difflineplus">+        regExpStr += &quot;$&quot;;</span>
<a href="#l37.148"></a><span id="l37.148"> </span>
<a href="#l37.149"></a><span id="l37.149" class="difflineminus">-            if (args.titleIndex == 0 || args.startDateIndex == 0) {</span>
<a href="#l37.150"></a><span id="l37.150" class="difflineminus">-                dump(&quot;Can't import. Life sucks\n&quot;)</span>
<a href="#l37.151"></a><span id="l37.151" class="difflineminus">-                break parse;</span>
<a href="#l37.152"></a><span id="l37.152" class="difflineminus">-            }</span>
<a href="#l37.153"></a><span id="l37.153" class="difflineplus">+        // eventRegExp: regexp for reading events (this one'll be constructed on fly)</span>
<a href="#l37.154"></a><span id="l37.154" class="difflineplus">+        const eventRegExp = new RegExp(regExpStr, &quot;gm&quot;);</span>
<a href="#l37.155"></a><span id="l37.155" class="difflineplus">+</span>
<a href="#l37.156"></a><span id="l37.156" class="difflineplus">+        // match first line</span>
<a href="#l37.157"></a><span id="l37.157" class="difflineplus">+        let eventFields = eventRegExp.exec(str);</span>
<a href="#l37.158"></a><span id="l37.158" class="difflineplus">+</span>
<a href="#l37.159"></a><span id="l37.159" class="difflineplus">+        if (eventFields == null) {</span>
<a href="#l37.160"></a><span id="l37.160" class="difflineplus">+            aCount.value = 0;</span>
<a href="#l37.161"></a><span id="l37.161" class="difflineplus">+            return [];</span>
<a href="#l37.162"></a><span id="l37.162" class="difflineplus">+        }</span>
<a href="#l37.163"></a><span id="l37.163" class="difflineplus">+</span>
<a href="#l37.164"></a><span id="l37.164" class="difflineplus">+        args.boolStr = localeEn.valueTrue;</span>
<a href="#l37.165"></a><span id="l37.165" class="difflineplus">+        args.boolIsTrue = true;</span>
<a href="#l37.166"></a><span id="l37.166"> </span>
<a href="#l37.167"></a><span id="l37.167" class="difflineminus">-            // Construct event regexp according to field indexes. The regexp can</span>
<a href="#l37.168"></a><span id="l37.168" class="difflineminus">-            // be made stricter, if it seems this matches too loosely.</span>
<a href="#l37.169"></a><span id="l37.169" class="difflineminus">-            let regExpStr = &quot;^&quot;;</span>
<a href="#l37.170"></a><span id="l37.170" class="difflineminus">-            for (i = 1; i &lt;= header.length; i++) {</span>
<a href="#l37.171"></a><span id="l37.171" class="difflineminus">-                if (i &gt; 1)</span>
<a href="#l37.172"></a><span id="l37.172" class="difflineminus">-                    regExpStr += &quot;,&quot;;</span>
<a href="#l37.173"></a><span id="l37.173" class="difflineminus">-                regExpStr += &quot;(?:\&quot;((?:[^\&quot;]|\&quot;\&quot;)*)\&quot;)?&quot;;</span>
<a href="#l37.174"></a><span id="l37.174" class="difflineminus">-            }</span>
<a href="#l37.175"></a><span id="l37.175" class="difflineminus">-            regExpStr += &quot;$&quot;;</span>
<a href="#l37.176"></a><span id="l37.176" class="difflineplus">+        let dateParseConfirmed = false;</span>
<a href="#l37.177"></a><span id="l37.177" class="difflineplus">+        let eventArray = new Array();</span>
<a href="#l37.178"></a><span id="l37.178" class="difflineplus">+        do {</span>
<a href="#l37.179"></a><span id="l37.179" class="difflineplus">+            // At this point eventFields contains following fields. Position</span>
<a href="#l37.180"></a><span id="l37.180" class="difflineplus">+            // of fields is in args.[fieldname]Index.</span>
<a href="#l37.181"></a><span id="l37.181" class="difflineplus">+            //    subject, start date, start time, end date, end time,</span>
<a href="#l37.182"></a><span id="l37.182" class="difflineplus">+            //    all day, alarm on, alarm date, alarm time,</span>
<a href="#l37.183"></a><span id="l37.183" class="difflineplus">+            //    Description, Categories, Location, Private</span>
<a href="#l37.184"></a><span id="l37.184" class="difflineplus">+            // Unused fields (could maybe be copied to Description):</span>
<a href="#l37.185"></a><span id="l37.185" class="difflineplus">+            //    Meeting Organizer, Required Attendees, Optional Attendees,</span>
<a href="#l37.186"></a><span id="l37.186" class="difflineplus">+            //    Meeting Resources, Billing Information, Mileage, Priority,</span>
<a href="#l37.187"></a><span id="l37.187" class="difflineplus">+            //    Sensitivity, Show time as</span>
<a href="#l37.188"></a><span id="l37.188"> </span>
<a href="#l37.189"></a><span id="l37.189" class="difflineminus">-            // eventRegExp: regexp for reading events (this one'll be constructed on fly)</span>
<a href="#l37.190"></a><span id="l37.190" class="difflineminus">-            const eventRegExp = new RegExp(regExpStr, &quot;gm&quot;);</span>
<a href="#l37.191"></a><span id="l37.191" class="difflineminus">-</span>
<a href="#l37.192"></a><span id="l37.192" class="difflineminus">-            // match first line</span>
<a href="#l37.193"></a><span id="l37.193" class="difflineminus">-            let eventFields = eventRegExp.exec(str);</span>
<a href="#l37.194"></a><span id="l37.194" class="difflineminus">-</span>
<a href="#l37.195"></a><span id="l37.195" class="difflineminus">-            if (eventFields == null)</span>
<a href="#l37.196"></a><span id="l37.196" class="difflineminus">-                break parse;</span>
<a href="#l37.197"></a><span id="l37.197" class="difflineplus">+            let title = (&quot;titleIndex&quot; in args</span>
<a href="#l37.198"></a><span id="l37.198" class="difflineplus">+                         ? this.parseTextField(eventFields[args.titleIndex]) : &quot;&quot;);</span>
<a href="#l37.199"></a><span id="l37.199" class="difflineplus">+            let sDate = this.parseDateTime(eventFields[args.startDateIndex],</span>
<a href="#l37.200"></a><span id="l37.200" class="difflineplus">+                                           eventFields[args.startTimeIndex],</span>
<a href="#l37.201"></a><span id="l37.201" class="difflineplus">+                                           locale);</span>
<a href="#l37.202"></a><span id="l37.202" class="difflineplus">+            let eDate = this.parseDateTime(eventFields[args.endDateIndex],</span>
<a href="#l37.203"></a><span id="l37.203" class="difflineplus">+                                           eventFields[args.endTimeIndex],</span>
<a href="#l37.204"></a><span id="l37.204" class="difflineplus">+                                           locale);</span>
<a href="#l37.205"></a><span id="l37.205" class="difflineplus">+            // Create an event only if we have a startDate. No more checks</span>
<a href="#l37.206"></a><span id="l37.206" class="difflineplus">+            // on sDate needed in the following process.</span>
<a href="#l37.207"></a><span id="l37.207" class="difflineplus">+            if (sDate) {</span>
<a href="#l37.208"></a><span id="l37.208" class="difflineplus">+                let event = cal.createEvent();</span>
<a href="#l37.209"></a><span id="l37.209"> </span>
<a href="#l37.210"></a><span id="l37.210" class="difflineminus">-            args.boolStr = localeEn.valueTrue;</span>
<a href="#l37.211"></a><span id="l37.211" class="difflineminus">-            args.boolIsTrue = true;</span>
<a href="#l37.212"></a><span id="l37.212" class="difflineplus">+                // Use column head in brackets if event title misses in data.</span>
<a href="#l37.213"></a><span id="l37.213" class="difflineplus">+                if (title) {</span>
<a href="#l37.214"></a><span id="l37.214" class="difflineplus">+                    event.title = title;</span>
<a href="#l37.215"></a><span id="l37.215" class="difflineplus">+                } else {</span>
<a href="#l37.216"></a><span id="l37.216" class="difflineplus">+                    event.title = &quot;[&quot; + locale.headTitle + &quot;]&quot;;</span>
<a href="#l37.217"></a><span id="l37.217" class="difflineplus">+                }</span>
<a href="#l37.218"></a><span id="l37.218"> </span>
<a href="#l37.219"></a><span id="l37.219" class="difflineminus">-            let dateParseConfirmed = false;</span>
<a href="#l37.220"></a><span id="l37.220" class="difflineminus">-            let eventArray = new Array();</span>
<a href="#l37.221"></a><span id="l37.221" class="difflineminus">-            do {</span>
<a href="#l37.222"></a><span id="l37.222" class="difflineminus">-                // At this point eventFields contains following fields. Position</span>
<a href="#l37.223"></a><span id="l37.223" class="difflineminus">-                // of fields is in args.[fieldname]Index.</span>
<a href="#l37.224"></a><span id="l37.224" class="difflineminus">-                //    subject, start date, start time, end date, end time,</span>
<a href="#l37.225"></a><span id="l37.225" class="difflineminus">-                //    all day, alarm on, alarm date, alarm time,</span>
<a href="#l37.226"></a><span id="l37.226" class="difflineminus">-                //    Description, Categories, Location, Private</span>
<a href="#l37.227"></a><span id="l37.227" class="difflineminus">-                // Unused fields (could maybe be copied to Description):</span>
<a href="#l37.228"></a><span id="l37.228" class="difflineminus">-                //    Meeting Organizer, Required Attendees, Optional Attendees,</span>
<a href="#l37.229"></a><span id="l37.229" class="difflineminus">-                //    Meeting Resources, Billing Information, Mileage, Priority,</span>
<a href="#l37.230"></a><span id="l37.230" class="difflineminus">-                //    Sensitivity, Show time as</span>
<a href="#l37.231"></a><span id="l37.231" class="difflineplus">+                // Check data for all day event. Additionally sDate.isDate</span>
<a href="#l37.232"></a><span id="l37.232" class="difflineplus">+                // may have been set in parseDateTime() if no time was found</span>
<a href="#l37.233"></a><span id="l37.233" class="difflineplus">+                if (eventFields[args.allDayIndex] == locale.valueTrue) {</span>
<a href="#l37.234"></a><span id="l37.234" class="difflineplus">+                    sDate.isDate = true;</span>
<a href="#l37.235"></a><span id="l37.235" class="difflineplus">+                }</span>
<a href="#l37.236"></a><span id="l37.236" class="difflineplus">+                if (locale.valueTrue == eventFields[args.privateIndex]) {</span>
<a href="#l37.237"></a><span id="l37.237" class="difflineplus">+                    event.privacy = &quot;PRIVATE&quot;;</span>
<a href="#l37.238"></a><span id="l37.238" class="difflineplus">+                }</span>
<a href="#l37.239"></a><span id="l37.239"> </span>
<a href="#l37.240"></a><span id="l37.240" class="difflineminus">-                let title = (&quot;titleIndex&quot; in args</span>
<a href="#l37.241"></a><span id="l37.241" class="difflineminus">-                             ? this.parseTextField(eventFields[args.titleIndex]) : &quot;&quot;);</span>
<a href="#l37.242"></a><span id="l37.242" class="difflineminus">-                let sDate = this.parseDateTime(eventFields[args.startDateIndex],</span>
<a href="#l37.243"></a><span id="l37.243" class="difflineminus">-                                               eventFields[args.startTimeIndex],</span>
<a href="#l37.244"></a><span id="l37.244" class="difflineminus">-                                               locale);</span>
<a href="#l37.245"></a><span id="l37.245" class="difflineminus">-                let eDate = this.parseDateTime(eventFields[args.endDateIndex],</span>
<a href="#l37.246"></a><span id="l37.246" class="difflineminus">-                                               eventFields[args.endTimeIndex],</span>
<a href="#l37.247"></a><span id="l37.247" class="difflineminus">-                                               locale);</span>
<a href="#l37.248"></a><span id="l37.248" class="difflineminus">-                // Create an event only if we have a startDate. No more checks</span>
<a href="#l37.249"></a><span id="l37.249" class="difflineminus">-                // on sDate needed in the following process.</span>
<a href="#l37.250"></a><span id="l37.250" class="difflineminus">-                if (sDate) {</span>
<a href="#l37.251"></a><span id="l37.251" class="difflineminus">-                    let event = cal.createEvent();</span>
<a href="#l37.252"></a><span id="l37.252" class="difflineplus">+                if (!eDate) {</span>
<a href="#l37.253"></a><span id="l37.253" class="difflineplus">+                    // No endDate was found. All day events last one day and</span>
<a href="#l37.254"></a><span id="l37.254" class="difflineplus">+                    // timed events last the default length.</span>
<a href="#l37.255"></a><span id="l37.255" class="difflineplus">+                    eDate = sDate.clone();</span>
<a href="#l37.256"></a><span id="l37.256" class="difflineplus">+                    if (sDate.isDate) {</span>
<a href="#l37.257"></a><span id="l37.257" class="difflineplus">+                        // end date is exclusive, so set to next day after start.</span>
<a href="#l37.258"></a><span id="l37.258" class="difflineplus">+                        eDate.day += 1;</span>
<a href="#l37.259"></a><span id="l37.259" class="difflineplus">+                    } else {</span>
<a href="#l37.260"></a><span id="l37.260" class="difflineplus">+                        eDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l37.261"></a><span id="l37.261" class="difflineplus">+                    }</span>
<a href="#l37.262"></a><span id="l37.262" class="difflineplus">+                } else {</span>
<a href="#l37.263"></a><span id="l37.263" class="difflineplus">+                    // An endDate was found.</span>
<a href="#l37.264"></a><span id="l37.264" class="difflineplus">+                    if (sDate.isDate) {</span>
<a href="#l37.265"></a><span id="l37.265" class="difflineplus">+                        // A time part for the startDate is missing or was</span>
<a href="#l37.266"></a><span id="l37.266" class="difflineplus">+                        // not recognized. We have to throw away the endDates</span>
<a href="#l37.267"></a><span id="l37.267" class="difflineplus">+                        // time part too for obtaining a valid event.</span>
<a href="#l37.268"></a><span id="l37.268" class="difflineplus">+                        eDate.isDate = true;</span>
<a href="#l37.269"></a><span id="l37.269" class="difflineplus">+                        // Correct the eDate if duration is less than one day.</span>
<a href="#l37.270"></a><span id="l37.270" class="difflineplus">+                        if (1 &gt; eDate.subtractDate(sDate).days) {</span>
<a href="#l37.271"></a><span id="l37.271" class="difflineplus">+                            eDate = sDate.clone();</span>
<a href="#l37.272"></a><span id="l37.272" class="difflineplus">+                            eDate.day += 1;</span>
<a href="#l37.273"></a><span id="l37.273" class="difflineplus">+                        }</span>
<a href="#l37.274"></a><span id="l37.274" class="difflineplus">+                    } else {</span>
<a href="#l37.275"></a><span id="l37.275" class="difflineplus">+                        // We now have a timed startDate and an endDate. If the</span>
<a href="#l37.276"></a><span id="l37.276" class="difflineplus">+                        // end time is invalid set it to 23:59:00</span>
<a href="#l37.277"></a><span id="l37.277" class="difflineplus">+                        if (eDate.isDate) {</span>
<a href="#l37.278"></a><span id="l37.278" class="difflineplus">+                            eDate.isDate = false;</span>
<a href="#l37.279"></a><span id="l37.279" class="difflineplus">+                            eDate.hour   = 23;</span>
<a href="#l37.280"></a><span id="l37.280" class="difflineplus">+                            eDate.minute = 59;</span>
<a href="#l37.281"></a><span id="l37.281" class="difflineplus">+                        }</span>
<a href="#l37.282"></a><span id="l37.282" class="difflineplus">+                        // Correct the duration to 0 seconds if it is negative.</span>
<a href="#l37.283"></a><span id="l37.283" class="difflineplus">+                        if (eDate.subtractDate(sDate).isNegative ) {</span>
<a href="#l37.284"></a><span id="l37.284" class="difflineplus">+                            eDate = sDate.clone();</span>
<a href="#l37.285"></a><span id="l37.285" class="difflineplus">+                        }</span>
<a href="#l37.286"></a><span id="l37.286" class="difflineplus">+                    }</span>
<a href="#l37.287"></a><span id="l37.287" class="difflineplus">+                }</span>
<a href="#l37.288"></a><span id="l37.288" class="difflineplus">+                event.startDate = sDate;</span>
<a href="#l37.289"></a><span id="l37.289" class="difflineplus">+                event.endDate = eDate;</span>
<a href="#l37.290"></a><span id="l37.290"> </span>
<a href="#l37.291"></a><span id="l37.291" class="difflineminus">-                    // Use column head in brackets if event title misses in data.</span>
<a href="#l37.292"></a><span id="l37.292" class="difflineminus">-                    if (title) {</span>
<a href="#l37.293"></a><span id="l37.293" class="difflineminus">-                        event.title = title;</span>
<a href="#l37.294"></a><span id="l37.294" class="difflineminus">-                    } else {</span>
<a href="#l37.295"></a><span id="l37.295" class="difflineminus">-                        event.title = &quot;[&quot; + locale.headTitle + &quot;]&quot;;</span>
<a href="#l37.296"></a><span id="l37.296" class="difflineplus">+                // Exists an alarm true/false column?</span>
<a href="#l37.297"></a><span id="l37.297" class="difflineplus">+                if (&quot;alarmIndex&quot; in args) {</span>
<a href="#l37.298"></a><span id="l37.298" class="difflineplus">+                    // Is an alarm wanted for this event?</span>
<a href="#l37.299"></a><span id="l37.299" class="difflineplus">+                    if (locale.valueTrue == eventFields[args.alarmIndex]) {</span>
<a href="#l37.300"></a><span id="l37.300" class="difflineplus">+                        let alarmDate =</span>
<a href="#l37.301"></a><span id="l37.301" class="difflineplus">+                                this.parseDateTime(eventFields[args.alarmDateIndex],</span>
<a href="#l37.302"></a><span id="l37.302" class="difflineplus">+                                                   eventFields[args.alarmTimeIndex],</span>
<a href="#l37.303"></a><span id="l37.303" class="difflineplus">+                                                   locale);</span>
<a href="#l37.304"></a><span id="l37.304" class="difflineplus">+                        // Only set the alarm if a date was parsed</span>
<a href="#l37.305"></a><span id="l37.305" class="difflineplus">+                        if (alarmDate) {</span>
<a href="#l37.306"></a><span id="l37.306" class="difflineplus">+                            let alarm = cal.createAlarm();</span>
<a href="#l37.307"></a><span id="l37.307" class="difflineplus">+                            alarm.related = alarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l37.308"></a><span id="l37.308" class="difflineplus">+                            alarm.alarmDate = alarmDate;</span>
<a href="#l37.309"></a><span id="l37.309" class="difflineplus">+                            event.addAlarm(alarm);</span>
<a href="#l37.310"></a><span id="l37.310" class="difflineplus">+                        } else {</span>
<a href="#l37.311"></a><span id="l37.311" class="difflineplus">+                            // XXX Is this really wanted here?</span>
<a href="#l37.312"></a><span id="l37.312" class="difflineplus">+                            cal.alarms.setDefaultValues(event);</span>
<a href="#l37.313"></a><span id="l37.313" class="difflineplus">+                        }</span>
<a href="#l37.314"></a><span id="l37.314">                     }</span>
<a href="#l37.315"></a><span id="l37.315" class="difflineplus">+                }</span>
<a href="#l37.316"></a><span id="l37.316"> </span>
<a href="#l37.317"></a><span id="l37.317" class="difflineminus">-                    // Check data for all day event. Additionally sDate.isDate</span>
<a href="#l37.318"></a><span id="l37.318" class="difflineminus">-                    // may have been set in parseDateTime() if no time was found</span>
<a href="#l37.319"></a><span id="l37.319" class="difflineminus">-                    if (eventFields[args.allDayIndex] == locale.valueTrue) {</span>
<a href="#l37.320"></a><span id="l37.320" class="difflineminus">-                        sDate.isDate = true;</span>
<a href="#l37.321"></a><span id="l37.321" class="difflineminus">-                    }</span>
<a href="#l37.322"></a><span id="l37.322" class="difflineplus">+                // Using the &quot;Private&quot; field only for getting privacy status.</span>
<a href="#l37.323"></a><span id="l37.323" class="difflineplus">+                // &quot;Sensitivity&quot; is neglected for now.</span>
<a href="#l37.324"></a><span id="l37.324" class="difflineplus">+                if (&quot;privateIndex&quot; in args) {</span>
<a href="#l37.325"></a><span id="l37.325">                     if (locale.valueTrue == eventFields[args.privateIndex]) {</span>
<a href="#l37.326"></a><span id="l37.326">                         event.privacy = &quot;PRIVATE&quot;;</span>
<a href="#l37.327"></a><span id="l37.327">                     }</span>
<a href="#l37.328"></a><span id="l37.328" class="difflineminus">-</span>
<a href="#l37.329"></a><span id="l37.329" class="difflineminus">-                    if (!eDate) {</span>
<a href="#l37.330"></a><span id="l37.330" class="difflineminus">-                        // No endDate was found. All day events last one day and</span>
<a href="#l37.331"></a><span id="l37.331" class="difflineminus">-                        // timed events last the default length.</span>
<a href="#l37.332"></a><span id="l37.332" class="difflineminus">-                        eDate = sDate.clone();</span>
<a href="#l37.333"></a><span id="l37.333" class="difflineminus">-                        if (sDate.isDate) {</span>
<a href="#l37.334"></a><span id="l37.334" class="difflineminus">-                            // end date is exclusive, so set to next day after start.</span>
<a href="#l37.335"></a><span id="l37.335" class="difflineminus">-                            eDate.day += 1;</span>
<a href="#l37.336"></a><span id="l37.336" class="difflineminus">-                        } else {</span>
<a href="#l37.337"></a><span id="l37.337" class="difflineminus">-                            eDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l37.338"></a><span id="l37.338" class="difflineminus">-                        }</span>
<a href="#l37.339"></a><span id="l37.339" class="difflineminus">-                    } else {</span>
<a href="#l37.340"></a><span id="l37.340" class="difflineminus">-                        // An endDate was found.</span>
<a href="#l37.341"></a><span id="l37.341" class="difflineminus">-                        if (sDate.isDate) {</span>
<a href="#l37.342"></a><span id="l37.342" class="difflineminus">-                            // A time part for the startDate is missing or was</span>
<a href="#l37.343"></a><span id="l37.343" class="difflineminus">-                            // not recognized. We have to throw away the endDates</span>
<a href="#l37.344"></a><span id="l37.344" class="difflineminus">-                            // time part too for obtaining a valid event.</span>
<a href="#l37.345"></a><span id="l37.345" class="difflineminus">-                            eDate.isDate = true;</span>
<a href="#l37.346"></a><span id="l37.346" class="difflineminus">-                            // Correct the eDate if duration is less than one day.</span>
<a href="#l37.347"></a><span id="l37.347" class="difflineminus">-                            if (1 &gt; eDate.subtractDate(sDate).days) {</span>
<a href="#l37.348"></a><span id="l37.348" class="difflineminus">-                                eDate = sDate.clone();</span>
<a href="#l37.349"></a><span id="l37.349" class="difflineminus">-                                eDate.day += 1;</span>
<a href="#l37.350"></a><span id="l37.350" class="difflineminus">-                            }</span>
<a href="#l37.351"></a><span id="l37.351" class="difflineminus">-                        } else {</span>
<a href="#l37.352"></a><span id="l37.352" class="difflineminus">-                            // We now have a timed startDate and an endDate. If the</span>
<a href="#l37.353"></a><span id="l37.353" class="difflineminus">-                            // end time is invalid set it to 23:59:00</span>
<a href="#l37.354"></a><span id="l37.354" class="difflineminus">-                            if (eDate.isDate) {</span>
<a href="#l37.355"></a><span id="l37.355" class="difflineminus">-                                eDate.isDate = false;</span>
<a href="#l37.356"></a><span id="l37.356" class="difflineminus">-                                eDate.hour   = 23;</span>
<a href="#l37.357"></a><span id="l37.357" class="difflineminus">-                                eDate.minute = 59;</span>
<a href="#l37.358"></a><span id="l37.358" class="difflineminus">-                            }</span>
<a href="#l37.359"></a><span id="l37.359" class="difflineminus">-                            // Correct the duration to 0 seconds if it is negative.</span>
<a href="#l37.360"></a><span id="l37.360" class="difflineminus">-                            if (eDate.subtractDate(sDate).isNegative ) {</span>
<a href="#l37.361"></a><span id="l37.361" class="difflineminus">-                                eDate = sDate.clone();</span>
<a href="#l37.362"></a><span id="l37.362" class="difflineminus">-                            }</span>
<a href="#l37.363"></a><span id="l37.363" class="difflineminus">-                        }</span>
<a href="#l37.364"></a><span id="l37.364" class="difflineminus">-                    }</span>
<a href="#l37.365"></a><span id="l37.365" class="difflineminus">-                    event.startDate = sDate;</span>
<a href="#l37.366"></a><span id="l37.366" class="difflineminus">-                    event.endDate = eDate;</span>
<a href="#l37.367"></a><span id="l37.367" class="difflineminus">-</span>
<a href="#l37.368"></a><span id="l37.368" class="difflineminus">-                    // Exists an alarm true/false column?</span>
<a href="#l37.369"></a><span id="l37.369" class="difflineminus">-                    if (&quot;alarmIndex&quot; in args) {</span>
<a href="#l37.370"></a><span id="l37.370" class="difflineminus">-                        // Is an alarm wanted for this event?</span>
<a href="#l37.371"></a><span id="l37.371" class="difflineminus">-                        if (locale.valueTrue == eventFields[args.alarmIndex]) {</span>
<a href="#l37.372"></a><span id="l37.372" class="difflineminus">-                            let alarmDate =</span>
<a href="#l37.373"></a><span id="l37.373" class="difflineminus">-                                    this.parseDateTime(eventFields[args.alarmDateIndex],</span>
<a href="#l37.374"></a><span id="l37.374" class="difflineminus">-                                                       eventFields[args.alarmTimeIndex],</span>
<a href="#l37.375"></a><span id="l37.375" class="difflineminus">-                                                       locale);</span>
<a href="#l37.376"></a><span id="l37.376" class="difflineminus">-                            // Only set the alarm if a date was parsed</span>
<a href="#l37.377"></a><span id="l37.377" class="difflineminus">-                            if (alarmDate) {</span>
<a href="#l37.378"></a><span id="l37.378" class="difflineminus">-                                let alarm = cal.createAlarm();</span>
<a href="#l37.379"></a><span id="l37.379" class="difflineminus">-                                alarm.related = alarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l37.380"></a><span id="l37.380" class="difflineminus">-                                alarm.alarmDate = alarmDate;</span>
<a href="#l37.381"></a><span id="l37.381" class="difflineminus">-                                event.addAlarm(alarm);</span>
<a href="#l37.382"></a><span id="l37.382" class="difflineminus">-                            } else {</span>
<a href="#l37.383"></a><span id="l37.383" class="difflineminus">-                                // XXX Is this really wanted here?</span>
<a href="#l37.384"></a><span id="l37.384" class="difflineminus">-                                cal.alarms.setDefaultValues(event);</span>
<a href="#l37.385"></a><span id="l37.385" class="difflineminus">-                            }</span>
<a href="#l37.386"></a><span id="l37.386" class="difflineminus">-                        }</span>
<a href="#l37.387"></a><span id="l37.387" class="difflineminus">-                    }</span>
<a href="#l37.388"></a><span id="l37.388" class="difflineminus">-</span>
<a href="#l37.389"></a><span id="l37.389" class="difflineminus">-                    // Using the &quot;Private&quot; field only for getting privacy status.</span>
<a href="#l37.390"></a><span id="l37.390" class="difflineminus">-                    // &quot;Sensitivity&quot; is neglected for now.</span>
<a href="#l37.391"></a><span id="l37.391" class="difflineminus">-                    if (&quot;privateIndex&quot; in args) {</span>
<a href="#l37.392"></a><span id="l37.392" class="difflineminus">-                        if (locale.valueTrue == eventFields[args.privateIndex]) {</span>
<a href="#l37.393"></a><span id="l37.393" class="difflineminus">-                            event.privacy = &quot;PRIVATE&quot;;</span>
<a href="#l37.394"></a><span id="l37.394" class="difflineminus">-                        }</span>
<a href="#l37.395"></a><span id="l37.395" class="difflineminus">-                    }</span>
<a href="#l37.396"></a><span id="l37.396" class="difflineminus">-</span>
<a href="#l37.397"></a><span id="l37.397" class="difflineminus">-                    // Avoid setting empty properties</span>
<a href="#l37.398"></a><span id="l37.398" class="difflineminus">-                    let txt = &quot;&quot;;</span>
<a href="#l37.399"></a><span id="l37.399" class="difflineminus">-                    if (&quot;descriptionIndex&quot; in args) {</span>
<a href="#l37.400"></a><span id="l37.400" class="difflineminus">-                        txt = this.parseTextField(eventFields[args.descriptionIndex])</span>
<a href="#l37.401"></a><span id="l37.401" class="difflineminus">-                        if (txt) {</span>
<a href="#l37.402"></a><span id="l37.402" class="difflineminus">-                            event.setProperty(&quot;DESCRIPTION&quot;, txt);</span>
<a href="#l37.403"></a><span id="l37.403" class="difflineminus">-                        }</span>
<a href="#l37.404"></a><span id="l37.404" class="difflineminus">-                    }</span>
<a href="#l37.405"></a><span id="l37.405" class="difflineminus">-                    if (&quot;categoriesIndex&quot; in args) {</span>
<a href="#l37.406"></a><span id="l37.406" class="difflineminus">-                        txt = this.parseTextField(eventFields[args.categoriesIndex])</span>
<a href="#l37.407"></a><span id="l37.407" class="difflineminus">-                        if (txt) {</span>
<a href="#l37.408"></a><span id="l37.408" class="difflineminus">-                            let categories = cal.categoriesStringToArray(txt);</span>
<a href="#l37.409"></a><span id="l37.409" class="difflineminus">-                            event.setCategories(categories.length, categories);</span>
<a href="#l37.410"></a><span id="l37.410" class="difflineminus">-                        }</span>
<a href="#l37.411"></a><span id="l37.411" class="difflineminus">-                    }</span>
<a href="#l37.412"></a><span id="l37.412" class="difflineminus">-                    if (&quot;locationIndex&quot; in args) {</span>
<a href="#l37.413"></a><span id="l37.413" class="difflineminus">-                        txt = this.parseTextField(eventFields[args.locationIndex])</span>
<a href="#l37.414"></a><span id="l37.414" class="difflineminus">-                        if (txt) {</span>
<a href="#l37.415"></a><span id="l37.415" class="difflineminus">-                            event.setProperty(&quot;LOCATION&quot;, txt);</span>
<a href="#l37.416"></a><span id="l37.416" class="difflineminus">-                        }</span>
<a href="#l37.417"></a><span id="l37.417" class="difflineminus">-                    }</span>
<a href="#l37.418"></a><span id="l37.418" class="difflineminus">-</span>
<a href="#l37.419"></a><span id="l37.419" class="difflineminus">-                    //save the event into return array</span>
<a href="#l37.420"></a><span id="l37.420" class="difflineminus">-                    eventArray.push(event);</span>
<a href="#l37.421"></a><span id="l37.421">                 }</span>
<a href="#l37.422"></a><span id="l37.422"> </span>
<a href="#l37.423"></a><span id="l37.423" class="difflineminus">-                //get next events fields</span>
<a href="#l37.424"></a><span id="l37.424" class="difflineminus">-                eventFields = eventRegExp.exec(str);</span>
<a href="#l37.425"></a><span id="l37.425" class="difflineminus">-</span>
<a href="#l37.426"></a><span id="l37.426" class="difflineminus">-            } while (eventRegExp.lastIndex != 0);</span>
<a href="#l37.427"></a><span id="l37.427" class="difflineplus">+                // Avoid setting empty properties</span>
<a href="#l37.428"></a><span id="l37.428" class="difflineplus">+                let txt = &quot;&quot;;</span>
<a href="#l37.429"></a><span id="l37.429" class="difflineplus">+                if (&quot;descriptionIndex&quot; in args) {</span>
<a href="#l37.430"></a><span id="l37.430" class="difflineplus">+                    txt = this.parseTextField(eventFields[args.descriptionIndex])</span>
<a href="#l37.431"></a><span id="l37.431" class="difflineplus">+                    if (txt) {</span>
<a href="#l37.432"></a><span id="l37.432" class="difflineplus">+                        event.setProperty(&quot;DESCRIPTION&quot;, txt);</span>
<a href="#l37.433"></a><span id="l37.433" class="difflineplus">+                    }</span>
<a href="#l37.434"></a><span id="l37.434" class="difflineplus">+                }</span>
<a href="#l37.435"></a><span id="l37.435" class="difflineplus">+                if (&quot;categoriesIndex&quot; in args) {</span>
<a href="#l37.436"></a><span id="l37.436" class="difflineplus">+                    txt = this.parseTextField(eventFields[args.categoriesIndex])</span>
<a href="#l37.437"></a><span id="l37.437" class="difflineplus">+                    if (txt) {</span>
<a href="#l37.438"></a><span id="l37.438" class="difflineplus">+                        let categories = cal.categoriesStringToArray(txt);</span>
<a href="#l37.439"></a><span id="l37.439" class="difflineplus">+                        event.setCategories(categories.length, categories);</span>
<a href="#l37.440"></a><span id="l37.440" class="difflineplus">+                    }</span>
<a href="#l37.441"></a><span id="l37.441" class="difflineplus">+                }</span>
<a href="#l37.442"></a><span id="l37.442" class="difflineplus">+                if (&quot;locationIndex&quot; in args) {</span>
<a href="#l37.443"></a><span id="l37.443" class="difflineplus">+                    txt = this.parseTextField(eventFields[args.locationIndex])</span>
<a href="#l37.444"></a><span id="l37.444" class="difflineplus">+                    if (txt) {</span>
<a href="#l37.445"></a><span id="l37.445" class="difflineplus">+                        event.setProperty(&quot;LOCATION&quot;, txt);</span>
<a href="#l37.446"></a><span id="l37.446" class="difflineplus">+                    }</span>
<a href="#l37.447"></a><span id="l37.447" class="difflineplus">+                }</span>
<a href="#l37.448"></a><span id="l37.448"> </span>
<a href="#l37.449"></a><span id="l37.449" class="difflineminus">-            // return results</span>
<a href="#l37.450"></a><span id="l37.450" class="difflineminus">-            aCount.value = eventArray.length;</span>
<a href="#l37.451"></a><span id="l37.451" class="difflineminus">-            return eventArray;</span>
<a href="#l37.452"></a><span id="l37.452" class="difflineplus">+                //save the event into return array</span>
<a href="#l37.453"></a><span id="l37.453" class="difflineplus">+                eventArray.push(event);</span>
<a href="#l37.454"></a><span id="l37.454" class="difflineplus">+            }</span>
<a href="#l37.455"></a><span id="l37.455"> </span>
<a href="#l37.456"></a><span id="l37.456" class="difflineminus">-        } // end parse</span>
<a href="#l37.457"></a><span id="l37.457" class="difflineplus">+            //get next events fields</span>
<a href="#l37.458"></a><span id="l37.458" class="difflineplus">+            eventFields = eventRegExp.exec(str);</span>
<a href="#l37.459"></a><span id="l37.459"> </span>
<a href="#l37.460"></a><span id="l37.460" class="difflineminus">-        // The parse was cancelled, return an empty array of events.</span>
<a href="#l37.461"></a><span id="l37.461" class="difflineminus">-        aCount.value = 0;</span>
<a href="#l37.462"></a><span id="l37.462" class="difflineminus">-        return [];</span>
<a href="#l37.463"></a><span id="l37.463" class="difflineplus">+        } while (eventRegExp.lastIndex != 0);</span>
<a href="#l37.464"></a><span id="l37.464" class="difflineplus">+</span>
<a href="#l37.465"></a><span id="l37.465" class="difflineplus">+        // return results</span>
<a href="#l37.466"></a><span id="l37.466" class="difflineplus">+        aCount.value = eventArray.length;</span>
<a href="#l37.467"></a><span id="l37.467" class="difflineplus">+        return eventArray;</span>
<a href="#l37.468"></a><span id="l37.468">     },</span>
<a href="#l37.469"></a><span id="l37.469"> </span>
<a href="#l37.470"></a><span id="l37.470">     parseDateTime: function parseDateTime(aDate, aTime, aLocale) {</span>
<a href="#l37.471"></a><span id="l37.471">         let dt = cal.createDateTime();</span>
<a href="#l37.472"></a><span id="l37.472"> </span>
<a href="#l37.473"></a><span id="l37.473">         //XXX Can we do better?</span>
<a href="#l37.474"></a><span id="l37.474">         dt.timezone = cal.floating();</span>
<a href="#l37.475"></a><span id="l37.475"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -4,16 +4,17 @@</span>
<a href="#l38.4"></a><span id="l38.4"> </span>
<a href="#l38.5"></a><span id="l38.5"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l38.6"></a><span id="l38.6"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> var CI = Components.interfaces;</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10"> var ITIP_HANDLER_MIMETYPE = &quot;application/x-itip-internal&quot;;</span>
<a href="#l38.11"></a><span id="l38.11"> var ITIP_HANDLER_PROTOCOL = &quot;moz-cal-handle-itip&quot;;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+var NS_ERROR_WONT_HANDLE_CONTENT = 0x805d0001;</span>
<a href="#l38.13"></a><span id="l38.13"> </span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15"> function NYI() {</span>
<a href="#l38.16"></a><span id="l38.16">     throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l38.17"></a><span id="l38.17"> }</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19"> function ItipChannel(URI) {</span>
<a href="#l38.20"></a><span id="l38.20">    this.URI = this.originalURI = URI;</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -35,25 +36,25 @@ ItipChannel.prototype = {</span>
<a href="#l38.22"></a><span id="l38.22"> </span>
<a href="#l38.23"></a><span id="l38.23">     contentType: ITIP_HANDLER_MIMETYPE,</span>
<a href="#l38.24"></a><span id="l38.24">     loadAttributes: null,</span>
<a href="#l38.25"></a><span id="l38.25">     contentLength: 0,</span>
<a href="#l38.26"></a><span id="l38.26">     owner: null,</span>
<a href="#l38.27"></a><span id="l38.27">     loadGroup: null,</span>
<a href="#l38.28"></a><span id="l38.28">     notificationCallbacks: null,</span>
<a href="#l38.29"></a><span id="l38.29">     securityInfo: null,</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-    </span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+</span>
<a href="#l38.32"></a><span id="l38.32">     open: NYI,</span>
<a href="#l38.33"></a><span id="l38.33">     asyncOpen: function (observer, ctxt) {</span>
<a href="#l38.34"></a><span id="l38.34">         observer.onStartRequest(this, ctxt);</span>
<a href="#l38.35"></a><span id="l38.35">     },</span>
<a href="#l38.36"></a><span id="l38.36">     asyncRead: function (listener, ctxt) {</span>
<a href="#l38.37"></a><span id="l38.37">         return listener.onStartRequest(this, ctxt);</span>
<a href="#l38.38"></a><span id="l38.38">     },</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-    </span>
<a href="#l38.40"></a><span id="l38.40" class="difflineplus">+</span>
<a href="#l38.41"></a><span id="l38.41">     isPending: function () { return true; },</span>
<a href="#l38.42"></a><span id="l38.42">     status: Components.results.NS_OK,</span>
<a href="#l38.43"></a><span id="l38.43">     cancel: function (status) { this.status = status; },</span>
<a href="#l38.44"></a><span id="l38.44">     suspend: NYI,</span>
<a href="#l38.45"></a><span id="l38.45">     resume: NYI,</span>
<a href="#l38.46"></a><span id="l38.46"> };</span>
<a href="#l38.47"></a><span id="l38.47"> </span>
<a href="#l38.48"></a><span id="l38.48"> function ItipProtocolHandler() {</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineat">@@ -76,17 +77,17 @@ ItipProtocolHandler.prototype = {</span>
<a href="#l38.50"></a><span id="l38.50">     isSecure: false,</span>
<a href="#l38.51"></a><span id="l38.51">     newURI: function (spec, charSet, baseURI) {</span>
<a href="#l38.52"></a><span id="l38.52">         let cls = Components.classes[&quot;@mozilla.org/network/standard-url;1&quot;];</span>
<a href="#l38.53"></a><span id="l38.53">         let url = cls.createInstance(CI.nsIStandardURL);</span>
<a href="#l38.54"></a><span id="l38.54">         url.init(CI.nsIStandardURL.URLTYPE_STANDARD, 0, spec, charSet, baseURI);</span>
<a href="#l38.55"></a><span id="l38.55">         dump(&quot;Creating new URI for &quot; + spec + &quot;\n&quot;);</span>
<a href="#l38.56"></a><span id="l38.56">         return url.QueryInterface(CI.nsIURI);</span>
<a href="#l38.57"></a><span id="l38.57">     },</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineminus">-    </span>
<a href="#l38.59"></a><span id="l38.59" class="difflineplus">+</span>
<a href="#l38.60"></a><span id="l38.60">     newChannel: function (URI) {</span>
<a href="#l38.61"></a><span id="l38.61">         return this.newChannel2(URI, null);</span>
<a href="#l38.62"></a><span id="l38.62">     },</span>
<a href="#l38.63"></a><span id="l38.63"> </span>
<a href="#l38.64"></a><span id="l38.64">     newChannel2: function(URI, aLoadInfo)</span>
<a href="#l38.65"></a><span id="l38.65">     {</span>
<a href="#l38.66"></a><span id="l38.66">         dump(&quot;Creating new ItipChannel for &quot; + URI + &quot;\n&quot;);</span>
<a href="#l38.67"></a><span id="l38.67">         return new ItipChannel(URI);</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineat">@@ -108,17 +109,17 @@ ItipContentHandler.prototype = {</span>
<a href="#l38.69"></a><span id="l38.69">         interfaces: ItipContentHandlerInterfaces</span>
<a href="#l38.70"></a><span id="l38.70">     }),</span>
<a href="#l38.71"></a><span id="l38.71"> </span>
<a href="#l38.72"></a><span id="l38.72">     handleContent: function (contentType, windowTarget, request) {</span>
<a href="#l38.73"></a><span id="l38.73">         let channel = request.QueryInterface(CI.nsIChannel);</span>
<a href="#l38.74"></a><span id="l38.74">         let uri = channel.URI.spec;</span>
<a href="#l38.75"></a><span id="l38.75">         if (!uri.startsWith(ITIP_HANDLER_PROTOCOL + &quot;:&quot;)) {</span>
<a href="#l38.76"></a><span id="l38.76">             cal.ERROR(&quot;Unexpected iTIP uri: &quot; + uri + &quot;\n&quot;);</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineminus">-            return Components.results.NS_ERROR_FAILURE;</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineplus">+            throw NS_ERROR_WONT_HANDLE_CONTENT;</span>
<a href="#l38.79"></a><span id="l38.79">         }</span>
<a href="#l38.80"></a><span id="l38.80">         // moz-cal-handle-itip:///?</span>
<a href="#l38.81"></a><span id="l38.81">         let paramString = uri.substring(ITIP_HANDLER_PROTOCOL.length + 4);</span>
<a href="#l38.82"></a><span id="l38.82">         let paramArray = paramString.split(&quot;&amp;&quot;);</span>
<a href="#l38.83"></a><span id="l38.83">         let paramBlock = { };</span>
<a href="#l38.84"></a><span id="l38.84">         paramArray.forEach(function (v) {</span>
<a href="#l38.85"></a><span id="l38.85">             let parts = v.split(&quot;=&quot;);</span>
<a href="#l38.86"></a><span id="l38.86">             paramBlock[parts[0]] = unescape(unescape(parts[1]));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1078,17 +1078,17 @@ calDavCalendar.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">         // that pass paths like /dav/user/Calendar while</span>
<a href="#l39.5"></a><span id="l39.5">         // the request uri is like /dav/user@example.org/Calendar.</span>
<a href="#l39.6"></a><span id="l39.6">         let resPathComponents = path.split(&quot;/&quot;);</span>
<a href="#l39.7"></a><span id="l39.7">         resPathComponents.splice(0, uriPathComponentLength - 1);</span>
<a href="#l39.8"></a><span id="l39.8">         let locationPath = resPathComponents.join(&quot;/&quot;);</span>
<a href="#l39.9"></a><span id="l39.9">         let isInboxItem = this.isInbox(aUri.spec);</span>
<a href="#l39.10"></a><span id="l39.10">         let self = this;</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-        Task.spawn(function*() {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+        Task.spawn(function* () {</span>
<a href="#l39.14"></a><span id="l39.14">             if (self.mHrefIndex[path] &amp;&amp;</span>
<a href="#l39.15"></a><span id="l39.15">                 !self.mItemInfoCache[item.id]) {</span>
<a href="#l39.16"></a><span id="l39.16">                 // If we get here it means a meeting has kept the same filename</span>
<a href="#l39.17"></a><span id="l39.17">                 // but changed its uid, which can happen server side.</span>
<a href="#l39.18"></a><span id="l39.18">                 // Delete the meeting before re-adding it</span>
<a href="#l39.19"></a><span id="l39.19">                 self.deleteTargetCalendarItem(path);</span>
<a href="#l39.20"></a><span id="l39.20">             }</span>
<a href="#l39.21"></a><span id="l39.21"> </span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -1146,17 +1146,17 @@ calDavCalendar.prototype = {</span>
<a href="#l39.23"></a><span id="l39.23">         });</span>
<a href="#l39.24"></a><span id="l39.24">     },</span>
<a href="#l39.25"></a><span id="l39.25"> </span>
<a href="#l39.26"></a><span id="l39.26">     /**</span>
<a href="#l39.27"></a><span id="l39.27">      * Deletes an item from the target calendar</span>
<a href="#l39.28"></a><span id="l39.28">      *</span>
<a href="#l39.29"></a><span id="l39.29">      * @param path Path of the item to delete, must not be encoded</span>
<a href="#l39.30"></a><span id="l39.30">      */</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-    deleteTargetCalendarItem: Task.async(function*(path) {</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+    deleteTargetCalendarItem: Task.async(function* (path) {</span>
<a href="#l39.33"></a><span id="l39.33">         let pcal = cal.async.promisifyCalendar(this.mOfflineStorage);</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35">         let foundItem = (yield pcal.getItem(this.mHrefIndex[path]))[0];</span>
<a href="#l39.36"></a><span id="l39.36">         let wasInboxItem = this.mItemInfoCache[foundItem.id].isInboxItem;</span>
<a href="#l39.37"></a><span id="l39.37">         if ((wasInboxItem &amp;&amp; this.isInbox(path)) ||</span>
<a href="#l39.38"></a><span id="l39.38">             (wasInboxItem === false &amp;&amp; !this.isInbox(path))) {</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40">             cal.LOG(&quot;CalDAV: deleting item: &quot; + path + &quot;, uid: &quot; + foundItem.id);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -78,17 +78,17 @@ etagsHandler.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">             if (this.calendar.isCached &amp;&amp; this.changeLogListener) {</span>
<a href="#l40.5"></a><span id="l40.5">                 this.changeLogListener.onResult({ status: Components.results.NS_ERROR_FAILURE },</span>
<a href="#l40.6"></a><span id="l40.6">                                                 Components.results.NS_ERROR_FAILURE);</span>
<a href="#l40.7"></a><span id="l40.7">             }</span>
<a href="#l40.8"></a><span id="l40.8">             this._reader = null;</span>
<a href="#l40.9"></a><span id="l40.9">         }</span>
<a href="#l40.10"></a><span id="l40.10">     },</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-    onStopRequest: Task.async(function*(request, context, statusCode) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+    onStopRequest: Task.async(function* (request, context, statusCode) {</span>
<a href="#l40.14"></a><span id="l40.14">         if (this.calendar.verboseLogging()) {</span>
<a href="#l40.15"></a><span id="l40.15">             cal.LOG(&quot;CalDAV: recv: &quot; + this.logXML);</span>
<a href="#l40.16"></a><span id="l40.16">         }</span>
<a href="#l40.17"></a><span id="l40.17">         if (!this._reader) {</span>
<a href="#l40.18"></a><span id="l40.18">             // No reader means there was a request error</span>
<a href="#l40.19"></a><span id="l40.19">             return;</span>
<a href="#l40.20"></a><span id="l40.20">         }</span>
<a href="#l40.21"></a><span id="l40.21">         try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -103,20 +103,20 @@ calMemoryCalendar.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">     // readonly attribute AUTF8String type;</span>
<a href="#l41.5"></a><span id="l41.5">     get type() { return &quot;memory&quot;; },</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7">     // void addItem( in calIItemBase aItem, in calIOperationListener aListener );</span>
<a href="#l41.8"></a><span id="l41.8">     addItem: function (aItem, aListener) {</span>
<a href="#l41.9"></a><span id="l41.9">         var newItem = aItem.clone();</span>
<a href="#l41.10"></a><span id="l41.10">         return this.adoptItem(newItem, aListener);</span>
<a href="#l41.11"></a><span id="l41.11">     },</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    </span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+</span>
<a href="#l41.14"></a><span id="l41.14">     // void adoptItem( in calIItemBase aItem, in calIOperationListener aListener );</span>
<a href="#l41.15"></a><span id="l41.15">     adoptItem: function (aItem, aListener) {</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineminus">-        if (this.readOnly) </span>
<a href="#l41.17"></a><span id="l41.17" class="difflineplus">+        if (this.readOnly)</span>
<a href="#l41.18"></a><span id="l41.18">             throw Components.interfaces.calIErrors.CAL_IS_READONLY;</span>
<a href="#l41.19"></a><span id="l41.19">         if (aItem.id == null &amp;&amp; aItem.isMutable)</span>
<a href="#l41.20"></a><span id="l41.20">             aItem.id = cal.getUUID();</span>
<a href="#l41.21"></a><span id="l41.21"> </span>
<a href="#l41.22"></a><span id="l41.22">         if (aItem.id == null) {</span>
<a href="#l41.23"></a><span id="l41.23">             this.notifyOperationComplete(aListener,</span>
<a href="#l41.24"></a><span id="l41.24">                                          Components.results.NS_ERROR_FAILURE,</span>
<a href="#l41.25"></a><span id="l41.25">                                          Components.interfaces.calIOperationListener.ADD,</span>
<a href="#l41.26"></a><span id="l41.26" class="difflineat">@@ -160,17 +160,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l41.27"></a><span id="l41.27">                                      aItem.id,</span>
<a href="#l41.28"></a><span id="l41.28">                                      aItem);</span>
<a href="#l41.29"></a><span id="l41.29">         // notify observers</span>
<a href="#l41.30"></a><span id="l41.30">         this.mObservers.notify(&quot;onAddItem&quot;, [aItem]);</span>
<a href="#l41.31"></a><span id="l41.31">     },</span>
<a href="#l41.32"></a><span id="l41.32"> </span>
<a href="#l41.33"></a><span id="l41.33">     // void modifyItem( in calIItemBase aNewItem, in calIItemBase aOldItem, in calIOperationListener aListener );</span>
<a href="#l41.34"></a><span id="l41.34">     modifyItem: function (aNewItem, aOldItem, aListener) {</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineminus">-        if (this.readOnly) </span>
<a href="#l41.36"></a><span id="l41.36" class="difflineplus">+        if (this.readOnly)</span>
<a href="#l41.37"></a><span id="l41.37">             throw Components.interfaces.calIErrors.CAL_IS_READONLY;</span>
<a href="#l41.38"></a><span id="l41.38">         if (!aNewItem) {</span>
<a href="#l41.39"></a><span id="l41.39">             throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l41.40"></a><span id="l41.40">         }</span>
<a href="#l41.41"></a><span id="l41.41"> </span>
<a href="#l41.42"></a><span id="l41.42">         var this_ = this;</span>
<a href="#l41.43"></a><span id="l41.43">         function reportError(errStr, errId) {</span>
<a href="#l41.44"></a><span id="l41.44">             this_.notifyOperationComplete(aListener,</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineat">@@ -279,17 +279,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l41.46"></a><span id="l41.46">                 this.notifyOperationComplete(aListener,</span>
<a href="#l41.47"></a><span id="l41.47">                                              Components.results.NS_ERROR_FAILURE,</span>
<a href="#l41.48"></a><span id="l41.48">                                              Components.interfaces.calIOperationListener.DELETE,</span>
<a href="#l41.49"></a><span id="l41.49">                                              aItem.id,</span>
<a href="#l41.50"></a><span id="l41.50">                                              &quot;generation mismatch in deleteItem&quot;);</span>
<a href="#l41.51"></a><span id="l41.51">                 return;</span>
<a href="#l41.52"></a><span id="l41.52">             }</span>
<a href="#l41.53"></a><span id="l41.53">         }</span>
<a href="#l41.54"></a><span id="l41.54" class="difflineminus">-            </span>
<a href="#l41.55"></a><span id="l41.55" class="difflineplus">+</span>
<a href="#l41.56"></a><span id="l41.56"> </span>
<a href="#l41.57"></a><span id="l41.57">         delete this.mItems[aItem.id];</span>
<a href="#l41.58"></a><span id="l41.58">         this.mMetaData.deleteProperty(aItem.id);</span>
<a href="#l41.59"></a><span id="l41.59"> </span>
<a href="#l41.60"></a><span id="l41.60">         this.notifyOperationComplete(aListener,</span>
<a href="#l41.61"></a><span id="l41.61">                                      Components.results.NS_OK,</span>
<a href="#l41.62"></a><span id="l41.62">                                      Components.interfaces.calIOperationListener.DELETE,</span>
<a href="#l41.63"></a><span id="l41.63">                                      aItem.id,</span>
<a href="#l41.64"></a><span id="l41.64" class="difflineat">@@ -336,17 +336,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l41.65"></a><span id="l41.65"> </span>
<a href="#l41.66"></a><span id="l41.66">         this.notifyOperationComplete(aListener,</span>
<a href="#l41.67"></a><span id="l41.67">                                      Components.results.NS_OK,</span>
<a href="#l41.68"></a><span id="l41.68">                                      Components.interfaces.calIOperationListener.GET,</span>
<a href="#l41.69"></a><span id="l41.69">                                      aId,</span>
<a href="#l41.70"></a><span id="l41.70">                                      null);</span>
<a href="#l41.71"></a><span id="l41.71">     },</span>
<a href="#l41.72"></a><span id="l41.72"> </span>
<a href="#l41.73"></a><span id="l41.73" class="difflineminus">-    // void getItems( in unsigned long aItemFilter, in unsigned long aCount, </span>
<a href="#l41.74"></a><span id="l41.74" class="difflineplus">+    // void getItems( in unsigned long aItemFilter, in unsigned long aCount,</span>
<a href="#l41.75"></a><span id="l41.75">     //                in calIDateTime aRangeStart, in calIDateTime aRangeEnd,</span>
<a href="#l41.76"></a><span id="l41.76">     //                in calIOperationListener aListener );</span>
<a href="#l41.77"></a><span id="l41.77">     getItems: function (aItemFilter, aCount,</span>
<a href="#l41.78"></a><span id="l41.78">                         aRangeStart, aRangeEnd, aListener) {</span>
<a href="#l41.79"></a><span id="l41.79">         let this_ = this;</span>
<a href="#l41.80"></a><span id="l41.80">         cal.postPone(function() {</span>
<a href="#l41.81"></a><span id="l41.81">                 this_.getItems_(aItemFilter, aCount, aRangeStart, aRangeEnd, aListener);</span>
<a href="#l41.82"></a><span id="l41.82">             });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -668,46 +668,46 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.4"></a><span id="l42.4">     },</span>
<a href="#l42.5"></a><span id="l42.5">     getItems_: function cSC_getItems_(aItemFilter, aCount,</span>
<a href="#l42.6"></a><span id="l42.6">                                       aRangeStart, aRangeEnd, aListener)</span>
<a href="#l42.7"></a><span id="l42.7">     {</span>
<a href="#l42.8"></a><span id="l42.8">         //var profStartTime = Date.now();</span>
<a href="#l42.9"></a><span id="l42.9">         if (!aListener)</span>
<a href="#l42.10"></a><span id="l42.10">             return;</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-        var self = this;</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+        let self = this;</span>
<a href="#l42.14"></a><span id="l42.14"> </span>
<a href="#l42.15"></a><span id="l42.15" class="difflineminus">-        var itemsFound = Array();</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineminus">-        var startTime = -0x7fffffffffffffff;</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+        let itemsFound = Array();</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+        let startTime = -0x7fffffffffffffff;</span>
<a href="#l42.19"></a><span id="l42.19">         // endTime needs to be the max value a PRTime can be</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineminus">-        var endTime = 0x7fffffffffffffff;</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineminus">-        var count = 0;</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineplus">+        let endTime = 0x7fffffffffffffff;</span>
<a href="#l42.23"></a><span id="l42.23" class="difflineplus">+        let count = 0;</span>
<a href="#l42.24"></a><span id="l42.24">         if (aRangeStart)</span>
<a href="#l42.25"></a><span id="l42.25">             startTime = aRangeStart.nativeTime;</span>
<a href="#l42.26"></a><span id="l42.26">         if (aRangeEnd)</span>
<a href="#l42.27"></a><span id="l42.27">             endTime = aRangeEnd.nativeTime;</span>
<a href="#l42.28"></a><span id="l42.28"> </span>
<a href="#l42.29"></a><span id="l42.29" class="difflineminus">-        var wantUnrespondedInvitations = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_REQUEST_NEEDS_ACTION) != 0);</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineminus">-        var superCal;</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineplus">+        let wantUnrespondedInvitations = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_REQUEST_NEEDS_ACTION) != 0);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+        let superCal;</span>
<a href="#l42.33"></a><span id="l42.33">         try {</span>
<a href="#l42.34"></a><span id="l42.34">             superCal = this.superCalendar.QueryInterface(Components.interfaces.calISchedulingSupport);</span>
<a href="#l42.35"></a><span id="l42.35">         } catch (exc) {</span>
<a href="#l42.36"></a><span id="l42.36">             wantUnrespondedInvitations = false;</span>
<a href="#l42.37"></a><span id="l42.37">         }</span>
<a href="#l42.38"></a><span id="l42.38">         function checkUnrespondedInvitation(item) {</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineminus">-            var att = superCal.getInvitedAttendee(item);</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineplus">+            let att = superCal.getInvitedAttendee(item);</span>
<a href="#l42.41"></a><span id="l42.41">             return (att &amp;&amp; (att.participationStatus == &quot;NEEDS-ACTION&quot;));</span>
<a href="#l42.42"></a><span id="l42.42">         }</span>
<a href="#l42.43"></a><span id="l42.43"> </span>
<a href="#l42.44"></a><span id="l42.44" class="difflineminus">-        var wantEvents = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_TYPE_EVENT) != 0);</span>
<a href="#l42.45"></a><span id="l42.45" class="difflineminus">-        var wantTodos = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_TYPE_TODO) != 0);</span>
<a href="#l42.46"></a><span id="l42.46" class="difflineminus">-        var asOccurrences = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_CLASS_OCCURRENCES) != 0);</span>
<a href="#l42.47"></a><span id="l42.47" class="difflineminus">-        var wantOfflineDeletedItems = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_OFFLINE_DELETED) != 0);</span>
<a href="#l42.48"></a><span id="l42.48" class="difflineminus">-        var wantOfflineCreatedItems = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_OFFLINE_CREATED) != 0);</span>
<a href="#l42.49"></a><span id="l42.49" class="difflineminus">-        var wantOfflineModifiedItems = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_OFFLINE_MODIFIED) != 0);</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineplus">+        let wantEvents = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_TYPE_EVENT) != 0);</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+        let wantTodos = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_TYPE_TODO) != 0);</span>
<a href="#l42.52"></a><span id="l42.52" class="difflineplus">+        let asOccurrences = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_CLASS_OCCURRENCES) != 0);</span>
<a href="#l42.53"></a><span id="l42.53" class="difflineplus">+        let wantOfflineDeletedItems = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_OFFLINE_DELETED) != 0);</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineplus">+        let wantOfflineCreatedItems = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_OFFLINE_CREATED) != 0);</span>
<a href="#l42.55"></a><span id="l42.55" class="difflineplus">+        let wantOfflineModifiedItems = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_OFFLINE_MODIFIED) != 0);</span>
<a href="#l42.56"></a><span id="l42.56"> </span>
<a href="#l42.57"></a><span id="l42.57">         if (!wantEvents &amp;&amp; !wantTodos) {</span>
<a href="#l42.58"></a><span id="l42.58">             // nothing to do</span>
<a href="#l42.59"></a><span id="l42.59">             this.notifyOperationComplete(aListener,</span>
<a href="#l42.60"></a><span id="l42.60">                                          Components.results.NS_OK,</span>
<a href="#l42.61"></a><span id="l42.61">                                          Components.interfaces.calIOperationListener.GET,</span>
<a href="#l42.62"></a><span id="l42.62">                                          null,</span>
<a href="#l42.63"></a><span id="l42.63">                                          null);</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineat">@@ -718,31 +718,31 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.65"></a><span id="l42.65">         // Hence we need to update the mRecEventCacheOfflineFlags and  mRecTodoCacheOfflineFlags hash-tables</span>
<a href="#l42.66"></a><span id="l42.66">         // It can be an expensive operation but is only used in Online Reconciliation mode</span>
<a href="#l42.67"></a><span id="l42.67">         if (wantOfflineCreatedItems | wantOfflineDeletedItems | wantOfflineModifiedItems) {</span>
<a href="#l42.68"></a><span id="l42.68">             this.mRecItemCacheInited = false;</span>
<a href="#l42.69"></a><span id="l42.69">         }</span>
<a href="#l42.70"></a><span id="l42.70"> </span>
<a href="#l42.71"></a><span id="l42.71">         this.assureRecurringItemCaches();</span>
<a href="#l42.72"></a><span id="l42.72"> </span>
<a href="#l42.73"></a><span id="l42.73" class="difflineminus">-        var itemCompletedFilter = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_COMPLETED_YES) != 0);</span>
<a href="#l42.74"></a><span id="l42.74" class="difflineminus">-        var itemNotCompletedFilter = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_COMPLETED_NO) != 0);</span>
<a href="#l42.75"></a><span id="l42.75" class="difflineplus">+        let itemCompletedFilter = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_COMPLETED_YES) != 0);</span>
<a href="#l42.76"></a><span id="l42.76" class="difflineplus">+        let itemNotCompletedFilter = ((aItemFilter &amp; kCalICalendar.ITEM_FILTER_COMPLETED_NO) != 0);</span>
<a href="#l42.77"></a><span id="l42.77"> </span>
<a href="#l42.78"></a><span id="l42.78">         function checkCompleted(item) {</span>
<a href="#l42.79"></a><span id="l42.79">             return (item.isCompleted ? itemCompletedFilter : itemNotCompletedFilter);</span>
<a href="#l42.80"></a><span id="l42.80">         }</span>
<a href="#l42.81"></a><span id="l42.81"> </span>
<a href="#l42.82"></a><span id="l42.82">         // sending items to the listener 1 at a time sucks. instead,</span>
<a href="#l42.83"></a><span id="l42.83">         // queue them up.</span>
<a href="#l42.84"></a><span id="l42.84">         // if we ever have more than maxQueueSize items outstanding,</span>
<a href="#l42.85"></a><span id="l42.85">         // call the listener.  Calling with null theItems forces</span>
<a href="#l42.86"></a><span id="l42.86">         // a send and a queue clear.</span>
<a href="#l42.87"></a><span id="l42.87" class="difflineminus">-        var maxQueueSize = 10;</span>
<a href="#l42.88"></a><span id="l42.88" class="difflineminus">-        var queuedItems = [ ];</span>
<a href="#l42.89"></a><span id="l42.89" class="difflineminus">-        var queuedItemsIID;</span>
<a href="#l42.90"></a><span id="l42.90" class="difflineplus">+        let maxQueueSize = 10;</span>
<a href="#l42.91"></a><span id="l42.91" class="difflineplus">+        let queuedItems = [];</span>
<a href="#l42.92"></a><span id="l42.92" class="difflineplus">+        let queuedItemsIID;</span>
<a href="#l42.93"></a><span id="l42.93">         function queueItems(theItems, theIID) {</span>
<a href="#l42.94"></a><span id="l42.94">             // if we're about to start sending a different IID,</span>
<a href="#l42.95"></a><span id="l42.95">             // flush the queue</span>
<a href="#l42.96"></a><span id="l42.96">             if (theIID &amp;&amp; queuedItemsIID != theIID) {</span>
<a href="#l42.97"></a><span id="l42.97">                 if (queuedItemsIID)</span>
<a href="#l42.98"></a><span id="l42.98">                     queueItems(null);</span>
<a href="#l42.99"></a><span id="l42.99">                 queuedItemsIID = theIID;</span>
<a href="#l42.100"></a><span id="l42.100">             }</span>
<a href="#l42.101"></a><span id="l42.101" class="difflineat">@@ -761,17 +761,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.102"></a><span id="l42.102"> </span>
<a href="#l42.103"></a><span id="l42.103">                 queuedItems = [ ];</span>
<a href="#l42.104"></a><span id="l42.104">             }</span>
<a href="#l42.105"></a><span id="l42.105">         }</span>
<a href="#l42.106"></a><span id="l42.106"> </span>
<a href="#l42.107"></a><span id="l42.107">         // helper function to handle converting a row to an item,</span>
<a href="#l42.108"></a><span id="l42.108">         // expanding occurrences, and queue the items for the listener</span>
<a href="#l42.109"></a><span id="l42.109">         function handleResultItem(item, theIID, optionalFilterFunc) {</span>
<a href="#l42.110"></a><span id="l42.110" class="difflineminus">-            var expandedItems = [];</span>
<a href="#l42.111"></a><span id="l42.111" class="difflineplus">+            let expandedItems = [];</span>
<a href="#l42.112"></a><span id="l42.112">             if (item.recurrenceInfo &amp;&amp; asOccurrences) {</span>
<a href="#l42.113"></a><span id="l42.113">                 // If the item is recurring, get all ocurrences that fall in</span>
<a href="#l42.114"></a><span id="l42.114">                 // the range. If the item doesn't fall into the range at all,</span>
<a href="#l42.115"></a><span id="l42.115">                 // this expands to 0 items.</span>
<a href="#l42.116"></a><span id="l42.116">                 expandedItems = item.recurrenceInfo.getOccurrences(aRangeStart, aRangeEnd, 0, {});</span>
<a href="#l42.117"></a><span id="l42.117">                 if (wantUnrespondedInvitations) {</span>
<a href="#l42.118"></a><span id="l42.118">                     expandedItems = expandedItems.filter(checkUnrespondedInvitation);</span>
<a href="#l42.119"></a><span id="l42.119">                 }</span>
<a href="#l42.120"></a><span id="l42.120" class="difflineat">@@ -807,18 +807,18 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.121"></a><span id="l42.121">                 return true;</span>
<a href="#l42.122"></a><span id="l42.122">             }</span>
<a href="#l42.123"></a><span id="l42.123"> </span>
<a href="#l42.124"></a><span id="l42.124">             return false;</span>
<a href="#l42.125"></a><span id="l42.125">         }</span>
<a href="#l42.126"></a><span id="l42.126"> </span>
<a href="#l42.127"></a><span id="l42.127">         // First fetch all the events</span>
<a href="#l42.128"></a><span id="l42.128">         if (wantEvents) {</span>
<a href="#l42.129"></a><span id="l42.129" class="difflineminus">-            var sp;             // stmt params</span>
<a href="#l42.130"></a><span id="l42.130" class="difflineminus">-            var resultItems = [];</span>
<a href="#l42.131"></a><span id="l42.131" class="difflineplus">+            let sp;             // stmt params</span>
<a href="#l42.132"></a><span id="l42.132" class="difflineplus">+            let resultItems = [];</span>
<a href="#l42.133"></a><span id="l42.133"> </span>
<a href="#l42.134"></a><span id="l42.134">             // first get non-recurring events that happen to fall within the range</span>
<a href="#l42.135"></a><span id="l42.135">             //</span>
<a href="#l42.136"></a><span id="l42.136">             try {</span>
<a href="#l42.137"></a><span id="l42.137">                 this.prepareStatement(this.mSelectNonRecurringEventsByRange);</span>
<a href="#l42.138"></a><span id="l42.138">                 sp = this.mSelectNonRecurringEventsByRange.params;</span>
<a href="#l42.139"></a><span id="l42.139">                 sp.range_start = startTime;</span>
<a href="#l42.140"></a><span id="l42.140">                 sp.range_end = endTime;</span>
<a href="#l42.141"></a><span id="l42.141" class="difflineat">@@ -836,17 +836,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.142"></a><span id="l42.142">                 }</span>
<a href="#l42.143"></a><span id="l42.143">             } catch (e) {</span>
<a href="#l42.144"></a><span id="l42.144">                 this.logError(&quot;Error selecting non recurring events by range!\n&quot;, e);</span>
<a href="#l42.145"></a><span id="l42.145">             } finally {</span>
<a href="#l42.146"></a><span id="l42.146">                 this.mSelectNonRecurringEventsByRange.reset();</span>
<a href="#l42.147"></a><span id="l42.147">             }</span>
<a href="#l42.148"></a><span id="l42.148"> </span>
<a href="#l42.149"></a><span id="l42.149">             // Process the non-recurring events:</span>
<a href="#l42.150"></a><span id="l42.150" class="difflineminus">-            for (var evitem of resultItems) {</span>
<a href="#l42.151"></a><span id="l42.151" class="difflineplus">+            for (let evitem of resultItems) {</span>
<a href="#l42.152"></a><span id="l42.152">                 count += handleResultItem(evitem, Components.interfaces.calIEvent);</span>
<a href="#l42.153"></a><span id="l42.153">                 if (checkCount()) {</span>
<a href="#l42.154"></a><span id="l42.154">                     return;</span>
<a href="#l42.155"></a><span id="l42.155">                 }</span>
<a href="#l42.156"></a><span id="l42.156">             }</span>
<a href="#l42.157"></a><span id="l42.157"> </span>
<a href="#l42.158"></a><span id="l42.158">             // Process the recurring events from the cache</span>
<a href="#l42.159"></a><span id="l42.159">             for (let id in this.mRecEventCache) {</span>
<a href="#l42.160"></a><span id="l42.160" class="difflineat">@@ -861,18 +861,18 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.161"></a><span id="l42.161">                         return;</span>
<a href="#l42.162"></a><span id="l42.162">                     }</span>
<a href="#l42.163"></a><span id="l42.163">                 }</span>
<a href="#l42.164"></a><span id="l42.164">             }</span>
<a href="#l42.165"></a><span id="l42.165">         }</span>
<a href="#l42.166"></a><span id="l42.166"> </span>
<a href="#l42.167"></a><span id="l42.167">         // if todos are wanted, do them next</span>
<a href="#l42.168"></a><span id="l42.168">         if (wantTodos) {</span>
<a href="#l42.169"></a><span id="l42.169" class="difflineminus">-            var sp;             // stmt params</span>
<a href="#l42.170"></a><span id="l42.170" class="difflineminus">-            var resultItems = [];</span>
<a href="#l42.171"></a><span id="l42.171" class="difflineplus">+            let sp;             // stmt params</span>
<a href="#l42.172"></a><span id="l42.172" class="difflineplus">+            let resultItems = [];</span>
<a href="#l42.173"></a><span id="l42.173"> </span>
<a href="#l42.174"></a><span id="l42.174">             // first get non-recurring todos that happen to fall within the range</span>
<a href="#l42.175"></a><span id="l42.175">             try {</span>
<a href="#l42.176"></a><span id="l42.176">                 this.prepareStatement(this.mSelectNonRecurringTodosByRange);</span>
<a href="#l42.177"></a><span id="l42.177">                 sp = this.mSelectNonRecurringTodosByRange.params;</span>
<a href="#l42.178"></a><span id="l42.178">                 sp.range_start = startTime;</span>
<a href="#l42.179"></a><span id="l42.179">                 sp.range_end = endTime;</span>
<a href="#l42.180"></a><span id="l42.180">                 sp.start_offset = aRangeStart ? aRangeStart.timezoneOffset * USECS_PER_SECOND : 0;</span>
<a href="#l42.181"></a><span id="l42.181" class="difflineat">@@ -888,17 +888,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.182"></a><span id="l42.182">                 }</span>
<a href="#l42.183"></a><span id="l42.183">             } catch (e) {</span>
<a href="#l42.184"></a><span id="l42.184">                 this.logError(&quot;Error selecting non recurring todos by range&quot;, e);</span>
<a href="#l42.185"></a><span id="l42.185">             } finally {</span>
<a href="#l42.186"></a><span id="l42.186">                 this.mSelectNonRecurringTodosByRange.reset();</span>
<a href="#l42.187"></a><span id="l42.187">             }</span>
<a href="#l42.188"></a><span id="l42.188"> </span>
<a href="#l42.189"></a><span id="l42.189">             // process the non-recurring todos:</span>
<a href="#l42.190"></a><span id="l42.190" class="difflineminus">-            for (var todoitem of resultItems) {</span>
<a href="#l42.191"></a><span id="l42.191" class="difflineplus">+            for (let todoitem of resultItems) {</span>
<a href="#l42.192"></a><span id="l42.192">                 count += handleResultItem(todoitem, Components.interfaces.calITodo, checkCompleted);</span>
<a href="#l42.193"></a><span id="l42.193">                 if (checkCount()) {</span>
<a href="#l42.194"></a><span id="l42.194">                     return;</span>
<a href="#l42.195"></a><span id="l42.195">                 }</span>
<a href="#l42.196"></a><span id="l42.196">             }</span>
<a href="#l42.197"></a><span id="l42.197"> </span>
<a href="#l42.198"></a><span id="l42.198">             // Note: Reading the code, completed *occurrences* seems to be broken, because</span>
<a href="#l42.199"></a><span id="l42.199">             //       only the parent item has been filtered; I fixed that.</span>
<a href="#l42.200"></a><span id="l42.200" class="difflineat">@@ -1655,20 +1655,20 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.201"></a><span id="l42.201">     // after we get the base item, we need to check if we need to pull in</span>
<a href="#l42.202"></a><span id="l42.202">     // any extra data from other tables.  We do that here.</span>
<a href="#l42.203"></a><span id="l42.203"> </span>
<a href="#l42.204"></a><span id="l42.204">     // We used to use mDBTwo for this, so this can be run while a</span>
<a href="#l42.205"></a><span id="l42.205">     // select is executing but this no longer seems to be required.</span>
<a href="#l42.206"></a><span id="l42.206"> </span>
<a href="#l42.207"></a><span id="l42.207">     getAdditionalDataForItem: function cSC_getAdditionalDataForItem(item, flags) {</span>
<a href="#l42.208"></a><span id="l42.208">         // This is needed to keep the modification time intact.</span>
<a href="#l42.209"></a><span id="l42.209" class="difflineminus">-        var savedLastModifiedTime = item.lastModifiedTime;</span>
<a href="#l42.210"></a><span id="l42.210" class="difflineplus">+        let savedLastModifiedTime = item.lastModifiedTime;</span>
<a href="#l42.211"></a><span id="l42.211"> </span>
<a href="#l42.212"></a><span id="l42.212">         if (flags &amp; CAL_ITEM_FLAG.HAS_ATTENDEES) {</span>
<a href="#l42.213"></a><span id="l42.213" class="difflineminus">-            var selectItem = null;</span>
<a href="#l42.214"></a><span id="l42.214" class="difflineplus">+            let selectItem = null;</span>
<a href="#l42.215"></a><span id="l42.215">             if (item.recurrenceId == null) {</span>
<a href="#l42.216"></a><span id="l42.216">                 selectItem = this.mSelectAttendeesForItem;</span>
<a href="#l42.217"></a><span id="l42.217">             } else {</span>
<a href="#l42.218"></a><span id="l42.218">                 selectItem = this.mSelectAttendeesForItemWithRecurrenceId;</span>
<a href="#l42.219"></a><span id="l42.219">                 this.setDateParamHelper(selectItem.params, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l42.220"></a><span id="l42.220">             }</span>
<a href="#l42.221"></a><span id="l42.221"> </span>
<a href="#l42.222"></a><span id="l42.222">             try {</span>
<a href="#l42.223"></a><span id="l42.223" class="difflineat">@@ -1690,55 +1690,55 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.224"></a><span id="l42.224">             } catch (e) {</span>
<a href="#l42.225"></a><span id="l42.225">                 this.logError(&quot;Error getting attendees for item '&quot; +</span>
<a href="#l42.226"></a><span id="l42.226">                               item.title + &quot;' (&quot; + item.id + &quot;)!&quot;, e);</span>
<a href="#l42.227"></a><span id="l42.227">             } finally {</span>
<a href="#l42.228"></a><span id="l42.228">                 selectItem.reset();</span>
<a href="#l42.229"></a><span id="l42.229">             }</span>
<a href="#l42.230"></a><span id="l42.230">         }</span>
<a href="#l42.231"></a><span id="l42.231"> </span>
<a href="#l42.232"></a><span id="l42.232" class="difflineminus">-        var row;</span>
<a href="#l42.233"></a><span id="l42.233" class="difflineplus">+        let row;</span>
<a href="#l42.234"></a><span id="l42.234">         if (flags &amp; CAL_ITEM_FLAG.HAS_PROPERTIES) {</span>
<a href="#l42.235"></a><span id="l42.235" class="difflineminus">-            var selectItem = null;</span>
<a href="#l42.236"></a><span id="l42.236" class="difflineplus">+            let selectItem = null;</span>
<a href="#l42.237"></a><span id="l42.237">             if (item.recurrenceId == null) {</span>
<a href="#l42.238"></a><span id="l42.238">                 selectItem = this.mSelectPropertiesForItem;</span>
<a href="#l42.239"></a><span id="l42.239">             } else {</span>
<a href="#l42.240"></a><span id="l42.240">                 selectItem = this.mSelectPropertiesForItemWithRecurrenceId;</span>
<a href="#l42.241"></a><span id="l42.241">                 this.setDateParamHelper(selectItem.params, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l42.242"></a><span id="l42.242">             }</span>
<a href="#l42.243"></a><span id="l42.243"> </span>
<a href="#l42.244"></a><span id="l42.244">             try {</span>
<a href="#l42.245"></a><span id="l42.245">                 this.prepareStatement(selectItem);</span>
<a href="#l42.246"></a><span id="l42.246">                 selectItem.params.item_id = item.id;</span>
<a href="#l42.247"></a><span id="l42.247">                 while (selectItem.executeStep()) {</span>
<a href="#l42.248"></a><span id="l42.248">                     row = selectItem.row;</span>
<a href="#l42.249"></a><span id="l42.249" class="difflineminus">-                    var name = row.key;</span>
<a href="#l42.250"></a><span id="l42.250" class="difflineplus">+                    let name = row.key;</span>
<a href="#l42.251"></a><span id="l42.251">                     switch (name) {</span>
<a href="#l42.252"></a><span id="l42.252">                         case &quot;DURATION&quot;:</span>
<a href="#l42.253"></a><span id="l42.253">                             // for events DTEND/DUE is enforced by calEvent/calTodo, so suppress DURATION:</span>
<a href="#l42.254"></a><span id="l42.254">                             break;</span>
<a href="#l42.255"></a><span id="l42.255">                         case &quot;CATEGORIES&quot;: {</span>
<a href="#l42.256"></a><span id="l42.256" class="difflineminus">-                            var cats = categoriesStringToArray(row.value);</span>
<a href="#l42.257"></a><span id="l42.257" class="difflineplus">+                            let cats = categoriesStringToArray(row.value);</span>
<a href="#l42.258"></a><span id="l42.258">                             item.setCategories(cats.length, cats);</span>
<a href="#l42.259"></a><span id="l42.259">                             break;</span>
<a href="#l42.260"></a><span id="l42.260">                         }</span>
<a href="#l42.261"></a><span id="l42.261">                         default:</span>
<a href="#l42.262"></a><span id="l42.262">                             item.setProperty(name, row.value);</span>
<a href="#l42.263"></a><span id="l42.263">                             break;</span>
<a href="#l42.264"></a><span id="l42.264">                     }</span>
<a href="#l42.265"></a><span id="l42.265">                 }</span>
<a href="#l42.266"></a><span id="l42.266">             } catch (e) {</span>
<a href="#l42.267"></a><span id="l42.267">                 this.logError(&quot;Error getting extra properties for item '&quot; +</span>
<a href="#l42.268"></a><span id="l42.268">                               item.title + &quot;' (&quot; + item.id + &quot;)!&quot;, e);</span>
<a href="#l42.269"></a><span id="l42.269">             } finally {</span>
<a href="#l42.270"></a><span id="l42.270">                 selectItem.reset();</span>
<a href="#l42.271"></a><span id="l42.271">             }</span>
<a href="#l42.272"></a><span id="l42.272">         }</span>
<a href="#l42.273"></a><span id="l42.273"> </span>
<a href="#l42.274"></a><span id="l42.274" class="difflineminus">-        var i;</span>
<a href="#l42.275"></a><span id="l42.275" class="difflineplus">+        let i;</span>
<a href="#l42.276"></a><span id="l42.276">         if (flags &amp; CAL_ITEM_FLAG.HAS_RECURRENCE) {</span>
<a href="#l42.277"></a><span id="l42.277">             if (item.recurrenceId) {</span>
<a href="#l42.278"></a><span id="l42.278">                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l42.279"></a><span id="l42.279">             }</span>
<a href="#l42.280"></a><span id="l42.280"> </span>
<a href="#l42.281"></a><span id="l42.281">             let recInfo = cal.createRecurrenceInfo(item);</span>
<a href="#l42.282"></a><span id="l42.282">             item.recurrenceInfo = recInfo;</span>
<a href="#l42.283"></a><span id="l42.283"> </span>
<a href="#l42.284"></a><span id="l42.284" class="difflineat">@@ -1760,40 +1760,40 @@ calStorageCalendar.prototype = {</span>
<a href="#l42.285"></a><span id="l42.285"> </span>
<a href="#l42.286"></a><span id="l42.286">         if (flags &amp; CAL_ITEM_FLAG.HAS_EXCEPTIONS) {</span>
<a href="#l42.287"></a><span id="l42.287">             // it's safe that we don't run into this branch again for exceptions</span>
<a href="#l42.288"></a><span id="l42.288">             // (getAdditionalDataForItem-&gt;get[Event|Todo]FromRow-&gt;getAdditionalDataForItem):</span>
<a href="#l42.289"></a><span id="l42.289">             // every excepton has a recurrenceId and isn't flagged as CAL_ITEM_FLAG.HAS_EXCEPTIONS</span>
<a href="#l42.290"></a><span id="l42.290">             if (item.recurrenceId)</span>
<a href="#l42.291"></a><span id="l42.291">                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l42.292"></a><span id="l42.292"> </span>
<a href="#l42.293"></a><span id="l42.293" class="difflineminus">-            var rec = item.recurrenceInfo;</span>
<a href="#l42.294"></a><span id="l42.294" class="difflineplus">+            let rec = item.recurrenceInfo;</span>
<a href="#l42.295"></a><span id="l42.295"> </span>
<a href="#l42.296"></a><span id="l42.296">             if (cal.isEvent(item)) {</span>
<a href="#l42.297"></a><span id="l42.297">                 this.mSelectEventExceptions.params.id = item.id;</span>
<a href="#l42.298"></a><span id="l42.298">                 this.prepareStatement(this.mSelectEventExceptions);</span>
<a href="#l42.299"></a><span id="l42.299">                 try {</span>
<a href="#l42.300"></a><span id="l42.300">                     while (this.mSelectEventExceptions.executeStep()) {</span>
<a href="#l42.301"></a><span id="l42.301" class="difflineminus">-                        var row = this.mSelectEventExceptions.row;</span>
<a href="#l42.302"></a><span id="l42.302" class="difflineminus">-                        var exc = this.getEventFromRow(row, {}, true /*isException*/);</span>
<a href="#l42.303"></a><span id="l42.303" class="difflineplus">+                        let row = this.mSelectEventExceptions.row;</span>
<a href="#l42.304"></a><span id="l42.304" class="difflineplus">+                        let exc = this.getEventFromRow(row, {}, true /*isException*/);</span>
<a href="#l42.305"></a><span id="l42.305">                         rec.modifyException(exc, true);</span>
<a href="#l42.306"></a><span id="l42.306">                     }</span>
<a href="#l42.307"></a><span id="l42.307">                 } catch (e) {</span>
<a href="#l42.308"></a><span id="l42.308">                     this.logError(&quot;Error getting exceptions for event '&quot; +</span>
<a href="#l42.309"></a><span id="l42.309">                                   item.title + &quot;' (&quot; + item.id + &quot;)!&quot;, e);</span>
<a href="#l42.310"></a><span id="l42.310">                 } finally {</span>
<a href="#l42.311"></a><span id="l42.311">                     this.mSelectEventExceptions.reset();</span>
<a href="#l42.312"></a><span id="l42.312">                 }</span>
<a href="#l42.313"></a><span id="l42.313">             } else if (cal.isToDo(item)) {</span>
<a href="#l42.314"></a><span id="l42.314">                 this.mSelectTodoExceptions.params.id = item.id;</span>
<a href="#l42.315"></a><span id="l42.315">                 this.prepareStatement(this.mSelectTodoExceptions);</span>
<a href="#l42.316"></a><span id="l42.316">                 try {</span>
<a href="#l42.317"></a><span id="l42.317">                     while (this.mSelectTodoExceptions.executeStep()) {</span>
<a href="#l42.318"></a><span id="l42.318" class="difflineminus">-                        var row = this.mSelectTodoExceptions.row;</span>
<a href="#l42.319"></a><span id="l42.319" class="difflineminus">-                        var exc = this.getTodoFromRow(row, {}, true /*isException*/);</span>
<a href="#l42.320"></a><span id="l42.320" class="difflineplus">+                        let row = this.mSelectTodoExceptions.row;</span>
<a href="#l42.321"></a><span id="l42.321" class="difflineplus">+                        let exc = this.getTodoFromRow(row, {}, true /*isException*/);</span>
<a href="#l42.322"></a><span id="l42.322">                         rec.modifyException(exc, true);</span>
<a href="#l42.323"></a><span id="l42.323">                     }</span>
<a href="#l42.324"></a><span id="l42.324">                 } catch (e) {</span>
<a href="#l42.325"></a><span id="l42.325">                     this.logError(&quot;Error getting exceptions for task '&quot; +</span>
<a href="#l42.326"></a><span id="l42.326">                                   item.title + &quot;' (&quot; + item.id + &quot;)!&quot;, e);</span>
<a href="#l42.327"></a><span id="l42.327">                 } finally {</span>
<a href="#l42.328"></a><span id="l42.328">                     this.mSelectTodoExceptions.reset();</span>
<a href="#l42.329"></a><span id="l42.329">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/providers/storage/calStorageHelpers.jsm</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageHelpers.jsm</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -51,22 +51,26 @@ function getInUtcOrKeepFloating(dt) {</span>
<a href="#l43.4"></a><span id="l43.4"> </span>
<a href="#l43.5"></a><span id="l43.5"> /**</span>
<a href="#l43.6"></a><span id="l43.6">  * Transforms a date object to a text which is suitable for the database</span>
<a href="#l43.7"></a><span id="l43.7">  *</span>
<a href="#l43.8"></a><span id="l43.8">  * @param d     The calIDateTime to transform.</span>
<a href="#l43.9"></a><span id="l43.9">  * @return      The string representation of the date object.</span>
<a href="#l43.10"></a><span id="l43.10">  */</span>
<a href="#l43.11"></a><span id="l43.11"> function dateToText(d) {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    let datestr;</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-    let tz = null;</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineplus">+    let zonestr;</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineplus">+    if (d.timezone.isFloating) {</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineplus">+        zonestr = &quot;L&quot;;</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineplus">+    } else if (d.timezone.isUTC) {</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+        zonestr = &quot;U&quot;;</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+    } else {</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+        zonestr = &quot;Z&quot;;</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineplus">+    }</span>
<a href="#l43.22"></a><span id="l43.22"> </span>
<a href="#l43.23"></a><span id="l43.23" class="difflineminus">-    datestr = (d.timezone.isFloating ? &quot;L&quot; :</span>
<a href="#l43.24"></a><span id="l43.24" class="difflineminus">-                 (d.timezone.isUTC ? &quot;U&quot; : &quot;Z&quot;)) +</span>
<a href="#l43.25"></a><span id="l43.25" class="difflineminus">-              (d.isDate ? &quot;D&quot; : &quot;T&quot;) + d.nativeTime;</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineplus">+    let datestr = zonestr + (d.isDate ? &quot;D&quot; : &quot;T&quot;) + d.nativeTime;</span>
<a href="#l43.27"></a><span id="l43.27">     if (!d.timezone.isFloating &amp;&amp; ! d.timezone.isUTC) {</span>
<a href="#l43.28"></a><span id="l43.28">         datestr += &quot;:&quot; + d.timezone.tzid.replace(/%/g, &quot;%%&quot;).replace(/:/g, &quot;%:&quot;);</span>
<a href="#l43.29"></a><span id="l43.29">     }</span>
<a href="#l43.30"></a><span id="l43.30">     return datestr;</span>
<a href="#l43.31"></a><span id="l43.31"> }</span>
<a href="#l43.32"></a><span id="l43.32"> </span>
<a href="#l43.33"></a><span id="l43.33"> /**</span>
<a href="#l43.34"></a><span id="l43.34">  * Transforms the text representation of this date object to a calIDateTime</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -259,16 +259,17 @@ function createDBDelegate(funcName) {</span>
<a href="#l44.4"></a><span id="l44.4">             try {</span>
<a href="#l44.5"></a><span id="l44.5">                 return db[funcName](...args);</span>
<a href="#l44.6"></a><span id="l44.6">             } catch (e) {</span>
<a href="#l44.7"></a><span id="l44.7">                 cal.ERROR(&quot;Error calling '&quot; + funcName + &quot;' db error: '&quot; +</span>
<a href="#l44.8"></a><span id="l44.8">                           lastErrorString(db) + &quot;'.\nException: &quot; + e);</span>
<a href="#l44.9"></a><span id="l44.9">                 cal.WARN(cal.STACK(10));</span>
<a href="#l44.10"></a><span id="l44.10">             }</span>
<a href="#l44.11"></a><span id="l44.11">         }</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+        return null;</span>
<a href="#l44.13"></a><span id="l44.13">     };</span>
<a href="#l44.14"></a><span id="l44.14"> }</span>
<a href="#l44.15"></a><span id="l44.15"> </span>
<a href="#l44.16"></a><span id="l44.16"> /**</span>
<a href="#l44.17"></a><span id="l44.17">  * Creates a delegate function for a database getter. Returns a function that</span>
<a href="#l44.18"></a><span id="l44.18">  * can be called to get the specified attribute, if a database is passed. If no</span>
<a href="#l44.19"></a><span id="l44.19">  * database is passed, no error is thrown but null is returned.</span>
<a href="#l44.20"></a><span id="l44.20">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -196,17 +196,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l45.4"></a><span id="l45.4">     },</span>
<a href="#l45.5"></a><span id="l45.5">     refresh: function calWcapCalendar_refresh() {</span>
<a href="#l45.6"></a><span id="l45.6">         log(&quot;refresh.&quot;, this);</span>
<a href="#l45.7"></a><span id="l45.7">         // invalidate cached results:</span>
<a href="#l45.8"></a><span id="l45.8">         delete this.m_cachedResults;</span>
<a href="#l45.9"></a><span id="l45.9">         // notify about refreshed calendar:</span>
<a href="#l45.10"></a><span id="l45.10">         this.notifyObservers(&quot;onLoad&quot;, [this]);</span>
<a href="#l45.11"></a><span id="l45.11">     },</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-    </span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+</span>
<a href="#l45.14"></a><span id="l45.14">     issueNetworkRequest: function calWcapCalendar_issueNetworkRequest(</span>
<a href="#l45.15"></a><span id="l45.15">         request, respFunc, dataConvFunc, wcapCommand, params, accessRights) {</span>
<a href="#l45.16"></a><span id="l45.16"> </span>
<a href="#l45.17"></a><span id="l45.17">         var this_ = this;</span>
<a href="#l45.18"></a><span id="l45.18">         // - bootstrap problem: no cal_props, no access check, no default calId</span>
<a href="#l45.19"></a><span id="l45.19">         // - assure being logged in, thus the default cal_props are available</span>
<a href="#l45.20"></a><span id="l45.20">         // - every subscribed calendar will come along with cal_props</span>
<a href="#l45.21"></a><span id="l45.21">         return this.session.getSessionId(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -355,35 +355,36 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l46.4"></a><span id="l46.4">         // - if first occurrence is an exception</span>
<a href="#l46.5"></a><span id="l46.5">         //   and an EXDATE for that occurrence ought to be written,</span>
<a href="#l46.6"></a><span id="l46.6">         //   then the master item's data is replaced with that EXDATEd exception. WTF.</span>
<a href="#l46.7"></a><span id="l46.7">         // - if start/end date is being written on master, the previously EXDATEd</span>
<a href="#l46.8"></a><span id="l46.8">         //   exception overwrites master, why ever.</span>
<a href="#l46.9"></a><span id="l46.9">         // So in these cases: write all data of master.</span>
<a href="#l46.10"></a><span id="l46.10"> </span>
<a href="#l46.11"></a><span id="l46.11">         var bIsAllDay = false;</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineplus">+        var dtstart, dtend;</span>
<a href="#l46.13"></a><span id="l46.13">         if (bIsEvent) {</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">-            var dtstart = item.startDate;</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">-            var dtend = item.endDate;</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineplus">+            dtstart = item.startDate;</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineplus">+            dtend = item.endDate;</span>
<a href="#l46.18"></a><span id="l46.18">             bIsAllDay = (dtstart.isDate &amp;&amp; dtend.isDate);</span>
<a href="#l46.19"></a><span id="l46.19">             if (!oldItem || !identicalDatetimes(dtstart, oldItem.startDate)</span>
<a href="#l46.20"></a><span id="l46.20">                          || !identicalDatetimes(dtend, oldItem.endDate)) {</span>
<a href="#l46.21"></a><span id="l46.21">                 params += (&quot;&amp;dtstart=&quot; + getIcalUTC(dtstart)); // timezone will be set with tzid param</span>
<a href="#l46.22"></a><span id="l46.22">                 params += (&quot;&amp;dtend=&quot; + getIcalUTC(dtend));</span>
<a href="#l46.23"></a><span id="l46.23">                 params += (bIsAllDay ? &quot;&amp;isAllDay=1&quot; : &quot;&amp;isAllDay=0&quot;);</span>
<a href="#l46.24"></a><span id="l46.24"> </span>
<a href="#l46.25"></a><span id="l46.25">                 if (bIsParent &amp;&amp; item.recurrenceInfo) {</span>
<a href="#l46.26"></a><span id="l46.26">                     oldItem = null; // recurrence/exceptions hack: write whole master</span>
<a href="#l46.27"></a><span id="l46.27">                 }</span>
<a href="#l46.28"></a><span id="l46.28">             }</span>
<a href="#l46.29"></a><span id="l46.29">         } else { // calITodo</span>
<a href="#l46.30"></a><span id="l46.30">             // xxx todo: dtstart is mandatory for cs, so if this is</span>
<a href="#l46.31"></a><span id="l46.31">             //           undefined, assume an allDay todo???</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineminus">-            var dtstart = item.entryDate;</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineminus">-            var dtend = item.dueDate;</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineplus">+            dtstart = item.entryDate;</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineplus">+            dtend = item.dueDate;</span>
<a href="#l46.36"></a><span id="l46.36"> </span>
<a href="#l46.37"></a><span id="l46.37">             // cs bug: enforce DUE (set to DTSTART) if alarm is set</span>
<a href="#l46.38"></a><span id="l46.38">             if (!dtend &amp;&amp; item.getAlarms({}).length) {</span>
<a href="#l46.39"></a><span id="l46.39">                 dtend = dtstart;</span>
<a href="#l46.40"></a><span id="l46.40">             }</span>
<a href="#l46.41"></a><span id="l46.41"> </span>
<a href="#l46.42"></a><span id="l46.42">             bIsAllDay = (dtstart &amp;&amp; dtstart.isDate);</span>
<a href="#l46.43"></a><span id="l46.43">             if (!oldItem || !identicalDatetimes(dtstart, oldItem.entryDate)</span>
<a href="#l46.44"></a><span id="l46.44" class="difflineat">@@ -513,17 +514,17 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l46.45"></a><span id="l46.45">                 params += (&quot;&amp;percent=&quot; + item.percentComplete.toString(10));</span>
<a href="#l46.46"></a><span id="l46.46">             }</span>
<a href="#l46.47"></a><span id="l46.47">             if (!oldItem || !equalDatetimes(item.completedDate, oldItem.completedDate)) {</span>
<a href="#l46.48"></a><span id="l46.48">                 params += (&quot;&amp;completed=&quot; + getIcalUTC(item.completedDate));</span>
<a href="#l46.49"></a><span id="l46.49">             }</span>
<a href="#l46.50"></a><span id="l46.50">         }</span>
<a href="#l46.51"></a><span id="l46.51"> </span>
<a href="#l46.52"></a><span id="l46.52">         // attachment urls:</span>
<a href="#l46.53"></a><span id="l46.53" class="difflineminus">-        var val = getAttachments(item);</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineplus">+        val = getAttachments(item);</span>
<a href="#l46.55"></a><span id="l46.55">         if (!oldItem || val != getAttachments(oldItem)) {</span>
<a href="#l46.56"></a><span id="l46.56">             params += (&quot;&amp;attachments=&quot; + val);</span>
<a href="#l46.57"></a><span id="l46.57">         }</span>
<a href="#l46.58"></a><span id="l46.58">     } // PUBLISH, REQUEST</span>
<a href="#l46.59"></a><span id="l46.59"> </span>
<a href="#l46.60"></a><span id="l46.60">     var alarmParams = this.getAlarmParams(item);</span>
<a href="#l46.61"></a><span id="l46.61">     if (!oldItem || (this.getAlarmParams(oldItem) != alarmParams)) {</span>
<a href="#l46.62"></a><span id="l46.62">         if ((method == METHOD_REQUEST) &amp;&amp; params.length == 0) {</span>
<a href="#l46.63"></a><span id="l46.63" class="difflineat">@@ -1079,17 +1080,17 @@ function calWcapCalendar_getItem(id, lis</span>
<a href="#l46.64"></a><span id="l46.64">                                           &quot;unexpected number of items: &quot; + items.length);</span>
<a href="#l46.65"></a><span id="l46.65">                     }</span>
<a href="#l46.66"></a><span id="l46.66">                     if (listener) {</span>
<a href="#l46.67"></a><span id="l46.67">                         listener.onGetResult(this_.superCalendar, NS_OK,</span>
<a href="#l46.68"></a><span id="l46.68">                                              calIItemBase, log(&quot;getItem(): success. id=&quot; + id, this_),</span>
<a href="#l46.69"></a><span id="l46.69">                                              items.length, items);</span>
<a href="#l46.70"></a><span id="l46.70">                     }</span>
<a href="#l46.71"></a><span id="l46.71">                     request.execRespFunc(null, items[0]);</span>
<a href="#l46.72"></a><span id="l46.72" class="difflineminus">-                };</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineplus">+                }</span>
<a href="#l46.74"></a><span id="l46.74">                 if (err) {</span>
<a href="#l46.75"></a><span id="l46.75">                     if (!checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) &amp;&amp;</span>
<a href="#l46.76"></a><span id="l46.76">                         !checkErrorCode(err, calIWcapErrors.WCAP_COMPONENT_NOT_FOUND)) {</span>
<a href="#l46.77"></a><span id="l46.77">                         throw err;</span>
<a href="#l46.78"></a><span id="l46.78">                     }</span>
<a href="#l46.79"></a><span id="l46.79">                     // try todos:</span>
<a href="#l46.80"></a><span id="l46.80">                     this_.issueNetworkRequest(</span>
<a href="#l46.81"></a><span id="l46.81">                         request,</span>
<a href="#l46.82"></a><span id="l46.82" class="difflineat">@@ -1350,33 +1351,33 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l46.83"></a><span id="l46.83">                 if (!Components.isSuccessCode(status)) {</span>
<a href="#l46.84"></a><span id="l46.84">                     request.execRespFunc(status); // any error on writing breaks whole operation</span>
<a href="#l46.85"></a><span id="l46.85">                 }</span>
<a href="#l46.86"></a><span id="l46.86">             }</span>
<a href="#l46.87"></a><span id="l46.87">         };</span>
<a href="#l46.88"></a><span id="l46.88">         var request = new calWcapRequest(</span>
<a href="#l46.89"></a><span id="l46.89">             function netFinishedRespFunc(err, data) {</span>
<a href="#l46.90"></a><span id="l46.90">                 var modifiedIds = {};</span>
<a href="#l46.91"></a><span id="l46.91" class="difflineminus">-                for (var item of request.m_modifiedItems) {</span>
<a href="#l46.92"></a><span id="l46.92" class="difflineplus">+                for (let item of request.m_modifiedItems) {</span>
<a href="#l46.93"></a><span id="l46.93">                     var dtCreated = item.getProperty(&quot;CREATED&quot;);</span>
<a href="#l46.94"></a><span id="l46.94">                     var bAdd = (!dtCreated || !dtFrom || dtCreated.compare(dtFrom) &gt;= 0);</span>
<a href="#l46.95"></a><span id="l46.95">                     modifiedIds[item.id] = true;</span>
<a href="#l46.96"></a><span id="l46.96">                     if (bAdd) {</span>
<a href="#l46.97"></a><span id="l46.97">                         log(&quot;replayChangesOn(): new item &quot; + item.id, this_);</span>
<a href="#l46.98"></a><span id="l46.98">                         if (this_.offlineStorage) {</span>
<a href="#l46.99"></a><span id="l46.99">                             this_.offlineStorage.addItem(item, writeListener);</span>
<a href="#l46.100"></a><span id="l46.100">                         }</span>
<a href="#l46.101"></a><span id="l46.101">                     } else {</span>
<a href="#l46.102"></a><span id="l46.102">                         log(&quot;replayChangesOn(): modified item &quot; + item.id, this_);</span>
<a href="#l46.103"></a><span id="l46.103">                         if (this_.offlineStorage) {</span>
<a href="#l46.104"></a><span id="l46.104">                             this_.modifyItem(item, null, writeListener);</span>
<a href="#l46.105"></a><span id="l46.105">                         }</span>
<a href="#l46.106"></a><span id="l46.106">                     }</span>
<a href="#l46.107"></a><span id="l46.107">                 }</span>
<a href="#l46.108"></a><span id="l46.108" class="difflineminus">-                for (var item of request.m_deletedItems) {</span>
<a href="#l46.109"></a><span id="l46.109" class="difflineplus">+                for (let item of request.m_deletedItems) {</span>
<a href="#l46.110"></a><span id="l46.110">                     // don't delete anything that has been touched by lastmods:</span>
<a href="#l46.111"></a><span id="l46.111">                     if (modifiedIds[item.id]) {</span>
<a href="#l46.112"></a><span id="l46.112">                         log(&quot;replayChangesOn(): skipping deletion of &quot; + item.id, this_);</span>
<a href="#l46.113"></a><span id="l46.113">                     } else if (isParent(item)) {</span>
<a href="#l46.114"></a><span id="l46.114">                         log(&quot;replayChangesOn(): deleted item &quot; + item.id, this_);</span>
<a href="#l46.115"></a><span id="l46.115">                         if (this_.offlineStorage) {</span>
<a href="#l46.116"></a><span id="l46.116">                             this_.offlineStorage.deleteItem(item, writeListener);</span>
<a href="#l46.117"></a><span id="l46.117">                         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -37,17 +37,17 @@ var g_busyPhantomItemUuidPrefix;</span>
<a href="#l47.4"></a><span id="l47.4"> var CACHE_LAST_RESULTS = 4;</span>
<a href="#l47.5"></a><span id="l47.5"> // timer secs for invalidation:</span>
<a href="#l47.6"></a><span id="l47.6"> var CACHE_LAST_RESULTS_INVALIDATE = 120;</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8"> // logging:</span>
<a href="#l47.9"></a><span id="l47.9"> var LOG_LEVEL = 0;</span>
<a href="#l47.10"></a><span id="l47.10"> </span>
<a href="#l47.11"></a><span id="l47.11"> function initWcapProvider() {</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    try {        </span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+    try {</span>
<a href="#l47.14"></a><span id="l47.14">         initLogging();</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16">         // some string resources:</span>
<a href="#l47.17"></a><span id="l47.17">         g_privateItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;privateItem.title.text&quot;);</span>
<a href="#l47.18"></a><span id="l47.18">         g_confidentialItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;confidentialItem.title.text&quot;);</span>
<a href="#l47.19"></a><span id="l47.19">         g_busyItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;busyItem.title.text&quot;);</span>
<a href="#l47.20"></a><span id="l47.20">         g_busyPhantomItemUuidPrefix = (&quot;PHANTOM_uuid_&quot; + cal.getUUID());</span>
<a href="#l47.21"></a><span id="l47.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -478,26 +478,25 @@ calWcapSession.prototype = {</span>
<a href="#l48.4"></a><span id="l48.4">             },</span>
<a href="#l48.5"></a><span id="l48.5">             log(&quot;setupSession&quot;, this));</span>
<a href="#l48.6"></a><span id="l48.6">         if (request_) {</span>
<a href="#l48.7"></a><span id="l48.7">             request_.attachSubRequest(request);</span>
<a href="#l48.8"></a><span id="l48.8">         }</span>
<a href="#l48.9"></a><span id="l48.9"> </span>
<a href="#l48.10"></a><span id="l48.10">         request.lockPending();</span>
<a href="#l48.11"></a><span id="l48.11">         try {</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-            var this_ = this;</span>
<a href="#l48.13"></a><span id="l48.13">             this.issueNetworkRequest_(</span>
<a href="#l48.14"></a><span id="l48.14">                 request,</span>
<a href="#l48.15"></a><span id="l48.15">                 function userprefs_resp(err, data) {</span>
<a href="#l48.16"></a><span id="l48.16">                     if (err)</span>
<a href="#l48.17"></a><span id="l48.17">                         throw err;</span>
<a href="#l48.18"></a><span id="l48.18">                     this_.credentials.userPrefs = data;</span>
<a href="#l48.19"></a><span id="l48.19">                     log(&quot;installed user prefs.&quot;, this_);</span>
<a href="#l48.20"></a><span id="l48.20"> </span>
<a href="#l48.21"></a><span id="l48.21" class="difflineminus">-                    // get calprops for all registered calendars:                        </span>
<a href="#l48.22"></a><span id="l48.22" class="difflineplus">+                    // get calprops for all registered calendars:</span>
<a href="#l48.23"></a><span id="l48.23">                     var cals = this_.getRegisteredCalendars(true);</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25">                     var calprops_resp = null;</span>
<a href="#l48.26"></a><span id="l48.26">                     var defaultCal = this_.defaultCalendar;</span>
<a href="#l48.27"></a><span id="l48.27">                     if (defaultCal &amp;&amp; cals[defaultCal.calId] &amp;&amp; // default calendar is registered</span>
<a href="#l48.28"></a><span id="l48.28">                         getPref(&quot;calendar.wcap.subscriptions&quot;, true) &amp;&amp;</span>
<a href="#l48.29"></a><span id="l48.29">                         !defaultCal.getProperty(&quot;subscriptions_registered&quot;)) {</span>
<a href="#l48.30"></a><span id="l48.30"> </span>
<a href="#l48.31"></a><span id="l48.31" class="difflineat">@@ -550,17 +549,17 @@ calWcapSession.prototype = {</span>
<a href="#l48.32"></a><span id="l48.32">                 sessionId);</span>
<a href="#l48.33"></a><span id="l48.33">             this.installServerTimeDiff(sessionId, request);</span>
<a href="#l48.34"></a><span id="l48.34">             this.installServerTimezones(sessionId, request);</span>
<a href="#l48.35"></a><span id="l48.35"> </span>
<a href="#l48.36"></a><span id="l48.36">         } finally {</span>
<a href="#l48.37"></a><span id="l48.37">             request.unlockPending();</span>
<a href="#l48.38"></a><span id="l48.38">         }</span>
<a href="#l48.39"></a><span id="l48.39">     },</span>
<a href="#l48.40"></a><span id="l48.40" class="difflineminus">-    </span>
<a href="#l48.41"></a><span id="l48.41" class="difflineplus">+</span>
<a href="#l48.42"></a><span id="l48.42">     installCalProps_get_calprops:</span>
<a href="#l48.43"></a><span id="l48.43">     function calWcapSession_installCalProps_get_calprops(respFunc, sessionId, cals, request) {</span>
<a href="#l48.44"></a><span id="l48.44"> </span>
<a href="#l48.45"></a><span id="l48.45">         var this_ = this;</span>
<a href="#l48.46"></a><span id="l48.46">         function calprops_resp(err, data) {</span>
<a href="#l48.47"></a><span id="l48.47">             if (err) {</span>
<a href="#l48.48"></a><span id="l48.48">                 throw err;</span>
<a href="#l48.49"></a><span id="l48.49">             }</span>
<a href="#l48.50"></a><span id="l48.50" class="difflineat">@@ -1139,32 +1138,32 @@ function confirmInsecureLogin(uri)</span>
<a href="#l48.51"></a><span id="l48.51">     var host = uri.hostPort;</span>
<a href="#l48.52"></a><span id="l48.52">     var encodedHost = encodeURIComponent(host);</span>
<a href="#l48.53"></a><span id="l48.53">     var confirmedEntry = confirmInsecureLogin.m_confirmedHttpLogins[encodedHost];</span>
<a href="#l48.54"></a><span id="l48.54">     if (confirmedEntry) {</span>
<a href="#l48.55"></a><span id="l48.55">         bConfirmed = (confirmedEntry == &quot;1&quot;);</span>
<a href="#l48.56"></a><span id="l48.56">     } else {</span>
<a href="#l48.57"></a><span id="l48.57">         var prompt = Services.ww.getNewPrompter(null);</span>
<a href="#l48.58"></a><span id="l48.58">         var out_dontAskAgain = { value: false };</span>
<a href="#l48.59"></a><span id="l48.59" class="difflineminus">-        var bConfirmed = prompt.confirmCheck(</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineplus">+        bConfirmed = prompt.confirmCheck(</span>
<a href="#l48.61"></a><span id="l48.61">             cal.calGetString(&quot;wcap&quot;, &quot;noHttpsConfirmation.label&quot;),</span>
<a href="#l48.62"></a><span id="l48.62">             cal.calGetString(&quot;wcap&quot;, &quot;noHttpsConfirmation.text&quot;, [host]),</span>
<a href="#l48.63"></a><span id="l48.63">             cal.calGetString(&quot;wcap&quot;, &quot;noHttpsConfirmation.check.text&quot;),</span>
<a href="#l48.64"></a><span id="l48.64">             out_dontAskAgain);</span>
<a href="#l48.65"></a><span id="l48.65"> </span>
<a href="#l48.66"></a><span id="l48.66">         if (out_dontAskAgain.value) {</span>
<a href="#l48.67"></a><span id="l48.67">             // save decision for all running calendars and</span>
<a href="#l48.68"></a><span id="l48.68">             // all future confirmations:</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineminus">-            var confirmedHttpLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span>
<a href="#l48.70"></a><span id="l48.70" class="difflineminus">-            if (confirmedHttpLogins.length &gt; 0) {</span>
<a href="#l48.71"></a><span id="l48.71" class="difflineminus">-                confirmedHttpLogins += &quot;,&quot;;</span>
<a href="#l48.72"></a><span id="l48.72" class="difflineplus">+            var newConfirmedLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span>
<a href="#l48.73"></a><span id="l48.73" class="difflineplus">+            if (newConfirmedLogins.length &gt; 0) {</span>
<a href="#l48.74"></a><span id="l48.74" class="difflineplus">+                newConfirmedLogins += &quot;,&quot;;</span>
<a href="#l48.75"></a><span id="l48.75">             }</span>
<a href="#l48.76"></a><span id="l48.76">             confirmedEntry = (bConfirmed ? &quot;1&quot; : &quot;0&quot;);</span>
<a href="#l48.77"></a><span id="l48.77" class="difflineminus">-            confirmedHttpLogins += (encodedHost + &quot;:&quot; + confirmedEntry);</span>
<a href="#l48.78"></a><span id="l48.78" class="difflineminus">-            Preferences.set(&quot;calendar.wcap.confirmed_http_logins&quot;, confirmedHttpLogins);</span>
<a href="#l48.79"></a><span id="l48.79" class="difflineplus">+            newConfirmedLogins += (encodedHost + &quot;:&quot; + confirmedEntry);</span>
<a href="#l48.80"></a><span id="l48.80" class="difflineplus">+            Preferences.set(&quot;calendar.wcap.confirmed_http_logins&quot;, newConfirmedLogins);</span>
<a href="#l48.81"></a><span id="l48.81">             getPref(&quot;calendar.wcap.confirmed_http_logins&quot;); // log written entry</span>
<a href="#l48.82"></a><span id="l48.82">             confirmInsecureLogin.m_confirmedHttpLogins[encodedHost] = confirmedEntry;</span>
<a href="#l48.83"></a><span id="l48.83">         }</span>
<a href="#l48.84"></a><span id="l48.84">     }</span>
<a href="#l48.85"></a><span id="l48.85"> </span>
<a href="#l48.86"></a><span id="l48.86">     log(&quot;returned: &quot; + bConfirmed, &quot;confirmInsecureLogin(&quot; + host + &quot;)&quot;);</span>
<a href="#l48.87"></a><span id="l48.87">     return bConfirmed;</span>
<a href="#l48.88"></a><span id="l48.88"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -14,17 +14,17 @@ function initLogging() {</span>
<a href="#l49.4"></a><span id="l49.4">     if (initLogging.mLogFilestream) {</span>
<a href="#l49.5"></a><span id="l49.5">         try {</span>
<a href="#l49.6"></a><span id="l49.6">             initLogging.mLogFilestream.close();</span>
<a href="#l49.7"></a><span id="l49.7">         } catch (exc) {</span>
<a href="#l49.8"></a><span id="l49.8">             ASSERT(false, exc);</span>
<a href="#l49.9"></a><span id="l49.9">         }</span>
<a href="#l49.10"></a><span id="l49.10">         initLogging.mLogFilestream = null;</span>
<a href="#l49.11"></a><span id="l49.11">     }</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-    </span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+</span>
<a href="#l49.14"></a><span id="l49.14">     LOG_LEVEL = getPref(&quot;calendar.wcap.log_level&quot;, 0);</span>
<a href="#l49.15"></a><span id="l49.15">     if (LOG_LEVEL &lt; 1 &amp;&amp; getPref(&quot;calendar.debug.log&quot;, false)) {</span>
<a href="#l49.16"></a><span id="l49.16">         LOG_LEVEL = 1; // at least basic logging when calendar.debug.log is set</span>
<a href="#l49.17"></a><span id="l49.17">     }</span>
<a href="#l49.18"></a><span id="l49.18"> </span>
<a href="#l49.19"></a><span id="l49.19">     if (LOG_LEVEL &gt; 0) {</span>
<a href="#l49.20"></a><span id="l49.20">         var logFileName = getPref(&quot;calendar.wcap.log_file&quot;, null);</span>
<a href="#l49.21"></a><span id="l49.21">         if (logFileName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -2,32 +2,30 @@</span>
<a href="#l50.4"></a><span id="l50.4"> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
<a href="#l50.5"></a><span id="l50.5">           &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<a href="#l50.6"></a><span id="l50.6"> </span>
<a href="#l50.7"></a><span id="l50.7"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l50.8"></a><span id="l50.8">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l50.9"></a><span id="l50.9">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l50.10"></a><span id="l50.10"> </span>
<a href="#l50.11"></a><span id="l50.11"> &lt;!--</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-/*  This defines &lt;datepicker/&gt; &lt;timepicker/&gt; and &lt;datetimepicker/&gt;</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    This defines &lt;datepicker/&gt; &lt;timepicker/&gt; and &lt;datetimepicker/&gt;</span>
<a href="#l50.14"></a><span id="l50.14">     which all descend from datetimepicker-base to get date/time parsing</span>
<a href="#l50.15"></a><span id="l50.15">     and consistent behavior.</span>
<a href="#l50.16"></a><span id="l50.16">     It relies on &lt;minimonth/&gt; for the date picker's drop down.</span>
<a href="#l50.17"></a><span id="l50.17">     You can be notified of change event as follows:</span>
<a href="#l50.18"></a><span id="l50.18">       &lt;datepicker id=&quot;my-date-picker&quot; onchange=&quot;myDatePick( this );&quot;/&gt;</span>
<a href="#l50.19"></a><span id="l50.19">     May get/set value in javascript with</span>
<a href="#l50.20"></a><span id="l50.20">       document.getElementById(&quot;my-date-picker&quot;).value = new Date();</span>
<a href="#l50.21"></a><span id="l50.21">     May disable/enable in javascript with</span>
<a href="#l50.22"></a><span id="l50.22">       document.getElementById(&quot;my-date-picker&quot;).disabled = true;</span>
<a href="#l50.23"></a><span id="l50.23">     May also disable/enable a datetimepicker's component</span>
<a href="#l50.24"></a><span id="l50.24">       datepicker or timepicker individually with</span>
<a href="#l50.25"></a><span id="l50.25">       document.getElementById(&quot;my-datetimepicker&quot;).datepickerdisabled = true;</span>
<a href="#l50.26"></a><span id="l50.26">       document.getElementById(&quot;my-datetimepicker&quot;).timepickerdisabled = true;</span>
<a href="#l50.27"></a><span id="l50.27" class="difflineminus">-</span>
<a href="#l50.28"></a><span id="l50.28" class="difflineminus">-*/</span>
<a href="#l50.29"></a><span id="l50.29"> --&gt;</span>
<a href="#l50.30"></a><span id="l50.30"> &lt;bindings id=&quot;xulDatePicker&quot;</span>
<a href="#l50.31"></a><span id="l50.31">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l50.32"></a><span id="l50.32">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l50.33"></a><span id="l50.33">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l50.34"></a><span id="l50.34"> </span>
<a href="#l50.35"></a><span id="l50.35">   &lt;binding id=&quot;datetextpicker&quot;</span>
<a href="#l50.36"></a><span id="l50.36">            extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;&gt;</span>
<a href="#l50.37"></a><span id="l50.37" class="difflineat">@@ -161,28 +159,28 @@</span>
<a href="#l50.38"></a><span id="l50.38">            val = val.replace(',', '');</span>
<a href="#l50.39"></a><span id="l50.39"> </span>
<a href="#l50.40"></a><span id="l50.40">            if (!val.includes(' ')) {</span>
<a href="#l50.41"></a><span id="l50.41">              // Just a single word, or a single date.</span>
<a href="#l50.42"></a><span id="l50.42">              return getDateForDay(val);</span>
<a href="#l50.43"></a><span id="l50.43">            }</span>
<a href="#l50.44"></a><span id="l50.44"> </span>
<a href="#l50.45"></a><span id="l50.45">            // Replace month names with numbers</span>
<a href="#l50.46"></a><span id="l50.46" class="difflineminus">-           for (var i in this.mMonthLongNames) {</span>
<a href="#l50.47"></a><span id="l50.47" class="difflineplus">+           for (let i in this.mMonthLongNames) {</span>
<a href="#l50.48"></a><span id="l50.48">              if (val.includes(this.mMonthLongNames[i])) {</span>
<a href="#l50.49"></a><span id="l50.49" class="difflineminus">-               var newVal = val.replace(this.mMonthLongNames[i], Number(i)+1);</span>
<a href="#l50.50"></a><span id="l50.50" class="difflineplus">+               let newVal = val.replace(this.mMonthLongNames[i], Number(i)+1);</span>
<a href="#l50.51"></a><span id="l50.51">                newVal = newVal.replace(' ', '/');</span>
<a href="#l50.52"></a><span id="l50.52">                return this.parseDateTime(newVal);</span>
<a href="#l50.53"></a><span id="l50.53">              }</span>
<a href="#l50.54"></a><span id="l50.54">           }</span>
<a href="#l50.55"></a><span id="l50.55"> </span>
<a href="#l50.56"></a><span id="l50.56">           // Same for short month names</span>
<a href="#l50.57"></a><span id="l50.57" class="difflineminus">-           for (var i in this.mMonthShortNames) {</span>
<a href="#l50.58"></a><span id="l50.58" class="difflineplus">+           for (let i in this.mMonthShortNames) {</span>
<a href="#l50.59"></a><span id="l50.59">              if (val.includes(this.mMonthShortNames[i])) {</span>
<a href="#l50.60"></a><span id="l50.60" class="difflineminus">-               var newVal = val.replace(this.mMonthShortNames[i], Number(i)+1);</span>
<a href="#l50.61"></a><span id="l50.61" class="difflineplus">+               let newVal = val.replace(this.mMonthShortNames[i], Number(i)+1);</span>
<a href="#l50.62"></a><span id="l50.62">                newVal = newVal.replace(' ', '/');</span>
<a href="#l50.63"></a><span id="l50.63">                return this.parseDateTime(newVal);</span>
<a href="#l50.64"></a><span id="l50.64">              }</span>
<a href="#l50.65"></a><span id="l50.65">           }</span>
<a href="#l50.66"></a><span id="l50.66"> </span>
<a href="#l50.67"></a><span id="l50.67">           // Now for the cool 'next' and 'last'</span>
<a href="#l50.68"></a><span id="l50.68">           var words = val.split(' ');</span>
<a href="#l50.69"></a><span id="l50.69">           var offset, day;</span>
<a href="#l50.70"></a><span id="l50.70" class="difflineat">@@ -614,17 +612,17 @@</span>
<a href="#l50.71"></a><span id="l50.71">               this.mValue = aValue;</span>
<a href="#l50.72"></a><span id="l50.72">             }</span>
<a href="#l50.73"></a><span id="l50.73">             // set textBox.value property, not attribute</span>
<a href="#l50.74"></a><span id="l50.74">             this.kTextBox.value = this.formatTime(this.mValue);</span>
<a href="#l50.75"></a><span id="l50.75"> </span>
<a href="#l50.76"></a><span id="l50.76">             if (aValue != null &amp;&amp; aRefresh &amp;&amp; timeChanged) {</span>
<a href="#l50.77"></a><span id="l50.77">               let event = document.createEvent('Events');</span>
<a href="#l50.78"></a><span id="l50.78">               event.initEvent(&quot;change&quot;, true, true);</span>
<a href="#l50.79"></a><span id="l50.79" class="difflineminus">-              this.dispatchEvent(event);;</span>
<a href="#l50.80"></a><span id="l50.80" class="difflineplus">+              this.dispatchEvent(event);</span>
<a href="#l50.81"></a><span id="l50.81">             }</span>
<a href="#l50.82"></a><span id="l50.82">           ]]&gt;</span>
<a href="#l50.83"></a><span id="l50.83">         &lt;/body&gt;</span>
<a href="#l50.84"></a><span id="l50.84">       &lt;/method&gt;</span>
<a href="#l50.85"></a><span id="l50.85"> </span>
<a href="#l50.86"></a><span id="l50.86">       &lt;method name=&quot;parseTextBoxTime&quot;&gt;</span>
<a href="#l50.87"></a><span id="l50.87">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l50.88"></a><span id="l50.88">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -37,45 +37,45 @@ function publishCalendarDataDialogRespon</span>
<a href="#l51.4"></a><span id="l51.4">  * Show publish dialog, ask for URL and publish all items from the calendar.</span>
<a href="#l51.5"></a><span id="l51.5">  *</span>
<a href="#l51.6"></a><span id="l51.6">  * @param aCalendar   (optional) The calendar that will be published. If ommitted</span>
<a href="#l51.7"></a><span id="l51.7">  *                               the user will be prompted to select a calendar.</span>
<a href="#l51.8"></a><span id="l51.8">  */</span>
<a href="#l51.9"></a><span id="l51.9"> function publishEntireCalendar(aCalendar)</span>
<a href="#l51.10"></a><span id="l51.10"> {</span>
<a href="#l51.11"></a><span id="l51.11">     if (!aCalendar) {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-        var count = new Object();</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-        var calendars = getCalendarManager().getCalendars(count);</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineplus">+        let count = {};</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineplus">+        let calendars = getCalendarManager().getCalendars(count);</span>
<a href="#l51.16"></a><span id="l51.16"> </span>
<a href="#l51.17"></a><span id="l51.17">         if (count.value == 1) {</span>
<a href="#l51.18"></a><span id="l51.18">             // Do not ask user for calendar if only one calendar exists</span>
<a href="#l51.19"></a><span id="l51.19">             aCalendar = calendars[0];</span>
<a href="#l51.20"></a><span id="l51.20">         } else {</span>
<a href="#l51.21"></a><span id="l51.21">             // Ask user to select the calendar that should be published.</span>
<a href="#l51.22"></a><span id="l51.22">             // publishEntireCalendar() will be called again if OK is pressed</span>
<a href="#l51.23"></a><span id="l51.23">             // in the dialog and the selected calendar will be passed in.</span>
<a href="#l51.24"></a><span id="l51.24">             // Therefore return after openDialog().</span>
<a href="#l51.25"></a><span id="l51.25" class="difflineminus">-            var args = new Object();</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineplus">+            let args = new Object();</span>
<a href="#l51.27"></a><span id="l51.27">             args.onOk = publishEntireCalendar;</span>
<a href="#l51.28"></a><span id="l51.28">             args.promptText = calGetString(&quot;calendar&quot;, &quot;publishPrompt&quot;);</span>
<a href="#l51.29"></a><span id="l51.29">             openDialog(&quot;chrome://calendar/content/chooseCalendarDialog.xul&quot;,</span>
<a href="#l51.30"></a><span id="l51.30">                        &quot;_blank&quot;, &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l51.31"></a><span id="l51.31">             return;</span>
<a href="#l51.32"></a><span id="l51.32">         }</span>
<a href="#l51.33"></a><span id="l51.33">     }</span>
<a href="#l51.34"></a><span id="l51.34"> </span>
<a href="#l51.35"></a><span id="l51.35" class="difflineminus">-    var args = new Object();</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineminus">-    var publishObject = new Object( );</span>
<a href="#l51.37"></a><span id="l51.37" class="difflineplus">+    let args = {};</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineplus">+    let publishObject = {};</span>
<a href="#l51.39"></a><span id="l51.39"> </span>
<a href="#l51.40"></a><span id="l51.40">     args.onOk =  self.publishEntireCalendarDialogResponse;</span>
<a href="#l51.41"></a><span id="l51.41"> </span>
<a href="#l51.42"></a><span id="l51.42">     publishObject.calendar = aCalendar;</span>
<a href="#l51.43"></a><span id="l51.43"> </span>
<a href="#l51.44"></a><span id="l51.44">     // restore the remote ics path preference from the calendar passed in</span>
<a href="#l51.45"></a><span id="l51.45" class="difflineminus">-    var remotePath = aCalendar.getProperty(&quot;remote-ics-path&quot;);</span>
<a href="#l51.46"></a><span id="l51.46" class="difflineplus">+    let remotePath = aCalendar.getProperty(&quot;remote-ics-path&quot;);</span>
<a href="#l51.47"></a><span id="l51.47">     if (remotePath &amp;&amp; remotePath.length &amp;&amp; remotePath.length &gt; 0) {</span>
<a href="#l51.48"></a><span id="l51.48">         publishObject.remotePath = remotePath;</span>
<a href="#l51.49"></a><span id="l51.49">     }</span>
<a href="#l51.50"></a><span id="l51.50"> </span>
<a href="#l51.51"></a><span id="l51.51">     args.publishObject = publishObject;</span>
<a href="#l51.52"></a><span id="l51.52">     openDialog(&quot;chrome://calendar/content/publishDialog.xul&quot;, &quot;caPublishEvents&quot;,</span>
<a href="#l51.53"></a><span id="l51.53">                &quot;chrome,titlebar,modal,resizable&quot;, args );</span>
<a href="#l51.54"></a><span id="l51.54"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/resources/content/publishDialog.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/resources/content/publishDialog.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -18,33 +18,33 @@ var gPublishObject;</span>
<a href="#l52.4"></a><span id="l52.4"> </span>
<a href="#l52.5"></a><span id="l52.5"> /**</span>
<a href="#l52.6"></a><span id="l52.6"> *   Called when the dialog is loaded.</span>
<a href="#l52.7"></a><span id="l52.7"> */</span>
<a href="#l52.8"></a><span id="l52.8"> </span>
<a href="#l52.9"></a><span id="l52.9"> function loadCalendarPublishDialog()</span>
<a href="#l52.10"></a><span id="l52.10"> {</span>
<a href="#l52.11"></a><span id="l52.11">    // Get arguments, see description at top of file</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-   </span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+</span>
<a href="#l52.14"></a><span id="l52.14">    var args = window.arguments[0];</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineminus">-   </span>
<a href="#l52.16"></a><span id="l52.16" class="difflineplus">+</span>
<a href="#l52.17"></a><span id="l52.17">    gOnOkFunction = args.onOk;</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineminus">-   </span>
<a href="#l52.19"></a><span id="l52.19" class="difflineplus">+</span>
<a href="#l52.20"></a><span id="l52.20">    if( args.publishObject )</span>
<a href="#l52.21"></a><span id="l52.21">    {</span>
<a href="#l52.22"></a><span id="l52.22">       gPublishObject = args.publishObject;</span>
<a href="#l52.23"></a><span id="l52.23">       if ( args.publishObject.remotePath )</span>
<a href="#l52.24"></a><span id="l52.24">           document.getElementById( &quot;publish-remotePath-textbox&quot; ).value = args.publishObject.remotePath;</span>
<a href="#l52.25"></a><span id="l52.25">    }</span>
<a href="#l52.26"></a><span id="l52.26">    else</span>
<a href="#l52.27"></a><span id="l52.27">    {</span>
<a href="#l52.28"></a><span id="l52.28">       gPublishObject = new Object();</span>
<a href="#l52.29"></a><span id="l52.29">    }</span>
<a href="#l52.30"></a><span id="l52.30" class="difflineminus">-   document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;label&quot;, publishButtonLabel );   </span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-   </span>
<a href="#l52.32"></a><span id="l52.32" class="difflineplus">+   document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;label&quot;, publishButtonLabel );</span>
<a href="#l52.33"></a><span id="l52.33" class="difflineplus">+</span>
<a href="#l52.34"></a><span id="l52.34">    checkURLField( );</span>
<a href="#l52.35"></a><span id="l52.35"> </span>
<a href="#l52.36"></a><span id="l52.36">    var firstFocus = document.getElementById( &quot;publish-remotePath-textbox&quot; );</span>
<a href="#l52.37"></a><span id="l52.37">    firstFocus.focus();</span>
<a href="#l52.38"></a><span id="l52.38"> }</span>
<a href="#l52.39"></a><span id="l52.39"> </span>
<a href="#l52.40"></a><span id="l52.40"> </span>
<a href="#l52.41"></a><span id="l52.41"> </span>
<a href="#l52.42"></a><span id="l52.42" class="difflineat">@@ -53,17 +53,17 @@ function loadCalendarPublishDialog()</span>
<a href="#l52.43"></a><span id="l52.43"> */</span>
<a href="#l52.44"></a><span id="l52.44"> </span>
<a href="#l52.45"></a><span id="l52.45"> function onOKCommand()</span>
<a href="#l52.46"></a><span id="l52.46"> {</span>
<a href="#l52.47"></a><span id="l52.47">    gPublishObject.remotePath = document.getElementById( &quot;publish-remotePath-textbox&quot; ).value;</span>
<a href="#l52.48"></a><span id="l52.48"> </span>
<a href="#l52.49"></a><span id="l52.49">    // call caller's on OK function</span>
<a href="#l52.50"></a><span id="l52.50">    gOnOkFunction(gPublishObject, progressDialog);</span>
<a href="#l52.51"></a><span id="l52.51" class="difflineminus">-   document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;label&quot;, closeButtonLabel );   </span>
<a href="#l52.52"></a><span id="l52.52" class="difflineplus">+   document.getElementById( &quot;calendar-publishwindow&quot; ).getButton( &quot;accept&quot; ).setAttribute( &quot;label&quot;, closeButtonLabel );</span>
<a href="#l52.53"></a><span id="l52.53">    document.getElementById( &quot;calendar-publishwindow&quot; ).setAttribute( &quot;ondialogaccept&quot;, &quot;closeDialog()&quot; );</span>
<a href="#l52.54"></a><span id="l52.54">    return( false );</span>
<a href="#l52.55"></a><span id="l52.55"> }</span>
<a href="#l52.56"></a><span id="l52.56"> </span>
<a href="#l52.57"></a><span id="l52.57"> </span>
<a href="#l52.58"></a><span id="l52.58"> function checkURLField( )</span>
<a href="#l52.59"></a><span id="l52.59"> {</span>
<a href="#l52.60"></a><span id="l52.60">    if( document.getElementById( &quot;publish-remotePath-textbox&quot; ).value.length == 0 )</span>
<a href="#l52.61"></a><span id="l52.61" class="difflineat">@@ -76,14 +76,14 @@ function closeDialog( )</span>
<a href="#l52.62"></a><span id="l52.62"> {</span>
<a href="#l52.63"></a><span id="l52.63">    self.close( );</span>
<a href="#l52.64"></a><span id="l52.64"> }</span>
<a href="#l52.65"></a><span id="l52.65"> </span>
<a href="#l52.66"></a><span id="l52.66"> var progressDialog = {</span>
<a href="#l52.67"></a><span id="l52.67">     onStartUpload: function() {</span>
<a href="#l52.68"></a><span id="l52.68">         document.getElementById( &quot;publish-progressmeter&quot; ).setAttribute( &quot;mode&quot;, &quot;undetermined&quot; );</span>
<a href="#l52.69"></a><span id="l52.69">     },</span>
<a href="#l52.70"></a><span id="l52.70" class="difflineminus">-    </span>
<a href="#l52.71"></a><span id="l52.71" class="difflineplus">+</span>
<a href="#l52.72"></a><span id="l52.72">     onStopUpload: function() {</span>
<a href="#l52.73"></a><span id="l52.73">         document.getElementById( &quot;publish-progressmeter&quot; ).setAttribute( &quot;mode&quot;, &quot;determined&quot; );</span>
<a href="#l52.74"></a><span id="l52.74">     }</span>
<a href="#l52.75"></a><span id="l52.75"> };</span>
<a href="#l52.76"></a><span id="l52.76"> progressDialog.wrappedJSObject = progressDialog;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -34,41 +34,41 @@ var testEventDialog = function () {</span>
<a href="#l53.4"></a><span id="l53.4">     + 'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/'</span>
<a href="#l53.5"></a><span id="l53.5">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/'</span>
<a href="#l53.6"></a><span id="l53.6">     + '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l53.7"></a><span id="l53.7">     + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l53.8"></a><span id="l53.8"> </span>
<a href="#l53.9"></a><span id="l53.9">   // open month view</span>
<a href="#l53.10"></a><span id="l53.10">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l53.11"></a><span id="l53.11">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-    </span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+</span>
<a href="#l53.14"></a><span id="l53.14">   // pick year</span>
<a href="#l53.15"></a><span id="l53.15">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l53.16"></a><span id="l53.16">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l53.17"></a><span id="l53.17">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l53.18"></a><span id="l53.18">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l53.19"></a><span id="l53.19">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l53.20"></a><span id="l53.20" class="difflineminus">-  </span>
<a href="#l53.21"></a><span id="l53.21" class="difflineplus">+</span>
<a href="#l53.22"></a><span id="l53.22">   // pick month</span>
<a href="#l53.23"></a><span id="l53.23">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l53.24"></a><span id="l53.24">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l53.25"></a><span id="l53.25">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l53.26"></a><span id="l53.26">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l53.27"></a><span id="l53.27">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l53.28"></a><span id="l53.28"> </span>
<a href="#l53.29"></a><span id="l53.29">   // pick day</span>
<a href="#l53.30"></a><span id="l53.30">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l53.31"></a><span id="l53.31">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l53.32"></a><span id="l53.32">   controller.sleep(sleep);</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-  </span>
<a href="#l53.34"></a><span id="l53.34" class="difflineplus">+</span>
<a href="#l53.35"></a><span id="l53.35">   // create new event</span>
<a href="#l53.36"></a><span id="l53.36">   controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l53.37"></a><span id="l53.37">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l53.38"></a><span id="l53.38">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineminus">-  </span>
<a href="#l53.40"></a><span id="l53.40" class="difflineplus">+</span>
<a href="#l53.41"></a><span id="l53.41">   // check that the start time is correct</span>
<a href="#l53.42"></a><span id="l53.42">   // next full hour except last hour hour of the day</span>
<a href="#l53.43"></a><span id="l53.43">   let now = new Date();</span>
<a href="#l53.44"></a><span id="l53.44">   let hour = now.getHours();</span>
<a href="#l53.45"></a><span id="l53.45">   let startHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l53.46"></a><span id="l53.46">   let ampm = &quot;&quot;;</span>
<a href="#l53.47"></a><span id="l53.47">   if (now.toLocaleTimeString().match(/AM|PM/)) {</span>
<a href="#l53.48"></a><span id="l53.48">     ampm = (hour &gt;= 12 ? &quot; PM&quot; : &quot; AM&quot;)</span>
<a href="#l53.49"></a><span id="l53.49" class="difflineat">@@ -81,179 +81,179 @@ var testEventDialog = function () {</span>
<a href="#l53.50"></a><span id="l53.50">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l53.51"></a><span id="l53.51">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l53.52"></a><span id="l53.52">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l53.53"></a><span id="l53.53">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/'</span>
<a href="#l53.54"></a><span id="l53.54">     + 'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l53.55"></a><span id="l53.55">     );</span>
<a href="#l53.56"></a><span id="l53.56">   event.waitForElement(startTimeInput);</span>
<a href="#l53.57"></a><span id="l53.57">   event.assertValue(startTimeInput, startTime);</span>
<a href="#l53.58"></a><span id="l53.58" class="difflineminus">-  </span>
<a href="#l53.59"></a><span id="l53.59" class="difflineplus">+</span>
<a href="#l53.60"></a><span id="l53.60">   // check selected calendar</span>
<a href="#l53.61"></a><span id="l53.61">   event.assertNode(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l53.62"></a><span id="l53.62">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/'</span>
<a href="#l53.63"></a><span id="l53.63">     + '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'))</span>
<a href="#l53.64"></a><span id="l53.64" class="difflineminus">-  </span>
<a href="#l53.65"></a><span id="l53.65" class="difflineplus">+</span>
<a href="#l53.66"></a><span id="l53.66">   // fill in name, location, description</span>
<a href="#l53.67"></a><span id="l53.67">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l53.68"></a><span id="l53.68">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l53.69"></a><span id="l53.69">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l53.70"></a><span id="l53.70">     title);</span>
<a href="#l53.71"></a><span id="l53.71">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l53.72"></a><span id="l53.72">     + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l53.73"></a><span id="l53.73">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'), location);</span>
<a href="#l53.74"></a><span id="l53.74">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l53.75"></a><span id="l53.75">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l53.76"></a><span id="l53.76">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l53.77"></a><span id="l53.77">     desc);</span>
<a href="#l53.78"></a><span id="l53.78" class="difflineminus">-  </span>
<a href="#l53.79"></a><span id="l53.79" class="difflineplus">+</span>
<a href="#l53.80"></a><span id="l53.80">   // set category</span>
<a href="#l53.81"></a><span id="l53.81">   let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l53.82"></a><span id="l53.82">   let category = categories.split(',')[4]; // pick 4th value in a comma-separated list</span>
<a href="#l53.83"></a><span id="l53.83">   event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), null, category);</span>
<a href="#l53.84"></a><span id="l53.84"> </span>
<a href="#l53.85"></a><span id="l53.85">   // repeat daily</span>
<a href="#l53.86"></a><span id="l53.86">   event.click(new elementslib.ID(event.window.document, &quot;repeat-daily-menuitem&quot;));</span>
<a href="#l53.87"></a><span id="l53.87" class="difflineminus">-  </span>
<a href="#l53.88"></a><span id="l53.88" class="difflineplus">+</span>
<a href="#l53.89"></a><span id="l53.89">   // add reminder</span>
<a href="#l53.90"></a><span id="l53.90">   event.click(new elementslib.ID(event.window.document, &quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l53.91"></a><span id="l53.91" class="difflineminus">-  </span>
<a href="#l53.92"></a><span id="l53.92" class="difflineplus">+</span>
<a href="#l53.93"></a><span id="l53.93">   // add an attendee and verify added</span>
<a href="#l53.94"></a><span id="l53.94">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l53.95"></a><span id="l53.95">   md.start(handleAttendees);</span>
<a href="#l53.96"></a><span id="l53.96">   event.click(new elementslib.ID(event.window.document, &quot;button-attendees&quot;));</span>
<a href="#l53.97"></a><span id="l53.97">   event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l53.98"></a><span id="l53.98">     attendee);</span>
<a href="#l53.99"></a><span id="l53.99" class="difflineminus">-  </span>
<a href="#l53.100"></a><span id="l53.100" class="difflineplus">+</span>
<a href="#l53.101"></a><span id="l53.101">   // make it private and verify label visible</span>
<a href="#l53.102"></a><span id="l53.102">   event.click(new elementslib.ID(event.window.document, &quot;button-privacy&quot;));</span>
<a href="#l53.103"></a><span id="l53.103">   event.click(new elementslib.ID(event.window.document, &quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l53.104"></a><span id="l53.104">   let label = (new elementslib.ID(event.window.document, &quot;status-privacy-private-box&quot;));</span>
<a href="#l53.105"></a><span id="l53.105">   event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l53.106"></a><span id="l53.106" class="difflineminus">-  </span>
<a href="#l53.107"></a><span id="l53.107" class="difflineplus">+</span>
<a href="#l53.108"></a><span id="l53.108">   // add attachment and verify added</span>
<a href="#l53.109"></a><span id="l53.109">   calUtils.handleAddingAttachment(event, url);</span>
<a href="#l53.110"></a><span id="l53.110">   event.click(new elementslib.ID(event.window.document, &quot;button-url&quot;));</span>
<a href="#l53.111"></a><span id="l53.111">   event.assertNode(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l53.112"></a><span id="l53.112">     + 'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l53.113"></a><span id="l53.113" class="difflineminus">-  </span>
<a href="#l53.114"></a><span id="l53.114" class="difflineplus">+</span>
<a href="#l53.115"></a><span id="l53.115">   // save</span>
<a href="#l53.116"></a><span id="l53.116">   calUtils.acceptSendingNotificationMail(event);</span>
<a href="#l53.117"></a><span id="l53.117">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l53.118"></a><span id="l53.118" class="difflineminus">-  </span>
<a href="#l53.119"></a><span id="l53.119" class="difflineplus">+</span>
<a href="#l53.120"></a><span id="l53.120">   // catch and dismiss alarm</span>
<a href="#l53.121"></a><span id="l53.121">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0}, sleep);</span>
<a href="#l53.122"></a><span id="l53.122">   let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l53.123"></a><span id="l53.123">   // dismiss all button, label in .dtd file, bug #504635</span>
<a href="#l53.124"></a><span id="l53.124">   alarm.waitThenClick(new elementslib.Lookup(alarm.window.document, '/id(&quot;calendar-alarm-dialog&quot;)/'</span>
<a href="#l53.125"></a><span id="l53.125">     + 'id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l53.126"></a><span id="l53.126">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0}, sleep);</span>
<a href="#l53.127"></a><span id="l53.127" class="difflineminus">-  </span>
<a href="#l53.128"></a><span id="l53.128" class="difflineplus">+</span>
<a href="#l53.129"></a><span id="l53.129">   // verify event and alarm icon visible every day of the month and check tooltip</span>
<a href="#l53.130"></a><span id="l53.130">   // 1st January is Thursday so there's three days to check in the first row</span>
<a href="#l53.131"></a><span id="l53.131" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.132"></a><span id="l53.132" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.133"></a><span id="l53.133">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l53.134"></a><span id="l53.134">   checkIcon(eventBox, &quot;0&quot;, &quot;4&quot;);</span>
<a href="#l53.135"></a><span id="l53.135">   checkTooltip(monthView, &quot;0&quot;, &quot;4&quot;, &quot;1&quot;, startTime, endTime);</span>
<a href="#l53.136"></a><span id="l53.136" class="difflineminus">-  </span>
<a href="#l53.137"></a><span id="l53.137" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.138"></a><span id="l53.138" class="difflineplus">+</span>
<a href="#l53.139"></a><span id="l53.139" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.140"></a><span id="l53.140">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l53.141"></a><span id="l53.141">   checkIcon(eventBox, &quot;0&quot;, &quot;5&quot;);</span>
<a href="#l53.142"></a><span id="l53.142">   checkTooltip(monthView, &quot;0&quot;, &quot;5&quot;, &quot;2&quot;, startTime, endTime);</span>
<a href="#l53.143"></a><span id="l53.143" class="difflineminus">-  </span>
<a href="#l53.144"></a><span id="l53.144" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.145"></a><span id="l53.145" class="difflineplus">+</span>
<a href="#l53.146"></a><span id="l53.146" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.147"></a><span id="l53.147">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l53.148"></a><span id="l53.148">   checkIcon(eventBox, &quot;0&quot;, &quot;6&quot;);</span>
<a href="#l53.149"></a><span id="l53.149">   checkTooltip(monthView, &quot;0&quot;, &quot;6&quot;, &quot;3&quot;, startTime, endTime);</span>
<a href="#l53.150"></a><span id="l53.150" class="difflineminus">-  </span>
<a href="#l53.151"></a><span id="l53.151" class="difflineplus">+</span>
<a href="#l53.152"></a><span id="l53.152">   // 31st of January is Saturday so there's four more full rows to check</span>
<a href="#l53.153"></a><span id="l53.153">   let date = 4;</span>
<a href="#l53.154"></a><span id="l53.154">   for(row = 1; row &lt; 5; row++){</span>
<a href="#l53.155"></a><span id="l53.155">     for(col = 0; col &lt; 7; col++){</span>
<a href="#l53.156"></a><span id="l53.156" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.157"></a><span id="l53.157" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.158"></a><span id="l53.158">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l53.159"></a><span id="l53.159">         checkIcon(eventBox, row, col);</span>
<a href="#l53.160"></a><span id="l53.160">         checkTooltip(monthView, row, col, date, startTime, endTime);</span>
<a href="#l53.161"></a><span id="l53.161">         date++;</span>
<a href="#l53.162"></a><span id="l53.162">     }</span>
<a href="#l53.163"></a><span id="l53.163">   }</span>
<a href="#l53.164"></a><span id="l53.164" class="difflineminus">-  </span>
<a href="#l53.165"></a><span id="l53.165" class="difflineplus">+</span>
<a href="#l53.166"></a><span id="l53.166">   // delete and verify deleted 2nd Jan</span>
<a href="#l53.167"></a><span id="l53.167">   calUtils.handleOccurrenceDeletion(controller);</span>
<a href="#l53.168"></a><span id="l53.168" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.169"></a><span id="l53.169" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.170"></a><span id="l53.170">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l53.171"></a><span id="l53.171">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l53.172"></a><span id="l53.172">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l53.173"></a><span id="l53.173" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.174"></a><span id="l53.174" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.175"></a><span id="l53.175">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l53.176"></a><span id="l53.176" class="difflineminus">-  </span>
<a href="#l53.177"></a><span id="l53.177" class="difflineplus">+</span>
<a href="#l53.178"></a><span id="l53.178">   // verify all others still exist</span>
<a href="#l53.179"></a><span id="l53.179" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.180"></a><span id="l53.180" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.181"></a><span id="l53.181">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l53.182"></a><span id="l53.182" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.183"></a><span id="l53.183" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.184"></a><span id="l53.184">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l53.185"></a><span id="l53.185" class="difflineminus">-    </span>
<a href="#l53.186"></a><span id="l53.186" class="difflineplus">+</span>
<a href="#l53.187"></a><span id="l53.187">   for(row = 1; row &lt; 5; row++)</span>
<a href="#l53.188"></a><span id="l53.188">     for(col = 0; col &lt; 7; col++)</span>
<a href="#l53.189"></a><span id="l53.189" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.190"></a><span id="l53.190" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.191"></a><span id="l53.191">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l53.192"></a><span id="l53.192" class="difflineminus">-  </span>
<a href="#l53.193"></a><span id="l53.193" class="difflineplus">+</span>
<a href="#l53.194"></a><span id="l53.194">   // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l53.195"></a><span id="l53.195">   calUtils.handleParentDeletion(controller);</span>
<a href="#l53.196"></a><span id="l53.196" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.197"></a><span id="l53.197" class="difflineplus">+  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.198"></a><span id="l53.198">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l53.199"></a><span id="l53.199">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l53.200"></a><span id="l53.200">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l53.201"></a><span id="l53.201" class="difflineminus">-  </span>
<a href="#l53.202"></a><span id="l53.202" class="difflineplus">+</span>
<a href="#l53.203"></a><span id="l53.203">   // verify all deleted</span>
<a href="#l53.204"></a><span id="l53.204" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.205"></a><span id="l53.205" class="difflineplus">+  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.206"></a><span id="l53.206">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l53.207"></a><span id="l53.207" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.208"></a><span id="l53.208" class="difflineplus">+  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.209"></a><span id="l53.209">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l53.210"></a><span id="l53.210" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.211"></a><span id="l53.211" class="difflineplus">+  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.212"></a><span id="l53.212">     eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l53.213"></a><span id="l53.213" class="difflineminus">-    </span>
<a href="#l53.214"></a><span id="l53.214" class="difflineplus">+</span>
<a href="#l53.215"></a><span id="l53.215">   for(row = 1; row &lt; 5; row++)</span>
<a href="#l53.216"></a><span id="l53.216">     for(col = 0; col &lt; 7; col++)</span>
<a href="#l53.217"></a><span id="l53.217" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.218"></a><span id="l53.218" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.219"></a><span id="l53.219">           eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l53.220"></a><span id="l53.220"> }</span>
<a href="#l53.221"></a><span id="l53.221"> </span>
<a href="#l53.222"></a><span id="l53.222"> function handleAttendees(attendees){</span>
<a href="#l53.223"></a><span id="l53.223">   let input = new elementslib.Lookup(attendees.window.document,</span>
<a href="#l53.224"></a><span id="l53.224">     '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/'</span>
<a href="#l53.225"></a><span id="l53.225">     + 'anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/'</span>
<a href="#l53.226"></a><span id="l53.226">     + 'anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/'</span>
<a href="#l53.227"></a><span id="l53.227">     + '{&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l53.228"></a><span id="l53.228">   attendees.waitForElement(input);</span>
<a href="#l53.229"></a><span id="l53.229">   attendees.type(input, attendee);</span>
<a href="#l53.230"></a><span id="l53.230" class="difflineminus">-  attendees.click(new elementslib.Lookup(attendees.window.document, </span>
<a href="#l53.231"></a><span id="l53.231" class="difflineplus">+  attendees.click(new elementslib.Lookup(attendees.window.document,</span>
<a href="#l53.232"></a><span id="l53.232">     '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l53.233"></a><span id="l53.233"> }</span>
<a href="#l53.234"></a><span id="l53.234"> </span>
<a href="#l53.235"></a><span id="l53.235"> function checkIcon(eventBox, row, col){</span>
<a href="#l53.236"></a><span id="l53.236">   let icon = new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.237"></a><span id="l53.237">     (eventBox + '/anon({&quot;anonid&quot;:&quot;category-box-stack&quot;})/anon({&quot;align&quot;: &quot;right&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/anon({&quot;class&quot;: &quot;reminder-icon&quot;})')</span>
<a href="#l53.238"></a><span id="l53.238">     .replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l53.239"></a><span id="l53.239">   controller.assertJS(icon.getNode().getAttribute(&quot;value&quot;) == &quot;DISPLAY&quot;);</span>
<a href="#l53.240"></a><span id="l53.240"> }</span>
<a href="#l53.241"></a><span id="l53.241"> </span>
<a href="#l53.242"></a><span id="l53.242"> function checkTooltip(monthView, row, col, date, startTime, endTime){</span>
<a href="#l53.243"></a><span id="l53.243">   let mouseOverItem = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/'</span>
<a href="#l53.244"></a><span id="l53.244">     + 'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/'</span>
<a href="#l53.245"></a><span id="l53.245">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l53.246"></a><span id="l53.246" class="difflineminus">-  controller.mouseOver(new elementslib.Lookup(controller.window.document, </span>
<a href="#l53.247"></a><span id="l53.247" class="difflineplus">+  controller.mouseOver(new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.248"></a><span id="l53.248">           mouseOverItem.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l53.249"></a><span id="l53.249" class="difflineminus">-  </span>
<a href="#l53.250"></a><span id="l53.250" class="difflineplus">+</span>
<a href="#l53.251"></a><span id="l53.251">   // check title</span>
<a href="#l53.252"></a><span id="l53.252">   let eventName = new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.253"></a><span id="l53.253">     '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/'</span>
<a href="#l53.254"></a><span id="l53.254">     + '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[0]/[1]');</span>
<a href="#l53.255"></a><span id="l53.255">   controller.assertJS(eventName.getNode().textContent == title);</span>
<a href="#l53.256"></a><span id="l53.256" class="difflineminus">-  </span>
<a href="#l53.257"></a><span id="l53.257" class="difflineplus">+</span>
<a href="#l53.258"></a><span id="l53.258">   // check date and time</span>
<a href="#l53.259"></a><span id="l53.259">   // date-time string contains strings formatted in operating system language so check numeric values only</span>
<a href="#l53.260"></a><span id="l53.260">   let dateTime = new elementslib.Lookup(controller.window.document,</span>
<a href="#l53.261"></a><span id="l53.261">     '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/'</span>
<a href="#l53.262"></a><span id="l53.262">     + '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]').getNode().textContent + '';</span>
<a href="#l53.263"></a><span id="l53.263">   controller.assertJS(dateTime.includes(date) &amp;&amp; dateTime.includes(startTime)</span>
<a href="#l53.264"></a><span id="l53.264">     &amp;&amp; dateTime.includes(endTime));</span>
<a href="#l53.265"></a><span id="l53.265"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -27,116 +27,116 @@ var newlines = [{title: &quot;title&quot;, descrip</span>
<a href="#l54.4"></a><span id="l54.4">                 {title: &quot;title&quot;, description: &quot;\ntest newline\n&quot;},</span>
<a href="#l54.5"></a><span id="l54.5">                 {title: &quot;title&quot;, description: &quot;\rtest \\r\r&quot;},</span>
<a href="#l54.6"></a><span id="l54.6">                 {title: &quot;title&quot;, description: &quot;\r\ntest \\r\\n\r\n&quot;},</span>
<a href="#l54.7"></a><span id="l54.7">                 {title: &quot;title&quot;, description: &quot;\ttest \\t\t&quot;}];</span>
<a href="#l54.8"></a><span id="l54.8"> </span>
<a href="#l54.9"></a><span id="l54.9"> var setupModule = function(module) {</span>
<a href="#l54.10"></a><span id="l54.10">   controller = mozmill.getMail3PaneController();</span>
<a href="#l54.11"></a><span id="l54.11">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  </span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+</span>
<a href="#l54.14"></a><span id="l54.14">   let categories = prefs.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(',');</span>
<a href="#l54.15"></a><span id="l54.15">   data[0].category = categories[0];</span>
<a href="#l54.16"></a><span id="l54.16">   data[1].category = categories[1];</span>
<a href="#l54.17"></a><span id="l54.17"> }</span>
<a href="#l54.18"></a><span id="l54.18"> </span>
<a href="#l54.19"></a><span id="l54.19"> // Test that closing an event dialog with no changes does not prompt for save</span>
<a href="#l54.20"></a><span id="l54.20"> var testEventDialogModificationPrompt = function () {</span>
<a href="#l54.21"></a><span id="l54.21">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l54.22"></a><span id="l54.22">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l54.23"></a><span id="l54.23">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l54.24"></a><span id="l54.24" class="difflineminus">-  </span>
<a href="#l54.25"></a><span id="l54.25" class="difflineplus">+</span>
<a href="#l54.26"></a><span id="l54.26">   // create new event</span>
<a href="#l54.27"></a><span id="l54.27">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.28"></a><span id="l54.28">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l54.29"></a><span id="l54.29">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l54.30"></a><span id="l54.30">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l54.31"></a><span id="l54.31">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineminus">-  </span>
<a href="#l54.33"></a><span id="l54.33" class="difflineplus">+</span>
<a href="#l54.34"></a><span id="l54.34">   // enter first set of data</span>
<a href="#l54.35"></a><span id="l54.35">   calUtils.setData(event, data[0]);</span>
<a href="#l54.36"></a><span id="l54.36" class="difflineminus">-  </span>
<a href="#l54.37"></a><span id="l54.37" class="difflineplus">+</span>
<a href="#l54.38"></a><span id="l54.38">   // save</span>
<a href="#l54.39"></a><span id="l54.39">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l54.40"></a><span id="l54.40" class="difflineminus">-  </span>
<a href="#l54.41"></a><span id="l54.41" class="difflineplus">+</span>
<a href="#l54.42"></a><span id="l54.42">   // open, but change nothing</span>
<a href="#l54.43"></a><span id="l54.43">   let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.44"></a><span id="l54.44">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l54.45"></a><span id="l54.45">     + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l54.46"></a><span id="l54.46">   controller.waitForElement(eventBox);</span>
<a href="#l54.47"></a><span id="l54.47">   controller.doubleClick(eventBox);</span>
<a href="#l54.48"></a><span id="l54.48">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l54.49"></a><span id="l54.49">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l54.50"></a><span id="l54.50">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l54.51"></a><span id="l54.51" class="difflineminus">-  </span>
<a href="#l54.52"></a><span id="l54.52" class="difflineplus">+</span>
<a href="#l54.53"></a><span id="l54.53">   // modal dialog setup</span>
<a href="#l54.54"></a><span id="l54.54">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l54.55"></a><span id="l54.55">   md.start(handleSavePrompt);</span>
<a href="#l54.56"></a><span id="l54.56" class="difflineminus">-  </span>
<a href="#l54.57"></a><span id="l54.57" class="difflineplus">+</span>
<a href="#l54.58"></a><span id="l54.58">   // escape the event window, there should be no prompt to save event</span>
<a href="#l54.59"></a><span id="l54.59">   event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l54.60"></a><span id="l54.60">   controller.sleep(sleep);</span>
<a href="#l54.61"></a><span id="l54.61">   md.stop();</span>
<a href="#l54.62"></a><span id="l54.62" class="difflineminus">-  </span>
<a href="#l54.63"></a><span id="l54.63" class="difflineplus">+</span>
<a href="#l54.64"></a><span id="l54.64">   // open</span>
<a href="#l54.65"></a><span id="l54.65">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.66"></a><span id="l54.66">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l54.67"></a><span id="l54.67">     + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l54.68"></a><span id="l54.68">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l54.69"></a><span id="l54.69">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l54.70"></a><span id="l54.70">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l54.71"></a><span id="l54.71" class="difflineminus">-  </span>
<a href="#l54.72"></a><span id="l54.72" class="difflineplus">+</span>
<a href="#l54.73"></a><span id="l54.73">   // change all values</span>
<a href="#l54.74"></a><span id="l54.74">   calUtils.setData(event, data[1]);</span>
<a href="#l54.75"></a><span id="l54.75" class="difflineminus">-  </span>
<a href="#l54.76"></a><span id="l54.76" class="difflineplus">+</span>
<a href="#l54.77"></a><span id="l54.77">   // edit all values back to original</span>
<a href="#l54.78"></a><span id="l54.78">   calUtils.setData(event, data[0]);</span>
<a href="#l54.79"></a><span id="l54.79" class="difflineminus">-  </span>
<a href="#l54.80"></a><span id="l54.80" class="difflineplus">+</span>
<a href="#l54.81"></a><span id="l54.81">   // this is set up after data entry because otherwise it tries to handle attachment dialog</span>
<a href="#l54.82"></a><span id="l54.82">   md = new modalDialog.modalDialog(event.window);</span>
<a href="#l54.83"></a><span id="l54.83">   md.start(handleSavePrompt);</span>
<a href="#l54.84"></a><span id="l54.84"> </span>
<a href="#l54.85"></a><span id="l54.85">   // escape the event window, there should be no prompt to save event</span>
<a href="#l54.86"></a><span id="l54.86">   event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l54.87"></a><span id="l54.87" class="difflineminus">-  controller.sleep(sleep); </span>
<a href="#l54.88"></a><span id="l54.88" class="difflineplus">+  controller.sleep(sleep);</span>
<a href="#l54.89"></a><span id="l54.89">   md.stop();</span>
<a href="#l54.90"></a><span id="l54.90" class="difflineminus">-  </span>
<a href="#l54.91"></a><span id="l54.91" class="difflineplus">+</span>
<a href="#l54.92"></a><span id="l54.92">   // delete event</span>
<a href="#l54.93"></a><span id="l54.93">   controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.94"></a><span id="l54.94">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l54.95"></a><span id="l54.95">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l54.96"></a><span id="l54.96">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l54.97"></a><span id="l54.97">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.98"></a><span id="l54.98">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l54.99"></a><span id="l54.99" class="difflineminus">-  </span>
<a href="#l54.100"></a><span id="l54.100" class="difflineplus">+</span>
<a href="#l54.101"></a><span id="l54.101">   for(let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l54.102"></a><span id="l54.102">     // test set i</span>
<a href="#l54.103"></a><span id="l54.103">     controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.104"></a><span id="l54.104">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l54.105"></a><span id="l54.105">     controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l54.106"></a><span id="l54.106">     event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l54.107"></a><span id="l54.107">       .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l54.108"></a><span id="l54.108">     calUtils.setData(event, newlines[i]);</span>
<a href="#l54.109"></a><span id="l54.109">     event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l54.110"></a><span id="l54.110" class="difflineminus">-    </span>
<a href="#l54.111"></a><span id="l54.111" class="difflineplus">+</span>
<a href="#l54.112"></a><span id="l54.112">     // open and close</span>
<a href="#l54.113"></a><span id="l54.113">     eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.114"></a><span id="l54.114">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l54.115"></a><span id="l54.115">       + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l54.116"></a><span id="l54.116">     controller.waitForElement(eventBox);</span>
<a href="#l54.117"></a><span id="l54.117">     controller.doubleClick(eventBox);</span>
<a href="#l54.118"></a><span id="l54.118">     controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l54.119"></a><span id="l54.119">     event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l54.120"></a><span id="l54.120">       .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l54.121"></a><span id="l54.121">     md = new modalDialog.modalDialog(event.window);</span>
<a href="#l54.122"></a><span id="l54.122">     md.start(handleSavePrompt);</span>
<a href="#l54.123"></a><span id="l54.123">     event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l54.124"></a><span id="l54.124">     controller.sleep(sleep);</span>
<a href="#l54.125"></a><span id="l54.125">     md.stop();</span>
<a href="#l54.126"></a><span id="l54.126" class="difflineminus">-    </span>
<a href="#l54.127"></a><span id="l54.127" class="difflineplus">+</span>
<a href="#l54.128"></a><span id="l54.128">     // delete it</span>
<a href="#l54.129"></a><span id="l54.129">     // XXX somehow the event is selected at this point, this didn't use to be the case</span>
<a href="#l54.130"></a><span id="l54.130">     // and can't be reproduced manually</span>
<a href="#l54.131"></a><span id="l54.131">     /*controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l54.132"></a><span id="l54.132">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));*/</span>
<a href="#l54.133"></a><span id="l54.133">     controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l54.134"></a><span id="l54.134">       &quot;VK_DELETE&quot;, {});</span>
<a href="#l54.135"></a><span id="l54.135">     controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -13,74 +13,74 @@ var UTF8string = &quot;&quot;;</span>
<a href="#l55.4"></a><span id="l55.4"> var setupModule = function(module) {</span>
<a href="#l55.5"></a><span id="l55.5">   controller = mozmill.getMail3PaneController();</span>
<a href="#l55.6"></a><span id="l55.6">   calUtils.createCalendar(controller, UTF8string);</span>
<a href="#l55.7"></a><span id="l55.7">   Preferences.set(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l55.8"></a><span id="l55.8"> }</span>
<a href="#l55.9"></a><span id="l55.9"> </span>
<a href="#l55.10"></a><span id="l55.10"> var testUTF8 = function () {</span>
<a href="#l55.11"></a><span id="l55.11">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  </span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+</span>
<a href="#l55.14"></a><span id="l55.14">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l55.15"></a><span id="l55.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineminus">-  </span>
<a href="#l55.17"></a><span id="l55.17" class="difflineplus">+</span>
<a href="#l55.18"></a><span id="l55.18">   // create new event</span>
<a href="#l55.19"></a><span id="l55.19">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l55.20"></a><span id="l55.20">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l55.21"></a><span id="l55.21">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l55.22"></a><span id="l55.22">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l55.23"></a><span id="l55.23" class="difflineminus">-  </span>
<a href="#l55.24"></a><span id="l55.24" class="difflineplus">+</span>
<a href="#l55.25"></a><span id="l55.25">   // fill in name, location, description</span>
<a href="#l55.26"></a><span id="l55.26">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l55.27"></a><span id="l55.27">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l55.28"></a><span id="l55.28">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l55.29"></a><span id="l55.29">   event.waitForElement(titleTextBox);</span>
<a href="#l55.30"></a><span id="l55.30">   event.type(titleTextBox, UTF8string);</span>
<a href="#l55.31"></a><span id="l55.31">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l55.32"></a><span id="l55.32">     + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l55.33"></a><span id="l55.33">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l55.34"></a><span id="l55.34">     UTF8string);</span>
<a href="#l55.35"></a><span id="l55.35">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l55.36"></a><span id="l55.36">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l55.37"></a><span id="l55.37">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l55.38"></a><span id="l55.38">     UTF8string);</span>
<a href="#l55.39"></a><span id="l55.39" class="difflineminus">-  </span>
<a href="#l55.40"></a><span id="l55.40" class="difflineplus">+</span>
<a href="#l55.41"></a><span id="l55.41">   // select category</span>
<a href="#l55.42"></a><span id="l55.42">   event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l55.43"></a><span id="l55.43">     UTF8string);</span>
<a href="#l55.44"></a><span id="l55.44" class="difflineminus">-  </span>
<a href="#l55.45"></a><span id="l55.45" class="difflineplus">+</span>
<a href="#l55.46"></a><span id="l55.46">   // save</span>
<a href="#l55.47"></a><span id="l55.47">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l55.48"></a><span id="l55.48" class="difflineminus">-  </span>
<a href="#l55.49"></a><span id="l55.49" class="difflineplus">+</span>
<a href="#l55.50"></a><span id="l55.50">   // open</span>
<a href="#l55.51"></a><span id="l55.51">   let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l55.52"></a><span id="l55.52">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)</span>
<a href="#l55.53"></a><span id="l55.53">     + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}');</span>
<a href="#l55.54"></a><span id="l55.54">   controller.waitForElement(eventBox);</span>
<a href="#l55.55"></a><span id="l55.55">   controller.doubleClick(eventBox);</span>
<a href="#l55.56"></a><span id="l55.56">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l55.57"></a><span id="l55.57">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l55.58"></a><span id="l55.58" class="difflineminus">-  </span>
<a href="#l55.59"></a><span id="l55.59" class="difflineplus">+</span>
<a href="#l55.60"></a><span id="l55.60">   // check values</span>
<a href="#l55.61"></a><span id="l55.61">   titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l55.62"></a><span id="l55.62">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l55.63"></a><span id="l55.63">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l55.64"></a><span id="l55.64">   event.waitForElement(titleTextBox);</span>
<a href="#l55.65"></a><span id="l55.65">   event.assertValue(titleTextBox, UTF8string);</span>
<a href="#l55.66"></a><span id="l55.66">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l55.67"></a><span id="l55.67">     + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l55.68"></a><span id="l55.68">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l55.69"></a><span id="l55.69">     UTF8string);</span>
<a href="#l55.70"></a><span id="l55.70">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l55.71"></a><span id="l55.71">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l55.72"></a><span id="l55.72">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l55.73"></a><span id="l55.73">     UTF8string);</span>
<a href="#l55.74"></a><span id="l55.74">   event.assertValue(new elementslib.ID(event.window.document, &quot;item-categories&quot;),</span>
<a href="#l55.75"></a><span id="l55.75">     UTF8string);</span>
<a href="#l55.76"></a><span id="l55.76" class="difflineminus">-  </span>
<a href="#l55.77"></a><span id="l55.77" class="difflineplus">+</span>
<a href="#l55.78"></a><span id="l55.78">   // escape the event window</span>
<a href="#l55.79"></a><span id="l55.79">   event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l55.80"></a><span id="l55.80"> }</span>
<a href="#l55.81"></a><span id="l55.81"> </span>
<a href="#l55.82"></a><span id="l55.82"> var teardownTest = function(module) {</span>
<a href="#l55.83"></a><span id="l55.83">   calUtils.deleteCalendars(controller, UTF8string);</span>
<a href="#l55.84"></a><span id="l55.84">   prefs.preferences.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l55.85"></a><span id="l55.85"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -11,67 +11,67 @@ var epoch = 1970;</span>
<a href="#l56.4"></a><span id="l56.4"> </span>
<a href="#l56.5"></a><span id="l56.5"> var setupModule = function(module) {</span>
<a href="#l56.6"></a><span id="l56.6">   controller = mozmill.getMail3PaneController();</span>
<a href="#l56.7"></a><span id="l56.7">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l56.8"></a><span id="l56.8"> }</span>
<a href="#l56.9"></a><span id="l56.9"> </span>
<a href="#l56.10"></a><span id="l56.10"> var testAnnualRecurrence = function () {</span>
<a href="#l56.11"></a><span id="l56.11">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  </span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+</span>
<a href="#l56.14"></a><span id="l56.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l56.15"></a><span id="l56.15">   controller.sleep(sleep);</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineminus">-  </span>
<a href="#l56.17"></a><span id="l56.17" class="difflineplus">+</span>
<a href="#l56.18"></a><span id="l56.18">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l56.19"></a><span id="l56.19">   calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l56.20"></a><span id="l56.20" class="difflineminus">-  </span>
<a href="#l56.21"></a><span id="l56.21" class="difflineplus">+</span>
<a href="#l56.22"></a><span id="l56.22">   // create yearly recurring all-day event</span>
<a href="#l56.23"></a><span id="l56.23">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l56.24"></a><span id="l56.24">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l56.25"></a><span id="l56.25">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l56.26"></a><span id="l56.26">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l56.27"></a><span id="l56.27">                  .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l56.28"></a><span id="l56.28">   event.sleep(sleep);</span>
<a href="#l56.29"></a><span id="l56.29">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l56.30"></a><span id="l56.30">     &quot;yearly&quot;);</span>
<a href="#l56.31"></a><span id="l56.31">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l56.32"></a><span id="l56.32">   controller.sleep(sleep);</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineminus">-  </span>
<a href="#l56.34"></a><span id="l56.34" class="difflineplus">+</span>
<a href="#l56.35"></a><span id="l56.35">   let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l56.36"></a><span id="l56.36">   let box = &quot;&quot;;</span>
<a href="#l56.37"></a><span id="l56.37">   for(let i = 0; i &lt; checkYears.length; i++){</span>
<a href="#l56.38"></a><span id="l56.38">     calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l56.39"></a><span id="l56.39">     let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l56.40"></a><span id="l56.40">     let column = date.getDay() + 1;</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineminus">-    </span>
<a href="#l56.42"></a><span id="l56.42" class="difflineplus">+</span>
<a href="#l56.43"></a><span id="l56.43">     // day view</span>
<a href="#l56.44"></a><span id="l56.44">     calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l56.45"></a><span id="l56.45">     box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l56.46"></a><span id="l56.46">       + eventPath;</span>
<a href="#l56.47"></a><span id="l56.47">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l56.48"></a><span id="l56.48" class="difflineminus">-    </span>
<a href="#l56.49"></a><span id="l56.49" class="difflineplus">+</span>
<a href="#l56.50"></a><span id="l56.50">     // week view</span>
<a href="#l56.51"></a><span id="l56.51">     calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l56.52"></a><span id="l56.52">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined)</span>
<a href="#l56.53"></a><span id="l56.53">       + eventPath;</span>
<a href="#l56.54"></a><span id="l56.54">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l56.55"></a><span id="l56.55" class="difflineminus">-    </span>
<a href="#l56.56"></a><span id="l56.56" class="difflineplus">+</span>
<a href="#l56.57"></a><span id="l56.57">     // multiweek view</span>
<a href="#l56.58"></a><span id="l56.58">     calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l56.59"></a><span id="l56.59">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l56.60"></a><span id="l56.60">       + eventPath;</span>
<a href="#l56.61"></a><span id="l56.61">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l56.62"></a><span id="l56.62" class="difflineminus">-    </span>
<a href="#l56.63"></a><span id="l56.63" class="difflineplus">+</span>
<a href="#l56.64"></a><span id="l56.64">     // month view</span>
<a href="#l56.65"></a><span id="l56.65">     calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l56.66"></a><span id="l56.66">     box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l56.67"></a><span id="l56.67">       + eventPath;</span>
<a href="#l56.68"></a><span id="l56.68">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l56.69"></a><span id="l56.69">   }</span>
<a href="#l56.70"></a><span id="l56.70" class="difflineminus">-  </span>
<a href="#l56.71"></a><span id="l56.71" class="difflineplus">+</span>
<a href="#l56.72"></a><span id="l56.72">   // delete event</span>
<a href="#l56.73"></a><span id="l56.73">   calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l56.74"></a><span id="l56.74">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l56.75"></a><span id="l56.75">   box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l56.76"></a><span id="l56.76">     + eventPath;</span>
<a href="#l56.77"></a><span id="l56.77">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l56.78"></a><span id="l56.78">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l56.79"></a><span id="l56.79">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -1,102 +1,102 @@</span>
<a href="#l57.4"></a><span id="l57.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l57.5"></a><span id="l57.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l57.6"></a><span id="l57.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l57.7"></a><span id="l57.7" class="difflineminus">- </span>
<a href="#l57.8"></a><span id="l57.8" class="difflineplus">+</span>
<a href="#l57.9"></a><span id="l57.9"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l57.10"></a><span id="l57.10"> </span>
<a href="#l57.11"></a><span id="l57.11"> var sleep = 500;</span>
<a href="#l57.12"></a><span id="l57.12"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l57.13"></a><span id="l57.13"> var hour = 8;</span>
<a href="#l57.14"></a><span id="l57.14"> </span>
<a href="#l57.15"></a><span id="l57.15"> var setupModule = function(module) {</span>
<a href="#l57.16"></a><span id="l57.16">   controller = mozmill.getMail3PaneController();</span>
<a href="#l57.17"></a><span id="l57.17">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l57.18"></a><span id="l57.18"> }</span>
<a href="#l57.19"></a><span id="l57.19"> </span>
<a href="#l57.20"></a><span id="l57.20"> var testBiweeklyRecurrence = function () {</span>
<a href="#l57.21"></a><span id="l57.21">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineminus">-  </span>
<a href="#l57.23"></a><span id="l57.23" class="difflineplus">+</span>
<a href="#l57.24"></a><span id="l57.24">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l57.25"></a><span id="l57.25">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l57.26"></a><span id="l57.26">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l57.27"></a><span id="l57.27" class="difflineminus">-  </span>
<a href="#l57.28"></a><span id="l57.28" class="difflineplus">+</span>
<a href="#l57.29"></a><span id="l57.29">   // create biweekly event</span>
<a href="#l57.30"></a><span id="l57.30">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l57.31"></a><span id="l57.31">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l57.32"></a><span id="l57.32">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l57.33"></a><span id="l57.33">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineminus">-  </span>
<a href="#l57.35"></a><span id="l57.35" class="difflineplus">+</span>
<a href="#l57.36"></a><span id="l57.36">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l57.37"></a><span id="l57.37">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l57.38"></a><span id="l57.38">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l57.39"></a><span id="l57.39">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l57.40"></a><span id="l57.40" class="difflineminus">-  </span>
<a href="#l57.41"></a><span id="l57.41" class="difflineplus">+</span>
<a href="#l57.42"></a><span id="l57.42">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l57.43"></a><span id="l57.43">     + eventPath;</span>
<a href="#l57.44"></a><span id="l57.44" class="difflineminus">-  </span>
<a href="#l57.45"></a><span id="l57.45" class="difflineplus">+</span>
<a href="#l57.46"></a><span id="l57.46">   // check day view</span>
<a href="#l57.47"></a><span id="l57.47">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l57.48"></a><span id="l57.48">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.49"></a><span id="l57.49">     calUtils.forward(controller, 14);</span>
<a href="#l57.50"></a><span id="l57.50">   }</span>
<a href="#l57.51"></a><span id="l57.51" class="difflineminus">-  </span>
<a href="#l57.52"></a><span id="l57.52" class="difflineplus">+</span>
<a href="#l57.53"></a><span id="l57.53">   // check week view</span>
<a href="#l57.54"></a><span id="l57.54">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l57.55"></a><span id="l57.55">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l57.56"></a><span id="l57.56" class="difflineminus">-  </span>
<a href="#l57.57"></a><span id="l57.57" class="difflineplus">+</span>
<a href="#l57.58"></a><span id="l57.58">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l57.59"></a><span id="l57.59">     + eventPath;</span>
<a href="#l57.60"></a><span id="l57.60">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l57.61"></a><span id="l57.61">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.62"></a><span id="l57.62">     calUtils.forward(controller, 2);</span>
<a href="#l57.63"></a><span id="l57.63">   }</span>
<a href="#l57.64"></a><span id="l57.64"> </span>
<a href="#l57.65"></a><span id="l57.65">   // check multiweek view</span>
<a href="#l57.66"></a><span id="l57.66">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l57.67"></a><span id="l57.67">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l57.68"></a><span id="l57.68" class="difflineminus">-  </span>
<a href="#l57.69"></a><span id="l57.69" class="difflineplus">+</span>
<a href="#l57.70"></a><span id="l57.70">   // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l57.71"></a><span id="l57.71">   for(let i = 0; i &lt; 5; i++){</span>
<a href="#l57.72"></a><span id="l57.72">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l57.73"></a><span id="l57.73">       undefined) + eventPath;</span>
<a href="#l57.74"></a><span id="l57.74">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.75"></a><span id="l57.75">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l57.76"></a><span id="l57.76">       undefined) + eventPath;</span>
<a href="#l57.77"></a><span id="l57.77">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.78"></a><span id="l57.78">     calUtils.forward(controller, 1);</span>
<a href="#l57.79"></a><span id="l57.79">   }</span>
<a href="#l57.80"></a><span id="l57.80" class="difflineminus">-  </span>
<a href="#l57.81"></a><span id="l57.81" class="difflineplus">+</span>
<a href="#l57.82"></a><span id="l57.82">   // check month view</span>
<a href="#l57.83"></a><span id="l57.83">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l57.84"></a><span id="l57.84">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l57.85"></a><span id="l57.85"> </span>
<a href="#l57.86"></a><span id="l57.86">   // January</span>
<a href="#l57.87"></a><span id="l57.87">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined)</span>
<a href="#l57.88"></a><span id="l57.88">     + eventPath;</span>
<a href="#l57.89"></a><span id="l57.89">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.90"></a><span id="l57.90">   calUtils.forward(controller, 1);</span>
<a href="#l57.91"></a><span id="l57.91" class="difflineminus">-  </span>
<a href="#l57.92"></a><span id="l57.92" class="difflineplus">+</span>
<a href="#l57.93"></a><span id="l57.93">   // February</span>
<a href="#l57.94"></a><span id="l57.94">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l57.95"></a><span id="l57.95">     + eventPath;</span>
<a href="#l57.96"></a><span id="l57.96">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.97"></a><span id="l57.97">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l57.98"></a><span id="l57.98">     + eventPath;</span>
<a href="#l57.99"></a><span id="l57.99">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.100"></a><span id="l57.100">   calUtils.forward(controller, 1);</span>
<a href="#l57.101"></a><span id="l57.101" class="difflineminus">-  </span>
<a href="#l57.102"></a><span id="l57.102" class="difflineplus">+</span>
<a href="#l57.103"></a><span id="l57.103">   // March</span>
<a href="#l57.104"></a><span id="l57.104">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l57.105"></a><span id="l57.105">     + eventPath;</span>
<a href="#l57.106"></a><span id="l57.106">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.107"></a><span id="l57.107">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l57.108"></a><span id="l57.108">     + eventPath;</span>
<a href="#l57.109"></a><span id="l57.109" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));  </span>
<a href="#l57.110"></a><span id="l57.110" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.111"></a><span id="l57.111"> </span>
<a href="#l57.112"></a><span id="l57.112">   // delete event</span>
<a href="#l57.113"></a><span id="l57.113">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.114"></a><span id="l57.114">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l57.115"></a><span id="l57.115">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l57.116"></a><span id="l57.116">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l57.117"></a><span id="l57.117">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l57.118"></a><span id="l57.118"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -10,191 +10,191 @@ var hour = 8;</span>
<a href="#l58.4"></a><span id="l58.4"> </span>
<a href="#l58.5"></a><span id="l58.5"> var setupModule = function(module) {</span>
<a href="#l58.6"></a><span id="l58.6">   controller = mozmill.getMail3PaneController();</span>
<a href="#l58.7"></a><span id="l58.7">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l58.8"></a><span id="l58.8"> }</span>
<a href="#l58.9"></a><span id="l58.9"> </span>
<a href="#l58.10"></a><span id="l58.10"> var testDailyRecurrence = function () {</span>
<a href="#l58.11"></a><span id="l58.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  </span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+</span>
<a href="#l58.14"></a><span id="l58.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l58.15"></a><span id="l58.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l58.16"></a><span id="l58.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineminus">-  </span>
<a href="#l58.18"></a><span id="l58.18" class="difflineplus">+</span>
<a href="#l58.19"></a><span id="l58.19">   // create daily event</span>
<a href="#l58.20"></a><span id="l58.20">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l58.21"></a><span id="l58.21">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l58.22"></a><span id="l58.22">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l58.23"></a><span id="l58.23">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l58.24"></a><span id="l58.24">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l58.25"></a><span id="l58.25" class="difflineminus">-  </span>
<a href="#l58.26"></a><span id="l58.26" class="difflineplus">+</span>
<a href="#l58.27"></a><span id="l58.27">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l58.28"></a><span id="l58.28">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l58.29"></a><span id="l58.29">     &quot;daily&quot;);</span>
<a href="#l58.30"></a><span id="l58.30">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-  </span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+</span>
<a href="#l58.33"></a><span id="l58.33">   // check day view for 7 days</span>
<a href="#l58.34"></a><span id="l58.34">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l58.35"></a><span id="l58.35">     + eventPath;</span>
<a href="#l58.36"></a><span id="l58.36">   controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.37"></a><span id="l58.37" class="difflineminus">-  </span>
<a href="#l58.38"></a><span id="l58.38" class="difflineplus">+</span>
<a href="#l58.39"></a><span id="l58.39">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l58.40"></a><span id="l58.40">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.41"></a><span id="l58.41">     calUtils.forward(controller, 1);</span>
<a href="#l58.42"></a><span id="l58.42">   }</span>
<a href="#l58.43"></a><span id="l58.43" class="difflineminus">-  </span>
<a href="#l58.44"></a><span id="l58.44" class="difflineplus">+</span>
<a href="#l58.45"></a><span id="l58.45">   // check week view for 2 weeks</span>
<a href="#l58.46"></a><span id="l58.46">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l58.47"></a><span id="l58.47">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.48"></a><span id="l58.48" class="difflineminus">-  </span>
<a href="#l58.49"></a><span id="l58.49" class="difflineplus">+</span>
<a href="#l58.50"></a><span id="l58.50">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l58.51"></a><span id="l58.51">     let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l58.52"></a><span id="l58.52">       + eventPath;</span>
<a href="#l58.53"></a><span id="l58.53">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.54"></a><span id="l58.54">   }</span>
<a href="#l58.55"></a><span id="l58.55" class="difflineminus">-  </span>
<a href="#l58.56"></a><span id="l58.56" class="difflineplus">+</span>
<a href="#l58.57"></a><span id="l58.57">   calUtils.forward(controller, 1);</span>
<a href="#l58.58"></a><span id="l58.58" class="difflineminus">-  </span>
<a href="#l58.59"></a><span id="l58.59" class="difflineplus">+</span>
<a href="#l58.60"></a><span id="l58.60">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l58.61"></a><span id="l58.61">     let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l58.62"></a><span id="l58.62">       + eventPath;</span>
<a href="#l58.63"></a><span id="l58.63">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.64"></a><span id="l58.64">   }</span>
<a href="#l58.65"></a><span id="l58.65" class="difflineminus">-  </span>
<a href="#l58.66"></a><span id="l58.66" class="difflineplus">+</span>
<a href="#l58.67"></a><span id="l58.67">   // check multiweek view for 4 weeks</span>
<a href="#l58.68"></a><span id="l58.68">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l58.69"></a><span id="l58.69">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.70"></a><span id="l58.70" class="difflineminus">-  </span>
<a href="#l58.71"></a><span id="l58.71" class="difflineplus">+</span>
<a href="#l58.72"></a><span id="l58.72">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l58.73"></a><span id="l58.73">     let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l58.74"></a><span id="l58.74">       + eventPath;</span>
<a href="#l58.75"></a><span id="l58.75">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.76"></a><span id="l58.76">   }</span>
<a href="#l58.77"></a><span id="l58.77" class="difflineminus">-  </span>
<a href="#l58.78"></a><span id="l58.78" class="difflineplus">+</span>
<a href="#l58.79"></a><span id="l58.79">   for(let week = 2; week &lt;= 4; week++){</span>
<a href="#l58.80"></a><span id="l58.80">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l58.81"></a><span id="l58.81">       let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l58.82"></a><span id="l58.82">         + eventPath;</span>
<a href="#l58.83"></a><span id="l58.83">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.84"></a><span id="l58.84">     }</span>
<a href="#l58.85"></a><span id="l58.85">   }</span>
<a href="#l58.86"></a><span id="l58.86" class="difflineminus">-  </span>
<a href="#l58.87"></a><span id="l58.87" class="difflineplus">+</span>
<a href="#l58.88"></a><span id="l58.88">   // check month view for all 5 weeks</span>
<a href="#l58.89"></a><span id="l58.89">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l58.90"></a><span id="l58.90">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.91"></a><span id="l58.91" class="difflineminus">-  </span>
<a href="#l58.92"></a><span id="l58.92" class="difflineplus">+</span>
<a href="#l58.93"></a><span id="l58.93">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l58.94"></a><span id="l58.94">     let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l58.95"></a><span id="l58.95">       + eventPath;</span>
<a href="#l58.96"></a><span id="l58.96">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.97"></a><span id="l58.97">   }</span>
<a href="#l58.98"></a><span id="l58.98" class="difflineminus">-  </span>
<a href="#l58.99"></a><span id="l58.99" class="difflineplus">+</span>
<a href="#l58.100"></a><span id="l58.100">   for(let week = 2; week &lt;= 5; week++){</span>
<a href="#l58.101"></a><span id="l58.101">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l58.102"></a><span id="l58.102">       let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l58.103"></a><span id="l58.103">         + eventPath;</span>
<a href="#l58.104"></a><span id="l58.104">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l58.105"></a><span id="l58.105">     }</span>
<a href="#l58.106"></a><span id="l58.106">   }</span>
<a href="#l58.107"></a><span id="l58.107" class="difflineminus">-  </span>
<a href="#l58.108"></a><span id="l58.108" class="difflineplus">+</span>
<a href="#l58.109"></a><span id="l58.109">   // delete 3rd January occurrence</span>
<a href="#l58.110"></a><span id="l58.110">   let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l58.111"></a><span id="l58.111">     + eventPath;</span>
<a href="#l58.112"></a><span id="l58.112">   calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l58.113"></a><span id="l58.113">   controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l58.114"></a><span id="l58.114">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l58.115"></a><span id="l58.115">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l58.116"></a><span id="l58.116" class="difflineminus">-  </span>
<a href="#l58.117"></a><span id="l58.117" class="difflineplus">+</span>
<a href="#l58.118"></a><span id="l58.118">   // verify in all views</span>
<a href="#l58.119"></a><span id="l58.119">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l58.120"></a><span id="l58.120" class="difflineminus">-  </span>
<a href="#l58.121"></a><span id="l58.121" class="difflineplus">+</span>
<a href="#l58.122"></a><span id="l58.122">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l58.123"></a><span id="l58.123">   saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l58.124"></a><span id="l58.124">     + eventPath;</span>
<a href="#l58.125"></a><span id="l58.125">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l58.126"></a><span id="l58.126" class="difflineminus">-    </span>
<a href="#l58.127"></a><span id="l58.127" class="difflineplus">+</span>
<a href="#l58.128"></a><span id="l58.128">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l58.129"></a><span id="l58.129">   saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l58.130"></a><span id="l58.130">     + eventPath;</span>
<a href="#l58.131"></a><span id="l58.131">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l58.132"></a><span id="l58.132" class="difflineminus">-    </span>
<a href="#l58.133"></a><span id="l58.133" class="difflineplus">+</span>
<a href="#l58.134"></a><span id="l58.134">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l58.135"></a><span id="l58.135">   saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l58.136"></a><span id="l58.136">     + eventPath;</span>
<a href="#l58.137"></a><span id="l58.137">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l58.138"></a><span id="l58.138" class="difflineminus">-  </span>
<a href="#l58.139"></a><span id="l58.139" class="difflineplus">+</span>
<a href="#l58.140"></a><span id="l58.140">   // go to previous day to edit event to occur only on weekdays</span>
<a href="#l58.141"></a><span id="l58.141">   calUtils.back(controller, 1);</span>
<a href="#l58.142"></a><span id="l58.142" class="difflineminus">-  </span>
<a href="#l58.143"></a><span id="l58.143" class="difflineplus">+</span>
<a href="#l58.144"></a><span id="l58.144">   calUtils.handleParentModification(controller, false);</span>
<a href="#l58.145"></a><span id="l58.145">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l58.146"></a><span id="l58.146">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l58.147"></a><span id="l58.147">       + eventPath));</span>
<a href="#l58.148"></a><span id="l58.148" class="difflineminus">-  </span>
<a href="#l58.149"></a><span id="l58.149" class="difflineplus">+</span>
<a href="#l58.150"></a><span id="l58.150">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l58.151"></a><span id="l58.151">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l58.152"></a><span id="l58.152">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l58.153"></a><span id="l58.153" class="difflineminus">-  </span>
<a href="#l58.154"></a><span id="l58.154" class="difflineplus">+</span>
<a href="#l58.155"></a><span id="l58.155">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l58.156"></a><span id="l58.156">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l58.157"></a><span id="l58.157">     &quot;every.weekday&quot;);</span>
<a href="#l58.158"></a><span id="l58.158">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l58.159"></a><span id="l58.159">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l58.160"></a><span id="l58.160" class="difflineminus">-  </span>
<a href="#l58.161"></a><span id="l58.161" class="difflineplus">+</span>
<a href="#l58.162"></a><span id="l58.162">   // check day view for 7 days</span>
<a href="#l58.163"></a><span id="l58.163">   let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l58.164"></a><span id="l58.164">     + eventPath;</span>
<a href="#l58.165"></a><span id="l58.165">   var dates = [[2009, 1, 3],</span>
<a href="#l58.166"></a><span id="l58.166">                [2009, 1, 4]];</span>
<a href="#l58.167"></a><span id="l58.167">   for(let i = 0; i &lt; dates.length; i++){</span>
<a href="#l58.168"></a><span id="l58.168">     calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l58.169"></a><span id="l58.169">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.170"></a><span id="l58.170">   }</span>
<a href="#l58.171"></a><span id="l58.171" class="difflineminus">-  </span>
<a href="#l58.172"></a><span id="l58.172" class="difflineplus">+</span>
<a href="#l58.173"></a><span id="l58.173">   // check week view for 2 weeks</span>
<a href="#l58.174"></a><span id="l58.174">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l58.175"></a><span id="l58.175">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.176"></a><span id="l58.176" class="difflineminus">-  </span>
<a href="#l58.177"></a><span id="l58.177" class="difflineplus">+</span>
<a href="#l58.178"></a><span id="l58.178">   for(let i = 0; i &lt;= 1; i++){</span>
<a href="#l58.179"></a><span id="l58.179">     let day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l58.180"></a><span id="l58.180">       + eventPath;</span>
<a href="#l58.181"></a><span id="l58.181">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.182"></a><span id="l58.182">     day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l58.183"></a><span id="l58.183">       + eventPath;</span>
<a href="#l58.184"></a><span id="l58.184">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.185"></a><span id="l58.185">     calUtils.forward(controller, 1);</span>
<a href="#l58.186"></a><span id="l58.186">   }</span>
<a href="#l58.187"></a><span id="l58.187" class="difflineminus">-  </span>
<a href="#l58.188"></a><span id="l58.188" class="difflineplus">+</span>
<a href="#l58.189"></a><span id="l58.189">   // check multiweek view for 4 weeks</span>
<a href="#l58.190"></a><span id="l58.190">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l58.191"></a><span id="l58.191">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.192"></a><span id="l58.192" class="difflineminus">-  </span>
<a href="#l58.193"></a><span id="l58.193" class="difflineplus">+</span>
<a href="#l58.194"></a><span id="l58.194">   for(let i = 1; i &lt;= 4; i++){</span>
<a href="#l58.195"></a><span id="l58.195">     let day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l58.196"></a><span id="l58.196">       + eventPath;</span>
<a href="#l58.197"></a><span id="l58.197">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.198"></a><span id="l58.198">     day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l58.199"></a><span id="l58.199">       + eventPath;</span>
<a href="#l58.200"></a><span id="l58.200">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.201"></a><span id="l58.201">   }</span>
<a href="#l58.202"></a><span id="l58.202" class="difflineminus">-  </span>
<a href="#l58.203"></a><span id="l58.203" class="difflineplus">+</span>
<a href="#l58.204"></a><span id="l58.204">   // check month view for all 5 weeks</span>
<a href="#l58.205"></a><span id="l58.205">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l58.206"></a><span id="l58.206">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l58.207"></a><span id="l58.207" class="difflineminus">-  </span>
<a href="#l58.208"></a><span id="l58.208" class="difflineplus">+</span>
<a href="#l58.209"></a><span id="l58.209">   for(let i = 1; i &lt;= 5; i++){</span>
<a href="#l58.210"></a><span id="l58.210">     let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l58.211"></a><span id="l58.211">       + eventPath;</span>
<a href="#l58.212"></a><span id="l58.212">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.213"></a><span id="l58.213">     day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l58.214"></a><span id="l58.214">       + eventPath;</span>
<a href="#l58.215"></a><span id="l58.215">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.216"></a><span id="l58.216">   }</span>
<a href="#l58.217"></a><span id="l58.217" class="difflineminus">-  </span>
<a href="#l58.218"></a><span id="l58.218" class="difflineplus">+</span>
<a href="#l58.219"></a><span id="l58.219">   // delete event</span>
<a href="#l58.220"></a><span id="l58.220">   day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined)</span>
<a href="#l58.221"></a><span id="l58.221">     + eventPath;</span>
<a href="#l58.222"></a><span id="l58.222">   controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l58.223"></a><span id="l58.223">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l58.224"></a><span id="l58.224">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l58.225"></a><span id="l58.225">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l58.226"></a><span id="l58.226">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l59.4"></a><span id="l59.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l59.5"></a><span id="l59.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l59.6"></a><span id="l59.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l59.7"></a><span id="l59.7" class="difflineminus">- </span>
<a href="#l59.8"></a><span id="l59.8" class="difflineplus">+</span>
<a href="#l59.9"></a><span id="l59.9"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l59.10"></a><span id="l59.10"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l59.11"></a><span id="l59.11"> </span>
<a href="#l59.12"></a><span id="l59.12"> var sleep = 500;</span>
<a href="#l59.13"></a><span id="l59.13"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l59.14"></a><span id="l59.14"> var hour = 8;</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16"> var setupModule = function(module) {</span>
<a href="#l59.17"></a><span id="l59.17" class="difflineat">@@ -14,33 +14,33 @@ var setupModule = function(module) {</span>
<a href="#l59.18"></a><span id="l59.18">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l59.19"></a><span id="l59.19"> }</span>
<a href="#l59.20"></a><span id="l59.20"> </span>
<a href="#l59.21"></a><span id="l59.21"> var testLastDayOfMonthRecurrence = function () {</span>
<a href="#l59.22"></a><span id="l59.22">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l59.23"></a><span id="l59.23">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l59.24"></a><span id="l59.24">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l59.25"></a><span id="l59.25">   calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l59.26"></a><span id="l59.26" class="difflineminus">-  </span>
<a href="#l59.27"></a><span id="l59.27" class="difflineplus">+</span>
<a href="#l59.28"></a><span id="l59.28">   // create monthly recurring event</span>
<a href="#l59.29"></a><span id="l59.29">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l59.30"></a><span id="l59.30">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l59.31"></a><span id="l59.31">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l59.32"></a><span id="l59.32">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l59.33"></a><span id="l59.33">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineminus">-  </span>
<a href="#l59.35"></a><span id="l59.35" class="difflineplus">+</span>
<a href="#l59.36"></a><span id="l59.36">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l59.37"></a><span id="l59.37">   md.start(setRecurrence);</span>
<a href="#l59.38"></a><span id="l59.38">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l59.39"></a><span id="l59.39">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l59.40"></a><span id="l59.40">     &quot;custom&quot;);</span>
<a href="#l59.41"></a><span id="l59.41" class="difflineminus">-  </span>
<a href="#l59.42"></a><span id="l59.42" class="difflineplus">+</span>
<a href="#l59.43"></a><span id="l59.43">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l59.44"></a><span id="l59.44">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l59.45"></a><span id="l59.45" class="difflineminus">-  </span>
<a href="#l59.46"></a><span id="l59.46" class="difflineplus">+</span>
<a href="#l59.47"></a><span id="l59.47">   //                        date     correct row in month view</span>
<a href="#l59.48"></a><span id="l59.48">   let checkingData = [[2008,  1, 31, 5],</span>
<a href="#l59.49"></a><span id="l59.49">                       [2008,  2, 29, 5],</span>
<a href="#l59.50"></a><span id="l59.50">                       [2008,  3, 31, 6],</span>
<a href="#l59.51"></a><span id="l59.51">                       [2008,  4, 30, 5],</span>
<a href="#l59.52"></a><span id="l59.52">                       [2008,  5, 31, 5],</span>
<a href="#l59.53"></a><span id="l59.53">                       [2008,  6, 30, 5],</span>
<a href="#l59.54"></a><span id="l59.54">                       [2008,  7, 31, 5],</span>
<a href="#l59.55"></a><span id="l59.55" class="difflineat">@@ -48,77 +48,77 @@ var testLastDayOfMonthRecurrence = funct</span>
<a href="#l59.56"></a><span id="l59.56">                       [2008,  9, 30, 5],</span>
<a href="#l59.57"></a><span id="l59.57">                       [2008, 10, 31, 5],</span>
<a href="#l59.58"></a><span id="l59.58">                       [2008, 11, 30, 6],</span>
<a href="#l59.59"></a><span id="l59.59">                       [2008, 12, 31, 5],</span>
<a href="#l59.60"></a><span id="l59.60">                       [2009,  1, 31, 5],</span>
<a href="#l59.61"></a><span id="l59.61">                       [2009,  2, 28, 4],</span>
<a href="#l59.62"></a><span id="l59.62">                       [2009,  3, 31, 5]];</span>
<a href="#l59.63"></a><span id="l59.63">   let box = &quot;&quot;;</span>
<a href="#l59.64"></a><span id="l59.64" class="difflineminus">-  </span>
<a href="#l59.65"></a><span id="l59.65" class="difflineplus">+</span>
<a href="#l59.66"></a><span id="l59.66">   // check all dates</span>
<a href="#l59.67"></a><span id="l59.67">   for(let i = 0; i &lt; checkingData.length; i++){</span>
<a href="#l59.68"></a><span id="l59.68">     calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l59.69"></a><span id="l59.69" class="difflineminus">-    </span>
<a href="#l59.70"></a><span id="l59.70" class="difflineplus">+</span>
<a href="#l59.71"></a><span id="l59.71">     // day view</span>
<a href="#l59.72"></a><span id="l59.72">     calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l59.73"></a><span id="l59.73">     box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l59.74"></a><span id="l59.74">       + eventPath;</span>
<a href="#l59.75"></a><span id="l59.75">     controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l59.76"></a><span id="l59.76" class="difflineminus">-    </span>
<a href="#l59.77"></a><span id="l59.77" class="difflineplus">+</span>
<a href="#l59.78"></a><span id="l59.78">     // week view</span>
<a href="#l59.79"></a><span id="l59.79">     calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l59.80"></a><span id="l59.80">     let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l59.81"></a><span id="l59.81">     let column = date.getDay() + 1;</span>
<a href="#l59.82"></a><span id="l59.82">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour)</span>
<a href="#l59.83"></a><span id="l59.83">       + eventPath;</span>
<a href="#l59.84"></a><span id="l59.84">     controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l59.85"></a><span id="l59.85" class="difflineminus">-    </span>
<a href="#l59.86"></a><span id="l59.86" class="difflineplus">+</span>
<a href="#l59.87"></a><span id="l59.87">     // multiweek view</span>
<a href="#l59.88"></a><span id="l59.88">     calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l59.89"></a><span id="l59.89">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined)</span>
<a href="#l59.90"></a><span id="l59.90">       + eventPath;</span>
<a href="#l59.91"></a><span id="l59.91">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l59.92"></a><span id="l59.92" class="difflineminus">-    </span>
<a href="#l59.93"></a><span id="l59.93" class="difflineplus">+</span>
<a href="#l59.94"></a><span id="l59.94">     // month view</span>
<a href="#l59.95"></a><span id="l59.95">     calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l59.96"></a><span id="l59.96">     box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l59.97"></a><span id="l59.97">       column, undefined) + eventPath;</span>
<a href="#l59.98"></a><span id="l59.98">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l59.99"></a><span id="l59.99">   }</span>
<a href="#l59.100"></a><span id="l59.100" class="difflineminus">-  </span>
<a href="#l59.101"></a><span id="l59.101" class="difflineplus">+</span>
<a href="#l59.102"></a><span id="l59.102">   // delete event</span>
<a href="#l59.103"></a><span id="l59.103">   calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l59.104"></a><span id="l59.104">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l59.105"></a><span id="l59.105">   box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l59.106"></a><span id="l59.106">     undefined, 1, hour) + eventPath;</span>
<a href="#l59.107"></a><span id="l59.107">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l59.108"></a><span id="l59.108">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l59.109"></a><span id="l59.109">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l59.110"></a><span id="l59.110">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l59.111"></a><span id="l59.111">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l59.112"></a><span id="l59.112"> }</span>
<a href="#l59.113"></a><span id="l59.113"> </span>
<a href="#l59.114"></a><span id="l59.114"> function setRecurrence(recurrence){</span>
<a href="#l59.115"></a><span id="l59.115">   recurrence.sleep(sleep);</span>
<a href="#l59.116"></a><span id="l59.116" class="difflineminus">-  </span>
<a href="#l59.117"></a><span id="l59.117" class="difflineplus">+</span>
<a href="#l59.118"></a><span id="l59.118">   // monthly</span>
<a href="#l59.119"></a><span id="l59.119">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l59.120"></a><span id="l59.120">     undefined, &quot;2&quot;);</span>
<a href="#l59.121"></a><span id="l59.121" class="difflineminus">-  </span>
<a href="#l59.122"></a><span id="l59.122" class="difflineplus">+</span>
<a href="#l59.123"></a><span id="l59.123">   // last day of month</span>
<a href="#l59.124"></a><span id="l59.124">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l59.125"></a><span id="l59.125">   recurrence.sleep(sleep);</span>
<a href="#l59.126"></a><span id="l59.126">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l59.127"></a><span id="l59.127">     undefined, &quot;-1&quot;);</span>
<a href="#l59.128"></a><span id="l59.128">   recurrence.sleep(sleep);</span>
<a href="#l59.129"></a><span id="l59.129">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l59.130"></a><span id="l59.130">     undefined, &quot;-1&quot;);</span>
<a href="#l59.131"></a><span id="l59.131">   recurrence.sleep(sleep);</span>
<a href="#l59.132"></a><span id="l59.132" class="difflineminus">-  </span>
<a href="#l59.133"></a><span id="l59.133" class="difflineplus">+</span>
<a href="#l59.134"></a><span id="l59.134">   // close dialog</span>
<a href="#l59.135"></a><span id="l59.135">   recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l59.136"></a><span id="l59.136">     '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l59.137"></a><span id="l59.137"> }</span>
<a href="#l59.138"></a><span id="l59.138"> </span>
<a href="#l59.139"></a><span id="l59.139"> var teardownTest = function(module) {</span>
<a href="#l59.140"></a><span id="l59.140">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l59.141"></a><span id="l59.141"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -15,129 +15,128 @@ var setupModule = function(module) {</span>
<a href="#l60.4"></a><span id="l60.4">   controller = mozmill.getMail3PaneController();</span>
<a href="#l60.5"></a><span id="l60.5">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l60.6"></a><span id="l60.6"> }</span>
<a href="#l60.7"></a><span id="l60.7"> </span>
<a href="#l60.8"></a><span id="l60.8"> var testWeeklyNRecurrence = function () {</span>
<a href="#l60.9"></a><span id="l60.9">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l60.10"></a><span id="l60.10">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l60.11"></a><span id="l60.11">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-  </span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+</span>
<a href="#l60.14"></a><span id="l60.14">   // create weekly recurring event</span>
<a href="#l60.15"></a><span id="l60.15">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l60.16"></a><span id="l60.16">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l60.17"></a><span id="l60.17">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l60.18"></a><span id="l60.18">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l60.19"></a><span id="l60.19" class="difflineminus">-  </span>
<a href="#l60.20"></a><span id="l60.20" class="difflineplus">+</span>
<a href="#l60.21"></a><span id="l60.21">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l60.22"></a><span id="l60.22">   md.start(setRecurrence);</span>
<a href="#l60.23"></a><span id="l60.23">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l60.24"></a><span id="l60.24">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l60.25"></a><span id="l60.25" class="difflineminus">-  </span>
<a href="#l60.26"></a><span id="l60.26" class="difflineplus">+</span>
<a href="#l60.27"></a><span id="l60.27">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l60.28"></a><span id="l60.28" class="difflineminus">-  </span>
<a href="#l60.29"></a><span id="l60.29" class="difflineminus">-  </span>
<a href="#l60.30"></a><span id="l60.30" class="difflineplus">+</span>
<a href="#l60.31"></a><span id="l60.31">   // check day view</span>
<a href="#l60.32"></a><span id="l60.32">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l60.33"></a><span id="l60.33">     + eventPath;</span>
<a href="#l60.34"></a><span id="l60.34" class="difflineminus">-  </span>
<a href="#l60.35"></a><span id="l60.35" class="difflineplus">+</span>
<a href="#l60.36"></a><span id="l60.36">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l60.37"></a><span id="l60.37">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l60.38"></a><span id="l60.38">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.39"></a><span id="l60.39">     calUtils.forward(controller, 1);</span>
<a href="#l60.40"></a><span id="l60.40">   }</span>
<a href="#l60.41"></a><span id="l60.41" class="difflineminus">-  </span>
<a href="#l60.42"></a><span id="l60.42" class="difflineplus">+</span>
<a href="#l60.43"></a><span id="l60.43">   // Saturday</span>
<a href="#l60.44"></a><span id="l60.44">   calUtils.forward(controller, 1);</span>
<a href="#l60.45"></a><span id="l60.45">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.46"></a><span id="l60.46" class="difflineminus">-  </span>
<a href="#l60.47"></a><span id="l60.47" class="difflineplus">+</span>
<a href="#l60.48"></a><span id="l60.48">   // check week view</span>
<a href="#l60.49"></a><span id="l60.49">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l60.50"></a><span id="l60.50" class="difflineminus">-  </span>
<a href="#l60.51"></a><span id="l60.51" class="difflineplus">+</span>
<a href="#l60.52"></a><span id="l60.52">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l60.53"></a><span id="l60.53">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l60.54"></a><span id="l60.54">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour)</span>
<a href="#l60.55"></a><span id="l60.55">       + eventPath;</span>
<a href="#l60.56"></a><span id="l60.56">     controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.57"></a><span id="l60.57">   }</span>
<a href="#l60.58"></a><span id="l60.58" class="difflineminus">-  </span>
<a href="#l60.59"></a><span id="l60.59" class="difflineplus">+</span>
<a href="#l60.60"></a><span id="l60.60">   // Saturday</span>
<a href="#l60.61"></a><span id="l60.61">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l60.62"></a><span id="l60.62">     + eventPath;</span>
<a href="#l60.63"></a><span id="l60.63">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.64"></a><span id="l60.64" class="difflineminus">-  </span>
<a href="#l60.65"></a><span id="l60.65" class="difflineplus">+</span>
<a href="#l60.66"></a><span id="l60.66">   // check multiweek view</span>
<a href="#l60.67"></a><span id="l60.67">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l60.68"></a><span id="l60.68">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l60.69"></a><span id="l60.69" class="difflineminus">-  </span>
<a href="#l60.70"></a><span id="l60.70" class="difflineplus">+</span>
<a href="#l60.71"></a><span id="l60.71">   // check month view</span>
<a href="#l60.72"></a><span id="l60.72">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l60.73"></a><span id="l60.73">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l60.74"></a><span id="l60.74" class="difflineminus">-  </span>
<a href="#l60.75"></a><span id="l60.75" class="difflineplus">+</span>
<a href="#l60.76"></a><span id="l60.76">   // delete event</span>
<a href="#l60.77"></a><span id="l60.77">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour)</span>
<a href="#l60.78"></a><span id="l60.78">     + eventPath;</span>
<a href="#l60.79"></a><span id="l60.79">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.80"></a><span id="l60.80">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l60.81"></a><span id="l60.81">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l60.82"></a><span id="l60.82">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l60.83"></a><span id="l60.83">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.84"></a><span id="l60.84"> }</span>
<a href="#l60.85"></a><span id="l60.85"> </span>
<a href="#l60.86"></a><span id="l60.86"> function setRecurrence(recurrence){</span>
<a href="#l60.87"></a><span id="l60.87">   // weekly</span>
<a href="#l60.88"></a><span id="l60.88">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l60.89"></a><span id="l60.89">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l60.90"></a><span id="l60.90">   recurrence.sleep(sleep);</span>
<a href="#l60.91"></a><span id="l60.91" class="difflineminus">-  </span>
<a href="#l60.92"></a><span id="l60.92" class="difflineplus">+</span>
<a href="#l60.93"></a><span id="l60.93">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l60.94"></a><span id="l60.94">   let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l60.95"></a><span id="l60.95">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l60.96"></a><span id="l60.96">   let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l60.97"></a><span id="l60.97">   let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l60.98"></a><span id="l60.98" class="difflineminus">-  </span>
<a href="#l60.99"></a><span id="l60.99" class="difflineplus">+</span>
<a href="#l60.100"></a><span id="l60.100">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l60.101"></a><span id="l60.101">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l60.102"></a><span id="l60.102">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l60.103"></a><span id="l60.103" class="difflineminus">-  </span>
<a href="#l60.104"></a><span id="l60.104" class="difflineplus">+</span>
<a href="#l60.105"></a><span id="l60.105">   // starting from Monday so it should be checked</span>
<a href="#l60.106"></a><span id="l60.106">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l60.107"></a><span id="l60.107">   // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l60.108"></a><span id="l60.108">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l60.109"></a><span id="l60.109">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l60.110"></a><span id="l60.110">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l60.111"></a><span id="l60.111">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l60.112"></a><span id="l60.112" class="difflineminus">-  </span>
<a href="#l60.113"></a><span id="l60.113" class="difflineplus">+</span>
<a href="#l60.114"></a><span id="l60.114">   // set number of occurrences</span>
<a href="#l60.115"></a><span id="l60.115">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l60.116"></a><span id="l60.116">   let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/'</span>
<a href="#l60.117"></a><span id="l60.117">     + 'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/'</span>
<a href="#l60.118"></a><span id="l60.118">     + 'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l60.119"></a><span id="l60.119">   // replace previous number</span>
<a href="#l60.120"></a><span id="l60.120">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l60.121"></a><span id="l60.121">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l60.122"></a><span id="l60.122" class="difflineminus">-    </span>
<a href="#l60.123"></a><span id="l60.123" class="difflineplus">+</span>
<a href="#l60.124"></a><span id="l60.124">   // close dialog</span>
<a href="#l60.125"></a><span id="l60.125">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l60.126"></a><span id="l60.126">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l60.127"></a><span id="l60.127"> }</span>
<a href="#l60.128"></a><span id="l60.128"> </span>
<a href="#l60.129"></a><span id="l60.129"> function checkMultiWeekView(view){</span>
<a href="#l60.130"></a><span id="l60.130">   let week = 1;</span>
<a href="#l60.131"></a><span id="l60.131" class="difflineminus">-  </span>
<a href="#l60.132"></a><span id="l60.132" class="difflineplus">+</span>
<a href="#l60.133"></a><span id="l60.133">   // in month view event starts from 2nd row</span>
<a href="#l60.134"></a><span id="l60.134">   if(view == &quot;month&quot;) week++;</span>
<a href="#l60.135"></a><span id="l60.135"> </span>
<a href="#l60.136"></a><span id="l60.136">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l60.137"></a><span id="l60.137">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l60.138"></a><span id="l60.138">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined)</span>
<a href="#l60.139"></a><span id="l60.139">       + eventPath;</span>
<a href="#l60.140"></a><span id="l60.140">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.141"></a><span id="l60.141">   }</span>
<a href="#l60.142"></a><span id="l60.142" class="difflineminus">-  </span>
<a href="#l60.143"></a><span id="l60.143" class="difflineplus">+</span>
<a href="#l60.144"></a><span id="l60.144">   // Saturday</span>
<a href="#l60.145"></a><span id="l60.145">   let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined)</span>
<a href="#l60.146"></a><span id="l60.146">     + eventPath;</span>
<a href="#l60.147"></a><span id="l60.147">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l60.148"></a><span id="l60.148"> }</span>
<a href="#l60.149"></a><span id="l60.149"> </span>
<a href="#l60.150"></a><span id="l60.150"> var teardownTest = function(module) {</span>
<a href="#l60.151"></a><span id="l60.151">   calUtils.deleteCalendars(controller, calendar);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l61.4"></a><span id="l61.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l61.5"></a><span id="l61.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l61.6"></a><span id="l61.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l61.7"></a><span id="l61.7" class="difflineminus">- </span>
<a href="#l61.8"></a><span id="l61.8" class="difflineplus">+</span>
<a href="#l61.9"></a><span id="l61.9"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l61.10"></a><span id="l61.10"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l61.11"></a><span id="l61.11"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l61.12"></a><span id="l61.12"> </span>
<a href="#l61.13"></a><span id="l61.13"> var sleep = 500;</span>
<a href="#l61.14"></a><span id="l61.14"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l61.15"></a><span id="l61.15"> var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l61.16"></a><span id="l61.16"> </span>
<a href="#l61.17"></a><span id="l61.17" class="difflineat">@@ -17,147 +17,147 @@ var setupModule = function(module) {</span>
<a href="#l61.18"></a><span id="l61.18">   controller = mozmill.getMail3PaneController();</span>
<a href="#l61.19"></a><span id="l61.19">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l61.20"></a><span id="l61.20"> }</span>
<a href="#l61.21"></a><span id="l61.21"> </span>
<a href="#l61.22"></a><span id="l61.22"> var testWeeklyUntilRecurrence = function () {</span>
<a href="#l61.23"></a><span id="l61.23">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l61.24"></a><span id="l61.24">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l61.25"></a><span id="l61.25">   calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l61.26"></a><span id="l61.26" class="difflineminus">-  </span>
<a href="#l61.27"></a><span id="l61.27" class="difflineplus">+</span>
<a href="#l61.28"></a><span id="l61.28">   // create weekly recurring event</span>
<a href="#l61.29"></a><span id="l61.29">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l61.30"></a><span id="l61.30">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l61.31"></a><span id="l61.31">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l61.32"></a><span id="l61.32">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l61.33"></a><span id="l61.33" class="difflineminus">-  </span>
<a href="#l61.34"></a><span id="l61.34" class="difflineplus">+</span>
<a href="#l61.35"></a><span id="l61.35">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l61.36"></a><span id="l61.36">   md.start(setRecurrence);</span>
<a href="#l61.37"></a><span id="l61.37">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l61.38"></a><span id="l61.38">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l61.39"></a><span id="l61.39" class="difflineminus">-  </span>
<a href="#l61.40"></a><span id="l61.40" class="difflineplus">+</span>
<a href="#l61.41"></a><span id="l61.41">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l61.42"></a><span id="l61.42">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l61.43"></a><span id="l61.43" class="difflineminus">-  </span>
<a href="#l61.44"></a><span id="l61.44" class="difflineplus">+</span>
<a href="#l61.45"></a><span id="l61.45">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l61.46"></a><span id="l61.46">     + eventPath;</span>
<a href="#l61.47"></a><span id="l61.47" class="difflineminus">-  </span>
<a href="#l61.48"></a><span id="l61.48" class="difflineplus">+</span>
<a href="#l61.49"></a><span id="l61.49">   // check day view</span>
<a href="#l61.50"></a><span id="l61.50">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l61.51"></a><span id="l61.51">     // Monday</span>
<a href="#l61.52"></a><span id="l61.52">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.53"></a><span id="l61.53">     calUtils.forward(controller, 2);</span>
<a href="#l61.54"></a><span id="l61.54">     // Wednesday</span>
<a href="#l61.55"></a><span id="l61.55">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.56"></a><span id="l61.56">     calUtils.forward(controller, 2);</span>
<a href="#l61.57"></a><span id="l61.57">     // Friday</span>
<a href="#l61.58"></a><span id="l61.58">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.59"></a><span id="l61.59">     calUtils.forward(controller, 3);</span>
<a href="#l61.60"></a><span id="l61.60">   }</span>
<a href="#l61.61"></a><span id="l61.61" class="difflineminus">-  </span>
<a href="#l61.62"></a><span id="l61.62" class="difflineplus">+</span>
<a href="#l61.63"></a><span id="l61.63">   // Monday, last occurrence</span>
<a href="#l61.64"></a><span id="l61.64">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.65"></a><span id="l61.65">   calUtils.forward(controller, 2);</span>
<a href="#l61.66"></a><span id="l61.66">   // Wednesday</span>
<a href="#l61.67"></a><span id="l61.67">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.68"></a><span id="l61.68">   calUtils.forward(controller, 2);</span>
<a href="#l61.69"></a><span id="l61.69" class="difflineminus">-  </span>
<a href="#l61.70"></a><span id="l61.70" class="difflineplus">+</span>
<a href="#l61.71"></a><span id="l61.71">   // check week view</span>
<a href="#l61.72"></a><span id="l61.72">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l61.73"></a><span id="l61.73">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l61.74"></a><span id="l61.74">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l61.75"></a><span id="l61.75">     // Monday</span>
<a href="#l61.76"></a><span id="l61.76">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l61.77"></a><span id="l61.77">       + eventPath;</span>
<a href="#l61.78"></a><span id="l61.78">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.79"></a><span id="l61.79">     // Wednesday</span>
<a href="#l61.80"></a><span id="l61.80">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l61.81"></a><span id="l61.81">       + eventPath;</span>
<a href="#l61.82"></a><span id="l61.82">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.83"></a><span id="l61.83">     // Friday</span>
<a href="#l61.84"></a><span id="l61.84">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour)</span>
<a href="#l61.85"></a><span id="l61.85">       + eventPath;</span>
<a href="#l61.86"></a><span id="l61.86">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.87"></a><span id="l61.87" class="difflineminus">-    </span>
<a href="#l61.88"></a><span id="l61.88" class="difflineplus">+</span>
<a href="#l61.89"></a><span id="l61.89">     calUtils.forward(controller, 1);</span>
<a href="#l61.90"></a><span id="l61.90">   }</span>
<a href="#l61.91"></a><span id="l61.91" class="difflineminus">-  </span>
<a href="#l61.92"></a><span id="l61.92" class="difflineplus">+</span>
<a href="#l61.93"></a><span id="l61.93">   // Monday, last occurrence</span>
<a href="#l61.94"></a><span id="l61.94">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l61.95"></a><span id="l61.95">     + eventPath;</span>
<a href="#l61.96"></a><span id="l61.96">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.97"></a><span id="l61.97">   // Wednesday</span>
<a href="#l61.98"></a><span id="l61.98">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l61.99"></a><span id="l61.99">     + eventPath;</span>
<a href="#l61.100"></a><span id="l61.100">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.101"></a><span id="l61.101" class="difflineminus">-  </span>
<a href="#l61.102"></a><span id="l61.102" class="difflineplus">+</span>
<a href="#l61.103"></a><span id="l61.103">   // check multiweek view</span>
<a href="#l61.104"></a><span id="l61.104">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l61.105"></a><span id="l61.105">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l61.106"></a><span id="l61.106">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l61.107"></a><span id="l61.107" class="difflineminus">-  </span>
<a href="#l61.108"></a><span id="l61.108" class="difflineplus">+</span>
<a href="#l61.109"></a><span id="l61.109">   // check month view</span>
<a href="#l61.110"></a><span id="l61.110">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l61.111"></a><span id="l61.111">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l61.112"></a><span id="l61.112">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l61.113"></a><span id="l61.113" class="difflineminus">-  </span>
<a href="#l61.114"></a><span id="l61.114" class="difflineplus">+</span>
<a href="#l61.115"></a><span id="l61.115">   // delete event</span>
<a href="#l61.116"></a><span id="l61.116">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined)</span>
<a href="#l61.117"></a><span id="l61.117">     + eventPath;</span>
<a href="#l61.118"></a><span id="l61.118">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.119"></a><span id="l61.119">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l61.120"></a><span id="l61.120">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l61.121"></a><span id="l61.121">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l61.122"></a><span id="l61.122">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.123"></a><span id="l61.123"> }</span>
<a href="#l61.124"></a><span id="l61.124"> </span>
<a href="#l61.125"></a><span id="l61.125"> function setRecurrence(recurrence){</span>
<a href="#l61.126"></a><span id="l61.126">   // weekly</span>
<a href="#l61.127"></a><span id="l61.127">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l61.128"></a><span id="l61.128">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l61.129"></a><span id="l61.129">   recurrence.sleep(sleep);</span>
<a href="#l61.130"></a><span id="l61.130" class="difflineminus">-  </span>
<a href="#l61.131"></a><span id="l61.131" class="difflineplus">+</span>
<a href="#l61.132"></a><span id="l61.132">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l61.133"></a><span id="l61.133">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l61.134"></a><span id="l61.134">   let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l61.135"></a><span id="l61.135" class="difflineminus">-  </span>
<a href="#l61.136"></a><span id="l61.136" class="difflineplus">+</span>
<a href="#l61.137"></a><span id="l61.137">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l61.138"></a><span id="l61.138">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l61.139"></a><span id="l61.139">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l61.140"></a><span id="l61.140" class="difflineminus">-  </span>
<a href="#l61.141"></a><span id="l61.141" class="difflineplus">+</span>
<a href="#l61.142"></a><span id="l61.142">   // starting from Monday so it should be checked</span>
<a href="#l61.143"></a><span id="l61.143">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l61.144"></a><span id="l61.144">   // check Wednesday and Friday too</span>
<a href="#l61.145"></a><span id="l61.145">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l61.146"></a><span id="l61.146">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l61.147"></a><span id="l61.147" class="difflineminus">-  </span>
<a href="#l61.148"></a><span id="l61.148" class="difflineplus">+</span>
<a href="#l61.149"></a><span id="l61.149">   // set until date</span>
<a href="#l61.150"></a><span id="l61.150">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l61.151"></a><span id="l61.151">   let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/'</span>
<a href="#l61.152"></a><span id="l61.152">     + 'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/'</span>
<a href="#l61.153"></a><span id="l61.153">     + 'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/'</span>
<a href="#l61.154"></a><span id="l61.154">     + 'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l61.155"></a><span id="l61.155">   // delete previous date</span>
<a href="#l61.156"></a><span id="l61.156">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l61.157"></a><span id="l61.157">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l61.158"></a><span id="l61.158"> </span>
<a href="#l61.159"></a><span id="l61.159">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l61.160"></a><span id="l61.160">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l61.161"></a><span id="l61.161" class="difflineminus">-  let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l61.162"></a><span id="l61.162" class="difflineplus">+  let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l61.163"></a><span id="l61.163">                                              endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l61.164"></a><span id="l61.164">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l61.165"></a><span id="l61.165" class="difflineminus">-  </span>
<a href="#l61.166"></a><span id="l61.166" class="difflineplus">+</span>
<a href="#l61.167"></a><span id="l61.167">   // close dialog</span>
<a href="#l61.168"></a><span id="l61.168">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l61.169"></a><span id="l61.169">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l61.170"></a><span id="l61.170"> }</span>
<a href="#l61.171"></a><span id="l61.171"> </span>
<a href="#l61.172"></a><span id="l61.172"> function checkMultiWeekView(view){</span>
<a href="#l61.173"></a><span id="l61.173">   let startWeek = 1;</span>
<a href="#l61.174"></a><span id="l61.174" class="difflineminus">-  </span>
<a href="#l61.175"></a><span id="l61.175" class="difflineplus">+</span>
<a href="#l61.176"></a><span id="l61.176">   // in month view event starts from 2nd row</span>
<a href="#l61.177"></a><span id="l61.177">   if(view == &quot;month&quot;) startWeek++;</span>
<a href="#l61.178"></a><span id="l61.178"> </span>
<a href="#l61.179"></a><span id="l61.179">   for(let week = startWeek; week &lt; startWeek + 3; week++){</span>
<a href="#l61.180"></a><span id="l61.180">     // Monday</span>
<a href="#l61.181"></a><span id="l61.181">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined)</span>
<a href="#l61.182"></a><span id="l61.182">       + eventPath;</span>
<a href="#l61.183"></a><span id="l61.183">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.184"></a><span id="l61.184" class="difflineat">@@ -165,17 +165,17 @@ function checkMultiWeekView(view){</span>
<a href="#l61.185"></a><span id="l61.185">     box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined)</span>
<a href="#l61.186"></a><span id="l61.186">       + eventPath;</span>
<a href="#l61.187"></a><span id="l61.187">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.188"></a><span id="l61.188">     // Friday</span>
<a href="#l61.189"></a><span id="l61.189">     box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined)</span>
<a href="#l61.190"></a><span id="l61.190">       + eventPath;</span>
<a href="#l61.191"></a><span id="l61.191">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.192"></a><span id="l61.192">   }</span>
<a href="#l61.193"></a><span id="l61.193" class="difflineminus">-  </span>
<a href="#l61.194"></a><span id="l61.194" class="difflineplus">+</span>
<a href="#l61.195"></a><span id="l61.195">   // Monday, last occurrence</span>
<a href="#l61.196"></a><span id="l61.196">   let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l61.197"></a><span id="l61.197">     undefined) + eventPath;</span>
<a href="#l61.198"></a><span id="l61.198">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l61.199"></a><span id="l61.199">   // Wednesday</span>
<a href="#l61.200"></a><span id="l61.200">   box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l61.201"></a><span id="l61.201">     undefined) + eventPath;</span>
<a href="#l61.202"></a><span id="l61.202">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -16,185 +16,185 @@ var setupModule = function(module) {</span>
<a href="#l62.4"></a><span id="l62.4">   controller = mozmill.getMail3PaneController();</span>
<a href="#l62.5"></a><span id="l62.5">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l62.6"></a><span id="l62.6"> }</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> var testWeeklyWithExceptionRecurrence = function () {</span>
<a href="#l62.9"></a><span id="l62.9">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l62.10"></a><span id="l62.10">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l62.11"></a><span id="l62.11">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  </span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+</span>
<a href="#l62.14"></a><span id="l62.14">   // create weekly recurring event</span>
<a href="#l62.15"></a><span id="l62.15">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.16"></a><span id="l62.16">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l62.17"></a><span id="l62.17">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l62.18"></a><span id="l62.18">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineminus">-  </span>
<a href="#l62.20"></a><span id="l62.20" class="difflineplus">+</span>
<a href="#l62.21"></a><span id="l62.21">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l62.22"></a><span id="l62.22">   md.start(setRecurrence);</span>
<a href="#l62.23"></a><span id="l62.23">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l62.24"></a><span id="l62.24">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l62.25"></a><span id="l62.25" class="difflineminus">-  </span>
<a href="#l62.26"></a><span id="l62.26" class="difflineplus">+</span>
<a href="#l62.27"></a><span id="l62.27">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l62.28"></a><span id="l62.28">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l62.29"></a><span id="l62.29" class="difflineminus">-  </span>
<a href="#l62.30"></a><span id="l62.30" class="difflineplus">+</span>
<a href="#l62.31"></a><span id="l62.31">   // move 5th January occurrence to 6th January</span>
<a href="#l62.32"></a><span id="l62.32">   calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l62.33"></a><span id="l62.33">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.34"></a><span id="l62.34">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l62.35"></a><span id="l62.35">       + eventPath));</span>
<a href="#l62.36"></a><span id="l62.36">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l62.37"></a><span id="l62.37">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l62.38"></a><span id="l62.38">   event.sleep(sleep);</span>
<a href="#l62.39"></a><span id="l62.39" class="difflineminus">-  </span>
<a href="#l62.40"></a><span id="l62.40" class="difflineplus">+</span>
<a href="#l62.41"></a><span id="l62.41">   let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l62.42"></a><span id="l62.42">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/'</span>
<a href="#l62.43"></a><span id="l62.43">     + 'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/'</span>
<a href="#l62.44"></a><span id="l62.44">     + 'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l62.45"></a><span id="l62.45">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l62.46"></a><span id="l62.46">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l62.47"></a><span id="l62.47">   let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l62.48"></a><span id="l62.48">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/'</span>
<a href="#l62.49"></a><span id="l62.49">     + 'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/'</span>
<a href="#l62.50"></a><span id="l62.50">     + 'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l62.51"></a><span id="l62.51">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l62.52"></a><span id="l62.52">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l62.53"></a><span id="l62.53"> </span>
<a href="#l62.54"></a><span id="l62.54">   event.keypress(startDateInput, &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l62.55"></a><span id="l62.55">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l62.56"></a><span id="l62.56">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l62.57"></a><span id="l62.57" class="difflineminus">-  let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l62.58"></a><span id="l62.58" class="difflineplus">+  let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l62.59"></a><span id="l62.59">                                              startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l62.60"></a><span id="l62.60">   event.type(startDateInput, startDateString);</span>
<a href="#l62.61"></a><span id="l62.61">   // applies startdate change</span>
<a href="#l62.62"></a><span id="l62.62">   event.click(endDateInput);</span>
<a href="#l62.63"></a><span id="l62.63"> </span>
<a href="#l62.64"></a><span id="l62.64">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l62.65"></a><span id="l62.65">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l62.66"></a><span id="l62.66" class="difflineminus">-  </span>
<a href="#l62.67"></a><span id="l62.67" class="difflineplus">+</span>
<a href="#l62.68"></a><span id="l62.68">   // change recurrence rule</span>
<a href="#l62.69"></a><span id="l62.69">   calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l62.70"></a><span id="l62.70">   calUtils.handleParentModification(controller, false);</span>
<a href="#l62.71"></a><span id="l62.71">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.72"></a><span id="l62.72">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l62.73"></a><span id="l62.73">       + eventPath));</span>
<a href="#l62.74"></a><span id="l62.74">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l62.75"></a><span id="l62.75">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l62.76"></a><span id="l62.76" class="difflineminus">-  </span>
<a href="#l62.77"></a><span id="l62.77" class="difflineplus">+</span>
<a href="#l62.78"></a><span id="l62.78">   md = new modalDialog.modalDialog(event.window);</span>
<a href="#l62.79"></a><span id="l62.79">   md.start(changeRecurrence);</span>
<a href="#l62.80"></a><span id="l62.80">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l62.81"></a><span id="l62.81">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l62.82"></a><span id="l62.82" class="difflineminus">-  </span>
<a href="#l62.83"></a><span id="l62.83" class="difflineplus">+</span>
<a href="#l62.84"></a><span id="l62.84">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l62.85"></a><span id="l62.85">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l62.86"></a><span id="l62.86" class="difflineminus">-  </span>
<a href="#l62.87"></a><span id="l62.87" class="difflineplus">+</span>
<a href="#l62.88"></a><span id="l62.88">   // check two weeks</span>
<a href="#l62.89"></a><span id="l62.89">   // day view</span>
<a href="#l62.90"></a><span id="l62.90">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l62.91"></a><span id="l62.91">   let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l62.92"></a><span id="l62.92">     + eventPath;</span>
<a href="#l62.93"></a><span id="l62.93" class="difflineminus">-  </span>
<a href="#l62.94"></a><span id="l62.94" class="difflineplus">+</span>
<a href="#l62.95"></a><span id="l62.95">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l62.96"></a><span id="l62.96">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.97"></a><span id="l62.97" class="difflineminus">-  </span>
<a href="#l62.98"></a><span id="l62.98" class="difflineplus">+</span>
<a href="#l62.99"></a><span id="l62.99">   calUtils.forward(controller, 1);</span>
<a href="#l62.100"></a><span id="l62.100">   let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l62.101"></a><span id="l62.101">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l62.102"></a><span id="l62.102">     + 'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l62.103"></a><span id="l62.103">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l62.104"></a><span id="l62.104">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l62.105"></a><span id="l62.105">   // assert exactly two</span>
<a href="#l62.106"></a><span id="l62.106">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.107"></a><span id="l62.107">     tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l62.108"></a><span id="l62.108">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.109"></a><span id="l62.109">     tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l62.110"></a><span id="l62.110">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.111"></a><span id="l62.111">     tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l62.112"></a><span id="l62.112" class="difflineminus">-  </span>
<a href="#l62.113"></a><span id="l62.113" class="difflineplus">+</span>
<a href="#l62.114"></a><span id="l62.114">   calUtils.forward(controller, 1);</span>
<a href="#l62.115"></a><span id="l62.115">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.116"></a><span id="l62.116">   calUtils.forward(controller, 1);</span>
<a href="#l62.117"></a><span id="l62.117">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.118"></a><span id="l62.118">   calUtils.forward(controller, 1);</span>
<a href="#l62.119"></a><span id="l62.119">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.120"></a><span id="l62.120">   calUtils.forward(controller, 1);</span>
<a href="#l62.121"></a><span id="l62.121">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.122"></a><span id="l62.122">   calUtils.forward(controller, 1);</span>
<a href="#l62.123"></a><span id="l62.123">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.124"></a><span id="l62.124" class="difflineminus">-  </span>
<a href="#l62.125"></a><span id="l62.125" class="difflineplus">+</span>
<a href="#l62.126"></a><span id="l62.126">   // next week</span>
<a href="#l62.127"></a><span id="l62.127">   calUtils.forward(controller, 1);</span>
<a href="#l62.128"></a><span id="l62.128">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.129"></a><span id="l62.129">   calUtils.forward(controller, 1);</span>
<a href="#l62.130"></a><span id="l62.130">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.131"></a><span id="l62.131">   calUtils.forward(controller, 1);</span>
<a href="#l62.132"></a><span id="l62.132">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.133"></a><span id="l62.133">   calUtils.forward(controller, 1);</span>
<a href="#l62.134"></a><span id="l62.134">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.135"></a><span id="l62.135">   calUtils.forward(controller, 1);</span>
<a href="#l62.136"></a><span id="l62.136">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.137"></a><span id="l62.137">   calUtils.forward(controller, 1);</span>
<a href="#l62.138"></a><span id="l62.138">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.139"></a><span id="l62.139" class="difflineminus">-  </span>
<a href="#l62.140"></a><span id="l62.140" class="difflineplus">+</span>
<a href="#l62.141"></a><span id="l62.141">   // week view</span>
<a href="#l62.142"></a><span id="l62.142">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l62.143"></a><span id="l62.143">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l62.144"></a><span id="l62.144" class="difflineminus">-  </span>
<a href="#l62.145"></a><span id="l62.145" class="difflineplus">+</span>
<a href="#l62.146"></a><span id="l62.146">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l62.147"></a><span id="l62.147">     + eventPath;</span>
<a href="#l62.148"></a><span id="l62.148">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.149"></a><span id="l62.149" class="difflineminus">-  </span>
<a href="#l62.150"></a><span id="l62.150" class="difflineplus">+</span>
<a href="#l62.151"></a><span id="l62.151">   tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l62.152"></a><span id="l62.152">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l62.153"></a><span id="l62.153">     + 'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l62.154"></a><span id="l62.154">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l62.155"></a><span id="l62.155">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l62.156"></a><span id="l62.156">   // assert exactly two</span>
<a href="#l62.157"></a><span id="l62.157">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.158"></a><span id="l62.158">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l62.159"></a><span id="l62.159">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.160"></a><span id="l62.160">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l62.161"></a><span id="l62.161">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l62.162"></a><span id="l62.162">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l62.163"></a><span id="l62.163" class="difflineminus">-  </span>
<a href="#l62.164"></a><span id="l62.164" class="difflineplus">+</span>
<a href="#l62.165"></a><span id="l62.165">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l62.166"></a><span id="l62.166">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.167"></a><span id="l62.167">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l62.168"></a><span id="l62.168">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.169"></a><span id="l62.169">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l62.170"></a><span id="l62.170">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.171"></a><span id="l62.171">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l62.172"></a><span id="l62.172">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.173"></a><span id="l62.173" class="difflineminus">-  </span>
<a href="#l62.174"></a><span id="l62.174" class="difflineplus">+</span>
<a href="#l62.175"></a><span id="l62.175">   calUtils.forward(controller, 1);</span>
<a href="#l62.176"></a><span id="l62.176">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l62.177"></a><span id="l62.177">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.178"></a><span id="l62.178">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l62.179"></a><span id="l62.179">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.180"></a><span id="l62.180">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l62.181"></a><span id="l62.181">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.182"></a><span id="l62.182">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l62.183"></a><span id="l62.183">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.184"></a><span id="l62.184">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l62.185"></a><span id="l62.185">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.186"></a><span id="l62.186">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l62.187"></a><span id="l62.187">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.188"></a><span id="l62.188">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l62.189"></a><span id="l62.189">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.190"></a><span id="l62.190" class="difflineminus">-  </span>
<a href="#l62.191"></a><span id="l62.191" class="difflineplus">+</span>
<a href="#l62.192"></a><span id="l62.192">   // multiweek view</span>
<a href="#l62.193"></a><span id="l62.193">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l62.194"></a><span id="l62.194">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l62.195"></a><span id="l62.195">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l62.196"></a><span id="l62.196" class="difflineminus">-  </span>
<a href="#l62.197"></a><span id="l62.197" class="difflineplus">+</span>
<a href="#l62.198"></a><span id="l62.198">   // month view</span>
<a href="#l62.199"></a><span id="l62.199">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l62.200"></a><span id="l62.200">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l62.201"></a><span id="l62.201" class="difflineminus">-  </span>
<a href="#l62.202"></a><span id="l62.202" class="difflineplus">+</span>
<a href="#l62.203"></a><span id="l62.203">   // delete event</span>
<a href="#l62.204"></a><span id="l62.204">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l62.205"></a><span id="l62.205">   calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l62.206"></a><span id="l62.206">   path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l62.207"></a><span id="l62.207">     + eventPath;</span>
<a href="#l62.208"></a><span id="l62.208">   controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.209"></a><span id="l62.209">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l62.210"></a><span id="l62.210">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l62.211"></a><span id="l62.211" class="difflineat">@@ -202,59 +202,59 @@ var testWeeklyWithExceptionRecurrence = </span>
<a href="#l62.212"></a><span id="l62.212">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l62.213"></a><span id="l62.213"> }</span>
<a href="#l62.214"></a><span id="l62.214"> </span>
<a href="#l62.215"></a><span id="l62.215"> function setRecurrence(recurrence){</span>
<a href="#l62.216"></a><span id="l62.216">   // weekly</span>
<a href="#l62.217"></a><span id="l62.217">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l62.218"></a><span id="l62.218">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l62.219"></a><span id="l62.219">   recurrence.sleep(sleep);</span>
<a href="#l62.220"></a><span id="l62.220" class="difflineminus">-  </span>
<a href="#l62.221"></a><span id="l62.221" class="difflineplus">+</span>
<a href="#l62.222"></a><span id="l62.222">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l62.223"></a><span id="l62.223">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l62.224"></a><span id="l62.224">   let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l62.225"></a><span id="l62.225" class="difflineminus">-  </span>
<a href="#l62.226"></a><span id="l62.226" class="difflineplus">+</span>
<a href="#l62.227"></a><span id="l62.227">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l62.228"></a><span id="l62.228">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l62.229"></a><span id="l62.229">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l62.230"></a><span id="l62.230" class="difflineminus">-  </span>
<a href="#l62.231"></a><span id="l62.231" class="difflineplus">+</span>
<a href="#l62.232"></a><span id="l62.232">   // starting from Monday so it should be checked</span>
<a href="#l62.233"></a><span id="l62.233">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l62.234"></a><span id="l62.234">   // check Wednesday and Friday too</span>
<a href="#l62.235"></a><span id="l62.235">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l62.236"></a><span id="l62.236">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l62.237"></a><span id="l62.237" class="difflineminus">-    </span>
<a href="#l62.238"></a><span id="l62.238" class="difflineplus">+</span>
<a href="#l62.239"></a><span id="l62.239">   // close dialog</span>
<a href="#l62.240"></a><span id="l62.240">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l62.241"></a><span id="l62.241">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l62.242"></a><span id="l62.242"> }</span>
<a href="#l62.243"></a><span id="l62.243"> </span>
<a href="#l62.244"></a><span id="l62.244"> function changeRecurrence(recurrence){</span>
<a href="#l62.245"></a><span id="l62.245">   // weekly</span>
<a href="#l62.246"></a><span id="l62.246">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l62.247"></a><span id="l62.247">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l62.248"></a><span id="l62.248">   recurrence.sleep(sleep);</span>
<a href="#l62.249"></a><span id="l62.249" class="difflineminus">-  </span>
<a href="#l62.250"></a><span id="l62.250" class="difflineplus">+</span>
<a href="#l62.251"></a><span id="l62.251">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l62.252"></a><span id="l62.252">   let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l62.253"></a><span id="l62.253">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l62.254"></a><span id="l62.254">   let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l62.255"></a><span id="l62.255" class="difflineminus">-  </span>
<a href="#l62.256"></a><span id="l62.256" class="difflineplus">+</span>
<a href="#l62.257"></a><span id="l62.257">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l62.258"></a><span id="l62.258">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l62.259"></a><span id="l62.259">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l62.260"></a><span id="l62.260" class="difflineminus">-  </span>
<a href="#l62.261"></a><span id="l62.261" class="difflineplus">+</span>
<a href="#l62.262"></a><span id="l62.262">   // check old rule</span>
<a href="#l62.263"></a><span id="l62.263">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l62.264"></a><span id="l62.264">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l62.265"></a><span id="l62.265">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l62.266"></a><span id="l62.266" class="difflineminus">-  </span>
<a href="#l62.267"></a><span id="l62.267" class="difflineplus">+</span>
<a href="#l62.268"></a><span id="l62.268">   // check Tuesday</span>
<a href="#l62.269"></a><span id="l62.269">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l62.270"></a><span id="l62.270" class="difflineminus">-  </span>
<a href="#l62.271"></a><span id="l62.271" class="difflineplus">+</span>
<a href="#l62.272"></a><span id="l62.272">   // close dialog</span>
<a href="#l62.273"></a><span id="l62.273">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l62.274"></a><span id="l62.274">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l62.275"></a><span id="l62.275"> }</span>
<a href="#l62.276"></a><span id="l62.276"> </span>
<a href="#l62.277"></a><span id="l62.277"> function checkMultiWeekView(view){</span>
<a href="#l62.278"></a><span id="l62.278">   let startWeek = view == &quot;multiweek&quot; ? 1 : 2</span>
<a href="#l62.279"></a><span id="l62.279"> </span>
<a href="#l62.280"></a><span id="l62.280" class="difflineat">@@ -270,17 +270,17 @@ function checkMultiWeekView(view){</span>
<a href="#l62.281"></a><span id="l62.281">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l62.282"></a><span id="l62.282">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.283"></a><span id="l62.283">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l62.284"></a><span id="l62.284">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.285"></a><span id="l62.285">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l62.286"></a><span id="l62.286">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.287"></a><span id="l62.287">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l62.288"></a><span id="l62.288">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.289"></a><span id="l62.289" class="difflineminus">-  </span>
<a href="#l62.290"></a><span id="l62.290" class="difflineplus">+</span>
<a href="#l62.291"></a><span id="l62.291">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l62.292"></a><span id="l62.292">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.293"></a><span id="l62.293">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l62.294"></a><span id="l62.294">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.295"></a><span id="l62.295">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l62.296"></a><span id="l62.296">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l62.297"></a><span id="l62.297">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l62.298"></a><span id="l62.298">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -11,82 +11,82 @@ var epoch = 1970;</span>
<a href="#l63.4"></a><span id="l63.4"> </span>
<a href="#l63.5"></a><span id="l63.5"> var setupModule = function(module) {</span>
<a href="#l63.6"></a><span id="l63.6">   controller = mozmill.getMail3PaneController();</span>
<a href="#l63.7"></a><span id="l63.7">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l63.8"></a><span id="l63.8"> }</span>
<a href="#l63.9"></a><span id="l63.9"> </span>
<a href="#l63.10"></a><span id="l63.10"> var testAnnualRecurrence = function () {</span>
<a href="#l63.11"></a><span id="l63.11">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  </span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+</span>
<a href="#l63.14"></a><span id="l63.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l63.15"></a><span id="l63.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l63.16"></a><span id="l63.16">   calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l63.17"></a><span id="l63.17" class="difflineminus">-  </span>
<a href="#l63.18"></a><span id="l63.18" class="difflineplus">+</span>
<a href="#l63.19"></a><span id="l63.19">   // rotate view</span>
<a href="#l63.20"></a><span id="l63.20">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l63.21"></a><span id="l63.21">   controller.waitFor(function() {</span>
<a href="#l63.22"></a><span id="l63.22">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l63.23"></a><span id="l63.23">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l63.24"></a><span id="l63.24" class="difflineminus">-  </span>
<a href="#l63.25"></a><span id="l63.25" class="difflineplus">+</span>
<a href="#l63.26"></a><span id="l63.26">   // create yearly recurring all-day event</span>
<a href="#l63.27"></a><span id="l63.27">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l63.28"></a><span id="l63.28">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l63.29"></a><span id="l63.29">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l63.30"></a><span id="l63.30">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l63.31"></a><span id="l63.31">                  .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l63.32"></a><span id="l63.32">   event.sleep(sleep);</span>
<a href="#l63.33"></a><span id="l63.33">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l63.34"></a><span id="l63.34">     &quot;yearly&quot;);</span>
<a href="#l63.35"></a><span id="l63.35">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l63.36"></a><span id="l63.36">   controller.sleep(sleep);</span>
<a href="#l63.37"></a><span id="l63.37" class="difflineminus">-  </span>
<a href="#l63.38"></a><span id="l63.38" class="difflineplus">+</span>
<a href="#l63.39"></a><span id="l63.39">   let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l63.40"></a><span id="l63.40">   let box = &quot;&quot;;</span>
<a href="#l63.41"></a><span id="l63.41">   for(let i = 0; i &lt; checkYears.length; i++){</span>
<a href="#l63.42"></a><span id="l63.42">     calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l63.43"></a><span id="l63.43">     let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l63.44"></a><span id="l63.44">     let column = date.getDay() + 1;</span>
<a href="#l63.45"></a><span id="l63.45" class="difflineminus">-    </span>
<a href="#l63.46"></a><span id="l63.46" class="difflineplus">+</span>
<a href="#l63.47"></a><span id="l63.47">     // day view</span>
<a href="#l63.48"></a><span id="l63.48">     calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l63.49"></a><span id="l63.49">     box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l63.50"></a><span id="l63.50">       + eventPath;</span>
<a href="#l63.51"></a><span id="l63.51">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l63.52"></a><span id="l63.52" class="difflineminus">-    </span>
<a href="#l63.53"></a><span id="l63.53" class="difflineplus">+</span>
<a href="#l63.54"></a><span id="l63.54">     // week view</span>
<a href="#l63.55"></a><span id="l63.55">     calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l63.56"></a><span id="l63.56">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined)</span>
<a href="#l63.57"></a><span id="l63.57">       + eventPath;</span>
<a href="#l63.58"></a><span id="l63.58">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l63.59"></a><span id="l63.59" class="difflineminus">-    </span>
<a href="#l63.60"></a><span id="l63.60" class="difflineplus">+</span>
<a href="#l63.61"></a><span id="l63.61">     // multiweek view</span>
<a href="#l63.62"></a><span id="l63.62">     calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l63.63"></a><span id="l63.63">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l63.64"></a><span id="l63.64">       + eventPath;</span>
<a href="#l63.65"></a><span id="l63.65">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l63.66"></a><span id="l63.66" class="difflineminus">-    </span>
<a href="#l63.67"></a><span id="l63.67" class="difflineplus">+</span>
<a href="#l63.68"></a><span id="l63.68">     // month view</span>
<a href="#l63.69"></a><span id="l63.69">     calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l63.70"></a><span id="l63.70">     box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined)</span>
<a href="#l63.71"></a><span id="l63.71">       + eventPath;</span>
<a href="#l63.72"></a><span id="l63.72">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l63.73"></a><span id="l63.73">   }</span>
<a href="#l63.74"></a><span id="l63.74" class="difflineminus">-  </span>
<a href="#l63.75"></a><span id="l63.75" class="difflineplus">+</span>
<a href="#l63.76"></a><span id="l63.76">   // delete event</span>
<a href="#l63.77"></a><span id="l63.77">   calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l63.78"></a><span id="l63.78">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l63.79"></a><span id="l63.79">   box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)</span>
<a href="#l63.80"></a><span id="l63.80">     + eventPath;</span>
<a href="#l63.81"></a><span id="l63.81">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l63.82"></a><span id="l63.82">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l63.83"></a><span id="l63.83">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l63.84"></a><span id="l63.84">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l63.85"></a><span id="l63.85">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l63.86"></a><span id="l63.86" class="difflineminus">-  </span>
<a href="#l63.87"></a><span id="l63.87" class="difflineplus">+</span>
<a href="#l63.88"></a><span id="l63.88">   // reset view</span>
<a href="#l63.89"></a><span id="l63.89">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l63.90"></a><span id="l63.90">   controller.waitFor(function() {</span>
<a href="#l63.91"></a><span id="l63.91">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l63.92"></a><span id="l63.92">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l63.93"></a><span id="l63.93"> }</span>
<a href="#l63.94"></a><span id="l63.94"> </span>
<a href="#l63.95"></a><span id="l63.95"> var teardownTest = function(module) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -1,116 +1,116 @@</span>
<a href="#l64.4"></a><span id="l64.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l64.5"></a><span id="l64.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l64.6"></a><span id="l64.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l64.7"></a><span id="l64.7" class="difflineminus">- </span>
<a href="#l64.8"></a><span id="l64.8" class="difflineplus">+</span>
<a href="#l64.9"></a><span id="l64.9"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l64.10"></a><span id="l64.10"> </span>
<a href="#l64.11"></a><span id="l64.11"> var sleep = 500;</span>
<a href="#l64.12"></a><span id="l64.12"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l64.13"></a><span id="l64.13"> var hour = 8;</span>
<a href="#l64.14"></a><span id="l64.14"> </span>
<a href="#l64.15"></a><span id="l64.15"> var setupModule = function(module) {</span>
<a href="#l64.16"></a><span id="l64.16">   controller = mozmill.getMail3PaneController();</span>
<a href="#l64.17"></a><span id="l64.17">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l64.18"></a><span id="l64.18"> }</span>
<a href="#l64.19"></a><span id="l64.19"> </span>
<a href="#l64.20"></a><span id="l64.20"> var testBiweeklyRecurrence = function () {</span>
<a href="#l64.21"></a><span id="l64.21">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineminus">-  </span>
<a href="#l64.23"></a><span id="l64.23" class="difflineplus">+</span>
<a href="#l64.24"></a><span id="l64.24">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l64.25"></a><span id="l64.25">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l64.26"></a><span id="l64.26">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l64.27"></a><span id="l64.27" class="difflineminus">-  </span>
<a href="#l64.28"></a><span id="l64.28" class="difflineplus">+</span>
<a href="#l64.29"></a><span id="l64.29">   // rotate view</span>
<a href="#l64.30"></a><span id="l64.30">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l64.31"></a><span id="l64.31">   controller.waitFor(function() {</span>
<a href="#l64.32"></a><span id="l64.32">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l64.33"></a><span id="l64.33">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l64.34"></a><span id="l64.34" class="difflineminus">-  </span>
<a href="#l64.35"></a><span id="l64.35" class="difflineplus">+</span>
<a href="#l64.36"></a><span id="l64.36">   // create biweekly event</span>
<a href="#l64.37"></a><span id="l64.37">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l64.38"></a><span id="l64.38">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l64.39"></a><span id="l64.39">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l64.40"></a><span id="l64.40">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l64.41"></a><span id="l64.41" class="difflineminus">-  </span>
<a href="#l64.42"></a><span id="l64.42" class="difflineplus">+</span>
<a href="#l64.43"></a><span id="l64.43">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l64.44"></a><span id="l64.44">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l64.45"></a><span id="l64.45">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l64.46"></a><span id="l64.46">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l64.47"></a><span id="l64.47" class="difflineminus">-  </span>
<a href="#l64.48"></a><span id="l64.48" class="difflineplus">+</span>
<a href="#l64.49"></a><span id="l64.49">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l64.50"></a><span id="l64.50">     + eventPath;</span>
<a href="#l64.51"></a><span id="l64.51" class="difflineminus">-  </span>
<a href="#l64.52"></a><span id="l64.52" class="difflineplus">+</span>
<a href="#l64.53"></a><span id="l64.53">   // check day view</span>
<a href="#l64.54"></a><span id="l64.54">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l64.55"></a><span id="l64.55">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.56"></a><span id="l64.56">     calUtils.forward(controller, 14);</span>
<a href="#l64.57"></a><span id="l64.57">   }</span>
<a href="#l64.58"></a><span id="l64.58" class="difflineminus">-  </span>
<a href="#l64.59"></a><span id="l64.59" class="difflineplus">+</span>
<a href="#l64.60"></a><span id="l64.60">   // check week view</span>
<a href="#l64.61"></a><span id="l64.61">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l64.62"></a><span id="l64.62">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l64.63"></a><span id="l64.63" class="difflineminus">-  </span>
<a href="#l64.64"></a><span id="l64.64" class="difflineplus">+</span>
<a href="#l64.65"></a><span id="l64.65">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l64.66"></a><span id="l64.66">     + eventPath;</span>
<a href="#l64.67"></a><span id="l64.67">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l64.68"></a><span id="l64.68">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.69"></a><span id="l64.69">     calUtils.forward(2);</span>
<a href="#l64.70"></a><span id="l64.70">   }</span>
<a href="#l64.71"></a><span id="l64.71"> </span>
<a href="#l64.72"></a><span id="l64.72">   // check multiweek view</span>
<a href="#l64.73"></a><span id="l64.73">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l64.74"></a><span id="l64.74">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l64.75"></a><span id="l64.75" class="difflineminus">-  </span>
<a href="#l64.76"></a><span id="l64.76" class="difflineplus">+</span>
<a href="#l64.77"></a><span id="l64.77">   // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l64.78"></a><span id="l64.78">   for(let i = 0; i &lt; 5; i++){</span>
<a href="#l64.79"></a><span id="l64.79">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l64.80"></a><span id="l64.80">       undefined) + eventPath;</span>
<a href="#l64.81"></a><span id="l64.81">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.82"></a><span id="l64.82">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l64.83"></a><span id="l64.83">       undefined) + eventPath;</span>
<a href="#l64.84"></a><span id="l64.84">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.85"></a><span id="l64.85">     calUtils.forward(controller, 1);</span>
<a href="#l64.86"></a><span id="l64.86">   }</span>
<a href="#l64.87"></a><span id="l64.87" class="difflineminus">-  </span>
<a href="#l64.88"></a><span id="l64.88" class="difflineplus">+</span>
<a href="#l64.89"></a><span id="l64.89">   // check month view</span>
<a href="#l64.90"></a><span id="l64.90">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l64.91"></a><span id="l64.91">   calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l64.92"></a><span id="l64.92"> </span>
<a href="#l64.93"></a><span id="l64.93">   // January</span>
<a href="#l64.94"></a><span id="l64.94">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined)</span>
<a href="#l64.95"></a><span id="l64.95">     + eventPath;</span>
<a href="#l64.96"></a><span id="l64.96">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.97"></a><span id="l64.97">   calUtils.forward(controller, 1);</span>
<a href="#l64.98"></a><span id="l64.98" class="difflineminus">-  </span>
<a href="#l64.99"></a><span id="l64.99" class="difflineplus">+</span>
<a href="#l64.100"></a><span id="l64.100">   // February</span>
<a href="#l64.101"></a><span id="l64.101">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l64.102"></a><span id="l64.102">     + eventPath;</span>
<a href="#l64.103"></a><span id="l64.103">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.104"></a><span id="l64.104">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l64.105"></a><span id="l64.105">     + eventPath;</span>
<a href="#l64.106"></a><span id="l64.106">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.107"></a><span id="l64.107">   calUtils.forward(controller, 1);</span>
<a href="#l64.108"></a><span id="l64.108" class="difflineminus">-  </span>
<a href="#l64.109"></a><span id="l64.109" class="difflineplus">+</span>
<a href="#l64.110"></a><span id="l64.110">   // March</span>
<a href="#l64.111"></a><span id="l64.111">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined)</span>
<a href="#l64.112"></a><span id="l64.112">     + eventPath;</span>
<a href="#l64.113"></a><span id="l64.113">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.114"></a><span id="l64.114">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined)</span>
<a href="#l64.115"></a><span id="l64.115">     + eventPath;</span>
<a href="#l64.116"></a><span id="l64.116" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));  </span>
<a href="#l64.117"></a><span id="l64.117" class="difflineplus">+  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.118"></a><span id="l64.118"> </span>
<a href="#l64.119"></a><span id="l64.119">   // delete event</span>
<a href="#l64.120"></a><span id="l64.120">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.121"></a><span id="l64.121">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l64.122"></a><span id="l64.122">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l64.123"></a><span id="l64.123">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l64.124"></a><span id="l64.124">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l64.125"></a><span id="l64.125" class="difflineminus">-  </span>
<a href="#l64.126"></a><span id="l64.126" class="difflineplus">+</span>
<a href="#l64.127"></a><span id="l64.127">   // reset view</span>
<a href="#l64.128"></a><span id="l64.128">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l64.129"></a><span id="l64.129">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l64.130"></a><span id="l64.130">   controller.waitFor(function() {</span>
<a href="#l64.131"></a><span id="l64.131">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l64.132"></a><span id="l64.132">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l64.133"></a><span id="l64.133"> }</span>
<a href="#l64.134"></a><span id="l64.134"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -10,206 +10,206 @@ var hour = 8;</span>
<a href="#l65.4"></a><span id="l65.4"> </span>
<a href="#l65.5"></a><span id="l65.5"> var setupModule = function(module) {</span>
<a href="#l65.6"></a><span id="l65.6">   controller = mozmill.getMail3PaneController();</span>
<a href="#l65.7"></a><span id="l65.7">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l65.8"></a><span id="l65.8"> }</span>
<a href="#l65.9"></a><span id="l65.9"> </span>
<a href="#l65.10"></a><span id="l65.10"> var testDailyRecurrence = function () {</span>
<a href="#l65.11"></a><span id="l65.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  </span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+</span>
<a href="#l65.14"></a><span id="l65.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l65.15"></a><span id="l65.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l65.16"></a><span id="l65.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.17"></a><span id="l65.17" class="difflineminus">-  </span>
<a href="#l65.18"></a><span id="l65.18" class="difflineplus">+</span>
<a href="#l65.19"></a><span id="l65.19">   // rotate view</span>
<a href="#l65.20"></a><span id="l65.20">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l65.21"></a><span id="l65.21">   controller.waitFor(function() {</span>
<a href="#l65.22"></a><span id="l65.22">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l65.23"></a><span id="l65.23">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l65.24"></a><span id="l65.24" class="difflineminus">-  </span>
<a href="#l65.25"></a><span id="l65.25" class="difflineplus">+</span>
<a href="#l65.26"></a><span id="l65.26">   // create daily event</span>
<a href="#l65.27"></a><span id="l65.27">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l65.28"></a><span id="l65.28">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l65.29"></a><span id="l65.29">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l65.30"></a><span id="l65.30">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l65.31"></a><span id="l65.31">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineminus">-  </span>
<a href="#l65.33"></a><span id="l65.33" class="difflineplus">+</span>
<a href="#l65.34"></a><span id="l65.34">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l65.35"></a><span id="l65.35">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l65.36"></a><span id="l65.36">     &quot;daily&quot;);</span>
<a href="#l65.37"></a><span id="l65.37">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l65.38"></a><span id="l65.38" class="difflineminus">-  </span>
<a href="#l65.39"></a><span id="l65.39" class="difflineplus">+</span>
<a href="#l65.40"></a><span id="l65.40">   // check day view for 7 days</span>
<a href="#l65.41"></a><span id="l65.41">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l65.42"></a><span id="l65.42">     + eventPath;</span>
<a href="#l65.43"></a><span id="l65.43">   controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.44"></a><span id="l65.44" class="difflineminus">-  </span>
<a href="#l65.45"></a><span id="l65.45" class="difflineplus">+</span>
<a href="#l65.46"></a><span id="l65.46">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l65.47"></a><span id="l65.47">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.48"></a><span id="l65.48">     calUtils.forward(controller, 1);</span>
<a href="#l65.49"></a><span id="l65.49">   }</span>
<a href="#l65.50"></a><span id="l65.50" class="difflineminus">-  </span>
<a href="#l65.51"></a><span id="l65.51" class="difflineplus">+</span>
<a href="#l65.52"></a><span id="l65.52">   // check week view for 2 weeks</span>
<a href="#l65.53"></a><span id="l65.53">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l65.54"></a><span id="l65.54">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.55"></a><span id="l65.55" class="difflineminus">-  </span>
<a href="#l65.56"></a><span id="l65.56" class="difflineplus">+</span>
<a href="#l65.57"></a><span id="l65.57">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l65.58"></a><span id="l65.58">     let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l65.59"></a><span id="l65.59">       + eventPath;</span>
<a href="#l65.60"></a><span id="l65.60">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.61"></a><span id="l65.61">   }</span>
<a href="#l65.62"></a><span id="l65.62" class="difflineminus">-  </span>
<a href="#l65.63"></a><span id="l65.63" class="difflineplus">+</span>
<a href="#l65.64"></a><span id="l65.64">   calUtils.forward(controller, 1);</span>
<a href="#l65.65"></a><span id="l65.65" class="difflineminus">-  </span>
<a href="#l65.66"></a><span id="l65.66" class="difflineplus">+</span>
<a href="#l65.67"></a><span id="l65.67">   for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l65.68"></a><span id="l65.68">     let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l65.69"></a><span id="l65.69">       + eventPath;</span>
<a href="#l65.70"></a><span id="l65.70">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.71"></a><span id="l65.71">   }</span>
<a href="#l65.72"></a><span id="l65.72" class="difflineminus">-  </span>
<a href="#l65.73"></a><span id="l65.73" class="difflineplus">+</span>
<a href="#l65.74"></a><span id="l65.74">   // check multiweek view for 4 weeks</span>
<a href="#l65.75"></a><span id="l65.75">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l65.76"></a><span id="l65.76">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.77"></a><span id="l65.77" class="difflineminus">-  </span>
<a href="#l65.78"></a><span id="l65.78" class="difflineplus">+</span>
<a href="#l65.79"></a><span id="l65.79">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l65.80"></a><span id="l65.80">     let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l65.81"></a><span id="l65.81">       + eventPath;</span>
<a href="#l65.82"></a><span id="l65.82">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.83"></a><span id="l65.83">   }</span>
<a href="#l65.84"></a><span id="l65.84" class="difflineminus">-  </span>
<a href="#l65.85"></a><span id="l65.85" class="difflineplus">+</span>
<a href="#l65.86"></a><span id="l65.86">   for(let week = 2; week &lt;= 4; week++){</span>
<a href="#l65.87"></a><span id="l65.87">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l65.88"></a><span id="l65.88">       let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l65.89"></a><span id="l65.89">         + eventPath;</span>
<a href="#l65.90"></a><span id="l65.90">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.91"></a><span id="l65.91">     }</span>
<a href="#l65.92"></a><span id="l65.92">   }</span>
<a href="#l65.93"></a><span id="l65.93" class="difflineminus">-  </span>
<a href="#l65.94"></a><span id="l65.94" class="difflineplus">+</span>
<a href="#l65.95"></a><span id="l65.95">   // check month view for all 5 weeks</span>
<a href="#l65.96"></a><span id="l65.96">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l65.97"></a><span id="l65.97">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.98"></a><span id="l65.98" class="difflineminus">-  </span>
<a href="#l65.99"></a><span id="l65.99" class="difflineplus">+</span>
<a href="#l65.100"></a><span id="l65.100">   for(let day = 5; day &lt;= 7; day++){</span>
<a href="#l65.101"></a><span id="l65.101">     let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l65.102"></a><span id="l65.102">       + eventPath;</span>
<a href="#l65.103"></a><span id="l65.103">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.104"></a><span id="l65.104">   }</span>
<a href="#l65.105"></a><span id="l65.105" class="difflineminus">-  </span>
<a href="#l65.106"></a><span id="l65.106" class="difflineplus">+</span>
<a href="#l65.107"></a><span id="l65.107">   for(let week = 2; week &lt;= 5; week++){</span>
<a href="#l65.108"></a><span id="l65.108">     for(let day = 1; day &lt;= 7; day++){</span>
<a href="#l65.109"></a><span id="l65.109">       let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l65.110"></a><span id="l65.110">         + eventPath;</span>
<a href="#l65.111"></a><span id="l65.111">       controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l65.112"></a><span id="l65.112">     }</span>
<a href="#l65.113"></a><span id="l65.113">   }</span>
<a href="#l65.114"></a><span id="l65.114" class="difflineminus">-  </span>
<a href="#l65.115"></a><span id="l65.115" class="difflineplus">+</span>
<a href="#l65.116"></a><span id="l65.116">   // delete 3rd January occurrence</span>
<a href="#l65.117"></a><span id="l65.117">   let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l65.118"></a><span id="l65.118">     + eventPath;</span>
<a href="#l65.119"></a><span id="l65.119">   calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l65.120"></a><span id="l65.120">   controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l65.121"></a><span id="l65.121">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l65.122"></a><span id="l65.122">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l65.123"></a><span id="l65.123" class="difflineminus">-  </span>
<a href="#l65.124"></a><span id="l65.124" class="difflineplus">+</span>
<a href="#l65.125"></a><span id="l65.125">   // verify in all views</span>
<a href="#l65.126"></a><span id="l65.126">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l65.127"></a><span id="l65.127" class="difflineminus">-  </span>
<a href="#l65.128"></a><span id="l65.128" class="difflineplus">+</span>
<a href="#l65.129"></a><span id="l65.129">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l65.130"></a><span id="l65.130">   saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l65.131"></a><span id="l65.131">     + eventPath;</span>
<a href="#l65.132"></a><span id="l65.132">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l65.133"></a><span id="l65.133" class="difflineminus">-    </span>
<a href="#l65.134"></a><span id="l65.134" class="difflineplus">+</span>
<a href="#l65.135"></a><span id="l65.135">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l65.136"></a><span id="l65.136">   saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l65.137"></a><span id="l65.137">     + eventPath;</span>
<a href="#l65.138"></a><span id="l65.138">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l65.139"></a><span id="l65.139" class="difflineminus">-    </span>
<a href="#l65.140"></a><span id="l65.140" class="difflineplus">+</span>
<a href="#l65.141"></a><span id="l65.141">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l65.142"></a><span id="l65.142">   saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l65.143"></a><span id="l65.143">     + eventPath;</span>
<a href="#l65.144"></a><span id="l65.144">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l65.145"></a><span id="l65.145" class="difflineminus">-  </span>
<a href="#l65.146"></a><span id="l65.146" class="difflineplus">+</span>
<a href="#l65.147"></a><span id="l65.147">   // go to previous day to edit event to occur only on weekdays</span>
<a href="#l65.148"></a><span id="l65.148">   calUtils.back(controller, 1);</span>
<a href="#l65.149"></a><span id="l65.149" class="difflineminus">-  </span>
<a href="#l65.150"></a><span id="l65.150" class="difflineplus">+</span>
<a href="#l65.151"></a><span id="l65.151">   calUtils.handleParentModification(controller, false);</span>
<a href="#l65.152"></a><span id="l65.152">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l65.153"></a><span id="l65.153">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l65.154"></a><span id="l65.154">       + eventPath));</span>
<a href="#l65.155"></a><span id="l65.155" class="difflineminus">-  </span>
<a href="#l65.156"></a><span id="l65.156" class="difflineplus">+</span>
<a href="#l65.157"></a><span id="l65.157">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l65.158"></a><span id="l65.158">   event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l65.159"></a><span id="l65.159">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l65.160"></a><span id="l65.160" class="difflineminus">-  </span>
<a href="#l65.161"></a><span id="l65.161" class="difflineplus">+</span>
<a href="#l65.162"></a><span id="l65.162">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l65.163"></a><span id="l65.163">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l65.164"></a><span id="l65.164">     &quot;every.weekday&quot;);</span>
<a href="#l65.165"></a><span id="l65.165">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l65.166"></a><span id="l65.166">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l65.167"></a><span id="l65.167" class="difflineminus">-  </span>
<a href="#l65.168"></a><span id="l65.168" class="difflineplus">+</span>
<a href="#l65.169"></a><span id="l65.169">   // check day view for 7 days</span>
<a href="#l65.170"></a><span id="l65.170">   let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l65.171"></a><span id="l65.171">     + eventPath;</span>
<a href="#l65.172"></a><span id="l65.172">   var dates = [[2009, 1, 3],</span>
<a href="#l65.173"></a><span id="l65.173">                [2009, 1, 4]];</span>
<a href="#l65.174"></a><span id="l65.174">   for(let i = 0; i &lt; dates.length; i++){</span>
<a href="#l65.175"></a><span id="l65.175">     calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l65.176"></a><span id="l65.176">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.177"></a><span id="l65.177">   }</span>
<a href="#l65.178"></a><span id="l65.178" class="difflineminus">-  </span>
<a href="#l65.179"></a><span id="l65.179" class="difflineplus">+</span>
<a href="#l65.180"></a><span id="l65.180">   // check week view for 2 weeks</span>
<a href="#l65.181"></a><span id="l65.181">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l65.182"></a><span id="l65.182">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.183"></a><span id="l65.183" class="difflineminus">-  </span>
<a href="#l65.184"></a><span id="l65.184" class="difflineplus">+</span>
<a href="#l65.185"></a><span id="l65.185">   for(let i = 0; i &lt;= 1; i++){</span>
<a href="#l65.186"></a><span id="l65.186">     let day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l65.187"></a><span id="l65.187">       + eventPath;</span>
<a href="#l65.188"></a><span id="l65.188">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.189"></a><span id="l65.189">     day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l65.190"></a><span id="l65.190">       + eventPath;</span>
<a href="#l65.191"></a><span id="l65.191">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.192"></a><span id="l65.192">     calUtils.forward(controller, 1);</span>
<a href="#l65.193"></a><span id="l65.193">   }</span>
<a href="#l65.194"></a><span id="l65.194" class="difflineminus">-  </span>
<a href="#l65.195"></a><span id="l65.195" class="difflineplus">+</span>
<a href="#l65.196"></a><span id="l65.196">   // check multiweek view for 4 weeks</span>
<a href="#l65.197"></a><span id="l65.197">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l65.198"></a><span id="l65.198">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.199"></a><span id="l65.199" class="difflineminus">-  </span>
<a href="#l65.200"></a><span id="l65.200" class="difflineplus">+</span>
<a href="#l65.201"></a><span id="l65.201">   for(let i = 1; i &lt;= 4; i++){</span>
<a href="#l65.202"></a><span id="l65.202">     let day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l65.203"></a><span id="l65.203">       + eventPath;</span>
<a href="#l65.204"></a><span id="l65.204">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.205"></a><span id="l65.205">     day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l65.206"></a><span id="l65.206">       + eventPath;</span>
<a href="#l65.207"></a><span id="l65.207">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.208"></a><span id="l65.208">   }</span>
<a href="#l65.209"></a><span id="l65.209" class="difflineminus">-  </span>
<a href="#l65.210"></a><span id="l65.210" class="difflineplus">+</span>
<a href="#l65.211"></a><span id="l65.211">   // check month view for all 5 weeks</span>
<a href="#l65.212"></a><span id="l65.212">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l65.213"></a><span id="l65.213">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l65.214"></a><span id="l65.214" class="difflineminus">-  </span>
<a href="#l65.215"></a><span id="l65.215" class="difflineplus">+</span>
<a href="#l65.216"></a><span id="l65.216">   for(let i = 1; i &lt;= 5; i++){</span>
<a href="#l65.217"></a><span id="l65.217">     let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l65.218"></a><span id="l65.218">       + eventPath;</span>
<a href="#l65.219"></a><span id="l65.219">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.220"></a><span id="l65.220">     day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l65.221"></a><span id="l65.221">       + eventPath;</span>
<a href="#l65.222"></a><span id="l65.222">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.223"></a><span id="l65.223">   }</span>
<a href="#l65.224"></a><span id="l65.224" class="difflineminus">-  </span>
<a href="#l65.225"></a><span id="l65.225" class="difflineplus">+</span>
<a href="#l65.226"></a><span id="l65.226">   // delete event</span>
<a href="#l65.227"></a><span id="l65.227">   day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined)</span>
<a href="#l65.228"></a><span id="l65.228">     + eventPath</span>
<a href="#l65.229"></a><span id="l65.229">   controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.230"></a><span id="l65.230">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l65.231"></a><span id="l65.231">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l65.232"></a><span id="l65.232">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l65.233"></a><span id="l65.233">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l65.234"></a><span id="l65.234" class="difflineminus">-  </span>
<a href="#l65.235"></a><span id="l65.235" class="difflineplus">+</span>
<a href="#l65.236"></a><span id="l65.236">   // reset view</span>
<a href="#l65.237"></a><span id="l65.237">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l65.238"></a><span id="l65.238">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l65.239"></a><span id="l65.239">   controller.waitFor(function() {</span>
<a href="#l65.240"></a><span id="l65.240">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l65.241"></a><span id="l65.241">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l65.242"></a><span id="l65.242"> }</span>
<a href="#l65.243"></a><span id="l65.243"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l66.4"></a><span id="l66.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l66.5"></a><span id="l66.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l66.6"></a><span id="l66.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l66.7"></a><span id="l66.7" class="difflineminus">- </span>
<a href="#l66.8"></a><span id="l66.8" class="difflineplus">+</span>
<a href="#l66.9"></a><span id="l66.9"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l66.10"></a><span id="l66.10"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12"> var sleep = 500;</span>
<a href="#l66.13"></a><span id="l66.13"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l66.14"></a><span id="l66.14"> var hour = 8;</span>
<a href="#l66.15"></a><span id="l66.15"> </span>
<a href="#l66.16"></a><span id="l66.16"> var setupModule = function(module) {</span>
<a href="#l66.17"></a><span id="l66.17" class="difflineat">@@ -14,39 +14,39 @@ var setupModule = function(module) {</span>
<a href="#l66.18"></a><span id="l66.18">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l66.19"></a><span id="l66.19"> }</span>
<a href="#l66.20"></a><span id="l66.20"> </span>
<a href="#l66.21"></a><span id="l66.21"> var testLastDayOfMonthRecurrence = function () {</span>
<a href="#l66.22"></a><span id="l66.22">   var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l66.23"></a><span id="l66.23">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l66.24"></a><span id="l66.24">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l66.25"></a><span id="l66.25">   calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l66.26"></a><span id="l66.26" class="difflineminus">-  </span>
<a href="#l66.27"></a><span id="l66.27" class="difflineplus">+</span>
<a href="#l66.28"></a><span id="l66.28">   // rotate view</span>
<a href="#l66.29"></a><span id="l66.29">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l66.30"></a><span id="l66.30">   controller.waitFor(function() {</span>
<a href="#l66.31"></a><span id="l66.31">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l66.32"></a><span id="l66.32">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l66.33"></a><span id="l66.33" class="difflineminus">-  </span>
<a href="#l66.34"></a><span id="l66.34" class="difflineplus">+</span>
<a href="#l66.35"></a><span id="l66.35">   // create monthly recurring event</span>
<a href="#l66.36"></a><span id="l66.36">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l66.37"></a><span id="l66.37">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l66.38"></a><span id="l66.38">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l66.39"></a><span id="l66.39">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l66.40"></a><span id="l66.40">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l66.41"></a><span id="l66.41" class="difflineminus">-  </span>
<a href="#l66.42"></a><span id="l66.42" class="difflineplus">+</span>
<a href="#l66.43"></a><span id="l66.43">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l66.44"></a><span id="l66.44">   md.start(setRecurrence);</span>
<a href="#l66.45"></a><span id="l66.45">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l66.46"></a><span id="l66.46">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l66.47"></a><span id="l66.47">     &quot;custom&quot;);</span>
<a href="#l66.48"></a><span id="l66.48" class="difflineminus">-  </span>
<a href="#l66.49"></a><span id="l66.49" class="difflineplus">+</span>
<a href="#l66.50"></a><span id="l66.50">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l66.51"></a><span id="l66.51">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l66.52"></a><span id="l66.52" class="difflineminus">-  </span>
<a href="#l66.53"></a><span id="l66.53" class="difflineplus">+</span>
<a href="#l66.54"></a><span id="l66.54">   //                        date     correct row in month view</span>
<a href="#l66.55"></a><span id="l66.55">   let checkingData = [[2008,  1, 31, 5],</span>
<a href="#l66.56"></a><span id="l66.56">                       [2008,  2, 29, 5],</span>
<a href="#l66.57"></a><span id="l66.57">                       [2008,  3, 31, 6],</span>
<a href="#l66.58"></a><span id="l66.58">                       [2008,  4, 30, 5],</span>
<a href="#l66.59"></a><span id="l66.59">                       [2008,  5, 31, 5],</span>
<a href="#l66.60"></a><span id="l66.60">                       [2008,  6, 30, 5],</span>
<a href="#l66.61"></a><span id="l66.61">                       [2008,  7, 31, 5],</span>
<a href="#l66.62"></a><span id="l66.62" class="difflineat">@@ -54,83 +54,83 @@ var testLastDayOfMonthRecurrence = funct</span>
<a href="#l66.63"></a><span id="l66.63">                       [2008,  9, 30, 5],</span>
<a href="#l66.64"></a><span id="l66.64">                       [2008, 10, 31, 5],</span>
<a href="#l66.65"></a><span id="l66.65">                       [2008, 11, 30, 6],</span>
<a href="#l66.66"></a><span id="l66.66">                       [2008, 12, 31, 5],</span>
<a href="#l66.67"></a><span id="l66.67">                       [2009,  1, 31, 5],</span>
<a href="#l66.68"></a><span id="l66.68">                       [2009,  2, 28, 4],</span>
<a href="#l66.69"></a><span id="l66.69">                       [2009,  3, 31, 5]];</span>
<a href="#l66.70"></a><span id="l66.70">   let box = &quot;&quot;;</span>
<a href="#l66.71"></a><span id="l66.71" class="difflineminus">-  </span>
<a href="#l66.72"></a><span id="l66.72" class="difflineplus">+</span>
<a href="#l66.73"></a><span id="l66.73">   // check all dates</span>
<a href="#l66.74"></a><span id="l66.74">   for(let i = 0; i &lt; checkingData.length; i++){</span>
<a href="#l66.75"></a><span id="l66.75">     calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l66.76"></a><span id="l66.76" class="difflineminus">-    </span>
<a href="#l66.77"></a><span id="l66.77" class="difflineplus">+</span>
<a href="#l66.78"></a><span id="l66.78">     // day view</span>
<a href="#l66.79"></a><span id="l66.79">     calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l66.80"></a><span id="l66.80">     box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l66.81"></a><span id="l66.81">       + eventPath;</span>
<a href="#l66.82"></a><span id="l66.82">     controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l66.83"></a><span id="l66.83" class="difflineminus">-    </span>
<a href="#l66.84"></a><span id="l66.84" class="difflineplus">+</span>
<a href="#l66.85"></a><span id="l66.85">     // week view</span>
<a href="#l66.86"></a><span id="l66.86">     calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l66.87"></a><span id="l66.87">     let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l66.88"></a><span id="l66.88">     let column = date.getDay() + 1;</span>
<a href="#l66.89"></a><span id="l66.89">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour)</span>
<a href="#l66.90"></a><span id="l66.90">       + eventPath;</span>
<a href="#l66.91"></a><span id="l66.91">     controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l66.92"></a><span id="l66.92" class="difflineminus">-    </span>
<a href="#l66.93"></a><span id="l66.93" class="difflineplus">+</span>
<a href="#l66.94"></a><span id="l66.94">     // multiweek view</span>
<a href="#l66.95"></a><span id="l66.95">     calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l66.96"></a><span id="l66.96">     box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined)</span>
<a href="#l66.97"></a><span id="l66.97">       + eventPath;</span>
<a href="#l66.98"></a><span id="l66.98">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l66.99"></a><span id="l66.99" class="difflineminus">-    </span>
<a href="#l66.100"></a><span id="l66.100" class="difflineplus">+</span>
<a href="#l66.101"></a><span id="l66.101">     // month view</span>
<a href="#l66.102"></a><span id="l66.102">     calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l66.103"></a><span id="l66.103">     box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l66.104"></a><span id="l66.104">       column, undefined) + eventPath;</span>
<a href="#l66.105"></a><span id="l66.105">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l66.106"></a><span id="l66.106">   }</span>
<a href="#l66.107"></a><span id="l66.107" class="difflineminus">-  </span>
<a href="#l66.108"></a><span id="l66.108" class="difflineplus">+</span>
<a href="#l66.109"></a><span id="l66.109">   // delete event</span>
<a href="#l66.110"></a><span id="l66.110">   calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l66.111"></a><span id="l66.111">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l66.112"></a><span id="l66.112">   box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l66.113"></a><span id="l66.113">     undefined, 1, hour) + eventPath;</span>
<a href="#l66.114"></a><span id="l66.114">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l66.115"></a><span id="l66.115">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l66.116"></a><span id="l66.116">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l66.117"></a><span id="l66.117">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l66.118"></a><span id="l66.118">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l66.119"></a><span id="l66.119" class="difflineminus">-  </span>
<a href="#l66.120"></a><span id="l66.120" class="difflineplus">+</span>
<a href="#l66.121"></a><span id="l66.121">   // reset view</span>
<a href="#l66.122"></a><span id="l66.122">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l66.123"></a><span id="l66.123">   controller.waitFor(function() {</span>
<a href="#l66.124"></a><span id="l66.124">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l66.125"></a><span id="l66.125">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l66.126"></a><span id="l66.126"> }</span>
<a href="#l66.127"></a><span id="l66.127"> </span>
<a href="#l66.128"></a><span id="l66.128"> function setRecurrence(recurrence){</span>
<a href="#l66.129"></a><span id="l66.129">   recurrence.sleep(sleep);</span>
<a href="#l66.130"></a><span id="l66.130" class="difflineminus">-  </span>
<a href="#l66.131"></a><span id="l66.131" class="difflineplus">+</span>
<a href="#l66.132"></a><span id="l66.132">   // monthly</span>
<a href="#l66.133"></a><span id="l66.133">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l66.134"></a><span id="l66.134">     undefined, &quot;2&quot;);</span>
<a href="#l66.135"></a><span id="l66.135" class="difflineminus">-  </span>
<a href="#l66.136"></a><span id="l66.136" class="difflineplus">+</span>
<a href="#l66.137"></a><span id="l66.137">   // last day of month</span>
<a href="#l66.138"></a><span id="l66.138">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l66.139"></a><span id="l66.139">   recurrence.sleep(sleep);</span>
<a href="#l66.140"></a><span id="l66.140">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l66.141"></a><span id="l66.141">     undefined, &quot;-1&quot;);</span>
<a href="#l66.142"></a><span id="l66.142">   recurrence.sleep(sleep);</span>
<a href="#l66.143"></a><span id="l66.143">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l66.144"></a><span id="l66.144">     undefined, &quot;-1&quot;);</span>
<a href="#l66.145"></a><span id="l66.145">   recurrence.sleep(sleep);</span>
<a href="#l66.146"></a><span id="l66.146" class="difflineminus">-  </span>
<a href="#l66.147"></a><span id="l66.147" class="difflineplus">+</span>
<a href="#l66.148"></a><span id="l66.148">   // close dialog</span>
<a href="#l66.149"></a><span id="l66.149">   recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l66.150"></a><span id="l66.150">     '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l66.151"></a><span id="l66.151"> }</span>
<a href="#l66.152"></a><span id="l66.152"> </span>
<a href="#l66.153"></a><span id="l66.153"> var teardownTest = function(module) {</span>
<a href="#l66.154"></a><span id="l66.154">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l66.155"></a><span id="l66.155"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -15,142 +15,141 @@ var setupModule = function(module) {</span>
<a href="#l67.4"></a><span id="l67.4">   controller = mozmill.getMail3PaneController();</span>
<a href="#l67.5"></a><span id="l67.5">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l67.6"></a><span id="l67.6"> }</span>
<a href="#l67.7"></a><span id="l67.7"> </span>
<a href="#l67.8"></a><span id="l67.8"> var testWeeklyNRecurrence = function () {</span>
<a href="#l67.9"></a><span id="l67.9">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l67.10"></a><span id="l67.10">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.11"></a><span id="l67.11">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-  </span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+</span>
<a href="#l67.14"></a><span id="l67.14">   // rotate view</span>
<a href="#l67.15"></a><span id="l67.15">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l67.16"></a><span id="l67.16">   controller.waitFor(function() {</span>
<a href="#l67.17"></a><span id="l67.17">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l67.18"></a><span id="l67.18">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l67.19"></a><span id="l67.19" class="difflineminus">-  </span>
<a href="#l67.20"></a><span id="l67.20" class="difflineplus">+</span>
<a href="#l67.21"></a><span id="l67.21">   // create weekly recurring event</span>
<a href="#l67.22"></a><span id="l67.22">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l67.23"></a><span id="l67.23">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l67.24"></a><span id="l67.24">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l67.25"></a><span id="l67.25">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l67.26"></a><span id="l67.26" class="difflineminus">-  </span>
<a href="#l67.27"></a><span id="l67.27" class="difflineplus">+</span>
<a href="#l67.28"></a><span id="l67.28">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l67.29"></a><span id="l67.29">   md.start(setRecurrence);</span>
<a href="#l67.30"></a><span id="l67.30">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l67.31"></a><span id="l67.31">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineminus">-  </span>
<a href="#l67.33"></a><span id="l67.33" class="difflineplus">+</span>
<a href="#l67.34"></a><span id="l67.34">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l67.35"></a><span id="l67.35" class="difflineminus">-  </span>
<a href="#l67.36"></a><span id="l67.36" class="difflineminus">-  </span>
<a href="#l67.37"></a><span id="l67.37" class="difflineplus">+</span>
<a href="#l67.38"></a><span id="l67.38">   // check day view</span>
<a href="#l67.39"></a><span id="l67.39">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l67.40"></a><span id="l67.40">     + eventPath;</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineminus">-  </span>
<a href="#l67.42"></a><span id="l67.42" class="difflineplus">+</span>
<a href="#l67.43"></a><span id="l67.43">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l67.44"></a><span id="l67.44">   for(let i = 0; i &lt; 4; i++){</span>
<a href="#l67.45"></a><span id="l67.45">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.46"></a><span id="l67.46">     calUtils.forward(controller, 1);</span>
<a href="#l67.47"></a><span id="l67.47">   }</span>
<a href="#l67.48"></a><span id="l67.48" class="difflineminus">-  </span>
<a href="#l67.49"></a><span id="l67.49" class="difflineplus">+</span>
<a href="#l67.50"></a><span id="l67.50">   // Saturday</span>
<a href="#l67.51"></a><span id="l67.51">   calUtils.forward(controller, 1);</span>
<a href="#l67.52"></a><span id="l67.52">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.53"></a><span id="l67.53" class="difflineminus">-  </span>
<a href="#l67.54"></a><span id="l67.54" class="difflineplus">+</span>
<a href="#l67.55"></a><span id="l67.55">   // check week view</span>
<a href="#l67.56"></a><span id="l67.56">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l67.57"></a><span id="l67.57" class="difflineminus">-  </span>
<a href="#l67.58"></a><span id="l67.58" class="difflineplus">+</span>
<a href="#l67.59"></a><span id="l67.59">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l67.60"></a><span id="l67.60">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l67.61"></a><span id="l67.61">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour)</span>
<a href="#l67.62"></a><span id="l67.62">       + eventPath;</span>
<a href="#l67.63"></a><span id="l67.63">     controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.64"></a><span id="l67.64">   }</span>
<a href="#l67.65"></a><span id="l67.65" class="difflineminus">-  </span>
<a href="#l67.66"></a><span id="l67.66" class="difflineplus">+</span>
<a href="#l67.67"></a><span id="l67.67">   // Saturday</span>
<a href="#l67.68"></a><span id="l67.68">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour)</span>
<a href="#l67.69"></a><span id="l67.69">     + eventPath;</span>
<a href="#l67.70"></a><span id="l67.70">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.71"></a><span id="l67.71" class="difflineminus">-  </span>
<a href="#l67.72"></a><span id="l67.72" class="difflineplus">+</span>
<a href="#l67.73"></a><span id="l67.73">   // check multiweek view</span>
<a href="#l67.74"></a><span id="l67.74">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l67.75"></a><span id="l67.75">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l67.76"></a><span id="l67.76" class="difflineminus">-  </span>
<a href="#l67.77"></a><span id="l67.77" class="difflineplus">+</span>
<a href="#l67.78"></a><span id="l67.78">   // check month view</span>
<a href="#l67.79"></a><span id="l67.79">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l67.80"></a><span id="l67.80">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l67.81"></a><span id="l67.81" class="difflineminus">-  </span>
<a href="#l67.82"></a><span id="l67.82" class="difflineplus">+</span>
<a href="#l67.83"></a><span id="l67.83">   // delete event</span>
<a href="#l67.84"></a><span id="l67.84">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour)</span>
<a href="#l67.85"></a><span id="l67.85">     + eventPath;</span>
<a href="#l67.86"></a><span id="l67.86">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.87"></a><span id="l67.87">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l67.88"></a><span id="l67.88">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l67.89"></a><span id="l67.89">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l67.90"></a><span id="l67.90">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.91"></a><span id="l67.91" class="difflineminus">-  </span>
<a href="#l67.92"></a><span id="l67.92" class="difflineplus">+</span>
<a href="#l67.93"></a><span id="l67.93">   // reset view</span>
<a href="#l67.94"></a><span id="l67.94">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l67.95"></a><span id="l67.95">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l67.96"></a><span id="l67.96">   controller.waitFor(function() {</span>
<a href="#l67.97"></a><span id="l67.97">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l67.98"></a><span id="l67.98">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l67.99"></a><span id="l67.99"> }</span>
<a href="#l67.100"></a><span id="l67.100"> </span>
<a href="#l67.101"></a><span id="l67.101"> function setRecurrence(recurrence){</span>
<a href="#l67.102"></a><span id="l67.102">   // weekly</span>
<a href="#l67.103"></a><span id="l67.103">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l67.104"></a><span id="l67.104">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l67.105"></a><span id="l67.105">   recurrence.sleep(sleep);</span>
<a href="#l67.106"></a><span id="l67.106" class="difflineminus">-  </span>
<a href="#l67.107"></a><span id="l67.107" class="difflineplus">+</span>
<a href="#l67.108"></a><span id="l67.108">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l67.109"></a><span id="l67.109">   let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l67.110"></a><span id="l67.110">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l67.111"></a><span id="l67.111">   let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l67.112"></a><span id="l67.112">   let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l67.113"></a><span id="l67.113" class="difflineminus">-  </span>
<a href="#l67.114"></a><span id="l67.114" class="difflineplus">+</span>
<a href="#l67.115"></a><span id="l67.115">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l67.116"></a><span id="l67.116">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l67.117"></a><span id="l67.117">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l67.118"></a><span id="l67.118" class="difflineminus">-  </span>
<a href="#l67.119"></a><span id="l67.119" class="difflineplus">+</span>
<a href="#l67.120"></a><span id="l67.120">   // starting from Monday so it should be checked</span>
<a href="#l67.121"></a><span id="l67.121">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l67.122"></a><span id="l67.122">   // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l67.123"></a><span id="l67.123">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l67.124"></a><span id="l67.124">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l67.125"></a><span id="l67.125">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l67.126"></a><span id="l67.126">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l67.127"></a><span id="l67.127" class="difflineminus">-  </span>
<a href="#l67.128"></a><span id="l67.128" class="difflineplus">+</span>
<a href="#l67.129"></a><span id="l67.129">   // set number of occurrences</span>
<a href="#l67.130"></a><span id="l67.130">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l67.131"></a><span id="l67.131">   let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/'</span>
<a href="#l67.132"></a><span id="l67.132">     + 'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/'</span>
<a href="#l67.133"></a><span id="l67.133">     + 'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l67.134"></a><span id="l67.134">   // replace previous number</span>
<a href="#l67.135"></a><span id="l67.135">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l67.136"></a><span id="l67.136">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l67.137"></a><span id="l67.137" class="difflineminus">-    </span>
<a href="#l67.138"></a><span id="l67.138" class="difflineplus">+</span>
<a href="#l67.139"></a><span id="l67.139">   // close dialog</span>
<a href="#l67.140"></a><span id="l67.140">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l67.141"></a><span id="l67.141">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l67.142"></a><span id="l67.142"> }</span>
<a href="#l67.143"></a><span id="l67.143"> </span>
<a href="#l67.144"></a><span id="l67.144"> function checkMultiWeekView(view){</span>
<a href="#l67.145"></a><span id="l67.145">   let week = 1;</span>
<a href="#l67.146"></a><span id="l67.146" class="difflineminus">-  </span>
<a href="#l67.147"></a><span id="l67.147" class="difflineplus">+</span>
<a href="#l67.148"></a><span id="l67.148">   // in month view event starts from 2nd row</span>
<a href="#l67.149"></a><span id="l67.149">   if(view == &quot;month&quot;) week++;</span>
<a href="#l67.150"></a><span id="l67.150"> </span>
<a href="#l67.151"></a><span id="l67.151">   // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l67.152"></a><span id="l67.152">   for(let i = 2; i &lt; 6; i++){</span>
<a href="#l67.153"></a><span id="l67.153">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined)</span>
<a href="#l67.154"></a><span id="l67.154">       + eventPath;</span>
<a href="#l67.155"></a><span id="l67.155">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.156"></a><span id="l67.156">   }</span>
<a href="#l67.157"></a><span id="l67.157" class="difflineminus">-  </span>
<a href="#l67.158"></a><span id="l67.158" class="difflineplus">+</span>
<a href="#l67.159"></a><span id="l67.159">   // Saturday</span>
<a href="#l67.160"></a><span id="l67.160">   let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined)</span>
<a href="#l67.161"></a><span id="l67.161">     + eventPath;</span>
<a href="#l67.162"></a><span id="l67.162">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l67.163"></a><span id="l67.163"> }</span>
<a href="#l67.164"></a><span id="l67.164"> </span>
<a href="#l67.165"></a><span id="l67.165"> var teardownTest = function(module) {</span>
<a href="#l67.166"></a><span id="l67.166">   calUtils.deleteCalendars(controller, calendar);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l68.4"></a><span id="l68.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l68.5"></a><span id="l68.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l68.6"></a><span id="l68.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l68.7"></a><span id="l68.7" class="difflineminus">- </span>
<a href="#l68.8"></a><span id="l68.8" class="difflineplus">+</span>
<a href="#l68.9"></a><span id="l68.9"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l68.10"></a><span id="l68.10"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l68.11"></a><span id="l68.11"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l68.12"></a><span id="l68.12"> </span>
<a href="#l68.13"></a><span id="l68.13"> var sleep = 500;</span>
<a href="#l68.14"></a><span id="l68.14"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l68.15"></a><span id="l68.15"> var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l68.16"></a><span id="l68.16"> var hour = 8;</span>
<a href="#l68.17"></a><span id="l68.17" class="difflineat">@@ -16,161 +16,161 @@ var setupModule = function(module) {</span>
<a href="#l68.18"></a><span id="l68.18">   controller = mozmill.getMail3PaneController();</span>
<a href="#l68.19"></a><span id="l68.19">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l68.20"></a><span id="l68.20"> }</span>
<a href="#l68.21"></a><span id="l68.21"> </span>
<a href="#l68.22"></a><span id="l68.22"> var testWeeklyUntilRecurrence = function () {</span>
<a href="#l68.23"></a><span id="l68.23">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l68.24"></a><span id="l68.24">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l68.25"></a><span id="l68.25">   calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l68.26"></a><span id="l68.26" class="difflineminus">-  </span>
<a href="#l68.27"></a><span id="l68.27" class="difflineplus">+</span>
<a href="#l68.28"></a><span id="l68.28">   // rotate view</span>
<a href="#l68.29"></a><span id="l68.29">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l68.30"></a><span id="l68.30">   controller.waitFor(function() {</span>
<a href="#l68.31"></a><span id="l68.31">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l68.32"></a><span id="l68.32">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l68.33"></a><span id="l68.33" class="difflineminus">-  </span>
<a href="#l68.34"></a><span id="l68.34" class="difflineplus">+</span>
<a href="#l68.35"></a><span id="l68.35">   // create weekly recurring event</span>
<a href="#l68.36"></a><span id="l68.36">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l68.37"></a><span id="l68.37">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l68.38"></a><span id="l68.38">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l68.39"></a><span id="l68.39">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l68.40"></a><span id="l68.40" class="difflineminus">-  </span>
<a href="#l68.41"></a><span id="l68.41" class="difflineplus">+</span>
<a href="#l68.42"></a><span id="l68.42">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l68.43"></a><span id="l68.43">   md.start(setRecurrence);</span>
<a href="#l68.44"></a><span id="l68.44">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l68.45"></a><span id="l68.45">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l68.46"></a><span id="l68.46" class="difflineminus">-  </span>
<a href="#l68.47"></a><span id="l68.47" class="difflineplus">+</span>
<a href="#l68.48"></a><span id="l68.48">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l68.49"></a><span id="l68.49">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l68.50"></a><span id="l68.50" class="difflineminus">-  </span>
<a href="#l68.51"></a><span id="l68.51" class="difflineplus">+</span>
<a href="#l68.52"></a><span id="l68.52">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l68.53"></a><span id="l68.53">     + eventPath;</span>
<a href="#l68.54"></a><span id="l68.54" class="difflineminus">-  </span>
<a href="#l68.55"></a><span id="l68.55" class="difflineplus">+</span>
<a href="#l68.56"></a><span id="l68.56">   // check day view</span>
<a href="#l68.57"></a><span id="l68.57">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l68.58"></a><span id="l68.58">     // Monday</span>
<a href="#l68.59"></a><span id="l68.59">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.60"></a><span id="l68.60">     calUtils.forward(controller, 2);</span>
<a href="#l68.61"></a><span id="l68.61">     // Wednesday</span>
<a href="#l68.62"></a><span id="l68.62">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.63"></a><span id="l68.63">     calUtils.forward(controller, 2);</span>
<a href="#l68.64"></a><span id="l68.64">     // Friday</span>
<a href="#l68.65"></a><span id="l68.65">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.66"></a><span id="l68.66">     calUtils.forward(controller, 3);</span>
<a href="#l68.67"></a><span id="l68.67">   }</span>
<a href="#l68.68"></a><span id="l68.68" class="difflineminus">-  </span>
<a href="#l68.69"></a><span id="l68.69" class="difflineplus">+</span>
<a href="#l68.70"></a><span id="l68.70">   // Monday, last occurrence</span>
<a href="#l68.71"></a><span id="l68.71">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.72"></a><span id="l68.72">   calUtils.forward(controller, 2);</span>
<a href="#l68.73"></a><span id="l68.73">   // Wednesday</span>
<a href="#l68.74"></a><span id="l68.74">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.75"></a><span id="l68.75">   calUtils.forward(controller, 2);</span>
<a href="#l68.76"></a><span id="l68.76" class="difflineminus">-  </span>
<a href="#l68.77"></a><span id="l68.77" class="difflineplus">+</span>
<a href="#l68.78"></a><span id="l68.78">   // check week view</span>
<a href="#l68.79"></a><span id="l68.79">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l68.80"></a><span id="l68.80">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l68.81"></a><span id="l68.81">   for(let week = 0; week &lt; 3; week++){</span>
<a href="#l68.82"></a><span id="l68.82">     // Monday</span>
<a href="#l68.83"></a><span id="l68.83">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l68.84"></a><span id="l68.84">       + eventPath;</span>
<a href="#l68.85"></a><span id="l68.85">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.86"></a><span id="l68.86">     // Wednesday</span>
<a href="#l68.87"></a><span id="l68.87">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l68.88"></a><span id="l68.88">       + eventPath;</span>
<a href="#l68.89"></a><span id="l68.89">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.90"></a><span id="l68.90">     // Friday</span>
<a href="#l68.91"></a><span id="l68.91">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour)</span>
<a href="#l68.92"></a><span id="l68.92">       + eventPath;</span>
<a href="#l68.93"></a><span id="l68.93">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.94"></a><span id="l68.94" class="difflineminus">-    </span>
<a href="#l68.95"></a><span id="l68.95" class="difflineplus">+</span>
<a href="#l68.96"></a><span id="l68.96">     calUtils.forward(controller, 1);</span>
<a href="#l68.97"></a><span id="l68.97">   }</span>
<a href="#l68.98"></a><span id="l68.98" class="difflineminus">-  </span>
<a href="#l68.99"></a><span id="l68.99" class="difflineplus">+</span>
<a href="#l68.100"></a><span id="l68.100">   // Monday, last occurrence</span>
<a href="#l68.101"></a><span id="l68.101">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l68.102"></a><span id="l68.102">     + eventPath;</span>
<a href="#l68.103"></a><span id="l68.103">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.104"></a><span id="l68.104">   // Wednesday</span>
<a href="#l68.105"></a><span id="l68.105">   box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour)</span>
<a href="#l68.106"></a><span id="l68.106">     + eventPath;</span>
<a href="#l68.107"></a><span id="l68.107">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.108"></a><span id="l68.108" class="difflineminus">-  </span>
<a href="#l68.109"></a><span id="l68.109" class="difflineplus">+</span>
<a href="#l68.110"></a><span id="l68.110">   // check multiweek view</span>
<a href="#l68.111"></a><span id="l68.111">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l68.112"></a><span id="l68.112">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l68.113"></a><span id="l68.113">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l68.114"></a><span id="l68.114" class="difflineminus">-  </span>
<a href="#l68.115"></a><span id="l68.115" class="difflineplus">+</span>
<a href="#l68.116"></a><span id="l68.116">   // check month view</span>
<a href="#l68.117"></a><span id="l68.117">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l68.118"></a><span id="l68.118">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l68.119"></a><span id="l68.119">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l68.120"></a><span id="l68.120" class="difflineminus">-  </span>
<a href="#l68.121"></a><span id="l68.121" class="difflineplus">+</span>
<a href="#l68.122"></a><span id="l68.122">   // delete event</span>
<a href="#l68.123"></a><span id="l68.123">   box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined)</span>
<a href="#l68.124"></a><span id="l68.124">     + eventPath;</span>
<a href="#l68.125"></a><span id="l68.125">   controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.126"></a><span id="l68.126">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l68.127"></a><span id="l68.127">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l68.128"></a><span id="l68.128">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l68.129"></a><span id="l68.129">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.130"></a><span id="l68.130" class="difflineminus">-  </span>
<a href="#l68.131"></a><span id="l68.131" class="difflineplus">+</span>
<a href="#l68.132"></a><span id="l68.132">   // reset view</span>
<a href="#l68.133"></a><span id="l68.133">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l68.134"></a><span id="l68.134">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l68.135"></a><span id="l68.135">   controller.waitFor(function() {</span>
<a href="#l68.136"></a><span id="l68.136">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l68.137"></a><span id="l68.137">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l68.138"></a><span id="l68.138"> }</span>
<a href="#l68.139"></a><span id="l68.139"> </span>
<a href="#l68.140"></a><span id="l68.140"> function setRecurrence(recurrence){</span>
<a href="#l68.141"></a><span id="l68.141">   // weekly</span>
<a href="#l68.142"></a><span id="l68.142">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l68.143"></a><span id="l68.143">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l68.144"></a><span id="l68.144">   recurrence.sleep(sleep);</span>
<a href="#l68.145"></a><span id="l68.145" class="difflineminus">-  </span>
<a href="#l68.146"></a><span id="l68.146" class="difflineplus">+</span>
<a href="#l68.147"></a><span id="l68.147">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l68.148"></a><span id="l68.148">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l68.149"></a><span id="l68.149">   let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l68.150"></a><span id="l68.150" class="difflineminus">-  </span>
<a href="#l68.151"></a><span id="l68.151" class="difflineplus">+</span>
<a href="#l68.152"></a><span id="l68.152">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l68.153"></a><span id="l68.153">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l68.154"></a><span id="l68.154">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l68.155"></a><span id="l68.155" class="difflineminus">-  </span>
<a href="#l68.156"></a><span id="l68.156" class="difflineplus">+</span>
<a href="#l68.157"></a><span id="l68.157">   // starting from Monday so it should be checked</span>
<a href="#l68.158"></a><span id="l68.158">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l68.159"></a><span id="l68.159">   // check Wednesday and Friday too</span>
<a href="#l68.160"></a><span id="l68.160">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l68.161"></a><span id="l68.161">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l68.162"></a><span id="l68.162" class="difflineminus">-  </span>
<a href="#l68.163"></a><span id="l68.163" class="difflineplus">+</span>
<a href="#l68.164"></a><span id="l68.164">   // set until date</span>
<a href="#l68.165"></a><span id="l68.165">   recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l68.166"></a><span id="l68.166">   let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/'</span>
<a href="#l68.167"></a><span id="l68.167">     + 'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/'</span>
<a href="#l68.168"></a><span id="l68.168">     + 'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/'</span>
<a href="#l68.169"></a><span id="l68.169">     + 'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l68.170"></a><span id="l68.170">   // delete previous date</span>
<a href="#l68.171"></a><span id="l68.171">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l68.172"></a><span id="l68.172">   recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l68.173"></a><span id="l68.173" class="difflineminus">-  </span>
<a href="#l68.174"></a><span id="l68.174" class="difflineplus">+</span>
<a href="#l68.175"></a><span id="l68.175">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l68.176"></a><span id="l68.176">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l68.177"></a><span id="l68.177" class="difflineminus">-  let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l68.178"></a><span id="l68.178" class="difflineplus">+  let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l68.179"></a><span id="l68.179">                                              endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l68.180"></a><span id="l68.180" class="difflineminus">-  </span>
<a href="#l68.181"></a><span id="l68.181" class="difflineplus">+</span>
<a href="#l68.182"></a><span id="l68.182">   recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l68.183"></a><span id="l68.183" class="difflineminus">-  </span>
<a href="#l68.184"></a><span id="l68.184" class="difflineplus">+</span>
<a href="#l68.185"></a><span id="l68.185">   // close dialog</span>
<a href="#l68.186"></a><span id="l68.186">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l68.187"></a><span id="l68.187">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l68.188"></a><span id="l68.188"> }</span>
<a href="#l68.189"></a><span id="l68.189"> </span>
<a href="#l68.190"></a><span id="l68.190"> function checkMultiWeekView(view){</span>
<a href="#l68.191"></a><span id="l68.191">   let startWeek = 1;</span>
<a href="#l68.192"></a><span id="l68.192" class="difflineminus">-  </span>
<a href="#l68.193"></a><span id="l68.193" class="difflineplus">+</span>
<a href="#l68.194"></a><span id="l68.194">   // in month view event starts from 2nd row</span>
<a href="#l68.195"></a><span id="l68.195">   if(view == &quot;month&quot;) startWeek++;</span>
<a href="#l68.196"></a><span id="l68.196"> </span>
<a href="#l68.197"></a><span id="l68.197">   for(let week = startWeek; week &lt; startWeek + 3; week++){</span>
<a href="#l68.198"></a><span id="l68.198">     // Monday</span>
<a href="#l68.199"></a><span id="l68.199">     let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined)</span>
<a href="#l68.200"></a><span id="l68.200">       + eventPath;</span>
<a href="#l68.201"></a><span id="l68.201">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.202"></a><span id="l68.202" class="difflineat">@@ -178,19 +178,19 @@ function checkMultiWeekView(view){</span>
<a href="#l68.203"></a><span id="l68.203">     box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined)</span>
<a href="#l68.204"></a><span id="l68.204">       + eventPath;</span>
<a href="#l68.205"></a><span id="l68.205">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.206"></a><span id="l68.206">     // Friday</span>
<a href="#l68.207"></a><span id="l68.207">     box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined)</span>
<a href="#l68.208"></a><span id="l68.208">       + eventPath;</span>
<a href="#l68.209"></a><span id="l68.209">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.210"></a><span id="l68.210">   }</span>
<a href="#l68.211"></a><span id="l68.211" class="difflineminus">-  </span>
<a href="#l68.212"></a><span id="l68.212" class="difflineplus">+</span>
<a href="#l68.213"></a><span id="l68.213">   // Monday, last occurrence</span>
<a href="#l68.214"></a><span id="l68.214" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2, </span>
<a href="#l68.215"></a><span id="l68.215" class="difflineplus">+  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l68.216"></a><span id="l68.216">     undefined) + eventPath;</span>
<a href="#l68.217"></a><span id="l68.217">   controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.218"></a><span id="l68.218">   // Wednesday</span>
<a href="#l68.219"></a><span id="l68.219">   box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l68.220"></a><span id="l68.220">     undefined) + eventPath;</span>
<a href="#l68.221"></a><span id="l68.221">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l68.222"></a><span id="l68.222"> }</span>
<a href="#l68.223"></a><span id="l68.223"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -16,256 +16,256 @@ var setupModule = function(module) {</span>
<a href="#l69.4"></a><span id="l69.4">   controller = mozmill.getMail3PaneController();</span>
<a href="#l69.5"></a><span id="l69.5">   calUtils.createCalendar(controller, calendar);</span>
<a href="#l69.6"></a><span id="l69.6"> }</span>
<a href="#l69.7"></a><span id="l69.7"> </span>
<a href="#l69.8"></a><span id="l69.8"> var testWeeklyWithExceptionRecurrence = function () {</span>
<a href="#l69.9"></a><span id="l69.9">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l69.10"></a><span id="l69.10">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l69.11"></a><span id="l69.11">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-  </span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+</span>
<a href="#l69.14"></a><span id="l69.14">   // rotate view</span>
<a href="#l69.15"></a><span id="l69.15">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l69.16"></a><span id="l69.16">   controller.waitFor(function() {</span>
<a href="#l69.17"></a><span id="l69.17">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l69.18"></a><span id="l69.18">     return view.orient == &quot;horizontal&quot;});</span>
<a href="#l69.19"></a><span id="l69.19" class="difflineminus">-  </span>
<a href="#l69.20"></a><span id="l69.20" class="difflineplus">+</span>
<a href="#l69.21"></a><span id="l69.21">   // create weekly recurring event</span>
<a href="#l69.22"></a><span id="l69.22">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.23"></a><span id="l69.23">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l69.24"></a><span id="l69.24">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l69.25"></a><span id="l69.25">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineminus">-  </span>
<a href="#l69.27"></a><span id="l69.27" class="difflineplus">+</span>
<a href="#l69.28"></a><span id="l69.28">   let md = new modalDialog.modalDialog(event.window);</span>
<a href="#l69.29"></a><span id="l69.29">   md.start(setRecurrence);</span>
<a href="#l69.30"></a><span id="l69.30">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l69.31"></a><span id="l69.31">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineminus">-  </span>
<a href="#l69.33"></a><span id="l69.33" class="difflineplus">+</span>
<a href="#l69.34"></a><span id="l69.34">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineminus">-  </span>
<a href="#l69.36"></a><span id="l69.36" class="difflineplus">+</span>
<a href="#l69.37"></a><span id="l69.37">   // move 5th January occurrence to 6th January</span>
<a href="#l69.38"></a><span id="l69.38">   calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l69.39"></a><span id="l69.39">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.40"></a><span id="l69.40">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l69.41"></a><span id="l69.41">       + eventPath));</span>
<a href="#l69.42"></a><span id="l69.42">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l69.43"></a><span id="l69.43">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l69.44"></a><span id="l69.44">   event.sleep(sleep);</span>
<a href="#l69.45"></a><span id="l69.45" class="difflineminus">-  </span>
<a href="#l69.46"></a><span id="l69.46" class="difflineplus">+</span>
<a href="#l69.47"></a><span id="l69.47">   let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l69.48"></a><span id="l69.48">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/'</span>
<a href="#l69.49"></a><span id="l69.49">     + 'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/'</span>
<a href="#l69.50"></a><span id="l69.50">     + 'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l69.51"></a><span id="l69.51">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l69.52"></a><span id="l69.52">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l69.53"></a><span id="l69.53">   let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/'</span>
<a href="#l69.54"></a><span id="l69.54">     + 'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/'</span>
<a href="#l69.55"></a><span id="l69.55">     + 'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/'</span>
<a href="#l69.56"></a><span id="l69.56">     + 'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l69.57"></a><span id="l69.57">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l69.58"></a><span id="l69.58">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l69.59"></a><span id="l69.59"> </span>
<a href="#l69.60"></a><span id="l69.60">   event.keypress(startDateInput, &quot;a&quot;, {ctrlKey:true});</span>
<a href="#l69.61"></a><span id="l69.61">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l69.62"></a><span id="l69.62">                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l69.63"></a><span id="l69.63" class="difflineminus">-  let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, </span>
<a href="#l69.64"></a><span id="l69.64" class="difflineplus">+  let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l69.65"></a><span id="l69.65">                                              startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l69.66"></a><span id="l69.66">   event.type(startDateInput, startDateString);</span>
<a href="#l69.67"></a><span id="l69.67">   // applies startdate change</span>
<a href="#l69.68"></a><span id="l69.68">   event.click(endDateInput);</span>
<a href="#l69.69"></a><span id="l69.69"> </span>
<a href="#l69.70"></a><span id="l69.70">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l69.71"></a><span id="l69.71">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l69.72"></a><span id="l69.72" class="difflineminus">-  </span>
<a href="#l69.73"></a><span id="l69.73" class="difflineplus">+</span>
<a href="#l69.74"></a><span id="l69.74">   // change recurrence rule</span>
<a href="#l69.75"></a><span id="l69.75">   calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l69.76"></a><span id="l69.76">   calUtils.handleParentModification(controller, false);</span>
<a href="#l69.77"></a><span id="l69.77">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.78"></a><span id="l69.78">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l69.79"></a><span id="l69.79">       + eventPath));</span>
<a href="#l69.80"></a><span id="l69.80">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l69.81"></a><span id="l69.81">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l69.82"></a><span id="l69.82" class="difflineminus">-  </span>
<a href="#l69.83"></a><span id="l69.83" class="difflineplus">+</span>
<a href="#l69.84"></a><span id="l69.84">   md = new modalDialog.modalDialog(event.window);</span>
<a href="#l69.85"></a><span id="l69.85">   md.start(changeRecurrence);</span>
<a href="#l69.86"></a><span id="l69.86">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l69.87"></a><span id="l69.87">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l69.88"></a><span id="l69.88" class="difflineminus">-  </span>
<a href="#l69.89"></a><span id="l69.89" class="difflineplus">+</span>
<a href="#l69.90"></a><span id="l69.90">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l69.91"></a><span id="l69.91">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l69.92"></a><span id="l69.92" class="difflineminus">-  </span>
<a href="#l69.93"></a><span id="l69.93" class="difflineplus">+</span>
<a href="#l69.94"></a><span id="l69.94">   // check two weeks</span>
<a href="#l69.95"></a><span id="l69.95">   // day view</span>
<a href="#l69.96"></a><span id="l69.96">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l69.97"></a><span id="l69.97">   let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l69.98"></a><span id="l69.98">     + eventPath;</span>
<a href="#l69.99"></a><span id="l69.99" class="difflineminus">-  </span>
<a href="#l69.100"></a><span id="l69.100" class="difflineplus">+</span>
<a href="#l69.101"></a><span id="l69.101">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l69.102"></a><span id="l69.102">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.103"></a><span id="l69.103" class="difflineminus">-  </span>
<a href="#l69.104"></a><span id="l69.104" class="difflineplus">+</span>
<a href="#l69.105"></a><span id="l69.105">   calUtils.forward(controller, 1);</span>
<a href="#l69.106"></a><span id="l69.106">   let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l69.107"></a><span id="l69.107">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l69.108"></a><span id="l69.108">     + 'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l69.109"></a><span id="l69.109">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l69.110"></a><span id="l69.110">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l69.111"></a><span id="l69.111">   // assert exactly two</span>
<a href="#l69.112"></a><span id="l69.112">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.113"></a><span id="l69.113">     tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l69.114"></a><span id="l69.114">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.115"></a><span id="l69.115">     tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l69.116"></a><span id="l69.116">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.117"></a><span id="l69.117">     tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l69.118"></a><span id="l69.118" class="difflineminus">-  </span>
<a href="#l69.119"></a><span id="l69.119" class="difflineplus">+</span>
<a href="#l69.120"></a><span id="l69.120">   calUtils.forward(controller, 1);</span>
<a href="#l69.121"></a><span id="l69.121">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.122"></a><span id="l69.122">   calUtils.forward(controller, 1);</span>
<a href="#l69.123"></a><span id="l69.123">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.124"></a><span id="l69.124">   calUtils.forward(controller, 1);</span>
<a href="#l69.125"></a><span id="l69.125">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.126"></a><span id="l69.126">   calUtils.forward(controller, 1);</span>
<a href="#l69.127"></a><span id="l69.127">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.128"></a><span id="l69.128">   calUtils.forward(controller, 1);</span>
<a href="#l69.129"></a><span id="l69.129">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.130"></a><span id="l69.130" class="difflineminus">-  </span>
<a href="#l69.131"></a><span id="l69.131" class="difflineplus">+</span>
<a href="#l69.132"></a><span id="l69.132">   // next week</span>
<a href="#l69.133"></a><span id="l69.133">   calUtils.forward(controller, 1);</span>
<a href="#l69.134"></a><span id="l69.134">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.135"></a><span id="l69.135">   calUtils.forward(controller, 1);</span>
<a href="#l69.136"></a><span id="l69.136">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.137"></a><span id="l69.137">   calUtils.forward(controller, 1);</span>
<a href="#l69.138"></a><span id="l69.138">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.139"></a><span id="l69.139">   calUtils.forward(controller, 1);</span>
<a href="#l69.140"></a><span id="l69.140">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.141"></a><span id="l69.141">   calUtils.forward(controller, 1);</span>
<a href="#l69.142"></a><span id="l69.142">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.143"></a><span id="l69.143">   calUtils.forward(controller, 1);</span>
<a href="#l69.144"></a><span id="l69.144">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.145"></a><span id="l69.145" class="difflineminus">-  </span>
<a href="#l69.146"></a><span id="l69.146" class="difflineplus">+</span>
<a href="#l69.147"></a><span id="l69.147">   // week view</span>
<a href="#l69.148"></a><span id="l69.148">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l69.149"></a><span id="l69.149">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l69.150"></a><span id="l69.150" class="difflineminus">-  </span>
<a href="#l69.151"></a><span id="l69.151" class="difflineplus">+</span>
<a href="#l69.152"></a><span id="l69.152">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour)</span>
<a href="#l69.153"></a><span id="l69.153">     + eventPath;</span>
<a href="#l69.154"></a><span id="l69.154">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.155"></a><span id="l69.155" class="difflineminus">-  </span>
<a href="#l69.156"></a><span id="l69.156" class="difflineplus">+</span>
<a href="#l69.157"></a><span id="l69.157">   tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l69.158"></a><span id="l69.158">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/'</span>
<a href="#l69.159"></a><span id="l69.159">     + 'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l69.160"></a><span id="l69.160">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l69.161"></a><span id="l69.161">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l69.162"></a><span id="l69.162">   // assert exactly two</span>
<a href="#l69.163"></a><span id="l69.163">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.164"></a><span id="l69.164">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l69.165"></a><span id="l69.165">   controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.166"></a><span id="l69.166">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l69.167"></a><span id="l69.167">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l69.168"></a><span id="l69.168">     tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l69.169"></a><span id="l69.169" class="difflineminus">-  </span>
<a href="#l69.170"></a><span id="l69.170" class="difflineplus">+</span>
<a href="#l69.171"></a><span id="l69.171">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l69.172"></a><span id="l69.172">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.173"></a><span id="l69.173">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l69.174"></a><span id="l69.174">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.175"></a><span id="l69.175">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l69.176"></a><span id="l69.176">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.177"></a><span id="l69.177">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l69.178"></a><span id="l69.178">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.179"></a><span id="l69.179" class="difflineminus">-  </span>
<a href="#l69.180"></a><span id="l69.180" class="difflineplus">+</span>
<a href="#l69.181"></a><span id="l69.181">   calUtils.forward(controller, 1);</span>
<a href="#l69.182"></a><span id="l69.182">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l69.183"></a><span id="l69.183">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.184"></a><span id="l69.184">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l69.185"></a><span id="l69.185">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.186"></a><span id="l69.186">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l69.187"></a><span id="l69.187">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.188"></a><span id="l69.188">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l69.189"></a><span id="l69.189">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.190"></a><span id="l69.190">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l69.191"></a><span id="l69.191">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.192"></a><span id="l69.192">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l69.193"></a><span id="l69.193">   controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.194"></a><span id="l69.194">   path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l69.195"></a><span id="l69.195">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.196"></a><span id="l69.196" class="difflineminus">-  </span>
<a href="#l69.197"></a><span id="l69.197" class="difflineplus">+</span>
<a href="#l69.198"></a><span id="l69.198">   // multiweek view</span>
<a href="#l69.199"></a><span id="l69.199">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l69.200"></a><span id="l69.200">   calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l69.201"></a><span id="l69.201">   checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l69.202"></a><span id="l69.202" class="difflineminus">-  </span>
<a href="#l69.203"></a><span id="l69.203" class="difflineplus">+</span>
<a href="#l69.204"></a><span id="l69.204">   // month view</span>
<a href="#l69.205"></a><span id="l69.205">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l69.206"></a><span id="l69.206">   checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l69.207"></a><span id="l69.207" class="difflineminus">-  </span>
<a href="#l69.208"></a><span id="l69.208" class="difflineplus">+</span>
<a href="#l69.209"></a><span id="l69.209">   // delete event</span>
<a href="#l69.210"></a><span id="l69.210">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l69.211"></a><span id="l69.211">   calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l69.212"></a><span id="l69.212">   path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l69.213"></a><span id="l69.213">     + eventPath;</span>
<a href="#l69.214"></a><span id="l69.214">   controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.215"></a><span id="l69.215">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l69.216"></a><span id="l69.216">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l69.217"></a><span id="l69.217">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l69.218"></a><span id="l69.218">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l69.219"></a><span id="l69.219" class="difflineminus">-  </span>
<a href="#l69.220"></a><span id="l69.220" class="difflineplus">+</span>
<a href="#l69.221"></a><span id="l69.221">   // reset view</span>
<a href="#l69.222"></a><span id="l69.222">   controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l69.223"></a><span id="l69.223">   controller.waitFor(function() {</span>
<a href="#l69.224"></a><span id="l69.224">     let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l69.225"></a><span id="l69.225">     return view.orient == &quot;vertical&quot;});</span>
<a href="#l69.226"></a><span id="l69.226"> }</span>
<a href="#l69.227"></a><span id="l69.227"> </span>
<a href="#l69.228"></a><span id="l69.228"> function setRecurrence(recurrence){</span>
<a href="#l69.229"></a><span id="l69.229">   // weekly</span>
<a href="#l69.230"></a><span id="l69.230">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l69.231"></a><span id="l69.231">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l69.232"></a><span id="l69.232">   recurrence.sleep(sleep);</span>
<a href="#l69.233"></a><span id="l69.233" class="difflineminus">-  </span>
<a href="#l69.234"></a><span id="l69.234" class="difflineplus">+</span>
<a href="#l69.235"></a><span id="l69.235">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l69.236"></a><span id="l69.236">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l69.237"></a><span id="l69.237">   let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l69.238"></a><span id="l69.238" class="difflineminus">-  </span>
<a href="#l69.239"></a><span id="l69.239" class="difflineplus">+</span>
<a href="#l69.240"></a><span id="l69.240">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l69.241"></a><span id="l69.241">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l69.242"></a><span id="l69.242">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l69.243"></a><span id="l69.243" class="difflineminus">-  </span>
<a href="#l69.244"></a><span id="l69.244" class="difflineplus">+</span>
<a href="#l69.245"></a><span id="l69.245">   // starting from Monday so it should be checked</span>
<a href="#l69.246"></a><span id="l69.246">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l69.247"></a><span id="l69.247">   // check Wednesday and Friday too</span>
<a href="#l69.248"></a><span id="l69.248">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l69.249"></a><span id="l69.249">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l69.250"></a><span id="l69.250" class="difflineminus">-    </span>
<a href="#l69.251"></a><span id="l69.251" class="difflineplus">+</span>
<a href="#l69.252"></a><span id="l69.252">   // close dialog</span>
<a href="#l69.253"></a><span id="l69.253">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l69.254"></a><span id="l69.254">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l69.255"></a><span id="l69.255"> }</span>
<a href="#l69.256"></a><span id="l69.256"> </span>
<a href="#l69.257"></a><span id="l69.257"> function changeRecurrence(recurrence){</span>
<a href="#l69.258"></a><span id="l69.258">   // weekly</span>
<a href="#l69.259"></a><span id="l69.259">   recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l69.260"></a><span id="l69.260">   recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l69.261"></a><span id="l69.261">   recurrence.sleep(sleep);</span>
<a href="#l69.262"></a><span id="l69.262" class="difflineminus">-  </span>
<a href="#l69.263"></a><span id="l69.263" class="difflineplus">+</span>
<a href="#l69.264"></a><span id="l69.264">   let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l69.265"></a><span id="l69.265">   let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l69.266"></a><span id="l69.266">   let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l69.267"></a><span id="l69.267">   let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l69.268"></a><span id="l69.268" class="difflineminus">-  </span>
<a href="#l69.269"></a><span id="l69.269" class="difflineplus">+</span>
<a href="#l69.270"></a><span id="l69.270">   let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/'</span>
<a href="#l69.271"></a><span id="l69.271">     + 'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/'</span>
<a href="#l69.272"></a><span id="l69.272">     + 'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l69.273"></a><span id="l69.273" class="difflineminus">-  </span>
<a href="#l69.274"></a><span id="l69.274" class="difflineplus">+</span>
<a href="#l69.275"></a><span id="l69.275">   // check old rule</span>
<a href="#l69.276"></a><span id="l69.276">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l69.277"></a><span id="l69.277">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l69.278"></a><span id="l69.278">   recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l69.279"></a><span id="l69.279" class="difflineminus">-  </span>
<a href="#l69.280"></a><span id="l69.280" class="difflineplus">+</span>
<a href="#l69.281"></a><span id="l69.281">   // check Tuesday</span>
<a href="#l69.282"></a><span id="l69.282">   recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l69.283"></a><span id="l69.283" class="difflineminus">-  </span>
<a href="#l69.284"></a><span id="l69.284" class="difflineplus">+</span>
<a href="#l69.285"></a><span id="l69.285">   // close dialog</span>
<a href="#l69.286"></a><span id="l69.286">   recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/'</span>
<a href="#l69.287"></a><span id="l69.287">     + 'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l69.288"></a><span id="l69.288"> }</span>
<a href="#l69.289"></a><span id="l69.289"> </span>
<a href="#l69.290"></a><span id="l69.290"> function checkMultiWeekView(view){</span>
<a href="#l69.291"></a><span id="l69.291">   let startWeek = view == &quot;multiweek&quot; ? 1 : 2</span>
<a href="#l69.292"></a><span id="l69.292"> </span>
<a href="#l69.293"></a><span id="l69.293" class="difflineat">@@ -281,17 +281,17 @@ function checkMultiWeekView(view){</span>
<a href="#l69.294"></a><span id="l69.294">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l69.295"></a><span id="l69.295">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.296"></a><span id="l69.296">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l69.297"></a><span id="l69.297">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.298"></a><span id="l69.298">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l69.299"></a><span id="l69.299">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.300"></a><span id="l69.300">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l69.301"></a><span id="l69.301">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.302"></a><span id="l69.302" class="difflineminus">-  </span>
<a href="#l69.303"></a><span id="l69.303" class="difflineplus">+</span>
<a href="#l69.304"></a><span id="l69.304">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l69.305"></a><span id="l69.305">   controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.306"></a><span id="l69.306">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l69.307"></a><span id="l69.307">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.308"></a><span id="l69.308">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l69.309"></a><span id="l69.309">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l69.310"></a><span id="l69.310">   path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l69.311"></a><span id="l69.311">   controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -154,59 +154,59 @@ function goToDate(controller, year, mont</span>
<a href="#l70.4"></a><span id="l70.4">   let activeYear = (new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.5"></a><span id="l70.5">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l70.6"></a><span id="l70.6">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l70.7"></a><span id="l70.7">   let activeMonth = (new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.8"></a><span id="l70.8">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l70.9"></a><span id="l70.9">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;index&quot;);</span>
<a href="#l70.10"></a><span id="l70.10">   let yearDifference = activeYear - year;</span>
<a href="#l70.11"></a><span id="l70.11">   let monthDifference = activeMonth - (month - 1);</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  </span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+</span>
<a href="#l70.14"></a><span id="l70.14">   if (yearDifference != 0) {</span>
<a href="#l70.15"></a><span id="l70.15">     let scrollArrow = yearDifference &gt; 0 ?</span>
<a href="#l70.16"></a><span id="l70.16">       (new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.17"></a><span id="l70.17">         + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l70.18"></a><span id="l70.18">         + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-up&quot;}')).getNode() :</span>
<a href="#l70.19"></a><span id="l70.19">       (new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.20"></a><span id="l70.20">         + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l70.21"></a><span id="l70.21">         + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-down&quot;}')).getNode();</span>
<a href="#l70.22"></a><span id="l70.22" class="difflineminus">-    </span>
<a href="#l70.23"></a><span id="l70.23" class="difflineplus">+</span>
<a href="#l70.24"></a><span id="l70.24">     // pick year</span>
<a href="#l70.25"></a><span id="l70.25">     controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.26"></a><span id="l70.26">       + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l70.27"></a><span id="l70.27">     controller.sleep(500);</span>
<a href="#l70.28"></a><span id="l70.28" class="difflineminus">-    </span>
<a href="#l70.29"></a><span id="l70.29" class="difflineplus">+</span>
<a href="#l70.30"></a><span id="l70.30">     for(let i = 0; i &lt; Math.abs(yearDifference); i++){</span>
<a href="#l70.31"></a><span id="l70.31">       scrollArrow.doCommand();</span>
<a href="#l70.32"></a><span id="l70.32">       controller.sleep(100);</span>
<a href="#l70.33"></a><span id="l70.33">     }</span>
<a href="#l70.34"></a><span id="l70.34" class="difflineminus">-  </span>
<a href="#l70.35"></a><span id="l70.35" class="difflineplus">+</span>
<a href="#l70.36"></a><span id="l70.36">     controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.37"></a><span id="l70.37">       + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l70.38"></a><span id="l70.38">       + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;' + year + '&quot;}'));</span>
<a href="#l70.39"></a><span id="l70.39">     controller.sleep(500);</span>
<a href="#l70.40"></a><span id="l70.40">   }</span>
<a href="#l70.41"></a><span id="l70.41" class="difflineminus">-  </span>
<a href="#l70.42"></a><span id="l70.42" class="difflineplus">+</span>
<a href="#l70.43"></a><span id="l70.43">   if (monthDifference != 0) {</span>
<a href="#l70.44"></a><span id="l70.44">     // pick month</span>
<a href="#l70.45"></a><span id="l70.45">     controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.46"></a><span id="l70.46">       + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})/[' + activeMonth</span>
<a href="#l70.47"></a><span id="l70.47">       + ']'));</span>
<a href="#l70.48"></a><span id="l70.48">     controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.49"></a><span id="l70.49">       + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l70.50"></a><span id="l70.50">       + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;' + (month - 1) + '&quot;}'));</span>
<a href="#l70.51"></a><span id="l70.51">     controller.sleep(500);</span>
<a href="#l70.52"></a><span id="l70.52">   }</span>
<a href="#l70.53"></a><span id="l70.53" class="difflineminus">-  </span>
<a href="#l70.54"></a><span id="l70.54" class="difflineplus">+</span>
<a href="#l70.55"></a><span id="l70.55">   let lastDayInFirstRow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l70.56"></a><span id="l70.56">     miniMonth + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/[6]')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l70.57"></a><span id="l70.57">   let positionOfFirst = 7 - lastDayInFirstRow;</span>
<a href="#l70.58"></a><span id="l70.58">   let dateColumn = (positionOfFirst + day - 1) % 7;</span>
<a href="#l70.59"></a><span id="l70.59">   let dateRow = Math.floor((positionOfFirst + day - 1) / 7);</span>
<a href="#l70.60"></a><span id="l70.60" class="difflineminus">-  </span>
<a href="#l70.61"></a><span id="l70.61" class="difflineplus">+</span>
<a href="#l70.62"></a><span id="l70.62">   // pick day</span>
<a href="#l70.63"></a><span id="l70.63">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l70.64"></a><span id="l70.64">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[' + (dateRow + 1) + ']/[' + dateColumn + ']'));</span>
<a href="#l70.65"></a><span id="l70.65">   controller.sleep(500);</span>
<a href="#l70.66"></a><span id="l70.66"> }</span>
<a href="#l70.67"></a><span id="l70.67"> </span>
<a href="#l70.68"></a><span id="l70.68"> /**</span>
<a href="#l70.69"></a><span id="l70.69">  *  @param controller - main window controller</span>
<a href="#l70.70"></a><span id="l70.70" class="difflineat">@@ -220,56 +220,56 @@ function goToDate(controller, year, mont</span>
<a href="#l70.71"></a><span id="l70.71"> function getEventBoxPath(controller, view, option, row, column, hour){</span>
<a href="#l70.72"></a><span id="l70.72">   let viewDeck = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l70.73"></a><span id="l70.73">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l70.74"></a><span id="l70.74">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)';</span>
<a href="#l70.75"></a><span id="l70.75">   let dayView = viewDeck + '/id(&quot;day-view&quot;)';</span>
<a href="#l70.76"></a><span id="l70.76">   let weekView = viewDeck + '/id(&quot;week-view&quot;)';</span>
<a href="#l70.77"></a><span id="l70.77">   let multiweekView = viewDeck + '/id(&quot;multiweek-view&quot;)';</span>
<a href="#l70.78"></a><span id="l70.78">   let monthView = viewDeck + '/id(&quot;month-view&quot;)';</span>
<a href="#l70.79"></a><span id="l70.79" class="difflineminus">-  </span>
<a href="#l70.80"></a><span id="l70.80" class="difflineplus">+</span>
<a href="#l70.81"></a><span id="l70.81">   let path = '';</span>
<a href="#l70.82"></a><span id="l70.82">   switch(view){</span>
<a href="#l70.83"></a><span id="l70.83">     case &quot;week&quot;:</span>
<a href="#l70.84"></a><span id="l70.84">       path += weekView;</span>
<a href="#l70.85"></a><span id="l70.85">       break;</span>
<a href="#l70.86"></a><span id="l70.86">     case &quot;multiweek&quot;:</span>
<a href="#l70.87"></a><span id="l70.87">       path += multiweekView;</span>
<a href="#l70.88"></a><span id="l70.88">       break;</span>
<a href="#l70.89"></a><span id="l70.89">     case &quot;month&quot;:</span>
<a href="#l70.90"></a><span id="l70.90">       path += monthView;</span>
<a href="#l70.91"></a><span id="l70.91">       break;</span>
<a href="#l70.92"></a><span id="l70.92">     default: path += dayView;</span>
<a href="#l70.93"></a><span id="l70.93">   }</span>
<a href="#l70.94"></a><span id="l70.94" class="difflineminus">-  </span>
<a href="#l70.95"></a><span id="l70.95" class="difflineplus">+</span>
<a href="#l70.96"></a><span id="l70.96">   if((view == &quot;day&quot; || view == &quot;week&quot;) &amp;&amp; option == ALLDAY){</span>
<a href="#l70.97"></a><span id="l70.97">     path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})';</span>
<a href="#l70.98"></a><span id="l70.98">     path += '/[' + (column - 1) + ']';</span>
<a href="#l70.99"></a><span id="l70.99" class="difflineminus">-    </span>
<a href="#l70.100"></a><span id="l70.100" class="difflineplus">+</span>
<a href="#l70.101"></a><span id="l70.101">     return path;</span>
<a href="#l70.102"></a><span id="l70.102">   }</span>
<a href="#l70.103"></a><span id="l70.103">   else if(view == &quot;day&quot; || view == &quot;week&quot;){</span>
<a href="#l70.104"></a><span id="l70.104">     path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})';</span>
<a href="#l70.105"></a><span id="l70.105">     path += '/[' + (column - 1) + ']';</span>
<a href="#l70.106"></a><span id="l70.106">     path += '/anon({&quot;anonid&quot;:&quot;boxstack&quot;})';</span>
<a href="#l70.107"></a><span id="l70.107" class="difflineminus">-    </span>
<a href="#l70.108"></a><span id="l70.108" class="difflineplus">+</span>
<a href="#l70.109"></a><span id="l70.109">     if(option == CANVAS_BOX)</span>
<a href="#l70.110"></a><span id="l70.110">       path += '/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + hour + ']';</span>
<a href="#l70.111"></a><span id="l70.111">     else</span>
<a href="#l70.112"></a><span id="l70.112">       path += '/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l70.113"></a><span id="l70.113" class="difflineminus">-    </span>
<a href="#l70.114"></a><span id="l70.114" class="difflineplus">+</span>
<a href="#l70.115"></a><span id="l70.115">     return path;</span>
<a href="#l70.116"></a><span id="l70.116">   }</span>
<a href="#l70.117"></a><span id="l70.117">   else{</span>
<a href="#l70.118"></a><span id="l70.118">     path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/'</span>
<a href="#l70.119"></a><span id="l70.119">       + 'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[' + (row - 1) + ']/[' + (column - 1) + ']';</span>
<a href="#l70.120"></a><span id="l70.120" class="difflineminus">-  </span>
<a href="#l70.121"></a><span id="l70.121" class="difflineplus">+</span>
<a href="#l70.122"></a><span id="l70.122">     if(option == CANVAS_BOX)</span>
<a href="#l70.123"></a><span id="l70.123">       path += '/anon({&quot;anonid&quot;:&quot;day-items&quot;})';</span>
<a href="#l70.124"></a><span id="l70.124" class="difflineminus">-    </span>
<a href="#l70.125"></a><span id="l70.125" class="difflineplus">+</span>
<a href="#l70.126"></a><span id="l70.126">     return path;</span>
<a href="#l70.127"></a><span id="l70.127">   }</span>
<a href="#l70.128"></a><span id="l70.128"> }</span>
<a href="#l70.129"></a><span id="l70.129"> </span>
<a href="#l70.130"></a><span id="l70.130"> /**</span>
<a href="#l70.131"></a><span id="l70.131">  * @param controller - Mozmill window controller</span>
<a href="#l70.132"></a><span id="l70.132">  * @param n - how many times next button in view is clicked</span>
<a href="#l70.133"></a><span id="l70.133">  */</span>
<a href="#l70.134"></a><span id="l70.134" class="difflineat">@@ -317,17 +317,17 @@ function createCalendar(controller, name</span>
<a href="#l70.135"></a><span id="l70.135">   let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l70.136"></a><span id="l70.136">                     .getNode().ownerDocument.defaultView;</span>
<a href="#l70.137"></a><span id="l70.137">   let manager = defaultView.getCalendarManager();</span>
<a href="#l70.138"></a><span id="l70.138"> </span>
<a href="#l70.139"></a><span id="l70.139">   let url = defaultView.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l70.140"></a><span id="l70.140">   let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l70.141"></a><span id="l70.141">   calendar.name = name;</span>
<a href="#l70.142"></a><span id="l70.142">   manager.registerCalendar(calendar);</span>
<a href="#l70.143"></a><span id="l70.143" class="difflineminus">-  </span>
<a href="#l70.144"></a><span id="l70.144" class="difflineplus">+</span>
<a href="#l70.145"></a><span id="l70.145">   let id = calendar.id;</span>
<a href="#l70.146"></a><span id="l70.146">   let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l70.147"></a><span id="l70.147">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l70.148"></a><span id="l70.148">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/'</span>
<a href="#l70.149"></a><span id="l70.149">     + 'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l70.150"></a><span id="l70.150">     .getNode();</span>
<a href="#l70.151"></a><span id="l70.151">   for(i = 0; i &lt; calendarTree.mCalendarList.length; i++)</span>
<a href="#l70.152"></a><span id="l70.152">     if(calendarTree.mCalendarList[i].id == id)</span>
<a href="#l70.153"></a><span id="l70.153" class="difflineat">@@ -378,17 +378,17 @@ function findEventsInNode(node, eventNod</span>
<a href="#l70.154"></a><span id="l70.154">  *                  attachment.add - url to add</span>
<a href="#l70.155"></a><span id="l70.155">  *                  attachment.remove - label of url to remove (without http://)</span>
<a href="#l70.156"></a><span id="l70.156">  */</span>
<a href="#l70.157"></a><span id="l70.157"> function setData(controller, data) {</span>
<a href="#l70.158"></a><span id="l70.158">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l70.159"></a><span id="l70.159">   let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l70.160"></a><span id="l70.160">   let dialog;</span>
<a href="#l70.161"></a><span id="l70.161">   let isEvent = true;</span>
<a href="#l70.162"></a><span id="l70.162" class="difflineminus">-  </span>
<a href="#l70.163"></a><span id="l70.163" class="difflineplus">+</span>
<a href="#l70.164"></a><span id="l70.164">   // see if it's an event dialog</span>
<a href="#l70.165"></a><span id="l70.165">   try {</span>
<a href="#l70.166"></a><span id="l70.166">     (new elementslib.Lookup(controller.window.document, eventDialog)).getNode();</span>
<a href="#l70.167"></a><span id="l70.167">     dialog = eventDialog;</span>
<a href="#l70.168"></a><span id="l70.168">   } catch (error) {</span>
<a href="#l70.169"></a><span id="l70.169">     dialog = taskDialog;</span>
<a href="#l70.170"></a><span id="l70.170">     isEvent = false;</span>
<a href="#l70.171"></a><span id="l70.171">   }</span>
<a href="#l70.172"></a><span id="l70.172" class="difflineat">@@ -421,135 +421,135 @@ function setData(controller, data) {</span>
<a href="#l70.173"></a><span id="l70.173">     + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/'</span>
<a href="#l70.174"></a><span id="l70.174">     + 'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/'</span>
<a href="#l70.175"></a><span id="l70.175">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l70.176"></a><span id="l70.176">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l70.177"></a><span id="l70.177">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l70.178"></a><span id="l70.178">   let mac = utils.appInfo.os.toLowerCase().includes(&quot;darwin&quot;);</span>
<a href="#l70.179"></a><span id="l70.179">   // wait for input elements' values to be populated</span>
<a href="#l70.180"></a><span id="l70.180">   controller.sleep(sleep);</span>
<a href="#l70.181"></a><span id="l70.181" class="difflineminus">-  </span>
<a href="#l70.182"></a><span id="l70.182" class="difflineplus">+</span>
<a href="#l70.183"></a><span id="l70.183">   // title</span>
<a href="#l70.184"></a><span id="l70.184">   if (data.title != undefined) {</span>
<a href="#l70.185"></a><span id="l70.185">     if (!mac) {</span>
<a href="#l70.186"></a><span id="l70.186">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.187"></a><span id="l70.187">         + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l70.188"></a><span id="l70.188">         + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l70.189"></a><span id="l70.189">         'a', {ctrlKey: true});</span>
<a href="#l70.190"></a><span id="l70.190">       controller.type(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.191"></a><span id="l70.191">         + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l70.192"></a><span id="l70.192">         + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l70.193"></a><span id="l70.193">         data.title);</span>
<a href="#l70.194"></a><span id="l70.194">     } else {</span>
<a href="#l70.195"></a><span id="l70.195">       let titleField = new elementslib.ID(controller.window.document, &quot;item-title&quot;);</span>
<a href="#l70.196"></a><span id="l70.196">       titleField.getNode().value = data.title;</span>
<a href="#l70.197"></a><span id="l70.197">     }</span>
<a href="#l70.198"></a><span id="l70.198">   }</span>
<a href="#l70.199"></a><span id="l70.199" class="difflineminus">-  </span>
<a href="#l70.200"></a><span id="l70.200" class="difflineplus">+</span>
<a href="#l70.201"></a><span id="l70.201">   // location</span>
<a href="#l70.202"></a><span id="l70.202">   if (data.location != undefined) {</span>
<a href="#l70.203"></a><span id="l70.203">     if (!mac) {</span>
<a href="#l70.204"></a><span id="l70.204">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.205"></a><span id="l70.205">         + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l70.206"></a><span id="l70.206">         + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l70.207"></a><span id="l70.207">         'a', {ctrlKey: true});</span>
<a href="#l70.208"></a><span id="l70.208">       controller.type(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.209"></a><span id="l70.209">         + 'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l70.210"></a><span id="l70.210">         + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l70.211"></a><span id="l70.211">         data.location);</span>
<a href="#l70.212"></a><span id="l70.212">     } else {</span>
<a href="#l70.213"></a><span id="l70.213">       let locationField = new elementslib.ID(controller.window.document, &quot;item-location&quot;);</span>
<a href="#l70.214"></a><span id="l70.214">       locationField.getNode().value = data.location;</span>
<a href="#l70.215"></a><span id="l70.215">     }</span>
<a href="#l70.216"></a><span id="l70.216">   }</span>
<a href="#l70.217"></a><span id="l70.217" class="difflineminus">-  </span>
<a href="#l70.218"></a><span id="l70.218" class="difflineplus">+</span>
<a href="#l70.219"></a><span id="l70.219">   // category</span>
<a href="#l70.220"></a><span id="l70.220">   if (data.category != undefined) {</span>
<a href="#l70.221"></a><span id="l70.221">     controller.select(new elementslib.ID(controller.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l70.222"></a><span id="l70.222">       data.category);</span>
<a href="#l70.223"></a><span id="l70.223">     controller.sleep(sleep);</span>
<a href="#l70.224"></a><span id="l70.224">   }</span>
<a href="#l70.225"></a><span id="l70.225" class="difflineminus">-  </span>
<a href="#l70.226"></a><span id="l70.226" class="difflineplus">+</span>
<a href="#l70.227"></a><span id="l70.227">   // all-day</span>
<a href="#l70.228"></a><span id="l70.228">   if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l70.229"></a><span id="l70.229">     controller.check(new elementslib.ID(controller.window.document, &quot;event-all-day&quot;), data.allday);</span>
<a href="#l70.230"></a><span id="l70.230">   }</span>
<a href="#l70.231"></a><span id="l70.231" class="difflineminus">-  </span>
<a href="#l70.232"></a><span id="l70.232" class="difflineplus">+</span>
<a href="#l70.233"></a><span id="l70.233">   // timezone</span>
<a href="#l70.234"></a><span id="l70.234">   if (data.timezone != undefined) {</span>
<a href="#l70.235"></a><span id="l70.235">     let menuitem = new elementslib.ID(controller.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l70.236"></a><span id="l70.236">     menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l70.237"></a><span id="l70.237">     controller.click(menuitem);</span>
<a href="#l70.238"></a><span id="l70.238">   }</span>
<a href="#l70.239"></a><span id="l70.239" class="difflineminus">-  </span>
<a href="#l70.240"></a><span id="l70.240" class="difflineplus">+</span>
<a href="#l70.241"></a><span id="l70.241">   // startdate</span>
<a href="#l70.242"></a><span id="l70.242">   if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == 'Date') {</span>
<a href="#l70.243"></a><span id="l70.243">     let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l70.244"></a><span id="l70.244">       data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l70.245"></a><span id="l70.245">     if(!isEvent)</span>
<a href="#l70.246"></a><span id="l70.246">       controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-entrydate&quot;), true);</span>
<a href="#l70.247"></a><span id="l70.247">     if (!mac) {</span>
<a href="#l70.248"></a><span id="l70.248">       controller.keypress(startDateInput, 'a', {ctrlKey: true});</span>
<a href="#l70.249"></a><span id="l70.249">       controller.type(startDateInput, startdate);</span>
<a href="#l70.250"></a><span id="l70.250">     } else {</span>
<a href="#l70.251"></a><span id="l70.251">       startDateInput.getNode().value = startdate;</span>
<a href="#l70.252"></a><span id="l70.252">     }</span>
<a href="#l70.253"></a><span id="l70.253">   }</span>
<a href="#l70.254"></a><span id="l70.254" class="difflineminus">-  </span>
<a href="#l70.255"></a><span id="l70.255" class="difflineplus">+</span>
<a href="#l70.256"></a><span id="l70.256">   // starttime</span>
<a href="#l70.257"></a><span id="l70.257">   if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == 'Date') {</span>
<a href="#l70.258"></a><span id="l70.258">     let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l70.259"></a><span id="l70.259">       data.starttime.getHours(), data.starttime.getMinutes(), 0);</span>
<a href="#l70.260"></a><span id="l70.260">     if (!mac) {</span>
<a href="#l70.261"></a><span id="l70.261">       controller.keypress(startTimeInput, 'a', {ctrlKey: true});</span>
<a href="#l70.262"></a><span id="l70.262">       controller.type(startTimeInput, starttime);</span>
<a href="#l70.263"></a><span id="l70.263">     } else {</span>
<a href="#l70.264"></a><span id="l70.264">       startTimeInput.getNode().value = starttime;</span>
<a href="#l70.265"></a><span id="l70.265">       controller.sleep(sleep);</span>
<a href="#l70.266"></a><span id="l70.266">     }</span>
<a href="#l70.267"></a><span id="l70.267">   }</span>
<a href="#l70.268"></a><span id="l70.268" class="difflineminus">-  </span>
<a href="#l70.269"></a><span id="l70.269" class="difflineplus">+</span>
<a href="#l70.270"></a><span id="l70.270">   // enddate</span>
<a href="#l70.271"></a><span id="l70.271">   if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == 'Date') {</span>
<a href="#l70.272"></a><span id="l70.272">     let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l70.273"></a><span id="l70.273">       data.enddate.getFullYear(), data.enddate.getMonth() + 1, data.enddate.getDate());</span>
<a href="#l70.274"></a><span id="l70.274">     if(!isEvent)</span>
<a href="#l70.275"></a><span id="l70.275">       controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-duedate&quot;), true);</span>
<a href="#l70.276"></a><span id="l70.276">     if (!mac) {</span>
<a href="#l70.277"></a><span id="l70.277">       controller.keypress(endDateInput, 'a', {ctrlKey: true});</span>
<a href="#l70.278"></a><span id="l70.278">       controller.type(endDateInput, enddate);</span>
<a href="#l70.279"></a><span id="l70.279">     } else {</span>
<a href="#l70.280"></a><span id="l70.280">       endDateInput.getNode().value = enddate;</span>
<a href="#l70.281"></a><span id="l70.281">     }</span>
<a href="#l70.282"></a><span id="l70.282">   }</span>
<a href="#l70.283"></a><span id="l70.283" class="difflineminus">-  </span>
<a href="#l70.284"></a><span id="l70.284" class="difflineplus">+</span>
<a href="#l70.285"></a><span id="l70.285">   // endttime</span>
<a href="#l70.286"></a><span id="l70.286">   if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == 'Date') {</span>
<a href="#l70.287"></a><span id="l70.287">     let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l70.288"></a><span id="l70.288">       data.endtime.getHours(), data.endtime.getMinutes(), 0);</span>
<a href="#l70.289"></a><span id="l70.289">     if (!mac) {</span>
<a href="#l70.290"></a><span id="l70.290">       controller.keypress(endTimeInput, 'a', {ctrlKey:true});</span>
<a href="#l70.291"></a><span id="l70.291">       controller.type(endTimeInput, endtime);</span>
<a href="#l70.292"></a><span id="l70.292">     } else {</span>
<a href="#l70.293"></a><span id="l70.293">       endTimeInput.getNode().value = endtime;</span>
<a href="#l70.294"></a><span id="l70.294">       controller.sleep(sleep);</span>
<a href="#l70.295"></a><span id="l70.295">     }</span>
<a href="#l70.296"></a><span id="l70.296">   }</span>
<a href="#l70.297"></a><span id="l70.297" class="difflineminus">-  </span>
<a href="#l70.298"></a><span id="l70.298" class="difflineplus">+</span>
<a href="#l70.299"></a><span id="l70.299">   // recurrence</span>
<a href="#l70.300"></a><span id="l70.300">   if (data.repeat != undefined) {</span>
<a href="#l70.301"></a><span id="l70.301">     controller.select(new elementslib.ID(controller.window.document, &quot;item-repeat&quot;), undefined,</span>
<a href="#l70.302"></a><span id="l70.302">       undefined, data.repeat);</span>
<a href="#l70.303"></a><span id="l70.303">   }</span>
<a href="#l70.304"></a><span id="l70.304" class="difflineminus">-  </span>
<a href="#l70.305"></a><span id="l70.305" class="difflineplus">+</span>
<a href="#l70.306"></a><span id="l70.306">   // reminder</span>
<a href="#l70.307"></a><span id="l70.307">   if (data.reminder != undefined) {</span>
<a href="#l70.308"></a><span id="l70.308">     controller.select(new elementslib.ID(controller.window.document, &quot;item-alarm&quot;), data.reminder);</span>
<a href="#l70.309"></a><span id="l70.309">   }</span>
<a href="#l70.310"></a><span id="l70.310" class="difflineminus">-  </span>
<a href="#l70.311"></a><span id="l70.311" class="difflineplus">+</span>
<a href="#l70.312"></a><span id="l70.312">   // description</span>
<a href="#l70.313"></a><span id="l70.313">   if (data.description != undefined) {</span>
<a href="#l70.314"></a><span id="l70.314">     if (!mac) {</span>
<a href="#l70.315"></a><span id="l70.315">       controller.keypress(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.316"></a><span id="l70.316">         + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l70.317"></a><span id="l70.317">         + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l70.318"></a><span id="l70.318">         'a', {ctrlKey: true});</span>
<a href="#l70.319"></a><span id="l70.319">       controller.type(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.320"></a><span id="l70.320" class="difflineat">@@ -558,83 +558,83 @@ function setData(controller, data) {</span>
<a href="#l70.321"></a><span id="l70.321">         data.description);</span>
<a href="#l70.322"></a><span id="l70.322">     } else {</span>
<a href="#l70.323"></a><span id="l70.323">       let descField = new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.324"></a><span id="l70.324">         + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l70.325"></a><span id="l70.325">         + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l70.326"></a><span id="l70.326">       descField.getNode().value = data.description;</span>
<a href="#l70.327"></a><span id="l70.327">     }</span>
<a href="#l70.328"></a><span id="l70.328">   }</span>
<a href="#l70.329"></a><span id="l70.329" class="difflineminus">-  </span>
<a href="#l70.330"></a><span id="l70.330" class="difflineplus">+</span>
<a href="#l70.331"></a><span id="l70.331">   // priority</span>
<a href="#l70.332"></a><span id="l70.332">   if (data.priority != undefined) {</span>
<a href="#l70.333"></a><span id="l70.333">     controller.mainMenu.click(&quot;#options-priority-&quot; + data.priority + &quot;-label&quot;);</span>
<a href="#l70.334"></a><span id="l70.334">   }</span>
<a href="#l70.335"></a><span id="l70.335" class="difflineminus">-  </span>
<a href="#l70.336"></a><span id="l70.336" class="difflineplus">+</span>
<a href="#l70.337"></a><span id="l70.337">   // privacy</span>
<a href="#l70.338"></a><span id="l70.338">   if (data.privacy != undefined) {</span>
<a href="#l70.339"></a><span id="l70.339">     controller.mainMenu.click(&quot;#options-privacy-&quot; + data.privacy + &quot;-menuitem&quot;);</span>
<a href="#l70.340"></a><span id="l70.340">   }</span>
<a href="#l70.341"></a><span id="l70.341" class="difflineminus">-  </span>
<a href="#l70.342"></a><span id="l70.342" class="difflineplus">+</span>
<a href="#l70.343"></a><span id="l70.343">   // status</span>
<a href="#l70.344"></a><span id="l70.344">   if (data.status != undefined) {</span>
<a href="#l70.345"></a><span id="l70.345">     if (isEvent) {</span>
<a href="#l70.346"></a><span id="l70.346">       controller.mainMenu.click(&quot;#options-status-&quot; + data.status + &quot;-menuitem&quot;);</span>
<a href="#l70.347"></a><span id="l70.347">     } else {</span>
<a href="#l70.348"></a><span id="l70.348">       controller.select(new elementslib.ID(controller.window.document, &quot;todo-status&quot;), undefined,</span>
<a href="#l70.349"></a><span id="l70.349">         undefined, data.status.toUpperCase());</span>
<a href="#l70.350"></a><span id="l70.350">       controller.sleep(sleep);</span>
<a href="#l70.351"></a><span id="l70.351">     }</span>
<a href="#l70.352"></a><span id="l70.352">   }</span>
<a href="#l70.353"></a><span id="l70.353" class="difflineminus">-  </span>
<a href="#l70.354"></a><span id="l70.354" class="difflineplus">+</span>
<a href="#l70.355"></a><span id="l70.355">   let currentStatus = (new elementslib.ID(controller.window.document, &quot;todo-status&quot;)).getNode().value;</span>
<a href="#l70.356"></a><span id="l70.356" class="difflineminus">-  </span>
<a href="#l70.357"></a><span id="l70.357" class="difflineplus">+</span>
<a href="#l70.358"></a><span id="l70.358">   // completed on</span>
<a href="#l70.359"></a><span id="l70.359">   if (data.completed != undefined &amp;&amp; data.completed.constructor.name == 'Date' &amp;&amp; !isEvent) {</span>
<a href="#l70.360"></a><span id="l70.360">     let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l70.361"></a><span id="l70.361">       data.completed.getFullYear(), data.completed.getMonth() + 1,</span>
<a href="#l70.362"></a><span id="l70.362">       data.completed.getDate());</span>
<a href="#l70.363"></a><span id="l70.363" class="difflineminus">-    </span>
<a href="#l70.364"></a><span id="l70.364" class="difflineplus">+</span>
<a href="#l70.365"></a><span id="l70.365">     if ( currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l70.366"></a><span id="l70.366">       if (!mac) {</span>
<a href="#l70.367"></a><span id="l70.367">         controller.keypress(completedDateInput, 'a', {ctrlKey: true});</span>
<a href="#l70.368"></a><span id="l70.368">         controller.type(completedDateInput, completeddate);</span>
<a href="#l70.369"></a><span id="l70.369">       } else {</span>
<a href="#l70.370"></a><span id="l70.370">         completedDateInput.getNode().value = completeddate;</span>
<a href="#l70.371"></a><span id="l70.371">       }</span>
<a href="#l70.372"></a><span id="l70.372">     }</span>
<a href="#l70.373"></a><span id="l70.373">   }</span>
<a href="#l70.374"></a><span id="l70.374" class="difflineminus">-  </span>
<a href="#l70.375"></a><span id="l70.375" class="difflineplus">+</span>
<a href="#l70.376"></a><span id="l70.376">   // percent complete</span>
<a href="#l70.377"></a><span id="l70.377" class="difflineminus">-  if (data.percent != undefined &amp;&amp; </span>
<a href="#l70.378"></a><span id="l70.378" class="difflineplus">+  if (data.percent != undefined &amp;&amp;</span>
<a href="#l70.379"></a><span id="l70.379">        (currentStatus == &quot;NEEDS-ACTION&quot; || currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l70.380"></a><span id="l70.380">         currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l70.381"></a><span id="l70.381">     percentCompleteInput.getNode().value = data.percent;</span>
<a href="#l70.382"></a><span id="l70.382">   }</span>
<a href="#l70.383"></a><span id="l70.383" class="difflineminus">-  </span>
<a href="#l70.384"></a><span id="l70.384" class="difflineplus">+</span>
<a href="#l70.385"></a><span id="l70.385">   // free/busy</span>
<a href="#l70.386"></a><span id="l70.386">   if (data.freebusy != undefined) {</span>
<a href="#l70.387"></a><span id="l70.387">     controller.mainMenu.click(&quot;#options-freebusy-&quot; + data.freebusy + &quot;-menuitem&quot;);</span>
<a href="#l70.388"></a><span id="l70.388">   }</span>
<a href="#l70.389"></a><span id="l70.389" class="difflineminus">-  </span>
<a href="#l70.390"></a><span id="l70.390" class="difflineplus">+</span>
<a href="#l70.391"></a><span id="l70.391">   // attachment</span>
<a href="#l70.392"></a><span id="l70.392">   if (data.attachment != undefined) {</span>
<a href="#l70.393"></a><span id="l70.393">     if (data.attachment.add != undefined) {</span>
<a href="#l70.394"></a><span id="l70.394">       handleAddingAttachment(controller, data.attachment.add);</span>
<a href="#l70.395"></a><span id="l70.395">       controller.click(new elementslib.ID(controller.window.document, &quot;button-url&quot;));</span>
<a href="#l70.396"></a><span id="l70.396">     }</span>
<a href="#l70.397"></a><span id="l70.397">     if (data.attachment.delete != undefined) {</span>
<a href="#l70.398"></a><span id="l70.398">       controller.click(new elementslib.Lookup(controller.window.document, dialog</span>
<a href="#l70.399"></a><span id="l70.399">         + 'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;' +</span>
<a href="#l70.400"></a><span id="l70.400">         data.attachment.delete + '&quot;}'));</span>
<a href="#l70.401"></a><span id="l70.401">       controller.keypress(new elementslib.ID(controller.window.document, &quot;attachment-link&quot;),</span>
<a href="#l70.402"></a><span id="l70.402">         &quot;VK_DELETE&quot;, {});</span>
<a href="#l70.403"></a><span id="l70.403">     }</span>
<a href="#l70.404"></a><span id="l70.404">   }</span>
<a href="#l70.405"></a><span id="l70.405" class="difflineminus">-  </span>
<a href="#l70.406"></a><span id="l70.406" class="difflineplus">+</span>
<a href="#l70.407"></a><span id="l70.407">   controller.sleep(sleep);</span>
<a href="#l70.408"></a><span id="l70.408"> }</span>
<a href="#l70.409"></a><span id="l70.409"> </span>
<a href="#l70.410"></a><span id="l70.410"> function open_lightning_prefs(aCallback, aParentController, collector, windowTimeout) {</span>
<a href="#l70.411"></a><span id="l70.411">   function paneLoadedChecker() {</span>
<a href="#l70.412"></a><span id="l70.412">     let pane = prefsController.window.document.getElementById(&quot;paneLightning&quot;);</span>
<a href="#l70.413"></a><span id="l70.413">     return pane.loaded;</span>
<a href="#l70.414"></a><span id="l70.414">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l71.4"></a><span id="l71.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l71.5"></a><span id="l71.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l71.6"></a><span id="l71.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l71.7"></a><span id="l71.7" class="difflineminus">- </span>
<a href="#l71.8"></a><span id="l71.8" class="difflineplus">+</span>
<a href="#l71.9"></a><span id="l71.9"> var calUtils = require(&quot;calendar-utils&quot;);</span>
<a href="#l71.10"></a><span id="l71.10"> var prefs = require(&quot;prefs&quot;);</span>
<a href="#l71.11"></a><span id="l71.11"> </span>
<a href="#l71.12"></a><span id="l71.12"> var sleep = 500;</span>
<a href="#l71.13"></a><span id="l71.13"> </span>
<a href="#l71.14"></a><span id="l71.14"> function switchAppTimezone(timezone) {</span>
<a href="#l71.15"></a><span id="l71.15">   // change directly as Mac has different Lookup &amp; XPath than Windows &amp; Linux, bug 536605</span>
<a href="#l71.16"></a><span id="l71.16">   prefs.preferences.setPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineat">@@ -17,73 +17,73 @@ function verify(controller, dates, timez</span>
<a href="#l71.18"></a><span id="l71.18">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l71.19"></a><span id="l71.19">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)';</span>
<a href="#l71.20"></a><span id="l71.20">   let dayStack = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l71.21"></a><span id="l71.21">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l71.22"></a><span id="l71.22">     + '{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l71.23"></a><span id="l71.23">   let timeLine = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/'</span>
<a href="#l71.24"></a><span id="l71.24">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/';</span>
<a href="#l71.25"></a><span id="l71.25">   let allowedDifference = 3;</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineminus">-  </span>
<a href="#l71.27"></a><span id="l71.27" class="difflineplus">+</span>
<a href="#l71.28"></a><span id="l71.28">   /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l71.29"></a><span id="l71.29">      xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l71.30"></a><span id="l71.30">      a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l71.31"></a><span id="l71.31">      But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l71.32"></a><span id="l71.32">      on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l71.33"></a><span id="l71.33">   */</span>
<a href="#l71.34"></a><span id="l71.34">   for (let date = 0; date &lt; dates.length; date++) {</span>
<a href="#l71.35"></a><span id="l71.35">     calUtils.goToDate(controller, dates[date][0], dates[date][1], dates[date][2]);</span>
<a href="#l71.36"></a><span id="l71.36" class="difflineminus">-    </span>
<a href="#l71.37"></a><span id="l71.37" class="difflineplus">+</span>
<a href="#l71.38"></a><span id="l71.38">     // find event with timezone tz</span>
<a href="#l71.39"></a><span id="l71.39">     for (let tz = 0; tz &lt; timezones.length; tz++) {</span>
<a href="#l71.40"></a><span id="l71.40">       let found = false;</span>
<a href="#l71.41"></a><span id="l71.41" class="difflineminus">-      </span>
<a href="#l71.42"></a><span id="l71.42" class="difflineplus">+</span>
<a href="#l71.43"></a><span id="l71.43">       let correctHour = times[date][tz][0];</span>
<a href="#l71.44"></a><span id="l71.44">       let minutes = times[date][tz][1];</span>
<a href="#l71.45"></a><span id="l71.45">       let day = times[date][tz][2];</span>
<a href="#l71.46"></a><span id="l71.46" class="difflineminus">-      </span>
<a href="#l71.47"></a><span id="l71.47" class="difflineminus">-      let timeNode = (new elementslib.Lookup(controller.window.document, </span>
<a href="#l71.48"></a><span id="l71.48" class="difflineplus">+</span>
<a href="#l71.49"></a><span id="l71.49" class="difflineplus">+      let timeNode = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l71.50"></a><span id="l71.50">                                              timeLine + '[' + correctHour + ']')).getNode();</span>
<a href="#l71.51"></a><span id="l71.51">       let timeY = timeNode.boxObject.y;</span>
<a href="#l71.52"></a><span id="l71.52">       timeY += timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l71.53"></a><span id="l71.53" class="difflineminus">-      </span>
<a href="#l71.54"></a><span id="l71.54" class="difflineplus">+</span>
<a href="#l71.55"></a><span id="l71.55">       let stackNode;</span>
<a href="#l71.56"></a><span id="l71.56">       let eventNodes = new Array();</span>
<a href="#l71.57"></a><span id="l71.57" class="difflineminus">-      </span>
<a href="#l71.58"></a><span id="l71.58" class="difflineplus">+</span>
<a href="#l71.59"></a><span id="l71.59">       // same day</span>
<a href="#l71.60"></a><span id="l71.60">       if(day == undefined) {</span>
<a href="#l71.61"></a><span id="l71.61">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l71.62"></a><span id="l71.62">       }</span>
<a href="#l71.63"></a><span id="l71.63" class="difflineminus">-      </span>
<a href="#l71.64"></a><span id="l71.64" class="difflineplus">+</span>
<a href="#l71.65"></a><span id="l71.65">       // following day</span>
<a href="#l71.66"></a><span id="l71.66">       if(day != undefined &amp;&amp; day == 1) {</span>
<a href="#l71.67"></a><span id="l71.67">         calUtils.forward(controller, 1);</span>
<a href="#l71.68"></a><span id="l71.68">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l71.69"></a><span id="l71.69">       }</span>
<a href="#l71.70"></a><span id="l71.70" class="difflineminus">-      </span>
<a href="#l71.71"></a><span id="l71.71" class="difflineplus">+</span>
<a href="#l71.72"></a><span id="l71.72">       // previous day</span>
<a href="#l71.73"></a><span id="l71.73">       if(day != undefined &amp;&amp; day == -1) {</span>
<a href="#l71.74"></a><span id="l71.74">         calUtils.back(controller, 1);</span>
<a href="#l71.75"></a><span id="l71.75">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l71.76"></a><span id="l71.76">       }</span>
<a href="#l71.77"></a><span id="l71.77" class="difflineminus">-      </span>
<a href="#l71.78"></a><span id="l71.78" class="difflineplus">+</span>
<a href="#l71.79"></a><span id="l71.79">       calUtils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l71.80"></a><span id="l71.80" class="difflineminus">-      </span>
<a href="#l71.81"></a><span id="l71.81" class="difflineplus">+</span>
<a href="#l71.82"></a><span id="l71.82">       for (let node of eventNodes) {</span>
<a href="#l71.83"></a><span id="l71.83">         if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l71.84"></a><span id="l71.84">                      timezones[tz] == node.mOccurrence.title) {</span>
<a href="#l71.85"></a><span id="l71.85">           found = true;</span>
<a href="#l71.86"></a><span id="l71.86">           break;</span>
<a href="#l71.87"></a><span id="l71.87">         }</span>
<a href="#l71.88"></a><span id="l71.88">       }</span>
<a href="#l71.89"></a><span id="l71.89" class="difflineminus">-      </span>
<a href="#l71.90"></a><span id="l71.90" class="difflineplus">+</span>
<a href="#l71.91"></a><span id="l71.91">       if(day != undefined &amp;&amp; day == 1) {</span>
<a href="#l71.92"></a><span id="l71.92">         calUtils.back(controller, 1);</span>
<a href="#l71.93"></a><span id="l71.93">       }</span>
<a href="#l71.94"></a><span id="l71.94" class="difflineminus">-      </span>
<a href="#l71.95"></a><span id="l71.95" class="difflineplus">+</span>
<a href="#l71.96"></a><span id="l71.96">       if(day != undefined &amp;&amp; day == -1) {</span>
<a href="#l71.97"></a><span id="l71.97">         calUtils.forward(controller, 1);</span>
<a href="#l71.98"></a><span id="l71.98">       }</span>
<a href="#l71.99"></a><span id="l71.99">       controller.assertJS(found == true);</span>
<a href="#l71.100"></a><span id="l71.100">     }</span>
<a href="#l71.101"></a><span id="l71.101">   }</span>
<a href="#l71.102"></a><span id="l71.102"> }</span>
<a href="#l71.103"></a><span id="l71.103"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -18,60 +18,60 @@ var setupModule = function(module) {</span>
<a href="#l72.4"></a><span id="l72.4"> var testSmokeTest = function () {</span>
<a href="#l72.5"></a><span id="l72.5">   let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l72.6"></a><span id="l72.6">                               .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l72.7"></a><span id="l72.7">   let path = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l72.8"></a><span id="l72.8">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/';</span>
<a href="#l72.9"></a><span id="l72.9"> </span>
<a href="#l72.10"></a><span id="l72.10">   // open calendar view</span>
<a href="#l72.11"></a><span id="l72.11">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  </span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+</span>
<a href="#l72.14"></a><span id="l72.14">   // check for minimonth</span>
<a href="#l72.15"></a><span id="l72.15">   controller.waitForElement(new elementslib.ID(controller.window.document, &quot;calMinimonth&quot;));</span>
<a href="#l72.16"></a><span id="l72.16">   // every month has a first</span>
<a href="#l72.17"></a><span id="l72.17">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l72.18"></a><span id="l72.18">     + 'id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/'</span>
<a href="#l72.19"></a><span id="l72.19">     + 'id(&quot;calMinimonth&quot;)/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l72.20"></a><span id="l72.20" class="difflineminus">-  </span>
<a href="#l72.21"></a><span id="l72.21" class="difflineplus">+</span>
<a href="#l72.22"></a><span id="l72.22">   // check for calendar list</span>
<a href="#l72.23"></a><span id="l72.23">   controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-list-pane&quot;));</span>
<a href="#l72.24"></a><span id="l72.24">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l72.25"></a><span id="l72.25">     + 'id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/'</span>
<a href="#l72.26"></a><span id="l72.26">     + 'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})'));</span>
<a href="#l72.27"></a><span id="l72.27" class="difflineminus">-  </span>
<a href="#l72.28"></a><span id="l72.28" class="difflineplus">+</span>
<a href="#l72.29"></a><span id="l72.29">   // check for event search</span>
<a href="#l72.30"></a><span id="l72.30">   controller.assertNode(new elementslib.ID(controller.window.document, &quot;bottom-events-box&quot;));</span>
<a href="#l72.31"></a><span id="l72.31">   // there should be search field</span>
<a href="#l72.32"></a><span id="l72.32">   controller.assertNode(new elementslib.ID(controller.window.document, &quot;unifinder-search-field&quot;));</span>
<a href="#l72.33"></a><span id="l72.33" class="difflineminus">-  </span>
<a href="#l72.34"></a><span id="l72.34" class="difflineplus">+</span>
<a href="#l72.35"></a><span id="l72.35">   // default view is day view which should have 09:00 label and box</span>
<a href="#l72.36"></a><span id="l72.36">   let label = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, 9, 0, 0);</span>
<a href="#l72.37"></a><span id="l72.37">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l72.38"></a><span id="l72.38">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/'</span>
<a href="#l72.39"></a><span id="l72.39">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/'</span>
<a href="#l72.40"></a><span id="l72.40">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/{&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;' + label + '&quot;}'));</span>
<a href="#l72.41"></a><span id="l72.41">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l72.42"></a><span id="l72.42">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/'</span>
<a href="#l72.43"></a><span id="l72.43">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/'</span>
<a href="#l72.44"></a><span id="l72.44">     + 'anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l72.45"></a><span id="l72.45" class="difflineminus">-    </span>
<a href="#l72.46"></a><span id="l72.46" class="difflineplus">+</span>
<a href="#l72.47"></a><span id="l72.47">   // open tasks view</span>
<a href="#l72.48"></a><span id="l72.48">   controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l72.49"></a><span id="l72.49">   // should be possible to filter today's tasks</span>
<a href="#l72.50"></a><span id="l72.50">   controller.waitForElement(new elementslib.ID(controller.window.document, &quot;opt_today_filter&quot;));</span>
<a href="#l72.51"></a><span id="l72.51">   // check for task add button</span>
<a href="#l72.52"></a><span id="l72.52">   controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-add-task-button&quot;));</span>
<a href="#l72.53"></a><span id="l72.53">   // check for filtered tasks list</span>
<a href="#l72.54"></a><span id="l72.54">   controller.assertNode(new elementslib.Lookup(controller.window.document, path</span>
<a href="#l72.55"></a><span id="l72.55">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/[1]/id(&quot;calendar-task-tree&quot;)/'</span>
<a href="#l72.56"></a><span id="l72.56">     + 'anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}'));</span>
<a href="#l72.57"></a><span id="l72.57" class="difflineminus">-  </span>
<a href="#l72.58"></a><span id="l72.58" class="difflineplus">+</span>
<a href="#l72.59"></a><span id="l72.59">   // create test calendar</span>
<a href="#l72.60"></a><span id="l72.60">   modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l72.61"></a><span id="l72.61" class="difflineminus">-  let calendarList = new elementslib.Lookup(controller.window.document, path </span>
<a href="#l72.62"></a><span id="l72.62" class="difflineplus">+  let calendarList = new elementslib.Lookup(controller.window.document, path</span>
<a href="#l72.63"></a><span id="l72.63">     + '/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/'</span>
<a href="#l72.64"></a><span id="l72.64">     + 'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})');</span>
<a href="#l72.65"></a><span id="l72.65">   controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height); // bottom left</span>
<a href="#l72.66"></a><span id="l72.66">   modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l72.67"></a><span id="l72.67"> }</span>
<a href="#l72.68"></a><span id="l72.68"> </span>
<a href="#l72.69"></a><span id="l72.69"> function handleNewCalendarWizard(controller) {</span>
<a href="#l72.70"></a><span id="l72.70">   let docEl = controller.window.document.documentElement;</span>
<a href="#l72.71"></a><span id="l72.71" class="difflineat">@@ -79,19 +79,19 @@ function handleNewCalendarWizard(control</span>
<a href="#l72.72"></a><span id="l72.72">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l72.73"></a><span id="l72.73"> </span>
<a href="#l72.74"></a><span id="l72.74">   // set calendar name</span>
<a href="#l72.75"></a><span id="l72.75">   let calendarNameTextBox = new elementslib.Lookup(controller.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l72.76"></a><span id="l72.76">     + '{&quot;pageid&quot;:&quot;customizePage&quot;}/[1]/id(&quot;customize-rows&quot;)/id(&quot;customize-name-row&quot;)/'</span>
<a href="#l72.77"></a><span id="l72.77">     + 'id(&quot;calendar-name&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l72.78"></a><span id="l72.78">   controller.waitForElement(calendarNameTextBox);</span>
<a href="#l72.79"></a><span id="l72.79">   controller.type(calendarNameTextBox, &quot;Mozmill&quot;);</span>
<a href="#l72.80"></a><span id="l72.80" class="difflineminus">-  </span>
<a href="#l72.81"></a><span id="l72.81" class="difflineplus">+</span>
<a href="#l72.82"></a><span id="l72.82">   // click next</span>
<a href="#l72.83"></a><span id="l72.83">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l72.84"></a><span id="l72.84" class="difflineminus">-  </span>
<a href="#l72.85"></a><span id="l72.85" class="difflineplus">+</span>
<a href="#l72.86"></a><span id="l72.86">   // click finish</span>
<a href="#l72.87"></a><span id="l72.87">   docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l72.88"></a><span id="l72.88"> }</span>
<a href="#l72.89"></a><span id="l72.89"> </span>
<a href="#l72.90"></a><span id="l72.90"> var teardownTest = function(module) {</span>
<a href="#l72.91"></a><span id="l72.91">   calUtils.deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l72.92"></a><span id="l72.92"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -17,37 +17,37 @@ var hour = 8;</span>
<a href="#l73.4"></a><span id="l73.4"> var calendar;</span>
<a href="#l73.5"></a><span id="l73.5"> var uri;</span>
<a href="#l73.6"></a><span id="l73.6"> var file;</span>
<a href="#l73.7"></a><span id="l73.7"> var title;</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9"> var setupModule = function(module) {</span>
<a href="#l73.10"></a><span id="l73.10">   controller = mozmill.getMail3PaneController();</span>
<a href="#l73.11"></a><span id="l73.11">   modalDialog = collector.getModule('window-helpers');</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-  </span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+</span>
<a href="#l73.14"></a><span id="l73.14">   // unique name needed as deleting a calendar only unsubscribes from it</span>
<a href="#l73.15"></a><span id="l73.15">   // and if same file were used on next testrun then previously created event would show up</span>
<a href="#l73.16"></a><span id="l73.16">   let time = (new Date()).getTime() + '';</span>
<a href="#l73.17"></a><span id="l73.17">   calendar = time;</span>
<a href="#l73.18"></a><span id="l73.18">   title = time;</span>
<a href="#l73.19"></a><span id="l73.19" class="difflineminus">-  </span>
<a href="#l73.20"></a><span id="l73.20" class="difflineplus">+</span>
<a href="#l73.21"></a><span id="l73.21">   file = Services.dirsvc.get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l73.22"></a><span id="l73.22">   file.append(calendar + &quot;.ics&quot;);</span>
<a href="#l73.23"></a><span id="l73.23">   let fileURI = Services.io.newFileURI(file);</span>
<a href="#l73.24"></a><span id="l73.24">   uri = fileURI.prePath + fileURI.path;</span>
<a href="#l73.25"></a><span id="l73.25"> }</span>
<a href="#l73.26"></a><span id="l73.26"> </span>
<a href="#l73.27"></a><span id="l73.27"> var testLocalICS = function () {</span>
<a href="#l73.28"></a><span id="l73.28">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l73.29"></a><span id="l73.29">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l73.30"></a><span id="l73.30" class="difflineminus">-  </span>
<a href="#l73.31"></a><span id="l73.31" class="difflineplus">+</span>
<a href="#l73.32"></a><span id="l73.32">   modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l73.33"></a><span id="l73.33">   controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l73.34"></a><span id="l73.34">   modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l73.35"></a><span id="l73.35" class="difflineminus">-  </span>
<a href="#l73.36"></a><span id="l73.36" class="difflineplus">+</span>
<a href="#l73.37"></a><span id="l73.37">   // create new event</span>
<a href="#l73.38"></a><span id="l73.38">   controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l73.39"></a><span id="l73.39">     calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l73.40"></a><span id="l73.40">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l73.41"></a><span id="l73.41">   let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l73.42"></a><span id="l73.42">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l73.43"></a><span id="l73.43"> </span>
<a href="#l73.44"></a><span id="l73.44">   // let the iframe load</span>
<a href="#l73.45"></a><span id="l73.45" class="difflineat">@@ -63,20 +63,20 @@ var testLocalICS = function () {</span>
<a href="#l73.46"></a><span id="l73.46"> </span>
<a href="#l73.47"></a><span id="l73.47">   // set calendar</span>
<a href="#l73.48"></a><span id="l73.48">   let itemCalendar = new elementslib.ID(event.window.document, &quot;item-calendar&quot;)</span>
<a href="#l73.49"></a><span id="l73.49">   event.select(itemCalendar, undefined, calendar);</span>
<a href="#l73.50"></a><span id="l73.50">   // HACK - Wait for the value to be selected. This is needed for platforms</span>
<a href="#l73.51"></a><span id="l73.51">   // like mac where selecting the menuitem is an asynchronous process, it might</span>
<a href="#l73.52"></a><span id="l73.52">   // be fixed in a later version of mozmill.</span>
<a href="#l73.53"></a><span id="l73.53">   event.waitFor(() =&gt; itemCalendar.getNode().value == calendar);</span>
<a href="#l73.54"></a><span id="l73.54" class="difflineminus">-  </span>
<a href="#l73.55"></a><span id="l73.55" class="difflineplus">+</span>
<a href="#l73.56"></a><span id="l73.56">   // save</span>
<a href="#l73.57"></a><span id="l73.57">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l73.58"></a><span id="l73.58" class="difflineminus">-  </span>
<a href="#l73.59"></a><span id="l73.59" class="difflineplus">+</span>
<a href="#l73.60"></a><span id="l73.60">   // assert presence in view</span>
<a href="#l73.61"></a><span id="l73.61">   let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour)</span>
<a href="#l73.62"></a><span id="l73.62">     + '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar + '&quot;}';</span>
<a href="#l73.63"></a><span id="l73.63">   controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l73.64"></a><span id="l73.64"> </span>
<a href="#l73.65"></a><span id="l73.65">   // verify in file</span>
<a href="#l73.66"></a><span id="l73.66">   let fstream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l73.67"></a><span id="l73.67">                           .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l73.68"></a><span id="l73.68" class="difflineat">@@ -101,35 +101,35 @@ var testLocalICS = function () {</span>
<a href="#l73.69"></a><span id="l73.69"> }</span>
<a href="#l73.70"></a><span id="l73.70"> </span>
<a href="#l73.71"></a><span id="l73.71"> var teardownTest = function(module) {</span>
<a href="#l73.72"></a><span id="l73.72">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l73.73"></a><span id="l73.73"> }</span>
<a href="#l73.74"></a><span id="l73.74"> </span>
<a href="#l73.75"></a><span id="l73.75"> function handleNewCalendarWizard(wizard) {</span>
<a href="#l73.76"></a><span id="l73.76">   let docEl = wizard.window.document.documentElement;</span>
<a href="#l73.77"></a><span id="l73.77" class="difflineminus">-  </span>
<a href="#l73.78"></a><span id="l73.78" class="difflineplus">+</span>
<a href="#l73.79"></a><span id="l73.79">   // choose network calendar</span>
<a href="#l73.80"></a><span id="l73.80">   let remoteOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l73.81"></a><span id="l73.81">     + '{&quot;pageid&quot;:&quot;initialPage&quot;}/id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}');</span>
<a href="#l73.82"></a><span id="l73.82">   wizard.waitForElement(remoteOption);</span>
<a href="#l73.83"></a><span id="l73.83">   wizard.radio(remoteOption);</span>
<a href="#l73.84"></a><span id="l73.84">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l73.85"></a><span id="l73.85" class="difflineminus">-  </span>
<a href="#l73.86"></a><span id="l73.86" class="difflineplus">+</span>
<a href="#l73.87"></a><span id="l73.87">   // choose ical</span>
<a href="#l73.88"></a><span id="l73.88">   let icalOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l73.89"></a><span id="l73.89">     + '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/id(&quot;calendar-format&quot;)/{&quot;value&quot;:&quot;ics&quot;}');</span>
<a href="#l73.90"></a><span id="l73.90">   wizard.waitForElement(icalOption);</span>
<a href="#l73.91"></a><span id="l73.91">   wizard.radio(icalOption);</span>
<a href="#l73.92"></a><span id="l73.92">   // enter location</span>
<a href="#l73.93"></a><span id="l73.93">   wizard.type(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/'</span>
<a href="#l73.94"></a><span id="l73.94">     + '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/'</span>
<a href="#l73.95"></a><span id="l73.95">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l73.96"></a><span id="l73.96">     uri);</span>
<a href="#l73.97"></a><span id="l73.97">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l73.98"></a><span id="l73.98" class="difflineminus">-  </span>
<a href="#l73.99"></a><span id="l73.99" class="difflineplus">+</span>
<a href="#l73.100"></a><span id="l73.100">   // name is filled in automatically using filename</span>
<a href="#l73.101"></a><span id="l73.101">   wizard.waitFor(function() {return docEl.getButton(&quot;next&quot;).disabled == false});</span>
<a href="#l73.102"></a><span id="l73.102">   docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l73.103"></a><span id="l73.103" class="difflineminus">-  </span>
<a href="#l73.104"></a><span id="l73.104" class="difflineplus">+</span>
<a href="#l73.105"></a><span id="l73.105">   // finish</span>
<a href="#l73.106"></a><span id="l73.106">   docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l73.107"></a><span id="l73.107"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -24,20 +24,20 @@ var times = [[[18, 30], [19, 30], [20, 3</span>
<a href="#l74.4"></a><span id="l74.4">              [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]]</span>
<a href="#l74.5"></a><span id="l74.5"> </span>
<a href="#l74.6"></a><span id="l74.6"> var setupModule = function(module) {</span>
<a href="#l74.7"></a><span id="l74.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l74.8"></a><span id="l74.8"> }</span>
<a href="#l74.9"></a><span id="l74.9"> </span>
<a href="#l74.10"></a><span id="l74.10"> var testTimezones10_checkAdelaide = function () {</span>
<a href="#l74.11"></a><span id="l74.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-  </span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+</span>
<a href="#l74.14"></a><span id="l74.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l74.15"></a><span id="l74.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l74.16"></a><span id="l74.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l74.17"></a><span id="l74.17" class="difflineminus">-  </span>
<a href="#l74.18"></a><span id="l74.18" class="difflineplus">+</span>
<a href="#l74.19"></a><span id="l74.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l74.20"></a><span id="l74.20"> }</span>
<a href="#l74.21"></a><span id="l74.21"> </span>
<a href="#l74.22"></a><span id="l74.22"> var teardownTest = function(module) {</span>
<a href="#l74.23"></a><span id="l74.23">   prefs.preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l74.24"></a><span id="l74.24">   calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l74.25"></a><span id="l74.25"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -16,53 +16,53 @@ var gTimezone;</span>
<a href="#l75.4"></a><span id="l75.4"> var setupModule = function(module) {</span>
<a href="#l75.5"></a><span id="l75.5">   controller = mozmill.getMail3PaneController();</span>
<a href="#l75.6"></a><span id="l75.6"> }</span>
<a href="#l75.7"></a><span id="l75.7"> </span>
<a href="#l75.8"></a><span id="l75.8"> var testTimezones2_CreateEvents = function () {</span>
<a href="#l75.9"></a><span id="l75.9">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l75.10"></a><span id="l75.10">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l75.11"></a><span id="l75.11">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-  </span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+</span>
<a href="#l75.14"></a><span id="l75.14">   // create daily recurring events in all timezones</span>
<a href="#l75.15"></a><span id="l75.15">   let time = new Date();</span>
<a href="#l75.16"></a><span id="l75.16">   for (let i = 0; i &lt; timezones.length; i++) {</span>
<a href="#l75.17"></a><span id="l75.17">     controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l75.18"></a><span id="l75.18">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, i + 8)), 1, 1);</span>
<a href="#l75.19"></a><span id="l75.19">     controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l75.20"></a><span id="l75.20">     let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l75.21"></a><span id="l75.21" class="difflineminus">-    </span>
<a href="#l75.22"></a><span id="l75.22" class="difflineplus">+</span>
<a href="#l75.23"></a><span id="l75.23">     time.setHours(times[i][0]);</span>
<a href="#l75.24"></a><span id="l75.24">     time.setMinutes(times[i][1]);</span>
<a href="#l75.25"></a><span id="l75.25" class="difflineminus">-    </span>
<a href="#l75.26"></a><span id="l75.26" class="difflineplus">+</span>
<a href="#l75.27"></a><span id="l75.27">     // set timezone</span>
<a href="#l75.28"></a><span id="l75.28">     setTimezone(event, timezones[i]);</span>
<a href="#l75.29"></a><span id="l75.29" class="difflineminus">-    </span>
<a href="#l75.30"></a><span id="l75.30" class="difflineplus">+</span>
<a href="#l75.31"></a><span id="l75.31">     // set title and repeat</span>
<a href="#l75.32"></a><span id="l75.32">     calUtils.setData(event, {title:timezones[i], repeat:&quot;weekly&quot;, starttime:time});</span>
<a href="#l75.33"></a><span id="l75.33"> </span>
<a href="#l75.34"></a><span id="l75.34">     // save</span>
<a href="#l75.35"></a><span id="l75.35">     event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l75.36"></a><span id="l75.36">     controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l75.37"></a><span id="l75.37">   }</span>
<a href="#l75.38"></a><span id="l75.38"> }</span>
<a href="#l75.39"></a><span id="l75.39"> </span>
<a href="#l75.40"></a><span id="l75.40"> var teardownTest = function(module) {</span>
<a href="#l75.41"></a><span id="l75.41">   timezoneUtils.switchAppTimezone(timezones[0]);</span>
<a href="#l75.42"></a><span id="l75.42"> }</span>
<a href="#l75.43"></a><span id="l75.43"> </span>
<a href="#l75.44"></a><span id="l75.44"> function setTimezone(event, timezone) {</span>
<a href="#l75.45"></a><span id="l75.45">   gTimezone = timezone;</span>
<a href="#l75.46"></a><span id="l75.46" class="difflineminus">-  </span>
<a href="#l75.47"></a><span id="l75.47" class="difflineplus">+</span>
<a href="#l75.48"></a><span id="l75.48">   // for some reason setting checked is needed, no other menuitem with checkbox needs it</span>
<a href="#l75.49"></a><span id="l75.49">   let menuitem = new elementslib.ID(event.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l75.50"></a><span id="l75.50">   event.waitForElement(menuitem);</span>
<a href="#l75.51"></a><span id="l75.51">   menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l75.52"></a><span id="l75.52">   event.click(menuitem);</span>
<a href="#l75.53"></a><span id="l75.53" class="difflineminus">-  </span>
<a href="#l75.54"></a><span id="l75.54" class="difflineplus">+</span>
<a href="#l75.55"></a><span id="l75.55">   let modal = new modalDialog.modalDialog(event.window);</span>
<a href="#l75.56"></a><span id="l75.56">   modal.start(eventCallback);</span>
<a href="#l75.57"></a><span id="l75.57">   event.waitForElement(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l75.58"></a><span id="l75.58">   event.click(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l75.59"></a><span id="l75.59"> }</span>
<a href="#l75.60"></a><span id="l75.60"> </span>
<a href="#l75.61"></a><span id="l75.61"> function eventCallback(timezone) {</span>
<a href="#l75.62"></a><span id="l75.62">   let item = new elementslib.XPath(timezone.window.document, &quot;/*[name()='dialog']/&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[4, 30], [5, 30], [6, 30],</span>
<a href="#l76.4"></a><span id="l76.4">              [[4, 30], [5, 30], [6, 30], [7, 30],  [8, 30],  [9, 30], [10, 30], [11, 30]]]</span>
<a href="#l76.5"></a><span id="l76.5"> </span>
<a href="#l76.6"></a><span id="l76.6"> var setupModule = function(module) {</span>
<a href="#l76.7"></a><span id="l76.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l76.8"></a><span id="l76.8"> }</span>
<a href="#l76.9"></a><span id="l76.9"> </span>
<a href="#l76.10"></a><span id="l76.10"> var testTimezones3_checkStJohns = function () {</span>
<a href="#l76.11"></a><span id="l76.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  </span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+</span>
<a href="#l76.14"></a><span id="l76.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l76.15"></a><span id="l76.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l76.16"></a><span id="l76.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l76.17"></a><span id="l76.17" class="difflineminus">-  </span>
<a href="#l76.18"></a><span id="l76.18" class="difflineplus">+</span>
<a href="#l76.19"></a><span id="l76.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l76.20"></a><span id="l76.20"> }</span>
<a href="#l76.21"></a><span id="l76.21"> </span>
<a href="#l76.22"></a><span id="l76.22"> var teardownTest = function(module) {</span>
<a href="#l76.23"></a><span id="l76.23">   timezoneUtils.switchAppTimezone(timezones[1]);</span>
<a href="#l76.24"></a><span id="l76.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[3, 30], [4, 30], [5, 30],</span>
<a href="#l77.4"></a><span id="l77.4">              [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]]]</span>
<a href="#l77.5"></a><span id="l77.5"> </span>
<a href="#l77.6"></a><span id="l77.6"> var setupModule = function(module) {</span>
<a href="#l77.7"></a><span id="l77.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l77.8"></a><span id="l77.8"> }</span>
<a href="#l77.9"></a><span id="l77.9"> </span>
<a href="#l77.10"></a><span id="l77.10"> var testTimezones4_checkCaracas = function () {</span>
<a href="#l77.11"></a><span id="l77.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-  </span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+</span>
<a href="#l77.14"></a><span id="l77.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l77.15"></a><span id="l77.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l77.16"></a><span id="l77.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l77.17"></a><span id="l77.17" class="difflineminus">-  </span>
<a href="#l77.18"></a><span id="l77.18" class="difflineplus">+</span>
<a href="#l77.19"></a><span id="l77.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l77.20"></a><span id="l77.20"> }</span>
<a href="#l77.21"></a><span id="l77.21"> </span>
<a href="#l77.22"></a><span id="l77.22"> var teardownTest = function(module) {</span>
<a href="#l77.23"></a><span id="l77.23">   timezoneUtils.switchAppTimezone(timezones[2]);</span>
<a href="#l77.24"></a><span id="l77.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[1, 0], [2, 0], [3, 0], [4</span>
<a href="#l78.4"></a><span id="l78.4">              [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]]</span>
<a href="#l78.5"></a><span id="l78.5"> </span>
<a href="#l78.6"></a><span id="l78.6"> var setupModule = function(module) {</span>
<a href="#l78.7"></a><span id="l78.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l78.8"></a><span id="l78.8"> }</span>
<a href="#l78.9"></a><span id="l78.9"> </span>
<a href="#l78.10"></a><span id="l78.10"> var testTimezones5_checkPhoenix = function () {</span>
<a href="#l78.11"></a><span id="l78.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-  </span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+</span>
<a href="#l78.14"></a><span id="l78.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l78.15"></a><span id="l78.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l78.16"></a><span id="l78.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l78.17"></a><span id="l78.17" class="difflineminus">-  </span>
<a href="#l78.18"></a><span id="l78.18" class="difflineplus">+</span>
<a href="#l78.19"></a><span id="l78.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l78.20"></a><span id="l78.20"> }</span>
<a href="#l78.21"></a><span id="l78.21"> </span>
<a href="#l78.22"></a><span id="l78.22"> var teardownTest = function(module) {</span>
<a href="#l78.23"></a><span id="l78.23">   timezoneUtils.switchAppTimezone(timezones[3]);</span>
<a href="#l78.24"></a><span id="l78.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[0, 0], [1, 0], [2, 0], [3</span>
<a href="#l79.4"></a><span id="l79.4">              [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]]</span>
<a href="#l79.5"></a><span id="l79.5"> </span>
<a href="#l79.6"></a><span id="l79.6"> var setupModule = function(module) {</span>
<a href="#l79.7"></a><span id="l79.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l79.8"></a><span id="l79.8"> }</span>
<a href="#l79.9"></a><span id="l79.9"> </span>
<a href="#l79.10"></a><span id="l79.10"> var testTimezones6_checkLosAngeles = function () {</span>
<a href="#l79.11"></a><span id="l79.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-  </span>
<a href="#l79.13"></a><span id="l79.13" class="difflineplus">+</span>
<a href="#l79.14"></a><span id="l79.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l79.15"></a><span id="l79.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l79.16"></a><span id="l79.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l79.17"></a><span id="l79.17" class="difflineminus">-  </span>
<a href="#l79.18"></a><span id="l79.18" class="difflineplus">+</span>
<a href="#l79.19"></a><span id="l79.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l79.20"></a><span id="l79.20"> }</span>
<a href="#l79.21"></a><span id="l79.21"> </span>
<a href="#l79.22"></a><span id="l79.22"> var teardownTest = function(module) {</span>
<a href="#l79.23"></a><span id="l79.23">   timezoneUtils.switchAppTimezone(timezones[4]);</span>
<a href="#l79.24"></a><span id="l79.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[5, 0], [6, 0], [7, 0], [8</span>
<a href="#l80.4"></a><span id="l80.4">              [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]]</span>
<a href="#l80.5"></a><span id="l80.5"> </span>
<a href="#l80.6"></a><span id="l80.6"> var setupModule = function(module) {</span>
<a href="#l80.7"></a><span id="l80.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l80.8"></a><span id="l80.8"> }</span>
<a href="#l80.9"></a><span id="l80.9"> </span>
<a href="#l80.10"></a><span id="l80.10"> var testTimezones7_checkBuenosAires = function () {</span>
<a href="#l80.11"></a><span id="l80.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-  </span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+</span>
<a href="#l80.14"></a><span id="l80.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l80.15"></a><span id="l80.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l80.16"></a><span id="l80.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l80.17"></a><span id="l80.17" class="difflineminus">-  </span>
<a href="#l80.18"></a><span id="l80.18" class="difflineplus">+</span>
<a href="#l80.19"></a><span id="l80.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l80.20"></a><span id="l80.20"> }</span>
<a href="#l80.21"></a><span id="l80.21"> </span>
<a href="#l80.22"></a><span id="l80.22"> var teardownTest = function(module) {</span>
<a href="#l80.23"></a><span id="l80.23">   timezoneUtils.switchAppTimezone(timezones[5]);</span>
<a href="#l80.24"></a><span id="l80.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[9, 0], [10, 0], [11, 0], </span>
<a href="#l81.4"></a><span id="l81.4">              [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]]</span>
<a href="#l81.5"></a><span id="l81.5"> </span>
<a href="#l81.6"></a><span id="l81.6"> var setupModule = function(module) {</span>
<a href="#l81.7"></a><span id="l81.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l81.8"></a><span id="l81.8"> }</span>
<a href="#l81.9"></a><span id="l81.9"> </span>
<a href="#l81.10"></a><span id="l81.10"> var testTimezones8_checkParis = function () {</span>
<a href="#l81.11"></a><span id="l81.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-  </span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+</span>
<a href="#l81.14"></a><span id="l81.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l81.15"></a><span id="l81.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l81.16"></a><span id="l81.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l81.17"></a><span id="l81.17" class="difflineminus">-  </span>
<a href="#l81.18"></a><span id="l81.18" class="difflineplus">+</span>
<a href="#l81.19"></a><span id="l81.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l81.20"></a><span id="l81.20"> }</span>
<a href="#l81.21"></a><span id="l81.21"> </span>
<a href="#l81.22"></a><span id="l81.22"> var teardownTest = function(module) {</span>
<a href="#l81.23"></a><span id="l81.23">   timezoneUtils.switchAppTimezone(timezones[6]);</span>
<a href="#l81.24"></a><span id="l81.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -23,19 +23,19 @@ var times = [[[13, 45], [14, 45], [15, 4</span>
<a href="#l82.4"></a><span id="l82.4">              [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]]</span>
<a href="#l82.5"></a><span id="l82.5"> </span>
<a href="#l82.6"></a><span id="l82.6"> var setupModule = function(module) {</span>
<a href="#l82.7"></a><span id="l82.7">   controller = mozmill.getMail3PaneController();</span>
<a href="#l82.8"></a><span id="l82.8"> }</span>
<a href="#l82.9"></a><span id="l82.9"> </span>
<a href="#l82.10"></a><span id="l82.10"> var testTimezones9_checkKathmandu = function () {</span>
<a href="#l82.11"></a><span id="l82.11">   let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-  </span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+</span>
<a href="#l82.14"></a><span id="l82.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l82.15"></a><span id="l82.15">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l82.16"></a><span id="l82.16">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l82.17"></a><span id="l82.17" class="difflineminus">-  </span>
<a href="#l82.18"></a><span id="l82.18" class="difflineplus">+</span>
<a href="#l82.19"></a><span id="l82.19">   timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l82.20"></a><span id="l82.20"> }</span>
<a href="#l82.21"></a><span id="l82.21"> </span>
<a href="#l82.22"></a><span id="l82.22"> var teardownTest = function(module) {</span>
<a href="#l82.23"></a><span id="l82.23">   timezoneUtils.switchAppTimezone(timezones[7]);</span>
<a href="#l82.24"></a><span id="l82.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -24,50 +24,50 @@ var testDayView = function () {</span>
<a href="#l83.4"></a><span id="l83.4">     + 'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l83.5"></a><span id="l83.5">   let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l83.6"></a><span id="l83.6">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l83.7"></a><span id="l83.7">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l83.8"></a><span id="l83.8">   let day = new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l83.9"></a><span id="l83.9">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/'</span>
<a href="#l83.10"></a><span id="l83.10">     + '{&quot;flex&quot;:&quot;1&quot;}');</span>
<a href="#l83.11"></a><span id="l83.11">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-  </span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+</span>
<a href="#l83.14"></a><span id="l83.14">   // open day view</span>
<a href="#l83.15"></a><span id="l83.15">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l83.16"></a><span id="l83.16">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l83.17"></a><span id="l83.17" class="difflineminus">-  </span>
<a href="#l83.18"></a><span id="l83.18" class="difflineplus">+</span>
<a href="#l83.19"></a><span id="l83.19">   // pick year</span>
<a href="#l83.20"></a><span id="l83.20">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l83.21"></a><span id="l83.21">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l83.22"></a><span id="l83.22">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l83.23"></a><span id="l83.23">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l83.24"></a><span id="l83.24">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l83.25"></a><span id="l83.25" class="difflineminus">-  </span>
<a href="#l83.26"></a><span id="l83.26" class="difflineplus">+</span>
<a href="#l83.27"></a><span id="l83.27">   // pick month</span>
<a href="#l83.28"></a><span id="l83.28">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l83.29"></a><span id="l83.29">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l83.30"></a><span id="l83.30">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l83.31"></a><span id="l83.31">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l83.32"></a><span id="l83.32">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l83.33"></a><span id="l83.33" class="difflineminus">-  </span>
<a href="#l83.34"></a><span id="l83.34" class="difflineplus">+</span>
<a href="#l83.35"></a><span id="l83.35">   // pick day</span>
<a href="#l83.36"></a><span id="l83.36">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l83.37"></a><span id="l83.37">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l83.38"></a><span id="l83.38" class="difflineminus">-  </span>
<a href="#l83.39"></a><span id="l83.39" class="difflineplus">+</span>
<a href="#l83.40"></a><span id="l83.40">   // verify date in view</span>
<a href="#l83.41"></a><span id="l83.41">   controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l83.42"></a><span id="l83.42"> </span>
<a href="#l83.43"></a><span id="l83.43">   // create event at 8 AM</span>
<a href="#l83.44"></a><span id="l83.44">   controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l83.45"></a><span id="l83.45">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l83.46"></a><span id="l83.46">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l83.47"></a><span id="l83.47">     + 'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l83.48"></a><span id="l83.48">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l83.49"></a><span id="l83.49">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l83.50"></a><span id="l83.50" class="difflineminus">-  </span>
<a href="#l83.51"></a><span id="l83.51" class="difflineplus">+</span>
<a href="#l83.52"></a><span id="l83.52">   // check that the start time is correct</span>
<a href="#l83.53"></a><span id="l83.53">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l83.54"></a><span id="l83.54">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l83.55"></a><span id="l83.55">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l83.56"></a><span id="l83.56">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l83.57"></a><span id="l83.57">     + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l83.58"></a><span id="l83.58">   event.waitForElement(startTimeInput);</span>
<a href="#l83.59"></a><span id="l83.59">   event.assertValue(startTimeInput, '8:00');</span>
<a href="#l83.60"></a><span id="l83.60" class="difflineat">@@ -75,61 +75,61 @@ var testDayView = function () {</span>
<a href="#l83.61"></a><span id="l83.61">     2009, 1, 1);</span>
<a href="#l83.62"></a><span id="l83.62">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l83.63"></a><span id="l83.63">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l83.64"></a><span id="l83.64">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l83.65"></a><span id="l83.65">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l83.66"></a><span id="l83.66">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l83.67"></a><span id="l83.67">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l83.68"></a><span id="l83.68">     date);</span>
<a href="#l83.69"></a><span id="l83.69" class="difflineminus">-    </span>
<a href="#l83.70"></a><span id="l83.70" class="difflineplus">+</span>
<a href="#l83.71"></a><span id="l83.71">   // fill in title, description and calendar</span>
<a href="#l83.72"></a><span id="l83.72">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l83.73"></a><span id="l83.73">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l83.74"></a><span id="l83.74">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l83.75"></a><span id="l83.75">     title1);</span>
<a href="#l83.76"></a><span id="l83.76">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l83.77"></a><span id="l83.77">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l83.78"></a><span id="l83.78">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l83.79"></a><span id="l83.79">     desc);</span>
<a href="#l83.80"></a><span id="l83.80">   event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l83.81"></a><span id="l83.81" class="difflineminus">-  </span>
<a href="#l83.82"></a><span id="l83.82" class="difflineplus">+</span>
<a href="#l83.83"></a><span id="l83.83">   // save</span>
<a href="#l83.84"></a><span id="l83.84">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l83.85"></a><span id="l83.85" class="difflineminus">-  </span>
<a href="#l83.86"></a><span id="l83.86" class="difflineplus">+</span>
<a href="#l83.87"></a><span id="l83.87">   // if it was created successfully, it can be opened</span>
<a href="#l83.88"></a><span id="l83.88">   let eventBox = new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l83.89"></a><span id="l83.89">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l83.90"></a><span id="l83.90">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l83.91"></a><span id="l83.91">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[0]/'</span>
<a href="#l83.92"></a><span id="l83.92">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}');</span>
<a href="#l83.93"></a><span id="l83.93">   controller.waitForElement(eventBox);</span>
<a href="#l83.94"></a><span id="l83.94">   controller.doubleClick(eventBox);</span>
<a href="#l83.95"></a><span id="l83.95">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l83.96"></a><span id="l83.96">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l83.97"></a><span id="l83.97" class="difflineminus">-  </span>
<a href="#l83.98"></a><span id="l83.98" class="difflineplus">+</span>
<a href="#l83.99"></a><span id="l83.99">   // change title and save changes</span>
<a href="#l83.100"></a><span id="l83.100">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l83.101"></a><span id="l83.101">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l83.102"></a><span id="l83.102">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l83.103"></a><span id="l83.103">   event.waitForElement(titleTextBox);</span>
<a href="#l83.104"></a><span id="l83.104">   event.type(titleTextBox, title2);</span>
<a href="#l83.105"></a><span id="l83.105">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l83.106"></a><span id="l83.106" class="difflineminus">-  </span>
<a href="#l83.107"></a><span id="l83.107" class="difflineplus">+</span>
<a href="#l83.108"></a><span id="l83.108">   // check if name was saved</span>
<a href="#l83.109"></a><span id="l83.109">   let eventName = new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l83.110"></a><span id="l83.110">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l83.111"></a><span id="l83.111">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l83.112"></a><span id="l83.112">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/'</span>
<a href="#l83.113"></a><span id="l83.113">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/'</span>
<a href="#l83.114"></a><span id="l83.114">     + 'anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l83.115"></a><span id="l83.115">     + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l83.116"></a><span id="l83.116">   controller.waitForElement(eventName);</span>
<a href="#l83.117"></a><span id="l83.117">   controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l83.118"></a><span id="l83.118" class="difflineminus">-  </span>
<a href="#l83.119"></a><span id="l83.119" class="difflineplus">+</span>
<a href="#l83.120"></a><span id="l83.120">   // delete event</span>
<a href="#l83.121"></a><span id="l83.121">   controller.click(new elementslib.Lookup(controller.window.document, dayView</span>
<a href="#l83.122"></a><span id="l83.122">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l83.123"></a><span id="l83.123">     + '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/'</span>
<a href="#l83.124"></a><span id="l83.124">     + 'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/'</span>
<a href="#l83.125"></a><span id="l83.125">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l83.126"></a><span id="l83.126">   controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l83.127"></a><span id="l83.127">     &quot;VK_DELETE&quot;, {});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -26,53 +26,53 @@ var testMonthView = function () {</span>
<a href="#l84.4"></a><span id="l84.4">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l84.5"></a><span id="l84.5">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l84.6"></a><span id="l84.6">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l84.7"></a><span id="l84.7">   let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/'</span>
<a href="#l84.8"></a><span id="l84.8">     + 'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/'</span>
<a href="#l84.9"></a><span id="l84.9">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/'</span>
<a href="#l84.10"></a><span id="l84.10">     + '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l84.11"></a><span id="l84.11">     + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-  </span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+</span>
<a href="#l84.14"></a><span id="l84.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l84.15"></a><span id="l84.15">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l84.16"></a><span id="l84.16" class="difflineminus">-  </span>
<a href="#l84.17"></a><span id="l84.17" class="difflineplus">+</span>
<a href="#l84.18"></a><span id="l84.18">   // pick year</span>
<a href="#l84.19"></a><span id="l84.19">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l84.20"></a><span id="l84.20">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l84.21"></a><span id="l84.21">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l84.22"></a><span id="l84.22">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l84.23"></a><span id="l84.23">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l84.24"></a><span id="l84.24" class="difflineminus">-  </span>
<a href="#l84.25"></a><span id="l84.25" class="difflineplus">+</span>
<a href="#l84.26"></a><span id="l84.26">   // pick month</span>
<a href="#l84.27"></a><span id="l84.27">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l84.28"></a><span id="l84.28">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l84.29"></a><span id="l84.29">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l84.30"></a><span id="l84.30">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l84.31"></a><span id="l84.31">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l84.32"></a><span id="l84.32"> </span>
<a href="#l84.33"></a><span id="l84.33">   // pick day</span>
<a href="#l84.34"></a><span id="l84.34">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l84.35"></a><span id="l84.35">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l84.36"></a><span id="l84.36" class="difflineminus">-  </span>
<a href="#l84.37"></a><span id="l84.37" class="difflineplus">+</span>
<a href="#l84.38"></a><span id="l84.38">   // verify date</span>
<a href="#l84.39"></a><span id="l84.39">   let day = new elementslib.Lookup(controller.window.document, monthView</span>
<a href="#l84.40"></a><span id="l84.40">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l84.41"></a><span id="l84.41">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l84.42"></a><span id="l84.42">   controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l84.43"></a><span id="l84.43"> </span>
<a href="#l84.44"></a><span id="l84.44">   // create event</span>
<a href="#l84.45"></a><span id="l84.45">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l84.46"></a><span id="l84.46">   let hour = new Date().getHours(); // remember time at click</span>
<a href="#l84.47"></a><span id="l84.47">   controller.doubleClick(new elementslib.Lookup(controller.window.document, monthView</span>
<a href="#l84.48"></a><span id="l84.48">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l84.49"></a><span id="l84.49">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l84.50"></a><span id="l84.50">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l84.51"></a><span id="l84.51">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l84.52"></a><span id="l84.52" class="difflineminus">-  </span>
<a href="#l84.53"></a><span id="l84.53" class="difflineplus">+</span>
<a href="#l84.54"></a><span id="l84.54">   // check that the start time is correct</span>
<a href="#l84.55"></a><span id="l84.55">   // next full hour except last hour hour of the day</span>
<a href="#l84.56"></a><span id="l84.56">   let nextHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l84.57"></a><span id="l84.57">   let startTime = nextHour + ':00'; // next full hour</span>
<a href="#l84.58"></a><span id="l84.58">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l84.59"></a><span id="l84.59">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l84.60"></a><span id="l84.60">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l84.61"></a><span id="l84.61">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l84.62"></a><span id="l84.62" class="difflineat">@@ -83,54 +83,54 @@ var testMonthView = function () {</span>
<a href="#l84.63"></a><span id="l84.63">     2009, 1, 1);</span>
<a href="#l84.64"></a><span id="l84.64">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l84.65"></a><span id="l84.65">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l84.66"></a><span id="l84.66">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l84.67"></a><span id="l84.67">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l84.68"></a><span id="l84.68">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l84.69"></a><span id="l84.69">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l84.70"></a><span id="l84.70">     date);</span>
<a href="#l84.71"></a><span id="l84.71" class="difflineminus">-    </span>
<a href="#l84.72"></a><span id="l84.72" class="difflineplus">+</span>
<a href="#l84.73"></a><span id="l84.73">   // fill in title, description and calendar</span>
<a href="#l84.74"></a><span id="l84.74">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l84.75"></a><span id="l84.75">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l84.76"></a><span id="l84.76">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l84.77"></a><span id="l84.77">     title1);</span>
<a href="#l84.78"></a><span id="l84.78">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l84.79"></a><span id="l84.79">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l84.80"></a><span id="l84.80">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l84.81"></a><span id="l84.81">     desc);</span>
<a href="#l84.82"></a><span id="l84.82">   event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l84.83"></a><span id="l84.83">   event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l84.84"></a><span id="l84.84">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/'</span>
<a href="#l84.85"></a><span id="l84.85">     + '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l84.86"></a><span id="l84.86" class="difflineminus">-  </span>
<a href="#l84.87"></a><span id="l84.87" class="difflineplus">+</span>
<a href="#l84.88"></a><span id="l84.88">   // save</span>
<a href="#l84.89"></a><span id="l84.89">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l84.90"></a><span id="l84.90" class="difflineminus">-  </span>
<a href="#l84.91"></a><span id="l84.91" class="difflineplus">+</span>
<a href="#l84.92"></a><span id="l84.92">   // if it was created successfully, it can be opened</span>
<a href="#l84.93"></a><span id="l84.93">   controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l84.94"></a><span id="l84.94">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l84.95"></a><span id="l84.95">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l84.96"></a><span id="l84.96">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l84.97"></a><span id="l84.97" class="difflineminus">-  </span>
<a href="#l84.98"></a><span id="l84.98" class="difflineplus">+</span>
<a href="#l84.99"></a><span id="l84.99">   // change title and save changes</span>
<a href="#l84.100"></a><span id="l84.100">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l84.101"></a><span id="l84.101">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l84.102"></a><span id="l84.102">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l84.103"></a><span id="l84.103">   event.waitForElement(titleTextBox);</span>
<a href="#l84.104"></a><span id="l84.104">   event.type(titleTextBox, title2);</span>
<a href="#l84.105"></a><span id="l84.105">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l84.106"></a><span id="l84.106" class="difflineminus">-  </span>
<a href="#l84.107"></a><span id="l84.107" class="difflineplus">+</span>
<a href="#l84.108"></a><span id="l84.108">   // check if name was saved</span>
<a href="#l84.109"></a><span id="l84.109">   let eventName = new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l84.110"></a><span id="l84.110">     + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l84.111"></a><span id="l84.111">   controller.waitForElement(eventName);</span>
<a href="#l84.112"></a><span id="l84.112">   controller.assertValue(eventName, title2);</span>
<a href="#l84.113"></a><span id="l84.113" class="difflineminus">-  </span>
<a href="#l84.114"></a><span id="l84.114" class="difflineplus">+</span>
<a href="#l84.115"></a><span id="l84.115">   // delete event</span>
<a href="#l84.116"></a><span id="l84.116">   controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l84.117"></a><span id="l84.117">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l84.118"></a><span id="l84.118">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l84.119"></a><span id="l84.119">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l84.120"></a><span id="l84.120"> }</span>
<a href="#l84.121"></a><span id="l84.121"> </span>
<a href="#l84.122"></a><span id="l84.122"> var teardownTest = function(module) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -26,111 +26,111 @@ var testMultiWeekView = function () {</span>
<a href="#l85.4"></a><span id="l85.4">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l85.5"></a><span id="l85.5">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;multiweek-view&quot;)/';</span>
<a href="#l85.6"></a><span id="l85.6">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l85.7"></a><span id="l85.7">   let eventBox = multiWeekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/'</span>
<a href="#l85.8"></a><span id="l85.8">     + 'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/'</span>
<a href="#l85.9"></a><span id="l85.9">     + '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/'</span>
<a href="#l85.10"></a><span id="l85.10">     + '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l85.11"></a><span id="l85.11">     + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-  </span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+</span>
<a href="#l85.14"></a><span id="l85.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l85.15"></a><span id="l85.15">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l85.16"></a><span id="l85.16" class="difflineminus">-  </span>
<a href="#l85.17"></a><span id="l85.17" class="difflineplus">+</span>
<a href="#l85.18"></a><span id="l85.18">   // pick year</span>
<a href="#l85.19"></a><span id="l85.19">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l85.20"></a><span id="l85.20">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l85.21"></a><span id="l85.21">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l85.22"></a><span id="l85.22">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l85.23"></a><span id="l85.23">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l85.24"></a><span id="l85.24" class="difflineminus">-  </span>
<a href="#l85.25"></a><span id="l85.25" class="difflineplus">+</span>
<a href="#l85.26"></a><span id="l85.26">   // pick month</span>
<a href="#l85.27"></a><span id="l85.27">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l85.28"></a><span id="l85.28">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l85.29"></a><span id="l85.29">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l85.30"></a><span id="l85.30">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l85.31"></a><span id="l85.31">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l85.32"></a><span id="l85.32"> </span>
<a href="#l85.33"></a><span id="l85.33">   // pick day</span>
<a href="#l85.34"></a><span id="l85.34">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l85.35"></a><span id="l85.35">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l85.36"></a><span id="l85.36" class="difflineminus">-  </span>
<a href="#l85.37"></a><span id="l85.37" class="difflineplus">+</span>
<a href="#l85.38"></a><span id="l85.38">   // verify date</span>
<a href="#l85.39"></a><span id="l85.39">   let day = new elementslib.Lookup(controller.window.document, multiWeekView</span>
<a href="#l85.40"></a><span id="l85.40">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l85.41"></a><span id="l85.41">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l85.42"></a><span id="l85.42">   controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l85.43"></a><span id="l85.43"> </span>
<a href="#l85.44"></a><span id="l85.44">   // create event</span>
<a href="#l85.45"></a><span id="l85.45">   // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l85.46"></a><span id="l85.46">   let hour = new Date().getHours(); // remember time at click</span>
<a href="#l85.47"></a><span id="l85.47">   controller.doubleClick(new elementslib.Lookup(controller.window.document, multiWeekView</span>
<a href="#l85.48"></a><span id="l85.48">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/'</span>
<a href="#l85.49"></a><span id="l85.49">     + '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l85.50"></a><span id="l85.50">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l85.51"></a><span id="l85.51">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l85.52"></a><span id="l85.52" class="difflineminus">-  </span>
<a href="#l85.53"></a><span id="l85.53" class="difflineplus">+</span>
<a href="#l85.54"></a><span id="l85.54">   // check that the start time is correct</span>
<a href="#l85.55"></a><span id="l85.55">   // next full hour except last hour hour of the day</span>
<a href="#l85.56"></a><span id="l85.56">   let nextHour = (hour == 23)? hour : (hour + 1) % 24;</span>
<a href="#l85.57"></a><span id="l85.57">   let startTime = nextHour + ':00';</span>
<a href="#l85.58"></a><span id="l85.58">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l85.59"></a><span id="l85.59">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l85.60"></a><span id="l85.60">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l85.61"></a><span id="l85.61">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l85.62"></a><span id="l85.62">     + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l85.63"></a><span id="l85.63">   event.waitForElement(startTimeInput);</span>
<a href="#l85.64"></a><span id="l85.64" class="difflineminus">-  event.assertValue(startTimeInput, startTime); </span>
<a href="#l85.65"></a><span id="l85.65" class="difflineplus">+  event.assertValue(startTimeInput, startTime);</span>
<a href="#l85.66"></a><span id="l85.66">   let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l85.67"></a><span id="l85.67">     2009, 1, 1);</span>
<a href="#l85.68"></a><span id="l85.68">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l85.69"></a><span id="l85.69">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l85.70"></a><span id="l85.70">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l85.71"></a><span id="l85.71">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l85.72"></a><span id="l85.72">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l85.73"></a><span id="l85.73">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l85.74"></a><span id="l85.74">     date);</span>
<a href="#l85.75"></a><span id="l85.75" class="difflineminus">-    </span>
<a href="#l85.76"></a><span id="l85.76" class="difflineplus">+</span>
<a href="#l85.77"></a><span id="l85.77">   // fill in title, description and calendar</span>
<a href="#l85.78"></a><span id="l85.78">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l85.79"></a><span id="l85.79">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l85.80"></a><span id="l85.80">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l85.81"></a><span id="l85.81">     title1);</span>
<a href="#l85.82"></a><span id="l85.82">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l85.83"></a><span id="l85.83">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l85.84"></a><span id="l85.84">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l85.85"></a><span id="l85.85">     desc);</span>
<a href="#l85.86"></a><span id="l85.86">   event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l85.87"></a><span id="l85.87">   event.click(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l85.88"></a><span id="l85.88">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/'</span>
<a href="#l85.89"></a><span id="l85.89">     + '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l85.90"></a><span id="l85.90" class="difflineminus">-  </span>
<a href="#l85.91"></a><span id="l85.91" class="difflineplus">+</span>
<a href="#l85.92"></a><span id="l85.92">   // save</span>
<a href="#l85.93"></a><span id="l85.93">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l85.94"></a><span id="l85.94" class="difflineminus">-  </span>
<a href="#l85.95"></a><span id="l85.95" class="difflineplus">+</span>
<a href="#l85.96"></a><span id="l85.96">   // if it was created successfully, it can be opened</span>
<a href="#l85.97"></a><span id="l85.97">   controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l85.98"></a><span id="l85.98">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l85.99"></a><span id="l85.99">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l85.100"></a><span id="l85.100">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l85.101"></a><span id="l85.101" class="difflineminus">-  </span>
<a href="#l85.102"></a><span id="l85.102" class="difflineplus">+</span>
<a href="#l85.103"></a><span id="l85.103">   // change title and save changes</span>
<a href="#l85.104"></a><span id="l85.104">   let titmeTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l85.105"></a><span id="l85.105">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l85.106"></a><span id="l85.106">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l85.107"></a><span id="l85.107">   event.waitForElement(titmeTextBox);</span>
<a href="#l85.108"></a><span id="l85.108">   event.type(titmeTextBox, title2);</span>
<a href="#l85.109"></a><span id="l85.109">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l85.110"></a><span id="l85.110" class="difflineminus">-  </span>
<a href="#l85.111"></a><span id="l85.111" class="difflineplus">+</span>
<a href="#l85.112"></a><span id="l85.112">   // check if name was saved</span>
<a href="#l85.113"></a><span id="l85.113">   let eventName = new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l85.114"></a><span id="l85.114">     + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l85.115"></a><span id="l85.115">   controller.waitForElement(eventName);</span>
<a href="#l85.116"></a><span id="l85.116">   controller.assertValue(eventName, title2);</span>
<a href="#l85.117"></a><span id="l85.117" class="difflineminus">-  </span>
<a href="#l85.118"></a><span id="l85.118" class="difflineplus">+</span>
<a href="#l85.119"></a><span id="l85.119">   // delete event</span>
<a href="#l85.120"></a><span id="l85.120">   controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l85.121"></a><span id="l85.121">   controller.keypress(new elementslib.ID(controller.window.document, &quot;multiweek-view&quot;),</span>
<a href="#l85.122"></a><span id="l85.122">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l85.123"></a><span id="l85.123">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l85.124"></a><span id="l85.124"> }</span>
<a href="#l85.125"></a><span id="l85.125"> </span>
<a href="#l85.126"></a><span id="l85.126"> var teardownTest = function(module) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -24,135 +24,135 @@ var testTaskView = function () {</span>
<a href="#l86.4"></a><span id="l86.4">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l86.5"></a><span id="l86.5">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/';</span>
<a href="#l86.6"></a><span id="l86.6">   let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l86.7"></a><span id="l86.7">   let treeChildren = taskView + '[1]/id(&quot;calendar-task-tree&quot;)/anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/'</span>
<a href="#l86.8"></a><span id="l86.8">     + '{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}';</span>
<a href="#l86.9"></a><span id="l86.9">   let taskTree = taskView + '[1]/id(&quot;calendar-task-tree&quot;)';</span>
<a href="#l86.10"></a><span id="l86.10">   let toolTip = '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;taskTreeTooltip&quot;)';</span>
<a href="#l86.11"></a><span id="l86.11">   let toolTipGrid = toolTip + '/{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/';</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-  </span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+</span>
<a href="#l86.14"></a><span id="l86.14">   // open task view</span>
<a href="#l86.15"></a><span id="l86.15">   controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l86.16"></a><span id="l86.16">   controller.sleep(sleep);</span>
<a href="#l86.17"></a><span id="l86.17" class="difflineminus">-  </span>
<a href="#l86.18"></a><span id="l86.18" class="difflineplus">+</span>
<a href="#l86.19"></a><span id="l86.19">   // make sure that testing calendar is selected</span>
<a href="#l86.20"></a><span id="l86.20">   let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l86.21"></a><span id="l86.21">     '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/'</span>
<a href="#l86.22"></a><span id="l86.22">     + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/'</span>
<a href="#l86.23"></a><span id="l86.23">     + 'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l86.24"></a><span id="l86.24">     .getNode();</span>
<a href="#l86.25"></a><span id="l86.25">   for(i = 0; i &lt; calendarTree.mCalendarList.length; i++)</span>
<a href="#l86.26"></a><span id="l86.26">     if(calendarTree.mCalendarList[i].name == calendar)</span>
<a href="#l86.27"></a><span id="l86.27">       calendarTree.tree.view.selection.select(i);</span>
<a href="#l86.28"></a><span id="l86.28" class="difflineminus">-  </span>
<a href="#l86.29"></a><span id="l86.29" class="difflineplus">+</span>
<a href="#l86.30"></a><span id="l86.30">   let taskTreeNode = (new elementslib.Lookup(controller.window.document, taskTree)).getNode();</span>
<a href="#l86.31"></a><span id="l86.31">   let countBefore = taskTreeNode.mTaskArray.length;</span>
<a href="#l86.32"></a><span id="l86.32" class="difflineminus">-  </span>
<a href="#l86.33"></a><span id="l86.33" class="difflineplus">+</span>
<a href="#l86.34"></a><span id="l86.34">   // add task</span>
<a href="#l86.35"></a><span id="l86.35">   controller.type(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l86.36"></a><span id="l86.36">     + 'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l86.37"></a><span id="l86.37">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l86.38"></a><span id="l86.38">     title);</span>
<a href="#l86.39"></a><span id="l86.39">   controller.keypress(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l86.40"></a><span id="l86.40">     + 'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l86.41"></a><span id="l86.41">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l86.42"></a><span id="l86.42">     &quot;VK_RETURN&quot;,</span>
<a href="#l86.43"></a><span id="l86.43">     {});</span>
<a href="#l86.44"></a><span id="l86.44" class="difflineminus">-  </span>
<a href="#l86.45"></a><span id="l86.45" class="difflineplus">+</span>
<a href="#l86.46"></a><span id="l86.46">   // verify added</span>
<a href="#l86.47"></a><span id="l86.47">   let countAfter;</span>
<a href="#l86.48"></a><span id="l86.48">   controller.waitFor(function() {countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l86.49"></a><span id="l86.49">                                  return countBefore + 1 == countAfter});</span>
<a href="#l86.50"></a><span id="l86.50" class="difflineminus">-  </span>
<a href="#l86.51"></a><span id="l86.51" class="difflineplus">+</span>
<a href="#l86.52"></a><span id="l86.52">   // last added task is automatically selected so verify detail window data</span>
<a href="#l86.53"></a><span id="l86.53">   controller.assertJSProperty(new elementslib.ID(controller.window.document,</span>
<a href="#l86.54"></a><span id="l86.54">     &quot;calendar-task-details-title&quot;), &quot;textContent&quot;, title);</span>
<a href="#l86.55"></a><span id="l86.55" class="difflineminus">-  </span>
<a href="#l86.56"></a><span id="l86.56" class="difflineplus">+</span>
<a href="#l86.57"></a><span id="l86.57">   // open added task</span>
<a href="#l86.58"></a><span id="l86.58">   // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l86.59"></a><span id="l86.59">   // left where the checkbox is located</span>
<a href="#l86.60"></a><span id="l86.60">   controller.doubleClick(new elementslib.Lookup(controller.window.document, treeChildren), 50, 0);</span>
<a href="#l86.61"></a><span id="l86.61">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l86.62"></a><span id="l86.62">   let task = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l86.63"></a><span id="l86.63" class="difflineminus">-  </span>
<a href="#l86.64"></a><span id="l86.64" class="difflineplus">+</span>
<a href="#l86.65"></a><span id="l86.65">   // verify calendar</span>
<a href="#l86.66"></a><span id="l86.66">   task.waitForElement(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l86.67"></a><span id="l86.67">     + 'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/'</span>
<a href="#l86.68"></a><span id="l86.68">     + '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'))</span>
<a href="#l86.69"></a><span id="l86.69" class="difflineminus">-  </span>
<a href="#l86.70"></a><span id="l86.70" class="difflineplus">+</span>
<a href="#l86.71"></a><span id="l86.71">   // add description, mark needs action and add percent complete</span>
<a href="#l86.72"></a><span id="l86.72">   task.type(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l86.73"></a><span id="l86.73">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l86.74"></a><span id="l86.74">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l86.75"></a><span id="l86.75">     description);</span>
<a href="#l86.76"></a><span id="l86.76">   task.click(new elementslib.ID(task.window.document, &quot;todo-status-needsaction-menuitem&quot;));</span>
<a href="#l86.77"></a><span id="l86.77" class="difflineminus">-  </span>
<a href="#l86.78"></a><span id="l86.78" class="difflineplus">+</span>
<a href="#l86.79"></a><span id="l86.79">   // delete default 0 percent complete</span>
<a href="#l86.80"></a><span id="l86.80">   task.keypress(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l86.81"></a><span id="l86.81">     + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/'</span>
<a href="#l86.82"></a><span id="l86.82">     + 'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/'</span>
<a href="#l86.83"></a><span id="l86.83">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l86.84"></a><span id="l86.84">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l86.85"></a><span id="l86.85">   task.type(new elementslib.Lookup(task.window.document, taskDialog</span>
<a href="#l86.86"></a><span id="l86.86">     + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/'</span>
<a href="#l86.87"></a><span id="l86.87">     + 'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/'</span>
<a href="#l86.88"></a><span id="l86.88">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l86.89"></a><span id="l86.89">     percentComplete);</span>
<a href="#l86.90"></a><span id="l86.90" class="difflineminus">-  </span>
<a href="#l86.91"></a><span id="l86.91" class="difflineplus">+</span>
<a href="#l86.92"></a><span id="l86.92">   // save</span>
<a href="#l86.93"></a><span id="l86.93">   task.click(new elementslib.ID(task.window.document, &quot;button-save&quot;));</span>
<a href="#l86.94"></a><span id="l86.94">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0});</span>
<a href="#l86.95"></a><span id="l86.95" class="difflineminus">-  </span>
<a href="#l86.96"></a><span id="l86.96" class="difflineplus">+</span>
<a href="#l86.97"></a><span id="l86.97">   // verify description and status in details pane</span>
<a href="#l86.98"></a><span id="l86.98">   controller.assertValue(new elementslib.Lookup(controller.window.document, taskView</span>
<a href="#l86.99"></a><span id="l86.99">     + '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details-description&quot;)/'</span>
<a href="#l86.100"></a><span id="l86.100">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l86.101"></a><span id="l86.101">     description);</span>
<a href="#l86.102"></a><span id="l86.102">   let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l86.103"></a><span id="l86.103">     &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l86.104"></a><span id="l86.104">   controller.assertValue(new elementslib.ID(controller.window.document, &quot;calendar-task-details-status&quot;),</span>
<a href="#l86.105"></a><span id="l86.105">     status);</span>
<a href="#l86.106"></a><span id="l86.106" class="difflineminus">-  </span>
<a href="#l86.107"></a><span id="l86.107" class="difflineplus">+</span>
<a href="#l86.108"></a><span id="l86.108">   // set high priority and verify it in detail pane</span>
<a href="#l86.109"></a><span id="l86.109">   controller.click(new elementslib.ID(controller.window.document, &quot;task-actions-priority&quot;));</span>
<a href="#l86.110"></a><span id="l86.110">   controller.sleep(sleep);</span>
<a href="#l86.111"></a><span id="l86.111">   controller.click(new elementslib.ID(controller.window.document, &quot;priority-1-menuitem&quot;));</span>
<a href="#l86.112"></a><span id="l86.112">   controller.sleep(sleep);</span>
<a href="#l86.113"></a><span id="l86.113">   let priorityNode = new elementslib.ID(controller.window.document, &quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l86.114"></a><span id="l86.114">   controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l86.115"></a><span id="l86.115" class="difflineminus">-  </span>
<a href="#l86.116"></a><span id="l86.116" class="difflineplus">+</span>
<a href="#l86.117"></a><span id="l86.117">   // verify that tooltip shows status, priority and percent complete</span>
<a href="#l86.118"></a><span id="l86.118">   let toolTipNode = new elementslib.Lookup(controller.window.document, toolTip).getNode();</span>
<a href="#l86.119"></a><span id="l86.119">   toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l86.120"></a><span id="l86.120" class="difflineminus">-  </span>
<a href="#l86.121"></a><span id="l86.121" class="difflineplus">+</span>
<a href="#l86.122"></a><span id="l86.122">   let toolTipName = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[0]/[1]');</span>
<a href="#l86.123"></a><span id="l86.123">   let toolTipCalendar = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[1]/[1]');</span>
<a href="#l86.124"></a><span id="l86.124">   let toolTipPriority = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[2]/[1]');</span>
<a href="#l86.125"></a><span id="l86.125">   let toolTipStatus = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[3]/[1]');</span>
<a href="#l86.126"></a><span id="l86.126">   let toolTipComplete = new elementslib.Lookup(controller.window.document, toolTipGrid + '[1]/[4]/[1]');</span>
<a href="#l86.127"></a><span id="l86.127">   let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l86.128"></a><span id="l86.128">     &quot;highPriority&quot;);</span>
<a href="#l86.129"></a><span id="l86.129" class="difflineminus">-  </span>
<a href="#l86.130"></a><span id="l86.130" class="difflineplus">+</span>
<a href="#l86.131"></a><span id="l86.131">   controller.assertJSProperty(toolTipName, &quot;textContent&quot;, title);</span>
<a href="#l86.132"></a><span id="l86.132">   controller.assertJSProperty(toolTipCalendar, &quot;textContent&quot;, calendar);</span>
<a href="#l86.133"></a><span id="l86.133">   controller.assertJSProperty(toolTipPriority, &quot;textContent&quot;, priority);</span>
<a href="#l86.134"></a><span id="l86.134">   controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l86.135"></a><span id="l86.135">   controller.assertJSProperty(toolTipComplete, &quot;textContent&quot;, percentComplete + '%');</span>
<a href="#l86.136"></a><span id="l86.136" class="difflineminus">-  </span>
<a href="#l86.137"></a><span id="l86.137" class="difflineplus">+</span>
<a href="#l86.138"></a><span id="l86.138">   // mark completed, verify</span>
<a href="#l86.139"></a><span id="l86.139">   controller.click(new elementslib.ID(controller.window.document,</span>
<a href="#l86.140"></a><span id="l86.140">                                       &quot;task-actions-markcompleted&quot;));</span>
<a href="#l86.141"></a><span id="l86.141">   controller.sleep(sleep);</span>
<a href="#l86.142"></a><span id="l86.142" class="difflineminus">-  </span>
<a href="#l86.143"></a><span id="l86.143" class="difflineplus">+</span>
<a href="#l86.144"></a><span id="l86.144">   status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l86.145"></a><span id="l86.145">     &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l86.146"></a><span id="l86.146">   toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l86.147"></a><span id="l86.147">   controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l86.148"></a><span id="l86.148" class="difflineminus">-  </span>
<a href="#l86.149"></a><span id="l86.149" class="difflineplus">+</span>
<a href="#l86.150"></a><span id="l86.150">   // delete task, verify</span>
<a href="#l86.151"></a><span id="l86.151">   controller.click(new elementslib.ID(controller.window.document, &quot;task-context-menu-delete&quot;));</span>
<a href="#l86.152"></a><span id="l86.152">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-delete-task-button&quot;));</span>
<a href="#l86.153"></a><span id="l86.153">   let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l86.154"></a><span id="l86.154">   controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l86.155"></a><span id="l86.155"> }</span>
<a href="#l86.156"></a><span id="l86.156"> </span>
<a href="#l86.157"></a><span id="l86.157"> var teardownTest = function(module) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -25,52 +25,52 @@ var testWeekView = function () {</span>
<a href="#l87.4"></a><span id="l87.4">   let weekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/'</span>
<a href="#l87.5"></a><span id="l87.5">     + 'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/'</span>
<a href="#l87.6"></a><span id="l87.6">     + 'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/';</span>
<a href="#l87.7"></a><span id="l87.7">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l87.8"></a><span id="l87.8">   let eventBox = weekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/'</span>
<a href="#l87.9"></a><span id="l87.9">     + 'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/'</span>
<a href="#l87.10"></a><span id="l87.10">     + '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;'</span>
<a href="#l87.11"></a><span id="l87.11">     + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-    </span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+</span>
<a href="#l87.14"></a><span id="l87.14">   controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l87.15"></a><span id="l87.15">   controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-week-view-button&quot;));</span>
<a href="#l87.16"></a><span id="l87.16" class="difflineminus">-  </span>
<a href="#l87.17"></a><span id="l87.17" class="difflineplus">+</span>
<a href="#l87.18"></a><span id="l87.18">   // pick year</span>
<a href="#l87.19"></a><span id="l87.19">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l87.20"></a><span id="l87.20">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l87.21"></a><span id="l87.21">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l87.22"></a><span id="l87.22">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l87.23"></a><span id="l87.23">     + 'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l87.24"></a><span id="l87.24" class="difflineminus">-  </span>
<a href="#l87.25"></a><span id="l87.25" class="difflineplus">+</span>
<a href="#l87.26"></a><span id="l87.26">   // pick month</span>
<a href="#l87.27"></a><span id="l87.27">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l87.28"></a><span id="l87.28">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l87.29"></a><span id="l87.29">   controller.click(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l87.30"></a><span id="l87.30">     + 'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/'</span>
<a href="#l87.31"></a><span id="l87.31">     + 'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l87.32"></a><span id="l87.32"> </span>
<a href="#l87.33"></a><span id="l87.33">   // pick day</span>
<a href="#l87.34"></a><span id="l87.34">   controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth</span>
<a href="#l87.35"></a><span id="l87.35">     + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l87.36"></a><span id="l87.36" class="difflineminus">-  </span>
<a href="#l87.37"></a><span id="l87.37" class="difflineplus">+</span>
<a href="#l87.38"></a><span id="l87.38">   // verify date</span>
<a href="#l87.39"></a><span id="l87.39">   let day = new elementslib.Lookup(controller.window.document, weekView</span>
<a href="#l87.40"></a><span id="l87.40">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/'</span>
<a href="#l87.41"></a><span id="l87.41">     + '{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l87.42"></a><span id="l87.42">   controller.waitFor(function() {return day.getNode().mDate.icalString == &quot;20090101&quot;});</span>
<a href="#l87.43"></a><span id="l87.43"> </span>
<a href="#l87.44"></a><span id="l87.44">   // create event at 8 AM</span>
<a href="#l87.45"></a><span id="l87.45">   // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l87.46"></a><span id="l87.46">   controller.doubleClick(new elementslib.Lookup(controller.window.document, weekView</span>
<a href="#l87.47"></a><span id="l87.47">     + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/'</span>
<a href="#l87.48"></a><span id="l87.48">     + '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l87.49"></a><span id="l87.49">   controller.waitFor(function() {return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l87.50"></a><span id="l87.50">   let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l87.51"></a><span id="l87.51" class="difflineminus">-  </span>
<a href="#l87.52"></a><span id="l87.52" class="difflineplus">+</span>
<a href="#l87.53"></a><span id="l87.53">   // check that the start time is correct</span>
<a href="#l87.54"></a><span id="l87.54">   let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l87.55"></a><span id="l87.55">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l87.56"></a><span id="l87.56">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/'</span>
<a href="#l87.57"></a><span id="l87.57">     + 'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/'</span>
<a href="#l87.58"></a><span id="l87.58">     + 'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l87.59"></a><span id="l87.59">   event.waitForElement(startTimeInput);</span>
<a href="#l87.60"></a><span id="l87.60">   event.assertValue(startTimeInput, '8:00');</span>
<a href="#l87.61"></a><span id="l87.61" class="difflineat">@@ -78,53 +78,53 @@ var testWeekView = function () {</span>
<a href="#l87.62"></a><span id="l87.62">     2009, 1, 1);</span>
<a href="#l87.63"></a><span id="l87.63">   event.assertValue(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l87.64"></a><span id="l87.64">     + 'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/'</span>
<a href="#l87.65"></a><span id="l87.65">     + 'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/'</span>
<a href="#l87.66"></a><span id="l87.66">     + 'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/'</span>
<a href="#l87.67"></a><span id="l87.67">     + '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/'</span>
<a href="#l87.68"></a><span id="l87.68">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l87.69"></a><span id="l87.69">     date);</span>
<a href="#l87.70"></a><span id="l87.70" class="difflineminus">-    </span>
<a href="#l87.71"></a><span id="l87.71" class="difflineplus">+</span>
<a href="#l87.72"></a><span id="l87.72">   // fill in title, description and calendar</span>
<a href="#l87.73"></a><span id="l87.73">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l87.74"></a><span id="l87.74">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l87.75"></a><span id="l87.75">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l87.76"></a><span id="l87.76">     title1);</span>
<a href="#l87.77"></a><span id="l87.77">   event.type(new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l87.78"></a><span id="l87.78">     + 'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/'</span>
<a href="#l87.79"></a><span id="l87.79">     + 'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l87.80"></a><span id="l87.80">     desc);</span>
<a href="#l87.81"></a><span id="l87.81">   event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l87.82"></a><span id="l87.82" class="difflineminus">-  </span>
<a href="#l87.83"></a><span id="l87.83" class="difflineplus">+</span>
<a href="#l87.84"></a><span id="l87.84">   // save</span>
<a href="#l87.85"></a><span id="l87.85">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l87.86"></a><span id="l87.86" class="difflineminus">-  </span>
<a href="#l87.87"></a><span id="l87.87" class="difflineplus">+</span>
<a href="#l87.88"></a><span id="l87.88">   // if it was created successfully, it can be opened</span>
<a href="#l87.89"></a><span id="l87.89">   controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l87.90"></a><span id="l87.90">   controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l87.91"></a><span id="l87.91">   controller.waitFor(function () {return utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0}, sleep);</span>
<a href="#l87.92"></a><span id="l87.92">   event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l87.93"></a><span id="l87.93" class="difflineminus">-  </span>
<a href="#l87.94"></a><span id="l87.94" class="difflineplus">+</span>
<a href="#l87.95"></a><span id="l87.95">   // change title and save changes</span>
<a href="#l87.96"></a><span id="l87.96">   let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog</span>
<a href="#l87.97"></a><span id="l87.97">     + 'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/'</span>
<a href="#l87.98"></a><span id="l87.98">     + 'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l87.99"></a><span id="l87.99">   event.waitForElement(titleTextBox);</span>
<a href="#l87.100"></a><span id="l87.100">   event.type(titleTextBox, title2);</span>
<a href="#l87.101"></a><span id="l87.101">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l87.102"></a><span id="l87.102" class="difflineminus">-  </span>
<a href="#l87.103"></a><span id="l87.103" class="difflineplus">+</span>
<a href="#l87.104"></a><span id="l87.104">   // check if name was saved</span>
<a href="#l87.105"></a><span id="l87.105">   let eventName = new elementslib.Lookup(controller.window.document, eventBox</span>
<a href="#l87.106"></a><span id="l87.106">     + '/anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/'</span>
<a href="#l87.107"></a><span id="l87.107">     + 'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/'</span>
<a href="#l87.108"></a><span id="l87.108">     + 'anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l87.109"></a><span id="l87.109">   controller.waitForElement(eventName);</span>
<a href="#l87.110"></a><span id="l87.110">   controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l87.111"></a><span id="l87.111" class="difflineminus">-  </span>
<a href="#l87.112"></a><span id="l87.112" class="difflineplus">+</span>
<a href="#l87.113"></a><span id="l87.113">   // delete event</span>
<a href="#l87.114"></a><span id="l87.114">   controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l87.115"></a><span id="l87.115">   controller.keypress(new elementslib.ID(controller.window.document, &quot;week-view&quot;),</span>
<a href="#l87.116"></a><span id="l87.116">     &quot;VK_DELETE&quot;, {});</span>
<a href="#l87.117"></a><span id="l87.117">   controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l87.118"></a><span id="l87.118"> }</span>
<a href="#l87.119"></a><span id="l87.119"> </span>
<a href="#l87.120"></a><span id="l87.120"> var teardownTest = function(module) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/calendar/test/unit/test_calutils.js</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/calendar/test/unit/test_calutils.js</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -55,17 +55,17 @@ function getAttendeeEmail_test() {</span>
<a href="#l88.4"></a><span id="l88.4">         if (test.input.cn) {</span>
<a href="#l88.5"></a><span id="l88.5">             attendee.commonName = test.input.cn;</span>
<a href="#l88.6"></a><span id="l88.6">         }</span>
<a href="#l88.7"></a><span id="l88.7">         if (test.input.email) {</span>
<a href="#l88.8"></a><span id="l88.8">             attendee.setProperty(&quot;EMAIL&quot;, test.input.email);</span>
<a href="#l88.9"></a><span id="l88.9">         }</span>
<a href="#l88.10"></a><span id="l88.10">         equal(cal.getAttendeeEmail(attendee, test.input.useCn), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l88.11"></a><span id="l88.11">     }</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-};</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineplus">+}</span>
<a href="#l88.14"></a><span id="l88.14"> </span>
<a href="#l88.15"></a><span id="l88.15"> function getRecipientList_test() {</span>
<a href="#l88.16"></a><span id="l88.16">     let data = [{</span>
<a href="#l88.17"></a><span id="l88.17">         input: [{id: &quot;mailto:first@example.net&quot;, cn: null},</span>
<a href="#l88.18"></a><span id="l88.18">                 {id: &quot;mailto:second@example.net&quot;, cn: null},</span>
<a href="#l88.19"></a><span id="l88.19">                 {id: &quot;mailto:third@example.net&quot;, cn: null}],</span>
<a href="#l88.20"></a><span id="l88.20">         expected: &quot;first@example.net, second@example.net, third@example.net&quot;</span>
<a href="#l88.21"></a><span id="l88.21">     }, {</span>
<a href="#l88.22"></a><span id="l88.22" class="difflineat">@@ -101,41 +101,41 @@ function getRecipientList_test() {</span>
<a href="#l88.23"></a><span id="l88.23">             attendee.id = att.id;</span>
<a href="#l88.24"></a><span id="l88.24">             if (att.cn) {</span>
<a href="#l88.25"></a><span id="l88.25">                 attendee.commonName = att.cn;</span>
<a href="#l88.26"></a><span id="l88.26">             }</span>
<a href="#l88.27"></a><span id="l88.27">             attendees.push(attendee);</span>
<a href="#l88.28"></a><span id="l88.28">         }</span>
<a href="#l88.29"></a><span id="l88.29">         equal(cal.getRecipientList(attendees), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l88.30"></a><span id="l88.30">     }</span>
<a href="#l88.31"></a><span id="l88.31" class="difflineminus">-};</span>
<a href="#l88.32"></a><span id="l88.32" class="difflineplus">+}</span>
<a href="#l88.33"></a><span id="l88.33"> </span>
<a href="#l88.34"></a><span id="l88.34"> function prependMailTo_test() {</span>
<a href="#l88.35"></a><span id="l88.35">     let data = [{input: &quot;mailto:first.last@example.net&quot;, expected: &quot;mailto:first.last@example.net&quot;},</span>
<a href="#l88.36"></a><span id="l88.36">                 {input: &quot;MAILTO:first.last@example.net&quot;, expected: &quot;mailto:first.last@example.net&quot;},</span>
<a href="#l88.37"></a><span id="l88.37">                 {input: &quot;first.last@example.net&quot;, expected: &quot;mailto:first.last@example.net&quot;},</span>
<a href="#l88.38"></a><span id="l88.38">                 {input: &quot;first.last.example.net&quot;, expected: &quot;first.last.example.net&quot;}];</span>
<a href="#l88.39"></a><span id="l88.39">     let i = 0;</span>
<a href="#l88.40"></a><span id="l88.40">     for (let test of data) {</span>
<a href="#l88.41"></a><span id="l88.41">         i++;</span>
<a href="#l88.42"></a><span id="l88.42">         equal(cal.prependMailTo(test.input), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l88.43"></a><span id="l88.43">     }</span>
<a href="#l88.44"></a><span id="l88.44" class="difflineminus">-};</span>
<a href="#l88.45"></a><span id="l88.45" class="difflineplus">+}</span>
<a href="#l88.46"></a><span id="l88.46"> </span>
<a href="#l88.47"></a><span id="l88.47"> function removeMailTo_test() {</span>
<a href="#l88.48"></a><span id="l88.48">     let data = [{input: &quot;mailto:first.last@example.net&quot;, expected: &quot;first.last@example.net&quot;},</span>
<a href="#l88.49"></a><span id="l88.49">                 {input: &quot;MAILTO:first.last@example.net&quot;, expected: &quot;first.last@example.net&quot;},</span>
<a href="#l88.50"></a><span id="l88.50">                 {input: &quot;first.last@example.net&quot;, expected: &quot;first.last@example.net&quot;},</span>
<a href="#l88.51"></a><span id="l88.51">                 {input: &quot;first.last.example.net&quot;, expected: &quot;first.last.example.net&quot;}];</span>
<a href="#l88.52"></a><span id="l88.52">     let i = 0;</span>
<a href="#l88.53"></a><span id="l88.53">     for (let test of data) {</span>
<a href="#l88.54"></a><span id="l88.54">         i++;</span>
<a href="#l88.55"></a><span id="l88.55">         equal(cal.removeMailTo(test.input), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l88.56"></a><span id="l88.56">     }</span>
<a href="#l88.57"></a><span id="l88.57" class="difflineminus">-};</span>
<a href="#l88.58"></a><span id="l88.58" class="difflineplus">+}</span>
<a href="#l88.59"></a><span id="l88.59"> </span>
<a href="#l88.60"></a><span id="l88.60"> function resolveDelegation_test() {</span>
<a href="#l88.61"></a><span id="l88.61">     let data = [{</span>
<a href="#l88.62"></a><span id="l88.62">         input: {</span>
<a href="#l88.63"></a><span id="l88.63">             attendee:</span>
<a href="#l88.64"></a><span id="l88.64">                 'ATTENDEE;DELEGATED-FROM=&quot;mailto:attendee2@example.net&quot;;CN=&quot;Attendee 1&quot;:mailto:at' +</span>
<a href="#l88.65"></a><span id="l88.65">                 'tendee1@example.net',</span>
<a href="#l88.66"></a><span id="l88.66">             attendees: [</span>
<a href="#l88.67"></a><span id="l88.67" class="difflineat">@@ -271,9 +271,9 @@ function validateRecipientList_test() {</span>
<a href="#l88.68"></a><span id="l88.68">                   &quot;le.net&gt;, \&quot;last3, first3\&quot; &lt;first3.last2@example.net&gt;&quot;</span>
<a href="#l88.69"></a><span id="l88.69">     }];</span>
<a href="#l88.70"></a><span id="l88.70">     let i = 0;</span>
<a href="#l88.71"></a><span id="l88.71">     for (let test of data) {</span>
<a href="#l88.72"></a><span id="l88.72">         i++;</span>
<a href="#l88.73"></a><span id="l88.73">         equal(cal.validateRecipientList(test.input), test.expected,</span>
<a href="#l88.74"></a><span id="l88.74">               &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l88.75"></a><span id="l88.75">     }</span>
<a href="#l88.76"></a><span id="l88.76" class="difflineminus">-};</span>
<a href="#l88.77"></a><span id="l88.77" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/calendar/test/unit/test_datetime_before_1970.js</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/calendar/test/unit/test_datetime_before_1970.js</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -1,32 +1,32 @@</span>
<a href="#l89.4"></a><span id="l89.4" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l89.5"></a><span id="l89.5" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l89.6"></a><span id="l89.6" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l89.7"></a><span id="l89.7" class="difflineminus">-</span>
<a href="#l89.8"></a><span id="l89.8" class="difflineminus">-function run_test() {</span>
<a href="#l89.9"></a><span id="l89.9" class="difflineminus">-</span>
<a href="#l89.10"></a><span id="l89.10" class="difflineminus">-    // Bug 769938 - dates before 1970 are not handled correctly</span>
<a href="#l89.11"></a><span id="l89.11" class="difflineminus">-    // due to signed vs. unsigned mismatch in PRTime in xpconnect</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineminus">-    let dateTime1950 = cal.createDateTime();</span>
<a href="#l89.14"></a><span id="l89.14" class="difflineminus">-    dateTime1950.year = 1950;</span>
<a href="#l89.15"></a><span id="l89.15" class="difflineminus">-    equal(dateTime1950.year, 1950);</span>
<a href="#l89.16"></a><span id="l89.16" class="difflineminus">-</span>
<a href="#l89.17"></a><span id="l89.17" class="difflineminus">-    let dateTime1955 = cal.jsDateToDateTime(new Date(1955, 06, 15));</span>
<a href="#l89.18"></a><span id="l89.18" class="difflineminus">-    equal(dateTime1955.year, 1955);</span>
<a href="#l89.19"></a><span id="l89.19" class="difflineminus">-    </span>
<a href="#l89.20"></a><span id="l89.20" class="difflineminus">-    let dateTime1965 = cal.createDateTime();</span>
<a href="#l89.21"></a><span id="l89.21" class="difflineminus">-    dateTime1965.nativeTime = -150000000000000;</span>
<a href="#l89.22"></a><span id="l89.22" class="difflineminus">-    equal(dateTime1965.year, 1965);</span>
<a href="#l89.23"></a><span id="l89.23" class="difflineminus">-    equal(dateTime1965.nativeTime, -150000000000000);</span>
<a href="#l89.24"></a><span id="l89.24" class="difflineminus">-</span>
<a href="#l89.25"></a><span id="l89.25" class="difflineminus">-    let dateTime1990 = cal.createDateTime();</span>
<a href="#l89.26"></a><span id="l89.26" class="difflineminus">-    dateTime1990.year = 1990;</span>
<a href="#l89.27"></a><span id="l89.27" class="difflineminus">-</span>
<a href="#l89.28"></a><span id="l89.28" class="difflineminus">-    let dateTime2050 = cal.createDateTime();</span>
<a href="#l89.29"></a><span id="l89.29" class="difflineminus">-    dateTime2050.year = 2050;</span>
<a href="#l89.30"></a><span id="l89.30" class="difflineminus">-</span>
<a href="#l89.31"></a><span id="l89.31" class="difflineminus">-    ok(dateTime1950.nativeTime &lt; dateTime1955.nativeTime);</span>
<a href="#l89.32"></a><span id="l89.32" class="difflineminus">-    ok(dateTime1955.nativeTime &lt; dateTime1965.nativeTime);</span>
<a href="#l89.33"></a><span id="l89.33" class="difflineminus">-    ok(dateTime1965.nativeTime &lt; dateTime1990.nativeTime);</span>
<a href="#l89.34"></a><span id="l89.34" class="difflineminus">-    ok(dateTime1990.nativeTime &lt; dateTime2050.nativeTime);</span>
<a href="#l89.35"></a><span id="l89.35" class="difflineminus">-}</span>
<a href="#l89.36"></a><span id="l89.36" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l89.37"></a><span id="l89.37" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l89.38"></a><span id="l89.38" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l89.39"></a><span id="l89.39" class="difflineplus">+</span>
<a href="#l89.40"></a><span id="l89.40" class="difflineplus">+function run_test() {</span>
<a href="#l89.41"></a><span id="l89.41" class="difflineplus">+</span>
<a href="#l89.42"></a><span id="l89.42" class="difflineplus">+    // Bug 769938 - dates before 1970 are not handled correctly</span>
<a href="#l89.43"></a><span id="l89.43" class="difflineplus">+    // due to signed vs. unsigned mismatch in PRTime in xpconnect</span>
<a href="#l89.44"></a><span id="l89.44" class="difflineplus">+</span>
<a href="#l89.45"></a><span id="l89.45" class="difflineplus">+    let dateTime1950 = cal.createDateTime();</span>
<a href="#l89.46"></a><span id="l89.46" class="difflineplus">+    dateTime1950.year = 1950;</span>
<a href="#l89.47"></a><span id="l89.47" class="difflineplus">+    equal(dateTime1950.year, 1950);</span>
<a href="#l89.48"></a><span id="l89.48" class="difflineplus">+</span>
<a href="#l89.49"></a><span id="l89.49" class="difflineplus">+    let dateTime1955 = cal.jsDateToDateTime(new Date(1955, 6, 15));</span>
<a href="#l89.50"></a><span id="l89.50" class="difflineplus">+    equal(dateTime1955.year, 1955);</span>
<a href="#l89.51"></a><span id="l89.51" class="difflineplus">+</span>
<a href="#l89.52"></a><span id="l89.52" class="difflineplus">+    let dateTime1965 = cal.createDateTime();</span>
<a href="#l89.53"></a><span id="l89.53" class="difflineplus">+    dateTime1965.nativeTime = -150000000000000;</span>
<a href="#l89.54"></a><span id="l89.54" class="difflineplus">+    equal(dateTime1965.year, 1965);</span>
<a href="#l89.55"></a><span id="l89.55" class="difflineplus">+    equal(dateTime1965.nativeTime, -150000000000000);</span>
<a href="#l89.56"></a><span id="l89.56" class="difflineplus">+</span>
<a href="#l89.57"></a><span id="l89.57" class="difflineplus">+    let dateTime1990 = cal.createDateTime();</span>
<a href="#l89.58"></a><span id="l89.58" class="difflineplus">+    dateTime1990.year = 1990;</span>
<a href="#l89.59"></a><span id="l89.59" class="difflineplus">+</span>
<a href="#l89.60"></a><span id="l89.60" class="difflineplus">+    let dateTime2050 = cal.createDateTime();</span>
<a href="#l89.61"></a><span id="l89.61" class="difflineplus">+    dateTime2050.year = 2050;</span>
<a href="#l89.62"></a><span id="l89.62" class="difflineplus">+</span>
<a href="#l89.63"></a><span id="l89.63" class="difflineplus">+    ok(dateTime1950.nativeTime &lt; dateTime1955.nativeTime);</span>
<a href="#l89.64"></a><span id="l89.64" class="difflineplus">+    ok(dateTime1955.nativeTime &lt; dateTime1965.nativeTime);</span>
<a href="#l89.65"></a><span id="l89.65" class="difflineplus">+    ok(dateTime1965.nativeTime &lt; dateTime1990.nativeTime);</span>
<a href="#l89.66"></a><span id="l89.66" class="difflineplus">+    ok(dateTime1990.nativeTime &lt; dateTime2050.nativeTime);</span>
<a href="#l89.67"></a><span id="l89.67" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/calendar/test/unit/test_deleted_items.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/calendar/test/unit/test_deleted_items.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -13,17 +13,17 @@ function check_delmgr_call(aFunc) {</span>
<a href="#l90.4"></a><span id="l90.4">     let delmgr = Components.classes[&quot;@mozilla.org/calendar/deleted-items-manager;1&quot;]</span>
<a href="#l90.5"></a><span id="l90.5">                            .getService(Components.interfaces.calIDeletedItems);</span>
<a href="#l90.6"></a><span id="l90.6">     return new Promise(function(resolve, reject) {</span>
<a href="#l90.7"></a><span id="l90.7">         delmgr.wrappedJSObject.completedNotifier.handleCompletion = (aReason) =&gt; {</span>
<a href="#l90.8"></a><span id="l90.8">             if (aReason == mISSC.REASON_FINISHED) {</span>
<a href="#l90.9"></a><span id="l90.9">                 resolve();</span>
<a href="#l90.10"></a><span id="l90.10">             } else {</span>
<a href="#l90.11"></a><span id="l90.11">                 reject(aReason);</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-            };</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineplus">+            }</span>
<a href="#l90.14"></a><span id="l90.14">         };</span>
<a href="#l90.15"></a><span id="l90.15">         aFunc();</span>
<a href="#l90.16"></a><span id="l90.16">     });</span>
<a href="#l90.17"></a><span id="l90.17"> }</span>
<a href="#l90.18"></a><span id="l90.18"> </span>
<a href="#l90.19"></a><span id="l90.19"> add_task(function* test_deleted_items() {</span>
<a href="#l90.20"></a><span id="l90.20">     let calmgr = cal.getCalendarManager();</span>
<a href="#l90.21"></a><span id="l90.21">     let delmgr = Components.classes[&quot;@mozilla.org/calendar/deleted-items-manager;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -231,16 +231,17 @@ GDataServer.prototype = {</span>
<a href="#l91.4"></a><span id="l91.4">                 body = JSON.parse(NetUtil.readInputStreamToString(request.bodyInputStream,</span>
<a href="#l91.5"></a><span id="l91.5">                                   request.bodyInputStream.available()));</span>
<a href="#l91.6"></a><span id="l91.6">             } catch (e) {}</span>
<a href="#l91.7"></a><span id="l91.7"> </span>
<a href="#l91.8"></a><span id="l91.8">             this.lastMethod = method;</span>
<a href="#l91.9"></a><span id="l91.9">             return nextHandler(request, response, method, parameters, body);</span>
<a href="#l91.10"></a><span id="l91.10">         } catch (e) {</span>
<a href="#l91.11"></a><span id="l91.11">             do_print(&quot;Server Error: &quot; + e.fileName + &quot;:&quot; + e.lineNumber + &quot;: &quot; + e + &quot;\n&quot;);</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineplus">+            return null;</span>
<a href="#l91.13"></a><span id="l91.13">         }</span>
<a href="#l91.14"></a><span id="l91.14">     },</span>
<a href="#l91.15"></a><span id="l91.15"> </span>
<a href="#l91.16"></a><span id="l91.16">     calendarListRequest: function(request, response, method, parameters, body) {</span>
<a href="#l91.17"></a><span id="l91.17">         let data = this.calendarListData;</span>
<a href="#l91.18"></a><span id="l91.18">         response.write(JSON.stringify(data));</span>
<a href="#l91.19"></a><span id="l91.19">     },</span>
<a href="#l91.20"></a><span id="l91.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l92.4"></a><span id="l92.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l92.5"></a><span id="l92.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l92.6"></a><span id="l92.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l92.7"></a><span id="l92.7"> </span>
<a href="#l92.8"></a><span id="l92.8"> var icalStringArray = [</span>
<a href="#l92.9"></a><span id="l92.9">                 // Comments refer to the range defined in testGetItems().</span>
<a href="#l92.10"></a><span id="l92.10">                 // 1: one-hour event</span>
<a href="#l92.11"></a><span id="l92.11" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.12"></a><span id="l92.12" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.13"></a><span id="l92.13">                 &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l92.14"></a><span id="l92.14">                 &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l92.15"></a><span id="l92.15">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.16"></a><span id="l92.16">                 // 2: Test a zero-length event with DTSTART and DTEND</span>
<a href="#l92.17"></a><span id="l92.17">                 &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.18"></a><span id="l92.18">                 &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l92.19"></a><span id="l92.19">                 &quot;DTEND:20020402T000000Z\n&quot; +</span>
<a href="#l92.20"></a><span id="l92.20">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.21"></a><span id="l92.21" class="difflineat">@@ -18,76 +18,76 @@ var icalStringArray = [</span>
<a href="#l92.22"></a><span id="l92.22">                 &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.23"></a><span id="l92.23">                 &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l92.24"></a><span id="l92.24">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.25"></a><span id="l92.25">                 // 4: Test a zero-length event with DTEND set and no  DTSTART. Invalid!</span>
<a href="#l92.26"></a><span id="l92.26">                 &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.27"></a><span id="l92.27">                 &quot;DTEND:20020402T000000Z\n&quot; +</span>
<a href="#l92.28"></a><span id="l92.28">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.29"></a><span id="l92.29">                 // 5: one-hour event that is outside the range</span>
<a href="#l92.30"></a><span id="l92.30" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.31"></a><span id="l92.31" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.32"></a><span id="l92.32">                 &quot;DTSTART:20020401T114500Z\n&quot; +</span>
<a href="#l92.33"></a><span id="l92.33">                 &quot;DTEND:20020401T124500Z\n&quot; +</span>
<a href="#l92.34"></a><span id="l92.34">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.35"></a><span id="l92.35">                 // 6: one-hour event that starts outside the range and ends inside.</span>
<a href="#l92.36"></a><span id="l92.36" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.37"></a><span id="l92.37" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.38"></a><span id="l92.38">                 &quot;DTSTART:20020401T114500Z\n&quot; +</span>
<a href="#l92.39"></a><span id="l92.39">                 &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l92.40"></a><span id="l92.40">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.41"></a><span id="l92.41">                 // 7:  one-hour event that starts inside the range and ends outside.</span>
<a href="#l92.42"></a><span id="l92.42" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.43"></a><span id="l92.43" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.44"></a><span id="l92.44">                 &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l92.45"></a><span id="l92.45">                 &quot;DTEND:20020403T124500Z\n&quot; +</span>
<a href="#l92.46"></a><span id="l92.46">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.47"></a><span id="l92.47">                 // 8: one-hour event that starts at the end of the range.</span>
<a href="#l92.48"></a><span id="l92.48" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.49"></a><span id="l92.49" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.50"></a><span id="l92.50">                 &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l92.51"></a><span id="l92.51">                 &quot;DTEND:20020403T124500Z\n&quot; +</span>
<a href="#l92.52"></a><span id="l92.52">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.53"></a><span id="l92.53">                 // 9: allday event that starts at start of range and ends at end of range.</span>
<a href="#l92.54"></a><span id="l92.54" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.55"></a><span id="l92.55" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.56"></a><span id="l92.56">                 &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l92.57"></a><span id="l92.57">                 &quot;DTEND;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l92.58"></a><span id="l92.58">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.59"></a><span id="l92.59">                 // 10: allday event that starts at end of range.</span>
<a href="#l92.60"></a><span id="l92.60" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.61"></a><span id="l92.61" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.62"></a><span id="l92.62">                 &quot;DTSTART;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l92.63"></a><span id="l92.63">                 &quot;DTEND;VALUE=DATE:20020404\n&quot; +</span>
<a href="#l92.64"></a><span id="l92.64">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.65"></a><span id="l92.65">                 // 11: allday event that ends at start of range. See bug 333363.</span>
<a href="#l92.66"></a><span id="l92.66" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.67"></a><span id="l92.67" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.68"></a><span id="l92.68">                 &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l92.69"></a><span id="l92.69">                 &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l92.70"></a><span id="l92.70">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.71"></a><span id="l92.71">                 // 12: daily recurring allday event. parent item in the range.</span>
<a href="#l92.72"></a><span id="l92.72" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.73"></a><span id="l92.73" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.74"></a><span id="l92.74">                 &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l92.75"></a><span id="l92.75">                 &quot;DTEND;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l92.76"></a><span id="l92.76">                 &quot;RRULE:FREQ=DAILY;INTERVAL=1;COUNT=10\n&quot; +</span>
<a href="#l92.77"></a><span id="l92.77">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.78"></a><span id="l92.78">                 // 13: daily recurring allday event. First occurence in the range.</span>
<a href="#l92.79"></a><span id="l92.79" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.80"></a><span id="l92.80" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.81"></a><span id="l92.81">                 &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l92.82"></a><span id="l92.82">                 &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l92.83"></a><span id="l92.83">                 &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l92.84"></a><span id="l92.84">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.85"></a><span id="l92.85">                 // 14: two-daily recurring allday event. Not in the range.</span>
<a href="#l92.86"></a><span id="l92.86" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.87"></a><span id="l92.87" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.88"></a><span id="l92.88">                 &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l92.89"></a><span id="l92.89">                 &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l92.90"></a><span id="l92.90">                 &quot;RRULE:FREQ=DAILY;INTERVAL=2;COUNT=10\n&quot; +</span>
<a href="#l92.91"></a><span id="l92.91">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.92"></a><span id="l92.92">                 // 15: daily recurring one-hour event. Parent in the range.</span>
<a href="#l92.93"></a><span id="l92.93" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.94"></a><span id="l92.94" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.95"></a><span id="l92.95">                 &quot;DTSTART:20020402T100000Z\n&quot; +</span>
<a href="#l92.96"></a><span id="l92.96">                 &quot;DTEND:20020402T110000Z\n&quot; +</span>
<a href="#l92.97"></a><span id="l92.97">                 &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l92.98"></a><span id="l92.98">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.99"></a><span id="l92.99">                 // 16: daily recurring one-hour event. Occurrence in the range.</span>
<a href="#l92.100"></a><span id="l92.100" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.101"></a><span id="l92.101" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.102"></a><span id="l92.102">                 &quot;DTSTART:20020401T100000Z\n&quot; +</span>
<a href="#l92.103"></a><span id="l92.103">                 &quot;DTEND:20020401T110000Z\n&quot; +</span>
<a href="#l92.104"></a><span id="l92.104">                 &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l92.105"></a><span id="l92.105">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.106"></a><span id="l92.106">                 // 17: zero-length task with DTSTART and DUE set at start of range.</span>
<a href="#l92.107"></a><span id="l92.107">                 &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l92.108"></a><span id="l92.108">                 &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l92.109"></a><span id="l92.109">                 &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l92.110"></a><span id="l92.110" class="difflineat">@@ -111,23 +111,23 @@ var icalStringArray = [</span>
<a href="#l92.111"></a><span id="l92.111">                 &quot;DUE:20020403T010000Z\n&quot; +</span>
<a href="#l92.112"></a><span id="l92.112">                 &quot;END:VTODO\n&quot;,</span>
<a href="#l92.113"></a><span id="l92.113">                 // 22: one-hour todo that ends at start of range.</span>
<a href="#l92.114"></a><span id="l92.114">                 &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l92.115"></a><span id="l92.115">                 &quot;DTSTART:20020401T230000Z\n&quot; +</span>
<a href="#l92.116"></a><span id="l92.116">                 &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l92.117"></a><span id="l92.117">                 &quot;END:VTODO\n&quot;,</span>
<a href="#l92.118"></a><span id="l92.118">                 // 23: daily recurring one-hour event. Parent in the range.</span>
<a href="#l92.119"></a><span id="l92.119" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.120"></a><span id="l92.120" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.121"></a><span id="l92.121">                 &quot;DTSTART:20020402T000000\n&quot; +</span>
<a href="#l92.122"></a><span id="l92.122">                 &quot;DTEND:20020402T010000\n&quot; +</span>
<a href="#l92.123"></a><span id="l92.123">                 &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l92.124"></a><span id="l92.124">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.125"></a><span id="l92.125">                 // 24: daily recurring 24-hour event. Parent in the range.</span>
<a href="#l92.126"></a><span id="l92.126" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.127"></a><span id="l92.127" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.128"></a><span id="l92.128">                 &quot;DTSTART:20020402T000000\n&quot; +</span>
<a href="#l92.129"></a><span id="l92.129">                 &quot;DTEND:20020403T000000\n&quot; +</span>
<a href="#l92.130"></a><span id="l92.130">                 &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l92.131"></a><span id="l92.131">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.132"></a><span id="l92.132">                 // 25: todo that has neither start nor due date set.</span>
<a href="#l92.133"></a><span id="l92.133">                 // Should be returned on every getItems() call. See bug 405459.</span>
<a href="#l92.134"></a><span id="l92.134">                 &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l92.135"></a><span id="l92.135">                 &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l92.136"></a><span id="l92.136" class="difflineat">@@ -152,47 +152,47 @@ var icalStringArray = [</span>
<a href="#l92.137"></a><span id="l92.137">                 &quot;END:VTODO\n&quot;,</span>
<a href="#l92.138"></a><span id="l92.138">                 // 29: todo that has neither start nor due date set,</span>
<a href="#l92.139"></a><span id="l92.139">                 // has the status &quot;COMPLETED&quot; but no completion time. See bug 405459.</span>
<a href="#l92.140"></a><span id="l92.140">                 &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l92.141"></a><span id="l92.141">                 &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l92.142"></a><span id="l92.142">                 &quot;STATUS:COMPLETED\n&quot; +</span>
<a href="#l92.143"></a><span id="l92.143">                 &quot;END:VTODO\n&quot;,</span>
<a href="#l92.144"></a><span id="l92.144">                 // 30: one-hour event with duration (in the range). See bug 390492.</span>
<a href="#l92.145"></a><span id="l92.145" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.146"></a><span id="l92.146" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.147"></a><span id="l92.147">                 &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l92.148"></a><span id="l92.148">                 &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l92.149"></a><span id="l92.149">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.150"></a><span id="l92.150">                 // 31: one-hour event with duration (after the range). See bug 390492.</span>
<a href="#l92.151"></a><span id="l92.151" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.152"></a><span id="l92.152" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.153"></a><span id="l92.153">                 &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l92.154"></a><span id="l92.154">                 &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l92.155"></a><span id="l92.155">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.156"></a><span id="l92.156">                 // 32: one-hour event with duration (before the range). See bug 390492.</span>
<a href="#l92.157"></a><span id="l92.157" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.158"></a><span id="l92.158" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.159"></a><span id="l92.159">                 &quot;DTSTART:20020401T230000Z\n&quot; +</span>
<a href="#l92.160"></a><span id="l92.160">                 &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l92.161"></a><span id="l92.161">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.162"></a><span id="l92.162">                 // 33: one-day event with duration. Starts in the range, Ends outside. See bug 390492.</span>
<a href="#l92.163"></a><span id="l92.163" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.164"></a><span id="l92.164" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.165"></a><span id="l92.165">                 &quot;DTSTART:20020402T120000Z\n&quot; +</span>
<a href="#l92.166"></a><span id="l92.166">                 &quot;DURATION:P1D\n&quot; +</span>
<a href="#l92.167"></a><span id="l92.167">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.168"></a><span id="l92.168">                 // 34: one-day event with duration. Starts before the range. Ends inside. See bug 390492.</span>
<a href="#l92.169"></a><span id="l92.169" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.170"></a><span id="l92.170" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.171"></a><span id="l92.171">                 &quot;DTSTART:20020401T120000Z\n&quot; +</span>
<a href="#l92.172"></a><span id="l92.172">                 &quot;DURATION:P1D\n&quot; +</span>
<a href="#l92.173"></a><span id="l92.173">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.174"></a><span id="l92.174">                 // 35: one-day event with duration (before the range). See bug 390492.</span>
<a href="#l92.175"></a><span id="l92.175" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.176"></a><span id="l92.176" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.177"></a><span id="l92.177">                 &quot;DTSTART:20020401T000000Z\n&quot; +</span>
<a href="#l92.178"></a><span id="l92.178">                 &quot;DURATION:P1D\n&quot; +</span>
<a href="#l92.179"></a><span id="l92.179">                 &quot;END:VEVENT\n&quot;,</span>
<a href="#l92.180"></a><span id="l92.180">                 // 36: one-day event with duration (after the range). See bug 390492.</span>
<a href="#l92.181"></a><span id="l92.181" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; + </span>
<a href="#l92.182"></a><span id="l92.182" class="difflineplus">+                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l92.183"></a><span id="l92.183">                 &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l92.184"></a><span id="l92.184">                 &quot;DURATION:P1D\n&quot; +</span>
<a href="#l92.185"></a><span id="l92.185">                 &quot;END:VEVENT\n&quot;</span>
<a href="#l92.186"></a><span id="l92.186">                 ];</span>
<a href="#l92.187"></a><span id="l92.187"> </span>
<a href="#l92.188"></a><span id="l92.188"> function run_test() {</span>
<a href="#l92.189"></a><span id="l92.189">     // First entry is test number, second item is expected result for testGetItems().</span>
<a href="#l92.190"></a><span id="l92.190">     var wantedArray = [[ 1, 1],</span>
<a href="#l92.191"></a><span id="l92.191" class="difflineat">@@ -226,25 +226,26 @@ function run_test() {</span>
<a href="#l92.192"></a><span id="l92.192">                        [ 30, 1],</span>
<a href="#l92.193"></a><span id="l92.193">                        [ 31, 0],</span>
<a href="#l92.194"></a><span id="l92.194">                        [ 32, 0],</span>
<a href="#l92.195"></a><span id="l92.195">                        [ 33, 1],</span>
<a href="#l92.196"></a><span id="l92.196">                        [ 34, 1],</span>
<a href="#l92.197"></a><span id="l92.197">                        [ 35, 0],</span>
<a href="#l92.198"></a><span id="l92.198">                        [ 36, 0]];</span>
<a href="#l92.199"></a><span id="l92.199"> </span>
<a href="#l92.200"></a><span id="l92.200" class="difflineminus">-    for (var i = 0; i &lt; wantedArray.length; i++) {</span>
<a href="#l92.201"></a><span id="l92.201" class="difflineminus">-        var itemArray = wantedArray[i];</span>
<a href="#l92.202"></a><span id="l92.202" class="difflineplus">+    for (let i = 0; i &lt; wantedArray.length; i++) {</span>
<a href="#l92.203"></a><span id="l92.203" class="difflineplus">+        let itemArray = wantedArray[i];</span>
<a href="#l92.204"></a><span id="l92.204">         // Correct for 1 to stay in synch with test numbers.</span>
<a href="#l92.205"></a><span id="l92.205" class="difflineminus">-        var calItem = icalStringArray[itemArray[0] - 1];</span>
<a href="#l92.206"></a><span id="l92.206" class="difflineplus">+        let calItem = icalStringArray[itemArray[0] - 1];</span>
<a href="#l92.207"></a><span id="l92.207"> </span>
<a href="#l92.208"></a><span id="l92.208" class="difflineplus">+        let item;</span>
<a href="#l92.209"></a><span id="l92.209">         if (calItem.search(/VEVENT/) != -1) {</span>
<a href="#l92.210"></a><span id="l92.210" class="difflineminus">-            var item = createEventFromIcalString(calItem);</span>
<a href="#l92.211"></a><span id="l92.211" class="difflineplus">+            item = createEventFromIcalString(calItem);</span>
<a href="#l92.212"></a><span id="l92.212">         } else if (calItem.search(/VTODO/) != -1) {</span>
<a href="#l92.213"></a><span id="l92.213" class="difflineminus">-            var item = createTodoFromIcalString(calItem);</span>
<a href="#l92.214"></a><span id="l92.214" class="difflineplus">+            item = createTodoFromIcalString(calItem);</span>
<a href="#l92.215"></a><span id="l92.215">         }</span>
<a href="#l92.216"></a><span id="l92.216"> </span>
<a href="#l92.217"></a><span id="l92.217">         print(&quot;Test &quot; + wantedArray[i][0]);</span>
<a href="#l92.218"></a><span id="l92.218">         testGetItems(item, itemArray[1]);</span>
<a href="#l92.219"></a><span id="l92.219">         testGetItem(item);</span>
<a href="#l92.220"></a><span id="l92.220">     }</span>
<a href="#l92.221"></a><span id="l92.221"> </span>
<a href="#l92.222"></a><span id="l92.222">    /**</span>
<a href="#l92.223"></a><span id="l92.223" class="difflineat">@@ -262,17 +263,17 @@ function run_test() {</span>
<a href="#l92.224"></a><span id="l92.224"> </span>
<a href="#l92.225"></a><span id="l92.225">     function checkCalendar(calendar, aItem, aResult) {</span>
<a href="#l92.226"></a><span id="l92.226">         // construct range</span>
<a href="#l92.227"></a><span id="l92.227">         var rangeStart = createDate(2002, 3, 2); // 3 = April</span>
<a href="#l92.228"></a><span id="l92.228">         var rangeEnd = rangeStart.clone();</span>
<a href="#l92.229"></a><span id="l92.229">         rangeEnd.day += 1;</span>
<a href="#l92.230"></a><span id="l92.230"> </span>
<a href="#l92.231"></a><span id="l92.231">         // filter options</span>
<a href="#l92.232"></a><span id="l92.232" class="difflineminus">-        var filter = Ci.calICalendar.ITEM_FILTER_TYPE_ALL | </span>
<a href="#l92.233"></a><span id="l92.233" class="difflineplus">+        var filter = Ci.calICalendar.ITEM_FILTER_TYPE_ALL |</span>
<a href="#l92.234"></a><span id="l92.234">                      Ci.calICalendar.ITEM_FILTER_CLASS_OCCURRENCES |</span>
<a href="#l92.235"></a><span id="l92.235">                      Ci.calICalendar.ITEM_FILTER_COMPLETED_ALL;</span>
<a href="#l92.236"></a><span id="l92.236"> </span>
<a href="#l92.237"></a><span id="l92.237">         // implement listener</span>
<a href="#l92.238"></a><span id="l92.238">         var count = 0;</span>
<a href="#l92.239"></a><span id="l92.239">         var listener = {</span>
<a href="#l92.240"></a><span id="l92.240">             onOperationComplete: function(aCalendar,</span>
<a href="#l92.241"></a><span id="l92.241">                                           aStatus,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -214,17 +214,17 @@ function test_rules() {</span>
<a href="#l93.4"></a><span id="l93.4">                                           &quot;DESCRIPTION:Repeat Yearly the last day of February\n&quot; +</span>
<a href="#l93.5"></a><span id="l93.5">                                           &quot;RRULE:FREQ=YEARLY;COUNT=6;BYMONTHDAY=-1;BYMONTH=2\n&quot; +</span>
<a href="#l93.6"></a><span id="l93.6">                                           &quot;DTSTART:20140228T220000Z\n&quot; +</span>
<a href="#l93.7"></a><span id="l93.7">                                           &quot;DTEND:20140228T230000Z\n&quot; +</span>
<a href="#l93.8"></a><span id="l93.8">                                           &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l93.9"></a><span id="l93.9">                 [&quot;20140228T220000Z&quot;, &quot;20150228T220000Z&quot;, &quot;20160229T220000Z&quot;,</span>
<a href="#l93.10"></a><span id="l93.10">                  &quot;20170228T220000Z&quot;, &quot;20180228T220000Z&quot;, &quot;20190228T220000Z&quot;],</span>
<a href="#l93.11"></a><span id="l93.11">                 false);</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-               </span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+</span>
<a href="#l93.14"></a><span id="l93.14">     // Bug 958978: Yearly recurrence, the last day of a not specified month.</span>
<a href="#l93.15"></a><span id="l93.15">     check_recur(createEventFromIcalString(&quot;BEGIN:VCALENDAR\nBEGIN:VEVENT\n&quot; +</span>
<a href="#l93.16"></a><span id="l93.16">                                           &quot;DESCRIPTION:Repeat Yearly the last day of April without BYMONTH=4 in the rule\n&quot; +</span>
<a href="#l93.17"></a><span id="l93.17">                                           &quot;RRULE:FREQ=YEARLY;COUNT=6;BYMONTHDAY=-1\n&quot; +</span>
<a href="#l93.18"></a><span id="l93.18">                                           &quot;DTSTART:20140430T220000Z\n&quot; +</span>
<a href="#l93.19"></a><span id="l93.19">                                           &quot;DTEND:20140430T230000Z\n&quot; +</span>
<a href="#l93.20"></a><span id="l93.20">                                           &quot;END:VEVENT\nEND:VCALENDAR\n&quot;),</span>
<a href="#l93.21"></a><span id="l93.21">                 [&quot;20140430T220000Z&quot;, &quot;20150430T220000Z&quot;, &quot;20160430T220000Z&quot;,</span>
<a href="#l93.22"></a><span id="l93.22" class="difflineat">@@ -814,99 +814,99 @@ function test_immutable() {</span>
<a href="#l93.23"></a><span id="l93.23"> }</span>
<a href="#l93.24"></a><span id="l93.24"> </span>
<a href="#l93.25"></a><span id="l93.25"> function test_rrule_icalstring() {</span>
<a href="#l93.26"></a><span id="l93.26">     var recRule = createRecurrenceRule();</span>
<a href="#l93.27"></a><span id="l93.27">     recRule.type = &quot;DAILY&quot;;</span>
<a href="#l93.28"></a><span id="l93.28">     recRule.interval = 4;</span>
<a href="#l93.29"></a><span id="l93.29">     equal(recRule.icalString, &quot;RRULE:FREQ=DAILY;INTERVAL=4\r\n&quot;);</span>
<a href="#l93.30"></a><span id="l93.30"> </span>
<a href="#l93.31"></a><span id="l93.31" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.32"></a><span id="l93.32" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.33"></a><span id="l93.33">     recRule.type = &quot;DAILY&quot;;</span>
<a href="#l93.34"></a><span id="l93.34">     recRule.setComponent(&quot;BYDAY&quot;, 5, [2, 3, 4, 5, 6]);</span>
<a href="#l93.35"></a><span id="l93.35">     equal(recRule.icalString, &quot;RRULE:FREQ=DAILY;BYDAY=MO,TU,WE,TH,FR\r\n&quot;);</span>
<a href="#l93.36"></a><span id="l93.36">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [2, 3, 4, 5, 6]);</span>
<a href="#l93.37"></a><span id="l93.37"> </span>
<a href="#l93.38"></a><span id="l93.38" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.39"></a><span id="l93.39" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.40"></a><span id="l93.40">     recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l93.41"></a><span id="l93.41">     recRule.interval = 3;</span>
<a href="#l93.42"></a><span id="l93.42">     recRule.setComponent(&quot;BYDAY&quot;, 3, [2, 4, 6]);</span>
<a href="#l93.43"></a><span id="l93.43">     equal(recRule.icalString, &quot;RRULE:FREQ=WEEKLY;INTERVAL=3;BYDAY=MO,WE,FR\r\n&quot;);</span>
<a href="#l93.44"></a><span id="l93.44">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [2, 4, 6]);</span>
<a href="#l93.45"></a><span id="l93.45"> </span>
<a href="#l93.46"></a><span id="l93.46" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.47"></a><span id="l93.47" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.48"></a><span id="l93.48">     recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l93.49"></a><span id="l93.49">     recRule.setComponent(&quot;BYDAY&quot;, 7, [2,3,4,5,6,7,1]);</span>
<a href="#l93.50"></a><span id="l93.50">     equal(recRule.icalString, &quot;RRULE:FREQ=MONTHLY;BYDAY=MO,TU,WE,TH,FR,SA,SU\r\n&quot;);</span>
<a href="#l93.51"></a><span id="l93.51">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [2,3,4,5,6,7,1]);</span>
<a href="#l93.52"></a><span id="l93.52"> </span>
<a href="#l93.53"></a><span id="l93.53" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.54"></a><span id="l93.54" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.55"></a><span id="l93.55">     recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l93.56"></a><span id="l93.56">     recRule.setComponent(&quot;BYDAY&quot;, 1, [10]);</span>
<a href="#l93.57"></a><span id="l93.57">     equal(recRule.icalString, &quot;RRULE:FREQ=MONTHLY;BYDAY=1MO\r\n&quot;);</span>
<a href="#l93.58"></a><span id="l93.58">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [10]);</span>
<a href="#l93.59"></a><span id="l93.59"> </span>
<a href="#l93.60"></a><span id="l93.60" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.61"></a><span id="l93.61" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.62"></a><span id="l93.62">     recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l93.63"></a><span id="l93.63">     recRule.setComponent(&quot;BYDAY&quot;, 1, [20]);</span>
<a href="#l93.64"></a><span id="l93.64">     equal(recRule.icalString, &quot;RRULE:FREQ=MONTHLY;BYDAY=2WE\r\n&quot;);</span>
<a href="#l93.65"></a><span id="l93.65">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [20]);</span>
<a href="#l93.66"></a><span id="l93.66"> </span>
<a href="#l93.67"></a><span id="l93.67" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.68"></a><span id="l93.68" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.69"></a><span id="l93.69">     recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l93.70"></a><span id="l93.70">     recRule.setComponent(&quot;BYDAY&quot;, 1, [-22]);</span>
<a href="#l93.71"></a><span id="l93.71">     equal(recRule.icalString, &quot;RRULE:FREQ=MONTHLY;BYDAY=-2FR\r\n&quot;);</span>
<a href="#l93.72"></a><span id="l93.72">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [-22]);</span>
<a href="#l93.73"></a><span id="l93.73"> </span>
<a href="#l93.74"></a><span id="l93.74" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.75"></a><span id="l93.75" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.76"></a><span id="l93.76">     recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l93.77"></a><span id="l93.77">     recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [5]);</span>
<a href="#l93.78"></a><span id="l93.78">     equal(recRule.icalString, &quot;RRULE:FREQ=MONTHLY;BYMONTHDAY=5\r\n&quot;);</span>
<a href="#l93.79"></a><span id="l93.79">     deepEqual(recRule.getComponent(&quot;BYMONTHDAY&quot;, {}), [5]);</span>
<a href="#l93.80"></a><span id="l93.80"> </span>
<a href="#l93.81"></a><span id="l93.81" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.82"></a><span id="l93.82" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.83"></a><span id="l93.83">     recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l93.84"></a><span id="l93.84">     recRule.setComponent(&quot;BYMONTHDAY&quot;, 3, [1, 9, 17]);</span>
<a href="#l93.85"></a><span id="l93.85">     equal(recRule.icalString, &quot;RRULE:FREQ=MONTHLY;BYMONTHDAY=1,9,17\r\n&quot;);</span>
<a href="#l93.86"></a><span id="l93.86">     deepEqual(recRule.getComponent(&quot;BYMONTHDAY&quot;, {}), [1, 9, 17]);</span>
<a href="#l93.87"></a><span id="l93.87"> </span>
<a href="#l93.88"></a><span id="l93.88" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.89"></a><span id="l93.89" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.90"></a><span id="l93.90">     recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l93.91"></a><span id="l93.91">     recRule.setComponent(&quot;BYMONTH&quot;, 1, [1]);</span>
<a href="#l93.92"></a><span id="l93.92">     recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [3]);</span>
<a href="#l93.93"></a><span id="l93.93">     ok([</span>
<a href="#l93.94"></a><span id="l93.94">         &quot;RRULE:FREQ=YEARLY;BYMONTHDAY=3;BYMONTH=1\r\n&quot;,</span>
<a href="#l93.95"></a><span id="l93.95">         &quot;RRULE:FREQ=YEARLY;BYMONTH=1;BYMONTHDAY=3\r\n&quot;</span>
<a href="#l93.96"></a><span id="l93.96">     ].includes(recRule.icalString));</span>
<a href="#l93.97"></a><span id="l93.97">     deepEqual(recRule.getComponent(&quot;BYMONTH&quot;, {}), [1]);</span>
<a href="#l93.98"></a><span id="l93.98">     deepEqual(recRule.getComponent(&quot;BYMONTHDAY&quot;, {}), [3]);</span>
<a href="#l93.99"></a><span id="l93.99"> </span>
<a href="#l93.100"></a><span id="l93.100" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.101"></a><span id="l93.101" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.102"></a><span id="l93.102">     recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l93.103"></a><span id="l93.103">     recRule.setComponent(&quot;BYMONTH&quot;, 1, [4]);</span>
<a href="#l93.104"></a><span id="l93.104">     recRule.setComponent(&quot;BYDAY&quot;, 1, [3]);</span>
<a href="#l93.105"></a><span id="l93.105">     ok([</span>
<a href="#l93.106"></a><span id="l93.106">         &quot;RRULE:FREQ=YEARLY;BYDAY=TU;BYMONTH=4\r\n&quot;,</span>
<a href="#l93.107"></a><span id="l93.107">         &quot;RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=TU\r\n&quot;</span>
<a href="#l93.108"></a><span id="l93.108">     ].includes(recRule.icalString));</span>
<a href="#l93.109"></a><span id="l93.109">     deepEqual(recRule.getComponent(&quot;BYMONTH&quot;, {}), [4]);</span>
<a href="#l93.110"></a><span id="l93.110">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [3]);</span>
<a href="#l93.111"></a><span id="l93.111"> </span>
<a href="#l93.112"></a><span id="l93.112" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.113"></a><span id="l93.113" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.114"></a><span id="l93.114">     recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l93.115"></a><span id="l93.115">     recRule.setComponent(&quot;BYMONTH&quot;, 1, [4]);</span>
<a href="#l93.116"></a><span id="l93.116">     recRule.setComponent(&quot;BYDAY&quot;, 1, [10]);</span>
<a href="#l93.117"></a><span id="l93.117">     ok([</span>
<a href="#l93.118"></a><span id="l93.118">         &quot;RRULE:FREQ=YEARLY;BYDAY=1MO;BYMONTH=4\r\n&quot;,</span>
<a href="#l93.119"></a><span id="l93.119">         &quot;RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=1MO\r\n&quot;</span>
<a href="#l93.120"></a><span id="l93.120">     ].includes(recRule.icalString));</span>
<a href="#l93.121"></a><span id="l93.121">     deepEqual(recRule.getComponent(&quot;BYMONTH&quot;, {}), [4]);</span>
<a href="#l93.122"></a><span id="l93.122">     deepEqual(recRule.getComponent(&quot;BYDAY&quot;, {}), [10]);</span>
<a href="#l93.123"></a><span id="l93.123"> </span>
<a href="#l93.124"></a><span id="l93.124" class="difflineminus">-    var recRule = createRecurrenceRule();</span>
<a href="#l93.125"></a><span id="l93.125" class="difflineplus">+    recRule = createRecurrenceRule();</span>
<a href="#l93.126"></a><span id="l93.126">     recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l93.127"></a><span id="l93.127">     recRule.setComponent(&quot;BYMONTH&quot;, 1, [4]);</span>
<a href="#l93.128"></a><span id="l93.128">     recRule.setComponent(&quot;BYDAY&quot;, 1, [-22]);</span>
<a href="#l93.129"></a><span id="l93.129">     ok([</span>
<a href="#l93.130"></a><span id="l93.130">         &quot;RRULE:FREQ=YEARLY;BYDAY=-2FR;BYMONTH=4\r\n&quot;,</span>
<a href="#l93.131"></a><span id="l93.131">         &quot;RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=-2FR\r\n&quot;</span>
<a href="#l93.132"></a><span id="l93.132">     ].includes(recRule.icalString));</span>
<a href="#l93.133"></a><span id="l93.133">     deepEqual(recRule.getComponent(&quot;BYMONTH&quot;, {}), [4]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -95,9 +95,9 @@ function testAttachRoundtrip() {</span>
<a href="#l94.4"></a><span id="l94.4">         onOperationComplete: function() {</span>
<a href="#l94.5"></a><span id="l94.5">             if (!this.found) {</span>
<a href="#l94.6"></a><span id="l94.6">                 do_throw(&quot;Could not find item&quot;);</span>
<a href="#l94.7"></a><span id="l94.7">             }</span>
<a href="#l94.8"></a><span id="l94.8">             do_test_finished();</span>
<a href="#l94.9"></a><span id="l94.9">             run_next_test();</span>
<a href="#l94.10"></a><span id="l94.10">         }</span>
<a href="#l94.11"></a><span id="l94.11">     };</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-};</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

