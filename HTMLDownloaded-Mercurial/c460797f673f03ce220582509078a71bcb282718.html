<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18599:c460797f673f03ce220582509078a71bcb282718</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ c460797f673f03ce220582509078a71bcb282718" />
<meta property="og:url" content="/comm-central/rev/c460797f673f03ce220582509078a71bcb282718" />
<meta property="og:description" content="Bug 1221638 - Remove for-each from im/. r=aleth a=aleth" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / c460797f673f03ce220582509078a71bcb282718 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/c460797f673f03ce220582509078a71bcb282718">shortlog</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/c460797f673f03ce220582509078a71bcb282718">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718">files</a> |
changeset |
<a href="/comm-central/raw-rev/c460797f673f03ce220582509078a71bcb282718">raw</a>  | <a href="/comm-central/archive/c460797f673f03ce220582509078a71bcb282718.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1221638">Bug 1221638</a> - Remove for-each from im/. r=aleth a=aleth
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#84;&#111;&#111;&#114;&#117;&#32;&#70;&#117;&#106;&#105;&#115;&#97;&#119;&#97;&#32;&#60;&#97;&#114;&#97;&#105;&#95;&#97;&#64;&#109;&#97;&#99;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 15 Nov 2015 09:19:38 +0900</td></tr>

<tr>
 <td>changeset 18599</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/c460797f673f03ce220582509078a71bcb282718">c460797f673f03ce220582509078a71bcb282718</a></td>
</tr>



<tr>
<td>parent 18598</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/21c7f2e1e706be47acc74af309680a536c694b33">21c7f2e1e706be47acc74af309680a536c694b33</a>
</td>
</tr>

<tr>
<td>child 18600</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/884430e0888d72741dbc005a20bc5e9f0c88e2eb">884430e0888d72741dbc005a20bc5e9f0c88e2eb</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=c460797f673f03ce220582509078a71bcb282718">11385</a></td></tr>
<tr><td>push user</td><td>aleth@instantbird.org</td></tr>
<tr><td>push date</td><td class="date age">Sun, 15 Nov 2015 01:21:40 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c460797f673f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c460797f673f03ce220582509078a71bcb282718">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c460797f673f03ce220582509078a71bcb282718&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c460797f673f03ce220582509078a71bcb282718&newProject=comm-central&newRevision=d06b932c7759a966de8e6aa71673bbd7d0ebd142&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c460797f673f03ce220582509078a71bcb282718&newProject=comm-central&newRevision=d06b932c7759a966de8e6aa71673bbd7d0ebd142&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c460797f673f03ce220582509078a71bcb282718&newProject=comm-central&newRevision=d06b932c7759a966de8e6aa71673bbd7d0ebd142&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aleth%29&revcount=50">aleth</a>, <a href="/comm-central/log?rev=reviewer%28aleth%29&revcount=50">aleth</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1221638">1221638</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1221638">Bug 1221638</a> - Remove for-each from im/. r=aleth a=aleth</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/components/ibConvStatsService.js">im/components/ibConvStatsService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/components/ibConvStatsService.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/components/ibConvStatsService.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/components/ibConvStatsService.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/components/ibConvStatsService.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/components/ibConvStatsService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/accountWizard.js">im/content/accountWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/accountWizard.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/accountWizard.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/accountWizard.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/accountWizard.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/accountWizard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/accounts.js">im/content/accounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/accounts.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/accounts.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/accounts.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/accounts.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/accounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/blist.js">im/content/blist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/blist.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/blist.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/blist.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/blist.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/blist.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/contact.xml">im/content/contact.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/contact.xml">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/contact.xml">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/contact.xml">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/contact.xml">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/contact.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/conversation.xml">im/content/conversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/conversation.xml">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/conversation.xml">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/conversation.xml">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/conversation.xml">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/conversation.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/debug/fake/fake.js">im/content/debug/fake/fake.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/debug/fake/fake.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/debug/fake/fake.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/debug/fake/fake.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/debug/fake/fake.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/debug/fake/fake.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/engineManager.js">im/content/engineManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/engineManager.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/engineManager.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/engineManager.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/engineManager.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/engineManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/group.xml">im/content/group.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/group.xml">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/group.xml">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/group.xml">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/group.xml">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/group.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/joinchat.js">im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/macgestures.js">im/content/macgestures.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/macgestures.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/macgestures.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/macgestures.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/macgestures.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/macgestures.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/nsContextMenu.js">im/content/nsContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/nsContextMenu.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/nsContextMenu.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/nsContextMenu.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/nsContextMenu.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/nsContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/applications.js">im/content/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/smileys.js">im/content/preferences/smileys.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/smileys.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/smileys.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/smileys.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/smileys.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/preferences/smileys.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/viewlog.js">im/content/viewlog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/content/viewlog.js">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/content/viewlog.js">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/content/viewlog.js">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/content/viewlog.js">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/content/viewlog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/modules/ibSounds.jsm">im/modules/ibSounds.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/modules/ibSounds.jsm">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/modules/ibSounds.jsm">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/modules/ibSounds.jsm">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/modules/ibSounds.jsm">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/modules/ibSounds.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/modules/ibWinJumpList.jsm">im/modules/ibWinJumpList.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/modules/ibWinJumpList.jsm">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/modules/ibWinJumpList.jsm">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/modules/ibWinJumpList.jsm">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/modules/ibWinJumpList.jsm">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/modules/ibWinJumpList.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/modules/imWindows.jsm">im/modules/imWindows.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c460797f673f03ce220582509078a71bcb282718/im/modules/imWindows.jsm">file</a> |
<a href="/comm-central/annotate/c460797f673f03ce220582509078a71bcb282718/im/modules/imWindows.jsm">annotate</a> |
<a href="/comm-central/diff/c460797f673f03ce220582509078a71bcb282718/im/modules/imWindows.jsm">diff</a> |
<a href="/comm-central/comparison/c460797f673f03ce220582509078a71bcb282718/im/modules/imWindows.jsm">comparison</a> |
<a href="/comm-central/log/c460797f673f03ce220582509078a71bcb282718/im/modules/imWindows.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/components/ibConvStatsService.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/components/ibConvStatsService.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -153,17 +153,18 @@ ConvStatsService.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">     OS.File.read(this._statsCacheFilePath).then(function(aArray) {</span>
<a href="#l1.5"></a><span id="l1.5">       try {</span>
<a href="#l1.6"></a><span id="l1.6">         let {version: version, stats: allStats} =</span>
<a href="#l1.7"></a><span id="l1.7">           JSON.parse((new TextDecoder()).decode(aArray));</span>
<a href="#l1.8"></a><span id="l1.8">         if (version !== gStatsCacheVersion) {</span>
<a href="#l1.9"></a><span id="l1.9">           gLogParser.sweep(this);</span>
<a href="#l1.10"></a><span id="l1.10">           return;</span>
<a href="#l1.11"></a><span id="l1.11">         }</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        for each (let stats in allStats) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        for (let key in allStats) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+          let stats = allStats[key];</span>
<a href="#l1.15"></a><span id="l1.15">           gStatsByConvId[stats.id] =</span>
<a href="#l1.16"></a><span id="l1.16">             new ConversationStats(stats.id, stats.lastDate,</span>
<a href="#l1.17"></a><span id="l1.17">                                   stats.incomingCount, stats.outgoingCount);</span>
<a href="#l1.18"></a><span id="l1.18">         }</span>
<a href="#l1.19"></a><span id="l1.19">         gStatsByContactId = {};</span>
<a href="#l1.20"></a><span id="l1.20">       }</span>
<a href="#l1.21"></a><span id="l1.21">       catch (e) {</span>
<a href="#l1.22"></a><span id="l1.22">         // Something unexpected was encountered in the file.</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -408,17 +409,17 @@ ConvStatsService.prototype = {</span>
<a href="#l1.24"></a><span id="l1.24">     this._requestRoomInfo();</span>
<a href="#l1.25"></a><span id="l1.25">   },</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">   removeObserver: function(aObserver) {</span>
<a href="#l1.28"></a><span id="l1.28">     this._observers = this._observers.filter(o =&gt; o !== aObserver);</span>
<a href="#l1.29"></a><span id="l1.29">   },</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31">   _notifyObservers: function(aTopic, aData) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-    for each (let observer in this._observers) {</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+    for (let observer of this._observers) {</span>
<a href="#l1.34"></a><span id="l1.34">       if (&quot;observe&quot; in observer) // Avoid failing on destructed XBL bindings.</span>
<a href="#l1.35"></a><span id="l1.35">         observer.observe(this, &quot;stats-service-&quot; + aTopic, aData);</span>
<a href="#l1.36"></a><span id="l1.36">     }</span>
<a href="#l1.37"></a><span id="l1.37">   },</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">   // Maps prplConversation ids to their ConversationStats objects.</span>
<a href="#l1.40"></a><span id="l1.40">   _statsByPrplConvId: new Map(),</span>
<a href="#l1.41"></a><span id="l1.41">   // Maps prplConversation ids to the corresponding PossibleConversations.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/content/accountWizard.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/content/accountWizard.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -8,17 +8,17 @@ Cu.import(&quot;resource:///modules/imService</span>
<a href="#l2.4"></a><span id="l2.4"> var PREF_EXTENSIONS_GETMOREPROTOCOLSURL = &quot;extensions.getMoreProtocolsURL&quot;;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> var accountWizard = {</span>
<a href="#l2.7"></a><span id="l2.7">   onload: function aw_onload() {</span>
<a href="#l2.8"></a><span id="l2.8">     let topProtoList = document.getElementById(&quot;topprotolist&quot;);</span>
<a href="#l2.9"></a><span id="l2.9">     let bundle = document.getElementById(&quot;topProtocolsBundle&quot;);</span>
<a href="#l2.10"></a><span id="l2.10">     let topProtocols = bundle.getString(&quot;topProtocol.list&quot;).split(&quot;,&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    for each (let topProto in topProtocols) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    for (let topProto of topProtocols) {</span>
<a href="#l2.14"></a><span id="l2.14">       let proto = Services.core.getProtocolById(topProto);</span>
<a href="#l2.15"></a><span id="l2.15">       if (proto == null)</span>
<a href="#l2.16"></a><span id="l2.16">         continue;</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18">       let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l2.19"></a><span id="l2.19">       item.className = &quot;top-protocol&quot;;</span>
<a href="#l2.20"></a><span id="l2.20">       topProtoList.insertBefore(item, document.getElementById(&quot;otherListItem&quot;));</span>
<a href="#l2.21"></a><span id="l2.21">       let desc = bundle.getString(&quot;topProtocol.&quot; + proto.id + &quot;.description&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/content/accounts.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/content/accounts.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -37,17 +37,17 @@ var gAccountManager = {</span>
<a href="#l3.4"></a><span id="l3.4">       let defaultID;</span>
<a href="#l3.5"></a><span id="l3.5">       for (let acc in this.getAccounts()) {</span>
<a href="#l3.6"></a><span id="l3.6">         var elt = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l3.7"></a><span id="l3.7">         this.accountList.appendChild(elt);</span>
<a href="#l3.8"></a><span id="l3.8">         elt.build(acc);</span>
<a href="#l3.9"></a><span id="l3.9">         if (!defaultID &amp;&amp; acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l3.10"></a><span id="l3.10">           defaultID = acc.id;</span>
<a href="#l3.11"></a><span id="l3.11">       }</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      for each (let event in events)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      for (let event of events)</span>
<a href="#l3.14"></a><span id="l3.14">         Services.obs.addObserver(this, event, false);</span>
<a href="#l3.15"></a><span id="l3.15">       if (!this.accountList.getRowCount())</span>
<a href="#l3.16"></a><span id="l3.16">         // This is horrible, but it works. Otherwise (at least on mac)</span>
<a href="#l3.17"></a><span id="l3.17">         // the wizard is not centered relatively to the account manager</span>
<a href="#l3.18"></a><span id="l3.18">         setTimeout(function() { gAccountManager.new(); }, 0);</span>
<a href="#l3.19"></a><span id="l3.19">       else {</span>
<a href="#l3.20"></a><span id="l3.20">         // we have accounts, show the list</span>
<a href="#l3.21"></a><span id="l3.21">         document.getElementById(&quot;accountsDesk&quot;).selectedIndex = 1;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -65,17 +65,17 @@ var gAccountManager = {</span>
<a href="#l3.23"></a><span id="l3.23">       window.addEventListener(&quot;unload&quot;, this.unload.bind(this));</span>
<a href="#l3.24"></a><span id="l3.24">       this._connectedLabelInterval = setInterval(this.updateConnectedLabels, 60000);</span>
<a href="#l3.25"></a><span id="l3.25">     }, () =&gt; {</span>
<a href="#l3.26"></a><span id="l3.26">       this.close();</span>
<a href="#l3.27"></a><span id="l3.27">     });</span>
<a href="#l3.28"></a><span id="l3.28">   },</span>
<a href="#l3.29"></a><span id="l3.29">   unload: function am_unload() {</span>
<a href="#l3.30"></a><span id="l3.30">     clearInterval(this._connectedLabelInterval);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    for each (let event in events)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    for (let event of events)</span>
<a href="#l3.33"></a><span id="l3.33">       Services.obs.removeObserver(this, event);</span>
<a href="#l3.34"></a><span id="l3.34">   },</span>
<a href="#l3.35"></a><span id="l3.35">   _updateAccountList: function am__updateAccountList() {</span>
<a href="#l3.36"></a><span id="l3.36">     let accountList = this.accountList;</span>
<a href="#l3.37"></a><span id="l3.37">     let i = 0;</span>
<a href="#l3.38"></a><span id="l3.38">     for (let acc in this.getAccounts()) {</span>
<a href="#l3.39"></a><span id="l3.39">       let oldItem = accountList.getItemAtIndex(i);</span>
<a href="#l3.40"></a><span id="l3.40">       if (oldItem.id != acc.id) {</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -359,19 +359,19 @@ var gAccountManager = {</span>
<a href="#l3.42"></a><span id="l3.42">        (account.disconnected &amp;&amp;</span>
<a href="#l3.43"></a><span id="l3.43">         account.connectionErrorReason == Ci.imIAccount.ERROR_UNKNOWN_PRPL));</span>
<a href="#l3.44"></a><span id="l3.44">     let disabledItems = {</span>
<a href="#l3.45"></a><span id="l3.45">       connect: isCommandDisabled,</span>
<a href="#l3.46"></a><span id="l3.46">       disconnect: isCommandDisabled,</span>
<a href="#l3.47"></a><span id="l3.47">       moveup: accountList.selectedIndex == 0,</span>
<a href="#l3.48"></a><span id="l3.48">       movedown: accountList.selectedIndex == accountList.itemCount - 1</span>
<a href="#l3.49"></a><span id="l3.49">     };</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-    for each (let [name, state] in Iterator(disabledItems)) {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+    for (let name in disabledItems) {</span>
<a href="#l3.52"></a><span id="l3.52">       let elt = document.getElementById(&quot;cmd_&quot; + name);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-      if (state)</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+      if (disabledItems[name])</span>
<a href="#l3.55"></a><span id="l3.55">         elt.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l3.56"></a><span id="l3.56">       else</span>
<a href="#l3.57"></a><span id="l3.57">         elt.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l3.58"></a><span id="l3.58">     }</span>
<a href="#l3.59"></a><span id="l3.59">   },</span>
<a href="#l3.60"></a><span id="l3.60">   onContextMenuShowing: function am_onContextMenuShowing() {</span>
<a href="#l3.61"></a><span id="l3.61">     let targetElt = document.popupNode;</span>
<a href="#l3.62"></a><span id="l3.62">     let isAccount = targetElt instanceof Ci.nsIDOMXULSelectControlItemElement;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/im/content/blist.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/im/content/blist.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -845,30 +845,30 @@ var buddyList = {</span>
<a href="#l4.4"></a><span id="l4.4">       this.parentNode.setAttribute(&quot;listedConvCount&quot;, count);</span>
<a href="#l4.5"></a><span id="l4.5">     }.bind(buddyList.convBox);</span>
<a href="#l4.6"></a><span id="l4.6">     let convs = Services.conversations.getUIConversations();</span>
<a href="#l4.7"></a><span id="l4.7">     if (convs.length != 0) {</span>
<a href="#l4.8"></a><span id="l4.8">       if (!(&quot;Conversations&quot; in window))</span>
<a href="#l4.9"></a><span id="l4.9">         Components.utils.import(&quot;resource:///modules/imWindows.jsm&quot;);</span>
<a href="#l4.10"></a><span id="l4.10">       convs.sort((a, b) =&gt;</span>
<a href="#l4.11"></a><span id="l4.11">         a.title.toLowerCase().localeCompare(b.title.toLowerCase()));</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      for each (let conv in convs) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      for (let conv of convs) {</span>
<a href="#l4.14"></a><span id="l4.14">         if (!Conversations.isUIConversationDisplayed(conv)) {</span>
<a href="#l4.15"></a><span id="l4.15">           let convElt = document.createElement(&quot;conv&quot;);</span>
<a href="#l4.16"></a><span id="l4.16">           buddyList.convBox.appendChild(convElt);</span>
<a href="#l4.17"></a><span id="l4.17">           convElt.build(conv);</span>
<a href="#l4.18"></a><span id="l4.18">         }</span>
<a href="#l4.19"></a><span id="l4.19">       }</span>
<a href="#l4.20"></a><span id="l4.20">       buddyList.convBox._updateListConvCount();</span>
<a href="#l4.21"></a><span id="l4.21">     }</span>
<a href="#l4.22"></a><span id="l4.22">     new MutationObserver(buddyList.convBox._updateListConvCount)</span>
<a href="#l4.23"></a><span id="l4.23">       .observe(buddyList.convBox, {childList: true});</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     prefBranch.addObserver(showOfflineBuddiesPref, buddyList, false);</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-    for each (let event in events)</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+    for (let event of events)</span>
<a href="#l4.28"></a><span id="l4.28">       Services.obs.addObserver(buddyList, event, false);</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">     this.addEventListener(&quot;unload&quot;, buddyList.unload);</span>
<a href="#l4.31"></a><span id="l4.31">   },</span>
<a href="#l4.32"></a><span id="l4.32">   _displayedGroups: [],</span>
<a href="#l4.33"></a><span id="l4.33">   _getGroupIndex: function(aName) {</span>
<a href="#l4.34"></a><span id="l4.34">     let start = 0;</span>
<a href="#l4.35"></a><span id="l4.35">     let end = this._displayedGroups.length;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineat">@@ -917,17 +917,17 @@ var buddyList = {</span>
<a href="#l4.37"></a><span id="l4.37">   onblur: function bl_onblur() {</span>
<a href="#l4.38"></a><span id="l4.38">     // Clear the buddy list selection. Contacts expand to two lines</span>
<a href="#l4.39"></a><span id="l4.39">     // when selected, but only when the buddy list has focus. This makes</span>
<a href="#l4.40"></a><span id="l4.40">     // it hard to select the right contact by clicking on an unfocused</span>
<a href="#l4.41"></a><span id="l4.41">     // contact list, as the contact will reexpand before the click is handled.</span>
<a href="#l4.42"></a><span id="l4.42">     document.getElementById(&quot;buddylistbox&quot;).clearSelection();</span>
<a href="#l4.43"></a><span id="l4.43">   },</span>
<a href="#l4.44"></a><span id="l4.44">   unload: function bl_unload() {</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-    for each (let event in events)</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+    for (let event of events)</span>
<a href="#l4.47"></a><span id="l4.47">       Services.obs.removeObserver(buddyList, event);</span>
<a href="#l4.48"></a><span id="l4.48">     Services.prefs.removeObserver(showOfflineBuddiesPref, buddyList);</span>
<a href="#l4.49"></a><span id="l4.49">    },</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51">   selectFirstItem: function (aListboxID) {</span>
<a href="#l4.52"></a><span id="l4.52">     let listbox = document.getElementById(aListboxID);</span>
<a href="#l4.53"></a><span id="l4.53">     if (!listbox.itemCount)</span>
<a href="#l4.54"></a><span id="l4.54">       return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/content/contact.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/content/contact.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -579,17 +579,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">      &lt;/property&gt;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">      &lt;method name=&quot;open&quot;&gt;</span>
<a href="#l5.7"></a><span id="l5.7">       &lt;body&gt;</span>
<a href="#l5.8"></a><span id="l5.8">       &lt;![CDATA[</span>
<a href="#l5.9"></a><span id="l5.9">         let className, tooltip;</span>
<a href="#l5.10"></a><span id="l5.10">         if (!this.hasAttribute(&quot;open&quot;)) {</span>
<a href="#l5.11"></a><span id="l5.11">           let buddies = this.contact.getBuddies();</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          for each (let buddy in buddies) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+          for (let buddy of buddies) {</span>
<a href="#l5.14"></a><span id="l5.14">             let buddyElt = document.createElement(&quot;buddy&quot;);</span>
<a href="#l5.15"></a><span id="l5.15">             this.appendChild(buddyElt);</span>
<a href="#l5.16"></a><span id="l5.16">             buddyElt.build(buddy, this);</span>
<a href="#l5.17"></a><span id="l5.17">           }</span>
<a href="#l5.18"></a><span id="l5.18">           if (buddies.length == 1) {</span>
<a href="#l5.19"></a><span id="l5.19">             let buddyElt = document.createElement(&quot;buddy&quot;);</span>
<a href="#l5.20"></a><span id="l5.20">             buddyElt.setAttribute(&quot;dummy&quot;, &quot;true&quot;);</span>
<a href="#l5.21"></a><span id="l5.21">             this.appendChild(buddyElt);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/content/conversation.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/content/conversation.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -639,17 +639,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">             let word = words[0];</span>
<a href="#l6.5"></a><span id="l6.5">             if (!word)</span>
<a href="#l6.6"></a><span id="l6.6">               return;</span>
<a href="#l6.7"></a><span id="l6.7">             let isFirstWord = inputBox.selectionStart == word.length;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">             // Check if we are completing a command.</span>
<a href="#l6.10"></a><span id="l6.10">             let completingCommand = isFirstWord &amp;&amp; word[0] == &quot;/&quot;;</span>
<a href="#l6.11"></a><span id="l6.11">             if (completingCommand) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-              for each (let cmd in Services.cmd.listCommandsForConversation(this._conv)) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+              for (let cmd of Services.cmd.listCommandsForConversation(this._conv)) {</span>
<a href="#l6.14"></a><span id="l6.14">                 // It's possible to have a global and a protocol specific command</span>
<a href="#l6.15"></a><span id="l6.15">                 // with the same name. Avoid duplicates in the |completions| array.</span>
<a href="#l6.16"></a><span id="l6.16">                 let name = &quot;/&quot; + cmd.name;</span>
<a href="#l6.17"></a><span id="l6.17">                 if (completions.indexOf(name) == -1)</span>
<a href="#l6.18"></a><span id="l6.18">                   completions.push(name);</span>
<a href="#l6.19"></a><span id="l6.19">               }</span>
<a href="#l6.20"></a><span id="l6.20">             }</span>
<a href="#l6.21"></a><span id="l6.21">             else {</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -707,17 +707,17 @@</span>
<a href="#l6.23"></a><span id="l6.23">               matchingCompletions = completions.filter(condition);</span>
<a href="#l6.24"></a><span id="l6.24">             }</span>
<a href="#l6.25"></a><span id="l6.25">             if (!matchingCompletions.length)</span>
<a href="#l6.26"></a><span id="l6.26">               return;</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">             // If the cursor is in the middle of a word, and the word is a nick,</span>
<a href="#l6.29"></a><span id="l6.29">             // there is no need to complete - just jump to the end of the nick.</span>
<a href="#l6.30"></a><span id="l6.30">             let wholeWord = text.substring(inputBox.selectionStart - word.length);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-            for each (let completion in matchingCompletions) {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+            for (let completion of matchingCompletions) {</span>
<a href="#l6.33"></a><span id="l6.33">               if (wholeWord.lastIndexOf(completion, 0) == 0) {</span>
<a href="#l6.34"></a><span id="l6.34">                 let moveCursor = completion.length - word.length;</span>
<a href="#l6.35"></a><span id="l6.35">                 inputBox.selectionStart += moveCursor;</span>
<a href="#l6.36"></a><span id="l6.36">                 let separator = text.substring(inputBox.selectionStart,</span>
<a href="#l6.37"></a><span id="l6.37">                                                inputBox.selectionStart + 2);</span>
<a href="#l6.38"></a><span id="l6.38">                 if (separator == &quot;: &quot; || separator == &quot;, &quot;)</span>
<a href="#l6.39"></a><span id="l6.39">                   inputBox.selectionStart += 2;</span>
<a href="#l6.40"></a><span id="l6.40">                 else if (!moveCursor) {</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineat">@@ -2231,17 +2231,17 @@</span>
<a href="#l6.42"></a><span id="l6.42">         &lt;body&gt;</span>
<a href="#l6.43"></a><span id="l6.43">         &lt;![CDATA[</span>
<a href="#l6.44"></a><span id="l6.44">           let popup = this.querySelector(&quot;.all-targets-popup&quot;);</span>
<a href="#l6.45"></a><span id="l6.45">           let _conv = document.getBindingParent(this)._conv;</span>
<a href="#l6.46"></a><span id="l6.46">           if (!_conv.contact)</span>
<a href="#l6.47"></a><span id="l6.47">             return;</span>
<a href="#l6.48"></a><span id="l6.48">           let currentBuddyId = _conv.target.buddy.buddy.id;</span>
<a href="#l6.49"></a><span id="l6.49">           let buddies = _conv.contact.getBuddies();</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-          for each (let buddy in buddies) {</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+          for (let buddy of buddies) {</span>
<a href="#l6.52"></a><span id="l6.52">             let menuItem = document.createElementNS(</span>
<a href="#l6.53"></a><span id="l6.53">               &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l6.54"></a><span id="l6.54">               &quot;menuitem&quot;);</span>
<a href="#l6.55"></a><span id="l6.55">             menuItem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic alltargets-item&quot;);</span>
<a href="#l6.56"></a><span id="l6.56">             menuItem.setAttribute(&quot;label&quot;, buddy.displayName);</span>
<a href="#l6.57"></a><span id="l6.57">             menuItem.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l6.58"></a><span id="l6.58">             menuItem.setAttribute(&quot;image&quot;, buddy.protocol.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l6.59"></a><span id="l6.59">             if (buddy.id == currentBuddyId)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/im/content/debug/fake/fake.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/im/content/debug/fake/fake.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -206,17 +206,17 @@ var fake = {</span>
<a href="#l7.4"></a><span id="l7.4">     menus.accounts();</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">     this.accounts = [new Account(&quot;Tom&quot;, &quot;prpl-aim&quot;),</span>
<a href="#l7.7"></a><span id="l7.7">                      new Account(&quot;tom.smith@hotmail.com&quot;, &quot;prpl-msn&quot;),</span>
<a href="#l7.8"></a><span id="l7.8">                      new Account(&quot;tom.smith@gmail.com/instantbird&quot;,</span>
<a href="#l7.9"></a><span id="l7.9">                                  &quot;prpl-jabber&quot;),</span>
<a href="#l7.10"></a><span id="l7.10">                      new Account(&quot;tom.smith@yahoo.com&quot;, &quot;prpl-yahoo&quot;),</span>
<a href="#l7.11"></a><span id="l7.11">                      new Account(&quot;tom@irc.mozilla.org&quot;, &quot;prpl-irc&quot;)];</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    for each (let account in this.accounts)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    for (let account of this.accounts)</span>
<a href="#l7.14"></a><span id="l7.14">       Services.obs.notifyObservers(account, &quot;account-added&quot;, null);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">     var win = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span>
<a href="#l7.17"></a><span id="l7.17">                        .getService(Components.interfaces.nsIWindowMediator)</span>
<a href="#l7.18"></a><span id="l7.18">                        .getMostRecentWindow(&quot;Messenger:accountWizard&quot;);</span>
<a href="#l7.19"></a><span id="l7.19">     if (win)</span>
<a href="#l7.20"></a><span id="l7.20">       win.close();</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -236,17 +236,17 @@ var fake = {</span>
<a href="#l7.23"></a><span id="l7.23">       new AccountBuddy(&quot;Florian&quot;, this.accounts[2], this.groups[1], {_buddyIconFileName: flo_img_url}),</span>
<a href="#l7.24"></a><span id="l7.24">       new AccountBuddy(&quot;Emma&quot;, this.accounts[1], this.groups[1]),</span>
<a href="#l7.25"></a><span id="l7.25">       new AccountBuddy(&quot;Tony&quot;, this.accounts[1], this.groups[1], {_statusText: &quot;Try Instantbird!&quot;}),</span>
<a href="#l7.26"></a><span id="l7.26">       new AccountBuddy(&quot;Andrew&quot;, this.accounts[3], this.groups[1]),</span>
<a href="#l7.27"></a><span id="l7.27">       new AccountBuddy(&quot;Olivia&quot;, this.accounts[3], this.groups[1]),</span>
<a href="#l7.28"></a><span id="l7.28">       new AccountBuddy(&quot;Elizabeth&quot;, this.accounts[1], this.groups[2]),</span>
<a href="#l7.29"></a><span id="l7.29">       new AccountBuddy(&quot;William&quot;, this.accounts[2], this.groups[2])</span>
<a href="#l7.30"></a><span id="l7.30">     ];</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    for each (let buddy in this.buddies)</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+    for (let buddy of this.buddies)</span>
<a href="#l7.33"></a><span id="l7.33">       Services.contacts.accountBuddyAdded(buddy);</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">     this.convs = [</span>
<a href="#l7.36"></a><span id="l7.36">       new Conversation(&quot;Florian&quot;, this.accounts[2], this.buddies[6]),</span>
<a href="#l7.37"></a><span id="l7.37">       new Chat(&quot;#instantbird&quot;, this.accounts[4], &quot;Tom&quot;),</span>
<a href="#l7.38"></a><span id="l7.38">       new Conversation(&quot;William&quot;, this.accounts[2], this.buddies[13]),</span>
<a href="#l7.39"></a><span id="l7.39">       new Conversation(&quot;Emma&quot;, this.accounts[2], this.buddies[7])</span>
<a href="#l7.40"></a><span id="l7.40">     ];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/im/content/engineManager.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/im/content/engineManager.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -123,17 +123,17 @@ var gEngineManagerDialog = {</span>
<a href="#l8.4"></a><span id="l8.4">     var msg = strings.getFormattedString(&quot;editMsg&quot;, [selectedEngine.name]);</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">     while (prompt.prompt(window, title, msg, alias, null, { })) {</span>
<a href="#l8.7"></a><span id="l8.7">       var eduplicate = false;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">       if (alias.value != &quot;&quot;) {</span>
<a href="#l8.10"></a><span id="l8.10">         // Check for duplicates in changes we haven't committed yet</span>
<a href="#l8.11"></a><span id="l8.11">         let engines = gEngineView._engineStore.engines;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        for each (let engine in engines) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+        for (let engine of engines) {</span>
<a href="#l8.14"></a><span id="l8.14">           if (engine.alias == alias.value &amp;&amp;</span>
<a href="#l8.15"></a><span id="l8.15">               engine.name != selectedEngine.name) {</span>
<a href="#l8.16"></a><span id="l8.16">             eduplicate = true;</span>
<a href="#l8.17"></a><span id="l8.17">             break;</span>
<a href="#l8.18"></a><span id="l8.18">           }</span>
<a href="#l8.19"></a><span id="l8.19">         }</span>
<a href="#l8.20"></a><span id="l8.20">       }</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -281,17 +281,17 @@ EngineStore.prototype = {</span>
<a href="#l8.23"></a><span id="l8.23">     return val;</span>
<a href="#l8.24"></a><span id="l8.24">   },</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26">   _getIndexForEngine: function ES_getIndexForEngine(aEngine) {</span>
<a href="#l8.27"></a><span id="l8.27">     return this._engines.indexOf(aEngine);</span>
<a href="#l8.28"></a><span id="l8.28">   },</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">   _getEngineByName: function ES_getEngineByName(aName) {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    for each (var engine in this._engines)</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    for (var engine of this._engines)</span>
<a href="#l8.33"></a><span id="l8.33">       if (engine.name == aName)</span>
<a href="#l8.34"></a><span id="l8.34">         return engine;</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">     return null;</span>
<a href="#l8.37"></a><span id="l8.37">   },</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39">   _cloneEngine: function ES_cloneObj(aEngine) {</span>
<a href="#l8.40"></a><span id="l8.40">     var newO=[];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/im/content/group.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/im/content/group.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -112,17 +112,17 @@</span>
<a href="#l9.4"></a><span id="l9.4">        &lt;![CDATA[</span>
<a href="#l9.5"></a><span id="l9.5">          if (this._pendingReorders.indexOf(aContactElt) != -1)</span>
<a href="#l9.6"></a><span id="l9.6">            return;</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">          this._pendingReorders.push(aContactElt);</span>
<a href="#l9.9"></a><span id="l9.9">          if (!this._selectListener) {</span>
<a href="#l9.10"></a><span id="l9.10">            this._selectListener = (function() {</span>
<a href="#l9.11"></a><span id="l9.11">              let remaining = [];</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-             for each (let contactElt in this._pendingReorders) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+             for (let contactElt of this._pendingReorders) {</span>
<a href="#l9.14"></a><span id="l9.14">                if (!contactElt.hasAttribute(&quot;selected&quot;) &amp;&amp;</span>
<a href="#l9.15"></a><span id="l9.15">                    !contactElt.hasAttribute(&quot;open&quot;))</span>
<a href="#l9.16"></a><span id="l9.16">                  this.observe(contactElt.contact, &quot;contact-display-name-changed&quot;);</span>
<a href="#l9.17"></a><span id="l9.17">                else</span>
<a href="#l9.18"></a><span id="l9.18">                  remaining.push(contactElt);</span>
<a href="#l9.19"></a><span id="l9.19">              }</span>
<a href="#l9.20"></a><span id="l9.20">              this._pendingReorders = remaining;</span>
<a href="#l9.21"></a><span id="l9.21">              if (remaining.length == 0) {</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -167,17 +167,17 @@</span>
<a href="#l9.23"></a><span id="l9.23">          if (aTopic == &quot;contact-display-name-changed&quot;) {</span>
<a href="#l9.24"></a><span id="l9.24">            this.updateContactPosition(aSubject);</span>
<a href="#l9.25"></a><span id="l9.25">            return;</span>
<a href="#l9.26"></a><span id="l9.26">          }</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28">          if (aTopic == &quot;tag-hidden&quot;) {</span>
<a href="#l9.29"></a><span id="l9.29">            this.setAttribute(&quot;collapsing&quot;, &quot;true&quot;);</span>
<a href="#l9.30"></a><span id="l9.30">            this.addEventListener(&quot;transitionend&quot;, this._transitionEnd, true);</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-           for each (let contact in this.contacts) {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+           for (let contact of this.contacts) {</span>
<a href="#l9.33"></a><span id="l9.33">              contact.state = &quot;collapsing&quot;;</span>
<a href="#l9.34"></a><span id="l9.34">              contact.destroy();</span>
<a href="#l9.35"></a><span id="l9.35">            }</span>
<a href="#l9.36"></a><span id="l9.36">            return;</span>
<a href="#l9.37"></a><span id="l9.37">          }</span>
<a href="#l9.38"></a><span id="l9.38">        ]]&gt;</span>
<a href="#l9.39"></a><span id="l9.39">        &lt;/body&gt;</span>
<a href="#l9.40"></a><span id="l9.40">      &lt;/method&gt;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -328,17 +328,17 @@</span>
<a href="#l9.42"></a><span id="l9.42">       ]]&gt;</span>
<a href="#l9.43"></a><span id="l9.43">       &lt;/body&gt;</span>
<a href="#l9.44"></a><span id="l9.44">      &lt;/method&gt;</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46">      &lt;method name=&quot;_updateClosedState&quot;&gt;</span>
<a href="#l9.47"></a><span id="l9.47">       &lt;parameter name=&quot;aClosed&quot;/&gt;</span>
<a href="#l9.48"></a><span id="l9.48">       &lt;body&gt;</span>
<a href="#l9.49"></a><span id="l9.49">       &lt;![CDATA[</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-        for each (let contact in this.contacts)</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+        for (let contact of this.contacts)</span>
<a href="#l9.52"></a><span id="l9.52">           contact.collapsed = aClosed;</span>
<a href="#l9.53"></a><span id="l9.53">       ]]&gt;</span>
<a href="#l9.54"></a><span id="l9.54">       &lt;/body&gt;</span>
<a href="#l9.55"></a><span id="l9.55">      &lt;/method&gt;</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57">      &lt;method name=&quot;close&quot;&gt;</span>
<a href="#l9.58"></a><span id="l9.58">       &lt;body&gt;</span>
<a href="#l9.59"></a><span id="l9.59">       &lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/im/content/joinchat.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/im/content/joinchat.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -83,17 +83,17 @@ var joinChat = {</span>
<a href="#l10.4"></a><span id="l10.4">       joinChat._fields.push({field: field, textbox: textbox});</span>
<a href="#l10.5"></a><span id="l10.5">     }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">     window.sizeToContent();</span>
<a href="#l10.8"></a><span id="l10.8">   },</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">   join: function jc_join() {</span>
<a href="#l10.11"></a><span id="l10.11">     let values = joinChat._values;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    for each (let field in joinChat._fields) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    for (let field of joinChat._fields) {</span>
<a href="#l10.14"></a><span id="l10.14">       let val = field.textbox.value.trim();</span>
<a href="#l10.15"></a><span id="l10.15">       if (!val &amp;&amp; field.field.required) {</span>
<a href="#l10.16"></a><span id="l10.16">         field.textbox.focus();</span>
<a href="#l10.17"></a><span id="l10.17">         //FIXME: why isn't the return false enough?</span>
<a href="#l10.18"></a><span id="l10.18">         throw &quot;Some required fields are empty!&quot;;</span>
<a href="#l10.19"></a><span id="l10.19">         return false;</span>
<a href="#l10.20"></a><span id="l10.20">       }</span>
<a href="#l10.21"></a><span id="l10.21">       if (val)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/im/content/macgestures.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/im/content/macgestures.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -34,17 +34,17 @@ var gGestureSupport = {</span>
<a href="#l11.4"></a><span id="l11.4">   init: function GS_init(aAddListener) {</span>
<a href="#l11.5"></a><span id="l11.5">     const gestureEvents = [&quot;SwipeGesture&quot;,</span>
<a href="#l11.6"></a><span id="l11.6">       &quot;MagnifyGestureStart&quot;, &quot;MagnifyGestureUpdate&quot;, &quot;MagnifyGesture&quot;,</span>
<a href="#l11.7"></a><span id="l11.7">       &quot;RotateGestureStart&quot;, &quot;RotateGestureUpdate&quot;, &quot;RotateGesture&quot;];</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">     let addRemove = aAddListener ? window.addEventListener :</span>
<a href="#l11.10"></a><span id="l11.10">       window.removeEventListener;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    for each (let event in gestureEvents)</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    for (let event of gestureEvents)</span>
<a href="#l11.14"></a><span id="l11.14">       addRemove(&quot;Moz&quot; + event, this, true);</span>
<a href="#l11.15"></a><span id="l11.15">   },</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   /**</span>
<a href="#l11.18"></a><span id="l11.18">    * Dispatch events based on the type of mouse gesture event. For now, make</span>
<a href="#l11.19"></a><span id="l11.19">    * sure to stop propagation of every gesture event so that web content cannot</span>
<a href="#l11.20"></a><span id="l11.20">    * receive gesture events.</span>
<a href="#l11.21"></a><span id="l11.21">    *</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -201,17 +201,17 @@ var gGestureSupport = {</span>
<a href="#l11.23"></a><span id="l11.23">   /**</span>
<a href="#l11.24"></a><span id="l11.24">    * Convert the swipe gesture into a browser action based on the direction</span>
<a href="#l11.25"></a><span id="l11.25">    *</span>
<a href="#l11.26"></a><span id="l11.26">    * @param aEvent</span>
<a href="#l11.27"></a><span id="l11.27">    *        The swipe event to handle</span>
<a href="#l11.28"></a><span id="l11.28">    */</span>
<a href="#l11.29"></a><span id="l11.29">   onSwipe: function GS_onSwipe(aEvent) {</span>
<a href="#l11.30"></a><span id="l11.30">     // Figure out which one (and only one) direction was triggered</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-    for each (let dir in [&quot;UP&quot;, &quot;RIGHT&quot;, &quot;DOWN&quot;, &quot;LEFT&quot;]) {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    for (let dir of [&quot;UP&quot;, &quot;RIGHT&quot;, &quot;DOWN&quot;, &quot;LEFT&quot;]) {</span>
<a href="#l11.33"></a><span id="l11.33">       if (aEvent.direction == aEvent[&quot;DIRECTION_&quot; + dir]) {</span>
<a href="#l11.34"></a><span id="l11.34">         this._doAction(aEvent, [&quot;swipe&quot;, dir.toLowerCase()]);</span>
<a href="#l11.35"></a><span id="l11.35">         return;</span>
<a href="#l11.36"></a><span id="l11.36">       }</span>
<a href="#l11.37"></a><span id="l11.37">     }</span>
<a href="#l11.38"></a><span id="l11.38">   }</span>
<a href="#l11.39"></a><span id="l11.39"> };</span>
<a href="#l11.40"></a><span id="l11.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/im/content/nsContextMenu.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/im/content/nsContextMenu.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -131,17 +131,17 @@ nsContextMenu.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">       this.getLogsForNick(this.nick).then(aLogs =&gt; {</span>
<a href="#l12.5"></a><span id="l12.5">         if (aLogs &amp;&amp; aLogs.hasMoreElements())</span>
<a href="#l12.6"></a><span id="l12.6">           elt.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l12.7"></a><span id="l12.7">       });</span>
<a href="#l12.8"></a><span id="l12.8">     }</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">     // Display action menu items.</span>
<a href="#l12.11"></a><span id="l12.11">     let before = document.getElementById(&quot;context-sep-messageactions&quot;);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    for each (let action in actions) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    for (let action of actions) {</span>
<a href="#l12.14"></a><span id="l12.14">       let menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l12.15"></a><span id="l12.15">       menuitem.setAttribute(&quot;label&quot;, action.label);</span>
<a href="#l12.16"></a><span id="l12.16">       menuitem.setAttribute(&quot;oncommand&quot;, &quot;this.action.run();&quot;);</span>
<a href="#l12.17"></a><span id="l12.17">       menuitem.action = action;</span>
<a href="#l12.18"></a><span id="l12.18">       before.parentNode.insertBefore(menuitem, before);</span>
<a href="#l12.19"></a><span id="l12.19">     }</span>
<a href="#l12.20"></a><span id="l12.20">   },</span>
<a href="#l12.21"></a><span id="l12.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/im/content/preferences/applications.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/im/content/preferences/applications.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -490,17 +490,17 @@ var gApplicationsPane = {</span>
<a href="#l13.4"></a><span id="l13.4">       this._list.lastChild.remove();</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">     var visibleTypes = this._visibleTypes;</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">     // If the user is filtering the list, then only show matching types.</span>
<a href="#l13.9"></a><span id="l13.9">     if (this._filter.value)</span>
<a href="#l13.10"></a><span id="l13.10">       visibleTypes = visibleTypes.filter(this._matchesFilter, this);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    for each (let visibleType in visibleTypes) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    for (let visibleType of visibleTypes) {</span>
<a href="#l13.14"></a><span id="l13.14">       let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l13.15"></a><span id="l13.15">       item.setAttribute(&quot;type&quot;, visibleType.type);</span>
<a href="#l13.16"></a><span id="l13.16">       item.setAttribute(&quot;typeDescription&quot;, this._describeType(visibleType));</span>
<a href="#l13.17"></a><span id="l13.17">       if (visibleType.smallIcon)</span>
<a href="#l13.18"></a><span id="l13.18">         item.setAttribute(&quot;typeIcon&quot;, visibleType.smallIcon);</span>
<a href="#l13.19"></a><span id="l13.19">       item.setAttribute(&quot;actionDescription&quot;,</span>
<a href="#l13.20"></a><span id="l13.20">                         this._describePreferredAction(visibleType));</span>
<a href="#l13.21"></a><span id="l13.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/im/content/preferences/smileys.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/im/content/preferences/smileys.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -25,17 +25,17 @@ var smileysPreview = {</span>
<a href="#l14.4"></a><span id="l14.4">     let item = list.firstChild.nextSibling;</span>
<a href="#l14.5"></a><span id="l14.5">     while (item) {</span>
<a href="#l14.6"></a><span id="l14.6">       let next = item.nextSibling;</span>
<a href="#l14.7"></a><span id="l14.7">       item.remove();</span>
<a href="#l14.8"></a><span id="l14.8">       item = next;</span>
<a href="#l14.9"></a><span id="l14.9">     }</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">     if (this.smileyList) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      for each (let smiley in this.smileyList) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      for (let smiley of this.smileyList) {</span>
<a href="#l14.14"></a><span id="l14.14">         let item = document.createElement(&quot;smiley&quot;);</span>
<a href="#l14.15"></a><span id="l14.15">         item.setAttribute(&quot;smileyImage&quot;, smiley.src);</span>
<a href="#l14.16"></a><span id="l14.16">         item.setAttribute(&quot;smileyTextCodes&quot;, smiley.textCodes.join(&quot; &quot;));</span>
<a href="#l14.17"></a><span id="l14.17">         list.appendChild(item);</span>
<a href="#l14.18"></a><span id="l14.18">       }</span>
<a href="#l14.19"></a><span id="l14.19">     }</span>
<a href="#l14.20"></a><span id="l14.20">   }</span>
<a href="#l14.21"></a><span id="l14.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/im/content/viewlog.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/im/content/viewlog.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -179,17 +179,17 @@ var logWindow = {</span>
<a href="#l15.4"></a><span id="l15.4">       Cu.import(&quot;resource:///modules/imSmileys.jsm&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">     smileTextNode(elt);</span>
<a href="#l15.6"></a><span id="l15.6">   }</span>
<a href="#l15.7"></a><span id="l15.7"> };</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> function chatLogTreeGroupItem(aTitle, aLogItems) {</span>
<a href="#l15.10"></a><span id="l15.10">   this._title = aTitle;</span>
<a href="#l15.11"></a><span id="l15.11">   this._children = aLogItems;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  for each (let child in this._children)</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  for (let child of this._children)</span>
<a href="#l15.14"></a><span id="l15.14">     child._parent = this;</span>
<a href="#l15.15"></a><span id="l15.15">   this._open = false;</span>
<a href="#l15.16"></a><span id="l15.16"> }</span>
<a href="#l15.17"></a><span id="l15.17"> chatLogTreeGroupItem.prototype = {</span>
<a href="#l15.18"></a><span id="l15.18">   getText: function() { return this._title; },</span>
<a href="#l15.19"></a><span id="l15.19">   get id() { return this._title; },</span>
<a href="#l15.20"></a><span id="l15.20">   get open() { return this._open; },</span>
<a href="#l15.21"></a><span id="l15.21">   get level() { return 0; },</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -272,17 +272,17 @@ chatLogTreeView.prototype = {</span>
<a href="#l15.23"></a><span id="l15.23">     };</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">     // today and yesterday are treated differently, because for JSON logs they</span>
<a href="#l15.26"></a><span id="l15.26">     // represent individual logs, and are not &quot;groups&quot;.</span>
<a href="#l15.27"></a><span id="l15.27">     let today = null, yesterday = null;</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">     // Build a chatLogTreeLogItem for each log, and put it in the right group.</span>
<a href="#l15.30"></a><span id="l15.30">     let groups = {};</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-    for each (let log in getIter(this._logs)) {</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+    for (let log of getIter(this._logs)) {</span>
<a href="#l15.33"></a><span id="l15.33">       let logDate = new Date(log.time * 1000);</span>
<a href="#l15.34"></a><span id="l15.34">       // Calculate elapsed time between the log and 00:00:00 today.</span>
<a href="#l15.35"></a><span id="l15.35">       let timeFromToday = todayDate - logDate;</span>
<a href="#l15.36"></a><span id="l15.36">       let isJSON = log.format == &quot;json&quot;;</span>
<a href="#l15.37"></a><span id="l15.37">       let title = (isJSON ? formatDate : formatDateTime)(logDate);</span>
<a href="#l15.38"></a><span id="l15.38">       let group;</span>
<a href="#l15.39"></a><span id="l15.39">       if (timeFromToday &lt;= 0) {</span>
<a href="#l15.40"></a><span id="l15.40">         if (isJSON) {</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineat">@@ -330,17 +330,18 @@ chatLogTreeView.prototype = {</span>
<a href="#l15.42"></a><span id="l15.42">         group = groups[groupID].entries;</span>
<a href="#l15.43"></a><span id="l15.43">       }</span>
<a href="#l15.44"></a><span id="l15.44">       group.push(new chatLogTreeLogItem(log, title, 1));</span>
<a href="#l15.45"></a><span id="l15.45">     }</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">     let groupIDs = Object.keys(groups).sort().reverse();</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">     // Add firstgroups to groups and groupIDs.</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-    for each (let [groupID, group] in Iterator(firstgroups)) {</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+    for (let groupID in firstgroups) {</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+      let group = firstgroups[groupID];</span>
<a href="#l15.53"></a><span id="l15.53">       if (!group.length)</span>
<a href="#l15.54"></a><span id="l15.54">         continue;</span>
<a href="#l15.55"></a><span id="l15.55">       groupIDs.unshift(groupID);</span>
<a href="#l15.56"></a><span id="l15.56">       groups[groupID] = {</span>
<a href="#l15.57"></a><span id="l15.57">         entries: firstgroups[groupID],</span>
<a href="#l15.58"></a><span id="l15.58">         name: chatBundle.getString(&quot;log.&quot; + groupID)</span>
<a href="#l15.59"></a><span id="l15.59">       };</span>
<a href="#l15.60"></a><span id="l15.60">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/im/modules/ibSounds.jsm</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/im/modules/ibSounds.jsm</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -52,12 +52,12 @@ var Sounds = {</span>
<a href="#l16.4"></a><span id="l16.4">       break;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">     default:</span>
<a href="#l16.7"></a><span id="l16.7">       throw &quot;bad notification&quot;;</span>
<a href="#l16.8"></a><span id="l16.8">     }</span>
<a href="#l16.9"></a><span id="l16.9">   },</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">   init: function() {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    for each (let topic in this.soundEvents)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    for (let topic of this.soundEvents)</span>
<a href="#l16.14"></a><span id="l16.14">       Services.obs.addObserver(this, topic, false);</span>
<a href="#l16.15"></a><span id="l16.15">   }</span>
<a href="#l16.16"></a><span id="l16.16"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/im/modules/ibWinJumpList.jsm</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/im/modules/ibWinJumpList.jsm</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -70,17 +70,17 @@ var WinJumpList = {</span>
<a href="#l17.4"></a><span id="l17.4">     if (!this.winJumpListBuilder)</span>
<a href="#l17.5"></a><span id="l17.5">       return;</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">     // Remove the current jump list so it can be replaced.</span>
<a href="#l17.8"></a><span id="l17.8">     this.reset();</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">     let items = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    for each (let currentItem in this.jumplistEntries) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    for (let currentItem of this.jumplistEntries) {</span>
<a href="#l17.14"></a><span id="l17.14">       let item;</span>
<a href="#l17.15"></a><span id="l17.15">       if (currentItem.type == &quot;separator&quot;)</span>
<a href="#l17.16"></a><span id="l17.16">         item = this._getSeparatorItem();</span>
<a href="#l17.17"></a><span id="l17.17">       else if (currentItem.type == &quot;shortcut&quot;) {</span>
<a href="#l17.18"></a><span id="l17.18">         item = this._getHandlerAppItem(currentItem.label,</span>
<a href="#l17.19"></a><span id="l17.19">                                        currentItem.description,</span>
<a href="#l17.20"></a><span id="l17.20">                                        currentItem.parameter,</span>
<a href="#l17.21"></a><span id="l17.21">                                        currentItem.iconIndex);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/im/modules/imWindows.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/im/modules/imWindows.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -23,17 +23,17 @@ var Conversations = {</span>
<a href="#l18.4"></a><span id="l18.4">       this._windows.unshift(aWindow);</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">     if (this._pendingConversations) {</span>
<a href="#l18.7"></a><span id="l18.7">       // Cache in a variable and delete the existing notification array</span>
<a href="#l18.8"></a><span id="l18.8">       // before redispatching the notifications so that the observe</span>
<a href="#l18.9"></a><span id="l18.9">       // method can recreate it.</span>
<a href="#l18.10"></a><span id="l18.10">       let notifications = this._pendingConversations;</span>
<a href="#l18.11"></a><span id="l18.11">       this._pendingConversations = null;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      for each (let conv in notifications)</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+      for (let conv of notifications)</span>
<a href="#l18.14"></a><span id="l18.14">         this.showConversation(conv);</span>
<a href="#l18.15"></a><span id="l18.15">     }</span>
<a href="#l18.16"></a><span id="l18.16">   },</span>
<a href="#l18.17"></a><span id="l18.17">   unregisterWindow: function(aWindow) {</span>
<a href="#l18.18"></a><span id="l18.18">     let index = this._windows.indexOf(aWindow);</span>
<a href="#l18.19"></a><span id="l18.19">     if (index != -1)</span>
<a href="#l18.20"></a><span id="l18.20">       this._windows.splice(index, 1);</span>
<a href="#l18.21"></a><span id="l18.21">   },</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -186,17 +186,17 @@ var Conversations = {</span>
<a href="#l18.23"></a><span id="l18.23">     if (this.isUIConversationDisplayed(aConv) ||</span>
<a href="#l18.24"></a><span id="l18.24">         (this._pendingConversations &amp;&amp;</span>
<a href="#l18.25"></a><span id="l18.25">         this._pendingConversations.indexOf(aConv) != -1))</span>
<a href="#l18.26"></a><span id="l18.26">       return;</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">     Services.obs.notifyObservers(aConv, &quot;showing-ui-conversation&quot;, null);</span>
<a href="#l18.29"></a><span id="l18.29">     // The conversation is not displayed anywhere yet.</span>
<a href="#l18.30"></a><span id="l18.30">     // First, check if an existing conversation window can accept it.</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    for each (let win in this._windows)</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    for (let win of this._windows)</span>
<a href="#l18.33"></a><span id="l18.33">       if (win.document.getElementById(&quot;conversations&quot;).addConversation(aConv))</span>
<a href="#l18.34"></a><span id="l18.34">         return;</span>
<a href="#l18.35"></a><span id="l18.35"> </span>
<a href="#l18.36"></a><span id="l18.36">     // At this point, no existing registered window can accept the conversation.</span>
<a href="#l18.37"></a><span id="l18.37">     if (this._pendingConversations) {</span>
<a href="#l18.38"></a><span id="l18.38">       // If we are already creating a window, append the notification.</span>
<a href="#l18.39"></a><span id="l18.39">       this._pendingConversations.push(aConv);</span>
<a href="#l18.40"></a><span id="l18.40">     }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

