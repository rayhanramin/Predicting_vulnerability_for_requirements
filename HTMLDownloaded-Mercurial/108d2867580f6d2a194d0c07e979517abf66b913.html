<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20938:108d2867580f6d2a194d0c07e979517abf66b913</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 108d2867580f6d2a194d0c07e979517abf66b913" />
<meta property="og:url" content="/comm-central/rev/108d2867580f6d2a194d0c07e979517abf66b913" />
<meta property="og:description" content="Bug 1303626 - &quot;Make mozmill tests more readable and fix indent&quot; [r=makemyday]" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 108d2867580f6d2a194d0c07e979517abf66b913 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/108d2867580f6d2a194d0c07e979517abf66b913">shortlog</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/108d2867580f6d2a194d0c07e979517abf66b913">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913">files</a> |
changeset |
<a href="/comm-central/raw-rev/108d2867580f6d2a194d0c07e979517abf66b913">raw</a>  | <a href="/comm-central/archive/108d2867580f6d2a194d0c07e979517abf66b913.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1303626">Bug 1303626</a> - &quot;Make mozmill tests more readable and fix indent&quot; [r=makemyday]
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#117;&#115;&#32;&#65;&#100;&#114;&#97;&#114;&#105;&#111;&#32;&#60;&#84;&#97;&#114;&#97;&#109;&#97;&#110;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 29 Dec 2016 12:00:00 +0100</td></tr>

<tr>
 <td>changeset 20938</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/108d2867580f6d2a194d0c07e979517abf66b913">108d2867580f6d2a194d0c07e979517abf66b913</a></td>
</tr>



<tr>
<td>parent 20937</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f63a0b7059c7e99e7a3435d22a0d0cb9fa35857f">f63a0b7059c7e99e7a3435d22a0d0cb9fa35857f</a>
</td>
</tr>

<tr>
<td>child 20939</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2405248d19bd551005acd2404909c2147995331a">2405248d19bd551005acd2404909c2147995331a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=108d2867580f6d2a194d0c07e979517abf66b913">12691</a></td></tr>
<tr><td>push user</td><td>Mozilla@Adrario.de</td></tr>
<tr><td>push date</td><td class="date age">Thu, 29 Dec 2016 20:40:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@108d2867580f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=108d2867580f6d2a194d0c07e979517abf66b913">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=108d2867580f6d2a194d0c07e979517abf66b913&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=108d2867580f6d2a194d0c07e979517abf66b913&newProject=comm-central&newRevision=108d2867580f6d2a194d0c07e979517abf66b913&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=108d2867580f6d2a194d0c07e979517abf66b913&newProject=comm-central&newRevision=108d2867580f6d2a194d0c07e979517abf66b913&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=108d2867580f6d2a194d0c07e979517abf66b913&newProject=comm-central&newRevision=108d2867580f6d2a194d0c07e979517abf66b913&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28makemyday%29&revcount=50">makemyday</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1303626">1303626</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1303626">Bug 1303626</a> - &quot;Make mozmill tests more readable and fix indent&quot; [r=makemyday]</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/.eslintrc.js">calendar/test/mozmill/.eslintrc.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/.eslintrc.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/.eslintrc.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/.eslintrc.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/.eslintrc.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/.eslintrc.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/mozmilltests.list">calendar/test/mozmill/mozmilltests.list</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/mozmilltests.list">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/mozmilltests.list">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/mozmilltests.list">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/mozmilltests.list">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/mozmilltests.list">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">calendar/test/mozmill/recurrence/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testDailyRecurrence.js">calendar/test/mozmill/recurrence/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-timezone-utils.js">calendar/test/mozmill/shared-modules/test-timezone-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-timezone-utils.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-timezone-utils.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-timezone-utils.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/test-timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/timezone-utils.js">calendar/test/mozmill/shared-modules/timezone-utils.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/timezone-utils.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/shared-modules/timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testAlarmDefaultValue.js">calendar/test/mozmill/testAlarmDefaultValue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testAlarmDefaultValue.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testAlarmDefaultValue.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testAlarmDefaultValue.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testAlarmDefaultValue.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testAlarmDefaultValue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testLocalICS.js">calendar/test/mozmill/testLocalICS.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testLocalICS.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testLocalICS.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testLocalICS.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testLocalICS.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testLocalICS.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testTodayPane.js">calendar/test/mozmill/testTodayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testTodayPane.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testTodayPane.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testTodayPane.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testTodayPane.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/testTodayPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test1.js">calendar/test/mozmill/timezoneTests/test1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test1.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test1.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test1.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test1.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test10.js">calendar/test/mozmill/timezoneTests/test10.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test10.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test10.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test10.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test10.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test10.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test2.js">calendar/test/mozmill/timezoneTests/test2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test2.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test2.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test2.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test2.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test3.js">calendar/test/mozmill/timezoneTests/test3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test3.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test3.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test3.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test3.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test4.js">calendar/test/mozmill/timezoneTests/test4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test4.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test4.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test4.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test4.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test4.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test5.js">calendar/test/mozmill/timezoneTests/test5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test5.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test5.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test5.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test5.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test5.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test6.js">calendar/test/mozmill/timezoneTests/test6.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test6.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test6.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test6.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test6.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test6.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test7.js">calendar/test/mozmill/timezoneTests/test7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test7.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test7.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test7.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test7.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test7.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test8.js">calendar/test/mozmill/timezoneTests/test8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test8.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test8.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test8.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test8.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test9.js">calendar/test/mozmill/timezoneTests/test9.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test9.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test9.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test9.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test9.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/timezoneTests/test9.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testDayView.js">calendar/test/mozmill/views/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testDayView.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testDayView.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testDayView.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testDayView.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMonthView.js">calendar/test/mozmill/views/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMonthView.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMonthView.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMultiweekView.js">calendar/test/mozmill/views/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testWeekView.js">calendar/test/mozmill/views/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testWeekView.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testWeekView.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/calendar/test/mozmill/views/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">mail/test/mozmill/shared-modules/test-pref-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/108d2867580f6d2a194d0c07e979517abf66b913/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">file</a> |
<a href="/comm-central/annotate/108d2867580f6d2a194d0c07e979517abf66b913/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/108d2867580f6d2a194d0c07e979517abf66b913/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/108d2867580f6d2a194d0c07e979517abf66b913/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">comparison</a> |
<a href="/comm-central/log/108d2867580f6d2a194d0c07e979517abf66b913/mail/test/mozmill/shared-modules/test-pref-window-helpers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/test/mozmill/.eslintrc.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/test/mozmill/.eslintrc.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -10,12 +10,12 @@ module.exports = {</span>
<a href="#l1.4"></a><span id="l1.4">         exports: true,</span>
<a href="#l1.5"></a><span id="l1.5">         module: true</span>
<a href="#l1.6"></a><span id="l1.6">     },</span>
<a href="#l1.7"></a><span id="l1.7">     rules: {</span>
<a href="#l1.8"></a><span id="l1.8">         // Allow mozmill test methods to be used without warning</span>
<a href="#l1.9"></a><span id="l1.9">         &quot;no-unused-vars&quot;: [2, {</span>
<a href="#l1.10"></a><span id="l1.10">             vars: &quot;all&quot;,</span>
<a href="#l1.11"></a><span id="l1.11">             args: &quot;none&quot;,</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-            varsIgnorePattern: &quot;(MODULE_NAME|MODULE_REQUIRES|RELATIVE_ROOT|setupModule|teardownTest|^test[A-Z].*)&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+            varsIgnorePattern: &quot;(MODULE_NAME|MODULE_REQUIRES|RELATIVE_ROOT|setupModule|installInto|teardownTest|^test[A-Z].*)&quot;</span>
<a href="#l1.14"></a><span id="l1.14">         }]</span>
<a href="#l1.15"></a><span id="l1.15">     }</span>
<a href="#l1.16"></a><span id="l1.16"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">old mode 100644</span>
<a href="#l2.2"></a><span id="l2.2">new mode 100755</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineat">@@ -1,268 +1,345 @@</span>
<a href="#l2.6"></a><span id="l2.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.7"></a><span id="l2.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.8"></a><span id="l2.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+var handleAddingAttachment, acceptSendingNotificationMail, handleOccurrencePrompt;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+var CALENDARNAME, TIMEOUT_MODAL_DIALOG;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+</span>
<a href="#l2.20"></a><span id="l2.20"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-var sleep = 500;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-var title = &quot;Event&quot;;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-var location = &quot;Location&quot;;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-var desc = &quot;Event Decription&quot;;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-var attendee = &quot;foo@bar.com&quot;;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-var url = &quot;http://mozilla.org&quot;;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+var eventTitle = &quot;Event&quot;;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+var eventLocation = &quot;Location&quot;;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+var eventDescription = &quot;Event Description&quot;;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+var eventAttendee = &quot;foo@bar.com&quot;;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+var eventUrl = &quot;http://mozilla.org&quot;;</span>
<a href="#l2.34"></a><span id="l2.34"> </span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+function setupModule(module) {</span>
<a href="#l2.37"></a><span id="l2.37">     controller = mozmill.getMail3PaneController();</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-};</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+    ({</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+        helpersForController,</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+        createCalendar,</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+        deleteCalendars,</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+        handleAddingAttachment,</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+        acceptSendingNotificationMail,</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+        TIMEOUT_MODAL_DIALOG</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+}</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-var testEventDialog = function() {</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+function testEventDialog() {</span>
<a href="#l2.61"></a><span id="l2.61">     // paths</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-    let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+    let monthView = `</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+        id(&quot;month-view&quot;)</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+    `;</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    let miniMonth = `</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    `;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    let eventDialog = `</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+        /id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    `;</span>
<a href="#l2.84"></a><span id="l2.84"> </span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-    let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/' +</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-      '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+    let eventBox = `</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+    `;</span>
<a href="#l2.98"></a><span id="l2.98"> </span>
<a href="#l2.99"></a><span id="l2.99">     // open month view</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+    controller.waitThenClick(eid(&quot;calendar-month-view-button&quot;));</span>
<a href="#l2.104"></a><span id="l2.104"> </span>
<a href="#l2.105"></a><span id="l2.105">     // pick year</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+    `));</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+        [0]/{&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+    `));</span>
<a href="#l2.119"></a><span id="l2.119"> </span>
<a href="#l2.120"></a><span id="l2.120">     // pick month</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+    `));</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+        [0]/{&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+    `));</span>
<a href="#l2.135"></a><span id="l2.135"> </span>
<a href="#l2.136"></a><span id="l2.136">     // pick day</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    `));</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+    sleep();</span>
<a href="#l2.144"></a><span id="l2.144"> </span>
<a href="#l2.145"></a><span id="l2.145">     // create new event</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-    controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-    // check that the start time is correct</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-    // next full hour except last hour hour of the day</span>
<a href="#l2.152"></a><span id="l2.152">     let now = new Date();</span>
<a href="#l2.153"></a><span id="l2.153">     let hour = now.getHours();</span>
<a href="#l2.154"></a><span id="l2.154">     let startHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l2.155"></a><span id="l2.155">     let ampm = &quot;&quot;;</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+    // check that the start time is correct</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+    // next full hour except last hour hour of the day</span>
<a href="#l2.158"></a><span id="l2.158">     if (now.toLocaleTimeString().match(/AM|PM/)) {</span>
<a href="#l2.159"></a><span id="l2.159">         ampm = (hour &gt;= 12 ? &quot; PM&quot; : &quot; AM&quot;);</span>
<a href="#l2.160"></a><span id="l2.160">         startHour = startHour % 12;</span>
<a href="#l2.161"></a><span id="l2.161">         if (startHour == 0) {</span>
<a href="#l2.162"></a><span id="l2.162">             startHour = 12;</span>
<a href="#l2.163"></a><span id="l2.163">         }</span>
<a href="#l2.164"></a><span id="l2.164">     }</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-</span>
<a href="#l2.166"></a><span id="l2.166">     let startTime = startHour + &quot;:00&quot; + ampm;</span>
<a href="#l2.167"></a><span id="l2.167">     let endTime = ((startHour + 1) % 24) + &quot;:00&quot; + ampm;</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/' +</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineminus">-      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineminus">-      );</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineminus">-    event.waitForElement(startTimeInput);</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineminus">-    event.assertValue(startTimeInput, startTime);</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+        let startTimeInput = eventlookup(`</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+        `);</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+        event.waitForElement(startTimeInput);</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+        event.assertValue(startTimeInput, startTime);</span>
<a href="#l2.191"></a><span id="l2.191"> </span>
<a href="#l2.192"></a><span id="l2.192" class="difflineminus">-    // check selected calendar</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineminus">-    event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineminus">-      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineminus">-      '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+        // check selected calendar</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+        event.assertNode(eventlookup(`</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+            {&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;${CALENDARNAME}&quot;}</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+        `));</span>
<a href="#l2.202"></a><span id="l2.202"> </span>
<a href="#l2.203"></a><span id="l2.203" class="difflineminus">-    // fill in name, location, description</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-      title);</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineminus">-      'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'), location);</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineminus">-      desc);</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+        // fill in name, location, description</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineplus">+        `), eventTitle);</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineplus">+        `), eventLocation);</span>
<a href="#l2.225"></a><span id="l2.225"> </span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-    // set category</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-    let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineminus">-    let category = categories.split(&quot;,&quot;)[4]; // pick 4th value in a comma-separated list</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), null, category);</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineplus">+            id(&quot;item-description&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineplus">+        `), eventDescription);</span>
<a href="#l2.235"></a><span id="l2.235"> </span>
<a href="#l2.236"></a><span id="l2.236" class="difflineminus">-    // repeat daily</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;repeat-daily-menuitem&quot;));</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineplus">+        // set category</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineplus">+        let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineplus">+        let category = categories.split(&quot;,&quot;)[4]; // pick 4th value in a comma-separated list</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineplus">+        event.select(eventid(&quot;item-categories&quot;), null, category);</span>
<a href="#l2.242"></a><span id="l2.242"> </span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-    // add reminder</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineplus">+        // repeat daily</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineplus">+        event.click(eventid(&quot;repeat-daily-menuitem&quot;));</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineplus">+</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineplus">+        // add reminder</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineplus">+        event.click(eventid(&quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l2.250"></a><span id="l2.250"> </span>
<a href="#l2.251"></a><span id="l2.251" class="difflineminus">-    // add an attendee and verify added</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineminus">-    dialog.start(handleAttendees);</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-attendees&quot;));</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineminus">-    event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineminus">-      attendee);</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineplus">+        // add an attendee and verify added</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineplus">+        plan_for_modal_dialog(&quot;Calendar:EventDialog:Attendees&quot;, handleAttendees);</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineplus">+        event.click(eventid(&quot;button-attendees&quot;));</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineplus">+        wait_for_modal_dialog(&quot;Calendar:EventDialog:Recurrence&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineplus">+        event.assertValue(eventid(&quot;attendee-list&quot;), eventAttendee);</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineplus">+</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineplus">+        // make it private and verify label visible</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineplus">+        event.click(eventid(&quot;button-privacy&quot;));</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineplus">+        event.click(eventid(&quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineplus">+        let label = eventid(&quot;status-privacy-private-box&quot;);</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineplus">+        event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l2.268"></a><span id="l2.268"> </span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-    // make it private and verify label visible</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-privacy&quot;));</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-    let label = new elementslib.ID(event.window.document, &quot;status-privacy-private-box&quot;);</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-    event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineplus">+        // add attachment and verify added</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineplus">+        handleAddingAttachment(event, eventUrl);</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineplus">+        event.click(eventid(&quot;button-url&quot;));</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineplus">+        event.assertNode(eventlookup(`</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-attachment-row&quot;)/</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineplus">+            id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineplus">+        `));</span>
<a href="#l2.281"></a><span id="l2.281"> </span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-    // add attachment and verify added</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-    calUtils.handleAddingAttachment(event, url);</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-url&quot;));</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-    event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-      'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineminus">-</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineminus">-    // save</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-    calUtils.acceptSendingNotificationMail(event);</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineplus">+        // save</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineplus">+        acceptSendingNotificationMail(event);</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineplus">+    });</span>
<a href="#l2.295"></a><span id="l2.295"> </span>
<a href="#l2.296"></a><span id="l2.296">     // catch and dismiss alarm</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0, sleep);</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0);</span>
<a href="#l2.299"></a><span id="l2.299">     let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineplus">+    let { lookup: alarmlookup } = helpersForController(alarm);</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineplus">+</span>
<a href="#l2.302"></a><span id="l2.302">     // dismiss all button, label in .dtd file, bug #504635</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineminus">-    alarm.waitThenClick(new elementslib.Lookup(alarm.window.document, '/id(&quot;calendar-alarm-dialog&quot;)/' +</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineminus">-      'id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0, sleep);</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineplus">+    alarm.waitThenClick(alarmlookup('/id(&quot;calendar-alarm-dialog&quot;)/id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0);</span>
<a href="#l2.308"></a><span id="l2.308"> </span>
<a href="#l2.309"></a><span id="l2.309">     // verify event and alarm icon visible every day of the month and check tooltip</span>
<a href="#l2.310"></a><span id="l2.310">     // 1st January is Thursday so there's three days to check in the first row</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineplus">+    ));</span>
<a href="#l2.316"></a><span id="l2.316">     checkIcon(eventBox, &quot;0&quot;, &quot;4&quot;);</span>
<a href="#l2.317"></a><span id="l2.317">     checkTooltip(monthView, &quot;0&quot;, &quot;4&quot;, &quot;1&quot;, startTime, endTime);</span>
<a href="#l2.318"></a><span id="l2.318"> </span>
<a href="#l2.319"></a><span id="l2.319" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineplus">+    ));</span>
<a href="#l2.324"></a><span id="l2.324">     checkIcon(eventBox, &quot;0&quot;, &quot;5&quot;);</span>
<a href="#l2.325"></a><span id="l2.325">     checkTooltip(monthView, &quot;0&quot;, &quot;5&quot;, &quot;2&quot;, startTime, endTime);</span>
<a href="#l2.326"></a><span id="l2.326"> </span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineplus">+    ));</span>
<a href="#l2.332"></a><span id="l2.332">     checkIcon(eventBox, &quot;0&quot;, &quot;6&quot;);</span>
<a href="#l2.333"></a><span id="l2.333">     checkTooltip(monthView, &quot;0&quot;, &quot;6&quot;, &quot;3&quot;, startTime, endTime);</span>
<a href="#l2.334"></a><span id="l2.334"> </span>
<a href="#l2.335"></a><span id="l2.335">     // 31st of January is Saturday so there's four more full rows to check</span>
<a href="#l2.336"></a><span id="l2.336">     let date = 4;</span>
<a href="#l2.337"></a><span id="l2.337">     for (row = 1; row &lt; 5; row++) {</span>
<a href="#l2.338"></a><span id="l2.338">         for (col = 0; col &lt; 7; col++) {</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineminus">-            controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineminus">-              eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineplus">+            controller.assertNode(lookup(</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineplus">+                eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineplus">+            ));</span>
<a href="#l2.344"></a><span id="l2.344">             checkIcon(eventBox, row, col);</span>
<a href="#l2.345"></a><span id="l2.345">             checkTooltip(monthView, row, col, date, startTime, endTime);</span>
<a href="#l2.346"></a><span id="l2.346">             date++;</span>
<a href="#l2.347"></a><span id="l2.347">         }</span>
<a href="#l2.348"></a><span id="l2.348">     }</span>
<a href="#l2.349"></a><span id="l2.349"> </span>
<a href="#l2.350"></a><span id="l2.350">     // delete and verify deleted 2nd Jan</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineminus">-    calUtils.handleOccurrenceDeletion(controller);</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineplus">+    controller.click(lookup(</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineplus">+    ));</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineplus">+    let elemToDelete = eid(&quot;month-view&quot;);</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineplus">+    handleOccurrencePrompt(controller, elemToDelete, &quot;delete&quot;, false, false);</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineplus">+    controller.waitForElementNotPresent(lookup(</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineplus">+    ));</span>
<a href="#l2.366"></a><span id="l2.366"> </span>
<a href="#l2.367"></a><span id="l2.367">     // verify all others still exist</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)</span>
<a href="#l2.374"></a><span id="l2.374" class="difflineplus">+    ));</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineplus">+    ));</span>
<a href="#l2.378"></a><span id="l2.378"> </span>
<a href="#l2.379"></a><span id="l2.379">     for (row = 1; row &lt; 5; row++) {</span>
<a href="#l2.380"></a><span id="l2.380">         for (col = 0; col &lt; 7; col++) {</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineminus">-            controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineminus">-              eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineplus">+            controller.assertNode(lookup(</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineplus">+                eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)</span>
<a href="#l2.385"></a><span id="l2.385" class="difflineplus">+            ));</span>
<a href="#l2.386"></a><span id="l2.386">         }</span>
<a href="#l2.387"></a><span id="l2.387">     }</span>
<a href="#l2.388"></a><span id="l2.388"> </span>
<a href="#l2.389"></a><span id="l2.389">     // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l2.390"></a><span id="l2.390" class="difflineminus">-    calUtils.handleParentDeletion(controller);</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.392"></a><span id="l2.392" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l2.393"></a><span id="l2.393" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l2.394"></a><span id="l2.394" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l2.395"></a><span id="l2.395" class="difflineplus">+    controller.click(lookup(</span>
<a href="#l2.396"></a><span id="l2.396" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l2.397"></a><span id="l2.397" class="difflineplus">+    ));</span>
<a href="#l2.398"></a><span id="l2.398" class="difflineplus">+    elemToDelete = eid(&quot;month-view&quot;);</span>
<a href="#l2.399"></a><span id="l2.399" class="difflineplus">+    handleOccurrencePrompt(controller, elemToDelete, &quot;delete&quot;, true, false);</span>
<a href="#l2.400"></a><span id="l2.400"> </span>
<a href="#l2.401"></a><span id="l2.401">     // verify all deleted</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineminus">-      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineplus">+    controller.waitForElementNotPresent(lookup(</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineplus">+    ));</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineplus">+    controller.assertNodeNotExist(lookup(</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineplus">+    ));</span>
<a href="#l2.414"></a><span id="l2.414" class="difflineplus">+    controller.assertNodeNotExist(lookup(</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineplus">+        eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)</span>
<a href="#l2.416"></a><span id="l2.416" class="difflineplus">+    ));</span>
<a href="#l2.417"></a><span id="l2.417"> </span>
<a href="#l2.418"></a><span id="l2.418">     for (row = 1; row &lt; 5; row++) {</span>
<a href="#l2.419"></a><span id="l2.419">         for (col = 0; col &lt; 7; col++) {</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineminus">-            controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineminus">-              eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineplus">+            controller.assertNodeNotExist(lookup(</span>
<a href="#l2.423"></a><span id="l2.423" class="difflineplus">+                eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineplus">+            ));</span>
<a href="#l2.425"></a><span id="l2.425">         }</span>
<a href="#l2.426"></a><span id="l2.426">     }</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineminus">-};</span>
<a href="#l2.428"></a><span id="l2.428" class="difflineplus">+}</span>
<a href="#l2.429"></a><span id="l2.429"> </span>
<a href="#l2.430"></a><span id="l2.430"> function handleAttendees(attendees) {</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineminus">-    let input = new elementslib.Lookup(attendees.window.document,</span>
<a href="#l2.432"></a><span id="l2.432" class="difflineminus">-      '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/' +</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/' +</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineminus">-      'anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/' +</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineminus">-      '{&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineplus">+    let { lookup: attendeeslookup } = helpersForController(attendees);</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineplus">+</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineplus">+    let input = attendeeslookup(`</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineplus">+        /id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineplus">+        anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineplus">+        {&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineplus">+    `);</span>
<a href="#l2.444"></a><span id="l2.444">     attendees.waitForElement(input);</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineminus">-    attendees.type(input, attendee);</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineminus">-    attendees.click(new elementslib.Lookup(attendees.window.document,</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineminus">-      '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineplus">+    attendees.type(input, eventAttendee);</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineplus">+    attendees.click(attendeeslookup(`</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineplus">+        /id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineplus">+    `));</span>
<a href="#l2.453"></a><span id="l2.453"> }</span>
<a href="#l2.454"></a><span id="l2.454"> </span>
<a href="#l2.455"></a><span id="l2.455"> function checkIcon(eventBox, row, col) {</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineminus">-    let icon = new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineminus">-      (eventBox + '/anon({&quot;anonid&quot;:&quot;category-box-stack&quot;})/anon({&quot;align&quot;: &quot;right&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/anon({&quot;class&quot;: &quot;reminder-icon&quot;})')</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineminus">-      .replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineplus">+    let icon = lookup((`</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineplus">+        ${eventBox}/anon({&quot;anonid&quot;:&quot;category-box-stack&quot;})/</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineplus">+        anon({&quot;align&quot;: &quot;right&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineplus">+        anon({&quot;class&quot;: &quot;reminder-icon&quot;})</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineplus">+    `).replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineplus">+</span>
<a href="#l2.465"></a><span id="l2.465">     controller.assertJS(icon.getNode().getAttribute(&quot;value&quot;) == &quot;DISPLAY&quot;);</span>
<a href="#l2.466"></a><span id="l2.466"> }</span>
<a href="#l2.467"></a><span id="l2.467"> </span>
<a href="#l2.468"></a><span id="l2.468"> function checkTooltip(monthView, row, col, date, startTime, endTime) {</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineminus">-    let mouseOverItem = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/' +</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineminus">-    controller.mouseOver(new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineminus">-            mouseOverItem.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineplus">+    controller.mouseOver(lookup((`</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineplus">+        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineplus">+    `).replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l2.479"></a><span id="l2.479"> </span>
<a href="#l2.480"></a><span id="l2.480">     // check title</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineminus">-    let eventName = new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/' +</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineminus">-      '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[0]/[1]');</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineminus">-    controller.assertJS(eventName.getNode().textContent == title);</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineplus">+    let eventName = lookup(`</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/</span>
<a href="#l2.487"></a><span id="l2.487" class="difflineplus">+        {&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[0]/[1]</span>
<a href="#l2.488"></a><span id="l2.488" class="difflineplus">+    `);</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineplus">+    controller.assertJS(eventName.getNode().textContent == eventTitle);</span>
<a href="#l2.490"></a><span id="l2.490"> </span>
<a href="#l2.491"></a><span id="l2.491">     // check date and time</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineminus">-    // date-time string contains strings formatted in operating system language so check numeric values only</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineminus">-    let dateTime = new elementslib.Lookup(controller.window.document,</span>
<a href="#l2.494"></a><span id="l2.494" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/' +</span>
<a href="#l2.495"></a><span id="l2.495" class="difflineminus">-      '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]').getNode().textContent;</span>
<a href="#l2.496"></a><span id="l2.496" class="difflineminus">-    controller.assertJS(dateTime.includes(date) &amp;&amp; dateTime.includes(startTime) &amp;&amp;</span>
<a href="#l2.497"></a><span id="l2.497" class="difflineminus">-      dateTime.includes(endTime));</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineplus">+    // date-time string contains strings formatted in operating system language</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineplus">+    // so check numeric values only</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineplus">+    let dateTime = lookup(`</span>
<a href="#l2.501"></a><span id="l2.501" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/</span>
<a href="#l2.502"></a><span id="l2.502" class="difflineplus">+        {&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]</span>
<a href="#l2.503"></a><span id="l2.503" class="difflineplus">+    `).getNode().textContent;</span>
<a href="#l2.504"></a><span id="l2.504" class="difflineplus">+</span>
<a href="#l2.505"></a><span id="l2.505" class="difflineplus">+    controller.assertJS(</span>
<a href="#l2.506"></a><span id="l2.506" class="difflineplus">+        dateTime.includes(date) &amp;&amp;</span>
<a href="#l2.507"></a><span id="l2.507" class="difflineplus">+        dateTime.includes(startTime) &amp;&amp;</span>
<a href="#l2.508"></a><span id="l2.508" class="difflineplus">+        dateTime.includes(endTime)</span>
<a href="#l2.509"></a><span id="l2.509" class="difflineplus">+    );</span>
<a href="#l2.510"></a><span id="l2.510"> }</span>
<a href="#l2.511"></a><span id="l2.511"> </span>
<a href="#l2.512"></a><span id="l2.512" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l2.513"></a><span id="l2.513" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l2.514"></a><span id="l2.514" class="difflineminus">-};</span>
<a href="#l2.515"></a><span id="l2.515" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l2.516"></a><span id="l2.516" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">old mode 100644</span>
<a href="#l3.2"></a><span id="l3.2">new mode 100755</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineat">@@ -1,184 +1,189 @@</span>
<a href="#l3.6"></a><span id="l3.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.7"></a><span id="l3.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.8"></a><span id="l3.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+var deleteCalendars, switchToView, goToDate, setData;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+</span>
<a href="#l3.18"></a><span id="l3.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l3.19"></a><span id="l3.19"> var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-var pass;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-var date1 = new Date(2009, 0, 1, 8, 0);</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-var date2 = new Date(2009, 0, 2, 9, 0);</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-var date3 = new Date(2009, 0, 3, 10, 0);</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-var data = [{</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-    title: &quot;title1&quot;,</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-    location: &quot;location1&quot;,</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-    description: &quot;description1&quot;,</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    allday: false,</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-    startdate: date1,</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-    starttime: date1,</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-    enddate: date2,</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-    endtime: date2,</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-    repeat: &quot;none&quot;,</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-    reminder: 0,</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-    priority: &quot;normal&quot;,</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-    privacy: &quot;public&quot;,</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-    status: &quot;confirmed&quot;,</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-    freebusy: &quot;busy&quot;,</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-    timezone: true,</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-    attachment: { add: &quot;http://mozilla.org&quot; }</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-}, {</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-    title: &quot;title2&quot;,</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-    location: &quot;location2&quot;,</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-    description: &quot;description2&quot;,</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-    allday: true,</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-    startdate: date2,</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-    starttime: date2,</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-    enddate: date3,</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-    endtime: date3,</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-    repeat: &quot;daily&quot;,</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-    reminder: 2,</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-    priority: &quot;high&quot;,</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-    privacy: &quot;private&quot;,</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-    status: &quot;tentative&quot;,</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-    freebusy: &quot;free&quot;,</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-    timezone: true,</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-    attachment: { &quot;delete&quot;: &quot;mozilla.org&quot; }</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-}];</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-var newlines = [{ title: &quot;title&quot;, description: &quot;  test spaces  &quot; },</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-                { title: &quot;title&quot;, description: &quot;\ntest newline\n&quot; },</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-                { title: &quot;title&quot;, description: &quot;\rtest \\r\r&quot; },</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-                { title: &quot;title&quot;, description: &quot;\r\ntest \\r\\n\r\n&quot; },</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-                { title: &quot;title&quot;, description: &quot;\ttest \\t\t&quot; }];</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+var savePromptAppeared = false;</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+var { date1, date2, date3, data, newlines } = setupData();</span>
<a href="#l3.69"></a><span id="l3.69"> </span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+function setupModule(module) {</span>
<a href="#l3.72"></a><span id="l3.72">     controller = mozmill.getMail3PaneController();</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+    ({</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+        helpersForController,</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+        createCalendar,</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+        deleteCalendars,</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+        switchToView,</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+        goToDate,</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+        setData,</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l3.88"></a><span id="l3.88"> </span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l3.90"></a><span id="l3.90">     let categories = prefs.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(&quot;,&quot;);</span>
<a href="#l3.91"></a><span id="l3.91">     data[0].category = categories[0];</span>
<a href="#l3.92"></a><span id="l3.92">     data[1].category = categories[1];</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-};</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+}</span>
<a href="#l3.95"></a><span id="l3.95"> </span>
<a href="#l3.96"></a><span id="l3.96"> // Test that closing an event dialog with no changes does not prompt for save</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-var testEventDialogModificationPrompt = function() {</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+function testEventDialogModificationPrompt() {</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l3.105"></a><span id="l3.105"> </span>
<a href="#l3.106"></a><span id="l3.106">     // create new event</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+    let eventbox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+    invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l3.115"></a><span id="l3.115"> </span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-    // enter first set of data</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-    calUtils.setData(event, data[0]);</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+        // enter first set of data</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+        setData(event, iframe, data[0]);</span>
<a href="#l3.120"></a><span id="l3.120"> </span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-    // save</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+        // save</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+    });</span>
<a href="#l3.126"></a><span id="l3.126"> </span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-    // open, but change nothing</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-    let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-    controller.waitForElement(eventBox);</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-    controller.doubleClick(eventBox);</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+    eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+    invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+        // open, but change nothing</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+        dialog.start(handleSavePrompt);</span>
<a href="#l3.141"></a><span id="l3.141"> </span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-    // modal dialog setup</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-    dialog.start(handleSavePrompt);</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-    // escape the event window, there should be no prompt to save event</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-    event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-    dialog.stop();</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+        // escape the event window, there should be no prompt to save event</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+        event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+        sleep();</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+        dialog.stop();</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+    });</span>
<a href="#l3.155"></a><span id="l3.155"> </span>
<a href="#l3.156"></a><span id="l3.156">     // open</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineminus">-      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+    eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+    invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+        // change all values</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+        setData(event, iframe, data[1]);</span>
<a href="#l3.167"></a><span id="l3.167"> </span>
<a href="#l3.168"></a><span id="l3.168" class="difflineminus">-    // change all values</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineminus">-    calUtils.setData(event, data[1]);</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+        // edit all values back to original</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+        setData(event, iframe, data[0]);</span>
<a href="#l3.172"></a><span id="l3.172"> </span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-    // edit all values back to original</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-    calUtils.setData(event, data[0]);</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+        // this is set up after data entry because otherwise it tries to handle</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+        // attachment dialog</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+        dialog.start(handleSavePrompt);</span>
<a href="#l3.179"></a><span id="l3.179"> </span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-    // this is set up after data entry because otherwise it tries to handle attachment dialog</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-    dialog.start(handleSavePrompt);</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineminus">-    // escape the event window, there should be no prompt to save event</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-    event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-    dialog.stop();</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+        // escape the event window, there should be no prompt to save event</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+        event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+        sleep();</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+        dialog.stop();</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+    });</span>
<a href="#l3.193"></a><span id="l3.193"> </span>
<a href="#l3.194"></a><span id="l3.194">     // delete event</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+    controller.click(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8));</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+    controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+    controller.waitForElementNotPresent(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8));</span>
<a href="#l3.204"></a><span id="l3.204"> </span>
<a href="#l3.205"></a><span id="l3.205">     for (let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l3.206"></a><span id="l3.206">         // test set i</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineminus">-        controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineminus">-          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineminus">-        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineminus">-        event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-          .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-        calUtils.setData(event, newlines[i]);</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-        event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineplus">+        eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineplus">+        invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+            setData(event, iframe, newlines[i]);</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+            event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+        });</span>
<a href="#l3.219"></a><span id="l3.219"> </span>
<a href="#l3.220"></a><span id="l3.220">         // open and close</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-        eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-          '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineminus">-        controller.waitForElement(eventBox);</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineminus">-        controller.doubleClick(eventBox);</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineminus">-        event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineminus">-          .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineminus">-        dialog.start(handleSavePrompt);</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineminus">-        event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineminus">-        controller.sleep(sleep);</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineminus">-        dialog.stop();</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineplus">+        eventbox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineplus">+        invokeEventDialog(controller, eventbox, (event, iframe) =&gt; {</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineplus">+            setData(event, iframe, newlines[i]);</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineplus">+            dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineplus">+            dialog.start(handleSavePrompt);</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineplus">+            event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineplus">+            sleep();</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+            dialog.stop();</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+        });</span>
<a href="#l3.243"></a><span id="l3.243"> </span>
<a href="#l3.244"></a><span id="l3.244">         // delete it</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineminus">-        // XXX somehow the event is selected at this point, this didn't use to be the case</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineminus">-        // and can't be reproduced manually</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-        controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineminus">-          &quot;VK_DELETE&quot;, {});</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineminus">-        controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineminus">-          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineplus">+        // XXX somehow the event is selected at this point, this didn't use to</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineplus">+        // be the case and can't be reproduced manually</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineplus">+        controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+        controller.waitForElementNotPresent(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8));</span>
<a href="#l3.255"></a><span id="l3.255">     }</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineminus">-};</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineplus">+}</span>
<a href="#l3.258"></a><span id="l3.258"> </span>
<a href="#l3.259"></a><span id="l3.259" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineminus">-    if (pass != undefined &amp;&amp; pass == false) {</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineplus">+    if (savePromptAppeared) {</span>
<a href="#l3.265"></a><span id="l3.265">         controller.assertJS('&quot;Prompt appeared&quot; == &quot;Prompt didn\'t appear.&quot;');</span>
<a href="#l3.266"></a><span id="l3.266">     }</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineminus">-};</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineplus">+}</span>
<a href="#l3.269"></a><span id="l3.269"> </span>
<a href="#l3.270"></a><span id="l3.270"> function handleSavePrompt(controller) {</span>
<a href="#l3.271"></a><span id="l3.271">     // unexpected prompt, thus the test has already failed</span>
<a href="#l3.272"></a><span id="l3.272">     // can't trigger a failure though, because the following click wouldn't be executed</span>
<a href="#l3.273"></a><span id="l3.273">     // so remembering it</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineminus">-    pass = false;</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineplus">+    savePromptAppered = true;</span>
<a href="#l3.276"></a><span id="l3.276">     // application close is blocked without it</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineminus">-      '/id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;extra1&quot;}'));</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineplus">+        /id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;extra1&quot;}</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineplus">+    `));</span>
<a href="#l3.282"></a><span id="l3.282"> }</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineplus">+</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineplus">+function setupData() {</span>
<a href="#l3.285"></a><span id="l3.285" class="difflineplus">+    return {</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineplus">+        date1: new Date(2009, 0, 1, 8, 0),</span>
<a href="#l3.287"></a><span id="l3.287" class="difflineplus">+        date2: new Date(2009, 0, 2, 9, 0),</span>
<a href="#l3.288"></a><span id="l3.288" class="difflineplus">+        date3: new Date(2009, 0, 3, 10, 0),</span>
<a href="#l3.289"></a><span id="l3.289" class="difflineplus">+        data: [{</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineplus">+            title: &quot;title1&quot;,</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineplus">+            location: &quot;location1&quot;,</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineplus">+            description: &quot;description1&quot;,</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineplus">+            allday: false,</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineplus">+            startdate: date1,</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineplus">+            starttime: date1,</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineplus">+            enddate: date2,</span>
<a href="#l3.297"></a><span id="l3.297" class="difflineplus">+            endtime: date2,</span>
<a href="#l3.298"></a><span id="l3.298" class="difflineplus">+            repeat: &quot;none&quot;,</span>
<a href="#l3.299"></a><span id="l3.299" class="difflineplus">+            reminder: 0,</span>
<a href="#l3.300"></a><span id="l3.300" class="difflineplus">+            priority: &quot;normal&quot;,</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineplus">+            privacy: &quot;public&quot;,</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineplus">+            status: &quot;confirmed&quot;,</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineplus">+            freebusy: &quot;busy&quot;,</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineplus">+            timezone: true,</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineplus">+            attachment: { add: &quot;http://mozilla.org&quot; }</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineplus">+        }, {</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineplus">+            title: &quot;title2&quot;,</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineplus">+            location: &quot;location2&quot;,</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineplus">+            description: &quot;description2&quot;,</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineplus">+            allday: true,</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineplus">+            startdate: date2,</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineplus">+            starttime: date2,</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineplus">+            enddate: date3,</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineplus">+            endtime: date3,</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineplus">+            repeat: &quot;daily&quot;,</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineplus">+            reminder: 2,</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineplus">+            priority: &quot;high&quot;,</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineplus">+            privacy: &quot;private&quot;,</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineplus">+            status: &quot;tentative&quot;,</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineplus">+            freebusy: &quot;free&quot;,</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineplus">+            timezone: true,</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineplus">+            attachment: { &quot;delete&quot;: &quot;mozilla.org&quot; }</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineplus">+        }],</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineplus">+        newlines: [</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineplus">+            { title: &quot;title&quot;, description: &quot;  test spaces  &quot; },</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineplus">+            { title: &quot;title&quot;, description: &quot;\ntest newline\n&quot; },</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineplus">+            { title: &quot;title&quot;, description: &quot;\rtest \\r\r&quot; },</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineplus">+            { title: &quot;title&quot;, description: &quot;\r\ntest \\r\\n\r\n&quot; },</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineplus">+            { title: &quot;title&quot;, description: &quot;\ttest \\t\t&quot; }</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineplus">+        ]</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineplus">+    };</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">old mode 100644</span>
<a href="#l4.2"></a><span id="l4.2">new mode 100755</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineat">@@ -1,86 +1,99 @@</span>
<a href="#l4.6"></a><span id="l4.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.7"></a><span id="l4.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.8"></a><span id="l4.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">-var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-var sleep = 500;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-var UTF8string = &quot;õäöü&quot;;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+var deleteCalendars, switchToView;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+var EVENT_BOX, CANVAS_BOX;</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+var UTF8STRING = &quot; 💣 💥  ☣  &quot;;</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+function setupModule(module) {</span>
<a href="#l4.29"></a><span id="l4.29">     controller = mozmill.getMail3PaneController();</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-    calUtils.createCalendar(controller, UTF8string);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    Preferences.set(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-};</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+    ({</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+        helpersForController,</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+        createCalendar,</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+        deleteCalendars,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+        switchToView,</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-var testUTF8 = function() {</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+    createCalendar(controller, UTF8STRING);</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+    Preferences.set(&quot;calendar.categories.names&quot;, UTF8STRING);</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+}</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+function testUTF8() {</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)';</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l4.58"></a><span id="l4.58"> </span>
<a href="#l4.59"></a><span id="l4.59">     // create new event</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, 8);</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l4.67"></a><span id="l4.67"> </span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-    // fill in name, location, description</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-    event.waitForElement(titleTextBox);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-    event.type(titleTextBox, UTF8string);</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-      'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-      UTF8string);</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-      UTF8string);</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+        // fill in name, location, description</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+        let titleTextBox = eventlookup(`</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+        `);</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+        event.waitForElement(titleTextBox);</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+        event.type(titleTextBox, UTF8STRING);</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+        `), UTF8STRING);</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+        `), UTF8STRING);</span>
<a href="#l4.97"></a><span id="l4.97"> </span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-    // select category</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-      UTF8string);</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+        // select category</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+        event.select(eventid(&quot;item-categories&quot;), null, UTF8STRING);</span>
<a href="#l4.103"></a><span id="l4.103"> </span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-    // save</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+        // save</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+    });</span>
<a href="#l4.109"></a><span id="l4.109"> </span>
<a href="#l4.110"></a><span id="l4.110">     // open</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-    let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}');</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-    controller.waitForElement(eventBox);</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-    controller.doubleClick(eventBox);</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+    let eventPath = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${UTF8STRING.toLowerCase()}&quot;}`;</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, 8, eventPath);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l4.122"></a><span id="l4.122"> </span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-    // check values</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-    titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-    event.waitForElement(titleTextBox);</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-    event.assertValue(titleTextBox, UTF8string);</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-      'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-      UTF8string);</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-      UTF8string);</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-    event.assertValue(new elementslib.ID(event.window.document, &quot;item-categories&quot;),</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-      UTF8string);</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+        // check values</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+        titleTextBox = eventlookup(`</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+        `);</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+        event.waitForElement(titleTextBox);</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+        event.assertValue(titleTextBox, UTF8STRING);</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineplus">+        event.assertValue(eventlookup(`</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+        `), UTF8STRING);</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+        event.assertValue(eventlookup(`</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineplus">+        `), UTF8STRING);</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+        event.assertValue(eventid(&quot;item-categories&quot;), UTF8STRING);</span>
<a href="#l4.155"></a><span id="l4.155"> </span>
<a href="#l4.156"></a><span id="l4.156" class="difflineminus">-    // escape the event window</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-    event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-};</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+        // escape the event window</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+        event.keypress(null, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+    });</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+}</span>
<a href="#l4.163"></a><span id="l4.163"> </span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-    calUtils.deleteCalendars(controller, UTF8string);</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-    prefs.preferences.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-};</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+    deleteCalendars(controller, UTF8STRING);</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineplus">+    Preferences.reset(&quot;calendar.categories.names&quot;);</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">old mode 100644</span>
<a href="#l5.2"></a><span id="l5.2">new mode 100755</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineminus">--- a/calendar/test/mozmill/mozmilltests.list</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineplus">+++ b/calendar/test/mozmill/mozmilltests.list</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineat">@@ -1,3 +1,4 @@</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+testAlarmDefaultValue.js</span>
<a href="#l5.7"></a><span id="l5.7"> testBasicFunctionality.js</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+testLocalICS.js</span>
<a href="#l5.9"></a><span id="l5.9"> testTodayPane.js</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-testLocalICS.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">old mode 100644</span>
<a href="#l6.2"></a><span id="l6.2">new mode 100755</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineat">@@ -1,84 +1,86 @@</span>
<a href="#l6.6"></a><span id="l6.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.7"></a><span id="l6.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.8"></a><span id="l6.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l6.13"></a><span id="l6.13"> </span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-var sleep = 500;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-var startYear = 1950;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-var epoch = 1970;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+var CALENDARNAME, ALLDAY;</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+var STARTYEAR = 1950;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+var EPOCH = 1970;</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+function setupModule(module) {</span>
<a href="#l6.27"></a><span id="l6.27">     controller = mozmill.getMail3PaneController();</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-};</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-var testAnnualRecurrence = function() {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+    ({</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+        helpersForController,</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+        createCalendar,</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+        deleteCalendars,</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+        switchToView,</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+        goToDate,</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+        ALLDAY</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+}</span>
<a href="#l6.48"></a><span id="l6.48"> </span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+function testAnnualRecurrence() {</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+    let EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    sleep();</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-    calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+    goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l6.60"></a><span id="l6.60"> </span>
<a href="#l6.61"></a><span id="l6.61">     // create yearly recurring all-day event</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-                   .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-    event.sleep(sleep);</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-      &quot;yearly&quot;);</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;yearly&quot;);</span>
<a href="#l6.77"></a><span id="l6.77"> </span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-    let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-    let box = &quot;&quot;;</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-    for (let i = 0; i &lt; checkYears.length; i++) {</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-        calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-        let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+        // save</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+    });</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+    let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+    for (let year of checkYears) {</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+        goToDate(controller, year, 1, 1);</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+        let date = new Date(year, 0, 1);</span>
<a href="#l6.91"></a><span id="l6.91">         let column = date.getDay() + 1;</span>
<a href="#l6.92"></a><span id="l6.92"> </span>
<a href="#l6.93"></a><span id="l6.93">         // day view</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-          eventPath;</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+        switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null, EVENTPATH));</span>
<a href="#l6.100"></a><span id="l6.100"> </span>
<a href="#l6.101"></a><span id="l6.101">         // week view</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined) +</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-          eventPath;</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+        switchToView(controller, &quot;week&quot;);</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;week&quot;, ALLDAY, null, column, null, EVENTPATH));</span>
<a href="#l6.108"></a><span id="l6.108"> </span>
<a href="#l6.109"></a><span id="l6.109">         // multiweek view</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-          eventPath;</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+        switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;multiweek&quot;, ALLDAY, 1, column, null, EVENTPATH));</span>
<a href="#l6.116"></a><span id="l6.116"> </span>
<a href="#l6.117"></a><span id="l6.117">         // month view</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineminus">-          eventPath;</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineplus">+        switchToView(controller, &quot;month&quot;);</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;month&quot;, ALLDAY, 1, column, null, EVENTPATH));</span>
<a href="#l6.124"></a><span id="l6.124">     }</span>
<a href="#l6.125"></a><span id="l6.125"> </span>
<a href="#l6.126"></a><span id="l6.126">     // delete event</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-    calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-      eventPath;</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineminus">-};</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+    goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, ALLDAY, null, 1, null) + EVENTPATH;</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+}</span>
<a href="#l6.144"></a><span id="l6.144"> </span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineminus">-};</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">old mode 100644</span>
<a href="#l7.2"></a><span id="l7.2">new mode 100755</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineat">@@ -1,106 +1,114 @@</span>
<a href="#l7.6"></a><span id="l7.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.7"></a><span id="l7.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.8"></a><span id="l7.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-var sleep = 500;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-var hour = 8;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+var switchToView, goToDate, handleOccurrencePrompt, viewForward;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+var HOUR = 8;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+function setupModule(module) {</span>
<a href="#l7.25"></a><span id="l7.25">     controller = mozmill.getMail3PaneController();</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-};</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+    ({</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+        helpersForController,</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+        createCalendar,</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+        deleteCalendars,</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+        switchToView,</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+        goToDate,</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+        viewForward,</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-var testBiweeklyRecurrence = function() {</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+}</span>
<a href="#l7.48"></a><span id="l7.48"> </span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+function testBiweeklyRecurrence() {</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+    let eventPath = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.58"></a><span id="l7.58"> </span>
<a href="#l7.59"></a><span id="l7.59">     // create biweekly event</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;bi.weekly&quot;);</span>
<a href="#l7.74"></a><span id="l7.74"> </span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-      eventPath;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+        // save</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+    });</span>
<a href="#l7.80"></a><span id="l7.80"> </span>
<a href="#l7.81"></a><span id="l7.81">     // check day view</span>
<a href="#l7.82"></a><span id="l7.82">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-        calUtils.forward(controller, 14);</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+        controller.assertNode(</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+            lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, eventPath)</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+        );</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+        viewForward(controller, 14);</span>
<a href="#l7.89"></a><span id="l7.89">     }</span>
<a href="#l7.90"></a><span id="l7.90"> </span>
<a href="#l7.91"></a><span id="l7.91">     // check week view</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.96"></a><span id="l7.96"> </span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-      eventPath;</span>
<a href="#l7.99"></a><span id="l7.99">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-        calUtils.forward(controller, 2);</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+        controller.assertNode(</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, eventPath)</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineplus">+        );</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineplus">+        viewForward(controller, 2);</span>
<a href="#l7.106"></a><span id="l7.106">     }</span>
<a href="#l7.107"></a><span id="l7.107"> </span>
<a href="#l7.108"></a><span id="l7.108">     // check multiweek view</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.113"></a><span id="l7.113"> </span>
<a href="#l7.114"></a><span id="l7.114">     // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l7.115"></a><span id="l7.115">     for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-          undefined) + eventPath;</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineminus">-          undefined) + eventPath;</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineplus">+        controller.assertNode(</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 1, 7, null, eventPath)</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+        );</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+        controller.assertNode(</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 3, 7, null, eventPath)</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+        );</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l7.130"></a><span id="l7.130">     }</span>
<a href="#l7.131"></a><span id="l7.131"> </span>
<a href="#l7.132"></a><span id="l7.132">     // check month view</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l7.137"></a><span id="l7.137"> </span>
<a href="#l7.138"></a><span id="l7.138">     // January</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined) +</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-      eventPath;</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 5, 7, null, eventPath));</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l7.145"></a><span id="l7.145"> </span>
<a href="#l7.146"></a><span id="l7.146">     // February</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineminus">-      eventPath;</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineminus">-      eventPath;</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, eventPath));</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, eventPath));</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l7.157"></a><span id="l7.157"> </span>
<a href="#l7.158"></a><span id="l7.158">     // March</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineminus">-      eventPath;</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineminus">-      eventPath;</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, eventPath));</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, eventPath));</span>
<a href="#l7.167"></a><span id="l7.167"> </span>
<a href="#l7.168"></a><span id="l7.168">     // delete event</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineminus">-};</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineplus">+    let box = lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, eventPath);</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineplus">+    controller.click(box);</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineplus">+    controller.waitForElementNotPresent(box);</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineplus">+}</span>
<a href="#l7.180"></a><span id="l7.180"> </span>
<a href="#l7.181"></a><span id="l7.181" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-};</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">old mode 100644</span>
<a href="#l8.2"></a><span id="l8.2">new mode 100755</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineat">@@ -1,205 +1,210 @@</span>
<a href="#l8.6"></a><span id="l8.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.7"></a><span id="l8.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.8"></a><span id="l8.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-var sleep = 500;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-var hour = 8;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+var switchToView, goToDate, viewForward, viewBack, handleOccurrencePrompt;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+var HOUR = 8;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+function setupModule(module) {</span>
<a href="#l8.26"></a><span id="l8.26">     controller = mozmill.getMail3PaneController();</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-};</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+    ({</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+        helpersForController,</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+        createCalendar,</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+        deleteCalendars,</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+        switchToView,</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+        goToDate,</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+        viewForward,</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+        viewBack,</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l8.45"></a><span id="l8.45"> </span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-var testDailyRecurrence = function() {</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+}</span>
<a href="#l8.50"></a><span id="l8.50"> </span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+function testDailyRecurrence() {</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.58"></a><span id="l8.58"> </span>
<a href="#l8.59"></a><span id="l8.59">     // create daily event</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-      &quot;daily&quot;);</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;daily&quot;);</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+        // save</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+    });</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80">     // check day view for 7 days</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-    let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined) +</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-      eventPath;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+    let daybox = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, null) + EVENTPATH;</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+    controller.waitForElement(lookup(daybox));</span>
<a href="#l8.86"></a><span id="l8.86"> </span>
<a href="#l8.87"></a><span id="l8.87">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+        controller.assertNode(lookup(daybox));</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l8.92"></a><span id="l8.92">     }</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94">     // check week view for 2 weeks</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.99"></a><span id="l8.99"> </span>
<a href="#l8.100"></a><span id="l8.100">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-          eventPath;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+        controller.assertNode(</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH)</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+        );</span>
<a href="#l8.107"></a><span id="l8.107">     }</span>
<a href="#l8.108"></a><span id="l8.108"> </span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l8.111"></a><span id="l8.111"> </span>
<a href="#l8.112"></a><span id="l8.112">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour) +</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-          eventPath;</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+        controller.assertNode(</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, 2, day, HOUR, EVENTPATH)</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+        );</span>
<a href="#l8.119"></a><span id="l8.119">     }</span>
<a href="#l8.120"></a><span id="l8.120"> </span>
<a href="#l8.121"></a><span id="l8.121">     // check multiweek view for 4 weeks</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.126"></a><span id="l8.126"> </span>
<a href="#l8.127"></a><span id="l8.127">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineminus">-        let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-          eventPath;</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+        controller.assertNode(</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH)</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineplus">+        );</span>
<a href="#l8.134"></a><span id="l8.134">     }</span>
<a href="#l8.135"></a><span id="l8.135"> </span>
<a href="#l8.136"></a><span id="l8.136">     for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l8.137"></a><span id="l8.137">         for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-            let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour) +</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineminus">-              eventPath;</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineminus">-            controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+            controller.assertNode(</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineplus">+                lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, week, day, HOUR, EVENTPATH)</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+            );</span>
<a href="#l8.144"></a><span id="l8.144">         }</span>
<a href="#l8.145"></a><span id="l8.145">     }</span>
<a href="#l8.146"></a><span id="l8.146"> </span>
<a href="#l8.147"></a><span id="l8.147">     // check month view for all 5 weeks</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.152"></a><span id="l8.152"> </span>
<a href="#l8.153"></a><span id="l8.153">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineminus">-        let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined) +</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineminus">-          eventPath;</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+        controller.assertNode(</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, 1, day, null, EVENTPATH)</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+        );</span>
<a href="#l8.160"></a><span id="l8.160">     }</span>
<a href="#l8.161"></a><span id="l8.161"> </span>
<a href="#l8.162"></a><span id="l8.162">     for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l8.163"></a><span id="l8.163">         for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-            let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined) +</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-              eventPath;</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-            controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+            controller.assertNode(</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineplus">+                lookupEventBox(&quot;month&quot;, EVENT_BOX, week, day, null, EVENTPATH)</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+            );</span>
<a href="#l8.170"></a><span id="l8.170">         }</span>
<a href="#l8.171"></a><span id="l8.171">     }</span>
<a href="#l8.172"></a><span id="l8.172"> </span>
<a href="#l8.173"></a><span id="l8.173">     // delete 3rd January occurrence</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineminus">-    let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineminus">-      eventPath;</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineminus">-    calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+    let saturday = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 1, 7, null) + EVENTPATH;</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+    controller.click(lookup(saturday));</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, false, false);</span>
<a href="#l8.183"></a><span id="l8.183"> </span>
<a href="#l8.184"></a><span id="l8.184">     // verify in all views</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineplus">+    controller.waitForElementNotPresent(lookup(saturday));</span>
<a href="#l8.187"></a><span id="l8.187"> </span>
<a href="#l8.188"></a><span id="l8.188" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineminus">-    saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-      eventPath;</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+    saturday = lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, 7, null, EVENTPATH);</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+    controller.assertNodeNotExist(saturday);</span>
<a href="#l8.195"></a><span id="l8.195"> </span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineminus">-    saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineminus">-      eventPath;</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineplus">+    saturday = lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH);</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineplus">+    controller.assertNodeNotExist(saturday);</span>
<a href="#l8.203"></a><span id="l8.203"> </span>
<a href="#l8.204"></a><span id="l8.204" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineminus">-    saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineminus">-      eventPath;</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+    saturday = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH);</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineplus">+    controller.assertNodeNotExist(saturday);</span>
<a href="#l8.211"></a><span id="l8.211"> </span>
<a href="#l8.212"></a><span id="l8.212">     // go to previous day to edit event to occur only on weekdays</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineminus">-    calUtils.back(controller, 1);</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineminus">-</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineminus">-    calUtils.handleParentModification(controller, false);</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineminus">-        eventPath));</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+    viewBack(controller, 1);</span>
<a href="#l8.220"></a><span id="l8.220"> </span>
<a href="#l8.221"></a><span id="l8.221" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l8.224"></a><span id="l8.224" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineplus">+    handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true, false);</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l8.228"></a><span id="l8.228"> </span>
<a href="#l8.229"></a><span id="l8.229" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineminus">-      &quot;every.weekday&quot;);</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;every.weekday&quot;);</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l8.237"></a><span id="l8.237" class="difflineplus">+    });</span>
<a href="#l8.238"></a><span id="l8.238"> </span>
<a href="#l8.239"></a><span id="l8.239">     // check day view for 7 days</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineminus">-      eventPath;</span>
<a href="#l8.242"></a><span id="l8.242" class="difflineminus">-    let dates = [[2009, 1, 3],</span>
<a href="#l8.243"></a><span id="l8.243" class="difflineminus">-                 [2009, 1, 4]];</span>
<a href="#l8.244"></a><span id="l8.244" class="difflineminus">-    for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l8.245"></a><span id="l8.245" class="difflineminus">-        calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l8.246"></a><span id="l8.246" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l8.247"></a><span id="l8.247" class="difflineplus">+    let day = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, null) + EVENTPATH;</span>
<a href="#l8.248"></a><span id="l8.248" class="difflineplus">+    let dates = [</span>
<a href="#l8.249"></a><span id="l8.249" class="difflineplus">+        [2009, 1, 3],</span>
<a href="#l8.250"></a><span id="l8.250" class="difflineplus">+        [2009, 1, 4]</span>
<a href="#l8.251"></a><span id="l8.251" class="difflineplus">+    ];</span>
<a href="#l8.252"></a><span id="l8.252" class="difflineplus">+    for (let [y, m, d] of dates) {</span>
<a href="#l8.253"></a><span id="l8.253" class="difflineplus">+        goToDate(controller, y, m, d);</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineplus">+        controller.assertNodeNotExist(lookup(day));</span>
<a href="#l8.255"></a><span id="l8.255">     }</span>
<a href="#l8.256"></a><span id="l8.256"> </span>
<a href="#l8.257"></a><span id="l8.257">     // check week view for 2 weeks</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.262"></a><span id="l8.262"> </span>
<a href="#l8.263"></a><span id="l8.263">     for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l8.264"></a><span id="l8.264" class="difflineminus">-        let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l8.265"></a><span id="l8.265" class="difflineminus">-          eventPath;</span>
<a href="#l8.266"></a><span id="l8.266" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l8.267"></a><span id="l8.267" class="difflineminus">-        weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l8.268"></a><span id="l8.268" class="difflineminus">-          eventPath;</span>
<a href="#l8.269"></a><span id="l8.269" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l8.270"></a><span id="l8.270" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l8.271"></a><span id="l8.271" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l8.272"></a><span id="l8.272" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, null, EVENTPATH)</span>
<a href="#l8.273"></a><span id="l8.273" class="difflineplus">+        );</span>
<a href="#l8.274"></a><span id="l8.274" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l8.275"></a><span id="l8.275" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH)</span>
<a href="#l8.276"></a><span id="l8.276" class="difflineplus">+        );</span>
<a href="#l8.277"></a><span id="l8.277" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l8.278"></a><span id="l8.278">     }</span>
<a href="#l8.279"></a><span id="l8.279"> </span>
<a href="#l8.280"></a><span id="l8.280">     // check multiweek view for 4 weeks</span>
<a href="#l8.281"></a><span id="l8.281" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.283"></a><span id="l8.283" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l8.284"></a><span id="l8.284" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.285"></a><span id="l8.285"> </span>
<a href="#l8.286"></a><span id="l8.286">     for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l8.287"></a><span id="l8.287" class="difflineminus">-        let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l8.288"></a><span id="l8.288" class="difflineminus">-          eventPath;</span>
<a href="#l8.289"></a><span id="l8.289" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l8.290"></a><span id="l8.290" class="difflineminus">-        mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l8.291"></a><span id="l8.291" class="difflineminus">-          eventPath;</span>
<a href="#l8.292"></a><span id="l8.292" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l8.293"></a><span id="l8.293" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l8.294"></a><span id="l8.294" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l8.295"></a><span id="l8.295" class="difflineplus">+        );</span>
<a href="#l8.296"></a><span id="l8.296" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l8.297"></a><span id="l8.297" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 7, null, EVENTPATH)</span>
<a href="#l8.298"></a><span id="l8.298" class="difflineplus">+        );</span>
<a href="#l8.299"></a><span id="l8.299">     }</span>
<a href="#l8.300"></a><span id="l8.300"> </span>
<a href="#l8.301"></a><span id="l8.301">     // check month view for all 5 weeks</span>
<a href="#l8.302"></a><span id="l8.302" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l8.303"></a><span id="l8.303" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.304"></a><span id="l8.304" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l8.305"></a><span id="l8.305" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l8.306"></a><span id="l8.306"> </span>
<a href="#l8.307"></a><span id="l8.307">     for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l8.308"></a><span id="l8.308" class="difflineminus">-        let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l8.309"></a><span id="l8.309" class="difflineminus">-          eventPath;</span>
<a href="#l8.310"></a><span id="l8.310" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l8.311"></a><span id="l8.311" class="difflineminus">-        mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l8.312"></a><span id="l8.312" class="difflineminus">-          eventPath;</span>
<a href="#l8.313"></a><span id="l8.313" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l8.314"></a><span id="l8.314" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l8.315"></a><span id="l8.315" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l8.316"></a><span id="l8.316" class="difflineplus">+        );</span>
<a href="#l8.317"></a><span id="l8.317" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l8.318"></a><span id="l8.318" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 7, null, EVENTPATH)</span>
<a href="#l8.319"></a><span id="l8.319" class="difflineplus">+        );</span>
<a href="#l8.320"></a><span id="l8.320">     }</span>
<a href="#l8.321"></a><span id="l8.321"> </span>
<a href="#l8.322"></a><span id="l8.322">     // delete event</span>
<a href="#l8.323"></a><span id="l8.323" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined) +</span>
<a href="#l8.324"></a><span id="l8.324" class="difflineminus">-      eventPath;</span>
<a href="#l8.325"></a><span id="l8.325" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l8.326"></a><span id="l8.326" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l8.328"></a><span id="l8.328" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l8.329"></a><span id="l8.329" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l8.330"></a><span id="l8.330" class="difflineminus">-};</span>
<a href="#l8.331"></a><span id="l8.331" class="difflineplus">+    day = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 1, 5, null) + EVENTPATH;</span>
<a href="#l8.332"></a><span id="l8.332" class="difflineplus">+    controller.click(lookup(day));</span>
<a href="#l8.333"></a><span id="l8.333" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineplus">+    controller.waitForElementNotPresent(lookup(day));</span>
<a href="#l8.335"></a><span id="l8.335" class="difflineplus">+}</span>
<a href="#l8.336"></a><span id="l8.336"> </span>
<a href="#l8.337"></a><span id="l8.337" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l8.338"></a><span id="l8.338" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l8.339"></a><span id="l8.339" class="difflineminus">-};</span>
<a href="#l8.340"></a><span id="l8.340" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l8.341"></a><span id="l8.341" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l8.342"></a><span id="l8.342" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">old mode 100644</span>
<a href="#l9.2"></a><span id="l9.2">new mode 100755</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineat">@@ -1,124 +1,142 @@</span>
<a href="#l9.6"></a><span id="l9.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.7"></a><span id="l9.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.8"></a><span id="l9.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+var deleteCalendars, switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+</span>
<a href="#l9.18"></a><span id="l9.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-var sleep = 500;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-var hour = 8;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+var HOUR = 8;</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+function setupModule(module) {</span>
<a href="#l9.27"></a><span id="l9.27">     controller = mozmill.getMail3PaneController();</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-};</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+    ({</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+        helpersForController,</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+        createCalendar,</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+        deleteCalendars,</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+        switchToView,</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+        goToDate,</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-var testLastDayOfMonthRecurrence = function() {</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-    calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+}</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+function testLastDayOfMonthRecurrence() {</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+    let eventPath = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+    goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60">     // create monthly recurring event</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-      &quot;custom&quot;);</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l9.79"></a><span id="l9.79"> </span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+    });</span>
<a href="#l9.84"></a><span id="l9.84"> </span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-    //                        date     correct row in month view</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+    //                   year mo day  correct row in month view</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+    //                   vvvv vv vvv  v</span>
<a href="#l9.88"></a><span id="l9.88">     let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l9.89"></a><span id="l9.89">                         [2008, 2, 29, 5],</span>
<a href="#l9.90"></a><span id="l9.90">                         [2008, 3, 31, 6],</span>
<a href="#l9.91"></a><span id="l9.91">                         [2008, 4, 30, 5],</span>
<a href="#l9.92"></a><span id="l9.92">                         [2008, 5, 31, 5],</span>
<a href="#l9.93"></a><span id="l9.93">                         [2008, 6, 30, 5],</span>
<a href="#l9.94"></a><span id="l9.94">                         [2008, 7, 31, 5],</span>
<a href="#l9.95"></a><span id="l9.95">                         [2008, 8, 31, 6],</span>
<a href="#l9.96"></a><span id="l9.96">                         [2008, 9, 30, 5],</span>
<a href="#l9.97"></a><span id="l9.97">                         [2008, 10, 31, 5],</span>
<a href="#l9.98"></a><span id="l9.98">                         [2008, 11, 30, 6],</span>
<a href="#l9.99"></a><span id="l9.99">                         [2008, 12, 31, 5],</span>
<a href="#l9.100"></a><span id="l9.100">                         [2009, 1, 31, 5],</span>
<a href="#l9.101"></a><span id="l9.101">                         [2009, 2, 28, 4],</span>
<a href="#l9.102"></a><span id="l9.102">                         [2009, 3, 31, 5]];</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-    let box = &quot;&quot;;</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+    // check all dates</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+    for (let [y, m, d, correctRow] of checkingData) {</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+        let date = new Date(y, m - 1, d);</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+        let column = date.getDay() + 1;</span>
<a href="#l9.108"></a><span id="l9.108"> </span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-    // check all dates</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-    for (let i = 0; i &lt; checkingData.length; i++) {</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-        calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+        goToDate(controller, y, m, d);</span>
<a href="#l9.113"></a><span id="l9.113"> </span>
<a href="#l9.114"></a><span id="l9.114">         // day view</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-          eventPath;</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineplus">+        switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+            lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, eventPath)</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+        );</span>
<a href="#l9.123"></a><span id="l9.123"> </span>
<a href="#l9.124"></a><span id="l9.124">         // week view</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-        let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineminus">-        let column = date.getDay() + 1;</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour) +</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-          eventPath;</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+        switchToView(controller, &quot;week&quot;);</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, column, HOUR, eventPath)</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+        );</span>
<a href="#l9.135"></a><span id="l9.135"> </span>
<a href="#l9.136"></a><span id="l9.136">         // multiweek view</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineminus">-        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined) +</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-          eventPath;</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+        switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+        controller.assertNode(</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, column, null, eventPath)</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+        );</span>
<a href="#l9.145"></a><span id="l9.145"> </span>
<a href="#l9.146"></a><span id="l9.146">         // month view</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineminus">-          column, undefined) + eventPath;</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineplus">+        switchToView(controller, &quot;month&quot;);</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+        controller.assertNode(</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, correctRow, column, null, eventPath)</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+        );</span>
<a href="#l9.155"></a><span id="l9.155">     }</span>
<a href="#l9.156"></a><span id="l9.156"> </span>
<a href="#l9.157"></a><span id="l9.157">     // delete event</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-    calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-      undefined, 1, hour) + eventPath;</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-};</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineplus">+    goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + eventPath;</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+    controller.waitThenClick(lookup(box));</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+}</span>
<a href="#l9.175"></a><span id="l9.175"> </span>
<a href="#l9.176"></a><span id="l9.176"> function setRecurrence(recurrence) {</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineplus">+    let {</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineplus">+        sleep: recsleep,</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineplus">+        lookup: reclookup,</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineplus">+        eid: recid</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineplus">+    } = helpersForController(recurrence);</span>
<a href="#l9.183"></a><span id="l9.183"> </span>
<a href="#l9.184"></a><span id="l9.184">     // monthly</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-      undefined, &quot;2&quot;);</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineplus">+    recsleep();</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;2&quot;);</span>
<a href="#l9.189"></a><span id="l9.189"> </span>
<a href="#l9.190"></a><span id="l9.190">     // last day of month</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineminus">-    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-      undefined, &quot;-1&quot;);</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineminus">-      undefined, &quot;-1&quot;);</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineplus">+    recurrence.click(recid(&quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineplus">+    recsleep();</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+    recurrence.select(recid(&quot;monthly-ordinal&quot;), null, null, &quot;-1&quot;);</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineplus">+    recsleep();</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+    recurrence.select(recid(&quot;monthly-weekday&quot;), null, null, &quot;-1&quot;);</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+    recsleep();</span>
<a href="#l9.205"></a><span id="l9.205"> </span>
<a href="#l9.206"></a><span id="l9.206">     // close dialog</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineminus">-      '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineplus">+    `));</span>
<a href="#l9.213"></a><span id="l9.213"> }</span>
<a href="#l9.214"></a><span id="l9.214"> </span>
<a href="#l9.215"></a><span id="l9.215" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-};</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">old mode 100644</span>
<a href="#l10.2"></a><span id="l10.2">new mode 100755</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineat">@@ -1,145 +1,174 @@</span>
<a href="#l10.6"></a><span id="l10.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.7"></a><span id="l10.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.8"></a><span id="l10.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+</span>
<a href="#l10.18"></a><span id="l10.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l10.19"></a><span id="l10.19"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-var hour = 8;</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+var HOUR = 8;</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+function setupModule(module) {</span>
<a href="#l10.30"></a><span id="l10.30">     controller = mozmill.getMail3PaneController();</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-};</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+    ({</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+        helpersForController,</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+        createCalendar,</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+        deleteCalendars,</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+        switchToView,</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+        goToDate,</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+        viewForward,</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-var testWeeklyNRecurrence = function() {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+}</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+function testWeeklyNRecurrence() {</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l10.60"></a><span id="l10.60"> </span>
<a href="#l10.61"></a><span id="l10.61">     // create weekly recurring event</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l10.69"></a><span id="l10.69"> </span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l10.78"></a><span id="l10.78"> </span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+    });</span>
<a href="#l10.82"></a><span id="l10.82"> </span>
<a href="#l10.83"></a><span id="l10.83">     // check day view</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-      eventPath;</span>
<a href="#l10.86"></a><span id="l10.86"> </span>
<a href="#l10.87"></a><span id="l10.87">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l10.88"></a><span id="l10.88">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+        controller.assertNode(</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+            lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH)</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+        );</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l10.95"></a><span id="l10.95">     }</span>
<a href="#l10.96"></a><span id="l10.96"> </span>
<a href="#l10.97"></a><span id="l10.97">     // Saturday</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+    controller.assertNodeNotExist(lookup(box));</span>
<a href="#l10.102"></a><span id="l10.102"> </span>
<a href="#l10.103"></a><span id="l10.103">     // check week view</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l10.106"></a><span id="l10.106"> </span>
<a href="#l10.107"></a><span id="l10.107">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l10.108"></a><span id="l10.108">     for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour) +</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-          eventPath;</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, i, HOUR, EVENTPATH)</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+        );</span>
<a href="#l10.115"></a><span id="l10.115">     }</span>
<a href="#l10.116"></a><span id="l10.116"> </span>
<a href="#l10.117"></a><span id="l10.117">     // Saturday</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-      eventPath;</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH)</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+    );</span>
<a href="#l10.124"></a><span id="l10.124"> </span>
<a href="#l10.125"></a><span id="l10.125">     // check multiweek view</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l10.128"></a><span id="l10.128">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l10.129"></a><span id="l10.129"> </span>
<a href="#l10.130"></a><span id="l10.130">     // check month view</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l10.133"></a><span id="l10.133">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l10.134"></a><span id="l10.134"> </span>
<a href="#l10.135"></a><span id="l10.135">     // delete event</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour) +</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineminus">-      eventPath;</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-};</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+    let box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 2, 2, HOUR) + EVENTPATH;</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+}</span>
<a href="#l10.149"></a><span id="l10.149"> </span>
<a href="#l10.150"></a><span id="l10.150"> function setRecurrence(recurrence) {</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+    let {</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+        sleep: recsleep,</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+        lookup: reclookup,</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+        eid: recid</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+    } = helpersForController(recurrence);</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+</span>
<a href="#l10.157"></a><span id="l10.157">     // weekly</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+    recsleep();</span>
<a href="#l10.164"></a><span id="l10.164"> </span>
<a href="#l10.165"></a><span id="l10.165">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l10.166"></a><span id="l10.166">     let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l10.167"></a><span id="l10.167">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l10.168"></a><span id="l10.168">     let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l10.169"></a><span id="l10.169">     let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l10.170"></a><span id="l10.170"> </span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+    let days = `</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+    `;</span>
<a href="#l10.181"></a><span id="l10.181"> </span>
<a href="#l10.182"></a><span id="l10.182">     // starting from Monday so it should be checked</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l10.185"></a><span id="l10.185">     // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${thu}&quot;}`));</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${sat}&quot;}`));</span>
<a href="#l10.194"></a><span id="l10.194"> </span>
<a href="#l10.195"></a><span id="l10.195">     // set number of occurrences</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineminus">-    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineminus">-    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineminus">-      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/' +</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+    recurrence.click(recid(&quot;recurrence-range-for&quot;));</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineplus">+    let input = `</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+        id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+        id(&quot;repeat-ntimes-count&quot;)/</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+    `;</span>
<a href="#l10.208"></a><span id="l10.208">     // replace previous number</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineminus">-    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineminus">-    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineplus">+    recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineplus">+    recurrence.type(reclookup(input), &quot;4&quot;);</span>
<a href="#l10.213"></a><span id="l10.213"> </span>
<a href="#l10.214"></a><span id="l10.214">     // close dialog</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineplus">+    `));</span>
<a href="#l10.221"></a><span id="l10.221"> }</span>
<a href="#l10.222"></a><span id="l10.222"> </span>
<a href="#l10.223"></a><span id="l10.223"> function checkMultiWeekView(view) {</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineminus">-    let week = 1;</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineminus">-</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineminus">-    // in month view event starts from 2nd row</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineminus">-    if (view == &quot;month&quot;) {</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineminus">-        week++;</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineminus">-    }</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineplus">+    // In month view event starts from 2nd row</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+    let week = view == &quot;month&quot; ? 2 : 1;</span>
<a href="#l10.232"></a><span id="l10.232"> </span>
<a href="#l10.233"></a><span id="l10.233">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l10.234"></a><span id="l10.234">     for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineminus">-        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined) +</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineminus">-          eventPath;</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+        controller.assertNode(</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, i, null, EVENTPATH)</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+        );</span>
<a href="#l10.241"></a><span id="l10.241">     }</span>
<a href="#l10.242"></a><span id="l10.242"> </span>
<a href="#l10.243"></a><span id="l10.243">     // Saturday</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined) +</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineminus">-      eventPath;</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineplus">+        getEventBoxPath(view, EVENT_BOX, week, 7, null, EVENTPATH)</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineplus">+    );</span>
<a href="#l10.250"></a><span id="l10.250"> }</span>
<a href="#l10.251"></a><span id="l10.251"> </span>
<a href="#l10.252"></a><span id="l10.252" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineminus">-};</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">old mode 100644</span>
<a href="#l11.2"></a><span id="l11.2">new mode 100755</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineat">@@ -1,188 +1,214 @@</span>
<a href="#l11.6"></a><span id="l11.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.7"></a><span id="l11.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.8"></a><span id="l11.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+</span>
<a href="#l11.18"></a><span id="l11.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l11.19"></a><span id="l11.19"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+var ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-var hour = 8;</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+var HOUR = 8;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+function setupModule(module) {</span>
<a href="#l11.33"></a><span id="l11.33">     controller = mozmill.getMail3PaneController();</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-};</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+    ({</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+        helpersForController,</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+        createCalendar,</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+        deleteCalendars,</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+        switchToView,</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+        goToDate,</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l11.50"></a><span id="l11.50"> </span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-var testWeeklyUntilRecurrence = function() {</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+    createCalendar(controller, calendar);</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+}</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+function testWeeklyUntilRecurrence() {</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+    goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l11.62"></a><span id="l11.62"> </span>
<a href="#l11.63"></a><span id="l11.63">     // create weekly recurring event</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l11.71"></a><span id="l11.71"> </span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l11.80"></a><span id="l11.80"> </span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+        event.click(eventid(&quot;button-save&quot;));</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+    });</span>
<a href="#l11.85"></a><span id="l11.85"> </span>
<a href="#l11.86"></a><span id="l11.86" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-      eventPath;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+    let box = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l11.89"></a><span id="l11.89"> </span>
<a href="#l11.90"></a><span id="l11.90">     // check day view</span>
<a href="#l11.91"></a><span id="l11.91">     for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l11.92"></a><span id="l11.92">         // Monday</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-        calUtils.forward(controller, 2);</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+        controller.assertNode(lookup(box));</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+        forward(controller, 2);</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+</span>
<a href="#l11.98"></a><span id="l11.98">         // Wednesday</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-        calUtils.forward(controller, 2);</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+        controller.assertNode(lookup(box));</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+        forward(controller, 2);</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+</span>
<a href="#l11.104"></a><span id="l11.104">         // Friday</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-        calUtils.forward(controller, 3);</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+        controller.assertNode(lookup(box));</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+        forward(controller, 3);</span>
<a href="#l11.109"></a><span id="l11.109">     }</span>
<a href="#l11.110"></a><span id="l11.110"> </span>
<a href="#l11.111"></a><span id="l11.111">     // Monday, last occurrence</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineminus">-    calUtils.forward(controller, 2);</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+    controller.assertNode(lookup(box));</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+    forward(controller, 2);</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+</span>
<a href="#l11.117"></a><span id="l11.117">     // Wednesday</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineminus">-    calUtils.forward(controller, 2);</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+    controller.assertNodeNotExist(lookup(box));</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+    forward(controller, 2);</span>
<a href="#l11.122"></a><span id="l11.122"> </span>
<a href="#l11.123"></a><span id="l11.123">     // check week view</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.128"></a><span id="l11.128">     for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l11.129"></a><span id="l11.129">         // Monday</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-          eventPath;</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+        );</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+</span>
<a href="#l11.137"></a><span id="l11.137">         // Wednesday</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineminus">-          eventPath;</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+        );</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+</span>
<a href="#l11.145"></a><span id="l11.145">         // Friday</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour) +</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-          eventPath;</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR, EVENTPATH)</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+        );</span>
<a href="#l11.152"></a><span id="l11.152"> </span>
<a href="#l11.153"></a><span id="l11.153" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+        forward(controller, 1);</span>
<a href="#l11.155"></a><span id="l11.155">     }</span>
<a href="#l11.156"></a><span id="l11.156"> </span>
<a href="#l11.157"></a><span id="l11.157">     // Monday, last occurrence</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-      eventPath;</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+    controller.assertNode(</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+    );</span>
<a href="#l11.164"></a><span id="l11.164">     // Wednesday</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-      eventPath;</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+    );</span>
<a href="#l11.171"></a><span id="l11.171"> </span>
<a href="#l11.172"></a><span id="l11.172">     // check multiweek view</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.177"></a><span id="l11.177">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l11.178"></a><span id="l11.178"> </span>
<a href="#l11.179"></a><span id="l11.179">     // check month view</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l11.184"></a><span id="l11.184">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l11.185"></a><span id="l11.185"> </span>
<a href="#l11.186"></a><span id="l11.186">     // delete event</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined) +</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineminus">-      eventPath;</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineminus">-};</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+    box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 2, 2, null) + EVENTPATH;</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+}</span>
<a href="#l11.200"></a><span id="l11.200"> </span>
<a href="#l11.201"></a><span id="l11.201"> function setRecurrence(recurrence) {</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+    let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+</span>
<a href="#l11.204"></a><span id="l11.204">     // weekly</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+    recsleep();</span>
<a href="#l11.211"></a><span id="l11.211"> </span>
<a href="#l11.212"></a><span id="l11.212">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l11.213"></a><span id="l11.213">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l11.214"></a><span id="l11.214">     let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l11.215"></a><span id="l11.215"> </span>
<a href="#l11.216"></a><span id="l11.216" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineplus">+    let days = `</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineplus">+        [1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineplus">+    `;</span>
<a href="#l11.225"></a><span id="l11.225"> </span>
<a href="#l11.226"></a><span id="l11.226">     // starting from Monday so it should be checked</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l11.229"></a><span id="l11.229">     // check Wednesday and Friday too</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l11.234"></a><span id="l11.234"> </span>
<a href="#l11.235"></a><span id="l11.235">     // set until date</span>
<a href="#l11.236"></a><span id="l11.236" class="difflineminus">-    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineminus">-    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l11.238"></a><span id="l11.238" class="difflineminus">-      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/' +</span>
<a href="#l11.239"></a><span id="l11.239" class="difflineminus">-      'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l11.240"></a><span id="l11.240" class="difflineminus">-      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l11.241"></a><span id="l11.241" class="difflineplus">+    recurrence.click(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineplus">+    let input = `</span>
<a href="#l11.243"></a><span id="l11.243" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l11.244"></a><span id="l11.244" class="difflineplus">+        id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/</span>
<a href="#l11.245"></a><span id="l11.245" class="difflineplus">+        id(&quot;repeat-until-date&quot;)/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l11.246"></a><span id="l11.246" class="difflineplus">+        {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineplus">+        anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineplus">+    `;</span>
<a href="#l11.250"></a><span id="l11.250">     // delete previous date</span>
<a href="#l11.251"></a><span id="l11.251" class="difflineminus">-    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineminus">-    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineplus">+    recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineplus">+    recurrence.keypress(reclookup(input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l11.255"></a><span id="l11.255"> </span>
<a href="#l11.256"></a><span id="l11.256">     let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l11.257"></a><span id="l11.257">                        .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l11.258"></a><span id="l11.258" class="difflineminus">-    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l11.259"></a><span id="l11.259" class="difflineminus">-                                               endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l11.260"></a><span id="l11.260" class="difflineminus">-    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineplus">+    let ymd = [ENDDATE.getFullYear(), ENDDATE.getMonth() + 1, ENDDATE.getDate()];</span>
<a href="#l11.262"></a><span id="l11.262" class="difflineplus">+    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l11.263"></a><span id="l11.263" class="difflineplus">+    recurrence.type(reclookup(input), endDateString);</span>
<a href="#l11.264"></a><span id="l11.264"> </span>
<a href="#l11.265"></a><span id="l11.265">     // close dialog</span>
<a href="#l11.266"></a><span id="l11.266" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l11.267"></a><span id="l11.267" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l11.268"></a><span id="l11.268" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l11.269"></a><span id="l11.269" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l11.270"></a><span id="l11.270" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l11.271"></a><span id="l11.271" class="difflineplus">+    `));</span>
<a href="#l11.272"></a><span id="l11.272"> }</span>
<a href="#l11.273"></a><span id="l11.273"> </span>
<a href="#l11.274"></a><span id="l11.274"> function checkMultiWeekView(view) {</span>
<a href="#l11.275"></a><span id="l11.275" class="difflineminus">-    let startWeek = 1;</span>
<a href="#l11.276"></a><span id="l11.276" class="difflineminus">-</span>
<a href="#l11.277"></a><span id="l11.277" class="difflineminus">-    // in month view event starts from 2nd row</span>
<a href="#l11.278"></a><span id="l11.278" class="difflineminus">-    if (view == &quot;month&quot;) {</span>
<a href="#l11.279"></a><span id="l11.279" class="difflineminus">-        startWeek++;</span>
<a href="#l11.280"></a><span id="l11.280" class="difflineminus">-    }</span>
<a href="#l11.281"></a><span id="l11.281" class="difflineplus">+    let startWeek = view == &quot;month&quot; ? 2 : 1;</span>
<a href="#l11.282"></a><span id="l11.282"> </span>
<a href="#l11.283"></a><span id="l11.283">     for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l11.284"></a><span id="l11.284">         // Monday</span>
<a href="#l11.285"></a><span id="l11.285" class="difflineminus">-        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined) +</span>
<a href="#l11.286"></a><span id="l11.286" class="difflineminus">-          eventPath;</span>
<a href="#l11.287"></a><span id="l11.287" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.288"></a><span id="l11.288" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.289"></a><span id="l11.289" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, 2, null, EVENTPATH)</span>
<a href="#l11.290"></a><span id="l11.290" class="difflineplus">+        );</span>
<a href="#l11.291"></a><span id="l11.291">         // Wednesday</span>
<a href="#l11.292"></a><span id="l11.292" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined) +</span>
<a href="#l11.293"></a><span id="l11.293" class="difflineminus">-          eventPath;</span>
<a href="#l11.294"></a><span id="l11.294" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.295"></a><span id="l11.295" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.296"></a><span id="l11.296" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, 4, null, EVENTPATH)</span>
<a href="#l11.297"></a><span id="l11.297" class="difflineplus">+        );</span>
<a href="#l11.298"></a><span id="l11.298">         // Friday</span>
<a href="#l11.299"></a><span id="l11.299" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined) +</span>
<a href="#l11.300"></a><span id="l11.300" class="difflineminus">-          eventPath;</span>
<a href="#l11.301"></a><span id="l11.301" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.302"></a><span id="l11.302" class="difflineplus">+        controller.assertNode(</span>
<a href="#l11.303"></a><span id="l11.303" class="difflineplus">+            lookupEventBox(view, EVENT_BOX, week, 6, null, EVENTPATH)</span>
<a href="#l11.304"></a><span id="l11.304" class="difflineplus">+        );</span>
<a href="#l11.305"></a><span id="l11.305">     }</span>
<a href="#l11.306"></a><span id="l11.306"> </span>
<a href="#l11.307"></a><span id="l11.307">     // Monday, last occurrence</span>
<a href="#l11.308"></a><span id="l11.308" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l11.309"></a><span id="l11.309" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l11.310"></a><span id="l11.310" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.311"></a><span id="l11.311" class="difflineplus">+    controller.assertNode(</span>
<a href="#l11.312"></a><span id="l11.312" class="difflineplus">+        lookupEventBox(view, EVENT_BOX, startWeek + 3, 2, null, EVENTPATH)</span>
<a href="#l11.313"></a><span id="l11.313" class="difflineplus">+    );</span>
<a href="#l11.314"></a><span id="l11.314" class="difflineplus">+</span>
<a href="#l11.315"></a><span id="l11.315">     // Wednesday</span>
<a href="#l11.316"></a><span id="l11.316" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l11.317"></a><span id="l11.317" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l11.318"></a><span id="l11.318" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l11.319"></a><span id="l11.319" class="difflineplus">+    controller.assertNode(</span>
<a href="#l11.320"></a><span id="l11.320" class="difflineplus">+        lookupEventBox(view, EVENT_BOX, startWeek + 3, 4, null, EVENTPATH)</span>
<a href="#l11.321"></a><span id="l11.321" class="difflineplus">+    );</span>
<a href="#l11.322"></a><span id="l11.322"> }</span>
<a href="#l11.323"></a><span id="l11.323"> </span>
<a href="#l11.324"></a><span id="l11.324" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l11.325"></a><span id="l11.325" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l11.326"></a><span id="l11.326" class="difflineminus">-};</span>
<a href="#l11.327"></a><span id="l11.327" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l11.328"></a><span id="l11.328" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l11.329"></a><span id="l11.329" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">old mode 100644</span>
<a href="#l12.2"></a><span id="l12.2">new mode 100755</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -1,297 +1,324 @@</span>
<a href="#l12.6"></a><span id="l12.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.7"></a><span id="l12.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.8"></a><span id="l12.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+</span>
<a href="#l12.18"></a><span id="l12.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l12.19"></a><span id="l12.19"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineminus">-var hour = 8;</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+var HOUR = 8;</span>
<a href="#l12.26"></a><span id="l12.26"> var startDate = new Date(2009, 0, 6);</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+function setupModule(module) {</span>
<a href="#l12.32"></a><span id="l12.32">     controller = mozmill.getMail3PaneController();</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-};</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+    ({</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+        helpersForController,</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+        createCalendar,</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+        deleteCalendars,</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+        switchToView,</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+        goToDate,</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+        viewForward,</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l12.50"></a><span id="l12.50"> </span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-var testWeeklyWithExceptionRecurrence = function() {</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+}</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.62"></a><span id="l12.62"> </span>
<a href="#l12.63"></a><span id="l12.63">     // create weekly recurring event</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l12.71"></a><span id="l12.71"> </span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l12.80"></a><span id="l12.80"> </span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineplus">+    });</span>
<a href="#l12.85"></a><span id="l12.85"> </span>
<a href="#l12.86"></a><span id="l12.86">     // move 5th January occurrence to 6th January</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-    calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineminus">-        eventPath));</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineminus">-    event.sleep(sleep);</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+    handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, false, false);</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l12.98"></a><span id="l12.98"> </span>
<a href="#l12.99"></a><span id="l12.99" class="difflineminus">-    let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineminus">-      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/' +</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineminus">-      'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineminus">-    let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineminus">-      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/' +</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-      'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+        let startDateInput = eventlookup(`</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineplus">+            /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+            id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineplus">+            id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+        `);</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+        let endDateInput = eventlookup(`</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+            /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+            id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+            id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+        `);</span>
<a href="#l12.129"></a><span id="l12.129"> </span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-    event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-    let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineminus">-                                               startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineminus">-    event.type(startDateInput, startDateString);</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineminus">-    // applies startdate change</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineminus">-    event.click(endDateInput);</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+        event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineplus">+        let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+                           .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineplus">+        let ymd = [startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate()];</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineplus">+        let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l12.143"></a><span id="l12.143"> </span>
<a href="#l12.144"></a><span id="l12.144" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+        event.type(startDateInput, startDateString);</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineplus">+        // applies startdate change</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineplus">+        event.click(endDateInput);</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineplus">+</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+    });</span>
<a href="#l12.152"></a><span id="l12.152"> </span>
<a href="#l12.153"></a><span id="l12.153">     // change recurrence rule</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineminus">-    calUtils.handleParentModification(controller, false);</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineminus">-        eventPath));</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineplus">+    goToDate(controller, 2009, 1, 7);</span>
<a href="#l12.162"></a><span id="l12.162" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineplus">+    handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true, false);</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l12.166"></a><span id="l12.166"> </span>
<a href="#l12.167"></a><span id="l12.167" class="difflineminus">-    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l12.168"></a><span id="l12.168" class="difflineminus">-    dialog.start(changeRecurrence);</span>
<a href="#l12.169"></a><span id="l12.169" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l12.170"></a><span id="l12.170" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l12.171"></a><span id="l12.171" class="difflineplus">+        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l12.172"></a><span id="l12.172" class="difflineplus">+        dialog.start(changeRecurrence);</span>
<a href="#l12.173"></a><span id="l12.173" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l12.175"></a><span id="l12.175"> </span>
<a href="#l12.176"></a><span id="l12.176" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineplus">+    });</span>
<a href="#l12.180"></a><span id="l12.180"> </span>
<a href="#l12.181"></a><span id="l12.181">     // check two weeks</span>
<a href="#l12.182"></a><span id="l12.182">     // day view</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-    let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineminus">-      eventPath;</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineplus">+    let path = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l12.188"></a><span id="l12.188"> </span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.193"></a><span id="l12.193"> </span>
<a href="#l12.194"></a><span id="l12.194" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineminus">-    let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-      'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineplus">+    let tuesPath = `</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+        id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineplus">+    `;</span>
<a href="#l12.209"></a><span id="l12.209">     // assert exactly two</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineminus">-      tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineminus">-      tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineminus">-      tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineplus">+    controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH));</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineplus">+    controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH));</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineplus">+    controller.assertNodeNotExist(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH));</span>
<a href="#l12.219"></a><span id="l12.219"> </span>
<a href="#l12.220"></a><span id="l12.220" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.240"></a><span id="l12.240"> </span>
<a href="#l12.241"></a><span id="l12.241">     // next week</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.266"></a><span id="l12.266"> </span>
<a href="#l12.267"></a><span id="l12.267">     // week view</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineminus">-</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineminus">-      eventPath;</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.276"></a><span id="l12.276"> </span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-    tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineminus">-      'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineminus">-    // assert exactly two</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineminus">-      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineminus">-      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineminus">-      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineplus">+    path = getEventBoxPath(&quot;week&quot;, EVENT_BOX, null, 2, HOUR) + EVENTPATH;</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l12.291"></a><span id="l12.291"> </span>
<a href="#l12.292"></a><span id="l12.292" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l12.293"></a><span id="l12.293" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.300"></a><span id="l12.300" class="difflineplus">+    tuesPath = `</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineplus">+        id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineplus">+    `;</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineplus">+    // assert exactly two</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineplus">+        tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+    ));</span>
<a href="#l12.312"></a><span id="l12.312" class="difflineplus">+    controller.assertNode(lookup(</span>
<a href="#l12.313"></a><span id="l12.313" class="difflineplus">+        tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH</span>
<a href="#l12.314"></a><span id="l12.314" class="difflineplus">+    ));</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineplus">+        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineplus">+    ));</span>
<a href="#l12.318"></a><span id="l12.318"> </span>
<a href="#l12.319"></a><span id="l12.319" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l12.320"></a><span id="l12.320" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l12.321"></a><span id="l12.321" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.328"></a><span id="l12.328" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l12.329"></a><span id="l12.329" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.332"></a><span id="l12.332" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR));</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, HOUR));</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR));</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineplus">+</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, HOUR));</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR));</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 3, HOUR));</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR));</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, HOUR));</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR));</span>
<a href="#l12.347"></a><span id="l12.347"> </span>
<a href="#l12.348"></a><span id="l12.348">     // multiweek view</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.351"></a><span id="l12.351" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l12.353"></a><span id="l12.353">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l12.354"></a><span id="l12.354"> </span>
<a href="#l12.355"></a><span id="l12.355">     // month view</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l12.358"></a><span id="l12.358">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l12.359"></a><span id="l12.359"> </span>
<a href="#l12.360"></a><span id="l12.360">     // delete event</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineminus">-      eventPath;</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineminus">-};</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineplus">+    goToDate(controller, 2009, 1, 12);</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineplus">+    path = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineplus">+    controller.click(lookup(path));</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineplus">+}</span>
<a href="#l12.378"></a><span id="l12.378"> </span>
<a href="#l12.379"></a><span id="l12.379"> function setRecurrence(recurrence) {</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineplus">+    let {</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineplus">+        sleep: recsleep,</span>
<a href="#l12.382"></a><span id="l12.382" class="difflineplus">+        lookup: reclookup,</span>
<a href="#l12.383"></a><span id="l12.383" class="difflineplus">+        eid: recid</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineplus">+    } = helpersForController(recurrence);</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineplus">+</span>
<a href="#l12.386"></a><span id="l12.386">     // weekly</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l12.391"></a><span id="l12.391" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineplus">+    recsleep();</span>
<a href="#l12.393"></a><span id="l12.393"> </span>
<a href="#l12.394"></a><span id="l12.394">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l12.395"></a><span id="l12.395">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l12.396"></a><span id="l12.396">     let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l12.397"></a><span id="l12.397"> </span>
<a href="#l12.398"></a><span id="l12.398" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l12.399"></a><span id="l12.399" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l12.400"></a><span id="l12.400" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineplus">+    let days = `</span>
<a href="#l12.402"></a><span id="l12.402" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l12.403"></a><span id="l12.403" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l12.404"></a><span id="l12.404" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l12.405"></a><span id="l12.405" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l12.406"></a><span id="l12.406" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l12.407"></a><span id="l12.407" class="difflineplus">+    `;</span>
<a href="#l12.408"></a><span id="l12.408"> </span>
<a href="#l12.409"></a><span id="l12.409">     // starting from Monday so it should be checked</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l12.412"></a><span id="l12.412">     // check Wednesday and Friday too</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l12.414"></a><span id="l12.414" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l12.415"></a><span id="l12.415" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l12.417"></a><span id="l12.417"> </span>
<a href="#l12.418"></a><span id="l12.418">     // close dialog</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l12.420"></a><span id="l12.420" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l12.424"></a><span id="l12.424" class="difflineplus">+    `));</span>
<a href="#l12.425"></a><span id="l12.425"> }</span>
<a href="#l12.426"></a><span id="l12.426"> </span>
<a href="#l12.427"></a><span id="l12.427"> function changeRecurrence(recurrence) {</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineplus">+    let {</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineplus">+        sleep: recsleep,</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineplus">+        lookup: reclookup,</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineplus">+        eid: recid</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineplus">+    } = helpersForController(recurrence);</span>
<a href="#l12.433"></a><span id="l12.433" class="difflineplus">+</span>
<a href="#l12.434"></a><span id="l12.434">     // weekly</span>
<a href="#l12.435"></a><span id="l12.435" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l12.436"></a><span id="l12.436" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l12.438"></a><span id="l12.438" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l12.439"></a><span id="l12.439" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l12.440"></a><span id="l12.440" class="difflineplus">+    recsleep();</span>
<a href="#l12.441"></a><span id="l12.441"> </span>
<a href="#l12.442"></a><span id="l12.442">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l12.443"></a><span id="l12.443">     let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l12.444"></a><span id="l12.444">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l12.445"></a><span id="l12.445">     let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l12.446"></a><span id="l12.446"> </span>
<a href="#l12.447"></a><span id="l12.447" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineplus">+    let days = `</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l12.452"></a><span id="l12.452" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})/</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineplus">+    `;</span>
<a href="#l12.457"></a><span id="l12.457"> </span>
<a href="#l12.458"></a><span id="l12.458">     // check old rule</span>
<a href="#l12.459"></a><span id="l12.459" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l12.465"></a><span id="l12.465"> </span>
<a href="#l12.466"></a><span id="l12.466">     // check Tuesday</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l12.469"></a><span id="l12.469"> </span>
<a href="#l12.470"></a><span id="l12.470">     // close dialog</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineplus">+    `));</span>
<a href="#l12.477"></a><span id="l12.477"> }</span>
<a href="#l12.478"></a><span id="l12.478"> </span>
<a href="#l12.479"></a><span id="l12.479"> function checkMultiWeekView(view) {</span>
<a href="#l12.480"></a><span id="l12.480">     let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l12.481"></a><span id="l12.481" class="difflineplus">+    let assertNodeLookup = (...args) =&gt; {</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineplus">+        return controller.assertNode(lookupEventBox(...args));</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineplus">+    };</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineplus">+    let assertNodeNotExistLookup = (...args) =&gt; {</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineplus">+        return controller.assertNodeNotExist(lookupEventBox(...args));</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineplus">+    };</span>
<a href="#l12.487"></a><span id="l12.487"> </span>
<a href="#l12.488"></a><span id="l12.488" class="difflineminus">-    let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 2, HOUR, EVENTPATH);</span>
<a href="#l12.491"></a><span id="l12.491">     // assert exactly two</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[0]&quot;));</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[1]&quot;));</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + &quot;/[2]&quot;));</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[0]&quot;);</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[1]&quot;);</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[2]&quot;);</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 4, HOUR, EVENTPATH);</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 5, HOUR, EVENTPATH);</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek, 6, HOUR, EVENTPATH);</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek, 7, HOUR, EVENTPATH);</span>
<a href="#l12.513"></a><span id="l12.513"> </span>
<a href="#l12.514"></a><span id="l12.514" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 1, HOUR, EVENTPATH);</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 2, HOUR, EVENTPATH);</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 3, HOUR, EVENTPATH);</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 4, HOUR, EVENTPATH);</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 5, HOUR, EVENTPATH);</span>
<a href="#l12.533"></a><span id="l12.533" class="difflineplus">+    assertNodeLookup(view, EVENT_BOX, startWeek + 1, 6, HOUR, EVENTPATH);</span>
<a href="#l12.534"></a><span id="l12.534" class="difflineplus">+    assertNodeNotExistLookup(view, EVENT_BOX, startWeek + 1, 7, HOUR, EVENTPATH);</span>
<a href="#l12.535"></a><span id="l12.535"> }</span>
<a href="#l12.536"></a><span id="l12.536"> </span>
<a href="#l12.537"></a><span id="l12.537" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineminus">-};</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l12.541"></a><span id="l12.541" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">old mode 100644</span>
<a href="#l13.2"></a><span id="l13.2">new mode 100755</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineat">@@ -1,96 +1,100 @@</span>
<a href="#l13.6"></a><span id="l13.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.7"></a><span id="l13.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.8"></a><span id="l13.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l13.13"></a><span id="l13.13"> </span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-var sleep = 500;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-var startYear = 1950;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-var epoch = 1970;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+var ALLDAY, CALENDARNAME;</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+var STARTYEAR = 1950;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+var EPOCH = 1970;</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+function setupModule(module) {</span>
<a href="#l13.27"></a><span id="l13.27">     controller = mozmill.getMail3PaneController();</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-};</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+    ({</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+        helpersForController,</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+        createCalendar,</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+        deleteCalendars,</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+        switchToView,</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+        goToDate,</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+        ALLDAY,</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+        CALENDARNAME</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l13.43"></a><span id="l13.43"> </span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-var testAnnualRecurrence = function() {</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+}</span>
<a href="#l13.48"></a><span id="l13.48"> </span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-    calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+function testAnnualRecurrence() {</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+    let EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+    goToDate(controller, STARTYEAR, 1, 1);</span>
<a href="#l13.57"></a><span id="l13.57"> </span>
<a href="#l13.58"></a><span id="l13.58">     // rotate view</span>
<a href="#l13.59"></a><span id="l13.59">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineminus">-    });</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66">     // create yearly recurring all-day event</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineminus">-                   .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-    event.sleep(sleep);</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-      &quot;yearly&quot;);</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null);</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l13.80"></a><span id="l13.80"> </span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-    let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;yearly&quot;);</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+        event.click(eventid(&quot;button-save&quot;));</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+    });</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+    let checkYears = [STARTYEAR, STARTYEAR + 1, EPOCH - 1, EPOCH, EPOCH + 1];</span>
<a href="#l13.87"></a><span id="l13.87">     let box = &quot;&quot;;</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-    for (let i = 0; i &lt; checkYears.length; i++) {</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-        calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-        let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+    for (let year of checkYears) {</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+        goToDate(controller, year, 1, 1);</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+        let date = new Date(year, 0, 1);</span>
<a href="#l13.94"></a><span id="l13.94">         let column = date.getDay() + 1;</span>
<a href="#l13.95"></a><span id="l13.95"> </span>
<a href="#l13.96"></a><span id="l13.96">         // day view</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineminus">-        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineminus">-          eventPath;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+        switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+        controller.assertNode(</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+            lookupEventBox(&quot;day&quot;, ALLDAY, null, 1, null, EVENTPATH)</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+        );</span>
<a href="#l13.105"></a><span id="l13.105"> </span>
<a href="#l13.106"></a><span id="l13.106">         // week view</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined) +</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-          eventPath;</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+        switchToView(controller, &quot;week&quot;);</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+        controller.assertNode(</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+            lookupEventBox(&quot;week&quot;, ALLDAY, null, column, null, EVENTPATH)</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+        );</span>
<a href="#l13.115"></a><span id="l13.115"> </span>
<a href="#l13.116"></a><span id="l13.116">         // multiweek view</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineminus">-          eventPath;</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+        switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+        controller.assertNode(</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, ALLDAY, 1, column, null, EVENTPATH)</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+        );</span>
<a href="#l13.125"></a><span id="l13.125"> </span>
<a href="#l13.126"></a><span id="l13.126">         // month view</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-          eventPath;</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+        switchToView(controller, &quot;month&quot;);</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+        controller.assertNode(</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+            lookupEventBox(&quot;month&quot;, ALLDAY, 1, column, null, EVENTPATH)</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+        );</span>
<a href="#l13.135"></a><span id="l13.135">     }</span>
<a href="#l13.136"></a><span id="l13.136"> </span>
<a href="#l13.137"></a><span id="l13.137">     // delete event</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-    calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineminus">-      eventPath;</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+    goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+    box = getEventBoxPath(&quot;day&quot;, ALLDAY, null, 1, null) + EVENTPATH;</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l13.153"></a><span id="l13.153"> </span>
<a href="#l13.154"></a><span id="l13.154">     // reset view</span>
<a href="#l13.155"></a><span id="l13.155">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-    });</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-};</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+}</span>
<a href="#l13.163"></a><span id="l13.163"> </span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-};</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">old mode 100644</span>
<a href="#l14.2"></a><span id="l14.2">new mode 100755</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineat">@@ -1,121 +1,116 @@</span>
<a href="#l14.6"></a><span id="l14.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.7"></a><span id="l14.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.8"></a><span id="l14.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-var sleep = 500;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-var hour = 8;</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+var HOUR = 8;</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+function setupModule(module) {</span>
<a href="#l14.26"></a><span id="l14.26">     controller = mozmill.getMail3PaneController();</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-};</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+    ({</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+        helpersForController,</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+        createCalendar,</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+        deleteCalendars,</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+        switchToView,</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+        goToDate,</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+        viewForward,</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l14.44"></a><span id="l14.44"> </span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-var testBiweeklyRecurrence = function() {</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+}</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+function testBiweeklyRecurrence() {</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.57"></a><span id="l14.57"> </span>
<a href="#l14.58"></a><span id="l14.58">     // rotate view</span>
<a href="#l14.59"></a><span id="l14.59">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineminus">-    });</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l14.65"></a><span id="l14.65"> </span>
<a href="#l14.66"></a><span id="l14.66">     // create biweekly event</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l14.74"></a><span id="l14.74"> </span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineminus">-</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-      eventPath;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;bi.weekly&quot;);</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+    });</span>
<a href="#l14.86"></a><span id="l14.86"> </span>
<a href="#l14.87"></a><span id="l14.87">     // check day view</span>
<a href="#l14.88"></a><span id="l14.88">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-        calUtils.forward(controller, 14);</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH));</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+        viewForward(controller, 14);</span>
<a href="#l14.93"></a><span id="l14.93">     }</span>
<a href="#l14.94"></a><span id="l14.94"> </span>
<a href="#l14.95"></a><span id="l14.95">     // check week view</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.100"></a><span id="l14.100"> </span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-      eventPath;</span>
<a href="#l14.103"></a><span id="l14.103">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-        calUtils.forward(2);</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH));</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+        viewForward(controller, 2);</span>
<a href="#l14.108"></a><span id="l14.108">     }</span>
<a href="#l14.109"></a><span id="l14.109"> </span>
<a href="#l14.110"></a><span id="l14.110">     // check multiweek view</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.115"></a><span id="l14.115"> </span>
<a href="#l14.116"></a><span id="l14.116">     // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l14.117"></a><span id="l14.117">     for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineminus">-          undefined) + eventPath;</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-          undefined) + eventPath;</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineplus">+        controller.assertNode(</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 1, 7, null, EVENTPATH)</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+        );</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+        controller.assertNode(</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+            getEventBoxPath(&quot;multiweek&quot;, EVENT_BOX, i % 2 + 3, 7, null, EVENTPATH)</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineplus">+        );</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l14.132"></a><span id="l14.132">     }</span>
<a href="#l14.133"></a><span id="l14.133"> </span>
<a href="#l14.134"></a><span id="l14.134">     // check month view</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineplus">+    goToDate(controller, 2009, 1, 31);</span>
<a href="#l14.139"></a><span id="l14.139"> </span>
<a href="#l14.140"></a><span id="l14.140">     // January</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined) +</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-      eventPath;</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 5, 7, null, EVENTPATH));</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l14.147"></a><span id="l14.147"> </span>
<a href="#l14.148"></a><span id="l14.148">     // February</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineminus">-      eventPath;</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineminus">-      eventPath;</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, EVENTPATH));</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l14.159"></a><span id="l14.159"> </span>
<a href="#l14.160"></a><span id="l14.160">     // March</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineminus">-      eventPath;</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineminus">-      eventPath;</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 2, 7, null, EVENTPATH));</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 4, 7, null, EVENTPATH));</span>
<a href="#l14.169"></a><span id="l14.169"> </span>
<a href="#l14.170"></a><span id="l14.170">     // delete event</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineplus">+    let box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 4, 7, null) + EVENTPATH;</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l14.180"></a><span id="l14.180"> </span>
<a href="#l14.181"></a><span id="l14.181">     // reset view</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l14.184"></a><span id="l14.184">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineminus">-    });</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineminus">-};</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineplus">+}</span>
<a href="#l14.192"></a><span id="l14.192"> </span>
<a href="#l14.193"></a><span id="l14.193" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">-};</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">old mode 100644</span>
<a href="#l15.2"></a><span id="l15.2">new mode 100755</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineat">@@ -1,220 +1,216 @@</span>
<a href="#l15.6"></a><span id="l15.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.7"></a><span id="l15.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.8"></a><span id="l15.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l15.13"></a><span id="l15.13"> </span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-var sleep = 500;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-var hour = 8;</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+var switchToView, goToDate, viewForward, viewBack, handleOccurrencePrompt;</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l15.20"></a><span id="l15.20"> </span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+var HOUR = 8;</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+function setupModule(module) {</span>
<a href="#l15.26"></a><span id="l15.26">     controller = mozmill.getMail3PaneController();</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-};</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+    ({</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+        helpersForController,</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+        createCalendar,</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+        deleteCalendars,</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+        switchToView,</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+        goToDate,</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+        viewForward,</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+        viewBack,</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l15.45"></a><span id="l15.45"> </span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-var testDailyRecurrence = function() {</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+}</span>
<a href="#l15.50"></a><span id="l15.50"> </span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+function testDailyRecurrence() {</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.58"></a><span id="l15.58"> </span>
<a href="#l15.59"></a><span id="l15.59">     // rotate view</span>
<a href="#l15.60"></a><span id="l15.60">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-    });</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l15.66"></a><span id="l15.66"> </span>
<a href="#l15.67"></a><span id="l15.67">     // create daily event</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l15.76"></a><span id="l15.76"> </span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineminus">-      &quot;daily&quot;);</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;daily&quot;);</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+    });</span>
<a href="#l15.85"></a><span id="l15.85"> </span>
<a href="#l15.86"></a><span id="l15.86">     // check day view for 7 days</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-    let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined) +</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-      eventPath;</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+    let daybox = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, null) + EVENTPATH;</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+    controller.waitForElement(lookup(daybox));</span>
<a href="#l15.92"></a><span id="l15.92"> </span>
<a href="#l15.93"></a><span id="l15.93">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+        controller.assertNode(lookup(daybox));</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l15.98"></a><span id="l15.98">     }</span>
<a href="#l15.99"></a><span id="l15.99"> </span>
<a href="#l15.100"></a><span id="l15.100">     // check week view for 2 weeks</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.105"></a><span id="l15.105"> </span>
<a href="#l15.106"></a><span id="l15.106">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-          eventPath;</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH));</span>
<a href="#l15.111"></a><span id="l15.111">     }</span>
<a href="#l15.112"></a><span id="l15.112"> </span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l15.115"></a><span id="l15.115"> </span>
<a href="#l15.116"></a><span id="l15.116">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour) +</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-          eventPath;</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, 2, day, HOUR, EVENTPATH));</span>
<a href="#l15.121"></a><span id="l15.121">     }</span>
<a href="#l15.122"></a><span id="l15.122"> </span>
<a href="#l15.123"></a><span id="l15.123">     // check multiweek view for 4 weeks</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.128"></a><span id="l15.128"> </span>
<a href="#l15.129"></a><span id="l15.129">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-        let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-          eventPath;</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, day, HOUR, EVENTPATH));</span>
<a href="#l15.134"></a><span id="l15.134">     }</span>
<a href="#l15.135"></a><span id="l15.135"> </span>
<a href="#l15.136"></a><span id="l15.136">     for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l15.137"></a><span id="l15.137">         for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-            let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour) +</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-              eventPath;</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineminus">-            controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineplus">+            controller.assertNode(</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineplus">+                lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, week, day, HOUR, EVENTPATH)</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineplus">+            );</span>
<a href="#l15.144"></a><span id="l15.144">         }</span>
<a href="#l15.145"></a><span id="l15.145">     }</span>
<a href="#l15.146"></a><span id="l15.146"> </span>
<a href="#l15.147"></a><span id="l15.147">     // check month view for all 5 weeks</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.152"></a><span id="l15.152"> </span>
<a href="#l15.153"></a><span id="l15.153">     for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineminus">-        let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined) +</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineminus">-          eventPath;</span>
<a href="#l15.156"></a><span id="l15.156" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l15.157"></a><span id="l15.157" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;month&quot;, EVENT_BOX, 1, day, null, EVENTPATH));</span>
<a href="#l15.158"></a><span id="l15.158">     }</span>
<a href="#l15.159"></a><span id="l15.159"> </span>
<a href="#l15.160"></a><span id="l15.160">     for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l15.161"></a><span id="l15.161">         for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineminus">-            let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined) +</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineminus">-              eventPath;</span>
<a href="#l15.164"></a><span id="l15.164" class="difflineminus">-            controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l15.165"></a><span id="l15.165" class="difflineplus">+            controller.assertNode(</span>
<a href="#l15.166"></a><span id="l15.166" class="difflineplus">+                lookupEventBox(&quot;month&quot;, EVENT_BOX, week, day, null, EVENTPATH)</span>
<a href="#l15.167"></a><span id="l15.167" class="difflineplus">+            );</span>
<a href="#l15.168"></a><span id="l15.168">         }</span>
<a href="#l15.169"></a><span id="l15.169">     }</span>
<a href="#l15.170"></a><span id="l15.170"> </span>
<a href="#l15.171"></a><span id="l15.171">     // delete 3rd January occurrence</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineminus">-    let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineminus">-      eventPath;</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineminus">-    calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l15.175"></a><span id="l15.175" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l15.176"></a><span id="l15.176" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l15.177"></a><span id="l15.177" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l15.178"></a><span id="l15.178" class="difflineplus">+    let saturday = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 1, 7, null) + EVENTPATH;</span>
<a href="#l15.179"></a><span id="l15.179" class="difflineplus">+    controller.click(lookup(saturday));</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, false, false);</span>
<a href="#l15.181"></a><span id="l15.181"> </span>
<a href="#l15.182"></a><span id="l15.182">     // verify in all views</span>
<a href="#l15.183"></a><span id="l15.183" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l15.184"></a><span id="l15.184" class="difflineplus">+    controller.waitForElementNotPresent(lookup(saturday));</span>
<a href="#l15.185"></a><span id="l15.185"> </span>
<a href="#l15.186"></a><span id="l15.186" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.187"></a><span id="l15.187" class="difflineminus">-    saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineminus">-      eventPath;</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.191"></a><span id="l15.191" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l15.192"></a><span id="l15.192" class="difflineplus">+        lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, 1, 7, null, EVENTPATH)</span>
<a href="#l15.193"></a><span id="l15.193" class="difflineplus">+    );</span>
<a href="#l15.194"></a><span id="l15.194"> </span>
<a href="#l15.195"></a><span id="l15.195" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.196"></a><span id="l15.196" class="difflineminus">-    saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l15.197"></a><span id="l15.197" class="difflineminus">-      eventPath;</span>
<a href="#l15.198"></a><span id="l15.198" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l15.199"></a><span id="l15.199" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.200"></a><span id="l15.200" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l15.201"></a><span id="l15.201" class="difflineplus">+        lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH)</span>
<a href="#l15.202"></a><span id="l15.202" class="difflineplus">+    );</span>
<a href="#l15.203"></a><span id="l15.203"> </span>
<a href="#l15.204"></a><span id="l15.204" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.205"></a><span id="l15.205" class="difflineminus">-    saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l15.206"></a><span id="l15.206" class="difflineminus">-      eventPath;</span>
<a href="#l15.207"></a><span id="l15.207" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l15.208"></a><span id="l15.208" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.209"></a><span id="l15.209" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l15.210"></a><span id="l15.210" class="difflineplus">+        lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, null, EVENTPATH)</span>
<a href="#l15.211"></a><span id="l15.211" class="difflineplus">+    );</span>
<a href="#l15.212"></a><span id="l15.212"> </span>
<a href="#l15.213"></a><span id="l15.213">     // go to previous day to edit event to occur only on weekdays</span>
<a href="#l15.214"></a><span id="l15.214" class="difflineminus">-    calUtils.back(controller, 1);</span>
<a href="#l15.215"></a><span id="l15.215" class="difflineminus">-</span>
<a href="#l15.216"></a><span id="l15.216" class="difflineminus">-    calUtils.handleParentModification(controller, false);</span>
<a href="#l15.217"></a><span id="l15.217" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l15.218"></a><span id="l15.218" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l15.219"></a><span id="l15.219" class="difflineminus">-        eventPath));</span>
<a href="#l15.220"></a><span id="l15.220" class="difflineplus">+    viewBack(controller, 1);</span>
<a href="#l15.221"></a><span id="l15.221"> </span>
<a href="#l15.222"></a><span id="l15.222" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l15.223"></a><span id="l15.223" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l15.224"></a><span id="l15.224" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l15.225"></a><span id="l15.225" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l15.226"></a><span id="l15.226" class="difflineplus">+    handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true, false);</span>
<a href="#l15.227"></a><span id="l15.227" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l15.228"></a><span id="l15.228" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l15.229"></a><span id="l15.229"> </span>
<a href="#l15.230"></a><span id="l15.230" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l15.231"></a><span id="l15.231" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l15.232"></a><span id="l15.232" class="difflineminus">-      &quot;every.weekday&quot;);</span>
<a href="#l15.233"></a><span id="l15.233" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l15.234"></a><span id="l15.234" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l15.235"></a><span id="l15.235" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l15.236"></a><span id="l15.236" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;every.weekday&quot;);</span>
<a href="#l15.237"></a><span id="l15.237" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l15.238"></a><span id="l15.238" class="difflineplus">+    });</span>
<a href="#l15.239"></a><span id="l15.239"> </span>
<a href="#l15.240"></a><span id="l15.240">     // check day view for 7 days</span>
<a href="#l15.241"></a><span id="l15.241" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l15.242"></a><span id="l15.242" class="difflineminus">-      eventPath;</span>
<a href="#l15.243"></a><span id="l15.243" class="difflineminus">-    let dates = [[2009, 1, 3],</span>
<a href="#l15.244"></a><span id="l15.244" class="difflineminus">-                 [2009, 1, 4]];</span>
<a href="#l15.245"></a><span id="l15.245" class="difflineminus">-    for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l15.246"></a><span id="l15.246" class="difflineminus">-        calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l15.247"></a><span id="l15.247" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l15.248"></a><span id="l15.248" class="difflineplus">+    let day = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, null) + EVENTPATH;</span>
<a href="#l15.249"></a><span id="l15.249" class="difflineplus">+    let dates = [[2009, 1, 3], [2009, 1, 4]];</span>
<a href="#l15.250"></a><span id="l15.250" class="difflineplus">+    for (let [y, m, d] of dates) {</span>
<a href="#l15.251"></a><span id="l15.251" class="difflineplus">+        goToDate(controller, y, m, d);</span>
<a href="#l15.252"></a><span id="l15.252" class="difflineplus">+        controller.assertNodeNotExist(lookup(day));</span>
<a href="#l15.253"></a><span id="l15.253">     }</span>
<a href="#l15.254"></a><span id="l15.254"> </span>
<a href="#l15.255"></a><span id="l15.255">     // check week view for 2 weeks</span>
<a href="#l15.256"></a><span id="l15.256" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.257"></a><span id="l15.257" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.258"></a><span id="l15.258" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l15.259"></a><span id="l15.259" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.260"></a><span id="l15.260"> </span>
<a href="#l15.261"></a><span id="l15.261">     for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l15.262"></a><span id="l15.262" class="difflineminus">-        let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l15.263"></a><span id="l15.263" class="difflineminus">-          eventPath;</span>
<a href="#l15.264"></a><span id="l15.264" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l15.265"></a><span id="l15.265" class="difflineminus">-        weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l15.266"></a><span id="l15.266" class="difflineminus">-          eventPath;</span>
<a href="#l15.267"></a><span id="l15.267" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l15.268"></a><span id="l15.268" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l15.269"></a><span id="l15.269" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l15.270"></a><span id="l15.270" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, null, EVENTPATH)</span>
<a href="#l15.271"></a><span id="l15.271" class="difflineplus">+        );</span>
<a href="#l15.272"></a><span id="l15.272" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l15.273"></a><span id="l15.273" class="difflineplus">+            lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, null, EVENTPATH)</span>
<a href="#l15.274"></a><span id="l15.274" class="difflineplus">+        );</span>
<a href="#l15.275"></a><span id="l15.275" class="difflineplus">+</span>
<a href="#l15.276"></a><span id="l15.276" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l15.277"></a><span id="l15.277">     }</span>
<a href="#l15.278"></a><span id="l15.278"> </span>
<a href="#l15.279"></a><span id="l15.279">     // check multiweek view for 4 weeks</span>
<a href="#l15.280"></a><span id="l15.280" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.281"></a><span id="l15.281" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.282"></a><span id="l15.282" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l15.283"></a><span id="l15.283" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.284"></a><span id="l15.284"> </span>
<a href="#l15.285"></a><span id="l15.285">     for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l15.286"></a><span id="l15.286" class="difflineminus">-        let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l15.287"></a><span id="l15.287" class="difflineminus">-          eventPath;</span>
<a href="#l15.288"></a><span id="l15.288" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l15.289"></a><span id="l15.289" class="difflineminus">-        mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l15.290"></a><span id="l15.290" class="difflineminus">-          eventPath;</span>
<a href="#l15.291"></a><span id="l15.291" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l15.292"></a><span id="l15.292" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l15.293"></a><span id="l15.293" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l15.294"></a><span id="l15.294" class="difflineplus">+        );</span>
<a href="#l15.295"></a><span id="l15.295" class="difflineplus">+</span>
<a href="#l15.296"></a><span id="l15.296" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l15.297"></a><span id="l15.297" class="difflineplus">+            lookupEventBox(&quot;multiweek&quot;, EVENT_BOX, i, 7, null, EVENTPATH)</span>
<a href="#l15.298"></a><span id="l15.298" class="difflineplus">+        );</span>
<a href="#l15.299"></a><span id="l15.299" class="difflineplus">+</span>
<a href="#l15.300"></a><span id="l15.300" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l15.301"></a><span id="l15.301">     }</span>
<a href="#l15.302"></a><span id="l15.302"> </span>
<a href="#l15.303"></a><span id="l15.303">     // check month view for all 5 weeks</span>
<a href="#l15.304"></a><span id="l15.304" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l15.305"></a><span id="l15.305" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.306"></a><span id="l15.306" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l15.307"></a><span id="l15.307" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l15.308"></a><span id="l15.308"> </span>
<a href="#l15.309"></a><span id="l15.309">     for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l15.310"></a><span id="l15.310" class="difflineminus">-        let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l15.311"></a><span id="l15.311" class="difflineminus">-          eventPath;</span>
<a href="#l15.312"></a><span id="l15.312" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l15.313"></a><span id="l15.313" class="difflineminus">-        mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l15.314"></a><span id="l15.314" class="difflineminus">-          eventPath;</span>
<a href="#l15.315"></a><span id="l15.315" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l15.316"></a><span id="l15.316" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l15.317"></a><span id="l15.317" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 1, null, EVENTPATH)</span>
<a href="#l15.318"></a><span id="l15.318" class="difflineplus">+        );</span>
<a href="#l15.319"></a><span id="l15.319" class="difflineplus">+</span>
<a href="#l15.320"></a><span id="l15.320" class="difflineplus">+        controller.assertNodeNotExist(</span>
<a href="#l15.321"></a><span id="l15.321" class="difflineplus">+            lookupEventBox(&quot;month&quot;, EVENT_BOX, i, 7, null, EVENTPATH)</span>
<a href="#l15.322"></a><span id="l15.322" class="difflineplus">+        );</span>
<a href="#l15.323"></a><span id="l15.323" class="difflineplus">+</span>
<a href="#l15.324"></a><span id="l15.324" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l15.325"></a><span id="l15.325">     }</span>
<a href="#l15.326"></a><span id="l15.326"> </span>
<a href="#l15.327"></a><span id="l15.327">     // delete event</span>
<a href="#l15.328"></a><span id="l15.328" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined) +</span>
<a href="#l15.329"></a><span id="l15.329" class="difflineminus">-      eventPath;</span>
<a href="#l15.330"></a><span id="l15.330" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l15.331"></a><span id="l15.331" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l15.332"></a><span id="l15.332" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l15.333"></a><span id="l15.333" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l15.334"></a><span id="l15.334" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l15.335"></a><span id="l15.335" class="difflineplus">+    day = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 1, 5, null) + EVENTPATH;</span>
<a href="#l15.336"></a><span id="l15.336" class="difflineplus">+    controller.click(lookup(day));</span>
<a href="#l15.337"></a><span id="l15.337" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l15.338"></a><span id="l15.338" class="difflineplus">+    controller.waitForElementNotPresent(lookup(day));</span>
<a href="#l15.339"></a><span id="l15.339"> </span>
<a href="#l15.340"></a><span id="l15.340">     // reset view</span>
<a href="#l15.341"></a><span id="l15.341" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.342"></a><span id="l15.342" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l15.343"></a><span id="l15.343">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l15.344"></a><span id="l15.344" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l15.345"></a><span id="l15.345" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l15.346"></a><span id="l15.346" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l15.347"></a><span id="l15.347" class="difflineminus">-    });</span>
<a href="#l15.348"></a><span id="l15.348" class="difflineminus">-};</span>
<a href="#l15.349"></a><span id="l15.349" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l15.350"></a><span id="l15.350" class="difflineplus">+}</span>
<a href="#l15.351"></a><span id="l15.351"> </span>
<a href="#l15.352"></a><span id="l15.352" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l15.353"></a><span id="l15.353" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l15.354"></a><span id="l15.354" class="difflineminus">-};</span>
<a href="#l15.355"></a><span id="l15.355" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l15.356"></a><span id="l15.356" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l15.357"></a><span id="l15.357" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">old mode 100644</span>
<a href="#l16.2"></a><span id="l16.2">new mode 100755</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineat">@@ -1,52 +1,65 @@</span>
<a href="#l16.6"></a><span id="l16.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.7"></a><span id="l16.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.8"></a><span id="l16.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+</span>
<a href="#l16.18"></a><span id="l16.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-var sleep = 500;</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-var hour = 8;</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+var HOUR = 8;</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+function setupModule(module) {</span>
<a href="#l16.28"></a><span id="l16.28">     controller = mozmill.getMail3PaneController();</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-};</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+    ({</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+        helpersForController,</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+        createCalendar,</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+        deleteCalendars,</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+        switchToView,</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+        goToDate,</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-var testLastDayOfMonthRecurrence = function() {</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-    calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+}</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+function testLastDayOfMonthRecurrence() {</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+    goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l16.58"></a><span id="l16.58"> </span>
<a href="#l16.59"></a><span id="l16.59">     // rotate view</span>
<a href="#l16.60"></a><span id="l16.60">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineminus">-    });</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l16.66"></a><span id="l16.66"> </span>
<a href="#l16.67"></a><span id="l16.67">     // create monthly recurring event</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+    let eventBox = lookupEventBox(controller, &quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l16.76"></a><span id="l16.76"> </span>
<a href="#l16.77"></a><span id="l16.77" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineminus">-      &quot;custom&quot;);</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l16.86"></a><span id="l16.86"> </span>
<a href="#l16.87"></a><span id="l16.87" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+    });</span>
<a href="#l16.91"></a><span id="l16.91"> </span>
<a href="#l16.92"></a><span id="l16.92">     //                      date      correct row in month view</span>
<a href="#l16.93"></a><span id="l16.93">     //                   vvvvvvvvvvv  v</span>
<a href="#l16.94"></a><span id="l16.94">     let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l16.95"></a><span id="l16.95">                         [2008, 2, 29, 5],</span>
<a href="#l16.96"></a><span id="l16.96">                         [2008, 3, 31, 6],</span>
<a href="#l16.97"></a><span id="l16.97">                         [2008, 4, 30, 5],</span>
<a href="#l16.98"></a><span id="l16.98">                         [2008, 5, 31, 5],</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineat">@@ -58,82 +71,77 @@ var testLastDayOfMonthRecurrence = funct</span>
<a href="#l16.100"></a><span id="l16.100">                         [2008, 11, 30, 6],</span>
<a href="#l16.101"></a><span id="l16.101">                         [2008, 12, 31, 5],</span>
<a href="#l16.102"></a><span id="l16.102">                         [2009, 1, 31, 5],</span>
<a href="#l16.103"></a><span id="l16.103">                         [2009, 2, 28, 4],</span>
<a href="#l16.104"></a><span id="l16.104">                         [2009, 3, 31, 5]];</span>
<a href="#l16.105"></a><span id="l16.105">     let box = &quot;&quot;;</span>
<a href="#l16.106"></a><span id="l16.106"> </span>
<a href="#l16.107"></a><span id="l16.107">     // check all dates</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">-    for (let i = 0; i &lt; checkingData.length; i++) {</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineminus">-        calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+    for (let [y, m, d, correctRow] of checkingData) {</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+        goToDate(controller, y, m, d);</span>
<a href="#l16.112"></a><span id="l16.112"> </span>
<a href="#l16.113"></a><span id="l16.113">         // day view</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineminus">-        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineminus">-          eventPath;</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineminus">-        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+        switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineplus">+            lookupEventBox(controller, &quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH)</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineplus">+        );</span>
<a href="#l16.122"></a><span id="l16.122"> </span>
<a href="#l16.123"></a><span id="l16.123">         // week view</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineminus">-        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineminus">-        let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+        switchToView(controller, &quot;week&quot;);</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineplus">+        let date = new Date(y, m - 1, d);</span>
<a href="#l16.128"></a><span id="l16.128">         let column = date.getDay() + 1;</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour) +</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-          eventPath;</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineminus">-        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+        controller.waitForElement(</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineplus">+            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, column, HOUR, EVENTPATH)</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+        );</span>
<a href="#l16.135"></a><span id="l16.135"> </span>
<a href="#l16.136"></a><span id="l16.136">         // multiweek view</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineminus">-        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined) +</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineminus">-          eventPath;</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineplus">+        switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+        controller.assertNode(</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+            lookupEventBox(controller, &quot;multiweek&quot;, EVENT_BOX, 1, column, null, EVENTPATH)</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+        );</span>
<a href="#l16.145"></a><span id="l16.145"> </span>
<a href="#l16.146"></a><span id="l16.146">         // month view</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineminus">-        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineminus">-          column, undefined) + eventPath;</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+        switchToView(controller, &quot;month&quot;);</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+        controller.assertNode(</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineplus">+            lookupEventBox(controller, &quot;month&quot;, EVENT_BOX, correctRow, column, null, EVENTPATH)</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineplus">+        );</span>
<a href="#l16.155"></a><span id="l16.155">     }</span>
<a href="#l16.156"></a><span id="l16.156"> </span>
<a href="#l16.157"></a><span id="l16.157">     // delete event</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineminus">-    calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineminus">-      undefined, 1, hour) + eventPath;</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+    goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineplus">+    box = getEventBoxPath(controller, &quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineplus">+    controller.waitThenClick(lookup(box));</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l16.174"></a><span id="l16.174"> </span>
<a href="#l16.175"></a><span id="l16.175">     // reset view</span>
<a href="#l16.176"></a><span id="l16.176">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineminus">-    });</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineminus">-};</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineplus">+}</span>
<a href="#l16.184"></a><span id="l16.184"> </span>
<a href="#l16.185"></a><span id="l16.185"> function setRecurrence(recurrence) {</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+    let { lookup: reclookup, eid: recid, sleep: recsleep } = helpersForController(recurrence);</span>
<a href="#l16.188"></a><span id="l16.188"> </span>
<a href="#l16.189"></a><span id="l16.189">     // monthly</span>
<a href="#l16.190"></a><span id="l16.190" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineminus">-      undefined, &quot;2&quot;);</span>
<a href="#l16.192"></a><span id="l16.192" class="difflineplus">+    recsleep();</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;2&quot;);</span>
<a href="#l16.194"></a><span id="l16.194"> </span>
<a href="#l16.195"></a><span id="l16.195">     // last day of month</span>
<a href="#l16.196"></a><span id="l16.196" class="difflineminus">-    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineminus">-      undefined, &quot;-1&quot;);</span>
<a href="#l16.200"></a><span id="l16.200" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l16.201"></a><span id="l16.201" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l16.202"></a><span id="l16.202" class="difflineminus">-      undefined, &quot;-1&quot;);</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l16.204"></a><span id="l16.204" class="difflineplus">+    recurrence.click(recid(&quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineplus">+    recsleep();</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineplus">+    recurrence.select(recid(&quot;monthly-ordinal&quot;), null, null, &quot;-1&quot;);</span>
<a href="#l16.207"></a><span id="l16.207" class="difflineplus">+    recsleep();</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineplus">+    recurrence.select(recid(&quot;monthly-weekday&quot;), null, null, &quot;-1&quot;);</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineplus">+    recsleep();</span>
<a href="#l16.210"></a><span id="l16.210"> </span>
<a href="#l16.211"></a><span id="l16.211">     // close dialog</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l16.213"></a><span id="l16.213" class="difflineminus">-      '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l16.216"></a><span id="l16.216" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineplus">+    `));</span>
<a href="#l16.218"></a><span id="l16.218"> }</span>
<a href="#l16.219"></a><span id="l16.219"> </span>
<a href="#l16.220"></a><span id="l16.220" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineminus">-};</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">old mode 100644</span>
<a href="#l17.2"></a><span id="l17.2">new mode 100755</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineat">@@ -1,160 +1,173 @@</span>
<a href="#l17.6"></a><span id="l17.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.7"></a><span id="l17.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.8"></a><span id="l17.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+</span>
<a href="#l17.18"></a><span id="l17.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l17.19"></a><span id="l17.19"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-var hour = 8;</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+var HOUR = 8;</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+function setupModule(module) {</span>
<a href="#l17.30"></a><span id="l17.30">     controller = mozmill.getMail3PaneController();</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-};</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+    ({</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+        helpersForController,</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+        createCalendar,</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+        deleteCalendars,</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+        switchToView,</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+        goToDate,</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+        viewForward,</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l17.48"></a><span id="l17.48"> </span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-var testWeeklyNRecurrence = function() {</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+}</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+function testWeeklyNRecurrence() {</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l17.60"></a><span id="l17.60"> </span>
<a href="#l17.61"></a><span id="l17.61">     // rotate view</span>
<a href="#l17.62"></a><span id="l17.62">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineminus">-    });</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l17.68"></a><span id="l17.68"> </span>
<a href="#l17.69"></a><span id="l17.69">     // create weekly recurring event</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l17.77"></a><span id="l17.77"> </span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l17.86"></a><span id="l17.86"> </span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+    });</span>
<a href="#l17.90"></a><span id="l17.90"> </span>
<a href="#l17.91"></a><span id="l17.91">     // check day view</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineminus">-      eventPath;</span>
<a href="#l17.94"></a><span id="l17.94"> </span>
<a href="#l17.95"></a><span id="l17.95">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l17.96"></a><span id="l17.96">     for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+        controller.assertNode(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH));</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l17.101"></a><span id="l17.101">     }</span>
<a href="#l17.102"></a><span id="l17.102"> </span>
<a href="#l17.103"></a><span id="l17.103">     // Saturday</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH));</span>
<a href="#l17.108"></a><span id="l17.108"> </span>
<a href="#l17.109"></a><span id="l17.109">     // check week view</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l17.112"></a><span id="l17.112"> </span>
<a href="#l17.113"></a><span id="l17.113">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l17.114"></a><span id="l17.114">     for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour) +</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineminus">-          eventPath;</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+        controller.waitForElement(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, i, HOUR, EVENTPATH));</span>
<a href="#l17.119"></a><span id="l17.119">     }</span>
<a href="#l17.120"></a><span id="l17.120"> </span>
<a href="#l17.121"></a><span id="l17.121">     // Saturday</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineminus">-      eventPath;</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR, EVENTPATH));</span>
<a href="#l17.126"></a><span id="l17.126"> </span>
<a href="#l17.127"></a><span id="l17.127">     // check multiweek view</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l17.130"></a><span id="l17.130">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l17.131"></a><span id="l17.131"> </span>
<a href="#l17.132"></a><span id="l17.132">     // check month view</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l17.135"></a><span id="l17.135">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l17.136"></a><span id="l17.136"> </span>
<a href="#l17.137"></a><span id="l17.137">     // delete event</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour) +</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineminus">-      eventPath;</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+    let box = getEventBoxPath(&quot;month&quot;, EVENT_BOX, 2, 2, HOUR) + EVENTPATH;</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l17.149"></a><span id="l17.149"> </span>
<a href="#l17.150"></a><span id="l17.150">     // reset view</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l17.153"></a><span id="l17.153">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineminus">-    });</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-};</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineplus">+}</span>
<a href="#l17.161"></a><span id="l17.161"> </span>
<a href="#l17.162"></a><span id="l17.162"> function setRecurrence(recurrence) {</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+    let { lookup: reclookup, eid: recid, sleep: recsleep } = helpersForController(recurrence);</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineplus">+</span>
<a href="#l17.165"></a><span id="l17.165">     // weekly</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+    recsleep();</span>
<a href="#l17.172"></a><span id="l17.172"> </span>
<a href="#l17.173"></a><span id="l17.173">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l17.174"></a><span id="l17.174">     let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l17.175"></a><span id="l17.175">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l17.176"></a><span id="l17.176">     let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l17.177"></a><span id="l17.177">     let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l17.178"></a><span id="l17.178"> </span>
<a href="#l17.179"></a><span id="l17.179" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+    let days = `</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineplus">+    `;</span>
<a href="#l17.189"></a><span id="l17.189"> </span>
<a href="#l17.190"></a><span id="l17.190">     // starting from Monday so it should be checked</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l17.193"></a><span id="l17.193">     // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${thu}&quot;}`));</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${sat}&quot;}`));</span>
<a href="#l17.202"></a><span id="l17.202"> </span>
<a href="#l17.203"></a><span id="l17.203">     // set number of occurrences</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineminus">-    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineminus">-    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineminus">-      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/' +</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+    recurrence.click(recid(&quot;recurrence-range-for&quot;));</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+    let input = `</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+        id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+        id(&quot;repeat-ntimes-count&quot;)/</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineplus">+    `;</span>
<a href="#l17.216"></a><span id="l17.216">     // replace previous number</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineminus">-    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineminus">-    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+    recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+    recurrence.type(reclookup(input), &quot;4&quot;);</span>
<a href="#l17.221"></a><span id="l17.221"> </span>
<a href="#l17.222"></a><span id="l17.222">     // close dialog</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineplus">+    `));</span>
<a href="#l17.229"></a><span id="l17.229"> }</span>
<a href="#l17.230"></a><span id="l17.230"> </span>
<a href="#l17.231"></a><span id="l17.231"> function checkMultiWeekView(view) {</span>
<a href="#l17.232"></a><span id="l17.232">     let week = 1;</span>
<a href="#l17.233"></a><span id="l17.233"> </span>
<a href="#l17.234"></a><span id="l17.234">     // in month view event starts from 2nd row</span>
<a href="#l17.235"></a><span id="l17.235">     if (view == &quot;month&quot;) {</span>
<a href="#l17.236"></a><span id="l17.236">         week++;</span>
<a href="#l17.237"></a><span id="l17.237">     }</span>
<a href="#l17.238"></a><span id="l17.238"> </span>
<a href="#l17.239"></a><span id="l17.239">     // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l17.240"></a><span id="l17.240">     for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineminus">-        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined) +</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineminus">-          eventPath;</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineplus">+        controller.assertNode(lookupEventBox(view, EVENT_BOX, week, i, null, EVENTPATH));</span>
<a href="#l17.245"></a><span id="l17.245">     }</span>
<a href="#l17.246"></a><span id="l17.246"> </span>
<a href="#l17.247"></a><span id="l17.247">     // Saturday</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined) +</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineminus">-      eventPath;</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(view, EVENT_BOX, week, 7, null, EVENTPATH));</span>
<a href="#l17.252"></a><span id="l17.252"> }</span>
<a href="#l17.253"></a><span id="l17.253"> </span>
<a href="#l17.254"></a><span id="l17.254" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineminus">-};</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">old mode 100644</span>
<a href="#l18.2"></a><span id="l18.2">new mode 100755</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineat">@@ -1,203 +1,234 @@</span>
<a href="#l18.6"></a><span id="l18.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.7"></a><span id="l18.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.8"></a><span id="l18.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+</span>
<a href="#l18.18"></a><span id="l18.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l18.19"></a><span id="l18.19"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-var hour = 8;</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+var ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+var HOUR = 8;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+function setupModule(module) {</span>
<a href="#l18.32"></a><span id="l18.32">     controller = mozmill.getMail3PaneController();</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-};</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+    ({</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+        helpersForController,</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+        createCalendar,</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+        deleteCalendars,</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+        switchToView,</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+        goToDate,</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+        viewForward,</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l18.50"></a><span id="l18.50"> </span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-var testWeeklyUntilRecurrence = function() {</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+}</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+function testWeeklyUntilRecurrence() {</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+    goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l18.62"></a><span id="l18.62"> </span>
<a href="#l18.63"></a><span id="l18.63">     // rotate view</span>
<a href="#l18.64"></a><span id="l18.64">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineminus">-    });</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l18.70"></a><span id="l18.70"> </span>
<a href="#l18.71"></a><span id="l18.71">     // create weekly recurring event</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineplus">+    let eventBox = lookupEventBox(controller, &quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l18.79"></a><span id="l18.79"> </span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l18.88"></a><span id="l18.88"> </span>
<a href="#l18.89"></a><span id="l18.89" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineplus">+    });</span>
<a href="#l18.93"></a><span id="l18.93"> </span>
<a href="#l18.94"></a><span id="l18.94" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineminus">-      eventPath;</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineplus">+    let box = getEventBoxPath(controller, &quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l18.97"></a><span id="l18.97"> </span>
<a href="#l18.98"></a><span id="l18.98">     // check day view</span>
<a href="#l18.99"></a><span id="l18.99">     for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l18.100"></a><span id="l18.100">         // Monday</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineminus">-        calUtils.forward(controller, 2);</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-        // Wednesday</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineminus">-        calUtils.forward(controller, 2);</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineminus">-        // Friday</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineminus">-        calUtils.forward(controller, 3);</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineminus">-    }</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineminus">-</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineminus">-    // Monday, last occurrence</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineminus">-    calUtils.forward(controller, 2);</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineminus">-    // Wednesday</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineminus">-    calUtils.forward(controller, 2);</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineplus">+        controller.assertNode(lookup(box));</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineplus">+        viewForward(controller, 2);</span>
<a href="#l18.119"></a><span id="l18.119"> </span>
<a href="#l18.120"></a><span id="l18.120" class="difflineminus">-    // check week view</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineminus">-    for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineminus">-        // Monday</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-          eventPath;</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.128"></a><span id="l18.128">         // Wednesday</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-          eventPath;</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineplus">+        controller.assertNode(lookup(box));</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineplus">+        viewForward(controller, 2);</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineplus">+</span>
<a href="#l18.135"></a><span id="l18.135">         // Friday</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour) +</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineminus">-          eventPath;</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineminus">-</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineplus">+        controller.assertNode(lookup(box));</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineplus">+        viewForward(controller, 3);</span>
<a href="#l18.143"></a><span id="l18.143">     }</span>
<a href="#l18.144"></a><span id="l18.144"> </span>
<a href="#l18.145"></a><span id="l18.145">     // Monday, last occurrence</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineminus">-      eventPath;</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineplus">+    controller.assertNode(lookup(box));</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineplus">+    viewForward(controller, 2);</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineplus">+</span>
<a href="#l18.152"></a><span id="l18.152">     // Wednesday</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineminus">-      eventPath;</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineplus">+    controller.assertNodeNotExist(lookup(box));</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineplus">+    viewForward(controller, 2);</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineplus">+</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineplus">+    // check week view</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineplus">+    for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineplus">+        // Monday</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineplus">+        controller.assertNode(</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineplus">+            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineplus">+        );</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineplus">+</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineplus">+        controller.assertNode(</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineplus">+            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineplus">+        );</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineplus">+</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineplus">+        // Friday</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineplus">+        controller.assertNode(</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineplus">+            lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 6, HOUR, EVENTPATH)</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineplus">+        );</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineplus">+</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineplus">+        viewForward(controller, 1);</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineplus">+    }</span>
<a href="#l18.179"></a><span id="l18.179" class="difflineplus">+</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l18.181"></a><span id="l18.181" class="difflineplus">+    controller.assertNode(</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineplus">+        lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 2, HOUR, EVENTPATH)</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineplus">+    );</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineplus">+</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineplus">+    // Wednesday</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineplus">+        lookupEventBox(controller, &quot;week&quot;, EVENT_BOX, null, 4, HOUR, EVENTPATH)</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineplus">+    );</span>
<a href="#l18.189"></a><span id="l18.189"> </span>
<a href="#l18.190"></a><span id="l18.190">     // check multiweek view</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.195"></a><span id="l18.195">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l18.196"></a><span id="l18.196"> </span>
<a href="#l18.197"></a><span id="l18.197">     // check month view</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l18.202"></a><span id="l18.202">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l18.203"></a><span id="l18.203"> </span>
<a href="#l18.204"></a><span id="l18.204">     // delete event</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined) +</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineminus">-      eventPath;</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l18.210"></a><span id="l18.210" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l18.211"></a><span id="l18.211" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.212"></a><span id="l18.212" class="difflineplus">+    box = getEventBoxPath(controller, &quot;month&quot;, EVENT_BOX, 2, 2, null) + EVENTPATH;</span>
<a href="#l18.213"></a><span id="l18.213" class="difflineplus">+    controller.click(lookup(box));</span>
<a href="#l18.214"></a><span id="l18.214" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;month-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l18.215"></a><span id="l18.215" class="difflineplus">+    controller.waitForElementNotPresent(lookup(box));</span>
<a href="#l18.216"></a><span id="l18.216"> </span>
<a href="#l18.217"></a><span id="l18.217">     // reset view</span>
<a href="#l18.218"></a><span id="l18.218" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.219"></a><span id="l18.219" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l18.220"></a><span id="l18.220">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l18.221"></a><span id="l18.221" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l18.222"></a><span id="l18.222" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l18.223"></a><span id="l18.223" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l18.224"></a><span id="l18.224" class="difflineminus">-    });</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineminus">-};</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l18.227"></a><span id="l18.227" class="difflineplus">+}</span>
<a href="#l18.228"></a><span id="l18.228"> </span>
<a href="#l18.229"></a><span id="l18.229"> function setRecurrence(recurrence) {</span>
<a href="#l18.230"></a><span id="l18.230" class="difflineplus">+    let { lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l18.231"></a><span id="l18.231" class="difflineplus">+</span>
<a href="#l18.232"></a><span id="l18.232">     // weekly</span>
<a href="#l18.233"></a><span id="l18.233" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l18.236"></a><span id="l18.236" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l18.237"></a><span id="l18.237">     recurrence.sleep(sleep);</span>
<a href="#l18.238"></a><span id="l18.238"> </span>
<a href="#l18.239"></a><span id="l18.239">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l18.240"></a><span id="l18.240">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l18.241"></a><span id="l18.241">     let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l18.242"></a><span id="l18.242"> </span>
<a href="#l18.243"></a><span id="l18.243" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l18.244"></a><span id="l18.244" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l18.245"></a><span id="l18.245" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l18.246"></a><span id="l18.246" class="difflineplus">+    let days = `</span>
<a href="#l18.247"></a><span id="l18.247" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l18.248"></a><span id="l18.248" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l18.249"></a><span id="l18.249" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l18.250"></a><span id="l18.250" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l18.251"></a><span id="l18.251" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l18.252"></a><span id="l18.252" class="difflineplus">+    `;</span>
<a href="#l18.253"></a><span id="l18.253"> </span>
<a href="#l18.254"></a><span id="l18.254">     // starting from Monday so it should be checked</span>
<a href="#l18.255"></a><span id="l18.255" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l18.256"></a><span id="l18.256" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l18.257"></a><span id="l18.257" class="difflineplus">+</span>
<a href="#l18.258"></a><span id="l18.258">     // check Wednesday and Friday too</span>
<a href="#l18.259"></a><span id="l18.259" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l18.260"></a><span id="l18.260" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l18.261"></a><span id="l18.261" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l18.262"></a><span id="l18.262" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l18.263"></a><span id="l18.263"> </span>
<a href="#l18.264"></a><span id="l18.264">     // set until date</span>
<a href="#l18.265"></a><span id="l18.265" class="difflineminus">-    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l18.266"></a><span id="l18.266" class="difflineminus">-    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l18.267"></a><span id="l18.267" class="difflineminus">-      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/' +</span>
<a href="#l18.268"></a><span id="l18.268" class="difflineminus">-      'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l18.269"></a><span id="l18.269" class="difflineminus">-      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l18.270"></a><span id="l18.270" class="difflineplus">+    recurrence.click(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l18.271"></a><span id="l18.271" class="difflineplus">+    let input = `</span>
<a href="#l18.272"></a><span id="l18.272" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/</span>
<a href="#l18.273"></a><span id="l18.273" class="difflineplus">+        id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/</span>
<a href="#l18.274"></a><span id="l18.274" class="difflineplus">+        id(&quot;repeat-until-date&quot;)/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l18.275"></a><span id="l18.275" class="difflineplus">+        {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l18.276"></a><span id="l18.276" class="difflineplus">+        anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l18.277"></a><span id="l18.277" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l18.278"></a><span id="l18.278" class="difflineplus">+    `;</span>
<a href="#l18.279"></a><span id="l18.279" class="difflineplus">+</span>
<a href="#l18.280"></a><span id="l18.280">     // delete previous date</span>
<a href="#l18.281"></a><span id="l18.281" class="difflineminus">-    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l18.282"></a><span id="l18.282" class="difflineminus">-    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l18.283"></a><span id="l18.283" class="difflineplus">+    recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l18.284"></a><span id="l18.284" class="difflineplus">+    recurrence.keypress(reclookup(input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l18.285"></a><span id="l18.285"> </span>
<a href="#l18.286"></a><span id="l18.286">     let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l18.287"></a><span id="l18.287" class="difflineminus">-                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l18.288"></a><span id="l18.288" class="difflineminus">-    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l18.289"></a><span id="l18.289" class="difflineminus">-                                               endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l18.290"></a><span id="l18.290" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l18.291"></a><span id="l18.291" class="difflineplus">+    let ymd = [ENDDATE.getFullYear(), ENDDATE.getMonth() + 1, ENDDATE.getDate()];</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineplus">+    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l18.293"></a><span id="l18.293"> </span>
<a href="#l18.294"></a><span id="l18.294" class="difflineminus">-    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l18.295"></a><span id="l18.295" class="difflineplus">+    recurrence.type(reclookup(input), endDateString);</span>
<a href="#l18.296"></a><span id="l18.296"> </span>
<a href="#l18.297"></a><span id="l18.297">     // close dialog</span>
<a href="#l18.298"></a><span id="l18.298" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l18.299"></a><span id="l18.299" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l18.300"></a><span id="l18.300" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l18.301"></a><span id="l18.301" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l18.302"></a><span id="l18.302" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l18.303"></a><span id="l18.303" class="difflineplus">+    `));</span>
<a href="#l18.304"></a><span id="l18.304"> }</span>
<a href="#l18.305"></a><span id="l18.305"> </span>
<a href="#l18.306"></a><span id="l18.306"> function checkMultiWeekView(view) {</span>
<a href="#l18.307"></a><span id="l18.307">     let startWeek = 1;</span>
<a href="#l18.308"></a><span id="l18.308"> </span>
<a href="#l18.309"></a><span id="l18.309">     // in month view event starts from 2nd row</span>
<a href="#l18.310"></a><span id="l18.310">     if (view == &quot;month&quot;) {</span>
<a href="#l18.311"></a><span id="l18.311">         startWeek++;</span>
<a href="#l18.312"></a><span id="l18.312">     }</span>
<a href="#l18.313"></a><span id="l18.313"> </span>
<a href="#l18.314"></a><span id="l18.314">     for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l18.315"></a><span id="l18.315">         // Monday</span>
<a href="#l18.316"></a><span id="l18.316" class="difflineminus">-        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined) +</span>
<a href="#l18.317"></a><span id="l18.317" class="difflineminus">-          eventPath;</span>
<a href="#l18.318"></a><span id="l18.318" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.319"></a><span id="l18.319" class="difflineplus">+        controller.assertNode(</span>
<a href="#l18.320"></a><span id="l18.320" class="difflineplus">+            lookupEventBox(controller, view, EVENT_BOX, week, 2, null, EVENTPATH)</span>
<a href="#l18.321"></a><span id="l18.321" class="difflineplus">+        );</span>
<a href="#l18.322"></a><span id="l18.322" class="difflineplus">+</span>
<a href="#l18.323"></a><span id="l18.323">         // Wednesday</span>
<a href="#l18.324"></a><span id="l18.324" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined) +</span>
<a href="#l18.325"></a><span id="l18.325" class="difflineminus">-          eventPath;</span>
<a href="#l18.326"></a><span id="l18.326" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.327"></a><span id="l18.327" class="difflineplus">+        controller.assertNode(</span>
<a href="#l18.328"></a><span id="l18.328" class="difflineplus">+            lookupEventBox(controller, view, EVENT_BOX, week, 4, null, EVENTPATH)</span>
<a href="#l18.329"></a><span id="l18.329" class="difflineplus">+        );</span>
<a href="#l18.330"></a><span id="l18.330" class="difflineplus">+</span>
<a href="#l18.331"></a><span id="l18.331">         // Friday</span>
<a href="#l18.332"></a><span id="l18.332" class="difflineminus">-        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined) +</span>
<a href="#l18.333"></a><span id="l18.333" class="difflineminus">-          eventPath;</span>
<a href="#l18.334"></a><span id="l18.334" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.335"></a><span id="l18.335" class="difflineplus">+        controller.assertNode(</span>
<a href="#l18.336"></a><span id="l18.336" class="difflineplus">+            lookupEventBox(controller, view, EVENT_BOX, week, 6, null, EVENTPATH)</span>
<a href="#l18.337"></a><span id="l18.337" class="difflineplus">+        );</span>
<a href="#l18.338"></a><span id="l18.338">     }</span>
<a href="#l18.339"></a><span id="l18.339"> </span>
<a href="#l18.340"></a><span id="l18.340">     // Monday, last occurrence</span>
<a href="#l18.341"></a><span id="l18.341" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l18.342"></a><span id="l18.342" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l18.343"></a><span id="l18.343" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.344"></a><span id="l18.344" class="difflineplus">+    controller.assertNode(</span>
<a href="#l18.345"></a><span id="l18.345" class="difflineplus">+        lookupEventBox(controller, view, EVENT_BOX, startWeek + 3, 2, null, EVENTPATH)</span>
<a href="#l18.346"></a><span id="l18.346" class="difflineplus">+    );</span>
<a href="#l18.347"></a><span id="l18.347" class="difflineplus">+</span>
<a href="#l18.348"></a><span id="l18.348">     // Wednesday</span>
<a href="#l18.349"></a><span id="l18.349" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l18.350"></a><span id="l18.350" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l18.351"></a><span id="l18.351" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l18.352"></a><span id="l18.352" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l18.353"></a><span id="l18.353" class="difflineplus">+        lookupEventBox(controller, view, EVENT_BOX, startWeek + 3, 4, null, EVENTPATH)</span>
<a href="#l18.354"></a><span id="l18.354" class="difflineplus">+    );</span>
<a href="#l18.355"></a><span id="l18.355"> }</span>
<a href="#l18.356"></a><span id="l18.356"> </span>
<a href="#l18.357"></a><span id="l18.357" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l18.358"></a><span id="l18.358" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l18.359"></a><span id="l18.359" class="difflineminus">-};</span>
<a href="#l18.360"></a><span id="l18.360" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l18.361"></a><span id="l18.361" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l18.362"></a><span id="l18.362" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">old mode 100644</span>
<a href="#l19.2"></a><span id="l19.2">new mode 100755</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineat">@@ -1,310 +1,322 @@</span>
<a href="#l19.6"></a><span id="l19.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.7"></a><span id="l19.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.8"></a><span id="l19.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+</span>
<a href="#l19.18"></a><span id="l19.18"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l19.19"></a><span id="l19.19"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineminus">-var hour = 8;</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineminus">-var startDate = new Date(2009, 0, 6);</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">-var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+var HOUR = 8;</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+var STARTDATE = new Date(2009, 0, 6);</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+var EVENTPATH = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}`;</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineplus">+function setupModule(module) {</span>
<a href="#l19.32"></a><span id="l19.32">     controller = mozmill.getMail3PaneController();</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineminus">-};</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+    ({</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+        helpersForController,</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+        createCalendar,</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+        deleteCalendars,</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+        switchToView,</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineplus">+        viewForward,</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+        goToDate,</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+        handleOccurrencePrompt,</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+        CALENDARNAME,</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-var testWeeklyWithExceptionRecurrence = function() {</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+}</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+function testWeeklyWithExceptionRecurrence() {</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.62"></a><span id="l19.62"> </span>
<a href="#l19.63"></a><span id="l19.63">     // rotate view</span>
<a href="#l19.64"></a><span id="l19.64">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineminus">-    });</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;horizontal&quot;);</span>
<a href="#l19.70"></a><span id="l19.70"> </span>
<a href="#l19.71"></a><span id="l19.71">     // create weekly recurring event</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+    let eventBox = lookupEventBox(&quot;day&quot;, CANVAS_BOX, null, 1, HOUR);</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l19.79"></a><span id="l19.79"> </span>
<a href="#l19.80"></a><span id="l19.80" class="difflineminus">-    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineminus">-    dialog.start(setRecurrence);</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineplus">+        let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineplus">+        dialog.start(setRecurrence);</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l19.88"></a><span id="l19.88"> </span>
<a href="#l19.89"></a><span id="l19.89" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+    });</span>
<a href="#l19.92"></a><span id="l19.92"> </span>
<a href="#l19.93"></a><span id="l19.93">     // move 5th January occurrence to 6th January</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineminus">-    calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.96"></a><span id="l19.96" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l19.97"></a><span id="l19.97" class="difflineminus">-        eventPath));</span>
<a href="#l19.98"></a><span id="l19.98" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l19.100"></a><span id="l19.100" class="difflineminus">-    event.sleep(sleep);</span>
<a href="#l19.101"></a><span id="l19.101" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineplus">+    handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, false, false);</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l19.104"></a><span id="l19.104" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l19.105"></a><span id="l19.105"> </span>
<a href="#l19.106"></a><span id="l19.106" class="difflineminus">-    let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineminus">-      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/' +</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineminus">-      'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineminus">-    let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineminus">-      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/' +</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineminus">-      'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l19.116"></a><span id="l19.116" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l19.117"></a><span id="l19.117" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+        let startDateInput = eventlookup(`</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+            /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineplus">+            id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/</span>
<a href="#l19.121"></a><span id="l19.121" class="difflineplus">+            id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineplus">+        `);</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineplus">+        let endDateInput = eventlookup(`</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+            /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineplus">+            id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineplus">+            id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+        `);</span>
<a href="#l19.136"></a><span id="l19.136"> </span>
<a href="#l19.137"></a><span id="l19.137" class="difflineminus">-    event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineminus">-                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineminus">-    let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineminus">-                                               startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineminus">-    event.type(startDateInput, startDateString);</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineminus">-    // applies startdate change</span>
<a href="#l19.144"></a><span id="l19.144" class="difflineminus">-    event.click(endDateInput);</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineplus">+        event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l19.146"></a><span id="l19.146" class="difflineplus">+        let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineplus">+                                    .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineplus">+        let ymd = [STARTDATE.getFullYear(), STARTDATE.getMonth() + 1, STARTDATE.getDate()];</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineplus">+        let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineplus">+        event.type(startDateInput, startDateString);</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineplus">+        // applies startdate change</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineplus">+        event.click(endDateInput);</span>
<a href="#l19.153"></a><span id="l19.153"> </span>
<a href="#l19.154"></a><span id="l19.154" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineplus">+    });</span>
<a href="#l19.158"></a><span id="l19.158"> </span>
<a href="#l19.159"></a><span id="l19.159">     // change recurrence rule</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l19.161"></a><span id="l19.161" class="difflineminus">-    calUtils.handleParentModification(controller, false);</span>
<a href="#l19.162"></a><span id="l19.162" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l19.164"></a><span id="l19.164" class="difflineminus">-        eventPath));</span>
<a href="#l19.165"></a><span id="l19.165" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l19.166"></a><span id="l19.166" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l19.167"></a><span id="l19.167" class="difflineplus">+    goToDate(controller, 2009, 1, 7);</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineplus">+    eventBox = lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, EVENTPATH);</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineplus">+    handleOccurrencePrompt(controller, eventBox, &quot;modify&quot;, true, false);</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l19.171"></a><span id="l19.171" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l19.172"></a><span id="l19.172"> </span>
<a href="#l19.173"></a><span id="l19.173" class="difflineminus">-    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l19.174"></a><span id="l19.174" class="difflineminus">-    dialog.start(changeRecurrence);</span>
<a href="#l19.175"></a><span id="l19.175" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l19.176"></a><span id="l19.176" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l19.177"></a><span id="l19.177" class="difflineplus">+        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l19.178"></a><span id="l19.178" class="difflineplus">+        dialog.start(changeRecurrence);</span>
<a href="#l19.179"></a><span id="l19.179" class="difflineplus">+        event.waitForElement(eventid(&quot;item-repeat&quot;));</span>
<a href="#l19.180"></a><span id="l19.180" class="difflineplus">+        event.select(eventid(&quot;item-repeat&quot;), null, null, &quot;custom&quot;);</span>
<a href="#l19.181"></a><span id="l19.181"> </span>
<a href="#l19.182"></a><span id="l19.182" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l19.183"></a><span id="l19.183" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l19.184"></a><span id="l19.184" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l19.185"></a><span id="l19.185" class="difflineplus">+    });</span>
<a href="#l19.186"></a><span id="l19.186"> </span>
<a href="#l19.187"></a><span id="l19.187">     // check two weeks</span>
<a href="#l19.188"></a><span id="l19.188">     // day view</span>
<a href="#l19.189"></a><span id="l19.189" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.190"></a><span id="l19.190" class="difflineminus">-    let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l19.191"></a><span id="l19.191" class="difflineminus">-      eventPath;</span>
<a href="#l19.192"></a><span id="l19.192" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.193"></a><span id="l19.193" class="difflineplus">+    let path = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l19.194"></a><span id="l19.194"> </span>
<a href="#l19.195"></a><span id="l19.195" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.196"></a><span id="l19.196" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.197"></a><span id="l19.197" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.198"></a><span id="l19.198" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.199"></a><span id="l19.199"> </span>
<a href="#l19.200"></a><span id="l19.200" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.201"></a><span id="l19.201" class="difflineminus">-    let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l19.202"></a><span id="l19.202" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l19.203"></a><span id="l19.203" class="difflineminus">-      'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l19.204"></a><span id="l19.204" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l19.205"></a><span id="l19.205" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l19.206"></a><span id="l19.206" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.207"></a><span id="l19.207" class="difflineplus">+    let tuesPath = `</span>
<a href="#l19.208"></a><span id="l19.208" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l19.209"></a><span id="l19.209" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l19.210"></a><span id="l19.210" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l19.211"></a><span id="l19.211" class="difflineplus">+        id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l19.212"></a><span id="l19.212" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l19.213"></a><span id="l19.213" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l19.214"></a><span id="l19.214" class="difflineplus">+    `;</span>
<a href="#l19.215"></a><span id="l19.215" class="difflineplus">+</span>
<a href="#l19.216"></a><span id="l19.216">     // assert exactly two</span>
<a href="#l19.217"></a><span id="l19.217" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.218"></a><span id="l19.218" class="difflineminus">-      tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l19.219"></a><span id="l19.219" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.220"></a><span id="l19.220" class="difflineminus">-      tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l19.221"></a><span id="l19.221" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.222"></a><span id="l19.222" class="difflineminus">-      tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l19.223"></a><span id="l19.223" class="difflineplus">+    controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH));</span>
<a href="#l19.224"></a><span id="l19.224" class="difflineplus">+    controller.assertNode(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH));</span>
<a href="#l19.225"></a><span id="l19.225" class="difflineplus">+    controller.assertNodeNotExist(lookup(tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH));</span>
<a href="#l19.226"></a><span id="l19.226"> </span>
<a href="#l19.227"></a><span id="l19.227" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.228"></a><span id="l19.228" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.229"></a><span id="l19.229" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.230"></a><span id="l19.230" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.231"></a><span id="l19.231" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.232"></a><span id="l19.232" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.233"></a><span id="l19.233" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.234"></a><span id="l19.234" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.235"></a><span id="l19.235" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.236"></a><span id="l19.236" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.237"></a><span id="l19.237" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.238"></a><span id="l19.238" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l19.239"></a><span id="l19.239" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.240"></a><span id="l19.240" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.241"></a><span id="l19.241" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.242"></a><span id="l19.242" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l19.243"></a><span id="l19.243" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.244"></a><span id="l19.244" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.245"></a><span id="l19.245" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.246"></a><span id="l19.246" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.247"></a><span id="l19.247"> </span>
<a href="#l19.248"></a><span id="l19.248">     // next week</span>
<a href="#l19.249"></a><span id="l19.249" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.250"></a><span id="l19.250" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.251"></a><span id="l19.251" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.252"></a><span id="l19.252" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.253"></a><span id="l19.253" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.254"></a><span id="l19.254" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.255"></a><span id="l19.255" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.256"></a><span id="l19.256" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.257"></a><span id="l19.257" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.258"></a><span id="l19.258" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.259"></a><span id="l19.259" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.260"></a><span id="l19.260" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.261"></a><span id="l19.261" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.262"></a><span id="l19.262" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l19.263"></a><span id="l19.263" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.264"></a><span id="l19.264" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l19.265"></a><span id="l19.265" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.266"></a><span id="l19.266" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l19.267"></a><span id="l19.267" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.268"></a><span id="l19.268" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.269"></a><span id="l19.269" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.270"></a><span id="l19.270" class="difflineplus">+    controller.assertNode(lookup(path));</span>
<a href="#l19.271"></a><span id="l19.271" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.272"></a><span id="l19.272" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.273"></a><span id="l19.273"> </span>
<a href="#l19.274"></a><span id="l19.274">     // week view</span>
<a href="#l19.275"></a><span id="l19.275" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l19.276"></a><span id="l19.276" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.277"></a><span id="l19.277" class="difflineminus">-</span>
<a href="#l19.278"></a><span id="l19.278" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l19.279"></a><span id="l19.279" class="difflineminus">-      eventPath;</span>
<a href="#l19.280"></a><span id="l19.280" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.281"></a><span id="l19.281" class="difflineplus">+    switchToView(controller, &quot;week&quot;);</span>
<a href="#l19.282"></a><span id="l19.282" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.283"></a><span id="l19.283"> </span>
<a href="#l19.284"></a><span id="l19.284" class="difflineminus">-    tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l19.285"></a><span id="l19.285" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l19.286"></a><span id="l19.286" class="difflineminus">-      'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l19.287"></a><span id="l19.287" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l19.288"></a><span id="l19.288" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l19.289"></a><span id="l19.289" class="difflineminus">-    // assert exactly two</span>
<a href="#l19.290"></a><span id="l19.290" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.291"></a><span id="l19.291" class="difflineminus">-      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l19.292"></a><span id="l19.292" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.293"></a><span id="l19.293" class="difflineminus">-      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l19.294"></a><span id="l19.294" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l19.295"></a><span id="l19.295" class="difflineminus">-      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l19.296"></a><span id="l19.296" class="difflineplus">+    path = getEventBoxPath(&quot;week&quot;, EVENT_BOX, null, 2, HOUR) + EVENTPATH;</span>
<a href="#l19.297"></a><span id="l19.297" class="difflineplus">+    controller.assertNodeNotExist(lookup(path));</span>
<a href="#l19.298"></a><span id="l19.298"> </span>
<a href="#l19.299"></a><span id="l19.299" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l19.300"></a><span id="l19.300" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.301"></a><span id="l19.301" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l19.302"></a><span id="l19.302" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.303"></a><span id="l19.303" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l19.304"></a><span id="l19.304" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.305"></a><span id="l19.305" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l19.306"></a><span id="l19.306" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.307"></a><span id="l19.307" class="difflineplus">+    tuesPath = `</span>
<a href="#l19.308"></a><span id="l19.308" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l19.309"></a><span id="l19.309" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l19.310"></a><span id="l19.310" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l19.311"></a><span id="l19.311" class="difflineplus">+        id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l19.312"></a><span id="l19.312" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l19.313"></a><span id="l19.313" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]</span>
<a href="#l19.314"></a><span id="l19.314" class="difflineplus">+    `;</span>
<a href="#l19.315"></a><span id="l19.315" class="difflineplus">+    // assert exactly two</span>
<a href="#l19.316"></a><span id="l19.316" class="difflineplus">+    controller.assertNode(</span>
<a href="#l19.317"></a><span id="l19.317" class="difflineplus">+        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + EVENTPATH)</span>
<a href="#l19.318"></a><span id="l19.318" class="difflineplus">+    );</span>
<a href="#l19.319"></a><span id="l19.319" class="difflineplus">+    controller.assertNode(</span>
<a href="#l19.320"></a><span id="l19.320" class="difflineplus">+        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + EVENTPATH)</span>
<a href="#l19.321"></a><span id="l19.321" class="difflineplus">+    );</span>
<a href="#l19.322"></a><span id="l19.322" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l19.323"></a><span id="l19.323" class="difflineplus">+        lookup(tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + EVENTPATH)</span>
<a href="#l19.324"></a><span id="l19.324" class="difflineplus">+    );</span>
<a href="#l19.325"></a><span id="l19.325"> </span>
<a href="#l19.326"></a><span id="l19.326" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l19.327"></a><span id="l19.327" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l19.328"></a><span id="l19.328" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.329"></a><span id="l19.329" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l19.330"></a><span id="l19.330" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.331"></a><span id="l19.331" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l19.332"></a><span id="l19.332" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.333"></a><span id="l19.333" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l19.334"></a><span id="l19.334" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.335"></a><span id="l19.335" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l19.336"></a><span id="l19.336" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.337"></a><span id="l19.337" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l19.338"></a><span id="l19.338" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.339"></a><span id="l19.339" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l19.340"></a><span id="l19.340" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.341"></a><span id="l19.341" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR));</span>
<a href="#l19.342"></a><span id="l19.342" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, HOUR));</span>
<a href="#l19.343"></a><span id="l19.343" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l19.344"></a><span id="l19.344" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR));</span>
<a href="#l19.345"></a><span id="l19.345" class="difflineplus">+</span>
<a href="#l19.346"></a><span id="l19.346" class="difflineplus">+    viewForward(controller, 1);</span>
<a href="#l19.347"></a><span id="l19.347" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 1, HOUR));</span>
<a href="#l19.348"></a><span id="l19.348" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 2, HOUR));</span>
<a href="#l19.349"></a><span id="l19.349" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 3, HOUR));</span>
<a href="#l19.350"></a><span id="l19.350" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 4, HOUR));</span>
<a href="#l19.351"></a><span id="l19.351" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 5, HOUR));</span>
<a href="#l19.352"></a><span id="l19.352" class="difflineplus">+    controller.assertNode(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 6, HOUR));</span>
<a href="#l19.353"></a><span id="l19.353" class="difflineplus">+    controller.assertNodeNotExist(lookupEventBox(&quot;week&quot;, EVENT_BOX, null, 7, HOUR));</span>
<a href="#l19.354"></a><span id="l19.354"> </span>
<a href="#l19.355"></a><span id="l19.355">     // multiweek view</span>
<a href="#l19.356"></a><span id="l19.356" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l19.357"></a><span id="l19.357" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.358"></a><span id="l19.358" class="difflineplus">+    switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l19.359"></a><span id="l19.359" class="difflineplus">+    goToDate(controller, 2009, 1, 5);</span>
<a href="#l19.360"></a><span id="l19.360">     checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l19.361"></a><span id="l19.361"> </span>
<a href="#l19.362"></a><span id="l19.362">     // month view</span>
<a href="#l19.363"></a><span id="l19.363" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l19.364"></a><span id="l19.364" class="difflineplus">+    switchToView(controller, &quot;month&quot;);</span>
<a href="#l19.365"></a><span id="l19.365">     checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l19.366"></a><span id="l19.366"> </span>
<a href="#l19.367"></a><span id="l19.367">     // delete event</span>
<a href="#l19.368"></a><span id="l19.368" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.369"></a><span id="l19.369" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l19.370"></a><span id="l19.370" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l19.371"></a><span id="l19.371" class="difflineminus">-      eventPath;</span>
<a href="#l19.372"></a><span id="l19.372" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.373"></a><span id="l19.373" class="difflineminus">-    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l19.374"></a><span id="l19.374" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l19.375"></a><span id="l19.375" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l19.376"></a><span id="l19.376" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l19.377"></a><span id="l19.377" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l19.378"></a><span id="l19.378" class="difflineplus">+    goToDate(controller, 2009, 1, 12);</span>
<a href="#l19.379"></a><span id="l19.379" class="difflineplus">+    path = getEventBoxPath(&quot;day&quot;, EVENT_BOX, null, 1, HOUR) + EVENTPATH;</span>
<a href="#l19.380"></a><span id="l19.380" class="difflineplus">+</span>
<a href="#l19.381"></a><span id="l19.381" class="difflineplus">+    controller.click(lookup(path));</span>
<a href="#l19.382"></a><span id="l19.382" class="difflineplus">+    handleOccurrencePrompt(controller, eid(&quot;day-view&quot;), &quot;delete&quot;, true, false);</span>
<a href="#l19.383"></a><span id="l19.383" class="difflineplus">+    controller.waitForElementNotPresent(lookup(path));</span>
<a href="#l19.384"></a><span id="l19.384"> </span>
<a href="#l19.385"></a><span id="l19.385">     // reset view</span>
<a href="#l19.386"></a><span id="l19.386">     controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l19.387"></a><span id="l19.387" class="difflineminus">-    controller.waitFor(() =&gt; {</span>
<a href="#l19.388"></a><span id="l19.388" class="difflineminus">-        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l19.389"></a><span id="l19.389" class="difflineminus">-        return view.orient == &quot;vertical&quot;;</span>
<a href="#l19.390"></a><span id="l19.390" class="difflineminus">-    });</span>
<a href="#l19.391"></a><span id="l19.391" class="difflineminus">-};</span>
<a href="#l19.392"></a><span id="l19.392" class="difflineplus">+    controller.waitFor(() =&gt; eid(&quot;day-view&quot;).getNode().orient == &quot;vertical&quot;);</span>
<a href="#l19.393"></a><span id="l19.393" class="difflineplus">+}</span>
<a href="#l19.394"></a><span id="l19.394"> </span>
<a href="#l19.395"></a><span id="l19.395"> function setRecurrence(recurrence) {</span>
<a href="#l19.396"></a><span id="l19.396" class="difflineplus">+    let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l19.397"></a><span id="l19.397" class="difflineplus">+</span>
<a href="#l19.398"></a><span id="l19.398">     // weekly</span>
<a href="#l19.399"></a><span id="l19.399" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l19.400"></a><span id="l19.400" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l19.401"></a><span id="l19.401" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l19.402"></a><span id="l19.402" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l19.403"></a><span id="l19.403" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l19.404"></a><span id="l19.404" class="difflineplus">+    recsleep();</span>
<a href="#l19.405"></a><span id="l19.405"> </span>
<a href="#l19.406"></a><span id="l19.406">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l19.407"></a><span id="l19.407">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l19.408"></a><span id="l19.408">     let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l19.409"></a><span id="l19.409"> </span>
<a href="#l19.410"></a><span id="l19.410" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l19.411"></a><span id="l19.411" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l19.412"></a><span id="l19.412" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l19.413"></a><span id="l19.413" class="difflineplus">+    let days = `</span>
<a href="#l19.414"></a><span id="l19.414" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l19.415"></a><span id="l19.415" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l19.416"></a><span id="l19.416" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l19.417"></a><span id="l19.417" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l19.418"></a><span id="l19.418" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})</span>
<a href="#l19.419"></a><span id="l19.419" class="difflineplus">+    `;</span>
<a href="#l19.420"></a><span id="l19.420"> </span>
<a href="#l19.421"></a><span id="l19.421">     // starting from Monday so it should be checked</span>
<a href="#l19.422"></a><span id="l19.422" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l19.423"></a><span id="l19.423" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l19.424"></a><span id="l19.424">     // check Wednesday and Friday too</span>
<a href="#l19.425"></a><span id="l19.425" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l19.426"></a><span id="l19.426" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l19.427"></a><span id="l19.427" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l19.428"></a><span id="l19.428" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l19.429"></a><span id="l19.429"> </span>
<a href="#l19.430"></a><span id="l19.430">     // close dialog</span>
<a href="#l19.431"></a><span id="l19.431" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l19.432"></a><span id="l19.432" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l19.433"></a><span id="l19.433" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l19.434"></a><span id="l19.434" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l19.435"></a><span id="l19.435" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l19.436"></a><span id="l19.436" class="difflineplus">+    `));</span>
<a href="#l19.437"></a><span id="l19.437"> }</span>
<a href="#l19.438"></a><span id="l19.438"> </span>
<a href="#l19.439"></a><span id="l19.439"> function changeRecurrence(recurrence) {</span>
<a href="#l19.440"></a><span id="l19.440" class="difflineplus">+    let { sleep: recsleep, lookup: reclookup, eid: recid } = helpersForController(recurrence);</span>
<a href="#l19.441"></a><span id="l19.441" class="difflineplus">+</span>
<a href="#l19.442"></a><span id="l19.442">     // weekly</span>
<a href="#l19.443"></a><span id="l19.443" class="difflineminus">-    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l19.444"></a><span id="l19.444" class="difflineminus">-    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l19.445"></a><span id="l19.445" class="difflineminus">-    recurrence.sleep(sleep);</span>
<a href="#l19.446"></a><span id="l19.446" class="difflineplus">+    recurrence.waitForElement(recid(&quot;period-list&quot;));</span>
<a href="#l19.447"></a><span id="l19.447" class="difflineplus">+    recurrence.select(recid(&quot;period-list&quot;), null, null, &quot;1&quot;);</span>
<a href="#l19.448"></a><span id="l19.448" class="difflineplus">+    recsleep();</span>
<a href="#l19.449"></a><span id="l19.449"> </span>
<a href="#l19.450"></a><span id="l19.450">     let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l19.451"></a><span id="l19.451">     let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l19.452"></a><span id="l19.452">     let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l19.453"></a><span id="l19.453">     let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l19.454"></a><span id="l19.454"> </span>
<a href="#l19.455"></a><span id="l19.455" class="difflineminus">-    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l19.456"></a><span id="l19.456" class="difflineminus">-      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l19.457"></a><span id="l19.457" class="difflineminus">-      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l19.458"></a><span id="l19.458" class="difflineplus">+    let days = `</span>
<a href="#l19.459"></a><span id="l19.459" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/</span>
<a href="#l19.460"></a><span id="l19.460" class="difflineplus">+        id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/</span>
<a href="#l19.461"></a><span id="l19.461" class="difflineplus">+        id(&quot;recurrence-pattern-period-row&quot;)/id(&quot;period-deck&quot;)/</span>
<a href="#l19.462"></a><span id="l19.462" class="difflineplus">+        id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/</span>
<a href="#l19.463"></a><span id="l19.463" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;mainbox&quot;})/</span>
<a href="#l19.464"></a><span id="l19.464" class="difflineplus">+     `;</span>
<a href="#l19.465"></a><span id="l19.465"> </span>
<a href="#l19.466"></a><span id="l19.466">     // check old rule</span>
<a href="#l19.467"></a><span id="l19.467" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l19.468"></a><span id="l19.468" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l19.469"></a><span id="l19.469" class="difflineminus">-    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l19.470"></a><span id="l19.470" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${mon}&quot;}`));</span>
<a href="#l19.471"></a><span id="l19.471" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${wed}&quot;}`));</span>
<a href="#l19.472"></a><span id="l19.472" class="difflineplus">+    recurrence.assertChecked(reclookup(`${days}/{&quot;label&quot;:&quot;${fri}&quot;}`));</span>
<a href="#l19.473"></a><span id="l19.473"> </span>
<a href="#l19.474"></a><span id="l19.474">     // check Tuesday</span>
<a href="#l19.475"></a><span id="l19.475" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l19.476"></a><span id="l19.476" class="difflineplus">+    recurrence.click(reclookup(`${days}/{&quot;label&quot;:&quot;${tue}&quot;}`));</span>
<a href="#l19.477"></a><span id="l19.477"> </span>
<a href="#l19.478"></a><span id="l19.478">     // close dialog</span>
<a href="#l19.479"></a><span id="l19.479" class="difflineminus">-    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l19.480"></a><span id="l19.480" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l19.481"></a><span id="l19.481" class="difflineplus">+    recurrence.click(reclookup(`</span>
<a href="#l19.482"></a><span id="l19.482" class="difflineplus">+        /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l19.483"></a><span id="l19.483" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l19.484"></a><span id="l19.484" class="difflineplus">+    `));</span>
<a href="#l19.485"></a><span id="l19.485"> }</span>
<a href="#l19.486"></a><span id="l19.486"> </span>
<a href="#l19.487"></a><span id="l19.487"> function checkMultiWeekView(view) {</span>
<a href="#l19.488"></a><span id="l19.488">     let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l19.489"></a><span id="l19.489"> </span>
<a href="#l19.490"></a><span id="l19.490" class="difflineminus">-    let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l19.491"></a><span id="l19.491" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.492"></a><span id="l19.492" class="difflineplus">+    controller.assertNodeNotExist(</span>
<a href="#l19.493"></a><span id="l19.493" class="difflineplus">+        lookupEventBox(view, EVENT_BOX, startWeek, 2, HOUR, EVENTPATH)</span>
<a href="#l19.494"></a><span id="l19.494" class="difflineplus">+    );</span>
<a href="#l19.495"></a><span id="l19.495" class="difflineplus">+</span>
<a href="#l19.496"></a><span id="l19.496">     // assert exactly two</span>
<a href="#l19.497"></a><span id="l19.497" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l19.498"></a><span id="l19.498" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[0]&quot;));</span>
<a href="#l19.499"></a><span id="l19.499" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l19.500"></a><span id="l19.500" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[1]&quot;));</span>
<a href="#l19.501"></a><span id="l19.501" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l19.502"></a><span id="l19.502" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + &quot;/[2]&quot;));</span>
<a href="#l19.503"></a><span id="l19.503" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l19.504"></a><span id="l19.504" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.505"></a><span id="l19.505" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l19.506"></a><span id="l19.506" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.507"></a><span id="l19.507" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l19.508"></a><span id="l19.508" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.509"></a><span id="l19.509" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l19.510"></a><span id="l19.510" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.511"></a><span id="l19.511" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[0]&quot;));</span>
<a href="#l19.512"></a><span id="l19.512" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[1]&quot;));</span>
<a href="#l19.513"></a><span id="l19.513" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, &quot;/[2]&quot;));</span>
<a href="#l19.514"></a><span id="l19.514" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 4, HOUR, EVENTPATH));</span>
<a href="#l19.515"></a><span id="l19.515" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 5, HOUR, EVENTPATH));</span>
<a href="#l19.516"></a><span id="l19.516" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 6, HOUR, EVENTPATH));</span>
<a href="#l19.517"></a><span id="l19.517" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 7, HOUR, EVENTPATH));</span>
<a href="#l19.518"></a><span id="l19.518"> </span>
<a href="#l19.519"></a><span id="l19.519" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l19.520"></a><span id="l19.520" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.521"></a><span id="l19.521" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l19.522"></a><span id="l19.522" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.523"></a><span id="l19.523" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l19.524"></a><span id="l19.524" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.525"></a><span id="l19.525" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l19.526"></a><span id="l19.526" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.527"></a><span id="l19.527" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l19.528"></a><span id="l19.528" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.529"></a><span id="l19.529" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l19.530"></a><span id="l19.530" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.531"></a><span id="l19.531" class="difflineminus">-    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l19.532"></a><span id="l19.532" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l19.533"></a><span id="l19.533" class="difflineplus">+    startWeek++;</span>
<a href="#l19.534"></a><span id="l19.534" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 1, HOUR, EVENTPATH));</span>
<a href="#l19.535"></a><span id="l19.535" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 2, HOUR, EVENTPATH));</span>
<a href="#l19.536"></a><span id="l19.536" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 3, HOUR, EVENTPATH));</span>
<a href="#l19.537"></a><span id="l19.537" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 4, HOUR, EVENTPATH));</span>
<a href="#l19.538"></a><span id="l19.538" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 5, HOUR, EVENTPATH));</span>
<a href="#l19.539"></a><span id="l19.539" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 6, HOUR, EVENTPATH));</span>
<a href="#l19.540"></a><span id="l19.540" class="difflineplus">+    controller.assertNode(lookupEventBox(view, EVENT_BOX, startWeek, 7, HOUR, EVENTPATH));</span>
<a href="#l19.541"></a><span id="l19.541"> }</span>
<a href="#l19.542"></a><span id="l19.542"> </span>
<a href="#l19.543"></a><span id="l19.543" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l19.544"></a><span id="l19.544" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l19.545"></a><span id="l19.545" class="difflineminus">-};</span>
<a href="#l19.546"></a><span id="l19.546" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l19.547"></a><span id="l19.547" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l19.548"></a><span id="l19.548" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">old mode 100644</span>
<a href="#l20.2"></a><span id="l20.2">new mode 100755</span>
<a href="#l20.3"></a><span id="l20.3">rename from calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l20.4"></a><span id="l20.4">rename to calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineat">@@ -1,681 +1,833 @@</span>
<a href="#l20.8"></a><span id="l20.8"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.9"></a><span id="l20.9">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.10"></a><span id="l20.10">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12"> var MODULE_NAME = &quot;calendar-utils&quot;;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-var MODULE_REQUIRES = [&quot;window-helpers&quot;];</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+var MODULE_REQUIRES = [&quot;window-helpers&quot;, &quot;folder-display-helpers&quot;, &quot;pref-window-helpers&quot;];</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.18"></a><span id="l20.18"> var os = {};</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineminus">-Components.utils.import(&quot;resource://mozmill/stdlib/os.js&quot;, os);</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+Cu.import(&quot;resource://mozmill/stdlib/os.js&quot;, os);</span>
<a href="#l20.21"></a><span id="l20.21"> var frame = {};</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineminus">-Components.utils.import(&quot;resource://mozmill/modules/frame.js&quot;, frame);</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+Cu.import(&quot;resource://mozmill/modules/frame.js&quot;, frame);</span>
<a href="#l20.24"></a><span id="l20.24"> </span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-var modalDialog = require(&quot;test-window-helpers&quot;);</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+var SHORT_SLEEP = 100;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+var MID_SLEEP = 500;</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+var CALENDARNAME = &quot;Mozmill&quot;;</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-var sleep = 500;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+// these are used in EventBox lookup.</span>
<a href="#l20.33"></a><span id="l20.33"> var EVENT_BOX = 0; // Use when you need an event box</span>
<a href="#l20.34"></a><span id="l20.34"> var CANVAS_BOX = 1; // Use when you need a calendar canvas box</span>
<a href="#l20.35"></a><span id="l20.35"> var ALLDAY = 2; // Use when you need an allday canvas or event box</span>
<a href="#l20.36"></a><span id="l20.36"> </span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-/**</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">- *  Accept to send notification email with event to attendees</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">- */</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-function acceptSendingNotificationMail(controller) {</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-    modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (dialog) =&gt; {</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-        dialog.waitThenClick(new elementslib.Lookup(dialog.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog, open_pref_window;</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+function setupModule() {</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+    // this setup is needed for pref-win-helpers. For some reason, the automatic</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+    // loading of modules in shared modules does not setup the module correctly.</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+    collector.getModule(&quot;folder-display-helpers&quot;).setupModule();</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+    ({ open_pref_window } = collector.getModule(&quot;pref-window-helpers&quot;));</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+    collector.getModule(&quot;pref-window-helpers&quot;).setupModule();</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+}</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+function installInto(module) {</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+    // copy constants into module</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+    module.SHORT_SLEEP = SHORT_SLEEP;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+    module.MID_SLEEP = MID_SLEEP;</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+    module.TIMEOUT_MODAL_DIALOG = TIMEOUT_MODAL_DIALOG;</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+    module.CALENDARNAME = CALENDARNAME;</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+    module.EVENT_BOX = EVENT_BOX;</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+    module.CANVAS_BOX = CANVAS_BOX;</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineplus">+    module.ALLDAY = ALLDAY;</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineplus">+    // Now copy helper functions</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+    module.helpersForController = helpersForController;</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+    module.acceptSendingNotificationMail = acceptSendingNotificationMail;</span>
<a href="#l20.71"></a><span id="l20.71" class="difflineplus">+    module.handleAddingAttachment = handleAddingAttachment;</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineplus">+    module.handleOccurrencePrompt = handleOccurrencePrompt;</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineplus">+    module.switchToView = switchToView;</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineplus">+    module.goToDate = goToDate;</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineplus">+    module.invokeEventDialog = invokeEventDialog;</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineplus">+    module.getEventBoxPath = getEventBoxPath;</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineplus">+    module.viewForward = viewForward;</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineplus">+    module.viewBack = viewBack;</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineplus">+    module.deleteCalendars = deleteCalendars;</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+    module.createCalendar = createCalendar;</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineplus">+    module.handleNewCalendarWizard = handleNewCalendarWizard;</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+    module.findEventsInNode = findEventsInNode;</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineplus">+    module.setData = setData;</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineplus">+    module.openLightningPrefs = openLightningPrefs;</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineplus">+    module.menulistSelect = menulistSelect;</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+}</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineplus">+</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineplus">+function helpersForController(controller) {</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineplus">+    function selector(sel) {</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineplus">+        return sel.trim().replace(/\n(\s*)/g, &quot;&quot;);</span>
<a href="#l20.91"></a><span id="l20.91">     }</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineminus">-  );</span>
<a href="#l20.93"></a><span id="l20.93"> </span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-    modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineplus">+    return {</span>
<a href="#l20.96"></a><span id="l20.96" class="difflineplus">+        lookup: (sel) =&gt; new elementslib.Lookup(controller.window.document, selector(sel)),</span>
<a href="#l20.97"></a><span id="l20.97" class="difflineplus">+        eid: (id) =&gt; new elementslib.ID(controller.window.document, id),</span>
<a href="#l20.98"></a><span id="l20.98" class="difflineplus">+        xpath: (path) =&gt; new elementslib.XPath(controller.window.document, selector(path)),</span>
<a href="#l20.99"></a><span id="l20.99" class="difflineplus">+        sleep: (timeout = MID_SLEEP) =&gt; controller.sleep(timeout),</span>
<a href="#l20.100"></a><span id="l20.100" class="difflineplus">+        getEventBoxPath: (...args) =&gt; getEventBoxPath(controller, ...args),</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineplus">+        lookupEventBox: (view, option, row, column, hour, extra = &quot;/&quot;) =&gt; {</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineplus">+            let path = getEventBoxPath(controller, view, option, row, column, hour);</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineplus">+            return new elementslib.Lookup(controller.window.document, selector(path + extra));</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+        }</span>
<a href="#l20.105"></a><span id="l20.105" class="difflineplus">+    };</span>
<a href="#l20.106"></a><span id="l20.106"> }</span>
<a href="#l20.107"></a><span id="l20.107"> </span>
<a href="#l20.108"></a><span id="l20.108"> /**</span>
<a href="#l20.109"></a><span id="l20.109" class="difflineminus">- *  Add an attachment with url</span>
<a href="#l20.110"></a><span id="l20.110" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineplus">+ * Accept to send notification email with event to attendees</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineplus">+ *</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineplus">+ * @param controller        Mozmill window controller</span>
<a href="#l20.114"></a><span id="l20.114">  */</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineminus">-function handleAddingAttachment(controller, url) {</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineminus">-    modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (attachment) =&gt; {</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineminus">-        let input = new elementslib.ID(attachment.window.document, &quot;loginTextbox&quot;);</span>
<a href="#l20.118"></a><span id="l20.118" class="difflineminus">-        attachment.waitForElement(input);</span>
<a href="#l20.119"></a><span id="l20.119" class="difflineminus">-        input.getNode().value = url;</span>
<a href="#l20.120"></a><span id="l20.120" class="difflineminus">-        attachment.click(new elementslib.Lookup(attachment.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineplus">+function acceptSendingNotificationMail(controller) {</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineplus">+    plan_for_modal_dialog(&quot;commonDialog&quot;, (dialog) =&gt; {</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineplus">+        let { lookup: cdlglookup } = helpersForController(dialog);</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineplus">+        dialog.waitThenClick(cdlglookup(`</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineplus">+            /id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineplus">+        `));</span>
<a href="#l20.128"></a><span id="l20.128">     });</span>
<a href="#l20.129"></a><span id="l20.129"> </span>
<a href="#l20.130"></a><span id="l20.130" class="difflineminus">-    modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l20.131"></a><span id="l20.131" class="difflineplus">+    wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l20.132"></a><span id="l20.132"> }</span>
<a href="#l20.133"></a><span id="l20.133"> </span>
<a href="#l20.134"></a><span id="l20.134"> /**</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineminus">- *  Choose to delete just one occurrence of a repeating event</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineminus">- *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineplus">+ * Add an attachment with url</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineplus">+ *</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineplus">+ * @param controller        Mozmill window controller</span>
<a href="#l20.141"></a><span id="l20.141">  */</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineminus">-function handleOccurrenceDeletion(controller, attendees) {</span>
<a href="#l20.143"></a><span id="l20.143" class="difflineminus">-    let dialog = new modalDialog.modalDialog(controller.window);</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineminus">-    dialog.start((dialogController) =&gt; {</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineminus">-        if (attendees) {</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineminus">-            acceptSendingNotificationMail();</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineminus">-        }</span>
<a href="#l20.148"></a><span id="l20.148" class="difflineminus">-        dialogController.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-occurrence-button&quot;));</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineplus">+function handleAddingAttachment(controller, url) {</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineplus">+    plan_for_modal_dialog(&quot;commonDialog&quot;, (attachment) =&gt; {</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineplus">+        let { lookup: cdlglookup, eid: cdlgid } = helpersForController(attachment);</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineplus">+        attachment.waitForElement(cdlgid(&quot;loginTextbox&quot;));</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineplus">+        cdlgid(&quot;loginTextbox&quot;).getNode().value = url;</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineplus">+        attachment.click(cdlglookup(`</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineplus">+            /id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+        `));</span>
<a href="#l20.157"></a><span id="l20.157">     });</span>
<a href="#l20.158"></a><span id="l20.158" class="difflineplus">+</span>
<a href="#l20.159"></a><span id="l20.159" class="difflineplus">+    wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l20.160"></a><span id="l20.160"> }</span>
<a href="#l20.161"></a><span id="l20.161"> </span>
<a href="#l20.162"></a><span id="l20.162"> /**</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineminus">- *  Choose to delete all occurrences of a repeating event</span>
<a href="#l20.164"></a><span id="l20.164" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.165"></a><span id="l20.165" class="difflineminus">- *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l20.166"></a><span id="l20.166" class="difflineplus">+ * open and click the appropriate button on the recurrence-Prompt Dialog</span>
<a href="#l20.167"></a><span id="l20.167" class="difflineplus">+ *</span>
<a href="#l20.168"></a><span id="l20.168" class="difflineplus">+ * @param controller      Mozmill window controller</span>
<a href="#l20.169"></a><span id="l20.169" class="difflineplus">+ * @param element         Mozmill element which will open the dialog</span>
<a href="#l20.170"></a><span id="l20.170" class="difflineplus">+ * @param mode            action to exec on element (delete OR modify)</span>
<a href="#l20.171"></a><span id="l20.171" class="difflineplus">+ * @param selectParent    true if all occurrences should be deleted</span>
<a href="#l20.172"></a><span id="l20.172" class="difflineplus">+ * @param attendees       Whether there are attendees that can be notified or not</span>
<a href="#l20.173"></a><span id="l20.173">  */</span>
<a href="#l20.174"></a><span id="l20.174" class="difflineminus">-function handleParentDeletion(controller, attendees) {</span>
<a href="#l20.175"></a><span id="l20.175" class="difflineminus">-    let dialog = new modalDialog.modalDialog(controller.window);</span>
<a href="#l20.176"></a><span id="l20.176" class="difflineminus">-    dialog.start((dialogController) =&gt; {</span>
<a href="#l20.177"></a><span id="l20.177" class="difflineplus">+function handleOccurrencePrompt(controller, element, mode, selectParent, attendees) {</span>
<a href="#l20.178"></a><span id="l20.178" class="difflineplus">+    controller.waitForElement(element);</span>
<a href="#l20.179"></a><span id="l20.179" class="difflineplus">+    plan_for_modal_dialog(&quot;Calendar:OccurrencePrompt&quot;, (dialog) =&gt; {</span>
<a href="#l20.180"></a><span id="l20.180" class="difflineplus">+        let { eid: dlgid } = helpersForController(dialog);</span>
<a href="#l20.181"></a><span id="l20.181">         if (attendees) {</span>
<a href="#l20.182"></a><span id="l20.182">             acceptSendingNotificationMail();</span>
<a href="#l20.183"></a><span id="l20.183">         }</span>
<a href="#l20.184"></a><span id="l20.184" class="difflineminus">-        dialogController.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-parent-button&quot;));</span>
<a href="#l20.185"></a><span id="l20.185" class="difflineplus">+        if (selectParent) {</span>
<a href="#l20.186"></a><span id="l20.186" class="difflineplus">+            dialog.waitThenClick(dlgid(&quot;accept-parent-button&quot;));</span>
<a href="#l20.187"></a><span id="l20.187" class="difflineplus">+        } else {</span>
<a href="#l20.188"></a><span id="l20.188" class="difflineplus">+            dialog.waitThenClick(dlgid(&quot;accept-occurrence-button&quot;));</span>
<a href="#l20.189"></a><span id="l20.189" class="difflineplus">+        }</span>
<a href="#l20.190"></a><span id="l20.190">     });</span>
<a href="#l20.191"></a><span id="l20.191" class="difflineminus">-}</span>
<a href="#l20.192"></a><span id="l20.192" class="difflineminus">-</span>
<a href="#l20.193"></a><span id="l20.193" class="difflineminus">-/**</span>
<a href="#l20.194"></a><span id="l20.194" class="difflineminus">- *  Choose to modify just one occurrence of a repeating event</span>
<a href="#l20.195"></a><span id="l20.195" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.196"></a><span id="l20.196" class="difflineminus">- *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l20.197"></a><span id="l20.197" class="difflineminus">- */</span>
<a href="#l20.198"></a><span id="l20.198" class="difflineminus">-function handleOccurrenceModification(controller, attendees) {</span>
<a href="#l20.199"></a><span id="l20.199" class="difflineminus">-    handleOccurrenceDeletion(controller, attendees);</span>
<a href="#l20.200"></a><span id="l20.200" class="difflineminus">-}</span>
<a href="#l20.201"></a><span id="l20.201" class="difflineminus">-</span>
<a href="#l20.202"></a><span id="l20.202" class="difflineminus">-/**</span>
<a href="#l20.203"></a><span id="l20.203" class="difflineminus">- *  Choose to modify all occurrences of a repeating event</span>
<a href="#l20.204"></a><span id="l20.204" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.205"></a><span id="l20.205" class="difflineminus">- *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l20.206"></a><span id="l20.206" class="difflineminus">- */</span>
<a href="#l20.207"></a><span id="l20.207" class="difflineminus">-function handleParentModification(controller, attendees) {</span>
<a href="#l20.208"></a><span id="l20.208" class="difflineminus">-    handleParentDeletion(controller, attendees);</span>
<a href="#l20.209"></a><span id="l20.209" class="difflineplus">+    if (mode == &quot;delete&quot;) {</span>
<a href="#l20.210"></a><span id="l20.210" class="difflineplus">+        controller.keypress(element, &quot;VK_DELETE&quot;, {});</span>
<a href="#l20.211"></a><span id="l20.211" class="difflineplus">+    } else if (mode == &quot;modify&quot;) {</span>
<a href="#l20.212"></a><span id="l20.212" class="difflineplus">+        controller.doubleClick(element);</span>
<a href="#l20.213"></a><span id="l20.213" class="difflineplus">+    }</span>
<a href="#l20.214"></a><span id="l20.214" class="difflineplus">+    wait_for_modal_dialog(&quot;Calendar:OccurrencePrompt&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l20.215"></a><span id="l20.215"> }</span>
<a href="#l20.216"></a><span id="l20.216"> </span>
<a href="#l20.217"></a><span id="l20.217"> /**</span>
<a href="#l20.218"></a><span id="l20.218" class="difflineminus">- *  Switch to a view</span>
<a href="#l20.219"></a><span id="l20.219" class="difflineminus">- *  @param controller - Mozmill window controller</span>
<a href="#l20.220"></a><span id="l20.220" class="difflineminus">- *  @param view - day, week, multiweek or month</span>
<a href="#l20.221"></a><span id="l20.221" class="difflineplus">+ * Switch to a view and make sure it's displayed</span>
<a href="#l20.222"></a><span id="l20.222" class="difflineplus">+ *</span>
<a href="#l20.223"></a><span id="l20.223" class="difflineplus">+ * @param controller        Mozmill window controller</span>
<a href="#l20.224"></a><span id="l20.224" class="difflineplus">+ * @param view              day, week, multiweek or month</span>
<a href="#l20.225"></a><span id="l20.225">  */</span>
<a href="#l20.226"></a><span id="l20.226"> function switchToView(controller, view) {</span>
<a href="#l20.227"></a><span id="l20.227" class="difflineminus">-    switch (view) {</span>
<a href="#l20.228"></a><span id="l20.228" class="difflineminus">-        case &quot;week&quot;:</span>
<a href="#l20.229"></a><span id="l20.229" class="difflineminus">-            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l20.230"></a><span id="l20.230" class="difflineminus">-              &quot;calendar-week-view-button&quot;));</span>
<a href="#l20.231"></a><span id="l20.231" class="difflineminus">-            controller.waitFor(() =&gt; {</span>
<a href="#l20.232"></a><span id="l20.232" class="difflineminus">-                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l20.233"></a><span id="l20.233" class="difflineminus">-                &quot;calendar-week-view-button&quot;);</span>
<a href="#l20.234"></a><span id="l20.234" class="difflineminus">-                return button.getNode().selected == true;</span>
<a href="#l20.235"></a><span id="l20.235" class="difflineminus">-            });</span>
<a href="#l20.236"></a><span id="l20.236" class="difflineminus">-            break;</span>
<a href="#l20.237"></a><span id="l20.237" class="difflineminus">-        case &quot;multiweek&quot;:</span>
<a href="#l20.238"></a><span id="l20.238" class="difflineminus">-            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l20.239"></a><span id="l20.239" class="difflineminus">-              &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l20.240"></a><span id="l20.240" class="difflineminus">-            controller.waitFor(() =&gt; {</span>
<a href="#l20.241"></a><span id="l20.241" class="difflineminus">-                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l20.242"></a><span id="l20.242" class="difflineminus">-                &quot;calendar-multiweek-view-button&quot;);</span>
<a href="#l20.243"></a><span id="l20.243" class="difflineminus">-                return button.getNode().selected == true;</span>
<a href="#l20.244"></a><span id="l20.244" class="difflineminus">-            });</span>
<a href="#l20.245"></a><span id="l20.245" class="difflineminus">-            break;</span>
<a href="#l20.246"></a><span id="l20.246" class="difflineminus">-        case &quot;month&quot;:</span>
<a href="#l20.247"></a><span id="l20.247" class="difflineminus">-            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l20.248"></a><span id="l20.248" class="difflineminus">-              &quot;calendar-month-view-button&quot;));</span>
<a href="#l20.249"></a><span id="l20.249" class="difflineminus">-            controller.waitFor(() =&gt; {</span>
<a href="#l20.250"></a><span id="l20.250" class="difflineminus">-                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l20.251"></a><span id="l20.251" class="difflineminus">-                &quot;calendar-month-view-button&quot;);</span>
<a href="#l20.252"></a><span id="l20.252" class="difflineminus">-                return button.getNode().selected == true;</span>
<a href="#l20.253"></a><span id="l20.253" class="difflineminus">-            });</span>
<a href="#l20.254"></a><span id="l20.254" class="difflineminus">-            break;</span>
<a href="#l20.255"></a><span id="l20.255" class="difflineminus">-        default:</span>
<a href="#l20.256"></a><span id="l20.256" class="difflineminus">-            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l20.257"></a><span id="l20.257" class="difflineminus">-              &quot;calendar-day-view-button&quot;));</span>
<a href="#l20.258"></a><span id="l20.258" class="difflineminus">-            controller.waitFor(() =&gt; {</span>
<a href="#l20.259"></a><span id="l20.259" class="difflineminus">-                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l20.260"></a><span id="l20.260" class="difflineminus">-                &quot;calendar-day-view-button&quot;);</span>
<a href="#l20.261"></a><span id="l20.261" class="difflineminus">-                return button.getNode().selected == true;</span>
<a href="#l20.262"></a><span id="l20.262" class="difflineminus">-            });</span>
<a href="#l20.263"></a><span id="l20.263" class="difflineplus">+    let { eid } = helpersForController(controller);</span>
<a href="#l20.264"></a><span id="l20.264" class="difflineplus">+</span>
<a href="#l20.265"></a><span id="l20.265" class="difflineplus">+    let views = { day: 0, week: 1, multiweek: 2, month: 3 };</span>
<a href="#l20.266"></a><span id="l20.266" class="difflineplus">+    controller.waitForEvents.init(</span>
<a href="#l20.267"></a><span id="l20.267" class="difflineplus">+        controller.window.getViewDeck().childNodes[views[view]],</span>
<a href="#l20.268"></a><span id="l20.268" class="difflineplus">+        [&quot;viewloaded&quot;]</span>
<a href="#l20.269"></a><span id="l20.269" class="difflineplus">+    );</span>
<a href="#l20.270"></a><span id="l20.270" class="difflineplus">+    let button = `calendar-${view}-view-button`;</span>
<a href="#l20.271"></a><span id="l20.271" class="difflineplus">+    controller.waitThenClick(eid(button));</span>
<a href="#l20.272"></a><span id="l20.272" class="difflineplus">+</span>
<a href="#l20.273"></a><span id="l20.273" class="difflineplus">+    // wait for the view to be loaded</span>
<a href="#l20.274"></a><span id="l20.274" class="difflineplus">+    try {</span>
<a href="#l20.275"></a><span id="l20.275" class="difflineplus">+        controller.waitForEvents.wait(4000);</span>
<a href="#l20.276"></a><span id="l20.276" class="difflineplus">+    } catch (err) {</span>
<a href="#l20.277"></a><span id="l20.277" class="difflineplus">+      // The event only fires, if the view reloads the displayed events.</span>
<a href="#l20.278"></a><span id="l20.278" class="difflineplus">+      // when switching from month-view to day-view, changing forward-backward</span>
<a href="#l20.279"></a><span id="l20.279" class="difflineplus">+      // some times, it may be still the same month when switching back to</span>
<a href="#l20.280"></a><span id="l20.280" class="difflineplus">+      // month-view. In this case we just have to wait for the view to be ready.</span>
<a href="#l20.281"></a><span id="l20.281" class="difflineplus">+      // Since data loading may take some time, we have to wait a decent time</span>
<a href="#l20.282"></a><span id="l20.282" class="difflineplus">+      // to give the view time to load and fire the event.</span>
<a href="#l20.283"></a><span id="l20.283">     }</span>
<a href="#l20.284"></a><span id="l20.284"> }</span>
<a href="#l20.285"></a><span id="l20.285"> </span>
<a href="#l20.286"></a><span id="l20.286"> /**</span>
<a href="#l20.287"></a><span id="l20.287" class="difflineminus">- *  Go to a specific date using minimonth</span>
<a href="#l20.288"></a><span id="l20.288" class="difflineminus">- *  @param controller - main window controller</span>
<a href="#l20.289"></a><span id="l20.289" class="difflineminus">- *  @param year - four-digit year</span>
<a href="#l20.290"></a><span id="l20.290" class="difflineminus">- *  @param month - 1-based index of a month</span>
<a href="#l20.291"></a><span id="l20.291" class="difflineminus">- *  @param day - 1-based index of a day</span>
<a href="#l20.292"></a><span id="l20.292" class="difflineplus">+ * Go to a specific date using minimonth</span>
<a href="#l20.293"></a><span id="l20.293" class="difflineplus">+ *</span>
<a href="#l20.294"></a><span id="l20.294" class="difflineplus">+ * @param controller    Main window controller</span>
<a href="#l20.295"></a><span id="l20.295" class="difflineplus">+ * @param year          Four-digit year</span>
<a href="#l20.296"></a><span id="l20.296" class="difflineplus">+ * @param month         1-based index of a month</span>
<a href="#l20.297"></a><span id="l20.297" class="difflineplus">+ * @param day           1-based index of a day</span>
<a href="#l20.298"></a><span id="l20.298">  */</span>
<a href="#l20.299"></a><span id="l20.299"> function goToDate(controller, year, month, day) {</span>
<a href="#l20.300"></a><span id="l20.300" class="difflineminus">-    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l20.301"></a><span id="l20.301" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l20.302"></a><span id="l20.302" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l20.303"></a><span id="l20.303" class="difflineminus">-    let activeYear = (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.304"></a><span id="l20.304" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l20.305"></a><span id="l20.305" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l20.306"></a><span id="l20.306" class="difflineminus">-    let activeMonth = (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.307"></a><span id="l20.307" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l20.308"></a><span id="l20.308" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;index&quot;);</span>
<a href="#l20.309"></a><span id="l20.309" class="difflineplus">+    let { lookup, sleep } = helpersForController(controller);</span>
<a href="#l20.310"></a><span id="l20.310" class="difflineplus">+</span>
<a href="#l20.311"></a><span id="l20.311" class="difflineplus">+    let miniMonth = `</span>
<a href="#l20.312"></a><span id="l20.312" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l20.313"></a><span id="l20.313" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l20.314"></a><span id="l20.314" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l20.315"></a><span id="l20.315" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l20.316"></a><span id="l20.316" class="difflineplus">+    `;</span>
<a href="#l20.317"></a><span id="l20.317" class="difflineplus">+</span>
<a href="#l20.318"></a><span id="l20.318" class="difflineplus">+    let activeYear = lookup(`</span>
<a href="#l20.319"></a><span id="l20.319" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l20.320"></a><span id="l20.320" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l20.321"></a><span id="l20.321" class="difflineplus">+    `).getNode().getAttribute(&quot;label&quot;);</span>
<a href="#l20.322"></a><span id="l20.322" class="difflineplus">+</span>
<a href="#l20.323"></a><span id="l20.323" class="difflineplus">+    let activeMonth = lookup(`</span>
<a href="#l20.324"></a><span id="l20.324" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l20.325"></a><span id="l20.325" class="difflineplus">+    `).getNode().getAttribute(&quot;selectedIndex&quot;);</span>
<a href="#l20.326"></a><span id="l20.326" class="difflineplus">+</span>
<a href="#l20.327"></a><span id="l20.327">     let yearDifference = activeYear - year;</span>
<a href="#l20.328"></a><span id="l20.328">     let monthDifference = activeMonth - (month - 1);</span>
<a href="#l20.329"></a><span id="l20.329"> </span>
<a href="#l20.330"></a><span id="l20.330">     if (yearDifference != 0) {</span>
<a href="#l20.331"></a><span id="l20.331" class="difflineminus">-        let scrollArrow = yearDifference &gt; 0</span>
<a href="#l20.332"></a><span id="l20.332" class="difflineminus">-          ? (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.333"></a><span id="l20.333" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l20.334"></a><span id="l20.334" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-up&quot;}')).getNode()</span>
<a href="#l20.335"></a><span id="l20.335" class="difflineminus">-          : (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.336"></a><span id="l20.336" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l20.337"></a><span id="l20.337" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-down&quot;}')).getNode();</span>
<a href="#l20.338"></a><span id="l20.338" class="difflineplus">+        let direction = yearDifference &gt; 0 ? &quot;up&quot; : &quot;down&quot;;</span>
<a href="#l20.339"></a><span id="l20.339" class="difflineplus">+        let scrollArrow = lookup(`</span>
<a href="#l20.340"></a><span id="l20.340" class="difflineplus">+            ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l20.341"></a><span id="l20.341" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/</span>
<a href="#l20.342"></a><span id="l20.342" class="difflineplus">+            [0]/{&quot;class&quot;:&quot;autorepeatbutton-${direction}&quot;}`);</span>
<a href="#l20.343"></a><span id="l20.343"> </span>
<a href="#l20.344"></a><span id="l20.344">         // pick year</span>
<a href="#l20.345"></a><span id="l20.345" class="difflineminus">-        controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.346"></a><span id="l20.346" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l20.347"></a><span id="l20.347" class="difflineminus">-        controller.sleep(500);</span>
<a href="#l20.348"></a><span id="l20.348" class="difflineplus">+        controller.click(lookup(`</span>
<a href="#l20.349"></a><span id="l20.349" class="difflineplus">+            ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l20.350"></a><span id="l20.350" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l20.351"></a><span id="l20.351" class="difflineplus">+        `));</span>
<a href="#l20.352"></a><span id="l20.352" class="difflineplus">+</span>
<a href="#l20.353"></a><span id="l20.353" class="difflineplus">+        controller.waitForElement(scrollArrow);</span>
<a href="#l20.354"></a><span id="l20.354" class="difflineplus">+        scrollArrow = scrollArrow.getNode();</span>
<a href="#l20.355"></a><span id="l20.355"> </span>
<a href="#l20.356"></a><span id="l20.356">         for (let i = 0; i &lt; Math.abs(yearDifference); i++) {</span>
<a href="#l20.357"></a><span id="l20.357">             scrollArrow.doCommand();</span>
<a href="#l20.358"></a><span id="l20.358" class="difflineminus">-            controller.sleep(100);</span>
<a href="#l20.359"></a><span id="l20.359" class="difflineplus">+            sleep(SHORT_SLEEP);</span>
<a href="#l20.360"></a><span id="l20.360">         }</span>
<a href="#l20.361"></a><span id="l20.361"> </span>
<a href="#l20.362"></a><span id="l20.362" class="difflineminus">-        controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.363"></a><span id="l20.363" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l20.364"></a><span id="l20.364" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;' + year + '&quot;}'));</span>
<a href="#l20.365"></a><span id="l20.365" class="difflineminus">-        controller.sleep(500);</span>
<a href="#l20.366"></a><span id="l20.366" class="difflineplus">+        controller.click(lookup(`</span>
<a href="#l20.367"></a><span id="l20.367" class="difflineplus">+            ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l20.368"></a><span id="l20.368" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/</span>
<a href="#l20.369"></a><span id="l20.369" class="difflineplus">+            [0]/{&quot;value&quot;:&quot;${year}&quot;}</span>
<a href="#l20.370"></a><span id="l20.370" class="difflineplus">+        `));</span>
<a href="#l20.371"></a><span id="l20.371" class="difflineplus">+        sleep();</span>
<a href="#l20.372"></a><span id="l20.372">     }</span>
<a href="#l20.373"></a><span id="l20.373"> </span>
<a href="#l20.374"></a><span id="l20.374">     if (monthDifference != 0) {</span>
<a href="#l20.375"></a><span id="l20.375">         // pick month</span>
<a href="#l20.376"></a><span id="l20.376" class="difflineminus">-        controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.377"></a><span id="l20.377" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})/[' + activeMonth +</span>
<a href="#l20.378"></a><span id="l20.378" class="difflineminus">-          &quot;]&quot;));</span>
<a href="#l20.379"></a><span id="l20.379" class="difflineminus">-        controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.380"></a><span id="l20.380" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l20.381"></a><span id="l20.381" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;' + (month - 1) + '&quot;}'));</span>
<a href="#l20.382"></a><span id="l20.382" class="difflineminus">-        controller.sleep(500);</span>
<a href="#l20.383"></a><span id="l20.383" class="difflineplus">+        controller.click(lookup(`</span>
<a href="#l20.384"></a><span id="l20.384" class="difflineplus">+            ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l20.385"></a><span id="l20.385" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;monthheader&quot;})/[${activeMonth}]</span>
<a href="#l20.386"></a><span id="l20.386" class="difflineplus">+        `));</span>
<a href="#l20.387"></a><span id="l20.387" class="difflineplus">+        controller.waitThenClick(lookup(`</span>
<a href="#l20.388"></a><span id="l20.388" class="difflineplus">+            ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l20.389"></a><span id="l20.389" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/</span>
<a href="#l20.390"></a><span id="l20.390" class="difflineplus">+            [0]/{&quot;index&quot;:&quot;${month - 1}&quot;}</span>
<a href="#l20.391"></a><span id="l20.391" class="difflineplus">+        `));</span>
<a href="#l20.392"></a><span id="l20.392" class="difflineplus">+        sleep();</span>
<a href="#l20.393"></a><span id="l20.393">     }</span>
<a href="#l20.394"></a><span id="l20.394"> </span>
<a href="#l20.395"></a><span id="l20.395" class="difflineminus">-    let lastDayInFirstRow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l20.396"></a><span id="l20.396" class="difflineminus">-      miniMonth + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/[6]')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l20.397"></a><span id="l20.397" class="difflineplus">+    let lastDayInFirstRow = lookup(`</span>
<a href="#l20.398"></a><span id="l20.398" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/[7]</span>
<a href="#l20.399"></a><span id="l20.399" class="difflineplus">+    `).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l20.400"></a><span id="l20.400" class="difflineplus">+</span>
<a href="#l20.401"></a><span id="l20.401">     let positionOfFirst = 7 - lastDayInFirstRow;</span>
<a href="#l20.402"></a><span id="l20.402">     let dateColumn = (positionOfFirst + day - 1) % 7;</span>
<a href="#l20.403"></a><span id="l20.403">     let dateRow = Math.floor((positionOfFirst + day - 1) / 7);</span>
<a href="#l20.404"></a><span id="l20.404"> </span>
<a href="#l20.405"></a><span id="l20.405">     // pick day</span>
<a href="#l20.406"></a><span id="l20.406" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l20.407"></a><span id="l20.407" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[' + (dateRow + 1) + &quot;]/[&quot; + dateColumn + &quot;]&quot;));</span>
<a href="#l20.408"></a><span id="l20.408" class="difflineminus">-    controller.sleep(500);</span>
<a href="#l20.409"></a><span id="l20.409" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l20.410"></a><span id="l20.410" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[${dateRow + 1}]/</span>
<a href="#l20.411"></a><span id="l20.411" class="difflineplus">+        [${dateColumn + 1}]</span>
<a href="#l20.412"></a><span id="l20.412" class="difflineplus">+    `));</span>
<a href="#l20.413"></a><span id="l20.413" class="difflineplus">+    sleep();</span>
<a href="#l20.414"></a><span id="l20.414"> }</span>
<a href="#l20.415"></a><span id="l20.415"> </span>
<a href="#l20.416"></a><span id="l20.416"> /**</span>
<a href="#l20.417"></a><span id="l20.417" class="difflineminus">- *  @param controller - main window controller</span>
<a href="#l20.418"></a><span id="l20.418" class="difflineminus">- *  @param view - day, week, multiweek or month</span>
<a href="#l20.419"></a><span id="l20.419" class="difflineminus">- *  @param option - bg for creating event, fg for checking</span>
<a href="#l20.420"></a><span id="l20.420" class="difflineminus">- *  @param row - only used in multiweek and month view, 1-based index of a row</span>
<a href="#l20.421"></a><span id="l20.421" class="difflineminus">- *  @param column - 1-based index of a column</span>
<a href="#l20.422"></a><span id="l20.422" class="difflineminus">- *  @param hour - index of hour box</span>
<a href="#l20.423"></a><span id="l20.423" class="difflineminus">- *  @returns path string</span>
<a href="#l20.424"></a><span id="l20.424" class="difflineplus">+ * Opens the event dialog by clicking on the (optional) box and executing the</span>
<a href="#l20.425"></a><span id="l20.425" class="difflineplus">+ * body. The event dialog must be closed in the body function.</span>
<a href="#l20.426"></a><span id="l20.426" class="difflineplus">+ *</span>
<a href="#l20.427"></a><span id="l20.427" class="difflineplus">+ * @param controller    Main window controller</span>
<a href="#l20.428"></a><span id="l20.428" class="difflineplus">+ * @param clickBox      The box to click on, or null if no box to click on.</span>
<a href="#l20.429"></a><span id="l20.429" class="difflineplus">+ * @param body          The function to execute while the event dialog is open.</span>
<a href="#l20.430"></a><span id="l20.430" class="difflineplus">+ */</span>
<a href="#l20.431"></a><span id="l20.431" class="difflineplus">+function invokeEventDialog(controller, clickBox, body) {</span>
<a href="#l20.432"></a><span id="l20.432" class="difflineplus">+    if (clickBox) {</span>
<a href="#l20.433"></a><span id="l20.433" class="difflineplus">+        controller.waitForElement(clickBox);</span>
<a href="#l20.434"></a><span id="l20.434" class="difflineplus">+        controller.doubleClick(clickBox, 1, 1);</span>
<a href="#l20.435"></a><span id="l20.435" class="difflineplus">+    }</span>
<a href="#l20.436"></a><span id="l20.436" class="difflineplus">+</span>
<a href="#l20.437"></a><span id="l20.437" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l20.438"></a><span id="l20.438" class="difflineplus">+        return mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0;</span>
<a href="#l20.439"></a><span id="l20.439" class="difflineplus">+    }, MID_SLEEP);</span>
<a href="#l20.440"></a><span id="l20.440" class="difflineplus">+</span>
<a href="#l20.441"></a><span id="l20.441" class="difflineplus">+    let eventWindow = mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0];</span>
<a href="#l20.442"></a><span id="l20.442" class="difflineplus">+    let eventController = new mozmill.controller.MozMillController(eventWindow);</span>
<a href="#l20.443"></a><span id="l20.443" class="difflineplus">+    let iframe = eventController.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l20.444"></a><span id="l20.444" class="difflineplus">+</span>
<a href="#l20.445"></a><span id="l20.445" class="difflineplus">+    eventController.waitFor(() =&gt; {</span>
<a href="#l20.446"></a><span id="l20.446" class="difflineplus">+        return iframe.contentWindow.onLoad &amp;&amp;</span>
<a href="#l20.447"></a><span id="l20.447" class="difflineplus">+               iframe.contentWindow.onLoad.hasLoaded == true;</span>
<a href="#l20.448"></a><span id="l20.448" class="difflineplus">+    });</span>
<a href="#l20.449"></a><span id="l20.449" class="difflineplus">+</span>
<a href="#l20.450"></a><span id="l20.450" class="difflineplus">+    // We can't use a full mozmill controller on an iframe, but we need</span>
<a href="#l20.451"></a><span id="l20.451" class="difflineplus">+    // something for helpersForController.</span>
<a href="#l20.452"></a><span id="l20.452" class="difflineplus">+    let mockIframeController = { window: iframe.contentWindow };</span>
<a href="#l20.453"></a><span id="l20.453" class="difflineplus">+</span>
<a href="#l20.454"></a><span id="l20.454" class="difflineplus">+    body(eventController, mockIframeController);</span>
<a href="#l20.455"></a><span id="l20.455" class="difflineplus">+</span>
<a href="#l20.456"></a><span id="l20.456" class="difflineplus">+    // Wait for close</span>
<a href="#l20.457"></a><span id="l20.457" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l20.458"></a><span id="l20.458" class="difflineplus">+}</span>
<a href="#l20.459"></a><span id="l20.459" class="difflineplus">+</span>
<a href="#l20.460"></a><span id="l20.460" class="difflineplus">+/**</span>
<a href="#l20.461"></a><span id="l20.461" class="difflineplus">+ * Gets the path for an event box</span>
<a href="#l20.462"></a><span id="l20.462" class="difflineplus">+ *</span>
<a href="#l20.463"></a><span id="l20.463" class="difflineplus">+ * @param controller    main window controller</span>
<a href="#l20.464"></a><span id="l20.464" class="difflineplus">+ * @param view          day, week, multiweek or month</span>
<a href="#l20.465"></a><span id="l20.465" class="difflineplus">+ * @param option        CANVAS_BOX or ALLDAY for creating event, EVENT_BOX for existing event</span>
<a href="#l20.466"></a><span id="l20.466" class="difflineplus">+ * @param row           only used in multiweek and month view, 1-based index of a row</span>
<a href="#l20.467"></a><span id="l20.467" class="difflineplus">+ * @param column        1-based index of a column</span>
<a href="#l20.468"></a><span id="l20.468" class="difflineplus">+ * @param hour          index of hour box</span>
<a href="#l20.469"></a><span id="l20.469" class="difflineplus">+ * @returns             path string</span>
<a href="#l20.470"></a><span id="l20.470">  */</span>
<a href="#l20.471"></a><span id="l20.471"> function getEventBoxPath(controller, view, option, row, column, hour) {</span>
<a href="#l20.472"></a><span id="l20.472" class="difflineminus">-    let viewDeck = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l20.473"></a><span id="l20.473" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l20.474"></a><span id="l20.474" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)';</span>
<a href="#l20.475"></a><span id="l20.475" class="difflineminus">-    let dayView = viewDeck + '/id(&quot;day-view&quot;)';</span>
<a href="#l20.476"></a><span id="l20.476" class="difflineminus">-    let weekView = viewDeck + '/id(&quot;week-view&quot;)';</span>
<a href="#l20.477"></a><span id="l20.477" class="difflineminus">-    let multiweekView = viewDeck + '/id(&quot;multiweek-view&quot;)';</span>
<a href="#l20.478"></a><span id="l20.478" class="difflineminus">-    let monthView = viewDeck + '/id(&quot;month-view&quot;)';</span>
<a href="#l20.479"></a><span id="l20.479" class="difflineplus">+    let viewDeck = `</span>
<a href="#l20.480"></a><span id="l20.480" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l20.481"></a><span id="l20.481" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l20.482"></a><span id="l20.482" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)</span>
<a href="#l20.483"></a><span id="l20.483" class="difflineplus">+    `;</span>
<a href="#l20.484"></a><span id="l20.484"> </span>
<a href="#l20.485"></a><span id="l20.485" class="difflineminus">-    let path = &quot;&quot;;</span>
<a href="#l20.486"></a><span id="l20.486" class="difflineminus">-    switch (view) {</span>
<a href="#l20.487"></a><span id="l20.487" class="difflineminus">-        case &quot;week&quot;:</span>
<a href="#l20.488"></a><span id="l20.488" class="difflineminus">-            path += weekView;</span>
<a href="#l20.489"></a><span id="l20.489" class="difflineminus">-            break;</span>
<a href="#l20.490"></a><span id="l20.490" class="difflineminus">-        case &quot;multiweek&quot;:</span>
<a href="#l20.491"></a><span id="l20.491" class="difflineminus">-            path += multiweekView;</span>
<a href="#l20.492"></a><span id="l20.492" class="difflineminus">-            break;</span>
<a href="#l20.493"></a><span id="l20.493" class="difflineminus">-        case &quot;month&quot;:</span>
<a href="#l20.494"></a><span id="l20.494" class="difflineminus">-            path += monthView;</span>
<a href="#l20.495"></a><span id="l20.495" class="difflineminus">-            break;</span>
<a href="#l20.496"></a><span id="l20.496" class="difflineminus">-        default: path += dayView;</span>
<a href="#l20.497"></a><span id="l20.497" class="difflineminus">-    }</span>
<a href="#l20.498"></a><span id="l20.498" class="difflineplus">+    let path = `${viewDeck}/id(&quot;${view}-view&quot;)`;</span>
<a href="#l20.499"></a><span id="l20.499" class="difflineplus">+</span>
<a href="#l20.500"></a><span id="l20.500"> </span>
<a href="#l20.501"></a><span id="l20.501">     if ((view == &quot;day&quot; || view == &quot;week&quot;) &amp;&amp; option == ALLDAY) {</span>
<a href="#l20.502"></a><span id="l20.502" class="difflineminus">-        path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})';</span>
<a href="#l20.503"></a><span id="l20.503" class="difflineminus">-        path += &quot;/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l20.504"></a><span id="l20.504" class="difflineminus">-</span>
<a href="#l20.505"></a><span id="l20.505" class="difflineminus">-        return path;</span>
<a href="#l20.506"></a><span id="l20.506" class="difflineplus">+        return path + `</span>
<a href="#l20.507"></a><span id="l20.507" class="difflineplus">+            /anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/</span>
<a href="#l20.508"></a><span id="l20.508" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})/</span>
<a href="#l20.509"></a><span id="l20.509" class="difflineplus">+            [${column - 1}]</span>
<a href="#l20.510"></a><span id="l20.510" class="difflineplus">+        `;</span>
<a href="#l20.511"></a><span id="l20.511">     } else if (view == &quot;day&quot; || view == &quot;week&quot;) {</span>
<a href="#l20.512"></a><span id="l20.512" class="difflineminus">-        path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})';</span>
<a href="#l20.513"></a><span id="l20.513" class="difflineminus">-        path += &quot;/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l20.514"></a><span id="l20.514" class="difflineminus">-        path += '/anon({&quot;anonid&quot;:&quot;boxstack&quot;})';</span>
<a href="#l20.515"></a><span id="l20.515" class="difflineplus">+        path += `</span>
<a href="#l20.516"></a><span id="l20.516" class="difflineplus">+            /anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l20.517"></a><span id="l20.517" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;daybox&quot;})/[${column - 1}]/</span>
<a href="#l20.518"></a><span id="l20.518" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;boxstack&quot;})</span>
<a href="#l20.519"></a><span id="l20.519" class="difflineplus">+        `;</span>
<a href="#l20.520"></a><span id="l20.520"> </span>
<a href="#l20.521"></a><span id="l20.521">         if (option == CANVAS_BOX) {</span>
<a href="#l20.522"></a><span id="l20.522" class="difflineminus">-            path += '/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + hour + &quot;]&quot;;</span>
<a href="#l20.523"></a><span id="l20.523" class="difflineplus">+            path += `/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[${hour}]`;</span>
<a href="#l20.524"></a><span id="l20.524">         } else {</span>
<a href="#l20.525"></a><span id="l20.525">             path += '/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l20.526"></a><span id="l20.526">         }</span>
<a href="#l20.527"></a><span id="l20.527"> </span>
<a href="#l20.528"></a><span id="l20.528">         return path;</span>
<a href="#l20.529"></a><span id="l20.529">     } else {</span>
<a href="#l20.530"></a><span id="l20.530" class="difflineminus">-        path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l20.531"></a><span id="l20.531" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[' + (row - 1) + &quot;]/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l20.532"></a><span id="l20.532" class="difflineplus">+        path += `</span>
<a href="#l20.533"></a><span id="l20.533" class="difflineplus">+            /anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l20.534"></a><span id="l20.534" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[${row - 1}]/</span>
<a href="#l20.535"></a><span id="l20.535" class="difflineplus">+            [${column - 1}]</span>
<a href="#l20.536"></a><span id="l20.536" class="difflineplus">+        `;</span>
<a href="#l20.537"></a><span id="l20.537"> </span>
<a href="#l20.538"></a><span id="l20.538">         if (option == CANVAS_BOX) {</span>
<a href="#l20.539"></a><span id="l20.539">             path += '/anon({&quot;anonid&quot;:&quot;day-items&quot;})';</span>
<a href="#l20.540"></a><span id="l20.540">         }</span>
<a href="#l20.541"></a><span id="l20.541"> </span>
<a href="#l20.542"></a><span id="l20.542">         return path;</span>
<a href="#l20.543"></a><span id="l20.543">     }</span>
<a href="#l20.544"></a><span id="l20.544"> }</span>
<a href="#l20.545"></a><span id="l20.545"> </span>
<a href="#l20.546"></a><span id="l20.546"> /**</span>
<a href="#l20.547"></a><span id="l20.547" class="difflineminus">- * @param controller - Mozmill window controller</span>
<a href="#l20.548"></a><span id="l20.548" class="difflineminus">- * @param n - how many times next button in view is clicked</span>
<a href="#l20.549"></a><span id="l20.549" class="difflineplus">+ * Moves the view n times forward</span>
<a href="#l20.550"></a><span id="l20.550" class="difflineplus">+ *</span>
<a href="#l20.551"></a><span id="l20.551" class="difflineplus">+ * @param controller    Mozmill window controller</span>
<a href="#l20.552"></a><span id="l20.552" class="difflineplus">+ * @param n             how many times next button in view is clicked</span>
<a href="#l20.553"></a><span id="l20.553">  */</span>
<a href="#l20.554"></a><span id="l20.554" class="difflineminus">-function forward(controller, n) {</span>
<a href="#l20.555"></a><span id="l20.555" class="difflineplus">+function viewForward(controller, n) {</span>
<a href="#l20.556"></a><span id="l20.556" class="difflineplus">+    let { eid, sleep } = helpersForController(controller);</span>
<a href="#l20.557"></a><span id="l20.557" class="difflineplus">+</span>
<a href="#l20.558"></a><span id="l20.558">     for (let i = 0; i &lt; n; i++) {</span>
<a href="#l20.559"></a><span id="l20.559" class="difflineminus">-        controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l20.560"></a><span id="l20.560" class="difflineminus">-        controller.sleep(100);</span>
<a href="#l20.561"></a><span id="l20.561" class="difflineplus">+        controller.click(eid(&quot;next-view-button&quot;));</span>
<a href="#l20.562"></a><span id="l20.562" class="difflineplus">+        sleep(SHORT_SLEEP);</span>
<a href="#l20.563"></a><span id="l20.563">     }</span>
<a href="#l20.564"></a><span id="l20.564"> }</span>
<a href="#l20.565"></a><span id="l20.565"> </span>
<a href="#l20.566"></a><span id="l20.566"> /**</span>
<a href="#l20.567"></a><span id="l20.567" class="difflineminus">- * @param controller - Mozmill window controller</span>
<a href="#l20.568"></a><span id="l20.568" class="difflineminus">- * @param n - how many times previous button in view is clicked</span>
<a href="#l20.569"></a><span id="l20.569" class="difflineplus">+ * Moves the view n times back</span>
<a href="#l20.570"></a><span id="l20.570" class="difflineplus">+ *</span>
<a href="#l20.571"></a><span id="l20.571" class="difflineplus">+ * @param controller    Mozmill window controller</span>
<a href="#l20.572"></a><span id="l20.572" class="difflineplus">+ * @param n             how many times previous button in view is clicked</span>
<a href="#l20.573"></a><span id="l20.573">  */</span>
<a href="#l20.574"></a><span id="l20.574" class="difflineminus">-function back(controller, n) {</span>
<a href="#l20.575"></a><span id="l20.575" class="difflineplus">+function viewBack(controller, n) {</span>
<a href="#l20.576"></a><span id="l20.576" class="difflineplus">+    let { eid, sleep } = helpersForController(controller);</span>
<a href="#l20.577"></a><span id="l20.577" class="difflineplus">+</span>
<a href="#l20.578"></a><span id="l20.578">     for (let i = 0; i &lt; n; i++) {</span>
<a href="#l20.579"></a><span id="l20.579" class="difflineminus">-        controller.click(new elementslib.ID(controller.window.document, &quot;previous-view-button&quot;));</span>
<a href="#l20.580"></a><span id="l20.580" class="difflineminus">-        controller.sleep(100);</span>
<a href="#l20.581"></a><span id="l20.581" class="difflineplus">+        controller.click(eid(&quot;previous-view-button&quot;));</span>
<a href="#l20.582"></a><span id="l20.582" class="difflineplus">+        sleep(SHORT_SLEEP);</span>
<a href="#l20.583"></a><span id="l20.583">     }</span>
<a href="#l20.584"></a><span id="l20.584"> }</span>
<a href="#l20.585"></a><span id="l20.585"> </span>
<a href="#l20.586"></a><span id="l20.586"> /**</span>
<a href="#l20.587"></a><span id="l20.587">  * Deletes all calendars with given name</span>
<a href="#l20.588"></a><span id="l20.588" class="difflineminus">- * @param controller - Mozmill window controller</span>
<a href="#l20.589"></a><span id="l20.589" class="difflineminus">- * @param name - calendar name</span>
<a href="#l20.590"></a><span id="l20.590" class="difflineplus">+ *</span>
<a href="#l20.591"></a><span id="l20.591" class="difflineplus">+ * @param controller    Mozmill window controller</span>
<a href="#l20.592"></a><span id="l20.592" class="difflineplus">+ * @param name          calendar name</span>
<a href="#l20.593"></a><span id="l20.593">  */</span>
<a href="#l20.594"></a><span id="l20.594"> function deleteCalendars(controller, name) {</span>
<a href="#l20.595"></a><span id="l20.595" class="difflineminus">-    let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l20.596"></a><span id="l20.596" class="difflineminus">-                      .getNode().ownerDocument.defaultView;</span>
<a href="#l20.597"></a><span id="l20.597" class="difflineplus">+    let { eid } = helpersForController(controller);</span>
<a href="#l20.598"></a><span id="l20.598" class="difflineplus">+</span>
<a href="#l20.599"></a><span id="l20.599" class="difflineplus">+    let defaultView = eid(&quot;messengerWindow&quot;).getNode().ownerDocument.defaultView;</span>
<a href="#l20.600"></a><span id="l20.600">     let manager = defaultView.getCalendarManager();</span>
<a href="#l20.601"></a><span id="l20.601" class="difflineminus">-    let cals = manager.getCalendars({});</span>
<a href="#l20.602"></a><span id="l20.602"> </span>
<a href="#l20.603"></a><span id="l20.603" class="difflineminus">-    for (let i = 0; i &lt; cals.length; i++) {</span>
<a href="#l20.604"></a><span id="l20.604" class="difflineminus">-        if (cals[i].name == name) {</span>
<a href="#l20.605"></a><span id="l20.605" class="difflineminus">-            manager.removeCalendar(cals[i]);</span>
<a href="#l20.606"></a><span id="l20.606" class="difflineplus">+    for (let calendar of manager.getCalendars({})) {</span>
<a href="#l20.607"></a><span id="l20.607" class="difflineplus">+        if (calendar.name == name) {</span>
<a href="#l20.608"></a><span id="l20.608" class="difflineplus">+            manager.removeCalendar(calendar);</span>
<a href="#l20.609"></a><span id="l20.609">         }</span>
<a href="#l20.610"></a><span id="l20.610">     }</span>
<a href="#l20.611"></a><span id="l20.611"> }</span>
<a href="#l20.612"></a><span id="l20.612"> </span>
<a href="#l20.613"></a><span id="l20.613"> /**</span>
<a href="#l20.614"></a><span id="l20.614">  * Creates local calendar with given name and select it in calendars list</span>
<a href="#l20.615"></a><span id="l20.615" class="difflineminus">- * @param controller - Mozmill window controller</span>
<a href="#l20.616"></a><span id="l20.616" class="difflineminus">- * @param name - calendar name</span>
<a href="#l20.617"></a><span id="l20.617" class="difflineplus">+ *</span>
<a href="#l20.618"></a><span id="l20.618" class="difflineplus">+ * @param controller    Mozmill window controller</span>
<a href="#l20.619"></a><span id="l20.619" class="difflineplus">+ * @param name          calendar name</span>
<a href="#l20.620"></a><span id="l20.620">  */</span>
<a href="#l20.621"></a><span id="l20.621"> function createCalendar(controller, name) {</span>
<a href="#l20.622"></a><span id="l20.622" class="difflineminus">-    let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l20.623"></a><span id="l20.623" class="difflineminus">-                      .getNode().ownerDocument.defaultView;</span>
<a href="#l20.624"></a><span id="l20.624" class="difflineplus">+    let { lookup, eid } = helpersForController(controller);</span>
<a href="#l20.625"></a><span id="l20.625" class="difflineplus">+</span>
<a href="#l20.626"></a><span id="l20.626" class="difflineplus">+    let defaultView = eid(&quot;messengerWindow&quot;).getNode().ownerDocument.defaultView;</span>
<a href="#l20.627"></a><span id="l20.627">     let manager = defaultView.getCalendarManager();</span>
<a href="#l20.628"></a><span id="l20.628"> </span>
<a href="#l20.629"></a><span id="l20.629">     let url = defaultView.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l20.630"></a><span id="l20.630">     let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l20.631"></a><span id="l20.631">     calendar.name = name;</span>
<a href="#l20.632"></a><span id="l20.632">     manager.registerCalendar(calendar);</span>
<a href="#l20.633"></a><span id="l20.633"> </span>
<a href="#l20.634"></a><span id="l20.634" class="difflineminus">-    let id = calendar.id;</span>
<a href="#l20.635"></a><span id="l20.635" class="difflineminus">-    let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l20.636"></a><span id="l20.636" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l20.637"></a><span id="l20.637" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/' +</span>
<a href="#l20.638"></a><span id="l20.638" class="difflineminus">-      'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l20.639"></a><span id="l20.639" class="difflineminus">-      .getNode();</span>
<a href="#l20.640"></a><span id="l20.640" class="difflineminus">-    for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l20.641"></a><span id="l20.641" class="difflineminus">-        if (calendarTree.mCalendarList[i].id == id) {</span>
<a href="#l20.642"></a><span id="l20.642" class="difflineplus">+    let calendarTree = lookup(`</span>
<a href="#l20.643"></a><span id="l20.643" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l20.644"></a><span id="l20.644" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l20.645"></a><span id="l20.645" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/</span>
<a href="#l20.646"></a><span id="l20.646" class="difflineplus">+        id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)</span>
<a href="#l20.647"></a><span id="l20.647" class="difflineplus">+    `).getNode();</span>
<a href="#l20.648"></a><span id="l20.648" class="difflineplus">+</span>
<a href="#l20.649"></a><span id="l20.649" class="difflineplus">+    for (let i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l20.650"></a><span id="l20.650" class="difflineplus">+        if (calendarTree.mCalendarList[i].id == calendar.id) {</span>
<a href="#l20.651"></a><span id="l20.651">             calendarTree.tree.view.selection.select(i);</span>
<a href="#l20.652"></a><span id="l20.652">         }</span>
<a href="#l20.653"></a><span id="l20.653">     }</span>
<a href="#l20.654"></a><span id="l20.654"> }</span>
<a href="#l20.655"></a><span id="l20.655"> </span>
<a href="#l20.656"></a><span id="l20.656"> /**</span>
<a href="#l20.657"></a><span id="l20.657" class="difflineplus">+ * Handles the &quot;Create New Calendar&quot; Wizard</span>
<a href="#l20.658"></a><span id="l20.658" class="difflineplus">+ *</span>
<a href="#l20.659"></a><span id="l20.659" class="difflineplus">+ * @param wizard            wizard dialog controller</span>
<a href="#l20.660"></a><span id="l20.660" class="difflineplus">+ * @param name              calendar name</span>
<a href="#l20.661"></a><span id="l20.661" class="difflineplus">+ * @param data              (optional) dataset object</span>
<a href="#l20.662"></a><span id="l20.662" class="difflineplus">+ *                              showReminders - false to disable reminders</span>
<a href="#l20.663"></a><span id="l20.663" class="difflineplus">+ *                              eMail - id of eMail account</span>
<a href="#l20.664"></a><span id="l20.664" class="difflineplus">+ *                              network.format - ics/caldav/wcap</span>
<a href="#l20.665"></a><span id="l20.665" class="difflineplus">+ *                              network.location - URI (undefined for local ICS)</span>
<a href="#l20.666"></a><span id="l20.666" class="difflineplus">+ *                              network.offline - false to disable cache</span>
<a href="#l20.667"></a><span id="l20.667" class="difflineplus">+ */</span>
<a href="#l20.668"></a><span id="l20.668" class="difflineplus">+function handleNewCalendarWizard(wizard, name, data = undefined) {</span>
<a href="#l20.669"></a><span id="l20.669" class="difflineplus">+    let { lookup: wizardlookup, eid: wizardId } = helpersForController(wizard);</span>
<a href="#l20.670"></a><span id="l20.670" class="difflineplus">+    let dlgButton = (btn) =&gt; wizard.window.document.documentElement.getButton(btn);</span>
<a href="#l20.671"></a><span id="l20.671" class="difflineplus">+    if (data == undefined) {</span>
<a href="#l20.672"></a><span id="l20.672" class="difflineplus">+        data = {};</span>
<a href="#l20.673"></a><span id="l20.673" class="difflineplus">+    }</span>
<a href="#l20.674"></a><span id="l20.674" class="difflineplus">+</span>
<a href="#l20.675"></a><span id="l20.675" class="difflineplus">+    // choose network calendar if any network data is set.</span>
<a href="#l20.676"></a><span id="l20.676" class="difflineplus">+    if (data.network) {</span>
<a href="#l20.677"></a><span id="l20.677" class="difflineplus">+        let remoteOption = wizardlookup(`</span>
<a href="#l20.678"></a><span id="l20.678" class="difflineplus">+            /id(&quot;calendar-wizard&quot;)/{&quot;pageid&quot;:&quot;initialPage&quot;}/</span>
<a href="#l20.679"></a><span id="l20.679" class="difflineplus">+            id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}</span>
<a href="#l20.680"></a><span id="l20.680" class="difflineplus">+        `);</span>
<a href="#l20.681"></a><span id="l20.681" class="difflineplus">+        wizard.waitForElement(remoteOption);</span>
<a href="#l20.682"></a><span id="l20.682" class="difflineplus">+        wizard.radio(remoteOption);</span>
<a href="#l20.683"></a><span id="l20.683" class="difflineplus">+        dlgButton(&quot;next&quot;).doCommand();</span>
<a href="#l20.684"></a><span id="l20.684" class="difflineplus">+</span>
<a href="#l20.685"></a><span id="l20.685" class="difflineplus">+        // choose format</span>
<a href="#l20.686"></a><span id="l20.686" class="difflineplus">+        if (data.network.format == undefined) {</span>
<a href="#l20.687"></a><span id="l20.687" class="difflineplus">+            data.network.format = &quot;ics&quot;;</span>
<a href="#l20.688"></a><span id="l20.688" class="difflineplus">+        }</span>
<a href="#l20.689"></a><span id="l20.689" class="difflineplus">+        let formatOption = wizardlookup(`</span>
<a href="#l20.690"></a><span id="l20.690" class="difflineplus">+            /id(&quot;calendar-wizard&quot;)/{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/</span>
<a href="#l20.691"></a><span id="l20.691" class="difflineplus">+            id(&quot;calendar-format&quot;)/{&quot;value&quot;:&quot;${data.network.format}&quot;}</span>
<a href="#l20.692"></a><span id="l20.692" class="difflineplus">+        `);</span>
<a href="#l20.693"></a><span id="l20.693" class="difflineplus">+        wizard.waitForElement(formatOption);</span>
<a href="#l20.694"></a><span id="l20.694" class="difflineplus">+        wizard.radio(formatOption);</span>
<a href="#l20.695"></a><span id="l20.695" class="difflineplus">+</span>
<a href="#l20.696"></a><span id="l20.696" class="difflineplus">+        // enter location</span>
<a href="#l20.697"></a><span id="l20.697" class="difflineplus">+        if (data.network.location == undefined) {</span>
<a href="#l20.698"></a><span id="l20.698" class="difflineplus">+            let calendarFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l20.699"></a><span id="l20.699" class="difflineplus">+            calendarFile.append(name + &quot;.ics&quot;);</span>
<a href="#l20.700"></a><span id="l20.700" class="difflineplus">+            let fileURI = Services.io.newFileURI(calendarFile);</span>
<a href="#l20.701"></a><span id="l20.701" class="difflineplus">+            data.network.location = fileURI.prePath + fileURI.path;</span>
<a href="#l20.702"></a><span id="l20.702" class="difflineplus">+        }</span>
<a href="#l20.703"></a><span id="l20.703" class="difflineplus">+        wizard.type(wizardlookup(`</span>
<a href="#l20.704"></a><span id="l20.704" class="difflineplus">+            /id(&quot;calendar-wizard&quot;)/{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/</span>
<a href="#l20.705"></a><span id="l20.705" class="difflineplus">+            {&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/</span>
<a href="#l20.706"></a><span id="l20.706" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l20.707"></a><span id="l20.707" class="difflineplus">+        `), data.network.location);</span>
<a href="#l20.708"></a><span id="l20.708" class="difflineplus">+</span>
<a href="#l20.709"></a><span id="l20.709" class="difflineplus">+        // choose offline support</span>
<a href="#l20.710"></a><span id="l20.710" class="difflineplus">+        if (data.network.offline == undefined) {</span>
<a href="#l20.711"></a><span id="l20.711" class="difflineplus">+            data.network.offline = true;</span>
<a href="#l20.712"></a><span id="l20.712" class="difflineplus">+        }</span>
<a href="#l20.713"></a><span id="l20.713" class="difflineplus">+        wizard.check(wizardId(&quot;cache&quot;), data.network.offline);</span>
<a href="#l20.714"></a><span id="l20.714" class="difflineplus">+        wizard.waitFor(() =&gt; dlgButton(&quot;next&quot;).disabled == false);</span>
<a href="#l20.715"></a><span id="l20.715" class="difflineplus">+        dlgButton(&quot;next&quot;).doCommand();</span>
<a href="#l20.716"></a><span id="l20.716" class="difflineplus">+    } else {</span>
<a href="#l20.717"></a><span id="l20.717" class="difflineplus">+        // local calendar is default</span>
<a href="#l20.718"></a><span id="l20.718" class="difflineplus">+        dlgButton(&quot;next&quot;).doCommand();</span>
<a href="#l20.719"></a><span id="l20.719" class="difflineplus">+    }</span>
<a href="#l20.720"></a><span id="l20.720" class="difflineplus">+    // set calendar Name</span>
<a href="#l20.721"></a><span id="l20.721" class="difflineplus">+    wizard.waitForElement(wizardId(&quot;calendar-name&quot;));</span>
<a href="#l20.722"></a><span id="l20.722" class="difflineplus">+    // not on all platforms setting the value activates the next button</span>
<a href="#l20.723"></a><span id="l20.723" class="difflineplus">+    // so we need to type in case the field is empty</span>
<a href="#l20.724"></a><span id="l20.724" class="difflineplus">+    if (wizardId(&quot;calendar-name&quot;).getNode().value == &quot;&quot;) {</span>
<a href="#l20.725"></a><span id="l20.725" class="difflineplus">+        wizard.type(wizardId(&quot;calendar-name&quot;), name);</span>
<a href="#l20.726"></a><span id="l20.726" class="difflineplus">+    } // else the name is already filled in from URI</span>
<a href="#l20.727"></a><span id="l20.727" class="difflineplus">+</span>
<a href="#l20.728"></a><span id="l20.728" class="difflineplus">+    // set reminder Option</span>
<a href="#l20.729"></a><span id="l20.729" class="difflineplus">+    if (data.showReminders == undefined) {</span>
<a href="#l20.730"></a><span id="l20.730" class="difflineplus">+        data.showReminders = true;</span>
<a href="#l20.731"></a><span id="l20.731" class="difflineplus">+    }</span>
<a href="#l20.732"></a><span id="l20.732" class="difflineplus">+    wizard.check(wizardId(&quot;fire-alarms&quot;), data.showReminders);</span>
<a href="#l20.733"></a><span id="l20.733" class="difflineplus">+</span>
<a href="#l20.734"></a><span id="l20.734" class="difflineplus">+    // set eMail Account</span>
<a href="#l20.735"></a><span id="l20.735" class="difflineplus">+    if (data.eMail == undefined) {</span>
<a href="#l20.736"></a><span id="l20.736" class="difflineplus">+        data.eMail = &quot;none&quot;;</span>
<a href="#l20.737"></a><span id="l20.737" class="difflineplus">+    }</span>
<a href="#l20.738"></a><span id="l20.738" class="difflineplus">+    menulistSelect(wizardId(&quot;email-identity-menulist&quot;), data.eMail, wizard);</span>
<a href="#l20.739"></a><span id="l20.739" class="difflineplus">+    wizard.waitFor(() =&gt; dlgButton(&quot;next&quot;).disabled == false);</span>
<a href="#l20.740"></a><span id="l20.740" class="difflineplus">+    dlgButton(&quot;next&quot;).doCommand();</span>
<a href="#l20.741"></a><span id="l20.741" class="difflineplus">+</span>
<a href="#l20.742"></a><span id="l20.742" class="difflineplus">+    // finish</span>
<a href="#l20.743"></a><span id="l20.743" class="difflineplus">+    dlgButton(&quot;finish&quot;).doCommand();</span>
<a href="#l20.744"></a><span id="l20.744" class="difflineplus">+}</span>
<a href="#l20.745"></a><span id="l20.745" class="difflineplus">+</span>
<a href="#l20.746"></a><span id="l20.746" class="difflineplus">+/**</span>
<a href="#l20.747"></a><span id="l20.747">  * Retrieves array of all calendar-event-box elements in node</span>
<a href="#l20.748"></a><span id="l20.748" class="difflineminus">- * @param node - node to be searched</span>
<a href="#l20.749"></a><span id="l20.749" class="difflineminus">- * @param eventNodes - array where to put resultíng nodes</span>
<a href="#l20.750"></a><span id="l20.750" class="difflineplus">+ *</span>
<a href="#l20.751"></a><span id="l20.751" class="difflineplus">+ * @param node          node to be searched</span>
<a href="#l20.752"></a><span id="l20.752" class="difflineplus">+ * @param eventNodes    array where to put resultíng nodes</span>
<a href="#l20.753"></a><span id="l20.753">  */</span>
<a href="#l20.754"></a><span id="l20.754"> function findEventsInNode(node, eventNodes) {</span>
<a href="#l20.755"></a><span id="l20.755">     if (node.tagName == &quot;calendar-event-box&quot;) {</span>
<a href="#l20.756"></a><span id="l20.756">         eventNodes.push(node);</span>
<a href="#l20.757"></a><span id="l20.757" class="difflineminus">-        return;</span>
<a href="#l20.758"></a><span id="l20.758">     } else if (node.children.length &gt; 0) {</span>
<a href="#l20.759"></a><span id="l20.759" class="difflineminus">-        for (let i = 0; i &lt; node.children.length; i++) {</span>
<a href="#l20.760"></a><span id="l20.760" class="difflineminus">-            findEventsInNode(node.children[i], eventNodes);</span>
<a href="#l20.761"></a><span id="l20.761" class="difflineplus">+        for (let child of node.children) {</span>
<a href="#l20.762"></a><span id="l20.762" class="difflineplus">+            findEventsInNode(child, eventNodes);</span>
<a href="#l20.763"></a><span id="l20.763">         }</span>
<a href="#l20.764"></a><span id="l20.764">     }</span>
<a href="#l20.765"></a><span id="l20.765"> }</span>
<a href="#l20.766"></a><span id="l20.766"> </span>
<a href="#l20.767"></a><span id="l20.767"> /**</span>
<a href="#l20.768"></a><span id="l20.768" class="difflineminus">- *  Helper function to enter event/task dialog data</span>
<a href="#l20.769"></a><span id="l20.769" class="difflineminus">- *  @param controller - event/task controller</span>
<a href="#l20.770"></a><span id="l20.770" class="difflineminus">- *  @param data - dataset object</span>
<a href="#l20.771"></a><span id="l20.771" class="difflineminus">- *                  title - event/task title</span>
<a href="#l20.772"></a><span id="l20.772" class="difflineminus">- *                  location - event/task location</span>
<a href="#l20.773"></a><span id="l20.773" class="difflineminus">- *                  description - event/task description</span>
<a href="#l20.774"></a><span id="l20.774" class="difflineminus">- *                  category - category label</span>
<a href="#l20.775"></a><span id="l20.775" class="difflineminus">- *                  allday - boolean value</span>
<a href="#l20.776"></a><span id="l20.776" class="difflineminus">- *                  startdate - Date object</span>
<a href="#l20.777"></a><span id="l20.777" class="difflineminus">- *                  starttime - Date object</span>
<a href="#l20.778"></a><span id="l20.778" class="difflineminus">- *                  enddate - Date object</span>
<a href="#l20.779"></a><span id="l20.779" class="difflineminus">- *                  endtime - Date object</span>
<a href="#l20.780"></a><span id="l20.780" class="difflineminus">- *                  timezone - false for local, true for set timezone</span>
<a href="#l20.781"></a><span id="l20.781" class="difflineminus">- *                  repeat - reccurrence value, one of none/daily/weekly/every.weekday/bi.weekly/</span>
<a href="#l20.782"></a><span id="l20.782" class="difflineminus">- *                           monthly/yearly/custom</span>
<a href="#l20.783"></a><span id="l20.783" class="difflineminus">- *                  reminder - reminder option index</span>
<a href="#l20.784"></a><span id="l20.784" class="difflineminus">- *                  priority - none/low/normal/high</span>
<a href="#l20.785"></a><span id="l20.785" class="difflineminus">- *                  privacy - public/confidential/private</span>
<a href="#l20.786"></a><span id="l20.786" class="difflineminus">- *                  status - none/tentative/confirmed/canceled for events</span>
<a href="#l20.787"></a><span id="l20.787" class="difflineminus">- *                           none/needs-action/in-process/completed/cancelled for tasks</span>
<a href="#l20.788"></a><span id="l20.788" class="difflineminus">- *                  completed - Date object for tasks</span>
<a href="#l20.789"></a><span id="l20.789" class="difflineminus">- *                  percent - percent complete for tasks</span>
<a href="#l20.790"></a><span id="l20.790" class="difflineminus">- *                  freebusy - free/busy</span>
<a href="#l20.791"></a><span id="l20.791" class="difflineminus">- *                  attachment.add - url to add</span>
<a href="#l20.792"></a><span id="l20.792" class="difflineminus">- *                  attachment.remove - label of url to remove (without http://)</span>
<a href="#l20.793"></a><span id="l20.793" class="difflineplus">+ * Helper function to enter event/task dialog data</span>
<a href="#l20.794"></a><span id="l20.794" class="difflineplus">+ *</span>
<a href="#l20.795"></a><span id="l20.795" class="difflineplus">+ * @param dialog        event/task dialog controller</span>
<a href="#l20.796"></a><span id="l20.796" class="difflineplus">+ * @param iframe        event/task dialog iframe controller</span>
<a href="#l20.797"></a><span id="l20.797" class="difflineplus">+ * @param data          dataset object</span>
<a href="#l20.798"></a><span id="l20.798" class="difflineplus">+ *                          title - event/task title</span>
<a href="#l20.799"></a><span id="l20.799" class="difflineplus">+ *                          location - event/task location</span>
<a href="#l20.800"></a><span id="l20.800" class="difflineplus">+ *                          description - event/task description</span>
<a href="#l20.801"></a><span id="l20.801" class="difflineplus">+ *                          category - category label</span>
<a href="#l20.802"></a><span id="l20.802" class="difflineplus">+ *                          calendar - calendar the item should be in</span>
<a href="#l20.803"></a><span id="l20.803" class="difflineplus">+ *                          allday - boolean value</span>
<a href="#l20.804"></a><span id="l20.804" class="difflineplus">+ *                          startdate - Date object</span>
<a href="#l20.805"></a><span id="l20.805" class="difflineplus">+ *                          starttime - Date object</span>
<a href="#l20.806"></a><span id="l20.806" class="difflineplus">+ *                          enddate - Date object</span>
<a href="#l20.807"></a><span id="l20.807" class="difflineplus">+ *                          endtime - Date object</span>
<a href="#l20.808"></a><span id="l20.808" class="difflineplus">+ *                          timezone - false for local, true for set timezone</span>
<a href="#l20.809"></a><span id="l20.809" class="difflineplus">+ *                          repeat - reccurrence value, one of none/daily/weekly/</span>
<a href="#l20.810"></a><span id="l20.810" class="difflineplus">+ *                                   every.weekday/bi.weekly/</span>
<a href="#l20.811"></a><span id="l20.811" class="difflineplus">+ *                                   monthly/yearly</span>
<a href="#l20.812"></a><span id="l20.812" class="difflineplus">+ *                                   (custom is not supported)</span>
<a href="#l20.813"></a><span id="l20.813" class="difflineplus">+ *                          reminder - reminder option index (custom not supp.)</span>
<a href="#l20.814"></a><span id="l20.814" class="difflineplus">+ *                          priority - none/low/normal/high</span>
<a href="#l20.815"></a><span id="l20.815" class="difflineplus">+ *                          privacy - public/confidential/private</span>
<a href="#l20.816"></a><span id="l20.816" class="difflineplus">+ *                          status - none/tentative/confirmed/canceled for events</span>
<a href="#l20.817"></a><span id="l20.817" class="difflineplus">+ *                                   none/needs-action/in-process/completed/cancelled for tasks</span>
<a href="#l20.818"></a><span id="l20.818" class="difflineplus">+ *                          completed - Date object for tasks</span>
<a href="#l20.819"></a><span id="l20.819" class="difflineplus">+ *                          percent - percent complete for tasks</span>
<a href="#l20.820"></a><span id="l20.820" class="difflineplus">+ *                          freebusy - free/busy</span>
<a href="#l20.821"></a><span id="l20.821" class="difflineplus">+ *                          attachment.add - url to add</span>
<a href="#l20.822"></a><span id="l20.822" class="difflineplus">+ *                          attachment.remove - label of url to remove (without http://)</span>
<a href="#l20.823"></a><span id="l20.823">  */</span>
<a href="#l20.824"></a><span id="l20.824" class="difflineminus">-function setData(controller, data) {</span>
<a href="#l20.825"></a><span id="l20.825" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l20.826"></a><span id="l20.826" class="difflineminus">-    let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l20.827"></a><span id="l20.827" class="difflineminus">-    let dialog;</span>
<a href="#l20.828"></a><span id="l20.828" class="difflineplus">+function setData(dialog, iframe, data) {</span>
<a href="#l20.829"></a><span id="l20.829" class="difflineplus">+    let { eid, sleep } = helpersForController(dialog);</span>
<a href="#l20.830"></a><span id="l20.830" class="difflineplus">+    let { lookup: iframeLookup, eid: iframeId } = helpersForController(iframe);</span>
<a href="#l20.831"></a><span id="l20.831" class="difflineplus">+</span>
<a href="#l20.832"></a><span id="l20.832" class="difflineplus">+    let eventIframe = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l20.833"></a><span id="l20.833" class="difflineplus">+    let taskIframe = '/id(&quot;calendar-task-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l20.834"></a><span id="l20.834" class="difflineplus">+    let innerFrame;</span>
<a href="#l20.835"></a><span id="l20.835">     let isEvent = true;</span>
<a href="#l20.836"></a><span id="l20.836"> </span>
<a href="#l20.837"></a><span id="l20.837">     // see if it's an event dialog</span>
<a href="#l20.838"></a><span id="l20.838">     try {</span>
<a href="#l20.839"></a><span id="l20.839" class="difflineminus">-        (new elementslib.Lookup(controller.window.document, eventDialog)).getNode();</span>
<a href="#l20.840"></a><span id="l20.840" class="difflineminus">-        dialog = eventDialog;</span>
<a href="#l20.841"></a><span id="l20.841" class="difflineplus">+        iframeLookup(eventIframe).getNode();</span>
<a href="#l20.842"></a><span id="l20.842" class="difflineplus">+        innerFrame = eventIframe;</span>
<a href="#l20.843"></a><span id="l20.843">     } catch (error) {</span>
<a href="#l20.844"></a><span id="l20.844" class="difflineminus">-        dialog = taskDialog;</span>
<a href="#l20.845"></a><span id="l20.845" class="difflineplus">+        innerFrame = taskIframe;</span>
<a href="#l20.846"></a><span id="l20.846">         isEvent = false;</span>
<a href="#l20.847"></a><span id="l20.847">     }</span>
<a href="#l20.848"></a><span id="l20.848"> </span>
<a href="#l20.849"></a><span id="l20.849" class="difflineminus">-    let dateInput = 'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l20.850"></a><span id="l20.850" class="difflineminus">-      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l20.851"></a><span id="l20.851" class="difflineminus">-    let timeInput = 'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l20.852"></a><span id="l20.852" class="difflineminus">-      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l20.853"></a><span id="l20.853" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l20.854"></a><span id="l20.854" class="difflineminus">-    let startDateInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.855"></a><span id="l20.855" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l20.856"></a><span id="l20.856" class="difflineminus">-      (isEvent ? 'id(&quot;event-starttime&quot;)/' : 'id(&quot;todo-entrydate&quot;)/') +</span>
<a href="#l20.857"></a><span id="l20.857" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' + dateInput);</span>
<a href="#l20.858"></a><span id="l20.858" class="difflineminus">-    let endDateInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.859"></a><span id="l20.859" class="difflineminus">-      'id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/' +</span>
<a href="#l20.860"></a><span id="l20.860" class="difflineminus">-      (isEvent ? 'id(&quot;event-endtime&quot;)/' : 'id(&quot;todo-duedate&quot;)/') +</span>
<a href="#l20.861"></a><span id="l20.861" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' + dateInput);</span>
<a href="#l20.862"></a><span id="l20.862" class="difflineminus">-    let startTimeInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.863"></a><span id="l20.863" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l20.864"></a><span id="l20.864" class="difflineminus">-      (isEvent ? 'id(&quot;event-starttime&quot;)/' : 'id(&quot;todo-entrydate&quot;)/') +</span>
<a href="#l20.865"></a><span id="l20.865" class="difflineminus">-      timeInput);</span>
<a href="#l20.866"></a><span id="l20.866" class="difflineminus">-    let endTimeInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.867"></a><span id="l20.867" class="difflineminus">-      'id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/' +</span>
<a href="#l20.868"></a><span id="l20.868" class="difflineminus">-      (isEvent ? 'id(&quot;event-endtime&quot;)/' : 'id(&quot;todo-duedate&quot;)/') +</span>
<a href="#l20.869"></a><span id="l20.869" class="difflineminus">-      timeInput);</span>
<a href="#l20.870"></a><span id="l20.870" class="difflineminus">-    let completedDateInput = new elementslib.Lookup(controller.window.document,</span>
<a href="#l20.871"></a><span id="l20.871" class="difflineminus">-      dialog + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l20.872"></a><span id="l20.872" class="difflineminus">-      'id(&quot;completed-date-picker&quot;)/' + dateInput);</span>
<a href="#l20.873"></a><span id="l20.873" class="difflineminus">-    let percentCompleteInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.874"></a><span id="l20.874" class="difflineminus">-      'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l20.875"></a><span id="l20.875" class="difflineminus">-      'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l20.876"></a><span id="l20.876" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l20.877"></a><span id="l20.877" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l20.878"></a><span id="l20.878" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l20.879"></a><span id="l20.879" class="difflineminus">-    let mac = utils.appInfo.os.toLowerCase().includes(&quot;darwin&quot;);</span>
<a href="#l20.880"></a><span id="l20.880" class="difflineplus">+    let dateInput = `</span>
<a href="#l20.881"></a><span id="l20.881" class="difflineplus">+        anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l20.882"></a><span id="l20.882" class="difflineplus">+        anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l20.883"></a><span id="l20.883" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l20.884"></a><span id="l20.884" class="difflineplus">+    `;</span>
<a href="#l20.885"></a><span id="l20.885" class="difflineplus">+    let timeInput = `</span>
<a href="#l20.886"></a><span id="l20.886" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l20.887"></a><span id="l20.887" class="difflineplus">+        anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l20.888"></a><span id="l20.888" class="difflineplus">+        anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l20.889"></a><span id="l20.889" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l20.890"></a><span id="l20.890" class="difflineplus">+    `;</span>
<a href="#l20.891"></a><span id="l20.891" class="difflineplus">+    let startId = isEvent ? &quot;event-starttime&quot; : &quot;todo-entrydate&quot;;</span>
<a href="#l20.892"></a><span id="l20.892" class="difflineplus">+    let startDateInput = iframeLookup(`</span>
<a href="#l20.893"></a><span id="l20.893" class="difflineplus">+        ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l20.894"></a><span id="l20.894" class="difflineplus">+        id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/</span>
<a href="#l20.895"></a><span id="l20.895" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/${dateInput}</span>
<a href="#l20.896"></a><span id="l20.896" class="difflineplus">+    `);</span>
<a href="#l20.897"></a><span id="l20.897" class="difflineplus">+    let endId = isEvent ? &quot;event-endtime&quot; : &quot;todo-duedate&quot;;</span>
<a href="#l20.898"></a><span id="l20.898" class="difflineplus">+    let endDateInput = iframeLookup(`</span>
<a href="#l20.899"></a><span id="l20.899" class="difflineplus">+        ${innerFrame}id(&quot;event-grid-enddate-row&quot;)/[1]/</span>
<a href="#l20.900"></a><span id="l20.900" class="difflineplus">+        id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;${endId}&quot;)/</span>
<a href="#l20.901"></a><span id="l20.901" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/${dateInput}</span>
<a href="#l20.902"></a><span id="l20.902" class="difflineplus">+    `);</span>
<a href="#l20.903"></a><span id="l20.903" class="difflineplus">+    let startTimeInput = iframeLookup(`</span>
<a href="#l20.904"></a><span id="l20.904" class="difflineplus">+        ${innerFrame}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l20.905"></a><span id="l20.905" class="difflineplus">+        id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;${startId}&quot;)/${timeInput}</span>
<a href="#l20.906"></a><span id="l20.906" class="difflineplus">+    `);</span>
<a href="#l20.907"></a><span id="l20.907" class="difflineplus">+    let endTimeInput = iframeLookup(`</span>
<a href="#l20.908"></a><span id="l20.908" class="difflineplus">+        ${innerFrame}/id(&quot;event-grid-enddate-row&quot;)/[1]/</span>
<a href="#l20.909"></a><span id="l20.909" class="difflineplus">+        id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;${endId}&quot;)/${timeInput}</span>
<a href="#l20.910"></a><span id="l20.910" class="difflineplus">+    `);</span>
<a href="#l20.911"></a><span id="l20.911" class="difflineplus">+    let completedDateInput = iframeLookup(`</span>
<a href="#l20.912"></a><span id="l20.912" class="difflineplus">+        ${innerFrame}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l20.913"></a><span id="l20.913" class="difflineplus">+        id(&quot;event-grid-todo-status-picker-box&quot;)/id(&quot;completed-date-picker&quot;)/${dateInput}</span>
<a href="#l20.914"></a><span id="l20.914" class="difflineplus">+    `);</span>
<a href="#l20.915"></a><span id="l20.915" class="difflineplus">+    let percentCompleteInput = iframeLookup(`</span>
<a href="#l20.916"></a><span id="l20.916" class="difflineplus">+        ${innerFrame}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l20.917"></a><span id="l20.917" class="difflineplus">+        id(&quot;event-grid-todo-status-picker-box&quot;)/id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l20.918"></a><span id="l20.918" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l20.919"></a><span id="l20.919" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l20.920"></a><span id="l20.920" class="difflineplus">+    `);</span>
<a href="#l20.921"></a><span id="l20.921" class="difflineplus">+    let dateService = Cc[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l20.922"></a><span id="l20.922" class="difflineplus">+                        .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l20.923"></a><span id="l20.923">     // wait for input elements' values to be populated</span>
<a href="#l20.924"></a><span id="l20.924" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l20.925"></a><span id="l20.925" class="difflineplus">+    sleep();</span>
<a href="#l20.926"></a><span id="l20.926"> </span>
<a href="#l20.927"></a><span id="l20.927">     // title</span>
<a href="#l20.928"></a><span id="l20.928">     if (data.title != undefined) {</span>
<a href="#l20.929"></a><span id="l20.929" class="difflineminus">-        if (mac) {</span>
<a href="#l20.930"></a><span id="l20.930" class="difflineminus">-            let titleField = new elementslib.ID(controller.window.document, &quot;item-title&quot;);</span>
<a href="#l20.931"></a><span id="l20.931" class="difflineminus">-            titleField.getNode().value = data.title;</span>
<a href="#l20.932"></a><span id="l20.932" class="difflineminus">-        } else {</span>
<a href="#l20.933"></a><span id="l20.933" class="difflineminus">-            controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.934"></a><span id="l20.934" class="difflineminus">-              'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l20.935"></a><span id="l20.935" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l20.936"></a><span id="l20.936" class="difflineminus">-              &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.937"></a><span id="l20.937" class="difflineminus">-            controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.938"></a><span id="l20.938" class="difflineminus">-              'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l20.939"></a><span id="l20.939" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l20.940"></a><span id="l20.940" class="difflineminus">-              data.title);</span>
<a href="#l20.941"></a><span id="l20.941" class="difflineminus">-        }</span>
<a href="#l20.942"></a><span id="l20.942" class="difflineplus">+        // we need to set directly here in case there is already a title.</span>
<a href="#l20.943"></a><span id="l20.943" class="difflineplus">+        // accelKey+a won't work in all OS</span>
<a href="#l20.944"></a><span id="l20.944" class="difflineplus">+        iframeId(&quot;item-title&quot;).getNode().value = data.title;</span>
<a href="#l20.945"></a><span id="l20.945">     }</span>
<a href="#l20.946"></a><span id="l20.946"> </span>
<a href="#l20.947"></a><span id="l20.947">     // location</span>
<a href="#l20.948"></a><span id="l20.948">     if (data.location != undefined) {</span>
<a href="#l20.949"></a><span id="l20.949" class="difflineminus">-        if (mac) {</span>
<a href="#l20.950"></a><span id="l20.950" class="difflineminus">-            let locationField = new elementslib.ID(controller.window.document, &quot;item-location&quot;);</span>
<a href="#l20.951"></a><span id="l20.951" class="difflineminus">-            locationField.getNode().value = data.location;</span>
<a href="#l20.952"></a><span id="l20.952" class="difflineminus">-        } else {</span>
<a href="#l20.953"></a><span id="l20.953" class="difflineminus">-            controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.954"></a><span id="l20.954" class="difflineminus">-              'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l20.955"></a><span id="l20.955" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l20.956"></a><span id="l20.956" class="difflineminus">-              &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.957"></a><span id="l20.957" class="difflineminus">-            controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.958"></a><span id="l20.958" class="difflineminus">-              'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l20.959"></a><span id="l20.959" class="difflineminus">-              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l20.960"></a><span id="l20.960" class="difflineminus">-              data.location);</span>
<a href="#l20.961"></a><span id="l20.961" class="difflineminus">-        }</span>
<a href="#l20.962"></a><span id="l20.962" class="difflineplus">+        // see comment above</span>
<a href="#l20.963"></a><span id="l20.963" class="difflineplus">+        iframeId(&quot;item-location&quot;).getNode().value = data.location;</span>
<a href="#l20.964"></a><span id="l20.964">     }</span>
<a href="#l20.965"></a><span id="l20.965"> </span>
<a href="#l20.966"></a><span id="l20.966">     // category</span>
<a href="#l20.967"></a><span id="l20.967" class="difflineplus">+    // TODO: needs adjustment for the menulist-panel now used for categories.</span>
<a href="#l20.968"></a><span id="l20.968" class="difflineplus">+    // will be fixed with Bug 984044</span>
<a href="#l20.969"></a><span id="l20.969">     if (data.category != undefined) {</span>
<a href="#l20.970"></a><span id="l20.970" class="difflineminus">-        controller.select(new elementslib.ID(controller.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l20.971"></a><span id="l20.971" class="difflineminus">-          data.category);</span>
<a href="#l20.972"></a><span id="l20.972" class="difflineminus">-        controller.sleep(sleep);</span>
<a href="#l20.973"></a><span id="l20.973" class="difflineplus">+        menulistSelect(iframeId(&quot;item-categories&quot;), data.category, dialog);</span>
<a href="#l20.974"></a><span id="l20.974" class="difflineplus">+    }</span>
<a href="#l20.975"></a><span id="l20.975" class="difflineplus">+</span>
<a href="#l20.976"></a><span id="l20.976" class="difflineplus">+    // calendar</span>
<a href="#l20.977"></a><span id="l20.977" class="difflineplus">+    if (data.calendar != undefined) {</span>
<a href="#l20.978"></a><span id="l20.978" class="difflineplus">+        menulistSelect(iframeId(&quot;item-calendar&quot;), data.calendar, dialog);</span>
<a href="#l20.979"></a><span id="l20.979">     }</span>
<a href="#l20.980"></a><span id="l20.980"> </span>
<a href="#l20.981"></a><span id="l20.981">     // all-day</span>
<a href="#l20.982"></a><span id="l20.982">     if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l20.983"></a><span id="l20.983" class="difflineminus">-        controller.check(new elementslib.ID(controller.window.document, &quot;event-all-day&quot;), data.allday);</span>
<a href="#l20.984"></a><span id="l20.984" class="difflineplus">+        dialog.check(iframeId(&quot;event-all-day&quot;), data.allday);</span>
<a href="#l20.985"></a><span id="l20.985">     }</span>
<a href="#l20.986"></a><span id="l20.986"> </span>
<a href="#l20.987"></a><span id="l20.987">     // timezone</span>
<a href="#l20.988"></a><span id="l20.988">     if (data.timezone != undefined) {</span>
<a href="#l20.989"></a><span id="l20.989" class="difflineminus">-        let menuitem = new elementslib.ID(controller.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l20.990"></a><span id="l20.990" class="difflineplus">+        let menuitem = iframeId(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l20.991"></a><span id="l20.991">         menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l20.992"></a><span id="l20.992" class="difflineminus">-        controller.click(menuitem);</span>
<a href="#l20.993"></a><span id="l20.993" class="difflineplus">+        dialog.click(menuitem);</span>
<a href="#l20.994"></a><span id="l20.994">     }</span>
<a href="#l20.995"></a><span id="l20.995"> </span>
<a href="#l20.996"></a><span id="l20.996">     // startdate</span>
<a href="#l20.997"></a><span id="l20.997">     if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l20.998"></a><span id="l20.998" class="difflineminus">-        let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l20.999"></a><span id="l20.999" class="difflineminus">-          data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l20.1000"></a><span id="l20.1000" class="difflineplus">+        let ymd = [</span>
<a href="#l20.1001"></a><span id="l20.1001" class="difflineplus">+            data.startdate.getFullYear(),</span>
<a href="#l20.1002"></a><span id="l20.1002" class="difflineplus">+            data.startdate.getMonth() + 1,</span>
<a href="#l20.1003"></a><span id="l20.1003" class="difflineplus">+            data.startdate.getDate()</span>
<a href="#l20.1004"></a><span id="l20.1004" class="difflineplus">+        ];</span>
<a href="#l20.1005"></a><span id="l20.1005" class="difflineplus">+        let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l20.1006"></a><span id="l20.1006" class="difflineplus">+</span>
<a href="#l20.1007"></a><span id="l20.1007">         if (!isEvent) {</span>
<a href="#l20.1008"></a><span id="l20.1008" class="difflineminus">-            controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-entrydate&quot;), true);</span>
<a href="#l20.1009"></a><span id="l20.1009" class="difflineplus">+            dialog.check(iframeId(&quot;todo-has-entrydate&quot;), true);</span>
<a href="#l20.1010"></a><span id="l20.1010">         }</span>
<a href="#l20.1011"></a><span id="l20.1011" class="difflineminus">-        if (mac) {</span>
<a href="#l20.1012"></a><span id="l20.1012" class="difflineminus">-            startDateInput.getNode().value = startdate;</span>
<a href="#l20.1013"></a><span id="l20.1013" class="difflineminus">-        } else {</span>
<a href="#l20.1014"></a><span id="l20.1014" class="difflineminus">-            controller.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.1015"></a><span id="l20.1015" class="difflineminus">-            controller.type(startDateInput, startdate);</span>
<a href="#l20.1016"></a><span id="l20.1016" class="difflineminus">-        }</span>
<a href="#l20.1017"></a><span id="l20.1017" class="difflineplus">+        startDateInput.getNode().value = startdate;</span>
<a href="#l20.1018"></a><span id="l20.1018">     }</span>
<a href="#l20.1019"></a><span id="l20.1019"> </span>
<a href="#l20.1020"></a><span id="l20.1020">     // starttime</span>
<a href="#l20.1021"></a><span id="l20.1021">     if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l20.1022"></a><span id="l20.1022" class="difflineminus">-        let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l20.1023"></a><span id="l20.1023" class="difflineminus">-          data.starttime.getHours(), data.starttime.getMinutes(), 0);</span>
<a href="#l20.1024"></a><span id="l20.1024" class="difflineminus">-        if (mac) {</span>
<a href="#l20.1025"></a><span id="l20.1025" class="difflineminus">-            startTimeInput.getNode().value = starttime;</span>
<a href="#l20.1026"></a><span id="l20.1026" class="difflineminus">-            controller.sleep(sleep);</span>
<a href="#l20.1027"></a><span id="l20.1027" class="difflineminus">-        } else {</span>
<a href="#l20.1028"></a><span id="l20.1028" class="difflineminus">-            controller.keypress(startTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.1029"></a><span id="l20.1029" class="difflineminus">-            controller.type(startTimeInput, starttime);</span>
<a href="#l20.1030"></a><span id="l20.1030" class="difflineminus">-        }</span>
<a href="#l20.1031"></a><span id="l20.1031" class="difflineplus">+        let hms = [data.starttime.getHours(), data.starttime.getMinutes(), 0];</span>
<a href="#l20.1032"></a><span id="l20.1032" class="difflineplus">+        let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, ...hms);</span>
<a href="#l20.1033"></a><span id="l20.1033" class="difflineplus">+        startTimeInput.getNode().value = starttime;</span>
<a href="#l20.1034"></a><span id="l20.1034" class="difflineplus">+        sleep();</span>
<a href="#l20.1035"></a><span id="l20.1035">     }</span>
<a href="#l20.1036"></a><span id="l20.1036"> </span>
<a href="#l20.1037"></a><span id="l20.1037">     // enddate</span>
<a href="#l20.1038"></a><span id="l20.1038">     if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l20.1039"></a><span id="l20.1039" class="difflineminus">-        let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l20.1040"></a><span id="l20.1040" class="difflineminus">-          data.enddate.getFullYear(), data.enddate.getMonth() + 1, data.enddate.getDate());</span>
<a href="#l20.1041"></a><span id="l20.1041" class="difflineplus">+        let ymd = [</span>
<a href="#l20.1042"></a><span id="l20.1042" class="difflineplus">+            data.enddate.getFullYear(),</span>
<a href="#l20.1043"></a><span id="l20.1043" class="difflineplus">+            data.enddate.getMonth() + 1,</span>
<a href="#l20.1044"></a><span id="l20.1044" class="difflineplus">+            data.enddate.getDate()</span>
<a href="#l20.1045"></a><span id="l20.1045" class="difflineplus">+        ];</span>
<a href="#l20.1046"></a><span id="l20.1046" class="difflineplus">+        let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l20.1047"></a><span id="l20.1047">         if (!isEvent) {</span>
<a href="#l20.1048"></a><span id="l20.1048" class="difflineminus">-            controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-duedate&quot;), true);</span>
<a href="#l20.1049"></a><span id="l20.1049" class="difflineplus">+            dialog.check(iframeId(&quot;todo-has-duedate&quot;), true);</span>
<a href="#l20.1050"></a><span id="l20.1050">         }</span>
<a href="#l20.1051"></a><span id="l20.1051" class="difflineminus">-        if (mac) {</span>
<a href="#l20.1052"></a><span id="l20.1052" class="difflineminus">-            endDateInput.getNode().value = enddate;</span>
<a href="#l20.1053"></a><span id="l20.1053" class="difflineminus">-        } else {</span>
<a href="#l20.1054"></a><span id="l20.1054" class="difflineminus">-            controller.keypress(endDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.1055"></a><span id="l20.1055" class="difflineminus">-            controller.type(endDateInput, enddate);</span>
<a href="#l20.1056"></a><span id="l20.1056" class="difflineminus">-        }</span>
<a href="#l20.1057"></a><span id="l20.1057" class="difflineplus">+        endDateInput.getNode().value = enddate;</span>
<a href="#l20.1058"></a><span id="l20.1058">     }</span>
<a href="#l20.1059"></a><span id="l20.1059"> </span>
<a href="#l20.1060"></a><span id="l20.1060" class="difflineminus">-    // endttime</span>
<a href="#l20.1061"></a><span id="l20.1061" class="difflineplus">+    // endtime</span>
<a href="#l20.1062"></a><span id="l20.1062">     if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l20.1063"></a><span id="l20.1063" class="difflineminus">-        let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l20.1064"></a><span id="l20.1064" class="difflineminus">-          data.endtime.getHours(), data.endtime.getMinutes(), 0);</span>
<a href="#l20.1065"></a><span id="l20.1065" class="difflineminus">-        if (mac) {</span>
<a href="#l20.1066"></a><span id="l20.1066" class="difflineminus">-            endTimeInput.getNode().value = endtime;</span>
<a href="#l20.1067"></a><span id="l20.1067" class="difflineminus">-            controller.sleep(sleep);</span>
<a href="#l20.1068"></a><span id="l20.1068" class="difflineminus">-        } else {</span>
<a href="#l20.1069"></a><span id="l20.1069" class="difflineminus">-            controller.keypress(endTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.1070"></a><span id="l20.1070" class="difflineminus">-            controller.type(endTimeInput, endtime);</span>
<a href="#l20.1071"></a><span id="l20.1071" class="difflineminus">-        }</span>
<a href="#l20.1072"></a><span id="l20.1072" class="difflineplus">+        let hms = [data.endtime.getHours(), data.endtime.getMinutes(), 0];</span>
<a href="#l20.1073"></a><span id="l20.1073" class="difflineplus">+        let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, ...hms);</span>
<a href="#l20.1074"></a><span id="l20.1074" class="difflineplus">+        endTimeInput.getNode().value = endtime;</span>
<a href="#l20.1075"></a><span id="l20.1075">     }</span>
<a href="#l20.1076"></a><span id="l20.1076"> </span>
<a href="#l20.1077"></a><span id="l20.1077">     // recurrence</span>
<a href="#l20.1078"></a><span id="l20.1078">     if (data.repeat != undefined) {</span>
<a href="#l20.1079"></a><span id="l20.1079" class="difflineminus">-        controller.select(new elementslib.ID(controller.window.document, &quot;item-repeat&quot;), undefined,</span>
<a href="#l20.1080"></a><span id="l20.1080" class="difflineminus">-          undefined, data.repeat);</span>
<a href="#l20.1081"></a><span id="l20.1081" class="difflineplus">+        menulistSelect(iframeId(&quot;item-repeat&quot;), data.repeat, dialog);</span>
<a href="#l20.1082"></a><span id="l20.1082">     }</span>
<a href="#l20.1083"></a><span id="l20.1083"> </span>
<a href="#l20.1084"></a><span id="l20.1084">     // reminder</span>
<a href="#l20.1085"></a><span id="l20.1085" class="difflineplus">+    // TODO: menulistSelect does not work here, because menuitems have no value.</span>
<a href="#l20.1086"></a><span id="l20.1086" class="difflineplus">+    // will be fixed with Bug 984044</span>
<a href="#l20.1087"></a><span id="l20.1087">     if (data.reminder != undefined) {</span>
<a href="#l20.1088"></a><span id="l20.1088" class="difflineminus">-        controller.select(new elementslib.ID(controller.window.document, &quot;item-alarm&quot;), data.reminder);</span>
<a href="#l20.1089"></a><span id="l20.1089" class="difflineplus">+        menulistSelect(iframeId(&quot;item-alarm&quot;), data.reminder, dialog);</span>
<a href="#l20.1090"></a><span id="l20.1090">     }</span>
<a href="#l20.1091"></a><span id="l20.1091"> </span>
<a href="#l20.1092"></a><span id="l20.1092">     // description</span>
<a href="#l20.1093"></a><span id="l20.1093">     if (data.description != undefined) {</span>
<a href="#l20.1094"></a><span id="l20.1094" class="difflineminus">-        if (mac) {</span>
<a href="#l20.1095"></a><span id="l20.1095" class="difflineminus">-            let descField = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.1096"></a><span id="l20.1096" class="difflineminus">-              'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l20.1097"></a><span id="l20.1097" class="difflineminus">-              'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l20.1098"></a><span id="l20.1098" class="difflineminus">-            descField.getNode().value = data.description;</span>
<a href="#l20.1099"></a><span id="l20.1099" class="difflineminus">-        } else {</span>
<a href="#l20.1100"></a><span id="l20.1100" class="difflineminus">-            controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.1101"></a><span id="l20.1101" class="difflineminus">-              'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l20.1102"></a><span id="l20.1102" class="difflineminus">-              'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l20.1103"></a><span id="l20.1103" class="difflineminus">-              &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.1104"></a><span id="l20.1104" class="difflineminus">-            controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.1105"></a><span id="l20.1105" class="difflineminus">-              'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l20.1106"></a><span id="l20.1106" class="difflineminus">-              'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l20.1107"></a><span id="l20.1107" class="difflineminus">-              data.description);</span>
<a href="#l20.1108"></a><span id="l20.1108" class="difflineminus">-        }</span>
<a href="#l20.1109"></a><span id="l20.1109" class="difflineplus">+        let descField = iframeLookup(`</span>
<a href="#l20.1110"></a><span id="l20.1110" class="difflineplus">+            ${innerFrame}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l20.1111"></a><span id="l20.1111" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l20.1112"></a><span id="l20.1112" class="difflineplus">+        `);</span>
<a href="#l20.1113"></a><span id="l20.1113" class="difflineplus">+        descField.getNode().value = data.description;</span>
<a href="#l20.1114"></a><span id="l20.1114">     }</span>
<a href="#l20.1115"></a><span id="l20.1115"> </span>
<a href="#l20.1116"></a><span id="l20.1116">     // priority</span>
<a href="#l20.1117"></a><span id="l20.1117">     if (data.priority != undefined) {</span>
<a href="#l20.1118"></a><span id="l20.1118" class="difflineminus">-        controller.mainMenu.click(&quot;#options-priority-&quot; + data.priority + &quot;-label&quot;);</span>
<a href="#l20.1119"></a><span id="l20.1119" class="difflineplus">+        dialog.mainMenu.click(`#options-priority-${data.priority}-label`);</span>
<a href="#l20.1120"></a><span id="l20.1120">     }</span>
<a href="#l20.1121"></a><span id="l20.1121"> </span>
<a href="#l20.1122"></a><span id="l20.1122">     // privacy</span>
<a href="#l20.1123"></a><span id="l20.1123">     if (data.privacy != undefined) {</span>
<a href="#l20.1124"></a><span id="l20.1124" class="difflineminus">-        controller.mainMenu.click(&quot;#options-privacy-&quot; + data.privacy + &quot;-menuitem&quot;);</span>
<a href="#l20.1125"></a><span id="l20.1125" class="difflineplus">+        dialog.mainMenu.click(`#options-privacy-${data.privacy}-menuitem`);</span>
<a href="#l20.1126"></a><span id="l20.1126">     }</span>
<a href="#l20.1127"></a><span id="l20.1127"> </span>
<a href="#l20.1128"></a><span id="l20.1128">     // status</span>
<a href="#l20.1129"></a><span id="l20.1129">     if (data.status != undefined) {</span>
<a href="#l20.1130"></a><span id="l20.1130">         if (isEvent) {</span>
<a href="#l20.1131"></a><span id="l20.1131" class="difflineminus">-            controller.mainMenu.click(&quot;#options-status-&quot; + data.status + &quot;-menuitem&quot;);</span>
<a href="#l20.1132"></a><span id="l20.1132" class="difflineplus">+            dialog.mainMenu.click(`#options-status-${data.status}-menuitem`);</span>
<a href="#l20.1133"></a><span id="l20.1133">         } else {</span>
<a href="#l20.1134"></a><span id="l20.1134" class="difflineminus">-            controller.select(new elementslib.ID(controller.window.document, &quot;todo-status&quot;), undefined,</span>
<a href="#l20.1135"></a><span id="l20.1135" class="difflineminus">-              undefined, data.status.toUpperCase());</span>
<a href="#l20.1136"></a><span id="l20.1136" class="difflineminus">-            controller.sleep(sleep);</span>
<a href="#l20.1137"></a><span id="l20.1137" class="difflineplus">+            menulistSelect(iframeId(&quot;todo-status&quot;), data.status.toUpperCase(), dialog);</span>
<a href="#l20.1138"></a><span id="l20.1138">         }</span>
<a href="#l20.1139"></a><span id="l20.1139">     }</span>
<a href="#l20.1140"></a><span id="l20.1140"> </span>
<a href="#l20.1141"></a><span id="l20.1141" class="difflineminus">-    let currentStatus = (new elementslib.ID(controller.window.document, &quot;todo-status&quot;)).getNode().value;</span>
<a href="#l20.1142"></a><span id="l20.1142" class="difflineplus">+    let currentStatus = iframeId(&quot;todo-status&quot;).getNode().value;</span>
<a href="#l20.1143"></a><span id="l20.1143"> </span>
<a href="#l20.1144"></a><span id="l20.1144">     // completed on</span>
<a href="#l20.1145"></a><span id="l20.1145">     if (data.completed != undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l20.1146"></a><span id="l20.1146" class="difflineminus">-        let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l20.1147"></a><span id="l20.1147" class="difflineminus">-          data.completed.getFullYear(), data.completed.getMonth() + 1,</span>
<a href="#l20.1148"></a><span id="l20.1148" class="difflineminus">-          data.completed.getDate());</span>
<a href="#l20.1149"></a><span id="l20.1149" class="difflineplus">+        let ymd = [</span>
<a href="#l20.1150"></a><span id="l20.1150" class="difflineplus">+            data.completed.getFullYear(),</span>
<a href="#l20.1151"></a><span id="l20.1151" class="difflineplus">+            data.completed.getMonth() + 1,</span>
<a href="#l20.1152"></a><span id="l20.1152" class="difflineplus">+            data.completed.getDate()</span>
<a href="#l20.1153"></a><span id="l20.1153" class="difflineplus">+        ];</span>
<a href="#l20.1154"></a><span id="l20.1154" class="difflineplus">+        let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l20.1155"></a><span id="l20.1155"> </span>
<a href="#l20.1156"></a><span id="l20.1156">         if (currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l20.1157"></a><span id="l20.1157" class="difflineminus">-            if (mac) {</span>
<a href="#l20.1158"></a><span id="l20.1158" class="difflineminus">-                completedDateInput.getNode().value = completeddate;</span>
<a href="#l20.1159"></a><span id="l20.1159" class="difflineminus">-            } else {</span>
<a href="#l20.1160"></a><span id="l20.1160" class="difflineminus">-                controller.keypress(completedDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l20.1161"></a><span id="l20.1161" class="difflineminus">-                controller.type(completedDateInput, completeddate);</span>
<a href="#l20.1162"></a><span id="l20.1162" class="difflineminus">-            }</span>
<a href="#l20.1163"></a><span id="l20.1163" class="difflineplus">+            completedDateInput.getNode().value = completeddate;</span>
<a href="#l20.1164"></a><span id="l20.1164">         }</span>
<a href="#l20.1165"></a><span id="l20.1165">     }</span>
<a href="#l20.1166"></a><span id="l20.1166"> </span>
<a href="#l20.1167"></a><span id="l20.1167">     // percent complete</span>
<a href="#l20.1168"></a><span id="l20.1168">     if (data.percent != undefined &amp;&amp;</span>
<a href="#l20.1169"></a><span id="l20.1169" class="difflineminus">-         (currentStatus == &quot;NEEDS-ACTION&quot; || currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l20.1170"></a><span id="l20.1170" class="difflineminus">-          currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l20.1171"></a><span id="l20.1171" class="difflineplus">+        (currentStatus == &quot;NEEDS-ACTION&quot; ||</span>
<a href="#l20.1172"></a><span id="l20.1172" class="difflineplus">+         currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l20.1173"></a><span id="l20.1173" class="difflineplus">+         currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l20.1174"></a><span id="l20.1174">         percentCompleteInput.getNode().value = data.percent;</span>
<a href="#l20.1175"></a><span id="l20.1175">     }</span>
<a href="#l20.1176"></a><span id="l20.1176"> </span>
<a href="#l20.1177"></a><span id="l20.1177">     // free/busy</span>
<a href="#l20.1178"></a><span id="l20.1178">     if (data.freebusy != undefined) {</span>
<a href="#l20.1179"></a><span id="l20.1179" class="difflineminus">-        controller.mainMenu.click(&quot;#options-freebusy-&quot; + data.freebusy + &quot;-menuitem&quot;);</span>
<a href="#l20.1180"></a><span id="l20.1180" class="difflineplus">+        dialog.mainMenu.click(`#options-freebusy-${data.freebusy}-menuitem`);</span>
<a href="#l20.1181"></a><span id="l20.1181">     }</span>
<a href="#l20.1182"></a><span id="l20.1182"> </span>
<a href="#l20.1183"></a><span id="l20.1183">     // attachment</span>
<a href="#l20.1184"></a><span id="l20.1184" class="difflineplus">+    // TODO: Needs fixing,</span>
<a href="#l20.1185"></a><span id="l20.1185" class="difflineplus">+    // will be fixed with Bug 984044</span>
<a href="#l20.1186"></a><span id="l20.1186">     if (data.attachment != undefined) {</span>
<a href="#l20.1187"></a><span id="l20.1187">         if (data.attachment.add != undefined) {</span>
<a href="#l20.1188"></a><span id="l20.1188" class="difflineminus">-            handleAddingAttachment(controller, data.attachment.add);</span>
<a href="#l20.1189"></a><span id="l20.1189" class="difflineminus">-            controller.click(new elementslib.ID(controller.window.document, &quot;button-url&quot;));</span>
<a href="#l20.1190"></a><span id="l20.1190" class="difflineplus">+            handleAddingAttachment(dialog, data.attachment.add);</span>
<a href="#l20.1191"></a><span id="l20.1191" class="difflineplus">+            dialog.click(eid(&quot;button-url&quot;));</span>
<a href="#l20.1192"></a><span id="l20.1192">         }</span>
<a href="#l20.1193"></a><span id="l20.1193">         if (data.attachment.delete != undefined) {</span>
<a href="#l20.1194"></a><span id="l20.1194" class="difflineminus">-            controller.click(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l20.1195"></a><span id="l20.1195" class="difflineminus">-              'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;' +</span>
<a href="#l20.1196"></a><span id="l20.1196" class="difflineminus">-              data.attachment.delete + '&quot;}'));</span>
<a href="#l20.1197"></a><span id="l20.1197" class="difflineminus">-            controller.keypress(new elementslib.ID(controller.window.document, &quot;attachment-link&quot;),</span>
<a href="#l20.1198"></a><span id="l20.1198" class="difflineminus">-              &quot;VK_DELETE&quot;, {});</span>
<a href="#l20.1199"></a><span id="l20.1199" class="difflineplus">+            dialog.click(iframeLookup(`</span>
<a href="#l20.1200"></a><span id="l20.1200" class="difflineplus">+                ${innerFrame}/id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/</span>
<a href="#l20.1201"></a><span id="l20.1201" class="difflineplus">+                {&quot;label&quot;:&quot;${data.attachment.delete}&quot;}</span>
<a href="#l20.1202"></a><span id="l20.1202" class="difflineplus">+            `));</span>
<a href="#l20.1203"></a><span id="l20.1203" class="difflineplus">+            dialog.keypress(iframeId(&quot;attachment-link&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l20.1204"></a><span id="l20.1204">         }</span>
<a href="#l20.1205"></a><span id="l20.1205">     }</span>
<a href="#l20.1206"></a><span id="l20.1206" class="difflineminus">-</span>
<a href="#l20.1207"></a><span id="l20.1207" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l20.1208"></a><span id="l20.1208" class="difflineplus">+    sleep();</span>
<a href="#l20.1209"></a><span id="l20.1209"> }</span>
<a href="#l20.1210"></a><span id="l20.1210"> </span>
<a href="#l20.1211"></a><span id="l20.1211" class="difflineminus">-function open_lightning_prefs(aCallback, aParentController, collector, windowTimeout) {</span>
<a href="#l20.1212"></a><span id="l20.1212" class="difflineminus">-    function paneLoadedChecker() {</span>
<a href="#l20.1213"></a><span id="l20.1213" class="difflineminus">-        let pane = prefsController.window.document.getElementById(&quot;paneLightning&quot;);</span>
<a href="#l20.1214"></a><span id="l20.1214" class="difflineminus">-        return pane.loaded;</span>
<a href="#l20.1215"></a><span id="l20.1215" class="difflineminus">-    }</span>
<a href="#l20.1216"></a><span id="l20.1216" class="difflineplus">+function openLightningPrefs(aCallback, aParentController) {</span>
<a href="#l20.1217"></a><span id="l20.1217" class="difflineplus">+    open_pref_window(&quot;paneLightning&quot;, aCallback);</span>
<a href="#l20.1218"></a><span id="l20.1218"> </span>
<a href="#l20.1219"></a><span id="l20.1219" class="difflineminus">-    let timeout = windowTimeout || 30000;</span>
<a href="#l20.1220"></a><span id="l20.1220" class="difflineminus">-    aParentController.window.openOptionsDialog(&quot;paneLightning&quot;);</span>
<a href="#l20.1221"></a><span id="l20.1221" class="difflineminus">-    aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 1,</span>
<a href="#l20.1222"></a><span id="l20.1222" class="difflineminus">-                              &quot;Error opening preferences window&quot;, timeout);</span>
<a href="#l20.1223"></a><span id="l20.1223" class="difflineminus">-    let prefsController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Mail:Preferences&quot;)[0]);</span>
<a href="#l20.1224"></a><span id="l20.1224" class="difflineminus">-    prefsController.waitFor(paneLoadedChecker, &quot;Timed out waiting for lightning prefpane to load.&quot;);</span>
<a href="#l20.1225"></a><span id="l20.1225" class="difflineminus">-</span>
<a href="#l20.1226"></a><span id="l20.1226" class="difflineminus">-    aCallback(prefsController);</span>
<a href="#l20.1227"></a><span id="l20.1227" class="difflineminus">-</span>
<a href="#l20.1228"></a><span id="l20.1228" class="difflineminus">-    prefsController.window.close();</span>
<a href="#l20.1229"></a><span id="l20.1229" class="difflineminus">-    aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 0,</span>
<a href="#l20.1230"></a><span id="l20.1230" class="difflineminus">-                              &quot;Error closing preferences window&quot;, timeout);</span>
<a href="#l20.1231"></a><span id="l20.1231" class="difflineplus">+    aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 0, &quot;Error closing preferences window&quot;, 2000);</span>
<a href="#l20.1232"></a><span id="l20.1232"> }</span>
<a href="#l20.1233"></a><span id="l20.1233"> </span>
<a href="#l20.1234"></a><span id="l20.1234" class="difflineminus">-// Export of constants</span>
<a href="#l20.1235"></a><span id="l20.1235" class="difflineminus">-exports.ALLDAY = ALLDAY;</span>
<a href="#l20.1236"></a><span id="l20.1236" class="difflineminus">-exports.CANVAS_BOX = CANVAS_BOX;</span>
<a href="#l20.1237"></a><span id="l20.1237" class="difflineminus">-exports.EVENT_BOX = EVENT_BOX;</span>
<a href="#l20.1238"></a><span id="l20.1238" class="difflineminus">-</span>
<a href="#l20.1239"></a><span id="l20.1239" class="difflineminus">-// Export of functions</span>
<a href="#l20.1240"></a><span id="l20.1240" class="difflineminus">-exports.acceptSendingNotificationMail = acceptSendingNotificationMail;</span>
<a href="#l20.1241"></a><span id="l20.1241" class="difflineminus">-exports.back = back;</span>
<a href="#l20.1242"></a><span id="l20.1242" class="difflineminus">-exports.createCalendar = createCalendar;</span>
<a href="#l20.1243"></a><span id="l20.1243" class="difflineminus">-exports.deleteCalendars = deleteCalendars;</span>
<a href="#l20.1244"></a><span id="l20.1244" class="difflineminus">-exports.findEventsInNode = findEventsInNode;</span>
<a href="#l20.1245"></a><span id="l20.1245" class="difflineminus">-exports.forward = forward;</span>
<a href="#l20.1246"></a><span id="l20.1246" class="difflineminus">-exports.getEventBoxPath = getEventBoxPath;</span>
<a href="#l20.1247"></a><span id="l20.1247" class="difflineminus">-exports.goToDate = goToDate;</span>
<a href="#l20.1248"></a><span id="l20.1248" class="difflineminus">-exports.handleAddingAttachment = handleAddingAttachment;</span>
<a href="#l20.1249"></a><span id="l20.1249" class="difflineminus">-exports.handleOccurrenceDeletion = handleOccurrenceDeletion;</span>
<a href="#l20.1250"></a><span id="l20.1250" class="difflineminus">-exports.handleOccurrenceModification = handleOccurrenceModification;</span>
<a href="#l20.1251"></a><span id="l20.1251" class="difflineminus">-exports.handleParentDeletion = handleParentDeletion;</span>
<a href="#l20.1252"></a><span id="l20.1252" class="difflineminus">-exports.handleParentModification = handleParentModification;</span>
<a href="#l20.1253"></a><span id="l20.1253" class="difflineminus">-exports.setData = setData;</span>
<a href="#l20.1254"></a><span id="l20.1254" class="difflineminus">-exports.switchToView = switchToView;</span>
<a href="#l20.1255"></a><span id="l20.1255" class="difflineminus">-exports.open_lightning_prefs = open_lightning_prefs;</span>
<a href="#l20.1256"></a><span id="l20.1256" class="difflineplus">+/**</span>
<a href="#l20.1257"></a><span id="l20.1257" class="difflineplus">+ * Helper to work around a mac bug in Thunderbird's mozmill version. This can</span>
<a href="#l20.1258"></a><span id="l20.1258" class="difflineplus">+ * likely be removed with Mozmill 2.0's new Element Object.</span>
<a href="#l20.1259"></a><span id="l20.1259" class="difflineplus">+ *</span>
<a href="#l20.1260"></a><span id="l20.1260" class="difflineplus">+ * @param aMenuList     The XUL menulist to select in</span>
<a href="#l20.1261"></a><span id="l20.1261" class="difflineplus">+ * @param aValue        The value assigned to the desired menuitem</span>
<a href="#l20.1262"></a><span id="l20.1262" class="difflineplus">+ * @param aController   The mozmill controller associated to the menulist.</span>
<a href="#l20.1263"></a><span id="l20.1263" class="difflineplus">+ */</span>
<a href="#l20.1264"></a><span id="l20.1264" class="difflineplus">+function menulistSelect(aMenuList, aValue, aController) {</span>
<a href="#l20.1265"></a><span id="l20.1265" class="difflineplus">+    let menulist = aMenuList.getNode();</span>
<a href="#l20.1266"></a><span id="l20.1266" class="difflineplus">+    let menuitem = menulist.querySelector(`menupopup &gt; menuitem[value='${aValue}']`);</span>
<a href="#l20.1267"></a><span id="l20.1267" class="difflineplus">+    menulist.click();</span>
<a href="#l20.1268"></a><span id="l20.1268" class="difflineplus">+    menuitem.click();</span>
<a href="#l20.1269"></a><span id="l20.1269" class="difflineplus">+    aController.waitFor(() =&gt; { return menulist.value == aValue; });</span>
<a href="#l20.1270"></a><span id="l20.1270" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">old mode 100644</span>
<a href="#l21.2"></a><span id="l21.2">new mode 100755</span>
<a href="#l21.3"></a><span id="l21.3">rename from calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l21.4"></a><span id="l21.4">rename to calendar/test/mozmill/shared-modules/test-timezone-utils.js</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-timezone-utils.js</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineat">@@ -1,90 +1,126 @@</span>
<a href="#l21.8"></a><span id="l21.8"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.9"></a><span id="l21.9">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.10"></a><span id="l21.10">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-var calUtils = require(&quot;calendar-utils&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-var prefs = require(&quot;prefs&quot;);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+var MODULE_NAME = &quot;timezone-utils&quot;;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+var DATES = [</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+    [2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+    [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+];</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+var TIMEZONES = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+var helpersForController, goToDate, viewForward, viewBack, findEventsInNode;</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+function setupModule() {</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+    ({ helpersForController, goToDate, viewForward, viewBack, findEventsInNode } =</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+}</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+function installInto(module) {</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+    // copy constants into module</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+    module.DATES = DATES;</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+    module.TIMEZONES = TIMEZONES;</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+    // Now copy helper functions</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+    module.switchAppTimezone = switchAppTimezone;</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+    module.verify = verify;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+}</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+</span>
<a href="#l21.45"></a><span id="l21.45"> </span>
<a href="#l21.46"></a><span id="l21.46"> function switchAppTimezone(timezone) {</span>
<a href="#l21.47"></a><span id="l21.47">     // change directly as Mac has different Lookup &amp; XPath than Windows &amp; Linux, bug 536605</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-    prefs.preferences.setPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l21.50"></a><span id="l21.50"> }</span>
<a href="#l21.51"></a><span id="l21.51"> </span>
<a href="#l21.52"></a><span id="l21.52"> function verify(controller, dates, timezones, times) {</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-    let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)';</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-    let dayStack = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-    let timeLine = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/' +</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/';</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+    function* datetimes() {</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+        for (let idx = 0; idx &lt; dates.length; idx++) {</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+            yield [dates[idx][0], dates[idx][1], dates[idx][2], times[idx]];</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+        }</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+    }</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+    let { lookup } = helpersForController(controller);</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+    let dayView = `</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+        id(&quot;day-view&quot;)</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+    `;</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+    let dayStack = `</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+    `;</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+    let timeLine = `</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;timebar&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+    `;</span>
<a href="#l21.84"></a><span id="l21.84">     let allowedDifference = 3;</span>
<a href="#l21.85"></a><span id="l21.85"> </span>
<a href="#l21.86"></a><span id="l21.86">     /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l21.87"></a><span id="l21.87">        xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l21.88"></a><span id="l21.88">        a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l21.89"></a><span id="l21.89">        But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l21.90"></a><span id="l21.90">        on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l21.91"></a><span id="l21.91">     */</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineminus">-    for (let date = 0; date &lt; dates.length; date++) {</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineminus">-        calUtils.goToDate(controller, dates[date][0], dates[date][1], dates[date][2]);</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+    for (let [selectedYear, selectedMonth, selectedDay, selectedTime] of datetimes()) {</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+        goToDate(controller, selectedYear, selectedMonth, selectedDay);</span>
<a href="#l21.97"></a><span id="l21.97"> </span>
<a href="#l21.98"></a><span id="l21.98">         // find event with timezone tz</span>
<a href="#l21.99"></a><span id="l21.99">         for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineplus">+            let [correctHour, minutes, day] = selectedTime[tzIdx];</span>
<a href="#l21.101"></a><span id="l21.101">             let found = false;</span>
<a href="#l21.102"></a><span id="l21.102"> </span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-            let correctHour = times[date][tzIdx][0];</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-            let minutes = times[date][tzIdx][1];</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-            let day = times[date][tzIdx][2];</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineminus">-</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineminus">-            let timeNode = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-                                                   timeLine + &quot;[&quot; + correctHour + &quot;]&quot;)).getNode();</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-            let timeY = timeNode.boxObject.y;</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineminus">-            timeY += timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineplus">+            let timeNode = lookup(`${timeLine}/[${correctHour}]`).getNode();</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineplus">+            let timeY = timeNode.boxObject.y + timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l21.113"></a><span id="l21.113"> </span>
<a href="#l21.114"></a><span id="l21.114">             let stackNode;</span>
<a href="#l21.115"></a><span id="l21.115">             let eventNodes = [];</span>
<a href="#l21.116"></a><span id="l21.116"> </span>
<a href="#l21.117"></a><span id="l21.117">             // same day</span>
<a href="#l21.118"></a><span id="l21.118">             if (day == undefined) {</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-                stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineplus">+                stackNode = lookup(dayStack).getNode();</span>
<a href="#l21.121"></a><span id="l21.121">             }</span>
<a href="#l21.122"></a><span id="l21.122"> </span>
<a href="#l21.123"></a><span id="l21.123">             // following day</span>
<a href="#l21.124"></a><span id="l21.124">             if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineminus">-                calUtils.forward(controller, 1);</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineminus">-                stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineplus">+                viewForward(controller, 1);</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineplus">+                stackNode = lookup(dayStack).getNode();</span>
<a href="#l21.129"></a><span id="l21.129">             }</span>
<a href="#l21.130"></a><span id="l21.130"> </span>
<a href="#l21.131"></a><span id="l21.131">             // previous day</span>
<a href="#l21.132"></a><span id="l21.132">             if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineminus">-                calUtils.back(controller, 1);</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineminus">-                stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineplus">+                viewBack(controller, 1);</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineplus">+                stackNode = lookup(dayStack).getNode();</span>
<a href="#l21.137"></a><span id="l21.137">             }</span>
<a href="#l21.138"></a><span id="l21.138"> </span>
<a href="#l21.139"></a><span id="l21.139" class="difflineminus">-            calUtils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineplus">+            findEventsInNode(stackNode, eventNodes);</span>
<a href="#l21.141"></a><span id="l21.141"> </span>
<a href="#l21.142"></a><span id="l21.142">             for (let node of eventNodes) {</span>
<a href="#l21.143"></a><span id="l21.143">                 if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineminus">-                             timezones[tzIdx] == node.mOccurrence.title) {</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineplus">+                    timezones[tzIdx] == node.mOccurrence.title) {</span>
<a href="#l21.146"></a><span id="l21.146">                     found = true;</span>
<a href="#l21.147"></a><span id="l21.147">                     break;</span>
<a href="#l21.148"></a><span id="l21.148">                 }</span>
<a href="#l21.149"></a><span id="l21.149">             }</span>
<a href="#l21.150"></a><span id="l21.150"> </span>
<a href="#l21.151"></a><span id="l21.151">             if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineminus">-                calUtils.back(controller, 1);</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineplus">+                viewBack(controller, 1);</span>
<a href="#l21.154"></a><span id="l21.154">             }</span>
<a href="#l21.155"></a><span id="l21.155"> </span>
<a href="#l21.156"></a><span id="l21.156">             if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineminus">-                calUtils.forward(controller, 1);</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineplus">+                viewForward(controller, 1);</span>
<a href="#l21.159"></a><span id="l21.159">             }</span>
<a href="#l21.160"></a><span id="l21.160">             controller.assertJS(found == true);</span>
<a href="#l21.161"></a><span id="l21.161">         }</span>
<a href="#l21.162"></a><span id="l21.162">     }</span>
<a href="#l21.163"></a><span id="l21.163"> }</span>
<a href="#l21.164"></a><span id="l21.164" class="difflineminus">-</span>
<a href="#l21.165"></a><span id="l21.165" class="difflineminus">-// Export of functions</span>
<a href="#l21.166"></a><span id="l21.166" class="difflineminus">-exports.switchAppTimezone = switchAppTimezone;</span>
<a href="#l21.167"></a><span id="l21.167" class="difflineminus">-exports.verify = verify;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">old mode 100644</span>
<a href="#l22.2"></a><span id="l22.2">new mode 100755</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineminus">--- a/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineplus">+++ b/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineat">@@ -1,118 +1,112 @@</span>
<a href="#l22.6"></a><span id="l22.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.7"></a><span id="l22.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.8"></a><span id="l22.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> /**</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">- * @title Test default alarm settings for events and tasks</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">- * @litmus 2510</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+ * Test default alarm settings for events and tasks</span>
<a href="#l22.14"></a><span id="l22.14">  */</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-</span>
<a href="#l22.20"></a><span id="l22.20"> var MODULE_NAME = &quot;testAlarmDefaultValue&quot;;</span>
<a href="#l22.21"></a><span id="l22.21"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;keyboard-helpers&quot;];</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-var calendarController;</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-var calUtils = require(&quot;shared-modules/calendar-utils&quot;);</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+Cu.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+Cu.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+const DEFVALUE = 43;</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+var helpersForController, invokeEventDialog, openLightningPrefs, menulistSelect;</span>
<a href="#l22.34"></a><span id="l22.34"> </span>
<a href="#l22.35"></a><span id="l22.35"> function setupModule(module) {</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-    calendarController = mozmill.getMail3PaneController();</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+    ({</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+        helpersForController,</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+        openLightningPrefs,</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+        menulistSelect</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l22.46"></a><span id="l22.46"> }</span>
<a href="#l22.47"></a><span id="l22.47"> </span>
<a href="#l22.48"></a><span id="l22.48"> function testDefaultAlarms() {</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineminus">-    let localeUnitString = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-                                            &quot;unitDays&quot;);</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-    let unitString = PluralForm.get(50, localeUnitString)</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-                               .replace(&quot;#1&quot;, 50);</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-    let originStringEvent = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-                                             &quot;reminderCustomOriginBeginBeforeEvent&quot;);</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-    let originStringTask = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">-                                            &quot;reminderCustomOriginBeginBeforeTask&quot;);</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-    let expectedEventReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-                                                &quot;reminderCustomTitle&quot;,</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineminus">-                                                [unitString, originStringEvent]);</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-    let expectedTaskReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-                                                &quot;reminderCustomTitle&quot;,</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-                                                [unitString, originStringTask]);</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+    let localeUnitString = cal.calGetString(&quot;calendar&quot;, &quot;unitDays&quot;);</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+    let unitString = PluralForm.get(DEFVALUE, localeUnitString).replace(&quot;#1&quot;, DEFVALUE);</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+    let alarmString = (...args) =&gt; cal.calGetString(&quot;calendar-alarms&quot;, ...args);</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineplus">+    let originStringEvent = alarmString(&quot;reminderCustomOriginBeginBeforeEvent&quot;);</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+    let originStringTask = alarmString(&quot;reminderCustomOriginBeginBeforeTask&quot;);</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+    let expectedEventReminder = alarmString(&quot;reminderCustomTitle&quot;, [unitString, originStringEvent]);</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+    let expectedTaskReminder = alarmString(&quot;reminderCustomTitle&quot;, [unitString, originStringTask]);</span>
<a href="#l22.70"></a><span id="l22.70"> </span>
<a href="#l22.71"></a><span id="l22.71">     // Configure the lightning preferences</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-    calUtils.open_lightning_prefs(handle_pref_dialog, calendarController, collector);</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+    openLightningPrefs(handlePrefDialog, controller);</span>
<a href="#l22.74"></a><span id="l22.74"> </span>
<a href="#l22.75"></a><span id="l22.75">     // Create New Event</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-    calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-calendar-menuitem&quot;));</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+    controller.click(eid(&quot;newMsgButton-calendar-menuitem&quot;));</span>
<a href="#l22.78"></a><span id="l22.78"> </span>
<a href="#l22.79"></a><span id="l22.79">     // Set up the event dialog controller</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineminus">-    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0);</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineminus">-    let eventController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+    invokeEventDialog(controller, null, (event, iframe) =&gt; {</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+        let { xpath: eventpath, eid: eventid } = helpersForController(event);</span>
<a href="#l22.84"></a><span id="l22.84"> </span>
<a href="#l22.85"></a><span id="l22.85" class="difflineminus">-    // Check if the &quot;custom&quot; item was selected</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineminus">-    eventController.assertDOMProperty(new elementslib.ID(eventController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineminus">-                                      &quot;value&quot;,</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-                                      &quot;custom&quot;);</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineminus">-    eventController.assertDOMProperty(new elementslib.XPath(eventController.window.document,</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineminus">-                                        '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineminus">-                                        'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineminus">-                                      &quot;value&quot;,</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineminus">-                                      expectedEventReminder);</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineplus">+        // Check if the &quot;custom&quot; item was selected</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineplus">+        event.assertDOMProperty(eventid(&quot;item-alarm&quot;), &quot;value&quot;, &quot;custom&quot;);</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineplus">+        let reminderDetailsVisible = eventpath(`</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineplus">+            //*[@id=&quot;reminder-details&quot;]/</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineplus">+            *[local-name()=&quot;label&quot; and (not(@hidden) or @hidden=&quot;false&quot;)]</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineplus">+        `);</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+        event.assertDOMProperty(reminderDetailsVisible, &quot;value&quot;, expectedEventReminder);</span>
<a href="#l22.101"></a><span id="l22.101"> </span>
<a href="#l22.102"></a><span id="l22.102" class="difflineminus">-    // Close the event dialog</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineminus">-    eventController.window.close();</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineminus">-    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l22.105"></a><span id="l22.105" class="difflineplus">+        // Close the event dialog</span>
<a href="#l22.106"></a><span id="l22.106" class="difflineplus">+        event.window.close();</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineplus">+    });</span>
<a href="#l22.108"></a><span id="l22.108"> </span>
<a href="#l22.109"></a><span id="l22.109">     // Create New Task</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineminus">-    calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-task-menuitem&quot;));</span>
<a href="#l22.111"></a><span id="l22.111" class="difflineminus">-</span>
<a href="#l22.112"></a><span id="l22.112" class="difflineminus">-    // Set up the task dialog controller</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineminus">-    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0);</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineminus">-    let taskController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineplus">+    controller.click(eid(&quot;newMsgButton-task-menuitem&quot;));</span>
<a href="#l22.116"></a><span id="l22.116" class="difflineplus">+    invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l22.117"></a><span id="l22.117" class="difflineplus">+        let { xpath: taskpath, eid: taskid } = helpersForController(task);</span>
<a href="#l22.118"></a><span id="l22.118"> </span>
<a href="#l22.119"></a><span id="l22.119" class="difflineminus">-    // Check if the &quot;custom&quot; item was selected</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineminus">-    taskController.assertDOMProperty(new elementslib.ID(taskController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineminus">-                                     &quot;value&quot;,</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineminus">-                                     &quot;custom&quot;);</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineminus">-    taskController.assertDOMProperty(new elementslib.XPath(taskController.window.document,</span>
<a href="#l22.124"></a><span id="l22.124" class="difflineminus">-                                       '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l22.125"></a><span id="l22.125" class="difflineminus">-                                        'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l22.126"></a><span id="l22.126" class="difflineminus">-                                     &quot;value&quot;,</span>
<a href="#l22.127"></a><span id="l22.127" class="difflineminus">-                                     expectedTaskReminder);</span>
<a href="#l22.128"></a><span id="l22.128" class="difflineminus">-    // Close the task dialog</span>
<a href="#l22.129"></a><span id="l22.129" class="difflineminus">-    taskController.window.close();</span>
<a href="#l22.130"></a><span id="l22.130" class="difflineminus">-    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l22.131"></a><span id="l22.131" class="difflineplus">+        // Check if the &quot;custom&quot; item was selected</span>
<a href="#l22.132"></a><span id="l22.132" class="difflineplus">+        task.assertDOMProperty(taskid(&quot;item-alarm&quot;), &quot;value&quot;, &quot;custom&quot;);</span>
<a href="#l22.133"></a><span id="l22.133" class="difflineplus">+        reminderDetailsVisible = taskpath(`</span>
<a href="#l22.134"></a><span id="l22.134" class="difflineplus">+            //*[@id=&quot;reminder-details&quot;]/</span>
<a href="#l22.135"></a><span id="l22.135" class="difflineplus">+            *[local-name()=&quot;label&quot; and (not(@hidden) or @hidden=&quot;false&quot;)]</span>
<a href="#l22.136"></a><span id="l22.136" class="difflineplus">+        `);</span>
<a href="#l22.137"></a><span id="l22.137" class="difflineplus">+        task.assertDOMProperty(reminderDetailsVisible, &quot;value&quot;, expectedTaskReminder);</span>
<a href="#l22.138"></a><span id="l22.138" class="difflineplus">+</span>
<a href="#l22.139"></a><span id="l22.139" class="difflineplus">+        // Close the task dialog</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineplus">+        task.window.close();</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineplus">+    });</span>
<a href="#l22.142"></a><span id="l22.142"> }</span>
<a href="#l22.143"></a><span id="l22.143"> </span>
<a href="#l22.144"></a><span id="l22.144" class="difflineminus">-function handle_pref_dialog(prefsController) {</span>
<a href="#l22.145"></a><span id="l22.145" class="difflineplus">+function handlePrefDialog(prefs) {</span>
<a href="#l22.146"></a><span id="l22.146" class="difflineplus">+    let { eid: prefsid } = helpersForController(prefs);</span>
<a href="#l22.147"></a><span id="l22.147" class="difflineplus">+</span>
<a href="#l22.148"></a><span id="l22.148">     // Click on the alarms tab</span>
<a href="#l22.149"></a><span id="l22.149" class="difflineminus">-    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;calPreferencesTabAlarms&quot;));</span>
<a href="#l22.150"></a><span id="l22.150" class="difflineplus">+    prefs.click(prefsid(&quot;calPreferencesTabAlarms&quot;));</span>
<a href="#l22.151"></a><span id="l22.151"> </span>
<a href="#l22.152"></a><span id="l22.152">     // Turn on alarms for events and tasks</span>
<a href="#l22.153"></a><span id="l22.153" class="difflineminus">-    prefsController.waitThenClick(new elementslib.ID(prefsController.window.document, &quot;eventdefalarm&quot;));</span>
<a href="#l22.154"></a><span id="l22.154" class="difflineminus">-    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmon&quot;));</span>
<a href="#l22.155"></a><span id="l22.155" class="difflineminus">-    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarm&quot;));</span>
<a href="#l22.156"></a><span id="l22.156" class="difflineminus">-    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmon&quot;));</span>
<a href="#l22.157"></a><span id="l22.157" class="difflineplus">+    prefs.waitForElement(prefsid(&quot;eventdefalarm&quot;));</span>
<a href="#l22.158"></a><span id="l22.158" class="difflineplus">+    menulistSelect(prefsid(&quot;eventdefalarm&quot;), &quot;1&quot;, prefs);</span>
<a href="#l22.159"></a><span id="l22.159" class="difflineplus">+    menulistSelect(prefsid(&quot;tododefalarm&quot;), &quot;1&quot;, prefs);</span>
<a href="#l22.160"></a><span id="l22.160"> </span>
<a href="#l22.161"></a><span id="l22.161">     // Selects &quot;days&quot; as a unit</span>
<a href="#l22.162"></a><span id="l22.162" class="difflineminus">-    prefsController.select(new elementslib.ID(prefsController.window.document, &quot;tododefalarmunit&quot;),</span>
<a href="#l22.163"></a><span id="l22.163" class="difflineminus">-                           null, null, &quot;days&quot;);</span>
<a href="#l22.164"></a><span id="l22.164" class="difflineminus">-    prefsController.select(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmunit&quot;),</span>
<a href="#l22.165"></a><span id="l22.165" class="difflineminus">-                           null, null, &quot;days&quot;);</span>
<a href="#l22.166"></a><span id="l22.166" class="difflineplus">+    menulistSelect(prefsid(&quot;tododefalarmunit&quot;), &quot;days&quot;, prefs);</span>
<a href="#l22.167"></a><span id="l22.167" class="difflineplus">+    menulistSelect(prefsid(&quot;eventdefalarmunit&quot;), &quot;days&quot;, prefs);</span>
<a href="#l22.168"></a><span id="l22.168"> </span>
<a href="#l22.169"></a><span id="l22.169" class="difflineminus">-    // Sets default alarm length for events to &quot;50&quot;</span>
<a href="#l22.170"></a><span id="l22.170" class="difflineminus">-    let eventdefalarmlen = new elementslib.ID(prefsController.window.document, &quot;eventdefalarmlen&quot;);</span>
<a href="#l22.171"></a><span id="l22.171" class="difflineminus">-    let tododefalarmlen = new elementslib.ID(prefsController.window.document, &quot;tododefalarmlen&quot;);</span>
<a href="#l22.172"></a><span id="l22.172" class="difflineminus">-    prefsController.keypress(eventdefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l22.173"></a><span id="l22.173" class="difflineminus">-    prefsController.type(eventdefalarmlen, &quot;50&quot;);</span>
<a href="#l22.174"></a><span id="l22.174" class="difflineminus">-    prefsController.keypress(tododefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l22.175"></a><span id="l22.175" class="difflineminus">-    prefsController.type(tododefalarmlen, &quot;50&quot;);</span>
<a href="#l22.176"></a><span id="l22.176" class="difflineplus">+    // Sets default alarm length for events to DEFVALUE</span>
<a href="#l22.177"></a><span id="l22.177" class="difflineplus">+    let eventdefalarmlen = prefsid(&quot;eventdefalarmlen&quot;);</span>
<a href="#l22.178"></a><span id="l22.178" class="difflineplus">+    prefs.click(eventdefalarmlen);</span>
<a href="#l22.179"></a><span id="l22.179" class="difflineplus">+    prefs.keypress(eventdefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l22.180"></a><span id="l22.180" class="difflineplus">+    prefs.type(eventdefalarmlen, DEFVALUE.toString());</span>
<a href="#l22.181"></a><span id="l22.181" class="difflineplus">+</span>
<a href="#l22.182"></a><span id="l22.182" class="difflineplus">+    let tododefalarmlen = prefsid(&quot;tododefalarmlen&quot;);</span>
<a href="#l22.183"></a><span id="l22.183" class="difflineplus">+    prefs.click(tododefalarmlen);</span>
<a href="#l22.184"></a><span id="l22.184" class="difflineplus">+    prefs.keypress(tododefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l22.185"></a><span id="l22.185" class="difflineplus">+    prefs.type(tododefalarmlen, DEFVALUE.toString());</span>
<a href="#l22.186"></a><span id="l22.186" class="difflineplus">+    prefs.window.document.documentElement.acceptDialog();</span>
<a href="#l22.187"></a><span id="l22.187"> }</span>
<a href="#l22.188"></a><span id="l22.188"> </span>
<a href="#l22.189"></a><span id="l22.189"> function teardownTest(module) {</span>
<a href="#l22.190"></a><span id="l22.190" class="difflineminus">-    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l22.191"></a><span id="l22.191" class="difflineminus">-    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l22.192"></a><span id="l22.192" class="difflineminus">-    Services.prefs.clearUserPref(&quot;calendar.alarms.onforevents&quot;);</span>
<a href="#l22.193"></a><span id="l22.193" class="difflineminus">-    Services.prefs.clearUserPref(&quot;calendar.alarms.onfortodos&quot;);</span>
<a href="#l22.194"></a><span id="l22.194" class="difflineminus">-    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l22.195"></a><span id="l22.195" class="difflineminus">-    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l22.196"></a><span id="l22.196" class="difflineplus">+    Preferences.resetBranch(&quot;calendar.alarms&quot;);</span>
<a href="#l22.197"></a><span id="l22.197"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">old mode 100644</span>
<a href="#l23.2"></a><span id="l23.2">new mode 100755</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineat">@@ -1,97 +1,106 @@</span>
<a href="#l23.6"></a><span id="l23.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l23.7"></a><span id="l23.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l23.8"></a><span id="l23.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10"> var MODULE_NAME = &quot;testBasicFunctionality&quot;;</span>
<a href="#l23.11"></a><span id="l23.11"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l23.12"></a><span id="l23.12"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l23.13"></a><span id="l23.13"> </span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-var calUtils = require(&quot;shared-modules/calendar-utils&quot;);</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+var helpersForController, deleteCalendars, handleNewCalendarWizard;</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+var TIMEOUT_MODAL_DIALOG, CALENDARNAME;</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20" class="difflineminus">-var modalDialog;</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+function setupModule(module) {</span>
<a href="#l23.23"></a><span id="l23.23">     controller = mozmill.getMail3PaneController();</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-    modalDialog = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-};</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineplus">+    ({</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineplus">+        helpersForController,</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+        deleteCalendars,</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+        handleNewCalendarWizard,</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+        TIMEOUT_MODAL_DIALOG,</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+        CALENDARNAME</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+}</span>
<a href="#l23.38"></a><span id="l23.38"> </span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-var testSmokeTest = function() {</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+function testSmokeTest() {</span>
<a href="#l23.41"></a><span id="l23.41">     let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l23.42"></a><span id="l23.42">                                 .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-    let path = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/';</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+    let path = `</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+    `;</span>
<a href="#l23.49"></a><span id="l23.49"> </span>
<a href="#l23.50"></a><span id="l23.50">     // open calendar view</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l23.53"></a><span id="l23.53"> </span>
<a href="#l23.54"></a><span id="l23.54">     // check for minimonth</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineminus">-    controller.waitForElement(new elementslib.ID(controller.window.document, &quot;calMinimonth&quot;));</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineplus">+    controller.waitForElement(eid(&quot;calMinimonth&quot;));</span>
<a href="#l23.57"></a><span id="l23.57">     // every month has a first</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l23.59"></a><span id="l23.59" class="difflineminus">-      'id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/' +</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineminus">-      'id(&quot;calMinimonth&quot;)/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineplus">+    controller.assertNode(lookup(`</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+        ${path}/id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l23.65"></a><span id="l23.65" class="difflineplus">+    `));</span>
<a href="#l23.66"></a><span id="l23.66"> </span>
<a href="#l23.67"></a><span id="l23.67">     // check for calendar list</span>
<a href="#l23.68"></a><span id="l23.68" class="difflineminus">-    controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-list-pane&quot;));</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineminus">-      'id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/' +</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineminus">-      'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})'));</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineplus">+    controller.assertNode(eid(&quot;calendar-list-pane&quot;));</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineplus">+    controller.assertNode(lookup(`</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineplus">+        ${path}/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineplus">+        id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)/</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+    `));</span>
<a href="#l23.78"></a><span id="l23.78"> </span>
<a href="#l23.79"></a><span id="l23.79">     // check for event search</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineminus">-    controller.assertNode(new elementslib.ID(controller.window.document, &quot;bottom-events-box&quot;));</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineplus">+    controller.assertNode(eid(&quot;bottom-events-box&quot;));</span>
<a href="#l23.82"></a><span id="l23.82">     // there should be search field</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineminus">-    controller.assertNode(new elementslib.ID(controller.window.document, &quot;unifinder-search-field&quot;));</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineplus">+    controller.assertNode(eid(&quot;unifinder-search-field&quot;));</span>
<a href="#l23.85"></a><span id="l23.85"> </span>
<a href="#l23.86"></a><span id="l23.86">     // default view is day view which should have 09:00 label and box</span>
<a href="#l23.87"></a><span id="l23.87">     let label = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, 9, 0, 0);</span>
<a href="#l23.88"></a><span id="l23.88" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l23.89"></a><span id="l23.89" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/' +</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/' +</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/{&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;' + label + '&quot;}'));</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/' +</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/' +</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineplus">+    controller.assertNode(lookup(`</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineplus">+        ${path}/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineplus">+        id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;${label}&quot;}</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineplus">+    `));</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineplus">+    controller.assertNode(lookup(`</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineplus">+        ${path}/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineplus">+        id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/</span>
<a href="#l23.107"></a><span id="l23.107" class="difflineplus">+        [0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineplus">+    `));</span>
<a href="#l23.109"></a><span id="l23.109"> </span>
<a href="#l23.110"></a><span id="l23.110">     // open tasks view</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineplus">+    controller.click(eid(&quot;task-tab-button&quot;));</span>
<a href="#l23.113"></a><span id="l23.113">     // should be possible to filter today's tasks</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineminus">-    controller.waitForElement(new elementslib.ID(controller.window.document, &quot;opt_today_filter&quot;));</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineplus">+    controller.waitForElement(eid(&quot;opt_today_filter&quot;));</span>
<a href="#l23.116"></a><span id="l23.116">     // check for task add button</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineminus">-    controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-add-task-button&quot;));</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+    controller.assertNode(eid(&quot;calendar-add-task-button&quot;));</span>
<a href="#l23.119"></a><span id="l23.119">     // check for filtered tasks list</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/[1]/id(&quot;calendar-task-tree&quot;)/' +</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}'));</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineplus">+    controller.assertNode(lookup(`</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineplus">+        ${path}/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/[1]/</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineplus">+        id(&quot;calendar-task-tree&quot;)/anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineplus">+        {&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineplus">+    `));</span>
<a href="#l23.128"></a><span id="l23.128"> </span>
<a href="#l23.129"></a><span id="l23.129">     // create test calendar</span>
<a href="#l23.130"></a><span id="l23.130" class="difflineminus">-    modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l23.131"></a><span id="l23.131" class="difflineminus">-    let calendarList = new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineminus">-      '/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/' +</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineminus">-      'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})');</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineminus">-    controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height); // bottom left</span>
<a href="#l23.135"></a><span id="l23.135" class="difflineminus">-    modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineminus">-};</span>
<a href="#l23.137"></a><span id="l23.137" class="difflineminus">-</span>
<a href="#l23.138"></a><span id="l23.138" class="difflineminus">-function handleNewCalendarWizard(controller) {</span>
<a href="#l23.139"></a><span id="l23.139" class="difflineminus">-    let docEl = controller.window.document.documentElement;</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineminus">-    // click next</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineminus">-    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineminus">-</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineminus">-    // set calendar name</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineminus">-    let calendarNameTextBox = new elementslib.Lookup(controller.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l23.145"></a><span id="l23.145" class="difflineminus">-      '{&quot;pageid&quot;:&quot;customizePage&quot;}/[1]/id(&quot;customize-rows&quot;)/id(&quot;customize-name-row&quot;)/' +</span>
<a href="#l23.146"></a><span id="l23.146" class="difflineminus">-      'id(&quot;calendar-name&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineminus">-    controller.waitForElement(calendarNameTextBox);</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineminus">-    controller.type(calendarNameTextBox, &quot;Mozmill&quot;);</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineminus">-</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineminus">-    // click next</span>
<a href="#l23.151"></a><span id="l23.151" class="difflineminus">-    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineminus">-</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineminus">-    // click finish</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineminus">-    docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l23.155"></a><span id="l23.155" class="difflineplus">+    plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, (wizard) =&gt; {</span>
<a href="#l23.156"></a><span id="l23.156" class="difflineplus">+        handleNewCalendarWizard(wizard, CALENDARNAME);</span>
<a href="#l23.157"></a><span id="l23.157" class="difflineplus">+    });</span>
<a href="#l23.158"></a><span id="l23.158" class="difflineplus">+    let calendarList = lookup(`</span>
<a href="#l23.159"></a><span id="l23.159" class="difflineplus">+        ${path}/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/</span>
<a href="#l23.160"></a><span id="l23.160" class="difflineplus">+        id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)/</span>
<a href="#l23.161"></a><span id="l23.161" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})</span>
<a href="#l23.162"></a><span id="l23.162" class="difflineplus">+    `);</span>
<a href="#l23.163"></a><span id="l23.163" class="difflineplus">+    // double click on bottom left</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineplus">+    controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height);</span>
<a href="#l23.165"></a><span id="l23.165" class="difflineplus">+    wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l23.166"></a><span id="l23.166"> }</span>
<a href="#l23.167"></a><span id="l23.167"> </span>
<a href="#l23.168"></a><span id="l23.168" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l23.169"></a><span id="l23.169" class="difflineminus">-    calUtils.deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l23.170"></a><span id="l23.170" class="difflineminus">-};</span>
<a href="#l23.171"></a><span id="l23.171" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l23.172"></a><span id="l23.172" class="difflineplus">+    deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">old mode 100644</span>
<a href="#l24.2"></a><span id="l24.2">new mode 100755</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineminus">--- a/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineplus">+++ b/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineat">@@ -1,135 +1,93 @@</span>
<a href="#l24.6"></a><span id="l24.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.7"></a><span id="l24.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.8"></a><span id="l24.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.9"></a><span id="l24.9"> </span>
<a href="#l24.10"></a><span id="l24.10"> var MODULE_NAME = &quot;testLocalICS&quot;;</span>
<a href="#l24.11"></a><span id="l24.11"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l24.12"></a><span id="l24.12"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l24.13"></a><span id="l24.13"> </span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-var modalDialog; // Initialized in setupModule</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+Cu.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l24.20"></a><span id="l24.20"> </span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-var hour = 8;</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-var calendar;</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-var uri;</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-var file;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-var title;</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+var helpersForController, invokeEventDialog, switchToView, deleteCalendars;</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+var handleNewCalendarWizard, setData;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+var CANVAS_BOX, EVENT_BOX, TIMEOUT_MODAL_DIALOG;</span>
<a href="#l24.32"></a><span id="l24.32"> </span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-    modalDialog = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+const HOUR = 8;</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+var calendarName, calendarTitle, calendarFile;</span>
<a href="#l24.38"></a><span id="l24.38"> </span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-    // unique name needed as deleting a calendar only unsubscribes from it</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-    // and if same file were used on next testrun then previously created event would show up</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-    let time = (new Date()).getTime() + &quot;&quot;;</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-    calendar = time;</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-    title = time;</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+    ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+        collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineplus">+    ({</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineplus">+        helpersForController,</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+        switchToView,</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineplus">+        deleteCalendars,</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+        handleNewCalendarWizard,</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineplus">+        setData,</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineplus">+        CANVAS_BOX,</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineplus">+        EVENT_BOX,</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+        TIMEOUT_MODAL_DIALOG</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l24.61"></a><span id="l24.61"> </span>
<a href="#l24.62"></a><span id="l24.62" class="difflineminus">-    file = Services.dirsvc.get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineminus">-    file.append(calendar + &quot;.ics&quot;);</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineminus">-    let fileURI = Services.io.newFileURI(file);</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineminus">-    uri = fileURI.prePath + fileURI.path;</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineminus">-};</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineplus">+    // unique name needed as deleting a calendar only unsubscribes from it and</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineplus">+    // if same file were used on next testrun then previously created event</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineplus">+    // would show up</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+    calendarName = calendarTitle = (new Date()).getTime() + &quot;&quot;;</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+    calendarFile = Services.dirsvc.get(&quot;TmpD&quot;, Ci.nsIFile);</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+    calendarFile.append(calendarName + &quot;.ics&quot;);</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+}</span>
<a href="#l24.74"></a><span id="l24.74"> </span>
<a href="#l24.75"></a><span id="l24.75" class="difflineminus">-var testLocalICS = function() {</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineplus">+function testLocalICS() {</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l24.81"></a><span id="l24.81"> </span>
<a href="#l24.82"></a><span id="l24.82" class="difflineminus">-    modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineplus">+    plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, (wizard) =&gt; {</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineplus">+        handleNewCalendarWizard(wizard, calendarName, { network: { format: &quot;ics&quot; } });</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineplus">+    });</span>
<a href="#l24.86"></a><span id="l24.86">     controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineminus">-    modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineplus">+    wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l24.89"></a><span id="l24.89"> </span>
<a href="#l24.90"></a><span id="l24.90">     // create new event</span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l24.93"></a><span id="l24.93" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l24.94"></a><span id="l24.94" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineminus">-      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineminus">-</span>
<a href="#l24.97"></a><span id="l24.97" class="difflineminus">-    // let the iframe load</span>
<a href="#l24.98"></a><span id="l24.98" class="difflineminus">-    let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l24.99"></a><span id="l24.99" class="difflineminus">-    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l24.100"></a><span id="l24.100" class="difflineplus">+    let box = lookupEventBox(&quot;day&quot;, CANVAS_BOX, undefined, 1, HOUR);</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineplus">+    invokeEventDialog(controller, box, (event, iframe) =&gt; {</span>
<a href="#l24.102"></a><span id="l24.102" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l24.103"></a><span id="l24.103"> </span>
<a href="#l24.104"></a><span id="l24.104" class="difflineminus">-    // title</span>
<a href="#l24.105"></a><span id="l24.105" class="difflineminus">-    let titleTextBox = new elementslib.Lookup(iframe.contentDocument, '/id(&quot;calendar-event-dialog-inner&quot;)/' +</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineminus">-      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-title-row&quot;)/' +</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineminus">-      'id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineminus">-    event.waitForElement(titleTextBox);</span>
<a href="#l24.109"></a><span id="l24.109" class="difflineminus">-    event.type(titleTextBox, title);</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineplus">+        setData(event, iframe, { title: calendarTitle, calendar: calendarName });</span>
<a href="#l24.111"></a><span id="l24.111"> </span>
<a href="#l24.112"></a><span id="l24.112" class="difflineminus">-    // set calendar</span>
<a href="#l24.113"></a><span id="l24.113" class="difflineminus">-    let itemCalendar = new elementslib.ID(event.window.document, &quot;item-calendar&quot;);</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineminus">-    event.select(itemCalendar, undefined, calendar);</span>
<a href="#l24.115"></a><span id="l24.115" class="difflineminus">-    // HACK - Wait for the value to be selected. This is needed for platforms</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-    // like mac where selecting the menuitem is an asynchronous process, it might</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineminus">-    // be fixed in a later version of mozmill.</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineminus">-    event.waitFor(() =&gt; itemCalendar.getNode().value == calendar);</span>
<a href="#l24.119"></a><span id="l24.119" class="difflineminus">-</span>
<a href="#l24.120"></a><span id="l24.120" class="difflineminus">-    // save</span>
<a href="#l24.121"></a><span id="l24.121" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineplus">+        // save</span>
<a href="#l24.123"></a><span id="l24.123" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineplus">+    });</span>
<a href="#l24.125"></a><span id="l24.125"> </span>
<a href="#l24.126"></a><span id="l24.126">     // assert presence in view</span>
<a href="#l24.127"></a><span id="l24.127" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l24.128"></a><span id="l24.128" class="difflineminus">-      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar + '&quot;}';</span>
<a href="#l24.129"></a><span id="l24.129" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l24.130"></a><span id="l24.130" class="difflineplus">+    let eventPath = `/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${calendarName}&quot;}`;</span>
<a href="#l24.131"></a><span id="l24.131" class="difflineplus">+    controller.waitForElement(lookupEventBox(&quot;day&quot;, EVENT_BOX, null, 1, HOUR, eventPath));</span>
<a href="#l24.132"></a><span id="l24.132"> </span>
<a href="#l24.133"></a><span id="l24.133">     // verify in file</span>
<a href="#l24.134"></a><span id="l24.134">     let fstream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l24.135"></a><span id="l24.135">                             .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l24.136"></a><span id="l24.136">     let cstream = Components.classes[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l24.137"></a><span id="l24.137">                             .createInstance(Components.interfaces.nsIConverterInputStream);</span>
<a href="#l24.138"></a><span id="l24.138"> </span>
<a href="#l24.139"></a><span id="l24.139">     // wait a moment until file is written</span>
<a href="#l24.140"></a><span id="l24.140" class="difflineminus">-    let i = 0;</span>
<a href="#l24.141"></a><span id="l24.141" class="difflineminus">-    while (!file.exists() &amp;&amp; i &lt; 10) {</span>
<a href="#l24.142"></a><span id="l24.142" class="difflineminus">-        controller.sleep(sleep);</span>
<a href="#l24.143"></a><span id="l24.143" class="difflineminus">-        i++;</span>
<a href="#l24.144"></a><span id="l24.144" class="difflineminus">-    }</span>
<a href="#l24.145"></a><span id="l24.145" class="difflineplus">+    controller.waitFor(() =&gt; calendarFile.exists());</span>
<a href="#l24.146"></a><span id="l24.146"> </span>
<a href="#l24.147"></a><span id="l24.147" class="difflineminus">-    fstream.init(file, -1, 0, 0);</span>
<a href="#l24.148"></a><span id="l24.148" class="difflineplus">+    // read the calendar file and check for the summary</span>
<a href="#l24.149"></a><span id="l24.149" class="difflineplus">+    fstream.init(calendarFile, -1, 0, 0);</span>
<a href="#l24.150"></a><span id="l24.150">     cstream.init(fstream, &quot;UTF-8&quot;, 0, 0);</span>
<a href="#l24.151"></a><span id="l24.151"> </span>
<a href="#l24.152"></a><span id="l24.152">     let str = {};</span>
<a href="#l24.153"></a><span id="l24.153">     cstream.readString(-1, str);</span>
<a href="#l24.154"></a><span id="l24.154">     cstream.close();</span>
<a href="#l24.155"></a><span id="l24.155"> </span>
<a href="#l24.156"></a><span id="l24.156" class="difflineminus">-    controller.assertJS(str.value.includes(&quot;SUMMARY:&quot; + title));</span>
<a href="#l24.157"></a><span id="l24.157" class="difflineminus">-};</span>
<a href="#l24.158"></a><span id="l24.158" class="difflineminus">-</span>
<a href="#l24.159"></a><span id="l24.159" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l24.160"></a><span id="l24.160" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l24.161"></a><span id="l24.161" class="difflineminus">-};</span>
<a href="#l24.162"></a><span id="l24.162" class="difflineminus">-</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineminus">-function handleNewCalendarWizard(wizard) {</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineminus">-    let docEl = wizard.window.document.documentElement;</span>
<a href="#l24.165"></a><span id="l24.165" class="difflineminus">-</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineminus">-    // choose network calendar</span>
<a href="#l24.167"></a><span id="l24.167" class="difflineminus">-    let remoteOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l24.168"></a><span id="l24.168" class="difflineminus">-      '{&quot;pageid&quot;:&quot;initialPage&quot;}/id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}');</span>
<a href="#l24.169"></a><span id="l24.169" class="difflineminus">-    wizard.waitForElement(remoteOption);</span>
<a href="#l24.170"></a><span id="l24.170" class="difflineminus">-    wizard.radio(remoteOption);</span>
<a href="#l24.171"></a><span id="l24.171" class="difflineminus">-    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l24.172"></a><span id="l24.172" class="difflineplus">+    controller.assertJS(str.value.includes(&quot;SUMMARY:&quot; + calendarTitle));</span>
<a href="#l24.173"></a><span id="l24.173" class="difflineplus">+}</span>
<a href="#l24.174"></a><span id="l24.174"> </span>
<a href="#l24.175"></a><span id="l24.175" class="difflineminus">-    // choose ical</span>
<a href="#l24.176"></a><span id="l24.176" class="difflineminus">-    let icalOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l24.177"></a><span id="l24.177" class="difflineminus">-      '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/id(&quot;calendar-format&quot;)/{&quot;value&quot;:&quot;ics&quot;}');</span>
<a href="#l24.178"></a><span id="l24.178" class="difflineminus">-    wizard.waitForElement(icalOption);</span>
<a href="#l24.179"></a><span id="l24.179" class="difflineminus">-    wizard.radio(icalOption);</span>
<a href="#l24.180"></a><span id="l24.180" class="difflineminus">-    // enter location</span>
<a href="#l24.181"></a><span id="l24.181" class="difflineminus">-    wizard.type(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l24.182"></a><span id="l24.182" class="difflineminus">-      '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/' +</span>
<a href="#l24.183"></a><span id="l24.183" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l24.184"></a><span id="l24.184" class="difflineminus">-      uri);</span>
<a href="#l24.185"></a><span id="l24.185" class="difflineminus">-    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineminus">-</span>
<a href="#l24.187"></a><span id="l24.187" class="difflineminus">-    // name is filled in automatically using filename</span>
<a href="#l24.188"></a><span id="l24.188" class="difflineminus">-    wizard.waitFor(() =&gt; docEl.getButton(&quot;next&quot;).disabled == false);</span>
<a href="#l24.189"></a><span id="l24.189" class="difflineminus">-    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l24.190"></a><span id="l24.190" class="difflineminus">-</span>
<a href="#l24.191"></a><span id="l24.191" class="difflineminus">-    // finish</span>
<a href="#l24.192"></a><span id="l24.192" class="difflineminus">-    docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l24.193"></a><span id="l24.193" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l24.194"></a><span id="l24.194" class="difflineplus">+    deleteCalendars(controller, calendarName);</span>
<a href="#l24.195"></a><span id="l24.195"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">old mode 100644</span>
<a href="#l25.2"></a><span id="l25.2">new mode 100755</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineminus">--- a/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineplus">+++ b/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineat">@@ -1,253 +1,292 @@</span>
<a href="#l25.6"></a><span id="l25.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l25.7"></a><span id="l25.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l25.8"></a><span id="l25.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10" class="difflineminus">-</span>
<a href="#l25.11"></a><span id="l25.11"> var MODULE_NAME = &quot;testTodayPane&quot;;</span>
<a href="#l25.12"></a><span id="l25.12"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l25.13"></a><span id="l25.13"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-var WAIT_FOR_WINDOW_TIMEOUT = 500;</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-var MOZMILL_CALENDAR = &quot;Mozmill&quot;;</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+var CALENDARNAME;</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineplus">+Cu.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+function setupModule(module) {</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+    ({</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineplus">+        helpersForController,</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+        createCalendar,</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+        deleteCalendars,</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineplus">+        CALENDARNAME</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l25.35"></a><span id="l25.35"> </span>
<a href="#l25.36"></a><span id="l25.36" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineminus">-    calUtils.createCalendar(controller, MOZMILL_CALENDAR);</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-};</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+}</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-var testTodayPane = function() {</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineplus">+function testTodayPane() {</span>
<a href="#l25.45"></a><span id="l25.45">     // paths</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-    let panels = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/';</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-    let miniMonth = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/';</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-    let dayView = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/' +</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-      'id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-    let dayPath = dayView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/' +</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-    let eventName = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/' +</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+    let panels = `</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+        id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineplus">+    `;</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineplus">+    let miniMonth = `</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineplus">+        ${panels}/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineplus">+        id(&quot;minimonth-pane&quot;)</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineplus">+    `;</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineplus">+    let dayView = `</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineplus">+        ${panels}/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+        id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+    `;</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+    let dayPath = `</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineplus">+    `;</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineplus">+    let eventName = `</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineplus">+        id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineplus">+        id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+    `;</span>
<a href="#l25.79"></a><span id="l25.79"> </span>
<a href="#l25.80"></a><span id="l25.80">     // open calendar view</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l25.82"></a><span id="l25.82" class="difflineminus">-    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineplus">+    controller.waitThenClick(eid(&quot;calendar-day-view-button&quot;));</span>
<a href="#l25.85"></a><span id="l25.85"> </span>
<a href="#l25.86"></a><span id="l25.86">     // go to today and verify date</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineminus">-      '{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/' +</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;today-button&quot;})'));</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineminus">-    let dayNode = (new elementslib.Lookup(controller.window.document, dayPath)).getNode();</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineminus">-    controller.assertJS(dayNode.mDate.icalString == getIsoDate());</span>
<a href="#l25.92"></a><span id="l25.92" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l25.93"></a><span id="l25.93" class="difflineplus">+        ${miniMonth}/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;today-button&quot;})</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineplus">+    `));</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+    controller.assertJS(lookup(dayPath).getNode().mDate.icalString == getIsoDate());</span>
<a href="#l25.97"></a><span id="l25.97"> </span>
<a href="#l25.98"></a><span id="l25.98" class="difflineminus">-    // create event 6 hours from now, if this is tomorrow then at 23 today</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineminus">-    // doubleclick only triggers new event dialog on visible boxes, so scrolling may be needed</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineminus">-    // by default visible time is 08:00 - 17:00, box of 17th hour is out of view</span>
<a href="#l25.101"></a><span id="l25.101" class="difflineplus">+    // Create event 6 hours from now, if this is tomorrow then at 23 today.</span>
<a href="#l25.102"></a><span id="l25.102" class="difflineplus">+    // Doubleclick only triggers new event dialog on visible boxes, so scrolling</span>
<a href="#l25.103"></a><span id="l25.103" class="difflineplus">+    // may be needed by default visible time is 08:00 - 17:00, box of 17th hour</span>
<a href="#l25.104"></a><span id="l25.104" class="difflineplus">+    // is out of view</span>
<a href="#l25.105"></a><span id="l25.105">     let hour = (new Date()).getHours();</span>
<a href="#l25.106"></a><span id="l25.106">     let startHour = (hour &lt; 18 ? hour + 6 : 23);</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineminus">-    let view = (new elementslib.Lookup(controller.window.document, dayView)).getNode();</span>
<a href="#l25.108"></a><span id="l25.108" class="difflineplus">+    let view = lookup(dayView).getNode();</span>
<a href="#l25.109"></a><span id="l25.109"> </span>
<a href="#l25.110"></a><span id="l25.110">     if (startHour &lt; 8 || startHour &gt; 16) {</span>
<a href="#l25.111"></a><span id="l25.111">         view.scrollToMinute(60 * startHour);</span>
<a href="#l25.112"></a><span id="l25.112">     }</span>
<a href="#l25.113"></a><span id="l25.113"> </span>
<a href="#l25.114"></a><span id="l25.114" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l25.115"></a><span id="l25.115" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + &quot;]&quot;), 1, 1);</span>
<a href="#l25.118"></a><span id="l25.118" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.119"></a><span id="l25.119" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineminus">-    let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineminus">-    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l25.122"></a><span id="l25.122" class="difflineplus">+    invokeEventDialog(controller, lookup(`</span>
<a href="#l25.123"></a><span id="l25.123" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l25.124"></a><span id="l25.124" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[${startHour}]</span>
<a href="#l25.126"></a><span id="l25.126" class="difflineplus">+    `), (event, iframe) =&gt; {</span>
<a href="#l25.127"></a><span id="l25.127" class="difflineplus">+        let { lookup: iframelookup } = helpersForController(iframe);</span>
<a href="#l25.128"></a><span id="l25.128" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l25.129"></a><span id="l25.129"> </span>
<a href="#l25.130"></a><span id="l25.130" class="difflineminus">-    event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l25.131"></a><span id="l25.131" class="difflineminus">-    event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Today's Event&quot;);</span>
<a href="#l25.132"></a><span id="l25.132" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l25.133"></a><span id="l25.133" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l25.134"></a><span id="l25.134" class="difflineplus">+        let eventNameElement = iframelookup(eventName);</span>
<a href="#l25.135"></a><span id="l25.135" class="difflineplus">+        event.waitForElement(eventNameElement);</span>
<a href="#l25.136"></a><span id="l25.136" class="difflineplus">+        event.type(eventNameElement, &quot;Today's Event&quot;);</span>
<a href="#l25.137"></a><span id="l25.137" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l25.138"></a><span id="l25.138" class="difflineplus">+    });</span>
<a href="#l25.139"></a><span id="l25.139"> </span>
<a href="#l25.140"></a><span id="l25.140">     // reset view</span>
<a href="#l25.141"></a><span id="l25.141">     view.scrollToMinute(60 * 8);</span>
<a href="#l25.142"></a><span id="l25.142"> </span>
<a href="#l25.143"></a><span id="l25.143">     // go to tomorrow and add an event</span>
<a href="#l25.144"></a><span id="l25.144" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l25.146"></a><span id="l25.146" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l25.147"></a><span id="l25.147" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l25.148"></a><span id="l25.148" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l25.149"></a><span id="l25.149" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.150"></a><span id="l25.150" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l25.151"></a><span id="l25.151" class="difflineminus">-    iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l25.152"></a><span id="l25.152" class="difflineminus">-    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l25.153"></a><span id="l25.153" class="difflineplus">+    controller.click(eid(&quot;next-view-button&quot;));</span>
<a href="#l25.154"></a><span id="l25.154" class="difflineplus">+    invokeEventDialog(controller, lookup(`</span>
<a href="#l25.155"></a><span id="l25.155" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l25.156"></a><span id="l25.156" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l25.157"></a><span id="l25.157" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]</span>
<a href="#l25.158"></a><span id="l25.158" class="difflineplus">+    `), (event, iframe) =&gt; {</span>
<a href="#l25.159"></a><span id="l25.159" class="difflineplus">+        let { lookup: iframelookup } = helpersForController(iframe);</span>
<a href="#l25.160"></a><span id="l25.160" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l25.161"></a><span id="l25.161"> </span>
<a href="#l25.162"></a><span id="l25.162" class="difflineminus">-    event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l25.163"></a><span id="l25.163" class="difflineminus">-    event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Tomorrow's Event&quot;);</span>
<a href="#l25.164"></a><span id="l25.164" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l25.165"></a><span id="l25.165" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l25.166"></a><span id="l25.166" class="difflineplus">+        let eventNameElement = iframelookup(eventName);</span>
<a href="#l25.167"></a><span id="l25.167" class="difflineplus">+        event.waitForElement(eventNameElement);</span>
<a href="#l25.168"></a><span id="l25.168" class="difflineplus">+        event.type(eventNameElement, &quot;Tomorrow's Event&quot;);</span>
<a href="#l25.169"></a><span id="l25.169" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l25.170"></a><span id="l25.170" class="difflineplus">+    });</span>
<a href="#l25.171"></a><span id="l25.171"> </span>
<a href="#l25.172"></a><span id="l25.172">     // go 5 days forward and add an event</span>
<a href="#l25.173"></a><span id="l25.173">     for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l25.174"></a><span id="l25.174" class="difflineminus">-        controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l25.175"></a><span id="l25.175" class="difflineplus">+        controller.click(eid(&quot;next-view-button&quot;));</span>
<a href="#l25.176"></a><span id="l25.176">     }</span>
<a href="#l25.177"></a><span id="l25.177" class="difflineminus">-    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.178"></a><span id="l25.178" class="difflineplus">+    sleep();</span>
<a href="#l25.179"></a><span id="l25.179"> </span>
<a href="#l25.180"></a><span id="l25.180" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l25.181"></a><span id="l25.181" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l25.182"></a><span id="l25.182" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l25.183"></a><span id="l25.183" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l25.184"></a><span id="l25.184" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.185"></a><span id="l25.185" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l25.186"></a><span id="l25.186" class="difflineminus">-    iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l25.187"></a><span id="l25.187" class="difflineminus">-    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l25.188"></a><span id="l25.188" class="difflineplus">+    invokeEventDialog(controller, lookup(`</span>
<a href="#l25.189"></a><span id="l25.189" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l25.190"></a><span id="l25.190" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l25.191"></a><span id="l25.191" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]</span>
<a href="#l25.192"></a><span id="l25.192" class="difflineplus">+    `), (event, iframe) =&gt; {</span>
<a href="#l25.193"></a><span id="l25.193" class="difflineplus">+        let { lookup: iframelookup } = helpersForController(iframe);</span>
<a href="#l25.194"></a><span id="l25.194" class="difflineplus">+        let { eid: eventid } = helpersForController(event);</span>
<a href="#l25.195"></a><span id="l25.195"> </span>
<a href="#l25.196"></a><span id="l25.196" class="difflineminus">-    event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l25.197"></a><span id="l25.197" class="difflineminus">-    event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Future's Event&quot;);</span>
<a href="#l25.198"></a><span id="l25.198" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l25.199"></a><span id="l25.199" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l25.200"></a><span id="l25.200" class="difflineplus">+        let eventNameElement = iframelookup(eventName);</span>
<a href="#l25.201"></a><span id="l25.201" class="difflineplus">+        event.waitForElement(eventNameElement);</span>
<a href="#l25.202"></a><span id="l25.202" class="difflineplus">+        event.type(eventNameElement, &quot;Future's Event&quot;);</span>
<a href="#l25.203"></a><span id="l25.203" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l25.204"></a><span id="l25.204" class="difflineplus">+    });</span>
<a href="#l25.205"></a><span id="l25.205"> </span>
<a href="#l25.206"></a><span id="l25.206">     // go to mail tab</span>
<a href="#l25.207"></a><span id="l25.207" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l25.208"></a><span id="l25.208" class="difflineminus">-      'id(&quot;navigation-toolbox&quot;)/id(&quot;tabs-toolbar&quot;)/id(&quot;tabcontainer&quot;)/{&quot;first-tab&quot;:&quot;true&quot;,&quot;type&quot;:&quot;folder&quot;}/' +</span>
<a href="#l25.209"></a><span id="l25.209" class="difflineminus">-      'anon({&quot;class&quot;:&quot;tab-stack&quot;})/{&quot;class&quot;:&quot;tab-background&quot;}/{&quot;class&quot;:&quot;tab-background-middle&quot;}'));</span>
<a href="#l25.210"></a><span id="l25.210" class="difflineminus">-    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.211"></a><span id="l25.211" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.212"></a><span id="l25.212" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;navigation-toolbox&quot;)/id(&quot;tabs-toolbar&quot;)/</span>
<a href="#l25.213"></a><span id="l25.213" class="difflineplus">+        id(&quot;tabcontainer&quot;)/{&quot;first-tab&quot;:&quot;true&quot;,&quot;type&quot;:&quot;folder&quot;}/</span>
<a href="#l25.214"></a><span id="l25.214" class="difflineplus">+        anon({&quot;class&quot;:&quot;tab-stack&quot;})/{&quot;class&quot;:&quot;tab-background&quot;}/</span>
<a href="#l25.215"></a><span id="l25.215" class="difflineplus">+        {&quot;class&quot;:&quot;tab-background-middle&quot;}</span>
<a href="#l25.216"></a><span id="l25.216" class="difflineplus">+    `));</span>
<a href="#l25.217"></a><span id="l25.217" class="difflineplus">+    sleep();</span>
<a href="#l25.218"></a><span id="l25.218"> </span>
<a href="#l25.219"></a><span id="l25.219">     // verify today pane open</span>
<a href="#l25.220"></a><span id="l25.220" class="difflineminus">-    controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.221"></a><span id="l25.221" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l25.222"></a><span id="l25.222" class="difflineplus">+    controller.assertNotDOMProperty(lookup(`</span>
<a href="#l25.223"></a><span id="l25.223" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)</span>
<a href="#l25.224"></a><span id="l25.224" class="difflineplus">+    `), &quot;collapsed&quot;);</span>
<a href="#l25.225"></a><span id="l25.225"> </span>
<a href="#l25.226"></a><span id="l25.226">     // verify today pane's date</span>
<a href="#l25.227"></a><span id="l25.227" class="difflineminus">-    controller.assertValue(new elementslib.ID(controller.window.document, &quot;datevalue-label&quot;),</span>
<a href="#l25.228"></a><span id="l25.228" class="difflineminus">-      (new Date()).getDate());</span>
<a href="#l25.229"></a><span id="l25.229" class="difflineplus">+    controller.assertValue(eid(&quot;datevalue-label&quot;), (new Date()).getDate());</span>
<a href="#l25.230"></a><span id="l25.230"> </span>
<a href="#l25.231"></a><span id="l25.231">     // tomorrow and soon are collapsed by default</span>
<a href="#l25.232"></a><span id="l25.232" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l25.233"></a><span id="l25.233" class="difflineminus">-      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l25.234"></a><span id="l25.234" class="difflineminus">-      'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l25.235"></a><span id="l25.235" class="difflineminus">-      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l25.236"></a><span id="l25.236" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l25.237"></a><span id="l25.237" class="difflineminus">-      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l25.238"></a><span id="l25.238" class="difflineminus">-      'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l25.239"></a><span id="l25.239" class="difflineminus">-      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l25.240"></a><span id="l25.240" class="difflineminus">-    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.241"></a><span id="l25.241" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.242"></a><span id="l25.242" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.243"></a><span id="l25.243" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/[3]/id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/</span>
<a href="#l25.244"></a><span id="l25.244" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/anon({&quot;class&quot;:&quot;checkbox-check&quot;})</span>
<a href="#l25.245"></a><span id="l25.245" class="difflineplus">+    `));</span>
<a href="#l25.246"></a><span id="l25.246" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.247"></a><span id="l25.247" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.248"></a><span id="l25.248" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/[3]/id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/</span>
<a href="#l25.249"></a><span id="l25.249" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/anon({&quot;class&quot;:&quot;checkbox-check&quot;})</span>
<a href="#l25.250"></a><span id="l25.250" class="difflineplus">+    `));</span>
<a href="#l25.251"></a><span id="l25.251" class="difflineplus">+    sleep();</span>
<a href="#l25.252"></a><span id="l25.252"> </span>
<a href="#l25.253"></a><span id="l25.253">     // verify events shown in today pane</span>
<a href="#l25.254"></a><span id="l25.254">     let now = new Date();</span>
<a href="#l25.255"></a><span id="l25.255">     now.setHours(startHour);</span>
<a href="#l25.256"></a><span id="l25.256">     now.setMinutes(0);</span>
<a href="#l25.257"></a><span id="l25.257">     let dtz = cal.calendarDefaultTimezone();</span>
<a href="#l25.258"></a><span id="l25.258">     let probeDate = cal.jsDateToDateTime(now, dtz);</span>
<a href="#l25.259"></a><span id="l25.259" class="difflineminus">-    let dateFormatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l25.260"></a><span id="l25.260" class="difflineminus">-                                  .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l25.261"></a><span id="l25.261" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l25.262"></a><span id="l25.262">     let startTime = dateFormatter.formatTime(probeDate);</span>
<a href="#l25.263"></a><span id="l25.263" class="difflineminus">-    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.264"></a><span id="l25.264" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.265"></a><span id="l25.265" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l25.266"></a><span id="l25.266" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l25.267"></a><span id="l25.267" class="difflineminus">-      startTime + &quot; Today's Event&quot;);</span>
<a href="#l25.268"></a><span id="l25.268" class="difflineplus">+    controller.assertText(lookup(`</span>
<a href="#l25.269"></a><span id="l25.269" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.270"></a><span id="l25.270" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/</span>
<a href="#l25.271"></a><span id="l25.271" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/</span>
<a href="#l25.272"></a><span id="l25.272" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/</span>
<a href="#l25.273"></a><span id="l25.273" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/</span>
<a href="#l25.274"></a><span id="l25.274" class="difflineplus">+    `), startTime + &quot; Today's Event&quot;);</span>
<a href="#l25.275"></a><span id="l25.275"> </span>
<a href="#l25.276"></a><span id="l25.276">     let tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 9, 0);</span>
<a href="#l25.277"></a><span id="l25.277">     probeDate = cal.jsDateToDateTime(tomorrow, dtz);</span>
<a href="#l25.278"></a><span id="l25.278">     startTime = dateFormatter.formatTime(probeDate);</span>
<a href="#l25.279"></a><span id="l25.279" class="difflineminus">-    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.280"></a><span id="l25.280" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.281"></a><span id="l25.281" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l25.282"></a><span id="l25.282" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l25.283"></a><span id="l25.283" class="difflineminus">-      startTime + &quot; Tomorrow's Event&quot;);</span>
<a href="#l25.284"></a><span id="l25.284" class="difflineplus">+    controller.assertText(lookup(`</span>
<a href="#l25.285"></a><span id="l25.285" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.286"></a><span id="l25.286" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]/</span>
<a href="#l25.287"></a><span id="l25.287" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/</span>
<a href="#l25.288"></a><span id="l25.288" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/</span>
<a href="#l25.289"></a><span id="l25.289" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/</span>
<a href="#l25.290"></a><span id="l25.290" class="difflineplus">+    `), startTime + &quot; Tomorrow's Event&quot;);</span>
<a href="#l25.291"></a><span id="l25.291"> </span>
<a href="#l25.292"></a><span id="l25.292">     let future = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 6, 9, 0);</span>
<a href="#l25.293"></a><span id="l25.293">     probeDate = cal.jsDateToDateTime(future, dtz);</span>
<a href="#l25.294"></a><span id="l25.294">     startTime = dateFormatter.formatDateTime(probeDate);</span>
<a href="#l25.295"></a><span id="l25.295"> </span>
<a href="#l25.296"></a><span id="l25.296">     // Future event's start time</span>
<a href="#l25.297"></a><span id="l25.297" class="difflineminus">-    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.298"></a><span id="l25.298" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.299"></a><span id="l25.299" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l25.300"></a><span id="l25.300" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l25.301"></a><span id="l25.301" class="difflineminus">-      startTime);</span>
<a href="#l25.302"></a><span id="l25.302" class="difflineplus">+    controller.assertText(lookup(`</span>
<a href="#l25.303"></a><span id="l25.303" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.304"></a><span id="l25.304" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/</span>
<a href="#l25.305"></a><span id="l25.305" class="difflineplus">+        {&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/</span>
<a href="#l25.306"></a><span id="l25.306" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})</span>
<a href="#l25.307"></a><span id="l25.307" class="difflineplus">+     `), startTime);</span>
<a href="#l25.308"></a><span id="l25.308"> </span>
<a href="#l25.309"></a><span id="l25.309">     // Future event's title</span>
<a href="#l25.310"></a><span id="l25.310" class="difflineminus">-    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.311"></a><span id="l25.311" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.312"></a><span id="l25.312" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l25.313"></a><span id="l25.313" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/anon({&quot;anonid&quot;:&quot;agenda-event-title&quot;})/'),</span>
<a href="#l25.314"></a><span id="l25.314" class="difflineminus">-      &quot;Future's Event&quot;);</span>
<a href="#l25.315"></a><span id="l25.315" class="difflineplus">+    controller.assertText(lookup(`</span>
<a href="#l25.316"></a><span id="l25.316" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/</span>
<a href="#l25.317"></a><span id="l25.317" class="difflineplus">+        id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/</span>
<a href="#l25.318"></a><span id="l25.318" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/</span>
<a href="#l25.319"></a><span id="l25.319" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/</span>
<a href="#l25.320"></a><span id="l25.320" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-event-title&quot;})</span>
<a href="#l25.321"></a><span id="l25.321" class="difflineplus">+    `), &quot;Future's Event&quot;);</span>
<a href="#l25.322"></a><span id="l25.322"> </span>
<a href="#l25.323"></a><span id="l25.323">     // delete events</span>
<a href="#l25.324"></a><span id="l25.324" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.325"></a><span id="l25.325" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.326"></a><span id="l25.326" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]'));</span>
<a href="#l25.327"></a><span id="l25.327" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l25.328"></a><span id="l25.328" class="difflineminus">-      &quot;VK_DELETE&quot;,</span>
<a href="#l25.329"></a><span id="l25.329" class="difflineminus">-      {});</span>
<a href="#l25.330"></a><span id="l25.330" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.331"></a><span id="l25.331" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.332"></a><span id="l25.332" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]'));</span>
<a href="#l25.333"></a><span id="l25.333" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.334"></a><span id="l25.334" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.335"></a><span id="l25.335" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]</span>
<a href="#l25.336"></a><span id="l25.336" class="difflineplus">+    `));</span>
<a href="#l25.337"></a><span id="l25.337" class="difflineplus">+</span>
<a href="#l25.338"></a><span id="l25.338" class="difflineplus">+    controller.keypress(eid(&quot;agenda-listbox&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l25.339"></a><span id="l25.339" class="difflineplus">+    controller.waitForElementNotPresent(lookup(`</span>
<a href="#l25.340"></a><span id="l25.340" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.341"></a><span id="l25.341" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]</span>
<a href="#l25.342"></a><span id="l25.342" class="difflineplus">+    `));</span>
<a href="#l25.343"></a><span id="l25.343"> </span>
<a href="#l25.344"></a><span id="l25.344" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.345"></a><span id="l25.345" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.346"></a><span id="l25.346" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[3]'));</span>
<a href="#l25.347"></a><span id="l25.347" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l25.348"></a><span id="l25.348" class="difflineminus">-      &quot;VK_DELETE&quot;,</span>
<a href="#l25.349"></a><span id="l25.349" class="difflineminus">-      {});</span>
<a href="#l25.350"></a><span id="l25.350" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.351"></a><span id="l25.351" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.352"></a><span id="l25.352" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[5]'));</span>
<a href="#l25.353"></a><span id="l25.353" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.354"></a><span id="l25.354" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.355"></a><span id="l25.355" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[3]</span>
<a href="#l25.356"></a><span id="l25.356" class="difflineplus">+    `));</span>
<a href="#l25.357"></a><span id="l25.357" class="difflineplus">+    controller.keypress(eid(&quot;agenda-listbox&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l25.358"></a><span id="l25.358" class="difflineplus">+    controller.waitForElementNotPresent(lookup(`</span>
<a href="#l25.359"></a><span id="l25.359" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.360"></a><span id="l25.360" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[5]</span>
<a href="#l25.361"></a><span id="l25.361" class="difflineplus">+    `));</span>
<a href="#l25.362"></a><span id="l25.362"> </span>
<a href="#l25.363"></a><span id="l25.363" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.364"></a><span id="l25.364" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.365"></a><span id="l25.365" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l25.366"></a><span id="l25.366" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l25.367"></a><span id="l25.367" class="difflineminus">-      &quot;VK_DELETE&quot;,</span>
<a href="#l25.368"></a><span id="l25.368" class="difflineminus">-      {});</span>
<a href="#l25.369"></a><span id="l25.369" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.370"></a><span id="l25.370" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.371"></a><span id="l25.371" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l25.372"></a><span id="l25.372" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.373"></a><span id="l25.373" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.374"></a><span id="l25.374" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]</span>
<a href="#l25.375"></a><span id="l25.375" class="difflineplus">+    `));</span>
<a href="#l25.376"></a><span id="l25.376" class="difflineplus">+    controller.keypress(eid(&quot;agenda-listbox&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l25.377"></a><span id="l25.377" class="difflineplus">+    controller.waitForElementNotPresent(lookup(`</span>
<a href="#l25.378"></a><span id="l25.378" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.379"></a><span id="l25.379" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]</span>
<a href="#l25.380"></a><span id="l25.380" class="difflineplus">+    `));</span>
<a href="#l25.381"></a><span id="l25.381"> </span>
<a href="#l25.382"></a><span id="l25.382">     // hide and verify today pane hidden</span>
<a href="#l25.383"></a><span id="l25.383" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l25.384"></a><span id="l25.384" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.385"></a><span id="l25.385" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/{&quot;collapsed&quot;:&quot;true&quot;}'));</span>
<a href="#l25.386"></a><span id="l25.386" class="difflineplus">+    controller.click(eid(&quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l25.387"></a><span id="l25.387" class="difflineplus">+    controller.assertNode(lookup(`</span>
<a href="#l25.388"></a><span id="l25.388" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/{&quot;collapsed&quot;:&quot;true&quot;}</span>
<a href="#l25.389"></a><span id="l25.389" class="difflineplus">+    `));</span>
<a href="#l25.390"></a><span id="l25.390"> </span>
<a href="#l25.391"></a><span id="l25.391">     // reset today pane</span>
<a href="#l25.392"></a><span id="l25.392" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l25.393"></a><span id="l25.393" class="difflineminus">-    controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.394"></a><span id="l25.394" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l25.395"></a><span id="l25.395" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l25.396"></a><span id="l25.396" class="difflineminus">-      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l25.397"></a><span id="l25.397" class="difflineminus">-      'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l25.398"></a><span id="l25.398" class="difflineminus">-      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l25.399"></a><span id="l25.399" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l25.400"></a><span id="l25.400" class="difflineminus">-      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l25.401"></a><span id="l25.401" class="difflineminus">-      'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l25.402"></a><span id="l25.402" class="difflineminus">-      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l25.403"></a><span id="l25.403" class="difflineminus">-    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l25.404"></a><span id="l25.404" class="difflineplus">+    controller.click(eid(&quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l25.405"></a><span id="l25.405" class="difflineplus">+    controller.assertNotDOMProperty(lookup(`</span>
<a href="#l25.406"></a><span id="l25.406" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)</span>
<a href="#l25.407"></a><span id="l25.407" class="difflineplus">+    `), &quot;collapsed&quot;);</span>
<a href="#l25.408"></a><span id="l25.408" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.409"></a><span id="l25.409" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.410"></a><span id="l25.410" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/[3]/id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/</span>
<a href="#l25.411"></a><span id="l25.411" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/anon({&quot;class&quot;:&quot;checkbox-check&quot;})</span>
<a href="#l25.412"></a><span id="l25.412" class="difflineplus">+    `));</span>
<a href="#l25.413"></a><span id="l25.413" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l25.414"></a><span id="l25.414" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.415"></a><span id="l25.415" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/[3]/id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/</span>
<a href="#l25.416"></a><span id="l25.416" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/anon({&quot;class&quot;:&quot;checkbox-check&quot;})</span>
<a href="#l25.417"></a><span id="l25.417" class="difflineplus">+    `));</span>
<a href="#l25.418"></a><span id="l25.418" class="difflineplus">+    sleep();</span>
<a href="#l25.419"></a><span id="l25.419"> </span>
<a href="#l25.420"></a><span id="l25.420">     // verify tomorrow and soon collapsed</span>
<a href="#l25.421"></a><span id="l25.421" class="difflineminus">-    tomorrow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.422"></a><span id="l25.422" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.423"></a><span id="l25.423" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[1]/anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})')).getNode();</span>
<a href="#l25.424"></a><span id="l25.424" class="difflineminus">-    let soon = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l25.425"></a><span id="l25.425" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l25.426"></a><span id="l25.426" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})')).getNode();</span>
<a href="#l25.427"></a><span id="l25.427" class="difflineplus">+    tomorrow = lookup(`</span>
<a href="#l25.428"></a><span id="l25.428" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.429"></a><span id="l25.429" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[1]/</span>
<a href="#l25.430"></a><span id="l25.430" class="difflineplus">+        anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})</span>
<a href="#l25.431"></a><span id="l25.431" class="difflineplus">+    `).getNode();</span>
<a href="#l25.432"></a><span id="l25.432" class="difflineplus">+</span>
<a href="#l25.433"></a><span id="l25.433" class="difflineplus">+    let soon = lookup(`</span>
<a href="#l25.434"></a><span id="l25.434" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/</span>
<a href="#l25.435"></a><span id="l25.435" class="difflineplus">+        [1]/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/</span>
<a href="#l25.436"></a><span id="l25.436" class="difflineplus">+        anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})</span>
<a href="#l25.437"></a><span id="l25.437" class="difflineplus">+    `).getNode();</span>
<a href="#l25.438"></a><span id="l25.438" class="difflineplus">+</span>
<a href="#l25.439"></a><span id="l25.439">     // TODO This is failing, which might actually be an error in our code!</span>
<a href="#l25.440"></a><span id="l25.440">     //  controller.assertJS(!tomorrow.hasAttribute(&quot;checked&quot;)</span>
<a href="#l25.441"></a><span id="l25.441">     //    || tomorrow.getAttribute(&quot;checked&quot;) != &quot;true&quot;);</span>
<a href="#l25.442"></a><span id="l25.442" class="difflineminus">-    controller.assertJS(!soon.hasAttribute(&quot;checked&quot;) ||</span>
<a href="#l25.443"></a><span id="l25.443" class="difflineminus">-      soon.getAttribute(&quot;checked&quot;) != &quot;true&quot;);</span>
<a href="#l25.444"></a><span id="l25.444" class="difflineminus">-};</span>
<a href="#l25.445"></a><span id="l25.445" class="difflineplus">+    controller.assertJS(</span>
<a href="#l25.446"></a><span id="l25.446" class="difflineplus">+        !soon.hasAttribute(&quot;checked&quot;) ||</span>
<a href="#l25.447"></a><span id="l25.447" class="difflineplus">+        soon.getAttribute(&quot;checked&quot;) != &quot;true&quot;</span>
<a href="#l25.448"></a><span id="l25.448" class="difflineplus">+    );</span>
<a href="#l25.449"></a><span id="l25.449" class="difflineplus">+}</span>
<a href="#l25.450"></a><span id="l25.450"> </span>
<a href="#l25.451"></a><span id="l25.451" class="difflineminus">-var getIsoDate = function() {</span>
<a href="#l25.452"></a><span id="l25.452" class="difflineminus">-    let date = new Date();</span>
<a href="#l25.453"></a><span id="l25.453" class="difflineminus">-    let year = date.getFullYear();</span>
<a href="#l25.454"></a><span id="l25.454" class="difflineminus">-    let month = (date.getMonth() &lt; 9 ? &quot;0&quot; + (date.getMonth() + 1) : date.getMonth() + 1);</span>
<a href="#l25.455"></a><span id="l25.455" class="difflineminus">-    let day = (date.getDate() &lt; 10 ? &quot;0&quot; + date.getDate() : date.getDate());</span>
<a href="#l25.456"></a><span id="l25.456" class="difflineminus">-    let isoDate = year + &quot;&quot; + month + &quot;&quot; + day;</span>
<a href="#l25.457"></a><span id="l25.457" class="difflineminus">-    return isoDate;</span>
<a href="#l25.458"></a><span id="l25.458" class="difflineminus">-};</span>
<a href="#l25.459"></a><span id="l25.459" class="difflineplus">+function getIsoDate() {</span>
<a href="#l25.460"></a><span id="l25.460" class="difflineplus">+    let currDate = new Date();</span>
<a href="#l25.461"></a><span id="l25.461" class="difflineplus">+    return `${currDate.getFullYear()}${currDate.getMonth() + 1}${currDate.getDate()}`;</span>
<a href="#l25.462"></a><span id="l25.462" class="difflineplus">+}</span>
<a href="#l25.463"></a><span id="l25.463"> </span>
<a href="#l25.464"></a><span id="l25.464" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l25.465"></a><span id="l25.465" class="difflineminus">-    calUtils.deleteCalendars(controller, MOZMILL_CALENDAR);</span>
<a href="#l25.466"></a><span id="l25.466" class="difflineminus">-};</span>
<a href="#l25.467"></a><span id="l25.467" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l25.468"></a><span id="l25.468" class="difflineplus">+    deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l25.469"></a><span id="l25.469" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">old mode 100644</span>
<a href="#l26.2"></a><span id="l26.2">new mode 100755</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineat">@@ -1,17 +1,22 @@</span>
<a href="#l26.6"></a><span id="l26.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.7"></a><span id="l26.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.8"></a><span id="l26.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l26.14"></a><span id="l26.14"> </span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+var createCalendar, CALENDARNAME;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+var switchAppTimezone;</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+function setupModule(module) {</span>
<a href="#l26.21"></a><span id="l26.21">     controller = mozmill.getMail3PaneController();</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineminus">-};</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+    ({ createCalendar, CALENDARNAME } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l26.26"></a><span id="l26.26" class="difflineplus">+    ({ switchAppTimezone } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineplus">+}</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-var testTimezones1_SetGMT = function() {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-    timezoneUtils.switchAppTimezone(&quot;Europe/London&quot;);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-};</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+function testTimezones1_SetGMT() {</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineplus">+    switchAppTimezone(&quot;Europe/London&quot;);</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">old mode 100644</span>
<a href="#l27.2"></a><span id="l27.2">new mode 100755</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineat">@@ -1,40 +1,48 @@</span>
<a href="#l27.6"></a><span id="l27.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.7"></a><span id="l27.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.8"></a><span id="l27.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineminus">-var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+var helpersForController, switchToView, goToDate, deleteCalendars, CALENDARNAME;</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+var verify, DATES, TIMEZONES;</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+var { preferences } = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+</span>
<a href="#l27.26"></a><span id="l27.26"> /* rows - dates</span>
<a href="#l27.27"></a><span id="l27.27">    columns - correct time for each event */</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineminus">-var times = [[[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineminus">-             [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineminus">-             [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-             [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">-             [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">-             [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-             [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-             [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]];</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">-};</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineplus">+var times = [</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineplus">+    [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineplus">+    [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineplus">+    [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineplus">+    [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineplus">+    [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineplus">+    [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineplus">+    [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineplus">+    [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineplus">+];</span>
<a href="#l27.50"></a><span id="l27.50"> </span>
<a href="#l27.51"></a><span id="l27.51" class="difflineminus">-var testTimezones10_checkAdelaide = function() {</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineplus">+function setupModule(module) {</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineplus">+    ({ helpersForController, switchToView, goToDate, deleteCalendars, CALENDARNAME } =</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l27.61"></a><span id="l27.61" class="difflineplus">+</span>
<a href="#l27.62"></a><span id="l27.62" class="difflineplus">+    ({ verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l27.63"></a><span id="l27.63" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l27.64"></a><span id="l27.64" class="difflineplus">+}</span>
<a href="#l27.65"></a><span id="l27.65"> </span>
<a href="#l27.66"></a><span id="l27.66" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l27.67"></a><span id="l27.67" class="difflineminus">-};</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineplus">+function testTimezones10_checkAdelaide() {</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l27.71"></a><span id="l27.71" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l27.72"></a><span id="l27.72"> </span>
<a href="#l27.73"></a><span id="l27.73" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineminus">-    prefs.preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-};</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineplus">+    verify(controller, dates, DATES, TIMEZONES, times);</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineplus">+}</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineplus">+</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+    preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1">old mode 100644</span>
<a href="#l28.2"></a><span id="l28.2">new mode 100755</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l28.4"></a><span id="l28.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l28.5"></a><span id="l28.5" class="difflineat">@@ -1,73 +1,89 @@</span>
<a href="#l28.6"></a><span id="l28.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l28.7"></a><span id="l28.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l28.8"></a><span id="l28.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.9"></a><span id="l28.9"> </span>
<a href="#l28.10"></a><span id="l28.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l28.11"></a><span id="l28.11" class="difflineminus">-var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-var sleep = 500;</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+var helpersForController, invokeEventDialog, switchToView, goToDate, setData;</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+var CANVAS_BOX;</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+var switchAppTimezone, TIMEZONES;</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineplus">+var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineplus">+</span>
<a href="#l28.25"></a><span id="l28.25"> var times = [[4, 30], [4, 30], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-var gTimezone;</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+function setupModule(module) {</span>
<a href="#l28.30"></a><span id="l28.30">     controller = mozmill.getMail3PaneController();</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-};</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+    ({</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+        helpersForController,</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+        switchToView,</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineplus">+        goToDate,</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+        setData,</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+        CANVAS_BOX</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+    ({ switchAppTimezone, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+}</span>
<a href="#l28.45"></a><span id="l28.45"> </span>
<a href="#l28.46"></a><span id="l28.46" class="difflineminus">-var testTimezones2_CreateEvents = function() {</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineplus">+function testTimezones2_CreateEvents() {</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l28.54"></a><span id="l28.54"> </span>
<a href="#l28.55"></a><span id="l28.55" class="difflineminus">-    // create daily recurring events in all timezones</span>
<a href="#l28.56"></a><span id="l28.56" class="difflineplus">+    // create daily recurring events in all TIMEZONES</span>
<a href="#l28.57"></a><span id="l28.57">     let time = new Date();</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-    for (let i = 0; i &lt; timezones.length; i++) {</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineminus">-        controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineminus">-          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, i + 8)), 1, 1);</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineminus">-        let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineplus">+    for (let i = 0; i &lt; TIMEZONES.length; i++) {</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineplus">+        let eventBox = lookupEventBox(controller, &quot;day&quot;, CANVAS_BOX, null, 1, i + 8);</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineplus">+        invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+            time.setHours(times[i][0]);</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineplus">+            time.setMinutes(times[i][1]);</span>
<a href="#l28.68"></a><span id="l28.68"> </span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-        time.setHours(times[i][0]);</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineminus">-        time.setMinutes(times[i][1]);</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-        // set timezone</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-        setTimezone(event, timezones[i]);</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineplus">+            // set timezone</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+            setTimezone(event, TIMEZONES[i]);</span>
<a href="#l28.76"></a><span id="l28.76"> </span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-        // set title and repeat</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-        calUtils.setData(event, { title: timezones[i], repeat: &quot;weekly&quot;, starttime: time });</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineplus">+            // set title and repeat</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineplus">+            setData(event, { title: TIMEZONES[i], repeat: &quot;weekly&quot;, starttime: time });</span>
<a href="#l28.81"></a><span id="l28.81"> </span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-        // save</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-        event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineplus">+            // save</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineplus">+            event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineplus">+        });</span>
<a href="#l28.88"></a><span id="l28.88">     }</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineminus">-};</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineplus">+}</span>
<a href="#l28.91"></a><span id="l28.91"> </span>
<a href="#l28.92"></a><span id="l28.92" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[0]);</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineminus">-};</span>
<a href="#l28.95"></a><span id="l28.95" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineplus">+    switchAppTimezone(TIMEZONES[0]);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineplus">+}</span>
<a href="#l28.98"></a><span id="l28.98"> </span>
<a href="#l28.99"></a><span id="l28.99"> function setTimezone(event, timezone) {</span>
<a href="#l28.100"></a><span id="l28.100" class="difflineminus">-    gTimezone = timezone;</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineplus">+    let { eid: eventid } = helpersForController(event);</span>
<a href="#l28.102"></a><span id="l28.102"> </span>
<a href="#l28.103"></a><span id="l28.103">     // for some reason setting checked is needed, no other menuitem with checkbox needs it</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineminus">-    let menuitem = new elementslib.ID(event.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineplus">+    let menuitem = eventid(&quot;options-TIMEZONES-menuitem&quot;);</span>
<a href="#l28.106"></a><span id="l28.106">     event.waitForElement(menuitem);</span>
<a href="#l28.107"></a><span id="l28.107">     menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l28.108"></a><span id="l28.108">     event.click(menuitem);</span>
<a href="#l28.109"></a><span id="l28.109"> </span>
<a href="#l28.110"></a><span id="l28.110">     let modal = new modalDialog.modalDialog(event.window);</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineminus">-    modal.start(eventCallback);</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineminus">-    event.waitForElement(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineplus">+    modal.start(eventCallback.bind(null, timezone));</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineplus">+    event.waitForElement(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineplus">+    event.click(eventid(&quot;timezone-starttime&quot;));</span>
<a href="#l28.117"></a><span id="l28.117"> }</span>
<a href="#l28.118"></a><span id="l28.118"> </span>
<a href="#l28.119"></a><span id="l28.119" class="difflineminus">-function eventCallback(timezone) {</span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-    let item = new elementslib.XPath(timezone.window.document, &quot;/*[name()='dialog']/&quot; +</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-       &quot;*[name()='menulist'][1]/*[name()='menupopup'][1]/*[@value='&quot; + gTimezone + &quot;']&quot;);</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-    timezone.waitForElement(item);</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-    timezone.click(item);</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineminus">-    timezone.click(new elementslib.Lookup(timezone.window.document, '/id(&quot;calendar-event-dialog-timezone&quot;)/' +</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineplus">+function eventCallback(zone, tzcontroller) {</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineplus">+    let { lookup: tzlookup, xpath: tzpath } = helpersForController(tzcontroller);</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineplus">+</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineplus">+    let item = tzpath(`</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineplus">+        /*[name()='dialog']/*[name()='menulist'][1]/*[name()='menupopup'][1]/</span>
<a href="#l28.131"></a><span id="l28.131" class="difflineplus">+        *[@value='${zone}']</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineplus">+    `);</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineplus">+    tzcontroller.waitForElement(item);</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineplus">+    tzcontroller.click(item);</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineplus">+    tzcontroller.click(tzlookup(`</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineplus">+        /id(&quot;calendar-event-dialog-timezone&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineplus">+        {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineplus">+    `));</span>
<a href="#l28.139"></a><span id="l28.139"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">old mode 100644</span>
<a href="#l29.2"></a><span id="l29.2">new mode 100755</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineat">@@ -1,37 +1,47 @@</span>
<a href="#l29.6"></a><span id="l29.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l29.7"></a><span id="l29.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l29.8"></a><span id="l29.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l29.14"></a><span id="l29.14"> </span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineplus">+</span>
<a href="#l29.22"></a><span id="l29.22"> /* rows - dates</span>
<a href="#l29.23"></a><span id="l29.23">    columns - correct time for each event */</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineminus">-var times = [[[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]],</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineminus">-             [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">-             [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-             [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-             [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-             [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-             [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-             [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]]];</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+var times = [</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+    [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]],</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineplus">+    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineplus">+    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineplus">+    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineplus">+    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineplus">+    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+    [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineplus">+    [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]]</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineplus">+];</span>
<a href="#l29.42"></a><span id="l29.42"> </span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l29.45"></a><span id="l29.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-};</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineplus">+</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l29.51"></a><span id="l29.51"> </span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-var testTimezones3_checkStJohns = function() {</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } =</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineplus">+        collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineplus">+}</span>
<a href="#l29.61"></a><span id="l29.61"> </span>
<a href="#l29.62"></a><span id="l29.62" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-};</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineplus">+function testTimezones3_checkStJohns() {</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l29.68"></a><span id="l29.68"> </span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[1]);</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-};</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineplus">+}</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineplus">+</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineplus">+    switchAppTimezone(TIMEZONES[1]);</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">old mode 100644</span>
<a href="#l30.2"></a><span id="l30.2">new mode 100755</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineat">@@ -1,37 +1,46 @@</span>
<a href="#l30.6"></a><span id="l30.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.7"></a><span id="l30.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.8"></a><span id="l30.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l30.14"></a><span id="l30.14"> </span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+</span>
<a href="#l30.22"></a><span id="l30.22"> /* rows - dates</span>
<a href="#l30.23"></a><span id="l30.23">    columns - correct time for each event */</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-var times = [[[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineminus">-             [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineminus">-             [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineminus">-             [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineminus">-             [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineminus">-             [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-             [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-             [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]]];</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+var times = [</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+    [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+    [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+    [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]]</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+];</span>
<a href="#l30.42"></a><span id="l30.42"> </span>
<a href="#l30.43"></a><span id="l30.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l30.45"></a><span id="l30.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineminus">-};</span>
<a href="#l30.47"></a><span id="l30.47"> </span>
<a href="#l30.48"></a><span id="l30.48" class="difflineminus">-var testTimezones4_checkCaracas = function() {</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineplus">+</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineplus">+}</span>
<a href="#l30.60"></a><span id="l30.60"> </span>
<a href="#l30.61"></a><span id="l30.61" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineminus">-};</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineplus">+function testTimezones4_checkCaracas() {</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l30.67"></a><span id="l30.67"> </span>
<a href="#l30.68"></a><span id="l30.68" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[2]);</span>
<a href="#l30.70"></a><span id="l30.70" class="difflineminus">-};</span>
<a href="#l30.71"></a><span id="l30.71" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineplus">+}</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineplus">+</span>
<a href="#l30.74"></a><span id="l30.74" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l30.75"></a><span id="l30.75" class="difflineplus">+    switchAppTimezone(TIMEZONES[2]);</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1">old mode 100644</span>
<a href="#l31.2"></a><span id="l31.2">new mode 100755</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l31.4"></a><span id="l31.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l31.5"></a><span id="l31.5" class="difflineat">@@ -1,37 +1,44 @@</span>
<a href="#l31.6"></a><span id="l31.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l31.7"></a><span id="l31.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l31.8"></a><span id="l31.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l31.11"></a><span id="l31.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+</span>
<a href="#l31.22"></a><span id="l31.22"> /* rows - dates</span>
<a href="#l31.23"></a><span id="l31.23">    columns - correct time for each event */</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-var times = [[[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-             [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]];</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+var times = [</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+    [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineplus">+    [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineplus">+];</span>
<a href="#l31.42"></a><span id="l31.42"> </span>
<a href="#l31.43"></a><span id="l31.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l31.44"></a><span id="l31.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l31.45"></a><span id="l31.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineminus">-};</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineminus">-</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineminus">-var testTimezones5_checkPhoenix = function() {</span>
<a href="#l31.49"></a><span id="l31.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l31.52"></a><span id="l31.52" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineplus">+}</span>
<a href="#l31.59"></a><span id="l31.59"> </span>
<a href="#l31.60"></a><span id="l31.60" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineminus">-};</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineplus">+function testTimezones5_checkPhoenix() {</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l31.66"></a><span id="l31.66"> </span>
<a href="#l31.67"></a><span id="l31.67" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l31.68"></a><span id="l31.68" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[3]);</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineminus">-};</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l31.71"></a><span id="l31.71" class="difflineplus">+}</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineplus">+</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l31.74"></a><span id="l31.74" class="difflineplus">+    switchAppTimezone(TIMEZONES[3]);</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1">old mode 100644</span>
<a href="#l32.2"></a><span id="l32.2">new mode 100755</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l32.4"></a><span id="l32.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l32.5"></a><span id="l32.5" class="difflineat">@@ -1,37 +1,44 @@</span>
<a href="#l32.6"></a><span id="l32.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.7"></a><span id="l32.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.8"></a><span id="l32.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l32.11"></a><span id="l32.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l32.14"></a><span id="l32.14"> </span>
<a href="#l32.15"></a><span id="l32.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineplus">+</span>
<a href="#l32.22"></a><span id="l32.22"> /* rows - dates</span>
<a href="#l32.23"></a><span id="l32.23">    columns - correct time for each event */</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineminus">-var times = [[[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]],</span>
<a href="#l32.25"></a><span id="l32.25" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-             [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-             [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]];</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+var times = [</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+    [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]],</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+    [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+    [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+];</span>
<a href="#l32.42"></a><span id="l32.42"> </span>
<a href="#l32.43"></a><span id="l32.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l32.45"></a><span id="l32.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineminus">-};</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-var testTimezones6_checkLosAngeles = function() {</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+}</span>
<a href="#l32.59"></a><span id="l32.59"> </span>
<a href="#l32.60"></a><span id="l32.60" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineminus">-};</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineplus">+function testTimezones6_checkLosAngeles() {</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l32.66"></a><span id="l32.66"> </span>
<a href="#l32.67"></a><span id="l32.67" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[4]);</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-};</span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l32.71"></a><span id="l32.71" class="difflineplus">+}</span>
<a href="#l32.72"></a><span id="l32.72" class="difflineplus">+</span>
<a href="#l32.73"></a><span id="l32.73" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l32.74"></a><span id="l32.74" class="difflineplus">+    switchAppTimezone(TIMEZONES[4]);</span>
<a href="#l32.75"></a><span id="l32.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">old mode 100644</span>
<a href="#l33.2"></a><span id="l33.2">new mode 100755</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l33.4"></a><span id="l33.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l33.5"></a><span id="l33.5" class="difflineat">@@ -1,37 +1,44 @@</span>
<a href="#l33.6"></a><span id="l33.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l33.7"></a><span id="l33.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l33.8"></a><span id="l33.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l33.9"></a><span id="l33.9"> </span>
<a href="#l33.10"></a><span id="l33.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+</span>
<a href="#l33.22"></a><span id="l33.22"> /* rows - dates</span>
<a href="#l33.23"></a><span id="l33.23">    columns - correct time for each event */</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineminus">-var times = [[[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineminus">-             [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineminus">-             [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineminus">-             [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineminus">-             [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineminus">-             [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">-             [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-             [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]];</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+var times = [</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineplus">+    [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineplus">+    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineplus">+    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineplus">+    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineplus">+    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+    [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineplus">+    [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+];</span>
<a href="#l33.42"></a><span id="l33.42"> </span>
<a href="#l33.43"></a><span id="l33.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l33.45"></a><span id="l33.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineminus">-};</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineminus">-</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineminus">-var testTimezones7_checkBuenosAires = function() {</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l33.53"></a><span id="l33.53" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l33.54"></a><span id="l33.54" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l33.56"></a><span id="l33.56" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l33.57"></a><span id="l33.57" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l33.58"></a><span id="l33.58" class="difflineplus">+}</span>
<a href="#l33.59"></a><span id="l33.59"> </span>
<a href="#l33.60"></a><span id="l33.60" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l33.61"></a><span id="l33.61" class="difflineminus">-};</span>
<a href="#l33.62"></a><span id="l33.62" class="difflineplus">+function testTimezones7_checkBuenosAires() {</span>
<a href="#l33.63"></a><span id="l33.63" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l33.64"></a><span id="l33.64" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l33.65"></a><span id="l33.65" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l33.66"></a><span id="l33.66"> </span>
<a href="#l33.67"></a><span id="l33.67" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l33.68"></a><span id="l33.68" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[5]);</span>
<a href="#l33.69"></a><span id="l33.69" class="difflineminus">-};</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l33.71"></a><span id="l33.71" class="difflineplus">+}</span>
<a href="#l33.72"></a><span id="l33.72" class="difflineplus">+</span>
<a href="#l33.73"></a><span id="l33.73" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+    switchAppTimezone(TIMEZONES[5]);</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">old mode 100644</span>
<a href="#l34.2"></a><span id="l34.2">new mode 100755</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineat">@@ -1,37 +1,44 @@</span>
<a href="#l34.6"></a><span id="l34.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l34.7"></a><span id="l34.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l34.8"></a><span id="l34.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l34.14"></a><span id="l34.14"> </span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineplus">+</span>
<a href="#l34.22"></a><span id="l34.22"> /* rows - dates</span>
<a href="#l34.23"></a><span id="l34.23">    columns - correct time for each event */</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-var times = [[[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineminus">-             [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineminus">-             [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineminus">-             [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineminus">-             [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-             [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-             [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-             [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]];</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+var times = [</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+    [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineplus">+    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineplus">+    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineplus">+    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineplus">+    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineplus">+    [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineplus">+    [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+    [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+];</span>
<a href="#l34.42"></a><span id="l34.42"> </span>
<a href="#l34.43"></a><span id="l34.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l34.45"></a><span id="l34.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineminus">-};</span>
<a href="#l34.47"></a><span id="l34.47" class="difflineminus">-</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-var testTimezones8_checkParis = function() {</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l34.56"></a><span id="l34.56" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineplus">+}</span>
<a href="#l34.59"></a><span id="l34.59"> </span>
<a href="#l34.60"></a><span id="l34.60" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineminus">-};</span>
<a href="#l34.62"></a><span id="l34.62" class="difflineplus">+function testTimezones8_checkParis() {</span>
<a href="#l34.63"></a><span id="l34.63" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l34.64"></a><span id="l34.64" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l34.65"></a><span id="l34.65" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l34.66"></a><span id="l34.66"> </span>
<a href="#l34.67"></a><span id="l34.67" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l34.68"></a><span id="l34.68" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[6]);</span>
<a href="#l34.69"></a><span id="l34.69" class="difflineminus">-};</span>
<a href="#l34.70"></a><span id="l34.70" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l34.71"></a><span id="l34.71" class="difflineplus">+}</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineplus">+</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineplus">+    switchAppTimezone(TIMEZONES[6]);</span>
<a href="#l34.75"></a><span id="l34.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1">old mode 100644</span>
<a href="#l35.2"></a><span id="l35.2">new mode 100755</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l35.4"></a><span id="l35.4" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l35.5"></a><span id="l35.5" class="difflineat">@@ -1,37 +1,44 @@</span>
<a href="#l35.6"></a><span id="l35.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l35.7"></a><span id="l35.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.8"></a><span id="l35.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineminus">-var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;timezone-utils&quot;];</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">-var dates = [[2009, 1, 1], [2009, 4, 2], [2009, 4, 16], [2009, 4, 30],</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">-             [2009, 7, 2], [2009, 10, 15], [2009, 10, 29], [2009, 11, 5]];</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-                 &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+var helpersForController, switchToView, goToDate;</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+var switchAppTimezone, verify, DATES, TIMEZONES;</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+</span>
<a href="#l35.22"></a><span id="l35.22"> /* rows - dates</span>
<a href="#l35.23"></a><span id="l35.23">    columns - correct time for each event */</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">-var times = [[[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">-             [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">-             [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">-             [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">-             [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineminus">-             [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">-             [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-             [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]];</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+var times = [</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+    [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+    [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+    [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+];</span>
<a href="#l35.42"></a><span id="l35.42"> </span>
<a href="#l35.43"></a><span id="l35.43" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+function setupModule(module) {</span>
<a href="#l35.45"></a><span id="l35.45">     controller = mozmill.getMail3PaneController();</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">-};</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">-</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineminus">-var testTimezones9_checkKathmandu = function() {</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+    ({ helpersForController, switchToView, goToDate } =</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+        collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+    ({ switchAppTimezone, verify, DATES, TIMEZONES } = collector.getModule(&quot;timezone-utils&quot;));</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+    collector.getModule(&quot;timezone-utils&quot;).setupModule();</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+}</span>
<a href="#l35.59"></a><span id="l35.59"> </span>
<a href="#l35.60"></a><span id="l35.60" class="difflineminus">-    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineminus">-};</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineplus">+function testTimezones9_checkKathmandu() {</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+    switchToView(controller, &quot;day&quot;);</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+    goToDate(controller, 2009, 1, 1);</span>
<a href="#l35.66"></a><span id="l35.66"> </span>
<a href="#l35.67"></a><span id="l35.67" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineminus">-    timezoneUtils.switchAppTimezone(timezones[7]);</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-};</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineplus">+    verify(controller, DATES, TIMEZONES, times);</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineplus">+}</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineplus">+</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineplus">+    switchAppTimezone(TIMEZONES[7]);</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1">old mode 100644</span>
<a href="#l36.2"></a><span id="l36.2">new mode 100755</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineminus">--- a/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l36.4"></a><span id="l36.4" class="difflineplus">+++ b/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l36.5"></a><span id="l36.5" class="difflineat">@@ -1,145 +1,187 @@</span>
<a href="#l36.6"></a><span id="l36.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l36.7"></a><span id="l36.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l36.8"></a><span id="l36.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l36.9"></a><span id="l36.9"> </span>
<a href="#l36.10"></a><span id="l36.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l36.11"></a><span id="l36.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+var CALENDARNAME;</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineplus">+var TITLE1 = &quot;Day View Event&quot;;</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+var TITLE2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineplus">+var DESC = &quot;Day View Event Description&quot;;</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineminus">-var title1 = &quot;Day View Event&quot;;</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineminus">-var title2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineminus">-var desc = &quot;Day View Event Description&quot;;</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">-</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineplus">+function setupModule(module) {</span>
<a href="#l36.29"></a><span id="l36.29">     controller = mozmill.getMail3PaneController();</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-};</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+    ({</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineplus">+        helpersForController,</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineplus">+        createCalendar,</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineplus">+        deleteCalendars,</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineplus">+        CALENDARNAME</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l36.41"></a><span id="l36.41"> </span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-var testDayView = function() {</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineplus">+}</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineplus">+</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+function testDayView() {</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineplus">+    let dateService = Cc[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineplus">+                        .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l36.51"></a><span id="l36.51">     // paths</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineminus">-    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineminus">-    let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineminus">-    let day = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}');</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineplus">+    let miniMonth = `</span>
<a href="#l36.62"></a><span id="l36.62" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l36.66"></a><span id="l36.66" class="difflineplus">+    `;</span>
<a href="#l36.67"></a><span id="l36.67" class="difflineplus">+    let dayView = `</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineplus">+        id(&quot;day-view&quot;)</span>
<a href="#l36.72"></a><span id="l36.72" class="difflineplus">+    `;</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineplus">+    let day = lookup(`</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/</span>
<a href="#l36.75"></a><span id="l36.75" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineplus">+    `);</span>
<a href="#l36.77"></a><span id="l36.77">     let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l36.78"></a><span id="l36.78"> </span>
<a href="#l36.79"></a><span id="l36.79">     // open day view</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineminus">-    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineplus">+    controller.waitThenClick(eid(&quot;calendar-day-view-button&quot;));</span>
<a href="#l36.84"></a><span id="l36.84"> </span>
<a href="#l36.85"></a><span id="l36.85">     // pick year</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l36.87"></a><span id="l36.87" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l36.90"></a><span id="l36.90" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l36.91"></a><span id="l36.91" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l36.92"></a><span id="l36.92" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l36.93"></a><span id="l36.93" class="difflineplus">+    `));</span>
<a href="#l36.94"></a><span id="l36.94" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l36.95"></a><span id="l36.95" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l36.96"></a><span id="l36.96" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l36.97"></a><span id="l36.97" class="difflineplus">+        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l36.98"></a><span id="l36.98" class="difflineplus">+    `));</span>
<a href="#l36.99"></a><span id="l36.99"> </span>
<a href="#l36.100"></a><span id="l36.100">     // pick month</span>
<a href="#l36.101"></a><span id="l36.101" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l36.103"></a><span id="l36.103" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l36.106"></a><span id="l36.106" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l36.107"></a><span id="l36.107" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l36.109"></a><span id="l36.109" class="difflineplus">+    `));</span>
<a href="#l36.110"></a><span id="l36.110" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l36.111"></a><span id="l36.111" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l36.112"></a><span id="l36.112" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l36.113"></a><span id="l36.113" class="difflineplus">+        {&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l36.114"></a><span id="l36.114" class="difflineplus">+    `));</span>
<a href="#l36.115"></a><span id="l36.115"> </span>
<a href="#l36.116"></a><span id="l36.116">     // pick day</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l36.118"></a><span id="l36.118" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l36.119"></a><span id="l36.119" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l36.120"></a><span id="l36.120" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l36.121"></a><span id="l36.121" class="difflineplus">+    `));</span>
<a href="#l36.122"></a><span id="l36.122"> </span>
<a href="#l36.123"></a><span id="l36.123">     // verify date in view</span>
<a href="#l36.124"></a><span id="l36.124">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l36.125"></a><span id="l36.125"> </span>
<a href="#l36.126"></a><span id="l36.126">     // create event at 8 AM</span>
<a href="#l36.127"></a><span id="l36.127" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l36.128"></a><span id="l36.128" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l36.129"></a><span id="l36.129" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l36.130"></a><span id="l36.130" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l36.131"></a><span id="l36.131" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l36.132"></a><span id="l36.132" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l36.133"></a><span id="l36.133" class="difflineplus">+    let eventBox = lookup(`</span>
<a href="#l36.134"></a><span id="l36.134" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l36.135"></a><span id="l36.135" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l36.136"></a><span id="l36.136" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]')</span>
<a href="#l36.137"></a><span id="l36.137" class="difflineplus">+    `);</span>
<a href="#l36.138"></a><span id="l36.138" class="difflineplus">+</span>
<a href="#l36.139"></a><span id="l36.139" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l36.140"></a><span id="l36.140" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l36.141"></a><span id="l36.141"> </span>
<a href="#l36.142"></a><span id="l36.142" class="difflineminus">-    // check that the start time is correct</span>
<a href="#l36.143"></a><span id="l36.143" class="difflineminus">-    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l36.144"></a><span id="l36.144" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l36.145"></a><span id="l36.145" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l36.146"></a><span id="l36.146" class="difflineminus">-      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l36.147"></a><span id="l36.147" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l36.148"></a><span id="l36.148" class="difflineminus">-    event.waitForElement(startTimeInput);</span>
<a href="#l36.149"></a><span id="l36.149" class="difflineminus">-    event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l36.150"></a><span id="l36.150" class="difflineminus">-    let date = startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l36.151"></a><span id="l36.151" class="difflineminus">-      2009, 1, 1);</span>
<a href="#l36.152"></a><span id="l36.152" class="difflineminus">-    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l36.153"></a><span id="l36.153" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l36.154"></a><span id="l36.154" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l36.155"></a><span id="l36.155" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l36.156"></a><span id="l36.156" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l36.157"></a><span id="l36.157" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l36.158"></a><span id="l36.158" class="difflineminus">-      date);</span>
<a href="#l36.159"></a><span id="l36.159" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l36.160"></a><span id="l36.160" class="difflineplus">+        let startTimeInput = eventlookup(`</span>
<a href="#l36.161"></a><span id="l36.161" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l36.162"></a><span id="l36.162" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l36.163"></a><span id="l36.163" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l36.164"></a><span id="l36.164" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l36.165"></a><span id="l36.165" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l36.166"></a><span id="l36.166" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l36.167"></a><span id="l36.167" class="difflineplus">+        `);</span>
<a href="#l36.168"></a><span id="l36.168" class="difflineplus">+        event.waitForElement(startTimeInput);</span>
<a href="#l36.169"></a><span id="l36.169" class="difflineplus">+        event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l36.170"></a><span id="l36.170" class="difflineplus">+        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l36.171"></a><span id="l36.171" class="difflineplus">+        event.assertValue(eventlookup(`</span>
<a href="#l36.172"></a><span id="l36.172" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l36.173"></a><span id="l36.173" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l36.174"></a><span id="l36.174" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l36.175"></a><span id="l36.175" class="difflineplus">+            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l36.176"></a><span id="l36.176" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l36.177"></a><span id="l36.177" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l36.178"></a><span id="l36.178" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l36.179"></a><span id="l36.179" class="difflineplus">+        `), date);</span>
<a href="#l36.180"></a><span id="l36.180"> </span>
<a href="#l36.181"></a><span id="l36.181" class="difflineminus">-    // fill in title, description and calendar</span>
<a href="#l36.182"></a><span id="l36.182" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l36.183"></a><span id="l36.183" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l36.184"></a><span id="l36.184" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l36.185"></a><span id="l36.185" class="difflineminus">-      title1);</span>
<a href="#l36.186"></a><span id="l36.186" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l36.187"></a><span id="l36.187" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l36.188"></a><span id="l36.188" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l36.189"></a><span id="l36.189" class="difflineminus">-      desc);</span>
<a href="#l36.190"></a><span id="l36.190" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l36.191"></a><span id="l36.191" class="difflineplus">+        // fill in title, description and calendar</span>
<a href="#l36.192"></a><span id="l36.192" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l36.193"></a><span id="l36.193" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l36.194"></a><span id="l36.194" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l36.195"></a><span id="l36.195" class="difflineplus">+        `), TITLE1);</span>
<a href="#l36.196"></a><span id="l36.196" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l36.197"></a><span id="l36.197" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l36.198"></a><span id="l36.198" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l36.199"></a><span id="l36.199" class="difflineplus">+        `), DESC);</span>
<a href="#l36.200"></a><span id="l36.200" class="difflineplus">+        event.select(eventid(&quot;item-calendar&quot;), null, CALENDARNAME);</span>
<a href="#l36.201"></a><span id="l36.201"> </span>
<a href="#l36.202"></a><span id="l36.202" class="difflineminus">-    // save</span>
<a href="#l36.203"></a><span id="l36.203" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l36.204"></a><span id="l36.204" class="difflineplus">+        // save</span>
<a href="#l36.205"></a><span id="l36.205" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l36.206"></a><span id="l36.206" class="difflineplus">+    });</span>
<a href="#l36.207"></a><span id="l36.207"> </span>
<a href="#l36.208"></a><span id="l36.208">     // if it was created successfully, it can be opened</span>
<a href="#l36.209"></a><span id="l36.209" class="difflineminus">-    let eventBox = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l36.210"></a><span id="l36.210" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l36.211"></a><span id="l36.211" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l36.212"></a><span id="l36.212" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[0]/' +</span>
<a href="#l36.213"></a><span id="l36.213" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}');</span>
<a href="#l36.214"></a><span id="l36.214" class="difflineminus">-    controller.waitForElement(eventBox);</span>
<a href="#l36.215"></a><span id="l36.215" class="difflineminus">-    controller.doubleClick(eventBox);</span>
<a href="#l36.216"></a><span id="l36.216" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l36.217"></a><span id="l36.217" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l36.218"></a><span id="l36.218" class="difflineplus">+    eventBox = lookup(`</span>
<a href="#l36.219"></a><span id="l36.219" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l36.220"></a><span id="l36.220" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l36.221"></a><span id="l36.221" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.222"></a><span id="l36.222" class="difflineplus">+        {&quot;flex&quot;:&quot;1&quot;}/[0]/</span>
<a href="#l36.223"></a><span id="l36.223" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l36.224"></a><span id="l36.224" class="difflineplus">+    `);</span>
<a href="#l36.225"></a><span id="l36.225" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l36.226"></a><span id="l36.226" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l36.227"></a><span id="l36.227"> </span>
<a href="#l36.228"></a><span id="l36.228" class="difflineminus">-    // change title and save changes</span>
<a href="#l36.229"></a><span id="l36.229" class="difflineminus">-    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l36.230"></a><span id="l36.230" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l36.231"></a><span id="l36.231" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l36.232"></a><span id="l36.232" class="difflineminus">-    event.waitForElement(titleTextBox);</span>
<a href="#l36.233"></a><span id="l36.233" class="difflineminus">-    event.type(titleTextBox, title2);</span>
<a href="#l36.234"></a><span id="l36.234" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l36.235"></a><span id="l36.235" class="difflineplus">+        // change title and save changes</span>
<a href="#l36.236"></a><span id="l36.236" class="difflineplus">+        let titleTextBox = eventlookup(`</span>
<a href="#l36.237"></a><span id="l36.237" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l36.238"></a><span id="l36.238" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l36.239"></a><span id="l36.239" class="difflineplus">+        `);</span>
<a href="#l36.240"></a><span id="l36.240" class="difflineplus">+        event.waitForElement(titleTextBox);</span>
<a href="#l36.241"></a><span id="l36.241" class="difflineplus">+        event.type(titleTextBox, TITLE2);</span>
<a href="#l36.242"></a><span id="l36.242" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l36.243"></a><span id="l36.243" class="difflineplus">+    });</span>
<a href="#l36.244"></a><span id="l36.244"> </span>
<a href="#l36.245"></a><span id="l36.245">     // check if name was saved</span>
<a href="#l36.246"></a><span id="l36.246" class="difflineminus">-    let eventName = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l36.247"></a><span id="l36.247" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l36.248"></a><span id="l36.248" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l36.249"></a><span id="l36.249" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l36.250"></a><span id="l36.250" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l36.251"></a><span id="l36.251" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l36.252"></a><span id="l36.252" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l36.253"></a><span id="l36.253" class="difflineplus">+    let eventName = lookup(`</span>
<a href="#l36.254"></a><span id="l36.254" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l36.255"></a><span id="l36.255" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l36.256"></a><span id="l36.256" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.257"></a><span id="l36.257" class="difflineplus">+        {&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.258"></a><span id="l36.258" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l36.259"></a><span id="l36.259" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l36.260"></a><span id="l36.260" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l36.261"></a><span id="l36.261" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})</span>
<a href="#l36.262"></a><span id="l36.262" class="difflineplus">+    `);</span>
<a href="#l36.263"></a><span id="l36.263">     controller.waitForElement(eventName);</span>
<a href="#l36.264"></a><span id="l36.264" class="difflineminus">-    controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l36.265"></a><span id="l36.265" class="difflineplus">+    controller.assertJSProperty(eventName, &quot;textContent&quot;, TITLE2);</span>
<a href="#l36.266"></a><span id="l36.266"> </span>
<a href="#l36.267"></a><span id="l36.267">     // delete event</span>
<a href="#l36.268"></a><span id="l36.268" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l36.269"></a><span id="l36.269" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l36.270"></a><span id="l36.270" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l36.271"></a><span id="l36.271" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l36.272"></a><span id="l36.272" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l36.273"></a><span id="l36.273" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l36.274"></a><span id="l36.274" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l36.275"></a><span id="l36.275" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l36.276"></a><span id="l36.276" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l36.277"></a><span id="l36.277" class="difflineminus">-      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l36.278"></a><span id="l36.278" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l36.279"></a><span id="l36.279" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l36.280"></a><span id="l36.280" class="difflineminus">-};</span>
<a href="#l36.281"></a><span id="l36.281" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l36.282"></a><span id="l36.282" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l36.283"></a><span id="l36.283" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l36.284"></a><span id="l36.284" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.285"></a><span id="l36.285" class="difflineplus">+        {&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.286"></a><span id="l36.286" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l36.287"></a><span id="l36.287" class="difflineplus">+    `));</span>
<a href="#l36.288"></a><span id="l36.288" class="difflineplus">+    controller.keypress(eid(&quot;day-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l36.289"></a><span id="l36.289" class="difflineplus">+    controller.waitForElementNotPresent(lookup(`</span>
<a href="#l36.290"></a><span id="l36.290" class="difflineplus">+        ${dayView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l36.291"></a><span id="l36.291" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/</span>
<a href="#l36.292"></a><span id="l36.292" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.293"></a><span id="l36.293" class="difflineplus">+        {&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l36.294"></a><span id="l36.294" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l36.295"></a><span id="l36.295" class="difflineplus">+    `));</span>
<a href="#l36.296"></a><span id="l36.296" class="difflineplus">+}</span>
<a href="#l36.297"></a><span id="l36.297"> </span>
<a href="#l36.298"></a><span id="l36.298" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l36.299"></a><span id="l36.299" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l36.300"></a><span id="l36.300" class="difflineminus">-};</span>
<a href="#l36.301"></a><span id="l36.301" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l36.302"></a><span id="l36.302" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l36.303"></a><span id="l36.303" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1">old mode 100644</span>
<a href="#l37.2"></a><span id="l37.2">new mode 100755</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineminus">--- a/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l37.4"></a><span id="l37.4" class="difflineplus">+++ b/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l37.5"></a><span id="l37.5" class="difflineat">@@ -1,138 +1,176 @@</span>
<a href="#l37.6"></a><span id="l37.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l37.7"></a><span id="l37.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l37.8"></a><span id="l37.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l37.11"></a><span id="l37.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+var CALENDARNAME;</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+var TITLE1 = &quot;Month View Event&quot;;</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineplus">+var TITLE2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineplus">+var DESC = &quot;Month View Event Description&quot;;</span>
<a href="#l37.20"></a><span id="l37.20"> </span>
<a href="#l37.21"></a><span id="l37.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l37.23"></a><span id="l37.23" class="difflineminus">-var title1 = &quot;Month View Event&quot;;</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineminus">-var title2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineminus">-var desc = &quot;Month View Event Description&quot;;</span>
<a href="#l37.26"></a><span id="l37.26" class="difflineplus">+function setupModule(module) {</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+    ({</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+        helpersForController,</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+        createCalendar,</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+        deleteCalendars,</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineplus">+        CALENDARNAME</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l37.37"></a><span id="l37.37"> </span>
<a href="#l37.38"></a><span id="l37.38" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l37.41"></a><span id="l37.41" class="difflineminus">-};</span>
<a href="#l37.42"></a><span id="l37.42" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineplus">+}</span>
<a href="#l37.44"></a><span id="l37.44"> </span>
<a href="#l37.45"></a><span id="l37.45" class="difflineminus">-var testMonthView = function() {</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineplus">+function testMonthView() {</span>
<a href="#l37.47"></a><span id="l37.47">     let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l37.48"></a><span id="l37.48">                                 .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l37.49"></a><span id="l37.49">     // paths</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineminus">-    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineminus">-    let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineplus">+    let miniMonth = `</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineplus">+    `;</span>
<a href="#l37.62"></a><span id="l37.62" class="difflineplus">+    let monthView = `</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineplus">+        id(&quot;month-view&quot;)</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineplus">+    `;</span>
<a href="#l37.68"></a><span id="l37.68">     let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineminus">-    let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/' +</span>
<a href="#l37.71"></a><span id="l37.71" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l37.72"></a><span id="l37.72" class="difflineminus">-      '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l37.74"></a><span id="l37.74" class="difflineplus">+    let eventBox = `</span>
<a href="#l37.75"></a><span id="l37.75" class="difflineplus">+        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l37.76"></a><span id="l37.76" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l37.77"></a><span id="l37.77" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}/</span>
<a href="#l37.78"></a><span id="l37.78" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l37.79"></a><span id="l37.79" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l37.80"></a><span id="l37.80" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}</span>
<a href="#l37.81"></a><span id="l37.81" class="difflineplus">+    `;</span>
<a href="#l37.82"></a><span id="l37.82"> </span>
<a href="#l37.83"></a><span id="l37.83" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l37.84"></a><span id="l37.84" class="difflineminus">-    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l37.85"></a><span id="l37.85" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+    controller.waitThenClick(eid(&quot;calendar-month-view-button&quot;));</span>
<a href="#l37.87"></a><span id="l37.87"> </span>
<a href="#l37.88"></a><span id="l37.88">     // pick year</span>
<a href="#l37.89"></a><span id="l37.89" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l37.90"></a><span id="l37.90" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l37.91"></a><span id="l37.91" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l37.92"></a><span id="l37.92" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l37.93"></a><span id="l37.93" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l37.94"></a><span id="l37.94" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l37.95"></a><span id="l37.95" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l37.96"></a><span id="l37.96" class="difflineplus">+    `));</span>
<a href="#l37.97"></a><span id="l37.97" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l37.98"></a><span id="l37.98" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l37.99"></a><span id="l37.99" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l37.100"></a><span id="l37.100" class="difflineplus">+        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l37.101"></a><span id="l37.101" class="difflineplus">+    `));</span>
<a href="#l37.102"></a><span id="l37.102"> </span>
<a href="#l37.103"></a><span id="l37.103">     // pick month</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l37.105"></a><span id="l37.105" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l37.106"></a><span id="l37.106" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l37.107"></a><span id="l37.107" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l37.108"></a><span id="l37.108" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l37.109"></a><span id="l37.109" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l37.111"></a><span id="l37.111" class="difflineplus">+    `));</span>
<a href="#l37.112"></a><span id="l37.112" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l37.114"></a><span id="l37.114" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l37.115"></a><span id="l37.115" class="difflineplus">+        {&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l37.116"></a><span id="l37.116" class="difflineplus">+    `));</span>
<a href="#l37.117"></a><span id="l37.117"> </span>
<a href="#l37.118"></a><span id="l37.118">     // pick day</span>
<a href="#l37.119"></a><span id="l37.119" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l37.120"></a><span id="l37.120" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l37.121"></a><span id="l37.121" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l37.122"></a><span id="l37.122" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l37.123"></a><span id="l37.123" class="difflineplus">+    `));</span>
<a href="#l37.124"></a><span id="l37.124"> </span>
<a href="#l37.125"></a><span id="l37.125">     // verify date</span>
<a href="#l37.126"></a><span id="l37.126" class="difflineminus">-    let day = new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l37.127"></a><span id="l37.127" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l37.128"></a><span id="l37.128" class="difflineminus">-      '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l37.129"></a><span id="l37.129" class="difflineplus">+    let day = lookup(`</span>
<a href="#l37.130"></a><span id="l37.130" class="difflineplus">+        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l37.131"></a><span id="l37.131" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l37.132"></a><span id="l37.132" class="difflineplus">+    `);</span>
<a href="#l37.133"></a><span id="l37.133">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l37.134"></a><span id="l37.134"> </span>
<a href="#l37.135"></a><span id="l37.135">     // create event</span>
<a href="#l37.136"></a><span id="l37.136">     // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l37.137"></a><span id="l37.137">     let hour = new Date().getHours(); // remember time at click</span>
<a href="#l37.138"></a><span id="l37.138" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l37.139"></a><span id="l37.139" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l37.140"></a><span id="l37.140" class="difflineminus">-      '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l37.141"></a><span id="l37.141" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l37.142"></a><span id="l37.142" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l37.143"></a><span id="l37.143" class="difflineplus">+    eventBox = lookup(`</span>
<a href="#l37.144"></a><span id="l37.144" class="difflineplus">+        ${monthView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l37.145"></a><span id="l37.145" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l37.146"></a><span id="l37.146" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;day-items&quot;})</span>
<a href="#l37.147"></a><span id="l37.147" class="difflineplus">+    `);</span>
<a href="#l37.148"></a><span id="l37.148" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l37.149"></a><span id="l37.149" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l37.150"></a><span id="l37.150" class="difflineplus">+</span>
<a href="#l37.151"></a><span id="l37.151" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l37.152"></a><span id="l37.152" class="difflineplus">+        // next full hour except last hour hour of the day</span>
<a href="#l37.153"></a><span id="l37.153" class="difflineplus">+        let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l37.154"></a><span id="l37.154" class="difflineplus">+        let startTime = nextHour + &quot;:00&quot;; // next full hour</span>
<a href="#l37.155"></a><span id="l37.155" class="difflineplus">+        let startTimeInput = eventlookup(`</span>
<a href="#l37.156"></a><span id="l37.156" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l37.157"></a><span id="l37.157" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l37.158"></a><span id="l37.158" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l37.159"></a><span id="l37.159" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l37.160"></a><span id="l37.160" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l37.161"></a><span id="l37.161" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l37.162"></a><span id="l37.162" class="difflineplus">+        `);</span>
<a href="#l37.163"></a><span id="l37.163" class="difflineplus">+        event.waitForElement(startTimeInput);</span>
<a href="#l37.164"></a><span id="l37.164" class="difflineplus">+        event.assertValue(startTimeInput, startTime);</span>
<a href="#l37.165"></a><span id="l37.165"> </span>
<a href="#l37.166"></a><span id="l37.166" class="difflineminus">-    // check that the start time is correct</span>
<a href="#l37.167"></a><span id="l37.167" class="difflineminus">-    // next full hour except last hour hour of the day</span>
<a href="#l37.168"></a><span id="l37.168" class="difflineminus">-    let nextHour = (hour == 23 ? hour : (hour + 1) % 24);</span>
<a href="#l37.169"></a><span id="l37.169" class="difflineminus">-    let startTime = nextHour + &quot;:00&quot;; // next full hour</span>
<a href="#l37.170"></a><span id="l37.170" class="difflineminus">-    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l37.171"></a><span id="l37.171" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l37.172"></a><span id="l37.172" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l37.173"></a><span id="l37.173" class="difflineminus">-      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l37.174"></a><span id="l37.174" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l37.175"></a><span id="l37.175" class="difflineminus">-    event.waitForElement(startTimeInput);</span>
<a href="#l37.176"></a><span id="l37.176" class="difflineminus">-    event.assertValue(startTimeInput, startTime);</span>
<a href="#l37.177"></a><span id="l37.177" class="difflineminus">-    let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l37.178"></a><span id="l37.178" class="difflineminus">-      2009, 1, 1);</span>
<a href="#l37.179"></a><span id="l37.179" class="difflineminus">-    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l37.180"></a><span id="l37.180" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l37.181"></a><span id="l37.181" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l37.182"></a><span id="l37.182" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l37.183"></a><span id="l37.183" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l37.184"></a><span id="l37.184" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l37.185"></a><span id="l37.185" class="difflineminus">-      date);</span>
<a href="#l37.186"></a><span id="l37.186" class="difflineplus">+        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l37.187"></a><span id="l37.187" class="difflineplus">+        event.assertValue(eventlookup(`</span>
<a href="#l37.188"></a><span id="l37.188" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l37.189"></a><span id="l37.189" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l37.190"></a><span id="l37.190" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l37.191"></a><span id="l37.191" class="difflineplus">+            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l37.192"></a><span id="l37.192" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l37.193"></a><span id="l37.193" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l37.194"></a><span id="l37.194" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l37.195"></a><span id="l37.195" class="difflineplus">+        `), date);</span>
<a href="#l37.196"></a><span id="l37.196"> </span>
<a href="#l37.197"></a><span id="l37.197" class="difflineminus">-    // fill in title, description and calendar</span>
<a href="#l37.198"></a><span id="l37.198" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l37.199"></a><span id="l37.199" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l37.200"></a><span id="l37.200" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l37.201"></a><span id="l37.201" class="difflineminus">-      title1);</span>
<a href="#l37.202"></a><span id="l37.202" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l37.203"></a><span id="l37.203" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l37.204"></a><span id="l37.204" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l37.205"></a><span id="l37.205" class="difflineminus">-      desc);</span>
<a href="#l37.206"></a><span id="l37.206" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l37.207"></a><span id="l37.207" class="difflineminus">-    event.click(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l37.208"></a><span id="l37.208" class="difflineminus">-      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/' +</span>
<a href="#l37.209"></a><span id="l37.209" class="difflineminus">-      '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l37.210"></a><span id="l37.210" class="difflineplus">+        // fill in title, description and calendar</span>
<a href="#l37.211"></a><span id="l37.211" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l37.212"></a><span id="l37.212" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l37.213"></a><span id="l37.213" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l37.214"></a><span id="l37.214" class="difflineplus">+        `), TITLE1);</span>
<a href="#l37.215"></a><span id="l37.215" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l37.216"></a><span id="l37.216" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l37.217"></a><span id="l37.217" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l37.218"></a><span id="l37.218" class="difflineplus">+        `), DESC);</span>
<a href="#l37.219"></a><span id="l37.219" class="difflineplus">+        event.click(eventid(&quot;item-calendar&quot;));</span>
<a href="#l37.220"></a><span id="l37.220" class="difflineplus">+        event.click(eventlookup(`</span>
<a href="#l37.221"></a><span id="l37.221" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l37.222"></a><span id="l37.222" class="difflineplus">+            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l37.223"></a><span id="l37.223" class="difflineplus">+            {&quot;label&quot;:&quot;${CALENDARNAME}&quot;}'</span>
<a href="#l37.224"></a><span id="l37.224" class="difflineplus">+        `));</span>
<a href="#l37.225"></a><span id="l37.225"> </span>
<a href="#l37.226"></a><span id="l37.226" class="difflineminus">-    // save</span>
<a href="#l37.227"></a><span id="l37.227" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l37.228"></a><span id="l37.228" class="difflineplus">+        // save</span>
<a href="#l37.229"></a><span id="l37.229" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l37.230"></a><span id="l37.230" class="difflineplus">+    });</span>
<a href="#l37.231"></a><span id="l37.231"> </span>
<a href="#l37.232"></a><span id="l37.232">     // if it was created successfully, it can be opened</span>
<a href="#l37.233"></a><span id="l37.233" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l37.234"></a><span id="l37.234" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l37.235"></a><span id="l37.235" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l37.236"></a><span id="l37.236" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l37.237"></a><span id="l37.237" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l37.238"></a><span id="l37.238" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l37.239"></a><span id="l37.239"> </span>
<a href="#l37.240"></a><span id="l37.240" class="difflineminus">-    // change title and save changes</span>
<a href="#l37.241"></a><span id="l37.241" class="difflineminus">-    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l37.242"></a><span id="l37.242" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l37.243"></a><span id="l37.243" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l37.244"></a><span id="l37.244" class="difflineminus">-    event.waitForElement(titleTextBox);</span>
<a href="#l37.245"></a><span id="l37.245" class="difflineminus">-    event.type(titleTextBox, title2);</span>
<a href="#l37.246"></a><span id="l37.246" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l37.247"></a><span id="l37.247" class="difflineplus">+        // change title and save changes</span>
<a href="#l37.248"></a><span id="l37.248" class="difflineplus">+        let titleTextBox = eventlookup(`</span>
<a href="#l37.249"></a><span id="l37.249" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l37.250"></a><span id="l37.250" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l37.251"></a><span id="l37.251" class="difflineplus">+        `);</span>
<a href="#l37.252"></a><span id="l37.252" class="difflineplus">+        event.waitForElement(titleTextBox);</span>
<a href="#l37.253"></a><span id="l37.253" class="difflineplus">+        event.type(titleTextBox, TITLE2);</span>
<a href="#l37.254"></a><span id="l37.254" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l37.255"></a><span id="l37.255" class="difflineplus">+    });</span>
<a href="#l37.256"></a><span id="l37.256"> </span>
<a href="#l37.257"></a><span id="l37.257">     // check if name was saved</span>
<a href="#l37.258"></a><span id="l37.258" class="difflineminus">-    let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l37.259"></a><span id="l37.259" class="difflineminus">-      '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l37.260"></a><span id="l37.260" class="difflineplus">+    let eventName = lookup(eventBox + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l37.261"></a><span id="l37.261" class="difflineplus">+</span>
<a href="#l37.262"></a><span id="l37.262">     controller.waitForElement(eventName);</span>
<a href="#l37.263"></a><span id="l37.263" class="difflineminus">-    controller.assertValue(eventName, title2);</span>
<a href="#l37.264"></a><span id="l37.264" class="difflineplus">+    controller.assertValue(eventName, TITLE2);</span>
<a href="#l37.265"></a><span id="l37.265"> </span>
<a href="#l37.266"></a><span id="l37.266">     // delete event</span>
<a href="#l37.267"></a><span id="l37.267" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l37.268"></a><span id="l37.268" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l37.269"></a><span id="l37.269" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l37.270"></a><span id="l37.270" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l37.271"></a><span id="l37.271" class="difflineminus">-};</span>
<a href="#l37.272"></a><span id="l37.272" class="difflineplus">+    controller.click(lookup(eventBox));</span>
<a href="#l37.273"></a><span id="l37.273" class="difflineplus">+    controller.keypress(eid(&quot;month-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l37.274"></a><span id="l37.274" class="difflineplus">+    controller.waitForElementNotPresent(lookup(eventBox));</span>
<a href="#l37.275"></a><span id="l37.275" class="difflineplus">+}</span>
<a href="#l37.276"></a><span id="l37.276"> </span>
<a href="#l37.277"></a><span id="l37.277" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l37.278"></a><span id="l37.278" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l37.279"></a><span id="l37.279" class="difflineminus">-};</span>
<a href="#l37.280"></a><span id="l37.280" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l37.281"></a><span id="l37.281" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l37.282"></a><span id="l37.282" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1">old mode 100644</span>
<a href="#l38.2"></a><span id="l38.2">new mode 100755</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineminus">--- a/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l38.4"></a><span id="l38.4" class="difflineplus">+++ b/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineat">@@ -1,138 +1,174 @@</span>
<a href="#l38.6"></a><span id="l38.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l38.7"></a><span id="l38.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.8"></a><span id="l38.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l38.11"></a><span id="l38.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+var CALENDARNAME;</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+</span>
<a href="#l38.17"></a><span id="l38.17" class="difflineplus">+var TITLE1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineplus">+var TITLE2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineplus">+var DESC = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21" class="difflineminus">-var sleep = 500;</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineminus">-var title1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineminus">-var title2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineminus">-var desc = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineplus">+function setupModule(module) {</span>
<a href="#l38.27"></a><span id="l38.27" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineplus">+    ({</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+        helpersForController,</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+        createCalendar,</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+        deleteCalendars,</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+        CALENDARNAME</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l38.37"></a><span id="l38.37"> </span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineminus">-};</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineplus">+}</span>
<a href="#l38.44"></a><span id="l38.44"> </span>
<a href="#l38.45"></a><span id="l38.45" class="difflineminus">-var testMultiWeekView = function() {</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineplus">+function testMultiWeekView() {</span>
<a href="#l38.47"></a><span id="l38.47">     let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l38.48"></a><span id="l38.48">                                 .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l38.49"></a><span id="l38.49">     // paths</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-    let multiWeekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;multiweek-view&quot;)/';</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineplus">+    let miniMonth = `</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+    `;</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineplus">+    let multiWeekView = `</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineplus">+        id(&quot;multiweek-view&quot;)/</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineplus">+    `;</span>
<a href="#l38.68"></a><span id="l38.68">     let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineminus">-    let eventBox = multiWeekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/' +</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineminus">-      '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+    let eventBox = `</span>
<a href="#l38.75"></a><span id="l38.75" class="difflineplus">+        ${multiWeekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + CALENDARNAME.toLowerCase() + '&quot;}/</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineplus">+        anon({&quot;flex&quot;:&quot;1&quot;})/[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineplus">+    `;</span>
<a href="#l38.82"></a><span id="l38.82"> </span>
<a href="#l38.83"></a><span id="l38.83" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineminus">-    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l38.86"></a><span id="l38.86" class="difflineplus">+    controller.waitThenClick(eid(&quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l38.87"></a><span id="l38.87"> </span>
<a href="#l38.88"></a><span id="l38.88">     // pick year</span>
<a href="#l38.89"></a><span id="l38.89" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l38.90"></a><span id="l38.90" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l38.91"></a><span id="l38.91" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l38.92"></a><span id="l38.92" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l38.93"></a><span id="l38.93" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l38.94"></a><span id="l38.94" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l38.95"></a><span id="l38.95" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l38.96"></a><span id="l38.96" class="difflineplus">+    `));</span>
<a href="#l38.97"></a><span id="l38.97" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l38.99"></a><span id="l38.99" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineplus">+        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l38.101"></a><span id="l38.101" class="difflineplus">+    `));</span>
<a href="#l38.102"></a><span id="l38.102"> </span>
<a href="#l38.103"></a><span id="l38.103">     // pick month</span>
<a href="#l38.104"></a><span id="l38.104" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l38.105"></a><span id="l38.105" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l38.106"></a><span id="l38.106" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l38.107"></a><span id="l38.107" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l38.108"></a><span id="l38.108" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l38.110"></a><span id="l38.110" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l38.111"></a><span id="l38.111" class="difflineplus">+    `));</span>
<a href="#l38.112"></a><span id="l38.112" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l38.113"></a><span id="l38.113" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l38.114"></a><span id="l38.114" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l38.115"></a><span id="l38.115" class="difflineplus">+        {&quot;index&quot;:&quot;0&quot;}</span>
<a href="#l38.116"></a><span id="l38.116" class="difflineplus">+    `));</span>
<a href="#l38.117"></a><span id="l38.117"> </span>
<a href="#l38.118"></a><span id="l38.118">     // pick day</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l38.120"></a><span id="l38.120" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l38.122"></a><span id="l38.122" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l38.123"></a><span id="l38.123" class="difflineplus">+    `));</span>
<a href="#l38.124"></a><span id="l38.124"> </span>
<a href="#l38.125"></a><span id="l38.125">     // verify date</span>
<a href="#l38.126"></a><span id="l38.126" class="difflineminus">-    let day = new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l38.127"></a><span id="l38.127" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l38.128"></a><span id="l38.128" class="difflineminus">-      '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l38.129"></a><span id="l38.129" class="difflineplus">+    let day = lookup(`</span>
<a href="#l38.130"></a><span id="l38.130" class="difflineplus">+        ${multiWeekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l38.131"></a><span id="l38.131" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l38.132"></a><span id="l38.132" class="difflineplus">+    `);</span>
<a href="#l38.133"></a><span id="l38.133">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l38.134"></a><span id="l38.134"> </span>
<a href="#l38.135"></a><span id="l38.135">     // create event</span>
<a href="#l38.136"></a><span id="l38.136">     // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l38.137"></a><span id="l38.137">     let hour = new Date().getHours(); // remember time at click</span>
<a href="#l38.138"></a><span id="l38.138" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l38.139"></a><span id="l38.139" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l38.140"></a><span id="l38.140" class="difflineminus">-      '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l38.141"></a><span id="l38.141" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l38.142"></a><span id="l38.142" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l38.143"></a><span id="l38.143" class="difflineplus">+    eventBox = lookup(`</span>
<a href="#l38.144"></a><span id="l38.144" class="difflineplus">+        ${multiWeekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/</span>
<a href="#l38.145"></a><span id="l38.145" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/</span>
<a href="#l38.146"></a><span id="l38.146" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;day-items&quot;})</span>
<a href="#l38.147"></a><span id="l38.147" class="difflineplus">+    `);</span>
<a href="#l38.148"></a><span id="l38.148" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l38.149"></a><span id="l38.149" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l38.150"></a><span id="l38.150"> </span>
<a href="#l38.151"></a><span id="l38.151" class="difflineminus">-    // check that the start time is correct</span>
<a href="#l38.152"></a><span id="l38.152" class="difflineminus">-    // next full hour except last hour hour of the day</span>
<a href="#l38.153"></a><span id="l38.153" class="difflineminus">-    let nextHour = (hour == 23 ? hour : (hour + 1) % 24);</span>
<a href="#l38.154"></a><span id="l38.154" class="difflineminus">-    let startTime = nextHour + &quot;:00&quot;;</span>
<a href="#l38.155"></a><span id="l38.155" class="difflineminus">-    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l38.156"></a><span id="l38.156" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l38.157"></a><span id="l38.157" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l38.158"></a><span id="l38.158" class="difflineminus">-      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l38.159"></a><span id="l38.159" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l38.160"></a><span id="l38.160" class="difflineminus">-    event.waitForElement(startTimeInput);</span>
<a href="#l38.161"></a><span id="l38.161" class="difflineminus">-    event.assertValue(startTimeInput, startTime);</span>
<a href="#l38.162"></a><span id="l38.162" class="difflineminus">-    let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l38.163"></a><span id="l38.163" class="difflineminus">-      2009, 1, 1);</span>
<a href="#l38.164"></a><span id="l38.164" class="difflineminus">-    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l38.165"></a><span id="l38.165" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l38.166"></a><span id="l38.166" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l38.167"></a><span id="l38.167" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l38.168"></a><span id="l38.168" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l38.169"></a><span id="l38.169" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l38.170"></a><span id="l38.170" class="difflineminus">-      date);</span>
<a href="#l38.171"></a><span id="l38.171" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l38.172"></a><span id="l38.172" class="difflineplus">+        // next full hour except last hour hour of the day</span>
<a href="#l38.173"></a><span id="l38.173" class="difflineplus">+        let nextHour = (hour == 23 ? hour : (hour + 1) % 24);</span>
<a href="#l38.174"></a><span id="l38.174" class="difflineplus">+        let startTime = nextHour + &quot;:00&quot;;</span>
<a href="#l38.175"></a><span id="l38.175" class="difflineplus">+        let startTimeInput = eventlookup(`</span>
<a href="#l38.176"></a><span id="l38.176" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l38.177"></a><span id="l38.177" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l38.178"></a><span id="l38.178" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l38.179"></a><span id="l38.179" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l38.180"></a><span id="l38.180" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l38.181"></a><span id="l38.181" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l38.182"></a><span id="l38.182" class="difflineplus">+        `);</span>
<a href="#l38.183"></a><span id="l38.183" class="difflineplus">+        event.waitForElement(startTimeInput);</span>
<a href="#l38.184"></a><span id="l38.184" class="difflineplus">+        event.assertValue(startTimeInput, startTime);</span>
<a href="#l38.185"></a><span id="l38.185" class="difflineplus">+        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l38.186"></a><span id="l38.186" class="difflineplus">+        event.assertValue(eventlookup(`</span>
<a href="#l38.187"></a><span id="l38.187" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l38.188"></a><span id="l38.188" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l38.189"></a><span id="l38.189" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l38.190"></a><span id="l38.190" class="difflineplus">+            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l38.191"></a><span id="l38.191" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l38.192"></a><span id="l38.192" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l38.193"></a><span id="l38.193" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l38.194"></a><span id="l38.194" class="difflineplus">+        `), date);</span>
<a href="#l38.195"></a><span id="l38.195"> </span>
<a href="#l38.196"></a><span id="l38.196" class="difflineminus">-    // fill in title, description and calendar</span>
<a href="#l38.197"></a><span id="l38.197" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l38.198"></a><span id="l38.198" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l38.199"></a><span id="l38.199" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l38.200"></a><span id="l38.200" class="difflineminus">-      title1);</span>
<a href="#l38.201"></a><span id="l38.201" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l38.202"></a><span id="l38.202" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l38.203"></a><span id="l38.203" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l38.204"></a><span id="l38.204" class="difflineminus">-      desc);</span>
<a href="#l38.205"></a><span id="l38.205" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l38.206"></a><span id="l38.206" class="difflineminus">-    event.click(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l38.207"></a><span id="l38.207" class="difflineminus">-      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/' +</span>
<a href="#l38.208"></a><span id="l38.208" class="difflineminus">-      '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l38.209"></a><span id="l38.209" class="difflineplus">+        // fill in title, description and calendar</span>
<a href="#l38.210"></a><span id="l38.210" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l38.211"></a><span id="l38.211" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l38.212"></a><span id="l38.212" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l38.213"></a><span id="l38.213" class="difflineplus">+        `), TITLE1);</span>
<a href="#l38.214"></a><span id="l38.214" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l38.215"></a><span id="l38.215" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l38.216"></a><span id="l38.216" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l38.217"></a><span id="l38.217" class="difflineplus">+        `), DESC);</span>
<a href="#l38.218"></a><span id="l38.218" class="difflineplus">+        event.click(eventid(&quot;item-calendar&quot;));</span>
<a href="#l38.219"></a><span id="l38.219" class="difflineplus">+        event.click(eventlookup(`</span>
<a href="#l38.220"></a><span id="l38.220" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l38.221"></a><span id="l38.221" class="difflineplus">+            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l38.222"></a><span id="l38.222" class="difflineplus">+            {&quot;label&quot;:&quot;${CALENDARNAME}&quot;}</span>
<a href="#l38.223"></a><span id="l38.223" class="difflineplus">+        `));</span>
<a href="#l38.224"></a><span id="l38.224"> </span>
<a href="#l38.225"></a><span id="l38.225" class="difflineminus">-    // save</span>
<a href="#l38.226"></a><span id="l38.226" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l38.227"></a><span id="l38.227" class="difflineplus">+        // save</span>
<a href="#l38.228"></a><span id="l38.228" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l38.229"></a><span id="l38.229" class="difflineplus">+    });</span>
<a href="#l38.230"></a><span id="l38.230"> </span>
<a href="#l38.231"></a><span id="l38.231">     // if it was created successfully, it can be opened</span>
<a href="#l38.232"></a><span id="l38.232" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l38.233"></a><span id="l38.233" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l38.234"></a><span id="l38.234" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l38.235"></a><span id="l38.235" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l38.236"></a><span id="l38.236" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l38.237"></a><span id="l38.237" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l38.238"></a><span id="l38.238"> </span>
<a href="#l38.239"></a><span id="l38.239" class="difflineminus">-    // change title and save changes</span>
<a href="#l38.240"></a><span id="l38.240" class="difflineminus">-    let titmeTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l38.241"></a><span id="l38.241" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l38.242"></a><span id="l38.242" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l38.243"></a><span id="l38.243" class="difflineminus">-    event.waitForElement(titmeTextBox);</span>
<a href="#l38.244"></a><span id="l38.244" class="difflineminus">-    event.type(titmeTextBox, title2);</span>
<a href="#l38.245"></a><span id="l38.245" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l38.246"></a><span id="l38.246" class="difflineplus">+        // change title and save changes</span>
<a href="#l38.247"></a><span id="l38.247" class="difflineplus">+        let titmeTextBox = eventlookup(`</span>
<a href="#l38.248"></a><span id="l38.248" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l38.249"></a><span id="l38.249" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l38.250"></a><span id="l38.250" class="difflineplus">+        `);</span>
<a href="#l38.251"></a><span id="l38.251" class="difflineplus">+        event.waitForElement(titmeTextBox);</span>
<a href="#l38.252"></a><span id="l38.252" class="difflineplus">+        event.type(titmeTextBox, TITLE2);</span>
<a href="#l38.253"></a><span id="l38.253" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l38.254"></a><span id="l38.254" class="difflineplus">+    });</span>
<a href="#l38.255"></a><span id="l38.255"> </span>
<a href="#l38.256"></a><span id="l38.256">     // check if name was saved</span>
<a href="#l38.257"></a><span id="l38.257" class="difflineminus">-    let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l38.258"></a><span id="l38.258" class="difflineminus">-      '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l38.259"></a><span id="l38.259" class="difflineplus">+    let eventName = lookup(eventBox + '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l38.260"></a><span id="l38.260">     controller.waitForElement(eventName);</span>
<a href="#l38.261"></a><span id="l38.261" class="difflineminus">-    controller.assertValue(eventName, title2);</span>
<a href="#l38.262"></a><span id="l38.262" class="difflineplus">+    controller.assertValue(eventName, TITLE2);</span>
<a href="#l38.263"></a><span id="l38.263"> </span>
<a href="#l38.264"></a><span id="l38.264">     // delete event</span>
<a href="#l38.265"></a><span id="l38.265" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l38.266"></a><span id="l38.266" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;multiweek-view&quot;),</span>
<a href="#l38.267"></a><span id="l38.267" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l38.268"></a><span id="l38.268" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l38.269"></a><span id="l38.269" class="difflineminus">-};</span>
<a href="#l38.270"></a><span id="l38.270" class="difflineplus">+    controller.click(lookup(eventBox));</span>
<a href="#l38.271"></a><span id="l38.271" class="difflineplus">+    controller.keypress(eid(&quot;multiweek-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l38.272"></a><span id="l38.272" class="difflineplus">+    controller.waitForElementNotPresent(lookup(eventBox));</span>
<a href="#l38.273"></a><span id="l38.273" class="difflineplus">+}</span>
<a href="#l38.274"></a><span id="l38.274"> </span>
<a href="#l38.275"></a><span id="l38.275" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l38.276"></a><span id="l38.276" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l38.277"></a><span id="l38.277" class="difflineminus">-};</span>
<a href="#l38.278"></a><span id="l38.278" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l38.279"></a><span id="l38.279" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l38.280"></a><span id="l38.280" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1">old mode 100644</span>
<a href="#l39.2"></a><span id="l39.2">new mode 100755</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l39.4"></a><span id="l39.4" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l39.5"></a><span id="l39.5" class="difflineat">@@ -1,164 +1,184 @@</span>
<a href="#l39.6"></a><span id="l39.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l39.7"></a><span id="l39.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l39.8"></a><span id="l39.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l39.9"></a><span id="l39.9"> </span>
<a href="#l39.10"></a><span id="l39.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l39.11"></a><span id="l39.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineplus">+var CALENDARNAME;</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+</span>
<a href="#l39.17"></a><span id="l39.17"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l39.18"></a><span id="l39.18"> </span>
<a href="#l39.19"></a><span id="l39.19" class="difflineminus">-var sleep = 500;</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineminus">-var title = &quot;Task&quot;;</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineminus">-var description = &quot;1. Do A\n2. Do B&quot;;</span>
<a href="#l39.23"></a><span id="l39.23" class="difflineplus">+var TITLE = &quot;Task&quot;;</span>
<a href="#l39.24"></a><span id="l39.24" class="difflineplus">+var DESCRIPTION = &quot;1. Do A\n2. Do B&quot;;</span>
<a href="#l39.25"></a><span id="l39.25"> var percentComplete = &quot;50&quot;;</span>
<a href="#l39.26"></a><span id="l39.26"> </span>
<a href="#l39.27"></a><span id="l39.27" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineplus">+function setupModule(module) {</span>
<a href="#l39.29"></a><span id="l39.29">     controller = mozmill.getMail3PaneController();</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-};</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+</span>
<a href="#l39.33"></a><span id="l39.33" class="difflineplus">+    ({</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineplus">+        helpersForController,</span>
<a href="#l39.35"></a><span id="l39.35" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l39.36"></a><span id="l39.36" class="difflineplus">+        createCalendar,</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineplus">+        deleteCalendars,</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineplus">+        CALENDARNAME</span>
<a href="#l39.39"></a><span id="l39.39" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l39.40"></a><span id="l39.40" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l39.42"></a><span id="l39.42" class="difflineplus">+</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l39.44"></a><span id="l39.44" class="difflineplus">+}</span>
<a href="#l39.45"></a><span id="l39.45"> </span>
<a href="#l39.46"></a><span id="l39.46"> // mozmill doesn't support trees yet, therefore completed checkbox and line-through style are not</span>
<a href="#l39.47"></a><span id="l39.47"> // checked</span>
<a href="#l39.48"></a><span id="l39.48" class="difflineminus">-var testTaskView = function() {</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineplus">+function testTaskView() {</span>
<a href="#l39.50"></a><span id="l39.50">     // paths</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineminus">-    let taskView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l39.52"></a><span id="l39.52" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l39.53"></a><span id="l39.53" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/';</span>
<a href="#l39.54"></a><span id="l39.54" class="difflineminus">-    let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l39.55"></a><span id="l39.55" class="difflineminus">-    let treeChildren = taskView + '[1]/id(&quot;calendar-task-tree&quot;)/anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/' +</span>
<a href="#l39.56"></a><span id="l39.56" class="difflineminus">-      '{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}';</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineplus">+    let taskView = `</span>
<a href="#l39.58"></a><span id="l39.58" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l39.59"></a><span id="l39.59" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l39.60"></a><span id="l39.60" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/</span>
<a href="#l39.61"></a><span id="l39.61" class="difflineplus">+    `;</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineplus">+    let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)';</span>
<a href="#l39.63"></a><span id="l39.63" class="difflineplus">+    let treeChildren = `</span>
<a href="#l39.64"></a><span id="l39.64" class="difflineplus">+        ${taskView}/[1]/id(&quot;calendar-task-tree&quot;)/</span>
<a href="#l39.65"></a><span id="l39.65" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}</span>
<a href="#l39.66"></a><span id="l39.66" class="difflineplus">+    `;</span>
<a href="#l39.67"></a><span id="l39.67">     let taskTree = taskView + '[1]/id(&quot;calendar-task-tree&quot;)';</span>
<a href="#l39.68"></a><span id="l39.68">     let toolTip = '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;taskTreeTooltip&quot;)';</span>
<a href="#l39.69"></a><span id="l39.69">     let toolTipGrid = toolTip + '/{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/';</span>
<a href="#l39.70"></a><span id="l39.70"> </span>
<a href="#l39.71"></a><span id="l39.71">     // open task view</span>
<a href="#l39.72"></a><span id="l39.72" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l39.73"></a><span id="l39.73" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l39.74"></a><span id="l39.74" class="difflineplus">+    controller.click(eid(&quot;task-tab-button&quot;));</span>
<a href="#l39.75"></a><span id="l39.75" class="difflineplus">+    sleep();</span>
<a href="#l39.76"></a><span id="l39.76"> </span>
<a href="#l39.77"></a><span id="l39.77">     // make sure that testing calendar is selected</span>
<a href="#l39.78"></a><span id="l39.78" class="difflineminus">-    let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l39.79"></a><span id="l39.79" class="difflineminus">-      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l39.80"></a><span id="l39.80" class="difflineminus">-      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/' +</span>
<a href="#l39.81"></a><span id="l39.81" class="difflineminus">-      'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l39.82"></a><span id="l39.82" class="difflineminus">-      .getNode();</span>
<a href="#l39.83"></a><span id="l39.83" class="difflineminus">-    for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l39.84"></a><span id="l39.84" class="difflineminus">-        if (calendarTree.mCalendarList[i].name == calendar) {</span>
<a href="#l39.85"></a><span id="l39.85" class="difflineplus">+    let calendarTree = lookup(`</span>
<a href="#l39.86"></a><span id="l39.86" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l39.87"></a><span id="l39.87" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l39.88"></a><span id="l39.88" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/</span>
<a href="#l39.89"></a><span id="l39.89" class="difflineplus">+        id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)</span>
<a href="#l39.90"></a><span id="l39.90" class="difflineplus">+    `).getNode();</span>
<a href="#l39.91"></a><span id="l39.91" class="difflineplus">+</span>
<a href="#l39.92"></a><span id="l39.92" class="difflineplus">+    for (let i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l39.93"></a><span id="l39.93" class="difflineplus">+        if (calendarTree.mCalendarList[i].name == CALENDARNAME) {</span>
<a href="#l39.94"></a><span id="l39.94">             calendarTree.tree.view.selection.select(i);</span>
<a href="#l39.95"></a><span id="l39.95">         }</span>
<a href="#l39.96"></a><span id="l39.96">     }</span>
<a href="#l39.97"></a><span id="l39.97"> </span>
<a href="#l39.98"></a><span id="l39.98" class="difflineminus">-    let taskTreeNode = (new elementslib.Lookup(controller.window.document, taskTree)).getNode();</span>
<a href="#l39.99"></a><span id="l39.99" class="difflineplus">+    let taskTreeNode = lookup(taskTree).getNode();</span>
<a href="#l39.100"></a><span id="l39.100">     let countBefore = taskTreeNode.mTaskArray.length;</span>
<a href="#l39.101"></a><span id="l39.101"> </span>
<a href="#l39.102"></a><span id="l39.102">     // add task</span>
<a href="#l39.103"></a><span id="l39.103" class="difflineminus">-    controller.type(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l39.104"></a><span id="l39.104" class="difflineminus">-      'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l39.105"></a><span id="l39.105" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l39.106"></a><span id="l39.106" class="difflineminus">-      title);</span>
<a href="#l39.107"></a><span id="l39.107" class="difflineminus">-    controller.keypress(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l39.108"></a><span id="l39.108" class="difflineminus">-      'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l39.109"></a><span id="l39.109" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l39.110"></a><span id="l39.110" class="difflineminus">-      &quot;VK_RETURN&quot;,</span>
<a href="#l39.111"></a><span id="l39.111" class="difflineminus">-      {});</span>
<a href="#l39.112"></a><span id="l39.112" class="difflineplus">+    controller.type(lookup(`</span>
<a href="#l39.113"></a><span id="l39.113" class="difflineplus">+        ${taskView}/id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/</span>
<a href="#l39.114"></a><span id="l39.114" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l39.115"></a><span id="l39.115" class="difflineplus">+    `), TITLE);</span>
<a href="#l39.116"></a><span id="l39.116" class="difflineplus">+    controller.keypress(lookup(`</span>
<a href="#l39.117"></a><span id="l39.117" class="difflineplus">+        ${taskView}/id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/</span>
<a href="#l39.118"></a><span id="l39.118" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l39.119"></a><span id="l39.119" class="difflineplus">+    `), &quot;VK_RETURN&quot;, {});</span>
<a href="#l39.120"></a><span id="l39.120"> </span>
<a href="#l39.121"></a><span id="l39.121">     // verify added</span>
<a href="#l39.122"></a><span id="l39.122">     let countAfter;</span>
<a href="#l39.123"></a><span id="l39.123">     controller.waitFor(() =&gt; {</span>
<a href="#l39.124"></a><span id="l39.124">         countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l39.125"></a><span id="l39.125">         return countBefore + 1 == countAfter;</span>
<a href="#l39.126"></a><span id="l39.126">     });</span>
<a href="#l39.127"></a><span id="l39.127"> </span>
<a href="#l39.128"></a><span id="l39.128">     // last added task is automatically selected so verify detail window data</span>
<a href="#l39.129"></a><span id="l39.129" class="difflineminus">-    controller.assertJSProperty(new elementslib.ID(controller.window.document,</span>
<a href="#l39.130"></a><span id="l39.130" class="difflineminus">-      &quot;calendar-task-details-title&quot;), &quot;textContent&quot;, title);</span>
<a href="#l39.131"></a><span id="l39.131" class="difflineplus">+    controller.assertJSProperty(eid(&quot;calendar-task-details-title&quot;), &quot;textContent&quot;, TITLE);</span>
<a href="#l39.132"></a><span id="l39.132"> </span>
<a href="#l39.133"></a><span id="l39.133">     // open added task</span>
<a href="#l39.134"></a><span id="l39.134">     // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l39.135"></a><span id="l39.135">     // left where the checkbox is located</span>
<a href="#l39.136"></a><span id="l39.136" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, treeChildren), 50, 0);</span>
<a href="#l39.137"></a><span id="l39.137" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l39.138"></a><span id="l39.138" class="difflineminus">-    let task = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l39.139"></a><span id="l39.139" class="difflineplus">+    controller.doubleClick(lookup(treeChildren), 50, 0);</span>
<a href="#l39.140"></a><span id="l39.140" class="difflineplus">+    invokeEventDialog(controller, null, (task, iframe) =&gt; {</span>
<a href="#l39.141"></a><span id="l39.141" class="difflineplus">+        let { lookup: tasklookup, eid: taskid } = helpersForController(task);</span>
<a href="#l39.142"></a><span id="l39.142"> </span>
<a href="#l39.143"></a><span id="l39.143" class="difflineminus">-    // verify calendar</span>
<a href="#l39.144"></a><span id="l39.144" class="difflineminus">-    task.waitForElement(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l39.145"></a><span id="l39.145" class="difflineminus">-      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l39.146"></a><span id="l39.146" class="difflineminus">-      '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l39.147"></a><span id="l39.147" class="difflineplus">+        // verify calendar</span>
<a href="#l39.148"></a><span id="l39.148" class="difflineplus">+        task.waitForElement(tasklookup(`</span>
<a href="#l39.149"></a><span id="l39.149" class="difflineplus">+            ${taskDialog}/id(&quot;event-grid-category-color-row&quot;)/</span>
<a href="#l39.150"></a><span id="l39.150" class="difflineplus">+            id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/</span>
<a href="#l39.151"></a><span id="l39.151" class="difflineplus">+            {&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;${CALENDARNAME}&quot;}</span>
<a href="#l39.152"></a><span id="l39.152" class="difflineplus">+        `));</span>
<a href="#l39.153"></a><span id="l39.153"> </span>
<a href="#l39.154"></a><span id="l39.154" class="difflineminus">-    // add description, mark needs action and add percent complete</span>
<a href="#l39.155"></a><span id="l39.155" class="difflineminus">-    task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l39.156"></a><span id="l39.156" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l39.157"></a><span id="l39.157" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l39.158"></a><span id="l39.158" class="difflineminus">-      description);</span>
<a href="#l39.159"></a><span id="l39.159" class="difflineminus">-    task.click(new elementslib.ID(task.window.document, &quot;todo-status-needsaction-menuitem&quot;));</span>
<a href="#l39.160"></a><span id="l39.160" class="difflineplus">+        // add description, mark needs action and add percent complete</span>
<a href="#l39.161"></a><span id="l39.161" class="difflineplus">+        task.type(tasklookup(`</span>
<a href="#l39.162"></a><span id="l39.162" class="difflineplus">+            ${taskDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l39.163"></a><span id="l39.163" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l39.164"></a><span id="l39.164" class="difflineplus">+        `), DESCRIPTION);</span>
<a href="#l39.165"></a><span id="l39.165" class="difflineplus">+        task.click(taskid(&quot;todo-status-needsaction-menuitem&quot;));</span>
<a href="#l39.166"></a><span id="l39.166"> </span>
<a href="#l39.167"></a><span id="l39.167" class="difflineminus">-    // delete default 0 percent complete</span>
<a href="#l39.168"></a><span id="l39.168" class="difflineminus">-    task.keypress(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l39.169"></a><span id="l39.169" class="difflineminus">-      'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l39.170"></a><span id="l39.170" class="difflineminus">-      'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l39.171"></a><span id="l39.171" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l39.172"></a><span id="l39.172" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l39.173"></a><span id="l39.173" class="difflineminus">-    task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l39.174"></a><span id="l39.174" class="difflineminus">-      'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l39.175"></a><span id="l39.175" class="difflineminus">-      'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l39.176"></a><span id="l39.176" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l39.177"></a><span id="l39.177" class="difflineminus">-      percentComplete);</span>
<a href="#l39.178"></a><span id="l39.178" class="difflineplus">+        // delete default 0 percent complete</span>
<a href="#l39.179"></a><span id="l39.179" class="difflineplus">+        task.keypress(tasklookup(`</span>
<a href="#l39.180"></a><span id="l39.180" class="difflineplus">+            ${taskDialog}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l39.181"></a><span id="l39.181" class="difflineplus">+            id(&quot;event-grid-todo-status-picker-box&quot;)/</span>
<a href="#l39.182"></a><span id="l39.182" class="difflineplus">+            id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l39.183"></a><span id="l39.183" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l39.184"></a><span id="l39.184" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l39.185"></a><span id="l39.185" class="difflineplus">+        `), &quot;VK_DELETE&quot;, {});</span>
<a href="#l39.186"></a><span id="l39.186" class="difflineplus">+        task.type(tasklookup(`</span>
<a href="#l39.187"></a><span id="l39.187" class="difflineplus">+            ${taskDialog}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l39.188"></a><span id="l39.188" class="difflineplus">+            id(&quot;event-grid-todo-status-picker-box&quot;)/</span>
<a href="#l39.189"></a><span id="l39.189" class="difflineplus">+            id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l39.190"></a><span id="l39.190" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l39.191"></a><span id="l39.191" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l39.192"></a><span id="l39.192" class="difflineplus">+        `), percentComplete);</span>
<a href="#l39.193"></a><span id="l39.193"> </span>
<a href="#l39.194"></a><span id="l39.194" class="difflineminus">-    // save</span>
<a href="#l39.195"></a><span id="l39.195" class="difflineminus">-    task.click(new elementslib.ID(task.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l39.196"></a><span id="l39.196" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l39.197"></a><span id="l39.197" class="difflineplus">+        // save</span>
<a href="#l39.198"></a><span id="l39.198" class="difflineplus">+        task.click(taskid(&quot;button-saveandclose&quot;));</span>
<a href="#l39.199"></a><span id="l39.199" class="difflineplus">+    });</span>
<a href="#l39.200"></a><span id="l39.200"> </span>
<a href="#l39.201"></a><span id="l39.201">     // verify description and status in details pane</span>
<a href="#l39.202"></a><span id="l39.202" class="difflineminus">-    controller.assertValue(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l39.203"></a><span id="l39.203" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details-description&quot;)/' +</span>
<a href="#l39.204"></a><span id="l39.204" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l39.205"></a><span id="l39.205" class="difflineminus">-      description);</span>
<a href="#l39.206"></a><span id="l39.206" class="difflineminus">-    let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l39.207"></a><span id="l39.207" class="difflineminus">-      &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l39.208"></a><span id="l39.208" class="difflineminus">-    controller.assertValue(new elementslib.ID(controller.window.document, &quot;calendar-task-details-status&quot;),</span>
<a href="#l39.209"></a><span id="l39.209" class="difflineminus">-      status);</span>
<a href="#l39.210"></a><span id="l39.210" class="difflineplus">+    controller.assertValue(lookup(`</span>
<a href="#l39.211"></a><span id="l39.211" class="difflineplus">+        ${taskView}/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/</span>
<a href="#l39.212"></a><span id="l39.212" class="difflineplus">+        id(&quot;calendar-task-details-description&quot;)/</span>
<a href="#l39.213"></a><span id="l39.213" class="difflineplus">+        anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l39.214"></a><span id="l39.214" class="difflineplus">+    `), DESCRIPTION);</span>
<a href="#l39.215"></a><span id="l39.215" class="difflineplus">+    let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l39.216"></a><span id="l39.216" class="difflineplus">+    controller.assertValue(eid(&quot;calendar-task-details-status&quot;), status);</span>
<a href="#l39.217"></a><span id="l39.217"> </span>
<a href="#l39.218"></a><span id="l39.218">     // set high priority and verify it in detail pane</span>
<a href="#l39.219"></a><span id="l39.219" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;task-actions-priority&quot;));</span>
<a href="#l39.220"></a><span id="l39.220" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l39.221"></a><span id="l39.221" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;priority-1-menuitem&quot;));</span>
<a href="#l39.222"></a><span id="l39.222" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l39.223"></a><span id="l39.223" class="difflineminus">-    let priorityNode = new elementslib.ID(controller.window.document, &quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l39.224"></a><span id="l39.224" class="difflineplus">+    controller.click(eid(&quot;task-actions-priority&quot;));</span>
<a href="#l39.225"></a><span id="l39.225" class="difflineplus">+    sleep();</span>
<a href="#l39.226"></a><span id="l39.226" class="difflineplus">+    controller.click(eid(&quot;priority-1-menuitem&quot;));</span>
<a href="#l39.227"></a><span id="l39.227" class="difflineplus">+    sleep();</span>
<a href="#l39.228"></a><span id="l39.228" class="difflineplus">+    let priorityNode = eid(&quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l39.229"></a><span id="l39.229">     controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l39.230"></a><span id="l39.230"> </span>
<a href="#l39.231"></a><span id="l39.231">     // verify that tooltip shows status, priority and percent complete</span>
<a href="#l39.232"></a><span id="l39.232" class="difflineminus">-    let toolTipNode = new elementslib.Lookup(controller.window.document, toolTip).getNode();</span>
<a href="#l39.233"></a><span id="l39.233" class="difflineplus">+    let toolTipNode = lookup(toolTip).getNode();</span>
<a href="#l39.234"></a><span id="l39.234">     toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l39.235"></a><span id="l39.235"> </span>
<a href="#l39.236"></a><span id="l39.236" class="difflineminus">-    let toolTipName = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[0]/[1]&quot;);</span>
<a href="#l39.237"></a><span id="l39.237" class="difflineminus">-    let toolTipCalendar = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[1]/[1]&quot;);</span>
<a href="#l39.238"></a><span id="l39.238" class="difflineminus">-    let toolTipPriority = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[2]/[1]&quot;);</span>
<a href="#l39.239"></a><span id="l39.239" class="difflineminus">-    let toolTipStatus = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[3]/[1]&quot;);</span>
<a href="#l39.240"></a><span id="l39.240" class="difflineminus">-    let toolTipComplete = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[4]/[1]&quot;);</span>
<a href="#l39.241"></a><span id="l39.241" class="difflineminus">-    let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l39.242"></a><span id="l39.242" class="difflineminus">-      &quot;highPriority&quot;);</span>
<a href="#l39.243"></a><span id="l39.243" class="difflineplus">+    let toolTipName = lookup(toolTipGrid + &quot;[1]/[0]/[1]&quot;);</span>
<a href="#l39.244"></a><span id="l39.244" class="difflineplus">+    let toolTipCalendar = lookup(toolTipGrid + &quot;[1]/[1]/[1]&quot;);</span>
<a href="#l39.245"></a><span id="l39.245" class="difflineplus">+    let toolTipPriority = lookup(toolTipGrid + &quot;[1]/[2]/[1]&quot;);</span>
<a href="#l39.246"></a><span id="l39.246" class="difflineplus">+    let toolTipStatus = lookup(toolTipGrid + &quot;[1]/[3]/[1]&quot;);</span>
<a href="#l39.247"></a><span id="l39.247" class="difflineplus">+    let toolTipComplete = lookup(toolTipGrid + &quot;[1]/[4]/[1]&quot;);</span>
<a href="#l39.248"></a><span id="l39.248" class="difflineplus">+    let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;highPriority&quot;);</span>
<a href="#l39.249"></a><span id="l39.249"> </span>
<a href="#l39.250"></a><span id="l39.250" class="difflineminus">-    controller.assertJSProperty(toolTipName, &quot;textContent&quot;, title);</span>
<a href="#l39.251"></a><span id="l39.251" class="difflineminus">-    controller.assertJSProperty(toolTipCalendar, &quot;textContent&quot;, calendar);</span>
<a href="#l39.252"></a><span id="l39.252" class="difflineplus">+    controller.assertJSProperty(toolTipName, &quot;textContent&quot;, TITLE);</span>
<a href="#l39.253"></a><span id="l39.253" class="difflineplus">+    controller.assertJSProperty(toolTipCalendar, &quot;textContent&quot;, CALENDARNAME);</span>
<a href="#l39.254"></a><span id="l39.254">     controller.assertJSProperty(toolTipPriority, &quot;textContent&quot;, priority);</span>
<a href="#l39.255"></a><span id="l39.255">     controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l39.256"></a><span id="l39.256">     controller.assertJSProperty(toolTipComplete, &quot;textContent&quot;, percentComplete + &quot;%&quot;);</span>
<a href="#l39.257"></a><span id="l39.257"> </span>
<a href="#l39.258"></a><span id="l39.258">     // mark completed, verify</span>
<a href="#l39.259"></a><span id="l39.259" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document,</span>
<a href="#l39.260"></a><span id="l39.260" class="difflineminus">-                                        &quot;task-actions-markcompleted&quot;));</span>
<a href="#l39.261"></a><span id="l39.261" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l39.262"></a><span id="l39.262" class="difflineplus">+    controller.click(eid(&quot;task-actions-markcompleted&quot;));</span>
<a href="#l39.263"></a><span id="l39.263" class="difflineplus">+    sleep();</span>
<a href="#l39.264"></a><span id="l39.264"> </span>
<a href="#l39.265"></a><span id="l39.265" class="difflineminus">-    status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l39.266"></a><span id="l39.266" class="difflineminus">-      &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l39.267"></a><span id="l39.267" class="difflineplus">+    status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;, &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l39.268"></a><span id="l39.268">     toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l39.269"></a><span id="l39.269">     controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l39.270"></a><span id="l39.270"> </span>
<a href="#l39.271"></a><span id="l39.271">     // delete task, verify</span>
<a href="#l39.272"></a><span id="l39.272" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;task-context-menu-delete&quot;));</span>
<a href="#l39.273"></a><span id="l39.273" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-delete-task-button&quot;));</span>
<a href="#l39.274"></a><span id="l39.274" class="difflineplus">+    controller.click(eid(&quot;task-context-menu-delete&quot;));</span>
<a href="#l39.275"></a><span id="l39.275" class="difflineplus">+    controller.click(eid(&quot;calendar-delete-task-button&quot;));</span>
<a href="#l39.276"></a><span id="l39.276">     let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l39.277"></a><span id="l39.277">     controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l39.278"></a><span id="l39.278" class="difflineminus">-};</span>
<a href="#l39.279"></a><span id="l39.279" class="difflineplus">+}</span>
<a href="#l39.280"></a><span id="l39.280"> </span>
<a href="#l39.281"></a><span id="l39.281" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l39.282"></a><span id="l39.282" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l39.283"></a><span id="l39.283" class="difflineminus">-};</span>
<a href="#l39.284"></a><span id="l39.284" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l39.285"></a><span id="l39.285" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l39.286"></a><span id="l39.286" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1">old mode 100644</span>
<a href="#l40.2"></a><span id="l40.2">new mode 100755</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineminus">--- a/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l40.4"></a><span id="l40.4" class="difflineplus">+++ b/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l40.5"></a><span id="l40.5" class="difflineat">@@ -1,132 +1,169 @@</span>
<a href="#l40.6"></a><span id="l40.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l40.7"></a><span id="l40.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l40.8"></a><span id="l40.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10" class="difflineminus">-var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l40.11"></a><span id="l40.11" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineplus">+var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineplus">+var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+var CALENDARNAME;</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+var TITLE1 = &quot;Week View Event&quot;;</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineplus">+var TITLE2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineplus">+var DESC = &quot;Week View Event Description&quot;;</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineplus">+</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineplus">+function setupModule(module) {</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l40.23"></a><span id="l40.23"> </span>
<a href="#l40.24"></a><span id="l40.24" class="difflineminus">-var sleep = 500;</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineminus">-var calendar = &quot;Mozmill&quot;;</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineminus">-var title1 = &quot;Week View Event&quot;;</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineminus">-var title2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineminus">-var desc = &quot;Week View Event Description&quot;;</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineplus">+    ({</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineplus">+        helpersForController,</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+        invokeEventDialog,</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+        createCalendar,</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineplus">+        deleteCalendars,</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineplus">+        CALENDARNAME</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineplus">+    } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineplus">+    collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineplus">+    Object.assign(module, helpersForController(controller));</span>
<a href="#l40.38"></a><span id="l40.38"> </span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineminus">-    controller = mozmill.getMail3PaneController();</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineminus">-    calUtils.createCalendar(controller, calendar);</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineminus">-};</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineplus">+    createCalendar(controller, CALENDARNAME);</span>
<a href="#l40.44"></a><span id="l40.44" class="difflineplus">+}</span>
<a href="#l40.45"></a><span id="l40.45"> </span>
<a href="#l40.46"></a><span id="l40.46" class="difflineminus">-var testWeekView = function() {</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineplus">+function testWeekView() {</span>
<a href="#l40.48"></a><span id="l40.48">     let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l40.49"></a><span id="l40.49">                                 .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l40.50"></a><span id="l40.50">     // paths</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineminus">-    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineminus">-      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineminus">-    let weekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l40.55"></a><span id="l40.55" class="difflineminus">-      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l40.56"></a><span id="l40.56" class="difflineminus">-      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/';</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineminus">-    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineminus">-    let eventBox = weekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineminus">-      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' +</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineminus">-      calendar.toLowerCase() + '&quot;}';</span>
<a href="#l40.62"></a><span id="l40.62" class="difflineplus">+    let miniMonth = `</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l40.64"></a><span id="l40.64" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l40.65"></a><span id="l40.65" class="difflineplus">+        id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l40.66"></a><span id="l40.66" class="difflineplus">+        id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l40.67"></a><span id="l40.67" class="difflineplus">+    `;</span>
<a href="#l40.68"></a><span id="l40.68" class="difflineplus">+    let weekView = `</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineplus">+        /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineplus">+        id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l40.71"></a><span id="l40.71" class="difflineplus">+        id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/</span>
<a href="#l40.72"></a><span id="l40.72" class="difflineplus">+        id(&quot;week-view&quot;)/;</span>
<a href="#l40.73"></a><span id="l40.73" class="difflineplus">+    `;</span>
<a href="#l40.74"></a><span id="l40.74" class="difflineplus">+    let eventDialog = `</span>
<a href="#l40.75"></a><span id="l40.75" class="difflineplus">+        /id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/</span>
<a href="#l40.76"></a><span id="l40.76" class="difflineplus">+    `;</span>
<a href="#l40.77"></a><span id="l40.77" class="difflineplus">+    let eventBox = `</span>
<a href="#l40.78"></a><span id="l40.78" class="difflineplus">+        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l40.79"></a><span id="l40.79" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l40.80"></a><span id="l40.80" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/</span>
<a href="#l40.81"></a><span id="l40.81" class="difflineplus">+        {&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;${CALENDARNAME.toLowerCase()}&quot;}</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineplus">+    `;</span>
<a href="#l40.83"></a><span id="l40.83"> </span>
<a href="#l40.84"></a><span id="l40.84" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l40.85"></a><span id="l40.85" class="difflineminus">-    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-week-view-button&quot;));</span>
<a href="#l40.86"></a><span id="l40.86" class="difflineplus">+    controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l40.87"></a><span id="l40.87" class="difflineplus">+    controller.waitThenClick(eid(&quot;calendar-week-view-button&quot;));</span>
<a href="#l40.88"></a><span id="l40.88"> </span>
<a href="#l40.89"></a><span id="l40.89">     // pick year</span>
<a href="#l40.90"></a><span id="l40.90" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l40.91"></a><span id="l40.91" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l40.92"></a><span id="l40.92" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l40.94"></a><span id="l40.94" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l40.95"></a><span id="l40.95" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})</span>
<a href="#l40.97"></a><span id="l40.97" class="difflineplus">+    `));</span>
<a href="#l40.98"></a><span id="l40.98" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l40.99"></a><span id="l40.99" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l40.100"></a><span id="l40.100" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineplus">+        {&quot;value&quot;:&quot;2009&quot;}</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineplus">+    `));</span>
<a href="#l40.103"></a><span id="l40.103"> </span>
<a href="#l40.104"></a><span id="l40.104">     // pick month</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l40.107"></a><span id="l40.107" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l40.108"></a><span id="l40.108" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l40.109"></a><span id="l40.109" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l40.110"></a><span id="l40.110" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l40.111"></a><span id="l40.111" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})</span>
<a href="#l40.112"></a><span id="l40.112" class="difflineplus">+    `));</span>
<a href="#l40.113"></a><span id="l40.113" class="difflineplus">+    controller.click(lookup(`</span>
<a href="#l40.114"></a><span id="l40.114" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/</span>
<a href="#l40.115"></a><span id="l40.115" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/</span>
<a href="#l40.116"></a><span id="l40.116" class="difflineplus">+        {&quot;index&quot;:&quot;0&quot;}'</span>
<a href="#l40.117"></a><span id="l40.117" class="difflineplus">+    `));</span>
<a href="#l40.118"></a><span id="l40.118"> </span>
<a href="#l40.119"></a><span id="l40.119">     // pick day</span>
<a href="#l40.120"></a><span id="l40.120" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l40.121"></a><span id="l40.121" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l40.122"></a><span id="l40.122" class="difflineplus">+    controller.waitThenClick(lookup(`</span>
<a href="#l40.123"></a><span id="l40.123" class="difflineplus">+        ${miniMonth}/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}</span>
<a href="#l40.124"></a><span id="l40.124" class="difflineplus">+    `));</span>
<a href="#l40.125"></a><span id="l40.125"> </span>
<a href="#l40.126"></a><span id="l40.126">     // verify date</span>
<a href="#l40.127"></a><span id="l40.127" class="difflineminus">-    let day = new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l40.128"></a><span id="l40.128" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l40.129"></a><span id="l40.129" class="difflineminus">-      '{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l40.130"></a><span id="l40.130" class="difflineplus">+    let day = lookup(`</span>
<a href="#l40.131"></a><span id="l40.131" class="difflineplus">+        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/</span>
<a href="#l40.132"></a><span id="l40.132" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l40.133"></a><span id="l40.133" class="difflineplus">+    `);</span>
<a href="#l40.134"></a><span id="l40.134">     controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l40.135"></a><span id="l40.135"> </span>
<a href="#l40.136"></a><span id="l40.136">     // create event at 8 AM</span>
<a href="#l40.137"></a><span id="l40.137">     // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l40.138"></a><span id="l40.138" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l40.139"></a><span id="l40.139" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l40.140"></a><span id="l40.140" class="difflineminus">-      '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l40.141"></a><span id="l40.141" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l40.142"></a><span id="l40.142" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l40.143"></a><span id="l40.143" class="difflineminus">-</span>
<a href="#l40.144"></a><span id="l40.144" class="difflineminus">-    // check that the start time is correct</span>
<a href="#l40.145"></a><span id="l40.145" class="difflineminus">-    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l40.146"></a><span id="l40.146" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l40.147"></a><span id="l40.147" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l40.148"></a><span id="l40.148" class="difflineminus">-      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l40.149"></a><span id="l40.149" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l40.150"></a><span id="l40.150" class="difflineminus">-    event.waitForElement(startTimeInput);</span>
<a href="#l40.151"></a><span id="l40.151" class="difflineminus">-    event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l40.152"></a><span id="l40.152" class="difflineminus">-    let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l40.153"></a><span id="l40.153" class="difflineminus">-      2009, 1, 1);</span>
<a href="#l40.154"></a><span id="l40.154" class="difflineminus">-    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l40.155"></a><span id="l40.155" class="difflineminus">-      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l40.156"></a><span id="l40.156" class="difflineminus">-      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l40.157"></a><span id="l40.157" class="difflineminus">-      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l40.158"></a><span id="l40.158" class="difflineminus">-      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l40.159"></a><span id="l40.159" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l40.160"></a><span id="l40.160" class="difflineminus">-      date);</span>
<a href="#l40.161"></a><span id="l40.161" class="difflineplus">+    eventBox = lookup(`</span>
<a href="#l40.162"></a><span id="l40.162" class="difflineplus">+        ${weekView}/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/</span>
<a href="#l40.163"></a><span id="l40.163" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/</span>
<a href="#l40.164"></a><span id="l40.164" class="difflineplus">+        anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1</span>
<a href="#l40.165"></a><span id="l40.165" class="difflineplus">+    `);</span>
<a href="#l40.166"></a><span id="l40.166" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l40.167"></a><span id="l40.167" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l40.168"></a><span id="l40.168"> </span>
<a href="#l40.169"></a><span id="l40.169" class="difflineminus">-    // fill in title, description and calendar</span>
<a href="#l40.170"></a><span id="l40.170" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l40.171"></a><span id="l40.171" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l40.172"></a><span id="l40.172" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l40.173"></a><span id="l40.173" class="difflineminus">-      title1);</span>
<a href="#l40.174"></a><span id="l40.174" class="difflineminus">-    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l40.175"></a><span id="l40.175" class="difflineminus">-      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l40.176"></a><span id="l40.176" class="difflineminus">-      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l40.177"></a><span id="l40.177" class="difflineminus">-      desc);</span>
<a href="#l40.178"></a><span id="l40.178" class="difflineminus">-    event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l40.179"></a><span id="l40.179" class="difflineminus">-</span>
<a href="#l40.180"></a><span id="l40.180" class="difflineminus">-    // save</span>
<a href="#l40.181"></a><span id="l40.181" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l40.182"></a><span id="l40.182" class="difflineplus">+        // check that the start time is correct</span>
<a href="#l40.183"></a><span id="l40.183" class="difflineplus">+        let startTimeInput = eventlookup(`</span>
<a href="#l40.184"></a><span id="l40.184" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l40.185"></a><span id="l40.185" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l40.186"></a><span id="l40.186" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l40.187"></a><span id="l40.187" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l40.188"></a><span id="l40.188" class="difflineplus">+            anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l40.189"></a><span id="l40.189" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l40.190"></a><span id="l40.190" class="difflineplus">+        `);</span>
<a href="#l40.191"></a><span id="l40.191" class="difflineplus">+        event.waitForElement(startTimeInput);</span>
<a href="#l40.192"></a><span id="l40.192" class="difflineplus">+        event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l40.193"></a><span id="l40.193" class="difflineplus">+        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l40.194"></a><span id="l40.194" class="difflineplus">+        event.assertValue(eventlookup(`</span>
<a href="#l40.195"></a><span id="l40.195" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l40.196"></a><span id="l40.196" class="difflineplus">+            id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l40.197"></a><span id="l40.197" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l40.198"></a><span id="l40.198" class="difflineplus">+            anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l40.199"></a><span id="l40.199" class="difflineplus">+            {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l40.200"></a><span id="l40.200" class="difflineplus">+            anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l40.201"></a><span id="l40.201" class="difflineplus">+            anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l40.202"></a><span id="l40.202" class="difflineplus">+        `), date);</span>
<a href="#l40.203"></a><span id="l40.203"> </span>
<a href="#l40.204"></a><span id="l40.204" class="difflineminus">-    // if it was created successfully, it can be opened</span>
<a href="#l40.205"></a><span id="l40.205" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l40.206"></a><span id="l40.206" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l40.207"></a><span id="l40.207" class="difflineminus">-    controller.waitFor(() =&gt; utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l40.208"></a><span id="l40.208" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l40.209"></a><span id="l40.209" class="difflineplus">+        // fill in title, description and calendar</span>
<a href="#l40.210"></a><span id="l40.210" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l40.211"></a><span id="l40.211" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l40.212"></a><span id="l40.212" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l40.213"></a><span id="l40.213" class="difflineplus">+        `), TITLE1);</span>
<a href="#l40.214"></a><span id="l40.214" class="difflineplus">+        event.type(eventlookup(`</span>
<a href="#l40.215"></a><span id="l40.215" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/</span>
<a href="#l40.216"></a><span id="l40.216" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l40.217"></a><span id="l40.217" class="difflineplus">+        `), DESC);</span>
<a href="#l40.218"></a><span id="l40.218" class="difflineplus">+        event.select(eventid(&quot;item-calendar&quot;), null, CALENDARNAME);</span>
<a href="#l40.219"></a><span id="l40.219"> </span>
<a href="#l40.220"></a><span id="l40.220" class="difflineminus">-    // change title and save changes</span>
<a href="#l40.221"></a><span id="l40.221" class="difflineminus">-    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l40.222"></a><span id="l40.222" class="difflineminus">-      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l40.223"></a><span id="l40.223" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l40.224"></a><span id="l40.224" class="difflineminus">-    event.waitForElement(titleTextBox);</span>
<a href="#l40.225"></a><span id="l40.225" class="difflineminus">-    event.type(titleTextBox, title2);</span>
<a href="#l40.226"></a><span id="l40.226" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-saveandclose&quot;));</span>
<a href="#l40.227"></a><span id="l40.227" class="difflineplus">+        // save</span>
<a href="#l40.228"></a><span id="l40.228" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l40.229"></a><span id="l40.229" class="difflineplus">+    });</span>
<a href="#l40.230"></a><span id="l40.230" class="difflineplus">+</span>
<a href="#l40.231"></a><span id="l40.231" class="difflineplus">+    invokeEventDialog(controller, eventBox, (event, iframe) =&gt; {</span>
<a href="#l40.232"></a><span id="l40.232" class="difflineplus">+        let { lookup: eventlookup, eid: eventid } = helpersForController(event);</span>
<a href="#l40.233"></a><span id="l40.233" class="difflineplus">+</span>
<a href="#l40.234"></a><span id="l40.234" class="difflineplus">+        // change title and save changes</span>
<a href="#l40.235"></a><span id="l40.235" class="difflineplus">+        let titleTextBox = eventlookup(`</span>
<a href="#l40.236"></a><span id="l40.236" class="difflineplus">+            ${eventDialog}/id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/</span>
<a href="#l40.237"></a><span id="l40.237" class="difflineplus">+            anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l40.238"></a><span id="l40.238" class="difflineplus">+        `);</span>
<a href="#l40.239"></a><span id="l40.239" class="difflineplus">+        event.waitForElement(titleTextBox);</span>
<a href="#l40.240"></a><span id="l40.240" class="difflineplus">+        event.type(titleTextBox, TITLE2);</span>
<a href="#l40.241"></a><span id="l40.241" class="difflineplus">+        event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l40.242"></a><span id="l40.242" class="difflineplus">+    });</span>
<a href="#l40.243"></a><span id="l40.243"> </span>
<a href="#l40.244"></a><span id="l40.244">     // check if name was saved</span>
<a href="#l40.245"></a><span id="l40.245" class="difflineminus">-    let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l40.246"></a><span id="l40.246" class="difflineminus">-      '/anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l40.247"></a><span id="l40.247" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/' +</span>
<a href="#l40.248"></a><span id="l40.248" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l40.249"></a><span id="l40.249" class="difflineplus">+    let eventName = lookup(`</span>
<a href="#l40.250"></a><span id="l40.250" class="difflineplus">+        ${eventBox}//anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/</span>
<a href="#l40.251"></a><span id="l40.251" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-selection&quot;}/anon({&quot;anonid&quot;:&quot;eventbox&quot;})/</span>
<a href="#l40.252"></a><span id="l40.252" class="difflineplus">+        {&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})'</span>
<a href="#l40.253"></a><span id="l40.253" class="difflineplus">+    `);</span>
<a href="#l40.254"></a><span id="l40.254">     controller.waitForElement(eventName);</span>
<a href="#l40.255"></a><span id="l40.255" class="difflineminus">-    controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l40.256"></a><span id="l40.256" class="difflineplus">+    controller.assertJSProperty(eventName, &quot;textContent&quot;, TITLE2);</span>
<a href="#l40.257"></a><span id="l40.257"> </span>
<a href="#l40.258"></a><span id="l40.258">     // delete event</span>
<a href="#l40.259"></a><span id="l40.259" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l40.260"></a><span id="l40.260" class="difflineminus">-    controller.keypress(new elementslib.ID(controller.window.document, &quot;week-view&quot;),</span>
<a href="#l40.261"></a><span id="l40.261" class="difflineminus">-      &quot;VK_DELETE&quot;, {});</span>
<a href="#l40.262"></a><span id="l40.262" class="difflineminus">-    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l40.263"></a><span id="l40.263" class="difflineminus">-};</span>
<a href="#l40.264"></a><span id="l40.264" class="difflineplus">+    controller.click(lookup(eventBox));</span>
<a href="#l40.265"></a><span id="l40.265" class="difflineplus">+    controller.keypress(eid(&quot;week-view&quot;), &quot;VK_DELETE&quot;, {});</span>
<a href="#l40.266"></a><span id="l40.266" class="difflineplus">+    controller.waitForElementNotPresent(lookup(eventBox));</span>
<a href="#l40.267"></a><span id="l40.267" class="difflineplus">+}</span>
<a href="#l40.268"></a><span id="l40.268"> </span>
<a href="#l40.269"></a><span id="l40.269" class="difflineminus">-var teardownTest = function(module) {</span>
<a href="#l40.270"></a><span id="l40.270" class="difflineminus">-    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l40.271"></a><span id="l40.271" class="difflineminus">-};</span>
<a href="#l40.272"></a><span id="l40.272" class="difflineplus">+function teardownTest(module) {</span>
<a href="#l40.273"></a><span id="l40.273" class="difflineplus">+    deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l40.274"></a><span id="l40.274" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1">old mode 100644</span>
<a href="#l41.2"></a><span id="l41.2">new mode 100755</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

